{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NTQ5MTY5", "number": 865, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODo1NTo1M1rOE1jrWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwOTowODowMlrOFAGRjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTk0NTIxOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.deploy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODo1NTo1M1rOHt5Q1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODo1NTo1M1rOHt5Q1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg4NjE2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    cmd += \"--projects ${parentProjectName ?: directory}\"\n          \n          \n            \n                    cmd += \" --projects ${parentProjectName ?: directory}\"", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r517886166", "createdAt": "2020-11-05T08:55:53Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -270,9 +273,35 @@ void mavenCleanInstall(String directory, boolean skipTests = false, List profile\n     runMaven('clean install', directory, skipTests, profiles, extraArgs)\n }\n \n-void mavenDeploy(String directory) {\n-    extraArgs = params.MAVEN_DEPLOY_REPOSITORY != '' ? \"-DaltDeploymentRepository=runtimes-artifacts::default::${params.MAVEN_DEPLOY_REPOSITORY} -Denforcer.skip=true\" : ''\n-    runMaven('clean deploy', directory, true, [], extraArgs)\n+void mavenDeploy(String directory, String parentProjectName='') {\n+    if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY){\n+        extraArgs = ''\n+        if (params.MAVEN_DEPLOY_REPOSITORY){\n+            extraArgs += \"-DaltDeploymentRepository=runtimes-artifacts::default::${params.MAVEN_DEPLOY_REPOSITORY} -Denforcer.skip=true\"\n+        }\n+        runMaven('clean deploy', directory, true, [], extraArgs)\n+    } else {\n+        // First deploy locally\n+        extraArgs = \"-DaltDeploymentRepository=local::default::file://${env.MAVEN_DEPLOY_LOCAL_DIR}/${directory}\"\n+        runMaven('clean deploy', directory, true, [], extraArgs)\n+\n+        // Deploy to staging repository and close\n+        cmd = 'org.sonatype.plugins:nexus-staging-maven-plugin:1.6.5:deploy-staged-repository -DkeepStagingRepositoryOnCloseRuleFailure=true -DstagingProgressTimeoutMinutes=10'\n+        cmd += \"--projects ${parentProjectName ?: directory}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2020d8585240de01fd3429f99cf34ce2bb3e626c"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NjAzNDk3OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.deploy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOToxODoyN1rOHt6JEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOToxODoyN1rOHt6JEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkwMDU2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    cmd += \" --projects ${parentProjectName ?: directory}\"\n          \n          \n            \n                    cmd += \" --projects :${parentProjectName ?: directory}\"", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r517900562", "createdAt": "2020-11-05T09:18:27Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -270,9 +273,35 @@ void mavenCleanInstall(String directory, boolean skipTests = false, List profile\n     runMaven('clean install', directory, skipTests, profiles, extraArgs)\n }\n \n-void mavenDeploy(String directory) {\n-    extraArgs = params.MAVEN_DEPLOY_REPOSITORY != '' ? \"-DaltDeploymentRepository=runtimes-artifacts::default::${params.MAVEN_DEPLOY_REPOSITORY} -Denforcer.skip=true\" : ''\n-    runMaven('clean deploy', directory, true, [], extraArgs)\n+void mavenDeploy(String directory, String parentProjectName='') {\n+    if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY){\n+        extraArgs = ''\n+        if (params.MAVEN_DEPLOY_REPOSITORY){\n+            extraArgs += \"-DaltDeploymentRepository=runtimes-artifacts::default::${params.MAVEN_DEPLOY_REPOSITORY} -Denforcer.skip=true\"\n+        }\n+        runMaven('clean deploy', directory, true, [], extraArgs)\n+    } else {\n+        // First deploy locally\n+        extraArgs = \"-DaltDeploymentRepository=local::default::file://${env.MAVEN_DEPLOY_LOCAL_DIR}/${directory}\"\n+        runMaven('clean deploy', directory, true, [], extraArgs)\n+\n+        // Deploy to staging repository and close\n+        cmd = 'org.sonatype.plugins:nexus-staging-maven-plugin:1.6.5:deploy-staged-repository -DkeepStagingRepositoryOnCloseRuleFailure=true -DstagingProgressTimeoutMinutes=10'\n+        cmd += \" --projects ${parentProjectName ?: directory}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a6b4193614734bb85a37fff0c0d8a1f88e96673"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NjE1NzQ2OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.deploy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOTo0OToxMFrOHt7Vfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOTo0OToxMFrOHt7Vfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkyMDEyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    cmd += \"--projects ${directory}\"\n          \n          \n            \n                    cmd += \" --projects :${parentProjectName ?: directory}\"", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r517920127", "createdAt": "2020-11-05T09:49:10Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -270,9 +273,35 @@ void mavenCleanInstall(String directory, boolean skipTests = false, List profile\n     runMaven('clean install', directory, skipTests, profiles, extraArgs)\n }\n \n-void mavenDeploy(String directory) {\n-    extraArgs = params.MAVEN_DEPLOY_REPOSITORY != '' ? \"-DaltDeploymentRepository=runtimes-artifacts::default::${params.MAVEN_DEPLOY_REPOSITORY} -Denforcer.skip=true\" : ''\n-    runMaven('clean deploy', directory, true, [], extraArgs)\n+void mavenDeploy(String directory, String parentProjectName='') {\n+    if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY){\n+        extraArgs = ''\n+        if (params.MAVEN_DEPLOY_REPOSITORY){\n+            extraArgs += \"-DaltDeploymentRepository=runtimes-artifacts::default::${params.MAVEN_DEPLOY_REPOSITORY} -Denforcer.skip=true\"\n+        }\n+        runMaven('clean deploy', directory, true, [], extraArgs)\n+    } else {\n+        // First deploy locally\n+        extraArgs = \"-DaltDeploymentRepository=local::default::file://${env.MAVEN_DEPLOY_LOCAL_DIR}/${directory}\"\n+        runMaven('clean deploy', directory, true, [], extraArgs)\n+\n+        // Deploy to staging repository and close\n+        cmd = 'org.sonatype.plugins:nexus-staging-maven-plugin:1.6.5:deploy-staged-repository -DkeepStagingRepositoryOnCloseRuleFailure=true -DstagingProgressTimeoutMinutes=10'\n+        cmd += \" --projects :${parentProjectName ?: directory}\"\n+        cmd += \" -DnexusUrl=${env.NEXUS_RELEASE_URL}\"\n+        cmd += \" -DserverId=${env.NEXUS_RELEASE_REPOSITORY_ID}\" \n+        cmd += \" -DrepositoryDirectory=${env.MAVEN_DEPLOY_LOCAL_DIR}/${directory}\"\n+        cmd += \" -DstagingProfileId=${env.NEXUS_STAGING_REPOSITORY_ID}\" \n+        cmd += \" -DstagingDescription=\\\"Kogito Runtimes ${getProjectVersion()}\\\"\"\n+        echo \"Run maven cmd $cmd\"\n+        runMaven(cmd, directory)\n+\n+        // Promote to build profile\n+        cmd = \"org.sonatype.plugins:nexus-staging-maven-plugin:1.6.5:promote -DbuildPromotionProfileId=${env.NEXUS_BUILD_PROMOTION_PROFILE_ID}\"\n+        cmd += \"--projects ${directory}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cc6b409e9763445162ebbd15a6b36b7d0e12db5"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MDM2NjkxOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.deploy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTowMDowM1rOH9QoSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTowNjoyOFrOH9Q4RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk5NzY0Mg==", "bodyText": "what if you replace it by\ndef prBody = \"\"\"\nGenerated by build ${BUILD_TAG}: ${BUILD_URL}.\nPlease do not merge, it will be merged automatically after testing.\n\"\"\"", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r533997642", "createdAt": "2020-12-02T09:00:03Z", "author": {"login": "Ginxo"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -203,30 +224,12 @@ void prepareForPR(String repo) {\n     }\n }\n \n-void addNotIgnoredPoms() {\n-    // based on https://stackoverflow.com/a/59888964/8811872\n-    sh '''\n-    find . -type f -name 'pom.xml' > found_poms.txt\n-    poms_to_add=\"\"\n-    while IFS= read -r pom; do\n-        if ! git check-ignore -q \"\\$pom\"; then\n-            poms_to_add=\"\\$poms_to_add \\$pom\"\n-        fi\n-    done < found_poms.txt\n-    rm found_poms.txt\n-    git add \\$poms_to_add\n-    git status\n-    '''\n-}\n-\n void commitAndCreatePR(String repo) {\n-    def commitMsg = \"Update project version to ${getProjectVersion()} for release\"\n-    def prBody = \"Generated by build ${BUILD_TAG}: ${BUILD_URL}.\\nPlease do not merge, it will be merged automatically after testing.\"\n-    // Not using githubscm.commitChanges() because globbing won't work.\n-    // See: https://github.com/kiegroup/kogito-runtimes/pull/570#discussion_r449268738\n     dir(repo) {\n-        addNotIgnoredPoms()\n-        sh \"git commit -m '${commitMsg}'\"\n+        def commitMsg = \"Update project version to ${getProjectVersion()} for release\"\n+        def prBody = \"Generated by build ${BUILD_TAG}: ${BUILD_URL}.\\nPlease do not merge, it will be merged automatically after testing.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAwMTczMg==", "bodyText": "This is a good idea :) I guess I will implement it as a nice to have in another PR because I would like that one to be merged asap ;)\nThx for suggestion !", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534001732", "createdAt": "2020-12-02T09:06:28Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -203,30 +224,12 @@ void prepareForPR(String repo) {\n     }\n }\n \n-void addNotIgnoredPoms() {\n-    // based on https://stackoverflow.com/a/59888964/8811872\n-    sh '''\n-    find . -type f -name 'pom.xml' > found_poms.txt\n-    poms_to_add=\"\"\n-    while IFS= read -r pom; do\n-        if ! git check-ignore -q \"\\$pom\"; then\n-            poms_to_add=\"\\$poms_to_add \\$pom\"\n-        fi\n-    done < found_poms.txt\n-    rm found_poms.txt\n-    git add \\$poms_to_add\n-    git status\n-    '''\n-}\n-\n void commitAndCreatePR(String repo) {\n-    def commitMsg = \"Update project version to ${getProjectVersion()} for release\"\n-    def prBody = \"Generated by build ${BUILD_TAG}: ${BUILD_URL}.\\nPlease do not merge, it will be merged automatically after testing.\"\n-    // Not using githubscm.commitChanges() because globbing won't work.\n-    // See: https://github.com/kiegroup/kogito-runtimes/pull/570#discussion_r449268738\n     dir(repo) {\n-        addNotIgnoredPoms()\n-        sh \"git commit -m '${commitMsg}'\"\n+        def commitMsg = \"Update project version to ${getProjectVersion()} for release\"\n+        def prBody = \"Generated by build ${BUILD_TAG}: ${BUILD_URL}.\\nPlease do not merge, it will be merged automatically after testing.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk5NzY0Mg=="}, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 177}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MDQ4MjY0OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.deploy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOToyNjozMVrOH9Rugg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTo1MzowNVrOH9S2Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNTYxOA==", "bodyText": "Are these two IDs constant between releases or do we have to provide new ones per release?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534015618", "createdAt": "2020-12-02T09:26:31Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -24,13 +32,20 @@ pipeline {\n \n         // Build&test information\n         booleanParam(name: 'SKIP_TESTS', defaultValue: false, description: 'Skip tests')\n+        string(name: 'MAVEN_SETTINGS_CONFIG_FILE_ID', defaultValue: 'kogito_release_settings', description: 'Maven settings configfile to use in pipeline for Maven commands')\n \n         // Deploy information\n         string(name: 'MAVEN_DEPLOY_REPOSITORY', defaultValue: '', description: 'Specify a Maven repository to deploy the artifacts.')\n \n         // Release information\n         booleanParam(name: 'RELEASE', defaultValue: false, description: 'Is this build for a release?')\n         string(name: 'PROJECT_VERSION', defaultValue: '', description: 'Optional if not RELEASE. If RELEASE, cannot be empty.')\n+        \n+        // Nexus staging default parameters\n+        string(name: 'NEXUS_RELEASE_URL', defaultValue: 'https://repository.jboss.org/nexus', description: 'Nexus URL for release staging')\n+        string(name: 'NEXUS_RELEASE_REPOSITORY_ID', defaultValue: 'jboss-releases-repository', description: 'Nexus Release repository ID for staging')\n+        string(name: 'NEXUS_STAGING_PROFILE_ID', defaultValue: '2161b7b8da0080', description: 'Nexus staging profile ID for release process ')\n+        string(name: 'NEXUS_BUILD_PROMOTION_PROFILE_ID', defaultValue: 'ea49ccd6f174', description: 'Nexus Build Promotion profile ID for release process')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzNDAxOQ==", "bodyText": "those are constant. but for testing purpose, there might be different", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534034019", "createdAt": "2020-12-02T09:53:05Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -24,13 +32,20 @@ pipeline {\n \n         // Build&test information\n         booleanParam(name: 'SKIP_TESTS', defaultValue: false, description: 'Skip tests')\n+        string(name: 'MAVEN_SETTINGS_CONFIG_FILE_ID', defaultValue: 'kogito_release_settings', description: 'Maven settings configfile to use in pipeline for Maven commands')\n \n         // Deploy information\n         string(name: 'MAVEN_DEPLOY_REPOSITORY', defaultValue: '', description: 'Specify a Maven repository to deploy the artifacts.')\n \n         // Release information\n         booleanParam(name: 'RELEASE', defaultValue: false, description: 'Is this build for a release?')\n         string(name: 'PROJECT_VERSION', defaultValue: '', description: 'Optional if not RELEASE. If RELEASE, cannot be empty.')\n+        \n+        // Nexus staging default parameters\n+        string(name: 'NEXUS_RELEASE_URL', defaultValue: 'https://repository.jboss.org/nexus', description: 'Nexus URL for release staging')\n+        string(name: 'NEXUS_RELEASE_REPOSITORY_ID', defaultValue: 'jboss-releases-repository', description: 'Nexus Release repository ID for staging')\n+        string(name: 'NEXUS_STAGING_PROFILE_ID', defaultValue: '2161b7b8da0080', description: 'Nexus staging profile ID for release process ')\n+        string(name: 'NEXUS_BUILD_PROMOTION_PROFILE_ID', defaultValue: 'ea49ccd6f174', description: 'Nexus Build Promotion profile ID for release process')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNTYxOA=="}, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MDQ5MjQ0OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.deploy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOToyODo0OFrOH9R0rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOToyODo0OFrOH9R0rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxNzE5Nw==", "bodyText": "Formatting:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY){\n          \n          \n            \n                                if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY) {", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534017197", "createdAt": "2020-12-02T09:28:48Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -142,8 +152,19 @@ pipeline {\n         }\n         stage('Deploy artifacts') {\n             steps {\n-                mavenDeploy('kogito-runtimes')\n-                mavenDeploy('kogito-apps')\n+                script {\n+                    if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 133}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MDUwNTUyOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.deploy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTozMTozN1rOH9R8hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTo1NTozMVrOH9S9gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxOTIwNQ==", "bodyText": "If the params.MAVEN_DEPLOY_REPOSITORY is used only for testing, a comment would be nice.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534019205", "createdAt": "2020-12-02T09:31:37Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -142,8 +152,19 @@ pipeline {\n         }\n         stage('Deploy artifacts') {\n             steps {\n-                mavenDeploy('kogito-runtimes')\n-                mavenDeploy('kogito-apps')\n+                script {\n+                    if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAzNTg0MQ==", "bodyText": "done", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534035841", "createdAt": "2020-12-02T09:55:31Z", "author": {"login": "radtriste"}, "path": "Jenkinsfile.deploy", "diffHunk": "@@ -142,8 +152,19 @@ pipeline {\n         }\n         stage('Deploy artifacts') {\n             steps {\n-                mavenDeploy('kogito-runtimes')\n-                mavenDeploy('kogito-apps')\n+                script {\n+                    if(!isRelease() || params.MAVEN_DEPLOY_REPOSITORY){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAxOTIwNQ=="}, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 133}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MDUzOTUyOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile.promote", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTozOTo0MVrOH9SSCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTozOTo0MVrOH9SSCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAyNDcxMw==", "bodyText": "Nice to see this replacing the addNotIgnoredPoms().", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534024713", "createdAt": "2020-12-02T09:39:41Z", "author": {"login": "rsynek"}, "path": "Jenkinsfile.promote", "diffHunk": "@@ -284,28 +279,11 @@ void prepareForPR(String repo) {\n     githubscm.createBranch(getSnapshotBranch())\n }\n \n-void addNotIgnoredPoms() {\n-    // based on https://stackoverflow.com/a/59888964/8811872\n-    sh '''\n-    find . -type f -name 'pom.xml' > found_poms.txt\n-    poms_to_add=\"\"\n-    while IFS= read -r pom; do\n-        if ! git check-ignore -q \"\\$pom\"; then\n-            poms_to_add=\"\\$poms_to_add \\$pom\"\n-        fi\n-    done < found_poms.txt\n-    rm found_poms.txt\n-    git add \\$poms_to_add\n-    '''\n-}\n-\n void commitAndCreatePR(String repo) {\n     def commitMsg = \"Update snapshot version to ${getSnapshotVersion()}\"\n     def prBody = \"Generated by build ${BUILD_TAG}: ${BUILD_URL}.\\nPlease do not merge, it will be merged automatically after testing.\"\n-    // Not using githubscm.commitChanges() because globbing won't work.\n-    // See: https://github.com/kiegroup/kogito-runtimes/pull/570#discussion_r449268738\n-    addNotIgnoredPoms()\n-    sh \"git commit -m '${commitMsg}'\"\n+    \n+    githubscm.commitChanges(commitMsg, { githubscm.findAndStageNotIgnoredFiles('pom.xml') })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a02d64368c427fa90db41a23c0e736defcbc8d"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1NjQ3MTE2OnYy", "diffSide": "RIGHT", "path": ".jenkins/tests/src/test/vars/JenkinsfilePromote.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwOTowODowMlrOH-Mi5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwOToxODoxNFrOH-NDpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDk3OTMwMg==", "bodyText": "Was this formatting change intentional?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534979302", "createdAt": "2020-12-03T09:08:02Z", "author": {"login": "rsynek"}, "path": ".jenkins/tests/src/test/vars/JenkinsfilePromote.groovy", "diffHunk": "@@ -4,8 +4,8 @@ class JenkinsfilePromote extends JenkinsPipelineSpecification {\n \tdef Jenkinsfile = null\n \n     def setup() {\n-        Jenkinsfile = loadPipelineScriptForTest('Jenkinsfile.promote')\n-        Jenkinsfile.getBinding().setVariable('PROPERTIES_FILE_NAME', 'deployment.properties')\n+\t\t\tJenkinsfile = loadPipelineScriptForTest('Jenkinsfile.promote')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5129eca0e0178abaaff14e71818e0e871709db"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDk4NzY4Ng==", "bodyText": "nope, it is my IDE using real tabs instead of whitespaces ... gonna correct that ...", "url": "https://github.com/kiegroup/kogito-runtimes/pull/865#discussion_r534987686", "createdAt": "2020-12-03T09:18:14Z", "author": {"login": "radtriste"}, "path": ".jenkins/tests/src/test/vars/JenkinsfilePromote.groovy", "diffHunk": "@@ -4,8 +4,8 @@ class JenkinsfilePromote extends JenkinsPipelineSpecification {\n \tdef Jenkinsfile = null\n \n     def setup() {\n-        Jenkinsfile = loadPipelineScriptForTest('Jenkinsfile.promote')\n-        Jenkinsfile.getBinding().setVariable('PROPERTIES_FILE_NAME', 'deployment.properties')\n+\t\t\tJenkinsfile = loadPipelineScriptForTest('Jenkinsfile.promote')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDk3OTMwMg=="}, "originalCommit": {"oid": "ed5129eca0e0178abaaff14e71818e0e871709db"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4675, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}