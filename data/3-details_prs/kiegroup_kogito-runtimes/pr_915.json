{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3OTI0Mzk1", "number": 915, "title": "KOGITO-3849: kogito-events-api module + pluggable CloudEvent consumers", "bodyText": "Related Jira task\nRelated PR in kogito-apps\n\nGoal\nGive the developer of a Kogito app the capability to write custom consumers of events processed by the cloudevents addon with minimum effort. While doing so, try to isolate all the event-related APIs in a dedicated module.\nPart 1: the kogito-events-api module\nTarget\n\nHave a clearly identifiable place where to put all generic event-related code.\nHave a cleaner dependency graph.\n\nImplementation\n\nI moved almost all the generic classes and interfaces from kogito-api and kogito-services to a new module called kogito-events-api, with minimal dependencies (jackson-annotations and reactive-streams).\nI only left org.kie.kogito.event.EventManager inside kogito-api because otherwise it would generate a circular dependency between that and the new module: in fact, it depends from org.kie.kogito.Addons and is a dependency of org.kie.kogito.uow.UnitOfWorkManager.\nI left several classes/interfaces in org.kie.kogito.services.event inside kogito-services because they're strictly related to processes.\nAll the events addons now depends from kogito-events-api (it's even the only dependency of cloudevents-common-addon).\nkogito-events-api is now an optional dependency of both kogito-api and kogito-services: this allows to build without issues but forces the developer who needs events to explicitly declare it as dependency or include one of the events addons.\n\nPart 2: pluggable CloudEvents consumers\nImplementation\nI added a CloudEventReceiver class, which in my view is the dual of CloudEventEmitter, that hides the details about the wiring with the publisher.\nThe developer will simply need to declare a new bean that receives an injected CloudEventReceiver instance, which can be used to subscribe to incoming events.\nCustom consumer example for Quarkus\nHere is an example of a custom event consumer written for Quarkus.\nCustom consumer example for Spring Boot\nHere is an example of a custom event consumer written for Spring Boot.\nKnown issues\n\nOnly String payloads are supported at the moment. But that's how it works for the rest of the implementation.", "createdAt": "2020-11-26T08:52:10Z", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915", "merged": true, "mergeCommit": {"oid": "26419812b4aee24b9be31faa605d4699e8461c0c"}, "closed": true, "closedAt": "2020-12-18T13:11:05Z", "author": {"login": "kostola"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgk_lrgH2gAyNTI3OTI0Mzk1OmVjN2FmZTMyNzBhYmIzYmIwMTVhMmVhYmIwZjBkMGI3Y2FmM2NjMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnTwtggH2gAyNTI3OTI0Mzk1OmE4OTRkOGYwNmNmY2FjMTFmMzUzMjMxY2Y5MDY4MGExY2FiMTEyODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec7afe3270abb3bb015a2eabb0f0d0b7caf3cc32", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/ec7afe3270abb3bb015a2eabb0f0d0b7caf3cc32", "committedDate": "2020-11-27T10:28:51Z", "message": "KOGITO-3849: add CloudEventReceiver"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5dba95a0e5d45658ef31bf246dc4f9e797ffbf27", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/5dba95a0e5d45658ef31bf246dc4f9e797ffbf27", "committedDate": "2020-11-26T08:16:25Z", "message": "KOGITO-3849: add CloudEventReceiver"}, "afterCommit": {"oid": "ec7afe3270abb3bb015a2eabb0f0d0b7caf3cc32", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/ec7afe3270abb3bb015a2eabb0f0d0b7caf3cc32", "committedDate": "2020-11-27T10:28:51Z", "message": "KOGITO-3849: add CloudEventReceiver"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34d49b40cde2e7587db3fb1a78a4086c7a4642f5", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/34d49b40cde2e7587db3fb1a78a4086c7a4642f5", "committedDate": "2020-12-02T13:11:36Z", "message": "KOGITO-3849: move CloudEventEmitter/Receiver from kogito-services to kogito-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90651ee5fadfd141331db335b9510965e7835caf", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/90651ee5fadfd141331db335b9510965e7835caf", "committedDate": "2020-12-02T13:43:33Z", "message": "KOGITO-3849: add CloudEventReceiver#getEventPublisher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ba76481cd1a1c1c3a688c3c1b7ec7b76aa5bf07", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/7ba76481cd1a1c1c3a688c3c1b7ec7b76aa5bf07", "committedDate": "2020-12-04T14:16:22Z", "message": "KOGITO-3849: add kogito-events module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d5576149b17435176394c5c31c763d4d79b4a6c", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/2d5576149b17435176394c5c31c763d4d79b4a6c", "committedDate": "2020-12-10T15:30:00Z", "message": "KOGITO-3849: kogito-events is now kogito-events-api and detached completely from kogito-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cffe80dc56adfa7a1447ded7409dfe46841213c", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/9cffe80dc56adfa7a1447ded7409dfe46841213c", "committedDate": "2020-12-11T08:14:25Z", "message": "KOGITO-3849: merge branch master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35f035679bef11881a3c384cffe2c001fd35b0fc", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/35f035679bef11881a3c384cffe2c001fd35b0fc", "committedDate": "2020-12-11T09:50:49Z", "message": "KOGITO-3849: fix SpringTopicsInformationResourceTemplate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/cc1d03b432607e23f85ca6bf685417417fae73a5", "committedDate": "2020-12-11T14:05:18Z", "message": "KOGITO-3849: merge branch master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMjM2OTA0", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#pullrequestreview-550236904", "createdAt": "2020-12-11T16:12:18Z", "commit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTIyMTE2", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#pullrequestreview-551122116", "createdAt": "2020-12-14T08:07:33Z", "commit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTI1MjQ2", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#pullrequestreview-551125246", "createdAt": "2020-12-14T08:12:23Z", "commit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODoxMjoyNFrOIFEYEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODoyMDoyNVrOIFEptQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE4NTQ5MA==", "bodyText": "Please add a comment to mention why this dependency is optional and that is a transitive dependency in the addon so user is expected to only provide the addon", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#discussion_r542185490", "createdAt": "2020-12-14T08:12:24Z", "author": {"login": "danielezonca"}, "path": "api/kogito-api/pom.xml", "diffHunk": "@@ -35,6 +35,12 @@\n       <artifactId>jackson-annotations</artifactId>\n     </dependency>\n \n+    <dependency>\n+      <groupId>org.kie.kogito</groupId>\n+      <artifactId>kogito-events-api</artifactId>\n+      <optional>true</optional>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE4NzgzNw==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#discussion_r542187837", "createdAt": "2020-12-14T08:16:39Z", "author": {"login": "danielezonca"}, "path": "api/kogito-services/pom.xml", "diffHunk": "@@ -24,6 +24,11 @@\n       <groupId>org.kie.kogito</groupId>\n       <artifactId>kogito-api</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.kie.kogito</groupId>\n+      <artifactId>kogito-events-api</artifactId>\n+      <optional>true</optional>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MDAwNQ==", "bodyText": "I think it should be nice in another PR if this dependency can become optional also in jbpm-flow module. I expect we will need to do some changes in the code (i.e. create a jbpm-events module or similar).\n@cristianonicolai @tiagodolphine\nWdyt? Do you think it makes sense to create a similar ticket/task?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#discussion_r542190005", "createdAt": "2020-12-14T08:20:25Z", "author": {"login": "danielezonca"}, "path": "jbpm/jbpm-flow/pom.xml", "diffHunk": "@@ -25,6 +25,10 @@\n       <groupId>org.kie.kogito</groupId>\n       <artifactId>kogito-api</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.kie.kogito</groupId>\n+      <artifactId>kogito-events-api</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjYwOTc0", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#pullrequestreview-551260974", "createdAt": "2020-12-14T11:02:29Z", "commit": {"oid": "cc1d03b432607e23f85ca6bf685417417fae73a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "278c83508e908c71062ca4c03c7e940dfe33b421", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/278c83508e908c71062ca4c03c7e940dfe33b421", "committedDate": "2020-12-15T08:22:01Z", "message": "KOGITO-3849: explain kogito-events-api optional flag with a comment"}, "afterCommit": {"oid": "6186554810569bb4e6fe21823e16447c5ccfb644", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6186554810569bb4e6fe21823e16447c5ccfb644", "committedDate": "2020-12-15T08:52:24Z", "message": "KOGITO-3849: explain kogito-events-api optional flag with a comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6186554810569bb4e6fe21823e16447c5ccfb644", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6186554810569bb4e6fe21823e16447c5ccfb644", "committedDate": "2020-12-15T08:52:24Z", "message": "KOGITO-3849: explain kogito-events-api optional flag with a comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTQ0MTkx", "url": "https://github.com/kiegroup/kogito-runtimes/pull/915#pullrequestreview-554944191", "createdAt": "2020-12-17T20:01:24Z", "commit": {"oid": "6186554810569bb4e6fe21823e16447c5ccfb644"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a894d8f06cfcac11f353231cf90680a1cab11289", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/a894d8f06cfcac11f353231cf90680a1cab11289", "committedDate": "2020-12-18T08:21:41Z", "message": "KOGITO-3849: merge branch master"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3881, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}