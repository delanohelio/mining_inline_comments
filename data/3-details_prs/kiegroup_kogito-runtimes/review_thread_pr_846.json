{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NjAzNzA5", "number": 846, "reviewThreads": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo0MDoyMlrOEx4dZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNzowMzozNlrOE4BcDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzQwNzEwOnYy", "diffSide": "RIGHT", "path": "addons/svg-process-addon/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo0MDoyMlrOHoNqIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDozOTo0NlrOHoStEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkyODg2Nw==", "bodyText": "either turn to draft PR or remove this already", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r511928867", "createdAt": "2020-10-26T12:40:22Z", "author": {"login": "jstastny-cz"}, "path": "addons/svg-process-addon/pom.xml", "diffHunk": "@@ -0,0 +1,83 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.kie.kogito</groupId>\n+    <artifactId>addons</artifactId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>svg-process-addon</artifactId>\n+  <name>Kogito :: Add-Ons :: SVG Process Visualization</name>\n+\n+  <description>Process SVG visualization</description>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-vertx</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-resteasy-mutiny</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.smallrye.reactive</groupId>\n+      <artifactId>smallrye-mutiny-vertx-web-client</artifactId>\n+    </dependency>\n+    <!-- image -->\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>jbpm-process-svg</artifactId>\n+      <exclusions>\n+        <exclusion>\n+          <groupId>xml-apis</groupId>\n+          <artifactId>xml-apis</artifactId>\n+        </exclusion>\n+      </exclusions>\n+      <version>${version.org.kie7}</version>\n+    </dependency>\n+\n+    <!-- test dependencies -->\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-junit5</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.mockito</groupId>\n+      <artifactId>mockito-junit-jupiter</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>net.javacrumbs.json-unit</groupId>\n+      <artifactId>json-unit-assertj</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.rest-assured</groupId>\n+      <artifactId>rest-assured</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+\n+  </dependencies>\n+  <!-- just for DEV, TO BE REMOVED -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAxMTUzNw==", "bodyText": "@jstastny-cz  updated, I removed this part", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r512011537", "createdAt": "2020-10-26T14:39:46Z", "author": {"login": "nmirasch"}, "path": "addons/svg-process-addon/pom.xml", "diffHunk": "@@ -0,0 +1,83 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.kie.kogito</groupId>\n+    <artifactId>addons</artifactId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>svg-process-addon</artifactId>\n+  <name>Kogito :: Add-Ons :: SVG Process Visualization</name>\n+\n+  <description>Process SVG visualization</description>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-vertx</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-resteasy-mutiny</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.smallrye.reactive</groupId>\n+      <artifactId>smallrye-mutiny-vertx-web-client</artifactId>\n+    </dependency>\n+    <!-- image -->\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>jbpm-process-svg</artifactId>\n+      <exclusions>\n+        <exclusion>\n+          <groupId>xml-apis</groupId>\n+          <artifactId>xml-apis</artifactId>\n+        </exclusion>\n+      </exclusions>\n+      <version>${version.org.kie7}</version>\n+    </dependency>\n+\n+    <!-- test dependencies -->\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-junit5</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.mockito</groupId>\n+      <artifactId>mockito-junit-jupiter</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>net.javacrumbs.json-unit</groupId>\n+      <artifactId>json-unit-assertj</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.rest-assured</groupId>\n+      <artifactId>rest-assured</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+\n+  </dependencies>\n+  <!-- just for DEV, TO BE REMOVED -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkyODg2Nw=="}, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzQxNzI2OnYy", "diffSide": "RIGHT", "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo0MzowNFrOHoNwIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDo0MTozNlrOHoSyxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMDQwMw==", "bodyText": "I would argue for ProcessSvgService naming, imo it improves readability - similarly to the HttpResponse class imported above. Though I can see legacy naming conventions dictated by SVGImageProcessort and similar ...", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r511930403", "createdAt": "2020-10-26T12:43:04Z", "author": {"login": "jstastny-cz"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAxMjk5Ng==", "bodyText": "@jstastny-cz I renamed in many places SVG to Svg in classes and function, at least is homogeneous throw the current addon.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r512012996", "createdAt": "2020-10-26T14:41:36Z", "author": {"login": "nmirasch"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMDQwMw=="}, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzQzMjAzOnYy", "diffSide": "RIGHT", "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo0NzoyMlrOHoN5Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDo0MzoxNVrOHoS36A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMjc2Nw==", "bodyText": "the field is named svgResourcesPath, but in method we're using different naming convention in getProcessSVGFromVertxFileSystem, it would be good to unify.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r511932767", "createdAt": "2020-10-26T12:47:22Z", "author": {"login": "jstastny-cz"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ProcessSVGService.class);\n+\n+    private Vertx vertx;\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    private WebClient client;\n+    private String dataIndexHttpURL;\n+    private String svgResourcesPath;\n+    private String completedColor;\n+    private String completedBorderColor;\n+    private String activeBorderColor;\n+\n+    @Inject\n+    public ProcessSVGService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg.resources.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n+            @ConfigProperty(name = \"kogito.svg.color.completed\", defaultValue = \"#C0C0C0\") String completedColor,\n+            @ConfigProperty(name = \"kogito.svg.color.completed.border\", defaultValue = \"#030303\") String completedBorderColor,\n+            @ConfigProperty(name = \"kogito.svg.color.active.border\", defaultValue = \"#FF0000\") String activeBorderColor,\n+            Vertx vertx,\n+            Instance<WebClient> providedWebClient) {\n+        this.dataIndexHttpURL = dataIndexHttpURL;\n+        this.svgResourcesPath = svgResourcesPath;\n+        this.completedColor = completedColor;\n+        this.completedBorderColor = completedBorderColor;\n+        this.activeBorderColor = activeBorderColor;\n+        this.vertx = vertx;\n+        this.providedWebClient = providedWebClient;\n+    }\n+\n+    @PostConstruct\n+    public void initialize() {\n+        if (providedWebClient.isResolvable()) {\n+            this.client = providedWebClient.get();\n+        } else {\n+            WebClientOptions webClientOptions = getDataIndexWebClientOptions(this.dataIndexHttpURL);\n+            setClient(WebClient.create(Vertx.vertx(), webClientOptions));\n+            LOGGER.debug(\"Creating new instance of web client\");\n+        }\n+    }\n+\n+    public WebClient getClient() {\n+        return client;\n+    }\n+\n+    public void setClient(WebClient client) {\n+        this.client = client;\n+    }\n+\n+    public String getProcessSVGFromVertxFileSystem(String processId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMzMyMw==", "bodyText": "And below for the method getSvgFileUni", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r511933323", "createdAt": "2020-10-26T12:48:16Z", "author": {"login": "jstastny-cz"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ProcessSVGService.class);\n+\n+    private Vertx vertx;\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    private WebClient client;\n+    private String dataIndexHttpURL;\n+    private String svgResourcesPath;\n+    private String completedColor;\n+    private String completedBorderColor;\n+    private String activeBorderColor;\n+\n+    @Inject\n+    public ProcessSVGService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg.resources.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n+            @ConfigProperty(name = \"kogito.svg.color.completed\", defaultValue = \"#C0C0C0\") String completedColor,\n+            @ConfigProperty(name = \"kogito.svg.color.completed.border\", defaultValue = \"#030303\") String completedBorderColor,\n+            @ConfigProperty(name = \"kogito.svg.color.active.border\", defaultValue = \"#FF0000\") String activeBorderColor,\n+            Vertx vertx,\n+            Instance<WebClient> providedWebClient) {\n+        this.dataIndexHttpURL = dataIndexHttpURL;\n+        this.svgResourcesPath = svgResourcesPath;\n+        this.completedColor = completedColor;\n+        this.completedBorderColor = completedBorderColor;\n+        this.activeBorderColor = activeBorderColor;\n+        this.vertx = vertx;\n+        this.providedWebClient = providedWebClient;\n+    }\n+\n+    @PostConstruct\n+    public void initialize() {\n+        if (providedWebClient.isResolvable()) {\n+            this.client = providedWebClient.get();\n+        } else {\n+            WebClientOptions webClientOptions = getDataIndexWebClientOptions(this.dataIndexHttpURL);\n+            setClient(WebClient.create(Vertx.vertx(), webClientOptions));\n+            LOGGER.debug(\"Creating new instance of web client\");\n+        }\n+    }\n+\n+    public WebClient getClient() {\n+        return client;\n+    }\n+\n+    public void setClient(WebClient client) {\n+        this.client = client;\n+    }\n+\n+    public String getProcessSVGFromVertxFileSystem(String processId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMjc2Nw=="}, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAxNDMxMg==", "bodyText": "Agree, I just modify the references to getSvg, getSvgFrom.. Let me know if this fits please :)", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r512014312", "createdAt": "2020-10-26T14:43:15Z", "author": {"login": "nmirasch"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ProcessSVGService.class);\n+\n+    private Vertx vertx;\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    private WebClient client;\n+    private String dataIndexHttpURL;\n+    private String svgResourcesPath;\n+    private String completedColor;\n+    private String completedBorderColor;\n+    private String activeBorderColor;\n+\n+    @Inject\n+    public ProcessSVGService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg.resources.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n+            @ConfigProperty(name = \"kogito.svg.color.completed\", defaultValue = \"#C0C0C0\") String completedColor,\n+            @ConfigProperty(name = \"kogito.svg.color.completed.border\", defaultValue = \"#030303\") String completedBorderColor,\n+            @ConfigProperty(name = \"kogito.svg.color.active.border\", defaultValue = \"#FF0000\") String activeBorderColor,\n+            Vertx vertx,\n+            Instance<WebClient> providedWebClient) {\n+        this.dataIndexHttpURL = dataIndexHttpURL;\n+        this.svgResourcesPath = svgResourcesPath;\n+        this.completedColor = completedColor;\n+        this.completedBorderColor = completedBorderColor;\n+        this.activeBorderColor = activeBorderColor;\n+        this.vertx = vertx;\n+        this.providedWebClient = providedWebClient;\n+    }\n+\n+    @PostConstruct\n+    public void initialize() {\n+        if (providedWebClient.isResolvable()) {\n+            this.client = providedWebClient.get();\n+        } else {\n+            WebClientOptions webClientOptions = getDataIndexWebClientOptions(this.dataIndexHttpURL);\n+            setClient(WebClient.create(Vertx.vertx(), webClientOptions));\n+            LOGGER.debug(\"Creating new instance of web client\");\n+        }\n+    }\n+\n+    public WebClient getClient() {\n+        return client;\n+    }\n+\n+    public void setClient(WebClient client) {\n+        this.client = client;\n+    }\n+\n+    public String getProcessSVGFromVertxFileSystem(String processId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMjc2Nw=="}, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzQzOTIyOnYy", "diffSide": "RIGHT", "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo0OToxOFrOHoN9rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo0OToxOFrOHoN9rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMzg3MQ==", "bodyText": "the method naming - it would be good to start with a verb - does transformSvgToShowExecutedPath work fine?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r511933871", "createdAt": "2020-10-26T12:49:18Z", "author": {"login": "jstastny-cz"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ProcessSVGService.class);\n+\n+    private Vertx vertx;\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    private WebClient client;\n+    private String dataIndexHttpURL;\n+    private String svgResourcesPath;\n+    private String completedColor;\n+    private String completedBorderColor;\n+    private String activeBorderColor;\n+\n+    @Inject\n+    public ProcessSVGService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg.resources.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n+            @ConfigProperty(name = \"kogito.svg.color.completed\", defaultValue = \"#C0C0C0\") String completedColor,\n+            @ConfigProperty(name = \"kogito.svg.color.completed.border\", defaultValue = \"#030303\") String completedBorderColor,\n+            @ConfigProperty(name = \"kogito.svg.color.active.border\", defaultValue = \"#FF0000\") String activeBorderColor,\n+            Vertx vertx,\n+            Instance<WebClient> providedWebClient) {\n+        this.dataIndexHttpURL = dataIndexHttpURL;\n+        this.svgResourcesPath = svgResourcesPath;\n+        this.completedColor = completedColor;\n+        this.completedBorderColor = completedBorderColor;\n+        this.activeBorderColor = activeBorderColor;\n+        this.vertx = vertx;\n+        this.providedWebClient = providedWebClient;\n+    }\n+\n+    @PostConstruct\n+    public void initialize() {\n+        if (providedWebClient.isResolvable()) {\n+            this.client = providedWebClient.get();\n+        } else {\n+            WebClientOptions webClientOptions = getDataIndexWebClientOptions(this.dataIndexHttpURL);\n+            setClient(WebClient.create(Vertx.vertx(), webClientOptions));\n+            LOGGER.debug(\"Creating new instance of web client\");\n+        }\n+    }\n+\n+    public WebClient getClient() {\n+        return client;\n+    }\n+\n+    public void setClient(WebClient client) {\n+        this.client = client;\n+    }\n+\n+    public String getProcessSVGFromVertxFileSystem(String processId) {\n+        return vertx.fileSystem()\n+                .readFileBlocking(svgResourcesPath + processId + \".svg\")\n+                .toString(UTF_8);\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgFileUni(String processId) {\n+        return getClient().get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgFileContent(resp, processId));\n+    }\n+\n+    protected String getSvgFileContent(HttpResponse<Buffer> resp, String processId) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return getProcessSVGFromVertxFileSystem(processId);\n+    }\n+\n+    public String svgTransformToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzQ0MjQ2OnYy", "diffSide": "RIGHT", "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo1MDowNFrOHoN_ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDo0NDo1OVrOHoS9Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNDM0Ng==", "bodyText": "can we use constant for the http status code?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r511934346", "createdAt": "2020-10-26T12:50:04Z", "author": {"login": "jstastny-cz"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ProcessSVGService.class);\n+\n+    private Vertx vertx;\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    private WebClient client;\n+    private String dataIndexHttpURL;\n+    private String svgResourcesPath;\n+    private String completedColor;\n+    private String completedBorderColor;\n+    private String activeBorderColor;\n+\n+    @Inject\n+    public ProcessSVGService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg.resources.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n+            @ConfigProperty(name = \"kogito.svg.color.completed\", defaultValue = \"#C0C0C0\") String completedColor,\n+            @ConfigProperty(name = \"kogito.svg.color.completed.border\", defaultValue = \"#030303\") String completedBorderColor,\n+            @ConfigProperty(name = \"kogito.svg.color.active.border\", defaultValue = \"#FF0000\") String activeBorderColor,\n+            Vertx vertx,\n+            Instance<WebClient> providedWebClient) {\n+        this.dataIndexHttpURL = dataIndexHttpURL;\n+        this.svgResourcesPath = svgResourcesPath;\n+        this.completedColor = completedColor;\n+        this.completedBorderColor = completedBorderColor;\n+        this.activeBorderColor = activeBorderColor;\n+        this.vertx = vertx;\n+        this.providedWebClient = providedWebClient;\n+    }\n+\n+    @PostConstruct\n+    public void initialize() {\n+        if (providedWebClient.isResolvable()) {\n+            this.client = providedWebClient.get();\n+        } else {\n+            WebClientOptions webClientOptions = getDataIndexWebClientOptions(this.dataIndexHttpURL);\n+            setClient(WebClient.create(Vertx.vertx(), webClientOptions));\n+            LOGGER.debug(\"Creating new instance of web client\");\n+        }\n+    }\n+\n+    public WebClient getClient() {\n+        return client;\n+    }\n+\n+    public void setClient(WebClient client) {\n+        this.client = client;\n+    }\n+\n+    public String getProcessSVGFromVertxFileSystem(String processId) {\n+        return vertx.fileSystem()\n+                .readFileBlocking(svgResourcesPath + processId + \".svg\")\n+                .toString(UTF_8);\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgFileUni(String processId) {\n+        return getClient().get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgFileContent(resp, processId));\n+    }\n+\n+    protected String getSvgFileContent(HttpResponse<Buffer> resp, String processId) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return getProcessSVGFromVertxFileSystem(processId);\n+    }\n+\n+    public String svgTransformToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes) {\n+        if (svg != null) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n+                SVGProcessor processor = new SVGImageProcessor(svgStream).getProcessor();\n+                completedNodes.stream().forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));\n+                activeNodes.stream().forEach(nodeId -> processor.defaultActiveTransformation(nodeId, activeBorderColor));\n+                return processor.getSVG();\n+            } else {\n+                return svg;\n+            }\n+        } else {\n+            return \"SVG Not processed\";\n+        }\n+    }\n+\n+    public void fillNodesArrays(HttpResponse<Buffer> response, List<String> completedNodes, List<String> activeNodes) {\n+        if (response.statusCode() == 200) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAxNTY4Mg==", "bodyText": "done", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r512015682", "createdAt": "2020-10-26T14:44:59Z", "author": {"login": "nmirasch"}, "path": "addons/svg-process-addon/src/main/java/org/kie/kogito/svg/service/ProcessSVGService.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class ProcessSVGService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ProcessSVGService.class);\n+\n+    private Vertx vertx;\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    private WebClient client;\n+    private String dataIndexHttpURL;\n+    private String svgResourcesPath;\n+    private String completedColor;\n+    private String completedBorderColor;\n+    private String activeBorderColor;\n+\n+    @Inject\n+    public ProcessSVGService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg.resources.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n+            @ConfigProperty(name = \"kogito.svg.color.completed\", defaultValue = \"#C0C0C0\") String completedColor,\n+            @ConfigProperty(name = \"kogito.svg.color.completed.border\", defaultValue = \"#030303\") String completedBorderColor,\n+            @ConfigProperty(name = \"kogito.svg.color.active.border\", defaultValue = \"#FF0000\") String activeBorderColor,\n+            Vertx vertx,\n+            Instance<WebClient> providedWebClient) {\n+        this.dataIndexHttpURL = dataIndexHttpURL;\n+        this.svgResourcesPath = svgResourcesPath;\n+        this.completedColor = completedColor;\n+        this.completedBorderColor = completedBorderColor;\n+        this.activeBorderColor = activeBorderColor;\n+        this.vertx = vertx;\n+        this.providedWebClient = providedWebClient;\n+    }\n+\n+    @PostConstruct\n+    public void initialize() {\n+        if (providedWebClient.isResolvable()) {\n+            this.client = providedWebClient.get();\n+        } else {\n+            WebClientOptions webClientOptions = getDataIndexWebClientOptions(this.dataIndexHttpURL);\n+            setClient(WebClient.create(Vertx.vertx(), webClientOptions));\n+            LOGGER.debug(\"Creating new instance of web client\");\n+        }\n+    }\n+\n+    public WebClient getClient() {\n+        return client;\n+    }\n+\n+    public void setClient(WebClient client) {\n+        this.client = client;\n+    }\n+\n+    public String getProcessSVGFromVertxFileSystem(String processId) {\n+        return vertx.fileSystem()\n+                .readFileBlocking(svgResourcesPath + processId + \".svg\")\n+                .toString(UTF_8);\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgFileUni(String processId) {\n+        return getClient().get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgFileContent(resp, processId));\n+    }\n+\n+    protected String getSvgFileContent(HttpResponse<Buffer> resp, String processId) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return getProcessSVGFromVertxFileSystem(processId);\n+    }\n+\n+    public String svgTransformToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes) {\n+        if (svg != null) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n+                SVGProcessor processor = new SVGImageProcessor(svgStream).getProcessor();\n+                completedNodes.stream().forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));\n+                activeNodes.stream().forEach(nodeId -> processor.defaultActiveTransformation(nodeId, activeBorderColor));\n+                return processor.getSVG();\n+            } else {\n+                return svg;\n+            }\n+        } else {\n+            return \"SVG Not processed\";\n+        }\n+    }\n+\n+    public void fillNodesArrays(HttpResponse<Buffer> response, List<String> completedNodes, List<String> activeNodes) {\n+        if (response.statusCode() == 200) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNDM0Ng=="}, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 147}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzQ0Nzg2OnYy", "diffSide": "RIGHT", "path": "addons/svg-process-addon/src/main/resources/META-INF/processSVG/README.txt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo1MTozNlrOHoODAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMjo1MTozNlrOHoODAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNTIzNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Place here the Process SVG to used as source where draw the execution path.\n          \n          \n            \n            Place here the Process SVG to be used as source where to draw the execution path.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r511935234", "createdAt": "2020-10-26T12:51:36Z", "author": {"login": "jstastny-cz"}, "path": "addons/svg-process-addon/src/main/resources/META-INF/processSVG/README.txt", "diffHunk": "@@ -0,0 +1,2 @@\n+Place here the Process SVG to used as source where draw the execution path.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "308796690d07bb6f451aa371d3d36d61f4e01e84"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA3MDgwOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/.gitignore", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxNDo0NVrOHr2f3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxNDo0NVrOHr2f3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0MzcxMA==", "bodyText": "@nmirasch you can remove this as there is a .gitignore at the root level of the project already", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515743710", "createdAt": "2020-11-02T05:14:45Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/.gitignore", "diffHunk": "@@ -0,0 +1,11 @@\n+target/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA3MTI4OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxNTowNVrOHr2gIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxNTowNVrOHr2gIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0Mzc3Nw==", "bodyText": "SVG ?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515743777", "createdAt": "2020-11-02T05:15:05Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/pom.xml", "diffHunk": "@@ -0,0 +1,16 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.kie.kogito</groupId>\n+    <artifactId>addons</artifactId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>process-svg</artifactId>\n+  <packaging>pom</packaging>\n+  <name>Kogito :: Add-Ons :: Process svg</name>\n+  <description>Process Svg showing execution path</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA3Mjc2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxNjowMVrOHr2g8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxNjowMVrOHr2g8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0Mzk4Nw==", "bodyText": "Maybe\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <name>Kogito :: Add-Ons :: process-svg :: Common</name>\n          \n          \n            \n              <name>Kogito :: Add-Ons :: Process SVG :: Common</name>", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515743987", "createdAt": "2020-11-02T05:16:01Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/pom.xml", "diffHunk": "@@ -0,0 +1,67 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~     http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>process-svg</artifactId>\n+    <groupId>org.kie.kogito</groupId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>process-svg-common</artifactId>\n+  <name>Kogito :: Add-Ons :: process-svg :: Common</name>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA3NTY2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxODoxM1rOHr2imw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxODoxM1rOHr2imw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NDQxMQ==", "bodyText": "Just make sure resources are closed\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n          \n          \n            \n                            try(InputStream svgStream = new ByteArrayInputStream(svg.getBytes())){", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515744411", "createdAt": "2020-11-02T05:18:13Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+\n+    public String getSvgResourcesPath() {\n+        return svgResourcesPath;\n+    }\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String transformSvgToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {\n+        if (svg != null && !svg.isEmpty()) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA3NjU2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxODo0N1rOHr2jGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxODo0N1rOHr2jGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NDUzOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            completedNodes.stream().forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));\n          \n          \n            \n                            completedNodes.forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515744538", "createdAt": "2020-11-02T05:18:47Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+\n+    public String getSvgResourcesPath() {\n+        return svgResourcesPath;\n+    }\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String transformSvgToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {\n+        if (svg != null && !svg.isEmpty()) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n+                SVGProcessor processor = new SVGImageProcessor(svgStream).getProcessor();\n+                completedNodes.stream().forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA3Njc4OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxODo1NlrOHr2jPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxODo1NlrOHr2jPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NDU3Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            activeNodes.stream().forEach(nodeId -> processor.defaultActiveTransformation(nodeId, activeBorderColor));\n          \n          \n            \n                            activeNodes.forEach(nodeId -> processor.defaultActiveTransformation(nodeId, activeBorderColor));", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515744573", "createdAt": "2020-11-02T05:18:56Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+\n+    public String getSvgResourcesPath() {\n+        return svgResourcesPath;\n+    }\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String transformSvgToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {\n+        if (svg != null && !svg.isEmpty()) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n+                SVGProcessor processor = new SVGImageProcessor(svgStream).getProcessor();\n+                completedNodes.stream().forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));\n+                activeNodes.stream().forEach(nodeId -> processor.defaultActiveTransformation(nodeId, activeBorderColor));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA3ODAyOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxOTozNFrOHr2j5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToxOTozNFrOHr2j5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NDc0MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            nodesArray.stream()\n          \n          \n            \n                            nodesArray", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515744740", "createdAt": "2020-11-02T05:19:34Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+\n+    public String getSvgResourcesPath() {\n+        return svgResourcesPath;\n+    }\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String transformSvgToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {\n+        if (svg != null && !svg.isEmpty()) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n+                SVGProcessor processor = new SVGImageProcessor(svgStream).getProcessor();\n+                completedNodes.stream().forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));\n+                activeNodes.stream().forEach(nodeId -> processor.defaultActiveTransformation(nodeId, activeBorderColor));\n+                return processor.getSVG();\n+            } else {\n+                return svg;\n+            }\n+        } else {\n+            return  \"\";\n+        }\n+    }\n+\n+    public void fillNodeArrays(HttpResponse<Buffer> response, List<String> completedNodes, List<String> activeNodes) {\n+        if (response.statusCode() == RESPONSE_STATUS_CODE_OK) {\n+            JsonArray pInstancesArray = response.bodyAsJsonObject().getJsonObject(\"data\")\n+                    .getJsonArray(\"ProcessInstances\");\n+            if (pInstancesArray != null && !pInstancesArray.isEmpty()) {\n+                JsonArray nodesArray = pInstancesArray.getJsonObject(0).getJsonArray(\"nodes\");\n+                nodesArray.stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA4NTI1OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNDoxMlrOHr2nwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNDoxMlrOHr2nwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NTczMA==", "bodyText": "shouldnt we simply get from the filesystem instead?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515745730", "createdAt": "2020-11-02T05:24:12Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+\n+    public String getSvgResourcesPath() {\n+        return svgResourcesPath;\n+    }\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA4NjI1OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNDo1MFrOHr2oUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNDo1MFrOHr2oUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NTg3NA==", "bodyText": "Maybe we should log some error or even fail deployment as the image wont have the execution information?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515745874", "createdAt": "2020-11-02T05:24:50Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+\n+    public String getSvgResourcesPath() {\n+        return svgResourcesPath;\n+    }\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String transformSvgToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {\n+        if (svg != null && !svg.isEmpty()) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n+                SVGProcessor processor = new SVGImageProcessor(svgStream).getProcessor();\n+                completedNodes.stream().forEach(nodeId -> processor.defaultCompletedTransformation(nodeId, completedColor, completedBorderColor));\n+                activeNodes.stream().forEach(nodeId -> processor.defaultActiveTransformation(nodeId, activeBorderColor));\n+                return processor.getSVG();\n+            } else {\n+                return svg;\n+            }\n+        } else {\n+            return  \"\";\n+        }\n+    }\n+\n+    public void fillNodeArrays(HttpResponse<Buffer> response, List<String> completedNodes, List<String> activeNodes) {\n+        if (response.statusCode() == RESPONSE_STATUS_CODE_OK) {\n+            JsonArray pInstancesArray = response.bodyAsJsonObject().getJsonObject(\"data\")\n+                    .getJsonArray(\"ProcessInstances\");\n+            if (pInstancesArray != null && !pInstancesArray.isEmpty()) {\n+                JsonArray nodesArray = pInstancesArray.getJsonObject(0).getJsonArray(\"nodes\");\n+                nodesArray.stream()\n+                        .forEach(node -> {\n+                            if (isNull(((JsonObject) node).getInstant(\"exit\"))) {\n+                                activeNodes.add(((JsonObject) node).getString(\"definitionId\"));\n+                            } else {\n+                                completedNodes.add(((JsonObject) node).getString(\"definitionId\"));\n+                            }\n+                        });\n+            }\n+        }\n+    }\n+\n+    public WebClientOptions getWebClientToURLOptions(String targetHttpURL) {\n+        try {\n+            URL dataIndexURL = new URL(targetHttpURL);\n+            return new WebClientOptions()\n+                    .setDefaultHost(dataIndexURL.getHost())\n+                    .setDefaultPort(dataIndexURL.getPort())\n+                    .addEnabledSecureTransportProtocol(dataIndexURL.getProtocol());\n+        } catch (MalformedURLException malformedURLException) {\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 140}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA4OTQ2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/.gitignore", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNjo0NlrOHr2qDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNjo0NlrOHr2qDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NjMxNw==", "bodyText": "same here", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515746317", "createdAt": "2020-11-02T05:26:46Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/.gitignore", "diffHunk": "@@ -0,0 +1,11 @@\n+target/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA4OTk3OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNzowM1rOHr2qVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNToyNzowM1rOHr2qVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NjM5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <name>Kogito :: Add-Ons :: Process svg :: Quarkus Addon</name>\n          \n          \n            \n              <name>Kogito :: Add-Ons :: Process SVG :: Quarkus Addon</name>", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515746390", "createdAt": "2020-11-02T05:27:03Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/pom.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.kie.kogito</groupId>\n+    <artifactId>process-svg</artifactId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>process-svg-quarkus-addon</artifactId>\n+  <name>Kogito :: Add-Ons :: Process svg :: Quarkus Addon</name>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjA5OTI0OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNTozMjo1MFrOHr2vaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNTozMjo1MFrOHr2vaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0NzY4OA==", "bodyText": "@nmirasch in the runtimes, we've been using JAX-RS to build REST services based on Quarkus, do you think would be ok to migrate to that instead of using VertX?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Route(path = \"/svg/process/:processId/instances/:processInstanceId\", methods = HttpMethod.GET, produces = \"application/svg+xml\")\n          \n          \n            \n                @Route(path = \"/svg/processes/:processId/instances/:processInstanceId\", methods = HttpMethod.GET, produces = \"application/svg+xml\")", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515747688", "createdAt": "2020-11-02T05:32:50Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.rest;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Observes;\n+import javax.inject.Inject;\n+\n+import io.quarkus.vertx.web.Route;\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.http.HttpMethod;\n+import io.vertx.ext.web.Router;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.handler.StaticHandler;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import org.kie.kogito.svg.service.QuarkusProcessSvgService;\n+\n+@ApplicationScoped\n+public class ProcessSvgResource {\n+\n+    @Inject\n+    QuarkusProcessSvgService service;\n+\n+    public void setupRouter(@Observes Router router) {\n+        StaticHandler diagramHandler = StaticHandler.create();\n+        diagramHandler.setAllowRootFileSystemAccess(true);\n+        diagramHandler.setWebRoot(service.getSvgResourcesPath());\n+        router.route(\"/diagram/*\").handler(diagramHandler);\n+    }\n+\n+    @Route(path = \"/svg/process/:processId/instances/:processInstanceId\", methods = HttpMethod.GET, produces = \"application/svg+xml\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjEwNDg0OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNTozNjoxM1rOHr2ygg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNTozNjoxM1rOHr2ygg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0ODQ4Mg==", "bodyText": "Maybe call it annotateExecutedPath ? As it is inside ProcessSvgService already.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515748482", "createdAt": "2020-11-02T05:36:13Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+\n+    public String getSvgResourcesPath() {\n+        return svgResourcesPath;\n+    }\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String transformSvgToShowExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjEwNjQxOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNTozNzowOVrOHr2zXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNTozNzowOVrOHr2zXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0ODcwMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <description>Process svg Quarkus Addon to interact with Process Svg Service</description>\n          \n          \n            \n              <description>Quarkus Addon to interact with Process SVG Service</description>", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515748701", "createdAt": "2020-11-02T05:37:09Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/pom.xml", "diffHunk": "@@ -0,0 +1,53 @@\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.kie.kogito</groupId>\n+    <artifactId>process-svg</artifactId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>process-svg-quarkus-addon</artifactId>\n+  <name>Kogito :: Add-Ons :: Process svg :: Quarkus Addon</name>\n+\n+  <description>Process svg Quarkus Addon to interact with Process Svg Service</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjExMDUzOnYy", "diffSide": "RIGHT", "path": "kogito-bom/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNTozOTo1MVrOHr21tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMDoyODozN1rOHs_VSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0OTMwMw==", "bodyText": "do we still have/need this module?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r515749303", "createdAt": "2020-11-02T05:39:51Z", "author": {"login": "cristianonicolai"}, "path": "kogito-bom/pom.xml", "diffHunk": "@@ -306,6 +306,45 @@\n         <version>${project.version}</version>\n         <classifier>sources</classifier>\n       </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-common</artifactId>\n+        <version>${project.version}</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-common</artifactId>\n+        <version>${project.version}</version>\n+        <classifier>sources</classifier>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-common</artifactId>\n+        <version>${project.version}</version>\n+        <type>test-jar</type>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-quarkus-addon</artifactId>\n+        <version>${project.version}</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-quarkus-addon</artifactId>\n+        <version>${project.version}</version>\n+        <classifier>sources</classifier>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>svg-process-addon</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkzNzAzMw==", "bodyText": "removed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516937033", "createdAt": "2020-11-03T20:28:37Z", "author": {"login": "nmirasch"}, "path": "kogito-bom/pom.xml", "diffHunk": "@@ -306,6 +306,45 @@\n         <version>${project.version}</version>\n         <classifier>sources</classifier>\n       </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-common</artifactId>\n+        <version>${project.version}</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-common</artifactId>\n+        <version>${project.version}</version>\n+        <classifier>sources</classifier>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-common</artifactId>\n+        <version>${project.version}</version>\n+        <type>test-jar</type>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-quarkus-addon</artifactId>\n+        <version>${project.version}</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>process-svg-quarkus-addon</artifactId>\n+        <version>${project.version}</version>\n+        <classifier>sources</classifier>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.kie.kogito</groupId>\n+        <artifactId>svg-process-addon</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc0OTMwMw=="}, "originalCommit": {"oid": "cbd3e58caacc7819d244e2d3c4ac6185f5db33e7"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjgxMzA3OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/test/java/org/kie/kogito/svg/service/QuarkusProcessSvgServiceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo0MDoyOFrOHsi1qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMDoyOTowOFrOHs_WKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3MDE4NA==", "bodyText": "commented code", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516470184", "createdAt": "2020-11-03T07:40:28Z", "author": {"login": "jstastny-cz"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/test/java/org/kie/kogito/svg/service/QuarkusProcessSvgServiceTest.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import javax.enterprise.inject.Instance;\n+\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.kie.kogito.svg.ProcessSvgService;\n+import org.kie.kogito.svg.ProcessSvgServiceTest;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import static org.mockito.Mockito.lenient;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.verify;\n+\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n+@ExtendWith(MockitoExtension.class)\n+public class QuarkusProcessSvgServiceTest extends ProcessSvgServiceTest {\n+\n+    private QuarkusProcessSvgService tested;\n+    //private Vertx vertxMock;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkzNzI1Nw==", "bodyText": "removed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516937257", "createdAt": "2020-11-03T20:29:08Z", "author": {"login": "nmirasch"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/test/java/org/kie/kogito/svg/service/QuarkusProcessSvgServiceTest.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import javax.enterprise.inject.Instance;\n+\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.kie.kogito.svg.ProcessSvgService;\n+import org.kie.kogito.svg.ProcessSvgServiceTest;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import static org.mockito.Mockito.lenient;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.verify;\n+\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n+@ExtendWith(MockitoExtension.class)\n+public class QuarkusProcessSvgServiceTest extends ProcessSvgServiceTest {\n+\n+    private QuarkusProcessSvgService tested;\n+    //private Vertx vertxMock;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3MDE4NA=="}, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjg1NjQ1OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/test/java/org/kie/kogito/svg/rest/ProcessSvgResourceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo1NjowNVrOHsjPEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo1NjowNVrOHsjPEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NjY5MQ==", "bodyText": "one more method with SVG", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516476691", "createdAt": "2020-11-03T07:56:05Z", "author": {"login": "jstastny-cz"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/test/java/org/kie/kogito/svg/rest/ProcessSvgResourceTest.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.rest;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n+import org.kie.kogito.svg.service.QuarkusProcessSvgService;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyList;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.lenient;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n+class ProcessSvgResourceTest {\n+\n+    private final static String PROCESS_INSTANCE_ID = \"piId\";\n+    private final static String PROCESS_ID = \"travels\";\n+\n+    private ProcessSvgResource processSvgResourceTest;\n+    private QuarkusProcessSvgService processSvgServiceMock;\n+    private HttpResponse responseMock;\n+    private String svgFileContent;\n+\n+    @BeforeAll\n+    public void setup() {\n+        processSvgResourceTest = new ProcessSvgResource();\n+        processSvgServiceMock = mock(QuarkusProcessSvgService.class);\n+        responseMock = mock(HttpResponse.class);\n+        svgFileContent = \"svg\";\n+        processSvgResourceTest.setProcessSvgService(processSvgServiceMock);\n+\n+        lenient().when(processSvgServiceMock.getSvgUni(eq(PROCESS_ID), any()))\n+                .thenReturn(Uni.createFrom().item(getTravelsSVGFile()));\n+        lenient().when(processSvgServiceMock.getNodesQueryUni(PROCESS_ID, PROCESS_INSTANCE_ID))\n+                .thenReturn(Uni.createFrom().item(responseMock));\n+    }\n+\n+    @Test\n+    void getSVGExecutionPathByProcessInstanceTest() {\n+        processSvgResourceTest.getExecutionPathByProcessInstanceId(PROCESS_ID, PROCESS_INSTANCE_ID);\n+        verify(processSvgServiceMock).getNodesQueryUni(PROCESS_ID, PROCESS_INSTANCE_ID);\n+    }\n+\n+    public String getTravelsSVGFile() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjg3MzU2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowMToyNlrOHsjZDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowMToyNlrOHsjZDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3OTI0Nw==", "bodyText": "couldn't we check http code instead of body?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516479247", "createdAt": "2020-11-03T08:01:26Z", "author": {"login": "jstastny-cz"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+    protected Vertx vertx;\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public String getSvgFromVertxFileSystem(String processId) {\n+     return vertx.fileSystem()\n+             .readFileBlocking(svgResourcesPath + \"/\"+ processId + \".svg\")\n+             .toString(UTF_8);\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjg4MzU2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowNDo1MVrOHsjfGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowNDo1MVrOHsjfGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4MDc5NQ==", "bodyText": "here maybe again try-with-resources for the stream", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516480795", "createdAt": "2020-11-03T08:04:51Z", "author": {"login": "jstastny-cz"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+    protected Vertx vertx;\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public String getSvgFromVertxFileSystem(String processId) {\n+     return vertx.fileSystem()\n+             .readFileBlocking(svgResourcesPath + \"/\"+ processId + \".svg\")\n+             .toString(UTF_8);\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String annotateExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {\n+        if (svg != null && !svg.isEmpty()) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                try {\n+                    InputStream svgStream = new ByteArrayInputStream(svg.getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjg5NzQ2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowOToyNVrOHsjnUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowOToyNVrOHsjnUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4Mjg5OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <name>Kogito :: Add-Ons :: Process svg</name>\n          \n          \n            \n              <name>Kogito :: Add-Ons :: Process SVG</name>", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516482899", "createdAt": "2020-11-03T08:09:25Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/pom.xml", "diffHunk": "@@ -0,0 +1,16 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.kie.kogito</groupId>\n+    <artifactId>addons</artifactId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>process-svg</artifactId>\n+  <packaging>pom</packaging>\n+  <name>Kogito :: Add-Ons :: Process svg</name>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjg5ODIyOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowOTozOVrOHsjntw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODowOTozOVrOHsjntw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4Mjk5OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <name>Kogito :: Add-Ons :: process SVG :: Common</name>\n          \n          \n            \n              <name>Kogito :: Add-Ons :: Process SVG :: Common</name>", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516482999", "createdAt": "2020-11-03T08:09:39Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/pom.xml", "diffHunk": "@@ -0,0 +1,67 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~     http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>process-svg</artifactId>\n+    <groupId>org.kie.kogito</groupId>\n+    <version>1.0.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>process-svg-common</artifactId>\n+  <name>Kogito :: Add-Ons :: process SVG :: Common</name>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjkwMjk4OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoxMToxNVrOHsjqkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoxMToxNVrOHsjqkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4MzczMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            try {\n          \n          \n            \n                                InputStream svgStream = new ByteArrayInputStream(svg.getBytes());\n          \n          \n            \n                            try (InputStream svgStream = new ByteArrayInputStream(svg.getBytes())) {", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516483730", "createdAt": "2020-11-03T08:11:15Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+    protected Vertx vertx;\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public String getSvgFromVertxFileSystem(String processId) {\n+     return vertx.fileSystem()\n+             .readFileBlocking(svgResourcesPath + \"/\"+ processId + \".svg\")\n+             .toString(UTF_8);\n+    }\n+\n+    public Uni<String> getSvgUni(String processId, RoutingContext context) {\n+        return getAddonWebClient(context).get(\"/diagram/\" + processId + \".svg\")\n+                .send()\n+                .map(resp -> getSvgContent(resp));\n+    }\n+\n+    protected String getSvgContent(HttpResponse<Buffer> resp) {\n+        if (resp != null &&\n+                resp.bodyAsString() != null &&\n+                !resp.bodyAsString().contains(\"<title>404 - Resource Not Found</title>\")) {\n+            return resp.bodyAsString();\n+        }\n+        return \"\";\n+    }\n+\n+    public String annotateExecutedPath(String svg, List<String> completedNodes, List<String> activeNodes)  {\n+        if (svg != null && !svg.isEmpty()) {\n+            if (!(completedNodes.isEmpty() && activeNodes.isEmpty())) {\n+                try {\n+                    InputStream svgStream = new ByteArrayInputStream(svg.getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjkyNDIyOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/service/QuarkusProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoxODoxMlrOHsj3QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoxODoxMlrOHsj3QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4Njk3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        @ConfigProperty(name = \"kogito.svg-diagram.folder.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n          \n          \n            \n                        @ConfigProperty(name = \"kogito.svg.folder.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,\n          \n      \n    \n    \n  \n\nshouldnt this one be null or empty by default? as it would be used to point to an external folder?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516486977", "createdAt": "2020-11-03T08:18:12Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/service/QuarkusProcessSvgService.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+import org.kie.kogito.svg.ProcessSvgService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class QuarkusProcessSvgService extends ProcessSvgService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(QuarkusProcessSvgService.class);\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    @Inject\n+    public QuarkusProcessSvgService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg-diagram.folder.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjkzNTYyOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoyMTozOVrOHsj-HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoyMTozOVrOHsj-HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4ODczMg==", "bodyText": "formatting", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516488732", "createdAt": "2020-11-03T08:21:39Z", "author": {"login": "jstastny-cz"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+    protected Vertx vertx;\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNzAyMjI4OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODo0Njo1NFrOHskyCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODo0Njo1NFrOHskyCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUwMjAyNw==", "bodyText": "can we use the inferface here instead?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516502027", "createdAt": "2020-11-03T08:46:54Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.rest;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.MediaType;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import org.kie.kogito.svg.service.QuarkusProcessSvgService;\n+\n+@ApplicationScoped\n+@Path(\"/svg/\")\n+public class ProcessSvgResource {\n+\n+    @Inject\n+    QuarkusProcessSvgService service;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNzAyNTIyOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODo0Nzo0NlrOHskz0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODo0Nzo0NlrOHskz0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUwMjQ4MQ==", "bodyText": "@nmirasch could you add another method to simply retrieve the SVG for a process, without annotation.\n@Path(\"processes/{processId})", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516502481", "createdAt": "2020-11-03T08:47:46Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.rest;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.MediaType;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import org.kie.kogito.svg.service.QuarkusProcessSvgService;\n+\n+@ApplicationScoped\n+@Path(\"/svg/\")\n+public class ProcessSvgResource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNzIyMDU2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTo0MDowNFrOHsmsFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTo0MDowNFrOHsmsFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUzMzI2OA==", "bodyText": "@nmirasch seems like you're doing multiple calls to the same service, passing different parameters, I think it would be better if you could simply have one method getProcessInstanceSVG which gives you the annotated one, so everything else is considered internals of the service, wdyt?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516533268", "createdAt": "2020-11-03T09:40:04Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/rest/ProcessSvgResource.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.rest;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.MediaType;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import org.kie.kogito.svg.service.QuarkusProcessSvgService;\n+\n+@ApplicationScoped\n+@Path(\"/svg/\")\n+public class ProcessSvgResource {\n+\n+    @Inject\n+    QuarkusProcessSvgService service;\n+\n+    @Path(\"processes/{processId}/instances/{processInstanceId}\")\n+    @GET\n+    @Produces(MediaType.APPLICATION_SVG_XML)\n+    public Uni<String> getExecutionPathByProcessInstanceId(\n+            @PathParam(\"processId\") String processId,\n+            @PathParam(\"processInstanceId\") String processInstanceId) {\n+        Uni<HttpResponse<Buffer>> queryNodesUni = service.getNodesQueryUni(processId, processInstanceId);\n+        String svg = service.getSvgFromVertxFileSystem(processId);\n+        return queryNodesUni.onItem().transform(queryResults -> {\n+            List<String> completedNodes = new ArrayList<>();\n+            List<String> activeNodes = new ArrayList<>();\n+            service.fillNodeArrays(queryResults, completedNodes, activeNodes);\n+            return service.annotateExecutedPath(svg, completedNodes, activeNodes);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNzIyMzE2OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTo0MDo0N1rOHsmtxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwOTo0MDo0N1rOHsmtxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUzMzcwMA==", "bodyText": "maybe call it?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public String getSvgFromVertxFileSystem(String processId) {\n          \n          \n            \n                public String getProcessSVG(String processId) {", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r516533700", "createdAt": "2020-11-03T09:40:47Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/ProcessSvgService.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.ext.web.RoutingContext;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.core.buffer.Buffer;\n+import io.vertx.mutiny.ext.web.client.HttpResponse;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.Objects.isNull;\n+\n+import org.jbpm.process.svg.SVGImageProcessor;\n+import org.jbpm.process.svg.processor.SVGProcessor;\n+\n+\n+public abstract class ProcessSvgService {\n+    public static final int RESPONSE_STATUS_CODE_OK = 200;\n+    protected WebClient dataIndexWebClient;\n+    protected WebClient addonWebClient;\n+\n+    protected String dataIndexHttpURL;\n+    protected String svgResourcesPath;\n+    protected String completedColor;\n+    protected String completedBorderColor;\n+    protected String activeBorderColor;\n+    protected Vertx vertx;\n+\n+    public WebClient getDataIndexWebClient() {\n+        return dataIndexWebClient;\n+    }\n+\n+    public void setDataIndexWebClient(WebClient dataIndexWebClient) {\n+        this.dataIndexWebClient = dataIndexWebClient;\n+    }\n+\n+    public WebClient getAddonWebClient(RoutingContext context) {\n+        if(addonWebClient == null ){\n+            setAddonWebClient(WebClient.create(Vertx.vertx(),  getWebClientToURLOptions(context.request().absoluteURI())));\n+        }\n+        return addonWebClient;\n+    }\n+\n+    public void setAddonWebClient(WebClient addonWebClient) {\n+        this.addonWebClient = addonWebClient;\n+    }\n+\n+    public Uni<HttpResponse<Buffer>> getNodesQueryUni(String processId, String processInstanceId) {\n+        String query = \"{ ProcessInstances ( where: { and : {  id: {  equal : \\\"\" + processInstanceId + \"\\\" }, processId : { equal : \\\"\" + processId + \"\\\"} } }) { nodes { definitionId exit } } }\";\n+        return getDataIndexWebClient().post(\"/graphql\")\n+                .sendJson(JsonObject.mapFrom(Collections.singletonMap(\"query\", query)));\n+    }\n+\n+    public String getSvgFromVertxFileSystem(String processId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb2cde58f7dff7b25daeba0a4d3bcc9300303c7"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTA4MTU5OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/processor/JBPMDesignerSVGProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMjozMzoxMFrOHtxV7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMjozMzoxMFrOHtxV7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzc1NjM5Nw==", "bodyText": "this can be removed, as it targets old designer?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r517756397", "createdAt": "2020-11-05T02:33:10Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/main/java/org/kie/kogito/svg/processor/JBPMDesignerSVGProcessor.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.processor;\n+\n+import org.apache.batik.anim.dom.SVGOMTSpanElement;\n+import org.kie.kogito.svg.model.NodeSummary;\n+import org.kie.kogito.svg.model.SetBackgroundColorTransformation;\n+import org.kie.kogito.svg.model.SetBorderColorTransformation;\n+import org.kie.kogito.svg.model.SetSubProcessLinkTransformation;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Element;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+public class JBPMDesignerSVGProcessor extends AbstractSVGProcessor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39d1305631397e960c6d2bc48a91e70ed1d38b98"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTA5MjMyOnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/service/QuarkusProcessSvgService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMjozNjo0NFrOHtxcwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMjozNjo0NFrOHtxcwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzc1ODE0NA==", "bodyText": "@nmirasch still think that this folder should not be set, it either points to an external folder of we use the classpath to find the svg?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r517758144", "createdAt": "2020-11-05T02:36:44Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-quarkus-addon/src/main/java/org/kie/kogito/svg/service/QuarkusProcessSvgService.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg.service;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Instance;\n+import javax.inject.Inject;\n+\n+import io.vertx.mutiny.core.Vertx;\n+import io.vertx.mutiny.ext.web.client.WebClient;\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+import org.kie.kogito.svg.ProcessSvgService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@ApplicationScoped\n+public class QuarkusProcessSvgService extends ProcessSvgService {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(QuarkusProcessSvgService.class);\n+\n+    private Instance<WebClient> providedWebClient;\n+\n+    @Inject\n+    public QuarkusProcessSvgService(\n+            @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\") String dataIndexHttpURL,\n+            @ConfigProperty(name = \"kogito.svg.folder.path\", defaultValue = \"META-INF/processSVG/\") String svgResourcesPath,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39d1305631397e960c6d2bc48a91e70ed1d38b98"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MTc5Mjc5OnYy", "diffSide": "RIGHT", "path": "addons/process-svg/process-svg-common/src/test/java/org/kie/kogito/svg/ProcessSvgServiceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNzowMzozNlrOHxs7vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNzowMzozNlrOHxs7vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg3ODQ2Mg==", "bodyText": "@nmirasch I was checking the sonar report and I think if you define processService and the other collections as variables and then do the expected exception assertation, it would work. The problem now is that is calling multiple things that could", "url": "https://github.com/kiegroup/kogito-runtimes/pull/846#discussion_r521878462", "createdAt": "2020-11-12T07:03:36Z", "author": {"login": "cristianonicolai"}, "path": "addons/process-svg/process-svg-common/src/test/java/org/kie/kogito/svg/ProcessSvgServiceTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.svg;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.assertj.core.api.Assertions.fail;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public abstract class ProcessSvgServiceTest {\n+\n+    private final static String PROCESS_ID = \"travels\";\n+\n+    public static String readFileContent(String file) throws URISyntaxException, IOException {\n+        Path path = Paths.get(Thread.currentThread().getContextClassLoader().getResource(file).toURI());\n+        return new String(Files.readAllBytes(path));\n+    }\n+\n+    @Test\n+    public void getProcessSvgWithoutSvgResourcePathTest() throws Exception {\n+        String fileContent = getTravelsSVGFile();\n+        Optional<String> svgContent = getTestedProcessSvgService().getProcessSvg(PROCESS_ID);\n+        assertThat(svgContent).isPresent().hasValue(fileContent);\n+    }\n+\n+    @Test\n+    public void getProcessSvgFromFileSystemSuccessTest() throws Exception {\n+        String fileContent = getTravelsSVGFile();\n+        getTestedProcessSvgService().setSvgResourcesPath(Optional.of(\"./src/test/resources/META-INF/processSVG/\"));\n+        Optional<String> svgContent = getTestedProcessSvgService().getProcessSvg(PROCESS_ID);\n+        assertThat(svgContent).isPresent().hasValue(fileContent);\n+    }\n+\n+    @Test\n+    public void getProcessSvgFromFileSystemFailTest() throws Exception {\n+        getTestedProcessSvgService().setSvgResourcesPath(Optional.of(\"./src/test/resources/META-INF/processSVG/\"));\n+        assertThat(getTestedProcessSvgService().getProcessSvg(\"UnexistingProcessId\")).isEmpty();\n+    }\n+\n+    @Test\n+    public void annotateExecutedPathTest() throws Exception {\n+        assertThat(getTestedProcessSvgService().annotateExecutedPath(\n+                getTravelsSVGFile(),\n+                Arrays.asList(\"_1A708F87-11C0-42A0-A464-0B7E259C426F\"),\n+                Collections.emptyList())).hasValue(readFileContent(\"travels-expected.svg\"));\n+        assertThat(getTestedProcessSvgService().annotateExecutedPath(\n+                null,\n+                Arrays.asList(\"_1A708F87-11C0-42A0-A464-0B7E259C426F\"),\n+                Collections.emptyList())).isEmpty();\n+        assertThat(getTestedProcessSvgService().annotateExecutedPath(\n+                getTravelsSVGFile(),\n+                Collections.emptyList(),\n+                Collections.emptyList())).hasValue(getTravelsSVGFile());\n+    }\n+\n+    @Test\n+    public void readFileFromClassPathTest() throws Exception {\n+        assertThat(getTestedProcessSvgService().readFileContentFromClassPath(\"undefined\")).isEmpty();\n+        assertThat(getTravelsSVGFile()).isEqualTo(getTestedProcessSvgService().readFileContentFromClassPath(\"travels.svg\").get());\n+    }\n+\n+    @Test\n+    public void testWrongSVGContentThrowsException() {\n+        try {\n+            getTestedProcessSvgService().annotateExecutedPath(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc550a15e0746ef54ef6cb21684278f8f6e7f935"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4652, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}