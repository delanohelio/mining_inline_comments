{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwODE1NzU2", "number": 486, "reviewThreads": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMTozNzo1NFrOD33DaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxODo1NTozMlrOD588Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTAwMjY1OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMTozNzo1NFrOGOW1qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNTo1MDoxOVrOGOahCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwNzQzNQ==", "bodyText": "can this be reduced a bit using a more functional style?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417707435", "createdAt": "2020-04-30T01:37:54Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc2NzY5MQ==", "bodyText": "suggestions welcome as I was not able to find better way for it....", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417767691", "createdAt": "2020-04-30T05:50:19Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwNzQzNQ=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTAwMjc5OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMTozODowMlrOGOW1xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyMjo0MlrOGObSSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwNzQ2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n          \n          \n            \n                    AsyncResult<HttpResponse<Buffer>> asyncResult = mock(AsyncResult.class);", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417707462", "createdAt": "2020-04-30T01:38:02Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDI5OA==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780298", "createdAt": "2020-04-30T06:22:42Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwNzQ2Mg=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA1NzgwOnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoxMTo0OVrOGOXWVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyMjo0OVrOGObSbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNTc5Ng==", "bodyText": "could be check is equals to job.getExpirationTime?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417715796", "createdAt": "2020-04-30T02:11:49Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDMzNA==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780334", "createdAt": "2020-04-30T06:22:49Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNTc5Ng=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA1ODQ2OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoxMjoxOVrOGOXWuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNTo0OFrOGRv13g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNTg5Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n          \n          \n            \n                    AsyncResult<HttpResponse<Buffer>> asyncResult = mock(AsyncResult.class);", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417715896", "createdAt": "2020-04-30T02:12:19Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDQyNQ==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780425", "createdAt": "2020-04-30T06:23:01Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNTg5Ng=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyODYwNg==", "bodyText": "Still present as it seems.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420828606", "createdAt": "2020-05-06T14:18:48Z", "author": {"login": "MarianMacik"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNTg5Ng=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MjgxNA==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421262814", "createdAt": "2020-05-07T06:15:48Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNTg5Ng=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA2MDE4OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoxMzoxNVrOGOXXrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyMjo1NlrOGObSng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNjE0Mw==", "bodyText": "job variable not used I guess in this case", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417716143", "createdAt": "2020-04-30T02:13:15Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDM4Mg==", "bodyText": "removed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780382", "createdAt": "2020-04-30T06:22:56Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +124,54 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult =mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNjE0Mw=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA2MTY4OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-springboot-addon/src/main/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoxNDowNlrOGOXYjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyMzoxMlrOGObTBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNjM2Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Job foundJob = restTemplate.getForObject(getJobsServiceUri() + \"/{id}\", Job.class, id);\n          \n          \n            \n                        return restTemplate.getForObject(getJobsServiceUri() + \"/{id}\", Job.class, id).getExpirationTime();", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417716367", "createdAt": "2020-04-30T02:14:06Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-springboot-addon/src/main/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsService.java", "diffHunk": "@@ -100,8 +104,21 @@ public boolean cancelJob(String id) {\n             \n             return true;\n         } catch (RestClientException e) {\n-            LOGGER.debug(\"Exceltion thrown during canceling of job {}\", id, e);\n+            LOGGER.debug(\"Exception thrown during canceling of job {}\", id, e);\n             return false;\n         }\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        try {\n+            Job foundJob = restTemplate.getForObject(getJobsServiceUri() + \"/{id}\", Job.class, id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDQ4Ng==", "bodyText": "refactored", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780486", "createdAt": "2020-04-30T06:23:12Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-springboot-addon/src/main/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsService.java", "diffHunk": "@@ -100,8 +104,21 @@ public boolean cancelJob(String id) {\n             \n             return true;\n         } catch (RestClientException e) {\n-            LOGGER.debug(\"Exceltion thrown during canceling of job {}\", id, e);\n+            LOGGER.debug(\"Exception thrown during canceling of job {}\", id, e);\n             return false;\n         }\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        try {\n+            Job foundJob = restTemplate.getForObject(getJobsServiceUri() + \"/{id}\", Job.class, id);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNjM2Nw=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA2NjUwOnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-springboot-addon/src/test/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsServiceTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoxNzowOFrOGOXbXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyMzoxOVrOGObTKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNzA4Nw==", "bodyText": "equals to job.getExpirationTime?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417717087", "createdAt": "2020-04-30T02:17:08Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-springboot-addon/src/test/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsServiceTest.java", "diffHunk": "@@ -86,4 +90,28 @@ void testCancelJob() {\n         tested.cancelJob(\"123\");\n         verify(restTemplate).delete(tested.getJobsServiceUri() + \"/{id}\", \"123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime() {\n+        \n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        \n+        when(restTemplate.getForObject(any(), any(), anyString())).thenReturn(job);\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDUyMA==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780520", "createdAt": "2020-04-30T06:23:19Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-springboot-addon/src/test/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsServiceTest.java", "diffHunk": "@@ -86,4 +90,28 @@ void testCancelJob() {\n         tested.cancelJob(\"123\");\n         verify(restTemplate).delete(tested.getJobsServiceUri() + \"/{id}\", \"123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime() {\n+        \n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        \n+        when(restTemplate.getForObject(any(), any(), anyString())).thenReturn(job);\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNzA4Nw=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA2NzAwOnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-springboot-addon/src/test/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsServiceTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoxNzozMFrOGOXbrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyMzoyOFrOGObTZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNzE2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThatThrownBy(() -> tested.getScheduledTime(\"123\"))\n          \n          \n            \n                    assertThatThrownBy(() -> tested.getScheduledTime(\"123\")).isInstanceOf(JobNotFoundException.class);", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417717166", "createdAt": "2020-04-30T02:17:30Z", "author": {"login": "cristianonicolai"}, "path": "addons/jobs/jobs-management-springboot-addon/src/test/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsServiceTest.java", "diffHunk": "@@ -86,4 +90,28 @@ void testCancelJob() {\n         tested.cancelJob(\"123\");\n         verify(restTemplate).delete(tested.getJobsServiceUri() + \"/{id}\", \"123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime() {\n+        \n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        \n+        when(restTemplate.getForObject(any(), any(), anyString())).thenReturn(job);\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(restTemplate).getForObject(tested.getJobsServiceUri() + \"/{id}\", Job.class, \"123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound() {\n+\n+        when(restTemplate.getForObject(any(), any(), anyString())).thenThrow(NotFound.class);\n+        \n+        assertThatThrownBy(() -> tested.getScheduledTime(\"123\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDU4MQ==", "bodyText": "refactored", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780581", "createdAt": "2020-04-30T06:23:28Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-springboot-addon/src/test/java/org/kie/kogito/jobs/management/springboot/SpringRestJobsServiceTest.java", "diffHunk": "@@ -86,4 +90,28 @@ void testCancelJob() {\n         tested.cancelJob(\"123\");\n         verify(restTemplate).delete(tested.getJobsServiceUri() + \"/{id}\", \"123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime() {\n+        \n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        \n+        when(restTemplate.getForObject(any(), any(), anyString())).thenReturn(job);\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isNotNull();\n+        verify(restTemplate).getForObject(tested.getJobsServiceUri() + \"/{id}\", Job.class, \"123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound() {\n+\n+        when(restTemplate.getForObject(any(), any(), anyString())).thenThrow(NotFound.class);\n+        \n+        assertThatThrownBy(() -> tested.getScheduledTime(\"123\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxNzE2Ng=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA3Mjc2OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/AbstractNodeHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyMToxNlrOGOXfIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjowNDowMFrOGOa5Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxODA0OA==", "bodyText": "@mswiderski is expected that only one instance of ContextContainer?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417718048", "createdAt": "2020-04-30T02:21:16Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/AbstractNodeHandler.java", "diffHunk": "@@ -661,4 +663,28 @@ protected String retrieveDataType(String itemSubjectRef, String dtype, Extensibl\n         \n         return null;\n     }\n+    \n+    \n+    /**\n+     * Finds the right variable by its name to make sure that when given as id it will be also matched\n+     * @param variableName name or id of the variable\n+     * @param parser parser instance\n+     * @return returns found variable name or given 'variableName' otherwise\n+     */\n+    protected String findVariable(String variableName, final ExtensibleXmlParser parser) {\n+        if (variableName == null) {\n+            return null;\n+        }\n+        List<?> parents = parser.getParents();\n+        \n+        for (Object parent : parents) {\n+            if (parent instanceof ContextContainer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc3Mzg4Ng==", "bodyText": "there could be more than one ContextContainer as there can be subprocesses if that's what you mean", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417773886", "createdAt": "2020-04-30T06:04:00Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/AbstractNodeHandler.java", "diffHunk": "@@ -661,4 +663,28 @@ protected String retrieveDataType(String itemSubjectRef, String dtype, Extensibl\n         \n         return null;\n     }\n+    \n+    \n+    /**\n+     * Finds the right variable by its name to make sure that when given as id it will be also matched\n+     * @param variableName name or id of the variable\n+     * @param parser parser instance\n+     * @return returns found variable name or given 'variableName' otherwise\n+     */\n+    protected String findVariable(String variableName, final ExtensibleXmlParser parser) {\n+        if (variableName == null) {\n+            return null;\n+        }\n+        List<?> parents = parser.getParents();\n+        \n+        for (Object parent : parents) {\n+            if (parent instanceof ContextContainer) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxODA0OA=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA3NDMwOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyMjoxMlrOGOXgBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyMjoxMlrOGOXgBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxODI3OQ==", "bodyText": "can you add the import for org.jbpm.workflow.core.node.Transformation", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417718279", "createdAt": "2020-04-30T02:22:12Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +151,12 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");\n+                action.setMetaData(\"Action\", new SignalProcessInstanceAction(signalName, variable, (String) endNode.getMetaData(\"customScope\"), (org.jbpm.workflow.core.node.Transformation)endNode.getMetaData().get(\"Transformation\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA3NTcwOnYy", "diffSide": "LEFT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyMzowNlrOGOXg5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjowMToxMFrOGOa12w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxODUwMA==", "bodyText": "would this mean that mvel expressions would not work any more, something that can be dropped?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417718500", "createdAt": "2020-04-30T02:23:06Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +151,12 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");\n+                action.setMetaData(\"Action\", new SignalProcessInstanceAction(signalName, variable, (String) endNode.getMetaData(\"customScope\"), (org.jbpm.workflow.core.node.Transformation)endNode.getMetaData().get(\"Transformation\")));\n+                \n                 List<DroolsAction> actions = new ArrayList<DroolsAction>();\n-                actions.add(new DroolsConsequenceAction(\"mvel\",signalExpression));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc3MzAxOQ==", "bodyText": "move should not be used anyway but in reality it does not really matter as java class was generated for it anyway", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417773019", "createdAt": "2020-04-30T06:01:10Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +151,12 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");\n+                action.setMetaData(\"Action\", new SignalProcessInstanceAction(signalName, variable, (String) endNode.getMetaData(\"customScope\"), (org.jbpm.workflow.core.node.Transformation)endNode.getMetaData().get(\"Transformation\")));\n+                \n                 List<DroolsAction> actions = new ArrayList<DroolsAction>();\n-                actions.add(new DroolsConsequenceAction(\"mvel\",signalExpression));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxODUwMA=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA3NzE5OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyMzo1NlrOGOXhtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyNToyM1rOGOXjCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxODcwOQ==", "bodyText": "add import for org.jbpm.workflow.core.node.Transformation", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417718709", "createdAt": "2020-04-30T02:23:56Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -207,18 +210,9 @@ public void handleSignalNode(final Node node, final Element element,\n \t\t\t\t    signalName = \"ASYNC-\" + signalName;\n \t\t\t\t}\n \n-\t\t\t\tString signalExpression = getSignalExpression(actionNode, signalName, \"tVariable\");\n-\n-\t\t\t\tactionNode\n-\t\t\t\t\t\t.setAction(new DroolsConsequenceAction(\n-\t\t\t\t\t\t\t\t\"java\",\n-\t\t\t\t\t\t\t\t\" Object tVariable = \"+ (variable == null ? \"null\" : variable)+\";\"\n-\t\t\t\t\t\t\t\t+ \"org.jbpm.workflow.core.node.Transformation transformation = (org.jbpm.workflow.core.node.Transformation)kcontext.getNodeInstance().getNode().getMetaData().get(\\\"Transformation\\\");\"\n-\t\t\t\t\t\t\t\t+ \"if (transformation != null) {\"\n-\t\t\t\t\t\t\t\t+ \"  tVariable = new org.jbpm.process.core.event.EventTransformerImpl(transformation)\"\n-\t\t\t\t\t\t\t\t+ \"  .transformEvent(\"+(variable == null ? \"null\" : variable)+\");\"\n-\t\t\t\t\t\t\t\t+ \"}\"+\n-\t\t\t\t\t\t\t\tsignalExpression));\n+\t\t\t\tDroolsConsequenceAction action =  new DroolsConsequenceAction(\"java\", \"\");\n+                action.setMetaData(\"Action\", new SignalProcessInstanceAction(signalName, variable, (String) actionNode.getMetaData(\"customScope\"), (org.jbpm.workflow.core.node.Transformation)actionNode.getMetaData().get(\"Transformation\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxOTA0OA==", "bodyText": "review code format also please", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417719048", "createdAt": "2020-04-30T02:25:23Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -207,18 +210,9 @@ public void handleSignalNode(final Node node, final Element element,\n \t\t\t\t    signalName = \"ASYNC-\" + signalName;\n \t\t\t\t}\n \n-\t\t\t\tString signalExpression = getSignalExpression(actionNode, signalName, \"tVariable\");\n-\n-\t\t\t\tactionNode\n-\t\t\t\t\t\t.setAction(new DroolsConsequenceAction(\n-\t\t\t\t\t\t\t\t\"java\",\n-\t\t\t\t\t\t\t\t\" Object tVariable = \"+ (variable == null ? \"null\" : variable)+\";\"\n-\t\t\t\t\t\t\t\t+ \"org.jbpm.workflow.core.node.Transformation transformation = (org.jbpm.workflow.core.node.Transformation)kcontext.getNodeInstance().getNode().getMetaData().get(\\\"Transformation\\\");\"\n-\t\t\t\t\t\t\t\t+ \"if (transformation != null) {\"\n-\t\t\t\t\t\t\t\t+ \"  tVariable = new org.jbpm.process.core.event.EventTransformerImpl(transformation)\"\n-\t\t\t\t\t\t\t\t+ \"  .transformEvent(\"+(variable == null ? \"null\" : variable)+\");\"\n-\t\t\t\t\t\t\t\t+ \"}\"+\n-\t\t\t\t\t\t\t\tsignalExpression));\n+\t\t\t\tDroolsConsequenceAction action =  new DroolsConsequenceAction(\"java\", \"\");\n+                action.setMetaData(\"Action\", new SignalProcessInstanceAction(signalName, variable, (String) actionNode.getMetaData(\"customScope\"), (org.jbpm.workflow.core.node.Transformation)actionNode.getMetaData().get(\"Transformation\")));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxODcwOQ=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA3OTY4OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyNTo0MlrOGOXjRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyNDoyNFrOGObU7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxOTExMA==", "bodyText": "code format", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417719110", "createdAt": "2020-04-30T02:25:42Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -259,34 +253,10 @@ public void handleMessageNode(final Node node, final Element element,\n \t\t\t\tactionNode.setMetaData(\"MessageType\", message.getType());\n \t\t\t\tactionNode.setMetaData(\"TriggerType\", \"ProduceMessage\");\n \t\t\t\tactionNode.setMetaData(\"TriggerRef\", message.getName());\n-\t\t\t\tactionNode\n-\t\t\t\t\t\t.setAction(new DroolsConsequenceAction(\n-\t\t\t\t\t\t\t\t\"java\",\n-\t\t\t\t\t\t\t\t\" Object tVariable = \"+ (variable == null ? \"null\" : variable)+\";\"\n-\t\t\t\t\t\t\t\t+ \"org.jbpm.workflow.core.node.Transformation transformation = (org.jbpm.workflow.core.node.Transformation)kcontext.getNodeInstance().getNode().getMetaData().get(\\\"Transformation\\\");\"\n-\t\t\t\t\t\t\t\t+ \"if (transformation != null) {\"\n-\t\t\t\t\t\t\t\t+ \"  tVariable = new org.jbpm.process.core.event.EventTransformerImpl(transformation)\"\n-\t\t\t\t\t\t\t\t+ \"  .transformEvent(\"+(variable == null ? \"null\" : variable)+\");\"\n-\t\t\t\t\t\t\t\t+ \"}\"\n-\t\t\t\t\t\t\t\t+ \"org.drools.core.process.instance.impl.WorkItemImpl workItem = new org.drools.core.process.instance.impl.WorkItemImpl();\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setName(\\\"Send Task\\\");\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setProcessInstanceId(kcontext.getProcessInstance().getId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setParameter(\\\"MessageType\\\", \\\"\"\n-\t\t\t\t\t\t\t\t\t\t+ message.getType()\n-\t\t\t\t\t\t\t\t\t\t+ \"\\\");\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setNodeInstanceId(kcontext.getNodeInstance().getId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setNodeId(kcontext.getNodeInstance().getNodeId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setDeploymentId((String) kcontext.getKnowledgeRuntime().getEnvironment().get(\\\"deploymentId\\\"));\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ (variable == null ? \"\"\n-\t\t\t\t\t\t\t\t\t\t\t\t: \"workItem.setParameter(\\\"Message\\\", tVariable);\" + EOL)\n-\t\t\t\t\t\t\t\t\t\t+ \"((org.drools.core.process.instance.WorkItemManager) kcontext.getKnowledgeRuntime().getWorkItemManager()).internalExecuteWorkItem(workItem);\"));\n+\t\t\t\t\n+\t\t\t\tDroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");\n+                action.setMetaData(\"Action\", new HandleMessageAction(message.getType(), variable, (Transformation) actionNode.getMetaData().get(\"Transformation\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDk3NQ==", "bodyText": "Reformatted", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780975", "createdAt": "2020-04-30T06:24:24Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -259,34 +253,10 @@ public void handleMessageNode(final Node node, final Element element,\n \t\t\t\tactionNode.setMetaData(\"MessageType\", message.getType());\n \t\t\t\tactionNode.setMetaData(\"TriggerType\", \"ProduceMessage\");\n \t\t\t\tactionNode.setMetaData(\"TriggerRef\", message.getName());\n-\t\t\t\tactionNode\n-\t\t\t\t\t\t.setAction(new DroolsConsequenceAction(\n-\t\t\t\t\t\t\t\t\"java\",\n-\t\t\t\t\t\t\t\t\" Object tVariable = \"+ (variable == null ? \"null\" : variable)+\";\"\n-\t\t\t\t\t\t\t\t+ \"org.jbpm.workflow.core.node.Transformation transformation = (org.jbpm.workflow.core.node.Transformation)kcontext.getNodeInstance().getNode().getMetaData().get(\\\"Transformation\\\");\"\n-\t\t\t\t\t\t\t\t+ \"if (transformation != null) {\"\n-\t\t\t\t\t\t\t\t+ \"  tVariable = new org.jbpm.process.core.event.EventTransformerImpl(transformation)\"\n-\t\t\t\t\t\t\t\t+ \"  .transformEvent(\"+(variable == null ? \"null\" : variable)+\");\"\n-\t\t\t\t\t\t\t\t+ \"}\"\n-\t\t\t\t\t\t\t\t+ \"org.drools.core.process.instance.impl.WorkItemImpl workItem = new org.drools.core.process.instance.impl.WorkItemImpl();\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setName(\\\"Send Task\\\");\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setProcessInstanceId(kcontext.getProcessInstance().getId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setParameter(\\\"MessageType\\\", \\\"\"\n-\t\t\t\t\t\t\t\t\t\t+ message.getType()\n-\t\t\t\t\t\t\t\t\t\t+ \"\\\");\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setNodeInstanceId(kcontext.getNodeInstance().getId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setNodeId(kcontext.getNodeInstance().getNodeId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setDeploymentId((String) kcontext.getKnowledgeRuntime().getEnvironment().get(\\\"deploymentId\\\"));\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ (variable == null ? \"\"\n-\t\t\t\t\t\t\t\t\t\t\t\t: \"workItem.setParameter(\\\"Message\\\", tVariable);\" + EOL)\n-\t\t\t\t\t\t\t\t\t\t+ \"((org.drools.core.process.instance.WorkItemManager) kcontext.getKnowledgeRuntime().getWorkItemManager()).internalExecuteWorkItem(workItem);\"));\n+\t\t\t\t\n+\t\t\t\tDroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");\n+                action.setMetaData(\"Action\", new HandleMessageAction(message.getType(), variable, (Transformation) actionNode.getMetaData().get(\"Transformation\")));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxOTExMA=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA4MTkwOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ScriptTaskHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyNzowOVrOGOXknA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyNzowOVrOGOXknA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxOTQ1Mg==", "bodyText": "nice!", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417719452", "createdAt": "2020-04-30T02:27:09Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ScriptTaskHandler.java", "diffHunk": "@@ -38,7 +38,20 @@\n import org.xml.sax.SAXException;\n \n public class ScriptTaskHandler extends AbstractNodeHandler {\n-\t\n+\n+    private static Map<String, String> SUPPORTED_SCRIPT_FORMATS = new HashMap<>();\n+\n+    static {\n+        SUPPORTED_SCRIPT_FORMATS.put(XmlBPMNProcessDumper.JAVA_LANGUAGE, JavaDialect.ID);\n+        SUPPORTED_SCRIPT_FORMATS.put(XmlBPMNProcessDumper.JAVASCRIPT_LANGUAGE, \"JavaScript\");\n+        SUPPORTED_SCRIPT_FORMATS.put(XmlBPMNProcessDumper.FEEL_LANGUAGE, \"FEEL\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA4Mzk0OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/kie/kogito/process/bpmn2/BpmnVariables.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyODozN1rOGOXl4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjoyODozN1rOGOXl4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxOTc3OA==", "bodyText": "use a collect to map maybe?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417719778", "createdAt": "2020-04-30T02:28:37Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/kie/kogito/process/bpmn2/BpmnVariables.java", "diffHunk": "@@ -54,8 +69,23 @@ public void fromMap(Map<String, Object> vs) {\n         variables.putAll(vs);\n     }\n \n+    public List<Variable> definitions() {\n+        return definitions;\n+    }\n+\n     @Override\n     public Map<String, Object> toMap() {\n         return Collections.unmodifiableMap(variables);\n     }\n+    \n+    public Map<String, Object> toMap(Predicate<Variable> filter) {\n+        Map<String, Object> filteredVariables = new HashMap<>();\n+        \n+        definitions.stream()\n+            .filter(filter)\n+            .filter(v -> variables.containsKey(v.getName()))\n+            .forEach(v -> filteredVariables.put(v.getName(), this.variables.get(v.getName())));       ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA4Nzg1OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/context/variable/Variable.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjozMDozMVrOGOXn_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjozMDozMVrOGOXn_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcyMDMxOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (id.equals(nameOrId) || name.equals(nameOrId)) {\n          \n          \n            \n                    return (id.equals(nameOrId) || name.equals(nameOrId))", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417720318", "createdAt": "2020-04-30T02:30:31Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/context/variable/Variable.java", "diffHunk": "@@ -164,4 +163,12 @@ public String toString() {\n     public boolean hasTag(String tagName) {\n         return getTags().contains(tagName);\n     }\n+    \n+    public boolean matchyIdOrName(String nameOrId) {\n+        if (id.equals(nameOrId) || name.equals(nameOrId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA4ODgzOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/event/EventTransformerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjozMTowMVrOGOXoiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjozMTowMVrOGOXoiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcyMDQ1OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                \t\tObject parameterValue = transformer.transform(transformation.getCompiledExpression(), parameters);\n          \n          \n            \n                \t\treturn transformer.transform(transformation.getCompiledExpression(), parameters);", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417720459", "createdAt": "2020-04-30T02:31:01Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/event/EventTransformerImpl.java", "diffHunk": "@@ -48,7 +49,14 @@ public Object transformEvent(Object event) {\n \t\t}\n \t\tDataTransformer transformer = DataTransformerRegistry.get().find(transformation.getLanguage());\n     \tif (transformer != null) {\n-    \t\tObject parameterValue = transformer.transform(transformation.getCompiledExpression(), Collections.singletonMap(name, event));\n+    \t    Map<String, Object> parameters = null;\n+    \t    if (event instanceof Map) {\n+    \t        parameters = (Map) event;\n+    \t    } else {\n+    \t        parameters = Collections.singletonMap(name, event);\n+    \t    }\n+    \t    \n+    \t\tObject parameterValue = transformer.transform(transformation.getCompiledExpression(), parameters);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA5MTk5OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/instance/impl/actions/HandleEscalationAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjozMjo0NFrOGOXqSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjozMjo0NFrOGOXqSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcyMDkwNw==", "bodyText": "add some imports where applicable", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417720907", "createdAt": "2020-04-30T02:32:44Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/instance/impl/actions/HandleEscalationAction.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.jbpm.process.instance.impl.actions;\n+\n+import java.io.Serializable;\n+\n+import org.jbpm.process.core.event.EventTransformerImpl;\n+import org.jbpm.process.instance.context.exception.ExceptionScopeInstance;\n+import org.jbpm.process.instance.impl.Action;\n+import org.jbpm.workflow.instance.NodeInstance;\n+import org.kie.api.runtime.process.ProcessContext;\n+\n+public class HandleEscalationAction implements Action, Serializable {\n+\n+    private static final long serialVersionUID = 1L;\n+\n+    private String faultName;\n+    private String variableName;\n+\n+    public HandleEscalationAction(String faultName, String variableName) {\n+        this.faultName = faultName;\n+        this.variableName = variableName;\n+    }\n+\n+    public void execute(ProcessContext context) throws Exception {\n+        ExceptionScopeInstance scopeInstance = (ExceptionScopeInstance) ((NodeInstance) context.getNodeInstance()).resolveContextInstance(org.jbpm.process.core.context.exception.ExceptionScope.EXCEPTION_SCOPE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5OTA5NjI5OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/process/impl/AbstractProcessInstance.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjozNToyM1rOGOXstw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNjoyMzozOVrOGObTng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcyMTUyNw==", "bodyText": "code formatting", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417721527", "createdAt": "2020-04-30T02:35:23Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/process/impl/AbstractProcessInstance.java", "diffHunk": "@@ -60,21 +60,21 @@\n \n public abstract class AbstractProcessInstance<T extends Model> implements ProcessInstance<T> {\n \n-    private final T variables;\n-    private final AbstractProcess<T> process;\n-    private final ProcessRuntime rt;\n-    private org.kie.api.runtime.process.ProcessInstance legacyProcessInstance;\n-    \n-    private Integer status;\n-    private String id;\n-    private String businessKey;\n-    private String description;\n-    \n-    private ProcessError processError;\n-    \n-    private Supplier<org.kie.api.runtime.process.ProcessInstance> reloadSupplier;\n-    \n-    private CompletionEventListener completionEventListener = new CompletionEventListener();\n+\tprotected final T variables;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc4MDYzOA==", "bodyText": "reformatted", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r417780638", "createdAt": "2020-04-30T06:23:39Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/process/impl/AbstractProcessInstance.java", "diffHunk": "@@ -60,21 +60,21 @@\n \n public abstract class AbstractProcessInstance<T extends Model> implements ProcessInstance<T> {\n \n-    private final T variables;\n-    private final AbstractProcess<T> process;\n-    private final ProcessRuntime rt;\n-    private org.kie.api.runtime.process.ProcessInstance legacyProcessInstance;\n-    \n-    private Integer status;\n-    private String id;\n-    private String businessKey;\n-    private String description;\n-    \n-    private ProcessError processError;\n-    \n-    private Supplier<org.kie.api.runtime.process.ProcessInstance> reloadSupplier;\n-    \n-    private CompletionEventListener completionEventListener = new CompletionEventListener();\n+\tprotected final T variables;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcyMTUyNw=="}, "originalCommit": {"oid": "dadbb514dcea33f0e9bd4fa1ac0fb91f5d5d6958"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQwMzc0OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODowNzoxNlrOGQ1edA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMDowOTowMlrOGRMP8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwNjU0OA==", "bodyText": "you can extract the promise.future() into a variable to be reused.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420306548", "createdAt": "2020-05-05T18:07:16Z", "author": {"login": "tiagodolphine"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "diffHunk": "@@ -134,4 +141,24 @@ public boolean cancelJob(String id) {\n         \n         return true;\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        Promise<Job> promise = Promise.promise();\n+        \n+        client.get(JOBS_PATH + \"/\" + id).send(res -> {\n+            if (res.succeeded() && res.result().statusCode() == 200) {\n+                promise.complete(res.result().bodyAsJson(Job.class));\n+            } else if (res.succeeded() && res.result().statusCode() == 404) {\n+                promise.fail(new JobNotFoundException(id));\n+            } else {\n+                promise.fail(new RuntimeException(\"Unable to find job with id \" + id));\n+            }\n+        });\n+        if (promise.future().result() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY3OTY2Ng==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420679666", "createdAt": "2020-05-06T10:09:02Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "diffHunk": "@@ -134,4 +141,24 @@ public boolean cancelJob(String id) {\n         \n         return true;\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        Promise<Job> promise = Promise.promise();\n+        \n+        client.get(JOBS_PATH + \"/\" + id).send(res -> {\n+            if (res.succeeded() && res.result().statusCode() == 200) {\n+                promise.complete(res.result().bodyAsJson(Job.class));\n+            } else if (res.succeeded() && res.result().statusCode() == 404) {\n+                promise.fail(new JobNotFoundException(id));\n+            } else {\n+                promise.fail(new RuntimeException(\"Unable to find job with id \" + id));\n+            }\n+        });\n+        if (promise.future().result() != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwNjU0OA=="}, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQxOTMxOnYy", "diffSide": "RIGHT", "path": "api/kogito-services/src/main/java/org/kie/services/jobs/impl/InMemoryJobService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxMTozNFrOGQ1ofA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMDoxMDoyNlrOGRMSrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwOTExNg==", "bodyText": "in case scheduled is null, maybe it is worth to check and throw a NotFound exception.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420309116", "createdAt": "2020-05-05T18:11:34Z", "author": {"login": "tiagodolphine"}, "path": "api/kogito-services/src/main/java/org/kie/services/jobs/impl/InMemoryJobService.java", "diffHunk": "@@ -91,6 +92,20 @@ public boolean cancelJob(String id) {\n         return false;\n     }\n \n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        if (scheduledJobs.containsKey(id)) {\n+             ScheduledFuture<?> scheduled = scheduledJobs.get(id);\n+             \n+             long remainingTime = scheduled.getDelay(TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY4MDM2NQ==", "bodyText": "I kept it as is as there is no JobNotFoundException available as this is in the api module while the exception is in the jobs-api. Note that this is mainly for test purpose so should not be used in production like scenarios.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420680365", "createdAt": "2020-05-06T10:10:26Z", "author": {"login": "mswiderski"}, "path": "api/kogito-services/src/main/java/org/kie/services/jobs/impl/InMemoryJobService.java", "diffHunk": "@@ -91,6 +92,20 @@ public boolean cancelJob(String id) {\n         return false;\n     }\n \n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        if (scheduledJobs.containsKey(id)) {\n+             ScheduledFuture<?> scheduled = scheduledJobs.get(id);\n+             \n+             long remainingTime = scheduled.getDelay(TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwOTExNg=="}, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQzODgzOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxNjo1OFrOGQ11Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxNjo1OFrOGQ11Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMjMyMg==", "bodyText": "maybe extract this block of code to build the action into a common/super class and have the SignalProcessInstanceAction, HandleMessageAction... instance as a parameter to be added to metadata, a more generic attribute like Action interface.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420312322", "createdAt": "2020-05-05T18:16:58Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +152,12 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ0NDcxOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxODoyN1rOGQ14uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxODoyN1rOGQ14uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzI3Mw==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420313273", "createdAt": "2020-05-05T18:18:27Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -186,17 +189,11 @@ public void handleMessageNode(final Node node, final Element element, final Stri\n                 endNode.setMetaData(\"TriggerType\", \"ProduceMessage\");\n                 endNode.setMetaData(\"TriggerRef\", message.getName());\n                 List<DroolsAction> actions = new ArrayList<DroolsAction>();\n-\n-                actions.add(new DroolsConsequenceAction(\"java\",\n-                    \"org.drools.core.process.instance.impl.WorkItemImpl workItem = new org.drools.core.process.instance.impl.WorkItemImpl();\" + EOL +\n-                    \"workItem.setName(\\\"Send Task\\\");\" + EOL +\n-                    \"workItem.setNodeInstanceId(kcontext.getNodeInstance().getId());\" + EOL +\n-                    \"workItem.setProcessInstanceId(kcontext.getProcessInstance().getId());\" + EOL +\n-                    \"workItem.setNodeId(kcontext.getNodeInstance().getNodeId());\" + EOL +\n-                    \"workItem.setParameter(\\\"MessageType\\\", \\\"\" + message.getType() + \"\\\");\" + EOL +\n-                    (variable == null ? \"\" : \"workItem.setParameter(\\\"Message\\\", \" + variable + \");\" + EOL) +\n-\t\t\t\t\t\"workItem.setDeploymentId((String) kcontext.getKnowledgeRuntime().getEnvironment().get(\\\"deploymentId\\\"));\" + EOL +\n-                    \"((org.drools.core.process.instance.WorkItemManager) kcontext.getKnowledgeRuntime().getWorkItemManager()).internalExecuteWorkItem(workItem);\"));\n+                \n+                DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ0NjgxOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxODo1OVrOGQ15_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxODo1OVrOGQ15_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzU5OQ==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420313599", "createdAt": "2020-05-05T18:18:59Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -203,23 +210,14 @@ public void handleSignalNode(final Node node, final Element element,\n                 actionNode.setMetaData(\"Variable\", variable);\n \n \t\t\t\t// check if signal should be send async\n-\t\t\t\tif (dataInputs.containsValue(\"async\")) {\n-\t\t\t\t    signalName = \"ASYNC-\" + signalName;\n-\t\t\t\t}\n+                if (dataInputs.containsValue(\"async\")) {\n+                    signalName = \"ASYNC-\" + signalName;\n+                }\n \n-\t\t\t\tString signalExpression = getSignalExpression(actionNode, signalName, \"tVariable\");\n-\n-\t\t\t\tactionNode\n-\t\t\t\t\t\t.setAction(new DroolsConsequenceAction(\n-\t\t\t\t\t\t\t\t\"java\",\n-\t\t\t\t\t\t\t\t\" Object tVariable = \"+ (variable == null ? \"null\" : variable)+\";\"\n-\t\t\t\t\t\t\t\t+ \"org.jbpm.workflow.core.node.Transformation transformation = (org.jbpm.workflow.core.node.Transformation)kcontext.getNodeInstance().getNode().getMetaData().get(\\\"Transformation\\\");\"\n-\t\t\t\t\t\t\t\t+ \"if (transformation != null) {\"\n-\t\t\t\t\t\t\t\t+ \"  tVariable = new org.jbpm.process.core.event.EventTransformerImpl(transformation)\"\n-\t\t\t\t\t\t\t\t+ \"  .transformEvent(\"+(variable == null ? \"null\" : variable)+\");\"\n-\t\t\t\t\t\t\t\t+ \"}\"+\n-\t\t\t\t\t\t\t\tsignalExpression));\n-\t\t\t}\n+                DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ0OTM3OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxOTozN1rOGQ17jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxOTozN1rOGQ17jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzk5Ng==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420313996", "createdAt": "2020-05-05T18:19:37Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -251,42 +249,18 @@ public void handleMessageNode(final Node node, final Element element,\n \t\t\t\t\tthrow new IllegalArgumentException(\n \t\t\t\t\t\t\t\"Could not find message \" + messageRef);\n \t\t\t\t}\n-                String variable = (String) actionNode.getMetaData(\"MappingVariable\");\n+                String variable = (String) actionNode.getMetaData(MAPPING_VARIABLE_KEY);\n                 Variable v = (Variable) ((ProcessBuildData) parser.getData()).getMetaData(\"Variable\");\n                 if (v != null) {\n                     variable = (String) v.getMetaData(variable);\n                 }\n-\t\t\t\tactionNode.setMetaData(\"MessageType\", message.getType());\n-\t\t\t\tactionNode.setMetaData(\"TriggerType\", \"ProduceMessage\");\n-\t\t\t\tactionNode.setMetaData(\"TriggerRef\", message.getName());\n-\t\t\t\tactionNode\n-\t\t\t\t\t\t.setAction(new DroolsConsequenceAction(\n-\t\t\t\t\t\t\t\t\"java\",\n-\t\t\t\t\t\t\t\t\" Object tVariable = \"+ (variable == null ? \"null\" : variable)+\";\"\n-\t\t\t\t\t\t\t\t+ \"org.jbpm.workflow.core.node.Transformation transformation = (org.jbpm.workflow.core.node.Transformation)kcontext.getNodeInstance().getNode().getMetaData().get(\\\"Transformation\\\");\"\n-\t\t\t\t\t\t\t\t+ \"if (transformation != null) {\"\n-\t\t\t\t\t\t\t\t+ \"  tVariable = new org.jbpm.process.core.event.EventTransformerImpl(transformation)\"\n-\t\t\t\t\t\t\t\t+ \"  .transformEvent(\"+(variable == null ? \"null\" : variable)+\");\"\n-\t\t\t\t\t\t\t\t+ \"}\"\n-\t\t\t\t\t\t\t\t+ \"org.drools.core.process.instance.impl.WorkItemImpl workItem = new org.drools.core.process.instance.impl.WorkItemImpl();\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setName(\\\"Send Task\\\");\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setProcessInstanceId(kcontext.getProcessInstance().getId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setParameter(\\\"MessageType\\\", \\\"\"\n-\t\t\t\t\t\t\t\t\t\t+ message.getType()\n-\t\t\t\t\t\t\t\t\t\t+ \"\\\");\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setNodeInstanceId(kcontext.getNodeInstance().getId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setNodeId(kcontext.getNodeInstance().getNodeId());\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ \"workItem.setDeploymentId((String) kcontext.getKnowledgeRuntime().getEnvironment().get(\\\"deploymentId\\\"));\"\n-\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t+ (variable == null ? \"\"\n-\t\t\t\t\t\t\t\t\t\t\t\t: \"workItem.setParameter(\\\"Message\\\", tVariable);\" + EOL)\n-\t\t\t\t\t\t\t\t\t\t+ \"((org.drools.core.process.instance.WorkItemManager) kcontext.getKnowledgeRuntime().getWorkItemManager()).internalExecuteWorkItem(workItem);\"));\n+                actionNode.setMetaData(\"MessageType\", message.getType());\n+                actionNode.setMetaData(\"TriggerType\", \"ProduceMessage\");\n+                actionNode.setMetaData(\"TriggerRef\", message.getName());\n+\n+                DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ1MDM0OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxOTo1M1rOGQ18Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoxOTo1M1rOGQ18Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNDE1NQ==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420314155", "createdAt": "2020-05-05T18:19:53Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -312,36 +286,17 @@ public void handleEscalationNode(final Node node, final Element element,\n \t\t\t\t\t\tthrow new IllegalArgumentException(\n \t\t\t\t\t\t\t\t\"No escalations found\");\n \t\t\t\t\t}\n-\t\t\t\t\tEscalation escalation = escalations.get(escalationRef);\n-\t\t\t\t\tif (escalation == null) {\n-\t\t\t\t\t\tthrow new IllegalArgumentException(\n-\t\t\t\t\t\t\t\t\"Could not find escalation \" + escalationRef);\n-\t\t\t\t\t}\n-\t\t\t\t\tString faultName = escalation.getEscalationCode();\n-\t\t\t\t\tString variable = (String) actionNode.getMetaData(\"MappingVariable\");\n-\t\t\t\t\tactionNode\n-\t\t\t\t\t\t\t.setAction(new DroolsConsequenceAction(\n-\t\t\t\t\t\t\t\t\t\"java\",\n-\t\t\t\t\t\t\t\t\t\"org.jbpm.process.instance.context.exception.ExceptionScopeInstance scopeInstance = (org.jbpm.process.instance.context.exception.ExceptionScopeInstance) ((org.jbpm.workflow.instance.NodeInstance) kcontext.getNodeInstance()).resolveContextInstance(org.jbpm.process.core.context.exception.ExceptionScope.EXCEPTION_SCOPE, \\\"\"\n-\t\t\t\t\t\t\t\t\t\t\t+ faultName\n-\t\t\t\t\t\t\t\t\t\t\t+ \"\\\");\"\n-\t\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t\t+ \"if (scopeInstance != null) {\"\n-\t\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t\t+ \" Object tVariable = \"+ (variable == null ? \"null\" : variable)+\";\"\n-\t\t\t\t\t\t\t\t\t\t\t+ \"org.jbpm.workflow.core.node.Transformation transformation = (org.jbpm.workflow.core.node.Transformation)kcontext.getNodeInstance().getNode().getMetaData().get(\\\"Transformation\\\");\"\n-\t\t\t\t\t\t\t\t\t\t\t+ \"if (transformation != null) {\"\n-\t\t\t\t\t\t\t\t\t\t\t+ \"  tVariable = new org.jbpm.process.core.event.EventTransformerImpl(transformation)\"\n-\t\t\t\t\t\t\t\t\t\t\t+ \"  .transformEvent(\"+(variable == null ? \"null\" : variable)+\");\"\n-\t\t\t\t\t\t\t\t\t\t\t+ \"}\"\n-\t\t\t\t\t\t\t\t\t\t\t+ \"  scopeInstance.handleException(\\\"\"\n-\t\t\t\t\t\t\t\t\t\t\t+ faultName\n-\t\t\t\t\t\t\t\t\t\t\t+ \"\\\", tVariable);\"\n-\t\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t\t+ \"} else {\"\n-\t\t\t\t\t\t\t\t\t\t\t+ EOL\n-\t\t\t\t\t\t\t\t\t\t\t+ \"    ((org.jbpm.process.instance.ProcessInstance) kcontext.getProcessInstance()).setState(org.jbpm.process.instance.ProcessInstance.STATE_ABORTED);\"\n-\t\t\t\t\t\t\t\t\t\t\t+ EOL + \"}\"));\n+                    Escalation escalation = escalations.get(escalationRef);\n+                    if (escalation == null) {\n+                        throw new IllegalArgumentException(\n+                                                           \"Could not find escalation \" + escalationRef);\n+                    }\n+                    String faultName = escalation.getEscalationCode();\n+                    String variable = (String) actionNode.getMetaData(MAPPING_VARIABLE_KEY);\n+\n+                    DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 176}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ1MjA0OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMDoxOVrOGQ19Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMDoxOVrOGQ19Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNDQyNw==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420314427", "createdAt": "2020-05-05T18:20:19Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "diffHunk": "@@ -403,9 +404,9 @@ private static void linkBoundaryEscalationEvent(NodeContainer nodeContainer, Nod\n         \n         String variable = ((EventNode)node).getVariableName();\n         ActionExceptionHandler exceptionHandler = new ActionExceptionHandler();\n-        DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \n-                    PROCESS_INSTANCE_SIGNAL_EVENT + \"Escalation-\" + attachedTo + \"-\" + escalationCode + \"\\\", kcontext.getVariable(\\\"\" + variable +\"\\\"));\");\n+        DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ1MjMzOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMDoyNVrOGQ19bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMDoyNVrOGQ19bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNDQ3Nw==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420314477", "createdAt": "2020-05-05T18:20:25Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "diffHunk": "@@ -441,17 +442,9 @@ private static void linkBoundaryErrorEvent(NodeContainer nodeContainer, Node nod\n         \n         String variable = ((EventNode)node).getVariableName();\n \n-        DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\",                   \n-                    PROCESS_INSTANCE_SIGNAL_EVENT + \"Error-\" + attachedTo + \"-\" + errorCode + \"\\\", kcontext.getVariable(\\\"\" + variable +\"\\\"));\");\n-        // register directly the action as metadata to do not require compilation\n-        action.setMetaData(\"Action\", new Action() {\n-            \n-            @Override\n-            public void execute(ProcessContext kcontext) throws Exception {        \n-                kcontext.getProcessInstance().signalEvent(\"Error-\" + attachedTo + \"-\" + errorCode, kcontext.getVariable(\" + variable +\"));\n-            }\n-        });\n-        \n+        DroolsConsequenceAction action = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ1NDQwOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMDo1NVrOGQ1-sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMDo1NVrOGQ1-sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNDgwMg==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420314802", "createdAt": "2020-05-05T18:20:55Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "diffHunk": "@@ -479,18 +472,9 @@ private static void linkBoundaryTimerEvent(NodeContainer nodeContainer, Node nod\n         if (timeDuration != null) {\n             timer.setDelay(timeDuration);\n             timer.setTimeType(Timer.TIME_DURATION);\n-            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\",\n-                    PROCESS_INSTANCE_SIGNAL_EVENT + \"Timer-\" + attachedTo + \"-\" + timeDuration + \"-\" + node.getId() +\"\\\", kcontext.getNodeInstance().getId());\");\n-            compositeNode.addTimer(timer, consequenceAction);\n-            \n-            // register directly the action as metadata to do not require compilation\n-            consequenceAction.setMetaData(\"Action\", new Action() {\n-                \n-                @Override\n-                public void execute(ProcessContext kcontext) throws Exception {        \n-                    kcontext.getProcessInstance().signalEvent(\"Timer-\" + attachedTo + \"-\" + timeDuration + \"-\" + node.getId(), kcontext.getNodeInstance().getId());\n-                }\n-            });\n+            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\", \"\");                       ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ1NDgxOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMTowNlrOGQ1_BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMTowNlrOGQ1_BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNDg4NQ==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420314885", "createdAt": "2020-05-05T18:21:06Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "diffHunk": "@@ -503,33 +487,16 @@ public void execute(ProcessContext kcontext) throws Exception {\n             \n             String finalTimeCycle = timeCycle;\n             \n-            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\",\n-            \t\tPROCESS_INSTANCE_SIGNAL_EVENT + \"Timer-\" + attachedTo + \"-\" + finalTimeCycle + (timer.getPeriod() == null ? \"\" : \"###\" + timer.getPeriod()) + \"-\" + node.getId() + \"\\\", kcontext.getNodeInstance().getId());\");\n+            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjQ1NTIwOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMToxM1rOGQ1_Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMToxM1rOGQ1_Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNDk0Ng==", "bodyText": "same, you can extract this block of code to build the action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420314946", "createdAt": "2020-05-05T18:21:13Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "diffHunk": "@@ -503,33 +487,16 @@ public void execute(ProcessContext kcontext) throws Exception {\n             \n             String finalTimeCycle = timeCycle;\n             \n-            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\",\n-            \t\tPROCESS_INSTANCE_SIGNAL_EVENT + \"Timer-\" + attachedTo + \"-\" + finalTimeCycle + (timer.getPeriod() == null ? \"\" : \"###\" + timer.getPeriod()) + \"-\" + node.getId() + \"\\\", kcontext.getNodeInstance().getId());\");\n+            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\", \"\");\n             compositeNode.addTimer(timer, consequenceAction);\n             \n-            // register directly the action as metadata to do not require compilation\n-            consequenceAction.setMetaData(\"Action\", new Action() {\n-                \n-                @Override\n-                public void execute(ProcessContext kcontext) throws Exception {        \n-                    kcontext.getProcessInstance().signalEvent(\"Timer-\" + attachedTo + \"-\" + finalTimeCycle + (timer.getPeriod() == null ? \"\" : \"###\" + timer.getPeriod()) + \"-\" + node.getId(), kcontext.getNodeInstance().getId());\n-                }\n-            });\n+            consequenceAction.setMetaData(\"Action\", new SignalProcessInstanceAction(\"Timer-\" + attachedTo + \"-\" + finalTimeCycle + (timer.getPeriod() == null ? \"\" : \"###\" + timer.getPeriod()) + \"-\" + node.getId(), kcontext -> kcontext.getNodeInstance().getId(), SignalProcessInstanceAction.PROCESS_INSTANCE_SCOPE));\n         } else if (timeDate != null) {\n             timer.setDate(timeDate);\n             timer.setTimeType(Timer.TIME_DATE);                        \n-            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\",\n-                    PROCESS_INSTANCE_SIGNAL_EVENT + \"Timer-\" + attachedTo + \"-\" + timeDate + \"-\" + node.getId() +\"\\\", kcontext.getNodeInstance().getId());\");\n-            compositeNode.addTimer(timer, consequenceAction);\n-            \n-            // register directly the action as metadata to do not require compilation\n-            consequenceAction.setMetaData(\"Action\", new Action() {\n-                \n-                @Override\n-                public void execute(ProcessContext kcontext) throws Exception {        \n-                    kcontext.getProcessInstance().signalEvent(\"Timer-\" + attachedTo + \"-\" + timeDate + \"-\" + node.getId(), kcontext.getNodeInstance().getId());\n-                }\n-            });\n+            DroolsConsequenceAction consequenceAction = new DroolsConsequenceAction(\"java\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjUxMDc5OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/event/EventTransformerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODozNjowMVrOGQ2iJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODozNjowMVrOGQ2iJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyMzg3OQ==", "bodyText": "what about a more functional style, suggestion:\ntransformer.transform(transformation.getCompiledExpression(),\n                              Optional.ofNullable(event)\n                                      .filter(Map.class::isInstance)\n                                      .map(Map.class::cast)\n                                      .orElseGet(() -> Collections.singletonMap(name, event)));", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420323879", "createdAt": "2020-05-05T18:36:01Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/event/EventTransformerImpl.java", "diffHunk": "@@ -41,15 +42,22 @@ public EventTransformerImpl(Transformation transformation) {\n \t\t}\n \t}\n \n-\t@Override\n+\t@SuppressWarnings({\"unchecked\", \"rawtypes\"})\n+    @Override\n \tpublic Object transformEvent(Object event) {\n \t\tif (event == null || transformation == null) {\n \t\t\treturn event;\n \t\t}\n \t\tDataTransformer transformer = DataTransformerRegistry.get().find(transformation.getLanguage());\n     \tif (transformer != null) {\n-    \t\tObject parameterValue = transformer.transform(transformation.getCompiledExpression(), Collections.singletonMap(name, event));\n-    \t\treturn parameterValue;\n+    \t    Map<String, Object> parameters = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjUyMDQ3OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/workflow/core/DroolsAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODozODo1M1rOGQ2oWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMDoxMjoxMlrOGRMV8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyNTQ2NQ==", "bodyText": "it is only possible to add the first \"Action\"? should it throw an error in case it is being set more than one?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420325465", "createdAt": "2020-05-05T18:38:53Z", "author": {"login": "tiagodolphine"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/workflow/core/DroolsAction.java", "diffHunk": "@@ -39,7 +39,11 @@ public void wire(Object object) {\n     }\n     \n     public void setMetaData(String name, Object value) {\n-        this.metaData.put(name, value);\n+        if (\"Action\".equals(name)) {\n+            this.metaData.putIfAbsent(name, value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY4MTIwMg==", "bodyText": "I'd say it should be possible to add only first action", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420681202", "createdAt": "2020-05-06T10:12:12Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/workflow/core/DroolsAction.java", "diffHunk": "@@ -39,7 +39,11 @@ public void wire(Object object) {\n     }\n     \n     public void setMetaData(String name, Object value) {\n-        this.metaData.put(name, value);\n+        if (\"Action\".equals(name)) {\n+            this.metaData.putIfAbsent(name, value);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyNTQ2NQ=="}, "originalCommit": {"oid": "1c24d20a97faf04eea67f33beefc67e1b6c265de"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxOTYzNDQ1OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzo1NDoxM1rOGRUK0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNDoxNTo1M1rOGRVNQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgwOTQyNw==", "bodyText": "@mswiderski seems like this is not used anymore", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420809427", "createdAt": "2020-05-06T13:54:13Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -50,6 +55,10 @@\n \tpublic static final String LINK_NAME = \"linkName\";\n \tpublic static final String LINK_SOURCE = \"source\";\n \tpublic static final String LINK_TARGET = \"target\";\n+\t\n+\tprivate static final String MAPPING_VARIABLE_KEY = \"MappingVariable\";\n+\tprivate static final String TRANSFORMATION_KEY = \"Transformation\";\n+\tprivate static final String ACTION_KEY = \"Action\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "938174b43f63a19c6e9a1fb163a6475399322a10"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyNjQzNA==", "bodyText": "removed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420826434", "createdAt": "2020-05-06T14:15:53Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/IntermediateThrowEventHandler.java", "diffHunk": "@@ -50,6 +55,10 @@\n \tpublic static final String LINK_NAME = \"linkName\";\n \tpublic static final String LINK_SOURCE = \"source\";\n \tpublic static final String LINK_TARGET = \"target\";\n+\t\n+\tprivate static final String MAPPING_VARIABLE_KEY = \"MappingVariable\";\n+\tprivate static final String TRANSFORMATION_KEY = \"Transformation\";\n+\tprivate static final String ACTION_KEY = \"Action\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgwOTQyNw=="}, "originalCommit": {"oid": "938174b43f63a19c6e9a1fb163a6475399322a10"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDE1MDAwOnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNTo0MDo0MFrOGRZPRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNjowMlrOGRv2PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg5MjQ4Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n          \n          \n            \n                        ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n          \n          \n            \n                        return null;\n          \n          \n            \n                        }\n          \n          \n            \n                      }).when(request).send(any());\n          \n          \n            \n                    doAnswer(invocationOnMock -> {\n          \n          \n            \n                        Handler<AsyncResult<HttpResponse<Buffer>>> handler = invocationOnMock.getArgument(0);\n          \n          \n            \n                        handler.handle(asyncResult);\n          \n          \n            \n                        return null;\n          \n          \n            \n                    }).when(request).send(any());\n          \n      \n    \n    \n  \n\nWhat about this? Looks much cleaner and gets rid of some unchecked warnings.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420892486", "createdAt": "2020-05-06T15:40:40Z", "author": {"login": "MarianMacik"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +123,51 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult = mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MjkwOQ==", "bodyText": "replaced, thanks", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421262909", "createdAt": "2020-05-07T06:16:02Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +123,51 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult = mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg5MjQ4Ng=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDE2MzM0OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNTo0Mzo1MlrOGRZX_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNjoxM1rOGRv2jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg5NDcxNg==", "bodyText": "Please include type arguments to HttpRequest.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420894716", "createdAt": "2020-05-06T15:43:52Z", "author": {"login": "MarianMacik"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +123,51 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2Mjk5MA==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421262990", "createdAt": "2020-05-07T06:16:13Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +123,51 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg5NDcxNg=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDE2NDUxOnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNTo0NDowN1rOGRZYtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNTo1NlrOGRv2DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg5NDkwMg==", "bodyText": "Same applies for this method.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420894902", "createdAt": "2020-05-06T15:44:07Z", "author": {"login": "MarianMacik"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +123,51 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult = mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isEqualTo(job.getExpirationTime());\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2Mjg2MQ==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421262861", "createdAt": "2020-05-07T06:15:56Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/test/java/org/kie/kogito/jobs/management/quarkus/VertxJobsServiceTest.java", "diffHunk": "@@ -112,4 +123,51 @@ void testCancelJob(@Mock HttpRequest request) {\n         tested.cancelJob(\"123\");\n         verify(webClient).delete(\"/jobs/123\");\n     }\n+    \n+    @Test\n+    void testGetScheduleTime(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {\n+        when(webClient.get(anyString())).thenReturn(request);\n+        Job job = new Job();\n+        job.setId(\"123\");\n+        job.setExpirationTime(ZonedDateTime.now());\n+        AsyncResult<HttpResponse<Buffer>> asyncResult = mock(AsyncResult.class);\n+        when(asyncResult.succeeded()).thenReturn(true);\n+        when(asyncResult.result()).thenReturn(response);\n+        when(response.statusCode()).thenReturn(200);\n+        when(response.bodyAsJson(any())).thenReturn(job);\n+        \n+        doAnswer(new Answer<AsyncResult<HttpResponse<Buffer>>>() {\n+            @Override\n+            public AsyncResult<HttpResponse<Buffer>> answer(InvocationOnMock arg0) throws Throwable {\n+            ((Handler<AsyncResult<HttpResponse<Buffer>>>) arg0.getArgument(0)).handle(asyncResult);\n+            return null;\n+            }\n+          }).when(request).send(any());\n+        \n+        ZonedDateTime scheduledTime = tested.getScheduledTime(\"123\");\n+        assertThat(scheduledTime).isEqualTo(job.getExpirationTime());\n+        verify(webClient).get(\"/jobs/123\");\n+    }\n+    \n+    @Test\n+    void testGetScheduleTimeJobNotFound(@Mock HttpRequest request, @Mock HttpResponse<Buffer> response) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg5NDkwMg=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDQ4MTE5OnYy", "diffSide": "RIGHT", "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNjo1OTowNlrOGRchaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNDo0MDozM1rOGSB50Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0NjI4Mw==", "bodyText": "Isn't this REST call async? In that case, shouldn't we wait for a response and only then return the expiration time?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420946283", "createdAt": "2020-05-06T16:59:06Z", "author": {"login": "MarianMacik"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "diffHunk": "@@ -134,4 +142,25 @@ public boolean cancelJob(String id) {\n         \n         return true;\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        Promise<Job> promise = Promise.promise();\n+        \n+        client.get(JOBS_PATH + \"/\" + id).send(res -> {\n+            if (res.succeeded() && res.result().statusCode() == 200) {\n+                promise.complete(res.result().bodyAsJson(Job.class));\n+            } else if (res.succeeded() && res.result().statusCode() == 404) {\n+                promise.fail(new JobNotFoundException(id));\n+            } else {\n+                promise.fail(new RuntimeException(\"Unable to find job with id \" + id));\n+            }\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1ODM5NQ==", "bodyText": "isn't that what promise does?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421258395", "createdAt": "2020-05-07T06:03:10Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "diffHunk": "@@ -134,4 +142,25 @@ public boolean cancelJob(String id) {\n         \n         return true;\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        Promise<Job> promise = Promise.promise();\n+        \n+        client.get(JOBS_PATH + \"/\" + id).send(res -> {\n+            if (res.succeeded() && res.result().statusCode() == 200) {\n+                promise.complete(res.result().bodyAsJson(Job.class));\n+            } else if (res.succeeded() && res.result().statusCode() == 404) {\n+                promise.fail(new JobNotFoundException(id));\n+            } else {\n+                promise.fail(new RuntimeException(\"Unable to find job with id \" + id));\n+            }\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0NjI4Mw=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5MDA3OA==", "bodyText": "I checked the code and there seems to be no blocking method when calling promise.future() or future.result(). According to IDE Promise.promise() returns just FutureImpl and its result() method is basically just a getter. I understand that the only thing what Promise does is to be able to set Handler which is called after the work is done. Here we could set a handler on the future but we need to wait there for the time to be returned. So perhaps we need vertx-sync method? Maybe I am wrong, not sure.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421390078", "createdAt": "2020-05-07T10:05:59Z", "author": {"login": "MarianMacik"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "diffHunk": "@@ -134,4 +142,25 @@ public boolean cancelJob(String id) {\n         \n         return true;\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        Promise<Job> promise = Promise.promise();\n+        \n+        client.get(JOBS_PATH + \"/\" + id).send(res -> {\n+            if (res.succeeded() && res.result().statusCode() == 200) {\n+                promise.complete(res.result().bodyAsJson(Job.class));\n+            } else if (res.succeeded() && res.result().statusCode() == 404) {\n+                promise.fail(new JobNotFoundException(id));\n+            } else {\n+                promise.fail(new RuntimeException(\"Unable to find job with id \" + id));\n+            }\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0NjI4Mw=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU1ODczNw==", "bodyText": "replaced with java CompletableFuture instead and updated test to make sure this works now. thanks", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421558737", "createdAt": "2020-05-07T14:40:33Z", "author": {"login": "mswiderski"}, "path": "addons/jobs/jobs-management-quarkus-addon/src/main/java/org/kie/kogito/jobs/management/quarkus/VertxJobsService.java", "diffHunk": "@@ -134,4 +142,25 @@ public boolean cancelJob(String id) {\n         \n         return true;\n     }\n+\n+    @Override\n+    public ZonedDateTime getScheduledTime(String id) {\n+        Promise<Job> promise = Promise.promise();\n+        \n+        client.get(JOBS_PATH + \"/\" + id).send(res -> {\n+            if (res.succeeded() && res.result().statusCode() == 200) {\n+                promise.complete(res.result().bodyAsJson(Job.class));\n+            } else if (res.succeeded() && res.result().statusCode() == 404) {\n+                promise.fail(new JobNotFoundException(id));\n+            } else {\n+                promise.fail(new RuntimeException(\"Unable to find job with id \" + id));\n+            }\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0NjI4Mw=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDU2NDkwOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/AbstractNodeHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzoyMDoxMVrOGRdWaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNjo1MFrOGRv3gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1OTg1MQ==", "bodyText": "Typo matchyIdOrName -> matchByIdOrName", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420959851", "createdAt": "2020-05-06T17:20:11Z", "author": {"login": "MarianMacik"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/AbstractNodeHandler.java", "diffHunk": "@@ -661,4 +663,29 @@ protected String retrieveDataType(String itemSubjectRef, String dtype, Extensibl\n         \n         return null;\n     }\n+    \n+    \n+    /**\n+     * Finds the right variable by its name to make sure that when given as id it will be also matched\n+     * @param variableName name or id of the variable\n+     * @param parser parser instance\n+     * @return returns found variable name or given 'variableName' otherwise\n+     */\n+    protected String findVariable(String variableName, final ExtensibleXmlParser parser) {\n+        if (variableName == null) {\n+            return null;\n+        }\n+        List<?> parents = parser.getParents();\n+        \n+        for (Object parent : parents) {\n+            if (parent instanceof ContextContainer) {\n+                ContextContainer contextContainer = (ContextContainer) parent;\n+                VariableScope variableScope = (VariableScope) contextContainer.getDefaultContext(VariableScope.VARIABLE_SCOPE);\n+                return variableScope.getVariables().stream().filter(v -> v.matchyIdOrName(variableName)).map(v -> v.getName()).findFirst().orElse(variableName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MzIzNQ==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421263235", "createdAt": "2020-05-07T06:16:50Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/AbstractNodeHandler.java", "diffHunk": "@@ -661,4 +663,29 @@ protected String retrieveDataType(String itemSubjectRef, String dtype, Extensibl\n         \n         return null;\n     }\n+    \n+    \n+    /**\n+     * Finds the right variable by its name to make sure that when given as id it will be also matched\n+     * @param variableName name or id of the variable\n+     * @param parser parser instance\n+     * @return returns found variable name or given 'variableName' otherwise\n+     */\n+    protected String findVariable(String variableName, final ExtensibleXmlParser parser) {\n+        if (variableName == null) {\n+            return null;\n+        }\n+        List<?> parents = parser.getParents();\n+        \n+        for (Object parent : parents) {\n+            if (parent instanceof ContextContainer) {\n+                ContextContainer contextContainer = (ContextContainer) parent;\n+                VariableScope variableScope = (VariableScope) contextContainer.getDefaultContext(VariableScope.VARIABLE_SCOPE);\n+                return variableScope.getVariables().stream().filter(v -> v.matchyIdOrName(variableName)).map(v -> v.getName()).findFirst().orElse(variableName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1OTg1MQ=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDYzOTUyOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/test/java/org/jbpm/bpmn2/JbpmBpmn2TestCase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzozOToyNVrOGReGKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNjo1OFrOGRv3rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3MjA3NA==", "bodyText": "Shouldn't this be in a separate method or method name should be adapted?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420972074", "createdAt": "2020-05-06T17:39:25Z", "author": {"login": "MarianMacik"}, "path": "jbpm/jbpm-bpmn2/src/test/java/org/jbpm/bpmn2/JbpmBpmn2TestCase.java", "diffHunk": "@@ -113,11 +102,14 @@ public void disposeSession() {\n     @BeforeEach\n     protected void logTestStart(TestInfo testInfo) {\n         logger.info(\" >>> {} <<<\", testInfo.getDisplayName());\n+        // this is to preserve the same behavior when executing over ksession\n+        System.setProperty(\"org.jbpm.signals.defaultscope\", SignalProcessInstanceAction.DEFAULT_SCOPE);\n     }\n \n     @AfterEach\n     protected void logTestEnd(TestInfo testInfo) {\n         logger.info(\"Finished {}\", testInfo.getDisplayName());\n+        System.clearProperty(\"org.jbpm.signals.defaultscope\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MzI3Ng==", "bodyText": "changed method name", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421263276", "createdAt": "2020-05-07T06:16:58Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/test/java/org/jbpm/bpmn2/JbpmBpmn2TestCase.java", "diffHunk": "@@ -113,11 +102,14 @@ public void disposeSession() {\n     @BeforeEach\n     protected void logTestStart(TestInfo testInfo) {\n         logger.info(\" >>> {} <<<\", testInfo.getDisplayName());\n+        // this is to preserve the same behavior when executing over ksession\n+        System.setProperty(\"org.jbpm.signals.defaultscope\", SignalProcessInstanceAction.DEFAULT_SCOPE);\n     }\n \n     @AfterEach\n     protected void logTestEnd(TestInfo testInfo) {\n         logger.info(\"Finished {}\", testInfo.getDisplayName());\n+        System.clearProperty(\"org.jbpm.signals.defaultscope\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3MjA3NA=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDY0MDk3OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-bpmn2/src/test/java/org/jbpm/bpmn2/JbpmBpmn2TestCase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzozOTo0N1rOGReHGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNzowN1rOGRv35g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3MjMxNA==", "bodyText": "Same here, the method no longer just logs the start of the test.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420972314", "createdAt": "2020-05-06T17:39:47Z", "author": {"login": "MarianMacik"}, "path": "jbpm/jbpm-bpmn2/src/test/java/org/jbpm/bpmn2/JbpmBpmn2TestCase.java", "diffHunk": "@@ -113,11 +102,14 @@ public void disposeSession() {\n     @BeforeEach\n     protected void logTestStart(TestInfo testInfo) {\n         logger.info(\" >>> {} <<<\", testInfo.getDisplayName());\n+        // this is to preserve the same behavior when executing over ksession\n+        System.setProperty(\"org.jbpm.signals.defaultscope\", SignalProcessInstanceAction.DEFAULT_SCOPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MzMzNA==", "bodyText": "changed method name", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421263334", "createdAt": "2020-05-07T06:17:07Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/test/java/org/jbpm/bpmn2/JbpmBpmn2TestCase.java", "diffHunk": "@@ -113,11 +102,14 @@ public void disposeSession() {\n     @BeforeEach\n     protected void logTestStart(TestInfo testInfo) {\n         logger.info(\" >>> {} <<<\", testInfo.getDisplayName());\n+        // this is to preserve the same behavior when executing over ksession\n+        System.setProperty(\"org.jbpm.signals.defaultscope\", SignalProcessInstanceAction.DEFAULT_SCOPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3MjMxNA=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDY0NTcxOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/context/variable/Variable.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo0MDo1NlrOGReKJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoxNzoxNVrOGRv4HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3MzA5Mg==", "bodyText": "Typo.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r420973092", "createdAt": "2020-05-06T17:40:56Z", "author": {"login": "MarianMacik"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/context/variable/Variable.java", "diffHunk": "@@ -164,4 +164,8 @@ public String toString() {\n     public boolean hasTag(String tagName) {\n         return getTags().contains(tagName);\n     }\n+    \n+    public boolean matchyIdOrName(String nameOrId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MzM4OA==", "bodyText": "fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421263388", "createdAt": "2020-05-07T06:17:15Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/core/context/variable/Variable.java", "diffHunk": "@@ -164,4 +164,8 @@ public String toString() {\n     public boolean hasTag(String tagName) {\n         return getTags().contains(tagName);\n     }\n+    \n+    public boolean matchyIdOrName(String nameOrId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3MzA5Mg=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDkzODk4OnYy", "diffSide": "LEFT", "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxODo1NTozMlrOGRg_lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNDo0MTo0OFrOGSB9mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAxOTU0Mg==", "bodyText": "How was this handled before?\nI see that before there was just a consequence (string) set. And that consequence was then code-generated as a lambda to action() builder method in the ActionNodeVisitor (actionNode.getAction().toString() actually returns consequence):\n\n  \n    \n      kogito-runtimes/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ActionNodeVisitor.java\n    \n    \n        Lines 95 to 97\n      in\n      fba1a5e\n    \n    \n    \n    \n\n        \n          \n           actionBody.addStatement(new NameExpr(actionNode.getAction().toString())); \n        \n\n        \n          \n            \n        \n\n        \n          \n           body.addStatement(getFactoryMethod(getNodeId(node), METHOD_ACTION, lambda)); \n        \n    \n  \n\n\nSo right now the consequence is an empty string, so the compilation is no-op. But how is this then translated to the generated ActionNode in case of a throw signal node? The action has to be somehow registered on the generated node as well, right?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421019542", "createdAt": "2020-05-06T18:55:32Z", "author": {"login": "MarianMacik"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +154,11 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = createJavaAction(new SignalProcessInstanceAction(signalName, variable, (String) endNode.getMetaData(\"customScope\"), (Transformation)endNode.getMetaData().get(\"Transformation\")));\n+                \n                 List<DroolsAction> actions = new ArrayList<DroolsAction>();\n-                actions.add(new DroolsConsequenceAction(\"mvel\",signalExpression));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzA0OQ==", "bodyText": "there is no need to do any compilation as the action is already given as actual java class. It was not handled before at all, as this was never implemented for code gen. ActionNodes that represent Script Tasks were implemented but not the internal use of ActionNodes like this.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421257049", "createdAt": "2020-05-07T05:59:02Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +154,11 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = createJavaAction(new SignalProcessInstanceAction(signalName, variable, (String) endNode.getMetaData(\"customScope\"), (Transformation)endNode.getMetaData().get(\"Transformation\")));\n+                \n                 List<DroolsAction> actions = new ArrayList<DroolsAction>();\n-                actions.add(new DroolsConsequenceAction(\"mvel\",signalExpression));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAxOTU0Mg=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4MDUyMA==", "bodyText": "So now it is implemented for codegen? Because that's what I am asking. In that ActionNodeVisitor the lambda will be now empty I guess as we no longer specify a String action but a Java class, so how is the action generated now?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421380520", "createdAt": "2020-05-07T09:49:36Z", "author": {"login": "MarianMacik"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +154,11 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = createJavaAction(new SignalProcessInstanceAction(signalName, variable, (String) endNode.getMetaData(\"customScope\"), (Transformation)endNode.getMetaData().get(\"Transformation\")));\n+                \n                 List<DroolsAction> actions = new ArrayList<DroolsAction>();\n-                actions.add(new DroolsConsequenceAction(\"mvel\",signalExpression));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAxOTU0Mg=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU1OTcwNQ==", "bodyText": "if this is implemented in code get it's more of a question if fluent api supports it. Once fluent api will support it will work fine. So it's prerequisite to make use of this constructs. Note that the changes where done on parser side so similar would have to be done on fluent api.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/486#discussion_r421559705", "createdAt": "2020-05-07T14:41:48Z", "author": {"login": "mswiderski"}, "path": "jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/EndEventHandler.java", "diffHunk": "@@ -150,11 +154,11 @@ public void handleSignalNode(final Node node, final Element element, final Strin\n                 if (dataInputs.containsValue(\"async\")) {\n                     signalName = \"ASYNC-\" + signalName;\n                 }\n-\n-                String signalExpression = getSignalExpression(endNode, signalName, variable);\n-\n+                \n+                DroolsConsequenceAction action = createJavaAction(new SignalProcessInstanceAction(signalName, variable, (String) endNode.getMetaData(\"customScope\"), (Transformation)endNode.getMetaData().get(\"Transformation\")));\n+                \n                 List<DroolsAction> actions = new ArrayList<DroolsAction>();\n-                actions.add(new DroolsConsequenceAction(\"mvel\",signalExpression));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAxOTU0Mg=="}, "originalCommit": {"oid": "e8efbb9fd1605c06172b2b2d81947a7ca812a4df"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 78, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}