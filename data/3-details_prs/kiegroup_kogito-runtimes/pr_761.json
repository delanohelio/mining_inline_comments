{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NDI2Mjgy", "number": 761, "title": "KOGITO-3330 Hotfix: Conditional eager reading of resources on native-image", "bodyText": "https://issues.redhat.com/browse/KOGITO-3330\nIn GraalVM 20.2 under certain conditions, it is not possible to hold onto an input stream reader that has been generated from a classpath resource -- see quarkusio/quarkus#8694 (comment)\nThe hotfix consists in eagerly reading the entire resource when native mode is detected at build time (detected via special System property).\nin other words, instead of:\nnew InputStreamReader(...getResourceAsStream())\n\nfor native image we do\nbytes = getResourceAsStream().readAllBytes()\nnew InputStreamReader(new ByteArrayInputStream(bytes))\n\nWe may have to revisit the issue to see if there are \"better\" ways to fix it (e.g. Quarkus has most probably a \"proper\" way to handle resources); in the meantime, we need to merge this to proceed with the release today.\n(tested locally with native-image. You can double check integration-tests/integration-tests-quarkus  if you want)", "createdAt": "2020-09-14T08:04:43Z", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761", "merged": true, "mergeCommit": {"oid": "1fb7279d667ab473f612ba66f3be1fd805ab7aed"}, "closed": true, "closedAt": "2020-09-14T10:43:24Z", "author": {"login": "evacchi"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIujgtgH2gAyNDg2NDI2MjgyOjA1OGNkYWI1MDA2ZTJhNGI3MjFjMjY1YzVkNTc5ODI4NzZhZDJjOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIwyn5AFqTQ4NzYyODY2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "058cdab5006e2a4b721c265c5d57982876ad2c94", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/058cdab5006e2a4b721c265c5d57982876ad2c94", "committedDate": "2020-09-14T08:03:03Z", "message": "KOGITO-3330 Hotfix: Conditional eager reading of resources on native-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NTE0NzU5", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761#pullrequestreview-487514759", "createdAt": "2020-09-14T08:09:43Z", "commit": {"oid": "058cdab5006e2a4b721c265c5d57982876ad2c94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODowOTo0M1rOHRIh8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODowOTo0M1rOHRIh8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcyNzYwMg==", "bodyText": "I would personally invert this and call it IS_GRAALVM :)", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761#discussion_r487727602", "createdAt": "2020-09-14T08:09:43Z", "author": {"login": "geoand"}, "path": "kogito-codegen/src/main/resources/class-templates/DecisionContainerTemplate.java", "diffHunk": "@@ -1,9 +1,7 @@\n-import java.util.function.Function;\n-\n-import org.kie.api.runtime.KieRuntimeFactory;\n-\n public class DecisionModels implements org.kie.kogito.decision.DecisionModels {\n \n+    private final static boolean IS_JDK = System.getProperty(\"org.graalvm.nativeimage.imagecode\") == null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "058cdab5006e2a4b721c265c5d57982876ad2c94"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d111025f8466bd839584cd65b6c0ae1ec07750", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/78d111025f8466bd839584cd65b6c0ae1ec07750", "committedDate": "2020-09-14T08:11:10Z", "message": "fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c716ee7a690cd620457c11f2a2262457a097587", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/3c716ee7a690cd620457c11f2a2262457a097587", "committedDate": "2020-09-14T08:39:29Z", "message": "IS_NATIVE_IMAGE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "848503be152679d4a9bf2342cd1c52cf4761e7dd", "author": {"user": {"login": "evacchi", "name": "Edoardo Vacchi"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/848503be152679d4a9bf2342cd1c52cf4761e7dd", "committedDate": "2020-09-14T08:39:51Z", "message": "IS_NATIVE_IMAGE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NTQwODU5", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761#pullrequestreview-487540859", "createdAt": "2020-09-14T08:42:50Z", "commit": {"oid": "848503be152679d4a9bf2342cd1c52cf4761e7dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NTQ0NDQ5", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761#pullrequestreview-487544449", "createdAt": "2020-09-14T08:47:21Z", "commit": {"oid": "848503be152679d4a9bf2342cd1c52cf4761e7dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NTUzODY1", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761#pullrequestreview-487553865", "createdAt": "2020-09-14T08:58:41Z", "commit": {"oid": "848503be152679d4a9bf2342cd1c52cf4761e7dd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODo1ODo0MVrOHRKW1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODo1ODo0MVrOHRKW1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc1NzUyNw==", "bodyText": "Good for me, I had similar to\nhttps://github.com/kiegroup/drools/blob/d72e9594cbb7f71a70f1bc13cf84b168ffa52e69/kie-dmn/kie-dmn-feel/src/main/java/org/kie/dmn/feel/util/ClassLoaderUtil.java#L21\neventually I can consolidate", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761#discussion_r487757527", "createdAt": "2020-09-14T08:58:41Z", "author": {"login": "tarilabs"}, "path": "kogito-codegen/src/main/resources/class-templates/DecisionContainerTemplate.java", "diffHunk": "@@ -1,9 +1,7 @@\n-import java.util.function.Function;\n-\n-import org.kie.api.runtime.KieRuntimeFactory;\n-\n public class DecisionModels implements org.kie.kogito.decision.DecisionModels {\n \n+    private final static boolean IS_NATIVE_IMAGE = System.getProperty(\"org.graalvm.nativeimage.imagecode\") != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "848503be152679d4a9bf2342cd1c52cf4761e7dd"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjI4NjYx", "url": "https://github.com/kiegroup/kogito-runtimes/pull/761#pullrequestreview-487628661", "createdAt": "2020-09-14T10:39:22Z", "commit": {"oid": "848503be152679d4a9bf2342cd1c52cf4761e7dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3942, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}