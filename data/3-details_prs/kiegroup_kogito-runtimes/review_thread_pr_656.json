{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NjUyMTQ0", "number": 656, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMToyOTowNFrOETo7rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDoyMzo1NlrOEYE9Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDI5MDM2OnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMToyOTowNVrOG5fGfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMTowNDowNVrOG5zxXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzMTU4MQ==", "bodyText": "In general, I agree the PUT method should be used to update the resource, in his case the variables, so it should not be a POST as it was, but on the other hand, creating a new resource using a PUT is not proper behavior, what about creating the resource in the POST method but sending the ID inside the body (the resource with the ID) or one other position would be the same as it is here with the ID on the path but using a POST instead of a PUT just to create and let the PUT exclusively to do the update operation. WDYT?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r462931581", "createdAt": "2020-07-30T11:29:05Z", "author": {"login": "tiagodolphine"}, "path": "kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java", "diffHunk": "@@ -104,18 +98,20 @@\n         });\n     }\n     \n-    @POST()\n+    @PUT()\n     @Path(\"/{id}\")\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces(MediaType.APPLICATION_JSON)\n-    public CompletionStage<$Type$Output> updateModel_$name$(@PathParam(\"id\") String id, $Type$ resource) {\n+    public CompletionStage<$Type$Output> createOrUpdateModel_$name$(@Context HttpHeaders httpHeaders,\n+                                                                    @PathParam(\"id\") String id,\n+                                                                    $Type$ resource) {\n         return CompletableFuture.supplyAsync(() -> {\n             return org.kie.kogito.services.uow.UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n                 ProcessInstance<$Type$> pi = process.instances()\n                         .findById(id)\n                         .orElse(null);\n                 if (pi == null) {\n-                    return null;\n+                    return createProcessInstance(httpHeaders, id, resource);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29c47ecae236e8db0aef137120c4aaae8684693"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk0NDAyOQ==", "bodyText": "Well, looking at the RFC https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.6\n\nPUT\n... If the Request-URI does not point to an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create the resource with that URI. If a new resource is created, the origin server MUST inform the user agent via the 201 (Created) response...\n\nSo using the PUT can be a solution as you did, and in case the resource does not exist the HTTP code on the response should be 201 instead of 200.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r462944029", "createdAt": "2020-07-30T11:56:03Z", "author": {"login": "tiagodolphine"}, "path": "kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java", "diffHunk": "@@ -104,18 +98,20 @@\n         });\n     }\n     \n-    @POST()\n+    @PUT()\n     @Path(\"/{id}\")\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces(MediaType.APPLICATION_JSON)\n-    public CompletionStage<$Type$Output> updateModel_$name$(@PathParam(\"id\") String id, $Type$ resource) {\n+    public CompletionStage<$Type$Output> createOrUpdateModel_$name$(@Context HttpHeaders httpHeaders,\n+                                                                    @PathParam(\"id\") String id,\n+                                                                    $Type$ resource) {\n         return CompletableFuture.supplyAsync(() -> {\n             return org.kie.kogito.services.uow.UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n                 ProcessInstance<$Type$> pi = process.instances()\n                         .findById(id)\n                         .orElse(null);\n                 if (pi == null) {\n-                    return null;\n+                    return createProcessInstance(httpHeaders, id, resource);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzMTU4MQ=="}, "originalCommit": {"oid": "e29c47ecae236e8db0aef137120c4aaae8684693"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI3MDIzOA==", "bodyText": "Yes, I've done it this way.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r463270238", "createdAt": "2020-07-30T21:04:05Z", "author": {"login": "ruromero"}, "path": "kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java", "diffHunk": "@@ -104,18 +98,20 @@\n         });\n     }\n     \n-    @POST()\n+    @PUT()\n     @Path(\"/{id}\")\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces(MediaType.APPLICATION_JSON)\n-    public CompletionStage<$Type$Output> updateModel_$name$(@PathParam(\"id\") String id, $Type$ resource) {\n+    public CompletionStage<$Type$Output> createOrUpdateModel_$name$(@Context HttpHeaders httpHeaders,\n+                                                                    @PathParam(\"id\") String id,\n+                                                                    $Type$ resource) {\n         return CompletableFuture.supplyAsync(() -> {\n             return org.kie.kogito.services.uow.UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n                 ProcessInstance<$Type$> pi = process.instances()\n                         .findById(id)\n                         .orElse(null);\n                 if (pi == null) {\n-                    return null;\n+                    return createProcessInstance(httpHeaders, id, resource);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzMTU4MQ=="}, "originalCommit": {"oid": "e29c47ecae236e8db0aef137120c4aaae8684693"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzU2MDI5OnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxOTozMDoyNVrOG_vdpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMTo1NjoxN1rOG_5RFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5MTExMA==", "bodyText": "Is it necessary to update the documentation regarding this modification? probably for the other points as well where the REST APIs are being changed, maybe create a JIRA for it, WDYT?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469491110", "createdAt": "2020-08-12T19:30:25Z", "author": {"login": "tiagodolphine"}, "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -25,18 +25,15 @@\n                                       pi.workItems().stream().filter(wi -> wi.getName().equals(\"$taskName$\"))\n                                         .findFirst();\n                               if (task.isPresent()) {\n-                                  return Response.ok(pi.variables().toOutput())\n-                                                 .header(\"Link\", \"</\" + id + \"/$taskName$/\" + task.get().getId() +\n-                                                                 \">; rel='instance'\")\n-                                                 .build();\n+                                  return Response.created(uriInfo.getAbsolutePathBuilder().path(task.get().getId()).build()).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e2f86f48bb03ebedbe8e5a840624330f1aa2c8b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUyMDY2OA==", "bodyText": "Done https://issues.redhat.com/browse/KOGITO-3068", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469520668", "createdAt": "2020-08-12T20:28:36Z", "author": {"login": "ruromero"}, "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -25,18 +25,15 @@\n                                       pi.workItems().stream().filter(wi -> wi.getName().equals(\"$taskName$\"))\n                                         .findFirst();\n                               if (task.isPresent()) {\n-                                  return Response.ok(pi.variables().toOutput())\n-                                                 .header(\"Link\", \"</\" + id + \"/$taskName$/\" + task.get().getId() +\n-                                                                 \">; rel='instance'\")\n-                                                 .build();\n+                                  return Response.created(uriInfo.getAbsolutePathBuilder().path(task.get().getId()).build()).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5MTExMA=="}, "originalCommit": {"oid": "0e2f86f48bb03ebedbe8e5a840624330f1aa2c8b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY1MTczNQ==", "bodyText": "In my opinion docs changes should be part of the JIRA that is causing the changes.\nAlso, I think we should continue to return the output variables of task as processes that were created.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469651735", "createdAt": "2020-08-13T01:56:17Z", "author": {"login": "cristianonicolai"}, "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -25,18 +25,15 @@\n                                       pi.workItems().stream().filter(wi -> wi.getName().equals(\"$taskName$\"))\n                                         .findFirst();\n                               if (task.isPresent()) {\n-                                  return Response.ok(pi.variables().toOutput())\n-                                                 .header(\"Link\", \"</\" + id + \"/$taskName$/\" + task.get().getId() +\n-                                                                 \">; rel='instance'\")\n-                                                 .build();\n+                                  return Response.created(uriInfo.getAbsolutePathBuilder().path(task.get().getId()).build()).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5MTExMA=="}, "originalCommit": {"oid": "0e2f86f48bb03ebedbe8e5a840624330f1aa2c8b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjgyNDQzOnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/resources/class-templates/RestResourceTemplate.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDoyMzo1NlrOHAN8lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDoyMzo1NlrOHAN8lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk5MDU0OQ==", "bodyText": "Is seems the same changes are missing on the Spring templates, like SpringRestResourceTemplate.java", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469990549", "createdAt": "2020-08-13T14:23:56Z", "author": {"login": "tiagodolphine"}, "path": "kogito-codegen/src/main/resources/class-templates/RestResourceTemplate.java", "diffHunk": "@@ -35,54 +40,56 @@\n import org.kie.kogito.auth.IdentityProvider;\n import org.jbpm.process.instance.impl.humantask.HumanTaskTransition;\n \n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n @Path(\"/$name$\")\n public class $Type$Resource {\n \n     Process<$Type$> process;\n \n     Application application;\n \n-    @POST()\n+    @POST\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public $Type$Output createResource_$name$(@Context HttpHeaders httpHeaders,\n+    public Response createResource_$name$(@Context HttpHeaders httpHeaders,\n+                                              @Context UriInfo uriInfo,\n                                               @QueryParam(\"businessKey\") String businessKey,\n                                               $Type$Input resource) {\n         return UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n             $Type$Input inputModel = resource != null ? resource : new $Type$Input();\n             ProcessInstance<$Type$> pi = process.createInstance(businessKey, inputModel.toModel());\n             String startFromNode = httpHeaders.getHeaderString(\"X-KOGITO-StartFromNode\");\n+\n             if (startFromNode != null) {\n                 pi.startFrom(startFromNode);\n             } else {\n                 pi.start();\n             }\n-            return pi.checkError().variables().toOutput();\n+            UriBuilder uriBuilder = uriInfo.getAbsolutePathBuilder().path(pi.id());\n+            return Response.created(uriBuilder.build())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7b39f1c7fe8fc51436c6d6eb8572c7473655aa"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4901, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}