{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMTAzNDU2", "number": 516, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMzozNTowMlrOD9zR_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0OTowOFrOD-LaEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MTI5OTE5OnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/resources/grafana-dashboard-template/operational-dashboard-template.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMzozNTowMlrOGXgtlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDoxMTo0MVrOGXiUzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMwNjM4OQ==", "bodyText": "is this intended?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427306389", "createdAt": "2020-05-19T13:35:02Z", "author": {"login": "evacchi"}, "path": "kogito-codegen/src/main/resources/grafana-dashboard-template/operational-dashboard-template.json", "diffHunk": "@@ -481,7 +481,7 @@\n     ]\n   },\n   \"timezone\": \"\",\n-  \"title\": \"$handlerName$ endpoint metrics\",\n+  \"title\": \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMzMjgxNA==", "bodyText": "Yeah, the title of the dashboard is set at code level when the template is imported", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427332814", "createdAt": "2020-05-19T14:11:41Z", "author": {"login": "r00ta"}, "path": "kogito-codegen/src/main/resources/grafana-dashboard-template/operational-dashboard-template.json", "diffHunk": "@@ -481,7 +481,7 @@\n     ]\n   },\n   \"timezone\": \"\",\n-  \"title\": \"$handlerName$ endpoint metrics\",\n+  \"title\": \"\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMwNjM4OQ=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTIzMzAyOnYy", "diffSide": "RIGHT", "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0MzowOVrOGYHlgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoyMDowNlrOGYIzWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0MzI5Nw==", "bodyText": "Is it possible to have a null type?\nCan you please log (warning?) the node ID in this case?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427943297", "createdAt": "2020-05-20T11:43:09Z", "author": {"login": "danielezonca"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -39,60 +41,52 @@ private GrafanaConfigurationWriter() {\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates an operational grafana dashboard based on a given template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param handlerName: The name of the endpoint.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param handlerName:  The name of the endpoint.\n      * @return: The template customized for the endpoint.\n      */\n-    public static String generateDashboardForEndpoint(String templatePath, String handlerName) {\n+    public static String generateOperationalDashboard(String templatePath, String handlerName) throws IOException {\n         String template = readStandardDashboard(templatePath);\n-        return customizeTemplate(template, handlerName);\n+        template = customizeTemplate(template, handlerName);\n+        JGrafana jgrafana;\n+        jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint operational dashboard\", handlerName));\n+\n+        return jgrafana.serialize();\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates domain specific dashboard from a given dashboard template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param endpoint: The name of the endpoint.\n-     * @param decisions: The decisions in the DMN model.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param endpoint:     The name of the endpoint.\n+     * @param decisions:    The decisions in the DMN model.\n      * @return: The customized template containing also specific panels for the DMN decisions that have been specified in the arguments.\n      */\n-    public static String generateDashboardForDMNEndpoint(String templatePath, String endpoint, List<Decision> decisions) {\n+    public static String generateDomainSpecificDMNDashboard(String templatePath, String endpoint, List<Decision> decisions) throws IOException {\n         String template = readStandardDashboard(templatePath);\n         template = customizeTemplate(template, endpoint);\n \n-        JGrafana jgrafana;\n-        try {\n-            jgrafana = JGrafana.parse(template);\n-        } catch (IOException e) {\n-            logger.warn(\"Could not read the grafana dashboard template.\", e);\n-            return null;\n-        }\n+        JGrafana jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint domain specific dashboard\", endpoint));\n \n         for (Decision decision : decisions) {\n-            String type = decision.getVariable().getTypeRef().getLocalPart();\n-            if (SupportedDecisionTypes.isSupported(type)) {\n+            QName type = decision.getVariable().getTypeRef();\n+            if (type != null && SupportedDecisionTypes.isSupported(type.getLocalPart())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NzM5Ng==", "bodyText": "I found during the demo that yes, this is possible for some dmn model. I will add a log", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427947396", "createdAt": "2020-05-20T11:51:18Z", "author": {"login": "r00ta"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -39,60 +41,52 @@ private GrafanaConfigurationWriter() {\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates an operational grafana dashboard based on a given template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param handlerName: The name of the endpoint.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param handlerName:  The name of the endpoint.\n      * @return: The template customized for the endpoint.\n      */\n-    public static String generateDashboardForEndpoint(String templatePath, String handlerName) {\n+    public static String generateOperationalDashboard(String templatePath, String handlerName) throws IOException {\n         String template = readStandardDashboard(templatePath);\n-        return customizeTemplate(template, handlerName);\n+        template = customizeTemplate(template, handlerName);\n+        JGrafana jgrafana;\n+        jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint operational dashboard\", handlerName));\n+\n+        return jgrafana.serialize();\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates domain specific dashboard from a given dashboard template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param endpoint: The name of the endpoint.\n-     * @param decisions: The decisions in the DMN model.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param endpoint:     The name of the endpoint.\n+     * @param decisions:    The decisions in the DMN model.\n      * @return: The customized template containing also specific panels for the DMN decisions that have been specified in the arguments.\n      */\n-    public static String generateDashboardForDMNEndpoint(String templatePath, String endpoint, List<Decision> decisions) {\n+    public static String generateDomainSpecificDMNDashboard(String templatePath, String endpoint, List<Decision> decisions) throws IOException {\n         String template = readStandardDashboard(templatePath);\n         template = customizeTemplate(template, endpoint);\n \n-        JGrafana jgrafana;\n-        try {\n-            jgrafana = JGrafana.parse(template);\n-        } catch (IOException e) {\n-            logger.warn(\"Could not read the grafana dashboard template.\", e);\n-            return null;\n-        }\n+        JGrafana jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint domain specific dashboard\", endpoint));\n \n         for (Decision decision : decisions) {\n-            String type = decision.getVariable().getTypeRef().getLocalPart();\n-            if (SupportedDecisionTypes.isSupported(type)) {\n+            QName type = decision.getVariable().getTypeRef();\n+            if (type != null && SupportedDecisionTypes.isSupported(type.getLocalPart())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0MzI5Nw=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MzIyNA==", "bodyText": "Good to know :)", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427963224", "createdAt": "2020-05-20T12:20:06Z", "author": {"login": "danielezonca"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -39,60 +41,52 @@ private GrafanaConfigurationWriter() {\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates an operational grafana dashboard based on a given template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param handlerName: The name of the endpoint.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param handlerName:  The name of the endpoint.\n      * @return: The template customized for the endpoint.\n      */\n-    public static String generateDashboardForEndpoint(String templatePath, String handlerName) {\n+    public static String generateOperationalDashboard(String templatePath, String handlerName) throws IOException {\n         String template = readStandardDashboard(templatePath);\n-        return customizeTemplate(template, handlerName);\n+        template = customizeTemplate(template, handlerName);\n+        JGrafana jgrafana;\n+        jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint operational dashboard\", handlerName));\n+\n+        return jgrafana.serialize();\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates domain specific dashboard from a given dashboard template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param endpoint: The name of the endpoint.\n-     * @param decisions: The decisions in the DMN model.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param endpoint:     The name of the endpoint.\n+     * @param decisions:    The decisions in the DMN model.\n      * @return: The customized template containing also specific panels for the DMN decisions that have been specified in the arguments.\n      */\n-    public static String generateDashboardForDMNEndpoint(String templatePath, String endpoint, List<Decision> decisions) {\n+    public static String generateDomainSpecificDMNDashboard(String templatePath, String endpoint, List<Decision> decisions) throws IOException {\n         String template = readStandardDashboard(templatePath);\n         template = customizeTemplate(template, endpoint);\n \n-        JGrafana jgrafana;\n-        try {\n-            jgrafana = JGrafana.parse(template);\n-        } catch (IOException e) {\n-            logger.warn(\"Could not read the grafana dashboard template.\", e);\n-            return null;\n-        }\n+        JGrafana jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint domain specific dashboard\", endpoint));\n \n         for (Decision decision : decisions) {\n-            String type = decision.getVariable().getTypeRef().getLocalPart();\n-            if (SupportedDecisionTypes.isSupported(type)) {\n+            QName type = decision.getVariable().getTypeRef();\n+            if (type != null && SupportedDecisionTypes.isSupported(type.getLocalPart())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0MzI5Nw=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTIzOTE2OnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0NDo1OVrOGYHpIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoyMDozNlrOGYI0mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NDIyNw==", "bodyText": "I think error fit better", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427944227", "createdAt": "2020-05-20T11:44:59Z", "author": {"login": "danielezonca"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "diffHunk": "@@ -168,16 +171,29 @@ public DecisionContainerGenerator moduleGenerator() {\n         return generatedFiles;\n     }\n \n-    private void generateAndStoreGrafanaDashboard(DMNRestResourceGenerator resourceGenerator) {\n+    private void generateAndStoreGrafanaDashboards(DMNRestResourceGenerator resourceGenerator) {\n         Definitions definitions = resourceGenerator.getDmnModel().getDefinitions();\n         List<Decision> decisions = definitions.getDrgElement().stream().filter(x -> x.getParentDRDElement() instanceof Decision).map(x -> (Decision) x).collect(Collectors.toList());\n \n-        String dashboard = GrafanaConfigurationWriter.generateDashboardForDMNEndpoint(grafanaTemplatePath, resourceGenerator.getNameURL(), decisions);\n+        String operationalDashboard = null;\n+        String domainDashboard = null;\n+\n+        try {\n+            operationalDashboard = GrafanaConfigurationWriter.generateOperationalDashboard(operationalDashboardDmnTemplate, resourceGenerator.getNameURL());\n+            domainDashboard = GrafanaConfigurationWriter.generateDomainSpecificDMNDashboard(domainDashboardDmnTemplate, resourceGenerator.getNameURL(), decisions);\n+        } catch (IOException e) {\n+            logger.warn(\"Could not create the grafana dashboards for the endpoint \" + resourceGenerator.getNameURL(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0ODg2OA==", "bodyText": "Fine, do you think we should also stop the execution? For me if we log it as error, then we should not move forward with the compilation wdyt @danielezonca ?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427948868", "createdAt": "2020-05-20T11:54:06Z", "author": {"login": "r00ta"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "diffHunk": "@@ -168,16 +171,29 @@ public DecisionContainerGenerator moduleGenerator() {\n         return generatedFiles;\n     }\n \n-    private void generateAndStoreGrafanaDashboard(DMNRestResourceGenerator resourceGenerator) {\n+    private void generateAndStoreGrafanaDashboards(DMNRestResourceGenerator resourceGenerator) {\n         Definitions definitions = resourceGenerator.getDmnModel().getDefinitions();\n         List<Decision> decisions = definitions.getDrgElement().stream().filter(x -> x.getParentDRDElement() instanceof Decision).map(x -> (Decision) x).collect(Collectors.toList());\n \n-        String dashboard = GrafanaConfigurationWriter.generateDashboardForDMNEndpoint(grafanaTemplatePath, resourceGenerator.getNameURL(), decisions);\n+        String operationalDashboard = null;\n+        String domainDashboard = null;\n+\n+        try {\n+            operationalDashboard = GrafanaConfigurationWriter.generateOperationalDashboard(operationalDashboardDmnTemplate, resourceGenerator.getNameURL());\n+            domainDashboard = GrafanaConfigurationWriter.generateDomainSpecificDMNDashboard(domainDashboardDmnTemplate, resourceGenerator.getNameURL(), decisions);\n+        } catch (IOException e) {\n+            logger.warn(\"Could not create the grafana dashboards for the endpoint \" + resourceGenerator.getNameURL(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NDIyNw=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk1MDM4NA==", "bodyText": "Will move to a runtime exception btw, so the execution will terminate", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427950384", "createdAt": "2020-05-20T11:57:02Z", "author": {"login": "r00ta"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "diffHunk": "@@ -168,16 +171,29 @@ public DecisionContainerGenerator moduleGenerator() {\n         return generatedFiles;\n     }\n \n-    private void generateAndStoreGrafanaDashboard(DMNRestResourceGenerator resourceGenerator) {\n+    private void generateAndStoreGrafanaDashboards(DMNRestResourceGenerator resourceGenerator) {\n         Definitions definitions = resourceGenerator.getDmnModel().getDefinitions();\n         List<Decision> decisions = definitions.getDrgElement().stream().filter(x -> x.getParentDRDElement() instanceof Decision).map(x -> (Decision) x).collect(Collectors.toList());\n \n-        String dashboard = GrafanaConfigurationWriter.generateDashboardForDMNEndpoint(grafanaTemplatePath, resourceGenerator.getNameURL(), decisions);\n+        String operationalDashboard = null;\n+        String domainDashboard = null;\n+\n+        try {\n+            operationalDashboard = GrafanaConfigurationWriter.generateOperationalDashboard(operationalDashboardDmnTemplate, resourceGenerator.getNameURL());\n+            domainDashboard = GrafanaConfigurationWriter.generateDomainSpecificDMNDashboard(domainDashboardDmnTemplate, resourceGenerator.getNameURL(), decisions);\n+        } catch (IOException e) {\n+            logger.warn(\"Could not create the grafana dashboards for the endpoint \" + resourceGenerator.getNameURL(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NDIyNw=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MzU0Ng==", "bodyText": "I think it is fine to stop the execution for now. If we want to make dashboard generation as optional, we will do in another ticket :)", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427963546", "createdAt": "2020-05-20T12:20:36Z", "author": {"login": "danielezonca"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "diffHunk": "@@ -168,16 +171,29 @@ public DecisionContainerGenerator moduleGenerator() {\n         return generatedFiles;\n     }\n \n-    private void generateAndStoreGrafanaDashboard(DMNRestResourceGenerator resourceGenerator) {\n+    private void generateAndStoreGrafanaDashboards(DMNRestResourceGenerator resourceGenerator) {\n         Definitions definitions = resourceGenerator.getDmnModel().getDefinitions();\n         List<Decision> decisions = definitions.getDrgElement().stream().filter(x -> x.getParentDRDElement() instanceof Decision).map(x -> (Decision) x).collect(Collectors.toList());\n \n-        String dashboard = GrafanaConfigurationWriter.generateDashboardForDMNEndpoint(grafanaTemplatePath, resourceGenerator.getNameURL(), decisions);\n+        String operationalDashboard = null;\n+        String domainDashboard = null;\n+\n+        try {\n+            operationalDashboard = GrafanaConfigurationWriter.generateOperationalDashboard(operationalDashboardDmnTemplate, resourceGenerator.getNameURL());\n+            domainDashboard = GrafanaConfigurationWriter.generateDomainSpecificDMNDashboard(domainDashboardDmnTemplate, resourceGenerator.getNameURL(), decisions);\n+        } catch (IOException e) {\n+            logger.warn(\"Could not create the grafana dashboards for the endpoint \" + resourceGenerator.getNameURL(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NDIyNw=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTI0MDM1OnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0NToyM1rOGYHp1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoxNjozM1rOGYIrgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NDQwNg==", "bodyText": "Can you please format both method invocation in the same way?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427944406", "createdAt": "2020-05-20T11:45:23Z", "author": {"login": "danielezonca"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "diffHunk": "@@ -168,16 +171,29 @@ public DecisionContainerGenerator moduleGenerator() {\n         return generatedFiles;\n     }\n \n-    private void generateAndStoreGrafanaDashboard(DMNRestResourceGenerator resourceGenerator) {\n+    private void generateAndStoreGrafanaDashboards(DMNRestResourceGenerator resourceGenerator) {\n         Definitions definitions = resourceGenerator.getDmnModel().getDefinitions();\n         List<Decision> decisions = definitions.getDrgElement().stream().filter(x -> x.getParentDRDElement() instanceof Decision).map(x -> (Decision) x).collect(Collectors.toList());\n \n-        String dashboard = GrafanaConfigurationWriter.generateDashboardForDMNEndpoint(grafanaTemplatePath, resourceGenerator.getNameURL(), decisions);\n+        String operationalDashboard = null;\n+        String domainDashboard = null;\n+\n+        try {\n+            operationalDashboard = GrafanaConfigurationWriter.generateOperationalDashboard(operationalDashboardDmnTemplate, resourceGenerator.getNameURL());\n+            domainDashboard = GrafanaConfigurationWriter.generateDomainSpecificDMNDashboard(domainDashboardDmnTemplate, resourceGenerator.getNameURL(), decisions);\n+        } catch (IOException e) {\n+            logger.warn(\"Could not create the grafana dashboards for the endpoint \" + resourceGenerator.getNameURL(), e);\n+            return;\n+        }\n+\n+        generatedFiles.add(new org.kie.kogito.codegen.GeneratedFile( org.kie.kogito.codegen.GeneratedFile.Type.RESOURCE,\n+                                                                     \"dashboards/operational-dashboard-\" + resourceGenerator.getNameURL() + \".json\",\n+                                                                     operationalDashboard));\n         generatedFiles.add(\n                 new org.kie.kogito.codegen.GeneratedFile(\n                         org.kie.kogito.codegen.GeneratedFile.Type.RESOURCE,\n-                        \"dashboards/dashboard-endpoint-\" + resourceGenerator.getNameURL() + \".json\",\n-                        dashboard));\n+                        \"dashboards/domain-dashboard-\" + resourceGenerator.getNameURL() + \".json\",\n+                        domainDashboard));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MTIxNw==", "bodyText": "Fixed", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427961217", "createdAt": "2020-05-20T12:16:33Z", "author": {"login": "r00ta"}, "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/DecisionCodegen.java", "diffHunk": "@@ -168,16 +171,29 @@ public DecisionContainerGenerator moduleGenerator() {\n         return generatedFiles;\n     }\n \n-    private void generateAndStoreGrafanaDashboard(DMNRestResourceGenerator resourceGenerator) {\n+    private void generateAndStoreGrafanaDashboards(DMNRestResourceGenerator resourceGenerator) {\n         Definitions definitions = resourceGenerator.getDmnModel().getDefinitions();\n         List<Decision> decisions = definitions.getDrgElement().stream().filter(x -> x.getParentDRDElement() instanceof Decision).map(x -> (Decision) x).collect(Collectors.toList());\n \n-        String dashboard = GrafanaConfigurationWriter.generateDashboardForDMNEndpoint(grafanaTemplatePath, resourceGenerator.getNameURL(), decisions);\n+        String operationalDashboard = null;\n+        String domainDashboard = null;\n+\n+        try {\n+            operationalDashboard = GrafanaConfigurationWriter.generateOperationalDashboard(operationalDashboardDmnTemplate, resourceGenerator.getNameURL());\n+            domainDashboard = GrafanaConfigurationWriter.generateDomainSpecificDMNDashboard(domainDashboardDmnTemplate, resourceGenerator.getNameURL(), decisions);\n+        } catch (IOException e) {\n+            logger.warn(\"Could not create the grafana dashboards for the endpoint \" + resourceGenerator.getNameURL(), e);\n+            return;\n+        }\n+\n+        generatedFiles.add(new org.kie.kogito.codegen.GeneratedFile( org.kie.kogito.codegen.GeneratedFile.Type.RESOURCE,\n+                                                                     \"dashboards/operational-dashboard-\" + resourceGenerator.getNameURL() + \".json\",\n+                                                                     operationalDashboard));\n         generatedFiles.add(\n                 new org.kie.kogito.codegen.GeneratedFile(\n                         org.kie.kogito.codegen.GeneratedFile.Type.RESOURCE,\n-                        \"dashboards/dashboard-endpoint-\" + resourceGenerator.getNameURL() + \".json\",\n-                        dashboard));\n+                        \"dashboards/domain-dashboard-\" + resourceGenerator.getNameURL() + \".json\",\n+                        domainDashboard));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NDQwNg=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTI0OTU0OnYy", "diffSide": "RIGHT", "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0ODoxOFrOGYHvkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoxNzowN1rOGYIsqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NTg3NQ==", "bodyText": "Can you please try-catch the checked exception, log it and propagate a runtime exception?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427945875", "createdAt": "2020-05-20T11:48:18Z", "author": {"login": "danielezonca"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -39,60 +41,52 @@ private GrafanaConfigurationWriter() {\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates an operational grafana dashboard based on a given template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param handlerName: The name of the endpoint.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param handlerName:  The name of the endpoint.\n      * @return: The template customized for the endpoint.\n      */\n-    public static String generateDashboardForEndpoint(String templatePath, String handlerName) {\n+    public static String generateOperationalDashboard(String templatePath, String handlerName) throws IOException {\n         String template = readStandardDashboard(templatePath);\n-        return customizeTemplate(template, handlerName);\n+        template = customizeTemplate(template, handlerName);\n+        JGrafana jgrafana;\n+        jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint operational dashboard\", handlerName));\n+\n+        return jgrafana.serialize();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MTUxMw==", "bodyText": "Done, feel free to close resolve the conversation if you are ok with the new implementation", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427961513", "createdAt": "2020-05-20T12:17:07Z", "author": {"login": "r00ta"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -39,60 +41,52 @@ private GrafanaConfigurationWriter() {\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates an operational grafana dashboard based on a given template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param handlerName: The name of the endpoint.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param handlerName:  The name of the endpoint.\n      * @return: The template customized for the endpoint.\n      */\n-    public static String generateDashboardForEndpoint(String templatePath, String handlerName) {\n+    public static String generateOperationalDashboard(String templatePath, String handlerName) throws IOException {\n         String template = readStandardDashboard(templatePath);\n-        return customizeTemplate(template, handlerName);\n+        template = customizeTemplate(template, handlerName);\n+        JGrafana jgrafana;\n+        jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint operational dashboard\", handlerName));\n+\n+        return jgrafana.serialize();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NTg3NQ=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTI1MjAwOnYy", "diffSide": "RIGHT", "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0OTowOFrOGYHxHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoxNzo1OFrOGYIucw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NjI3MQ==", "bodyText": "Why have you decided to propagate IOException? I prefer the previous code :)", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427946271", "createdAt": "2020-05-20T11:49:08Z", "author": {"login": "danielezonca"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -39,60 +41,52 @@ private GrafanaConfigurationWriter() {\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates an operational grafana dashboard based on a given template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param handlerName: The name of the endpoint.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param handlerName:  The name of the endpoint.\n      * @return: The template customized for the endpoint.\n      */\n-    public static String generateDashboardForEndpoint(String templatePath, String handlerName) {\n+    public static String generateOperationalDashboard(String templatePath, String handlerName) throws IOException {\n         String template = readStandardDashboard(templatePath);\n-        return customizeTemplate(template, handlerName);\n+        template = customizeTemplate(template, handlerName);\n+        JGrafana jgrafana;\n+        jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint operational dashboard\", handlerName));\n+\n+        return jgrafana.serialize();\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates domain specific dashboard from a given dashboard template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param endpoint: The name of the endpoint.\n-     * @param decisions: The decisions in the DMN model.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param endpoint:     The name of the endpoint.\n+     * @param decisions:    The decisions in the DMN model.\n      * @return: The customized template containing also specific panels for the DMN decisions that have been specified in the arguments.\n      */\n-    public static String generateDashboardForDMNEndpoint(String templatePath, String endpoint, List<Decision> decisions) {\n+    public static String generateDomainSpecificDMNDashboard(String templatePath, String endpoint, List<Decision> decisions) throws IOException {\n         String template = readStandardDashboard(templatePath);\n         template = customizeTemplate(template, endpoint);\n \n-        JGrafana jgrafana;\n-        try {\n-            jgrafana = JGrafana.parse(template);\n-        } catch (IOException e) {\n-            logger.warn(\"Could not read the grafana dashboard template.\", e);\n-            return null;\n-        }\n+        JGrafana jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint domain specific dashboard\", endpoint));\n \n         for (Decision decision : decisions) {\n-            String type = decision.getVariable().getTypeRef().getLocalPart();\n-            if (SupportedDecisionTypes.isSupported(type)) {\n+            QName type = decision.getVariable().getTypeRef();\n+            if (type != null && SupportedDecisionTypes.isSupported(type.getLocalPart())) {\n                 jgrafana.addPanel(PanelType.GRAPH,\n                                   \"Decision \" + decision.getName(),\n                                   String.format(\"%s_dmn_result{endpoint = \\\"%s\\\", decision = \\\"%s\\\"}\",\n                                                 type,\n                                                 endpoint,\n                                                 decision.getName()),\n-                                  SupportedDecisionTypes.getGrafanaFunction(type));\n+                                  SupportedDecisionTypes.getGrafanaFunction(type.getLocalPart()));\n             }\n         }\n \n-        try {\n-            return jgrafana.serialize();\n-        } catch (IOException e) {\n-            logger.warn(\"Could not serialize the grafana dashboard template.\", e);\n-            return null;\n-        }\n+        return jgrafana.serialize();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MTk3MQ==", "bodyText": "Done", "url": "https://github.com/kiegroup/kogito-runtimes/pull/516#discussion_r427961971", "createdAt": "2020-05-20T12:17:58Z", "author": {"login": "r00ta"}, "path": "grafana-api/src/main/java/org/kie/kogito/grafana/GrafanaConfigurationWriter.java", "diffHunk": "@@ -39,60 +41,52 @@ private GrafanaConfigurationWriter() {\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates an operational grafana dashboard based on a given template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param handlerName: The name of the endpoint.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param handlerName:  The name of the endpoint.\n      * @return: The template customized for the endpoint.\n      */\n-    public static String generateDashboardForEndpoint(String templatePath, String handlerName) {\n+    public static String generateOperationalDashboard(String templatePath, String handlerName) throws IOException {\n         String template = readStandardDashboard(templatePath);\n-        return customizeTemplate(template, handlerName);\n+        template = customizeTemplate(template, handlerName);\n+        JGrafana jgrafana;\n+        jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint operational dashboard\", handlerName));\n+\n+        return jgrafana.serialize();\n     }\n \n     /**\n-     * Adds a panel of a type to the dashboard.\n+     * Generates domain specific dashboard from a given dashboard template.\n      *\n-     * @param templatePath:  The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n-     * @param endpoint: The name of the endpoint.\n-     * @param decisions: The decisions in the DMN model.\n+     * @param templatePath: The path to the dashboard template. It must be a valid grafana dashboard in JSON format.\n+     * @param endpoint:     The name of the endpoint.\n+     * @param decisions:    The decisions in the DMN model.\n      * @return: The customized template containing also specific panels for the DMN decisions that have been specified in the arguments.\n      */\n-    public static String generateDashboardForDMNEndpoint(String templatePath, String endpoint, List<Decision> decisions) {\n+    public static String generateDomainSpecificDMNDashboard(String templatePath, String endpoint, List<Decision> decisions) throws IOException {\n         String template = readStandardDashboard(templatePath);\n         template = customizeTemplate(template, endpoint);\n \n-        JGrafana jgrafana;\n-        try {\n-            jgrafana = JGrafana.parse(template);\n-        } catch (IOException e) {\n-            logger.warn(\"Could not read the grafana dashboard template.\", e);\n-            return null;\n-        }\n+        JGrafana jgrafana = JGrafana.parse(template).setTitle(String.format(\"%s endpoint domain specific dashboard\", endpoint));\n \n         for (Decision decision : decisions) {\n-            String type = decision.getVariable().getTypeRef().getLocalPart();\n-            if (SupportedDecisionTypes.isSupported(type)) {\n+            QName type = decision.getVariable().getTypeRef();\n+            if (type != null && SupportedDecisionTypes.isSupported(type.getLocalPart())) {\n                 jgrafana.addPanel(PanelType.GRAPH,\n                                   \"Decision \" + decision.getName(),\n                                   String.format(\"%s_dmn_result{endpoint = \\\"%s\\\", decision = \\\"%s\\\"}\",\n                                                 type,\n                                                 endpoint,\n                                                 decision.getName()),\n-                                  SupportedDecisionTypes.getGrafanaFunction(type));\n+                                  SupportedDecisionTypes.getGrafanaFunction(type.getLocalPart()));\n             }\n         }\n \n-        try {\n-            return jgrafana.serialize();\n-        } catch (IOException e) {\n-            logger.warn(\"Could not serialize the grafana dashboard template.\", e);\n-            return null;\n-        }\n+        return jgrafana.serialize();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NjI3MQ=="}, "originalCommit": {"oid": "02058e852e090d3f0ad38d6bac66d740530e30a6"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 119, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}