{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MjgwODUy", "number": 631, "title": "[KOGITO-2736] Removing allowedPhases from ProcessInstance", "bodyText": "Creating as Draft since this requires user and group to be passed in the API (so we should not commit till this information is available at client side", "createdAt": "2020-07-13T14:09:09Z", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631", "merged": true, "mergeCommit": {"oid": "4310eb8c1379482470c101f1bf73b245cb354608"}, "closed": true, "closedAt": "2020-07-23T14:14:29Z", "author": {"login": "fjtirado"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc03ZDKgBqjM1NDQ1ODUzNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3rtKjABqjM1NzkwNjU4MjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25822e0c6598a811ea12258fafbed59ff4f87c05", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/25822e0c6598a811ea12258fafbed59ff4f87c05", "committedDate": "2020-07-13T14:07:31Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "26752e22c82cb327d3f31f05ac1dfdfcc104487d", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/26752e22c82cb327d3f31f05ac1dfdfcc104487d", "committedDate": "2020-07-14T15:02:06Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4ODU1OTA3", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631#pullrequestreview-448855907", "createdAt": "2020-07-15T11:14:39Z", "commit": {"oid": "26752e22c82cb327d3f31f05ac1dfdfcc104487d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNDozOVrOGx5eXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNDozOVrOGx5eXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3NTA3MA==", "bodyText": "right import?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631#discussion_r454975070", "createdAt": "2020-07-15T11:14:39Z", "author": {"login": "cristianonicolai"}, "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -2,6 +2,7 @@\n \n import java.util.List;\n \n+import org.dmg.pmml.Application;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26752e22c82cb327d3f31f05ac1dfdfcc104487d"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26752e22c82cb327d3f31f05ac1dfdfcc104487d", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/26752e22c82cb327d3f31f05ac1dfdfcc104487d", "committedDate": "2020-07-14T15:02:06Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "295af1cc84cac887243cb2e8ed05343e1b9e54ff", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/295af1cc84cac887243cb2e8ed05343e1b9e54ff", "committedDate": "2020-07-15T11:18:03Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5ODg4Mjgw", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631#pullrequestreview-449888280", "createdAt": "2020-07-16T14:12:07Z", "commit": {"oid": "295af1cc84cac887243cb2e8ed05343e1b9e54ff"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNDoxMjowN1rOGys4jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNDoxMjowN1rOGys4jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTgxNzM1Ng==", "bodyText": "wishlist for the future: I'd like it better to have two different interfaces, one with this method, the other without.\n\nWorkItemHandler\nCustomPhaseWorkItemHandler extends WorkItemHandler\n\nor something along those lines", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631#discussion_r455817356", "createdAt": "2020-07-16T14:12:07Z", "author": {"login": "evacchi"}, "path": "api/kogito-api/src/main/java/org/kie/api/runtime/process/WorkItemHandler.java", "diffHunk": "@@ -81,7 +81,7 @@ default void transitionToPhase(WorkItem workItem, WorkItemManager manager, Trans\n         throw new UnsupportedOperationException();\n     }\n \n-    default Set<String> allowedPhases(WorkItem workItem) {\n+    default Set<String> allowedPhases(String phaseId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "295af1cc84cac887243cb2e8ed05343e1b9e54ff"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "295af1cc84cac887243cb2e8ed05343e1b9e54ff", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/295af1cc84cac887243cb2e8ed05343e1b9e54ff", "committedDate": "2020-07-15T11:18:03Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "debf8e8c3cc4902a32c74ab9c77a6a05bca4c43d", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/debf8e8c3cc4902a32c74ab9c77a6a05bca4c43d", "committedDate": "2020-07-20T15:42:06Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "debf8e8c3cc4902a32c74ab9c77a6a05bca4c43d", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/debf8e8c3cc4902a32c74ab9c77a6a05bca4c43d", "committedDate": "2020-07-20T15:42:06Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "16945de751525fbf11bb7b07da2be4b82594d7d1", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/16945de751525fbf11bb7b07da2be4b82594d7d1", "committedDate": "2020-07-20T16:03:57Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16945de751525fbf11bb7b07da2be4b82594d7d1", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/16945de751525fbf11bb7b07da2be4b82594d7d1", "committedDate": "2020-07-20T16:03:57Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "6183b8e7e03fb8be3c686c2b92d9582bc9200ed2", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6183b8e7e03fb8be3c686c2b92d9582bc9200ed2", "committedDate": "2020-07-20T16:13:04Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6183b8e7e03fb8be3c686c2b92d9582bc9200ed2", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6183b8e7e03fb8be3c686c2b92d9582bc9200ed2", "committedDate": "2020-07-20T16:13:04Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "6d246efaa28f907bfa6fafdf889446a6db392e9c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6d246efaa28f907bfa6fafdf889446a6db392e9c", "committedDate": "2020-07-20T16:49:37Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d246efaa28f907bfa6fafdf889446a6db392e9c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6d246efaa28f907bfa6fafdf889446a6db392e9c", "committedDate": "2020-07-20T16:49:37Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "6423356b51947f67d2e3a3d681b3961203a59ad4", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6423356b51947f67d2e3a3d681b3961203a59ad4", "committedDate": "2020-07-20T16:52:02Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6423356b51947f67d2e3a3d681b3961203a59ad4", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/6423356b51947f67d2e3a3d681b3961203a59ad4", "committedDate": "2020-07-20T16:52:02Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "8e18b2c3dfe9641116d8a5fd2f240c74ef0da549", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/8e18b2c3dfe9641116d8a5fd2f240c74ef0da549", "committedDate": "2020-07-21T12:22:25Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDc0Mzk5", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631#pullrequestreview-453474399", "createdAt": "2020-07-22T16:16:18Z", "commit": {"oid": "8e18b2c3dfe9641116d8a5fd2f240c74ef0da549"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNjoxOFrOG1p3SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNzo1NVrOG1p7UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxMzYwOQ==", "bodyText": "please review code style, its missing spaces between vars, see https://github.com/kiegroup/droolsjbpm-build-bootstrap/tree/master/ide-configuration", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631#discussion_r458913609", "createdAt": "2020-07-22T16:16:18Z", "author": {"login": "cristianonicolai"}, "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -86,10 +87,8 @@\n     @GET()\n     @Path(\"/{id}/$taskName$/{workItemId}/schema\")\n     @Produces(MediaType.APPLICATION_JSON)\n-    public Map<String,Object> getSchemaAndPhases(@PathParam(\"id\") final String id, @PathParam(\"workItemId\") final String workItemId) {\n-        Map<String,Object> jsonSchema = JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n-        process.instances().findById(id).ifPresent(pi ->jsonSchema.put(\"phases\",pi.allowedPhases(workItemId)));\n-        return jsonSchema;\n+    public Map<String,Object> getSchemaAndPhases(@PathParam(\"id\") final String id, @PathParam(\"workItemId\") final String workItemId , @QueryParam(\"user\") final String user, @QueryParam(\"group\") final List<String> groups) {\n+        return JsonSchemaUtil.addPhases(process,application,id,workItemId, policies(user,groups),JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e18b2c3dfe9641116d8a5fd2f240c74ef0da549"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNDY0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Mockito.when(process.instances()).thenReturn(processInstances);\n          \n          \n            \n                    when(process.instances()).thenReturn(processInstances);", "url": "https://github.com/kiegroup/kogito-runtimes/pull/631#discussion_r458914640", "createdAt": "2020-07-22T16:17:55Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java", "diffHunk": "@@ -67,4 +82,30 @@ void testJsonSchema() throws IOException {\n         assertTrue((Boolean)((Map)properties.get(\"approved\")).get(\"output\"));\n         assertTrue((Boolean)((Map)properties.get(\"traveller\")).get(\"input\"));\n     }\n+\n+    @Test\n+    <T> void testJsonSchemaPhases() throws IOException {\n+        InputStream in = new ByteArrayInputStream(example.getBytes());\n+        Policy<T>[] policies = new Policy[0];\n+        Map<String, Object> schemaMap = JsonSchemaUtil.load(in);\n+        Process<T> process = Mockito.mock(Process.class);\n+        ProcessInstances<T> processInstances = Mockito.mock(ProcessInstances.class);\n+        Mockito.when(process.instances()).thenReturn(processInstances);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e18b2c3dfe9641116d8a5fd2f240c74ef0da549"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e18b2c3dfe9641116d8a5fd2f240c74ef0da549", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/8e18b2c3dfe9641116d8a5fd2f240c74ef0da549", "committedDate": "2020-07-21T12:22:25Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "f43b1c70d4ce9235f54aa8920cbfbc35c641741f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/f43b1c70d4ce9235f54aa8920cbfbc35c641741f", "committedDate": "2020-07-22T17:56:14Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "007ceffc3866a0c614a5ec24a3bb178b259913f0", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/007ceffc3866a0c614a5ec24a3bb178b259913f0", "committedDate": "2020-07-23T09:06:58Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f43b1c70d4ce9235f54aa8920cbfbc35c641741f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/f43b1c70d4ce9235f54aa8920cbfbc35c641741f", "committedDate": "2020-07-22T17:56:14Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}, "afterCommit": {"oid": "007ceffc3866a0c614a5ec24a3bb178b259913f0", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/kogito-runtimes/commit/007ceffc3866a0c614a5ec24a3bb178b259913f0", "committedDate": "2020-07-23T09:06:58Z", "message": "[KOGITO-2736] Removing allowedPhases from ProcessInstance"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4245, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}