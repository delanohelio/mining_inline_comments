{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMTIyNDIw", "number": 723, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzowNTozM1rOEcDzrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzo0NDo0MlrOEeqJNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODU3OTY2OnYy", "diffSide": "LEFT", "path": "api/kogito-services/src/main/java/org/kie/kogito/services/event/AbstractProcessDataEvent.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzowNTozM1rOHGXI9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMDowN1rOHKbvOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzMjYyOQ==", "bodyText": "Removing this won't affect JSON unmarshal/marshal in runtime?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r476432629", "createdAt": "2020-08-25T13:05:33Z", "author": {"login": "ricardozanini"}, "path": "api/kogito-services/src/main/java/org/kie/kogito/services/event/AbstractProcessDataEvent.java", "diffHunk": "@@ -78,7 +107,11 @@ public String getKogitoReferenceId() {\n         return this.kogitoReferenceId;\n     }\n \n-    public void setKogitoReferenceId(String kogitoReferenceId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5f257ffb14952389de0e5588bd5f318fb7c7f9b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ1OTU3Ng==", "bodyText": "A getter makes a non public field serializable/deserializble by jackson\nhttps://www.baeldung.com/jackson-field-serializable-deserializable-or-not", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r476459576", "createdAt": "2020-08-25T13:44:42Z", "author": {"login": "fjtirado"}, "path": "api/kogito-services/src/main/java/org/kie/kogito/services/event/AbstractProcessDataEvent.java", "diffHunk": "@@ -78,7 +107,11 @@ public String getKogitoReferenceId() {\n         return this.kogitoReferenceId;\n     }\n \n-    public void setKogitoReferenceId(String kogitoReferenceId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzMjYyOQ=="}, "originalCommit": {"oid": "b5f257ffb14952389de0e5588bd5f318fb7c7f9b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcwMjI2Nw==", "bodyText": "@fjtirado so why add setKogitoStartFromNode then? shouldnt we keep consistency?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480702267", "createdAt": "2020-09-01T03:30:07Z", "author": {"login": "cristianonicolai"}, "path": "api/kogito-services/src/main/java/org/kie/kogito/services/event/AbstractProcessDataEvent.java", "diffHunk": "@@ -78,7 +107,11 @@ public String getKogitoReferenceId() {\n         return this.kogitoReferenceId;\n     }\n \n-    public void setKogitoReferenceId(String kogitoReferenceId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzMjYyOQ=="}, "originalCommit": {"oid": "b5f257ffb14952389de0e5588bd5f318fb7c7f9b"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjUwOTYyOnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/resources/class-templates/events/CloudEventsMessageProducerTemplate.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTowNjoyNlrOHIhQ4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTowNjoyNlrOHIhQ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5NTY1MA==", "bodyText": "Is this a typo? \ud83e\udd14", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r478695650", "createdAt": "2020-08-27T21:06:26Z", "author": {"login": "ricardozanini"}, "path": "kogito-codegen/src/main/resources/class-templates/events/CloudEventsMessageProducerTemplate.java", "diffHunk": "@@ -38,33 +32,18 @@ public void produce(ProcessInstance pi, $Type$ eventData) {\n         } else {\n         }\n     }\n-\n+    \n+\u00a1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2744cdfb4b10c0997cdaff2e6a1b06265ac4690f"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTczMTE1OnYy", "diffSide": "RIGHT", "path": "integration-tests/integration-tests-quarkus/src/main/java/org/acme/travels/Traveller.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMToyN1rOHKb10Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODo0Njo1M1rOHN2Zww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcwMzk1Mw==", "bodyText": "please review code formatting in this class", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480703953", "createdAt": "2020-09-01T03:31:27Z", "author": {"login": "cristianonicolai"}, "path": "integration-tests/integration-tests-quarkus/src/main/java/org/acme/travels/Traveller.java", "diffHunk": "@@ -21,21 +21,24 @@\n \tprivate String lastName;\n \tprivate String email;\n \tprivate String nationality;\n-\tprivate Address address;\n+    private Address address;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4NDg2Nw==", "bodyText": "I did not want to introduce noise in the review by formatting the whole class, but if it is ok, lets go ahead", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r484284867", "createdAt": "2020-09-07T08:46:53Z", "author": {"login": "fjtirado"}, "path": "integration-tests/integration-tests-quarkus/src/main/java/org/acme/travels/Traveller.java", "diffHunk": "@@ -21,21 +21,24 @@\n \tprivate String lastName;\n \tprivate String email;\n \tprivate String nationality;\n-\tprivate Address address;\n+    private Address address;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcwMzk1Mw=="}, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTczOTE2OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMjoyNFrOHKb7YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMjoyNFrOHKb7YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcwNTM3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public CloudEventConsumer(Function<D, M> function,\n          \n          \n            \n                                          Class<T> cloudEventClass) {\n          \n          \n            \n                public CloudEventConsumer(Function<D, M> function, Class<T> cloudEventClass) {", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480705377", "createdAt": "2020-09-01T03:32:24Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.Application;\n+import org.kie.kogito.Model;\n+import org.kie.kogito.process.Process;\n+import org.kie.kogito.process.ProcessInstance;\n+import org.kie.kogito.process.impl.Sig;\n+import org.kie.kogito.services.event.AbstractProcessDataEvent;\n+import org.kie.kogito.services.event.EventConsumer;\n+import org.kie.kogito.services.uow.UnitOfWorkExecutor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class CloudEventConsumer<D, M extends Model, T extends AbstractProcessDataEvent<D>>\n+                               implements EventConsumer<M> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(CloudEventConsumer.class);\n+\n+    private Function<D, M> function;\n+    private Class<T> cloudEventClass;\n+\n+    public CloudEventConsumer(Function<D, M> function,\n+                              Class<T> cloudEventClass) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTc0MTE0OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMjozN1rOHKb8vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMjozN1rOHKb8vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcwNTcyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void\n          \n          \n            \n                    consume(Application application, Process<M> process, String payload, String trigger) {\n          \n          \n            \n                public void consume(Application application, Process<M> process, String payload, String trigger) {", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480705726", "createdAt": "2020-09-01T03:32:37Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.Application;\n+import org.kie.kogito.Model;\n+import org.kie.kogito.process.Process;\n+import org.kie.kogito.process.ProcessInstance;\n+import org.kie.kogito.process.impl.Sig;\n+import org.kie.kogito.services.event.AbstractProcessDataEvent;\n+import org.kie.kogito.services.event.EventConsumer;\n+import org.kie.kogito.services.uow.UnitOfWorkExecutor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class CloudEventConsumer<D, M extends Model, T extends AbstractProcessDataEvent<D>>\n+                               implements EventConsumer<M> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(CloudEventConsumer.class);\n+\n+    private Function<D, M> function;\n+    private Class<T> cloudEventClass;\n+\n+    public CloudEventConsumer(Function<D, M> function,\n+                              Class<T> cloudEventClass) {\n+        this.function = function;\n+        this.cloudEventClass = cloudEventClass;\n+    }\n+\n+    @Override\n+    public void\n+        consume(Application application, Process<M> process, String payload, String trigger) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTc0OTMzOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMzo0M1rOHKcCog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozMzo0M1rOHKcCog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcwNzIzNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                logger\n          \n          \n            \n                                    .debug(\n          \n          \n            \n                                        \"Received message without reference id, staring new process instance with trigger '{}'\",\n          \n          \n            \n                                        trigger);\n          \n          \n            \n                                logger.debug(\"Received message without reference id, staring new process instance with trigger '{}'\",\n          \n          \n            \n                                                     trigger);", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480707234", "createdAt": "2020-09-01T03:33:43Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.Application;\n+import org.kie.kogito.Model;\n+import org.kie.kogito.process.Process;\n+import org.kie.kogito.process.ProcessInstance;\n+import org.kie.kogito.process.impl.Sig;\n+import org.kie.kogito.services.event.AbstractProcessDataEvent;\n+import org.kie.kogito.services.event.EventConsumer;\n+import org.kie.kogito.services.uow.UnitOfWorkExecutor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class CloudEventConsumer<D, M extends Model, T extends AbstractProcessDataEvent<D>>\n+                               implements EventConsumer<M> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(CloudEventConsumer.class);\n+\n+    private Function<D, M> function;\n+    private Class<T> cloudEventClass;\n+\n+    public CloudEventConsumer(Function<D, M> function,\n+                              Class<T> cloudEventClass) {\n+        this.function = function;\n+        this.cloudEventClass = cloudEventClass;\n+    }\n+\n+    @Override\n+    public void\n+        consume(Application application, Process<M> process, String payload, String trigger) {\n+        try {\n+            T cloudEvent = EventUtils.readEvent(payload, cloudEventClass);\n+            M model = function.apply(cloudEvent.getData());\n+            UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n+                if (cloudEvent.getKogitoReferenceId() != null) {\n+                    logger\n+                        .debug(\n+                            \"Received message with reference id '{}' going to use it to send signal '{}'\",\n+                            cloudEvent.getKogitoReferenceId(),\n+                            trigger);\n+                    process\n+                        .instances()\n+                        .findById(cloudEvent.getKogitoReferenceId())\n+                        .ifPresent(\n+                            pi -> pi\n+                                .send(\n+                                    Sig\n+                                        .of(\n+                                            \"Message-\" + trigger,\n+                                            cloudEvent.getData(),\n+                                            cloudEvent.getKogitoProcessinstanceId())));\n+                } else {\n+                    logger\n+                        .debug(\n+                            \"Received message without reference id, staring new process instance with trigger '{}'\",\n+                            trigger);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTc2NTI5OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozNTo0NVrOHKcNxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozNTo0NVrOHKcNxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcxMDA4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                ProcessInstance<M> pi =\n          \n          \n            \n                                        process.createInstance(model);\n          \n          \n            \n                                ProcessInstance<M> pi = process.createInstance(model);", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480710084", "createdAt": "2020-09-01T03:35:45Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/CloudEventConsumer.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.Application;\n+import org.kie.kogito.Model;\n+import org.kie.kogito.process.Process;\n+import org.kie.kogito.process.ProcessInstance;\n+import org.kie.kogito.process.impl.Sig;\n+import org.kie.kogito.services.event.AbstractProcessDataEvent;\n+import org.kie.kogito.services.event.EventConsumer;\n+import org.kie.kogito.services.uow.UnitOfWorkExecutor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class CloudEventConsumer<D, M extends Model, T extends AbstractProcessDataEvent<D>>\n+                               implements EventConsumer<M> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(CloudEventConsumer.class);\n+\n+    private Function<D, M> function;\n+    private Class<T> cloudEventClass;\n+\n+    public CloudEventConsumer(Function<D, M> function,\n+                              Class<T> cloudEventClass) {\n+        this.function = function;\n+        this.cloudEventClass = cloudEventClass;\n+    }\n+\n+    @Override\n+    public void\n+        consume(Application application, Process<M> process, String payload, String trigger) {\n+        try {\n+            T cloudEvent = EventUtils.readEvent(payload, cloudEventClass);\n+            M model = function.apply(cloudEvent.getData());\n+            UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n+                if (cloudEvent.getKogitoReferenceId() != null) {\n+                    logger\n+                        .debug(\n+                            \"Received message with reference id '{}' going to use it to send signal '{}'\",\n+                            cloudEvent.getKogitoReferenceId(),\n+                            trigger);\n+                    process\n+                        .instances()\n+                        .findById(cloudEvent.getKogitoReferenceId())\n+                        .ifPresent(\n+                            pi -> pi\n+                                .send(\n+                                    Sig\n+                                        .of(\n+                                            \"Message-\" + trigger,\n+                                            cloudEvent.getData(),\n+                                            cloudEvent.getKogitoProcessinstanceId())));\n+                } else {\n+                    logger\n+                        .debug(\n+                            \"Received message without reference id, staring new process instance with trigger '{}'\",\n+                            trigger);\n+                    ProcessInstance<M> pi =\n+                            process.createInstance(model);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTc2OTkyOnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/DataEventConsumer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozNjoyMFrOHKcQ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozNjoyMFrOHKcQ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcxMDg5Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public DataEventConsumer(Function<D, M> function,\n          \n          \n            \n                                         Class<D> dataEventClass) {\n          \n          \n            \n                public DataEventConsumer(Function<D, M> function, Class<D> dataEventClass) {", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480710892", "createdAt": "2020-09-01T03:36:20Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/DataEventConsumer.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.Application;\n+import org.kie.kogito.Model;\n+import org.kie.kogito.process.Process;\n+import org.kie.kogito.process.ProcessInstance;\n+import org.kie.kogito.services.event.EventConsumer;\n+import org.kie.kogito.services.uow.UnitOfWorkExecutor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class DataEventConsumer<M extends Model, D> implements EventConsumer<M> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(DataEventConsumer.class);\n+\n+    private Function<D, M> function;\n+    private Class<D> dataEventClass;\n+\n+    public DataEventConsumer(Function<D, M> function,\n+                             Class<D> dataEventClass) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTc3MzA1OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/DataEventConsumer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozNjo0NVrOHKcTBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozNjo0NVrOHKcTBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcxMTQzMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            logger\n          \n          \n            \n                                .debug(\n          \n          \n            \n                            logger .debug(", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480711431", "createdAt": "2020-09-01T03:36:45Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/DataEventConsumer.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.Application;\n+import org.kie.kogito.Model;\n+import org.kie.kogito.process.Process;\n+import org.kie.kogito.process.ProcessInstance;\n+import org.kie.kogito.services.event.EventConsumer;\n+import org.kie.kogito.services.uow.UnitOfWorkExecutor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class DataEventConsumer<M extends Model, D> implements EventConsumer<M> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(DataEventConsumer.class);\n+\n+    private Function<D, M> function;\n+    private Class<D> dataEventClass;\n+\n+    public DataEventConsumer(Function<D, M> function,\n+                             Class<D> dataEventClass) {\n+        this.function = function;\n+        this.dataEventClass = dataEventClass;\n+    }\n+\n+    @Override\n+    public void consume(Application application, Process<M> process, String payload, String trigger) {\n+        try {\n+            D eventData = EventUtils.readEvent(payload, dataEventClass);\n+            M model = function.apply(eventData);\n+            UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n+                logger\n+                    .debug(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTc4MDY1OnYy", "diffSide": "RIGHT", "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/DefaultEventMarshaller.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzozNzo0NVrOHKcYMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODo0NTowMFrOHN2Vag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcxMjc1Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public <T, P extends AbstractProcessDataEvent<T>> String\n          \n          \n            \n                    marshall(T dataEvent, Function<T, P> cloudFunction, Optional<Boolean> isCloudEvent) {\n          \n          \n            \n                public <T, P extends AbstractProcessDataEvent<T>> String marshall(T dataEvent, Function<T, P> cloudFunction, Optional<Boolean> isCloudEvent) {", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480712752", "createdAt": "2020-09-01T03:37:45Z", "author": {"login": "cristianonicolai"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/DefaultEventMarshaller.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.Optional;\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.services.event.AbstractProcessDataEvent;\n+import org.kie.kogito.services.event.EventMarshaller;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+public class DefaultEventMarshaller implements EventMarshaller {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(DefaultEventMarshaller.class);\n+\n+    @Override\n+    public <T, P extends AbstractProcessDataEvent<T>> String\n+        marshall(T dataEvent, Function<T, P> cloudFunction, Optional<Boolean> isCloudEvent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4Mzc1NA==", "bodyText": "Formatter changed to do not wrap method declaration", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r484283754", "createdAt": "2020-09-07T08:45:00Z", "author": {"login": "fjtirado"}, "path": "jbpm/jbpm-flow/src/main/java/org/kie/kogito/event/impl/DefaultEventMarshaller.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.event.impl;\n+\n+import java.util.Optional;\n+import java.util.function.Function;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import org.kie.kogito.services.event.AbstractProcessDataEvent;\n+import org.kie.kogito.services.event.EventMarshaller;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+public class DefaultEventMarshaller implements EventMarshaller {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(DefaultEventMarshaller.class);\n+\n+    @Override\n+    public <T, P extends AbstractProcessDataEvent<T>> String\n+        marshall(T dataEvent, Function<T, P> cloudFunction, Optional<Boolean> isCloudEvent) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcxMjc1Mg=="}, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNTgzMjIwOnYy", "diffSide": "RIGHT", "path": "kogito-codegen/src/main/resources/class-templates/MessageProducerTemplate.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMzo0NDo0MlrOHKc83A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjoxOTozNlrOHN9QmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcyMjE0MA==", "bodyText": "@fjtirado this is resolved at compile time right, so why dont we inject a DefaultEventMarshaller or CloudEventMarshaller depending on that so we dont need to check at runtime? Instead we would have to concrete classes. Wouldnt that make things easier in the code we have to maintain?", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r480722140", "createdAt": "2020-09-01T03:44:42Z", "author": {"login": "cristianonicolai"}, "path": "kogito-codegen/src/main/resources/class-templates/MessageProducerTemplate.java", "diffHunk": "@@ -1,29 +1,21 @@\n package com.myspace.demo;\n \n \n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.fasterxml.jackson.databind.util.StdDateFormat;\n-import org.kie.api.runtime.process.ProcessInstance;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n \n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.kogito.services.event.EventMarshaller;\n+import org.kie.kogito.event.impl.DefaultEventMarshaller;\n import java.util.Optional;\n-import java.util.TimeZone;\n \n public class MessageProducer {\n \n     Object emitter;\n \n     Optional<Boolean> useCloudEvents = Optional.of(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMwMjUzNQ==", "bodyText": "Im afraid this is not resolved at compilation time (I agree that it will be far easier if it was)\nSee generated code\n@org.eclipse.microprofile.config.inject.ConfigProperty(name = \"kogito.messaging.as-cloudevents\")\nthis is decided by configuration at runtime", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r484302535", "createdAt": "2020-09-07T09:16:04Z", "author": {"login": "fjtirado"}, "path": "kogito-codegen/src/main/resources/class-templates/MessageProducerTemplate.java", "diffHunk": "@@ -1,29 +1,21 @@\n package com.myspace.demo;\n \n \n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.fasterxml.jackson.databind.util.StdDateFormat;\n-import org.kie.api.runtime.process.ProcessInstance;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n \n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.kogito.services.event.EventMarshaller;\n+import org.kie.kogito.event.impl.DefaultEventMarshaller;\n import java.util.Optional;\n-import java.util.TimeZone;\n \n public class MessageProducer {\n \n     Object emitter;\n \n     Optional<Boolean> useCloudEvents = Optional.of(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcyMjE0MA=="}, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM5NzIwOQ==", "bodyText": "yep, you're right. Although I feel that is something that could be defined at compile time, but that's another story.", "url": "https://github.com/kiegroup/kogito-runtimes/pull/723#discussion_r484397209", "createdAt": "2020-09-07T12:19:36Z", "author": {"login": "cristianonicolai"}, "path": "kogito-codegen/src/main/resources/class-templates/MessageProducerTemplate.java", "diffHunk": "@@ -1,29 +1,21 @@\n package com.myspace.demo;\n \n \n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.fasterxml.jackson.databind.util.StdDateFormat;\n-import org.kie.api.runtime.process.ProcessInstance;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n \n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.kogito.services.event.EventMarshaller;\n+import org.kie.kogito.event.impl.DefaultEventMarshaller;\n import java.util.Optional;\n-import java.util.TimeZone;\n \n public class MessageProducer {\n \n     Object emitter;\n \n     Optional<Boolean> useCloudEvents = Optional.of(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDcyMjE0MA=="}, "originalCommit": {"oid": "a5d98c05a6d42ea103fdd1813a5c2140d4cce8d5"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4957, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}