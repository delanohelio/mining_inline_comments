{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MTQyMTA4", "number": 809, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjowODowOVrOE3ByJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjowOTowMFrOE3Byog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MTM2MzU3OnYy", "diffSide": "RIGHT", "path": "sql/src/main/java/com/vmware/ddlog/translator/TranslationVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjowODowOVrOHwI56A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjowODowOVrOHwI56A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIzOTU5Mg==", "bodyText": "Use braces just to be sure?", "url": "https://github.com/vmware/differential-datalog/pull/809#discussion_r520239592", "createdAt": "2020-11-10T02:08:09Z", "author": {"login": "lalithsuresh"}, "path": "sql/src/main/java/com/vmware/ddlog/translator/TranslationVisitor.java", "diffHunk": "@@ -73,15 +73,25 @@ protected DDlogIRNode visitCreateTable(CreateTable node, TranslationContext cont\n \n         List<TableElement> elements = node.getElements();\n         List<DDlogField> fields = new ArrayList<DDlogField>();\n+        List<DDlogField> keyColumns = new ArrayList<DDlogField>();\n         for (TableElement te: elements) {\n-            DDlogIRNode field = this.process(te, context);\n-            fields.add(field.to(DDlogField.class));\n+            DDlogIRNode f = this.process(te, context);\n+            DDlogField field = f.to(DDlogField.class);\n+            fields.add(field);\n+            if (te instanceof ColumnDefinition) {\n+                ColumnDefinition cd = (ColumnDefinition)te;\n+                if (Linq.any(cd.getProperties(), p -> p.getName().getValue().equals(\"primary_key\")))\n+                    keyColumns.add(field);\n+            }\n         }\n         DDlogTUser tuser = context.createStruct(node, fields, name);\n         String relName = DDlogRelationDeclaration.relationName(name);\n         context.reserveGlobalName(relName);\n         DDlogRelationDeclaration rel = new DDlogRelationDeclaration(\n                 node, DDlogRelationDeclaration.Role.Input, relName, tuser);\n+        if (keyColumns.size() > 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3581ab5a9d5aa62006c5d279e514652deaaca95d"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MTM2NDgyOnYy", "diffSide": "RIGHT", "path": "sql/src/test/java/ddlog/WeaveTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjowOTowMFrOHwI6wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODo1MjoxOVrOHwq1kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIzOTgwOQ==", "bodyText": "Can you also test for multiple primary keys in the same table (compound key)?", "url": "https://github.com/vmware/differential-datalog/pull/809#discussion_r520239809", "createdAt": "2020-11-10T02:09:00Z", "author": {"login": "lalithsuresh"}, "path": "sql/src/test/java/ddlog/WeaveTest.java", "diffHunk": "@@ -12,7 +12,7 @@ public void testWeave() {\n         Translator t = new Translator(null);\n         String node_info = \"create table node_info\\n\" +\n                 \"(\\n\" +\n-                \"  name varchar(36) not null /*primary key*/,\\n\" +\n+                \"  name varchar(36) not null with (primary_key = true),\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3581ab5a9d5aa62006c5d279e514652deaaca95d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc5NTUzOA==", "bodyText": "See keyTest", "url": "https://github.com/vmware/differential-datalog/pull/809#discussion_r520795538", "createdAt": "2020-11-10T18:52:19Z", "author": {"login": "mbudiu-vmw"}, "path": "sql/src/test/java/ddlog/WeaveTest.java", "diffHunk": "@@ -12,7 +12,7 @@ public void testWeave() {\n         Translator t = new Translator(null);\n         String node_info = \"create table node_info\\n\" +\n                 \"(\\n\" +\n-                \"  name varchar(36) not null /*primary key*/,\\n\" +\n+                \"  name varchar(36) not null with (primary_key = true),\\n\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIzOTgwOQ=="}, "originalCommit": {"oid": "3581ab5a9d5aa62006c5d279e514652deaaca95d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4656, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}