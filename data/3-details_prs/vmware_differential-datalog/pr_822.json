{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MTk2MTAy", "number": 822, "title": "Add checked conversions to DDValue", "bodyText": "Refactored ddval.rs\nRemoved the decl_ddval_convert!() macro and replaced it with a blanket implementation of DDValConvert\nAdded the type_id function to get a DDValue's TypeId (This is used for checking the types of DDValues)\nMade eq, cmp and partial_cmp in DDValMethods unsafe functions since they're UB if applied to DDVals of different types\nAdded the ability to inspect values during apply_updates()\nAdded the type_id() function to Relations\nUse the inspect function + Relations::type_id() to check that the proper values are being inserted in ddlog updates", "createdAt": "2020-11-21T22:07:25Z", "url": "https://github.com/vmware/differential-datalog/pull/822", "merged": true, "mergeCommit": {"oid": "57bfa093829f3360719d9eb3c07d320939e1ab35"}, "closed": true, "closedAt": "2020-11-28T09:12:40Z", "author": {"login": "Kixiron"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdezbL8gFqTUzNjAxMjIwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgrlDUABqjQwNDY5OTQ4MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDEyMjA0", "url": "https://github.com/vmware/differential-datalog/pull/822#pullrequestreview-536012204", "createdAt": "2020-11-21T22:09:49Z", "commit": {"oid": "59497282e0b6d381a463df6224af6fe1f2346a54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMjowOTo0OVrOH3xvLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMjowOTo0OVrOH3xvLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0ODYyMA==", "bodyText": "I couldn't figure out how to totally remove the ($+$ \"\"), so help there would be appreciated", "url": "https://github.com/vmware/differential-datalog/pull/822#discussion_r528248620", "createdAt": "2020-11-21T22:09:49Z", "author": {"login": "Kixiron"}, "path": "src/Language/DifferentialDatalog/Compile.hs", "diffHunk": "@@ -610,7 +612,7 @@ compileLib d specname modules rs_code = (typeLib, mainLib)\n     -- Add 'DDValConvert' impls to 'types' crate.\n     -- Since multiple DDlog types can map to the same Rust type, we convert\n     -- types to Rust and fold over the resulting set.\n-    typeLib = S.foldl (\\libs t -> M.adjust ($+$ \"::differential_datalog::decl_ddval_convert!{\" <> pp t <> \"}\") mainModuleName libs) typeLibAllFuncs\n+    typeLib = S.foldl (\\libs _ -> M.adjust ($+$ \"\") mainModuleName libs) typeLibAllFuncs\n                       $ S.map (render . mkType d True) $ S.filter (typeNeedsDDValConvert d) $ cTypes cstate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59497282e0b6d381a463df6224af6fe1f2346a54"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcb1e38594ca9f9633922f859ea21d018d16c009", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/fcb1e38594ca9f9633922f859ea21d018d16c009", "committedDate": "2020-11-26T16:14:31Z", "message": "Broke ddval.rs into modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c60c6421800539833375328d2f9b9c12b403c6", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/f0c60c6421800539833375328d2f9b9c12b403c6", "committedDate": "2020-11-26T16:14:31Z", "message": "Refactored the decl_ddval_convert! macro"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c4ccfb5c20ac1a8acbf4485a736ca38adf915df", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/8c4ccfb5c20ac1a8acbf4485a736ca38adf915df", "committedDate": "2020-11-26T16:14:31Z", "message": "Added the type_id function to the DDValue vtable and added checks to methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2797d1e4077b1c08182b3462af26f712f994504", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/d2797d1e4077b1c08182b3462af26f712f994504", "committedDate": "2020-11-26T16:14:31Z", "message": "Added tests for DDValue conversions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17ba42d44b0ec35e1a1ecb5228e5fbb0dff5f4da", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/17ba42d44b0ec35e1a1ecb5228e5fbb0dff5f4da", "committedDate": "2020-11-26T16:14:31Z", "message": "Fixed some safety stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b62a96e1092948bee5f70a7d2d88982b225a19d9", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/b62a96e1092948bee5f70a7d2d88982b225a19d9", "committedDate": "2020-11-26T16:14:31Z", "message": "Generate Relations->TypeId match and check updates are the correct type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d6f26e4e5387af4c1b46efe7abff6947bbd0d0d", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/2d6f26e4e5387af4c1b46efe7abff6947bbd0d0d", "committedDate": "2020-11-26T16:14:31Z", "message": "Blanket implementation of DDValConvert and removed ddval convert macro"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fa87289acd36f7fa0645394505399fb36ce3ba9", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/5fa87289acd36f7fa0645394505399fb36ce3ba9", "committedDate": "2020-11-26T18:47:22Z", "message": "Use HDDlog method in OVSDB API.\n\n`ovsdb_api.rs` used to call the low-level differential_datalog API directly\ninstead of going through high-level `trait DDlog` API."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44eaf05b5606510280d374e66746b8aa7f4a013a", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/44eaf05b5606510280d374e66746b8aa7f4a013a", "committedDate": "2020-11-26T21:29:44Z", "message": "Make Closure and Group implement `Send + Sync`.\n\nThe blanket impl of DDValConvert requires the type to implement `Send`\nand `Sync`.  Make sure that `Closure` and `Group` types satisfy these\ntype bounds."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb281731323411761bff285e8f9b6c33877e76cb", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/fb281731323411761bff285e8f9b6c33877e76cb", "committedDate": "2020-11-27T00:30:35Z", "message": "Improved error messages in `HDDlog::apply_updates`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0e7948aba6f0275851ba239fa89143015949c0d", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/b0e7948aba6f0275851ba239fa89143015949c0d", "committedDate": "2020-11-27T18:08:53Z", "message": "ddvalue.rs: Comment out safety checks.\n\nI haven't done thorough evaluation, but the safety checks `partial_cmp`,\n`eq`, and `cmp` appear to add small but non-trivial overhead, e.g., on\nthe redist_opt benchmarks.  Disabling these checks, as they should\nanyway be redundant: assuming the compiler is correct and the\ningest-time type checking is working properly, types are guaranteed to\nmatch."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59497282e0b6d381a463df6224af6fe1f2346a54", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/59497282e0b6d381a463df6224af6fe1f2346a54", "committedDate": "2020-11-21T21:59:42Z", "message": "Blanket implementation of DDValConvert and removed ddval convert macro"}, "afterCommit": {"oid": "b0e7948aba6f0275851ba239fa89143015949c0d", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/b0e7948aba6f0275851ba239fa89143015949c0d", "committedDate": "2020-11-27T18:08:53Z", "message": "ddvalue.rs: Comment out safety checks.\n\nI haven't done thorough evaluation, but the safety checks `partial_cmp`,\n`eq`, and `cmp` appear to add small but non-trivial overhead, e.g., on\nthe redist_opt benchmarks.  Disabling these checks, as they should\nanyway be redundant: assuming the compiler is correct and the\ningest-time type checking is working properly, types are guaranteed to\nmatch."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4448, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}