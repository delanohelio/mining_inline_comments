{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2Njc4NjMz", "number": 885, "title": "Several small improvements", "bodyText": "See individual commits.", "createdAt": "2020-12-30T00:09:17Z", "url": "https://github.com/vmware/differential-datalog/pull/885", "merged": true, "mergeCommit": {"oid": "1f00179fb069c5756aaa0da038a33e4c6e516ac9"}, "closed": true, "closedAt": "2020-12-30T08:50:00Z", "author": {"login": "ryzhyk"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqqbHUgH2gAyNTQ2Njc4NjMzOjQzOWZkZmNmMTlhYzNmNDYzMmU0ZmJlNWNiMTEzOGQxZjVmZTc2NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrLTIjABqjQxNTY2NDM4MTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "439fdfcf19ac3f4632e4fbe5cb1138d1f5fe7649", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/439fdfcf19ac3f4632e4fbe5cb1138d1f5fe7649", "committedDate": "2020-12-28T18:27:41Z", "message": "Remove `unsafe impl Send for HDDlog`.\n\nThis unsafe `impl` was a workaround for older DD not implementing `Send`\nfor `WorkerGuard`s.  This is no longer necessary with the latest timely/DD."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e000d168c831456de2127d5b8be6054739087ec7", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/e000d168c831456de2127d5b8be6054739087ec7", "committedDate": "2020-12-28T22:22:29Z", "message": "arrange.rs: Remove `concatenate_collections`.\n\nThe function was introduced a while ago as an efficient method of\nmerging many collections.  DD has since exposed the same functionality\nthrough its `Collection` API."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzU1MDI2", "url": "https://github.com/vmware/differential-datalog/pull/885#pullrequestreview-559755026", "createdAt": "2020-12-30T01:37:00Z", "commit": {"oid": "b63b20867c7260f6f5ce53253c5fff1b223968db"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwMTozNzowMFrOIMbqWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwMTo0MToyOVrOIMbtSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkwNzAzMw==", "bodyText": "why not just delete this?", "url": "https://github.com/vmware/differential-datalog/pull/885#discussion_r549907033", "createdAt": "2020-12-30T01:37:00Z", "author": {"login": "mbudiu-vmw"}, "path": "java/test1/RedistTest.java", "diffHunk": "@@ -286,7 +277,7 @@ void onCommitChange(DDlogCommand<DDlogRecord> command) {\n                 printSpan = false;\n                 System.out.println(\"Span:\");\n             }\n-            this.onCommit(command);  // process change\n+            //this.onCommit(command);  // process change", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63b20867c7260f6f5ce53253c5fff1b223968db"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkwNzQ3Ng==", "bodyText": "this one was right.", "url": "https://github.com/vmware/differential-datalog/pull/885#discussion_r549907476", "createdAt": "2020-12-30T01:39:39Z", "author": {"login": "mbudiu-vmw"}, "path": "rust/template/distributed_datalog/src/accumulate/accumulator.rs", "diffHunk": "@@ -33,7 +33,7 @@ use crate::accumulate::AccumulatingObserver;\n use crate::accumulate::TxnDistributor;\n \n /// A trait object that acts as a proxy between an observable and observer.\n-/// It accumulates the updates to maintain the current state of the data.\n+/// It accumulates the updates to maintains the current state of the data.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63b20867c7260f6f5ce53253c5fff1b223968db"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkwNzc4NQ==", "bodyText": "delete \"use\"", "url": "https://github.com/vmware/differential-datalog/pull/885#discussion_r549907785", "createdAt": "2020-12-30T01:41:29Z", "author": {"login": "mbudiu-vmw"}, "path": "test/datalog_tests/rust_api_test/src/main.rs", "diffHunk": "@@ -37,17 +37,15 @@ use differential_datalog::record::UpdCmd; // Dynamically typed representation of\n \n fn main() -> Result<(), String> {\n \n-    fn cb(_rel: usize, _rec: &Record, _w: isize) {}\n-\n     // Instantiate a DDlog program.\n     // Returns a handle to the program and initial contents of output relations.\n     // Arguments\n     // - number of worker threads (you typically want 1 or 2).\n     // - Boolean flag that indicates whether DDlog will track the complete snapshot\n-    //   of output relations.  Should only be used if you plan to dump `dump_table`\n-    //   their contents using `HDDlog::dump_table()`.\n-    // - Callback - obsolete and will disappear in future releases.\n-    let (mut hddlog, init_state) = HDDlog::run(1, false, cb)?;\n+    //   of output relations.  Should only be used for debugging in order to dump\n+    //   the contents of output tables using `HDDlog::dump_table()`.  Otherwise,\n+    //   use indexes are the preferred way to achieve this.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b63b20867c7260f6f5ce53253c5fff1b223968db"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzczNTAx", "url": "https://github.com/vmware/differential-datalog/pull/885#pullrequestreview-559773501", "createdAt": "2020-12-30T04:05:46Z", "commit": {"oid": "5b456af54677ea7ab5a3d5002b63a0bebe471188"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNDowNTo0N1rOIMc92w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNDowNTo0N1rOIMc92w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkyODQxMQ==", "bodyText": "Removing the update callback from the external api should allow removing Relation.change_cb if I'm not mistaken", "url": "https://github.com/vmware/differential-datalog/pull/885#discussion_r549928411", "createdAt": "2020-12-30T04:05:47Z", "author": {"login": "Kixiron"}, "path": "CHANGELOG.md", "diffHunk": "@@ -3,6 +3,15 @@ All notable changes to this project will be documented in this file.\n \n The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n \n+## [Unreleased]\n+\n+### API changes\n+\n+- Removed callback argument from `HDDlog::run`, `ddlog_run`, and Go/Java language\n+  bindings based on `ddlog_run`.  This optional callback, invoked by DD workers on\n+  each update to an output collection complicated the API and was tricky to use\n+  correctly.  Most importantly, it is superseded by the `commit_dump_changes` API.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b456af54677ea7ab5a3d5002b63a0bebe471188"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f76a52e5f596f2e740e35c836f3621dc629de95a", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/f76a52e5f596f2e740e35c836f3621dc629de95a", "committedDate": "2020-12-30T08:43:58Z", "message": "Remove callback argument.\n\nRemoved the callback argument from `HDDlog::run`, `ddlog_run`, and\nlanguage bindings based on `ddlog_run`.  This callback is confusing\nand difficult to use: it can be invoked from multiple threads and can\ndelete and remove the same record multiple times, and in arbitrary\norder. The the `commit_dump_changes` API provides a better\nway to track changes to output collections (at the cost of buffering\nthem)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef36431a98c7bcd2fb67639a0d98754af52b9b0e", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/ef36431a98c7bcd2fb67639a0d98754af52b9b0e", "committedDate": "2020-12-30T08:43:58Z", "message": "Fix lints in `distributed_ddlog::accumulate`.\n\nThe `accumulate` module is now public, which triggered a bunch of\nnew lints."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b63b20867c7260f6f5ce53253c5fff1b223968db", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/b63b20867c7260f6f5ce53253c5fff1b223968db", "committedDate": "2020-12-29T21:21:51Z", "message": "Fix lints in `distributed_ddlog::accumulate`.\n\nThe `accumulate` module is now public, which triggered a bunch of\nnew lints."}, "afterCommit": {"oid": "ef36431a98c7bcd2fb67639a0d98754af52b9b0e", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/ef36431a98c7bcd2fb67639a0d98754af52b9b0e", "committedDate": "2020-12-30T08:43:58Z", "message": "Fix lints in `distributed_ddlog::accumulate`.\n\nThe `accumulate` module is now public, which triggered a bunch of\nnew lints."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4505, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}