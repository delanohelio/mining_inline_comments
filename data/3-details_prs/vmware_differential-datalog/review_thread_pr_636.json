{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NjAyODg3", "number": 636, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDowODowNFrODzdUJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoyMjozNVrODzdcxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1Mjg0MjYyOnYy", "diffSide": "RIGHT", "path": "doc/tutorial/tutorial.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDowODowNFrOGH8SdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNTozNzozN1rOGID34Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MDk4MQ==", "bodyText": "These are not really tutorial items, they are highly technical.\nThe tutorial should only describe the core language, and should be ideally short and easy to read.", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r410980981", "createdAt": "2020-04-19T20:08:04Z", "author": {"login": "mbudiu-vmw"}, "path": "doc/tutorial/tutorial.md", "diffHunk": "@@ -1706,6 +1706,33 @@ to optimize data structures layout:\n extern type IObj<'A>\n ```\n \n+### `#[has_side_effects]`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEwNTI0OQ==", "bodyText": "I think there's nothing wrong about having advanced topics covered in the tutorial. Maybe we should break it up into several chapters for easier navigation and to have all the basic stuff in one smaller document.", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r411105249", "createdAt": "2020-04-20T05:37:37Z", "author": {"login": "ryzhyk"}, "path": "doc/tutorial/tutorial.md", "diffHunk": "@@ -1706,6 +1706,33 @@ to optimize data structures layout:\n extern type IObj<'A>\n ```\n \n+### `#[has_side_effects]`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MDk4MQ=="}, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1Mjg0ODUyOnYy", "diffSide": "RIGHT", "path": "src/Language/DifferentialDatalog/Compile.hs", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoxMjoxM1rOGH8VHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoxMjoxM1rOGH8VHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MTY2Mw==", "bodyText": "One solution would be to have an earlier pass which annotates all polymorphic functions with their type.", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r410981663", "createdAt": "2020-04-19T20:12:13Z", "author": {"login": "mbudiu-vmw"}, "path": "src/Language/DifferentialDatalog/Compile.hs", "diffHunk": "@@ -547,7 +544,51 @@ compileLib d specname rs_code = (typesLib, valueLib, mainLib)\n     typedefs = vcat $ map (mkTypedef d) $ M.elems $ progTypedefs d\n     -- Functions\n     (fdef, fextern) = partition (isJust . funcDef) $ M.elems $ progFunctions d\n-    funcs = vcat $ (map (mkFunc d) fextern ++ map (mkFunc d) fdef)\n+    funcs = let ?statics = statics in vcat $ (map (mkFunc d) fextern ++ map (mkFunc d) fdef)\n+\n+-- This type stores the set of statically evaluated constant sub-expressions.\n+-- We need to track the type of each expression, as generic functions like\n+-- 'set_empty()' can have different types in different contexts.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1Mjg1NjExOnYy", "diffSide": "RIGHT", "path": "src/Language/DifferentialDatalog/Module.hs", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoxNzo0MVrOGH8Ypw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNTozNzo1NlrOGID4Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MjU2Nw==", "bodyText": "this should probably be documented too, because users need to know this.", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r410982567", "createdAt": "2020-04-19T20:17:41Z", "author": {"login": "mbudiu-vmw"}, "path": "src/Language/DifferentialDatalog/Module.hs", "diffHunk": "@@ -64,28 +64,31 @@ data DatalogModule = DatalogModule {\n     moduleDefs :: DatalogProgram\n }\n \n--- standard library module name\n-stdname :: ModuleName\n-stdname = ModuleName [\"std\"]\n+-- Standard library module name.\n+stdLibs :: [ModuleName]\n+stdLibs = [ModuleName [\"std\"], ModuleName [\"internment\"]]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEwNTM0Mw==", "bodyText": "Documentation is on its way...", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r411105343", "createdAt": "2020-04-20T05:37:56Z", "author": {"login": "ryzhyk"}, "path": "src/Language/DifferentialDatalog/Module.hs", "diffHunk": "@@ -64,28 +64,31 @@ data DatalogModule = DatalogModule {\n     moduleDefs :: DatalogProgram\n }\n \n--- standard library module name\n-stdname :: ModuleName\n-stdname = ModuleName [\"std\"]\n+-- Standard library module name.\n+stdLibs :: [ModuleName]\n+stdLibs = [ModuleName [\"std\"], ModuleName [\"internment\"]]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MjU2Nw=="}, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1Mjg1OTAxOnYy", "diffSide": "RIGHT", "path": "src/Language/DifferentialDatalog/Syntax.hs", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoxOToxNVrOGH8Z9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNTozODozNFrOGID5BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MjkwMQ==", "bodyText": "Why didn't we need to do this previously?", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r410982901", "createdAt": "2020-04-19T20:19:15Z", "author": {"login": "mbudiu-vmw"}, "path": "src/Language/DifferentialDatalog/Syntax.hs", "diffHunk": "@@ -656,6 +656,72 @@ instance Eq e => Eq (ExprNode e) where\n     (==) (ERef _ p1)              (ERef _ p2)                = p1 == p2\n     (==) _                        _                          = False\n \n+-- Assign rank to constructors; used in the implementation of Ord.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEwNTU0MA==", "bodyText": "We never used expressions as keys in a map and so never had to implement Ord for them.", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r411105540", "createdAt": "2020-04-20T05:38:34Z", "author": {"login": "ryzhyk"}, "path": "src/Language/DifferentialDatalog/Syntax.hs", "diffHunk": "@@ -656,6 +656,72 @@ instance Eq e => Eq (ExprNode e) where\n     (==) (ERef _ p1)              (ERef _ p2)                = p1 == p2\n     (==) _                        _                          = False\n \n+-- Assign rank to constructors; used in the implementation of Ord.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MjkwMQ=="}, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1Mjg2MTE2OnYy", "diffSide": "RIGHT", "path": "test/datalog_tests/internment_test.dl", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoyMDozMFrOGH8a9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoyMDozMFrOGH8a9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MzE1OA==", "bodyText": "I don't recall seeing the i\"\" syntax in the documentation.", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r410983158", "createdAt": "2020-04-19T20:20:30Z", "author": {"login": "mbudiu-vmw"}, "path": "test/datalog_tests/internment_test.dl", "diffHunk": "@@ -1,12 +1,22 @@\n-import internment\n+input relation IInternedString(ix: istring)\n+relation StaticInternedString(ix: istring)\n \n-input relation IInternedString(ix: IString)\n+StaticInternedString(intern(\"static foo\")).\n+StaticInternedString(i\"ifoo\").", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1Mjg2NDcwOnYy", "diffSide": "RIGHT", "path": "test/datalog_tests/simple2.dl", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoyMjozNVrOGH8ciw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMDoyMjozNVrOGH8ciw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk4MzU2Mw==", "bodyText": "no tests with other constant expressions?", "url": "https://github.com/vmware/differential-datalog/pull/636#discussion_r410983563", "createdAt": "2020-04-19T20:22:35Z", "author": {"login": "mbudiu-vmw"}, "path": "test/datalog_tests/simple2.dl", "diffHunk": "@@ -95,3 +95,14 @@ SumsOfDoubles(x, y, z) :-\n     Doubles(ys),\n     var y = FlatMap(ys),\n     var z = x + y.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21b9027bd06b7786150841e5ed211d319a607f11"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4738, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}