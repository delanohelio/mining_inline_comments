{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMzc1Nzkz", "number": 502, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjozNTo0MFrODYkSrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjo0MTowNlrODYkaWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MDg3MDIyOnYy", "diffSide": "RIGHT", "path": "sql/src/main/java/com/vmware/ddlog/translator/AggregateVisitor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjozNTo0MFrOFef4cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjozNTo0MFrOFef4cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUyMzk1Mg==", "bodyText": "functionCall(min, functionCall(min, salaries))) -> functionCall(min, functionCall(abs, salaries)))", "url": "https://github.com/vmware/differential-datalog/pull/502#discussion_r367523952", "createdAt": "2020-01-16T16:35:40Z", "author": {"login": "lalithsuresh"}, "path": "sql/src/main/java/com/vmware/ddlog/translator/AggregateVisitor.java", "diffHunk": "@@ -0,0 +1,151 @@\n+package com.vmware.ddlog.translator;\n+\n+import com.facebook.presto.sql.tree.*;\n+import com.vmware.ddlog.util.Ternary;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * This visitor computes the AggregateDecomposition of an expression.\n+ * It returns 'true' if the expression is the result of an aggregation.\n+ */\n+public class AggregateVisitor\n+        extends AstVisitor<Ternary, TranslationContext> {\n+    /**\n+     * This class represents the decomposition of an expression that contains\n+     * aggregates into multiple expressions.  Consider this example:\n+     *\n+     * select max(salaries) + min(abs(salaries)) from employees\n+     *\n+     * Consider the expression tree\n+     * + ( functionCall(max, salaries), functionCall(min, functionCall(min, salaries)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d288d137194e8be46e408e0d49943a0a7a4e3891"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MDg4NTA3OnYy", "diffSide": "RIGHT", "path": "sql/src/main/java/com/vmware/ddlog/translator/SqlSemantics.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjozOTo1MFrOFegCBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjozOTo1MFrOFegCBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUyNjQwNg==", "bodyText": "Why does this need an instance? As opposed to calls like isAggregateFunction() etc being static methods?", "url": "https://github.com/vmware/differential-datalog/pull/502#discussion_r367526406", "createdAt": "2020-01-16T16:39:50Z", "author": {"login": "lalithsuresh"}, "path": "sql/src/main/java/com/vmware/ddlog/translator/SqlSemantics.java", "diffHunk": "@@ -0,0 +1,175 @@\n+package com.vmware.ddlog.translator;\n+\n+import com.vmware.ddlog.ir.*;\n+\n+import javax.annotation.Nullable;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+\n+/**\n+ * This is a singleton pattern class\n+ * encoding various properties about SQL semantics.\n+ */\n+public class SqlSemantics {\n+    private final HashSet<String> aggregateFunctions = new HashSet<String>();\n+    private final HashMap<String, DDlogEBinOp.BOp> arithmeticFunctions = new HashMap<String, DDlogEBinOp.BOp>();\n+    private final HashMap<String, DDlogEBinOp.BOp> stringFunctions = new HashMap<String, DDlogEBinOp.BOp>();\n+    private final HashMap<String, DDlogEBinOp.BOp> booleanFunctions = new HashMap<String, DDlogEBinOp.BOp>();\n+\n+    private SqlSemantics() {\n+        this.aggregateFunctions.add(\"count\");\n+        this.aggregateFunctions.add(\"sum\");\n+        this.aggregateFunctions.add(\"avg\");\n+        this.aggregateFunctions.add(\"min\");\n+        this.aggregateFunctions.add(\"max\");\n+\n+        this.arithmeticFunctions.put(\"a_eq\", DDlogEBinOp.BOp.Eq);\n+        this.arithmeticFunctions.put(\"a_neq\", DDlogEBinOp.BOp.Neq);\n+        this.arithmeticFunctions.put(\"a_lt\", DDlogEBinOp.BOp.Lt);\n+        this.arithmeticFunctions.put(\"a_gt\", DDlogEBinOp.BOp.Gt);\n+        this.arithmeticFunctions.put(\"a_lte\", DDlogEBinOp.BOp.Lte);\n+        this.arithmeticFunctions.put(\"a_gte\", DDlogEBinOp.BOp.Gte);\n+        this.arithmeticFunctions.put(\"a_plus\", DDlogEBinOp.BOp.Plus);\n+        this.arithmeticFunctions.put(\"a_minus\", DDlogEBinOp.BOp.Minus);\n+        this.arithmeticFunctions.put(\"a_mod\", DDlogEBinOp.BOp.Mod);\n+        this.arithmeticFunctions.put(\"a_times\", DDlogEBinOp.BOp.Times);\n+        this.arithmeticFunctions.put(\"a_div\", DDlogEBinOp.BOp.Div);\n+        // The following don't work for 64 bits\n+        // this.arithmeticFunctions.put(\"a_shiftr\", DDlogEBinOp.BOp.ShiftR);\n+        // this.arithmeticFunctions.put(\"a_shiftl\", DDlogEBinOp.BOp.ShiftL);\n+        this.arithmeticFunctions.put(\"a_band\", DDlogEBinOp.BOp.BAnd);\n+        this.arithmeticFunctions.put(\"a_bor\", DDlogEBinOp.BOp.BOr);\n+        this.arithmeticFunctions.put(\"a_bxor\", DDlogEBinOp.BOp.BXor);\n+\n+        this.stringFunctions.put(\"s_concat\", DDlogEBinOp.BOp.Concat);\n+        this.stringFunctions.put(\"s_eq\", DDlogEBinOp.BOp.Eq);\n+        this.stringFunctions.put(\"s_neq\", DDlogEBinOp.BOp.Neq);\n+\n+        this.booleanFunctions.put(\"b_eq\", DDlogEBinOp.BOp.Eq);\n+        this.booleanFunctions.put(\"b_neq\", DDlogEBinOp.BOp.Neq);\n+        this.booleanFunctions.put(\"b_and\", DDlogEBinOp.BOp.And);\n+        this.booleanFunctions.put(\"b_or\", DDlogEBinOp.BOp.Or);\n+        this.booleanFunctions.put(\"b_impl\", DDlogEBinOp.BOp.Impl);\n+    }\n+\n+    public static SqlSemantics semantics = new SqlSemantics();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d288d137194e8be46e408e0d49943a0a7a4e3891"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MDg4OTg3OnYy", "diffSide": "RIGHT", "path": "sql/src/main/java/com/vmware/ddlog/translator/Translator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjo0MTowNlrOFegFAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjo0MTowNlrOFegFAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUyNzE3MQ==", "bodyText": "Why is generateLibrary in SqlSemantics?", "url": "https://github.com/vmware/differential-datalog/pull/502#discussion_r367527171", "createdAt": "2020-01-16T16:41:06Z", "author": {"login": "lalithsuresh"}, "path": "sql/src/main/java/com/vmware/ddlog/translator/Translator.java", "diffHunk": "@@ -83,10 +83,9 @@ public DDlogIRNode translateExpression(final String sql) {\n     }\n \n     public DDlogProgram generateLibrary() {\n-        return this.translationContext.generateLibrary();\n+        return SqlSemantics.semantics.generateLibrary();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d288d137194e8be46e408e0d49943a0a7a4e3891"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4850, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}