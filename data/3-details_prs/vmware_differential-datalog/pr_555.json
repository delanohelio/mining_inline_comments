{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MjM4MzU0", "number": 555, "title": "setup prerequisites and dependencies with Nix", "bodyText": "had to disable static binary compilation, due to some gmp problems with Nix infra static binary build is supported\ndidn't install Go into profile, cause don't know how to test it\nstack test --ta '-p path' works\nthe mentioned in tutorial small script now lives as a shell function ddlog-run\n\nPackaging ddlog as a \"package\" can be next step, but it will require some thinking. It will definitely require converting package.yaml and Cargo.toml into Nix files. But nix-shell approach is still fine for grab&try experience.", "createdAt": "2020-03-14T09:43:37Z", "url": "https://github.com/vmware/differential-datalog/pull/555", "merged": true, "mergeCommit": {"oid": "0fe889db01959f5ee5a9eb7cce501c52be5f8e01"}, "closed": true, "closedAt": "2020-03-17T20:05:03Z", "author": {"login": "danbst"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNhh98AH2gAyMzg4MjM4MzU0OjEwZTA3NWI3YTk0NjgxZGEzZWNlZTc4Y2ZlODQ0OTYyMDliMTFiMjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOmyS4gH2gAyMzg4MjM4MzU0OmRjNGUxN2MzNjJjNWFmNTQ2YjRiZWEwOTdhMGVhNGIzYzEzYjU2ODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "10e075b7a94681da3ecee78cfe84496209b11b21", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/10e075b7a94681da3ecee78cfe84496209b11b21", "committedDate": "2020-03-14T09:31:04Z", "message": "setup prerequisites and dependencies with Nix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a87cbc62ee8b10ca6e9ad2bfd7f15a1c1a91460b", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/a87cbc62ee8b10ca6e9ad2bfd7f15a1c1a91460b", "committedDate": "2020-03-14T13:22:15Z", "message": "fail fast if program does not compile and don't build in release mode, as it is too slow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbc3b3e43f8d7ff4fcf9bf580860896b254201f8", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/bbc3b3e43f8d7ff4fcf9bf580860896b254201f8", "committedDate": "2020-03-14T13:55:35Z", "message": "D'oh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODA3NTE0", "url": "https://github.com/vmware/differential-datalog/pull/555#pullrequestreview-374807514", "createdAt": "2020-03-15T15:11:51Z", "commit": {"oid": "a87cbc62ee8b10ca6e9ad2bfd7f15a1c1a91460b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNToxMTo1MVrOF2fdxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNToxMTo1MVrOF2fdxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4Mjk1MA==", "bodyText": "There are a couple of problems with debug builds in Rust: they are 10x slower (literally) and also take 10x more disk space than release builds. The release build is indeed slow, but after a recent refactoring only the first build is really slow; subsequent rebuilds usually take a few seconds, so I would stick to release builds here.", "url": "https://github.com/vmware/differential-datalog/pull/555#discussion_r392682950", "createdAt": "2020-03-15T15:11:51Z", "author": {"login": "ryzhyk"}, "path": "default.nix", "diffHunk": "@@ -70,8 +70,8 @@ let\n             input_file=\"$dat_name\"\n           fi\n         fi\n-        ddlog -i \"$program\" -L '${builtins.toPath ./lib}'\n-        (cd \"''${program_noext}_ddlog\" && cargo build --release)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87cbc62ee8b10ca6e9ad2bfd7f15a1c1a91460b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32548a5355a802339ac293b837d9f0d8ccc4265a", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/32548a5355a802339ac293b837d9f0d8ccc4265a", "committedDate": "2020-03-15T15:28:41Z", "message": "revert back to cargo build --release - incremental rebuild lasts reasonable time and much less disk space is used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb8f96923b0792fca2c8b53ee981803ac79dffe7", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/eb8f96923b0792fca2c8b53ee981803ac79dffe7", "committedDate": "2020-03-15T17:14:36Z", "message": "use GHC from Nix\n\nthis solves 2 problems:\n- template haskell and quasi qoutes will try run GHC installed by stack\n  which **may** cause linker issue if system glibc is different from Nix glibc\n- well we download GHC with Nix already, why duplicate this with Stack?\n  So this actually speeds up initial setup and reduces disk space usage\n\nNow GHC specified in `default.nix` overrides any setting used by LTS or whatever.\nSo upgrading LTS release now requires adjusting GHC version in Nix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bda4590d46362ac14c4c557dea2437ac4b1e8b63", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/bda4590d46362ac14c4c557dea2437ac4b1e8b63", "committedDate": "2020-03-17T07:21:55Z", "message": "README.md: Document both manual and Nix-based setups."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "768fefb05d2f98eb3cc0fd2d9bf319ab4012841c", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/768fefb05d2f98eb3cc0fd2d9bf319ab4012841c", "committedDate": "2020-03-17T07:26:00Z", "message": "move nix-specific hardcode out from stack.yaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33b85091ddf0cc37e7b1a31493c18f0d10d57ea0", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/33b85091ddf0cc37e7b1a31493c18f0d10d57ea0", "committedDate": "2020-03-17T08:35:37Z", "message": "static haskell builds with Nix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc4e17c362c5af546b4bea097a0ea4b3c13b5684", "author": {"user": {"login": "danbst", "name": "Danylo Hlynskyi"}}, "url": "https://github.com/vmware/differential-datalog/commit/dc4e17c362c5af546b4bea097a0ea4b3c13b5684", "committedDate": "2020-03-17T18:12:21Z", "message": "add go"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4670, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}