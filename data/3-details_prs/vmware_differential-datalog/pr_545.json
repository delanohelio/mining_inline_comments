{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NDgzMjQz", "number": 545, "title": "Support for floating points", "bodyText": "This is @mbudiu-vmw 's earlier PR with some changes.\nFixes #448", "createdAt": "2020-03-05T20:25:40Z", "url": "https://github.com/vmware/differential-datalog/pull/545", "merged": true, "mergeCommit": {"oid": "203faba100479d2aac03711355891ac6cf339b78"}, "closed": true, "closedAt": "2020-03-06T06:47:25Z", "author": {"login": "ryzhyk"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKhMXfAH2gAyMzg0NDgzMjQzOjVhYWIzYjNmMTYxN2JjMTJhMjVmMmVhZjE1NGUwY2ZmZWEyNzdmNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK581vABqjMxMDQxMjQ4MTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5aab3b3f1617bc12a25f2eaf154e0cffea277f51", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/5aab3b3f1617bc12a25f2eaf154e0cffea277f51", "committedDate": "2020-03-05T01:25:42Z", "message": "Support for FP; WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21a89fabf694ab54ebebfdd2417eeffa5aa203a1", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/21a89fabf694ab54ebebfdd2417eeffa5aa203a1", "committedDate": "2020-03-05T01:25:42Z", "message": "Support for double and float; still WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97ce730b500be28516304c8f47e6ed8f7eb7b1c9", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/97ce730b500be28516304c8f47e6ed8f7eb7b1c9", "committedDate": "2020-03-05T01:25:42Z", "message": "fmt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72fa31e6c685fcb5885b035203eb53a0d55d9979", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/72fa31e6c685fcb5885b035203eb53a0d55d9979", "committedDate": "2020-03-05T01:25:42Z", "message": "Tests for floating point support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fba16bc93485632db94c9f5c3ef18600cc9cb70", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/9fba16bc93485632db94c9f5c3ef18600cc9cb70", "committedDate": "2020-03-05T01:25:42Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7df99e5dd1dd47f990242d97322433adf5876b7a", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/7df99e5dd1dd47f990242d97322433adf5876b7a", "committedDate": "2020-03-05T01:25:42Z", "message": "pretty print"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d88a27b5ce1a9b2ff1286558fe92c51e22cd790", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/0d88a27b5ce1a9b2ff1286558fe92c51e22cd790", "committedDate": "2020-03-05T01:25:42Z", "message": "pretty print"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5838f5bcbf63be9edf784e5d8f971939782979b4", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/5838f5bcbf63be9edf784e5d8f971939782979b4", "committedDate": "2020-03-05T01:25:42Z", "message": "fix pretty-printing of fp values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d488cf43b2e2d81deb34f48199ec146c320b2387", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/d488cf43b2e2d81deb34f48199ec146c320b2387", "committedDate": "2020-03-05T01:25:42Z", "message": "Java API support for doubles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3145d52c096a8759e6e87a85894f6d761227403", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/f3145d52c096a8759e6e87a85894f6d761227403", "committedDate": "2020-03-05T01:25:43Z", "message": "Address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90906834946a3d9d3f6787f97398e9dee201b1c6", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/90906834946a3d9d3f6787f97398e9dee201b1c6", "committedDate": "2020-03-05T01:25:43Z", "message": "clippy fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8d3fffaadaf99aacfb164666714c1438f43ed0b", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/b8d3fffaadaf99aacfb164666714c1438f43ed0b", "committedDate": "2020-03-05T01:25:43Z", "message": "more clippy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6d88c32687aab0b15021a3b62ec565724d0c672", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/b6d88c32687aab0b15021a3b62ec565724d0c672", "committedDate": "2020-03-05T01:25:43Z", "message": "more clippy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebe7099426d5d37776ad0df8ff5db43faa451774", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/ebe7099426d5d37776ad0df8ff5db43faa451774", "committedDate": "2020-03-05T01:25:43Z", "message": "more clippy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a1539117276a150db5ec4d3e6263dc92ea6c3ef", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/8a1539117276a150db5ec4d3e6263dc92ea6c3ef", "committedDate": "2020-03-05T01:25:43Z", "message": "Duplicate Rust dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00380688973efd41bc184741c59766071832fd2f", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/00380688973efd41bc184741c59766071832fd2f", "committedDate": "2020-03-05T01:25:43Z", "message": "Fix failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba9bb72547bc579e982d0909aa35556284ea9c84", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/ba9bb72547bc579e982d0909aa35556284ea9c84", "committedDate": "2020-03-05T01:25:43Z", "message": "Parse floating point literals without size prefix.\n\nParse floating point literals like `0.5` and `5e-1`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63afa5d458fc8939e3748a1c88c404748a22ac25", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/63afa5d458fc8939e3748a1c88c404748a22ac25", "committedDate": "2020-03-05T01:25:43Z", "message": "fixup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7f2552b946d0e6f4a06ab13d8a2c3f8c4d8d75c", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/a7f2552b946d0e6f4a06ab13d8a2c3f8c4d8d75c", "committedDate": "2020-03-05T01:26:58Z", "message": "Parse Record::Double.\n\n- Parse `Record::Double`\n- Added missing Java APIs\n- Removed `Record::Float`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3861a0343373ac825a2ce3dd8631ee300dde677", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/c3861a0343373ac825a2ce3dd8631ee300dde677", "committedDate": "2020-03-05T17:38:16Z", "message": "Bring Record::Float back."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52c2b9c5a67c4b761a8a81ad62a163ad71f20084", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/52c2b9c5a67c4b761a8a81ad62a163ad71f20084", "committedDate": "2020-03-05T18:10:53Z", "message": "Java: Test double and float record API."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5OTMyMjEz", "url": "https://github.com/vmware/differential-datalog/pull/545#pullrequestreview-369932213", "createdAt": "2020-03-05T21:36:02Z", "commit": {"oid": "7096e009e1f59fd593b0458085d251ab9cf2fdb6"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTozNjowMlrOFylCIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTozODoxNFrOFylGdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3OTg3Mw==", "bodyText": "I don't like this.\nPerhaps JSON null would be a better choice.", "url": "https://github.com/vmware/differential-datalog/pull/545#discussion_r388579873", "createdAt": "2020-03-05T21:36:02Z", "author": {"login": "mbudiu-vmw"}, "path": "lib/json.dl", "diffHunk": "@@ -40,6 +40,6 @@ typedef JsonNum = // Integer number.  The value must be in the range between the\n                   // inclusive.  Values outside of this range will be truncated\n                   // during serialization.\n                   JsonInt{i: s128}\n-                | // Always finite.\n-                  // TODO.\n-                  JsonFloat\n+                | // NaN and infinity are not valid JSON values.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7096e009e1f59fd593b0458085d251ab9cf2fdb6"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4MDc3NQ==", "bodyText": "doubles, no apostrophe.\nyou may want a similar comment for bigint if it isn't there", "url": "https://github.com/vmware/differential-datalog/pull/545#discussion_r388580775", "createdAt": "2020-03-05T21:37:51Z", "author": {"login": "mbudiu-vmw"}, "path": "rust/template/cmd_parser/parse.rs", "diffHunk": "@@ -563,6 +564,70 @@ fn test_struct() {\n                                                                     (Cow::from(\"sfield\"), Record::String(\"foo\\nbar\".to_string()))]))]))));\n }\n \n+// nom's implementation mof `recognize_float` accepts integer literals\n+// like `5`, making it impossible for the parser to distinguish between\n+// floats and integers.  The following is a strict version of `recognize_float`\n+// that only accepts literals containing `.`, e.g., `0.5` or `e|E`, e.g.,\n+// `5e-1`.\n+named!(recognize_float<&[u8], &[u8]>,\n+  recognize!(\n+    do_parse!(\n+      opt!(alt!(char!('+') | char!('-'))) >>\n+      alt!(\n+          do_parse!(digit >>\n+                    alt!( value!((),tuple!(char!('.'), opt!(digit), opt!(recognize_exponent)))\n+                        | recognize_exponent) >>\n+                    (()))\n+        | do_parse!(char!('.') >>\n+                   digit >>\n+                   opt!(recognize_exponent) >>\n+                   (()))) >>\n+      (())\n+    )\n+  )\n+);\n+\n+named!(recognize_exponent<&[u8], ()>,\n+       do_parse!(alt!(char!('e') | char!('E')) >>\n+                 opt!(alt!(char!('+') | char!('-'))) >>\n+                 digit >>\n+                 (()))\n+);\n+\n+// We do not have enough type information to distinguish between floats\n+// and doubles during parsing, so we parse all floating point numbers as\n+// double's and postpone casting them to floats until when they get converted", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7096e009e1f59fd593b0458085d251ab9cf2fdb6"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4MDk4Mw==", "bodyText": "I wonder what happens on overflow", "url": "https://github.com/vmware/differential-datalog/pull/545#discussion_r388580983", "createdAt": "2020-03-05T21:38:14Z", "author": {"login": "mbudiu-vmw"}, "path": "rust/template/cmd_parser/parse.rs", "diffHunk": "@@ -563,6 +564,70 @@ fn test_struct() {\n                                                                     (Cow::from(\"sfield\"), Record::String(\"foo\\nbar\".to_string()))]))]))));\n }\n \n+// nom's implementation mof `recognize_float` accepts integer literals\n+// like `5`, making it impossible for the parser to distinguish between\n+// floats and integers.  The following is a strict version of `recognize_float`\n+// that only accepts literals containing `.`, e.g., `0.5` or `e|E`, e.g.,\n+// `5e-1`.\n+named!(recognize_float<&[u8], &[u8]>,\n+  recognize!(\n+    do_parse!(\n+      opt!(alt!(char!('+') | char!('-'))) >>\n+      alt!(\n+          do_parse!(digit >>\n+                    alt!( value!((),tuple!(char!('.'), opt!(digit), opt!(recognize_exponent)))\n+                        | recognize_exponent) >>\n+                    (()))\n+        | do_parse!(char!('.') >>\n+                   digit >>\n+                   opt!(recognize_exponent) >>\n+                   (()))) >>\n+      (())\n+    )\n+  )\n+);\n+\n+named!(recognize_exponent<&[u8], ()>,\n+       do_parse!(alt!(char!('e') | char!('E')) >>\n+                 opt!(alt!(char!('+') | char!('-'))) >>\n+                 digit >>\n+                 (()))\n+);\n+\n+// We do not have enough type information to distinguish between floats\n+// and doubles during parsing, so we parse all floating point numbers as\n+// double's and postpone casting them to floats until when they get converted\n+// into concrete types.\n+named!(float_val<&[u8], Record>,\n+       do_parse!(val: flat_map!(recognize_float, parse_to!(f64)) >>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7096e009e1f59fd593b0458085d251ab9cf2fdb6"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6479d39e3c8f0ccd56c2d68cf427eafd078fcbb8", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/6479d39e3c8f0ccd56c2d68cf427eafd078fcbb8", "committedDate": "2020-03-06T06:16:00Z", "message": "Add floats support to json.dl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "944e2eedd722600c091a3ffa6cd3a35dc5451066", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/944e2eedd722600c091a3ffa6cd3a35dc5451066", "committedDate": "2020-03-06T06:16:00Z", "message": ".gitlab-ci.yml: move test-simple to private runner."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7096e009e1f59fd593b0458085d251ab9cf2fdb6", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/7096e009e1f59fd593b0458085d251ab9cf2fdb6", "committedDate": "2020-03-05T20:07:38Z", "message": ".gitlab-ci.yml: move test-simple to private runner."}, "afterCommit": {"oid": "944e2eedd722600c091a3ffa6cd3a35dc5451066", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/944e2eedd722600c091a3ffa6cd3a35dc5451066", "committedDate": "2020-03-06T06:16:00Z", "message": ".gitlab-ci.yml: move test-simple to private runner."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4656, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}