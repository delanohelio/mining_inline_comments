{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NDAzNDcz", "number": 693, "title": "Expose Record::Serialized in c-api", "bodyText": "This pr exposes the Record::Serialized variant via the C api", "createdAt": "2020-07-05T12:50:42Z", "url": "https://github.com/vmware/differential-datalog/pull/693", "merged": true, "mergeCommit": {"oid": "6dd5836e0d23a213daa6cde2417bae0acd5683d8"}, "closed": true, "closedAt": "2020-07-05T20:12:19Z", "author": {"login": "c-nixon"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcx8IrKgH2gAyNDQ0NDAzNDczOjdiMzkwMzJmNTQyMzBhY2RkYmZlMWQ4YWU1YjYyNjIxMmQ1ZmQ1N2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyBM3NgH2gAyNDQ0NDAzNDczOjE3NmYwYTEyZDI2Y2UyMDQ3YWQzZDUzYzVjMDljZGJhY2I5ZjA2MDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b39032f54230acddbfe1d8ae5b626212d5fd57f", "author": {"user": {"login": "c-nixon", "name": "Chris Nixon"}}, "url": "https://github.com/vmware/differential-datalog/commit/7b39032f54230acddbfe1d8ae5b626212d5fd57f", "committedDate": "2020-07-05T12:52:09Z", "message": "Expose Record::Serialized in c-api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aeb24afc4e796adeacc463502ee5fe28b5752a4a", "author": {"user": {"login": "c-nixon", "name": "Chris Nixon"}}, "url": "https://github.com/vmware/differential-datalog/commit/aeb24afc4e796adeacc463502ee5fe28b5752a4a", "committedDate": "2020-07-05T12:47:28Z", "message": "Expose Record::Serialized in c-api"}, "afterCommit": {"oid": "7b39032f54230acddbfe1d8ae5b626212d5fd57f", "author": {"user": {"login": "c-nixon", "name": "Chris Nixon"}}, "url": "https://github.com/vmware/differential-datalog/commit/7b39032f54230acddbfe1d8ae5b626212d5fd57f", "committedDate": "2020-07-05T12:52:09Z", "message": "Expose Record::Serialized in c-api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjk1NjY0", "url": "https://github.com/vmware/differential-datalog/pull/693#pullrequestreview-442695664", "createdAt": "2020-07-05T17:57:29Z", "commit": {"oid": "7b39032f54230acddbfe1d8ae5b626212d5fd57f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNzo1NzoyOVrOGtD5DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNzo1NzoyOVrOGtD5DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMjg2MA==", "bodyText": "Looking at the implementation, I don't think t gets copied. It looks like the function expects it to be a static pointer.", "url": "https://github.com/vmware/differential-datalog/pull/693#discussion_r449902860", "createdAt": "2020-07-05T17:57:29Z", "author": {"login": "ryzhyk"}, "path": "rust/template/ddlog.h", "diffHunk": "@@ -954,6 +954,45 @@ extern size_t ddlog_get_strlen(const ddlog_record *rec);\n  */\n extern const char * ddlog_get_str_with_length(const ddlog_record *rec, size_t *len);\n \n+/*\n+ * Create a serialized record from a NULL-terminated string `t` containing\n+ * the serialization scheme and a NULL-terminated string `s` containing\n+ * the serialized data.\n+ * This function copies `s` to an internal buffer, so the caller is\n+ * responsible for deallocating `s` if it was dynamically allocated.\n+ *\n+ * Returns `NULL` if `t` or `s` are not a valid null-terminated UTF8 strings.\n+ */\n+extern ddlog_record* ddlog_serialized(const char *t, const char *s);\n+\n+/*\n+ * Create a serialized record.\n+ *\n+ * `t` - points to the start of a UTF8 string containing the\n+ *       serialization scheme. The string does not have to be\n+ *       NULL-terminated. The pointer must not be `NULL`\n+ * `t_len` - length of string in bytes.\n+ * `s` - points to the start of a UTF8 string containing the\n+ *       serialization scheme.  The string does not have to be\n+ *       NULL-terminated. The pointer must not be `NULL`, unless\n+ *       `s_len==0`, in which case the function ignores the value of the\n+ *       pointer and returns a record containing an empty string.\n+ * `s_len` - length of string in bytes.\n+ *\n+ * This function copies `s` and `t` to internal buffers, so the caller is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b39032f54230acddbfe1d8ae5b626212d5fd57f"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "176f0a12d26ce2047ad3d53c5c09cdbacb9f0602", "author": {"user": {"login": "c-nixon", "name": "Chris Nixon"}}, "url": "https://github.com/vmware/differential-datalog/commit/176f0a12d26ce2047ad3d53c5c09cdbacb9f0602", "committedDate": "2020-07-05T18:46:15Z", "message": "Fix ddlog.h serialized_with_length doc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4551, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}