{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MTQyMTA4", "number": 809, "title": "Support for table primary keys in SQL to DDlog compiler", "bodyText": "", "createdAt": "2020-11-10T01:16:00Z", "url": "https://github.com/vmware/differential-datalog/pull/809", "merged": true, "mergeCommit": {"oid": "6217e787d8bede789c19f2a3e66f03ba84018736"}, "closed": true, "closedAt": "2020-11-10T18:58:53Z", "author": {"login": "mbudiu-vmw"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda-31bAH2gAyNTE4MTQyMTA4OjM1ODFhYjVhOWQ1YWE2MjAwNmM1ZDI3OWU1MTQ2NTJkZWFhY2E5NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbOFwegFqTUyNzUxNjA3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3581ab5a9d5aa62006c5d279e514652deaaca95d", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/3581ab5a9d5aa62006c5d279e514652deaaca95d", "committedDate": "2020-11-10T01:14:22Z", "message": "Support for table primary keys"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2Nzk4ODA4", "url": "https://github.com/vmware/differential-datalog/pull/809#pullrequestreview-526798808", "createdAt": "2020-11-10T02:08:08Z", "commit": {"oid": "3581ab5a9d5aa62006c5d279e514652deaaca95d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjowODowOVrOHwI56A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjowOTowMFrOHwI6wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIzOTU5Mg==", "bodyText": "Use braces just to be sure?", "url": "https://github.com/vmware/differential-datalog/pull/809#discussion_r520239592", "createdAt": "2020-11-10T02:08:09Z", "author": {"login": "lalithsuresh"}, "path": "sql/src/main/java/com/vmware/ddlog/translator/TranslationVisitor.java", "diffHunk": "@@ -73,15 +73,25 @@ protected DDlogIRNode visitCreateTable(CreateTable node, TranslationContext cont\n \n         List<TableElement> elements = node.getElements();\n         List<DDlogField> fields = new ArrayList<DDlogField>();\n+        List<DDlogField> keyColumns = new ArrayList<DDlogField>();\n         for (TableElement te: elements) {\n-            DDlogIRNode field = this.process(te, context);\n-            fields.add(field.to(DDlogField.class));\n+            DDlogIRNode f = this.process(te, context);\n+            DDlogField field = f.to(DDlogField.class);\n+            fields.add(field);\n+            if (te instanceof ColumnDefinition) {\n+                ColumnDefinition cd = (ColumnDefinition)te;\n+                if (Linq.any(cd.getProperties(), p -> p.getName().getValue().equals(\"primary_key\")))\n+                    keyColumns.add(field);\n+            }\n         }\n         DDlogTUser tuser = context.createStruct(node, fields, name);\n         String relName = DDlogRelationDeclaration.relationName(name);\n         context.reserveGlobalName(relName);\n         DDlogRelationDeclaration rel = new DDlogRelationDeclaration(\n                 node, DDlogRelationDeclaration.Role.Input, relName, tuser);\n+        if (keyColumns.size() > 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3581ab5a9d5aa62006c5d279e514652deaaca95d"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIzOTgwOQ==", "bodyText": "Can you also test for multiple primary keys in the same table (compound key)?", "url": "https://github.com/vmware/differential-datalog/pull/809#discussion_r520239809", "createdAt": "2020-11-10T02:09:00Z", "author": {"login": "lalithsuresh"}, "path": "sql/src/test/java/ddlog/WeaveTest.java", "diffHunk": "@@ -12,7 +12,7 @@ public void testWeave() {\n         Translator t = new Translator(null);\n         String node_info = \"create table node_info\\n\" +\n                 \"(\\n\" +\n-                \"  name varchar(36) not null /*primary key*/,\\n\" +\n+                \"  name varchar(36) not null with (primary_key = true),\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3581ab5a9d5aa62006c5d279e514652deaaca95d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34cf2d89696a46afdc0197ddff601fc441fefbed", "author": {"user": {"login": "mbudiu-vmw", "name": "Mihai Budiu"}}, "url": "https://github.com/vmware/differential-datalog/commit/34cf2d89696a46afdc0197ddff601fc441fefbed", "committedDate": "2020-11-10T03:12:37Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTE2MDc1", "url": "https://github.com/vmware/differential-datalog/pull/809#pullrequestreview-527516075", "createdAt": "2020-11-10T18:58:10Z", "commit": {"oid": "34cf2d89696a46afdc0197ddff601fc441fefbed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4432, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}