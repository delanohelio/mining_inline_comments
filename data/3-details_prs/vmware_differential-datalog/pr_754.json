{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NDUyMjU2", "number": 754, "title": "Improved static variable generation", "bodyText": "Collected program statics are now nested within a single lazy_static! invocation (theoretically reduces compile times)\nRelation statics were refactored into one core function\nRelation statics now have their hashmaps pre-allocated, should reduce memory usage/churn and make startups quicker (affects large programs more)\nC-Name maps now store &'static CStrs instead of CStrings. This brings a huge memory benefit since now names are only baked into the binary instead of being uselessly heap-allocated\nChanged the C-Name maps to panicking instead of silently returning a corrupted/dummy value, a panic only in the instance of something being terribly wrong is better than silent state corruption and un-huntable bugs\nDocs! Both the generated relation statics have (kinda bad) docs and (most) of the functions that create them have 'em as well", "createdAt": "2020-08-27T05:15:43Z", "url": "https://github.com/vmware/differential-datalog/pull/754", "merged": true, "mergeCommit": {"oid": "af290ed1aaad1d98dc2fc32a6ff6a8bedc2f6331"}, "closed": true, "closedAt": "2020-08-27T16:54:03Z", "author": {"login": "Kixiron"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC5RgwAH2gAyNDc0NDUyMjU2OjM1OGM3OThhNWU4ZGZmNzQ2OTAyMTUzNDBhZTA0MGYzYzZlMjIzMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC5wp6gFqTQ3NjM5OTk5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "358c798a5e8dff74690215340ae040f3c6e2230b", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/358c798a5e8dff74690215340ae040f3c6e2230b", "committedDate": "2020-08-27T05:08:48Z", "message": "Improved static variable generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MzkyNTYx", "url": "https://github.com/vmware/differential-datalog/pull/754#pullrequestreview-476392561", "createdAt": "2020-08-27T05:20:37Z", "commit": {"oid": "358c798a5e8dff74690215340ae040f3c6e2230b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNToyMDozN1rOHH-8FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNToyMDozN1rOHH-8FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzMzI2OQ==", "bodyText": "Unfortunately, this does not work.  I don't remember the exact error, but basically rustc failed when there were too many static variables within a single lazy_static.", "url": "https://github.com/vmware/differential-datalog/pull/754#discussion_r478133269", "createdAt": "2020-08-27T05:20:37Z", "author": {"login": "ryzhyk"}, "path": "src/Language/DifferentialDatalog/Compile.hs", "diffHunk": "@@ -624,13 +624,19 @@ collectStatics d = execState (progExprMapCtxM d (checkStaticExpr)) M.empty\n -- computed by 'collectStatics'.\n mkStatics :: DatalogProgram -> Statics -> Doc\n mkStatics d statics =\n-    vcat $\n-    map (\\((e, t), i) ->\n-            let static_name = \"__STATIC_\" <> pp i in\n-            let ?statics = deleteStatic e t statics in\n-            let e' = mkExpr d CtxTop (eTyped e t) EVal in\n-            \"lazy_static!{ pub static ref\" <+> static_name <> \":\" <+> mkType t <+> \"=\" <+> e' <+> \"; }\")\n-        $ M.toList statics\n+    \"lazy_static! {\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "358c798a5e8dff74690215340ae040f3c6e2230b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7a463547a67b7295b5c9895609e717530bb1cea", "author": {"user": {"login": "Kixiron", "name": "Chase Wilson"}}, "url": "https://github.com/vmware/differential-datalog/commit/d7a463547a67b7295b5c9895609e717530bb1cea", "committedDate": "2020-08-27T05:27:24Z", "message": "It was too good to be true"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Mzk5OTk2", "url": "https://github.com/vmware/differential-datalog/pull/754#pullrequestreview-476399996", "createdAt": "2020-08-27T05:42:49Z", "commit": {"oid": "d7a463547a67b7295b5c9895609e717530bb1cea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4605, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}