{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1NzY1MDY3", "number": 778, "title": "Bug fix + documentation", "bodyText": "Bug in modify implementation.\nDocument modify behavior.\nDocument primary keys.", "createdAt": "2020-10-19T07:43:08Z", "url": "https://github.com/vmware/differential-datalog/pull/778", "merged": true, "mergeCommit": {"oid": "a99f50cbbd815ed36911e3e47aa43a688ef15a90"}, "closed": true, "closedAt": "2020-10-20T03:08:58Z", "author": {"login": "ryzhyk"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdT_KGjgH2gAyNTA1NzY1MDY3OjJmN2U0ZmJlYTc4Y2IxZTEyNTUzZjE0MjY3MTFlZGE0MjU3OTllMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUP6I6ABqjM4OTYzNzQ5Mzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f7e4fbea78cb1e12553f1426711eda425799e32", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/2f7e4fbea78cb1e12553f1426711eda425799e32", "committedDate": "2020-10-19T07:36:51Z", "message": "ddval.rs: Bug in DDValue::mutate().\n\nThis fixes a completely broken implementation of the `mofify` command.\n\nDescription of the bug:\n\n- DDValue is the type-erased representation of any DDlog value that\n  internally wraps the actual typed value in `Arc` and uses virtual\n  dispatch tables to forward various standard trait implementations to\n  the concrete type.\n\n- Cloning a DDValue increments the reference count without actually\n  copying the inner value.\n\n- The `from_ddvalue_ref_mut` method, generated by a Rust macro for each\n  type wrapped in DDValue extracted a writable reference to the\n  inner value from DDValue.  It did so in a completely unsafe way,\n  without enforcing unique ownership.\n\n- Fortunately, the only user of this broken method was the `Mutator`\n  implementation for DDValue.  Instead of mutating a new clone of the\n  inner value, it mutated the original value, thus altering all existing\n  clones.  This, in turn, broke the implementation of the\n  `Update::Modify` command that cloned the old value before modifying\n  the original in order to then issue a pair of delete old, insert\n  new commands.\n\nFix:\n\n- Create a clone of the inner value an wrap it in a new DDValue before\n  mutating it.\n\n- Remove the fundamentally broken `from_ddvalue_ref_mut` method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e059c904cf14c03bd1be3f57c91b2d25e0f7cfbb", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/e059c904cf14c03bd1be3f57c91b2d25e0f7cfbb", "committedDate": "2020-10-19T07:37:03Z", "message": "README.md: Typo."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4df18057c3e04abab3f7855505185b70d435e2e8", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/4df18057c3e04abab3f7855505185b70d435e2e8", "committedDate": "2020-10-19T07:37:11Z", "message": "Disable three souffle tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExOTgxNjIz", "url": "https://github.com/vmware/differential-datalog/pull/778#pullrequestreview-511981623", "createdAt": "2020-10-19T17:13:25Z", "commit": {"oid": "2ec69ecf243ded1955ab89dbad214e278298546b"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNzoxMzoyNVrOHkY2Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNzoxODoxN1rOHkZBeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxNzg1MQ==", "bodyText": "this is perhaps interesting, but I find this API asymmetric: people will expect that the same thing happens on outputs, You should indicate that this is not the case.", "url": "https://github.com/vmware/differential-datalog/pull/778#discussion_r507917851", "createdAt": "2020-10-19T17:13:25Z", "author": {"login": "mbudiu-vmw"}, "path": "doc/command_reference/command_reference.md", "diffHunk": "@@ -41,6 +41,82 @@ once the full list of updates has been read (end of list is indicated by a semic\n significantly more efficient and should always be the preferred option when the client wants to apply\n multiple updates that are known at the same time.\n \n+## `modify` command\n+\n+The `modify` command\n+\n+```\n+modify <relation> <key> <- <record>\n+```\n+\n+modifies the value associated with primary key `<key>` in `<relation>`.  It is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ec69ecf243ded1955ab89dbad214e278298546b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxODEyMw==", "bodyText": "typo", "url": "https://github.com/vmware/differential-datalog/pull/778#discussion_r507918123", "createdAt": "2020-10-19T17:13:52Z", "author": {"login": "mbudiu-vmw"}, "path": "doc/command_reference/command_reference.md", "diffHunk": "@@ -41,6 +41,82 @@ once the full list of updates has been read (end of list is indicated by a semic\n significantly more efficient and should always be the preferred option when the client wants to apply\n multiple updates that are known at the same time.\n \n+## `modify` command\n+\n+The `modify` command\n+\n+```\n+modify <relation> <key> <- <record>\n+```\n+\n+modifies the value associated with primary key `<key>` in `<relation>`.  It is\n+only applicabe to input relations declared with the `primary key` attribute.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ec69ecf243ded1955ab89dbad214e278298546b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkyMDc2MQ==", "bodyText": "I guess these are mine.", "url": "https://github.com/vmware/differential-datalog/pull/778#discussion_r507920761", "createdAt": "2020-10-19T17:18:17Z", "author": {"login": "mbudiu-vmw"}, "path": "test/run-souffle-tests.py", "diffHunk": "@@ -98,7 +99,9 @@\n     \"sort\",             # 202\n     \"tak\",              # 197\n     \"tic-tac-toe\",      # 197\n-    \"weighted_distances\" # 197\n+    \"weighted_distances\", # 197", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ec69ecf243ded1955ab89dbad214e278298546b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb3df7561d285a198514201d142924f194bf2da6", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/cb3df7561d285a198514201d142924f194bf2da6", "committedDate": "2020-10-20T03:05:27Z", "message": "command_reference: Document `modify` command.\n\nUnlike `insert`, `delete`, etc., the `modify` command has non-trivial\nsemantics.  Document this semantics in the command language reference."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ec69ecf243ded1955ab89dbad214e278298546b", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/2ec69ecf243ded1955ab89dbad214e278298546b", "committedDate": "2020-10-19T07:37:20Z", "message": "command_reference: Document `modify` command.\n\nUnlike `insert`, `delete`, etc., the `modify` command has non-trivial\nsemantics.  Document this semantics in the command language reference."}, "afterCommit": {"oid": "cb3df7561d285a198514201d142924f194bf2da6", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/cb3df7561d285a198514201d142924f194bf2da6", "committedDate": "2020-10-20T03:05:27Z", "message": "command_reference: Document `modify` command.\n\nUnlike `insert`, `delete`, etc., the `modify` command has non-trivial\nsemantics.  Document this semantics in the command language reference."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4411, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}