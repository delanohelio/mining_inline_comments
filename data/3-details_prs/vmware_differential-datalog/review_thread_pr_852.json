{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NzgwNjEz", "number": 852, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzo1Nzo1M1rOFDm-QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzo1Nzo1M1rOFDm-QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5MzI4NTc2OnYy", "diffSide": "RIGHT", "path": "src/Language/DifferentialDatalog/Util.hs", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzo1Nzo1M1rOIDWLnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzo1Nzo1M1rOIDWLnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM4MDA2Mw==", "bodyText": "no library function doing this?\nanyway, it's small.", "url": "https://github.com/vmware/differential-datalog/pull/852#discussion_r540380063", "createdAt": "2020-12-10T17:57:53Z", "author": {"login": "mbudiu-vmw"}, "path": "src/Language/DifferentialDatalog/Util.hs", "diffHunk": "@@ -181,6 +181,34 @@ updateFile path content = do\n                 renameFile tmppath path\n        else writeFile path content\n \n+-- | Update an entire directory tree, updating files whose contents has changed,\n+-- creating new files and deleting files not in `files` list, but keeping\n+-- files that haven't changed unmodified.\n+updateDirectory :: FilePath -> M.Map FilePath String -> IO ()\n+updateDirectory dir files = do\n+    -- Prepend directory path to all file names.\n+    let files' = M.mapKeys (dir </>) files\n+    -- Current directory contents.\n+    existing_files <- traverseDir dir\n+    -- Files not in the tree.\n+    let to_delete = filter (\\f -> M.notMember f files') existing_files\n+    mapM_ removeFile to_delete\n+    -- Update or create files in the tree.\n+    mapM_ (\\(mpath, mtext) -> updateFile mpath mtext)\n+          $ M.toList files'\n+\n+-- | Traverse directory tree, returning the list of files in it.\n+traverseDir :: FilePath -> IO [FilePath]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9793081c133e6f9d3681dc82671f6fc6efafc9b9"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4705, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}