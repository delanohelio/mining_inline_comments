{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MTM3NTU2", "number": 687, "title": "Add ddlog_dump_index(), ddlog_query_index() methods to the C API.", "bodyText": "", "createdAt": "2020-06-19T14:37:50Z", "url": "https://github.com/vmware/differential-datalog/pull/687", "merged": true, "mergeCommit": {"oid": "7f7e2c598383b79228268a1ca07de6bae725ac28"}, "closed": true, "closedAt": "2020-07-02T17:14:45Z", "author": {"login": "ryzhyk"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsiljAAH2gAyNDM3MTM3NTU2OjE4Y2U0NGEyZWU2ZjQyY2YzNWM1NDNiZTllZWU2ZjVkZGI0NTE5OGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwJb4ngH2gAyNDM3MTM3NTU2OmMwOGQ5Y2Q0NGVkZWFlMWM5ZjZlZmZmYzAyZWNkYjkyY2E4ZjE3ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "18ce44a2ee6f42cf35c543be9eee6f5ddb45198c", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/18ce44a2ee6f42cf35c543be9eee6f5ddb45198c", "committedDate": "2020-06-18T18:16:32Z", "message": "ddlog_dump_index() C API."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35fc1335453e00db442faef2c80f37bd892f5cd2", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/35fc1335453e00db442faef2c80f37bd892f5cd2", "committedDate": "2020-06-18T18:38:55Z", "message": "api.rs: Remove unnecessary Arc::from_raw/into_raw.\n\nFunctions in api.rs were not using the Arc API correctslu: there\nis no need to convert `&prog` into `Arc<prog>` and back, unless we\nintend to take over the ownership of the handle."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/a29df5d3eb6a578c820afd98d4ea949a1dd1094d", "committedDate": "2020-06-18T19:10:34Z", "message": "ddlog_query_index() C API."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MjQ5MDIz", "url": "https://github.com/vmware/differential-datalog/pull/687#pullrequestreview-434249023", "createdAt": "2020-06-19T17:47:32Z", "commit": {"oid": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzo0NzozM1rOGmc1Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzo0OTowM1rOGmc3lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3MTQxMA==", "bodyText": "typo", "url": "https://github.com/vmware/differential-datalog/pull/687#discussion_r442971410", "createdAt": "2020-06-19T17:47:33Z", "author": {"login": "mbudiu-vmw"}, "path": "rust/template/ddlog.h", "diffHunk": "@@ -409,6 +409,26 @@ extern int ddlog_apply_updates_from_flatbuf(ddlog_prog prog,\n                                             const unsigned char *buf,\n                                             size_t n);\n \n+/*\n+ * Query index by key.\n+ *\n+ * `idxid` - id of the index to dump.\n+ * `key` - query key.\n+ *     NOTE: the caller keeps ownership of `key` after the call and\n+ *     must deallocate it usin `ddlog_free()`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3MTUxNQ==", "bodyText": "misplaced quotes?", "url": "https://github.com/vmware/differential-datalog/pull/687#discussion_r442971515", "createdAt": "2020-06-19T17:47:47Z", "author": {"login": "mbudiu-vmw"}, "path": "rust/template/ddlog.h", "diffHunk": "@@ -409,6 +409,26 @@ extern int ddlog_apply_updates_from_flatbuf(ddlog_prog prog,\n                                             const unsigned char *buf,\n                                             size_t n);\n \n+/*\n+ * Query index by key.\n+ *\n+ * `idxid` - id of the index to dump.\n+ * `key` - query key.\n+ *     NOTE: the caller keeps ownership of `key` after the call and\n+ *     must deallocate it usin `ddlog_free()`.\n+ * `cb` - callback invoked for each returned record.\n+ * `cb_arg` - opaque handle passed to each `cb invocation`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk3MjA1NA==", "bodyText": "no message written here", "url": "https://github.com/vmware/differential-datalog/pull/687#discussion_r442972054", "createdAt": "2020-06-19T17:49:03Z", "author": {"login": "mbudiu-vmw"}, "path": "rust/template/src/api.rs", "diffHunk": "@@ -959,14 +953,68 @@ pub unsafe extern \"C\" fn ddlog_query_index_from_flatbuf(\n     if prog.is_null() {\n         return -1;\n     };\n-    let prog = Arc::from_raw(prog);\n+    let prog = &*prog;\n     prog.eprintln(\n         \"ddlog_query_index_from_flatbuf(): error: DDlog was compiled without FlatBuffers support\",\n     );\n-    Arc::into_raw(prog);\n     -1\n }\n \n+#[no_mangle]\n+pub unsafe extern \"C\" fn ddlog_dump_index(\n+    prog: *const HDDlog,\n+    idxid: libc::size_t,\n+    cb: Option<extern \"C\" fn(arg: libc::uintptr_t, rec: *const record::Record)>,\n+    cb_arg: libc::uintptr_t,\n+) -> raw::c_int {\n+    if prog.is_null() {\n+        return -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a29df5d3eb6a578c820afd98d4ea949a1dd1094d"}, "originalPosition": 183}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c08d9cd44edeae1c9f6efffc02ecdb92ca8f1786", "author": {"user": {"login": "ryzhyk", "name": "Leonid Ryzhyk"}}, "url": "https://github.com/vmware/differential-datalog/commit/c08d9cd44edeae1c9f6efffc02ecdb92ca8f1786", "committedDate": "2020-06-29T23:14:03Z", "message": "ddlog.h: Export two more APIs to C.\n\nExport ddlog_get_index_id(), ddlog_get_table_name() APIs from Rust to C."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4543, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}