{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3ODE0MTc1", "number": 6062, "title": "fix: [DHIS2-9287] Fix the stats in the import summary", "bodyText": "In this PR there are some fixes/refactoring together with the fix of the statistics in the import report:\n\nRemove the support for multiple bundles, we are always using one bundle\nPartial refactor of the converters, they create managed beans from hibernate (when we get them from the Preheat), so editing this beans is not what we want in the preprocess phase when we are calling rule engine\nFixing the validation for single active enrollments that was preventing to update enrollments at all\nStarting the refactor in the report part, removing unnecessary data\nRemoving the creation of errors in the delete service. We will need to review the whole deletion commit phase.\n\nThe response payload at the moment looks like this:\n{\n  \"status\": \"OK\",\n  \"timings\": {\n    \"validation\": \"2.587777 sec.\",\n    \"preheat\": \"0.032407 sec.\",\n    \"programrule\": \"0.000093 sec.\",\n    \"totalImport\": \"4.063622 sec.\"\n  },\n  \"trackerValidationReport\": {\n    \"errorReports\": [\n      {\n        \"trackerType\": \"TrackedEntity\",\n        \"uid\": \"mzllCXwP1qC\",\n        \"errorCode\": \"E1049\",\n        \"errorMessage\": \"Could not find OrganisationUnit: ``, linked to Tracked Entity.\"\n      },\n      {\n        \"trackerType\": \"TrackedEntity\",\n        \"uid\": \"mzllCXwP1qC\",\n        \"errorCode\": \"E1005\",\n        \"errorMessage\": \"Could not find TrackedEntityType: `ja8NY4PW7Xm`.\"\n      }\n    ],\n    \"warningReports\": [],\n  },\n  \"stats\": {\n    \"created\": 2,\n    \"updated\": 3,\n    \"deleted\": 0,\n    \"ignored\": 1,\n    \"total\": 6\n  }\n}", "createdAt": "2020-09-02T13:17:39Z", "url": "https://github.com/dhis2/dhis2-core/pull/6062", "merged": true, "mergeCommit": {"oid": "cb2ee65c0210c0d4b2bd8851789da8d4adfaf04d"}, "closed": true, "closedAt": "2020-09-07T08:28:22Z", "author": {"login": "enricocolasante"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE72FEAH2gAyNDc3ODE0MTc1OjY1NDFmMDRkMmQ1Y2Y4MDc4NDg3ZmU2OGIwZjk5MzJiYWViMTkxNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFoTicAFqTQ4MjgyMDM1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6541f04d2d5cf8078487fe68b0f9932baeb19147", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6541f04d2d5cf8078487fe68b0f9932baeb19147", "committedDate": "2020-09-02T13:16:24Z", "message": "fix: [DHIS2-9287] Fix the stats in the import summary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3497a54935a66bdd0305c39713d2b20ccfce1eb", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d3497a54935a66bdd0305c39713d2b20ccfce1eb", "committedDate": "2020-09-02T13:36:41Z", "message": "Fix renaming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe90145174e7ccc96845185afa4282d12fea6d01", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/fe90145174e7ccc96845185afa4282d12fea6d01", "committedDate": "2020-09-02T14:40:18Z", "message": "More fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNDM5OTkz", "url": "https://github.com/dhis2/dhis2-core/pull/6062#pullrequestreview-482439993", "createdAt": "2020-09-04T07:58:16Z", "commit": {"oid": "fe90145174e7ccc96845185afa4282d12fea6d01"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNzo1ODoxNlrOHNDpFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNzo1ODoxNlrOHNDpFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ1MzIwNg==", "bodyText": "Commented out code", "url": "https://github.com/dhis2/dhis2-core/pull/6062#discussion_r483453206", "createdAt": "2020-09-04T07:58:16Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/DefaultTrackerObjectsDeletionService.java", "diffHunk": "@@ -131,7 +131,8 @@ public TrackerTypeReport deleteEnrollments( TrackerBundle bundle, TrackerType tr\n \n             if ( !eventReport.isEmpty() )\n             {\n-                trackerObjectReport.getErrorReports().addAll( eventReport.getErrorReports() );\n+                // trackerObjectReport.getErrorReports().addAll( eventReport.getErrorReports()\n+                // );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe90145174e7ccc96845185afa4282d12fea6d01"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6444ac2ae4fbdb516b087d93ac7b75e317df844", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b6444ac2ae4fbdb516b087d93ac7b75e317df844", "committedDate": "2020-09-04T08:35:44Z", "message": "Removing unused fields from report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODIwMzU0", "url": "https://github.com/dhis2/dhis2-core/pull/6062#pullrequestreview-482820354", "createdAt": "2020-09-04T17:04:24Z", "commit": {"oid": "b6444ac2ae4fbdb516b087d93ac7b75e317df844"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2479, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}