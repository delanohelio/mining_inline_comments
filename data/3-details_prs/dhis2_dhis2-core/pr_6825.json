{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMDk5NzM5", "number": 6825, "title": "fix: Use encryption for SMS confidential parameters [DHIS2-10076]", "bodyText": "", "createdAt": "2020-12-03T20:32:18Z", "url": "https://github.com/dhis2/dhis2-core/pull/6825", "merged": true, "mergeCommit": {"oid": "e926b39289fd4b560522157748f383e0d63b0f55"}, "closed": true, "closedAt": "2020-12-10T08:43:20Z", "author": {"login": "zubaira"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiofBkgH2gAyNTMyMDk5NzM5OjI4YzI2NWU2OWRhMDJmMThiYjY0NGNlMjY0ZGUwOWNhM2RhZTBiZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdksx8YgH2gAyNTMyMDk5NzM5Ojg0Mjg4MWUyZjBiYWY1MTg1M2JkNTg0NThlMzZhNGZhNThlNjY1ZmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28c265e69da02f18bb644ce264de09ca3dae0bfc", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/28c265e69da02f18bb644ce264de09ca3dae0bfc", "committedDate": "2020-12-03T19:40:45Z", "message": "fix: Add encryption while saving confidential parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ad3f5d027aab6a327d68c69311c5ec12711a4d4", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/8ad3f5d027aab6a327d68c69311c5ec12711a4d4", "committedDate": "2020-12-03T20:20:04Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c8e81d89d389be8ef091e373829023ad56e256e", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/5c8e81d89d389be8ef091e373829023ad56e256e", "committedDate": "2020-12-03T20:29:08Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8914f9671ad81eab91d716ac5376155e94e2afde", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/8914f9671ad81eab91d716ac5376155e94e2afde", "committedDate": "2020-12-04T11:06:10Z", "message": "fix issues after server reboot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608a789d71d910c6edef4e81e3f60a99431c417b", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/608a789d71d910c6edef4e81e3f60a99431c417b", "committedDate": "2020-12-07T10:38:51Z", "message": "sonar code analysis fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95405531908f3d349b66590e9bde6fb087ea7b32", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/95405531908f3d349b66590e9bde6fb087ea7b32", "committedDate": "2020-12-07T10:49:07Z", "message": "fix compilation issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "630fdc29a09ca84e64ed60eace2a2203a1919361", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/630fdc29a09ca84e64ed60eace2a2203a1919361", "committedDate": "2020-12-07T11:04:53Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b766e220e856238e8c23334bc329eef28bfea070", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b766e220e856238e8c23334bc329eef28bfea070", "committedDate": "2020-12-08T08:55:37Z", "message": "Incase values are equal then no need to updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ed2e401ff04b539a4a321754fda923c5ef4cfb62", "committedDate": "2020-12-08T11:20:38Z", "message": "Add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3OTU1Mzc4", "url": "https://github.com/dhis2/dhis2-core/pull/6825#pullrequestreview-547955378", "createdAt": "2020-12-09T08:46:24Z", "commit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODo0NjoyNFrOICI-TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODo0NjoyNFrOICI-TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTExNTA4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        pbeStringEncryptor.decrypt( bulkSmsGatewayConfig.getPassword().trim());\n          \n          \n            \n                        pbeStringEncryptor.decrypt( bulkSmsGatewayConfig.getPassword().trim() );", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539115084", "createdAt": "2020-12-09T08:46:24Z", "author": {"login": "stian-sandvold"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/BulkSmsHttpGateway.java", "diffHunk": "@@ -87,7 +96,8 @@ public OutboundMessageResponse send( String subject, String text, Set<String> re\n \n     private HttpHeaders getRequestHeaderParameters( BulkSmsGatewayConfig bulkSmsGatewayConfig )\n     {\n-        String credentials = bulkSmsGatewayConfig.getUsername().trim() + \":\" + bulkSmsGatewayConfig.getPassword().trim();\n+        String credentials = bulkSmsGatewayConfig.getUsername().trim() + \":\" +\n+            pbeStringEncryptor.decrypt( bulkSmsGatewayConfig.getPassword().trim());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3OTU2MDk4", "url": "https://github.com/dhis2/dhis2-core/pull/6825#pullrequestreview-547956098", "createdAt": "2020-12-09T08:47:23Z", "commit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODo0NzoyM1rOICJA8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODo0NzoyM1rOICJA8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTExNTc2MQ==", "bodyText": "closing bracket on wrong line :)", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539115761", "createdAt": "2020-12-09T08:47:23Z", "author": {"login": "stian-sandvold"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/SimplisticHttpGetGateWay.java", "diffHunk": "@@ -184,8 +193,8 @@ public OutboundMessageResponse send( String subject, String text, Set<String> re\n         {\n             if ( !parameter.isHeader() )\n             {\n-                valueStore.put( parameter.getKey(), parameter.getValue() );\n-            }\n+                valueStore.put( parameter.getKey(), parameter.isConfidential() ?\n+                    pbeStringEncryptor.decrypt( parameter.getValue() ) : parameter.getValue() );            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3OTU2NDM5", "url": "https://github.com/dhis2/dhis2-core/pull/6825#pullrequestreview-547956439", "createdAt": "2020-12-09T08:47:51Z", "commit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzcyMTc0", "url": "https://github.com/dhis2/dhis2-core/pull/6825#pullrequestreview-548372174", "createdAt": "2020-12-09T16:34:22Z", "commit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjozNDoyM1rOICd_Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjozNzozMVrOICeJ2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ1OTQzMQ==", "bodyText": "Can't we just annotate this class with:\n@EqualsAndHashCode(of = {\"key\",\"value\", \"confidential\", \"encode\", \"header\"})\n?", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539459431", "createdAt": "2020-12-09T16:34:23Z", "author": {"login": "gnespolino"}, "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/sms/config/GenericGatewayParameter.java", "diffHunk": "@@ -106,4 +107,30 @@ public void setEncode( boolean encode )\n     {\n         this.encode = encode;\n     }\n+\n+    @Override\n+    public boolean equals( Object o )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2MTcyNw==", "bodyText": "@RequiredArgsConstructor\nwith\n@Qualifier( \"tripleDesStringEncryptor\" )\nprivate final PBEStringEncryptor pbeStringEncryptor;", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539461727", "createdAt": "2020-12-09T16:37:06Z", "author": {"login": "gnespolino"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/BulkSmsHttpGateway.java", "diffHunk": "@@ -50,6 +52,13 @@\n public class BulkSmsHttpGateway", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2MjEwNQ==", "bodyText": "same as BulkSmsHttpGateway", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539462105", "createdAt": "2020-12-09T16:37:31Z", "author": {"login": "gnespolino"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/ClickatellHttpGateway.java", "diffHunk": "@@ -50,6 +52,13 @@\n public class ClickatellHttpGateway", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd7691115c8f2ea55409a7f3a9f6fe68cbab4b31", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/dd7691115c8f2ea55409a7f3a9f6fe68cbab4b31", "committedDate": "2020-12-10T05:41:11Z", "message": "Merge branch 'master' into DHIS2-10076"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "842881e2f0baf51853bd58458e36a4fa58e665fe", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/842881e2f0baf51853bd58458e36a4fa58e665fe", "committedDate": "2020-12-10T05:48:53Z", "message": "resolve review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2260, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}