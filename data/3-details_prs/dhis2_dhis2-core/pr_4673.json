{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NjE0MDEw", "number": 4673, "title": "fix: Use Program Indicators to validate orgUnitField", "bodyText": "DHIS2-7552\nWhen validating the orgUnitField value the system now takes in\nconsideration the event that a Program may be null and therefore checks for\nProgram Indicators. If the EventQueryParams object contains Program Indicators,\nthe system runs the same validation against all the Programs associated\nto the Program Indicators. If at least one fails, the entire validation\nfails.", "createdAt": "2020-01-06T16:27:54Z", "url": "https://github.com/dhis2/dhis2-core/pull/4673", "merged": true, "mergeCommit": {"oid": "e1150ef82411370630ab292d812849919789c43c"}, "closed": true, "closedAt": "2020-01-08T15:54:55Z", "author": {"login": "luciano-fiandesio"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3uuWAgH2gAyMzU5NjE0MDEwOjdmNjhhM2JiOTY2NDEzOTc2ZTIyODY5MjVkNTMxMDdjZTIzYmYyNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4XcvlAH2gAyMzU5NjE0MDEwOmJlYjlhY2RiOTI5MDhhNzk3MTVkZjg4YmE0ZWE3OGEzZmNhMTA3ZjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7f68a3bb966413976e2286925d53107ce23bf262", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/7f68a3bb966413976e2286925d53107ce23bf262", "committedDate": "2020-01-06T16:27:01Z", "message": "fix: use Prg. Indicators to validate orgUnitField\n\n- DHIS2-7552\n- When validating the orgUnitField value the system now takes in\nconsideration the event that a Program may be null and also checks for\nProgram Indicators. If the EventQueryParams contains Program Indicators,\nthe system runs the same validation against all the Programs associated\nto the Program Indicators. If at least one fails, the entire validation\nfails."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODAxODEy", "url": "https://github.com/dhis2/dhis2-core/pull/4673#pullrequestreview-339801812", "createdAt": "2020-01-08T11:24:57Z", "commit": {"oid": "7f68a3bb966413976e2286925d53107ce23bf262"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMToyNDo1N1rOFbUCmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMToyNDo1N1rOFbUCmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE4NDIxNw==", "bodyText": "Since \"if at least one Program Indicator doesn't validate, we fail the validation\", could instead of checking all program indicators just break when we find one program indicator that does not validate?\n(It is needless to check all if we fail at the first false).\nInstead of using arrays we can also rewrite using a stream and anyMatch with a predicate.", "url": "https://github.com/dhis2/dhis2-core/pull/4673#discussion_r364184217", "createdAt": "2020-01-08T11:24:57Z", "author": {"login": "larshelge"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/EventQueryParams.java", "diffHunk": "@@ -500,6 +503,33 @@ public boolean orgUnitFieldIsValid()\n             return true;\n         }\n \n+        if ( program != null )\n+        {\n+            return validateProgramHasOrgUnitField( program );\n+        }\n+\n+        if ( !itemProgramIndicators.isEmpty() )\n+        {\n+            boolean[] isValidated = new boolean[itemProgramIndicators.size()];\n+\n+            for ( int i = 0; i < itemProgramIndicators.size(); i++ )\n+            {\n+                ProgramIndicator itemProgramIndicator = itemProgramIndicators.get( i );\n+                Program program = itemProgramIndicator.getProgram();\n+\n+                isValidated[i] = validateProgramHasOrgUnitField( program );\n+\n+            }\n+            // if at least one Program Indicator doesn't validate, fail the validation\n+            return !Booleans.contains( isValidated, false );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f68a3bb966413976e2286925d53107ce23bf262"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e84d405937078d7d8cae561bca2c75392e04c425", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e84d405937078d7d8cae561bca2c75392e04c425", "committedDate": "2020-01-08T11:52:27Z", "message": "chore: minor refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beb9acdb92908a79715df88ba4ea78a3fca107f1", "author": {"user": {"login": "larshelge", "name": "Lars Helge \u00d8verland"}}, "url": "https://github.com/dhis2/dhis2-core/commit/beb9acdb92908a79715df88ba4ea78a3fca107f1", "committedDate": "2020-01-08T15:53:54Z", "message": "Update EventQueryParams.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2974, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}