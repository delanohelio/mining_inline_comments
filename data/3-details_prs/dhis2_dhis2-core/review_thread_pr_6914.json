{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMjU4NDc4", "number": 6914, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOTowMzo0OFrOFHtwaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOTowMzo0OFrOFHtwaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNjM0MDI0OnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/relationship/RelationshipDeletionHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOTowMzo0OFrOIJRAEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOTowMzo0OFrOIJRAEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU4NjY0Mw==", "bodyText": "just as a suggestion:\nwe might replace this block of code which is duplicated across the whole class with a private method like:\n    private void deleteRelationships(Collection<Relationship> relationships )\n    {\n        Optional.ofNullable( relationships )\n            .orElse( Collections.emptySet() )\n            .forEach( relationshipService::deleteRelationship );\n    }\nso that each method would become just:\n    @Override\n    public void deleteProgramStageInstance( ProgramStageInstance programStageInstance )\n    {\n        deleteRelationships( relationshipService.getRelationshipsByProgramStageInstance( programStageInstance, false ) );\n    }", "url": "https://github.com/dhis2/dhis2-core/pull/6914#discussion_r546586643", "createdAt": "2020-12-21T09:03:48Z", "author": {"login": "gnespolino"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/relationship/RelationshipDeletionHandler.java", "diffHunk": "@@ -76,6 +78,37 @@ public void deleteTrackedEntityInstance( TrackedEntityInstance entityInstance )\n             }\n         }\n     }\n+    \n+    @Override\n+    public void deleteProgramStageInstance( ProgramStageInstance programStageInstance )\n+    {\n+        Collection<Relationship> relationships = relationshipService\n+            .getRelationshipsByProgramStageInstance( programStageInstance, false );\n+\n+        if ( relationships != null )\n+        {\n+            for ( Relationship relationship : relationships )\n+            {\n+                relationshipService.deleteRelationship( relationship );\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62f68a0f4cec94e9c239b8f4b6fed4e91e97ca15"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3681, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}