{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxODA5Njg3", "number": 6932, "title": "feat: DHIS2-9084 new tracker import sync endpoint", "bodyText": "", "createdAt": "2020-12-17T11:46:58Z", "url": "https://github.com/dhis2/dhis2-core/pull/6932", "merged": true, "mergeCommit": {"oid": "757b281ac024a43da56dc3f6b6bc477fe7f0ca82"}, "closed": true, "closedAt": "2020-12-21T09:09:12Z", "author": {"login": "gnespolino"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnBx9EgH2gAyNTQxODA5Njg3OmJlNDFmOTM0OTcyODZkZWI4NDVkMjk3ZjMzODlhNzk5OTA1OWQxNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoR9GoAH2gAyNTQxODA5Njg3OjgyYmJjNWJiOTgxNmQyYWVjM2ExYTgwY2YwYzJhZTAxYzM2YzQzOTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be41f93497286deb845d297f3389a7999059d153", "author": {"user": {"login": "gnespolino", "name": "Giuseppe Nespolino"}}, "url": "https://github.com/dhis2/dhis2-core/commit/be41f93497286deb845d297f3389a7999059d153", "committedDate": "2020-12-17T11:24:45Z", "message": "feat: DHIS2-9084 new tracker import sync endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NTI5OTA2", "url": "https://github.com/dhis2/dhis2-core/pull/6932#pullrequestreview-554529906", "createdAt": "2020-12-17T11:48:45Z", "commit": {"oid": "be41f93497286deb845d297f3389a7999059d153"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMTo0ODo0NVrOIHx8oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMTo0ODo0NVrOIHx8oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAyOTI4MA==", "bodyText": "we can decide whether use it like\n/tracker?async=false\n\nor\n/tracker/async\n\nthe latter was suggested by @luciano-fiandesio . Honestly I have no personal preference over the one or the other", "url": "https://github.com/dhis2/dhis2-core/pull/6932#discussion_r545029280", "createdAt": "2020-12-17T11:48:45Z", "author": {"login": "gnespolino"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/tracker/TrackerController.java", "diffHunk": "@@ -124,6 +105,56 @@ public void postJsonTracker( HttpServletRequest request, HttpServletResponse res\n                     .build() ) );\n     }\n \n+    @PostMapping( value = \"\", consumes = MediaType.APPLICATION_JSON_VALUE, params = { \"async=false\" } )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be41f93497286deb845d297f3389a7999059d153"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NTQ2MzMx", "url": "https://github.com/dhis2/dhis2-core/pull/6932#pullrequestreview-554546331", "createdAt": "2020-12-17T12:12:51Z", "commit": {"oid": "be41f93497286deb845d297f3389a7999059d153"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjoxMjo1MVrOIHyzPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjoxNDoxNlrOIHy2QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0MzI2MQ==", "bodyText": "space after parenthesis", "url": "https://github.com/dhis2/dhis2-core/pull/6932#discussion_r545043261", "createdAt": "2020-12-17T12:12:51Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/tracker/TrackerController.java", "diffHunk": "@@ -140,16 +171,7 @@ public TrackerImportReport getJobReport( @PathVariable String uid,\n         HttpServletResponse response )\n         throws HttpStatusCodeException\n     {\n-        TrackerBundleReportMode trackerBundleReportMode;\n-        try\n-        {\n-            trackerBundleReportMode = TrackerBundleReportMode.valueOf( reportMode.toUpperCase() );\n-        }\n-        catch ( IllegalArgumentException e )\n-        {\n-            throw new HttpClientErrorException( HttpStatus.BAD_REQUEST,\n-                \"Value \" + reportMode + \" is not a valid report mode\" );\n-        }\n+        TrackerBundleReportMode trackerBundleReportMode = getTrackerBundleReportMode(reportMode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be41f93497286deb845d297f3389a7999059d153"}, "originalPosition": 129}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0Mzc1OQ==", "bodyText": "formatting", "url": "https://github.com/dhis2/dhis2-core/pull/6932#discussion_r545043759", "createdAt": "2020-12-17T12:13:48Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/tracker/TrackerImportParamsBuilder.java", "diffHunk": "@@ -135,4 +136,40 @@ private static String getAttributeUidOrNull( Map<String, List<String>> parameter\n \n         return null;\n     }\n+\n+    private static TrackerIdentifier bySchemeAndKey( Map<String, List<String>> parameters,\n+                                                     TrackerImportParamKey trackerImportParameterKey,\n+                                                     TrackerIdScheme defaultIdScheme )\n+    {\n+\n+        TrackerIdScheme trackerIdScheme = getEnumWithDefault(\n+                TrackerIdScheme.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be41f93497286deb845d297f3389a7999059d153"}, "originalPosition": 186}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0NDAzMg==", "bodyText": "space after parenthesis", "url": "https://github.com/dhis2/dhis2-core/pull/6932#discussion_r545044032", "createdAt": "2020-12-17T12:14:16Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/tracker/TrackerImportParamsBuilder.java", "diffHunk": "@@ -135,4 +136,40 @@ private static String getAttributeUidOrNull( Map<String, List<String>> parameter\n \n         return null;\n     }\n+\n+    private static TrackerIdentifier bySchemeAndKey( Map<String, List<String>> parameters,\n+                                                     TrackerImportParamKey trackerImportParameterKey,\n+                                                     TrackerIdScheme defaultIdScheme )\n+    {\n+\n+        TrackerIdScheme trackerIdScheme = getEnumWithDefault(\n+                TrackerIdScheme.class,\n+                parameters,\n+                trackerImportParameterKey,\n+                defaultIdScheme );\n+\n+        return TrackerIdentifier.of( trackerIdScheme, getAttributeUidOrNull( parameters, trackerImportParameterKey ) );\n+    }\n+\n+    enum TrackerImportParamKey\n+    {\n+        VALIDATION_MODE_KEY( \"validationMode\" ),\n+        IMPORT_MODE_KEY( \"importMode\" ),\n+        IMPORT_STRATEGY_KEY( \"importStrategy\" ),\n+        ATOMIC_MODE_KEY( \"atomicMode\" ),\n+        FLUSH_MODE_KEY( \"flushMode\" ),\n+        SKIP_RULE_ENGINE_KEY( \"skipRuleEngine\" ),\n+        ID_SCHEME_KEY( \"idScheme\" ),\n+        ORG_UNIT_ID_SCHEME_KEY( \"orgUnitIdScheme\" ),\n+        PROGRAM_ID_SCHEME_KEY( \"programIdScheme\" ),\n+        PROGRAM_STAGE_ID_SCHEME_KEY( \"programStageIdScheme\" ),\n+        DATA_ELEMENT_ID_SCHEME_KEY( \"dataElementIdScheme\" );\n+\n+        @Getter\n+        private final String key;\n+\n+        TrackerImportParamKey(String key) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be41f93497286deb845d297f3389a7999059d153"}, "originalPosition": 211}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a07e7e9b1573095afaf1cdfe933164d5adcc7ec7", "author": {"user": {"login": "gnespolino", "name": "Giuseppe Nespolino"}}, "url": "https://github.com/dhis2/dhis2-core/commit/a07e7e9b1573095afaf1cdfe933164d5adcc7ec7", "committedDate": "2020-12-17T14:47:16Z", "message": "feat: DHIS2-9084 mockmvc tests added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d32f78c5b0f62e95bc1ee0a49ca600b7889e30dd", "author": {"user": {"login": "gnespolino", "name": "Giuseppe Nespolino"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d32f78c5b0f62e95bc1ee0a49ca600b7889e30dd", "committedDate": "2020-12-17T14:56:21Z", "message": "feat: DHIS2-9084 fail test on wrong response in sync invocation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MDAzODMy", "url": "https://github.com/dhis2/dhis2-core/pull/6932#pullrequestreview-556003832", "createdAt": "2020-12-20T10:16:31Z", "commit": {"oid": "d32f78c5b0f62e95bc1ee0a49ca600b7889e30dd"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMFQxMDoxNjozMVrOIJC33A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMFQxMDoxNzozNlrOIJC4aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1NTE2NA==", "bodyText": "package declaration is \"usually\" before the copyright statement. I understand its a bit tricky because there are some files which does not follow it. But the norm is before the copyright,", "url": "https://github.com/dhis2/dhis2-core/pull/6932#discussion_r546355164", "createdAt": "2020-12-20T10:16:31Z", "author": {"login": "ameenhere"}, "path": "dhis-2/dhis-web/dhis-web-api/src/test/java/org/hisp/dhis/webapi/controller/tracker/TrackerControllerTest.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ *  Copyright (c) 2004-2020, University of Oslo\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ * Redistributions of source code must retain the above copyright notice, this\n+ * list of conditions and the following disclaimer.\n+ *\n+ * Redistributions in binary form must reproduce the above copyright notice,\n+ * this list of conditions and the following disclaimer in the documentation\n+ * and/or other materials provided with the distribution.\n+ * Neither the name of the HISP project nor the names of its contributors may\n+ * be used to endorse or promote products derived from this software without\n+ * specific prior written permission.\n+ *\n+ *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ *  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ *  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ *  ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ *  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n+ *  ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\n+ */\n+\n+package org.hisp.dhis.webapi.controller.tracker;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d32f78c5b0f62e95bc1ee0a49ca600b7889e30dd"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1NTMwNA==", "bodyText": "Can we remove this if this is no longer required?", "url": "https://github.com/dhis2/dhis2-core/pull/6932#discussion_r546355304", "createdAt": "2020-12-20T10:17:36Z", "author": {"login": "ameenhere"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/tracker/TrackerController.java", "diffHunk": "@@ -80,50 +86,77 @@\n \n     private final Notifier notifier;\n \n-    public TrackerController(\n-        TrackerImportService trackerImportService,\n-        RenderService renderService,\n-        ContextService contextService,\n-        TrackerMessageManager trackerMessageManager,\n-        Notifier notifier )\n-    {\n-        this.trackerImportService = trackerImportService;\n-        this.renderService = renderService;\n-        this.contextService = contextService;\n-        this.trackerMessageManager = trackerMessageManager;\n-        this.notifier = notifier;\n-    }\n-\n     @PostMapping( value = \"\", consumes = MediaType.APPLICATION_JSON_VALUE )\n-//    @PreAuthorize( \"hasRole('ALL') or hasRole('F_TRACKER_IMPORTER_EXPERIMENTAL')\" )\n-    public void postJsonTracker( HttpServletRequest request, HttpServletResponse response, User currentUser )\n+    // @PreAuthorize( \"hasRole('ALL') or hasRole('F_TRACKER_IMPORTER_EXPERIMENTAL')\" )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d32f78c5b0f62e95bc1ee0a49ca600b7889e30dd"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82bbc5bb9816d2aec3a1a80cf0c2ae01c36c4398", "author": {"user": {"login": "gnespolino", "name": "Giuseppe Nespolino"}}, "url": "https://github.com/dhis2/dhis2-core/commit/82bbc5bb9816d2aec3a1a80cf0c2ae01c36c4398", "committedDate": "2020-12-21T08:49:20Z", "message": "feat: DHIS2-9084 package before license"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2225, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}