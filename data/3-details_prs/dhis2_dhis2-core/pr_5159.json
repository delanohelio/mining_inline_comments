{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxOTU2ODAw", "number": 5159, "title": "fix: Update SMS compression listeners to use new event/enrollment schemas", "bodyText": "NOTE: This is simply a draft PR for others to view, the final PR should use a reference to the SMS compression library in the dhis2 github org.\nThis PR updates events and enrollments with a number of important schema changes:\nEnrollments now have an enrollmentDate and incidentDate, as well as coordinates and enrollment status. Also Enrollments contain a list of events related to the enrollment.\nSimilarly, events (Simple and Tracker), have dueDate, eventDate and coordinates as well.", "createdAt": "2020-03-22T04:51:47Z", "url": "https://github.com/dhis2/dhis2-core/pull/5159", "merged": true, "mergeCommit": {"oid": "39672175e0cc8022ec79065f305c21df42670821"}, "closed": true, "closedAt": "2020-05-19T13:46:19Z", "author": {"login": "JasperTimm"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQCKJlAH2gAyMzkxOTU2ODAwOjRhMmJmMTM4MGYzMjc4YjJlNDYxODFkNzExN2IzMTBlZDVmMmU1MzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci0vSIgFqTQxNDQ2MTY1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4a2bf1380f3278b2e46181d7117b310ed5f2e533", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/4a2bf1380f3278b2e46181d7117b310ed5f2e533", "committedDate": "2020-03-22T04:39:46Z", "message": "Update Comp SMS listeners for event lists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cac191ade2cf616ed714334bc504b48cd216b9f", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/4cac191ade2cf616ed714334bc504b48cd216b9f", "committedDate": "2020-03-22T04:40:07Z", "message": "Refactor process SMS events and add tests for event lists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb94595d14f5d4cc87904479a0234d2d022d4cc9", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/eb94595d14f5d4cc87904479a0234d2d022d4cc9", "committedDate": "2020-03-22T04:40:19Z", "message": "feat: update enrollments and events with geopoints and status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b8f77fe2c28526b28c5eb87a7bfacbba6450294", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/6b8f77fe2c28526b28c5eb87a7bfacbba6450294", "committedDate": "2020-03-22T04:40:31Z", "message": "tests: update SMS listener tests for event schema changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f51b5d0c837d3d6e8bfe821c7983a5c01149c3ae", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/f51b5d0c837d3d6e8bfe821c7983a5c01149c3ae", "committedDate": "2020-03-22T04:40:41Z", "message": "tests: improve SMS listener tests with null tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "173e77ea493dfb4d1046adcb1f082b3cbe794345", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/173e77ea493dfb4d1046adcb1f082b3cbe794345", "committedDate": "2020-03-22T04:40:50Z", "message": "fix: remove unnecessary ref in SMS tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfebdcb688dacba92725ffd1f8825a6f79d94c84", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/cfebdcb688dacba92725ffd1f8825a6f79d94c84", "committedDate": "2020-03-22T04:41:03Z", "message": "fix: fix and improve SMS listener tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09bbdbc31dbad600e4f032e1a3d8622d1c27db99", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/09bbdbc31dbad600e4f032e1a3d8622d1c27db99", "committedDate": "2020-03-22T04:41:18Z", "message": "move copyright to top of file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "680d69b76bb01b4367b441f9ad1e3495e260f1ba", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/680d69b76bb01b4367b441f9ad1e3495e260f1ba", "committedDate": "2020-03-22T04:41:29Z", "message": "tests: add one small SMS listener test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76b875d4e70bff625404e1081c06956b31140fbc", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/76b875d4e70bff625404e1081c06956b31140fbc", "committedDate": "2020-03-23T10:39:45Z", "message": "update: change sms comp lib ref to dhis2 org"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzcyNTI2", "url": "https://github.com/dhis2/dhis2-core/pull/5159#pullrequestreview-379372526", "createdAt": "2020-03-23T12:14:36Z", "commit": {"oid": "76b875d4e70bff625404e1081c06956b31140fbc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f5241586773f076d69b6850e69d35e1b9dceeab", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/5f5241586773f076d69b6850e69d35e1b9dceeab", "committedDate": "2020-03-29T09:35:32Z", "message": "fix: ensure existing events are updates in SMS listeners"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4521a6635fc825e5d2a5d745dbb31164cc4a6d9", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/f4521a6635fc825e5d2a5d745dbb31164cc4a6d9", "committedDate": "2020-04-01T13:42:30Z", "message": "fix: ensure UID is used when enrolling TEIs in SMS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e37dcfecd52d0aee767ad5fb1bf43134fe687662", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/e37dcfecd52d0aee767ad5fb1bf43134fe687662", "committedDate": "2020-04-11T03:00:36Z", "message": "Merge branch 'master' of github.com:dhis2/dhis2-core into master-sms-event-schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bc457e37b4c9b11427d13b594b916f72a8e1554", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/3bc457e37b4c9b11427d13b594b916f72a8e1554", "committedDate": "2020-04-11T03:01:05Z", "message": "fix: Use TrackedEntityAttributeValueService to update values in SMS submissions\n\nFix will make sure that values updated through SMS are also reflected on the web."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28acaf78022ddedea6dcc45153b701e3a3694628", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/28acaf78022ddedea6dcc45153b701e3a3694628", "committedDate": "2020-04-11T03:01:16Z", "message": "refactor: reduce metadata calls for SMS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MzY2ODA0", "url": "https://github.com/dhis2/dhis2-core/pull/5159#pullrequestreview-397366804", "createdAt": "2020-04-21T14:08:01Z", "commit": {"oid": "28acaf78022ddedea6dcc45153b701e3a3694628"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNDowODowMVrOGJHudg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNDowODowMVrOGJHudg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxNjk1MA==", "bodyText": "Use .getUid() consistently.", "url": "https://github.com/dhis2/dhis2-core/pull/5159#discussion_r412216950", "createdAt": "2020-04-21T14:08:01Z", "author": {"login": "larshelge"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/listener/AggregateDataSetSMSListener.java", "diffHunk": "@@ -110,10 +110,10 @@ protected SMSResponse postProcess( IncomingSms sms, SMSSubmission submission )\n         String per = subm.getPeriod();\n         UID aocid = subm.getAttributeOptionCombo();\n \n-        OrganisationUnit orgUnit = organisationUnitService.getOrganisationUnit( ouid.uid );\n-        User user = userService.getUser( subm.getUserID().uid );\n+        OrganisationUnit orgUnit = organisationUnitService.getOrganisationUnit( ouid.getUID() );\n+        User user = userService.getUser( subm.getUserID().getUID() );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28acaf78022ddedea6dcc45153b701e3a3694628"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDYxNjU5", "url": "https://github.com/dhis2/dhis2-core/pull/5159#pullrequestreview-414461659", "createdAt": "2020-05-19T13:46:13Z", "commit": {"oid": "28acaf78022ddedea6dcc45153b701e3a3694628"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2793, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}