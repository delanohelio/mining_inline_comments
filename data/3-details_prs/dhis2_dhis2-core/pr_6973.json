{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNTI2Nzgw", "number": 6973, "title": "fix: [DHIS2-10109] Filter out program rules for data elements that are not supposed to be applied", "bodyText": "", "createdAt": "2020-12-21T14:48:24Z", "url": "https://github.com/dhis2/dhis2-core/pull/6973", "merged": true, "mergeCommit": {"oid": "9bb835a09bad8c762ed9fb023f8c47b242a4a790"}, "closed": true, "closedAt": "2020-12-22T20:16:49Z", "author": {"login": "enricocolasante"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoW_cggH2gAyNTQzNTI2NzgwOjZhNDYxZGUzM2Q5NTg5ZDUzOGU1Mzc4N2M0MmM3MDQyYjgxYWE2Y2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdosRZjAH2gAyNTQzNTI2NzgwOmU4OGRhNDk3N2UzNThjYmZlMjQ5MmE3OGE1NGU5YTJiOTcwMjhjNGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a461de33d9589d538e53787c42c7042b81aa6cc", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6a461de33d9589d538e53787c42c7042b81aa6cc", "committedDate": "2020-12-21T14:41:25Z", "message": "fix: [DHIS2-10109] Filter out program rules for data elements that are not supposed to be applied"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NDU3NjQ5", "url": "https://github.com/dhis2/dhis2-core/pull/6973#pullrequestreview-556457649", "createdAt": "2020-12-21T15:22:32Z", "commit": {"oid": "6a461de33d9589d538e53787c42c7042b81aa6cc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNToyMjozMlrOIJb8cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNToyMjozMlrOIJb8cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc2NTkzNw==", "bodyText": "Mocking data is a bit controversial, in general, it should be avoided. I guess in this case, it's not worth to change.", "url": "https://github.com/dhis2/dhis2-core/pull/6973#discussion_r546765937", "createdAt": "2020-12-21T15:22:32Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/test/java/org/hisp/dhis/tracker/programrule/ShowErrorWarningImplementerTest.java", "diffHunk": "@@ -71,173 +63,133 @@\n \n     private final static String EVALUATED_DATA = \"4.0\";\n \n-    @Autowired\n-    private ObjectBundleService objectBundleService;\n-\n-    @Autowired\n-    private ObjectBundleValidationService objectBundleValidationService;\n-\n-    @Autowired\n-    private RenderService _renderService;\n+    private final static String ACTIVE_ENROLLMENT_ID = \"ActiveEnrollmentUid\";\n \n-    @Autowired\n-    private UserService _userService;\n+    private final static String COMPLETED_ENROLLMENT_ID = \"CompletedEnrollmentUid\";\n \n-    @Autowired\n-    private TrackerBundleService trackerBundleService;\n+    private final static String ACTIVE_EVENT_ID = \"EventUid\";\n \n-    @Autowired\n-    private ProgramRuleService programRuleService;\n+    private final static String COMPLETED_EVENT_ID = \"CompletedEventUid\";\n \n-    @Autowired\n-    private ProgramRuleActionService programRuleActionService;\n+    private final static String ERROR_PREFIX = \"Error\";\n \n-    @Autowired\n-    private ShowWarningOnCompleteValidator warningOnCompleteImplementer;\n+    private final static String WARNING_PREFIX = \"Warning\";\n \n-    @Autowired\n-    private ShowErrorOnCompleteValidator errorOnCompleteImplementer;\n-\n-    @Autowired\n-    private ShowErrorValidator errorImplementer;\n-\n-    @Autowired\n-    private ShowWarningValidator warningImplementer;\n-\n-    private TrackerBundle trackerBundle;\n-\n-    @Override\n-    protected void setUpTest()\n-        throws IOException\n-    {\n-        renderService = _renderService;\n-        userService = _userService;\n+    private final static String ERROR_ON_COMPLETE_PREFIX = \"Error on complete\";\n \n-        Map<Class<? extends IdentifiableObject>, List<IdentifiableObject>> metadata = renderService\n-            .fromMetadata( new ClassPathResource( \"tracker/event_metadata.json\" ).getInputStream(), RenderFormat.JSON );\n+    private final static String WARNING_ON_COMPLETE_PREFIX = \"Warning on complete\";\n \n-        ObjectBundleParams params = new ObjectBundleParams();\n-        params.setObjectBundleMode( ObjectBundleMode.COMMIT );\n-        params.setImportStrategy( ImportStrategy.CREATE );\n-        params.setObjects( metadata );\n+    private final static String PROGRAM_STAGE_ID = \"ProrgamStageId\";\n \n-        ObjectBundle bundle = objectBundleService.create( params );\n-        ObjectBundleValidationReport validationReport = objectBundleValidationService.validate( bundle );\n-        assertTrue( validationReport.getErrorReports().isEmpty() );\n+    private final static String DATA_ELEMENT_ID = \"DataElementId\";\n \n-        objectBundleService.commit( bundle );\n+    private ShowWarningOnCompleteValidator warningOnCompleteImplementer = new ShowWarningOnCompleteValidator();\n \n-        Program program = bundle.getPreheat().get( PreheatIdentifier.UID, Program.class, \"BFcipDERJwr\" );\n+    private ShowErrorOnCompleteValidator errorOnCompleteImplementer = new ShowErrorOnCompleteValidator();\n \n-        ProgramRule programRule = createProgramRule( 'B',\n-            program );\n-        programRule.setCondition( \"true\" );\n-        programRuleService.addProgramRule( programRule );\n-        ProgramRuleAction programRuleActionError = createProgramRuleAction( 'A', programRule );\n-        programRuleActionError.setProgramRuleActionType( ProgramRuleActionType.SHOWERROR );\n+    private ShowErrorValidator errorImplementer = new ShowErrorValidator();\n \n-        programRuleActionError.setContent( CONTENT );\n-        programRuleActionError.setData( DATA );\n-        programRuleActionService.addProgramRuleAction( programRuleActionError );\n+    private ShowWarningValidator warningImplementer = new ShowWarningValidator();\n \n-        ProgramRuleAction programRuleActionErrorOnComplete = createProgramRuleAction( 'B', programRule );\n-        programRuleActionErrorOnComplete.setProgramRuleActionType( ProgramRuleActionType.ERRORONCOMPLETE );\n+    private TrackerBundle bundle;\n \n-        programRuleActionErrorOnComplete.setContent( CONTENT );\n-        programRuleActionErrorOnComplete.setData( DATA );\n-        programRuleActionService.addProgramRuleAction( programRuleActionErrorOnComplete );\n+    @Mock\n+    private TrackerPreheat preheat;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a461de33d9589d538e53787c42c7042b81aa6cc"}, "originalPosition": 155}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1c8333c2e0061f455c64eb74ba6e488bca5eda9", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d1c8333c2e0061f455c64eb74ba6e488bca5eda9", "committedDate": "2020-12-22T11:27:15Z", "message": "Fix code review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTI0NjEx", "url": "https://github.com/dhis2/dhis2-core/pull/6973#pullrequestreview-557124611", "createdAt": "2020-12-22T14:38:07Z", "commit": {"oid": "d1c8333c2e0061f455c64eb74ba6e488bca5eda9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2036584c67c0cb05c2de99444fda07c59f6175dd", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/2036584c67c0cb05c2de99444fda07c59f6175dd", "committedDate": "2020-12-22T14:42:02Z", "message": "Merge remote-tracking branch 'origin/master' into DHIS2-10109"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "555dfa0cc602b210c70feca098ac722e60c3a291", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/555dfa0cc602b210c70feca098ac722e60c3a291", "committedDate": "2020-12-22T14:46:32Z", "message": "Fix code smells"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14b9ef02a22a9624f04a38fe67aae1681a63ff06", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/14b9ef02a22a9624f04a38fe67aae1681a63ff06", "committedDate": "2020-12-22T15:27:47Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e88da4977e358cbfe2492a78a54e9a2b97028c4d", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e88da4977e358cbfe2492a78a54e9a2b97028c4d", "committedDate": "2020-12-22T15:29:02Z", "message": "Fix code smells"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2187, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}