{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMjk1NDc5", "number": 5343, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDowMVrODx1j8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDowMVrODx1j8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg0MzY5OnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/sms/SmsController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDowMVrOGFiWuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMzo1OTowMFrOGGmruA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1ODkzOQ==", "bodyText": "Start with uppercase \"O\".", "url": "https://github.com/dhis2/dhis2-core/pull/5343#discussion_r408458939", "createdAt": "2020-04-14T21:54:01Z", "author": {"login": "larshelge"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/sms/SmsController.java", "diffHunk": "@@ -243,14 +252,23 @@ private User getUserByPhoneNumber( String phoneNumber, String text ) throws WebM\n \n         List<User> users = userService.getUsersByPhoneNumber( phoneNumber );\n \n-        if ( users == null || users.isEmpty() )\n+        User currentUser = currentUserService.getCurrentUser();\n+\n+        if ( currentUser != null && !phoneNumber.equals( currentUser.getPhoneNumber() ) )\n         {\n-            if ( unregisteredParser != null )\n+            if ( users == null || users.isEmpty() )\n             {\n-                return null;\n+                if ( unregisteredParser != null )\n+                {\n+                    return null;\n+                }\n+\n+                // No user belong to this phone number\n+                throw new WebMessageException( WebMessageUtils.conflict( \"User's phone number is not registered in the system\" ) );\n             }\n \n-            throw new WebMessageException( WebMessageUtils.conflict( \"User not registered in the system\" ) );\n+            // current user does not belong to this number\n+            throw new WebMessageException( WebMessageUtils.conflict( \"originator's number does not match user's phone number\" ) );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05923977c7a3bdc344b5980f71fbc23d397b5f17"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU3ODQyNA==", "bodyText": "We can also say \"Phone number\" to make it clearer.", "url": "https://github.com/dhis2/dhis2-core/pull/5343#discussion_r409578424", "createdAt": "2020-04-16T13:59:00Z", "author": {"login": "larshelge"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/sms/SmsController.java", "diffHunk": "@@ -243,14 +252,23 @@ private User getUserByPhoneNumber( String phoneNumber, String text ) throws WebM\n \n         List<User> users = userService.getUsersByPhoneNumber( phoneNumber );\n \n-        if ( users == null || users.isEmpty() )\n+        User currentUser = currentUserService.getCurrentUser();\n+\n+        if ( currentUser != null && !phoneNumber.equals( currentUser.getPhoneNumber() ) )\n         {\n-            if ( unregisteredParser != null )\n+            if ( users == null || users.isEmpty() )\n             {\n-                return null;\n+                if ( unregisteredParser != null )\n+                {\n+                    return null;\n+                }\n+\n+                // No user belong to this phone number\n+                throw new WebMessageException( WebMessageUtils.conflict( \"User's phone number is not registered in the system\" ) );\n             }\n \n-            throw new WebMessageException( WebMessageUtils.conflict( \"User not registered in the system\" ) );\n+            // current user does not belong to this number\n+            throw new WebMessageException( WebMessageUtils.conflict( \"originator's number does not match user's phone number\" ) );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1ODkzOQ=="}, "originalCommit": {"oid": "05923977c7a3bdc344b5980f71fbc23d397b5f17"}, "originalPosition": 108}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3481, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}