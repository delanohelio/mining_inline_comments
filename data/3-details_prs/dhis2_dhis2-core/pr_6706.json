{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNTkyMzQw", "number": 6706, "title": "refactor: New Tracker Error reporting refactor", "bodyText": "Simplified the validation hook invocation code and the reporting logic.\nIt is now much easier to retrieve information about the \"root\" entities\nthat have failed the validation from the Validation report (ValidationErrorReporter).\n\nInvalid objects map on ValidationErrorReporter\n\nThe invalidDTOs is now a Map where the key is the tracker type (Tei, Enrollment, etc.) and the key is a list of invalid UIDs\n\nisInvalid method on ValidationErrorReporter\n\nEasily determine if a validated Tracked object has been \"marked\" invalid\n\nSimplified the validation logic within AbstractTrackerDtoValidationHook which now looks like:\n\nvalidateTrackedEntities( bundle, rootReporter, context );\nvalidateEnrollments( bundle, rootReporter, context );\nvalidateEvents( bundle, rootReporter, context );\nvalidateRelationships( bundle, rootReporter, context );\n\nOther notable changes:\nThe TrackerBundle object is cloned prior to the validation stage, since the validation stage may mutate the data in the bundle (e.g. removing failed objects)", "createdAt": "2020-11-17T17:49:20Z", "url": "https://github.com/dhis2/dhis2-core/pull/6706", "merged": true, "mergeCommit": {"oid": "0bf55d776481f6511e5f9ebca5de1f2cf79777c0"}, "closed": true, "closedAt": "2020-11-19T12:55:47Z", "author": {"login": "luciano-fiandesio"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddtOU-gH2gAyNTIyNTkyMzQwOjc0YmZjM2VmMzc3MGZjMDdjNDUwMDE3MjEzNTdjNmM1ZDI4MDhkNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeCQ_gAFqTUzNDQwODE1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "74bfc3ef3770fc07c45001721357c6c5d2808d40", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/74bfc3ef3770fc07c45001721357c6c5d2808d40", "committedDate": "2020-11-18T12:22:25Z", "message": "refactor: New Tracker Error reporting refactor\n\nSimplified the validation hook invocation code and the reporting logic.\nIt is now much easier to retrieve information about the \"root\" entities\nthat have failed the validation from the Validation report (`ValidationErrorReporter`).\n\n1) Invalid objects map on `ValidationErrorReporter`\n\nThe `invalidDTOs` is now a Map where the key is the tracker type (Tei, Enrollment, etc.) and the key is a list of invalid UIDs\n\n2) `isInvalid` method on `ValidationErrorReporter`\n\nEasily determine if a validated Tracked object has been \"marked\" invalid\n\n3) Simplified the validation logic within `AbstractTrackerDtoValidationHook` which now looks like:\n\n```\nvalidateTrackedEntities( bundle, rootReporter, context );\nvalidateEnrollments( bundle, rootReporter, context );\nvalidateEvents( bundle, rootReporter, context );\nvalidateRelationships( bundle, rootReporter, context );\n```\n\nOther notable changes:\n\nThe `TrackerBundle` object is cloned prior to the validation stage, since the validation stage may mutate the data in the bundle (e.g. removing failed objects)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6aec8637203868c45691db081eb3710121fa71bf", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6aec8637203868c45691db081eb3710121fa71bf", "committedDate": "2020-11-18T12:22:28Z", "message": "fix Sonar issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "committedDate": "2020-11-18T12:22:28Z", "message": "chore: add header to new classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da8f3f74ec252d01025a380afa06e180c82c5d2c", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/da8f3f74ec252d01025a380afa06e180c82c5d2c", "committedDate": "2020-11-18T07:13:00Z", "message": "chore: add header to new classes"}, "afterCommit": {"oid": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "committedDate": "2020-11-18T12:22:28Z", "message": "chore: add header to new classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTYyMjg0", "url": "https://github.com/dhis2/dhis2-core/pull/6706#pullrequestreview-534162284", "createdAt": "2020-11-19T08:04:32Z", "commit": {"oid": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODowNDozMlrOH2Q52Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODowNDozMlrOH2Q52Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2MjEwNQ==", "bodyText": "We could maybe call this another way: at least \"mainUid\".\nI personally do not like how the word main is used here because it makes you think that there are other less important uids somewhere.\nMaybe just uid would make the job.", "url": "https://github.com/dhis2/dhis2-core/pull/6706#discussion_r526662105", "createdAt": "2020-11-19T08:04:32Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/report/ValidationErrorReporter.java", "diffHunk": "@@ -54,42 +65,71 @@\n \n     private final TrackerImportValidationContext validationContext;\n \n-    private final Class<?> mainKlass;\n-\n-    private final AtomicInteger listIndex = new AtomicInteger( 0 );\n-\n+    /*\n+     * The Tracker object uid to which this reporter is associated.\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDA4MTU1", "url": "https://github.com/dhis2/dhis2-core/pull/6706#pullrequestreview-534408155", "createdAt": "2020-11-19T12:53:20Z", "commit": {"oid": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2283, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}