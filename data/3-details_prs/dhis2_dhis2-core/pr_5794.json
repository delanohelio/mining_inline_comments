{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMDQzOTE4", "number": 5794, "title": "feat: support transforming properties using DTOs", "bodyText": "Adds annotation PropertyTransformer, and interface PropertyTransformer\nAdds UserPropertyTransformer for BaseIdObject.user\nAdds example of UserPropertyTransformer (including Jackson support), not enabled anywhere except for tests", "createdAt": "2020-06-28T11:37:12Z", "url": "https://github.com/dhis2/dhis2-core/pull/5794", "merged": true, "mergeCommit": {"oid": "01a4d5120c146dc376d614d5ff31e76679bc6921"}, "closed": true, "closedAt": "2020-08-03T07:19:12Z", "author": {"login": "mortenoh"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvq2VagH2gAyNDQxMDQzOTE4OjBiNjYwZWFlZTQwMWNmNjRiNDQwZmIxOTFlNjdmMTg4NDZjYTRlNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7MvuOAFqTQ1OTc5ODk3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0b660eaee401cf64b440fb191e67f18846ca4e73", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/0b660eaee401cf64b440fb191e67f18846ca4e73", "committedDate": "2020-06-28T11:35:53Z", "message": "feat: adds @PropertyTransform, and PropertyTransform (interface) for pre-transforming field properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8ec234f83b743214e296f594b1cc65ec643a257", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d8ec234f83b743214e296f594b1cc65ec643a257", "committedDate": "2020-06-28T11:41:33Z", "message": "fix: make UserDto private static"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4a7b49507c2b77cef8963160ee45f1ef83493ec", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f4a7b49507c2b77cef8963160ee45f1ef83493ec", "committedDate": "2020-06-28T11:43:14Z", "message": "fix: support only User objects in UserPropertyTransformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342b6784a23678b514c3b379086b1042ba841a7a", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/342b6784a23678b514c3b379086b1042ba841a7a", "committedDate": "2020-06-29T07:28:27Z", "message": "fix: rename PropertyTransform => PropertyTransformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a6452f3508d78e7b5b39ebb700df6b60c70a615", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6a6452f3508d78e7b5b39ebb700df6b60c70a615", "committedDate": "2020-06-30T06:45:09Z", "message": "Merge remote-tracking branch 'origin/master' into TECH-388"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea71a8acc018860716c7880ff45a93cb872badeb", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ea71a8acc018860716c7880ff45a93cb872badeb", "committedDate": "2020-06-30T10:44:03Z", "message": "feat: adds propertyTransformer to Property class, adds PT by looking at PT annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf5b31b20b340f433e716e1efe71ae2472b0970b", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/bf5b31b20b340f433e716e1efe71ae2472b0970b", "committedDate": "2020-07-06T10:52:57Z", "message": "Merge remote-tracking branch 'origin/master' into TECH-388"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6edebd6ecb1bdb1484e2d8b7833106d170917aa8", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6edebd6ecb1bdb1484e2d8b7833106d170917aa8", "committedDate": "2020-07-09T12:21:00Z", "message": "fix: support propertyTransformer at property depth0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e180dad05505f43718da6ffb80a7517e41f5d1f", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6e180dad05505f43718da6ffb80a7517e41f5d1f", "committedDate": "2020-07-09T12:21:12Z", "message": "Merge remote-tracking branch 'origin/master' into TECH-388"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27aae6025c2323a8a50c5e9649ab69059b49a7c3", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/27aae6025c2323a8a50c5e9649ab69059b49a7c3", "committedDate": "2020-07-09T12:40:17Z", "message": "fix: add propertytransformer to DataElementGroup.getUser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41604aa29aa6f7902676dc517995c5b51c54c6b1", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/41604aa29aa6f7902676dc517995c5b51c54c6b1", "committedDate": "2020-07-09T21:49:35Z", "message": "Merge remote-tracking branch 'origin/master' into TECH-388"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6cdf40db02e6d327038302b09934b3b827a683b", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b6cdf40db02e6d327038302b09934b3b827a683b", "committedDate": "2020-07-10T08:46:11Z", "message": "Merge remote-tracking branch 'origin/master' into TECH-388"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "293e4154586c4845769423902885d291defeeb39", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/293e4154586c4845769423902885d291defeeb39", "committedDate": "2020-07-10T11:14:52Z", "message": "feat: support deserializing using Jackson"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "235a99ad0b76a90b576a3f7914bbd597c45d1de8", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/235a99ad0b76a90b576a3f7914bbd597c45d1de8", "committedDate": "2020-07-27T07:00:33Z", "message": "Merge remote-tracking branch 'origin/master' into TECH-388"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ff673276ea33cbd6ee3626b13b05582beb7286e", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/3ff673276ea33cbd6ee3626b13b05582beb7286e", "committedDate": "2020-07-27T09:39:57Z", "message": "fix: support uid as identifier (useful for tests)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb8810b69ab303b0845a88fa99a03e03eaf27b7", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/efb8810b69ab303b0845a88fa99a03e03eaf27b7", "committedDate": "2020-07-27T09:51:17Z", "message": "fix: support code in UserDto deserializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e195f53f768892a5ec1a40a6842eb28f282575ce", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e195f53f768892a5ec1a40a6842eb28f282575ce", "committedDate": "2020-07-28T13:18:21Z", "message": "test: UserPropertyTransformer tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8910bacc6286dbf508a99ef025659087d5724da", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b8910bacc6286dbf508a99ef025659087d5724da", "committedDate": "2020-07-30T07:28:32Z", "message": "Merge remote-tracking branch 'origin/master' into TECH-388"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f816778582b84565656227a6b915c03d7027a5e", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4f816778582b84565656227a6b915c03d7027a5e", "committedDate": "2020-07-30T09:59:26Z", "message": "test: adds tests for json/xml serdes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81f85669129a50f4453351659d58055884b4d6a1", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/81f85669129a50f4453351659d58055884b4d6a1", "committedDate": "2020-07-30T10:23:04Z", "message": "test: adds xml/json payload asserts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69329de64cb7c6dbc10b0dac80a6642adfc28663", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/69329de64cb7c6dbc10b0dac80a6642adfc28663", "committedDate": "2020-07-30T10:25:33Z", "message": "chore: newline fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4Mjg4OTI0", "url": "https://github.com/dhis2/dhis2-core/pull/5794#pullrequestreview-458288924", "createdAt": "2020-07-30T10:46:14Z", "commit": {"oid": "69329de64cb7c6dbc10b0dac80a6642adfc28663"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMDo0NjoxNFrOG5d3sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMTowODo0NlrOG5ehQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkxMTQxMQ==", "bodyText": "Would be good to have Javadocs here", "url": "https://github.com/dhis2/dhis2-core/pull/5794#discussion_r462911411", "createdAt": "2020-07-30T10:46:14Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/schema/PropertyTransformer.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package org.hisp.dhis.schema;\n+\n+/*\n+ * Copyright (c) 2004-2020, University of Oslo\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ * Redistributions of source code must retain the above copyright notice, this\n+ * list of conditions and the following disclaimer.\n+ *\n+ * Redistributions in binary form must reproduce the above copyright notice,\n+ * this list of conditions and the following disclaimer in the documentation\n+ * and/or other materials provided with the distribution.\n+ * Neither the name of the HISP project nor the names of its contributors may\n+ * be used to endorse or promote products derived from this software without\n+ * specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n+ * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+\n+/**\n+ * @author Morten Olav Hansen <mortenoh@gmail.com>\n+ */\n+@FunctionalInterface", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69329de64cb7c6dbc10b0dac80a6642adfc28663"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyMjA1MA==", "bodyText": "Consider using a \"caching\" layer here to avoid using reflection, which in this specific case could happen quite often, since the User is often part of payloads.", "url": "https://github.com/dhis2/dhis2-core/pull/5794#discussion_r462922050", "createdAt": "2020-07-30T11:08:46Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-services/dhis-service-node/src/main/java/org/hisp/dhis/fieldfilter/DefaultFieldFilterService.java", "diffHunk": "@@ -277,7 +285,36 @@ private AbstractNode buildNode( FieldMap fieldMap, Class<?> klass, Object object\n             Object returnValue = ReflectionUtils.invokeMethod( object, property.getGetterMethod() );\n             Class<?> propertyClass = property.getKlass();\n             Schema propertySchema = schemaService.getDynamicSchema( propertyClass );\n-            if ( returnValue != null && propertySchema.getProperties().isEmpty() && !property.isCollection() && property.getKlass().isInterface() && !property.isIdentifiableObject() )\n+\n+            if ( property.hasPropertyTransformer() )\n+            {\n+                PropertyTransformer propertyTransformer;\n+\n+                try\n+                {\n+                    propertyTransformer = property.getPropertyTransformer().newInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69329de64cb7c6dbc10b0dac80a6642adfc28663"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "708bbfe5a66d554ee7f175b9c173ab2a42c166ad", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/708bbfe5a66d554ee7f175b9c173ab2a42c166ad", "committedDate": "2020-07-31T09:05:03Z", "message": "fix: add caching layer to PropertyTransformer newInstance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c19f9918d225b20857a927bb57c7ae5618a95273", "author": {"user": {"login": "mortenoh", "name": "Morten Hansen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/c19f9918d225b20857a927bb57c7ae5618a95273", "committedDate": "2020-07-31T09:21:26Z", "message": "doc: docs for PropertyTransformer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NzgwNzU5", "url": "https://github.com/dhis2/dhis2-core/pull/5794#pullrequestreview-459780759", "createdAt": "2020-08-03T06:41:21Z", "commit": {"oid": "c19f9918d225b20857a927bb57c7ae5618a95273"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5Nzk4OTc5", "url": "https://github.com/dhis2/dhis2-core/pull/5794#pullrequestreview-459798979", "createdAt": "2020-08-03T07:18:36Z", "commit": {"oid": "c19f9918d225b20857a927bb57c7ae5618a95273"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2612, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}