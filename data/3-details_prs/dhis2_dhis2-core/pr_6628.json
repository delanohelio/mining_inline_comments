{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MTUxMDgz", "number": 6628, "title": "fix: send message rule action when stage is part of registration [DHIS2-9935]", "bodyText": "Due to recent refactor of event service program rule actions were ignored when program stage appears on tracker registration page.\n\nPublishEventPostProcessor is added to the processor chain while inserting new events.\nUsed @TransactionalEventListener with fallbackExecution = true\n\nPerformance testing on the feature branch\n\nPerformance testing on the master branch", "createdAt": "2020-11-11T11:57:00Z", "url": "https://github.com/dhis2/dhis2-core/pull/6628", "merged": true, "mergeCommit": {"oid": "f7525b730472ced1f1a3245e78f9c63b2d9c7b1b"}, "closed": true, "closedAt": "2021-01-05T11:04:25Z", "author": {"login": "zubaira"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbcoluAH2gAyNTE5MTUxMDgzOjAwZGMyOTI2ZDkyZjE0MTlkZGU3NDE4NzNiZGE2ZDExZGViNzgwZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds33vfAH2gAyNTE5MTUxMDgzOjc0OWJiZThiZmViOGMxOTNkZjU0MDViNzYwYzg0YTg5OTJiNTMzNmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "00dc2926d92f1419dde741873bda6d11deb780e2", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/00dc2926d92f1419dde741873bda6d11deb780e2", "committedDate": "2020-11-11T11:54:52Z", "message": "fix: send message rule action when ps is part of registration [DHIS2-9935]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8691c69af4d255fe64ae5e0699152b8163b12dfa", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/8691c69af4d255fe64ae5e0699152b8163b12dfa", "committedDate": "2020-11-11T11:56:29Z", "message": "minor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5602b51c721051c40ae694c109a7d4991cc2960", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e5602b51c721051c40ae694c109a7d4991cc2960", "committedDate": "2020-11-11T13:07:27Z", "message": "refactor to avoid work context reload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11953a57b2fdc0b6e9da6e65a4032e168950213b", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/11953a57b2fdc0b6e9da6e65a4032e168950213b", "committedDate": "2020-11-16T15:38:29Z", "message": "Merge branch 'master' into DHIS2-9935"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1f8dfdba4ad931a00cfec4b5dc9f267df031ef7", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b1f8dfdba4ad931a00cfec4b5dc9f267df031ef7", "committedDate": "2020-11-17T09:00:41Z", "message": "removed unused method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa466b7ceac35279c5714d5c4d2ead4ff93d8d20", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/fa466b7ceac35279c5714d5c4d2ead4ff93d8d20", "committedDate": "2020-11-17T09:00:52Z", "message": "Merge branch 'master' into DHIS2-9935"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Mzg0Njg5", "url": "https://github.com/dhis2/dhis2-core/pull/6628#pullrequestreview-554384689", "createdAt": "2020-12-17T08:44:20Z", "commit": {"oid": "fa466b7ceac35279c5714d5c4d2ead4ff93d8d20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a11da5c7bec3fe93908c72773323253a60b997e", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/7a11da5c7bec3fe93908c72773323253a60b997e", "committedDate": "2020-12-21T07:23:12Z", "message": "Merge branch 'master' into DHIS2-9935"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b295a8b6a10b3016ce3f73bc9800517f08ad5993", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b295a8b6a10b3016ce3f73bc9800517f08ad5993", "committedDate": "2020-12-21T08:54:43Z", "message": "Add use EventListener instead of TransactionalEventListener"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NDQ0OTA0", "url": "https://github.com/dhis2/dhis2-core/pull/6628#pullrequestreview-556444904", "createdAt": "2020-12-21T15:05:25Z", "commit": {"oid": "b295a8b6a10b3016ce3f73bc9800517f08ad5993"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTowNToyNlrOIJbXLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTowNToyNlrOIJbXLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc1NjM5OA==", "bodyText": "Is this dependency needed?\nIt is passed in the methods as a parameter", "url": "https://github.com/dhis2/dhis2-core/pull/6628#discussion_r546756398", "createdAt": "2020-12-21T15:05:26Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/importer/EventManager.java", "diffHunk": "@@ -82,6 +85,9 @@\n     @NonNull\n     private final ProcessingManager processingManager;\n \n+    @Nonnull\n+    private final WorkContextLoader contextLoader;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b295a8b6a10b3016ce3f73bc9800517f08ad5993"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3028f46187c36833c609bafa8fd1f4a10a134cb5", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/3028f46187c36833c609bafa8fd1f4a10a134cb5", "committedDate": "2020-12-22T07:44:31Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6b4cfd3f2056dee924d7b01ffc1121375829de6", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/a6b4cfd3f2056dee924d7b01ffc1121375829de6", "committedDate": "2020-12-22T14:27:51Z", "message": "Use fallbackExecution flag to invoke event even if there is no transaction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDY4NDI5", "url": "https://github.com/dhis2/dhis2-core/pull/6628#pullrequestreview-559468429", "createdAt": "2020-12-29T10:23:23Z", "commit": {"oid": "a6b4cfd3f2056dee924d7b01ffc1121375829de6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMDoyMzoyM1rOIMMCWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMDoyMzoyM1rOIMMCWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MTAzNA==", "bodyText": "@luciano-fiandesio I need your feedback on this change.", "url": "https://github.com/dhis2/dhis2-core/pull/6628#discussion_r549651034", "createdAt": "2020-12-29T10:23:23Z", "author": {"login": "zubaira"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/program/notification/ProgramNotificationListener.java", "diffHunk": "@@ -73,13 +68,13 @@ public void onEvent( ProgramStageCompletionNotificationEvent event )\n     }\n \n     // Published by rule engine\n-    @TransactionalEventListener\n+    @TransactionalEventListener( fallbackExecution = true )\n     public void onProgramRuleEnrollment( ProgramRuleEnrollmentEvent event )\n     {\n         programNotificationService.sendProgramRuleTriggeredNotifications( event.getTemplate(), event.getProgramInstance() );\n     }\n \n-    @TransactionalEventListener\n+    @TransactionalEventListener( fallbackExecution = true )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6b4cfd3f2056dee924d7b01ffc1121375829de6"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e1f0d991061f2286379751993b95478cb527920", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6e1f0d991061f2286379751993b95478cb527920", "committedDate": "2020-12-29T10:35:21Z", "message": "Merge branch 'master' into DHIS2-9935"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "398ea7dbe946289ea3672bba14af45ba9d2bbea9", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/398ea7dbe946289ea3672bba14af45ba9d2bbea9", "committedDate": "2020-12-30T08:20:52Z", "message": "use fallbackExecution flag in notification and rule listeners"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwODQ0MDkz", "url": "https://github.com/dhis2/dhis2-core/pull/6628#pullrequestreview-560844093", "createdAt": "2021-01-04T08:21:39Z", "commit": {"oid": "398ea7dbe946289ea3672bba14af45ba9d2bbea9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcb0671e6a4e55875e4fafcf9142a8f9354f0d1d", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/fcb0671e6a4e55875e4fafcf9142a8f9354f0d1d", "committedDate": "2021-01-04T14:11:14Z", "message": "minor code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMTAxMjg5", "url": "https://github.com/dhis2/dhis2-core/pull/6628#pullrequestreview-561101289", "createdAt": "2021-01-04T15:05:57Z", "commit": {"oid": "398ea7dbe946289ea3672bba14af45ba9d2bbea9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "749bbe8bfeb8c193df5405b760c84a8992b5336f", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/749bbe8bfeb8c193df5405b760c84a8992b5336f", "committedDate": "2021-01-04T15:15:34Z", "message": "Merge branch 'master' into DHIS2-9935"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2330, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}