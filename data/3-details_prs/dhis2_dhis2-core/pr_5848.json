{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4Njg5NjEy", "number": 5848, "title": "feat: ProgramInstance pre-heater", "bodyText": "A new pre-heater responsible for pre-loading Program Instances for\nevents that do not have the enrollment field set.\nThe Program Instances are then evaluated during the validation stage.\nref: TECH-402 (https://jira.dhis2.org/browse/TECH-402)", "createdAt": "2020-07-14T07:03:40Z", "url": "https://github.com/dhis2/dhis2-core/pull/5848", "merged": true, "mergeCommit": {"oid": "4c92c6dcc7bae69cef6889b95f7882ac8364ab80"}, "closed": true, "closedAt": "2020-08-04T13:04:47Z", "author": {"login": "luciano-fiandesio"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0wheWgH2gAyNDQ4Njg5NjEyOjBhMmE3Zjk0MThjMjE3NjAyZjc4ZWI3MDFlMjUxMjk0ZDQ5MTk5MTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5TSWIAFqTQ1NjQ3NTUxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0a2a7f9418c217602f78eb701e251294d4919912", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/0a2a7f9418c217602f78eb701e251294d4919912", "committedDate": "2020-07-14T07:02:09Z", "message": "feat: ProgramInstance pre-heater\n\nA new pre-heater responsible for pre-loading Program Instances for\nevents that do not have the enrollment field set.\nThe Program Instances are then evaluated during the validation stage.\n\nref: TECH-402 (https://jira.dhis2.org/browse/TECH-402)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3ec92fb23590e899435527adee34dc10bdc8227", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f3ec92fb23590e899435527adee34dc10bdc8227", "committedDate": "2020-07-14T09:05:16Z", "message": "fix: compilation error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3OTMwMzQx", "url": "https://github.com/dhis2/dhis2-core/pull/5848#pullrequestreview-447930341", "createdAt": "2020-07-14T09:13:01Z", "commit": {"oid": "f3ec92fb23590e899435527adee34dc10bdc8227"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwOToxMzowMVrOGxLNPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwOToxNTo0MlrOGxLTlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIxNzAyMg==", "bodyText": "typo: size -> side?", "url": "https://github.com/dhis2/dhis2-core/pull/5848#discussion_r454217022", "createdAt": "2020-07-14T09:13:01Z", "author": {"login": "netroms"}, "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/program/ProgramInstanceStore.java", "diffHunk": "@@ -138,4 +139,26 @@\n      * @param programInstance the ProgramInstance to delete.\n      */\n     void hardDelete( ProgramInstance programInstance );\n+\n+    /**\n+     * Executes a query to fetch all {@see ProgramInstance} matching the\n+     * Program/TrackedEntityInstance list.\n+     *\n+     * Resulting SQL query:\n+     *\n+     * <pre>{@code\n+     *  select programinstanceid, programid, trackedentityinstanceid\n+     *      from programinstance\n+     *      where (programid = 726 and trackedentityinstanceid = 19 and status = 'ACTIVE')\n+     *         or (programid = 726 and trackedentityinstanceid = 18 and status = 'ACTIVE')\n+     *         or (programid = 726 and trackedentityinstanceid = 17 and status = 'ACTIVE')\n+     * }</pre>\n+     *\n+     * @param programTeiPair a List of Pair, where the left size is a {@see Program}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ec92fb23590e899435527adee34dc10bdc8227"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIxNzMzNg==", "bodyText": "left -> right?", "url": "https://github.com/dhis2/dhis2-core/pull/5848#discussion_r454217336", "createdAt": "2020-07-14T09:13:36Z", "author": {"login": "netroms"}, "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/program/ProgramInstanceStore.java", "diffHunk": "@@ -138,4 +139,26 @@\n      * @param programInstance the ProgramInstance to delete.\n      */\n     void hardDelete( ProgramInstance programInstance );\n+\n+    /**\n+     * Executes a query to fetch all {@see ProgramInstance} matching the\n+     * Program/TrackedEntityInstance list.\n+     *\n+     * Resulting SQL query:\n+     *\n+     * <pre>{@code\n+     *  select programinstanceid, programid, trackedentityinstanceid\n+     *      from programinstance\n+     *      where (programid = 726 and trackedentityinstanceid = 19 and status = 'ACTIVE')\n+     *         or (programid = 726 and trackedentityinstanceid = 18 and status = 'ACTIVE')\n+     *         or (programid = 726 and trackedentityinstanceid = 17 and status = 'ACTIVE')\n+     * }</pre>\n+     *\n+     * @param programTeiPair a List of Pair, where the left size is a {@see Program}\n+     *        and the left side is a {@see TrackedEntityInstance}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ec92fb23590e899435527adee34dc10bdc8227"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIxODY0Ng==", "bodyText": "Does it make sense to send in null here? Might it be better to not allow null, since null might indicate a bug? Use checkNotNull and cast a np?", "url": "https://github.com/dhis2/dhis2-core/pull/5848#discussion_r454218646", "createdAt": "2020-07-14T09:15:42Z", "author": {"login": "netroms"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/program/hibernate/HibernateProgramInstanceStore.java", "diffHunk": "@@ -328,6 +330,39 @@ public void hardDelete( ProgramInstance programInstance )\n         getSession().delete( programInstance );\n     }\n \n+    @Override\n+    public List<ProgramInstance> getByProgramAndTrackedEntityInstance(\n+        List<Pair<Program, TrackedEntityInstance>> programTeiPair, ProgramStatus programStatus )\n+    {\n+        if ( programTeiPair == null || programTeiPair.isEmpty() )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ec92fb23590e899435527adee34dc10bdc8227"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ace59d625e16c2883ac20d32f88c681d72ee3f3c", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ace59d625e16c2883ac20d32f88c681d72ee3f3c", "committedDate": "2020-07-14T09:29:49Z", "message": "chore: code review fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba2bbf2e07bd1f65caeb1e04dcd1ce65370c7a25", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ba2bbf2e07bd1f65caeb1e04dcd1ce65370c7a25", "committedDate": "2020-07-14T09:49:22Z", "message": "fix: handle NPE in preheat hook"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e62bcedaeb5c5b8c3a550e76961acb68ca002cb6", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e62bcedaeb5c5b8c3a550e76961acb68ca002cb6", "committedDate": "2020-07-14T10:23:46Z", "message": "chore: formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4aa7e0d126657c341427c44cb7d9b2800b044ea", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d4aa7e0d126657c341427c44cb7d9b2800b044ea", "committedDate": "2020-07-14T10:32:33Z", "message": "fix: use enrollment uid to fetch an enrollment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "615f9676329046c954fa4cbe07234273980b001a", "author": {"user": {"login": "netroms", "name": null}}, "url": "https://github.com/dhis2/dhis2-core/commit/615f9676329046c954fa4cbe07234273980b001a", "committedDate": "2020-07-14T12:13:08Z", "message": "* refactored EventCountValidationHook.java into PreCheckDataRelationsValidationHook.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daa5a970e0c93301ca4cbc676731dcbb1e846fa9", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/daa5a970e0c93301ca4cbc676731dcbb1e846fa9", "committedDate": "2020-07-14T12:23:22Z", "message": "chore: renamed method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07b9f0658356e7b60659651ee989460e50e1be8", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/c07b9f0658356e7b60659651ee989460e50e1be8", "committedDate": "2020-07-14T13:02:03Z", "message": "fix: removed todo, fixed one test, ignored another"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88b69c7c9d78d6eaf767a96c9b44f18f933fa510", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/88b69c7c9d78d6eaf767a96c9b44f18f933fa510", "committedDate": "2020-07-14T13:35:22Z", "message": "chore: removed unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7f0f0de208eea76280eb69f45d329c6ae63fc4c", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e7f0f0de208eea76280eb69f45d329c6ae63fc4c", "committedDate": "2020-07-14T14:47:03Z", "message": "chore: address sonarqube issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzY1NjI5", "url": "https://github.com/dhis2/dhis2-core/pull/5848#pullrequestreview-448765629", "createdAt": "2020-07-15T09:04:43Z", "commit": {"oid": "88b69c7c9d78d6eaf767a96c9b44f18f933fa510"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwOTowNDo0NFrOGx1IDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwOTowNDo0NFrOGx1IDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkwMzgyMw==", "bodyText": "key->value?", "url": "https://github.com/dhis2/dhis2-core/pull/5848#discussion_r454903823", "createdAt": "2020-07-15T09:04:44Z", "author": {"login": "netroms"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/preheat/TrackerPreheat.java", "diffHunk": "@@ -131,10 +131,12 @@\n     private Map<TrackerIdScheme, Map<String, Relationship>> relationships = new EnumMap<>( TrackerIdScheme.class );\n \n     /**\n-     *\n+     * A Map of event uid and preheated {@see ProgramInstance}. The key is a List,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88b69c7c9d78d6eaf767a96c9b44f18f933fa510"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzY2ODkx", "url": "https://github.com/dhis2/dhis2-core/pull/5848#pullrequestreview-448766891", "createdAt": "2020-07-15T09:06:22Z", "commit": {"oid": "e7f0f0de208eea76280eb69f45d329c6ae63fc4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba9b9d076f0497f9f456794c391f28072c0c07fd", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ba9b9d076f0497f9f456794c391f28072c0c07fd", "committedDate": "2020-07-15T09:08:57Z", "message": "chore: fix Javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NTE2NTM0", "url": "https://github.com/dhis2/dhis2-core/pull/5848#pullrequestreview-455516534", "createdAt": "2020-07-27T07:00:12Z", "commit": {"oid": "ba9b9d076f0497f9f456794c391f28072c0c07fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NDc1MjMw", "url": "https://github.com/dhis2/dhis2-core/pull/5848#pullrequestreview-456475230", "createdAt": "2020-07-28T09:47:34Z", "commit": {"oid": "ba9b9d076f0497f9f456794c391f28072c0c07fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwOTo0NzozNFrOG4FKtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwOTo0NzozNFrOG4FKtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ1ODEwMg==", "bodyText": "Any reason why this is Ignored?", "url": "https://github.com/dhis2/dhis2-core/pull/5848#discussion_r461458102", "createdAt": "2020-07-28T09:47:34Z", "author": {"login": "stian-sandvold"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/test/java/org/hisp/dhis/tracker/validation/EventImportValidationTest.java", "diffHunk": "@@ -605,6 +596,7 @@ public void testTeiNotEnrolled()\n     }\n \n     @Test\n+    @Ignore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba9b9d076f0497f9f456794c391f28072c0c07fd"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NDc1NTE4", "url": "https://github.com/dhis2/dhis2-core/pull/5848#pullrequestreview-456475518", "createdAt": "2020-07-28T09:48:00Z", "commit": {"oid": "ba9b9d076f0497f9f456794c391f28072c0c07fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2567, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}