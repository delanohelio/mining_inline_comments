{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2OTUyOTEw", "number": 6045, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoxOTowNlrOEf1mlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoxOToyMVrOEf1myg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODE5NTQwOnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-services/dhis-service-node/src/main/java/org/hisp/dhis/fieldfilter/DefaultFieldFilterService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoxOTowNlrOHMXb2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoyMzoyMlrOHMXizg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjcyODkyMw==", "bodyText": "Maybe add a little message to this possible require non null, I guess this is not supposed to happen, but if... a small explanation what is possibly wrong could be nice, will also work as a sort of documentation possibly.", "url": "https://github.com/dhis2/dhis2-core/pull/6045#discussion_r482728923", "createdAt": "2020-09-03T06:19:06Z", "author": {"login": "netroms"}, "path": "dhis-2/dhis-services/dhis-service-node/src/main/java/org/hisp/dhis/fieldfilter/DefaultFieldFilterService.java", "diffHunk": "@@ -429,11 +424,22 @@ else if ( property.isIdentifiableObject() && isProperIdObject( propertyClass ) )\n                     child = new CollectionNode( property.getCollectionName() );\n                     child.setNamespace( property.getNamespace() );\n \n-                    for ( Object collectionObject : (Collection<?>) returnValue )\n+                    for ( Object collectionObject : (Collection<?>) Objects.requireNonNull( returnValue ) )\n                     {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8af4efdc08020a0bbfbe3d2a4c5650e8e7d2a87"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczMDcwMg==", "bodyText": "Yeah, it was basically to get rid of a IDE warning.. it has been working for the last 6 years :) there is no reason it would ever be null.", "url": "https://github.com/dhis2/dhis2-core/pull/6045#discussion_r482730702", "createdAt": "2020-09-03T06:23:22Z", "author": {"login": "mortenoh"}, "path": "dhis-2/dhis-services/dhis-service-node/src/main/java/org/hisp/dhis/fieldfilter/DefaultFieldFilterService.java", "diffHunk": "@@ -429,11 +424,22 @@ else if ( property.isIdentifiableObject() && isProperIdObject( propertyClass ) )\n                     child = new CollectionNode( property.getCollectionName() );\n                     child.setNamespace( property.getNamespace() );\n \n-                    for ( Object collectionObject : (Collection<?>) returnValue )\n+                    for ( Object collectionObject : (Collection<?>) Objects.requireNonNull( returnValue ) )\n                     {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjcyODkyMw=="}, "originalCommit": {"oid": "e8af4efdc08020a0bbfbe3d2a4c5650e8e7d2a87"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODE5NTk0OnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-services/dhis-service-node/src/main/java/org/hisp/dhis/fieldfilter/DefaultFieldFilterService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoxOToyMVrOHMXcOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNjoxOToyMVrOHMXcOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjcyOTAxNg==", "bodyText": "Same as comment above", "url": "https://github.com/dhis2/dhis2-core/pull/6045#discussion_r482729016", "createdAt": "2020-09-03T06:19:21Z", "author": {"login": "netroms"}, "path": "dhis-2/dhis-services/dhis-service-node/src/main/java/org/hisp/dhis/fieldfilter/DefaultFieldFilterService.java", "diffHunk": "@@ -429,11 +424,22 @@ else if ( property.isIdentifiableObject() && isProperIdObject( propertyClass ) )\n                     child = new CollectionNode( property.getCollectionName() );\n                     child.setNamespace( property.getNamespace() );\n \n-                    for ( Object collectionObject : (Collection<?>) returnValue )\n+                    for ( Object collectionObject : (Collection<?>) Objects.requireNonNull( returnValue ) )\n                     {\n-                        Node node = buildNode( fieldValue, property.getItemKlass(), collectionObject, user, property.getName(), defaults );\n+                        Node node;\n+\n+                        if ( property.hasPropertyTransformer() )\n+                        {\n+                            // if it has a transformer, re-get the schema (the item klass has probably changed)\n+                            Schema sch = schemaService.getDynamicSchema( collectionObject.getClass() );\n+                            node = buildNode( fieldValue, sch.getKlass(), collectionObject, user, property.getName(), defaults );\n+                        }\n+                        else\n+                        {\n+                            node = buildNode( fieldValue, property.getItemKlass(), collectionObject, user, property.getName(), defaults );\n+                        }\n \n-                        if ( !node.getChildren().isEmpty() )\n+                        if ( !Objects.requireNonNull( node ).getChildren().isEmpty() )\n                         {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8af4efdc08020a0bbfbe3d2a4c5650e8e7d2a87"}, "originalPosition": 107}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3884, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}