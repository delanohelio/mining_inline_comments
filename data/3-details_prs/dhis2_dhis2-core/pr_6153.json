{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MjYyNTM0", "number": 6153, "title": "fix: [DHIS2-8588] handling division by ZERO error", "bodyText": "Some data elements, which are not compulsory are returned as NULL values for this query. So, when converting to ZERO, we can face a division by ZERO error. This happens in cases when we have a division operation in the formula and the denominator is set to ZERO (for the cases when they are NULL).\nSee this comment for more details: https://jira.dhis2.org/browse/DHIS2-8588?focusedCommentId=35764&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-35764", "createdAt": "2020-09-15T12:30:31Z", "url": "https://github.com/dhis2/dhis2-core/pull/6153", "merged": true, "mergeCommit": {"oid": "8f4a22bdb1afeaa06d911adb845852aa01ebc51e"}, "closed": true, "closedAt": "2020-09-24T07:23:29Z", "author": {"login": "maikelarabori"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJG87YAH2gAyNDg3MjYyNTM0OjZlNjI2YTA3M2I5MDQ0NTA2OWE2YTIwYjA5M2NiYWI0Zjk2NzEyMDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLrmJNgH2gAyNDg3MjYyNTM0OjRjYzFhNjZmYmIzYzQyMzkwMTYzNmVhMjI5N2VmMTg1ZDRjMmVlMjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6e626a073b90445069a6a20b093cbab4f9671206", "author": {"user": {"login": "maikelarabori", "name": "Maikel Arabori"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6e626a073b90445069a6a20b093cbab4f9671206", "committedDate": "2020-09-15T12:28:32Z", "message": "fix: [DHIS2-8588] handling division by ZERO error\n\nSome data elements, which are not compulsory are returned as NULL values for this query. So, when converting to ZERO, we can face a division by ZERO error. This happens in cases when we have a division operation in the formula and the denominator is set to ZERO (for the cases when they are NULL)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25b95a6680c91167f9b1a8391a421af7cb678dec", "author": {"user": {"login": "maikelarabori", "name": "Maikel Arabori"}}, "url": "https://github.com/dhis2/dhis2-core/commit/25b95a6680c91167f9b1a8391a421af7cb678dec", "committedDate": "2020-09-15T12:36:50Z", "message": "fix: [DHIS2-8588] Code formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7e3c1d3a8b917e496d9483877bb7b4ca66b9811", "author": {"user": {"login": "maikelarabori", "name": "Maikel Arabori"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d7e3c1d3a8b917e496d9483877bb7b4ca66b9811", "committedDate": "2020-09-15T12:45:42Z", "message": "fix: [DHIS2-8588] Code formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c", "author": {"user": {"login": "maikelarabori", "name": "Maikel Arabori"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4d7d643c62000f85b32aefde1e961b88333cd84c", "committedDate": "2020-09-15T13:36:57Z", "message": "fix: [DHIS2-8588] Sonarqube issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NzM2NDM5", "url": "https://github.com/dhis2/dhis2-core/pull/6153#pullrequestreview-488736439", "createdAt": "2020-09-15T14:20:44Z", "commit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDoyMDo0NFrOHSEUBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDoyMDo0NFrOHSEUBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw==", "bodyText": "Could be this Exception Handler be moved at the CrudControllerAdvice level? The CrudControllerAdvice is annotated with @ControllerAdvice and it is applied to all the controllers in the system.\nI'm just thinking here that perhaps this handler is very specific to ANalytics, so it's better to keep it separated from the global exception handling strategy.\nIn any case, I would perhaps make the ExceptionHandler class its own class, which could be perhaps applied to all *AnalyticsManager in the system.", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r488707077", "createdAt": "2020-09-15T14:20:44Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -628,4 +672,26 @@ private String resolveCoordinateFieldColumnName( String coordinateField, EventQu\n         }\n         return coordinateField;\n     }\n+\n+    protected static class ExceptionHandler", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "originalPosition": 296}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTk0NTc3", "url": "https://github.com/dhis2/dhis2-core/pull/6153#pullrequestreview-494594577", "createdAt": "2020-09-23T12:16:10Z", "commit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxNjoxMFrOHWp-nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxNjoxMFrOHWp-nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxODQ5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public JdbcEventAnalyticsManager(JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,\n          \n          \n            \n                public JdbcEventAnalyticsManager( JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r493518492", "createdAt": "2020-09-23T12:16:10Z", "author": {"login": "stian-sandvold"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -102,10 +106,14 @@\n @Component( \"org.hisp.dhis.analytics.event.EventAnalyticsManager\" )\n public class JdbcEventAnalyticsManager\n     extends AbstractJdbcEventAnalyticsManager\n-        implements EventAnalyticsManager\n+    implements EventAnalyticsManager\n {\n-    public JdbcEventAnalyticsManager( JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,\n-        ProgramIndicatorService programIndicatorService, ProgramIndicatorSubqueryBuilder programIndicatorSubqueryBuilder )\n+\n+    private static final String OPEN_IN = \" in (\";\n+\n+    public JdbcEventAnalyticsManager(JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cc1a66fbb3c423901636ea2297ef185d4c2ee26", "author": {"user": {"login": "stian-sandvold", "name": "Stian Sandvold"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4cc1a66fbb3c423901636ea2297ef185d4c2ee26", "committedDate": "2020-09-23T12:17:59Z", "message": "Update dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2439, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}