{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNDEzNTIx", "number": 5131, "title": "fix: Soft delete TEI, Enrollment and events", "bodyText": "", "createdAt": "2020-03-18T12:43:21Z", "url": "https://github.com/dhis2/dhis2-core/pull/5131", "merged": true, "mergeCommit": {"oid": "62db8a053bb093d5785976b51e04a28ce1c9c8f7"}, "closed": true, "closedAt": "2020-04-15T13:55:39Z", "author": {"login": "enricocolasante"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO2qOagH2gAyMzkwNDEzNTIxOjFmMDYzYzVlNzdmNTFjYzVjYTE3ZTg1MWRmOTUyYzYwNjkwODQ2YmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX4fYXAFqTM5Mzc5NzAyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f063c5e77f51cc5ca17e851df952c60690846be", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/1f063c5e77f51cc5ca17e851df952c60690846be", "committedDate": "2020-03-18T12:42:01Z", "message": "Add delete TEI and Enrollment tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e749289a997bb717825b1daca51e78c40c70fab", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/9e749289a997bb717825b1daca51e78c40c70fab", "committedDate": "2020-03-20T13:35:29Z", "message": "Implement soft delete store"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a15eaae1a9840468822d26585d3908b2ffc14f2d", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/a15eaae1a9840468822d26585d3908b2ffc14f2d", "committedDate": "2020-03-20T13:43:03Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1acc3a5d983441a8d5a45ae812f4f89970ac3c5a", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/1acc3a5d983441a8d5a45ae812f4f89970ac3c5a", "committedDate": "2020-03-20T14:20:30Z", "message": "Fix sonar code smells"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "920e0e29c572d4968d571f790fa614765f20409b", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/920e0e29c572d4968d571f790fa614765f20409b", "committedDate": "2020-03-23T09:45:53Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad7dfb28e0046f77f108f11440917ee1eb86129", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/aad7dfb28e0046f77f108f11440917ee1eb86129", "committedDate": "2020-03-23T10:05:24Z", "message": "Merge remote-tracking branch 'origin/master' into DHIS2-7415"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTU0NzA0", "url": "https://github.com/dhis2/dhis2-core/pull/5131#pullrequestreview-380954704", "createdAt": "2020-03-25T08:54:44Z", "commit": {"oid": "aad7dfb28e0046f77f108f11440917ee1eb86129"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODo1NDo0NFrOF7RPBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODo1NDo0NFrOF7RPBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY5MjY3Ng==", "bodyText": "Remove commented out code.", "url": "https://github.com/dhis2/dhis2-core/pull/5131#discussion_r397692676", "createdAt": "2020-03-25T08:54:44Z", "author": {"login": "larshelge"}, "path": "dhis-2/dhis-services/dhis-service-core/src/test/java/org/hisp/dhis/trackedentity/TrackedEntityInstanceServiceTest.java", "diffHunk": "@@ -109,6 +169,35 @@ public void testDeleteTrackedEntityInstance()\n         assertNull( entityInstanceService.getTrackedEntityInstance( teiB.getUid() ) );\r\n     }\r\n \r\n+    @Test\r\n+    public void testDeleteTrackedEntityInstanceAndLinkedEnrollmentsAndEvents()\r\n+    {\r\n+        long idA = entityInstanceService.addTrackedEntityInstance( entityInstanceA1 );\r\n+        long psIdA = programInstanceService.addProgramInstance( programInstanceA );\r\n+        long psiIdA = programStageInstanceService.addProgramStageInstance( programStageInstanceA );\r\n+//        programInstanceA.setId( idA );\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad7dfb28e0046f77f108f11440917ee1eb86129"}, "originalPosition": 100}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abae66ebf296c5e77d17e72fee178cd8234c4d09", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/abae66ebf296c5e77d17e72fee178cd8234c4d09", "committedDate": "2020-03-26T10:03:41Z", "message": "Code review fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzM0OTgw", "url": "https://github.com/dhis2/dhis2-core/pull/5131#pullrequestreview-383734980", "createdAt": "2020-03-30T10:46:39Z", "commit": {"oid": "abae66ebf296c5e77d17e72fee178cd8234c4d09"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMDo0NjozOVrOF9j77g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMDo0NjozOVrOF9j77g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5NjIzOA==", "bodyText": "Are you sure there are no side effects of removing setting the status to CANCELLED ? Maybe you can set it before you send it onwards to the deletion store?", "url": "https://github.com/dhis2/dhis2-core/pull/5131#discussion_r400096238", "createdAt": "2020-03-30T10:46:39Z", "author": {"login": "mortenoh"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/program/DefaultProgramInstanceService.java", "diffHunk": "@@ -112,23 +112,7 @@ public long addProgramInstance( ProgramInstance programInstance )\n     @Transactional\r\n     public void deleteProgramInstance( ProgramInstance programInstance )\r\n     {\r\n-        deleteProgramInstance( programInstance, false );\r\n-    }\r\n-\r\n-    @Override\r\n-    @Transactional\r\n-    public void deleteProgramInstance( ProgramInstance programInstance, boolean forceDelete )\r\n-    {\r\n-        if ( forceDelete )\r\n-        {\r\n-            programInstanceStore.delete( programInstance );\r\n-        }\r\n-        else\r\n-        {\r\n-            programInstance.setDeleted( true );\r\n-            programInstance.setStatus( ProgramStatus.CANCELLED );\r\n-            programInstanceStore.update( programInstance );\r\n-        }\r\n+        programInstanceStore.delete( programInstance );\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abae66ebf296c5e77d17e72fee178cd8234c4d09"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c620392e16123c3476e0ebef35e508ceea4526c5", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/c620392e16123c3476e0ebef35e508ceea4526c5", "committedDate": "2020-03-30T11:57:09Z", "message": "Fix code review comments"}, "afterCommit": {"oid": "27a89af420dd17e9fd8003027dc1f02ebcd21844", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/27a89af420dd17e9fd8003027dc1f02ebcd21844", "committedDate": "2020-03-30T12:36:30Z", "message": "Code review fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "27a89af420dd17e9fd8003027dc1f02ebcd21844", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/27a89af420dd17e9fd8003027dc1f02ebcd21844", "committedDate": "2020-03-30T12:36:30Z", "message": "Code review fixes"}, "afterCommit": {"oid": "c6371109f5b04aa1ec6c8f97a46a3dd0e836893c", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/c6371109f5b04aa1ec6c8f97a46a3dd0e836893c", "committedDate": "2020-04-01T07:22:59Z", "message": "Fix code review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6371109f5b04aa1ec6c8f97a46a3dd0e836893c", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/c6371109f5b04aa1ec6c8f97a46a3dd0e836893c", "committedDate": "2020-04-01T07:22:59Z", "message": "Fix code review comments"}, "afterCommit": {"oid": "abae66ebf296c5e77d17e72fee178cd8234c4d09", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/abae66ebf296c5e77d17e72fee178cd8234c4d09", "committedDate": "2020-03-26T10:03:41Z", "message": "Code review fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7bfe2d9414308085cd785cd58584373b9642cdf", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/c7bfe2d9414308085cd785cd58584373b9642cdf", "committedDate": "2020-04-01T07:42:11Z", "message": "Code review fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b97c9f797c168b0455fa57e8435f82d99d9d8e51", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b97c9f797c168b0455fa57e8435f82d99d9d8e51", "committedDate": "2020-04-01T07:53:34Z", "message": "Merge remote-tracking branch 'origin/master' into HEAD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01266c84fef6387bef2936abb58fa45ac33a6431", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/01266c84fef6387bef2936abb58fa45ac33a6431", "committedDate": "2020-04-01T08:37:01Z", "message": "Fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9af491548be57fc4cee4158cbd9831f908f48930", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/9af491548be57fc4cee4158cbd9831f908f48930", "committedDate": "2020-04-06T07:54:09Z", "message": "Fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3deba89e896f849e491af7d7fc21a79eb48ab3a", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d3deba89e896f849e491af7d7fc21a79eb48ab3a", "committedDate": "2020-04-06T07:57:57Z", "message": "Merge remote-tracking branch 'origin/master' into DHIS2-7415"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25a6c5924d142120f40143613ca780e485751936", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/25a6c5924d142120f40143613ca780e485751936", "committedDate": "2020-04-06T08:07:14Z", "message": "Fix compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79e97e6d119c6be4aea7d425b8cc05db9193fcd6", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/79e97e6d119c6be4aea7d425b8cc05db9193fcd6", "committedDate": "2020-04-08T07:32:25Z", "message": "Merge remote-tracking branch 'origin/master' into DHIS2-7415"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "945d9fa67f68b1cba3d2420a7caf46c7cfe20907", "author": {"user": {"login": "enricocolasante", "name": "Enrico Colasante"}}, "url": "https://github.com/dhis2/dhis2-core/commit/945d9fa67f68b1cba3d2420a7caf46c7cfe20907", "committedDate": "2020-04-08T07:41:19Z", "message": "Fix line endings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTUyNjcx", "url": "https://github.com/dhis2/dhis2-core/pull/5131#pullrequestreview-393552671", "createdAt": "2020-04-15T08:16:53Z", "commit": {"oid": "945d9fa67f68b1cba3d2420a7caf46c7cfe20907"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzk3MDI0", "url": "https://github.com/dhis2/dhis2-core/pull/5131#pullrequestreview-393797024", "createdAt": "2020-04-15T13:55:18Z", "commit": {"oid": "945d9fa67f68b1cba3d2420a7caf46c7cfe20907"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2787, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}