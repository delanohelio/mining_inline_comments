{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NzkyNDg5", "number": 4734, "title": "fix: Allow \"unresolved\" Indicators to survive validation", "bodyText": "@larshelge @jimgrace\nThis issue is about allowing Indicators with static or constant values to \"survive\" the step in which we resolve the DimensionalItemObject from the query - when the \"static values\" indicators are the only data dimension in the query.\nSince an Indicator with static/constant values does not resolve to any DimensionalItemObject, the system exits without returning any data.\nI have applied a VERY SIMPLE fix, which assumes that, if we have one or more Indicators in the query, the Indicators must be \"correct\" when it comes to numerator/denumerator. I'm not 100% sure about this solution, so please take a look.", "createdAt": "2020-01-20T11:45:16Z", "url": "https://github.com/dhis2/dhis2-core/pull/4734", "merged": true, "mergeCommit": {"oid": "57ce48c2fbcb9096433e3ed3283d95c053d90c86"}, "closed": true, "closedAt": "2020-02-20T14:35:21Z", "author": {"login": "luciano-fiandesio"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8f2DcgBqjI5NjU5MTk2MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFz_mmAFqTM2MDk5OTk4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d56a64c4ea96d303ff4aa18f2c37d4ba7963f701", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d56a64c4ea96d303ff4aa18f2c37d4ba7963f701", "committedDate": "2020-01-20T13:28:51Z", "message": "fix: better test documentation"}, "afterCommit": {"oid": "58a9b656525a615f1f61dbc8051c2f394a826e72", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/58a9b656525a615f1f61dbc8051c2f394a826e72", "committedDate": "2020-01-21T11:56:16Z", "message": "fix: better test documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDk2MTEy", "url": "https://github.com/dhis2/dhis2-core/pull/4734#pullrequestreview-346496112", "createdAt": "2020-01-22T10:48:47Z", "commit": {"oid": "58a9b656525a615f1f61dbc8051c2f394a826e72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo0ODo0N1rOFgX2Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo0ODo0N1rOFgX2Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ4OTUwNw==", "bodyText": "This check is sort of pointless, in the sense that if there are no indicators in the query, we should not get here at all (i.e. break before the call to expression service), and if we get here, there should be indicators present, and then this check would always fail and hence could be removed (indicators would never be empty).", "url": "https://github.com/dhis2/dhis2-core/pull/4734#discussion_r369489507", "createdAt": "2020-01-22T10:48:47Z", "author": {"login": "larshelge"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/data/DefaultAnalyticsService.java", "diffHunk": "@@ -1345,7 +1345,7 @@ private void addRawData( DataQueryParams params, Grid grid )\n         List<DimensionalItemObject> items = Lists\n                 .newArrayList( expressionService.getIndicatorDimensionalItemObjects( preprocessIndicators( indicators ) ) );\n \n-        if ( items.isEmpty() )\n+        if ( items.isEmpty() && params.getIndicators().isEmpty() )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58a9b656525a615f1f61dbc8051c2f394a826e72"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "committedDate": "2020-01-23T11:42:21Z", "message": "fix: analytics: retain unresolved Indicators\n\n- DHIS2-7862\n- If an analytics query contains Indicators which contain constants or\n  static values (e.g. 100, 1), do not exit early and continue processing\nthe indicator expressions."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7540e29d30731434e52699beb8e7de6c1ebd5de5", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/7540e29d30731434e52699beb8e7de6c1ebd5de5", "committedDate": "2020-01-23T08:27:40Z", "message": "fix: static Indicators do not break loop"}, "afterCommit": {"oid": "6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "author": {"user": {"login": "luciano-fiandesio", "name": "Luciano Fiandesio"}}, "url": "https://github.com/dhis2/dhis2-core/commit/6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "committedDate": "2020-01-23T11:42:21Z", "message": "fix: analytics: retain unresolved Indicators\n\n- DHIS2-7862\n- If an analytics query contains Indicators which contain constants or\n  static values (e.g. 100, 1), do not exit early and continue processing\nthe indicator expressions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMDA2ODA2", "url": "https://github.com/dhis2/dhis2-core/pull/4734#pullrequestreview-351006806", "createdAt": "2020-01-30T17:28:04Z", "commit": {"oid": "6ee1d2f1b21852302f2ea5fd137edbb5978b1767"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTk5OTgx", "url": "https://github.com/dhis2/dhis2-core/pull/4734#pullrequestreview-360999981", "createdAt": "2020-02-19T10:30:20Z", "commit": {"oid": "6ee1d2f1b21852302f2ea5fd137edbb5978b1767"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2931, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}