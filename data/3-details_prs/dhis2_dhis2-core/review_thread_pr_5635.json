{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNjc1MzU2", "number": 5635, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwODoyMDoyMVrOEBSISQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDo1MjoxOFrOEGYsaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NzgxMDY1OnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/common/BaseAnalyticalObject.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwODoyMDoyMVrOGdCf_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwODoyMDoyMVrOGdCf_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzEwMjg0Nw==", "bodyText": "Here we get all data dimensions with dependencies.", "url": "https://github.com/dhis2/dhis2-core/pull/5635#discussion_r433102847", "createdAt": "2020-06-01T08:20:21Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/common/BaseAnalyticalObject.java", "diffHunk": "@@ -273,7 +277,8 @@ public boolean removeDataDimensionItem( DimensionalItemObject object )\n     {\n         if ( object != null && DataDimensionItem.DATA_DIMENSION_CLASSES.contains( object.getClass() ) )\n         {\n-            return dataDimensionItems.remove( DataDimensionItem.create( object ) );\n+            return dataDimensionItems\n+                .removeAll( DataDimensionItem.createWithDependencies( object, dataDimensionItems ) );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d990c37ddeded10fc8f6147f54f23628460ada3"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MTMxNDk5OnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/metadata/DefaultAnalyticalObjectImportHandler.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDo1MjoxOFrOGlJjuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjo1MDoyOVrOGlt0Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwNzA5Ng==", "bodyText": "@vietnguyen In order to make the deletion work, we need to remove this save.\nIs this going to create any other problem?", "url": "https://github.com/dhis2/dhis2-core/pull/5635#discussion_r441607096", "createdAt": "2020-06-17T14:52:18Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/metadata/DefaultAnalyticalObjectImportHandler.java", "diffHunk": "@@ -84,7 +84,6 @@ private void handleDataDimensionItems( Session session, Schema schema, BaseAnaly\n             if ( dataDimensionItem.getDataElementOperand() != null )\n             {\n                 preheatService.connectReferences( dataDimensionItem.getDataElementOperand(), bundle.getPreheat(), bundle.getPreheatIdentifier() );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b966af64027e61ef6d63fce90c4cf49d1c20803"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4NTgxMg==", "bodyText": "@enricocolasante  I'm not sure, this code has been in the class AnalyticObjectBundleHook  for a long time before it was moved to DefaultAnalyticObjectImportHandle so that it can be reused in different places.\nI guess removing this save function would cause issues for the importer. Because DataElementOperand  is EmbeddedObject.\nYou can try and check if this test is ok  ( need to add some more asserts to check if the dataElementOperands are imported correctly ) MetadataImportServiceTest.testImportEmbeddedObjectWithSkipSharingIsTrue", "url": "https://github.com/dhis2/dhis2-core/pull/5635#discussion_r442185812", "createdAt": "2020-06-18T12:24:21Z", "author": {"login": "vietnguyen"}, "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/metadata/DefaultAnalyticalObjectImportHandler.java", "diffHunk": "@@ -84,7 +84,6 @@ private void handleDataDimensionItems( Session session, Schema schema, BaseAnaly\n             if ( dataDimensionItem.getDataElementOperand() != null )\n             {\n                 preheatService.connectReferences( dataDimensionItem.getDataElementOperand(), bundle.getPreheat(), bundle.getPreheatIdentifier() );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwNzA5Ng=="}, "originalCommit": {"oid": "5b966af64027e61ef6d63fce90c4cf49d1c20803"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwMTEwMg==", "bodyText": "I updated the test and the import works correctly.\nDataElemenentOperand is an embedded object but in in this case is not treated as one because of the hibernate mapping.", "url": "https://github.com/dhis2/dhis2-core/pull/5635#discussion_r442201102", "createdAt": "2020-06-18T12:50:29Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/metadata/DefaultAnalyticalObjectImportHandler.java", "diffHunk": "@@ -84,7 +84,6 @@ private void handleDataDimensionItems( Session session, Schema schema, BaseAnaly\n             if ( dataDimensionItem.getDataElementOperand() != null )\n             {\n                 preheatService.connectReferences( dataDimensionItem.getDataElementOperand(), bundle.getPreheat(), bundle.getPreheatIdentifier() );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwNzA5Ng=="}, "originalCommit": {"oid": "5b966af64027e61ef6d63fce90c4cf49d1c20803"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3424, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}