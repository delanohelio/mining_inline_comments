{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDU5MTQ5", "number": 6569, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTo0NzozN1rOE2ujdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTo0NzozN1rOE2ujdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODIxMzAwOnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-support/dhis-support-artemis/src/main/java/org/hisp/dhis/artemis/audit/AuditableEntity.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTo0NzozN1rOHvq9ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNzowNjoxOFrOHxA71Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0ODk2NA==", "bodyText": "I asked the same in @zubaira 's PR; Why are we using Object, and not Map (as commented) or Serializable?", "url": "https://github.com/dhis2/dhis2-core/pull/6569#discussion_r519748964", "createdAt": "2020-11-09T11:47:37Z", "author": {"login": "stian-sandvold"}, "path": "dhis-2/dhis-support/dhis-support-artemis/src/main/java/org/hisp/dhis/artemis/audit/AuditableEntity.java", "diffHunk": "@@ -38,5 +38,19 @@\n @AllArgsConstructor\n public class AuditableEntity\n {\n-    private Object entity;\n+    /**\n+     * Class of the AuditableEntity\n+     * It will be used by {@link org.hisp.dhis.artemis.audit.legacy.AuditObjectFactory#collectAuditAttributes(Object)}\n+     */\n+    Class entityClass;\n+\n+    /**\n+     * An object that is ready for serialized by Jackson.\n+     * Means that this object should:\n+     * 1. Only includes referenced properties that are owned by the current Audit Entity. Means that the property's schema has attribute \"owner = true\"\n+     * 2. Do not include any lazy HibernateProxy or PersistentCollection that is not loaded.\n+     * 3. All referenced properties that extend BaseIdentifiableObject should be mapped to only UID string\n+     * This object could be a Map<String, Object>  with key is property name and value is the property value\n+     */\n+    Object serializableObject;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4901abb65d7876e2b67218b8224906da80c8c2c9"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc4Mjg5NA==", "bodyText": "Map would make more sense as this  serializableObject is almost always Map.", "url": "https://github.com/dhis2/dhis2-core/pull/6569#discussion_r519782894", "createdAt": "2020-11-09T12:50:53Z", "author": {"login": "zubaira"}, "path": "dhis-2/dhis-support/dhis-support-artemis/src/main/java/org/hisp/dhis/artemis/audit/AuditableEntity.java", "diffHunk": "@@ -38,5 +38,19 @@\n @AllArgsConstructor\n public class AuditableEntity\n {\n-    private Object entity;\n+    /**\n+     * Class of the AuditableEntity\n+     * It will be used by {@link org.hisp.dhis.artemis.audit.legacy.AuditObjectFactory#collectAuditAttributes(Object)}\n+     */\n+    Class entityClass;\n+\n+    /**\n+     * An object that is ready for serialized by Jackson.\n+     * Means that this object should:\n+     * 1. Only includes referenced properties that are owned by the current Audit Entity. Means that the property's schema has attribute \"owner = true\"\n+     * 2. Do not include any lazy HibernateProxy or PersistentCollection that is not loaded.\n+     * 3. All referenced properties that extend BaseIdentifiableObject should be mapped to only UID string\n+     * This object could be a Map<String, Object>  with key is property name and value is the property value\n+     */\n+    Object serializableObject;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0ODk2NA=="}, "originalCommit": {"oid": "4901abb65d7876e2b67218b8224906da80c8c2c9"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE1NzU4OQ==", "bodyText": "@stian-sandvold  @zubaira In some other places of the code some one could call AuditManager.send() and pass in any Java object.\nThis object will be serialized by objectMapper.writeValueAsString(Object value) which accepts any Java Object and serializes it to a String.\nI'm thinking of making another createAuditEntry funtion in another service where we have the object and session still open. So in that function we don't need to create HibernateProxy or open new session, just need to create an auditable object with correct format. With that , we can ensure to only use Map/Serializable for audit.", "url": "https://github.com/dhis2/dhis2-core/pull/6569#discussion_r521157589", "createdAt": "2020-11-11T07:06:18Z", "author": {"login": "vietnguyen"}, "path": "dhis-2/dhis-support/dhis-support-artemis/src/main/java/org/hisp/dhis/artemis/audit/AuditableEntity.java", "diffHunk": "@@ -38,5 +38,19 @@\n @AllArgsConstructor\n public class AuditableEntity\n {\n-    private Object entity;\n+    /**\n+     * Class of the AuditableEntity\n+     * It will be used by {@link org.hisp.dhis.artemis.audit.legacy.AuditObjectFactory#collectAuditAttributes(Object)}\n+     */\n+    Class entityClass;\n+\n+    /**\n+     * An object that is ready for serialized by Jackson.\n+     * Means that this object should:\n+     * 1. Only includes referenced properties that are owned by the current Audit Entity. Means that the property's schema has attribute \"owner = true\"\n+     * 2. Do not include any lazy HibernateProxy or PersistentCollection that is not loaded.\n+     * 3. All referenced properties that extend BaseIdentifiableObject should be mapped to only UID string\n+     * This object could be a Map<String, Object>  with key is property name and value is the property value\n+     */\n+    Object serializableObject;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0ODk2NA=="}, "originalCommit": {"oid": "4901abb65d7876e2b67218b8224906da80c8c2c9"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3754, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}