{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMTQ0MTUw", "number": 4847, "title": "ci: Test multiple docker images", "bodyText": "PR introduces matrix within 'Run api tests' stage. Tests will be executed on multiple environments, in parallel:\n\nTC8 + JDK 8 (docker image alliesed with default tag)\nTC9 + JDK 11\n\nNote: I tested the pipeline and clean up on Jenkins, but I haven't tested that the logs will be published after both parallel stages finish. Please let me know if you see anything that might go wrong with that.", "createdAt": "2020-02-10T13:48:48Z", "url": "https://github.com/dhis2/dhis2-core/pull/4847", "merged": true, "mergeCommit": {"oid": "3e0aa6ee33955ca86f4f85b6dc1ae57bc7cabbd5"}, "closed": true, "closedAt": "2020-04-02T12:27:37Z", "author": {"login": "vilkg"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC6af1AH2gAyMzczMTQ0MTUwOjU5MDNjOWJjNTRlM2ZjMzdiMzNhNGFjM2E3NTQ5MTI3NzY4MjM5YmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTrcN_gFqTM4NjM3NTEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5903c9bc54e3fc37b33a4ac3a7549127768239ba", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/5903c9bc54e3fc37b33a4ac3a7549127768239ba", "committedDate": "2020-02-10T10:17:22Z", "message": "ci: adding matrix for docker-variants to run tests with"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d54c2d6f7296afd75fb32280be39b7381a54f5a0", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d54c2d6f7296afd75fb32280be39b7381a54f5a0", "committedDate": "2020-02-10T10:17:55Z", "message": "temp: removing publish and post failure to test this on jenkins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4479c4d83f7fd81ea162033aff0a212bc8f4c988", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4479c4d83f7fd81ea162033aff0a212bc8f4c988", "committedDate": "2020-02-10T10:33:33Z", "message": "fix: stages inside matrix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53aa35d0853bce397afdd2742a50f2d5c5df65c0", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/53aa35d0853bce397afdd2742a50f2d5c5df65c0", "committedDate": "2020-02-10T10:39:39Z", "message": "fix: post inside stage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0b38b3245b20894ebf08f3febb8d916de230763", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/a0b38b3245b20894ebf08f3febb8d916de230763", "committedDate": "2020-02-10T10:46:39Z", "message": "fix: adding script block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "652e024c07950b94d5aed162af0bb8ffa1605f60", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/652e024c07950b94d5aed162af0bb8ffa1605f60", "committedDate": "2020-02-10T10:53:02Z", "message": "fix: steps block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1573da915c32247b40d94f3d3a1ef5460fb7230", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e1573da915c32247b40d94f3d3a1ef5460fb7230", "committedDate": "2020-02-10T10:55:06Z", "message": "temp: changing the image name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19053bcf5fec9937eb40acc7ff0ad7056ab718a3", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/19053bcf5fec9937eb40acc7ff0ad7056ab718a3", "committedDate": "2020-02-10T11:45:46Z", "message": "fix: removing redundant \""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beb64c69e32659c06890125295526ab3a090cabc", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/beb64c69e32659c06890125295526ab3a090cabc", "committedDate": "2020-02-10T12:11:02Z", "message": "Merge branch 'master' into ci/parallel-test-runs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3bac1e7c806729078d71fcd135d307bd6ff123e", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b3bac1e7c806729078d71fcd135d307bd6ff123e", "committedDate": "2020-02-10T12:30:56Z", "message": "fix: adding default docker variant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "565fd8a93e1be11f86e93407bc1cf57980a80757", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/565fd8a93e1be11f86e93407bc1cf57980a80757", "committedDate": "2020-02-10T12:54:58Z", "message": "ci: moving post always stage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5d918c3f352cbea89fda57dee4c574b1d491767", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e5d918c3f352cbea89fda57dee4c574b1d491767", "committedDate": "2020-02-10T13:07:59Z", "message": "fix: docker_variant var"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79af259c655323f39dec89888486057ddad75b50", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/79af259c655323f39dec89888486057ddad75b50", "committedDate": "2020-02-10T13:22:30Z", "message": "fix: docker_var"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99975ec22f521d2dc50dd0eb920a589914135b73", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/99975ec22f521d2dc50dd0eb920a589914135b73", "committedDate": "2020-02-10T13:35:31Z", "message": "fix: cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b804c38de1d7c8031b2f61b3ad7e1e9e3addf320", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b804c38de1d7c8031b2f61b3ad7e1e9e3addf320", "committedDate": "2020-02-10T13:42:42Z", "message": "fix: revert temporarily removed stages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3ebad5e68e4264df510da44fc7ed5eef9caf8a1", "author": {"user": {"login": "vilkg", "name": "Gintare Vilkelyte"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f3ebad5e68e4264df510da44fc7ed5eef9caf8a1", "committedDate": "2020-02-10T13:43:39Z", "message": "fix: empty lines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTc2MjU1", "url": "https://github.com/dhis2/dhis2-core/pull/4847#pullrequestreview-362576255", "createdAt": "2020-02-21T11:48:29Z", "commit": {"oid": "f3ebad5e68e4264df510da44fc7ed5eef9caf8a1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMTo0ODoyOVrOFs0Zrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMTo0ODoyOVrOFs0Zrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU0MDIwNw==", "bodyText": "Not sure if we can pull it off, but it would be nice if we have a single place where we source the variants we build for both this file, and the containers defined in: https://github.com/dhis2/dhis2-core/blob/master/docker/shared/containers-list.sh#L26-L42\nMaking sure our container versions are up-to-date is currently something that we don't track super-well, and we are opening ourselves up for more complications when we hardcode them in multiple places.", "url": "https://github.com/dhis2/dhis2-core/pull/4847#discussion_r382540207", "createdAt": "2020-02-21T11:48:29Z", "author": {"login": "varl"}, "path": "Jenkinsfile-publish-image", "diffHunk": "@@ -83,32 +83,55 @@ pipeline {\n             }\n         }\n \n-        stage('Start instance') {\n-            steps {\n-                dir(\"dhis-2/dhis-e2e-test\") {\n-                    sh \"IMAGE_NAME=${DOCKER_CORE_IMAGE_FULL_NAME} docker-compose -p ${COMPOSE_PARAMETER} up -d\"\n-                }\n-            }\n-        }\n-\n         stage('Run api tests') {\n-            steps {\n-                script {\n-                    TESTS_IMAGE_FULL_NAME = \"core-api-tests:${DOCKER_IMAGE_TAG}\"\n-\n-                    dir(\"dhis-2/dhis-e2e-test\") {\n-                        sh \"docker build -t ${TESTS_IMAGE_FULL_NAME} .\"\n-                        sh \"IMAGE_NAME=${TESTS_IMAGE_FULL_NAME} docker-compose -p ${COMPOSE_PARAMETER} -f docker-compose.e2e.yml up --exit-code-from e2e-test\"\n+            matrix {\n+                axes {\n+                    axis {\n+                        name 'DOCKER_VARIANT'\n+                        values '-tomcat-8.5-jdk8-openjdk-slim', '-tomcat-9.0.27-jdk11-openjdk-slim'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ebad5e68e4264df510da44fc7ed5eef9caf8a1"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2Mzc1MTIy", "url": "https://github.com/dhis2/dhis2-core/pull/4847#pullrequestreview-386375122", "createdAt": "2020-04-02T12:27:23Z", "commit": {"oid": "f3ebad5e68e4264df510da44fc7ed5eef9caf8a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2871, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}