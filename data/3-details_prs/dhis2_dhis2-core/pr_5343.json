{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMjk1NDc5", "number": 5343, "title": "fix: Replace general error message with more specific one", "bodyText": "", "createdAt": "2020-04-09T08:51:04Z", "url": "https://github.com/dhis2/dhis2-core/pull/5343", "merged": true, "mergeCommit": {"oid": "c6e9d71202762627e396e0e0c403c95e9bff52d5"}, "closed": true, "closedAt": "2020-04-20T12:25:43Z", "author": {"login": "zubaira"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV4h8VgH2gAyNDAxMjk1NDc5OjA1OTIzOTc3YzdhM2JkYzM0NGI1OTgwZjcxZmJjMjNkMzk3YjVmMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZeM-ngFqTM5NjQwMzk1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05923977c7a3bdc344b5980f71fbc23d397b5f17", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/05923977c7a3bdc344b5980f71fbc23d397b5f17", "committedDate": "2020-04-09T08:50:15Z", "message": "fix: remove general error message with more specific one"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzIzMjM1", "url": "https://github.com/dhis2/dhis2-core/pull/5343#pullrequestreview-393323235", "createdAt": "2020-04-14T21:54:01Z", "commit": {"oid": "05923977c7a3bdc344b5980f71fbc23d397b5f17"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDowMVrOGFiWuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDowMVrOGFiWuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1ODkzOQ==", "bodyText": "Start with uppercase \"O\".", "url": "https://github.com/dhis2/dhis2-core/pull/5343#discussion_r408458939", "createdAt": "2020-04-14T21:54:01Z", "author": {"login": "larshelge"}, "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/sms/SmsController.java", "diffHunk": "@@ -243,14 +252,23 @@ private User getUserByPhoneNumber( String phoneNumber, String text ) throws WebM\n \n         List<User> users = userService.getUsersByPhoneNumber( phoneNumber );\n \n-        if ( users == null || users.isEmpty() )\n+        User currentUser = currentUserService.getCurrentUser();\n+\n+        if ( currentUser != null && !phoneNumber.equals( currentUser.getPhoneNumber() ) )\n         {\n-            if ( unregisteredParser != null )\n+            if ( users == null || users.isEmpty() )\n             {\n-                return null;\n+                if ( unregisteredParser != null )\n+                {\n+                    return null;\n+                }\n+\n+                // No user belong to this phone number\n+                throw new WebMessageException( WebMessageUtils.conflict( \"User's phone number is not registered in the system\" ) );\n             }\n \n-            throw new WebMessageException( WebMessageUtils.conflict( \"User not registered in the system\" ) );\n+            // current user does not belong to this number\n+            throw new WebMessageException( WebMessageUtils.conflict( \"originator's number does not match user's phone number\" ) );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05923977c7a3bdc344b5980f71fbc23d397b5f17"}, "originalPosition": 108}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cab23b59409125b1f80b9508bc546aff7b36b31f", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/cab23b59409125b1f80b9508bc546aff7b36b31f", "committedDate": "2020-04-16T16:52:44Z", "message": "Merge branch 'master' into DHIS2-8610"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9038da7775c38588703173d3047e25937dcab2b", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/a9038da7775c38588703173d3047e25937dcab2b", "committedDate": "2020-04-16T16:57:35Z", "message": "Change exception message to use uppercase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NDAzOTU3", "url": "https://github.com/dhis2/dhis2-core/pull/5343#pullrequestreview-396403957", "createdAt": "2020-04-20T12:25:31Z", "commit": {"oid": "a9038da7775c38588703173d3047e25937dcab2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2747, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}