{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5ODIzOTg0", "number": 6643, "title": "feat: [DHIS2-9841] Use db for storing break the glass records. Temporary ownerships (2.36)", "bodyText": "This PR focusses on removing the \"temporaryOwnershipCache\" used to store the intermittent breaking the glass records in cache with timeToLive. A new table is created \"programtempowner\" which stores the explicit ownership taking using the breaking the glass feature. This PR simply substitutes and makes sure everything is functioning as it has been so far. More changes to further optimize the sql to join to this new table will be in an upcoming jira issue.", "createdAt": "2020-11-12T11:37:52Z", "url": "https://github.com/dhis2/dhis2-core/pull/6643", "merged": true, "mergeCommit": {"oid": "9f9b08a0ac165fb56a7b6ca8900aa54b2103a71d"}, "closed": true, "closedAt": "2020-11-18T09:13:56Z", "author": {"login": "ameenhere"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbw-dDgH2gAyNTE5ODIzOTg0OmZkYjVhMzU5MDFjZDRhMWI3YWQ3NWU5OTUwYzJjM2Y1NjNiYzhkYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddpqxgAH2gAyNTE5ODIzOTg0OjUzZWMzZmY1Yjg2OWQ0MjQ2M2I5ZmVjMzIyODM0ZGE0MTEyYjBkZjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fdb5a35901cd4a1b7ad75e9950c2c3f563bc8db1", "author": {"user": {"login": "ameenhere", "name": "Mohamed Ameen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/fdb5a35901cd4a1b7ad75e9950c2c3f563bc8db1", "committedDate": "2020-11-12T11:36:51Z", "message": "feat: Use db for storing break the glass records. Temporary ownerships (2.36)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f8be89a224157003eddd7a5b64eac8f583b7cb0", "author": {"user": {"login": "ameenhere", "name": "Mohamed Ameen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/2f8be89a224157003eddd7a5b64eac8f583b7cb0", "committedDate": "2020-11-12T12:26:32Z", "message": "Fix compilation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MTExMDc2", "url": "https://github.com/dhis2/dhis2-core/pull/6643#pullrequestreview-529111076", "createdAt": "2020-11-12T13:59:16Z", "commit": {"oid": "2f8be89a224157003eddd7a5b64eac8f583b7cb0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffae58e48e78600dd5b62f80abe182859971e3fd", "author": {"user": {"login": "ameenhere", "name": "Mohamed Ameen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ffae58e48e78600dd5b62f80abe182859971e3fd", "committedDate": "2020-11-16T13:02:32Z", "message": "Merge branch 'master' into DHIS2-9841-2.36"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "988ee47f8d86d2c3b73d0ee599fcb0c41b3f654d", "author": {"user": {"login": "ameenhere", "name": "Mohamed Ameen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/988ee47f8d86d2c3b73d0ee599fcb0c41b3f654d", "committedDate": "2020-11-16T16:24:24Z", "message": "Added a cache to avoid hitting the db everytime."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ae9ac95bc3d862e3224a7758b8d5ed46fefbf33", "author": {"user": {"login": "ameenhere", "name": "Mohamed Ameen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/8ae9ac95bc3d862e3224a7758b8d5ed46fefbf33", "committedDate": "2020-11-16T17:59:05Z", "message": "false if does not exist in acache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMzM5NTg4", "url": "https://github.com/dhis2/dhis2-core/pull/6643#pullrequestreview-532339588", "createdAt": "2020-11-17T13:05:32Z", "commit": {"oid": "8ae9ac95bc3d862e3224a7758b8d5ed46fefbf33"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzowNTozMlrOH0z3nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzowNTozMlrOH0z3nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzNzgyMw==", "bodyText": "Could this be @transactional( readOnly = true )?", "url": "https://github.com/dhis2/dhis2-core/pull/6643#discussion_r525137823", "createdAt": "2020-11-17T13:05:32Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/program/DefaultProgramTempOwnerService.java", "diffHunk": "@@ -0,0 +1,42 @@\n+package org.hisp.dhis.program;\n+\n+import org.hisp.dhis.trackedentity.TrackedEntityInstance;\n+import org.hisp.dhis.user.User;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+/**\n+ * @author Ameen Mohamed <ameen@dhis2.org>\n+ *\n+ */\n+@Service( \"org.hisp.dhis.program.ProgramTempOwnerService\" )\n+public class DefaultProgramTempOwnerService implements ProgramTempOwnerService\n+{\n+\n+    // -------------------------------------------------------------------------\n+    // Dependencies\n+    // -------------------------------------------------------------------------\n+\n+    @Autowired\n+    private ProgramTempOwnerStore programTempOwnerStore;\n+\n+    // -------------------------------------------------------------------------\n+    // ProgramTempOwnershipAuditService implementation\n+    // -------------------------------------------------------------------------\n+\n+    @Override\n+    @Transactional\n+    public void addProgramTempOwner( ProgramTempOwner programTempOwner )\n+    {\n+        programTempOwnerStore.addProgramTempOwner( programTempOwner );\n+    }\n+    \n+    @Override\n+    @Transactional", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae9ac95bc3d862e3224a7758b8d5ed46fefbf33"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d342590104b939b75d70d59775a0bf5d5066ed0", "author": {"user": {"login": "ameenhere", "name": "Mohamed Ameen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/7d342590104b939b75d70d59775a0bf5d5066ed0", "committedDate": "2020-11-18T08:13:31Z", "message": "Changed transactional to readonly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53ec3ff5b869d42463b9fec322834da4112b0df1", "author": {"user": {"login": "ameenhere", "name": "Mohamed Ameen"}}, "url": "https://github.com/dhis2/dhis2-core/commit/53ec3ff5b869d42463b9fec322834da4112b0df1", "committedDate": "2020-11-18T08:13:52Z", "message": "Merge branch 'master' into DHIS2-9841-2.36"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2337, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}