{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMTkyMzkz", "number": 5959, "title": "feat: Add support for deletion of tracker objects [DHIS2-9085]", "bodyText": "This PR add support for deletion of tracker object i.e Enrollment, Event, TEI and RelationShip.\nPreheating and validation are bypassed but existence checks and authorization checks are in place.", "createdAt": "2020-08-19T14:11:46Z", "url": "https://github.com/dhis2/dhis2-core/pull/5959", "merged": true, "mergeCommit": {"oid": "82a863c258aa34e592b309bb9d6081c4dc8f981b"}, "closed": true, "closedAt": "2020-08-27T12:46:58Z", "author": {"login": "zubaira"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAcNtUgH2gAyNDcwMTkyMzkzOjBlZGEzZGViODllMzYxNzkzNmVlNjUyYTFkZTkwODMxOWI3NTJhZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC_wsCgFqTQ3NjY3OTk5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0eda3deb89e3617936ee652a1de908319b752ad1", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/0eda3deb89e3617936ee652a1de908319b752ad1", "committedDate": "2020-08-19T14:09:33Z", "message": "feat: Add support for deletion of tracker objects [DHIS2-9085]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d59decd7c59d11f9d4076891c6954cde0606425", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4d59decd7c59d11f9d4076891c6954cde0606425", "committedDate": "2020-08-19T14:37:12Z", "message": "Add support for event deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e56dd54092efed90919b697c3a7db0edcf06fb85", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e56dd54092efed90919b697c3a7db0edcf06fb85", "committedDate": "2020-08-19T16:45:10Z", "message": "Add deletion support for relationship"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b45265daf37ebc58af0b42d0c0168299bb8c2a85", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b45265daf37ebc58af0b42d0c0168299bb8c2a85", "committedDate": "2020-08-19T16:53:31Z", "message": "add void return type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzUzNDQw", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-471353440", "createdAt": "2020-08-20T07:58:39Z", "commit": {"oid": "b45265daf37ebc58af0b42d0c0168299bb8c2a85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzo1ODozOVrOHDyNZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzo1ODozOVrOHDyNZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzczMDQwNg==", "bodyText": "This part of the code is one candidate to become a really unreadable one because the logic tree here is quite complex.\nMaybe we can try to understand all the different parameters that will create a different execution and the find a good way to put it in the code.\nI am saying that because I am changing this chunk of code in a different PR in the same way you are doing.", "url": "https://github.com/dhis2/dhis2-core/pull/5959#discussion_r473730406", "createdAt": "2020-08-20T07:58:39Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/DefaultTrackerImportService.java", "diffHunk": "@@ -102,19 +102,28 @@ public TrackerImportReport importTracker( TrackerImportParams params )\n             notifier.notify( params.getJobConfiguration(), \"(\" + params.getUsername() + \") Import:Start\" );\n         }\n \n-        List<TrackerBundle> trackerBundles = preheatBundle( params, importReport );\n-\n-        trackerBundles = preProcessBundle( trackerBundles, importReport );\n-\n-        TrackerValidationReport validationReport = validateBundle( params, importReport, trackerBundles );\n-\n-        if ( validationReport.hasErrors() )\n+        if ( TrackerImportStrategy.DELETE == params.getImportStrategy() )\n         {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45265daf37ebc58af0b42d0c0168299bb8c2a85"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzUzOTg0", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-471353984", "createdAt": "2020-08-20T07:59:25Z", "commit": {"oid": "b45265daf37ebc58af0b42d0c0168299bb8c2a85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzo1OToyNVrOHDyRhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzo1OToyNVrOHDyRhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzczMTQ2Mg==", "bodyText": "This declaration is repeated in the if and in the else, put it outside of the block to remove the duplication of code", "url": "https://github.com/dhis2/dhis2-core/pull/5959#discussion_r473731462", "createdAt": "2020-08-20T07:59:25Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/DefaultTrackerImportService.java", "diffHunk": "@@ -102,19 +102,28 @@ public TrackerImportReport importTracker( TrackerImportParams params )\n             notifier.notify( params.getJobConfiguration(), \"(\" + params.getUsername() + \") Import:Start\" );\n         }\n \n-        List<TrackerBundle> trackerBundles = preheatBundle( params, importReport );\n-\n-        trackerBundles = preProcessBundle( trackerBundles, importReport );\n-\n-        TrackerValidationReport validationReport = validateBundle( params, importReport, trackerBundles );\n-\n-        if ( validationReport.hasErrors() )\n+        if ( TrackerImportStrategy.DELETE == params.getImportStrategy() )\n         {\n-            importReport.setStatus( TrackerStatus.ERROR );\n+            List<TrackerBundle> trackerBundles = preheatBundle( params, importReport );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45265daf37ebc58af0b42d0c0168299bb8c2a85"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzU2MjQ2", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-471356246", "createdAt": "2020-08-20T08:02:49Z", "commit": {"oid": "b45265daf37ebc58af0b42d0c0168299bb8c2a85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODowMjo0OVrOHDyhjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODowMjo0OVrOHDyhjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzczNTU2Ng==", "bodyText": "Suggestion:\nto remove the duplication of code here you can create a map to link the TrackerType to the function to delete, then use iterate over this map to run the delete method, that will take the TrackedType, the function and the bundle as parameters. This way, we will have just one delete method instead of 4.", "url": "https://github.com/dhis2/dhis2-core/pull/5959#discussion_r473735566", "createdAt": "2020-08-20T08:02:49Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/bundle/DefaultTrackerBundleService.java", "diffHunk": "@@ -228,6 +233,69 @@ public TrackerBundleReport commit( TrackerBundle bundle )\n         return bundleReport;\n     }\n \n+    @Override\n+    @Transactional\n+    public TrackerBundleReport delete( TrackerBundle bundle )\n+    {\n+        TrackerBundleReport bundleReport = new TrackerBundleReport();\n+\n+        if ( TrackerBundleMode.VALIDATE == bundle.getImportMode() )\n+        {\n+            return bundleReport;\n+        }\n+\n+        TrackerTypeReport trackedEntityReport = deleteTrackedEntities( bundle );\n+        TrackerTypeReport enrollmentReport = deleteEnrollments( bundle );\n+        TrackerTypeReport eventReport = deleteEvents( bundle );\n+        TrackerTypeReport relationshipReport = deleteRelationShips( bundle );\n+\n+        bundleReport.getTypeReportMap().put( TrackerType.TRACKED_ENTITY, trackedEntityReport );\n+        bundleReport.getTypeReportMap().put( TrackerType.ENROLLMENT, enrollmentReport );\n+        bundleReport.getTypeReportMap().put( TrackerType.EVENT, eventReport );\n+        bundleReport.getTypeReportMap().put( TrackerType.RELATIONSHIP, relationshipReport );\n+\n+        dbmsManager.clearSession();\n+        cacheManager.clearCache();\n+\n+        return bundleReport;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45265daf37ebc58af0b42d0c0168299bb8c2a85"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa4e4f0818f56db6f8899e58e7267888555b26a3", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/fa4e4f0818f56db6f8899e58e7267888555b26a3", "committedDate": "2020-08-21T12:25:11Z", "message": "Merge branch 'master' into DHIS2-9085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3cdf0713090bccc62d8177001dc21430d48cac4", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f3cdf0713090bccc62d8177001dc21430d48cac4", "committedDate": "2020-08-21T14:04:32Z", "message": "refactor to fix review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5779b1c791daff290b675d13d90e15ec49cc8566", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/5779b1c791daff290b675d13d90e15ec49cc8566", "committedDate": "2020-08-21T14:22:48Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4780e010c95936e4275fb6e5cbd66817f7e14f14", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4780e010c95936e4275fb6e5cbd66817f7e14f14", "committedDate": "2020-08-23T12:33:01Z", "message": "Merge branch 'master' into DHIS2-9085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a80ce02f067226abe2d5afddcda9dd1a62a9aa70", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/a80ce02f067226abe2d5afddcda9dd1a62a9aa70", "committedDate": "2020-08-23T13:02:21Z", "message": "add integration tests for tracker object deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24aa72b2898850544ec61192a049749c5b00a165", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/24aa72b2898850544ec61192a049749c5b00a165", "committedDate": "2020-08-23T13:23:03Z", "message": "fix: unit tests issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a34f6efc94c5257c4aee971ee10052d7e226802", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/2a34f6efc94c5257c4aee971ee10052d7e226802", "committedDate": "2020-08-23T13:34:12Z", "message": "update unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c1300265e72c39ee70a1149b68f733c83597e59", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/9c1300265e72c39ee70a1149b68f733c83597e59", "committedDate": "2020-08-23T13:44:19Z", "message": "add sample payload for tei deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe96094ff338a4c2d3d4423ad08f65bb2fdc28d4", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/fe96094ff338a4c2d3d4423ad08f65bb2fdc28d4", "committedDate": "2020-08-23T17:14:53Z", "message": "add unit test for enrollment deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "177553cb01142f7dc05329e2ba28c0b30da47e12", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/177553cb01142f7dc05329e2ba28c0b30da47e12", "committedDate": "2020-08-23T17:18:03Z", "message": "rename method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07ff14643c8ae07004f0ced267ba827c924053d", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/c07ff14643c8ae07004f0ced267ba827c924053d", "committedDate": "2020-08-24T08:50:38Z", "message": "add unit test for event deletion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMzY4NDQ1", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-473368445", "createdAt": "2020-08-24T11:12:58Z", "commit": {"oid": "c07ff14643c8ae07004f0ced267ba827c924053d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f93ba2ecc2bc5f6b5b91e8d80e7e4d53efff7f0", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4f93ba2ecc2bc5f6b5b91e8d80e7e4d53efff7f0", "committedDate": "2020-08-24T11:41:58Z", "message": "add checks for deletion of associated events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd1d976b2067da4c828374c498d38f70f558ffab", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/dd1d976b2067da4c828374c498d38f70f558ffab", "committedDate": "2020-08-24T13:20:22Z", "message": "Merge branch 'master' into DHIS2-9085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef1184b3fc0ef5a91313f98c4a6eee6d4dc8d6b8", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ef1184b3fc0ef5a91313f98c4a6eee6d4dc8d6b8", "committedDate": "2020-08-24T14:30:10Z", "message": "resolved conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a05179b9be01c4d44a13433cd788f96d1466506d", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/a05179b9be01c4d44a13433cd788f96d1466506d", "committedDate": "2020-08-24T14:31:06Z", "message": "Merge branch 'DHIS2-9085' of github.com:dhis2/dhis2-core into DHIS2-9085"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MjcxNjkz", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-474271693", "createdAt": "2020-08-25T08:51:59Z", "commit": {"oid": "a05179b9be01c4d44a13433cd788f96d1466506d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1MjowMFrOHGONkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1MjowMFrOHGONkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NjM1NQ==", "bodyText": "It wouldnt be easier to understand the flow if we just validate also the delete payload and make assumptions when actually deleting?\nIt seems to me that all this errors that we are raising here would be covered by the validation.\nAre there some false errors that would be raised?", "url": "https://github.com/dhis2/dhis2-core/pull/5959#discussion_r476286355", "createdAt": "2020-08-25T08:52:00Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/DefaultTrackerObjectsDeletionService.java", "diffHunk": "@@ -0,0 +1,444 @@\n+package org.hisp.dhis.tracker;\n+\n+/*\n+ * Copyright (c) 2004-2020, University of Oslo\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ * Redistributions of source code must retain the above copyright notice, this\n+ * list of conditions and the following disclaimer.\n+ *\n+ * Redistributions in binary form must reproduce the above copyright notice,\n+ * this list of conditions and the following disclaimer in the documentation\n+ * and/or other materials provided with the distribution.\n+ * Neither the name of the HISP project nor the names of its contributors may\n+ * be used to endorse or promote products derived from this software without\n+ * specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n+ * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+\n+import com.google.common.collect.Lists;\n+import org.hisp.dhis.program.ProgramInstance;\n+import org.hisp.dhis.program.ProgramInstanceService;\n+import org.hisp.dhis.program.ProgramStageInstance;\n+import org.hisp.dhis.program.ProgramStageInstanceService;\n+import org.hisp.dhis.relationship.RelationshipService;\n+import org.hisp.dhis.security.Authorities;\n+import org.hisp.dhis.system.notification.Notifier;\n+import org.hisp.dhis.trackedentity.TrackedEntityInstance;\n+import org.hisp.dhis.trackedentity.TrackedEntityInstanceService;\n+import org.hisp.dhis.trackedentity.TrackerAccessManager;\n+import org.hisp.dhis.tracker.bundle.TrackerBundle;\n+import org.hisp.dhis.tracker.converter.EnrollmentTrackerConverterService;\n+import org.hisp.dhis.tracker.converter.EventTrackerConverterService;\n+import org.hisp.dhis.tracker.domain.Enrollment;\n+import org.hisp.dhis.tracker.domain.Event;\n+import org.hisp.dhis.tracker.domain.Relationship;\n+import org.hisp.dhis.tracker.domain.TrackedEntity;\n+import org.hisp.dhis.tracker.report.TrackerErrorCode;\n+import org.hisp.dhis.tracker.report.TrackerErrorReport;\n+import org.hisp.dhis.tracker.report.TrackerObjectReport;\n+import org.hisp.dhis.tracker.report.TrackerTypeReport;\n+import org.hisp.dhis.user.User;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * @author Zubair Asghar\n+ */\n+\n+@Service\n+public class DefaultTrackerObjectsDeletionService\n+    implements TrackerObjectDeletionService\n+{\n+    private final ProgramInstanceService programInstanceService;\n+\n+    private final TrackedEntityInstanceService teiService;\n+\n+    private final ProgramStageInstanceService programStageInstanceService;\n+\n+    private final RelationshipService relationshipService;\n+\n+    private final TrackerAccessManager trackerAccessManager;\n+\n+    private final EnrollmentTrackerConverterService enrollmentTrackerConverterService;\n+\n+    private final EventTrackerConverterService eventTrackerConverterService;\n+\n+    private final Notifier notifier;\n+\n+    public DefaultTrackerObjectsDeletionService( ProgramInstanceService programInstanceService,\n+         TrackedEntityInstanceService entityInstanceService,\n+         ProgramStageInstanceService stageInstanceService,\n+         RelationshipService relationshipService,\n+         TrackerAccessManager trackerAccessManager,\n+         EnrollmentTrackerConverterService enrollmentTrackerConverterService,\n+         EventTrackerConverterService eventTrackerConverterService,\n+         Notifier notifier )\n+    {\n+        this.programInstanceService = programInstanceService;\n+        this.teiService = entityInstanceService;\n+        this.programStageInstanceService = stageInstanceService;\n+        this.relationshipService = relationshipService;\n+        this.trackerAccessManager = trackerAccessManager;\n+        this.enrollmentTrackerConverterService = enrollmentTrackerConverterService;\n+        this.eventTrackerConverterService = eventTrackerConverterService;\n+        this.notifier = notifier;\n+    }\n+\n+    @Override\n+    public TrackerTypeReport deleteEnrollments( TrackerBundle bundle, TrackerType trackerType )\n+    {\n+        TrackerTypeReport typeReport = new TrackerTypeReport( trackerType );\n+\n+        List<Enrollment> enrollments = bundle.getEnrollments();\n+\n+        for ( int idx = 0; idx < enrollments.size(); idx++ )\n+        {\n+            String uid = enrollments.get( idx ).getEnrollment();\n+\n+            boolean existsEnrollment = programInstanceService.programInstanceExists( uid );\n+\n+            TrackerObjectReport trackerObjectReport = new TrackerObjectReport( TrackerType.ENROLLMENT );\n+\n+            if ( existsEnrollment )\n+            {\n+                ProgramInstance programInstance = programInstanceService.getProgramInstance( uid );\n+\n+                if ( bundle.getUser() != null )\n+                {\n+                    List<TrackerErrorReport> trackerErrorReports = isAllowedToDeleteEnrollment( idx, bundle.getUser(), programInstance, bundle );\n+\n+                    if ( !trackerErrorReports.isEmpty() )\n+                    {\n+                        trackerObjectReport.getErrorReports().addAll( trackerErrorReports );\n+                        trackerObjectReport.setIndex( idx );\n+                        trackerObjectReport.setUid( uid );\n+\n+                        typeReport.addObjectReport( trackerObjectReport );\n+                        typeReport.getStats().incIgnored();\n+                        return typeReport;\n+                    }\n+                }\n+\n+                List<Event> events = eventTrackerConverterService.to( Lists.newArrayList( programInstance.getProgramStageInstances() ) );\n+\n+                TrackerBundle trackerBundle = TrackerBundle.builder().events( events ).user( bundle.getUser() ).build();\n+\n+                // Associated events should be deleted provided user has authority for that.\n+                TrackerTypeReport eventReport = deleteEvents( trackerBundle, TrackerType.EVENT );\n+\n+                if ( !eventReport.isEmpty() )\n+                {\n+                    trackerObjectReport.getErrorReports().addAll( eventReport.getErrorReports() );\n+                }\n+\n+                programInstanceService.deleteProgramInstance( programInstance );\n+                teiService.updateTrackedEntityInstance( programInstance.getEntityInstance() );\n+\n+                typeReport.addObjectReport( trackerObjectReport );\n+                typeReport.getStats().incDeleted();\n+            }\n+            else\n+            {\n+                trackerObjectReport.getErrorReports().add( TrackerErrorReport.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a05179b9be01c4d44a13433cd788f96d1466506d"}, "originalPosition": 159}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1959dd857c95ab26185657759345e5b99a3b57b", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/e1959dd857c95ab26185657759345e5b99a3b57b", "committedDate": "2020-08-25T09:33:06Z", "message": "Merge branch 'master' into DHIS2-9085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f64f8bd2e4ad8c21a7318850f17a1e8f117ffb83", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f64f8bd2e4ad8c21a7318850f17a1e8f117ffb83", "committedDate": "2020-08-25T10:45:53Z", "message": "include validation step while deletion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDA2NzUx", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-474406751", "createdAt": "2020-08-25T11:56:31Z", "commit": {"oid": "f64f8bd2e4ad8c21a7318850f17a1e8f117ffb83"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMTo1NjozMVrOHGUoKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMTo1Nzo1MVrOHGUq1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5MTQ2NQ==", "bodyText": "This error reports should be here. They should be in the validation phase.\nSame thing for all the other errors in this class.", "url": "https://github.com/dhis2/dhis2-core/pull/5959#discussion_r476391465", "createdAt": "2020-08-25T11:56:31Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/DefaultTrackerObjectsDeletionService.java", "diffHunk": "@@ -0,0 +1,365 @@\n+package org.hisp.dhis.tracker;\n+\n+/*\n+ * Copyright (c) 2004-2020, University of Oslo\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ * Redistributions of source code must retain the above copyright notice, this\n+ * list of conditions and the following disclaimer.\n+ *\n+ * Redistributions in binary form must reproduce the above copyright notice,\n+ * this list of conditions and the following disclaimer in the documentation\n+ * and/or other materials provided with the distribution.\n+ * Neither the name of the HISP project nor the names of its contributors may\n+ * be used to endorse or promote products derived from this software without\n+ * specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n+ * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+\n+import com.google.common.collect.Lists;\n+import org.hisp.dhis.program.ProgramInstance;\n+import org.hisp.dhis.program.ProgramInstanceService;\n+import org.hisp.dhis.program.ProgramStageInstance;\n+import org.hisp.dhis.program.ProgramStageInstanceService;\n+import org.hisp.dhis.relationship.RelationshipService;\n+import org.hisp.dhis.security.Authorities;\n+import org.hisp.dhis.trackedentity.TrackedEntityInstance;\n+import org.hisp.dhis.trackedentity.TrackedEntityInstanceService;\n+import org.hisp.dhis.trackedentity.TrackerAccessManager;\n+import org.hisp.dhis.tracker.bundle.TrackerBundle;\n+import org.hisp.dhis.tracker.converter.EnrollmentTrackerConverterService;\n+import org.hisp.dhis.tracker.converter.EventTrackerConverterService;\n+import org.hisp.dhis.tracker.domain.Enrollment;\n+import org.hisp.dhis.tracker.domain.Event;\n+import org.hisp.dhis.tracker.domain.Relationship;\n+import org.hisp.dhis.tracker.domain.TrackedEntity;\n+import org.hisp.dhis.tracker.report.TrackerErrorCode;\n+import org.hisp.dhis.tracker.report.TrackerErrorReport;\n+import org.hisp.dhis.tracker.report.TrackerObjectReport;\n+import org.hisp.dhis.tracker.report.TrackerTypeReport;\n+import org.hisp.dhis.user.User;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * @author Zubair Asghar\n+ */\n+\n+@Service\n+public class DefaultTrackerObjectsDeletionService\n+    implements TrackerObjectDeletionService\n+{\n+    private final ProgramInstanceService programInstanceService;\n+\n+    private final TrackedEntityInstanceService teiService;\n+\n+    private final ProgramStageInstanceService programStageInstanceService;\n+\n+    private final RelationshipService relationshipService;\n+\n+    private final TrackerAccessManager trackerAccessManager;\n+\n+    private final EnrollmentTrackerConverterService enrollmentTrackerConverterService;\n+\n+    private final EventTrackerConverterService eventTrackerConverterService;\n+\n+    public DefaultTrackerObjectsDeletionService( ProgramInstanceService programInstanceService,\n+         TrackedEntityInstanceService entityInstanceService,\n+         ProgramStageInstanceService stageInstanceService,\n+         RelationshipService relationshipService,\n+         TrackerAccessManager trackerAccessManager,\n+         EnrollmentTrackerConverterService enrollmentTrackerConverterService,\n+         EventTrackerConverterService eventTrackerConverterService )\n+    {\n+        this.programInstanceService = programInstanceService;\n+        this.teiService = entityInstanceService;\n+        this.programStageInstanceService = stageInstanceService;\n+        this.relationshipService = relationshipService;\n+        this.trackerAccessManager = trackerAccessManager;\n+        this.enrollmentTrackerConverterService = enrollmentTrackerConverterService;\n+        this.eventTrackerConverterService = eventTrackerConverterService;\n+    }\n+\n+    @Override\n+    public TrackerTypeReport deleteEnrollments( TrackerBundle bundle, TrackerType trackerType )\n+    {\n+        TrackerTypeReport typeReport = new TrackerTypeReport( trackerType );\n+\n+        List<Enrollment> enrollments = bundle.getEnrollments();\n+\n+        for ( int idx = 0; idx < enrollments.size(); idx++ )\n+        {\n+            String uid = enrollments.get( idx ).getEnrollment();\n+\n+            TrackerObjectReport trackerObjectReport = new TrackerObjectReport( TrackerType.ENROLLMENT );\n+\n+            ProgramInstance programInstance = programInstanceService.getProgramInstance( uid );\n+\n+            if ( bundle.getUser() != null )\n+            {\n+                List<TrackerErrorReport> trackerErrorReports = isAllowedToDeleteEnrollment( idx, bundle.getUser(), programInstance, bundle );\n+\n+                if ( !trackerErrorReports.isEmpty() )\n+                {\n+                    trackerObjectReport.getErrorReports().addAll( trackerErrorReports );\n+                    trackerObjectReport.setIndex( idx );\n+                    trackerObjectReport.setUid( uid );\n+\n+                    typeReport.addObjectReport( trackerObjectReport );\n+                    typeReport.getStats().incIgnored();\n+                    return typeReport;\n+                }\n+            }\n+\n+            List<Event> events = eventTrackerConverterService.to( Lists.newArrayList( programInstance.getProgramStageInstances() ) );\n+\n+            TrackerBundle trackerBundle = TrackerBundle.builder().events( events ).user( bundle.getUser() ).build();\n+\n+            // Associated events should be deleted provided user has authority for that.\n+            TrackerTypeReport eventReport = deleteEvents( trackerBundle, TrackerType.EVENT );\n+\n+            if ( !eventReport.isEmpty() )\n+            {\n+                trackerObjectReport.getErrorReports().addAll( eventReport.getErrorReports() );\n+            }\n+\n+            programInstanceService.deleteProgramInstance( programInstance );\n+            teiService.updateTrackedEntityInstance( programInstance.getEntityInstance() );\n+\n+            typeReport.addObjectReport( trackerObjectReport );\n+            typeReport.getStats().incDeleted();\n+        }\n+\n+        return typeReport;\n+    }\n+\n+    @Override\n+    public TrackerTypeReport deleteEvents( TrackerBundle bundle, TrackerType trackerType )\n+    {\n+        TrackerTypeReport typeReport = new TrackerTypeReport( trackerType );\n+\n+        List<Event> events = bundle.getEvents();\n+\n+        for ( int idx = 0; idx < events.size(); idx++ )\n+        {\n+            String uid = events.get( idx ).getEvent();\n+\n+            TrackerObjectReport trackerObjectReport = new TrackerObjectReport( TrackerType.EVENT );\n+\n+            List<TrackerErrorReport> trackerErrorReports = new ArrayList<>();\n+\n+            ProgramStageInstance programStageInstance = programStageInstanceService.getProgramStageInstance( uid );\n+\n+            List<String> errors = trackerAccessManager.canDelete( bundle.getUser(), programStageInstance, false );\n+\n+            if ( !errors.isEmpty() )\n+            {\n+                errors.forEach( error -> trackerErrorReports.add( TrackerErrorReport.builder()\n+                    .mainKlass( ProgramStageInstance.class )\n+                    .errorMessage( error )\n+                    .build( bundle ) ) );\n+\n+                trackerObjectReport.getErrorReports().addAll( trackerErrorReports );\n+                trackerObjectReport.setIndex( idx );\n+                trackerObjectReport.setUid( uid );\n+\n+                typeReport.addObjectReport( trackerObjectReport );\n+                typeReport.getStats().incIgnored();\n+                return typeReport;\n+            }\n+\n+            programStageInstanceService.deleteProgramStageInstance( programStageInstance );\n+\n+            if ( programStageInstance.getProgramStage().getProgram().isRegistration() )\n+            {\n+                teiService.updateTrackedEntityInstance( programStageInstance.getProgramInstance().getEntityInstance() );\n+            }\n+\n+            typeReport.addObjectReport( trackerObjectReport );\n+            typeReport.getStats().incDeleted();\n+        }\n+\n+        return typeReport;\n+    }\n+\n+    @Override\n+    public TrackerTypeReport deleteTrackedEntityInstances( TrackerBundle bundle, TrackerType trackerType )\n+    {\n+        TrackerTypeReport typeReport = new TrackerTypeReport( trackerType );\n+\n+        List<TrackedEntity> trackedEntities = bundle.getTrackedEntities();\n+\n+        for ( int idx = 0; idx < trackedEntities.size(); idx++ )\n+        {\n+            String uid = trackedEntities.get( idx ).getTrackedEntity();\n+\n+            TrackerObjectReport trackerObjectReport = new TrackerObjectReport( TrackerType.TRACKED_ENTITY );\n+\n+            org.hisp.dhis.trackedentity.TrackedEntityInstance daoEntityInstance = teiService\n+                    .getTrackedEntityInstance( uid );\n+\n+            if ( bundle.getUser() != null )\n+            {\n+                List<TrackerErrorReport> trackerErrorReports = isAllowedToDeleteTrackedEntity( idx, bundle.getUser(), daoEntityInstance, bundle );\n+\n+                if ( !trackerErrorReports.isEmpty() )\n+                {\n+                    trackerObjectReport.getErrorReports().addAll( trackerErrorReports );\n+                    trackerObjectReport.setIndex( idx );\n+                    trackerObjectReport.setUid( uid );\n+\n+                    typeReport.addObjectReport( trackerObjectReport );\n+                    typeReport.getStats().incIgnored();\n+                    return typeReport;\n+                }\n+            }\n+\n+            Set<ProgramInstance> programInstances = daoEntityInstance.getProgramInstances();\n+\n+            List<Enrollment> enrollments = enrollmentTrackerConverterService.to( Lists.newArrayList( programInstances ) );\n+\n+            TrackerBundle trackerBundle = TrackerBundle.builder().enrollments( enrollments ).user( bundle.getUser() ).build();\n+\n+            // Associated enrollments should be deleted provided user has authority for that.\n+            TrackerTypeReport enrollmentReport = deleteEnrollments( trackerBundle, TrackerType.ENROLLMENT );\n+\n+            if ( !enrollmentReport.isEmpty() )\n+            {\n+                trackerObjectReport.getErrorReports().addAll( enrollmentReport.getErrorReports() );\n+            }\n+\n+            teiService.deleteTrackedEntityInstance( daoEntityInstance );\n+\n+            typeReport.addObjectReport( trackerObjectReport );\n+            typeReport.getStats().incDeleted();\n+        }\n+\n+        return typeReport;\n+    }\n+\n+    @Override\n+    public TrackerTypeReport deleteRelationShips( TrackerBundle bundle, TrackerType trackerType )\n+    {\n+        TrackerTypeReport typeReport = new TrackerTypeReport( trackerType );\n+\n+        List<Relationship> relationships = bundle.getRelationships();\n+\n+        for ( int idx = 0; idx < relationships.size(); idx++ )\n+        {\n+            String uid = relationships.get( idx ).getRelationship();\n+\n+            TrackerObjectReport trackerObjectReport = new TrackerObjectReport( TrackerType.RELATIONSHIP );\n+\n+            List<TrackerErrorReport> trackerErrorReports = new ArrayList<>();\n+\n+            org.hisp.dhis.relationship.Relationship relationship = relationshipService.getRelationship( uid );\n+\n+            List<String> errors = trackerAccessManager.canWrite( bundle.getUser(), relationship );\n+\n+            if ( !errors.isEmpty() )\n+            {\n+                errors.forEach( error -> trackerErrorReports.add( TrackerErrorReport.builder()\n+                    .mainKlass( org.hisp.dhis.relationship.Relationship.class )\n+                    .errorMessage( error )\n+                    .build( bundle ) ) );\n+\n+                trackerObjectReport.getErrorReports().addAll( trackerErrorReports );\n+                trackerObjectReport.setIndex( idx );\n+                trackerObjectReport.setUid( uid );\n+\n+                typeReport.addObjectReport( trackerObjectReport );\n+                typeReport.getStats().incIgnored();\n+                return typeReport;\n+            }\n+\n+            relationshipService.deleteRelationship( relationship );\n+\n+            typeReport.getStats().incDeleted();\n+        }\n+\n+        return typeReport;\n+    }\n+\n+    private List<TrackerErrorReport> isAllowedToDeleteEnrollment( int index, User user, ProgramInstance pi, TrackerBundle bundle )\n+    {\n+        List<TrackerErrorReport> errorReports = new ArrayList<>();\n+\n+        Set<ProgramStageInstance> notDeletedProgramStageInstances = pi.getProgramStageInstances().stream()\n+            .filter( psi -> !psi.isDeleted() )\n+            .collect( Collectors.toSet() );\n+\n+        if ( !notDeletedProgramStageInstances.isEmpty() && !user.isAuthorized( Authorities.F_ENROLLMENT_CASCADE_DELETE.getAuthority() ) )\n+        {\n+            TrackerErrorReport trackerErrorReport = TrackerErrorReport.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64f8bd2e4ad8c21a7318850f17a1e8f117ffb83"}, "originalPosition": 309}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5MjE1MA==", "bodyText": "Why is this a warning?\nIf import error is not empty it means that the importer didnt manage to delete something that was supposed to delete.", "url": "https://github.com/dhis2/dhis2-core/pull/5959#discussion_r476392150", "createdAt": "2020-08-25T11:57:51Z", "author": {"login": "enricocolasante"}, "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/DefaultTrackerImportService.java", "diffHunk": "@@ -181,6 +188,26 @@ protected void commitBundle( TrackerImportParams params, TrackerImportReport imp\n         }\n     }\n \n+    protected void deleteBundle( TrackerImportParams params, TrackerImportReport importReport, List<TrackerBundle> trackerBundles )\n+    {\n+        Timer commitTimer = new SystemTimer().start();\n+\n+        trackerBundles.forEach( tb -> importReport.getBundleReports().add( trackerBundleService.delete( tb ) ) );\n+\n+        if ( !importReport.isEmpty() )\n+        {\n+            importReport.setStatus( TrackerStatus.WARNING );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64f8bd2e4ad8c21a7318850f17a1e8f117ffb83"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f690112f51dcdfcdc56f33be9afecdf92607d4ef", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f690112f51dcdfcdc56f33be9afecdf92607d4ef", "committedDate": "2020-08-25T15:36:27Z", "message": "MWT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8e02a452803d49e83ccddb8ae7fff665c22a208", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/d8e02a452803d49e83ccddb8ae7fff665c22a208", "committedDate": "2020-08-25T15:52:35Z", "message": "Merge branch 'master' into DHIS2-9085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab903680fcbc655359feb5b4795496c5d38f56b5", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/ab903680fcbc655359feb5b4795496c5d38f56b5", "committedDate": "2020-08-25T16:06:48Z", "message": "Merge branch 'master' into DHIS2-9085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "049259bfa5c19f02cad21be20dc212b08cd49a0a", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/049259bfa5c19f02cad21be20dc212b08cd49a0a", "committedDate": "2020-08-25T18:52:38Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b10e04b9187082df79c3555a6bed7c9e350aa7e9", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/b10e04b9187082df79c3555a6bed7c9e350aa7e9", "committedDate": "2020-08-26T09:05:11Z", "message": "fix code smells"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a579a4574bdb7ba235aec6bd511ed3e7b4e4c4a", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/9a579a4574bdb7ba235aec6bd511ed3e7b4e4c4a", "committedDate": "2020-08-26T09:39:43Z", "message": "refactor to fix duplicate code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d1af865923538153014e32306cedb8418c41623", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/4d1af865923538153014e32306cedb8418c41623", "committedDate": "2020-08-27T11:02:38Z", "message": "Merge branch 'master' into DHIS2-9085"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0aaa82b90a7f043400b5b5f18418012ee14a379", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f0aaa82b90a7f043400b5b5f18418012ee14a379", "committedDate": "2020-08-27T11:03:23Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f189743e0891773e7a9076cb06d3e12830130e30", "author": {"user": {"login": "zubaira", "name": "Zubair Asghar"}}, "url": "https://github.com/dhis2/dhis2-core/commit/f189743e0891773e7a9076cb06d3e12830130e30", "committedDate": "2020-08-27T12:26:02Z", "message": "Add todo message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Njc0MjI1", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-476674225", "createdAt": "2020-08-27T12:34:45Z", "commit": {"oid": "f189743e0891773e7a9076cb06d3e12830130e30"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Njc5OTkw", "url": "https://github.com/dhis2/dhis2-core/pull/5959#pullrequestreview-476679990", "createdAt": "2020-08-27T12:42:17Z", "commit": {"oid": "f189743e0891773e7a9076cb06d3e12830130e30"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2532, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}