{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MjYyNTM0", "number": 6153, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDoyMDo0NFrOEjndjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxNjoxMFrOEmjuyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1NzgyMTU2OnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDoyMDo0NFrOHSEUBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNzoyMzoyNFrOHXNEnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw==", "bodyText": "Could be this Exception Handler be moved at the CrudControllerAdvice level? The CrudControllerAdvice is annotated with @ControllerAdvice and it is applied to all the controllers in the system.\nI'm just thinking here that perhaps this handler is very specific to ANalytics, so it's better to keep it separated from the global exception handling strategy.\nIn any case, I would perhaps make the ExceptionHandler class its own class, which could be perhaps applied to all *AnalyticsManager in the system.", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r488707077", "createdAt": "2020-09-15T14:20:44Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -628,4 +672,26 @@ private String resolveCoordinateFieldColumnName( String coordinateField, EventQu\n         }\n         return coordinateField;\n     }\n+\n+    protected static class ExceptionHandler", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "originalPosition": 296}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMTA5OQ==", "bodyText": "Hey @luciano-fiandesio,\nthis method is just deciding which exception should be thrown. It's very specific to this situation.\nOnce the exception is thrown, it will be handled by the CrudControllerAdvice:\n@ExceptionHandler( QueryRuntimeException.class ) public void queryRuntimeExceptionHandler( QueryRuntimeException ex, HttpServletResponse response, HttpServletRequest request ) { webMessageService.send( WebMessageUtils.conflict( ex.getMessage(), ex.getErrorCode() ), response, request ); }", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r488711099", "createdAt": "2020-09-15T14:25:47Z", "author": {"login": "maikelarabori"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -628,4 +672,26 @@ private String resolveCoordinateFieldColumnName( String coordinateField, EventQu\n         }\n         return coordinateField;\n     }\n+\n+    protected static class ExceptionHandler", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw=="}, "originalCommit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "originalPosition": 296}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMjc3NQ==", "bodyText": "Regarding the second point, this is could be done. But would require a great amount of refactoring. I would say we can create a task for it if you guys agree, and we can tackle as part of another PR.\nWhat do you think?", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r488712775", "createdAt": "2020-09-15T14:27:49Z", "author": {"login": "maikelarabori"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -628,4 +672,26 @@ private String resolveCoordinateFieldColumnName( String coordinateField, EventQu\n         }\n         return coordinateField;\n     }\n+\n+    protected static class ExceptionHandler", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw=="}, "originalCommit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "originalPosition": 296}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA5MzQ2OQ==", "bodyText": "This sounds like a task for a different issue/PR. I will merge this PR. @maikelarabori you can create a new issue for the second part of that comment and discuss further with Luciano :)", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r494093469", "createdAt": "2020-09-24T07:23:24Z", "author": {"login": "stian-sandvold"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -628,4 +672,26 @@ private String resolveCoordinateFieldColumnName( String coordinateField, EventQu\n         }\n         return coordinateField;\n     }\n+\n+    protected static class ExceptionHandler", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw=="}, "originalCommit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "originalPosition": 296}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODY2NzYxOnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxNjoxMFrOHWp-nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxNjoxMFrOHWp-nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxODQ5Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public JdbcEventAnalyticsManager(JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,\n          \n          \n            \n                public JdbcEventAnalyticsManager( JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r493518492", "createdAt": "2020-09-23T12:16:10Z", "author": {"login": "stian-sandvold"}, "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -102,10 +106,14 @@\n @Component( \"org.hisp.dhis.analytics.event.EventAnalyticsManager\" )\n public class JdbcEventAnalyticsManager\n     extends AbstractJdbcEventAnalyticsManager\n-        implements EventAnalyticsManager\n+    implements EventAnalyticsManager\n {\n-    public JdbcEventAnalyticsManager( JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,\n-        ProgramIndicatorService programIndicatorService, ProgramIndicatorSubqueryBuilder programIndicatorSubqueryBuilder )\n+\n+    private static final String OPEN_IN = \" in (\";\n+\n+    public JdbcEventAnalyticsManager(JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3857, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}