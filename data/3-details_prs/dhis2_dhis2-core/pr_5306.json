{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NDk2MjYy", "number": 5306, "title": "fix: Use TrackedEntityAttributeValueService to update values in SMS submissions", "bodyText": "This PR contains two fixes:\n\nEnsure the TrackedEntityAttributeValueService is used in the SMS compression listener when processing enrolment submissions.\nEnsure all metadata is retrieved when initialising the Compression listener (some types were missing), for use with hashing of UIDs.", "createdAt": "2020-04-04T09:31:09Z", "url": "https://github.com/dhis2/dhis2-core/pull/5306", "merged": true, "mergeCommit": {"oid": "f25a06fe45112bd4cfbfee1de739ff82f48293c6"}, "closed": true, "closedAt": "2020-04-07T08:36:36Z", "author": {"login": "JasperTimm"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUQjhhgH2gAyMzk4NDk2MjYyOjNkNDRiM2JiZjYwODdmZTczNjZkNTI0NDI2ZjIwYzBmN2VjNjQ2MWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcU48dEgFqTM4Nzk2OTYzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3d44b3bbf6087fe7366d524426f20c0f7ec6461d", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/3d44b3bbf6087fe7366d524426f20c0f7ec6461d", "committedDate": "2020-04-04T07:41:51Z", "message": "fix: ensure TEI attribs are updated in SMS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80fd481273610185839a7d00355d3e0c7339dc66", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/80fd481273610185839a7d00355d3e0c7339dc66", "committedDate": "2020-04-04T09:27:34Z", "message": "fix: ensure old attrib value is used when updating"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3bf71342ec990b79a93ff5b1dff5ad9db0ef161", "author": {"user": null}, "url": "https://github.com/dhis2/dhis2-core/commit/c3bf71342ec990b79a93ff5b1dff5ad9db0ef161", "committedDate": "2020-04-04T09:27:53Z", "message": "fix: ensure all metadata is collected for SMS listeners"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3OTY5NjM0", "url": "https://github.com/dhis2/dhis2-core/pull/5306#pullrequestreview-387969634", "createdAt": "2020-04-06T06:45:17Z", "commit": {"oid": "c3bf71342ec990b79a93ff5b1dff5ad9db0ef161"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwNjo0NToxN1rOGBJwCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwNjo0NToxN1rOGBJwCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2MTUxMg==", "bodyText": "@JasperTimm the SDK is not downloading this metadata. Should we do it? Also, I would say that trackedEntityInstances, enrollments, events and relationships are data. In a typical use case the android app would not have all this data because it could be huge", "url": "https://github.com/dhis2/dhis2-core/pull/5306#discussion_r403861512", "createdAt": "2020-04-06T06:45:17Z", "author": {"login": "vgarciabnz"}, "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/listener/CompressionSMSListener.java", "diffHunk": "@@ -245,6 +249,13 @@ private SMSMetadata getMetadata( Date lastSyncDate )\n         meta.trackedEntityAttributes = getTypeUidsBefore( TrackedEntityAttribute.class, lastSyncDate );\n         meta.programs = getTypeUidsBefore( Program.class, lastSyncDate );\n         meta.organisationUnits = getTypeUidsBefore( OrganisationUnit.class, lastSyncDate );\n+        meta.programStages = getTypeUidsBefore( ProgramStage.class, lastSyncDate );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3bf71342ec990b79a93ff5b1dff5ad9db0ef161"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2738, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}