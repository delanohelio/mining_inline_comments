{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NzQ2OTgz", "number": 5565, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwNjoyNzoxNFrOD7GRyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwNjoyNzoxNFrOD7GRyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMjk1NDM0OnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/enrollment/AbstractEnrollmentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwNjoyNzoxNFrOGTOM2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwNjozMTozNlrOGTOTsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwODc5NQ==", "bodyText": "Shouldn't we use ImportSummary here, rather than throw an Exception?", "url": "https://github.com/dhis2/dhis2-core/pull/5565#discussion_r422808795", "createdAt": "2020-05-11T06:27:14Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/enrollment/AbstractEnrollmentService.java", "diffHunk": "@@ -1201,8 +1200,12 @@ private boolean doValidationOfMandatoryAttributes( User user )\n             validateAttributeType( attribute, importOptions, importConflicts );\n         }\n \n-        TrackedEntityInstance instance = trackedEntityInstanceService.getTrackedEntityInstance( trackedEntityInstance, TrackedEntityInstanceParams.TRUE,\n-            importOptions.getUser() );\n+        List<String> errors = trackerAccessManager.canRead( importOptions.getUser(), trackedEntityInstance );\n+\n+        if ( !errors.isEmpty() )\n+        {\n+            throw new IllegalQueryException( errors.toString() );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e9b9f653e201be07248d503a2fefafcffdf704b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgxMDU0NQ==", "bodyText": "Yes, 100%, but it would break how it currently works. The getTrackedEntityinstance raised did this IllegalQueryException, and I didn't want to break compatibility (it also broke several tests). Since this is getting backported, I say stay with what we have right now without changing how the API contract behaves. For the new importer this is already gone long time ago.", "url": "https://github.com/dhis2/dhis2-core/pull/5565#discussion_r422810545", "createdAt": "2020-05-11T06:31:36Z", "author": {"login": "mortenoh"}, "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/enrollment/AbstractEnrollmentService.java", "diffHunk": "@@ -1201,8 +1200,12 @@ private boolean doValidationOfMandatoryAttributes( User user )\n             validateAttributeType( attribute, importOptions, importConflicts );\n         }\n \n-        TrackedEntityInstance instance = trackedEntityInstanceService.getTrackedEntityInstance( trackedEntityInstance, TrackedEntityInstanceParams.TRUE,\n-            importOptions.getUser() );\n+        List<String> errors = trackerAccessManager.canRead( importOptions.getUser(), trackedEntityInstance );\n+\n+        if ( !errors.isEmpty() )\n+        {\n+            throw new IllegalQueryException( errors.toString() );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwODc5NQ=="}, "originalCommit": {"oid": "3e9b9f653e201be07248d503a2fefafcffdf704b"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3452, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}