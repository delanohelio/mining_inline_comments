{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NDY4OTY1", "number": 5830, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxODo1Mzo1MlrOERkyxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzo0ODozOFrOEVAd9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2ODY0MDcwOnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-support/dhis-support-db-migration/src/main/resources/org/hisp/dhis/db/migration/2.35/V2_35_11__Add_sequentialcounter_procedure.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxODo1Mzo1MlrOG2XbiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxODo1Mzo1MlrOG2XbiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY2MDE2OQ==", "bodyText": "I'm a bit worried that this TABLE LOCK - ROW EXCLUSIVE is going to generate a lot of deadlocks under moderate concurrency. I think we should at least test it with a stress test, simulating 50/100 concurrent users.", "url": "https://github.com/dhis2/dhis2-core/pull/5830#discussion_r459660169", "createdAt": "2020-07-23T18:53:52Z", "author": {"login": "luciano-fiandesio"}, "path": "dhis-2/dhis-support/dhis-support-db-migration/src/main/resources/org/hisp/dhis/db/migration/2.35/V2_35_11__Add_sequentialcounter_procedure.sql", "diffHunk": "@@ -0,0 +1,27 @@\n+CREATE OR REPLACE FUNCTION incrementSequentialCounter(counter_owner text, counter_key text, i integer) RETURNS integer AS $$\n+\tDECLARE\n+\t\t-- Get the initial count, or 0 if it doesnt exist\n+\t\tcurrent_counter integer;\n+\tBEGIN\n+\t\t-- Lock the row, so noone else gets an old count.\n+\t\tLOCK TABLE sequentialnumbercounter IN ROW EXCLUSIVE MODE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cbaa97eb9ef096f8d0a6a6ce9bbd186e7931776"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNDYzMjIxOnYy", "diffSide": "RIGHT", "path": "dhis-2/dhis-support/dhis-support-db-migration/src/main/resources/org/hisp/dhis/db/migration/2.35/V2_35_11__Add_sequentialcounter_procedure.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzo0ODozOFrOG7hMew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzo0ODozOFrOG7hMew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA2MzAzNQ==", "bodyText": "@luciano-fiandesio / @stian-sandvold , please synchronize this Flyway migration version with the others PR's:\n#5876\n#5885", "url": "https://github.com/dhis2/dhis2-core/pull/5830#discussion_r465063035", "createdAt": "2020-08-04T13:48:38Z", "author": {"login": "maikelarabori"}, "path": "dhis-2/dhis-support/dhis-support-db-migration/src/main/resources/org/hisp/dhis/db/migration/2.35/V2_35_11__Add_sequentialcounter_procedure.sql", "diffHunk": "@@ -0,0 +1,24 @@\n+-- remove primary key on id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "142418385f32d131a1b217bf76c9beeaaf0b7ba6"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3951, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}