{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNDU2MzE2", "number": 4735, "title": "Check for BUILD file for bazel projects only", "bodyText": "We removed a check for BUILD to fix #4692 but this caused problems for internal projects.", "createdAt": "2020-08-04T00:09:55Z", "url": "https://github.com/flutter/flutter-intellij/pull/4735", "merged": true, "mergeCommit": {"oid": "0cc436a109e5dc033cce26397401300763ff9468"}, "closed": true, "closedAt": "2020-08-04T22:40:52Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7bKZAAH2gAyNDYyNDU2MzE2OjRmMWY2Y2E2MTUzZTNkOWY5ZGU3OTU2MTNhODNiODE3M2IyNDE2Yjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7so4_AH2gAyNDYyNDU2MzE2OjY1ZWVmNTU1MDQ5ODhkYTUwZTA4NDBiZmU1MTk3ZTM5Zjc0NTQwYjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f1f6ca6153e3d9f9de795613a83b8173b2416b9", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/4f1f6ca6153e3d9f9de795613a83b8173b2416b9", "committedDate": "2020-08-04T00:06:24Z", "message": "Check for BUILD file for bazel projects only"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNDIwMDM5", "url": "https://github.com/flutter/flutter-intellij/pull/4735#pullrequestreview-460420039", "createdAt": "2020-08-04T00:29:04Z", "commit": {"oid": "4f1f6ca6153e3d9f9de795613a83b8173b2416b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwMDoyOTowNFrOG7M8cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwMDoyOTowNFrOG7M8cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDczMTI0OA==", "bodyText": "checking for a BUILD file could be fragile. Instead ,it would be better to check whether the directory is under the bazel root directory. I think that is the equivalent of what isAppDir is doing externally.", "url": "https://github.com/flutter/flutter-intellij/pull/4735#discussion_r464731248", "createdAt": "2020-08-04T00:29:04Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/run/MainFile.java", "diffHunk": "@@ -120,14 +121,17 @@ public boolean hasFlutterImports() {\n   @Nullable\n   private static VirtualFile findAppDir(@Nullable VirtualFile file, @NotNull Project project) {\n     for (VirtualFile candidate = file; inProject(candidate, project); candidate = candidate.getParent()) {\n-      if (isAppDir(candidate)) return candidate;\n+      if (isAppDir(candidate, project)) return candidate;\n     }\n     return null;\n   }\n \n-  private static boolean isAppDir(@NotNull VirtualFile dir) {\n+  private static boolean isAppDir(@NotNull VirtualFile dir, @NotNull Project project) {\n     return dir.isDirectory() && (\n-      dir.findChild(\"pubspec.yaml\") != null || dir.findChild(\".packages\") != null);\n+      dir.findChild(\"pubspec.yaml\") != null ||\n+      (WorkspaceCache.getInstance(project).isBazel() && dir.findChild(\"BUILD\") != null) ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f1f6ca6153e3d9f9de795613a83b8173b2416b9"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fdcf87c481d6a7147519f99984adc078ed08aab", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/2fdcf87c481d6a7147519f99984adc078ed08aab", "committedDate": "2020-08-04T19:16:42Z", "message": "Use workspace to return root for bazel projects"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMTAxMzY0", "url": "https://github.com/flutter/flutter-intellij/pull/4735#pullrequestreview-461101364", "createdAt": "2020-08-04T19:21:04Z", "commit": {"oid": "2fdcf87c481d6a7147519f99984adc078ed08aab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxOToyMTowNFrOG7uHOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxOToyMTowNFrOG7uHOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI3NDY4MA==", "bodyText": "you should assert workspace != null instead of using an if.\nisBazel() is equivalent to workspace != null.", "url": "https://github.com/flutter/flutter-intellij/pull/4735#discussion_r465274680", "createdAt": "2020-08-04T19:21:04Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/run/MainFile.java", "diffHunk": "@@ -120,16 +121,22 @@ public boolean hasFlutterImports() {\n \n   @Nullable\n   private static VirtualFile findAppDir(@Nullable VirtualFile file, @NotNull Project project) {\n+    if (WorkspaceCache.getInstance(project).isBazel()) {\n+      Workspace workspace = WorkspaceCache.getInstance(project).get();\n+      if (workspace != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fdcf87c481d6a7147519f99984adc078ed08aab"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMTAzNDI1", "url": "https://github.com/flutter/flutter-intellij/pull/4735#pullrequestreview-461103425", "createdAt": "2020-08-04T19:22:09Z", "commit": {"oid": "2fdcf87c481d6a7147519f99984adc078ed08aab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxOToyMjowOVrOG7uJeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxOToyMjowOVrOG7uJeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI3NTI1Nw==", "bodyText": "comment that this method is only appropriate for non-bazel projects or continue to require passing in the project and asserting. I'd hate for someone else to start using this method in a place where it is triggered for a bazel project.", "url": "https://github.com/flutter/flutter-intellij/pull/4735#discussion_r465275257", "createdAt": "2020-08-04T19:22:09Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/run/MainFile.java", "diffHunk": "@@ -120,16 +121,22 @@ public boolean hasFlutterImports() {\n \n   @Nullable\n   private static VirtualFile findAppDir(@Nullable VirtualFile file, @NotNull Project project) {\n+    if (WorkspaceCache.getInstance(project).isBazel()) {\n+      Workspace workspace = WorkspaceCache.getInstance(project).get();\n+      if (workspace != null) {\n+        return workspace.getRoot();\n+      }\n+    }\n+\n     for (VirtualFile candidate = file; inProject(candidate, project); candidate = candidate.getParent()) {\n-      if (isAppDir(candidate, project)) return candidate;\n+      if (isAppDir(candidate)) return candidate;\n     }\n     return null;\n   }\n \n-  private static boolean isAppDir(@NotNull VirtualFile dir, @NotNull Project project) {\n+  private static boolean isAppDir(@NotNull VirtualFile dir) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fdcf87c481d6a7147519f99984adc078ed08aab"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65eef55504988da50e0840bfe5197e39f74540b9", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/65eef55504988da50e0840bfe5197e39f74540b9", "committedDate": "2020-08-04T20:28:06Z", "message": "Add assert statements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3164, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}