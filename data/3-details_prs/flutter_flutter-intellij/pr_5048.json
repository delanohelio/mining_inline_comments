{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwOTE1NjE5", "number": 5048, "title": "Channel command: run 'flutter channel'", "bodyText": "The FlutterSdk.returnOutputOfQuery() is derived from queryFlutterConfigImpl(). The command to run becomes a parameter and post-processing is moved out of that method and into its caller.", "createdAt": "2020-11-14T00:31:39Z", "url": "https://github.com/flutter/flutter-intellij/pull/5048", "merged": true, "mergeCommit": {"oid": "800a87653b21177c19712839de5a90aa57c68ac1"}, "closed": true, "closedAt": "2020-11-16T18:51:43Z", "author": {"login": "stevemessick"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcQVu4AH2gAyNTIwOTE1NjE5OjFjN2U4ZDA5YmI1NDI1YjUzMDM2NWM3OTA3OTA3ODFiZWU1ODc3NDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddIrvDgH2gAyNTIwOTE1NjE5OmYwNzNiZDBmYzNkZDNmYTIxMzc4Y2NlYTI2ODQ1MDA2ZjI1YWFmYjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1c7e8d09bb5425b530365c790790781bee587743", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/1c7e8d09bb5425b530365c790790781bee587743", "committedDate": "2020-11-14T00:09:20Z", "message": "Define a command to run: flutter channel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af1be0e6bb75c498d7700274125c2dc6bd07954b", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/af1be0e6bb75c498d7700274125c2dc6bd07954b", "committedDate": "2020-11-14T00:29:35Z", "message": "Add more post-processing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDU0Mzc3", "url": "https://github.com/flutter/flutter-intellij/pull/5048#pullrequestreview-531454377", "createdAt": "2020-11-16T15:52:52Z", "commit": {"oid": "af1be0e6bb75c498d7700274125c2dc6bd07954b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo1Mjo1M1rOH0FJUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo1Mjo1M1rOH0FJUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3MjMwNw==", "bodyText": "Do we want to throw here? Return null?\nFor a longer tail of users, the channel text will be just the git branch they're on for the flutter repo. We may want to handle unknown names, and map them to something like 'unknown' (instead of it being an error condition).", "url": "https://github.com/flutter/flutter-intellij/pull/5048#discussion_r524372307", "createdAt": "2020-11-16T15:52:53Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/sdk/FlutterSdkChannel.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 The Chromium Authors. All rights reserved.\n+ * Use of this source code is governed by a BSD-style license that can be\n+ * found in the LICENSE file.\n+ */\n+package io.flutter.sdk;\n+\n+import org.jetbrains.annotations.NotNull;\n+\n+public class FlutterSdkChannel {\n+\n+  public enum ID {\n+\n+    // Do not change this order.\n+    STABLE(\"stable\"), BETA(\"beta\"), DEV(\"dev\"), MASTER(\"master\");\n+\n+    private final String name;\n+\n+    ID(String name) {\n+      this.name = name;\n+    }\n+\n+    public String toString() {\n+      return name;\n+    }\n+\n+    @NotNull\n+    public static ID fromText(String name) {\n+      switch (name) {\n+        case \"master\":\n+          return MASTER;\n+        case \"dev\":\n+          return DEV;\n+        case \"beta\":\n+          return BETA;\n+        case \"stable\":\n+          return STABLE;\n+        default:\n+          throw new IllegalArgumentException(\"Unknown channel: \" + name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af1be0e6bb75c498d7700274125c2dc6bd07954b"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNTM1MTE0", "url": "https://github.com/flutter/flutter-intellij/pull/5048#pullrequestreview-531535114", "createdAt": "2020-11-16T17:16:05Z", "commit": {"oid": "af1be0e6bb75c498d7700274125c2dc6bd07954b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzoxNjowNlrOH0JGHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzoxNjowNlrOH0JGHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNzAyMw==", "bodyText": "what is EDT?", "url": "https://github.com/flutter/flutter-intellij/pull/5048#discussion_r524437023", "createdAt": "2020-11-16T17:16:06Z", "author": {"login": "helin24"}, "path": "src/io/flutter/sdk/FlutterSdk.java", "diffHunk": "@@ -478,72 +491,64 @@ public String queryFlutterConfig(String key, boolean useCachedValue) {\n       return cachedConfigValues.get(key);\n     }\n \n-    cachedConfigValues.put(key, queryFlutterConfigImpl(key));\n-    return cachedConfigValues.get(key);\n+    String stdout = returnOutputOfQuery(flutterConfig(\"--machine\"));\n+    if (stdout != null) {\n+      try {\n+        final JsonElement elem = JsonUtils.parseString(stdout.substring(stdout.indexOf('{')));\n+        if (elem.isJsonNull()) {\n+          FlutterUtils.warn(LOG, \"Invalid Json from flutter config\");\n+          return null;\n+        }\n+\n+        final JsonObject obj = elem.getAsJsonObject();\n+        final JsonPrimitive primitive = obj.getAsJsonPrimitive(key);\n+        if (primitive != null) {\n+          cachedConfigValues.put(key, stdout);\n+          return cachedConfigValues.get(key);\n+        }\n+      }\n+      catch (JsonSyntaxException ignored) {\n+      }\n+    }\n+    return null;\n   }\n \n-  private String queryFlutterConfigImpl(String key) {\n-    final FlutterCommand command = flutterConfig(\"--machine\");\n+  // Do not run this on EDT.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af1be0e6bb75c498d7700274125c2dc6bd07954b"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f073bd0fc3dd3fa21378ccea26845006f25aafb5", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/f073bd0fc3dd3fa21378ccea26845006f25aafb5", "committedDate": "2020-11-16T17:48:03Z", "message": "Add unknown channel"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3015, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}