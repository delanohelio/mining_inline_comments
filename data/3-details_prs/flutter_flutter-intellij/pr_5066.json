{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MjYxNDMy", "number": 5066, "title": "Use existing devtools for bazel in panel and remove opening devtools for tests", "bodyText": "We're currently launching a new devtools server when opening the embedded browser, but for bazel projects it is faster to use the existing devtools server.", "createdAt": "2020-11-19T22:03:17Z", "url": "https://github.com/flutter/flutter-intellij/pull/5066", "merged": true, "mergeCommit": {"oid": "64925d8aac303523f9b9ab35b526d1a7e8bc82ad"}, "closed": true, "closedAt": "2020-12-01T17:16:28Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdecIR-gFqTUzNTcwMDk0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh83F-gFqTU0MjA5OTk3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NzAwOTQx", "url": "https://github.com/flutter/flutter-intellij/pull/5066#pullrequestreview-535700941", "createdAt": "2020-11-20T19:01:21Z", "commit": {"oid": "ba53f0d4a331270eca7d0306600b01962b37ea73"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowMToyMVrOH3dLPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowMToyMVrOH3dLPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxMTc0MA==", "bodyText": "why is there a 15 second timeout?", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r527911740", "createdAt": "2020-11-20T19:01:21Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/devtools/DevToolsManager.java", "diffHunk": "@@ -237,23 +194,27 @@ public void openBrowserIntoPanel(String uri, ContentManager contentManager, Stri\n       devToolsInstance.openPanel(project, uri, contentManager, tabName, pageName);\n     }\n     else {\n-      @Nullable final OSProcessHandler handler =\n-        isBazel(project) ? getProcessHandlerForBazel() : getProcessHandlerForPub();\n+      if (isBazel(project)) {\n+        try {\n+          devToolsInstance = getDevToolsInstance().get(15, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba53f0d4a331270eca7d0306600b01962b37ea73"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NzA0MDU1", "url": "https://github.com/flutter/flutter-intellij/pull/5066#pullrequestreview-535704055", "createdAt": "2020-11-20T19:06:07Z", "commit": {"oid": "ba53f0d4a331270eca7d0306600b01962b37ea73"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowNjowN1rOH3dUiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowNjowN1rOH3dUiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxNDEyMA==", "bodyText": "discussing offline if there is a more robust way to achieve the same result. I worry about all the extra edge cases this could introduce.", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r527914120", "createdAt": "2020-11-20T19:06:07Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/devtools/DevToolsManager.java", "diffHunk": "@@ -298,6 +242,36 @@ private void openBrowserImpl(String uri, String screen) {\n     }\n   }\n \n+  private CompletableFuture<DevToolsInstance> getDevToolsInstance() {\n+    final CompletableFuture<DevToolsInstance> instance = new CompletableFuture<>();\n+    final Optional<FlutterApp> appsOptional =\n+      FlutterApp.allFromProjectProcess(project).stream().filter((FlutterApp app) -> app.getProject() == project).findFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba53f0d4a331270eca7d0306600b01962b37ea73"}, "originalPosition": 162}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd334e4481e03d2221fbb2464f599d5381d22220", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/dd334e4481e03d2221fbb2464f599d5381d22220", "committedDate": "2020-11-24T01:03:27Z", "message": "Use existing devtools for bazel in panel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53c710d794f1d872fd38e561ffa7a8417eac73ad", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/53c710d794f1d872fd38e561ffa7a8417eac73ad", "committedDate": "2020-11-24T01:03:27Z", "message": "Use isPresent instead of isEmpty for java 8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc21bbb4d52cf130d422289069cf98f3b2820ccc", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/cc21bbb4d52cf130d422289069cf98f3b2820ccc", "committedDate": "2020-11-24T01:03:27Z", "message": "Get server each time app is restarted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eab1df493a049421a6bbdf7ce26f54cdaeda610", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/4eab1df493a049421a6bbdf7ce26f54cdaeda610", "committedDate": "2020-11-24T01:04:09Z", "message": "Pass app to devtools"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "236f619ed2796f51bcc1f9c9b7e3be3cef68d9d5", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/236f619ed2796f51bcc1f9c9b7e3be3cef68d9d5", "committedDate": "2020-11-24T01:01:52Z", "message": "Pass app to devtools"}, "afterCommit": {"oid": "4eab1df493a049421a6bbdf7ce26f54cdaeda610", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/4eab1df493a049421a6bbdf7ce26f54cdaeda610", "committedDate": "2020-11-24T01:04:09Z", "message": "Pass app to devtools"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb29b043025f899a69e40aa4abb03402b991362a", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/fb29b043025f899a69e40aa4abb03402b991362a", "committedDate": "2020-11-30T20:05:23Z", "message": "Notes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c0f37bb7fb02a8c4274ed134d22414110ac03a8", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/5c0f37bb7fb02a8c4274ed134d22414110ac03a8", "committedDate": "2020-11-30T20:41:34Z", "message": "Remove devtools action form tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzA4MTI2", "url": "https://github.com/flutter/flutter-intellij/pull/5066#pullrequestreview-541308126", "createdAt": "2020-11-30T21:26:38Z", "commit": {"oid": "5c0f37bb7fb02a8c4274ed134d22414110ac03a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMToyNjozOFrOH8OgMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMToyNjozOFrOH8OgMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxNDIyNg==", "bodyText": "This code still has the problem that we are finding all FlutterApps for the project and picking one rather than usinig the app for the app being debugged. Can we pick the right app?", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r532914226", "createdAt": "2020-11-30T21:26:38Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/run/OpenDevToolsAction.java", "diffHunk": "@@ -50,21 +51,29 @@ public void update(@NotNull final AnActionEvent e) {\n   public void actionPerformed(@NotNull final AnActionEvent event) {\n     FlutterInitializer.sendAnalyticsAction(this);\n \n-    if (event.getProject() == null) {\n+    Project project = event.getProject();\n+    if (project == null) {\n       return;\n     }\n \n-    final DevToolsManager devToolsManager = DevToolsManager.getInstance(event.getProject());\n+    final DevToolsManager devToolsManager = DevToolsManager.getInstance(project);\n \n-    final Optional<FlutterApp> appOptional = FlutterUtils.findFlutterAppFromProject(event.getProject());\n+    final Optional<FlutterApp> appOptional =\n+      FlutterApp.allFromProjectProcess(project).stream().filter((FlutterApp app) -> app.getProject() == project).findFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0f37bb7fb02a8c4274ed134d22414110ac03a8"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "811266c035ab048939f460b8f5087195c633549a", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/811266c035ab048939f460b8f5087195c633549a", "committedDate": "2020-11-30T21:50:51Z", "message": "Set app for OpenDevToolsAction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMDk5OTc5", "url": "https://github.com/flutter/flutter-intellij/pull/5066#pullrequestreview-542099979", "createdAt": "2020-12-01T16:51:13Z", "commit": {"oid": "811266c035ab048939f460b8f5087195c633549a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3023, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}