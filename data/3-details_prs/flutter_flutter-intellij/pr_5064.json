{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNDEyNDgz", "number": 5064, "title": "Send SIGINT for bazel test processes", "bodyText": "SIGKILL is currently sent when a test process is stopped, but this can't be routed to remote processes spawned from the original one.", "createdAt": "2020-11-18T19:14:14Z", "url": "https://github.com/flutter/flutter-intellij/pull/5064", "merged": true, "mergeCommit": {"oid": "4d19dae24c9f38dbd5898f459091f840cb94752d"}, "closed": true, "closedAt": "2020-11-18T23:53:03Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddzE7lgH2gAyNTIzNDEyNDgzOjYxYTIxOTMyZjI1NjgwOGU5NTM4ZmE0MzUwMDgwMDkxNTE2Yzk4MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd3D0FgH2gAyNTIzNDEyNDgzOjQ2YzM4NTFmNDQ3YWUxMjk3N2VjMGExYmQ5OGY4ZTNlYTFhZjA0NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61a21932f256808e9538fa4350080091516c9814", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/61a21932f256808e9538fa4350080091516c9814", "committedDate": "2020-11-18T19:11:35Z", "message": "Send SIGINT for bazel test processes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODcxOTcx", "url": "https://github.com/flutter/flutter-intellij/pull/5064#pullrequestreview-533871971", "createdAt": "2020-11-18T21:00:53Z", "commit": {"oid": "61a21932f256808e9538fa4350080091516c9814"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMTowMDo1M1rOH2B97Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMTowMDo1M1rOH2B97Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQxNzM4OQ==", "bodyText": "Add a comment indicating why softKill should be preferred.\nYour comment for this CL is about the right level of granularity.\nSIGKILL is currently sent when a test process is stopped, but this can't be routed to remote processes spawned from the original one.", "url": "https://github.com/flutter/flutter-intellij/pull/5064#discussion_r526417389", "createdAt": "2020-11-18T21:00:53Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/utils/MostlySilentOsProcessHandler.java", "diffHunk": "@@ -30,14 +32,33 @@\n  * for more information.\n  */\n public class MostlySilentOsProcessHandler extends OSProcessHandler {\n+  private boolean softKill;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a21932f256808e9538fa4350080091516c9814"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODcyOTI2", "url": "https://github.com/flutter/flutter-intellij/pull/5064#pullrequestreview-533872926", "createdAt": "2020-11-18T21:02:08Z", "commit": {"oid": "61a21932f256808e9538fa4350080091516c9814"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMTowMjowOVrOH2CAjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMTowMjowOVrOH2CAjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQxODA2MA==", "bodyText": "Can we verify whether we were able to kill the process and fail if we weren't able to?", "url": "https://github.com/flutter/flutter-intellij/pull/5064#discussion_r526418060", "createdAt": "2020-11-18T21:02:09Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/utils/MostlySilentOsProcessHandler.java", "diffHunk": "@@ -30,14 +32,33 @@\n  * for more information.\n  */\n public class MostlySilentOsProcessHandler extends OSProcessHandler {\n+  private boolean softKill;\n+\n   public MostlySilentOsProcessHandler(@NotNull GeneralCommandLine commandLine)\n+    throws ExecutionException {\n+    this(commandLine, false);\n+  }\n+\n+  public MostlySilentOsProcessHandler(@NotNull GeneralCommandLine commandLine, boolean softKill)\n     throws ExecutionException {\n     super(commandLine);\n+    this.softKill = softKill;\n   }\n \n   @NotNull\n   @Override\n   protected BaseOutputReader.Options readerOptions() {\n     return BaseOutputReader.Options.forMostlySilentProcess();\n   }\n+\n+  @Override\n+  protected void doDestroyProcess() {\n+    final Process process = getProcess();\n+    if (softKill && SystemInfo.isUnix && shouldDestroyProcessRecursively() && processCanBeKilledByOS(process)) {\n+      UnixProcessManager.sendSigIntToProcessTree(process);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a21932f256808e9538fa4350080091516c9814"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d9d151bfacbb90d701b61774833e9fa90f1b841", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/8d9d151bfacbb90d701b61774833e9fa90f1b841", "committedDate": "2020-11-18T22:59:35Z", "message": "Add comment and log if unable to kill process"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTY1NDEw", "url": "https://github.com/flutter/flutter-intellij/pull/5064#pullrequestreview-533965410", "createdAt": "2020-11-18T23:31:13Z", "commit": {"oid": "8d9d151bfacbb90d701b61774833e9fa90f1b841"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzozMToxM1rOH2GgEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzozMToxM1rOH2GgEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5MTY2NQ==", "bodyText": "don't need the full command line string which might identify the user, just the file name.", "url": "https://github.com/flutter/flutter-intellij/pull/5064#discussion_r526491665", "createdAt": "2020-11-18T23:31:13Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/utils/MostlySilentOsProcessHandler.java", "diffHunk": "@@ -30,14 +33,43 @@\n  * for more information.\n  */\n public class MostlySilentOsProcessHandler extends OSProcessHandler {\n+  /*\n+  This determines whether a soft kill (SIGINT) is sent to the process on destroy, instead of the default SIGKILL. SIGKILL can't be routed\n+  to remote processes spawned from the original one.\n+   */\n+  private boolean softKill;\n+  private GeneralCommandLine commandLine;\n+\n   public MostlySilentOsProcessHandler(@NotNull GeneralCommandLine commandLine)\n+    throws ExecutionException {\n+    this(commandLine, false);\n+  }\n+\n+  public MostlySilentOsProcessHandler(@NotNull GeneralCommandLine commandLine, boolean softKill)\n     throws ExecutionException {\n     super(commandLine);\n+    this.softKill = softKill;\n+    this.commandLine = commandLine;\n   }\n \n   @NotNull\n   @Override\n   protected BaseOutputReader.Options readerOptions() {\n     return BaseOutputReader.Options.forMostlySilentProcess();\n   }\n+\n+  @Override\n+  protected void doDestroyProcess() {\n+    final Process process = getProcess();\n+    if (softKill && SystemInfo.isUnix && shouldDestroyProcessRecursively() && processCanBeKilledByOS(process)) {\n+      final boolean result = UnixProcessManager.sendSigIntToProcessTree(process);\n+      if (!result) {\n+        FlutterInitializer.getAnalytics().sendEvent(\"process\", \"process kill failed: \" + this.commandLine.getCommandLineString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d9d151bfacbb90d701b61774833e9fa90f1b841"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTY2MDMy", "url": "https://github.com/flutter/flutter-intellij/pull/5064#pullrequestreview-533966032", "createdAt": "2020-11-18T23:32:35Z", "commit": {"oid": "8d9d151bfacbb90d701b61774833e9fa90f1b841"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46c3851f447ae12977ec0a1bd98f8e3ea1af0444", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/46c3851f447ae12977ec0a1bd98f8e3ea1af0444", "committedDate": "2020-11-18T23:49:59Z", "message": "Remove command line str logging, may contain private info"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3017, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}