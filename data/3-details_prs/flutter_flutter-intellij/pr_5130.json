{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMDM3MzI4", "number": 5130, "title": "Start DevTools server on first request and handle exceptions", "bodyText": "We were previously starting a DevTools server on project open; this changes to starting the server when it's first requested (or if a previous attempt to start failed).\nThis change also adds exception logging and completion for various error conditions while starting the server.", "createdAt": "2020-12-17T18:08:59Z", "url": "https://github.com/flutter/flutter-intellij/pull/5130", "merged": true, "mergeCommit": {"oid": "10893c5caefc019113d88dc950dd234533e5c936"}, "closed": true, "closedAt": "2020-12-17T21:26:12Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnHJZigH2gAyNTQyMDM3MzI4Ojk2ZTQwZjg2OTQ4YzU0YjMyNGY1NmY3NWY5ZWMyNTliMjQ3M2Q5NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnJagpgH2gAyNTQyMDM3MzI4OmY1N2FjZDUwZDk1MDk3ODkxZjcyMzZhZjBmZTE1MmY3MTdiNzkyODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "96e40f86948c54b324f56f75f9ec259b2473d948", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/96e40f86948c54b324f56f75f9ec259b2473d948", "committedDate": "2020-12-17T17:39:53Z", "message": "Start DevTools server on first request and handle exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0ODg2NjQ5", "url": "https://github.com/flutter/flutter-intellij/pull/5130#pullrequestreview-554886649", "createdAt": "2020-12-17T18:43:38Z", "commit": {"oid": "96e40f86948c54b324f56f75f9ec259b2473d948"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo0MzozOFrOIIDngw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODo0NjoyMFrOIIDt7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxODc4Nw==", "bodyText": "Do we need to dispose() the devToolsInstance here?", "url": "https://github.com/flutter/flutter-intellij/pull/5130#discussion_r545318787", "createdAt": "2020-12-17T18:43:38Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/run/daemon/DevToolsService.java", "diffHunk": "@@ -92,23 +100,21 @@ private void setUpWithDaemon() {\n           return;\n         }\n         if (address == null) {\n-          Exception error = new Exception(\"DevTools address was null\");\n-          LOG.error(error);\n-          devToolsInstance.completeExceptionally(error);\n+          logExceptionAndComplete(\"DevTools address was null\");\n         }\n         else {\n           devToolsInstance.complete(new DevToolsInstance(address.host, address.port));\n         }\n       });\n     }\n     catch (ExecutionException e) {\n-      e.printStackTrace();\n+      logExceptionAndComplete(e);\n     }\n \n     ProjectManager.getInstance().addProjectManagerListener(project, new ProjectManagerListener() {\n       @Override\n       public void projectClosing(@NotNull Project project) {\n-        devToolsInstance = new CompletableFuture<>();\n+        devToolsInstance = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96e40f86948c54b324f56f75f9ec259b2473d948"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMDIwMg==", "bodyText": "Consider passing the devToolsInstance as a parameter to startServer() so that we always complete the right future (given that this field is reused over time for new instances).", "url": "https://github.com/flutter/flutter-intellij/pull/5130#discussion_r545320202", "createdAt": "2020-12-17T18:45:59Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/run/daemon/DevToolsService.java", "diffHunk": "@@ -58,7 +58,19 @@ public static DevToolsService getInstance(@NotNull final Project project) {\n \n   private DevToolsService(@NotNull final Project project) {\n     this.project = project;\n+  }\n+\n+  public CompletableFuture<DevToolsInstance> getDevToolsInstance() {\n+    // Create instance if it doesn't exist yet, or if the previous attempt failed.\n+    if (devToolsInstance == null || devToolsInstance.isCompletedExceptionally()) {\n+      devToolsInstance = new CompletableFuture<>();\n+      startServer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96e40f86948c54b324f56f75f9ec259b2473d948"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMDQzMA==", "bodyText": "Perhaps rename to devToolsInstanceFuture for clarity?", "url": "https://github.com/flutter/flutter-intellij/pull/5130#discussion_r545320430", "createdAt": "2020-12-17T18:46:20Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/run/daemon/DevToolsService.java", "diffHunk": "@@ -49,7 +49,7 @@\n   @NotNull private final Project project;\n   private DaemonApi daemonApi;\n   private ProcessHandler process;\n-  private CompletableFuture<DevToolsInstance> devToolsInstance = new CompletableFuture<>();\n+  private CompletableFuture<DevToolsInstance> devToolsInstance;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96e40f86948c54b324f56f75f9ec259b2473d948"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d028754e0ab0dd4ec509ed58a77b35d26f8eb59", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/4d028754e0ab0dd4ec509ed58a77b35d26f8eb59", "committedDate": "2020-12-17T19:03:03Z", "message": "Change future name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f57acd50d95097891f7236af0fe152f717b79280", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/f57acd50d95097891f7236af0fe152f717b79280", "committedDate": "2020-12-17T20:18:23Z", "message": "Make future atomic to ensure only one"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3055, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}