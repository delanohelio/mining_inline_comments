{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNzQ1ODg5", "number": 5121, "title": "Use project DevTools server for embedded browser", "bodyText": "This changes switches over the embedded browser to using the DevTools server that starts on project open rather than starting an instance of DevTools server associated with an app.\nFor bazel projects this currently opens a local daemon instance, but this will be changed once the run script is updated.", "createdAt": "2020-12-15T21:59:35Z", "url": "https://github.com/flutter/flutter-intellij/pull/5121", "merged": true, "mergeCommit": {"oid": "c932db7872b398a0be4e6e4067e85d06673a0b6d"}, "closed": true, "closedAt": "2020-12-16T20:15:30Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmgIhvAH2gAyNTQwNzQ1ODg5OjliMDI1MWIzNzIxOTllY2FkZmRkNjUxMzAyZmZlMTIxMzYwNzNhOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm0mIMAH2gAyNTQwNzQ1ODg5OjA2YTg1NTE3ODJkY2I3OTMzMmZkMzgxNzZlYzE0OThhNDY0NmJlNzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9b0251b372199ecadfdd651302ffe12136073a95", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/9b0251b372199ecadfdd651302ffe12136073a95", "committedDate": "2020-12-15T20:12:38Z", "message": "Use DevToolsService for project server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22fc9ef9226860c27c48b71a47d25bca183b81e4", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/22fc9ef9226860c27c48b71a47d25bca183b81e4", "committedDate": "2020-12-15T21:45:16Z", "message": "Modify for tests and remove unused methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "444f9007fddc5d417d19860065a654c9e00178e4", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/444f9007fddc5d417d19860065a654c9e00178e4", "committedDate": "2020-12-15T21:47:40Z", "message": "Expand imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa7692ad540bd012ccff042d64968f3a550b2e6e", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/aa7692ad540bd012ccff042d64968f3a550b2e6e", "committedDate": "2020-12-15T22:05:35Z", "message": "Make instance constructor package private"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzOTE4ODIw", "url": "https://github.com/flutter/flutter-intellij/pull/5121#pullrequestreview-553918820", "createdAt": "2020-12-16T17:26:54Z", "commit": {"oid": "aa7692ad540bd012ccff042d64968f3a550b2e6e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzoyNjo1NVrOIHQu9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzoyNjo1NVrOIHQu9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ4NTEwOQ==", "bodyText": "expose the Future directly instead of providing a method that might lock the UI thread.", "url": "https://github.com/flutter/flutter-intellij/pull/5121#discussion_r544485109", "createdAt": "2020-12-16T17:26:55Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/run/daemon/DevToolsService.java", "diffHunk": "@@ -71,6 +72,17 @@ private DevToolsService(@NotNull final Project project) {\n     });\n   }\n \n+  public DevToolsInstance getDevToolsInstance() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa7692ad540bd012ccff042d64968f3a550b2e6e"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzOTIwODAw", "url": "https://github.com/flutter/flutter-intellij/pull/5121#pullrequestreview-553920800", "createdAt": "2020-12-16T17:29:09Z", "commit": {"oid": "aa7692ad540bd012ccff042d64968f3a550b2e6e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzoyOTowOVrOIHQ1RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNzoyOTowOVrOIHQ1RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ4NjcyNQ==", "bodyText": "simpler pattern:\nrather than starting a pooled thread just call\nAsyncUtils.whenCompleteUiThread(DevToolsService.getInstance(myProject).getDevToolsInstance(), ...)\nand remove the invokeLater.", "url": "https://github.com/flutter/flutter-intellij/pull/5121#discussion_r544486725", "createdAt": "2020-12-16T17:29:09Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/view/FlutterView.java", "diffHunk": "@@ -429,35 +438,24 @@ protected void handleJxBrowserInstalled(FlutterApp app, InspectorService inspect\n \n   private void presentDevTools(FlutterApp app, InspectorService inspectorService, ToolWindow toolWindow, boolean isEmbedded) {\n     assert(SwingUtilities.isEventDispatchThread());\n-    final DevToolsManager devToolsManager = DevToolsManager.getInstance(app.getProject());\n \n-    if (devToolsManager.hasInstalledDevTools()) {\n-      addBrowserInspectorViewContent(app, inspectorService, toolWindow, isEmbedded);\n-    }\n-    else {\n-      presentLabel(toolWindow, INSTALLING_DEVTOOLS_LABEL);\n-      awaitDevToolsInstall(app, inspectorService, toolWindow, isEmbedded, devToolsManager);\n-    }\n+    presentLabel(toolWindow, INSTALLING_DEVTOOLS_LABEL);\n+\n+    openInspectorWithDevTools(app, inspectorService, toolWindow, isEmbedded);\n   }\n \n-  protected void awaitDevToolsInstall(FlutterApp app, InspectorService inspectorService, ToolWindow toolWindow, boolean isEmbedded, DevToolsManager devToolsManager) {\n+  protected void openInspectorWithDevTools(FlutterApp app, InspectorService inspectorService, ToolWindow toolWindow, boolean isEmbedded) {\n     ApplicationManager.getApplication().executeOnPooledThread(() -> {\n-      final CompletableFuture<Boolean> result = devToolsManager.installDevTools();\n+      final DevToolsInstance instance = DevToolsService.getInstance(myProject).getDevToolsInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa7692ad540bd012ccff042d64968f3a550b2e6e"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c554478f0ca264ab8df00da1f6b0ac84dc9edba", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/3c554478f0ca264ab8df00da1f6b0ac84dc9edba", "committedDate": "2020-12-16T18:24:20Z", "message": "Expose instance future and use async utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbaa9c2e5dc5c6df46378fd7ebfb5b8d6faf6e09", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/dbaa9c2e5dc5c6df46378fd7ebfb5b8d6faf6e09", "committedDate": "2020-12-16T18:37:18Z", "message": "Remove println and complete with exception when null"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDMyNzY0", "url": "https://github.com/flutter/flutter-intellij/pull/5121#pullrequestreview-554032764", "createdAt": "2020-12-16T19:52:47Z", "commit": {"oid": "3c554478f0ca264ab8df00da1f6b0ac84dc9edba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOTo1Mjo0N1rOIHWhWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOTo1Mjo0N1rOIHWhWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU3OTkyOA==", "bodyText": "nit: this is java. Keep private and provide getDevToolsInstance()", "url": "https://github.com/flutter/flutter-intellij/pull/5121#discussion_r544579928", "createdAt": "2020-12-16T19:52:47Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/run/daemon/DevToolsService.java", "diffHunk": "@@ -49,7 +49,7 @@\n   @NotNull private final Project project;\n   private DaemonApi daemonApi;\n   private ProcessHandler process;\n-  private CompletableFuture<DevToolsInstance> devToolsInstance = new CompletableFuture<>();\n+  public CompletableFuture<DevToolsInstance> devToolsInstance = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c554478f0ca264ab8df00da1f6b0ac84dc9edba"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDMzNDAz", "url": "https://github.com/flutter/flutter-intellij/pull/5121#pullrequestreview-554033403", "createdAt": "2020-12-16T19:53:43Z", "commit": {"oid": "3c554478f0ca264ab8df00da1f6b0ac84dc9edba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOTo1Mzo0M1rOIHWjQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOTo1Mzo0M1rOIHWjQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU4MDQxOQ==", "bodyText": "make sure the project has not gone away while you were waiting for the devToolsServer to start.", "url": "https://github.com/flutter/flutter-intellij/pull/5121#discussion_r544580419", "createdAt": "2020-12-16T19:53:43Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/view/FlutterView.java", "diffHunk": "@@ -445,16 +445,20 @@ private void presentDevTools(FlutterApp app, InspectorService inspectorService,\n   }\n \n   protected void openInspectorWithDevTools(FlutterApp app, InspectorService inspectorService, ToolWindow toolWindow, boolean isEmbedded) {\n-    ApplicationManager.getApplication().executeOnPooledThread(() -> {\n-      final DevToolsInstance instance = DevToolsService.getInstance(myProject).getDevToolsInstance();\n+    AsyncUtils.whenCompleteUiThread(DevToolsService.getInstance(myProject).devToolsInstance, (instance, error) -> {\n+      // TODO(helinx): Restart DevTools server if there's an error.\n+      if (error != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c554478f0ca264ab8df00da1f6b0ac84dc9edba"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDMzNjQz", "url": "https://github.com/flutter/flutter-intellij/pull/5121#pullrequestreview-554033643", "createdAt": "2020-12-16T19:54:02Z", "commit": {"oid": "dbaa9c2e5dc5c6df46378fd7ebfb5b8d6faf6e09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06a8551782dcb79332fd38176ec1498a4646be76", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/06a8551782dcb79332fd38176ec1498a4646be76", "committedDate": "2020-12-16T20:03:04Z", "message": "Use instance getter and skip if project has closed"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3050, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}