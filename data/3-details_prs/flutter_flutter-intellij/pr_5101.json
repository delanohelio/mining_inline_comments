{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMzA2NDMz", "number": 5101, "title": "update the live templates", "bodyText": "Some updates to our live templates:\n\nmove the super.initState() call to the first line of the initState() override (fix #5063)\nmove the system of record for the live templates to separate files in the resources/liveTemplates directory; this will make reviewing changes easier. The individual templates are copied into the resources/liveTemplates/flutter_miscellaneous.xml file as part of the ./bin/plugin generate build step (fix #4647)", "createdAt": "2020-12-07T00:53:20Z", "url": "https://github.com/flutter/flutter-intellij/pull/5101", "merged": true, "mergeCommit": {"oid": "468f5e63b741cc8c384ce28ed66917400db93625"}, "closed": true, "closedAt": "2020-12-07T18:00:25Z", "author": {"login": "devoncarew"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjqr5ugH2gAyNTMzMzA2NDMzOjdiMWQ5ZWQ4ZTQ3NWUwOWMzZTRlMTM1MzE3Y2Q0YTM4NzNmZjI4ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj4YVhgH2gAyNTMzMzA2NDMzOmUwMTAwMzI3NzYxMzQ3M2MzNWM0M2Y5OWUxMTFmNmFlNTQwYzNkZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b1d9ed8e475e09c3e4e135317cd4a3873ff2881", "author": {"user": {"login": "devoncarew", "name": "Devon Carew"}}, "url": "https://github.com/flutter/flutter-intellij/commit/7b1d9ed8e475e09c3e4e135317cd4a3873ff2881", "committedDate": "2020-12-07T00:48:33Z", "message": "update the live templates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MTgzNjg3", "url": "https://github.com/flutter/flutter-intellij/pull/5101#pullrequestreview-546183687", "createdAt": "2020-12-07T14:11:20Z", "commit": {"oid": "7b1d9ed8e475e09c3e4e135317cd4a3873ff2881"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNDoxMToyMFrOIAolkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNDoxMTo0MFrOIAomiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzNTg5MA==", "bodyText": "Nit: we don't use travis anymore. We generate the github actions file now.", "url": "https://github.com/flutter/flutter-intellij/pull/5101#discussion_r537535890", "createdAt": "2020-12-07T14:11:20Z", "author": {"login": "stevemessick"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -589,21 +591,21 @@ https://plugins.jetbrains.com/plugin/uploadPlugin\n   }\n }\n \n-/// Generate the plugin.xml from the plugin.xml.template file.\n-/// If the --release argument is given, create a git branch and\n-/// commit the new file to it, assuming the release checks pass.\n+/// Generate the plugin.xml from the plugin.xml.template file. If the --release\n+/// argument is given, create a git branch and commit the new file to it,\n+/// assuming the release checks pass.\n ///\n-/// Note: The product-matrix.json file includes a build spec for the\n-/// EAP version at the end. When the EAP version is released that needs\n-/// to be updated.\n+/// Note: The product-matrix.json file includes a build spec for the EAP version\n+/// at the end. When the EAP version is released that needs to be updated.\n class GenerateCommand extends ProductCommand {\n   final BuildCommandRunner runner;\n \n   GenerateCommand(this.runner) : super('generate');\n \n-  String get description =>\n-      'Generate a valid plugin.xml and .travis.yml for the Flutter plugin.\\n'\n-      'The plugin.xml.template and product-matrix.json are used as input.';\n+  String get description => 'Generate plugin.xml, .travis.yml, and '", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b1d9ed8e475e09c3e4e135317cd4a3873ff2881"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzNTk2Ng==", "bodyText": "Maybe add a README explaining double quotes are not allowed and new templates have to be manually added to the xml file?", "url": "https://github.com/flutter/flutter-intellij/pull/5101#discussion_r537535966", "createdAt": "2020-12-07T14:11:27Z", "author": {"login": "stevemessick"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -624,6 +627,48 @@ class GenerateCommand extends ProductCommand {\n \n   SyntheticBuildSpec makeSyntheticSpec(List specs) =>\n       SyntheticBuildSpec.fromJson(specs[0], release, specs[2]);\n+\n+  void generateLiveTemplates() {\n+    // Find all the live templates.\n+    final templateFragments = Directory(p.join('resources', 'liveTemplates'))\n+        .listSync()\n+        .where((entity) => entity is File)\n+        .where((file) => p.extension(file.path) == 'txt')\n+        .cast<File>()\n+        .toList();\n+    final templateFile =\n+        File(p.join('resources', 'liveTemplates', 'flutter_miscellaneous.xml'));\n+    var contents = templateFile.readAsStringSync();\n+\n+    log('writing ${p.relative(templateFile.path)}');\n+\n+    for (var file in templateFragments) {\n+      final name = p.basenameWithoutExtension(file.path);\n+\n+      var replaceContents = file.readAsStringSync();\n+      replaceContents = replaceContents\n+          .replaceAll('\\n', '&#10;')\n+          .replaceAll('<', '&lt;')\n+          .replaceAll('>', '&gt;');\n+\n+      // look for '<template name=\"$name\" value=\"...\"'\n+      final regexp = RegExp('<template name=\"$name\" value=\"([^\"]+)\"');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b1d9ed8e475e09c3e4e135317cd4a3873ff2881"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzNjA0MA==", "bodyText": "I don't understand this constraint. It makes it hard to add new live templates. I understand we need to control the size of the pop-up but this means we have to manually add a new one to the xml file.", "url": "https://github.com/flutter/flutter-intellij/pull/5101#discussion_r537536040", "createdAt": "2020-12-07T14:11:34Z", "author": {"login": "stevemessick"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -624,6 +627,48 @@ class GenerateCommand extends ProductCommand {\n \n   SyntheticBuildSpec makeSyntheticSpec(List specs) =>\n       SyntheticBuildSpec.fromJson(specs[0], release, specs[2]);\n+\n+  void generateLiveTemplates() {\n+    // Find all the live templates.\n+    final templateFragments = Directory(p.join('resources', 'liveTemplates'))\n+        .listSync()\n+        .where((entity) => entity is File)\n+        .where((file) => p.extension(file.path) == 'txt')\n+        .cast<File>()\n+        .toList();\n+    final templateFile =\n+        File(p.join('resources', 'liveTemplates', 'flutter_miscellaneous.xml'));\n+    var contents = templateFile.readAsStringSync();\n+\n+    log('writing ${p.relative(templateFile.path)}');\n+\n+    for (var file in templateFragments) {\n+      final name = p.basenameWithoutExtension(file.path);\n+\n+      var replaceContents = file.readAsStringSync();\n+      replaceContents = replaceContents\n+          .replaceAll('\\n', '&#10;')\n+          .replaceAll('<', '&lt;')\n+          .replaceAll('>', '&gt;');\n+\n+      // look for '<template name=\"$name\" value=\"...\"'\n+      final regexp = RegExp('<template name=\"$name\" value=\"([^\"]+)\"');\n+      final match = regexp.firstMatch(contents);\n+      if (match == null) {\n+        throw 'No entry found for \"$name\" live template in ${templateFile.path}';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b1d9ed8e475e09c3e4e135317cd4a3873ff2881"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzNjEzNg==", "bodyText": "Nit: \"content\"", "url": "https://github.com/flutter/flutter-intellij/pull/5101#discussion_r537536136", "createdAt": "2020-12-07T14:11:40Z", "author": {"login": "stevemessick"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -624,6 +627,48 @@ class GenerateCommand extends ProductCommand {\n \n   SyntheticBuildSpec makeSyntheticSpec(List specs) =>\n       SyntheticBuildSpec.fromJson(specs[0], release, specs[2]);\n+\n+  void generateLiveTemplates() {\n+    // Find all the live templates.\n+    final templateFragments = Directory(p.join('resources', 'liveTemplates'))\n+        .listSync()\n+        .where((entity) => entity is File)\n+        .where((file) => p.extension(file.path) == 'txt')\n+        .cast<File>()\n+        .toList();\n+    final templateFile =\n+        File(p.join('resources', 'liveTemplates', 'flutter_miscellaneous.xml'));\n+    var contents = templateFile.readAsStringSync();\n+\n+    log('writing ${p.relative(templateFile.path)}');\n+\n+    for (var file in templateFragments) {\n+      final name = p.basenameWithoutExtension(file.path);\n+\n+      var replaceContents = file.readAsStringSync();\n+      replaceContents = replaceContents\n+          .replaceAll('\\n', '&#10;')\n+          .replaceAll('<', '&lt;')\n+          .replaceAll('>', '&gt;');\n+\n+      // look for '<template name=\"$name\" value=\"...\"'\n+      final regexp = RegExp('<template name=\"$name\" value=\"([^\"]+)\"');\n+      final match = regexp.firstMatch(contents);\n+      if (match == null) {\n+        throw 'No entry found for \"$name\" live template in ${templateFile.path}';\n+      }\n+\n+      // Replace the existing content in the xml live template file with the\n+      // contwnt from the template $name.txt file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b1d9ed8e475e09c3e4e135317cd4a3873ff2881"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0cff4b98272dfb96d9e51bea4beadfa3af47ca2", "author": {"user": {"login": "devoncarew", "name": "Devon Carew"}}, "url": "https://github.com/flutter/flutter-intellij/commit/f0cff4b98272dfb96d9e51bea4beadfa3af47ca2", "committedDate": "2020-12-07T16:08:10Z", "message": "Merge branch 'master' into update_live_templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a281ffb364e887b229ee3c704aca1be7de1946d5", "author": {"user": {"login": "devoncarew", "name": "Devon Carew"}}, "url": "https://github.com/flutter/flutter-intellij/commit/a281ffb364e887b229ee3c704aca1be7de1946d5", "committedDate": "2020-12-07T16:19:13Z", "message": "review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e01003277613473c35c43f99e111f6ae540c3de7", "author": {"user": {"login": "devoncarew", "name": "Devon Carew"}}, "url": "https://github.com/flutter/flutter-intellij/commit/e01003277613473c35c43f99e111f6ae540c3de7", "committedDate": "2020-12-07T16:45:51Z", "message": "Merge branch 'master' into update_live_templates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3034, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}