{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNTk0NTg4", "number": 4360, "title": "Change the plugin tool to properly build the dev channel", "bodyText": "The initial dev channel support only built the specs that identified as dev channel specs. This makes a number of changes in how things are built:\n\nA dev channel build produces all versions\nA master branch build produces all versions, plus the version for integration tests\nA release build produces only the versions intended to be published (no change)\n\nThe dev channel version is now derived from the previous release and the number of weeks since its branch was committed. This is how it looks in the plugin management page:\n\n(There may be unresolved issues with point releases. I couldn't test that.)\nI did a little refactoring, too. Initialization of globals was really confusing, and now that it has to be done async it needed to be cleaned up.\n@devoncarew", "createdAt": "2020-02-05T21:29:35Z", "url": "https://github.com/flutter/flutter-intellij/pull/4360", "merged": true, "mergeCommit": {"oid": "aeef9166ed7cbe534a3fee5e1ff9d3591913cdb9"}, "closed": true, "closedAt": "2020-02-10T20:13:08Z", "author": {"login": "stevemessick"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBZzg5AH2gAyMzcxNTk0NTg4OjI3Y2QyYWRlZWIwMWIwNWVmNjkwNzFkYmI5MWJmYTgzZGY3YWJjYWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDC68jgFqTM1NjIyOTc2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27cd2adeeb01b05ef69071dbb91bfa83df7abcae", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/27cd2adeeb01b05ef69071dbb91bfa83df7abcae", "committedDate": "2020-02-05T17:43:54Z", "message": "Build artifacts for dev channel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b071e0427629371a9408deb77cc6c3f15ed1f382", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/b071e0427629371a9408deb77cc6c3f15ed1f382", "committedDate": "2020-02-05T21:00:36Z", "message": "Change the plugin tool to properly build the dev channel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3430383230cdfc3bbfc829d184722a30928db171", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/3430383230cdfc3bbfc829d184722a30928db171", "committedDate": "2020-02-05T21:27:13Z", "message": "Fix typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "393e06cb9949558368f5e71de3094fea40d4f2d0", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/393e06cb9949558368f5e71de3094fea40d4f2d0", "committedDate": "2020-02-05T22:43:55Z", "message": "Add git magic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b39feb9218d269114b84a4128fa33162469d9bb8", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/b39feb9218d269114b84a4128fa33162469d9bb8", "committedDate": "2020-02-05T22:48:01Z", "message": "debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8677098017b4b3465183c9a9b06da28e4ee8a267", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/8677098017b4b3465183c9a9b06da28e4ee8a267", "committedDate": "2020-02-05T22:59:51Z", "message": "Initialize dev channel globals only when needed (i.e. not travis)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8c137b9446a1ee48b767571ac2f8350dd9e0ec2", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/f8c137b9446a1ee48b767571ac2f8350dd9e0ec2", "committedDate": "2020-02-05T23:11:04Z", "message": "debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32483bf43bdeb9652cb7f65747f9d9a5c5f0bc88", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/32483bf43bdeb9652cb7f65747f9d9a5c5f0bc88", "committedDate": "2020-02-05T23:14:04Z", "message": "debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8355d63fc2e9634a8eabb3c208964f0e45618a34", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/8355d63fc2e9634a8eabb3c208964f0e45618a34", "committedDate": "2020-02-05T23:38:40Z", "message": "Remove obsolete comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18d0040500d870a605623d9e81dc96f001818f66", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/18d0040500d870a605623d9e81dc96f001818f66", "committedDate": "2020-02-07T21:56:16Z", "message": "Rewrite the deploy command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4085a5f8ef775681621751f3497ea36473525a9", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/d4085a5f8ef775681621751f3497ea36473525a9", "committedDate": "2020-02-07T22:06:30Z", "message": "Define envars for keystore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46234ef2e9b29f676ab53edae9f654589851d1b3", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/46234ef2e9b29f676ab53edae9f654589851d1b3", "committedDate": "2020-02-10T18:23:26Z", "message": "Update tests and refactor for testability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MTcwNDM5", "url": "https://github.com/flutter/flutter-intellij/pull/4360#pullrequestreview-356170439", "createdAt": "2020-02-10T18:40:21Z", "commit": {"oid": "46234ef2e9b29f676ab53edae9f654589851d1b3"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxODo0MDoyMVrOFnxKJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxODo0NDoyNFrOFnxSZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI0NDE5Nw==", "bodyText": "Do we need to fail the build here?", "url": "https://github.com/flutter/flutter-intellij/pull/4360#discussion_r377244197", "createdAt": "2020-02-10T18:40:21Z", "author": {"login": "devoncarew"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -241,7 +253,7 @@ Future<bool> performReleaseChecks(ProductCommand cmd) async {\n           log('the .travis.yml file needs updating: plugin generate');\n         }\n       } else {\n-        log('the current git branch must be named \"release_${cmd.releaseMajor}\"');\n+        log('the current git branch must be named \"$expectedName\"');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46234ef2e9b29f676ab53edae9f654589851d1b3"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI0NDc4Mg==", "bodyText": "Do we have the ability to publish a rev to a weekly dev build? What if we find a P0 in the dev channel and what to patch it in order to help validate a fix? a dev channel .1", "url": "https://github.com/flutter/flutter-intellij/pull/4360#discussion_r377244782", "createdAt": "2020-02-10T18:41:30Z", "author": {"login": "devoncarew"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -271,6 +283,15 @@ void separator(String name) {\n   log('${ansi.red}${ansi.bold}$name${ansi.none}', indent: false);\n }\n \n+int get devBuildNumber {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46234ef2e9b29f676ab53edae9f654589851d1b3"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI0NTgxOQ==", "bodyText": "num is a type; I assume this is valid Dart (as it analyzes correctly), but perhaps name the variable something else?", "url": "https://github.com/flutter/flutter-intellij/pull/4360#discussion_r377245819", "createdAt": "2020-02-10T18:43:29Z", "author": {"login": "devoncarew"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -316,6 +348,12 @@ Future<int> zip(String directory, String outFile) async {\n   return await exec('zip', args, cwd: p.dirname(directory));\n }\n \n+String _nextRelease() {\n+  var num = RegExp(r'release_(\\d+)').matchAsPrefix(lastReleaseName).group(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46234ef2e9b29f676ab53edae9f654589851d1b3"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI0NjMwOA==", "bodyText": "Why check against a specific number? If we need to check against 4. perhaps document in-line for other readers.", "url": "https://github.com/flutter/flutter-intellij/pull/4360#discussion_r377246308", "createdAt": "2020-02-10T18:44:24Z", "author": {"login": "devoncarew"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -632,7 +672,7 @@ class BuildCommand extends ProductCommand {\n         processedFile.writeAsStringSync(source);\n       }\n \n-      if (spec.channel == 'stable') {\n+      if (!spec.version.startsWith('4.')) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46234ef2e9b29f676ab53edae9f654589851d1b3"}, "originalPosition": 151}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f33d1d30adca554711d961facedeb34c6983746", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/9f33d1d30adca554711d961facedeb34c6983746", "committedDate": "2020-02-10T19:09:08Z", "message": "Review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MjI5NzYw", "url": "https://github.com/flutter/flutter-intellij/pull/4360#pullrequestreview-356229760", "createdAt": "2020-02-10T20:12:03Z", "commit": {"oid": "9f33d1d30adca554711d961facedeb34c6983746"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1648, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}