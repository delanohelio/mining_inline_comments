{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4ODM5OTU1", "number": 4603, "title": "Avoid updating subscribers if bazel project is disconnected", "bodyText": "When prodaccess is lost on mac, a bazel project's root directory disappears. ProjectWatch detects this and notifies subscribers, which includes the device daemon among others. This change skips notifying subscribers if disconnected.\nI tested this by keeping a project open during prodaccess loss and regain and verifying with breakpoints that refresh occurs in WorkspaceCache.\nNote that there are still some issues with this change.\n\nIntelliJ detecting rootsChanged is slow on disconnect and reconnect, often takes a few minutes to trigger\nProjectWatch seems to fail if IntelliJ experiences a 'Unable to save settings' error, which I have not been able to reproduce consistently (see below for more details)", "createdAt": "2020-06-05T23:18:00Z", "url": "https://github.com/flutter/flutter-intellij/pull/4603", "merged": true, "mergeCommit": {"oid": "2da92413534f70fb87249eafd3e984ed81d9464e"}, "closed": true, "closedAt": "2020-06-10T20:17:37Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcobCnmgH2gAyNDI4ODM5OTU1OmEzOGUyMzAyNGI2ZWZlNzU5YTM3OGUzZmVhNzFiMDVlNDdlY2VmMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp_eI7gFqTQyODM5MzcwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a38e23024b6efe759a378e3fea71b05e47ecef13", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/a38e23024b6efe759a378e3fea71b05e47ecef13", "committedDate": "2020-06-05T23:13:21Z", "message": "Avoid updating file watch if bazel project is disconnected"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjE3NzI4", "url": "https://github.com/flutter/flutter-intellij/pull/4603#pullrequestreview-426617728", "createdAt": "2020-06-08T21:01:10Z", "commit": {"oid": "a38e23024b6efe759a378e3fea71b05e47ecef13"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowMToxMVrOGgwQtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowMToxMVrOGgwQtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5ODMyNg==", "bodyText": "should we instead return early here after setting\ndisconnected = true;\n?\nsetting cache=null in this case seems a bit odd.", "url": "https://github.com/flutter/flutter-intellij/pull/4603#discussion_r436998326", "createdAt": "2020-06-08T21:01:11Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/bazel/WorkspaceCache.java", "diffHunk": "@@ -129,7 +132,12 @@ public void unsubscribe(Runnable callback) {\n    */\n   private void refresh() {\n     final Workspace workspace = Workspace.loadUncached(project);\n-    if (workspace == cache) return;\n+    if (workspace == cache && !disconnected) return;\n+    if (cache != null && workspace == null) {\n+      disconnected = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a38e23024b6efe759a378e3fea71b05e47ecef13"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9ed1643836b49b6acbfad89a690233b6eef741b", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/c9ed1643836b49b6acbfad89a690233b6eef741b", "committedDate": "2020-06-10T19:23:44Z", "message": "Skip notifying subscribers if disconnected"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzkzNzAy", "url": "https://github.com/flutter/flutter-intellij/pull/4603#pullrequestreview-428393702", "createdAt": "2020-06-10T20:13:56Z", "commit": {"oid": "c9ed1643836b49b6acbfad89a690233b6eef741b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1710, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}