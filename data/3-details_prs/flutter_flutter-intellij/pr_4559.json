{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMDU5Mjkz", "number": 4559, "title": "Add \"plugin make\" that uses Gradle instead of Ant", "bodyText": "There's more refactoring here since Gradle builds the plugin and we don't need to copy files or zip them up.\nSee the comment in runner.dart for yet another strange error that took some digging to find a work around.\nThis changes travis to use the Gradle builder. We'll see how well that works...", "createdAt": "2020-05-20T22:53:21Z", "url": "https://github.com/flutter/flutter-intellij/pull/4559", "merged": true, "mergeCommit": {"oid": "08e8895a9b6e0c43bce25670c32efb36def0ecd7"}, "closed": true, "closedAt": "2020-05-21T17:04:15Z", "author": {"login": "stevemessick"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjQ2hgAH2gAyNDIxMDU5MjkzOmIwMDk1Nzg2ZTE2ZDY0NDQ3ZGM2YTBlZjFiMDY5OThlZjA4OTY3YjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjgiAKAH2gAyNDIxMDU5MjkzOjhjM2ZlNWVlNzlhMmYwMTllNjhhZGQwMmQ4NzYzNDVmZjc0ZThhOWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/b0095786e16d64447dc6a0ef1b06998ef08967b6", "committedDate": "2020-05-20T22:31:28Z", "message": "Add \"plugin make\" that ues Gradle instead of Ant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MjY2MTIz", "url": "https://github.com/flutter/flutter-intellij/pull/4559#pullrequestreview-416266123", "createdAt": "2020-05-21T15:42:22Z", "commit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "state": "APPROVED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNTo0MjoyMlrOGY4Brg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNTo0ODoxOVrOGY4XAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODczNjk0Mg==", "bodyText": "nit: trailing comma after last param. There are several places in this file where this should also be applied. Sorry in advance for spamming with trailing comma comments :)", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428736942", "createdAt": "2020-05-21T15:42:22Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -309,13 +310,87 @@ void _copyResources(Directory from, Directory to) {\n   }\n }\n \n+class AntBuildCommand extends BuildCommand {\n+  AntBuildCommand(BuildCommandRunner runner) : super(runner, 'build');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.javac2(spec);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    int result;\n+\n+    // create the jars\n+    createDir('build/flutter-intellij/lib');\n+    result = await jar(\n+        'build/classes', 'build/flutter-intellij/lib/flutter-intellij.jar');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODczNzA2MA==", "bodyText": "trailing comma", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428737060", "createdAt": "2020-05-21T15:42:31Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -309,13 +310,87 @@ void _copyResources(Directory from, Directory to) {\n   }\n }\n \n+class AntBuildCommand extends BuildCommand {\n+  AntBuildCommand(BuildCommandRunner runner) : super(runner, 'build');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.javac2(spec);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    int result;\n+\n+    // create the jars\n+    createDir('build/flutter-intellij/lib');\n+    result = await jar(\n+        'build/classes', 'build/flutter-intellij/lib/flutter-intellij.jar');\n+    if (result != 0) {\n+      log('jar failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.isTestTarget && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File('build/flutter-intellij/lib/flutter-intellij.jar'),\n+          Directory(testTargetPath(spec)),\n+          filename: 'io.flutter.jar');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODczNzE4NA==", "bodyText": "trailing comma", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428737184", "createdAt": "2020-05-21T15:42:38Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -309,13 +310,87 @@ void _copyResources(Directory from, Directory to) {\n   }\n }\n \n+class AntBuildCommand extends BuildCommand {\n+  AntBuildCommand(BuildCommandRunner runner) : super(runner, 'build');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.javac2(spec);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    int result;\n+\n+    // create the jars\n+    createDir('build/flutter-intellij/lib');\n+    result = await jar(\n+        'build/classes', 'build/flutter-intellij/lib/flutter-intellij.jar');\n+    if (result != 0) {\n+      log('jar failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.isTestTarget && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File('build/flutter-intellij/lib/flutter-intellij.jar'),\n+          Directory(testTargetPath(spec)),\n+          filename: 'io.flutter.jar');\n+    }\n+    if (spec.isAndroidStudio) {\n+      result = await jar(\n+          'build/studio', 'build/flutter-intellij/lib/flutter-studio.jar');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODczODAxMA==", "bodyText": "trailing comma", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428738010", "createdAt": "2020-05-21T15:43:31Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -309,13 +310,87 @@ void _copyResources(Directory from, Directory to) {\n   }\n }\n \n+class AntBuildCommand extends BuildCommand {\n+  AntBuildCommand(BuildCommandRunner runner) : super(runner, 'build');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.javac2(spec);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    int result;\n+\n+    // create the jars\n+    createDir('build/flutter-intellij/lib');\n+    result = await jar(\n+        'build/classes', 'build/flutter-intellij/lib/flutter-intellij.jar');\n+    if (result != 0) {\n+      log('jar failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.isTestTarget && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File('build/flutter-intellij/lib/flutter-intellij.jar'),\n+          Directory(testTargetPath(spec)),\n+          filename: 'io.flutter.jar');\n+    }\n+    if (spec.isAndroidStudio) {\n+      result = await jar(\n+          'build/studio', 'build/flutter-intellij/lib/flutter-studio.jar');\n+      if (result != 0) {\n+        log('jar failed: ${result.toString()}');\n+        return result;\n+      }\n+    }\n+\n+    // zip it up\n+    result = await zip('build/flutter-intellij', releasesFilePath(spec));\n+    if (result != 0) {\n+      log('zip failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.copyIjVersion && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File(releasesFilePath(spec)), Directory(ijVersionPath(spec)),\n+          filename: 'flutter-intellij.zip');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODczODEyMw==", "bodyText": "trailing comma", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428738123", "createdAt": "2020-05-21T15:43:38Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -309,13 +310,87 @@ void _copyResources(Directory from, Directory to) {\n   }\n }\n \n+class AntBuildCommand extends BuildCommand {\n+  AntBuildCommand(BuildCommandRunner runner) : super(runner, 'build');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.javac2(spec);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    int result;\n+\n+    // create the jars\n+    createDir('build/flutter-intellij/lib');\n+    result = await jar(\n+        'build/classes', 'build/flutter-intellij/lib/flutter-intellij.jar');\n+    if (result != 0) {\n+      log('jar failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.isTestTarget && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File('build/flutter-intellij/lib/flutter-intellij.jar'),\n+          Directory(testTargetPath(spec)),\n+          filename: 'io.flutter.jar');\n+    }\n+    if (spec.isAndroidStudio) {\n+      result = await jar(\n+          'build/studio', 'build/flutter-intellij/lib/flutter-studio.jar');\n+      if (result != 0) {\n+        log('jar failed: ${result.toString()}');\n+        return result;\n+      }\n+    }\n+\n+    // zip it up\n+    result = await zip('build/flutter-intellij', releasesFilePath(spec));\n+    if (result != 0) {\n+      log('zip failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.copyIjVersion && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File(releasesFilePath(spec)), Directory(ijVersionPath(spec)),\n+          filename: 'flutter-intellij.zip');\n+    }\n+    return result;\n+  }\n+}\n+\n+class GradleBuildCommand extends BuildCommand {\n+  GradleBuildCommand(BuildCommandRunner runner) : super(runner, 'make');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.buildPlugin(spec, pluginVersion);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    var file = File(releasesFilePath(spec));\n+    _copyFile(\n+        File('build/distributions/flutter-intellij-$version.zip'), file.parent,\n+        filename: p.basename(file.path));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODczOTA0OA==", "bodyText": "this can be final", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428739048", "createdAt": "2020-05-21T15:44:36Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -309,13 +310,87 @@ void _copyResources(Directory from, Directory to) {\n   }\n }\n \n+class AntBuildCommand extends BuildCommand {\n+  AntBuildCommand(BuildCommandRunner runner) : super(runner, 'build');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.javac2(spec);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    int result;\n+\n+    // create the jars\n+    createDir('build/flutter-intellij/lib');\n+    result = await jar(\n+        'build/classes', 'build/flutter-intellij/lib/flutter-intellij.jar');\n+    if (result != 0) {\n+      log('jar failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.isTestTarget && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File('build/flutter-intellij/lib/flutter-intellij.jar'),\n+          Directory(testTargetPath(spec)),\n+          filename: 'io.flutter.jar');\n+    }\n+    if (spec.isAndroidStudio) {\n+      result = await jar(\n+          'build/studio', 'build/flutter-intellij/lib/flutter-studio.jar');\n+      if (result != 0) {\n+        log('jar failed: ${result.toString()}');\n+        return result;\n+      }\n+    }\n+\n+    // zip it up\n+    result = await zip('build/flutter-intellij', releasesFilePath(spec));\n+    if (result != 0) {\n+      log('zip failed: ${result.toString()}');\n+      return result;\n+    }\n+    if (spec.copyIjVersion && !isReleaseMode && !isDevChannel) {\n+      _copyFile(File(releasesFilePath(spec)), Directory(ijVersionPath(spec)),\n+          filename: 'flutter-intellij.zip');\n+    }\n+    return result;\n+  }\n+}\n+\n+class GradleBuildCommand extends BuildCommand {\n+  GradleBuildCommand(BuildCommandRunner runner) : super(runner, 'make');\n+\n+  Future<int> externalBuildCommand(BuildSpec spec) async {\n+    return runner.buildPlugin(spec, pluginVersion);\n+  }\n+\n+  Future<int> savePluginArtifact(BuildSpec spec, String version) async {\n+    var file = File(releasesFilePath(spec));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc0MjA0Ng==", "bodyText": "not your fault, but can these both be final?", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428742046", "createdAt": "2020-05-21T15:47:57Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -383,7 +464,7 @@ class BuildCommand extends ProductCommand {\n       log('spec.version: ${spec.version}');\n \n       var compileFn = () async {\n-        var r = await runner.javac2(spec);\n+        var r = await externalBuildCommand(spec);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc0MjQwMA==", "bodyText": "make variables in this method final", "url": "https://github.com/flutter/flutter-intellij/pull/4559#discussion_r428742400", "createdAt": "2020-05-21T15:48:19Z", "author": {"login": "kenzieschmoll"}, "path": "tool/plugin/lib/runner.dart", "diffHunk": "@@ -54,4 +54,29 @@ compile\n       }\n     }\n   }\n+\n+  Future<int> buildPlugin(BuildSpec spec, String version) async {\n+    var contents = '''", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0095786e16d64447dc6a0ef1b06998ef08967b6"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c3fe5ee79a2f019e68add02d876345ff74e8a9e", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/8c3fe5ee79a2f019e68add02d876345ff74e8a9e", "committedDate": "2020-05-21T16:47:32Z", "message": "Reformat and finalize"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1702, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}