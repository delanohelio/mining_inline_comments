{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwODQ4NDcy", "number": 4522, "title": "Prevent drawing child lines through other chars (https://github.com/flutter/flutter-intellij/issues/4297)", "bodyText": "Fixes #4297\nBefore (note line through child: briefly appears):\n\nAfter:", "createdAt": "2020-04-29T17:25:27Z", "url": "https://github.com/flutter/flutter-intellij/pull/4522", "merged": true, "mergeCommit": {"oid": "12d5f5bbbf2e6cf6888ff85468806d4ab108f1e8"}, "closed": true, "closedAt": "2020-05-06T16:27:35Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccbePpAH2gAyNDEwODQ4NDcyOjZkMmVmNTA0ZWYyY2Y5MjhkNjJlNGIzZWIxYmU0NjQ0NDI1ZTY3MmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcerBfCgH2gAyNDEwODQ4NDcyOmE3Mjg0N2I0MjJmYzY2ZWQ1OGUzZjMwODYyZTI1Y2Q3OTU1YjllMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6d2ef504ef2cf928d62e4b3eb1be4644425e672d", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/6d2ef504ef2cf928d62e4b3eb1be4644425e672d", "committedDate": "2020-04-29T16:56:26Z", "message": "Prevent drawing child lines through other chars"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODE1MTEy", "url": "https://github.com/flutter/flutter-intellij/pull/4522#pullrequestreview-403815112", "createdAt": "2020-04-30T19:28:53Z", "commit": {"oid": "6d2ef504ef2cf928d62e4b3eb1be4644425e672d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToyODo1M1rOGO3Udw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToyODo1M1rOGO3Udw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzOTYwNw==", "bodyText": "nit. Here and elsewhere, abbreviations so write\nstartIndex rather than startIdx.", "url": "https://github.com/flutter/flutter-intellij/pull/4522#discussion_r418239607", "createdAt": "2020-04-30T19:28:53Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/editor/WidgetIndentsHighlightingPass.java", "diffHunk": "@@ -336,7 +336,17 @@ public void paint(@NotNull Editor editor, @NotNull RangeHighlighter highlighter,\n             // Draw horizontal line to the child.\n             final VisualPosition widgetVisualPosition = editor.offsetToVisualPosition(childLine.getGuideOffset());\n             final Point widgetPoint = editor.visualPositionToXY(widgetVisualPosition);\n-            final int deltaX = widgetPoint.x - start.x;\n+\n+            final int startIdx = doc.getLineStartOffset(childLine.getLine());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d2ef504ef2cf928d62e4b3eb1be4644425e672d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODE3MDky", "url": "https://github.com/flutter/flutter-intellij/pull/4522#pullrequestreview-403817092", "createdAt": "2020-04-30T19:31:58Z", "commit": {"oid": "6d2ef504ef2cf928d62e4b3eb1be4644425e672d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOTozMTo1OFrOGO3aWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOTozMTo1OFrOGO3aWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI0MTExMg==", "bodyText": "Also update the edge case where we draw a line backward (starts at line 364). A reasonable option would be to just omit drawing the line backward if widgetLineStartX != widgetPoint.x as the backwards lines are distracting so drawing them for a case where we aren't confident that something strange has happened would be a bad thing.", "url": "https://github.com/flutter/flutter-intellij/pull/4522#discussion_r418241112", "createdAt": "2020-04-30T19:31:58Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/editor/WidgetIndentsHighlightingPass.java", "diffHunk": "@@ -347,7 +357,7 @@ public void paint(@NotNull Editor editor, @NotNull RangeHighlighter highlighter,\n                 start.x + 2,\n                 newY + lineHeight * 0.5,\n                 //start.x + charWidth  * childIndent - padding,\n-                widgetPoint.x - padding,\n+                widgetLineStartX - padding,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d2ef504ef2cf928d62e4b3eb1be4644425e672d"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODIzNTAz", "url": "https://github.com/flutter/flutter-intellij/pull/4522#pullrequestreview-403823503", "createdAt": "2020-04-30T19:41:53Z", "commit": {"oid": "6d2ef504ef2cf928d62e4b3eb1be4644425e672d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c3012b87b48df12bb6708795a7a10d0c5bd2f37", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/2c3012b87b48df12bb6708795a7a10d0c5bd2f37", "committedDate": "2020-04-30T23:45:00Z", "message": "Replace abbreviations and add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6170015f709a7a5ca7bd183dbb16b6f24fb8f592", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/6170015f709a7a5ca7bd183dbb16b6f24fb8f592", "committedDate": "2020-05-01T00:05:34Z", "message": "Skip drawing backwards line if start and widget start don't match"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af7278e318872201c2a9e81ba938557bf89ad60c", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/af7278e318872201c2a9e81ba938557bf89ad60c", "committedDate": "2020-05-05T20:58:37Z", "message": "Move finding guideline start to helper function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzE0MjA1", "url": "https://github.com/flutter/flutter-intellij/pull/4522#pullrequestreview-406714205", "createdAt": "2020-05-06T15:12:41Z", "commit": {"oid": "af7278e318872201c2a9e81ba938557bf89ad60c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNToxMjo0MVrOGRX8AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNToxMjo0MVrOGRX8AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg3MTE2OA==", "bodyText": "nit: prefer to wrap comment lines at 80 chars.", "url": "https://github.com/flutter/flutter-intellij/pull/4522#discussion_r420871168", "createdAt": "2020-05-06T15:12:41Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/editor/WidgetIndentsHighlightingPass.java", "diffHunk": "@@ -426,6 +432,38 @@ public void paint(@NotNull Editor editor, @NotNull RangeHighlighter highlighter,\n       }\n       g2d.dispose();\n     }\n+\n+    private static class GuidelineOffsetDetail {\n+      // This is the offset of the widget.\n+      final int offset;\n+      // This is the offset of the start of text in the line of the widget (which may differ from offset).\n+      final int textStartOffset;\n+\n+      GuidelineOffsetDetail(int offset, int textStartOffset) {\n+        this.offset = offset;\n+        this.textStartOffset = textStartOffset;\n+      }\n+    }\n+\n+    private GuidelineOffsetDetail getGuidelineOffsetDetail(OutlineLocation childLine,\n+                                                           Editor editor,\n+                                                           Document doc,\n+                                                           CharSequence chars) {\n+      // This additional point is computed because sometimes there are other characters on a line before the widget, e.g. if a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af7278e318872201c2a9e81ba938557bf89ad60c"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzE2ODQ5", "url": "https://github.com/flutter/flutter-intellij/pull/4522#pullrequestreview-406716849", "createdAt": "2020-05-06T15:15:24Z", "commit": {"oid": "af7278e318872201c2a9e81ba938557bf89ad60c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNToxNToyNFrOGRYEhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNToxNToyNFrOGRYEhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg3MzM1MA==", "bodyText": "end all comments with a period.", "url": "https://github.com/flutter/flutter-intellij/pull/4522#discussion_r420873350", "createdAt": "2020-05-06T15:15:24Z", "author": {"login": "jacob314"}, "path": "src/io/flutter/editor/WidgetIndentsHighlightingPass.java", "diffHunk": "@@ -352,6 +354,10 @@ public void paint(@NotNull Editor editor, @NotNull RangeHighlighter highlighter,\n               );\n             }\n             else {\n+              // If there are other characters on the same line as the widget, avoid drawing a backwards line", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af7278e318872201c2a9e81ba938557bf89ad60c"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a72847b422fc66ed58e3f30862e25cd7955b9e25", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/a72847b422fc66ed58e3f30862e25cd7955b9e25", "committedDate": "2020-05-06T16:11:21Z", "message": "Fix comment formatting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1689, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}