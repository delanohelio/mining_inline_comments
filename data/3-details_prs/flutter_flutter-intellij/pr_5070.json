{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MDIxOTcx", "number": 5070, "title": "Add platforms to the new project wizard", "bodyText": "Second page of the Android Studio 4.2 wizard looks like this. @devoncarew @pq may have ideas for improvement.\n\nThe IntelliJ view is similar but includes a Project Type selector.\nInstead of running flutter config this reads the settings file directly. It is much faster. Also, instead of running flutter channel this runs the git command directly.\nWe need to add unit tests to flutter_tools that document which fields we depend on from the settings file. We should also have a test that warns flutter_tools authors that if the locations of the settings file changes that IDE authors need to be notified.\nThe check boxes still need to be added to the wizard used by AS 4.1. That is a separate project, which may resolve itself when 4.2 becomes stable.\nLine 26 of CONTRIBUTING.md documents the additional dependency on git4idea.", "createdAt": "2020-11-21T00:23:10Z", "url": "https://github.com/flutter/flutter-intellij/pull/5070", "merged": true, "mergeCommit": {"oid": "9a9992c78e15e1be00b26c9791a11311a0e39637"}, "closed": true, "closedAt": "2020-12-17T19:09:42Z", "author": {"login": "stevemessick"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj45jgAH2gAyNTI1MDIxOTcxOmI3ZDc4YjRiZDliMmFiMmNjZmY5ZmMzNmI1MDUzNzZkMGQ5Yjk4MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnIUmCgFqTU1NDkwMTQ3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b7d78b4bd9b2ab2ccff9fc36b505376d0d9b9814", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/b7d78b4bd9b2ab2ccff9fc36b505376d0d9b9814", "committedDate": "2020-12-07T17:22:08Z", "message": "Add platforms to the new project wizard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b58071487e1c734f372a5a2ece260020d83d9e4b", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/b58071487e1c734f372a5a2ece260020d83d9e4b", "committedDate": "2020-12-07T17:22:08Z", "message": "Fix build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "250549af55e626180fa7b3b3255bac971fe99c13", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/250549af55e626180fa7b3b3255bac971fe99c13", "committedDate": "2020-12-07T17:22:08Z", "message": "Wire up buttons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f229e584c5fdf65edb05be52de2f7b93d36649b3", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/f229e584c5fdf65edb05be52de2f7b93d36649b3", "committedDate": "2020-12-08T00:23:11Z", "message": "Fix logic errors, clean up"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86d0379dc7d1b66d00617c331eba3e4982fc106a", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/86d0379dc7d1b66d00617c331eba3e4982fc106a", "committedDate": "2020-11-30T15:49:02Z", "message": "Wire up buttons"}, "afterCommit": {"oid": "f229e584c5fdf65edb05be52de2f7b93d36649b3", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/f229e584c5fdf65edb05be52de2f7b93d36649b3", "committedDate": "2020-12-08T00:23:11Z", "message": "Fix logic errors, clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27d6b654790e048b757d2304dfcb4486c8a7ea33", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/27d6b654790e048b757d2304dfcb4486c8a7ea33", "committedDate": "2020-12-08T18:38:13Z", "message": "Reimplement BoolValueProperty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1c1f79236d366acba617457cd6e3ad0a256d7e0", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/c1c1f79236d366acba617457cd6e3ad0a256d7e0", "committedDate": "2020-12-09T17:23:23Z", "message": "Ensure platform nullity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f0fb97937474f25afc026647a0caa86f8926c61", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/1f0fb97937474f25afc026647a0caa86f8926c61", "committedDate": "2020-12-09T21:41:38Z", "message": "Add settings when page two is displayed but not when Finish is clicked"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de84fd851548655ace454789848ade9d6f549249", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/de84fd851548655ace454789848ade9d6f549249", "committedDate": "2020-12-09T22:41:36Z", "message": "Externalize strings and reformat"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NjMwMjU3", "url": "https://github.com/flutter/flutter-intellij/pull/5070#pullrequestreview-549630257", "createdAt": "2020-12-10T21:48:28Z", "commit": {"oid": "de84fd851548655ace454789848ade9d6f549249"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMTo0ODoyOFrOIDey9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMTo1NTo0NFrOIDfDHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUyMTIwNg==", "bodyText": "Is this a built in plugin for IntelliJ?", "url": "https://github.com/flutter/flutter-intellij/pull/5070#discussion_r540521206", "createdAt": "2020-12-10T21:48:28Z", "author": {"login": "devoncarew"}, "path": "resources/META-INF/plugin.xml", "diffHunk": "@@ -24,6 +24,7 @@\n   <idea-version since-build=\"201.7223\" until-build=\"202.8194.7\"/>\n \n   <depends>Dart</depends>\n+  <depends>Git4Idea</depends>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de84fd851548655ace454789848ade9d6f549249"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUyMTc2NQ==", "bodyText": "Platform availability might depend on your Flutter SDK channel and 'flutter config' settings. ?", "url": "https://github.com/flutter/flutter-intellij/pull/5070#discussion_r540521765", "createdAt": "2020-12-10T21:49:28Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/FlutterBundle.properties", "diffHunk": "@@ -211,3 +211,16 @@ settings.enable.embedding.devtools=Enable embedding DevTools in the Flutter Insp\n action.new.project.title=New Flutter Project...\n welcome.new.project.title=Create New Flutter Project\n welcome.new.project.compact=New Flutter Project\n+\n+npw_platform_android=Android\n+npw_platform_ios=iOS\n+npw_platform_linux=Linux\n+npw_platform_macos=MacOS\n+npw_platform_web=Web\n+npw_platform_windows=Windows\n+npw_platform_availability_help=Platform availability depends on the Flutter SDK channel, and on 'flutter config'.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de84fd851548655ace454789848ade9d6f549249"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUyMjg1NA==", "bodyText": "And, should we have a tooltip on the 'Platform' label (on in-line text in the UI) that clarifies that it's used to select which platforms flutter create will generate template code for? And that other platforms can be added after the initial project creation.", "url": "https://github.com/flutter/flutter-intellij/pull/5070#discussion_r540522854", "createdAt": "2020-12-10T21:51:24Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/FlutterBundle.properties", "diffHunk": "@@ -211,3 +211,16 @@ settings.enable.embedding.devtools=Enable embedding DevTools in the Flutter Insp\n action.new.project.title=New Flutter Project...\n welcome.new.project.title=Create New Flutter Project\n welcome.new.project.compact=New Flutter Project\n+\n+npw_platform_android=Android\n+npw_platform_ios=iOS\n+npw_platform_linux=Linux\n+npw_platform_macos=MacOS\n+npw_platform_web=Web\n+npw_platform_windows=Windows\n+npw_platform_availability_help=Platform availability depends on the Flutter SDK channel, and on 'flutter config'.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUyMTc2NQ=="}, "originalCommit": {"oid": "de84fd851548655ace454789848ade9d6f549249"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUyNTM0Mg==", "bodyText": "I don't know if that's actually intended or if the flutter tool would pay attention to that.", "url": "https://github.com/flutter/flutter-intellij/pull/5070#discussion_r540525342", "createdAt": "2020-12-10T21:55:44Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/sdk/FlutterSdk.java", "diffHunk": "@@ -474,12 +497,85 @@ public String getDartSdkPath() {\n   }\n \n   @Nullable\n-  public FlutterSdkChannel queryFlutterChannel() {\n-    String stdout = returnOutputOfQuery(flutterChannel());\n-    if (stdout == null) {\n-      return null;\n+  @NonNls\n+  public FlutterSdkChannel queryFlutterChannel(boolean useCachedValue) {\n+    if (useCachedValue) {\n+      String channel = cachedConfigValues.get(\"channel\");\n+      if (channel != null) {\n+        return FlutterSdkChannel.fromText(channel);\n+      }\n     }\n-    return FlutterSdkChannel.fromText(stdout);\n+\n+    VirtualFile dir = LocalFileSystem.getInstance().findFileByPath(getHomePath());\n+    assert dir != null;\n+    String branch;\n+    try {\n+      branch = git4idea.light.LightGitUtilKt.getLocation(dir, GitExecutableManager.getInstance().getExecutable((Project)null));\n+    }\n+    catch (VcsException e) {\n+      LOG.error(e);\n+      branch = \"unknown\";\n+    }\n+\n+    cachedConfigValues.put(\"channel\", branch);\n+    return FlutterSdkChannel.fromText(branch);\n+  }\n+\n+  @NonNls\n+  private static final String[] PLATFORMS =\n+    new String[]{\"enable-android\", \"enable-ios\", \"enable-web\", \"enable-linux-desktop\", \"enable-macos-desktop\", \"enable-windows-desktop\"};\n+\n+  @NotNull\n+  @NonNls\n+  public Set<String> queryConfiguredPlatforms(boolean useCachedValue) {\n+    Set<String> platforms = new HashSet<>();\n+    // Someone could do: flutter config --no-enable-ios --no-enable-android", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de84fd851548655ace454789848ade9d6f549249"}, "originalPosition": 212}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c10e1de54ce75daed5c127b9af8490830bb52ef9", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/c10e1de54ce75daed5c127b9af8490830bb52ef9", "committedDate": "2020-12-11T23:47:17Z", "message": "Rework state variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2bbce79b8cdbe6cf25c3d26c2c220289b7b3940", "author": {"user": {"login": "stevemessick", "name": null}}, "url": "https://github.com/flutter/flutter-intellij/commit/b2bbce79b8cdbe6cf25c3d26c2c220289b7b3940", "committedDate": "2020-12-15T17:45:44Z", "message": "Change to run flutter config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTAxNDcy", "url": "https://github.com/flutter/flutter-intellij/pull/5070#pullrequestreview-554901472", "createdAt": "2020-12-17T19:02:01Z", "commit": {"oid": "b2bbce79b8cdbe6cf25c3d26c2c220289b7b3940"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3029, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}