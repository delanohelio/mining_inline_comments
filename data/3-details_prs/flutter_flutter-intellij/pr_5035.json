{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4Njc0ODI4", "number": 5035, "title": "Set user-data folder for embedded browser", "bodyText": "(maybe) fixes #5025\nThis changes EmbeddedBrowser to a singleton class so that we can maintain one JxBrowser Engine and Browser with a folder for the browser data.", "createdAt": "2020-11-10T18:15:03Z", "url": "https://github.com/flutter/flutter-intellij/pull/5035", "merged": true, "mergeCommit": {"oid": "fafd618b20334ef857314759aabb291c940ad022"}, "closed": true, "closedAt": "2020-11-10T23:59:23Z", "author": {"login": "helin24"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbNbpKgH2gAyNTE4Njc0ODI4OjU5ZWY0MGJkYjI4ZWJlMDkyYWUxZTZiMjI4NDE0M2U4NmIwMmIwZWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbSYgdgFqTUyNzcwMjYyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/59ef40bdb28ebe092ae1e6b2284143e86b02b0ea", "committedDate": "2020-11-10T18:12:09Z", "message": "Set user-data folder for embedded browser"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjE3ODYw", "url": "https://github.com/flutter/flutter-intellij/pull/5035#pullrequestreview-527617860", "createdAt": "2020-11-10T21:22:46Z", "commit": {"oid": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMToyMjo0NlrOHwwHMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMToyNToyNVrOHwwMkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4MTk3MA==", "bodyText": "log this instead?", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520881970", "createdAt": "2020-11-10T21:22:46Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/jxbrowser/EmbeddedBrowser.java", "diffHunk": "@@ -16,25 +16,46 @@\n import com.teamdev.jxbrowser.navigation.event.LoadFinished;\n import com.teamdev.jxbrowser.view.swing.BrowserView;\n import icons.FlutterIcons;\n+import org.jetbrains.annotations.NotNull;\n \n import java.awt.*;\n+import java.io.File;\n+import java.nio.file.Paths;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import static com.teamdev.jxbrowser.engine.RenderingMode.HARDWARE_ACCELERATED;\n \n public class EmbeddedBrowser {\n-  public void openPanel(ContentManager contentManager, String tabName, String url) {\n+  private static EmbeddedBrowser embeddedBrowser;\n+\n+  @NotNull\n+  public static EmbeddedBrowser getInstance() {\n+    if (embeddedBrowser == null) {\n+      embeddedBrowser = new EmbeddedBrowser();\n+    }\n+    return embeddedBrowser;\n+  }\n+\n+  private Browser browser;\n+\n+  private EmbeddedBrowser() {\n+    System.out.println(Paths.get(JxBrowserManager.DOWNLOAD_PATH + File.separatorChar + \"user-data\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4MzM0Ng==", "bodyText": "Do we want this to be an application singleton or a per project (per IntelliJ window) singleton? I'm guessing the 2nd one. There are several places in the code base where we have per-project singletons. You register them in the plugin's xml file and then have a slightly different singleton getter. See for example FlutterReloadManager.getInstance(Project project).", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520883346", "createdAt": "2020-11-10T21:25:25Z", "author": {"login": "devoncarew"}, "path": "src/io/flutter/jxbrowser/EmbeddedBrowser.java", "diffHunk": "@@ -16,25 +16,46 @@\n import com.teamdev.jxbrowser.navigation.event.LoadFinished;\n import com.teamdev.jxbrowser.view.swing.BrowserView;\n import icons.FlutterIcons;\n+import org.jetbrains.annotations.NotNull;\n \n import java.awt.*;\n+import java.io.File;\n+import java.nio.file.Paths;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import static com.teamdev.jxbrowser.engine.RenderingMode.HARDWARE_ACCELERATED;\n \n public class EmbeddedBrowser {\n-  public void openPanel(ContentManager contentManager, String tabName, String url) {\n+  private static EmbeddedBrowser embeddedBrowser;\n+\n+  @NotNull\n+  public static EmbeddedBrowser getInstance() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjM2NzQw", "url": "https://github.com/flutter/flutter-intellij/pull/5035#pullrequestreview-527636740", "createdAt": "2020-11-10T21:51:48Z", "commit": {"oid": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMTo1MTo0OFrOHwxBZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMTo1MTo0OFrOHwxBZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg5Njg3MQ==", "bodyText": "getInstance(project)\nI think we'd want separate instances for each window.\nI don't think IntelliJ allows opening two windows on a single project, but if it does that could be a problem.", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520896871", "createdAt": "2020-11-10T21:51:48Z", "author": {"login": "stevemessick"}, "path": "src/io/flutter/devtools/DevToolsManager.java", "diffHunk": "@@ -404,7 +404,7 @@ public void openPanel(String serviceProtocolUri, ContentManager contentManager,\n \n     //noinspection CodeBlock2Expr\n     ApplicationManager.getApplication().invokeLater(() -> {\n-      new EmbeddedBrowser().openPanel(contentManager, tabName, url);\n+      EmbeddedBrowser.getInstance().openPanel(contentManager, tabName, url);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2994f85d62b55121495d4843815282814fddf0", "author": {"user": {"login": "helin24", "name": "Helin Shiah"}}, "url": "https://github.com/flutter/flutter-intellij/commit/5b2994f85d62b55121495d4843815282814fddf0", "committedDate": "2020-11-10T23:39:33Z", "message": "Use separate engine for each project"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NzAyNjI5", "url": "https://github.com/flutter/flutter-intellij/pull/5035#pullrequestreview-527702629", "createdAt": "2020-11-10T23:58:15Z", "commit": {"oid": "5b2994f85d62b55121495d4843815282814fddf0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3006, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}