{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5OTMwNTYy", "number": 1030, "title": "[CDAP-16289] Added FLL for core plugins", "bodyText": "", "createdAt": "2020-02-26T01:06:50Z", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030", "merged": true, "mergeCommit": {"oid": "ce872e82522fcd69d8e9cfe99513be294f6ab48f"}, "closed": true, "closedAt": "2020-02-27T03:39:06Z", "author": {"login": "vravish"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH8HFwAH2gAyMzc5OTMwNTYyOjUxZjU3ZmUyZGNiYzYyOWYxZjhlYWVhNjFkOWNjZWRmMzY1NTNkZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcISg6ZgH2gAyMzc5OTMwNTYyOmYzZjY0NWNlYjY2NjFjZDIyMDUwZjVlMzU0ZDQwNjkzYjY5NzMzYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "51f57fe2dcbc629f1f8eaea61d9ccedf36553df6", "author": {"user": {"login": "vravish", "name": "Venudhar Ravishankar"}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/51f57fe2dcbc629f1f8eaea61d9ccedf36553df6", "committedDate": "2020-02-26T01:05:36Z", "message": "[CDAP-16289] Added FLL for core plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "674073105fb647e0a165306ed882740ce1331ea6", "author": {"user": {"login": "vravish", "name": "Venudhar Ravishankar"}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/674073105fb647e0a165306ed882740ce1331ea6", "committedDate": "2020-02-26T02:00:26Z", "message": "[CDAP-16289] Added FLL for core plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e", "author": {"user": {"login": "vravish", "name": "Venudhar Ravishankar"}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/087c35db5174f754d1a5fba6abc209ee645f864e", "committedDate": "2020-02-26T02:14:44Z", "message": "[CDAP-16289] Added FLL for core plugins"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzIwOTQ0", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#pullrequestreview-365320944", "createdAt": "2020-02-26T23:33:22Z", "commit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzozMzoyM1rOFvAO8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1NToyOFrOFvAq4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMTIxNg==", "bodyText": "You can just create this field with List<String> fields = conf.getFields() == null ?  ... : ... to avoid the if else block", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384831216", "createdAt": "2020-02-26T23:33:23Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/batch/aggregator/DistinctAggregator.java", "diffHunk": "@@ -106,6 +108,17 @@ public void prepareRun(BatchAggregatorContext context) throws Exception {\n     validate(context.getInputSchema(), conf.getFields(), context.getFailureCollector());\n     context.getFailureCollector().getOrThrowException();\n \n+    if (conf.getFields() == null) {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        TransformLineageRecorderUtils.getFields(context.getInputSchema()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzNjA5Mw==", "bodyText": "use new ArrayList<>(conf.getFields())", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384836093", "createdAt": "2020-02-26T23:48:25Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/batch/aggregator/DistinctAggregator.java", "diffHunk": "@@ -106,6 +108,17 @@ public void prepareRun(BatchAggregatorContext context) throws Exception {\n     validate(context.getInputSchema(), conf.getFields(), context.getFailureCollector());\n     context.getFailureCollector().getOrThrowException();\n \n+    if (conf.getFields() == null) {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        TransformLineageRecorderUtils.getFields(context.getInputSchema()),\n+        \"distinctAggregator\",\n+        \"Removed duplicates in input records.\"));\n+    } else {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        Lists.newArrayList(conf.getFields()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzNzU3OA==", "bodyText": "just create a keep list using new ArrayList<>(fieldsToKeep)", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384837578", "createdAt": "2020-02-26T23:53:01Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java", "diffHunk": "@@ -138,6 +146,25 @@ public void initialize(TransformContext context) throws Exception {\n     collector.getOrThrowException();\n   }\n \n+  @Override\n+  public void prepareRun(StageSubmitterContext context) {\n+    init(context.getInputSchema(), context.getFailureCollector());\n+\n+    List<FieldOperation> output = new ArrayList<>();\n+    Collection<String> fieldsToKeep = this.fieldsToKeep;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzODM2OA==", "bodyText": "for drops, if the fieldsToKeep is not empty, any field that is not in the keep list is dropped. See \n  \n    \n      hydrator-plugins/core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java\n    \n    \n        Lines 175 to 176\n      in\n      087c35d\n    \n    \n    \n    \n\n        \n          \n           if (!fieldsToKeep.isEmpty() && !fieldsToKeep.contains(inputFieldName)) { \n        \n\n        \n          \n               continue;", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384838368", "createdAt": "2020-02-26T23:55:28Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java", "diffHunk": "@@ -138,6 +146,25 @@ public void initialize(TransformContext context) throws Exception {\n     collector.getOrThrowException();\n   }\n \n+  @Override\n+  public void prepareRun(StageSubmitterContext context) {\n+    init(context.getInputSchema(), context.getFailureCollector());\n+\n+    List<FieldOperation> output = new ArrayList<>();\n+    Collection<String> fieldsToKeep = this.fieldsToKeep;\n+    if (fieldsToKeep.isEmpty()) {\n+      fieldsToKeep = TransformLineageRecorderUtils.getFields(context.getInputSchema());\n+    }\n+    output.addAll(TransformLineageRecorderUtils.generateOneToOnes(new ArrayList<>(fieldsToKeep),\n+      \"identity\", TransformLineageRecorderUtils.IDENTITY_TRANSFORM_DESCRIPTION));\n+    output.addAll(TransformLineageRecorderUtils.generateDrops(new ArrayList<>(fieldsToDrop)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e89c18967f3e5d342744b0b7cc69af51042f433", "author": {"user": {"login": "vravish", "name": "Venudhar Ravishankar"}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/4e89c18967f3e5d342744b0b7cc69af51042f433", "committedDate": "2020-02-27T01:42:12Z", "message": "[CDAP-16289] Added FLL for core plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb90c332ae195969ece2f2412707e7d71058f7bf", "author": {"user": {"login": "vravish", "name": "Venudhar Ravishankar"}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/fb90c332ae195969ece2f2412707e7d71058f7bf", "committedDate": "2020-02-27T01:54:14Z", "message": "[CDAP-16289] Added FLL for core plugins"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzcwNDE4", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#pullrequestreview-365370418", "createdAt": "2020-02-27T02:02:44Z", "commit": {"oid": "fb90c332ae195969ece2f2412707e7d71058f7bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c4b34730be0fc9fd31960ffae1f1a12b4d2ffae", "author": {"user": {"login": "vravish", "name": "Venudhar Ravishankar"}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/7c4b34730be0fc9fd31960ffae1f1a12b4d2ffae", "committedDate": "2020-02-27T03:10:58Z", "message": "[CDAP-16289] Added FLL for core plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3f645ceb6661cd22050f5e354d40693b69733a8", "author": {"user": {"login": "vravish", "name": "Venudhar Ravishankar"}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/f3f645ceb6661cd22050f5e354d40693b69733a8", "committedDate": "2020-02-27T03:11:43Z", "message": "Merge branch 'feature/CDAP-16289-fll-for-core-plugins-2' of https://github.com/cdapio/hydrator-plugins into feature/CDAP-16289-fll-for-core-plugins-2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1597, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}