{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5OTMwNTYy", "number": 1030, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzozMzoyMlrODjSAWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1NToyOFrODjSS2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzIxNzUyOnYy", "diffSide": "RIGHT", "path": "core-plugins/src/main/java/io/cdap/plugin/batch/aggregator/DistinctAggregator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzozMzoyM1rOFvAO8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzozMzoyM1rOFvAO8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMTIxNg==", "bodyText": "You can just create this field with List<String> fields = conf.getFields() == null ?  ... : ... to avoid the if else block", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384831216", "createdAt": "2020-02-26T23:33:23Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/batch/aggregator/DistinctAggregator.java", "diffHunk": "@@ -106,6 +108,17 @@ public void prepareRun(BatchAggregatorContext context) throws Exception {\n     validate(context.getInputSchema(), conf.getFields(), context.getFailureCollector());\n     context.getFailureCollector().getOrThrowException();\n \n+    if (conf.getFields() == null) {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        TransformLineageRecorderUtils.getFields(context.getInputSchema()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzI0OTcwOnYy", "diffSide": "RIGHT", "path": "core-plugins/src/main/java/io/cdap/plugin/batch/aggregator/DistinctAggregator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo0ODoyNVrOFvAh_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1Nzo1NlrOFvAt2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzNjA5Mw==", "bodyText": "use new ArrayList<>(conf.getFields())", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384836093", "createdAt": "2020-02-26T23:48:25Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/batch/aggregator/DistinctAggregator.java", "diffHunk": "@@ -106,6 +108,17 @@ public void prepareRun(BatchAggregatorContext context) throws Exception {\n     validate(context.getInputSchema(), conf.getFields(), context.getFailureCollector());\n     context.getFailureCollector().getOrThrowException();\n \n+    if (conf.getFields() == null) {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        TransformLineageRecorderUtils.getFields(context.getInputSchema()),\n+        \"distinctAggregator\",\n+        \"Removed duplicates in input records.\"));\n+    } else {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        Lists.newArrayList(conf.getFields()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzOTEyOA==", "bodyText": "That won't work since conf.getFields() returns an Iterable, and there's no ArrayList constructor that converts an Iterable to a list.", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384839128", "createdAt": "2020-02-26T23:57:56Z", "author": {"login": "vravish"}, "path": "core-plugins/src/main/java/io/cdap/plugin/batch/aggregator/DistinctAggregator.java", "diffHunk": "@@ -106,6 +108,17 @@ public void prepareRun(BatchAggregatorContext context) throws Exception {\n     validate(context.getInputSchema(), conf.getFields(), context.getFailureCollector());\n     context.getFailureCollector().getOrThrowException();\n \n+    if (conf.getFields() == null) {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        TransformLineageRecorderUtils.getFields(context.getInputSchema()),\n+        \"distinctAggregator\",\n+        \"Removed duplicates in input records.\"));\n+    } else {\n+      context.record(TransformLineageRecorderUtils.generateOneToOnes(\n+        Lists.newArrayList(conf.getFields()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzNjA5Mw=="}, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzI1OTgwOnYy", "diffSide": "RIGHT", "path": "core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1MzowMVrOFvAnyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1MzowMVrOFvAnyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzNzU3OA==", "bodyText": "just create a keep list using new ArrayList<>(fieldsToKeep)", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384837578", "createdAt": "2020-02-26T23:53:01Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java", "diffHunk": "@@ -138,6 +146,25 @@ public void initialize(TransformContext context) throws Exception {\n     collector.getOrThrowException();\n   }\n \n+  @Override\n+  public void prepareRun(StageSubmitterContext context) {\n+    init(context.getInputSchema(), context.getFailureCollector());\n+\n+    List<FieldOperation> output = new ArrayList<>();\n+    Collection<String> fieldsToKeep = this.fieldsToKeep;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzI2NDg5OnYy", "diffSide": "RIGHT", "path": "core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1NToyOFrOFvAq4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1NToyOFrOFvAq4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzODM2OA==", "bodyText": "for drops, if the fieldsToKeep is not empty, any field that is not in the keep list is dropped. See \n  \n    \n      hydrator-plugins/core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java\n    \n    \n        Lines 175 to 176\n      in\n      087c35d\n    \n    \n    \n    \n\n        \n          \n           if (!fieldsToKeep.isEmpty() && !fieldsToKeep.contains(inputFieldName)) { \n        \n\n        \n          \n               continue;", "url": "https://github.com/cdapio/hydrator-plugins/pull/1030#discussion_r384838368", "createdAt": "2020-02-26T23:55:28Z", "author": {"login": "yaojiefeng"}, "path": "core-plugins/src/main/java/io/cdap/plugin/transform/ProjectionTransform.java", "diffHunk": "@@ -138,6 +146,25 @@ public void initialize(TransformContext context) throws Exception {\n     collector.getOrThrowException();\n   }\n \n+  @Override\n+  public void prepareRun(StageSubmitterContext context) {\n+    init(context.getInputSchema(), context.getFailureCollector());\n+\n+    List<FieldOperation> output = new ArrayList<>();\n+    Collection<String> fieldsToKeep = this.fieldsToKeep;\n+    if (fieldsToKeep.isEmpty()) {\n+      fieldsToKeep = TransformLineageRecorderUtils.getFields(context.getInputSchema());\n+    }\n+    output.addAll(TransformLineageRecorderUtils.generateOneToOnes(new ArrayList<>(fieldsToKeep),\n+      \"identity\", TransformLineageRecorderUtils.IDENTITY_TRANSFORM_DESCRIPTION));\n+    output.addAll(TransformLineageRecorderUtils.generateDrops(new ArrayList<>(fieldsToDrop)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "087c35db5174f754d1a5fba6abc209ee645f864e"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2480, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}