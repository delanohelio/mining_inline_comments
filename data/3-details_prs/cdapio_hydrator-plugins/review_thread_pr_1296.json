{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NzY1NDgz", "number": 1296, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNzo1NDo0M1rOFJlbhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQyMToxMjoxNFrOFKLFOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTk0NzU5OnYy", "diffSide": "RIGHT", "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxNzo1NDo0M1rOIL-s_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMzoxNzowNFrOIOW1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA==", "bodyText": "writeToDataOut this method should also be modified", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r549432574", "createdAt": "2020-12-28T17:54:43Z", "author": {"login": "CuriousVini"}, "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9073013b7d41aee8fbe57df9d70e10efc6bf4209"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjkxOA==", "bodyText": "what is the existing behavior when database sink writes to DB? Is this change backwards compatible?", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r549432918", "createdAt": "2020-12-28T17:55:58Z", "author": {"login": "CuriousVini"}, "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}, "originalCommit": {"oid": "9073013b7d41aee8fbe57df9d70e10efc6bf4209"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI0NjgwOQ==", "bodyText": "What is the existing behavior when database sink writes to DB? Is this change backwards compatible?\n\nYes this change is backwards compatible. There are unit tests to confirm this, also we have created pipelines to test this. It all depends on the field type of the input structure record schema.\n\nwriteToDataOut this method should also be modified\n\nwirteToDataOut parameter (DataOutput out) accepts only primitive types. For logical type Decimal the type will be BYTES. Please let us know if there is a way on how to proceed to modify the writeToDataOut method?", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r550246809", "createdAt": "2020-12-30T16:12:51Z", "author": {"login": "ardian4"}, "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}, "originalCommit": {"oid": "9073013b7d41aee8fbe57df9d70e10efc6bf4209"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTczODcyOA==", "bodyText": "From the code it looks like existing plugin writes decimal types as bytes. After this change, the db sink will write decimal type as decimal. Is it correct?\nhttps://github.com/cdapio/hydrator-plugins/blob/develop/database-plugins/src/main/java/io/cdap/plugin/DBRecord.java#L323\n\n\nI see", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r551738728", "createdAt": "2021-01-05T06:24:23Z", "author": {"login": "CuriousVini"}, "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}, "originalCommit": {"oid": "9073013b7d41aee8fbe57df9d70e10efc6bf4209"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTkyNTA0NQ==", "bodyText": "Yes", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r551925045", "createdAt": "2021-01-05T13:17:04Z", "author": {"login": "ardian4"}, "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzMjU3NA=="}, "originalCommit": {"oid": "9073013b7d41aee8fbe57df9d70e10efc6bf4209"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MjExNjQwOnYy", "diffSide": "RIGHT", "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQyMToxMjoxNFrOIM1YkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQyMToxMjoxNFrOIM1YkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDMyODQ2NQ==", "bodyText": "Should we also add the size of the scale (int)?", "url": "https://github.com/cdapio/hydrator-plugins/pull/1296#discussion_r550328465", "createdAt": "2020-12-30T21:12:14Z", "author": {"login": "rmstar"}, "path": "database-plugins/src/main/java/io/cdap/plugin/DBRecord.java", "diffHunk": "@@ -285,6 +285,11 @@ private void writeToDB(PreparedStatement stmt, Schema.Field field, int fieldInde\n           stmt.setTimestamp(sqlIndex, Timestamp.from(record.getTimestamp(fieldName).toInstant()));\n           bytesWritten += Long.BYTES;\n           break;\n+        case DECIMAL:\n+          BigDecimal value = record.getDecimal(fieldName);\n+          stmt.setBigDecimal(sqlIndex, value);\n+          bytesWritten += value.unscaledValue().bitLength() / Byte.SIZE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9073013b7d41aee8fbe57df9d70e10efc6bf4209"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2451, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}