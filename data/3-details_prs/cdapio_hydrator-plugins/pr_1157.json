{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDI4MTQy", "number": 1157, "title": "Enable subclasses to override OutputFormat, output path implementation", "bodyText": "Fix for https://issues.cask.co/browse/CDAP-17123\n\nThe change in AbstractFileSink is required to override OutputFormat implementation for GCSSink to emit metric. PR for reference - data-integrations/google-cloud#267\nFixed a bug in which the outputdir was formatting as gs://<bucket>/path//<timeSuffix> instead of  gs://<bucket>/path/<timeSuffix>", "createdAt": "2020-08-04T21:54:40Z", "url": "https://github.com/cdapio/hydrator-plugins/pull/1157", "merged": true, "mergeCommit": {"oid": "e1994e4a9c8eef58e297900de854c8e7ce11e64e"}, "closed": true, "closedAt": "2020-08-07T22:22:23Z", "author": {"login": "greeshmaswaminathan"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7uSb3gFqTQ2MTIxNjA3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7-LtVgFqTQ2MTg1MDE4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjE2MDc1", "url": "https://github.com/cdapio/hydrator-plugins/pull/1157#pullrequestreview-461216075", "createdAt": "2020-08-04T22:19:54Z", "commit": {"oid": "274ee44e3c9ac8b8523abb9a26615cb0ab7811de"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxOTo1NFrOG7zeRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoyMjozMFrOG7ziUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM2MjUwMA==", "bodyText": "style: should have something on the previous line besides just return. Also, indentation for a new line should be 2 spaces and not 4.", "url": "https://github.com/cdapio/hydrator-plugins/pull/1157#discussion_r465362500", "createdAt": "2020-08-04T22:19:54Z", "author": {"login": "albertshau"}, "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -88,32 +88,24 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n     }\n \n     FileFormat format = config.getFormat();\n-    ValidatingOutputFormat validatingOutputFormat =\n-      pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format.name().toLowerCase(),\n-                                   format.name().toLowerCase(), config.getRawProperties());\n+    ValidatingOutputFormat validatingOutputFormat = getValidatingOutputFormat(pipelineConfigurer);\n     FormatContext context = new FormatContext(collector, pipelineConfigurer.getStageConfigurer().getInputSchema());\n     validateOutputFormatProvider(context, format, validatingOutputFormat);\n   }\n \n+  public ValidatingOutputFormat getValidatingOutputFormat(PipelineConfigurer pipelineConfigurer) {\n+    FileFormat format = config.getFormat();\n+    return\n+        pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format.name().toLowerCase(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "274ee44e3c9ac8b8523abb9a26615cb0ab7811de"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM2MzAyMA==", "bodyText": "I assume this is pulled into its own method so subclasses can use it? If that's the case, can this be protected instead of public?", "url": "https://github.com/cdapio/hydrator-plugins/pull/1157#discussion_r465363020", "createdAt": "2020-08-04T22:21:11Z", "author": {"login": "albertshau"}, "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -135,12 +127,28 @@ public void prepareRun(BatchSinkContext context) throws Exception {\n     Map<String, String> outputProperties = new HashMap<>(validatingOutputFormat.getOutputFormatConfiguration());\n     outputProperties.putAll(getFileSystemProperties(context));\n     outputProperties.put(FileOutputFormat.OUTDIR, getOutputDir(context.getLogicalStartTime()));\n-\n     context.addOutput(Output.of(config.getReferenceName(),\n                                 new SinkOutputFormatProvider(validatingOutputFormat.getOutputFormatClassName(),\n                                                              outputProperties)));\n   }\n \n+  public ValidatingOutputFormat getOutputFormatForRun(BatchSinkContext context) throws InstantiationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "274ee44e3c9ac8b8523abb9a26615cb0ab7811de"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM2MzUzOA==", "bodyText": "can this be protected instead of public?", "url": "https://github.com/cdapio/hydrator-plugins/pull/1157#discussion_r465363538", "createdAt": "2020-08-04T22:22:30Z", "author": {"login": "albertshau"}, "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -88,32 +88,24 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n     }\n \n     FileFormat format = config.getFormat();\n-    ValidatingOutputFormat validatingOutputFormat =\n-      pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format.name().toLowerCase(),\n-                                   format.name().toLowerCase(), config.getRawProperties());\n+    ValidatingOutputFormat validatingOutputFormat = getValidatingOutputFormat(pipelineConfigurer);\n     FormatContext context = new FormatContext(collector, pipelineConfigurer.getStageConfigurer().getInputSchema());\n     validateOutputFormatProvider(context, format, validatingOutputFormat);\n   }\n \n+  public ValidatingOutputFormat getValidatingOutputFormat(PipelineConfigurer pipelineConfigurer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "274ee44e3c9ac8b8523abb9a26615cb0ab7811de"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608ccbf4828955ba91a8ea76fc872f8072b5f54c", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/608ccbf4828955ba91a8ea76fc872f8072b5f54c", "committedDate": "2020-08-04T23:08:19Z", "message": "Enable subclasses to override OutputFormat and output path implementation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "274ee44e3c9ac8b8523abb9a26615cb0ab7811de", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/274ee44e3c9ac8b8523abb9a26615cb0ab7811de", "committedDate": "2020-08-04T20:00:42Z", "message": "Enable subclasses to override OutputFormat and output path implementation"}, "afterCommit": {"oid": "608ccbf4828955ba91a8ea76fc872f8072b5f54c", "author": {"user": {"login": "greeshmaswaminathan", "name": null}}, "url": "https://github.com/cdapio/hydrator-plugins/commit/608ccbf4828955ba91a8ea76fc872f8072b5f54c", "committedDate": "2020-08-04T23:08:19Z", "message": "Enable subclasses to override OutputFormat and output path implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxODUwMTg4", "url": "https://github.com/cdapio/hydrator-plugins/pull/1157#pullrequestreview-461850188", "createdAt": "2020-08-05T16:54:31Z", "commit": {"oid": "608ccbf4828955ba91a8ea76fc872f8072b5f54c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1570, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}