{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxNzgwNTA4", "number": 2765, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxMTo1Mjo0M1rOEPwRhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxMTo1Mjo0M1rOEPwRhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTU1MDEzOnYy", "diffSide": "RIGHT", "path": "h2/src/main/org/h2/store/fs/encrypt/FileEncrypt.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxMTo1Mjo0M1rOGznyag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxMjozMjoyOVrOGzn-yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MjQ0Mg==", "bodyText": "why XTS instance has to be passed on as result / local variable? existing field will do just fine", "url": "https://github.com/h2database/h2database/pull/2765#discussion_r456782442", "createdAt": "2020-07-18T11:52:43Z", "author": {"login": "andreitokar"}, "path": "h2/src/main/org/h2/store/fs/encrypt/FileEncrypt.java", "diffHunk": "@@ -73,9 +73,19 @@ public FileEncrypt(String name, byte[] encryptionKey, FileChannel base) {\n         this.encryptionKey = encryptionKey;\n     }\n \n-    private void init() throws IOException {\n+    private XTS init() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2e27868ae2e47dd7e14a8a5ee944dd11363eadf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MjY2NQ==", "bodyText": "never mind, i got it, it saves one volatile read", "url": "https://github.com/h2database/h2database/pull/2765#discussion_r456782665", "createdAt": "2020-07-18T11:55:10Z", "author": {"login": "andreitokar"}, "path": "h2/src/main/org/h2/store/fs/encrypt/FileEncrypt.java", "diffHunk": "@@ -73,9 +73,19 @@ public FileEncrypt(String name, byte[] encryptionKey, FileChannel base) {\n         this.encryptionKey = encryptionKey;\n     }\n \n-    private void init() throws IOException {\n+    private XTS init() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MjQ0Mg=="}, "originalCommit": {"oid": "c2e27868ae2e47dd7e14a8a5ee944dd11363eadf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MzUxOA==", "bodyText": "Actually IMHO, @little-pan change (final field) is more appropriate. How often this object is created? How likely, that it won't be used afterwards, so lazy initialization pays off?", "url": "https://github.com/h2database/h2database/pull/2765#discussion_r456783518", "createdAt": "2020-07-18T12:06:25Z", "author": {"login": "andreitokar"}, "path": "h2/src/main/org/h2/store/fs/encrypt/FileEncrypt.java", "diffHunk": "@@ -73,9 +73,19 @@ public FileEncrypt(String name, byte[] encryptionKey, FileChannel base) {\n         this.encryptionKey = encryptionKey;\n     }\n \n-    private void init() throws IOException {\n+    private XTS init() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MjQ0Mg=="}, "originalCommit": {"oid": "c2e27868ae2e47dd7e14a8a5ee944dd11363eadf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4NDczMg==", "bodyText": "In some virtual environments (but not on Travis CI) file locks don't work as expected and alternative locking mechanisms are really necessary (I have such VPS provided by web hosting company). Initialization of XTS performs some I/O, but file can be not yet really locked, therefore FileEncrypt intentionally delays its initialization and this is documented in its constructor. I'm not the author of this code and I have no idea whether this logic is still required by PageStore and MVStore backends and, unfortunately, I can't test it now. But I'm sure that we need to perform real tests in these environments first, otherwise we can create a regression in sensitive area of H2.", "url": "https://github.com/h2database/h2database/pull/2765#discussion_r456784732", "createdAt": "2020-07-18T12:21:38Z", "author": {"login": "katzyn"}, "path": "h2/src/main/org/h2/store/fs/encrypt/FileEncrypt.java", "diffHunk": "@@ -73,9 +73,19 @@ public FileEncrypt(String name, byte[] encryptionKey, FileChannel base) {\n         this.encryptionKey = encryptionKey;\n     }\n \n-    private void init() throws IOException {\n+    private XTS init() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MjQ0Mg=="}, "originalCommit": {"oid": "c2e27868ae2e47dd7e14a8a5ee944dd11363eadf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4NTYwMA==", "bodyText": "Actually I don't want to test anything on production servers for oblivious reasons and I don't have testing systems with this problem.\nThese VPS work in OpenVZ containers, but I don't know is it a problem of OpenVZ or a problem of underlying file system (possibly distributed one, I don't have any information about it).", "url": "https://github.com/h2database/h2database/pull/2765#discussion_r456785600", "createdAt": "2020-07-18T12:32:21Z", "author": {"login": "katzyn"}, "path": "h2/src/main/org/h2/store/fs/encrypt/FileEncrypt.java", "diffHunk": "@@ -73,9 +73,19 @@ public FileEncrypt(String name, byte[] encryptionKey, FileChannel base) {\n         this.encryptionKey = encryptionKey;\n     }\n \n-    private void init() throws IOException {\n+    private XTS init() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MjQ0Mg=="}, "originalCommit": {"oid": "c2e27868ae2e47dd7e14a8a5ee944dd11363eadf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4NTYwOA==", "bodyText": "sometimes it pays off to read comments \ud83d\ude04", "url": "https://github.com/h2database/h2database/pull/2765#discussion_r456785608", "createdAt": "2020-07-18T12:32:29Z", "author": {"login": "andreitokar"}, "path": "h2/src/main/org/h2/store/fs/encrypt/FileEncrypt.java", "diffHunk": "@@ -73,9 +73,19 @@ public FileEncrypt(String name, byte[] encryptionKey, FileChannel base) {\n         this.encryptionKey = encryptionKey;\n     }\n \n-    private void init() throws IOException {\n+    private XTS init() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc4MjQ0Mg=="}, "originalCommit": {"oid": "c2e27868ae2e47dd7e14a8a5ee944dd11363eadf"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2110, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}