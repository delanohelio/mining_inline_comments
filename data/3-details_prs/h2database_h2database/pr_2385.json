{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwNzIyNDE3", "number": 2385, "title": "Memory estimate", "bodyText": "Calculation of the amount of memory taken by keys, values and pages of the MVTable may become expensive operation for complex data types like Row.\nOn the other hand, result of the calculation is used by page cache to limit it's size and determine when eviction is needed. Another usage is to trigger auto commit based on amount of unsaved changes. In both cases good (lets say ~30%) approximation would do the job.\nThis PR replace exact calculation with estimation based on a sliding average of last 256 values. If estimation gets close to exact value, then next N calculations are skipped and replaced with the estimate, where N depends on the estimation error.\nAverage values are not persisted at this point yet.\nMy tests provided (anecdotal) evidence of 5-10% performance gain.", "createdAt": "2020-01-09T01:02:29Z", "url": "https://github.com/h2database/h2database/pull/2385", "merged": true, "mergeCommit": {"oid": "1d49f9b03415eb8be68111b51cd6b8e7f667c58c"}, "closed": true, "closedAt": "2020-01-12T17:19:28Z", "author": {"login": "andreitokar"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4KXHLgH2gAyMzYwNzIyNDE3OmZkMzVmNGZkNzA4MzcxZmNiMWFkZDk3YzhhZGZmNGY5NDc0YWMzMWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5SkNLgH2gAyMzYwNzIyNDE3Ojk3ZWFjZDc2YzEwMGU5ODI5ZmQ1ODYyNGFhMTYxZTc2MmQxZjE5MjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd35f4fd708371fcb1add97c8adff4f9474ac31d", "author": {"user": {"login": "andreitokar", "name": "Andrei Tokar"}}, "url": "https://github.com/h2database/h2database/commit/fd35f4fd708371fcb1add97c8adff4f9474ac31d", "committedDate": "2020-01-08T00:38:59Z", "message": "Estimate key/value memory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a23342d0140f8343e3d16cd7f8c4c4cc0c4cf52", "author": {"user": {"login": "andreitokar", "name": "Andrei Tokar"}}, "url": "https://github.com/h2database/h2database/commit/8a23342d0140f8343e3d16cd7f8c4c4cc0c4cf52", "committedDate": "2020-01-08T00:38:59Z", "message": "make memory estimation vs. calculation optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "559d5e5cb52e0696d2c5bea9c2bb92070f0cf1df", "author": {"user": {"login": "andreitokar", "name": "Andrei Tokar"}}, "url": "https://github.com/h2database/h2database/commit/559d5e5cb52e0696d2c5bea9c2bb92070f0cf1df", "committedDate": "2020-01-08T00:38:59Z", "message": "Update copyright notice"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMzEyNjA1", "url": "https://github.com/h2database/h2database/pull/2385#pullrequestreview-340312605", "createdAt": "2020-01-09T06:36:41Z", "commit": {"oid": "559d5e5cb52e0696d2c5bea9c2bb92070f0cf1df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjozNjo0MVrOFbsD3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjozNjo0MVrOFbsD3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3Nzc1OQ==", "bodyText": "would be nice to copy/paste the PR description you provided as class javadoc here", "url": "https://github.com/h2database/h2database/pull/2385#discussion_r364577759", "createdAt": "2020-01-09T06:36:41Z", "author": {"login": "grandinj"}, "path": "h2/src/main/org/h2/util/MemoryEstimator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.util;\n+\n+import static org.h2.engine.Constants.MEMORY_POINTER;\n+import org.h2.mvstore.type.DataType;\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+/**\n+ * Class MemoryEstimator.\n+ * <UL>\n+ * <LI> 12/7/19 10:45 PM initial creation\n+ * </UL>\n+ *\n+ * @author <a href='mailto:andrei.tokar@gmail.com'>Andrei Tokar</a>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559d5e5cb52e0696d2c5bea9c2bb92070f0cf1df"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97eacd76c100e9829fd58624aa161e762d1f1922", "author": {"user": {"login": "andreitokar", "name": "Andrei Tokar"}}, "url": "https://github.com/h2database/h2database/commit/97eacd76c100e9829fd58624aa161e762d1f1922", "committedDate": "2020-01-11T12:46:27Z", "message": "extract constants, javadoc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3890, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}