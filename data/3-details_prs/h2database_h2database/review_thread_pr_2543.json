{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4OTIxMDcz", "number": 2543, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxODoxOVrODu2dcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxOTozNVrODu2d8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwNDUzMzYxOnYy", "diffSide": "RIGHT", "path": "h2/src/main/org/h2/expression/SearchedCase.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxODoxOVrOGA93EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODozNToxNlrOGA9-vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2NjcwNA==", "bodyText": "if you do this, you need to override getSubexpressionCount. But why not just use ArrayList, rather than replicating the functionality?\nLooking at this and the other places we're now using OperationN, perhaps OperationN should not be resposible for argument storage at all, OperationN can implement all its logic in terms of getSubexpression() and getSubexpressionCount().", "url": "https://github.com/h2database/h2database/pull/2543#discussion_r403666704", "createdAt": "2020-04-05T08:18:19Z", "author": {"login": "grandinj"}, "path": "h2/src/main/org/h2/expression/SearchedCase.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.expression;\n+\n+import java.util.Arrays;\n+\n+import org.h2.engine.Session;\n+import org.h2.value.TypeInfo;\n+import org.h2.value.Value;\n+import org.h2.value.ValueNull;\n+\n+/**\n+ * A searched case.\n+ */\n+public class SearchedCase extends OperationN {\n+\n+    private int argsCount;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2NzkyNA==", "bodyText": "I don't know why Function uses an own list, I just preserved it as it.\nBut I agree, its logic can be moved to OperationN.", "url": "https://github.com/h2database/h2database/pull/2543#discussion_r403667924", "createdAt": "2020-04-05T08:28:19Z", "author": {"login": "katzyn"}, "path": "h2/src/main/org/h2/expression/SearchedCase.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.expression;\n+\n+import java.util.Arrays;\n+\n+import org.h2.engine.Session;\n+import org.h2.value.TypeInfo;\n+import org.h2.value.Value;\n+import org.h2.value.ValueNull;\n+\n+/**\n+ * A searched case.\n+ */\n+public class SearchedCase extends OperationN {\n+\n+    private int argsCount;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2NjcwNA=="}, "originalCommit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2ODY2OQ==", "bodyText": "Function uses own special logic in addParameter() to throw the exception a little bit earlier. But I think there is no big difference when the exception will be thrown.", "url": "https://github.com/h2database/h2database/pull/2543#discussion_r403668669", "createdAt": "2020-04-05T08:35:16Z", "author": {"login": "katzyn"}, "path": "h2/src/main/org/h2/expression/SearchedCase.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.expression;\n+\n+import java.util.Arrays;\n+\n+import org.h2.engine.Session;\n+import org.h2.value.TypeInfo;\n+import org.h2.value.Value;\n+import org.h2.value.ValueNull;\n+\n+/**\n+ * A searched case.\n+ */\n+public class SearchedCase extends OperationN {\n+\n+    private int argsCount;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2NjcwNA=="}, "originalCommit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwNDUzNDg5OnYy", "diffSide": "RIGHT", "path": "h2/src/main/org/h2/expression/SimpleCase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxOTozNVrOGA93uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoyOTo1N1rOGA98kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2Njg3Mg==", "bodyText": "this SimpleWhen1 vs SimpleWhenN thing seems like a lot of code for not much benefit. Why not just have SimpleWhenN ?", "url": "https://github.com/h2database/h2database/pull/2543#discussion_r403666872", "createdAt": "2020-04-05T08:19:35Z", "author": {"login": "grandinj"}, "path": "h2/src/main/org/h2/expression/SimpleCase.java", "diffHunk": "@@ -0,0 +1,362 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.expression;\n+\n+import org.h2.engine.Session;\n+import org.h2.table.ColumnResolver;\n+import org.h2.table.TableFilter;\n+import org.h2.value.TypeInfo;\n+import org.h2.value.Value;\n+import org.h2.value.ValueNull;\n+\n+/**\n+ * A simple case.\n+ */\n+public class SimpleCase extends Expression {\n+\n+    public static abstract class SimpleWhen {\n+\n+        Expression result;\n+\n+        SimpleWhen next;\n+\n+        SimpleWhen(Expression result) {\n+            this.result = result;\n+        }\n+\n+        public void addWhen(SimpleWhen next) {\n+            this.next = next;\n+        }\n+\n+    }\n+\n+    public static final class SimpleWhen1 extends SimpleWhen {\n+\n+        Expression operand;\n+\n+        public SimpleWhen1(Expression operand, Expression result) {\n+            super(result);\n+            this.operand = operand;\n+        }\n+\n+    }\n+\n+    public static final class SimpleWhenN extends SimpleWhen {\n+\n+        Expression[] operands;\n+\n+        Expression result;\n+\n+        public SimpleWhenN(Expression[] operands, Expression result) {\n+            super(result);\n+            this.operands = operands;\n+        }\n+\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2ODExMw==", "bodyText": "I'll merge them, you're right, specialized implementation for typical case with only one operand doesn't improve performance due to all these branches.", "url": "https://github.com/h2database/h2database/pull/2543#discussion_r403668113", "createdAt": "2020-04-05T08:29:57Z", "author": {"login": "katzyn"}, "path": "h2/src/main/org/h2/expression/SimpleCase.java", "diffHunk": "@@ -0,0 +1,362 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.expression;\n+\n+import org.h2.engine.Session;\n+import org.h2.table.ColumnResolver;\n+import org.h2.table.TableFilter;\n+import org.h2.value.TypeInfo;\n+import org.h2.value.Value;\n+import org.h2.value.ValueNull;\n+\n+/**\n+ * A simple case.\n+ */\n+public class SimpleCase extends Expression {\n+\n+    public static abstract class SimpleWhen {\n+\n+        Expression result;\n+\n+        SimpleWhen next;\n+\n+        SimpleWhen(Expression result) {\n+            this.result = result;\n+        }\n+\n+        public void addWhen(SimpleWhen next) {\n+            this.next = next;\n+        }\n+\n+    }\n+\n+    public static final class SimpleWhen1 extends SimpleWhen {\n+\n+        Expression operand;\n+\n+        public SimpleWhen1(Expression operand, Expression result) {\n+            super(result);\n+            this.operand = operand;\n+        }\n+\n+    }\n+\n+    public static final class SimpleWhenN extends SimpleWhen {\n+\n+        Expression[] operands;\n+\n+        Expression result;\n+\n+        public SimpleWhenN(Expression[] operands, Expression result) {\n+            super(result);\n+            this.operands = operands;\n+        }\n+\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2Njg3Mg=="}, "originalCommit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2150, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}