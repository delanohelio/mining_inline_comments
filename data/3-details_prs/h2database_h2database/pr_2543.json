{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4OTIxMDcz", "number": 2543, "title": "Improve case specification support and fix some issues with it", "bodyText": "Simple case with lists of operands (CASE A WHEN B, C, \u2026 THEN \u2026) is now supported.\n\n\nColumn not found exception if column is used in ELSE branch of CASE is fixed.\n\n\nSome new SQL-92 keywords are introduced, TestKeywords is improved to detect problems with them.\n\n\nIncorrect CAST examples are removed from documentation.", "createdAt": "2020-04-05T06:02:09Z", "url": "https://github.com/h2database/h2database/pull/2543", "merged": true, "mergeCommit": {"oid": "d01ea2a710a1313154ba9b658e93c753bf4673ff"}, "closed": true, "closedAt": "2020-04-05T09:24:59Z", "author": {"login": "katzyn"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUR3Q5gH2gAyMzk4OTIxMDczOmNiOTQyN2UzYWRlMDJmOGMwODBmZDhkYmExMWMzYzhmOGYyNjcxMjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUmOHtgH2gAyMzk4OTIxMDczOjk4MGYyN2RiZjBhMTU3YzAwM2UxNGNiM2E3MTA1NjRkMWNhMDkxNTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb9427e3ade02f8c080fd8dba11c3c8f8f267129", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/cb9427e3ade02f8c080fd8dba11c3c8f8f267129", "committedDate": "2020-04-04T09:13:19Z", "message": "Add Operation1 as a base class for single-argument operations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e18eb04ba8e53f1bb689955f1729e069df4f47cf", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/e18eb04ba8e53f1bb689955f1729e069df4f47cf", "committedDate": "2020-04-04T10:39:51Z", "message": "Extract CAST to CastSpecification from Function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0137ebbe203257bc61cf863fa083b4fb2ef9d072", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/0137ebbe203257bc61cf863fa083b4fb2ef9d072", "committedDate": "2020-04-04T11:29:58Z", "message": "Move CASE tests into own file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a94523f99d11c812aa3d85b8428de339022488ac", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/a94523f99d11c812aa3d85b8428de339022488ac", "committedDate": "2020-04-04T11:46:54Z", "message": "Fix column not found exception in CASE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b521b18e16f9650d60aa3e22cf0a72fe1f92ba0d", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/b521b18e16f9650d60aa3e22cf0a72fe1f92ba0d", "committedDate": "2020-04-04T12:02:36Z", "message": "Use Operation2 as a base class for IntervalOperation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/ac9ccfbe38f1e75e148f32b82fa9b5182961fa46", "committedDate": "2020-04-05T04:39:30Z", "message": "Add support for simple case with lists in when operand"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c85555bf587cdbb03474a35547ad600dcc434c3a", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/c85555bf587cdbb03474a35547ad600dcc434c3a", "committedDate": "2020-04-05T05:27:21Z", "message": "Improve TestKeywords and add more SQL-92 keywords"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c6fc478cb5137b4265867df9276b193224e7692", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/6c6fc478cb5137b4265867df9276b193224e7692", "committedDate": "2020-04-05T06:55:38Z", "message": "Fix TestRecursiveQueries and update changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzkzMTUz", "url": "https://github.com/h2database/h2database/pull/2543#pullrequestreview-387793153", "createdAt": "2020-04-05T08:18:18Z", "commit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxODoxOVrOGA93EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxODoxOVrOGA93EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2NjcwNA==", "bodyText": "if you do this, you need to override getSubexpressionCount. But why not just use ArrayList, rather than replicating the functionality?\nLooking at this and the other places we're now using OperationN, perhaps OperationN should not be resposible for argument storage at all, OperationN can implement all its logic in terms of getSubexpression() and getSubexpressionCount().", "url": "https://github.com/h2database/h2database/pull/2543#discussion_r403666704", "createdAt": "2020-04-05T08:18:19Z", "author": {"login": "grandinj"}, "path": "h2/src/main/org/h2/expression/SearchedCase.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.expression;\n+\n+import java.util.Arrays;\n+\n+import org.h2.engine.Session;\n+import org.h2.value.TypeInfo;\n+import org.h2.value.Value;\n+import org.h2.value.ValueNull;\n+\n+/**\n+ * A searched case.\n+ */\n+public class SearchedCase extends OperationN {\n+\n+    private int argsCount;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzkzMjU2", "url": "https://github.com/h2database/h2database/pull/2543#pullrequestreview-387793256", "createdAt": "2020-04-05T08:19:35Z", "commit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxOTozNVrOGA93uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwODoxOTozNVrOGA93uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY2Njg3Mg==", "bodyText": "this SimpleWhen1 vs SimpleWhenN thing seems like a lot of code for not much benefit. Why not just have SimpleWhenN ?", "url": "https://github.com/h2database/h2database/pull/2543#discussion_r403666872", "createdAt": "2020-04-05T08:19:35Z", "author": {"login": "grandinj"}, "path": "h2/src/main/org/h2/expression/SimpleCase.java", "diffHunk": "@@ -0,0 +1,362 @@\n+/*\n+ * Copyright 2004-2020 H2 Group. Multiple-Licensed under the MPL 2.0,\n+ * and the EPL 1.0 (https://h2database.com/html/license.html).\n+ * Initial Developer: H2 Group\n+ */\n+package org.h2.expression;\n+\n+import org.h2.engine.Session;\n+import org.h2.table.ColumnResolver;\n+import org.h2.table.TableFilter;\n+import org.h2.value.TypeInfo;\n+import org.h2.value.Value;\n+import org.h2.value.ValueNull;\n+\n+/**\n+ * A simple case.\n+ */\n+public class SimpleCase extends Expression {\n+\n+    public static abstract class SimpleWhen {\n+\n+        Expression result;\n+\n+        SimpleWhen next;\n+\n+        SimpleWhen(Expression result) {\n+            this.result = result;\n+        }\n+\n+        public void addWhen(SimpleWhen next) {\n+            this.next = next;\n+        }\n+\n+    }\n+\n+    public static final class SimpleWhen1 extends SimpleWhen {\n+\n+        Expression operand;\n+\n+        public SimpleWhen1(Expression operand, Expression result) {\n+            super(result);\n+            this.operand = operand;\n+        }\n+\n+    }\n+\n+    public static final class SimpleWhenN extends SimpleWhen {\n+\n+        Expression[] operands;\n+\n+        Expression result;\n+\n+        public SimpleWhenN(Expression[] operands, Expression result) {\n+            super(result);\n+            this.operands = operands;\n+        }\n+\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9ccfbe38f1e75e148f32b82fa9b5182961fa46"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6978fda927e62fcf66198768c2382ae4fca92d05", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/6978fda927e62fcf66198768c2382ae4fca92d05", "committedDate": "2020-04-05T08:47:57Z", "message": "Move addParameter() to OperationN"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "980f27dbf0a157c003e14cb3a710564d1ca09157", "author": {"user": {"login": "katzyn", "name": "Evgenij Ryazanov"}}, "url": "https://github.com/h2database/h2database/commit/980f27dbf0a157c003e14cb3a710564d1ca09157", "committedDate": "2020-04-05T08:56:23Z", "message": "Use only one implementation of simple when clause"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3852, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}