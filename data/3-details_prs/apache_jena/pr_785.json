{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMTAzOTE5", "number": 785, "title": "JENA-1936: Value-equality indexing for binary datatypes", "bodyText": "", "createdAt": "2020-08-23T10:15:35Z", "url": "https://github.com/apache/jena/pull/785", "merged": true, "mergeCommit": {"oid": "fc024ee3f91c7ebca222003c7f12aa41b6382049"}, "closed": true, "closedAt": "2020-08-28T16:41:45Z", "author": {"login": "afs"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC-lzEgFqTQ3NjYyMDUzNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDG8c2AFqTQ3NzA4MDAyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NjIwNTM3", "url": "https://github.com/apache/jena/pull/785#pullrequestreview-476620537", "createdAt": "2020-08-27T11:20:29Z", "commit": {"oid": "651ba80b2d6d1318d8e96545cd19862d9b875e48"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMToyMDoyOVrOHILsNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMToyMDoyOVrOHILsNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM0MjE5OQ==", "bodyText": "Consider caching the hash\nprivate int hash;\n\n/*package*/ ByteArray(byte[] bytes) {\n  this.bytes = bytes;\n}\n\n@Override\npublic int hashCode() {\n    if (hash == 0) {\n      hash = Arrays..hashCode(bytes);\n    }\n    return hash;\n}", "url": "https://github.com/apache/jena/pull/785#discussion_r478342199", "createdAt": "2020-08-27T11:20:29Z", "author": {"login": "strangepleasures"}, "path": "jena-core/src/main/java/org/apache/jena/graph/impl/LiteralLabelImpl.java", "diffHunk": "@@ -303,20 +304,59 @@ public String getLexicalForm() {\n \t\treturn lexicalForm;\n \t}\n     \n-    /** \n-     \tAnswer the value used to index this literal\n-        TODO Consider pushing indexing decisions down to the datatype\n-    */\n+    /**\n+     * Answer an object used to index this literal. This object must provide\n+     * {@link Object#equals} and {@link Object#hashCode} based on values, not object\n+     * instance identity.\n+     */\n     @Override\n     public Object getIndexingValue() {\n-        return\n-            isXML() ? this\n-            : !lang.equals( \"\" ) ? getLexicalForm() + \"@\" + lang.toLowerCase(Locale.ROOT)\n-            : wellformed ? getValue()\n-            : getLexicalForm() \n-            ;\n+        if ( isXML() )\n+            return this;\n+        if ( !lang.equals(\"\") )\n+            return getLexicalForm() + \"@\" + lang.toLowerCase(Locale.ROOT);\n+        if ( wellformed ) {\n+            Object value = getValue();\n+            // JENA-1936\n+            // byte[] does not provide hashCode/equals based on the contents of the array.\n+            if ( value instanceof byte[] )\n+                return new ByteArray((byte[])value);\n+            return value;\n+        }\n+        return getLexicalForm();\n     }\n \n+    /**\n+     * {@code byte[]} wrapper that provides {@code hashCode} and {@code equals} based\n+     * on the value of the array.\n+     */\n+    static class ByteArray {\n+        private final byte[] bytes;\n+        /*package*/ ByteArray(byte[] bytes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651ba80b2d6d1318d8e96545cd19862d9b875e48"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72a6ec6b26d6740f1096c521d22d33327899b084", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/72a6ec6b26d6740f1096c521d22d33327899b084", "committedDate": "2020-08-27T19:36:05Z", "message": "JENA-1936: Value-equality indexing for binary datatypes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "651ba80b2d6d1318d8e96545cd19862d9b875e48", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/651ba80b2d6d1318d8e96545cd19862d9b875e48", "committedDate": "2020-08-23T09:22:24Z", "message": "JENA-1936: Value-equality indexing for binary datatypes"}, "afterCommit": {"oid": "72a6ec6b26d6740f1096c521d22d33327899b084", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/72a6ec6b26d6740f1096c521d22d33327899b084", "committedDate": "2020-08-27T19:36:05Z", "message": "JENA-1936: Value-equality indexing for binary datatypes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDgwMDIw", "url": "https://github.com/apache/jena/pull/785#pullrequestreview-477080020", "createdAt": "2020-08-27T21:04:28Z", "commit": {"oid": "72a6ec6b26d6740f1096c521d22d33327899b084"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2934, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}