{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NjMzMDE5", "number": 884, "title": "JENA-2012: Test for UTF-16 high-low surrogates pairs", "bodyText": "Add checkString into the parsing process that makes sure a high-surrogate is followed by a low-surrogate.", "createdAt": "2020-12-08T18:15:19Z", "url": "https://github.com/apache/jena/pull/884", "merged": true, "mergeCommit": {"oid": "9f4bb3cff63c261211d0de3c5c6ee44e0838b454"}, "closed": true, "closedAt": "2020-12-09T15:33:41Z", "author": {"login": "afs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkPOINgFqTU0NzU1NTk2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkdA_JAFqTU0ODA4Nzg3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTU1OTY3", "url": "https://github.com/apache/jena/pull/884#pullrequestreview-547555967", "createdAt": "2020-12-08T19:22:05Z", "commit": {"oid": "0473c3252f2022b2c1357e75935f41d52b397d34"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToyMjowNVrOIByNXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToyMjoyOFrOIByOcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0MjExMQ==", "bodyText": "\ud83d\udc4d\nI checked for a method that does something like this on Apache Commons Text, and Apache Commons Lang, but there's none. I thought some user would have requested that, interesting.", "url": "https://github.com/apache/jena/pull/884#discussion_r538742111", "createdAt": "2020-12-08T19:22:05Z", "author": {"login": "kinow"}, "path": "jena-arq/src/main/java/org/apache/jena/sparql/lang/ParserBase.java", "diffHunk": "@@ -190,6 +190,24 @@ protected Node stripSign(Node node) {\n         return NodeFactory.createLiteral(lex, lang, dt) ;\n     }\n \n+    protected void checkString(String string, int line, int column) {\n+        for ( int i = 0 ; i < string.length() ; i++ ) {\n+            // Not \"codePointAt\" which does surrogate processing.\n+            char ch = string.charAt(i);\n+            // Check surrogate pairs are pairs.\n+            if ( Character.isHighSurrogate(ch) ) {\n+                i++;\n+                if ( i == string.length() )\n+                    throw new QueryParseException(\"Bad surrogate pair (end of string)\", line, column);\n+                char ch1 = string.charAt(i);\n+                if ( ! Character.isLowSurrogate(ch1) ) {\n+                    throw new QueryParseException(\"Bad surrogate pair (high surrogate not followed by low surrogate)\", line, column);\n+                }\n+            } else if ( Character.isLowSurrogate(ch) )\n+                throw new QueryParseException(\"Bad surrogate pair (low surrogate without high surrogate)\", line, column);\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0473c3252f2022b2c1357e75935f41d52b397d34"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0MjMwMw==", "bodyText": "Delete? \u261d\ufe0f", "url": "https://github.com/apache/jena/pull/884#discussion_r538742303", "createdAt": "2020-12-08T19:22:18Z", "author": {"login": "kinow"}, "path": "jena-base/src/main/java/org/apache/jena/atlas/io/InStreamUTF8.java", "diffHunk": "@@ -144,7 +144,18 @@ public final int advance()\n     public static final int advance(InputStreamBuffered input) {\n         int x = input.advance() ;\n         if ( x == -1 ) return -1 ;\n-        return advance(input, x) ;\n+\n+        int codepoint = advance(input, x) ;\n+        //System.out.printf(\"U+%04X\\n\", codepoint);\n+\n+        if ( false ) {\n+//          if ( codepoint > Character.MAX_VALUE ) {\n+//              throw new AtlasException(\"Out of range character (must use a surrogate pair)\");\n+//          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0473c3252f2022b2c1357e75935f41d52b397d34"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0MjM4Ng==", "bodyText": "Delete? \u261d\ufe0f", "url": "https://github.com/apache/jena/pull/884#discussion_r538742386", "createdAt": "2020-12-08T19:22:28Z", "author": {"login": "kinow"}, "path": "jena-cmds/src/main/java/riotcmd/utf8.java", "diffHunk": "@@ -60,7 +60,8 @@ public static void main(String... args) {\n                     } else\n                         colNum++ ;\n                     if ( !Character.isDefined(ch) )\n-                        throw new AtlasException(String.format(\"No such codepoint: 0x%04X\", ch)) ;\n+                        //throw new AtlasException(String.format(\"No such codepoint: 0x%04X\", ch)) ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0473c3252f2022b2c1357e75935f41d52b397d34"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0473c3252f2022b2c1357e75935f41d52b397d34", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/0473c3252f2022b2c1357e75935f41d52b397d34", "committedDate": "2020-12-08T18:09:28Z", "message": "JENA-2012: Test for UTF-16 high-low surrogates pairs"}, "afterCommit": {"oid": "02f031ca15f620dbd9fee7fbc123c7357c23f8fe", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/02f031ca15f620dbd9fee7fbc123c7357c23f8fe", "committedDate": "2020-12-08T22:08:30Z", "message": "JENA-2012: Test for UTF-16 high-low surrogates pairs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3OTk0MzMz", "url": "https://github.com/apache/jena/pull/884#pullrequestreview-547994333", "createdAt": "2020-12-09T09:33:35Z", "commit": {"oid": "02f031ca15f620dbd9fee7fbc123c7357c23f8fe"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwOTozMzozNlrOICLCmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwOTozNDozN1rOICLFjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE0ODk1NQ==", "bodyText": "Nit, the bracket style is pretty inconsistent here, I don't have a strong preference for using brackets when the if branch only has a single line but it would be nice to be consistent throughout the method\nFor example the outer if uses {} because it has a multi-line block but its corresponding else if doesn't\nSimilarly the inner if are both single line blocks but one uses {} and one doesn't", "url": "https://github.com/apache/jena/pull/884#discussion_r539148955", "createdAt": "2020-12-09T09:33:36Z", "author": {"login": "rvesse"}, "path": "jena-arq/src/main/java/org/apache/jena/sparql/lang/ParserBase.java", "diffHunk": "@@ -190,6 +190,24 @@ protected Node stripSign(Node node) {\n         return NodeFactory.createLiteral(lex, lang, dt) ;\n     }\n \n+    protected void checkString(String string, int line, int column) {\n+        for ( int i = 0 ; i < string.length() ; i++ ) {\n+            // Not \"codePointAt\" which does surrogate processing.\n+            char ch = string.charAt(i);\n+            // Check surrogate pairs are pairs.\n+            if ( Character.isHighSurrogate(ch) ) {\n+                i++;\n+                if ( i == string.length() )\n+                    throw new QueryParseException(\"Bad surrogate pair (end of string)\", line, column);\n+                char ch1 = string.charAt(i);\n+                if ( ! Character.isLowSurrogate(ch1) ) {\n+                    throw new QueryParseException(\"Bad surrogate pair (high surrogate not followed by low surrogate)\", line, column);\n+                }\n+            } else if ( Character.isLowSurrogate(ch) )\n+                throw new QueryParseException(\"Bad surrogate pair (low surrogate without high surrogate)\", line, column);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02f031ca15f620dbd9fee7fbc123c7357c23f8fe"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE0OTcxMQ==", "bodyText": "Any reason why this is now just a log message rather than an error as it was previously?", "url": "https://github.com/apache/jena/pull/884#discussion_r539149711", "createdAt": "2020-12-09T09:34:37Z", "author": {"login": "rvesse"}, "path": "jena-cmds/src/main/java/riotcmd/utf8.java", "diffHunk": "@@ -60,7 +60,7 @@ public static void main(String... args) {\n                     } else\n                         colNum++ ;\n                     if ( !Character.isDefined(ch) )\n-                        throw new AtlasException(String.format(\"No such codepoint: 0x%04X\", ch)) ;\n+                        System.out.printf(\"No such codepoint: 0x%04X\\n\", ch);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02f031ca15f620dbd9fee7fbc123c7357c23f8fe"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02f031ca15f620dbd9fee7fbc123c7357c23f8fe", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/02f031ca15f620dbd9fee7fbc123c7357c23f8fe", "committedDate": "2020-12-08T22:08:30Z", "message": "JENA-2012: Test for UTF-16 high-low surrogates pairs"}, "afterCommit": {"oid": "c3a0cc6b9ba3ed6bd4c0d35e700a5665b58650c2", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/c3a0cc6b9ba3ed6bd4c0d35e700a5665b58650c2", "committedDate": "2020-12-09T09:49:40Z", "message": "JENA-2012: Test for UTF-16 high-low surrogates pairs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a40b6c7e5679ea40ea10cd79aa8d613dacdd4504", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/a40b6c7e5679ea40ea10cd79aa8d613dacdd4504", "committedDate": "2020-12-09T09:54:00Z", "message": "JENA-2012: Test for UTF-16 high-low surrogates pairs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3a0cc6b9ba3ed6bd4c0d35e700a5665b58650c2", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/c3a0cc6b9ba3ed6bd4c0d35e700a5665b58650c2", "committedDate": "2020-12-09T09:49:40Z", "message": "JENA-2012: Test for UTF-16 high-low surrogates pairs"}, "afterCommit": {"oid": "a40b6c7e5679ea40ea10cd79aa8d613dacdd4504", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/a40b6c7e5679ea40ea10cd79aa8d613dacdd4504", "committedDate": "2020-12-09T09:54:00Z", "message": "JENA-2012: Test for UTF-16 high-low surrogates pairs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MDg3ODc3", "url": "https://github.com/apache/jena/pull/884#pullrequestreview-548087877", "createdAt": "2020-12-09T11:26:50Z", "commit": {"oid": "a40b6c7e5679ea40ea10cd79aa8d613dacdd4504"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2915, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}