{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMjgwNjk4", "number": 669, "title": "JENA-1837: MaxBasicQueries", "bodyText": "Add a new parameter text:maxBasicQueries used by the surround query parser.", "createdAt": "2020-01-10T05:20:54Z", "url": "https://github.com/apache/jena/pull/669", "merged": true, "mergeCommit": {"oid": "c1ba587d89d82a06a911253b9a90f6ed47c355f8"}, "closed": true, "closedAt": "2020-05-01T14:00:37Z", "author": {"login": "DamienFontaine"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4sZB5gH2gAyMzYxMjgwNjk4OjQzNzNiNGQ1YTFlZTEzZTM5YjJiMzgxYzQ2NjNmNjE3NjUyNTdkMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcc78QzgFqTQwNDA0MjE4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4373b4d5a1ee13e39b2b381c4663f61765257d24", "author": {"user": {"login": "DamienFontaine", "name": "DamienFontaine"}}, "url": "https://github.com/apache/jena/commit/4373b4d5a1ee13e39b2b381c4663f61765257d24", "committedDate": "2020-01-09T16:17:51Z", "message": "Merge pull request #1 from apache/master\n\nUpdate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348", "author": {"user": {"login": "DamienFontaine", "name": "DamienFontaine"}}, "url": "https://github.com/apache/jena/commit/a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348", "committedDate": "2020-01-10T05:16:22Z", "message": "Add text:maxBasicQueries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNTI2MjQ3", "url": "https://github.com/apache/jena/pull/669#pullrequestreview-403526247", "createdAt": "2020-04-30T13:37:03Z", "commit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMzozNzowM1rOGOpm7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMzozNzowM1rOGOpm7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAxNDk1OQ==", "bodyText": "This should specify a value.\nWhen used via TextIndexLuceneAssembler, it will be set to a default of 1024. jena-text may be used from code , no assembler, and then the default is zero from this line.\nIt is always passed in BasicQueryFactory(this.maxBasicQueries) by TextLuceneIndex so the other choice is set to -1 (an \"unset\" marker) and call BasicQueryFactory() when not set so that it tracks the Lucene choice for the default which may evolve over time.", "url": "https://github.com/apache/jena/pull/669#discussion_r418014959", "createdAt": "2020-04-30T13:37:03Z", "author": {"login": "afs"}, "path": "jena-text/src/main/java/org/apache/jena/query/text/TextIndexLucene.java", "diffHunk": "@@ -112,6 +112,7 @@\n     private final FieldType        ftTextNotStored ; // used for lang derived fields\n     private final FieldType        ftTextStoredNoIndex ; // used for lang derived fields\n     private final boolean          isMultilingual ;\n+    private final int              maxBasicQueries ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNTQ5MDgx", "url": "https://github.com/apache/jena/pull/669#pullrequestreview-403549081", "createdAt": "2020-04-30T14:00:38Z", "commit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNTgzMDE5", "url": "https://github.com/apache/jena/pull/669#pullrequestreview-403583019", "createdAt": "2020-04-30T14:36:17Z", "commit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNDozNjoxN1rOGOsQeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNDozNjoxN1rOGOsQeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA1ODM2MQ==", "bodyText": "I think L#136, below, ensures a value for maxBasicQueries. Perhaps L#30 above in TextIndexConfig.java should be set to 1024 since that's the default in org.apache.lucene.queryparser.surround.query. BasicQueryFactory", "url": "https://github.com/apache/jena/pull/669#discussion_r418058361", "createdAt": "2020-04-30T14:36:17Z", "author": {"login": "xristy"}, "path": "jena-text/src/main/java/org/apache/jena/query/text/TextIndexLucene.java", "diffHunk": "@@ -112,6 +112,7 @@\n     private final FieldType        ftTextNotStored ; // used for lang derived fields\n     private final FieldType        ftTextStoredNoIndex ; // used for lang derived fields\n     private final boolean          isMultilingual ;\n+    private final int              maxBasicQueries ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAxNDk1OQ=="}, "originalCommit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNjA5MjYw", "url": "https://github.com/apache/jena/pull/669#pullrequestreview-403609260", "createdAt": "2020-04-30T15:03:27Z", "commit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDQyMTg3", "url": "https://github.com/apache/jena/pull/669#pullrequestreview-404042187", "createdAt": "2020-05-01T06:46:08Z", "commit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjo0NjowOFrOGPDZrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjo0NjowOFrOGPDZrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzNzU1MA==", "bodyText": "All the code looks good to me. Only one question here. The message says that it must be an int. But up to this point, I think we only know it's a) not null, and b) not a literal.\nMy RDF-Fu is a bit rusty, feel free to ignore if what I'm saying is completely wrong please. But I think it could be another type (char, bool, etc)? So I think only after this if, when we call getInt() we will actually know whether we have an int or not?", "url": "https://github.com/apache/jena/pull/669#discussion_r418437550", "createdAt": "2020-05-01T06:46:08Z", "author": {"login": "kinow"}, "path": "jena-text/src/main/java/org/apache/jena/query/text/assembler/TextIndexLuceneAssembler.java", "diffHunk": "@@ -94,7 +94,17 @@ public TextIndex open(Assembler a, Resource root, Mode mode) {\n                 }\n                 isMultilingualSupport = mlsNode.asLiteral().getBoolean();\n             }\n-            \n+\n+            int maxBasicQueries = 1024;\n+            Statement maxBasicQueriesStatement = root.getProperty(pMaxBasicQueries);\n+            if (null != maxBasicQueriesStatement) {\n+                RDFNode mbqNode = maxBasicQueriesStatement.getObject();\n+                if (! mbqNode.isLiteral()) {\n+                    throw new TextIndexException(\"text:maxBasicQueries property must be a int : \" + mbqNode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6e7e1f9dfdbfae191d0c6549ee2bee7f3c38348"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3062, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}