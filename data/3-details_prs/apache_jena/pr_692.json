{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MzI4MzU4", "number": 692, "title": "GeoSPARQL: Malformed geo:lat and geo:lon checks", "bodyText": "GeoSPARQL\n\nmultiple cases of geo:lat or geo:lon now result in an exception and closure of iterators.\ngeo:lat and geo:lon made required properties.", "createdAt": "2020-02-17T21:58:58Z", "url": "https://github.com/apache/jena/pull/692", "merged": true, "mergeCommit": {"oid": "959b0cd0b11d505da8b0eb6ce306c43e65742f18"}, "closed": true, "closedAt": "2020-02-17T21:59:55Z", "author": {"login": "galbiston"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFUastAH2gAyMzc2MzI4MzU4OmIzMzUyYjA5MzYwYzZmMGE1ZWI1ZTRiMzM2MDZmYWFiODY4ODU3MDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF1-OHAFqTM2MTA4MTk1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3352b09360c6f0a5eb5e4b33606faab86885706", "author": {"user": {"login": "galbiston", "name": "GregAlbo"}}, "url": "https://github.com/apache/jena/commit/b3352b09360c6f0a5eb5e4b33606faab86885706", "committedDate": "2020-02-17T21:42:58Z", "message": "SpatialObjectGeometryLiteral now checks for multiple geo:lat or geo:lon predicates on a Feature. Exception thrown and iterator closed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "141d85e700a28f095d9487f2b54411d0ffb3f288", "author": {"user": {"login": "galbiston", "name": "GregAlbo"}}, "url": "https://github.com/apache/jena/commit/141d85e700a28f095d9487f2b54411d0ffb3f288", "committedDate": "2020-02-17T21:49:53Z", "message": "SpatialIndex: retrieval of geo:lat and geo:lon are now required properties to replace NullPointerException with PropertyNotFoundException."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMDgxOTUx", "url": "https://github.com/apache/jena/pull/692#pullrequestreview-361081951", "createdAt": "2020-02-19T12:48:37Z", "commit": {"oid": "141d85e700a28f095d9487f2b54411d0ffb3f288"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMjo0ODozN1rOFrmzUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMjo0ODozN1rOFrmzUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI2ODgxNg==", "bodyText": "Sorry to be late to the game.\nA comment: a useful pattern is\nExtendedIterator<> iter = ...;\ntry { \n   ... process ...\n} finally { iter.close(); }\n\nThere is no harm calling close multiple times or on already closed iterators.", "url": "https://github.com/apache/jena/pull/692#discussion_r381268816", "createdAt": "2020-02-19T12:48:37Z", "author": {"login": "afs"}, "path": "jena-geosparql/src/main/java/org/apache/jena/geosparql/geo/topological/SpatialObjectGeometryLiteral.java", "diffHunk": "@@ -132,8 +133,22 @@ protected static final SpatialObjectGeometryLiteral retrieve(Graph graph, Node t\n         } else {\n             //Target is not a Feature or Geometry but could have Geo Predicates.\n             if (graph.contains(targetSpatialObject, SpatialExtension.GEO_LAT_NODE, null) && graph.contains(targetSpatialObject, SpatialExtension.GEO_LON_NODE, null)) {\n-                Node lat = graph.find(targetSpatialObject, SpatialExtension.GEO_LAT_NODE, null).next().getObject();\n-                Node lon = graph.find(targetSpatialObject, SpatialExtension.GEO_LON_NODE, null).next().getObject();\n+\n+                //Extract Lat coordinate.\n+                ExtendedIterator<Triple> latIter = graph.find(targetSpatialObject, SpatialExtension.GEO_LAT_NODE, null);\n+                Node lat = latIter.next().getObject();\n+\n+                //Extract Lon coordinate.\n+                ExtendedIterator<Triple> lonIter = graph.find(targetSpatialObject, SpatialExtension.GEO_LON_NODE, null);\n+                Node lon = lonIter.next().getObject();\n+\n+                //Ensure that only a single Latitude and Longitude are present for the subject.\n+                if (latIter.hasNext() || lonIter.hasNext()) {\n+                    latIter.close();\n+                    lonIter.close();\n+                    throw new DatatypeFormatException(targetSpatialObject.getURI() + \" has more than one geo:lat or geo:lon property.\");\n+                }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "141d85e700a28f095d9487f2b54411d0ffb3f288"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2996, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}