{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MDQ1NTk3", "number": 787, "title": "JENA-1950 Replace Nashorn with GraalVM-based JavaScript engine", "bodyText": "", "createdAt": "2020-08-26T17:17:25Z", "url": "https://github.com/apache/jena/pull/787", "merged": true, "mergeCommit": {"oid": "4cff40806261afb6ed4ef9992e2cd606d066f805"}, "closed": true, "closedAt": "2020-09-17T08:26:34Z", "author": {"login": "strangepleasures"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCvFQnAH2gAyNDc0MDQ1NTk3OjFkZTdkMmRhM2E1ODE4OGFhZjRmYTk1MjliNGI0N2VjMWYyNmZmZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJsr77AFqTQ5MDM1ODkwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1de7d2da3a58188aaf4fa9529b4b47ec1f26fff6", "author": {"user": {"login": "strangepleasures", "name": "Pavel Mikhailovskii"}}, "url": "https://github.com/apache/jena/commit/1de7d2da3a58188aaf4fa9529b4b47ec1f26fff6", "committedDate": "2020-08-26T17:16:22Z", "message": "JENA-1950 Replace Nashorn with GraalVM-based JavaScript engine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e131fd769c6cf3a1ccff361e0aeedb5abb51e0f", "author": {"user": {"login": "strangepleasures", "name": "Pavel Mikhailovskii"}}, "url": "https://github.com/apache/jena/commit/6e131fd769c6cf3a1ccff361e0aeedb5abb51e0f", "committedDate": "2020-08-26T17:21:29Z", "message": "Move GraalVM dependencies before test dependencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NzMwODg3", "url": "https://github.com/apache/jena/pull/787#pullrequestreview-475730887", "createdAt": "2020-08-26T18:01:47Z", "commit": {"oid": "6e131fd769c6cf3a1ccff361e0aeedb5abb51e0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODE2MDMx", "url": "https://github.com/apache/jena/pull/787#pullrequestreview-475816031", "createdAt": "2020-08-26T20:00:22Z", "commit": {"oid": "6e131fd769c6cf3a1ccff361e0aeedb5abb51e0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55a3354a5deaf40761f5e93efc673d5dd0b4f8dd", "author": {"user": {"login": "strangepleasures", "name": "Pavel Mikhailovskii"}}, "url": "https://github.com/apache/jena/commit/55a3354a5deaf40761f5e93efc673d5dd0b4f8dd", "committedDate": "2020-09-15T19:10:46Z", "message": "Make Graal VM a provided dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTM2NjEx", "url": "https://github.com/apache/jena/pull/787#pullrequestreview-489136611", "createdAt": "2020-09-15T21:57:43Z", "commit": {"oid": "55a3354a5deaf40761f5e93efc673d5dd0b4f8dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTQ4MzI5", "url": "https://github.com/apache/jena/pull/787#pullrequestreview-489548329", "createdAt": "2020-09-16T11:56:34Z", "commit": {"oid": "55a3354a5deaf40761f5e93efc673d5dd0b4f8dd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTo1Njo0MFrOHStWcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTo1ODowMlrOHStZRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM3OTQ0Mg==", "bodyText": "I think this should be <optional>true</optional>.\nMy understanding is that the the effect is much the same. It is about the meaning indicated. \"provided\" is for environment capabilities used by this project (e.g running in a application container), \"optional\" is indicating downstream that a capability can be added.\ne.g.\nhttp://maven.40175.n5.nabble.com/lt-scope-gt-provided-lt-scope-gt-vs-lt-optional-gt-true-lt-optional-gt-td2852244.html\nDoes anyone have deeper experience?", "url": "https://github.com/apache/jena/pull/787#discussion_r489379442", "createdAt": "2020-09-16T11:56:40Z", "author": {"login": "afs"}, "path": "jena-arq/pom.xml", "diffHunk": "@@ -111,6 +111,18 @@\n       <artifactId>commons-lang3</artifactId>\n     </dependency>\n \n+    <dependency>\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js</artifactId>\n+      <scope>provided</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55a3354a5deaf40761f5e93efc673d5dd0b4f8dd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4MDE2NA==", "bodyText": "I would remove the \"else\" branch.\nIf on Java 8, this warning comes out whereas before there wasn't one.\nThe JDK prints warns its warning anyway on Java11 and Java14:\n\n\"Warning: Nashorn engine is planned to be removed from a future JDK release\"\n\nso we get two.", "url": "https://github.com/apache/jena/pull/787#discussion_r489380164", "createdAt": "2020-09-16T11:58:02Z", "author": {"login": "afs"}, "path": "jena-arq/src/main/java/org/apache/jena/sparql/function/js/JSEngine.java", "diffHunk": "@@ -55,24 +50,31 @@ public static JSEngine createFromFile(String functionLibFile) {\n         return new JSEngine(null, functionLibFile);\n     }\n     \n-    /*package*/ JSEngine(String functions, String functionLibFile) { \n-        this.functions = functions;\n-        this.functionLibFile = functionLibFile;\n+    /*package*/ JSEngine(String functions, String functionLibFile) {\n         invoc = build(functions, functionLibFile);\n     }\n \n     private static Invocable build(String functions, String functionLibFile) {\n         if ( functions == null && functionLibFile == null )\n-            throw new ARQException(\"Both script string and script filename are null\"); \n+            throw new ARQException(\"Both script string and script filename are null\");\n \n         ScriptEngineManager manager = new ScriptEngineManager();\n-        ScriptEngine scriptEngine = manager.getEngineByName(\"nashorn\");\n-        \n+        ScriptEngine scriptEngine = manager.getEngineByName(\"javascript\");\n+        if (scriptEngine == null) {\n+            throw new ARQException(\"Could not load JavaScript script engine. \" +\n+                    \"Make sure that org.graalvm.js:js and org.graalvm.js:js-scriptengine are added to the class path\");\n+        }\n+\n+        if (scriptEngine.getFactory().getEngineName().equals(\"Graal.js\")) {\n+            scriptEngine.getContext().setAttribute(\"polyglot.js.nashorn-compat\", true, ScriptContext.ENGINE_SCOPE);\n+        } else if (scriptEngine.getFactory().getNames().contains(\"Nashorn\")) {\n+            Log.warn(JSEngine.class, \"Nashorn will be permanently removed in JDK 15. Consider switching to Graal VM.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55a3354a5deaf40761f5e93efc673d5dd0b4f8dd"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c257ef6eb50f882d30cce6cb99fcc18df47d91a1", "author": {"user": {"login": "strangepleasures", "name": "Pavel Mikhailovskii"}}, "url": "https://github.com/apache/jena/commit/c257ef6eb50f882d30cce6cb99fcc18df47d91a1", "committedDate": "2020-09-16T15:28:54Z", "message": "Make Graal VM dependencies optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5b0dc3522d496d0918af6a0243efd52e3e7ee7a", "author": {"user": {"login": "strangepleasures", "name": "Pavel Mikhailovskii"}}, "url": "https://github.com/apache/jena/commit/c5b0dc3522d496d0918af6a0243efd52e3e7ee7a", "committedDate": "2020-09-16T15:29:35Z", "message": "Remove Nashorn deprecation warning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODY1NDI4", "url": "https://github.com/apache/jena/pull/787#pullrequestreview-489865428", "createdAt": "2020-09-16T17:58:02Z", "commit": {"oid": "c5b0dc3522d496d0918af6a0243efd52e3e7ee7a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzU4OTAx", "url": "https://github.com/apache/jena/pull/787#pullrequestreview-490358901", "createdAt": "2020-09-17T08:26:22Z", "commit": {"oid": "c5b0dc3522d496d0918af6a0243efd52e3e7ee7a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2937, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}