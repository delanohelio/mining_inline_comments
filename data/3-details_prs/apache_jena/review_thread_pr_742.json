{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MjU3MjY0", "number": 742, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMjo0Nzo0NlrOD7biVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMjo1MDowM1rOD7bkHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNjQzNzMyOnYy", "diffSide": "RIGHT", "path": "jena-arq/src/main/java/org/apache/jena/riot/resultset/rw/ResultSetWriterXML.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMjo0Nzo0NlrOGTwCOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODozNjoxNVrOGT8Dqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM2MzEzMQ==", "bodyText": "Extra white space", "url": "https://github.com/apache/jena/pull/742#discussion_r423363131", "createdAt": "2020-05-11T22:47:46Z", "author": {"login": "kinow"}, "path": "jena-arq/src/main/java/org/apache/jena/riot/resultset/rw/ResultSetWriterXML.java", "diffHunk": "@@ -253,84 +254,138 @@ public void binding(String varName, RDFNode node) {\n             out.print(varName);\n             out.println(\"\\\">\");\n             out.incIndent(INDENT);\n-            printBindingValue(node);\n+            printBindingValue(rdfNode);\n             out.decIndent(INDENT);\n             out.print(\"</\");\n             out.print(dfBinding);\n             out.println(\">\");\n         }\n \n-        void printBindingValue(RDFNode node) {\n-            if ( node == null ) {\n+        private void printBindingValue(RDFNode rdfNode) {\n+            if ( rdfNode == null ) {\n                 // Unbound\n                 out.print(\"<\");\n                 out.print(dfUnbound);\n                 out.println(\"/>\");\n                 return;\n             }\n \n-            if ( node instanceof Literal ) {\n-                printLiteral((Literal)node);\n+            Node node = rdfNode.asNode();\n+            printBindingValue(node);\n+        }\n+        \n+        private void printBindingValue(Node node) {\n+            if ( node == null )\n+                return;\n+        \n+            if ( node.isLiteral() ) {\n+                printLiteral(node);\n                 return;\n             }\n \n-            if ( node instanceof Resource ) {\n-                printResource((Resource)node);\n+            if ( node.isURI() ) {\n+                printURI(node);\n+                return;\n+            }\n+            \n+            if ( node.isBlank() ) {\n+                printBlankNode(node);\n+                return;\n+            }\n+            if ( node.isNodeTriple() ) {\n+                printTripleTerm(node);\n                 return;\n             }\n+            \n+            if ( node.isNodeGraph() )\n+                throw new UnsupportedOperationException(\"Graph terms\");\n \n-            Log.warn(this, \"Unknown RDFNode type in result set: \" + node.getClass());\n+            Log.warn(this, \"Unknown RDFNode type in result set: \" + node);\n         }\n \n-        void printLiteral(Literal literal) {\n+        private void printURI(Node nodeURI) {\n+            String uri = nodeURI.getURI();\n             out.print(\"<\");\n-            out.print(dfLiteral);\n+            out.print(dfURI);\n+            out.print(\">\");\n+            out.print(xml_escape(uri));\n+            out.print(\"</\");\n+            out.print(dfURI);\n+            out.println(\">\");\n+        }            \n+            \n+        private void printBlankNode(Node node) {\n+            String label = bNodeMap.get(null, node);\n+            // Comes with leading \"_:\"\n+            label = label.substring(2);\n+            out.print(\"<\");\n+            out.print(dfBNode);\n+            out.print(\">\");\n+            out.print(xml_escape(label));\n+            out.print(\"</\");\n+            out.print(dfBNode);\n+            out.println(\">\");\n+        }\n \n+        private void printLiteral(Node literal) {\n+            out.print(\"<\");\n+            out.print(dfLiteral);\n+        \n             if ( Util.isLangString(literal) ) {\n-                String lang = literal.getLanguage();\n+                String lang = literal.getLiteralLanguage();\n                 out.print(\" xml:lang=\\\"\");\n-                out.print(literal.getLanguage());\n+                out.print(lang);\n                 out.print(\"\\\"\");\n             } else if ( !Util.isSimpleString(literal) ) {\n                 // Datatype\n                 // (RDF 1.1) not xsd:string nor rdf:langString.\n                 // (RDF 1.0) any datatype.\n-                String datatype = literal.getDatatypeURI();\n+                String datatype = literal.getLiteralDatatypeURI();\n                 out.print(\" \");\n                 out.print(dfAttrDatatype);\n                 out.print(\"=\\\"\");\n                 out.print(datatype);\n                 out.print(\"\\\"\");\n             }\n-\n+        ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e87a8729f7416f183f0cd82819ab2ec0b5ed9d56"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU2MDEwNg==", "bodyText": "I didn't remove all trailing WS because it is all over the place.", "url": "https://github.com/apache/jena/pull/742#discussion_r423560106", "createdAt": "2020-05-12T08:36:15Z", "author": {"login": "afs"}, "path": "jena-arq/src/main/java/org/apache/jena/riot/resultset/rw/ResultSetWriterXML.java", "diffHunk": "@@ -253,84 +254,138 @@ public void binding(String varName, RDFNode node) {\n             out.print(varName);\n             out.println(\"\\\">\");\n             out.incIndent(INDENT);\n-            printBindingValue(node);\n+            printBindingValue(rdfNode);\n             out.decIndent(INDENT);\n             out.print(\"</\");\n             out.print(dfBinding);\n             out.println(\">\");\n         }\n \n-        void printBindingValue(RDFNode node) {\n-            if ( node == null ) {\n+        private void printBindingValue(RDFNode rdfNode) {\n+            if ( rdfNode == null ) {\n                 // Unbound\n                 out.print(\"<\");\n                 out.print(dfUnbound);\n                 out.println(\"/>\");\n                 return;\n             }\n \n-            if ( node instanceof Literal ) {\n-                printLiteral((Literal)node);\n+            Node node = rdfNode.asNode();\n+            printBindingValue(node);\n+        }\n+        \n+        private void printBindingValue(Node node) {\n+            if ( node == null )\n+                return;\n+        \n+            if ( node.isLiteral() ) {\n+                printLiteral(node);\n                 return;\n             }\n \n-            if ( node instanceof Resource ) {\n-                printResource((Resource)node);\n+            if ( node.isURI() ) {\n+                printURI(node);\n+                return;\n+            }\n+            \n+            if ( node.isBlank() ) {\n+                printBlankNode(node);\n+                return;\n+            }\n+            if ( node.isNodeTriple() ) {\n+                printTripleTerm(node);\n                 return;\n             }\n+            \n+            if ( node.isNodeGraph() )\n+                throw new UnsupportedOperationException(\"Graph terms\");\n \n-            Log.warn(this, \"Unknown RDFNode type in result set: \" + node.getClass());\n+            Log.warn(this, \"Unknown RDFNode type in result set: \" + node);\n         }\n \n-        void printLiteral(Literal literal) {\n+        private void printURI(Node nodeURI) {\n+            String uri = nodeURI.getURI();\n             out.print(\"<\");\n-            out.print(dfLiteral);\n+            out.print(dfURI);\n+            out.print(\">\");\n+            out.print(xml_escape(uri));\n+            out.print(\"</\");\n+            out.print(dfURI);\n+            out.println(\">\");\n+        }            \n+            \n+        private void printBlankNode(Node node) {\n+            String label = bNodeMap.get(null, node);\n+            // Comes with leading \"_:\"\n+            label = label.substring(2);\n+            out.print(\"<\");\n+            out.print(dfBNode);\n+            out.print(\">\");\n+            out.print(xml_escape(label));\n+            out.print(\"</\");\n+            out.print(dfBNode);\n+            out.println(\">\");\n+        }\n \n+        private void printLiteral(Node literal) {\n+            out.print(\"<\");\n+            out.print(dfLiteral);\n+        \n             if ( Util.isLangString(literal) ) {\n-                String lang = literal.getLanguage();\n+                String lang = literal.getLiteralLanguage();\n                 out.print(\" xml:lang=\\\"\");\n-                out.print(literal.getLanguage());\n+                out.print(lang);\n                 out.print(\"\\\"\");\n             } else if ( !Util.isSimpleString(literal) ) {\n                 // Datatype\n                 // (RDF 1.1) not xsd:string nor rdf:langString.\n                 // (RDF 1.0) any datatype.\n-                String datatype = literal.getDatatypeURI();\n+                String datatype = literal.getLiteralDatatypeURI();\n                 out.print(\" \");\n                 out.print(dfAttrDatatype);\n                 out.print(\"=\\\"\");\n                 out.print(datatype);\n                 out.print(\"\\\"\");\n             }\n-\n+        ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM2MzEzMQ=="}, "originalCommit": {"oid": "e87a8729f7416f183f0cd82819ab2ec0b5ed9d56"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNjQ0MTkwOnYy", "diffSide": "RIGHT", "path": "jena-arq/src/main/java/org/apache/jena/riot/resultset/rw/ResultSetWriterXML.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMjo1MDowM1rOGTwFHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODozNzo1M1rOGT8Hng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM2Mzg3MA==", "bodyText": "The new methods openTag/closeTag cannot be used in printBlankNode too, as in printTripleTerm? (asking because I noticed that method also increments indentation, so maybe not supposed to be always used?)", "url": "https://github.com/apache/jena/pull/742#discussion_r423363870", "createdAt": "2020-05-11T22:50:03Z", "author": {"login": "kinow"}, "path": "jena-arq/src/main/java/org/apache/jena/riot/resultset/rw/ResultSetWriterXML.java", "diffHunk": "@@ -253,84 +254,138 @@ public void binding(String varName, RDFNode node) {\n             out.print(varName);\n             out.println(\"\\\">\");\n             out.incIndent(INDENT);\n-            printBindingValue(node);\n+            printBindingValue(rdfNode);\n             out.decIndent(INDENT);\n             out.print(\"</\");\n             out.print(dfBinding);\n             out.println(\">\");\n         }\n \n-        void printBindingValue(RDFNode node) {\n-            if ( node == null ) {\n+        private void printBindingValue(RDFNode rdfNode) {\n+            if ( rdfNode == null ) {\n                 // Unbound\n                 out.print(\"<\");\n                 out.print(dfUnbound);\n                 out.println(\"/>\");\n                 return;\n             }\n \n-            if ( node instanceof Literal ) {\n-                printLiteral((Literal)node);\n+            Node node = rdfNode.asNode();\n+            printBindingValue(node);\n+        }\n+        \n+        private void printBindingValue(Node node) {\n+            if ( node == null )\n+                return;\n+        \n+            if ( node.isLiteral() ) {\n+                printLiteral(node);\n                 return;\n             }\n \n-            if ( node instanceof Resource ) {\n-                printResource((Resource)node);\n+            if ( node.isURI() ) {\n+                printURI(node);\n+                return;\n+            }\n+            \n+            if ( node.isBlank() ) {\n+                printBlankNode(node);\n+                return;\n+            }\n+            if ( node.isNodeTriple() ) {\n+                printTripleTerm(node);\n                 return;\n             }\n+            \n+            if ( node.isNodeGraph() )\n+                throw new UnsupportedOperationException(\"Graph terms\");\n \n-            Log.warn(this, \"Unknown RDFNode type in result set: \" + node.getClass());\n+            Log.warn(this, \"Unknown RDFNode type in result set: \" + node);\n         }\n \n-        void printLiteral(Literal literal) {\n+        private void printURI(Node nodeURI) {\n+            String uri = nodeURI.getURI();\n             out.print(\"<\");\n-            out.print(dfLiteral);\n+            out.print(dfURI);\n+            out.print(\">\");\n+            out.print(xml_escape(uri));\n+            out.print(\"</\");\n+            out.print(dfURI);\n+            out.println(\">\");\n+        }            \n+            \n+        private void printBlankNode(Node node) {\n+            String label = bNodeMap.get(null, node);\n+            // Comes with leading \"_:\"\n+            label = label.substring(2);\n+            out.print(\"<\");\n+            out.print(dfBNode);\n+            out.print(\">\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e87a8729f7416f183f0cd82819ab2ec0b5ed9d56"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU2MTExOA==", "bodyText": "The XML results writer is very, very, very old! I can't even track its history in git properly.\nThe new openTag/closeTag made writing the nested structures for printTripleTerm.\nI tried to limit the scope of changes and not do a whole-class clear-up, though I was sorely tempted to because the code is very un-DRY.", "url": "https://github.com/apache/jena/pull/742#discussion_r423561118", "createdAt": "2020-05-12T08:37:53Z", "author": {"login": "afs"}, "path": "jena-arq/src/main/java/org/apache/jena/riot/resultset/rw/ResultSetWriterXML.java", "diffHunk": "@@ -253,84 +254,138 @@ public void binding(String varName, RDFNode node) {\n             out.print(varName);\n             out.println(\"\\\">\");\n             out.incIndent(INDENT);\n-            printBindingValue(node);\n+            printBindingValue(rdfNode);\n             out.decIndent(INDENT);\n             out.print(\"</\");\n             out.print(dfBinding);\n             out.println(\">\");\n         }\n \n-        void printBindingValue(RDFNode node) {\n-            if ( node == null ) {\n+        private void printBindingValue(RDFNode rdfNode) {\n+            if ( rdfNode == null ) {\n                 // Unbound\n                 out.print(\"<\");\n                 out.print(dfUnbound);\n                 out.println(\"/>\");\n                 return;\n             }\n \n-            if ( node instanceof Literal ) {\n-                printLiteral((Literal)node);\n+            Node node = rdfNode.asNode();\n+            printBindingValue(node);\n+        }\n+        \n+        private void printBindingValue(Node node) {\n+            if ( node == null )\n+                return;\n+        \n+            if ( node.isLiteral() ) {\n+                printLiteral(node);\n                 return;\n             }\n \n-            if ( node instanceof Resource ) {\n-                printResource((Resource)node);\n+            if ( node.isURI() ) {\n+                printURI(node);\n+                return;\n+            }\n+            \n+            if ( node.isBlank() ) {\n+                printBlankNode(node);\n+                return;\n+            }\n+            if ( node.isNodeTriple() ) {\n+                printTripleTerm(node);\n                 return;\n             }\n+            \n+            if ( node.isNodeGraph() )\n+                throw new UnsupportedOperationException(\"Graph terms\");\n \n-            Log.warn(this, \"Unknown RDFNode type in result set: \" + node.getClass());\n+            Log.warn(this, \"Unknown RDFNode type in result set: \" + node);\n         }\n \n-        void printLiteral(Literal literal) {\n+        private void printURI(Node nodeURI) {\n+            String uri = nodeURI.getURI();\n             out.print(\"<\");\n-            out.print(dfLiteral);\n+            out.print(dfURI);\n+            out.print(\">\");\n+            out.print(xml_escape(uri));\n+            out.print(\"</\");\n+            out.print(dfURI);\n+            out.println(\">\");\n+        }            \n+            \n+        private void printBlankNode(Node node) {\n+            String label = bNodeMap.get(null, node);\n+            // Comes with leading \"_:\"\n+            label = label.substring(2);\n+            out.print(\"<\");\n+            out.print(dfBNode);\n+            out.print(\">\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM2Mzg3MA=="}, "originalCommit": {"oid": "e87a8729f7416f183f0cd82819ab2ec0b5ed9d56"}, "originalPosition": 107}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4582, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}