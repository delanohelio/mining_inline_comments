{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2Njc1Njk4", "number": 707, "title": "JENA-1857: DatasetGraphInMemory.size.", "bodyText": "", "createdAt": "2020-03-11T13:01:13Z", "url": "https://github.com/apache/jena/pull/707", "merged": true, "mergeCommit": {"oid": "d95b7d295cebaeb2ea41029f4ee7781be94e5e85"}, "closed": true, "closedAt": "2020-03-12T21:15:41Z", "author": {"login": "afs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMlNW1gH2gAyMzg2Njc1Njk4OjFkZjhjOGJjNDQ3YjViZDczOThiNTA5YzcxNmJkMDhiMDkyOTZmMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNBxxZAH2gAyMzg2Njc1Njk4OmNhODA3NjZiNTUwZDM1ZTBjMDg0NzZmNzgxOGMyZmVjY2I0ZTM1MmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1df8c8bc447b5bd7398b509c716bd08b09296f0b", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/1df8c8bc447b5bd7398b509c716bd08b09296f0b", "committedDate": "2020-03-11T11:14:15Z", "message": "JENA-1857: DatasetGraphInMemory.size."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTk2NjU1", "url": "https://github.com/apache/jena/pull/707#pullrequestreview-372996655", "createdAt": "2020-03-11T17:56:50Z", "commit": {"oid": "1df8c8bc447b5bd7398b509c716bd08b09296f0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTM4MjA3", "url": "https://github.com/apache/jena/pull/707#pullrequestreview-373138207", "createdAt": "2020-03-11T21:28:33Z", "commit": {"oid": "1df8c8bc447b5bd7398b509c716bd08b09296f0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjYwOTE3", "url": "https://github.com/apache/jena/pull/707#pullrequestreview-373660917", "createdAt": "2020-03-12T15:29:38Z", "commit": {"oid": "1df8c8bc447b5bd7398b509c716bd08b09296f0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjYyNDAw", "url": "https://github.com/apache/jena/pull/707#pullrequestreview-373662400", "createdAt": "2020-03-12T15:31:15Z", "commit": {"oid": "1df8c8bc447b5bd7398b509c716bd08b09296f0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTozMToxNlrOF1jqOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTozMToxNlrOF1jqOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcwMzA5Nw==", "bodyText": "I just realized I have this code already in here, so you need only:\nreturn access(quadsIndex().listGraphNodes()::count);\n\nwhich should match the other usage.", "url": "https://github.com/apache/jena/pull/707#discussion_r391703097", "createdAt": "2020-03-12T15:31:16Z", "author": {"login": "ajs6f"}, "path": "jena-arq/src/main/java/org/apache/jena/sparql/core/mem/DatasetGraphInMemory.java", "diffHunk": "@@ -400,7 +400,9 @@ public DatasetPrefixStorage prefixes() {\n \n     @Override\n     public long size() {\n-        return quadsIndex().listGraphNodes().count() ;\n+        return isInTransaction() \n+                ? quadsIndex().listGraphNodes().count()\n+                : calculateRead(this, ()->quadsIndex().listGraphNodes().count());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1df8c8bc447b5bd7398b509c716bd08b09296f0b"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25dc140a1153aefef445458b627ddd30c647bc9d", "author": {"user": {"login": "ajs6f", "name": "A. Soroka"}}, "url": "https://github.com/apache/jena/commit/25dc140a1153aefef445458b627ddd30c647bc9d", "committedDate": "2020-03-12T17:12:29Z", "message": "Use access() as per the rest of DatasetGraphInMemory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca80766b550d35e0c08476f7818c2feccb4e352e", "author": {"user": {"login": "afs", "name": "Andy Seaborne"}}, "url": "https://github.com/apache/jena/commit/ca80766b550d35e0c08476f7818c2feccb4e352e", "committedDate": "2020-03-12T20:31:22Z", "message": "Merge pull request #5 from apache/UseAccessInstead\n\nUse access() as per the rest of DatasetGraphInMemory"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3002, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}