{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyODk2MzY2", "number": 641, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwOToxODo1N1rOEidNyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMToyNzoxMVrOEigWyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTY1NzA2OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwOToxODo1N1rOHQV37g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMDoxNjoyN1rOHQZHGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5NzY0Ng==", "bodyText": "Should these be part of the if block? Is it used elsewhere?", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486897646", "createdAt": "2020-09-11T09:18:57Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,39 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n+                            String optionKey = option.optString(KEY);\n+                            String openmrsEntityId = option.optString(OPENMRS_ENTITY_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkwNTg4NA==", "bodyText": "yeah it should be part since, it checks first if it is a concept before starting the combination", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486905884", "createdAt": "2020-09-11T09:26:56Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,39 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n+                            String optionKey = option.optString(KEY);\n+                            String openmrsEntityId = option.optString(OPENMRS_ENTITY_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5NzY0Ng=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkzMDM1Ng==", "bodyText": "Sorry, meant should it move to the if block at line 440?", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486930356", "createdAt": "2020-09-11T09:51:53Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,39 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n+                            String optionKey = option.optString(KEY);\n+                            String openmrsEntityId = option.optString(OPENMRS_ENTITY_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5NzY0Ng=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk1MDY4MA==", "bodyText": "ok changing", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486950680", "createdAt": "2020-09-11T10:16:27Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,39 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n+                            String optionKey = option.optString(KEY);\n+                            String openmrsEntityId = option.optString(OPENMRS_ENTITY_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5NzY0Ng=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTY2NDIyOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwOToyMDoxNFrOHQV8yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwOTo0Njo0NlrOHQXj5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5ODg4OA==", "bodyText": "Isn't createObservation being called on line 445?", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486898888", "createdAt": "2020-09-11T09:20:14Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -435,8 +450,13 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n                         }\n                     }\n                     if (!optionValues.isEmpty()) {\n-                        // For options without concepts combine the values into one observation\n-                        createObservation(e, jsonObject, optionKeyVals, optionValues);\n+                        if (CONCEPT.equals(entity) && shouldBeCombined) {\n+                            e.addObs(new Obs(CONCEPT, AllConstants.CHECK_BOX, jsonObject.optString(OPENMRS_ENTITY_ID), jsonObject.optString(OPENMRS_ENTITY_PARENT), optionEntityIds, optionValues, null,\n+                                    jsonObject.optString(KEY)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5OTc0Mg==", "bodyText": "Or are we going for duplicate obs for backward compatibility?", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486899742", "createdAt": "2020-09-11T09:21:07Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -435,8 +450,13 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n                         }\n                     }\n                     if (!optionValues.isEmpty()) {\n-                        // For options without concepts combine the values into one observation\n-                        createObservation(e, jsonObject, optionKeyVals, optionValues);\n+                        if (CONCEPT.equals(entity) && shouldBeCombined) {\n+                            e.addObs(new Obs(CONCEPT, AllConstants.CHECK_BOX, jsonObject.optString(OPENMRS_ENTITY_ID), jsonObject.optString(OPENMRS_ENTITY_PARENT), optionEntityIds, optionValues, null,\n+                                    jsonObject.optString(KEY)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5ODg4OA=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkwODM3NQ==", "bodyText": "these are combined values hence, only one obs need to be created, This check shouldBeCombined ensures that its working only when combined AllConstants.COMBINE_CHECKBOX_OPTION_VALUES is added to the field", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486908375", "createdAt": "2020-09-11T09:29:27Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -435,8 +450,13 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n                         }\n                     }\n                     if (!optionValues.isEmpty()) {\n-                        // For options without concepts combine the values into one observation\n-                        createObservation(e, jsonObject, optionKeyVals, optionValues);\n+                        if (CONCEPT.equals(entity) && shouldBeCombined) {\n+                            e.addObs(new Obs(CONCEPT, AllConstants.CHECK_BOX, jsonObject.optString(OPENMRS_ENTITY_ID), jsonObject.optString(OPENMRS_ENTITY_PARENT), optionEntityIds, optionValues, null,\n+                                    jsonObject.optString(KEY)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5ODg4OA=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyMjA3Mw==", "bodyText": "I think you can define, jsonObject.optString(OPENMRS_ENTITY_ID), jsonObject.optString(OPENMRS_ENTITY_PARENT), jsonObject.optString(KEY) once, since they're used elsewhere in this block.", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486922073", "createdAt": "2020-09-11T09:43:34Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -435,8 +450,13 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n                         }\n                     }\n                     if (!optionValues.isEmpty()) {\n-                        // For options without concepts combine the values into one observation\n-                        createObservation(e, jsonObject, optionKeyVals, optionValues);\n+                        if (CONCEPT.equals(entity) && shouldBeCombined) {\n+                            e.addObs(new Obs(CONCEPT, AllConstants.CHECK_BOX, jsonObject.optString(OPENMRS_ENTITY_ID), jsonObject.optString(OPENMRS_ENTITY_PARENT), optionEntityIds, optionValues, null,\n+                                    jsonObject.optString(KEY)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5ODg4OA=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyNTI4NA==", "bodyText": "cool, changing", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486925284", "createdAt": "2020-09-11T09:46:46Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -435,8 +450,13 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n                         }\n                     }\n                     if (!optionValues.isEmpty()) {\n-                        // For options without concepts combine the values into one observation\n-                        createObservation(e, jsonObject, optionKeyVals, optionValues);\n+                        if (CONCEPT.equals(entity) && shouldBeCombined) {\n+                            e.addObs(new Obs(CONCEPT, AllConstants.CHECK_BOX, jsonObject.optString(OPENMRS_ENTITY_ID), jsonObject.optString(OPENMRS_ENTITY_PARENT), optionEntityIds, optionValues, null,\n+                                    jsonObject.optString(KEY)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5ODg4OA=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTY3NjcyOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/location/helper/LocationHelper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwOToyMjoyNlrOHQWFmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwOTo0OTozNVrOHQXuzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkwMTE0Nw==", "bodyText": "Not sure I understand this change?", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486901147", "createdAt": "2020-09-11T09:22:26Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/location/helper/LocationHelper.java", "diffHunk": "@@ -168,7 +168,7 @@ public String getOpenMrsLocationId(@NonNull String locationName) {\n         } catch (Exception e) {\n             Timber.e(e);\n         }\n-        return locationName.equals(response) ? AllConstants.ADVANCED_DATA_CAPTURE_STRATEGY_PREFIX + locationName.trim().replaceAll(\" \", \"-\").toLowerCase(Locale.ENGLISH) : response;\n+        return response;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkwNDE1OQ==", "bodyText": "@ndegwamartin  made this change an just reverting it since it breaks our code. I have discussed with him", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486904159", "createdAt": "2020-09-11T09:25:17Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/location/helper/LocationHelper.java", "diffHunk": "@@ -168,7 +168,7 @@ public String getOpenMrsLocationId(@NonNull String locationName) {\n         } catch (Exception e) {\n             Timber.e(e);\n         }\n-        return locationName.equals(response) ? AllConstants.ADVANCED_DATA_CAPTURE_STRATEGY_PREFIX + locationName.trim().replaceAll(\" \", \"-\").toLowerCase(Locale.ENGLISH) : response;\n+        return response;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkwMTE0Nw=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkyODA3OA==", "bodyText": "cool", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486928078", "createdAt": "2020-09-11T09:49:35Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/location/helper/LocationHelper.java", "diffHunk": "@@ -168,7 +168,7 @@ public String getOpenMrsLocationId(@NonNull String locationName) {\n         } catch (Exception e) {\n             Timber.e(e);\n         }\n-        return locationName.equals(response) ? AllConstants.ADVANCED_DATA_CAPTURE_STRATEGY_PREFIX + locationName.trim().replaceAll(\" \", \"-\").toLowerCase(Locale.ENGLISH) : response;\n+        return response;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkwMTE0Nw=="}, "originalCommit": {"oid": "27858faed8d80f89fc4eb5f39dc78c294a08f173"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NjE2ODkzOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMToyNjoxM1rOHQbCYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMjoxMDo0MlrOHQcR5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjI0MQ==", "bodyText": "fieldKey?", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486982241", "createdAt": "2020-09-11T11:26:13Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,42 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    String fieldsOpenmrsEntityId = jsonObject.optString(OPENMRS_ENTITY_ID);\n+                    String fieldOpenmrsEntityParent = jsonObject.optString(OPENMRS_ENTITY_PARENT);\n+                    String fieldKey = jsonObject.optString(KEY);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n                             // For options with concepts create an observation for each\n                             option.put(AllConstants.TYPE, type);\n-                            option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n+                            option.put(AllConstants.PARENT_ENTITY_ID, fieldsOpenmrsEntityId);\n                             option.put(KEY, jsonObject.getString(KEY));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba12a5fbcb4f5f65e1534e26d1880303deb562"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5ODIwMA==", "bodyText": "jsonObject.getString(OPENMRS_ENTITY_ID) is fieldsOpenmrsEntityId otherwise i dont get the question", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486998200", "createdAt": "2020-09-11T12:01:28Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,42 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    String fieldsOpenmrsEntityId = jsonObject.optString(OPENMRS_ENTITY_ID);\n+                    String fieldOpenmrsEntityParent = jsonObject.optString(OPENMRS_ENTITY_PARENT);\n+                    String fieldKey = jsonObject.optString(KEY);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n                             // For options with concepts create an observation for each\n                             option.put(AllConstants.TYPE, type);\n-                            option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n+                            option.put(AllConstants.PARENT_ENTITY_ID, fieldsOpenmrsEntityId);\n                             option.put(KEY, jsonObject.getString(KEY));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjI0MQ=="}, "originalCommit": {"oid": "4fba12a5fbcb4f5f65e1534e26d1880303deb562"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5OTU3Nw==", "bodyText": "Replace jsonObject.getString(KEY) with fieldKey.", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486999577", "createdAt": "2020-09-11T12:04:33Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,42 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    String fieldsOpenmrsEntityId = jsonObject.optString(OPENMRS_ENTITY_ID);\n+                    String fieldOpenmrsEntityParent = jsonObject.optString(OPENMRS_ENTITY_PARENT);\n+                    String fieldKey = jsonObject.optString(KEY);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n                             // For options with concepts create an observation for each\n                             option.put(AllConstants.TYPE, type);\n-                            option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n+                            option.put(AllConstants.PARENT_ENTITY_ID, fieldsOpenmrsEntityId);\n                             option.put(KEY, jsonObject.getString(KEY));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjI0MQ=="}, "originalCommit": {"oid": "4fba12a5fbcb4f5f65e1534e26d1880303deb562"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwMjU5OQ==", "bodyText": "cool changing", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r487002599", "createdAt": "2020-09-11T12:10:42Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,42 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    String fieldsOpenmrsEntityId = jsonObject.optString(OPENMRS_ENTITY_ID);\n+                    String fieldOpenmrsEntityParent = jsonObject.optString(OPENMRS_ENTITY_PARENT);\n+                    String fieldKey = jsonObject.optString(KEY);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n                             // For options with concepts create an observation for each\n                             option.put(AllConstants.TYPE, type);\n-                            option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n+                            option.put(AllConstants.PARENT_ENTITY_ID, fieldsOpenmrsEntityId);\n                             option.put(KEY, jsonObject.getString(KEY));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjI0MQ=="}, "originalCommit": {"oid": "4fba12a5fbcb4f5f65e1534e26d1880303deb562"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NjE3MTYxOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMToyNzoxMVrOHQbEBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMTo1OTo0MlrOHQb9gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjY2MA==", "bodyText": "Should this be part of an else block?\nDo we need to do this if someone explicitly specifies that they should be combined?", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486982660", "createdAt": "2020-09-11T11:27:11Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,42 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    String fieldsOpenmrsEntityId = jsonObject.optString(OPENMRS_ENTITY_ID);\n+                    String fieldOpenmrsEntityParent = jsonObject.optString(OPENMRS_ENTITY_PARENT);\n+                    String fieldKey = jsonObject.optString(KEY);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n                             // For options with concepts create an observation for each\n                             option.put(AllConstants.TYPE, type);\n-                            option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n+                            option.put(AllConstants.PARENT_ENTITY_ID, fieldsOpenmrsEntityId);\n                             option.put(KEY, jsonObject.getString(KEY));\n+\n+                            if (shouldBeCombined) {\n+                                String optionKey = option.optString(KEY);\n+                                String optionsOpenmrsEntityId = option.optString(OPENMRS_ENTITY_ID);\n+                                optionValues.add(optionKey);\n+                                optionEntityIds.add(optionsOpenmrsEntityId);\n+                                continue;\n+                            }\n                             createObservation(e, option, String.valueOf(option.getBoolean(VALUE)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fba12a5fbcb4f5f65e1534e26d1880303deb562"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NzM3Ng==", "bodyText": "it can but continue takes care of it", "url": "https://github.com/opensrp/opensrp-client-core/pull/641#discussion_r486997376", "createdAt": "2020-09-11T11:59:42Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -407,26 +409,42 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n-        if (StringUtils.isBlank(value)) { return; }\n+        if (StringUtils.isBlank(value)) {\n+            return;\n+        }\n \n         String type = getString(jsonObject, AllConstants.TYPE);\n         if (AllConstants.CHECK_BOX.equals(type)) {\n             try {\n                 List<Object> optionValues = new ArrayList<>();\n+                List<Object> optionEntityIds = new ArrayList<>();\n                 Map<String, Object> optionKeyVals = new HashMap<>();\n                 if (jsonObject.has(AllConstants.OPTIONS)) {\n                     JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    String fieldsOpenmrsEntityId = jsonObject.optString(OPENMRS_ENTITY_ID);\n+                    String fieldOpenmrsEntityParent = jsonObject.optString(OPENMRS_ENTITY_PARENT);\n+                    String fieldKey = jsonObject.optString(KEY);\n+                    boolean shouldBeCombined = jsonObject.optBoolean(AllConstants.COMBINE_CHECKBOX_OPTION_VALUES);\n+                    String entity = getString(jsonObject, OPENMRS_ENTITY);\n                     for (int i = 0; i < options.length(); i++) {\n                         JSONObject option = options.getJSONObject(i);\n                         boolean optionValue = option.optBoolean(VALUE);\n                         if (!optionValue) {\n                             continue;\n                         }\n-                        if (CONCEPT.equals(getString(jsonObject, OPENMRS_ENTITY))) {\n+                        if (CONCEPT.equals(entity)) {\n                             // For options with concepts create an observation for each\n                             option.put(AllConstants.TYPE, type);\n-                            option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n+                            option.put(AllConstants.PARENT_ENTITY_ID, fieldsOpenmrsEntityId);\n                             option.put(KEY, jsonObject.getString(KEY));\n+\n+                            if (shouldBeCombined) {\n+                                String optionKey = option.optString(KEY);\n+                                String optionsOpenmrsEntityId = option.optString(OPENMRS_ENTITY_ID);\n+                                optionValues.add(optionKey);\n+                                optionEntityIds.add(optionsOpenmrsEntityId);\n+                                continue;\n+                            }\n                             createObservation(e, option, String.valueOf(option.getBoolean(VALUE)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk4MjY2MA=="}, "originalCommit": {"oid": "4fba12a5fbcb4f5f65e1534e26d1880303deb562"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2109, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}