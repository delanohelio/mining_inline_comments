{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NzE4ODcy", "number": 548, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0MDozM1rOEHBd1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozOToyM1rOEHHqCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Nzk5NTA5OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/PlanIntentServiceHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0MDozM1rOGmLQhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0MDozM1rOGmLQhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY4MzUyNQ==", "bodyText": "since the limit can always be changed from the server, retry sync if any record was synced", "url": "https://github.com/opensrp/opensrp-client-core/pull/548#discussion_r442683525", "createdAt": "2020-06-19T07:40:33Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/PlanIntentServiceHelper.java", "diffHunk": "@@ -59,6 +60,15 @@ private PlanIntentServiceHelper(PlanDefinitionRepository planRepository, Locatio\n     }\n \n     public void syncPlans() {\n+        int batchFetchCount = batchFetchPlansFromServer();\n+\n+        while(batchFetchCount >= PLAN_PULL_LIMIT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997cf6f9fe7eb68dc2071ab7bc519406877f1b26"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Nzk5NTQ3OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/LocationServiceHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0MDo0MFrOGmLQxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0MDo0MFrOGmLQxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY4MzU4OA==", "bodyText": "since the limit can always be changed from the server, retry sync if any record was synced", "url": "https://github.com/opensrp/opensrp-client-core/pull/548#discussion_r442683588", "createdAt": "2020-06-19T07:40:40Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/LocationServiceHelper.java", "diffHunk": "@@ -78,6 +79,19 @@ public static LocationServiceHelper getInstance() {\n     }\n \n     protected List<Location> syncLocationsStructures(boolean isJurisdiction) {\n+        List<Location> locationStructures = batchSyncLocationsStructures(isJurisdiction);\n+        int batchFetchCount = locationStructures.size();\n+\n+        while( locationStructures != null &&  batchFetchCount >= LOCATION_PULL_LIMIT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997cf6f9fe7eb68dc2071ab7bc519406877f1b26"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Nzk5NzI3OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/TaskServiceHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0MToyM1rOGmLR3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo0MToyM1rOGmLR3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY4Mzg3MQ==", "bodyText": "since the limit can always be changed from the server, retry sync if any record was synced", "url": "https://github.com/opensrp/opensrp-client-core/pull/548#discussion_r442683871", "createdAt": "2020-06-19T07:41:23Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/TaskServiceHelper.java", "diffHunk": "@@ -95,6 +96,20 @@ public TaskServiceHelper(TaskRepository taskRepository) {\n     public List<Task> fetchTasksFromServer() {\n         Set<String> planDefinitions = getPlanDefinitionIds();\n         List<String> groups = getLocationIds();\n+\n+        List<Task> tasks = batchFetchTasksFromServer(planDefinitions,groups);\n+        int batchFetchCount = tasks.size();\n+\n+        while( tasks != null &&  batchFetchCount >= TASK_PULL_LIMIT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "997cf6f9fe7eb68dc2071ab7bc519406877f1b26"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODk5NzUxOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/PlanIntentServiceHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozNjowMVrOGmVFSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozNjowMVrOGmVFSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0NDQ5MQ==", "bodyText": "No need for this", "url": "https://github.com/opensrp/opensrp-client-core/pull/548#discussion_r442844491", "createdAt": "2020-06-19T13:36:01Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/PlanIntentServiceHelper.java", "diffHunk": "@@ -86,10 +91,15 @@ public void syncPlans() {\n             // update most recent server version\n             if (!Utils.isEmptyCollection(plans)) {\n                 allSharedPreferences.savePreference(PLAN_LAST_SYNC_DATE, String.valueOf(getPlanDefinitionMaxServerVersion(plans, maxServerVersion)));\n+\n+                // retry fetch since there were items synced from the server\n+                batchFetchPlansFromServer();\n             }\n         } catch (Exception e) {\n             Timber.e(e, \"EXCEPTION %s\", e.toString());\n         }\n+\n+        return ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67cc94109686f2773a128b85f6caa684181b15d4"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTAwNzUzOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/TaskServiceHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozODo1M1rOGmVLcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozODo1M1rOGmVLcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0NjA2NA==", "bodyText": "for recursion add a param  List<Task to batchFetchTasksFromServer\nThen this is how you recall the method\ntasks.addAll(batchFetchTasks);\nreturn  batchFetchTasksFromServer(planDefinitions, groups,tasks);", "url": "https://github.com/opensrp/opensrp-client-core/pull/548#discussion_r442846064", "createdAt": "2020-06-19T13:38:53Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/TaskServiceHelper.java", "diffHunk": "@@ -120,6 +127,9 @@ public TaskServiceHelper(TaskRepository taskRepository) {\n             }\n             if (!Utils.isEmptyCollection(tasks)) {\n                 allSharedPreferences.savePreference(TASK_LAST_SYNC_DATE, String.valueOf(getTaskMaxServerVersion(tasks, maxServerVersion)));\n+                // retry fetch since there were items synced from the server\n+                List<Task> batchFetchTasks = batchFetchTasksFromServer(planDefinitions, groups);\n+                tasks.addAll(batchFetchTasks);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67cc94109686f2773a128b85f6caa684181b15d4"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTAwOTM4OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/LocationServiceHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozOToyM1rOGmVMiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozOToyM1rOGmVMiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0NjM0Nw==", "bodyText": "check https://github.com/OpenSRP/opensrp-client-core/pull/548/files#r442846064", "url": "https://github.com/opensrp/opensrp-client-core/pull/548#discussion_r442846347", "createdAt": "2020-06-19T13:39:23Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/LocationServiceHelper.java", "diffHunk": "@@ -108,6 +113,10 @@ public static LocationServiceHelper getInstance() {\n                 String maxServerVersion = getMaxServerVersion(locations);\n                 String updateKey = isJurisdiction ? LOCATION_LAST_SYNC_DATE : STRUCTURES_LAST_SYNC_DATE;\n                 allSharedPreferences.savePreference(updateKey, maxServerVersion);\n+\n+                // retry fetch since there were items synced from the server\n+                List<Location> batchLocationStructures = batchSyncLocationsStructures(isJurisdiction);\n+                locations.addAll(batchLocationStructures);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67cc94109686f2773a128b85f6caa684181b15d4"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2178, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}