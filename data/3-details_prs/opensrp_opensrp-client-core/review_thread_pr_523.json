{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MDc4NTM1", "number": 523, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxNjoxNFrOD9teZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyNToxN1rOD9tr8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDM0Nzg5OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxNjoxNFrOGXXYtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxNjoxNFrOGXXYtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MzU5MQ==", "bodyText": "use Locale.ENGLISH instead or en", "url": "https://github.com/opensrp/opensrp-client-core/pull/523#discussion_r427153591", "createdAt": "2020-05-19T09:16:14Z", "author": {"login": "dubdabasoduba"}, "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "diffHunk": "@@ -1147,4 +1158,66 @@ public JSONObject getFormJsonFromRepositoryOrAssets(String formIdentity) {\n         return getFormJson(formIdentity);\n     }\n \n+    @Nullable\n+    public JSONObject getSubFormJsonFromRepository(String formIdentity, String subFormsLocation, Context context, boolean translateSubForm) {\n+        ClientFormRepository clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        String locale = mContext.getResources().getConfiguration().locale.getLanguage();\n+\n+        //Check the current locale of the app to load the correct version of the form in the desired language\n+        String localeFormIdentity = formIdentity;\n+        if (!\"en\".equals(locale)) {\n+            localeFormIdentity = localeFormIdentity + \"-\" + locale;\n+        }\n+\n+        String dbFormName = TextUtils.isEmpty(subFormsLocation) ? localeFormIdentity : subFormsLocation + \"/\" + localeFormIdentity;\n+        ClientForm clientForm = clientFormRepository.getActiveClientFormByIdentifier(dbFormName);\n+\n+        if (clientForm == null) {\n+            String revisedFormName = dbFormName.endsWith(\".json\")\n+                    ? dbFormName.substring(0, localeFormIdentity.length() - 5) : dbFormName + \".json\";\n+            clientForm = clientFormRepository.getActiveClientFormByIdentifier(revisedFormName);\n+\n+            if (clientForm == null) {\n+                String finalSubFormsLocation = com.vijay.jsonwizard.utils.FormUtils.getSubFormLocation(subFormsLocation);\n+                dbFormName = TextUtils.isEmpty(finalSubFormsLocation) ? localeFormIdentity : finalSubFormsLocation + \"/\" + localeFormIdentity;\n+                clientForm = clientFormRepository.getActiveClientFormByIdentifier(dbFormName);\n+            }\n+        }\n+\n+        try {\n+            if (clientForm != null) {\n+                Timber.d(\"============%s form loaded from db============\", dbFormName);\n+                String originalJson = clientForm.getJson();\n+\n+                return new JSONObject(NativeFormLangUtils.getTranslatedString(originalJson, context));\n+            }\n+        } catch (JSONException e) {\n+            Timber.e(e);\n+        }\n+\n+        return null;\n+    }\n+\n+    @Nullable\n+    public BufferedReader getRulesFromRepository(String fileName) {\n+        ClientFormRepository clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        String locale = mContext.getResources().getConfiguration().locale.getLanguage();\n+\n+        //Check the current locale of the app to load the correct version of the form in the desired language\n+        String localeFormIdentity = fileName;\n+        if (!\"en\".equals(locale)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78c3ac37e6631b2ce6f93afcabb9dd190633a67"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDM1MTU4OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/service/DocumentConfigurationService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxNzoxM1rOGXXbGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxNzoxM1rOGXXbGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1NDIwMQ==", "bodyText": "Where are this imports used in this class?", "url": "https://github.com/opensrp/opensrp-client-core/pull/523#discussion_r427154201", "createdAt": "2020-05-19T09:17:13Z", "author": {"login": "dubdabasoduba"}, "path": "opensrp-app/src/main/java/org/smartregister/service/DocumentConfigurationService.java", "diffHunk": "@@ -17,6 +17,8 @@\n import org.smartregister.repository.ClientFormRepository;\n import org.smartregister.repository.ManifestRepository;\n \n+import java.io.UnsupportedEncodingException;\n+import java.net.URLEncoder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78c3ac37e6631b2ce6f93afcabb9dd190633a67"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDM1Njg1OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxODozMFrOGXXeUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToxODozMFrOGXXeUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1NTAyNA==", "bodyText": "use Locale.ENGLISH instead of the  string en", "url": "https://github.com/opensrp/opensrp-client-core/pull/523#discussion_r427155024", "createdAt": "2020-05-19T09:18:30Z", "author": {"login": "dubdabasoduba"}, "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "diffHunk": "@@ -1147,4 +1158,66 @@ public JSONObject getFormJsonFromRepositoryOrAssets(String formIdentity) {\n         return getFormJson(formIdentity);\n     }\n \n+    @Nullable\n+    public JSONObject getSubFormJsonFromRepository(String formIdentity, String subFormsLocation, Context context, boolean translateSubForm) {\n+        ClientFormRepository clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        String locale = mContext.getResources().getConfiguration().locale.getLanguage();\n+\n+        //Check the current locale of the app to load the correct version of the form in the desired language\n+        String localeFormIdentity = formIdentity;\n+        if (!\"en\".equals(locale)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78c3ac37e6631b2ce6f93afcabb9dd190633a67"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDM3MDg5OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyMjoxMFrOGXXnLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyMjoxMFrOGXXnLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1NzI5Mg==", "bodyText": "StringUtils.isNotBlank or StringUtils.isBlank is more efficient than TextUtils.isEmpty since it checks for whitespaces too", "url": "https://github.com/opensrp/opensrp-client-core/pull/523#discussion_r427157292", "createdAt": "2020-05-19T09:22:10Z", "author": {"login": "dubdabasoduba"}, "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "diffHunk": "@@ -1147,4 +1158,66 @@ public JSONObject getFormJsonFromRepositoryOrAssets(String formIdentity) {\n         return getFormJson(formIdentity);\n     }\n \n+    @Nullable\n+    public JSONObject getSubFormJsonFromRepository(String formIdentity, String subFormsLocation, Context context, boolean translateSubForm) {\n+        ClientFormRepository clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        String locale = mContext.getResources().getConfiguration().locale.getLanguage();\n+\n+        //Check the current locale of the app to load the correct version of the form in the desired language\n+        String localeFormIdentity = formIdentity;\n+        if (!\"en\".equals(locale)) {\n+            localeFormIdentity = localeFormIdentity + \"-\" + locale;\n+        }\n+\n+        String dbFormName = TextUtils.isEmpty(subFormsLocation) ? localeFormIdentity : subFormsLocation + \"/\" + localeFormIdentity;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78c3ac37e6631b2ce6f93afcabb9dd190633a67"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDM3MjU4OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyMjo0MVrOGXXoPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyMjo0MVrOGXXoPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1NzU2NQ==", "bodyText": "Can we have the .json  defined as a constant?", "url": "https://github.com/opensrp/opensrp-client-core/pull/523#discussion_r427157565", "createdAt": "2020-05-19T09:22:41Z", "author": {"login": "dubdabasoduba"}, "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "diffHunk": "@@ -1147,4 +1158,66 @@ public JSONObject getFormJsonFromRepositoryOrAssets(String formIdentity) {\n         return getFormJson(formIdentity);\n     }\n \n+    @Nullable\n+    public JSONObject getSubFormJsonFromRepository(String formIdentity, String subFormsLocation, Context context, boolean translateSubForm) {\n+        ClientFormRepository clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        String locale = mContext.getResources().getConfiguration().locale.getLanguage();\n+\n+        //Check the current locale of the app to load the correct version of the form in the desired language\n+        String localeFormIdentity = formIdentity;\n+        if (!\"en\".equals(locale)) {\n+            localeFormIdentity = localeFormIdentity + \"-\" + locale;\n+        }\n+\n+        String dbFormName = TextUtils.isEmpty(subFormsLocation) ? localeFormIdentity : subFormsLocation + \"/\" + localeFormIdentity;\n+        ClientForm clientForm = clientFormRepository.getActiveClientFormByIdentifier(dbFormName);\n+\n+        if (clientForm == null) {\n+            String revisedFormName = dbFormName.endsWith(\".json\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78c3ac37e6631b2ce6f93afcabb9dd190633a67"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDM3OTM2OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyNDozMFrOGXXsiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyNDozMFrOGXXsiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1ODY2NQ==", "bodyText": "This has been repeated in line 1176 please refactor it for reuse", "url": "https://github.com/opensrp/opensrp-client-core/pull/523#discussion_r427158665", "createdAt": "2020-05-19T09:24:30Z", "author": {"login": "dubdabasoduba"}, "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "diffHunk": "@@ -1135,6 +1139,13 @@ public JSONObject getFormJsonFromRepositoryOrAssets(String formIdentity) {\n         }\n \n         ClientForm clientForm = clientFormRepository.getActiveClientFormByIdentifier(localeFormIdentity);\n+\n+        if (clientForm == null) {\n+            String revisedFormName = localeFormIdentity .endsWith(\".json\")\n+                    ? localeFormIdentity.substring(0, localeFormIdentity.length() - 5) : localeFormIdentity + \".json\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78c3ac37e6631b2ce6f93afcabb9dd190633a67"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDM4MjU3OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyNToxN1rOGXXujA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOToyNToxN1rOGXXujA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1OTE4MA==", "bodyText": "StringUtils.isNotBlank or StringUtils.isBlank is more efficient than TextUtils.isEmpty since it checks for whitespaces too & refactor for reuse.", "url": "https://github.com/opensrp/opensrp-client-core/pull/523#discussion_r427159180", "createdAt": "2020-05-19T09:25:17Z", "author": {"login": "dubdabasoduba"}, "path": "opensrp-app/src/main/java/org/smartregister/util/FormUtils.java", "diffHunk": "@@ -1147,4 +1158,66 @@ public JSONObject getFormJsonFromRepositoryOrAssets(String formIdentity) {\n         return getFormJson(formIdentity);\n     }\n \n+    @Nullable\n+    public JSONObject getSubFormJsonFromRepository(String formIdentity, String subFormsLocation, Context context, boolean translateSubForm) {\n+        ClientFormRepository clientFormRepository = CoreLibrary.getInstance().context().getClientFormRepository();\n+        String locale = mContext.getResources().getConfiguration().locale.getLanguage();\n+\n+        //Check the current locale of the app to load the correct version of the form in the desired language\n+        String localeFormIdentity = formIdentity;\n+        if (!\"en\".equals(locale)) {\n+            localeFormIdentity = localeFormIdentity + \"-\" + locale;\n+        }\n+\n+        String dbFormName = TextUtils.isEmpty(subFormsLocation) ? localeFormIdentity : subFormsLocation + \"/\" + localeFormIdentity;\n+        ClientForm clientForm = clientFormRepository.getActiveClientFormByIdentifier(dbFormName);\n+\n+        if (clientForm == null) {\n+            String revisedFormName = dbFormName.endsWith(\".json\")\n+                    ? dbFormName.substring(0, localeFormIdentity.length() - 5) : dbFormName + \".json\";\n+            clientForm = clientFormRepository.getActiveClientFormByIdentifier(revisedFormName);\n+\n+            if (clientForm == null) {\n+                String finalSubFormsLocation = com.vijay.jsonwizard.utils.FormUtils.getSubFormLocation(subFormsLocation);\n+                dbFormName = TextUtils.isEmpty(finalSubFormsLocation) ? localeFormIdentity : finalSubFormsLocation + \"/\" + localeFormIdentity;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78c3ac37e6631b2ce6f93afcabb9dd190633a67"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2166, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}