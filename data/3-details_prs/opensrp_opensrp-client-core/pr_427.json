{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NDg5NTAz", "number": 427, "title": "Add tests to clientprocessorforjava", "bodyText": "Added the following tests for ClientProcessorForJava:\n\ncloseCase\nupdateIdenitifier\ngetGender\ngetClientAttributes", "createdAt": "2020-02-18T08:51:28Z", "url": "https://github.com/opensrp/opensrp-client-core/pull/427", "merged": true, "mergeCommit": {"oid": "46a0826c5f353d6bfa75560e7729bd7d91e3b0a2"}, "closed": true, "closedAt": "2020-02-19T07:39:14Z", "author": {"login": "bennsimon"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFduyHgH2gAyMzc2NDg5NTAzOjE4ZjYzNGQ0MzgwMzUzOTIwMzE0MzZhZTY4ZDhhNzMxNWNiMGE0ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFxismgFqTM2MDg5MzIzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "18f634d438035392031436ae68d8a7315cb0a484", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/18f634d438035392031436ae68d8a7315cb0a484", "committedDate": "2020-02-18T08:34:03Z", "message": "added tests to org.smartregister.sync#getClientAttributes,#"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7756528db2e2b73088c1fcb8f68dcad8505724c7", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/7756528db2e2b73088c1fcb8f68dcad8505724c7", "committedDate": "2020-02-18T08:50:07Z", "message": "added close case test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82950a9eb5ffc46e2a3166fea9756f3c112c4c4e", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/82950a9eb5ffc46e2a3166fea9756f3c112c4c4e", "committedDate": "2020-02-18T09:14:46Z", "message": "set instance to null after test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzMyNzEy", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#pullrequestreview-360332712", "createdAt": "2020-02-18T13:24:37Z", "commit": {"oid": "82950a9eb5ffc46e2a3166fea9756f3c112c4c4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoyNDozN1rOFrCJsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoyNDozN1rOFrCJsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2ODMzOA==", "bodyText": "Is this the only the exception that can occur", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#discussion_r380668338", "createdAt": "2020-02-18T13:24:37Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/ClientProcessorForJava.java", "diffHunk": "@@ -663,7 +658,7 @@ public void updateClientDetailsTable(Event event, Client client) {\n             if (StringUtils.isNotBlank(gender)) {\n                 map.put(GENDER, gender);\n             }\n-        } catch (Exception e) {\n+        } catch (NullPointerException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82950a9eb5ffc46e2a3166fea9756f3c112c4c4e"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzMyNzU5", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#pullrequestreview-360332759", "createdAt": "2020-02-18T13:24:42Z", "commit": {"oid": "82950a9eb5ffc46e2a3166fea9756f3c112c4c4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoyNDo0MlrOFrCJ1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoyNDo0MlrOFrCJ1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2ODM3NA==", "bodyText": "Is this the only the exception that can occur", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#discussion_r380668374", "createdAt": "2020-02-18T13:24:42Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/ClientProcessorForJava.java", "diffHunk": "@@ -648,7 +643,7 @@ public void updateClientDetailsTable(Event event, Client client) {\n                     attributes.put(key, value.toString());\n                 }\n             }\n-        } catch (Exception e) {\n+        } catch (NullPointerException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82950a9eb5ffc46e2a3166fea9756f3c112c4c4e"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzM4MDg5", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#pullrequestreview-360338089", "createdAt": "2020-02-18T13:32:34Z", "commit": {"oid": "82950a9eb5ffc46e2a3166fea9756f3c112c4c4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzozMjozNVrOFrCZ4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzozMjozNVrOFrCZ4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY3MjQ4MA==", "bodyText": "why is this required, unit tests should normally end with asserts or expected failures", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#discussion_r380672480", "createdAt": "2020-02-18T13:32:35Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/test/java/org/smartregister/sync/ClientProcessorForJavaTest.java", "diffHunk": "@@ -92,4 +114,57 @@ public void testGetValuesStrShouldGetCorrectlyFormattedString() throws Exception\n         valStr = Whitebox.invokeMethod(clientProcessor, \"getValuesStr\", obs, values, null);\n         assertEquals(\"val1\", valStr);\n     }\n+\n+    @Test\n+    public void testGetClientAttributesShouldReturnRequiredValues() throws Exception {\n+        ClientProcessorForJava clientProcessor = new ClientProcessorForJava(context);\n+        Map<String, Object> attributes = new HashMap<>();\n+        attributes.put(\"national_id\", \"3434-34\");\n+        attributes.put(\"drivers-license\", \"DL-324\");\n+        Client client = new Client(\"123-23\");\n+        client.setAttributes(attributes);\n+        Map<String, Object> result = Whitebox.invokeMethod(clientProcessor, \"getClientAttributes\", client);\n+        assertEquals(attributes, result);\n+    }\n+\n+    @Test\n+    public void testGetGenderShouldReturnCorrectValue() throws Exception {\n+        ClientProcessorForJava clientProcessor = new ClientProcessorForJava(context);\n+        Client client = new Client(\"123-23\");\n+        client.setGender(\"Female\");\n+        Map<String, String> resultMap = Whitebox.invokeMethod(clientProcessor, \"getGender\", client);\n+        Map<String, String> expectedMap = new HashMap<>();\n+        expectedMap.put(\"gender\", \"Female\");\n+        assertEquals(expectedMap, resultMap);\n+    }\n+\n+    @Test\n+    public void testUpdateIdenitifierShouldRemoveHyphenFromOpenmrsId() throws Exception {\n+        ClientProcessorForJava clientProcessor = new ClientProcessorForJava(context);\n+        ContentValues contentValues = new ContentValues();\n+        contentValues.put(\"zeir_id\", \"23-23\");\n+        Whitebox.setInternalState(clientProcessor, \"openmrsGenIds\", new String[]{\"zeir_id\"});\n+        Whitebox.invokeMethod(clientProcessor, \"updateIdenitifier\", contentValues);\n+        assertEquals(\"2323\", contentValues.get(\"zeir_id\"));\n+    }\n+\n+    @Test\n+    public void testCloseCaseShouldReturnFalseIfCloseCaseIsEmpty() {\n+        ClientProcessorForJava clientProcessor = new ClientProcessorForJava(context);\n+        assertFalse(clientProcessor.closeCase(new Client(\"1233-2\"), new ArrayList<>()));\n+    }\n+\n+    @Test\n+    public void testCloseCaseShouldPassCorrectValuesToCloseCase() {\n+        ClientProcessorForJava clientProcessor = new ClientProcessorForJava(context);\n+        CommonRepository commonRepository = Mockito.mock(CommonRepository.class);\n+        ReflectionHelpers.setStaticField(CoreLibrary.class, \"instance\", coreLibrary);\n+        PowerMockito.when(coreLibrary.context()).thenReturn(opensrpContext);\n+        PowerMockito.when(opensrpContext.commonrepository(\"child\")).thenReturn(commonRepository);\n+        assertTrue(clientProcessor.closeCase(new Client(\"1233-2\"), Arrays.asList(\"child\")));\n+        Mockito.verify(commonRepository).closeCase(closeCaseArgumentCaptor.capture(), closeCaseArgumentCaptor.capture());\n+        assertEquals(\"1233-2\", closeCaseArgumentCaptor.getAllValues().get(0));\n+        assertEquals(\"child\", closeCaseArgumentCaptor.getAllValues().get(1));\n+        ReflectionHelpers.setStaticField(CoreLibrary.class, \"instance\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82950a9eb5ffc46e2a3166fea9756f3c112c4c4e"}, "originalPosition": 110}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c940ee22349d6bcc4b5255b61bb4f2592bf81d71", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/c940ee22349d6bcc4b5255b61bb4f2592bf81d71", "committedDate": "2020-02-18T14:03:23Z", "message": "Merge branch 'master' into add-tests-to-clientprocessorforjava"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzY5Mjg4", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#pullrequestreview-360369288", "createdAt": "2020-02-18T14:14:15Z", "commit": {"oid": "c940ee22349d6bcc4b5255b61bb4f2592bf81d71"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba4040fffdbc57deda57fc568092218c65ef1bd3", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/ba4040fffdbc57deda57fc568092218c65ef1bd3", "committedDate": "2020-02-19T07:04:28Z", "message": "Merge branch 'master' of github.com:OpenSRP/opensrp-client-core into add-tests-to-clientprocessorforjava"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2f06e4e62e5b486ae1b125a27f79e82475b7bd8", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/e2f06e4e62e5b486ae1b125a27f79e82475b7bd8", "committedDate": "2020-02-19T07:25:19Z", "message": "Merge branch 'master' into add-tests-to-clientprocessorforjava"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODkzMjMx", "url": "https://github.com/opensrp/opensrp-client-core/pull/427#pullrequestreview-360893231", "createdAt": "2020-02-19T07:38:57Z", "commit": {"oid": "e2f06e4e62e5b486ae1b125a27f79e82475b7bd8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2605, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}