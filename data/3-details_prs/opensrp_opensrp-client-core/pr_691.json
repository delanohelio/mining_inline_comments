{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMzk3NzI3", "number": 691, "title": "Task data model changes", "bodyText": "Resolves #686", "createdAt": "2020-11-16T06:31:54Z", "url": "https://github.com/opensrp/opensrp-client-core/pull/691", "merged": true, "mergeCommit": {"oid": "3a1554f0510e980e70e0e34f49a0da3afdfc6fc0"}, "closed": true, "closedAt": "2020-11-20T12:16:26Z", "author": {"login": "githengi"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddDXimAFqTUzMTIzMjk4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeWToXgFqTUzNTM3NzUxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMjMyOTg4", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#pullrequestreview-531232988", "createdAt": "2020-11-16T11:24:16Z", "commit": {"oid": "2df464ea50fe50d5ac38780d8879130698da130c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMToyNDoxNlrOHz3kQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMTozNjoxOFrOHz4YAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE0OTgyNg==", "bodyText": "Fix this to restriction_end", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r524149826", "createdAt": "2020-11-16T11:24:16Z", "author": {"login": "ekigamba"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -69,10 +72,13 @@\n     private static final String REASON_REFERENCE = \"reason_reference\";\n     private static final String LOCATION = \"location\";\n     private static final String REQUESTER = \"requester\";\n+    private static final String RESTRICTION_REPEAT = \"restriction_repeat\";\n+    private static final String RESTRICTION_START = \"restriction_start\";\n+    private static final String RESTRICTION_END = \"restriction_start\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2df464ea50fe50d5ac38780d8879130698da130c"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE1NDMxMQ==", "bodyText": "I think  this query is wrong\nHave you tested this out and line 132?", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r524154311", "createdAt": "2020-11-16T11:28:07Z", "author": {"login": "ekigamba"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -112,6 +121,17 @@ public static void createTable(SQLiteDatabase database) {\n         database.execSQL(CREATE_TASK_PLAN_GROUP_INDEX);\n     }\n \n+    /**\n+     * Migrate the older database by add restriction columns and changing of priority to enum\n+     * @param database the database being upgraded\n+     */\n+    public static void updatePriorityToEnumAndAddRestrictions(@NonNull SQLiteDatabase database) {\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_REPEAT, VARCHAR);\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_START, VARCHAR);\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_END, VARCHAR);\n+        DatabaseMigrationUtils.recreateSyncTableWithExistingColumnsOnly(database, TASK_TABLE, COLUMNS, CREATE_TASK_TABLE);\n+        database.execSQL(String.format(\"UPDATE %s SET %s=? WHERE %s =? \", TASK_TABLE, PRIORITY, PRIORITY), new Object[]{\"3\", \"3\"});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2df464ea50fe50d5ac38780d8879130698da130c"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE1OTY0Mg==", "bodyText": "Is the task.restriction supposed to be saved here also?", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r524159642", "createdAt": "2020-11-16T11:33:03Z", "author": {"login": "ekigamba"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -139,13 +159,15 @@ public void addOrUpdate(Task task, boolean updateOnly) {\n             contentValues.put(STATUS, task.getStatus().name());\n         }\n         contentValues.put(BUSINESS_STATUS, task.getBusinessStatus());\n-        contentValues.put(PRIORITY, task.getPriority());\n+        contentValues.put(PRIORITY, task.getPriority().name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2df464ea50fe50d5ac38780d8879130698da130c"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2MzA3NA==", "bodyText": "should be columns and not table here", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r524163074", "createdAt": "2020-11-16T11:36:18Z", "author": {"login": "ekigamba"}, "path": "opensrp-app/src/main/java/org/smartregister/util/DatabaseMigrationUtils.java", "diffHunk": "@@ -156,6 +156,32 @@ public static void recreateSyncTableWithExistingColumnsOnly(SQLiteDatabase datab\n     }\n \n \n+    public static void recreateSyncTableWithExistingColumnsOnly(SQLiteDatabase database, String table ,String[] columns, String createTableDDL) {\n+        database.beginTransaction();\n+        //rename original table\n+        database.execSQL(\"ALTER TABLE \" + table + \" RENAME TO \" + TABLE_PREFIX + table);\n+        //recreate table\n+        database.execSQL(createTableDDL);\n+        //\n+        String insertQuery = \"INSERT INTO \"\n+                + table\n+                + \" (\" + StringUtils.join(table, \", \") + \")\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2df464ea50fe50d5ac38780d8879130698da130c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eddfaadd1673a82de403d7ab0d1ffb0465e4c01", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/0eddfaadd1673a82de403d7ab0d1ffb0465e4c01", "committedDate": "2020-11-19T14:26:31Z", "message": "Upgrade plan evaluator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d66bce73298b6b6f4fada7b0eaa3a80ae4187c0", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/8d66bce73298b6b6f4fada7b0eaa3a80ae4187c0", "committedDate": "2020-11-19T14:26:32Z", "message": "Update task repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5154544e832fa10ca86af0baa01557937a42e582", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/5154544e832fa10ca86af0baa01557937a42e582", "committedDate": "2020-11-19T14:26:32Z", "message": "support adding of restriction columns as well as changing priority"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b949a6a766d47e02efc7baac02d4f42963ea18d9", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/b949a6a766d47e02efc7baac02d4f42963ea18d9", "committedDate": "2020-11-19T14:26:32Z", "message": "add method to upgrade the current task table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4e023e2c6716381c3d1ad046207670331102ea4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/c4e023e2c6716381c3d1ad046207670331102ea4", "committedDate": "2020-11-19T14:26:32Z", "message": "Use Task V2 API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2df464ea50fe50d5ac38780d8879130698da130c", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/2df464ea50fe50d5ac38780d8879130698da130c", "committedDate": "2020-11-13T15:05:31Z", "message": "Use Task V2 API"}, "afterCommit": {"oid": "c4e023e2c6716381c3d1ad046207670331102ea4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/c4e023e2c6716381c3d1ad046207670331102ea4", "committedDate": "2020-11-19T14:26:32Z", "message": "Use Task V2 API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "287144d9e5914fa008df1093b973551faa3d3fea", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/287144d9e5914fa008df1093b973551faa3d3fea", "committedDate": "2020-11-19T14:36:37Z", "message": "save restriction and populate when populating entity from database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99fedfa8bad9af52c4aa603fd476122ec7e2a2b4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/99fedfa8bad9af52c4aa603fd476122ec7e2a2b4", "committedDate": "2020-11-19T14:37:02Z", "message": "Bump up version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c267745fa316726696f008c3f1862f6f26a610f4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/c267745fa316726696f008c3f1862f6f26a610f4", "committedDate": "2020-11-19T14:47:09Z", "message": "Update campaign classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e91486a2aba888f99c8f7dc62230991acdb3958d", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/e91486a2aba888f99c8f7dc62230991acdb3958d", "committedDate": "2020-11-19T15:14:38Z", "message": "update unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bf6530fbafc79bc8e5f5996b4757d01104669c1", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/2bf6530fbafc79bc8e5f5996b4757d01104669c1", "committedDate": "2020-11-19T15:28:40Z", "message": "Update all tasks to routine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99c37cf12fae4c3b1070e2c1cfe7c39c7a66827b", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/99c37cf12fae4c3b1070e2c1cfe7c39c7a66827b", "committedDate": "2020-11-19T15:28:58Z", "message": "Correct query syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b90e55c8646e1bf4429b7a56c7e39b65b10a1265", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/b90e55c8646e1bf4429b7a56c7e39b65b10a1265", "committedDate": "2020-11-19T15:38:17Z", "message": "replace priority with enum name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "529973ca191c1dc11f23496221bef214286e20d4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/529973ca191c1dc11f23496221bef214286e20d4", "committedDate": "2020-11-19T15:42:02Z", "message": "strip date format for unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5971fb081ec56bc01c856f42b1d44267ddd3b293", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/5971fb081ec56bc01c856f42b1d44267ddd3b293", "committedDate": "2020-11-19T16:11:17Z", "message": "correct broken unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "756e1343cef37ca14d5de6878a6ab9807ad1cc66", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/756e1343cef37ca14d5de6878a6ab9807ad1cc66", "committedDate": "2020-11-19T16:20:41Z", "message": "set restriction only if period or repititions are set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5402974633978c0310bebcd1368b0b9822aa9223", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/5402974633978c0310bebcd1368b0b9822aa9223", "committedDate": "2020-11-19T16:30:34Z", "message": "Update broken unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdc3772d0f03b41c28067bf962a7456e271e3c11", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/cdc3772d0f03b41c28067bf962a7456e271e3c11", "committedDate": "2020-11-19T16:58:42Z", "message": "clear mock repository after tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a95ec7e49219d216bff908a1ccf3d467f0ba3b4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/2a95ec7e49219d216bff908a1ccf3d467f0ba3b4", "committedDate": "2020-11-20T07:22:27Z", "message": "Init core library before tests"}, "afterCommit": {"oid": "941bf9c0e4241dd8a758f66346317ae0ef1855e4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/941bf9c0e4241dd8a758f66346317ae0ef1855e4", "committedDate": "2020-11-20T07:30:10Z", "message": "Reinit core Library and context singleton after each test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "941bf9c0e4241dd8a758f66346317ae0ef1855e4", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/941bf9c0e4241dd8a758f66346317ae0ef1855e4", "committedDate": "2020-11-20T07:30:10Z", "message": "Reinit core Library and context singleton after each test"}, "afterCommit": {"oid": "6ddfdd4874f397a1b7cca3f901bcdfc26de18857", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/6ddfdd4874f397a1b7cca3f901bcdfc26de18857", "committedDate": "2020-11-20T07:50:03Z", "message": "Reinit core Library and context singleton after each test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ddfdd4874f397a1b7cca3f901bcdfc26de18857", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/6ddfdd4874f397a1b7cca3f901bcdfc26de18857", "committedDate": "2020-11-20T07:50:03Z", "message": "Reinit core Library and context singleton after each test"}, "afterCommit": {"oid": "cdc3772d0f03b41c28067bf962a7456e271e3c11", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/cdc3772d0f03b41c28067bf962a7456e271e3c11", "committedDate": "2020-11-19T16:58:42Z", "message": "clear mock repository after tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f3c7b95e852a0b17d57ae62c43c80794357c88b", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/7f3c7b95e852a0b17d57ae62c43c80794357c88b", "committedDate": "2020-11-20T09:20:25Z", "message": "Use oracle JDK"}, "afterCommit": {"oid": "84511f736bb4dcaeb2c9742e4ce3945410200f46", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/84511f736bb4dcaeb2c9742e4ce3945410200f46", "committedDate": "2020-11-20T09:21:53Z", "message": "Use oracle JDK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8650c3aa546792e72104503b2698770dbcc64f5", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/b8650c3aa546792e72104503b2698770dbcc64f5", "committedDate": "2020-11-20T09:28:56Z", "message": "init core library before tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84511f736bb4dcaeb2c9742e4ce3945410200f46", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/84511f736bb4dcaeb2c9742e4ce3945410200f46", "committedDate": "2020-11-20T09:21:53Z", "message": "Use oracle JDK"}, "afterCommit": {"oid": "b8650c3aa546792e72104503b2698770dbcc64f5", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/b8650c3aa546792e72104503b2698770dbcc64f5", "committedDate": "2020-11-20T09:28:56Z", "message": "init core library before tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb056bfc396e1880b0a4e1f165d3d2f16bd0b6ac", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/eb056bfc396e1880b0a4e1f165d3d2f16bd0b6ac", "committedDate": "2020-11-20T09:50:08Z", "message": "Broken unit tests"}, "afterCommit": {"oid": "847211b851c9f489fe77b45b608dbaca6bab7ff6", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/847211b851c9f489fe77b45b608dbaca6bab7ff6", "committedDate": "2020-11-20T10:20:39Z", "message": "fix Broken unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2afe25b9870432453b4af46af901dab0f5d65f5c", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/2afe25b9870432453b4af46af901dab0f5d65f5c", "committedDate": "2020-11-20T10:35:14Z", "message": "fix Broken unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "847211b851c9f489fe77b45b608dbaca6bab7ff6", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/847211b851c9f489fe77b45b608dbaca6bab7ff6", "committedDate": "2020-11-20T10:20:39Z", "message": "fix Broken unit tests"}, "afterCommit": {"oid": "2afe25b9870432453b4af46af901dab0f5d65f5c", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/2afe25b9870432453b4af46af901dab0f5d65f5c", "committedDate": "2020-11-20T10:35:14Z", "message": "fix Broken unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a0d42fb5fe1d7498cdd9e0408ee2836860dc434", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/3a0d42fb5fe1d7498cdd9e0408ee2836860dc434", "committedDate": "2020-11-20T10:37:02Z", "message": "Migrate test to roboelectric"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/35144dd34a5110f0b137bab68389febbf3b5b6ec", "committedDate": "2020-11-20T10:55:53Z", "message": "optimize imports code cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e66bd4e2342d84cc9c67e7c983e8edac18dab93", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/0e66bd4e2342d84cc9c67e7c983e8edac18dab93", "committedDate": "2020-11-20T11:03:51Z", "message": "Remove powermock ignore configs"}, "afterCommit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/35144dd34a5110f0b137bab68389febbf3b5b6ec", "committedDate": "2020-11-20T10:55:53Z", "message": "optimize imports code cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzM2NzM5", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#pullrequestreview-535336739", "createdAt": "2020-11-20T11:12:02Z", "commit": {"oid": "0e66bd4e2342d84cc9c67e7c983e8edac18dab93"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMToxMzoyN1rOH3LfLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMToxNzozN1rOH3Lnkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYyMTkzNA==", "bodyText": "Isn't this an Integer field as declared on line 108?", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r527621934", "createdAt": "2020-11-20T11:13:27Z", "author": {"login": "Rkareko"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -112,6 +121,18 @@ public static void createTable(SQLiteDatabase database) {\n         database.execSQL(CREATE_TASK_PLAN_GROUP_INDEX);\n     }\n \n+    /**\n+     * Migrate the older database by add restriction columns and changing of priority to enum\n+     *\n+     * @param database the database being upgraded\n+     */\n+    public static void updatePriorityToEnumAndAddRestrictions(@NonNull SQLiteDatabase database) {\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_REPEAT, VARCHAR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYyNDA4Mg==", "bodyText": "on line 92 Priority has been changed from an integer field to a varchar. Do we need a migration for that?", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r527624082", "createdAt": "2020-11-20T11:17:37Z", "author": {"login": "Rkareko"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -112,6 +121,18 @@ public static void createTable(SQLiteDatabase database) {\n         database.execSQL(CREATE_TASK_PLAN_GROUP_INDEX);\n     }\n \n+    /**\n+     * Migrate the older database by add restriction columns and changing of priority to enum\n+     *\n+     * @param database the database being upgraded\n+     */\n+    public static void updatePriorityToEnumAndAddRestrictions(@NonNull SQLiteDatabase database) {\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_REPEAT, VARCHAR);\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_START, VARCHAR);\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_END, VARCHAR);\n+        DatabaseMigrationUtils.recreateSyncTableWithExistingColumnsOnly(database, TASK_TABLE, COLUMNS, CREATE_TASK_TABLE);\n+        database.execSQL(String.format(\"UPDATE %s SET %s=?\", TASK_TABLE, PRIORITY), new Object[]{Task.TaskPriority.ROUTINE.name()});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzQxMzkx", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#pullrequestreview-535341391", "createdAt": "2020-11-20T11:19:18Z", "commit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMToxOToxOFrOH3Lqjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMToyNzozN1rOH3L7TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYyNDg0Nw==", "bodyText": "Drop priority column and readd it as varchar column type", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r527624847", "createdAt": "2020-11-20T11:19:18Z", "author": {"login": "ekigamba"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -112,6 +121,18 @@ public static void createTable(SQLiteDatabase database) {\n         database.execSQL(CREATE_TASK_PLAN_GROUP_INDEX);\n     }\n \n+    /**\n+     * Migrate the older database by add restriction columns and changing of priority to enum\n+     *\n+     * @param database the database being upgraded\n+     */\n+    public static void updatePriorityToEnumAndAddRestrictions(@NonNull SQLiteDatabase database) {\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_REPEAT, VARCHAR);\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_START, VARCHAR);\n+        DatabaseMigrationUtils.addColumnIfNotExists(database, TASK_TABLE, RESTRICTION_END, VARCHAR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYyNjM2NQ==", "bodyText": "Change this type to INTEGER and the restriction_end type also. This is queried as long on line 313. Similar changes on line 131 for migration scripts. Also when saving in the ContentValue", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r527626365", "createdAt": "2020-11-20T11:22:16Z", "author": {"login": "ekigamba"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/TaskRepository.java", "diffHunk": "@@ -98,7 +104,10 @@\n                     STRUCTURE_ID + \" VARCHAR, \" +\n                     REASON_REFERENCE + \" VARCHAR, \" +\n                     LOCATION + \" VARCHAR, \" +\n-                    REQUESTER + \" VARCHAR  )\";\n+                    REQUESTER + \" VARCHAR,  \" +\n+                    RESTRICTION_REPEAT + \" INTEGER,  \" +\n+                    RESTRICTION_START + \" VARCHAR,  \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYyOTEzMw==", "bodyText": "Not sure how this works with 2019-03-31T0000. Could you confirm? Is the T0000 part essential and/or ignored during conversion?\nFound the format in CampaignTest", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#discussion_r527629133", "createdAt": "2020-11-20T11:27:37Z", "author": {"login": "ekigamba"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/helper/PlanIntentServiceHelper.java", "diffHunk": "@@ -38,7 +40,10 @@\n \n     private final PlanDefinitionRepository planDefinitionRepository;\n     private final AllSharedPreferences allSharedPreferences;\n-    protected static final Gson gson = new GsonBuilder().registerTypeAdapter(LocalDate.class, new DateTypeConverter()).create();\n+    protected static Gson gson = new GsonBuilder().registerTypeAdapter(DateTime.class, new DateTimeTypeConverter(\"yyyy-MM-dd\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35144dd34a5110f0b137bab68389febbf3b5b6ec"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66e6f5ad2936e799c9092383e116b403433523c3", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/66e6f5ad2936e799c9092383e116b403433523c3", "committedDate": "2020-11-20T11:36:21Z", "message": "Change datatype to integer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "518ece3e0910c4861b805b696d6f007359c0b598", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/518ece3e0910c4861b805b696d6f007359c0b598", "committedDate": "2020-11-20T11:30:23Z", "message": "Change datatype to integer"}, "afterCommit": {"oid": "66e6f5ad2936e799c9092383e116b403433523c3", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/66e6f5ad2936e799c9092383e116b403433523c3", "committedDate": "2020-11-20T11:36:21Z", "message": "Change datatype to integer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzU2NjI0", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#pullrequestreview-535356624", "createdAt": "2020-11-20T11:42:59Z", "commit": {"oid": "66e6f5ad2936e799c9092383e116b403433523c3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1Mzc3NTE5", "url": "https://github.com/opensrp/opensrp-client-core/pull/691#pullrequestreview-535377519", "createdAt": "2020-11-20T12:14:19Z", "commit": {"oid": "66e6f5ad2936e799c9092383e116b403433523c3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2523, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}