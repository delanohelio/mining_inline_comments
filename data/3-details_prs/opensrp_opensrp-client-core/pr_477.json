{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTIxMjU1", "number": 477, "title": "Default to saving checkbox values as a group of obs ", "bodyText": "Closes #476", "createdAt": "2020-04-07T08:33:28Z", "url": "https://github.com/opensrp/opensrp-client-core/pull/477", "merged": true, "mergeCommit": {"oid": "c4bbae93365e6da7d0a9be49e0715c43138b0c07"}, "closed": true, "closedAt": "2020-05-05T11:10:43Z", "author": {"login": "vincent-karuri"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVPD66gH2gAyNDAwMTIxMjU1OmVkMWYwODBhYjA5OWJjMjVlMzFhZTIwN2Y3YzYzZTFkZGM4ZGJhMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceRP40gFqTQwNTY1MzU0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ed1f080ab099bc25e31ae207f7c63e1ddc8dba36", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/ed1f080ab099bc25e31ae207f7c63e1ddc8dba36", "committedDate": "2020-04-07T08:31:21Z", "message": "Default to saving checkbox values as a group of obs if checkbox does not have concepts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzc4MzEz", "url": "https://github.com/opensrp/opensrp-client-core/pull/477#pullrequestreview-392778313", "createdAt": "2020-04-14T09:57:46Z", "commit": {"oid": "ed1f080ab099bc25e31ae207f7c63e1ddc8dba36"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTo1Nzo0NlrOGFHNGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowMDowMFrOGFHSvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxNDEwNw==", "bodyText": "This should be checked at options level and not at the checkbox level. Usually the options are mapped to concepts", "url": "https://github.com/opensrp/opensrp-client-core/pull/477#discussion_r408014107", "createdAt": "2020-04-14T09:57:46Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -408,39 +404,40 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n+        if (StringUtils.isBlank(value)) { return; }\n+\n         String type = getString(jsonObject, AllConstants.TYPE);\n-        String entity = CONCEPT;\n-        boolean combineCheckboxOptionValues = jsonObject.optBoolean(COMBINE_CHECKBOX_OPTION_VALUES);\n-        if (StringUtils.isNotBlank(value)) {\n-            if (AllConstants.CHECK_BOX.equals(type)) {\n-                try {\n-                    List<Object> vall = new ArrayList<>();\n-                    if (jsonObject.has(AllConstants.OPTIONS)) {\n-                        JSONArray conceptsOptions = jsonObject.getJSONArray(AllConstants.OPTIONS);\n-                        for (int i = 0; i < conceptsOptions.length(); i++) {\n-                            JSONObject option = conceptsOptions.getJSONObject(i);\n-                            boolean optionValue = option.optBoolean(VALUE);\n-                            if (optionValue) {\n-                                option.put(AllConstants.TYPE, type);\n-                                option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n-                                option.put(KEY, jsonObject.getString(KEY));\n-                                if (combineCheckboxOptionValues) {\n-                                    vall.add(option.optString(AllConstants.TEXT));\n-                                } else { // For options with concepts create an observation for each\n-                                    createObservation(e, option, String.valueOf(option.getBoolean(VALUE)), entity);\n-                                }\n+        String entity =  getString(jsonObject, OPENMRS_ENTITY);;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed1f080ab099bc25e31ae207f7c63e1ddc8dba36"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxNTU0OA==", "bodyText": "I think that this should be mutually exclusive. Either save the list of checked options in one obs, or an obs for each selection, however not both", "url": "https://github.com/opensrp/opensrp-client-core/pull/477#discussion_r408015548", "createdAt": "2020-04-14T10:00:00Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -408,39 +404,40 @@ private static JSONObject getCheckBoxJsonObjects(Event event, JSONObject parentO\n \n     public static void addObservation(Event e, JSONObject jsonObject) {\n         String value = getString(jsonObject, VALUE);\n+        if (StringUtils.isBlank(value)) { return; }\n+\n         String type = getString(jsonObject, AllConstants.TYPE);\n-        String entity = CONCEPT;\n-        boolean combineCheckboxOptionValues = jsonObject.optBoolean(COMBINE_CHECKBOX_OPTION_VALUES);\n-        if (StringUtils.isNotBlank(value)) {\n-            if (AllConstants.CHECK_BOX.equals(type)) {\n-                try {\n-                    List<Object> vall = new ArrayList<>();\n-                    if (jsonObject.has(AllConstants.OPTIONS)) {\n-                        JSONArray conceptsOptions = jsonObject.getJSONArray(AllConstants.OPTIONS);\n-                        for (int i = 0; i < conceptsOptions.length(); i++) {\n-                            JSONObject option = conceptsOptions.getJSONObject(i);\n-                            boolean optionValue = option.optBoolean(VALUE);\n-                            if (optionValue) {\n-                                option.put(AllConstants.TYPE, type);\n-                                option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n-                                option.put(KEY, jsonObject.getString(KEY));\n-                                if (combineCheckboxOptionValues) {\n-                                    vall.add(option.optString(AllConstants.TEXT));\n-                                } else { // For options with concepts create an observation for each\n-                                    createObservation(e, option, String.valueOf(option.getBoolean(VALUE)), entity);\n-                                }\n+        String entity =  getString(jsonObject, OPENMRS_ENTITY);;\n+        if (AllConstants.CHECK_BOX.equals(type)) {\n+            try {\n+                List<Object> optionValues = new ArrayList<>();\n+                if (jsonObject.has(AllConstants.OPTIONS)) {\n+                    JSONArray options = jsonObject.getJSONArray(AllConstants.OPTIONS);\n+                    for (int i = 0; i < options.length(); i++) {\n+                        JSONObject option = options.getJSONObject(i);\n+                        boolean optionValue = option.optBoolean(VALUE);\n+                        if (optionValue) {\n+                            option.put(AllConstants.TYPE, type);\n+                            option.put(AllConstants.PARENT_ENTITY_ID, jsonObject.getString(OPENMRS_ENTITY_ID));\n+                            option.put(KEY, jsonObject.getString(KEY));\n+                            if (CONCEPT.equals(entity)) {\n+                                // For options with concepts create an observation for each\n+                                createObservation(e, option, String.valueOf(option.getBoolean(VALUE)), entity);\n+                            } else {\n+                                optionValues.add(option.optString(AllConstants.TEXT));\n                             }\n                         }\n-                        if (combineCheckboxOptionValues) { // For options without concepts combine the values into one observation\n-                            createObservation(e, jsonObject, vall);\n-                        }\n                     }\n-                } catch (JSONException e1) {\n-                    Timber.e(e1);\n+                    if (!optionValues.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed1f080ab099bc25e31ae207f7c63e1ddc8dba36"}, "originalPosition": 126}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7537470e8e52399eafcecf0cc60aa8a36923ad05", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/7537470e8e52399eafcecf0cc60aa8a36923ad05", "committedDate": "2020-04-20T09:52:05Z", "message": "Extract openmrs entity from options"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNzM1MDU1", "url": "https://github.com/opensrp/opensrp-client-core/pull/477#pullrequestreview-400735055", "createdAt": "2020-04-27T08:30:35Z", "commit": {"oid": "7537470e8e52399eafcecf0cc60aa8a36923ad05"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09fa0e86bf4a8688687141994ade48e9cd19e016", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/09fa0e86bf4a8688687141994ade48e9cd19e016", "committedDate": "2020-05-05T07:22:31Z", "message": "Pull openmrs entity from both the parent widget and each checkbox option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52da078547ec83693fba170a256802823f6e0aad", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/52da078547ec83693fba170a256802823f6e0aad", "committedDate": "2020-05-05T07:23:14Z", "message": "Merge remote-tracking branch 'origin/master' into 476-revert-saving-of-checkbox-values-as-a-group-by-default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef09e16d5b325121d3339859a3f214a905dce172", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/ef09e16d5b325121d3339859a3f214a905dce172", "committedDate": "2020-05-05T09:54:46Z", "message": "Ignore failing test - it calls an external service that is currently down"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NjUzNTQz", "url": "https://github.com/opensrp/opensrp-client-core/pull/477#pullrequestreview-405653543", "createdAt": "2020-05-05T10:09:33Z", "commit": {"oid": "ef09e16d5b325121d3339859a3f214a905dce172"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2537, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}