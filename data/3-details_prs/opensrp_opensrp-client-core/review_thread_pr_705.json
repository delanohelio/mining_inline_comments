{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NTk4MTc4", "number": 705, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzoxNjozOFrOE-hbFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoxNjoyOVrOE-rFMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzOTk0Nzc0OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzoxNjozOFrOH7uU6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwODo1Njo0NFrOH7xO1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM4NzA1MA==", "bodyText": "Any reason to save each observation separately? Wouldn't it be more compact and consistent to use the approach native radio widget takes of saving key-value pairs as part of the obs using https://github.com/OpenSRP/opensrp-client-core/blob/a6880cd75e0584bf39a08277fe9226f0078ec29f/opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java#L588?", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532387050", "createdAt": "2020-11-30T07:16:38Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM4OTAyOA==", "bodyText": "What happens on https://github.com/OpenSRP/opensrp-client-core/blob/a6880cd75e0584bf39a08277fe9226f0078ec29f/opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java#L597 ? Will it create separate obs with the key/value pair i provide?", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532389028", "createdAt": "2020-11-30T07:22:36Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM4NzA1MA=="}, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM5MzA1NA==", "bodyText": "No it won't but is that necessary? This creates a block with the key-value pairs you pass as part of one obs e.g.\n{\n      \"fieldType\": \"formsubmissionField\",\n      \"fieldDataType\": \"text\",\n      \"fieldCode\": \"travel_location\",\n      \"parentCode\": \"\",\n      \"values\": [\n        \"Jakarta\",\n        \"Depok\",\n        \"Manado\"\n      ],\n      \"set\": [],\n      \"formSubmissionField\": \"travel_location\",\n      \"humanReadableValues\": [],\n      \"keyValPairs\": {\n        \"depok\": \"Depok\",\n        \"manado\": \"Manado\",\n        \"jakarta\": \"Jakarta\"\n      },\n      \"saveObsAsArray\": false\n }", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532393054", "createdAt": "2020-11-30T07:33:57Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM4NzA1MA=="}, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM5MzYxMw==", "bodyText": "the keyValPairs can contain lat,lng,alt etc. for instance.", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532393613", "createdAt": "2020-11-30T07:35:17Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM4NzA1MA=="}, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQwNjA5NA==", "bodyText": "Yeah its necessary , I need them to be different obs.", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532406094", "createdAt": "2020-11-30T08:03:46Z", "author": {"login": "bennsimon"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM4NzA1MA=="}, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzNDY0NQ==", "bodyText": "Could I ask why that is? Like what the use case is?", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532434645", "createdAt": "2020-11-30T08:56:44Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM4NzA1MA=="}, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDI4NzkxOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowMzoxMVrOH7xdSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowMzoxMVrOH7xdSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzODM0Ng==", "bodyText": "The code here looks duplicated, we can maybe move the common code into a private method.", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532438346", "createdAt": "2020-11-30T09:03:11Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {\n+        createObservation(e, jsonObject, value);\n+        if (StringUtils.isNotBlank(value)) {\n+            String[] valueArr = value.split(\" \");\n+            String formSubmissionFieldPrefix = getString(jsonObject, KEY);\n+            if (valueArr.length >= 2) {\n+                String latitude = valueArr[0];\n+                String longitude = valueArr[1];\n+                String formSubmissionField = formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LATITUDE;\n+                addObs(e, formSubmissionField, AllConstants.TEXT, Collections.singletonList(latitude));\n+\n+                formSubmissionField = formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LONGITUDE;\n+                addObs(e, formSubmissionField, AllConstants.TEXT, Collections.singletonList(longitude));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDI4ODU3OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowMzoyNFrOH7xduw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOTowMzoyNFrOH7xduw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzODQ1OQ==", "bodyText": "https://github.com/OpenSRP/opensrp-client-core/pull/705/files#r532438346", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532438459", "createdAt": "2020-11-30T09:03:24Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,45 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {\n+        createObservation(e, jsonObject, value);\n+        if (StringUtils.isNotBlank(value)) {\n+            String[] valueArr = value.split(\" \");\n+            String formSubmissionFieldPrefix = getString(jsonObject, KEY);\n+            if (valueArr.length >= 2) {\n+                String latitude = valueArr[0];\n+                String longitude = valueArr[1];\n+                String formSubmissionField = formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LATITUDE;\n+                addObs(e, formSubmissionField, AllConstants.TEXT, Collections.singletonList(latitude));\n+\n+                formSubmissionField = formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LONGITUDE;\n+                addObs(e, formSubmissionField, AllConstants.TEXT, Collections.singletonList(longitude));\n+\n+                if (valueArr.length >= 4) {\n+                    String altitude = valueArr[2];\n+                    String accuracy = valueArr[3];\n+                    formSubmissionField = formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.ALTITUDE;\n+                    addObs(e, formSubmissionField, AllConstants.TEXT, Collections.singletonList(altitude));\n+\n+                    formSubmissionField = formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.ACCURACY;\n+                    addObs(e, formSubmissionField, AllConstants.TEXT, Collections.singletonList(accuracy));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6880cd75e0584bf39a08277fe9226f0078ec29f"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDk1ODA5OnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo1MDo1NFrOH73rlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo1ODowNFrOH737Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU0MDMxMA==", "bodyText": "These operations : formSubmissionFieldPrefix + \"_\" +, AllConstants.TEXT and Collections.singletonList() are still repeated. I think it's possible to simplify this by passing an event and formSubmissionFieldPrefix and suffix to a method that will perform the duplicated functionality.", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532540310", "createdAt": "2020-11-30T11:50:54Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,38 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {\n+        createObservation(e, jsonObject, value);\n+        if (StringUtils.isNotBlank(value)) {\n+            String[] valueArr = value.split(\" \");\n+            String formSubmissionFieldPrefix = getString(jsonObject, KEY);\n+            if (valueArr.length >= 2) {\n+                String latitude = valueArr[0];\n+                String longitude = valueArr[1];\n+                addObs(e, formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LATITUDE, AllConstants.TEXT, Collections.singletonList(latitude));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29fdc2c345c9ad6debedfa31d0e320b51964e86c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU0NDI4Mw==", "bodyText": "And since the method call would be relatively the same (minus the suffix), an array can be used to store the suffixes and loop through them while making the call.", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532544283", "createdAt": "2020-11-30T11:58:04Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -466,11 +465,38 @@ public static void addObservation(Event e, JSONObject jsonObject) {\n             } catch (JSONException e1) {\n                 Timber.e(e1);\n             }\n+        } else if (AllConstants.GPS.equals(type)) {\n+            createGpsObservation(e, jsonObject, value);\n         } else {\n             createObservation(e, jsonObject, value);\n         }\n     }\n \n+    private static void createGpsObservation(Event e, JSONObject jsonObject, String value) {\n+        createObservation(e, jsonObject, value);\n+        if (StringUtils.isNotBlank(value)) {\n+            String[] valueArr = value.split(\" \");\n+            String formSubmissionFieldPrefix = getString(jsonObject, KEY);\n+            if (valueArr.length >= 2) {\n+                String latitude = valueArr[0];\n+                String longitude = valueArr[1];\n+                addObs(e, formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LATITUDE, AllConstants.TEXT, Collections.singletonList(latitude));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU0MDMxMA=="}, "originalCommit": {"oid": "29fdc2c345c9ad6debedfa31d0e320b51964e86c"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTM3ODYwOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzo0MjoxMFrOH77mdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzo0MjoxMFrOH77mdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwNDUzMw==", "bodyText": "Why not use:\nString[] gpsKeys = new String{AllConstants.GpsConstants.ALTITUDE,...,...};\nfor (int i = 0; i < valueArr; i++) {\n   addGpsObs(e, formSubmissionFieldPrefix, gpsKeys[i], valueArr[i]);\n}\n\nThis removes the need to check for lengths and is a bit more concise.", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532604533", "createdAt": "2020-11-30T13:42:10Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/util/JsonFormUtils.java", "diffHunk": "@@ -480,18 +481,27 @@ private static void createGpsObservation(Event e, JSONObject jsonObject, String\n             if (valueArr.length >= 2) {\n                 String latitude = valueArr[0];\n                 String longitude = valueArr[1];\n-                addObs(e, formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LATITUDE, AllConstants.TEXT, Collections.singletonList(latitude));\n-                addObs(e, formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.LONGITUDE, AllConstants.TEXT, Collections.singletonList(longitude));\n+                addGpsObs(e, formSubmissionFieldPrefix, AllConstants.GpsConstants.LATITUDE, latitude);\n+                addGpsObs(e, formSubmissionFieldPrefix, AllConstants.GpsConstants.LONGITUDE, longitude);\n                 if (valueArr.length >= 4) {\n                     String altitude = valueArr[2];\n                     String accuracy = valueArr[3];\n-                    addObs(e, formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.ALTITUDE, AllConstants.TEXT, Collections.singletonList(altitude));\n-                    addObs(e, formSubmissionFieldPrefix + \"_\" + AllConstants.GpsConstants.ACCURACY, AllConstants.TEXT, Collections.singletonList(accuracy));\n+                    addGpsObs(e, formSubmissionFieldPrefix, AllConstants.GpsConstants.ALTITUDE, altitude);\n+                    addGpsObs(e, formSubmissionFieldPrefix, AllConstants.GpsConstants.ACCURACY, accuracy);\n                 }\n             }\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e780822f2330cbd93fe278b22d7392bdad95a452"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTUzMDEwOnYy", "diffSide": "RIGHT", "path": "opensrp-app/src/test/java/org/smartregister/util/JsonFormUtilsTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoxNjoyOVrOH79B6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoxNjoyOVrOH79B6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYyNzk0NQ==", "bodyText": "This should really be a switch-case.", "url": "https://github.com/opensrp/opensrp-client-core/pull/705#discussion_r532627945", "createdAt": "2020-11-30T14:16:29Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/test/java/org/smartregister/util/JsonFormUtilsTest.java", "diffHunk": "@@ -1472,4 +1473,35 @@ public void testCreateObservationShouldCreateCorrectObservation() throws Excepti\n         assertEquals(values, obs.getValues());\n         assertEquals(keyValPairs, obs.getKeyValPairs());\n     }\n+\n+    @Test\n+    public void addObservationAddsGpsObservationsToEvent() throws Exception {\n+        String observationJsonObjectString =\n+                \"{\\\"value\\\":\\\"-2.4535 37.324 0.2 0.3\\\",\\\"openmrs_entity\\\":\\\"\\\",\" +\n+                        \"\\\"openmrs_entity_id\\\":\\\"\\\",\\\"openmrs_entity_parent\\\":\\\"\\\",\" +\n+                        \"\\\"openmrs_data_type\\\":\\\"text\\\",\\\"type\\\":\\\"gps\\\",\\\"key\\\":\\\"gps\\\"}\";\n+        JSONObject observationJsonObject = new JSONObject(observationJsonObjectString);\n+        Event event = Mockito.spy(new Event());\n+        JsonFormUtils.addObservation(event, observationJsonObject);\n+        Mockito.verify(event, Mockito.times(5)).addObs(any(Obs.class));\n+        String values[] = observationJsonObject.optString(VALUE).split(\" \");\n+        String latitudeKey = observationJsonObject.getString(KEY) + \"_\" + AllConstants.GpsConstants.LATITUDE;\n+        String longitudeKey = observationJsonObject.getString(KEY) + \"_\" + AllConstants.GpsConstants.LONGITUDE;\n+        String altitudeKey = observationJsonObject.getString(KEY) + \"_\" + AllConstants.GpsConstants.ALTITUDE;\n+        String accuracyKey = observationJsonObject.getString(KEY) + \"_\" + AllConstants.GpsConstants.ACCURACY;\n+        List<String> formSubmissionFields = Arrays.asList(latitudeKey, longitudeKey, accuracyKey, altitudeKey, \"gps\");\n+        for (Obs obs : event.getObs()) {\n+            String formSubmissionField = obs.getFormSubmissionField();\n+            assertTrue(formSubmissionFields.contains(formSubmissionField));\n+            if (formSubmissionField.equals(latitudeKey)) {\n+                assertEquals(values[0], obs.getValues().get(0));\n+            } else if (formSubmissionField.equals(longitudeKey)) {\n+                assertEquals(values[1], obs.getValues().get(0));\n+            } else if (formSubmissionField.equals(altitudeKey)) {\n+                assertEquals(values[2], obs.getValues().get(0));\n+            } else if (formSubmissionField.equals(accuracyKey)) {\n+                assertEquals(values[3], obs.getValues().get(0));\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b835d2bc9ff94a867b4cd2e7ee0df3538647ead3"}, "originalPosition": 118}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2136, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}