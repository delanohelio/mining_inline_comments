{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMDg5MTk4", "number": 617, "title": "Remove all instances of Foreign  tables when not required for P2P", "bodyText": "Remove all instances of Foreign  tables when not required for P2P", "createdAt": "2020-08-03T10:20:05Z", "url": "https://github.com/opensrp/opensrp-client-core/pull/617", "merged": true, "mergeCommit": {"oid": "70e0774719091c0f653597792d597eeb8d25ff51"}, "closed": true, "closedAt": "2020-08-03T12:40:10Z", "author": {"login": "rkodev"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7PVZvAH2gAyNDYyMDg5MTk4Ojg4NzQxMGNkOTM5MjdlMDFhM2U2MjMyZTFlMzQ4ODFmY2UwYTVlOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7RMHZAFqTQ1OTk4NTA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "887410cd93927e01a3e6232e1e34881fce0a5e97", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/887410cd93927e01a3e6232e1e34881fce0a5e97", "committedDate": "2020-08-03T10:19:34Z", "message": "Remove all instances of Foreign  tables when not required for P2P"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e30494680507bfdb187ef9131c4432540a7ec996", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/e30494680507bfdb187ef9131c4432540a7ec996", "committedDate": "2020-08-03T10:22:55Z", "message": "Invert push to server checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/90a02ae92d5a136d758a1f295fe835b55f1cd87a", "committedDate": "2020-08-03T10:40:02Z", "message": "Codacy clean up on SyncIntentService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5OTQ0ODIx", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#pullrequestreview-459944821", "createdAt": "2020-08-03T11:15:11Z", "commit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToxNToxMVrOG61m5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToxNToxMVrOG61m5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM0ODkwMA==", "bodyText": "refactor so that CoreLibrary.getInstance().context().hasForeignEvents() is at the start", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#discussion_r464348900", "createdAt": "2020-08-03T11:15:11Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/P2PSenderTransferDao.java", "diffHunk": "@@ -53,10 +53,10 @@ public JsonData getJsonData(@NonNull DataType dataType, long l, int i) {\n         } else if (dataType.getName().equals(task.getName())) {\n             return CoreLibrary.getInstance().context()\n                     .getTaskRepository().getTasks(l, i);\n-        } else if (dataType.getName().equals(foreignClient.getName())) {\n+        } else if (dataType.getName().equals(foreignClient.getName()) && CoreLibrary.getInstance().context().hasForeignEvents()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5OTQ0ODQ2", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#pullrequestreview-459944846", "createdAt": "2020-08-03T11:15:15Z", "commit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToxNToxNVrOG61nAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToxNToxNVrOG61nAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM0ODkyOQ==", "bodyText": "refactor so that CoreLibrary.getInstance().context().hasForeignEvents() is at the start", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#discussion_r464348929", "createdAt": "2020-08-03T11:15:15Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/P2PSenderTransferDao.java", "diffHunk": "@@ -53,10 +53,10 @@ public JsonData getJsonData(@NonNull DataType dataType, long l, int i) {\n         } else if (dataType.getName().equals(task.getName())) {\n             return CoreLibrary.getInstance().context()\n                     .getTaskRepository().getTasks(l, i);\n-        } else if (dataType.getName().equals(foreignClient.getName())) {\n+        } else if (dataType.getName().equals(foreignClient.getName()) && CoreLibrary.getInstance().context().hasForeignEvents()) {\n             return CoreLibrary.getInstance().context()\n                     .getForeignEventClientRepository().getClients(l, i);\n-        } else if (dataType.getName().equals(foreignEvent.getName())) {\n+        } else if (dataType.getName().equals(foreignEvent.getName()) && CoreLibrary.getInstance().context().hasForeignEvents()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5OTQ1Mzc4", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#pullrequestreview-459945378", "createdAt": "2020-08-03T11:16:16Z", "commit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToxNjoxNlrOG61ooQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToxNjoxNlrOG61ooQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM0OTM0NQ==", "bodyText": "could you use CoreLibrary.getInstance().context().hasForeignEvents() for consistency", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#discussion_r464349345", "createdAt": "2020-08-03T11:16:16Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/P2PReceiverTransferDao.java", "diffHunk": "@@ -49,7 +49,7 @@ public long receiveJson(@NonNull DataType dataType, @NonNull JSONArray jsonArray\n         EventClientRepository foreignEventClientRepository = CoreLibrary.getInstance().context().getForeignEventClientRepository();\n \n         int eventsMaxRowId = eventClientRepository.getMaxRowId(eventClientRepository.getEventTable());\n-        int foreignEventsMaxRowId = foreignEventClientRepository.getMaxRowId(foreignEventClientRepository.getEventTable());\n+        int foreignEventsMaxRowId = (getP2PClassifier() == null) ? 0 : foreignEventClientRepository.getMaxRowId(foreignEventClientRepository.getEventTable());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5OTQ3Mjkw", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#pullrequestreview-459947290", "createdAt": "2020-08-03T11:20:01Z", "commit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToyMDowMlrOG61usw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMToyMDowMlrOG61usw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM1MDg5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!CoreLibrary.getInstance().context().hasForeignEvents())\n          \n          \n            \n                        return pushECToServer(CoreLibrary.getInstance().context().getEventClientRepository());\n          \n          \n            \n            \n          \n          \n            \n                    return pushECToServer(CoreLibrary.getInstance().context().getEventClientRepository()) &&\n          \n          \n            \n                            pushECToServer(CoreLibrary.getInstance().context().getForeignEventClientRepository());\n          \n          \n            \n                    return pushECToServer(CoreLibrary.getInstance().context().getEventClientRepository()) &&\n          \n          \n            \n                            (!CoreLibrary.getInstance().context().hasForeignEvents() || pushECToServer(CoreLibrary.getInstance().context().getForeignEventClientRepository()));", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#discussion_r464350899", "createdAt": "2020-08-03T11:20:02Z", "author": {"login": "githengi"}, "path": "opensrp-app/src/main/java/org/smartregister/sync/intent/SyncIntentService.java", "diffHunk": "@@ -229,6 +229,9 @@ protected void processClient(Pair<Long, Long> serverVersionPair) {\n \n     // PUSH TO SERVER\n     private boolean pushToServer() {\n+        if (!CoreLibrary.getInstance().context().hasForeignEvents())\n+            return pushECToServer(CoreLibrary.getInstance().context().getEventClientRepository());\n+\n         return pushECToServer(CoreLibrary.getInstance().context().getEventClientRepository()) &&\n                 pushECToServer(CoreLibrary.getInstance().context().getForeignEventClientRepository());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a02ae92d5a136d758a1f295fe835b55f1cd87a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ba18dbbfae00179af70e80ed39e659a785b2a43", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/7ba18dbbfae00179af70e80ed39e659a785b2a43", "committedDate": "2020-08-03T11:22:26Z", "message": "Update opensrp-app/src/main/java/org/smartregister/sync/intent/SyncIntentService.java\n\nCo-authored-by: Samuel Githengi <samuel.githengi@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d793ccbb11092f082a7a95c4151b39f2b0a7985b", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/d793ccbb11092f082a7a95c4151b39f2b0a7985b", "committedDate": "2020-08-03T11:27:57Z", "message": "Refactor hasForeignEvents check for consistency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5OTU2ODk5", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#pullrequestreview-459956899", "createdAt": "2020-08-03T11:38:37Z", "commit": {"oid": "d793ccbb11092f082a7a95c4151b39f2b0a7985b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f79ac58744061a77c07b1d93f4410294a5175128", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/f79ac58744061a77c07b1d93f4410294a5175128", "committedDate": "2020-08-03T12:01:22Z", "message": "Fix NPE on tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5OTg1MDYz", "url": "https://github.com/opensrp/opensrp-client-core/pull/617#pullrequestreview-459985063", "createdAt": "2020-08-03T12:29:14Z", "commit": {"oid": "f79ac58744061a77c07b1d93f4410294a5175128"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2470, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}