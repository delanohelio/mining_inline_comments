{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwODU3MTQ2", "number": 418, "title": "Add a function to confirm a plan exists for a jurisdiction", "bodyText": "Resolves #417", "createdAt": "2020-02-04T14:07:57Z", "url": "https://github.com/opensrp/opensrp-client-core/pull/418", "merged": true, "mergeCommit": {"oid": "c9e05742923f81340b70e8ef63d5f2b66bef0a93"}, "closed": true, "closedAt": "2020-02-04T14:54:27Z", "author": {"login": "githengi"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBCDHOgH2gAyMzcwODU3MTQ2OmE3YTNlMTIzZDU5OTgyZDc2OTM0YzQxYWYyNjQwMjQ3ZmQ2NmRkNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBConngFqTM1MzAyOTQxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7a3e123d59982d76934c41af2640247fd66dd77", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/a7a3e123d59982d76934c41af2640247fd66dd77", "committedDate": "2020-02-04T14:03:13Z", "message": "Add a function to confirm a plan exists for a jurisdiction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDA3NzEy", "url": "https://github.com/opensrp/opensrp-client-core/pull/418#pullrequestreview-353007712", "createdAt": "2020-02-04T14:17:08Z", "commit": {"oid": "a7a3e123d59982d76934c41af2640247fd66dd77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDoxNzo0OVrOFlVl0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDoxNzo0OVrOFlVl0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY5NTM3Nw==", "bodyText": "Simply return cursor.moveToFirst()?", "url": "https://github.com/opensrp/opensrp-client-core/pull/418#discussion_r374695377", "createdAt": "2020-02-04T14:17:49Z", "author": {"login": "vincent-karuri"}, "path": "opensrp-app/src/main/java/org/smartregister/repository/PlanDefinitionSearchRepository.java", "diffHunk": "@@ -86,6 +86,27 @@ public void addOrUpdate(PlanDefinition planDefinition, String jurisdiction) {\n         return getPlanDefinitionRepository().findPlanDefinitionByIds(planIds);\n     }\n \n+    public boolean planExists(String planId, String jurisdictionId) {\n+\n+        Cursor cursor = null;\n+        try {\n+            String query = String.format(\"SELECT %s FROM %s \" +\n+                            \"WHERE %s=? AND %s=? AND %s=?  AND %s  >=? \", PLAN_ID,\n+                    PLAN_DEFINITION_SEARCH_TABLE, PLAN_ID, JURISDICTION_ID, STATUS, END);\n+            cursor = getReadableDatabase().rawQuery(query, new String[]{planId, jurisdictionId, ACTIVE,\n+                    String.valueOf(LocalDate.now().toDate().getTime())});\n+            if (cursor.moveToFirst()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7a3e123d59982d76934c41af2640247fd66dd77"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f67e2d57ef63043aaefd80b0bd4529a128877944", "author": {"user": {"login": "githengi", "name": "Samuel Githengi"}}, "url": "https://github.com/opensrp/opensrp-client-core/commit/f67e2d57ef63043aaefd80b0bd4529a128877944", "committedDate": "2020-02-04T14:21:39Z", "message": "code cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDI5NDEx", "url": "https://github.com/opensrp/opensrp-client-core/pull/418#pullrequestreview-353029411", "createdAt": "2020-02-04T14:44:11Z", "commit": {"oid": "f67e2d57ef63043aaefd80b0bd4529a128877944"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2602, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}