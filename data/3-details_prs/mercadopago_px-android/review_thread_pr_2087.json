{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MDE2NzA3", "number": 2087, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozMDo0MlrODt9B2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0OToyM1rODt9lCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTEyNDExOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutPresenter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozMDo0MlrOF_rR8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDo0ODoxM1rOF_u5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMzcxNQ==", "bodyText": "Se van a terminar usando estos override?", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402313715", "createdAt": "2020-04-02T13:30:42Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutPresenter.java", "diffHunk": "@@ -439,6 +438,11 @@ public void driveToShowPaymentMethodSelection() {\n             });\n     }\n \n+    @Override\n+    public void onUserValidation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM3MjkxNw==", "bodyText": "Es una interfaz que se implementa en todos los puntos donde se espera una respuesta de la congrats, yo solo lo necesito en el fragment del bot\u00f3n de pagar.", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402372917", "createdAt": "2020-04-02T14:48:13Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutPresenter.java", "diffHunk": "@@ -439,6 +438,11 @@ public void driveToShowPaymentMethodSelection() {\n             });\n     }\n \n+    @Override\n+    public void onUserValidation() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMzcxNQ=="}, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTEzOTc2OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesBodyMapper.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozNDowMFrOF_rbYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozNDowMFrOF_rbYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxNjEyOQ==", "bodyText": "Ac\u00e1 tratar\u00eda de usar el with(data).", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402316129", "createdAt": "2020-04-02T13:34:00Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesBodyMapper.kt", "diffHunk": "@@ -1,18 +1,19 @@\n package com.mercadopago.android.px.internal.features.payment_result.remedies\n \n+import com.mercadopago.android.px.internal.repository.UserSelectionRepository\n import com.mercadopago.android.px.internal.viewmodel.mappers.Mapper\n-import com.mercadopago.android.px.model.Card\n-import com.mercadopago.android.px.model.PayerCost\n+import com.mercadopago.android.px.model.PaymentData\n import com.mercadopago.android.px.model.internal.remedies.PayerPaymentMethodRejected\n import com.mercadopago.android.px.model.internal.remedies.RemediesBody\n \n-internal class RemediesBodyMapper : Mapper<Pair<Card, PayerCost>, RemediesBody>() {\n+internal class RemediesBodyMapper(private val userSelectionRepository: UserSelectionRepository)\n+    : Mapper<PaymentData, RemediesBody>() {\n \n-    override fun map(cardAndPayerCost: Pair<Card, PayerCost>): RemediesBody {\n-        val (card, payerCost) = cardAndPayerCost\n-        val payerPaymentMethodRejected = PayerPaymentMethodRejected(payerCost.installments,\n-            card.issuer?.name ?: \"\", card.lastFourDigits.orEmpty(), card.paymentMethod.id, card.securityCodeLength,\n-            card.securityCodeLocation, payerCost.totalAmount)\n+    override fun map(data: PaymentData): RemediesBody {\n+        val securityCodeLocation = userSelectionRepository.card?.securityCodeLocation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTE5MTA3OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/view/PaymentResultFooter.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NDozNlrOF_r6QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NDozNlrOF_r6QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNDAzMw==", "bodyText": "Por que usamos View.inflate()?", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402324033", "createdAt": "2020-04-02T13:44:36Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/view/PaymentResultFooter.kt", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.mercadopago.android.px.internal.features.payment_result.remedies.view\n+\n+import android.content.Context\n+import android.os.Parcel\n+import android.os.Parcelable\n+import android.support.v4.content.ContextCompat\n+import android.util.AttributeSet\n+import android.view.View\n+import android.widget.LinearLayout\n+import com.mercadolibre.android.ui.widgets.MeliButton\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.features.payment_result.remedies.RemedyButton\n+\n+internal class PaymentResultFooter(context: Context, attrs: AttributeSet?, defStyleAttr: Int) :\n+    LinearLayout(context, attrs, defStyleAttr) {\n+\n+    init {\n+        configureView(context)\n+    }\n+\n+    constructor(context: Context, attrs: AttributeSet?) : this(context, attrs, 0)\n+    constructor(context: Context) : this(context, null)\n+\n+    private lateinit var loudButton: MeliButton\n+    private lateinit var quietButton: MeliButton\n+    private lateinit var payButtonContainer: View\n+\n+    private fun configureView(context: Context) {\n+        orientation = VERTICAL\n+        View.inflate(context, R.layout.px_payment_result_footer, this)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTE5ODg3OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/view/PaymentResultFooter.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NjoxNVrOF_r_AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NjoxNVrOF_r_AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNTI0OA==", "bodyText": "ac\u00e1 podes usar el with(button)", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402325248", "createdAt": "2020-04-02T13:46:15Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/view/PaymentResultFooter.kt", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.mercadopago.android.px.internal.features.payment_result.remedies.view\n+\n+import android.content.Context\n+import android.os.Parcel\n+import android.os.Parcelable\n+import android.support.v4.content.ContextCompat\n+import android.util.AttributeSet\n+import android.view.View\n+import android.widget.LinearLayout\n+import com.mercadolibre.android.ui.widgets.MeliButton\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.features.payment_result.remedies.RemedyButton\n+\n+internal class PaymentResultFooter(context: Context, attrs: AttributeSet?, defStyleAttr: Int) :\n+    LinearLayout(context, attrs, defStyleAttr) {\n+\n+    init {\n+        configureView(context)\n+    }\n+\n+    constructor(context: Context, attrs: AttributeSet?) : this(context, attrs, 0)\n+    constructor(context: Context) : this(context, null)\n+\n+    private lateinit var loudButton: MeliButton\n+    private lateinit var quietButton: MeliButton\n+    private lateinit var payButtonContainer: View\n+\n+    private fun configureView(context: Context) {\n+        orientation = VERTICAL\n+        View.inflate(context, R.layout.px_payment_result_footer, this)\n+        loudButton = findViewById(R.id.action_loud)\n+        quietButton = findViewById<MeliButton>(R.id.action_quiet).apply {\n+            background = ContextCompat.getDrawable(context, R.drawable.px_quiet_button_selector)\n+            text = resources.getString(R.string.px_change_payment)\n+        }\n+        payButtonContainer = findViewById(R.id.pay_button)\n+    }\n+\n+    fun init(model: Model, listener: Listener) {\n+        applyButtonConfig(loudButton, model.loudButton, listener::onLoudButtonClicked)\n+        applyButtonConfig(quietButton, model.quietButton, listener::onQuietButtonClicked)\n+        payButtonContainer.visibility = if (model.showPayButton) View.VISIBLE else View.GONE\n+    }\n+\n+    private fun applyButtonConfig(button: MeliButton, buttonModel: RemedyButton?,\n+        listener: (action: RemedyButton.Action) -> Unit) {\n+        buttonModel?.let {model ->\n+            button.visibility = View.VISIBLE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTIwMzgxOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesViewModel.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0NzoxN1rOF_sB_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDo0OToxM1rOF_u8bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNjAxMg==", "bodyText": "Que es esto de TODO()?", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402326012", "createdAt": "2020-04-02T13:47:17Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesViewModel.kt", "diffHunk": "@@ -69,6 +73,16 @@ internal class RemediesViewModel(\n             })\n     }\n \n+    override fun onButtonPressed(action: RemedyButton.Action) {\n+        when(action) {\n+            RemedyButton.Action.CHANGE_PM -> remedyState.value = RemedyState.ChangePaymentMethod\n+            RemedyButton.Action.KYC -> remediesModel.highRiskRemedyModel?.let {\n+                remedyState.value = RemedyState.GoToKyc(it.deepLink)\n+            }\n+            else -> TODO()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM3Mzc0MQ==", "bodyText": "Una funci\u00f3n falopa de Kotlin que descubr\u00ed el otro d\u00eda sin querer, que es como el comentario de TODO pero encima crashea (?)", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402373741", "createdAt": "2020-04-02T14:49:13Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesViewModel.kt", "diffHunk": "@@ -69,6 +73,16 @@ internal class RemediesViewModel(\n             })\n     }\n \n+    override fun onButtonPressed(action: RemedyButton.Action) {\n+        when(action) {\n+            RemedyButton.Action.CHANGE_PM -> remedyState.value = RemedyState.ChangePaymentMethod\n+            RemedyButton.Action.KYC -> remediesModel.highRiskRemedyModel?.let {\n+                remedyState.value = RemedyState.GoToKyc(it.deepLink)\n+            }\n+            else -> TODO()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNjAxMg=="}, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTIxNDE5OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesBodyMapper.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0OToyM1rOF_sIQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDo1MDoyNVrOF_vAPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNzYxNg==", "bodyText": "ac\u00e1 podemos usar el with(data)", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402327616", "createdAt": "2020-04-02T13:49:23Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesBodyMapper.kt", "diffHunk": "@@ -1,18 +1,19 @@\n package com.mercadopago.android.px.internal.features.payment_result.remedies\n \n+import com.mercadopago.android.px.internal.repository.UserSelectionRepository\n import com.mercadopago.android.px.internal.viewmodel.mappers.Mapper\n-import com.mercadopago.android.px.model.Card\n-import com.mercadopago.android.px.model.PayerCost\n+import com.mercadopago.android.px.model.PaymentData\n import com.mercadopago.android.px.model.internal.remedies.PayerPaymentMethodRejected\n import com.mercadopago.android.px.model.internal.remedies.RemediesBody\n \n-internal class RemediesBodyMapper : Mapper<Pair<Card, PayerCost>, RemediesBody>() {\n+internal class RemediesBodyMapper(private val userSelectionRepository: UserSelectionRepository)\n+    : Mapper<PaymentData, RemediesBody>() {\n \n-    override fun map(cardAndPayerCost: Pair<Card, PayerCost>): RemediesBody {\n-        val (card, payerCost) = cardAndPayerCost\n-        val payerPaymentMethodRejected = PayerPaymentMethodRejected(payerCost.installments,\n-            card.issuer?.name ?: \"\", card.lastFourDigits.orEmpty(), card.paymentMethod.id, card.securityCodeLength,\n-            card.securityCodeLocation, payerCost.totalAmount)\n+    override fun map(data: PaymentData): RemediesBody {\n+        val securityCodeLocation = userSelectionRepository.card?.securityCodeLocation\n+        val payerPaymentMethodRejected = PayerPaymentMethodRejected(data.payerCost?.installments,\n+            data.issuer?.name, data.token?.lastFourDigits, data.paymentMethod.id, data.paymentMethod.paymentTypeId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM3NDcxNg==", "bodyText": "Ten\u00e9s raz\u00f3n, no lo tengo muy en cuenta el with", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402374716", "createdAt": "2020-04-02T14:50:25Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesBodyMapper.kt", "diffHunk": "@@ -1,18 +1,19 @@\n package com.mercadopago.android.px.internal.features.payment_result.remedies\n \n+import com.mercadopago.android.px.internal.repository.UserSelectionRepository\n import com.mercadopago.android.px.internal.viewmodel.mappers.Mapper\n-import com.mercadopago.android.px.model.Card\n-import com.mercadopago.android.px.model.PayerCost\n+import com.mercadopago.android.px.model.PaymentData\n import com.mercadopago.android.px.model.internal.remedies.PayerPaymentMethodRejected\n import com.mercadopago.android.px.model.internal.remedies.RemediesBody\n \n-internal class RemediesBodyMapper : Mapper<Pair<Card, PayerCost>, RemediesBody>() {\n+internal class RemediesBodyMapper(private val userSelectionRepository: UserSelectionRepository)\n+    : Mapper<PaymentData, RemediesBody>() {\n \n-    override fun map(cardAndPayerCost: Pair<Card, PayerCost>): RemediesBody {\n-        val (card, payerCost) = cardAndPayerCost\n-        val payerPaymentMethodRejected = PayerPaymentMethodRejected(payerCost.installments,\n-            card.issuer?.name ?: \"\", card.lastFourDigits.orEmpty(), card.paymentMethod.id, card.securityCodeLength,\n-            card.securityCodeLocation, payerCost.totalAmount)\n+    override fun map(data: PaymentData): RemediesBody {\n+        val securityCodeLocation = userSelectionRepository.card?.securityCodeLocation\n+        val payerPaymentMethodRejected = PayerPaymentMethodRejected(data.payerCost?.installments,\n+            data.issuer?.name, data.token?.lastFourDigits, data.paymentMethod.id, data.paymentMethod.paymentTypeId,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNzYxNg=="}, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1671, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}