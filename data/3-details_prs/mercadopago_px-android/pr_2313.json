{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4OTU1NDM2", "number": 2313, "title": "[Feature] payment logic", "bodyText": "Motivaci\u00f3n y Contexto\nMaquetado de pantalla de cvv y l\u00f3gica de pago\nDescripci\u00f3n\n\nC\u00f3mo probarlo\n\n\nScreenshots\n\n\nTipo de cambio (para el release manager)\n\n Breaking change (Fix o feature que cambia una funcionalidad existente o rompe firmas)\n\n\n\n Mi cambio afecta a los integradores internos\n\n\nCompartir conocimiento", "createdAt": "2020-09-03T20:58:40Z", "url": "https://github.com/mercadopago/px-android/pull/2313", "merged": true, "mergeCommit": {"oid": "9d1876cdd425f30b1a25525b3f0ba64df5964aa0"}, "closed": true, "closedAt": "2020-09-10T13:27:56Z", "author": {"login": "jorGonzalez291292"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBvTzuAH2gAyNDc4OTU1NDM2OjI4YzJlNGZhYzkwZWQ1OTYxOTNiN2UxYWQ5NWE0MTNiNzk2NDFjYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHgHvFgFqTQ4NTg4NTY3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28c2e4fac90ed596193b7e1ad95a413b79641cb0", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/28c2e4fac90ed596193b7e1ad95a413b79641cb0", "committedDate": "2020-08-23T14:58:20Z", "message": "init feature branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82cb7b8cd4fb64f9e42d40854d85f880956dbd74", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/82cb7b8cd4fb64f9e42d40854d85f880956dbd74", "committedDate": "2020-08-31T11:50:47Z", "message": "security code fragment added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "769960d27b06ddae9581551b4e069398c5284144", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/769960d27b06ddae9581551b4e069398c5284144", "committedDate": "2020-08-31T11:53:03Z", "message": "Merge branch 'master' of github.com:mercadopago/px-android into feature/new-cvv-screen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be68dd58df70ccf5317ebf1bb4786fdf0b6b5d84", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/be68dd58df70ccf5317ebf1bb4786fdf0b6b5d84", "committedDate": "2020-09-01T14:41:35Z", "message": "viewmodel created"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c31e23d507d035c82f47793415037217608fc2e", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/3c31e23d507d035c82f47793415037217608fc2e", "committedDate": "2020-09-02T14:01:59Z", "message": "paylogic added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2007e41be0c724b30b7550dec14057d61fdecdfc", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/2007e41be0c724b30b7550dec14057d61fdecdfc", "committedDate": "2020-09-03T18:19:21Z", "message": "paylogic with paymentrecovery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "471a31738d0a9703820dcc597593098865e62692", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/471a31738d0a9703820dcc597593098865e62692", "committedDate": "2020-09-03T19:22:44Z", "message": "refactor ciew model factory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a848d10f0e21412eca04d4c0b10853577b844a1", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/5a848d10f0e21412eca04d4c0b10853577b844a1", "committedDate": "2020-09-03T19:45:28Z", "message": "merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0736150868f79f236616c9470832693fe6adcf0", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/f0736150868f79f236616c9470832693fe6adcf0", "committedDate": "2020-09-03T20:19:25Z", "message": "revert change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "686ebe01c123c898fa30c34f39fd22c77afb4ed5", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/686ebe01c123c898fa30c34f39fd22c77afb4ed5", "committedDate": "2020-09-03T20:22:04Z", "message": "revert change in samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c7fbb5ac3c2468e0cfc3c8c4fc6e26658e27dfe", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/4c7fbb5ac3c2468e0cfc3c8c4fc6e26658e27dfe", "committedDate": "2020-09-03T20:57:11Z", "message": "refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11ac243d0c1a1d5cff982a0e2c7ff4cc0a359709", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/11ac243d0c1a1d5cff982a0e2c7ff4cc0a359709", "committedDate": "2020-09-03T21:51:29Z", "message": "review changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10dc1e18846efee072bcb12b79242503eb2342a1", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/10dc1e18846efee072bcb12b79242503eb2342a1", "committedDate": "2020-09-04T17:37:56Z", "message": "add resource string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b22ca7591720cddcbf84ac98614fa3c1937bfa4", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/7b22ca7591720cddcbf84ac98614fa3c1937bfa4", "committedDate": "2020-09-04T18:06:13Z", "message": "translation resource added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/7c869ba4448f9fa02996a04359baa6ab6cde7922", "committedDate": "2020-09-04T18:58:59Z", "message": "test fixed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzEyMzk4", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-483712398", "createdAt": "2020-09-07T21:28:59Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMToyODo1OVrOHOH0RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMToyODo1OVrOHOH0RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU3MDE4MQ==", "bodyText": "Qu\u00e9 es este espacio??", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r484570181", "createdAt": "2020-09-07T21:28:59Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/pay_button/PayButtonFragment.kt", "diffHunk": "@@ -78,9 +75,9 @@ class PayButtonFragment : Fragment(), PayButton.View, SecurityValidationHandler\n             buttonTextLiveData.observe(viewLifecycleOwner,\n                 Observer { buttonConfig -> button.text = buttonConfig!!.getButtonText(this@PayButtonFragment.context!!) })\n             cvvRequiredLiveData.observe(viewLifecycleOwner,\n-                Observer { pair -> pair?.let { showSecurityCodeScreen(it.first, it.second) } })\n+                    Observer { pair -> pair?.let { showSecurityCodeScreen(newInstance(it.first, it.second)) } })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzEyNTkx", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-483712591", "createdAt": "2020-09-07T21:30:25Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMTozMDoyNVrOHOH1OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMTozMDoyNVrOHOH1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU3MDQyNA==", "bodyText": "Saquemos el import est\u00e1tico porque necesito contexto (?)", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r484570424", "createdAt": "2020-09-07T21:30:25Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/pay_button/PayButtonFragment.kt", "diffHunk": "@@ -78,9 +75,9 @@ class PayButtonFragment : Fragment(), PayButton.View, SecurityValidationHandler\n             buttonTextLiveData.observe(viewLifecycleOwner,\n                 Observer { buttonConfig -> button.text = buttonConfig!!.getButtonText(this@PayButtonFragment.context!!) })\n             cvvRequiredLiveData.observe(viewLifecycleOwner,\n-                Observer { pair -> pair?.let { showSecurityCodeScreen(it.first, it.second) } })\n+                    Observer { pair -> pair?.let { showSecurityCodeScreen(newInstance(it.first, it.second)) } })\n             recoverRequiredLiveData.observe(viewLifecycleOwner,\n-                Observer { recovery -> recovery?.let { showSecurityCodeForRecovery(it) } })\n+                Observer { pair -> pair?.let { showSecurityCodeScreen(newInstance(it.first, it.second)) } })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDAzNDM5", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-484403439", "createdAt": "2020-09-08T18:45:00Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODo0NTowMVrOHOppeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODo0NTowMVrOHOppeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEyNDQ3NA==", "bodyText": "Yo esto lo har\u00eda en la integraci\u00f3n, es algo espec\u00edfico para la pantalla de cvv", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485124474", "createdAt": "2020-09-08T18:45:01Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/pay_button/PayButtonFragment.kt", "diffHunk": "@@ -186,6 +178,7 @@ class PayButtonFragment : Fragment(), PayButton.View, SecurityValidationHandler\n     }\n \n     private fun finishLoading(params: ExplodeDecorator) {\n+        ViewUtils.hideKeyboard(activity)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDE4MjA5", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-484418209", "createdAt": "2020-09-08T19:06:55Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTowNjo1NVrOHOqX8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTowNjo1NVrOHOqX8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEzNjM3MQ==", "bodyText": "Mandale as? para que sea safe", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485136371", "createdAt": "2020-09-08T19:06:55Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/SecurityCodeFragment.kt", "diffHunk": "@@ -0,0 +1,142 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import android.os.Bundle\n+import android.text.InputFilter\n+import android.text.InputFilter.LengthFilter\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.View.GONE\n+import android.view.View.VISIBLE\n+import android.view.ViewGroup\n+import android.widget.EditText\n+import android.widget.TextView\n+import androidx.appcompat.app.AppCompatActivity\n+import androidx.appcompat.widget.Toolbar\n+import androidx.fragment.app.Fragment\n+import com.meli.android.carddrawer.model.CardDrawerView\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.core.BackHandler\n+import com.mercadopago.android.px.internal.di.viewModel\n+import com.mercadopago.android.px.internal.features.pay_button.PayButton\n+import com.mercadopago.android.px.internal.features.pay_button.PayButtonFragment\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.util.nonNullObserve\n+import com.mercadopago.android.px.model.PaymentRecovery\n+import com.mercadopago.android.px.model.internal.PaymentConfiguration\n+import com.mercadopago.android.px.tracking.internal.model.Reason\n+\n+\n+internal class SecurityCodeFragment : Fragment(), PayButton.Handler, BackHandler {\n+\n+    private val securityCodeViewModel: SecurityCodeViewModel by viewModel()\n+\n+    private lateinit var cardDrawer: CardDrawerView\n+    private lateinit var cvvEditText: EditText\n+    private lateinit var cvvTitle: TextView\n+    private lateinit var cvvSubtitle: TextView\n+    private lateinit var payButtonFragment: PayButtonFragment\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+        savedInstanceState: Bundle?): View? {\n+        return inflater.inflate(R.layout.fragment_security_code, container, false)\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        (activity as AppCompatActivity?)?.apply {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDM3NDQy", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-484437442", "createdAt": "2020-09-08T19:37:17Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTozNzoxN1rOHOrUUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTozNzoxN1rOHOrUUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE1MTgyNw==", "bodyText": "Estos observe hay que llevarlos al onViewCreated porque ac\u00e1 est\u00e1s agregando observers consecutivos para cada resume de la pantalla", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485151827", "createdAt": "2020-09-08T19:37:17Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/SecurityCodeFragment.kt", "diffHunk": "@@ -0,0 +1,142 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import android.os.Bundle\n+import android.text.InputFilter\n+import android.text.InputFilter.LengthFilter\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.View.GONE\n+import android.view.View.VISIBLE\n+import android.view.ViewGroup\n+import android.widget.EditText\n+import android.widget.TextView\n+import androidx.appcompat.app.AppCompatActivity\n+import androidx.appcompat.widget.Toolbar\n+import androidx.fragment.app.Fragment\n+import com.meli.android.carddrawer.model.CardDrawerView\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.core.BackHandler\n+import com.mercadopago.android.px.internal.di.viewModel\n+import com.mercadopago.android.px.internal.features.pay_button.PayButton\n+import com.mercadopago.android.px.internal.features.pay_button.PayButtonFragment\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.util.nonNullObserve\n+import com.mercadopago.android.px.model.PaymentRecovery\n+import com.mercadopago.android.px.model.internal.PaymentConfiguration\n+import com.mercadopago.android.px.tracking.internal.model.Reason\n+\n+\n+internal class SecurityCodeFragment : Fragment(), PayButton.Handler, BackHandler {\n+\n+    private val securityCodeViewModel: SecurityCodeViewModel by viewModel()\n+\n+    private lateinit var cardDrawer: CardDrawerView\n+    private lateinit var cvvEditText: EditText\n+    private lateinit var cvvTitle: TextView\n+    private lateinit var cvvSubtitle: TextView\n+    private lateinit var payButtonFragment: PayButtonFragment\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+        savedInstanceState: Bundle?): View? {\n+        return inflater.inflate(R.layout.fragment_security_code, container, false)\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        (activity as AppCompatActivity?)?.apply {\n+            view.findViewById<Toolbar>(R.id.cvv_toolbar)?.also { toolbar ->\n+                setSupportActionBar(toolbar)\n+                supportActionBar?.apply {\n+                    setDisplayShowTitleEnabled(false)\n+                    setDisplayHomeAsUpEnabled(true)\n+                    setDisplayShowHomeEnabled(true)\n+                    setHomeButtonEnabled(true)\n+                    toolbar.setNavigationOnClickListener { onBackPressed() }\n+                }\n+            }\n+        }\n+\n+        cardDrawer = view.findViewById(R.id.card_drawer)\n+        cvvEditText = view.findViewById(R.id.cvv_edit_text)\n+        cvvTitle = view.findViewById(R.id.cvv_title)\n+        cvvSubtitle = view.findViewById(R.id.cvv_subtitle)\n+        ViewUtils.openKeyboard(cvvEditText)\n+\n+        arguments?.apply {\n+\n+            check(\n+                containsKey(PAYMENT_RECOVERY_EXTRA) || containsKey(PAYMENT_CONFIGURATION_EXTRA) && containsKey(REASON_EXTRA))\n+\n+            securityCodeViewModel.init(\n+                getParcelable(PAYMENT_CONFIGURATION_EXTRA)!!,\n+                getParcelable(PAYMENT_RECOVERY_EXTRA),\n+                getString(REASON_EXTRA)?.let { Reason.valueOf(it) })\n+\n+        } ?: error(\"\")\n+\n+        payButtonFragment = childFragmentManager.findFragmentById(R.id.pay_button) as PayButtonFragment\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        with(securityCodeViewModel) {\n+            cvvCardUiLiveData.nonNullObserve(viewLifecycleOwner) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDM3ODcx", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-484437871", "createdAt": "2020-09-08T19:38:00Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTozODowMFrOHOrVuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTozODowMFrOHOrVuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE1MjE4NA==", "bodyText": "Por qu\u00e9 no solamente handlePrepayment(callback)?", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485152184", "createdAt": "2020-09-08T19:38:00Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/SecurityCodeFragment.kt", "diffHunk": "@@ -0,0 +1,142 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import android.os.Bundle\n+import android.text.InputFilter\n+import android.text.InputFilter.LengthFilter\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.View.GONE\n+import android.view.View.VISIBLE\n+import android.view.ViewGroup\n+import android.widget.EditText\n+import android.widget.TextView\n+import androidx.appcompat.app.AppCompatActivity\n+import androidx.appcompat.widget.Toolbar\n+import androidx.fragment.app.Fragment\n+import com.meli.android.carddrawer.model.CardDrawerView\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.core.BackHandler\n+import com.mercadopago.android.px.internal.di.viewModel\n+import com.mercadopago.android.px.internal.features.pay_button.PayButton\n+import com.mercadopago.android.px.internal.features.pay_button.PayButtonFragment\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.util.nonNullObserve\n+import com.mercadopago.android.px.model.PaymentRecovery\n+import com.mercadopago.android.px.model.internal.PaymentConfiguration\n+import com.mercadopago.android.px.tracking.internal.model.Reason\n+\n+\n+internal class SecurityCodeFragment : Fragment(), PayButton.Handler, BackHandler {\n+\n+    private val securityCodeViewModel: SecurityCodeViewModel by viewModel()\n+\n+    private lateinit var cardDrawer: CardDrawerView\n+    private lateinit var cvvEditText: EditText\n+    private lateinit var cvvTitle: TextView\n+    private lateinit var cvvSubtitle: TextView\n+    private lateinit var payButtonFragment: PayButtonFragment\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+        savedInstanceState: Bundle?): View? {\n+        return inflater.inflate(R.layout.fragment_security_code, container, false)\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        (activity as AppCompatActivity?)?.apply {\n+            view.findViewById<Toolbar>(R.id.cvv_toolbar)?.also { toolbar ->\n+                setSupportActionBar(toolbar)\n+                supportActionBar?.apply {\n+                    setDisplayShowTitleEnabled(false)\n+                    setDisplayHomeAsUpEnabled(true)\n+                    setDisplayShowHomeEnabled(true)\n+                    setHomeButtonEnabled(true)\n+                    toolbar.setNavigationOnClickListener { onBackPressed() }\n+                }\n+            }\n+        }\n+\n+        cardDrawer = view.findViewById(R.id.card_drawer)\n+        cvvEditText = view.findViewById(R.id.cvv_edit_text)\n+        cvvTitle = view.findViewById(R.id.cvv_title)\n+        cvvSubtitle = view.findViewById(R.id.cvv_subtitle)\n+        ViewUtils.openKeyboard(cvvEditText)\n+\n+        arguments?.apply {\n+\n+            check(\n+                containsKey(PAYMENT_RECOVERY_EXTRA) || containsKey(PAYMENT_CONFIGURATION_EXTRA) && containsKey(REASON_EXTRA))\n+\n+            securityCodeViewModel.init(\n+                getParcelable(PAYMENT_CONFIGURATION_EXTRA)!!,\n+                getParcelable(PAYMENT_RECOVERY_EXTRA),\n+                getString(REASON_EXTRA)?.let { Reason.valueOf(it) })\n+\n+        } ?: error(\"\")\n+\n+        payButtonFragment = childFragmentManager.findFragmentById(R.id.pay_button) as PayButtonFragment\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        with(securityCodeViewModel) {\n+            cvvCardUiLiveData.nonNullObserve(viewLifecycleOwner) {\n+                with(cardDrawer) {\n+                    card.name = it.name\n+                    card.expiration = it.date\n+                    card.number = it.number\n+                    show(it)\n+                }\n+            }\n+\n+            virtualCardInfoLiveData.nonNullObserve(viewLifecycleOwner) {\n+                cardDrawer.visibility = GONE\n+                cvvTitle.text = it.title\n+                with(cvvSubtitle) {\n+                    text = it.message\n+                    visibility = VISIBLE\n+                }\n+            }\n+\n+            inputInfoLiveData.nonNullObserve(viewLifecycleOwner) {\n+                cvvEditText.filters = arrayOf<InputFilter>(LengthFilter(it))\n+            }\n+        }\n+    }\n+\n+    override fun prePayment(callback: PayButton.OnReadyForPaymentCallback) {\n+        securityCodeViewModel.handlePrePaymentFinished(callback)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDM4NDA3", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-484438407", "createdAt": "2020-09-08T19:38:52Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTozODo1MlrOHOrXZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTozODo1MlrOHOrXZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE1MjYxNA==", "bodyText": "A estos, por convenci\u00f3n, les ponemos el extra adelante para que queden agrupados.\nSer\u00eda EXTRA_PAYMENT_CONFIGURATION y as\u00ed", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485152614", "createdAt": "2020-09-08T19:38:52Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/SecurityCodeFragment.kt", "diffHunk": "@@ -0,0 +1,142 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import android.os.Bundle\n+import android.text.InputFilter\n+import android.text.InputFilter.LengthFilter\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.View.GONE\n+import android.view.View.VISIBLE\n+import android.view.ViewGroup\n+import android.widget.EditText\n+import android.widget.TextView\n+import androidx.appcompat.app.AppCompatActivity\n+import androidx.appcompat.widget.Toolbar\n+import androidx.fragment.app.Fragment\n+import com.meli.android.carddrawer.model.CardDrawerView\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.core.BackHandler\n+import com.mercadopago.android.px.internal.di.viewModel\n+import com.mercadopago.android.px.internal.features.pay_button.PayButton\n+import com.mercadopago.android.px.internal.features.pay_button.PayButtonFragment\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.util.nonNullObserve\n+import com.mercadopago.android.px.model.PaymentRecovery\n+import com.mercadopago.android.px.model.internal.PaymentConfiguration\n+import com.mercadopago.android.px.tracking.internal.model.Reason\n+\n+\n+internal class SecurityCodeFragment : Fragment(), PayButton.Handler, BackHandler {\n+\n+    private val securityCodeViewModel: SecurityCodeViewModel by viewModel()\n+\n+    private lateinit var cardDrawer: CardDrawerView\n+    private lateinit var cvvEditText: EditText\n+    private lateinit var cvvTitle: TextView\n+    private lateinit var cvvSubtitle: TextView\n+    private lateinit var payButtonFragment: PayButtonFragment\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+        savedInstanceState: Bundle?): View? {\n+        return inflater.inflate(R.layout.fragment_security_code, container, false)\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        (activity as AppCompatActivity?)?.apply {\n+            view.findViewById<Toolbar>(R.id.cvv_toolbar)?.also { toolbar ->\n+                setSupportActionBar(toolbar)\n+                supportActionBar?.apply {\n+                    setDisplayShowTitleEnabled(false)\n+                    setDisplayHomeAsUpEnabled(true)\n+                    setDisplayShowHomeEnabled(true)\n+                    setHomeButtonEnabled(true)\n+                    toolbar.setNavigationOnClickListener { onBackPressed() }\n+                }\n+            }\n+        }\n+\n+        cardDrawer = view.findViewById(R.id.card_drawer)\n+        cvvEditText = view.findViewById(R.id.cvv_edit_text)\n+        cvvTitle = view.findViewById(R.id.cvv_title)\n+        cvvSubtitle = view.findViewById(R.id.cvv_subtitle)\n+        ViewUtils.openKeyboard(cvvEditText)\n+\n+        arguments?.apply {\n+\n+            check(\n+                containsKey(PAYMENT_RECOVERY_EXTRA) || containsKey(PAYMENT_CONFIGURATION_EXTRA) && containsKey(REASON_EXTRA))\n+\n+            securityCodeViewModel.init(\n+                getParcelable(PAYMENT_CONFIGURATION_EXTRA)!!,\n+                getParcelable(PAYMENT_RECOVERY_EXTRA),\n+                getString(REASON_EXTRA)?.let { Reason.valueOf(it) })\n+\n+        } ?: error(\"\")\n+\n+        payButtonFragment = childFragmentManager.findFragmentById(R.id.pay_button) as PayButtonFragment\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        with(securityCodeViewModel) {\n+            cvvCardUiLiveData.nonNullObserve(viewLifecycleOwner) {\n+                with(cardDrawer) {\n+                    card.name = it.name\n+                    card.expiration = it.date\n+                    card.number = it.number\n+                    show(it)\n+                }\n+            }\n+\n+            virtualCardInfoLiveData.nonNullObserve(viewLifecycleOwner) {\n+                cardDrawer.visibility = GONE\n+                cvvTitle.text = it.title\n+                with(cvvSubtitle) {\n+                    text = it.message\n+                    visibility = VISIBLE\n+                }\n+            }\n+\n+            inputInfoLiveData.nonNullObserve(viewLifecycleOwner) {\n+                cvvEditText.filters = arrayOf<InputFilter>(LengthFilter(it))\n+            }\n+        }\n+    }\n+\n+    override fun prePayment(callback: PayButton.OnReadyForPaymentCallback) {\n+        securityCodeViewModel.handlePrePaymentFinished(callback)\n+    }\n+\n+    override fun enqueueOnExploding(callback: PayButton.OnEnqueueResolvedCallback) {\n+        securityCodeViewModel.enqueueOnExploding(cvvEditText.text.toString(), callback)\n+    }\n+\n+    companion object {\n+        const val TAG = \"security_code\"\n+        private const val PAYMENT_CONFIGURATION_EXTRA = \"payment_configuration\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDUyMDA1", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-484452005", "createdAt": "2020-09-08T20:00:01Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDowMDowMVrOHOsCTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDowMDowMVrOHOsCTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2MzU5Ng==", "bodyText": "Usate el KParcelable amigo", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485163596", "createdAt": "2020-09-08T20:00:01Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/model/PaymentRecovery.kt", "diffHunk": "@@ -0,0 +1,55 @@\n+package com.mercadopago.android.px.model\n+\n+import android.os.Parcel\n+import android.os.Parcelable\n+import java.io.Serializable\n+\n+//TODO move to internal package.\n+class PaymentRecovery(private val statusDetail: String, val token: Token?, val card: Card?,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDUzMTkz", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-484453193", "createdAt": "2020-09-08T20:01:55Z", "commit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDowMTo1NVrOHOsGOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDowMTo1NVrOHOsGOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NDYwMA==", "bodyText": "Por qu\u00e9 tuvimos que meter esto?", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485164600", "createdAt": "2020-09-08T20:01:55Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/pay_button/PayButtonViewModel.kt", "diffHunk": "@@ -158,13 +158,21 @@ internal class PayButtonViewModel(\n         stateUILiveData.addSource(paymentFinishedLiveData) { value -> stateUILiveData.value = value }\n \n         // Cvv required event\n-        val cvvRequiredLiveData: LiveData<Pair<Card, Reason>?> = transform(serviceLiveData.requireCvvLiveData) { it }\n-        this.cvvRequiredLiveData.addSource(cvvRequiredLiveData) { value -> this.cvvRequiredLiveData.value = value }\n+        val cvvRequiredLiveData: LiveData<Reason?> = transform(serviceLiveData.requireCvvLiveData) { it }\n+        this.cvvRequiredLiveData.addSource(cvvRequiredLiveData) { value ->\n+            this.cvvRequiredLiveData.value = Pair(paymentConfiguration!!, value!!)\n+            stateUILiveData.value = ButtonLoadingCanceled", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c869ba4448f9fa02996a04359baa6ab6cde7922"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/de45027e4d12cbb74757866326df96bba146d07b", "committedDate": "2020-09-08T21:36:36Z", "message": "review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDgxMjQw", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485081240", "createdAt": "2020-09-09T14:40:14Z", "commit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo0MDoxNFrOHPKtTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo0MDoxNFrOHPKtTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY2NjEyNA==", "bodyText": "Esto lanza un exception? podemos ponerle un error mas representativo, tipo falto tal key como argument del fragment o el fragment debe tener tales keys", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485666124", "createdAt": "2020-09-09T14:40:14Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/SecurityCodeFragment.kt", "diffHunk": "@@ -0,0 +1,147 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import android.os.Bundle\n+import android.text.InputFilter\n+import android.text.InputFilter.LengthFilter\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.View.GONE\n+import android.view.View.VISIBLE\n+import android.view.ViewGroup\n+import android.widget.EditText\n+import android.widget.TextView\n+import androidx.appcompat.app.AppCompatActivity\n+import androidx.appcompat.widget.Toolbar\n+import androidx.fragment.app.Fragment\n+import com.meli.android.carddrawer.model.CardDrawerView\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.core.BackHandler\n+import com.mercadopago.android.px.internal.di.viewModel\n+import com.mercadopago.android.px.internal.features.pay_button.PayButton\n+import com.mercadopago.android.px.internal.features.pay_button.PayButtonFragment\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.util.nonNullObserve\n+import com.mercadopago.android.px.internal.viewmodel.PaymentModel\n+import com.mercadopago.android.px.model.PaymentRecovery\n+import com.mercadopago.android.px.model.internal.PaymentConfiguration\n+import com.mercadopago.android.px.tracking.internal.model.Reason\n+\n+\n+internal class SecurityCodeFragment : Fragment(), PayButton.Handler, BackHandler {\n+\n+    private val securityCodeViewModel: SecurityCodeViewModel by viewModel()\n+\n+    private lateinit var cardDrawer: CardDrawerView\n+    private lateinit var cvvEditText: EditText\n+    private lateinit var cvvTitle: TextView\n+    private lateinit var cvvSubtitle: TextView\n+    private lateinit var payButtonFragment: PayButtonFragment\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+        savedInstanceState: Bundle?): View? {\n+        return inflater.inflate(R.layout.fragment_security_code, container, false)\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        (activity as? AppCompatActivity?)?.apply {\n+            view.findViewById<Toolbar>(R.id.cvv_toolbar)?.also { toolbar ->\n+                setSupportActionBar(toolbar)\n+                supportActionBar?.apply {\n+                    setDisplayShowTitleEnabled(false)\n+                    setDisplayHomeAsUpEnabled(true)\n+                    setDisplayShowHomeEnabled(true)\n+                    setHomeButtonEnabled(true)\n+                    toolbar.setNavigationOnClickListener { onBackPressed() }\n+                }\n+            }\n+        }\n+\n+        cardDrawer = view.findViewById(R.id.card_drawer)\n+        cvvEditText = view.findViewById(R.id.cvv_edit_text)\n+        cvvTitle = view.findViewById(R.id.cvv_title)\n+        cvvSubtitle = view.findViewById(R.id.cvv_subtitle)\n+        ViewUtils.openKeyboard(cvvEditText)\n+\n+        arguments?.apply {\n+\n+            check(\n+                containsKey(EXTRA_PAYMENT_RECOVERY) || containsKey(EXTRA_PAYMENT_CONFIGURATION) && containsKey(EXTRA_REASON))\n+\n+            securityCodeViewModel.init(\n+                getParcelable(EXTRA_PAYMENT_CONFIGURATION)!!,\n+                getParcelable(EXTRA_PAYMENT_RECOVERY),\n+                getString(EXTRA_REASON)?.let { Reason.valueOf(it) })\n+\n+        } ?: error(\"\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTAwNjY1", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485100665", "createdAt": "2020-09-09T14:58:28Z", "commit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo1ODoyOFrOHPLmWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo1ODoyOFrOHPLmWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4MDcyOA==", "bodyText": "por que se llama build view model si no buildea el view model?", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485680728", "createdAt": "2020-09-09T14:58:28Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/SecurityCodeFragment.kt", "diffHunk": "@@ -0,0 +1,147 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import android.os.Bundle\n+import android.text.InputFilter\n+import android.text.InputFilter.LengthFilter\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.View.GONE\n+import android.view.View.VISIBLE\n+import android.view.ViewGroup\n+import android.widget.EditText\n+import android.widget.TextView\n+import androidx.appcompat.app.AppCompatActivity\n+import androidx.appcompat.widget.Toolbar\n+import androidx.fragment.app.Fragment\n+import com.meli.android.carddrawer.model.CardDrawerView\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.core.BackHandler\n+import com.mercadopago.android.px.internal.di.viewModel\n+import com.mercadopago.android.px.internal.features.pay_button.PayButton\n+import com.mercadopago.android.px.internal.features.pay_button.PayButtonFragment\n+import com.mercadopago.android.px.internal.util.ViewUtils\n+import com.mercadopago.android.px.internal.util.nonNullObserve\n+import com.mercadopago.android.px.internal.viewmodel.PaymentModel\n+import com.mercadopago.android.px.model.PaymentRecovery\n+import com.mercadopago.android.px.model.internal.PaymentConfiguration\n+import com.mercadopago.android.px.tracking.internal.model.Reason\n+\n+\n+internal class SecurityCodeFragment : Fragment(), PayButton.Handler, BackHandler {\n+\n+    private val securityCodeViewModel: SecurityCodeViewModel by viewModel()\n+\n+    private lateinit var cardDrawer: CardDrawerView\n+    private lateinit var cvvEditText: EditText\n+    private lateinit var cvvTitle: TextView\n+    private lateinit var cvvSubtitle: TextView\n+    private lateinit var payButtonFragment: PayButtonFragment\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+        savedInstanceState: Bundle?): View? {\n+        return inflater.inflate(R.layout.fragment_security_code, container, false)\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+\n+        (activity as? AppCompatActivity?)?.apply {\n+            view.findViewById<Toolbar>(R.id.cvv_toolbar)?.also { toolbar ->\n+                setSupportActionBar(toolbar)\n+                supportActionBar?.apply {\n+                    setDisplayShowTitleEnabled(false)\n+                    setDisplayHomeAsUpEnabled(true)\n+                    setDisplayShowHomeEnabled(true)\n+                    setHomeButtonEnabled(true)\n+                    toolbar.setNavigationOnClickListener { onBackPressed() }\n+                }\n+            }\n+        }\n+\n+        cardDrawer = view.findViewById(R.id.card_drawer)\n+        cvvEditText = view.findViewById(R.id.cvv_edit_text)\n+        cvvTitle = view.findViewById(R.id.cvv_title)\n+        cvvSubtitle = view.findViewById(R.id.cvv_subtitle)\n+        ViewUtils.openKeyboard(cvvEditText)\n+\n+        arguments?.apply {\n+\n+            check(\n+                containsKey(EXTRA_PAYMENT_RECOVERY) || containsKey(EXTRA_PAYMENT_CONFIGURATION) && containsKey(EXTRA_REASON))\n+\n+            securityCodeViewModel.init(\n+                getParcelable(EXTRA_PAYMENT_CONFIGURATION)!!,\n+                getParcelable(EXTRA_PAYMENT_RECOVERY),\n+                getString(EXTRA_REASON)?.let { Reason.valueOf(it) })\n+\n+        } ?: error(\"\")\n+\n+        payButtonFragment = childFragmentManager.findFragmentById(R.id.pay_button) as PayButtonFragment\n+        buildViewModel()\n+    }\n+\n+    private fun buildViewModel() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTAxNDUy", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485101452", "createdAt": "2020-09-09T14:59:13Z", "commit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo1OToxM1rOHPLooQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo1OToxM1rOHPLooQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4MTMxMw==", "bodyText": "tenemos que dejar de hacer los livedata publicos y de exponerlos como mutables", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485681313", "createdAt": "2020-09-09T14:59:13Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/SecurityCodeViewModel.kt", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import androidx.lifecycle.MutableLiveData\n+import com.mercadopago.android.px.addons.ESCManagerBehaviour\n+import com.mercadopago.android.px.internal.base.BaseViewModel\n+import com.mercadopago.android.px.internal.features.pay_button.PayButton\n+import com.mercadopago.android.px.internal.features.security_code.model.VirtualCardInfo\n+import com.mercadopago.android.px.internal.repository.CardTokenRepository\n+import com.mercadopago.android.px.internal.repository.InitRepository\n+import com.mercadopago.android.px.internal.repository.PaymentSettingRepository\n+import com.mercadopago.android.px.internal.repository.UserSelectionRepository\n+import com.mercadopago.android.px.internal.util.CVVRecoveryWrapper\n+import com.mercadopago.android.px.internal.util.TokenCreationWrapper\n+import com.mercadopago.android.px.internal.viewmodel.CardDrawerConfiguration\n+import com.mercadopago.android.px.model.Card\n+import com.mercadopago.android.px.model.CvvInfo\n+import com.mercadopago.android.px.model.PaymentRecovery\n+import com.mercadopago.android.px.model.internal.PaymentConfiguration\n+import com.mercadopago.android.px.tracking.internal.model.Reason\n+import kotlinx.coroutines.CoroutineScope\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.launch\n+import kotlinx.coroutines.withContext\n+\n+class SecurityCodeViewModel(\n+    private val cardTokenRepository: CardTokenRepository,\n+    private val escManagerBehaviour: ESCManagerBehaviour,\n+    private val paymentSettingRepository: PaymentSettingRepository,\n+    initRepository: InitRepository,\n+    userSelectionRepository: UserSelectionRepository,\n+    cardConfigurationMapper: CardConfigurationMapper,\n+    virtualCardInfoMapper: VirtualCardInfoMapper) : BaseViewModel() {\n+\n+    val cvvCardUiLiveData = MutableLiveData<CardDrawerConfiguration>()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTA2Mjkz", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485106293", "createdAt": "2020-09-09T15:03:54Z", "commit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTowMzo1NVrOHPL2iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTowMzo1NVrOHPL2iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4NDg3Mg==", "bodyText": "no parece un overkill hacer un mapper para esta linea nada m\u00e1s?", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485684872", "createdAt": "2020-09-09T15:03:55Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/CardConfigurationMapper.kt", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import com.meli.android.carddrawer.model.CardUI\n+import com.mercadopago.android.px.internal.viewmodel.CardDrawerConfiguration\n+import com.mercadopago.android.px.internal.viewmodel.mappers.Mapper\n+import com.mercadopago.android.px.model.CardDisplayInfo\n+\n+class CardConfigurationMapper: Mapper<CardDisplayInfo, CardUI>() {\n+    override fun map(model: CardDisplayInfo) = model.run { CardDrawerConfiguration(model,  null) }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTA2NjQ2", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485106646", "createdAt": "2020-09-09T15:04:17Z", "commit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTowNDoxN1rOHPL3kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTowNDoxN1rOHPL3kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY4NTEzNw==", "bodyText": "idem al otro mapper", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485685137", "createdAt": "2020-09-09T15:04:17Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/security_code/VirtualCardInfoMapper.kt", "diffHunk": "@@ -0,0 +1,9 @@\n+package com.mercadopago.android.px.internal.features.security_code\n+\n+import com.mercadopago.android.px.internal.features.security_code.model.VirtualCardInfo\n+import com.mercadopago.android.px.internal.viewmodel.mappers.Mapper\n+import com.mercadopago.android.px.model.CvvInfo\n+\n+class VirtualCardInfoMapper: Mapper<CvvInfo, VirtualCardInfo>() {\n+    override fun map(model: CvvInfo) = model.run { VirtualCardInfo(title, message) }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTQ5OTYy", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485149962", "createdAt": "2020-09-09T15:49:50Z", "commit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTo0OTo1MFrOHPN5FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNTo0OTo1MFrOHPN5FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcxODI5Mg==", "bodyText": "por que no se setea directamente en vez de hacer el get? tipo:\nval isTokenRecoverable = Payment.StatusDetail.isStatusDetailRecoverable(statusDetail)", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485718292", "createdAt": "2020-09-09T15:49:50Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/model/PaymentRecovery.kt", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.mercadopago.android.px.model\n+\n+import android.os.Parcel\n+import android.os.Parcelable\n+import com.mercadopago.android.px.internal.util.KParcelable\n+import com.mercadopago.android.px.internal.util.parcelableCreator\n+import java.io.Serializable\n+\n+//TODO move to internal package.\n+class PaymentRecovery(private val statusDetail: String, val token: Token?, val card: Card?,\n+                      val paymentMethod: PaymentMethod?) : Serializable, KParcelable {\n+\n+    @Deprecated(\"\")\n+    constructor(paymentStatusDetail: String) : this(paymentStatusDetail, null, null)\n+\n+    @Deprecated(\"\")\n+    constructor(statusDetail: String, token: Token) : this(statusDetail, token, null)\n+\n+    @Deprecated(\"\")\n+    constructor(statusDetail: String, token: Token?, card: Card?) : this(statusDetail, token, card, null)\n+\n+    val isTokenRecoverable: Boolean\n+        get() = Payment.StatusDetail.isStatusDetailRecoverable(statusDetail)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de45027e4d12cbb74757866326df96bba146d07b"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b6a3ed02e4f17dd508bb8ae3670c608e24575c8", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/0b6a3ed02e4f17dd508bb8ae3670c608e24575c8", "committedDate": "2020-09-09T16:31:15Z", "message": "review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1Mjg3OTc1", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485287975", "createdAt": "2020-09-09T18:28:00Z", "commit": {"oid": "0b6a3ed02e4f17dd508bb8ae3670c608e24575c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxODoyODowMFrOHPUjZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxODoyODowMFrOHPUjZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgyNzQyOA==", "bodyText": "deberia seguir siendo parte de la interfaz, habria que definir el field ac\u00e1", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485827428", "createdAt": "2020-09-09T18:28:00Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/offline_methods/OfflineMethods.kt", "diffHunk": "@@ -21,7 +21,6 @@ internal interface OfflineMethods {\n         fun onMethodSelected(selectedItem: OfflineMethodItem)\n         fun onPrePayment(callback: PayButton.OnReadyForPaymentCallback)\n         fun onBack()\n-        fun getObservableDeepLink(): LiveData<Event<String>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b6a3ed02e4f17dd508bb8ae3670c608e24575c8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a0770fa1e5c60de2dd94b9211d3499f6c2c34e7", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/5a0770fa1e5c60de2dd94b9211d3499f6c2c34e7", "committedDate": "2020-09-09T18:44:42Z", "message": "review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MzA5OTI3", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485309927", "createdAt": "2020-09-09T19:00:16Z", "commit": {"oid": "5a0770fa1e5c60de2dd94b9211d3499f6c2c34e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxOTowMDoxNlrOHPVmwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxOTowMDoxNlrOHPVmwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTg0NDY3Mw==", "bodyText": "No hab\u00edamos matado Event?", "url": "https://github.com/mercadopago/px-android/pull/2313#discussion_r485844673", "createdAt": "2020-09-09T19:00:16Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/offline_methods/OfflineMethods.kt", "diffHunk": "@@ -16,12 +17,12 @@ internal interface OfflineMethods {\n     }\n \n     interface ViewModel {\n+        val deepLinkLiveData: LiveData<Event<String>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0770fa1e5c60de2dd94b9211d3499f6c2c34e7"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MzE2MTAy", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485316102", "createdAt": "2020-09-09T19:09:17Z", "commit": {"oid": "5a0770fa1e5c60de2dd94b9211d3499f6c2c34e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37754437552198465b613366fa1f24b330b7ff62", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/37754437552198465b613366fa1f24b330b7ff62", "committedDate": "2020-09-09T20:25:30Z", "message": "SingleLiveData created"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06bee422dd622403fd2d542f3ff878c7582202b4", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/06bee422dd622403fd2d542f3ff878c7582202b4", "committedDate": "2020-09-09T20:26:17Z", "message": "MutableSingleLiveData created"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f06dda5dad04d2bdc05ec27d3eb2d27324fc737", "author": {"user": {"login": "jorGonzalez291292", "name": "Jorge Daniel Gonzalez"}}, "url": "https://github.com/mercadopago/px-android/commit/9f06dda5dad04d2bdc05ec27d3eb2d27324fc737", "committedDate": "2020-09-09T20:28:29Z", "message": "add tab"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODg1Njc5", "url": "https://github.com/mercadopago/px-android/pull/2313#pullrequestreview-485885679", "createdAt": "2020-09-10T12:40:07Z", "commit": {"oid": "9f06dda5dad04d2bdc05ec27d3eb2d27324fc737"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3756, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}