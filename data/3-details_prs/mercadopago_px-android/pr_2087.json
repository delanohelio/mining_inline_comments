{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MDE2NzA3", "number": 2087, "title": "[Feature] High risk remedy", "bodyText": "", "createdAt": "2020-03-28T00:10:20Z", "url": "https://github.com/mercadopago/px-android/pull/2087", "merged": true, "mergeCommit": {"oid": "a99e87ec751385d480eafc918576236821bf61a4"}, "closed": true, "closedAt": "2020-04-02T16:58:24Z", "author": {"login": "guchito9"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR57pYABqjMxNzQ0NDg2NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTvSBcAFqTM4NjYxNjg2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "053508439827ec0b012660947b47fd4d961a8d76", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/053508439827ec0b012660947b47fd4d961a8d76", "committedDate": "2020-03-28T00:08:32Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "181df6ce05ed0a6e8bc2ccd1de71d90b3b7b619b", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/181df6ce05ed0a6e8bc2ccd1de71d90b3b7b619b", "committedDate": "2020-03-28T00:12:23Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "181df6ce05ed0a6e8bc2ccd1de71d90b3b7b619b", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/181df6ce05ed0a6e8bc2ccd1de71d90b3b7b619b", "committedDate": "2020-03-28T00:12:23Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "f20b2ed87d57d2b09b76440ac5382c9f82f4a7db", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/f20b2ed87d57d2b09b76440ac5382c9f82f4a7db", "committedDate": "2020-03-30T20:19:14Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f20b2ed87d57d2b09b76440ac5382c9f82f4a7db", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/f20b2ed87d57d2b09b76440ac5382c9f82f4a7db", "committedDate": "2020-03-30T20:19:14Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "d68074cf67c73bae61065a806cbb2fb51ab627d5", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/d68074cf67c73bae61065a806cbb2fb51ab627d5", "committedDate": "2020-03-30T22:28:26Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d68074cf67c73bae61065a806cbb2fb51ab627d5", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/d68074cf67c73bae61065a806cbb2fb51ab627d5", "committedDate": "2020-03-30T22:28:26Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "b07f772a0c6f617a32b0d13ba6cca0f1a4d22483", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/b07f772a0c6f617a32b0d13ba6cca0f1a4d22483", "committedDate": "2020-04-01T17:15:45Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b07f772a0c6f617a32b0d13ba6cca0f1a4d22483", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/b07f772a0c6f617a32b0d13ba6cca0f1a4d22483", "committedDate": "2020-04-01T17:15:45Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "8a0dfc5d79559f189bfcdfccc82274291e3560f0", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/8a0dfc5d79559f189bfcdfccc82274291e3560f0", "committedDate": "2020-04-01T17:19:23Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a0dfc5d79559f189bfcdfccc82274291e3560f0", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/8a0dfc5d79559f189bfcdfccc82274291e3560f0", "committedDate": "2020-04-01T17:19:23Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "3b1b2d885d933813cbb5223ebf76c732575c9c91", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/3b1b2d885d933813cbb5223ebf76c732575c9c91", "committedDate": "2020-04-01T21:32:09Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b1b2d885d933813cbb5223ebf76c732575c9c91", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/3b1b2d885d933813cbb5223ebf76c732575c9c91", "committedDate": "2020-04-01T21:32:09Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "d30943bc3bf59d79f977d32d4979b1c59000e56c", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/d30943bc3bf59d79f977d32d4979b1c59000e56c", "committedDate": "2020-04-02T00:01:28Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d30943bc3bf59d79f977d32d4979b1c59000e56c", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/d30943bc3bf59d79f977d32d4979b1c59000e56c", "committedDate": "2020-04-02T00:01:28Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/ffcc7f24ca3903c7fe204edbc2a887ddfd66889c", "committedDate": "2020-04-02T01:16:41Z", "message": "Added high risk remedy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDI2Nzk0", "url": "https://github.com/mercadopago/px-android/pull/2087#pullrequestreview-386426794", "createdAt": "2020-04-02T13:30:42Z", "commit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozMDo0MlrOF_rR8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0OToyM1rOF_sIQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMzcxNQ==", "bodyText": "Se van a terminar usando estos override?", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402313715", "createdAt": "2020-04-02T13:30:42Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutPresenter.java", "diffHunk": "@@ -439,6 +438,11 @@ public void driveToShowPaymentMethodSelection() {\n             });\n     }\n \n+    @Override\n+    public void onUserValidation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxNjEyOQ==", "bodyText": "Ac\u00e1 tratar\u00eda de usar el with(data).", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402316129", "createdAt": "2020-04-02T13:34:00Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesBodyMapper.kt", "diffHunk": "@@ -1,18 +1,19 @@\n package com.mercadopago.android.px.internal.features.payment_result.remedies\n \n+import com.mercadopago.android.px.internal.repository.UserSelectionRepository\n import com.mercadopago.android.px.internal.viewmodel.mappers.Mapper\n-import com.mercadopago.android.px.model.Card\n-import com.mercadopago.android.px.model.PayerCost\n+import com.mercadopago.android.px.model.PaymentData\n import com.mercadopago.android.px.model.internal.remedies.PayerPaymentMethodRejected\n import com.mercadopago.android.px.model.internal.remedies.RemediesBody\n \n-internal class RemediesBodyMapper : Mapper<Pair<Card, PayerCost>, RemediesBody>() {\n+internal class RemediesBodyMapper(private val userSelectionRepository: UserSelectionRepository)\n+    : Mapper<PaymentData, RemediesBody>() {\n \n-    override fun map(cardAndPayerCost: Pair<Card, PayerCost>): RemediesBody {\n-        val (card, payerCost) = cardAndPayerCost\n-        val payerPaymentMethodRejected = PayerPaymentMethodRejected(payerCost.installments,\n-            card.issuer?.name ?: \"\", card.lastFourDigits.orEmpty(), card.paymentMethod.id, card.securityCodeLength,\n-            card.securityCodeLocation, payerCost.totalAmount)\n+    override fun map(data: PaymentData): RemediesBody {\n+        val securityCodeLocation = userSelectionRepository.card?.securityCodeLocation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNDAzMw==", "bodyText": "Por que usamos View.inflate()?", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402324033", "createdAt": "2020-04-02T13:44:36Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/view/PaymentResultFooter.kt", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.mercadopago.android.px.internal.features.payment_result.remedies.view\n+\n+import android.content.Context\n+import android.os.Parcel\n+import android.os.Parcelable\n+import android.support.v4.content.ContextCompat\n+import android.util.AttributeSet\n+import android.view.View\n+import android.widget.LinearLayout\n+import com.mercadolibre.android.ui.widgets.MeliButton\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.features.payment_result.remedies.RemedyButton\n+\n+internal class PaymentResultFooter(context: Context, attrs: AttributeSet?, defStyleAttr: Int) :\n+    LinearLayout(context, attrs, defStyleAttr) {\n+\n+    init {\n+        configureView(context)\n+    }\n+\n+    constructor(context: Context, attrs: AttributeSet?) : this(context, attrs, 0)\n+    constructor(context: Context) : this(context, null)\n+\n+    private lateinit var loudButton: MeliButton\n+    private lateinit var quietButton: MeliButton\n+    private lateinit var payButtonContainer: View\n+\n+    private fun configureView(context: Context) {\n+        orientation = VERTICAL\n+        View.inflate(context, R.layout.px_payment_result_footer, this)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNTI0OA==", "bodyText": "ac\u00e1 podes usar el with(button)", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402325248", "createdAt": "2020-04-02T13:46:15Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/view/PaymentResultFooter.kt", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.mercadopago.android.px.internal.features.payment_result.remedies.view\n+\n+import android.content.Context\n+import android.os.Parcel\n+import android.os.Parcelable\n+import android.support.v4.content.ContextCompat\n+import android.util.AttributeSet\n+import android.view.View\n+import android.widget.LinearLayout\n+import com.mercadolibre.android.ui.widgets.MeliButton\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.features.payment_result.remedies.RemedyButton\n+\n+internal class PaymentResultFooter(context: Context, attrs: AttributeSet?, defStyleAttr: Int) :\n+    LinearLayout(context, attrs, defStyleAttr) {\n+\n+    init {\n+        configureView(context)\n+    }\n+\n+    constructor(context: Context, attrs: AttributeSet?) : this(context, attrs, 0)\n+    constructor(context: Context) : this(context, null)\n+\n+    private lateinit var loudButton: MeliButton\n+    private lateinit var quietButton: MeliButton\n+    private lateinit var payButtonContainer: View\n+\n+    private fun configureView(context: Context) {\n+        orientation = VERTICAL\n+        View.inflate(context, R.layout.px_payment_result_footer, this)\n+        loudButton = findViewById(R.id.action_loud)\n+        quietButton = findViewById<MeliButton>(R.id.action_quiet).apply {\n+            background = ContextCompat.getDrawable(context, R.drawable.px_quiet_button_selector)\n+            text = resources.getString(R.string.px_change_payment)\n+        }\n+        payButtonContainer = findViewById(R.id.pay_button)\n+    }\n+\n+    fun init(model: Model, listener: Listener) {\n+        applyButtonConfig(loudButton, model.loudButton, listener::onLoudButtonClicked)\n+        applyButtonConfig(quietButton, model.quietButton, listener::onQuietButtonClicked)\n+        payButtonContainer.visibility = if (model.showPayButton) View.VISIBLE else View.GONE\n+    }\n+\n+    private fun applyButtonConfig(button: MeliButton, buttonModel: RemedyButton?,\n+        listener: (action: RemedyButton.Action) -> Unit) {\n+        buttonModel?.let {model ->\n+            button.visibility = View.VISIBLE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNjAxMg==", "bodyText": "Que es esto de TODO()?", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402326012", "createdAt": "2020-04-02T13:47:17Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesViewModel.kt", "diffHunk": "@@ -69,6 +73,16 @@ internal class RemediesViewModel(\n             })\n     }\n \n+    override fun onButtonPressed(action: RemedyButton.Action) {\n+        when(action) {\n+            RemedyButton.Action.CHANGE_PM -> remedyState.value = RemedyState.ChangePaymentMethod\n+            RemedyButton.Action.KYC -> remediesModel.highRiskRemedyModel?.let {\n+                remedyState.value = RemedyState.GoToKyc(it.deepLink)\n+            }\n+            else -> TODO()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNzYxNg==", "bodyText": "ac\u00e1 podemos usar el with(data)", "url": "https://github.com/mercadopago/px-android/pull/2087#discussion_r402327616", "createdAt": "2020-04-02T13:49:23Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/remedies/RemediesBodyMapper.kt", "diffHunk": "@@ -1,18 +1,19 @@\n package com.mercadopago.android.px.internal.features.payment_result.remedies\n \n+import com.mercadopago.android.px.internal.repository.UserSelectionRepository\n import com.mercadopago.android.px.internal.viewmodel.mappers.Mapper\n-import com.mercadopago.android.px.model.Card\n-import com.mercadopago.android.px.model.PayerCost\n+import com.mercadopago.android.px.model.PaymentData\n import com.mercadopago.android.px.model.internal.remedies.PayerPaymentMethodRejected\n import com.mercadopago.android.px.model.internal.remedies.RemediesBody\n \n-internal class RemediesBodyMapper : Mapper<Pair<Card, PayerCost>, RemediesBody>() {\n+internal class RemediesBodyMapper(private val userSelectionRepository: UserSelectionRepository)\n+    : Mapper<PaymentData, RemediesBody>() {\n \n-    override fun map(cardAndPayerCost: Pair<Card, PayerCost>): RemediesBody {\n-        val (card, payerCost) = cardAndPayerCost\n-        val payerPaymentMethodRejected = PayerPaymentMethodRejected(payerCost.installments,\n-            card.issuer?.name ?: \"\", card.lastFourDigits.orEmpty(), card.paymentMethod.id, card.securityCodeLength,\n-            card.securityCodeLocation, payerCost.totalAmount)\n+    override fun map(data: PaymentData): RemediesBody {\n+        val securityCodeLocation = userSelectionRepository.card?.securityCodeLocation\n+        val payerPaymentMethodRejected = PayerPaymentMethodRejected(data.payerCost?.installments,\n+            data.issuer?.name, data.token?.lastFourDigits, data.paymentMethod.id, data.paymentMethod.paymentTypeId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de64bd3951bef5f16a085a67de97e78fe9048cd4", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/de64bd3951bef5f16a085a67de97e78fe9048cd4", "committedDate": "2020-04-02T15:38:23Z", "message": "Added high risk remedy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffcc7f24ca3903c7fe204edbc2a887ddfd66889c", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/ffcc7f24ca3903c7fe204edbc2a887ddfd66889c", "committedDate": "2020-04-02T01:16:41Z", "message": "Added high risk remedy"}, "afterCommit": {"oid": "de64bd3951bef5f16a085a67de97e78fe9048cd4", "author": {"user": {"login": "guchito9", "name": "Guche Mantuano"}}, "url": "https://github.com/mercadopago/px-android/commit/de64bd3951bef5f16a085a67de97e78fe9048cd4", "committedDate": "2020-04-02T15:38:23Z", "message": "Added high risk remedy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTU5NjAw", "url": "https://github.com/mercadopago/px-android/pull/2087#pullrequestreview-386559600", "createdAt": "2020-04-02T15:48:12Z", "commit": {"oid": "de64bd3951bef5f16a085a67de97e78fe9048cd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NjE2ODY1", "url": "https://github.com/mercadopago/px-android/pull/2087#pullrequestreview-386616865", "createdAt": "2020-04-02T16:55:52Z", "commit": {"oid": "de64bd3951bef5f16a085a67de97e78fe9048cd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3907, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}