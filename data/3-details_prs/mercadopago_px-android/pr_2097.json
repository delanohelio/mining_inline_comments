{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3ODYyODY0", "number": 2097, "title": "[feature] ifpe congrats", "bodyText": "Se agregan dos vistas\n\ntop text box\nview receipt", "createdAt": "2020-04-02T23:46:55Z", "url": "https://github.com/mercadopago/px-android/pull/2097", "merged": true, "mergeCommit": {"oid": "62f18b080efa091ea838027971fed813e4dea359"}, "closed": true, "closedAt": "2020-04-05T23:57:57Z", "author": {"login": "cgaggino"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT1NasABqjMxOTQzMjAyMjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUy6-LABqjMyMDMxODMyODc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d100ebb7cbab21ec7226cb2e91dfaaf3c5e6c45", "author": {"user": {"login": "cgaggino", "name": "Cristian Gaggino"}}, "url": "https://github.com/mercadopago/px-android/commit/0d100ebb7cbab21ec7226cb2e91dfaaf3c5e6c45", "committedDate": "2020-04-02T23:44:25Z", "message": "* Added top text box and view receipt components"}, "afterCommit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67", "author": {"user": {"login": "cgaggino", "name": "Cristian Gaggino"}}, "url": "https://github.com/mercadopago/px-android/commit/ba72c2bf0e7980174a92259bfbcef4adc154cf67", "committedDate": "2020-04-02T23:49:30Z", "message": "* Added top text box and view receipt components"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODU0MzYz", "url": "https://github.com/mercadopago/px-android/pull/2097#pullrequestreview-386854363", "createdAt": "2020-04-02T23:52:32Z", "commit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMzo1MjozMlrOGAAdhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMzo1MjozMlrOGAAdhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2MDc0MA==", "bodyText": "El true lo voy a cambiar cuando tenga armado el callback de kyc, por ahora lo dejo hardcodeado", "url": "https://github.com/mercadopago/px-android/pull/2097#discussion_r402660740", "createdAt": "2020-04-02T23:52:32Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/CongratsRepositoryImpl.kt", "diffHunk": "@@ -53,23 +53,27 @@ class CongratsRepositoryImpl(private val congratsService: CongratsService,\n     private suspend fun getPaymentReward(payment: IPaymentDescriptor, paymentResult: PaymentResult) =\n         try {\n             val joinedPaymentIds = TextUtil.join(payment.paymentIds)\n+            val joinedPaymentMethodsIds = paymentResult.paymentDataList\n+                .joinToString(TextUtil.CSV_DELIMITER) { p -> (p.paymentMethod.id) }\n             val campaignId = paymentResult.paymentData.campaign?.run { id } ?: \"\"\n-            val response = congratsService.getPaymentReward(BuildConfig.API_ENVIRONMENT, locale, privateKey,\n-                    joinedPaymentIds, platform, campaignId, flow).await()\n+            val response = congratsService.getCongrats(BuildConfig.API_ENVIRONMENT, locale, privateKey,\n+                joinedPaymentIds, platform, campaignId, true, joinedPaymentMethodsIds, flow).await()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODU0OTkz", "url": "https://github.com/mercadopago/px-android/pull/2097#pullrequestreview-386854993", "createdAt": "2020-04-02T23:54:27Z", "commit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMzo1NDoyN1rOGAAfww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMzo1NDoyN1rOGAAfww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2MTMxNQ==", "bodyText": "Por ahora uso este callback, pensaba en cambiarle el nombre a onClickDeepLinkButton pero me di cuenta que la implementaci\u00f3n hace un track de showAllDiscounts, quizas los tracks podrian estar dentro de la vista y no en el presenter? o armo otro callback que igual al de showAllDiscounts pero con otro track", "url": "https://github.com/mercadopago/px-android/pull/2097#discussion_r402661315", "createdAt": "2020-04-02T23:54:27Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/view/PaymentResultBody.java", "diffHunk": "@@ -171,6 +181,20 @@ private void renderMethods(@NonNull final Model model) {\n         }\n     }\n \n+    private void renderViewReceipt(@Nullable final Action viewReceiptAction, final Listener listener) {\n+        final MeliButton viewReceiptButton = findViewById(R.id.view_receipt_action);\n+        final String target = viewReceiptAction != null ? viewReceiptAction.getTarget() : null;\n+        if (TextUtil.isNotEmpty(target) && isMPInstalled(getContext().getPackageManager())) {\n+            viewReceiptButton\n+                .setBackground(ContextCompat.getDrawable(getContext(), R.drawable.px_quiet_button_selector));\n+            viewReceiptButton.setText(viewReceiptAction.getLabel());\n+            viewReceiptButton.setOnClickListener(\n+                v -> listener.onClickShowAllDiscounts(target));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67"}, "originalPosition": 128}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3Mjg1NTE5", "url": "https://github.com/mercadopago/px-android/pull/2097#pullrequestreview-387285519", "createdAt": "2020-04-03T14:03:13Z", "commit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNDowMzoxM1rOGAW4zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNDowMzoxM1rOGAW4zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAyODE3Mg==", "bodyText": "por que usamos el .run aca? No podemos hacer campaign?.id?", "url": "https://github.com/mercadopago/px-android/pull/2097#discussion_r403028172", "createdAt": "2020-04-03T14:03:13Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/CongratsRepositoryImpl.kt", "diffHunk": "@@ -53,23 +53,27 @@ class CongratsRepositoryImpl(private val congratsService: CongratsService,\n     private suspend fun getPaymentReward(payment: IPaymentDescriptor, paymentResult: PaymentResult) =\n         try {\n             val joinedPaymentIds = TextUtil.join(payment.paymentIds)\n+            val joinedPaymentMethodsIds = paymentResult.paymentDataList\n+                .joinToString(TextUtil.CSV_DELIMITER) { p -> (p.paymentMethod.id) }\n             val campaignId = paymentResult.paymentData.campaign?.run { id } ?: \"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTk3NTQ0", "url": "https://github.com/mercadopago/px-android/pull/2097#pullrequestreview-387597544", "createdAt": "2020-04-03T21:42:13Z", "commit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6bd047bfb0e84c17d02d50252381aff925cc0ab", "author": {"user": {"login": "cgaggino", "name": "Cristian Gaggino"}}, "url": "https://github.com/mercadopago/px-android/commit/b6bd047bfb0e84c17d02d50252381aff925cc0ab", "committedDate": "2020-04-05T23:43:57Z", "message": "* Added top text box and view receipt components"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba72c2bf0e7980174a92259bfbcef4adc154cf67", "author": {"user": {"login": "cgaggino", "name": "Cristian Gaggino"}}, "url": "https://github.com/mercadopago/px-android/commit/ba72c2bf0e7980174a92259bfbcef4adc154cf67", "committedDate": "2020-04-02T23:49:30Z", "message": "* Added top text box and view receipt components"}, "afterCommit": {"oid": "b6bd047bfb0e84c17d02d50252381aff925cc0ab", "author": {"user": {"login": "cgaggino", "name": "Cristian Gaggino"}}, "url": "https://github.com/mercadopago/px-android/commit/b6bd047bfb0e84c17d02d50252381aff925cc0ab", "committedDate": "2020-04-05T23:43:57Z", "message": "* Added top text box and view receipt components"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3912, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}