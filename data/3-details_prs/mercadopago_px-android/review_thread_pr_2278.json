{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NjcyNzE0", "number": 2278, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTozNzo1MVrOEW7zDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMjoyNjowMlrOEYQenw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNDgzODU0OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTozNzo1MVrOG-czwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTozNzo1MVrOG-czwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEzNjg5Ng==", "bodyText": "No es algo innecesario hacer esto?", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r468136896", "createdAt": "2020-08-10T19:37:51Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutActivity.java", "diffHunk": "@@ -412,81 +413,56 @@ public boolean isActive() {\n         return !isFinishing();\n     }\n \n-    @Override\n-    public void finishWithPaymentResult() {\n-        presenter.exitWithCode(RESULT_OK);\n-    }\n-\n     @Override\n     public void onOneTapCanceled() {\n         cancelCheckout();\n     }\n \n-    //TODO UNIFY\n     @Override\n     public void cancelCheckout(final Integer resultCode, final Boolean paymentMethodEdited) {\n-        overrideTransitionOut();\n         final Intent intent = new Intent();\n         intent.putExtra(EXTRA_PAYMENT_METHOD_CHANGED, paymentMethodEdited);\n         setResult(resultCode, intent);\n         finish();\n+        overrideTransitionOut();\n     }\n \n-    //TODO UNIFY\n     @Override\n-    public void finishWithPaymentResult(final Payment payment) {\n-        final Intent data = new Intent();\n-        data.putExtra(EXTRA_PAYMENT_RESULT, payment);\n-        setResult(PAYMENT_RESULT_CODE, data);\n-        finish();\n+    public void goToLink(@NonNull final String url) {\n+        final Intent intent = MercadoPagoUtil.getBrowserIntent(url);\n+        startActivity(intent);\n     }\n \n-    //TODO UNIFY\n     @Override\n-    public void finishWithPaymentResult(final Integer paymentResultCode) {\n+    public void finishWithPaymentResult(@Nullable final Integer resultCode, @Nullable final Payment payment) {\n+        int defaultResultCode = RESULT_OK;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d0db7d1af26340a2c1af3efdef4702fcf23f872"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODYwODEwOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTo0NTozNVrOHAe0DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTo0NTozNVrOHAe0DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2Njg5Mg==", "bodyText": "esto iria fuera del metodo map probablemente", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470266892", "createdAt": "2020-08-13T21:45:35Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java", "diffHunk": "@@ -76,9 +95,17 @@ public void dispatch(final Action action) {\n     }\n \n     private void mapPaymentModel() {\n-        final BusinessPaymentResultViewModel viewModel = new BusinessPaymentResultMapper().map(model);\n+        final BusinessPaymentResultViewModel viewModel = new BusinessPaymentResultMapper(\n+            paymentSettings.getCheckoutPreference().getAutoReturn()).map(model);\n         getView().configureViews(viewModel, this);\n         getView().setStatusBarColor(viewModel.headerModel.getBackgroundColor());\n+        if (viewModel.shouldAutoReturn) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79950e363bac80d858e65ebb1583ab3689b26209"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODYzMjgwOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/PostCongratsDriver.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTo1NDozOFrOHAfClw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTo1NDozOFrOHAfClw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI3MDYxNQ==", "bodyText": "Por qu\u00e9 pasamos todo el payment si solo usamos le paymentStatus?", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470270615", "createdAt": "2020-08-13T21:54:38Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/PostCongratsDriver.kt", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.mercadopago.android.px.internal.features.checkout\n+\n+import com.mercadopago.android.px.internal.features.dummy_result.RedirectHelper\n+import com.mercadopago.android.px.internal.repository.PaymentRepository\n+import com.mercadopago.android.px.internal.repository.PaymentSettingRepository\n+import com.mercadopago.android.px.model.IPaymentDescriptor\n+import com.mercadopago.android.px.model.Payment\n+import com.mercadopago.android.px.preferences.CheckoutPreference\n+\n+class PostCongratsDriver(builder: Builder) {\n+\n+    private val paymentSettingRepository = builder.paymentSettingRepository\n+    private val paymentRepository = builder.paymentRepository\n+    private val action = builder.action!!\n+    private val customResponseCode = builder.customResponseCode\n+\n+    fun execute() {\n+        val payment = paymentRepository.payment\n+        paymentSettingRepository.checkoutPreference?.let { preference ->\n+            payment?.let { resolveRedirectUrls(preference, it) }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79950e363bac80d858e65ebb1583ab3689b26209"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODY4NTI1OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/CongratsAutoReturn.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMjoxNDo0OFrOHAfhsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNTowNDo0M1rOHDLvKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI3ODU3OQ==", "bodyText": "Medio raro un enum solo para validar un string, tendria mas sentido si le dieramos alguna responsabilidad quizas, por ejemplo que el enum sea la interfaz con el timer y que all no haga nada y approved si, y te evitas chequear is valid o shouldautoreturn en otros lados.", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470278579", "createdAt": "2020-08-13T22:14:48Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/CongratsAutoReturn.kt", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.mercadopago.android.px.internal.features.payment_result\n+\n+import android.os.CountDownTimer\n+\n+enum class CongratsAutoReturn(val value: String) {\n+\n+    ALL(\"all\"), APPROVED(\"approved\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79950e363bac80d858e65ebb1583ab3689b26209"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwMDA3Mw==", "bodyText": "Es buena esa!", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r473100073", "createdAt": "2020-08-19T15:04:43Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/CongratsAutoReturn.kt", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.mercadopago.android.px.internal.features.payment_result\n+\n+import android.os.CountDownTimer\n+\n+enum class CongratsAutoReturn(val value: String) {\n+\n+    ALL(\"all\"), APPROVED(\"approved\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI3ODU3OQ=="}, "originalCommit": {"oid": "79950e363bac80d858e65ebb1583ab3689b26209"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODcxMjYzOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/util/MercadoPagoUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMjoyNjowMlrOHAfyAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMjoyOTozM1rOHAf2oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4Mjc1NQ==", "bodyText": "hace falta chequear null si el return es nullable?", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470282755", "createdAt": "2020-08-13T22:26:02Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/util/MercadoPagoUtil.java", "diffHunk": "@@ -115,7 +118,29 @@ public static Intent getSafeIntent(@NonNull final Context context, @NonNull fina\n         return getSafeIntent(context).setData(uri);\n     }\n \n-    public static Intent getSafeIntent(@NonNull final Context context) {\n+    private static Intent getSafeIntent(@NonNull final Context context) {\n         return new Intent(Intent.ACTION_VIEW).setPackage(context.getPackageName()).putExtra(INTERNAL, true);\n     }\n+\n+    @Nullable\n+    public static Intent getIntent(@NonNull final Context context, @NonNull final String link) {\n+        final Intent intent = new Intent(Intent.ACTION_VIEW).setData(Uri.parse(link));\n+        if (context.getPackageManager().queryIntentActivities(intent, 0).isEmpty()) {\n+            return null;\n+        } else {\n+            return intent;\n+        }\n+    }\n+\n+    @Nullable\n+    public static Intent getNativeOrWebViewIntent(@NonNull final Context context, @NonNull final String link) {\n+        if (link.startsWith(\"http\")) {\n+            final String webViewPath = isMP(context) ? MP_WEBVIEW_DEEPLINK : ML_WEBVIEW_DEEPLINK;\n+            final Intent intent = getIntent(context, webViewPath + link);\n+            if (intent != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79950e363bac80d858e65ebb1583ab3689b26209"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4MzkzNg==", "bodyText": "ahi vi que lo ultimo lo haces siempre", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470283936", "createdAt": "2020-08-13T22:29:33Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/util/MercadoPagoUtil.java", "diffHunk": "@@ -115,7 +118,29 @@ public static Intent getSafeIntent(@NonNull final Context context, @NonNull fina\n         return getSafeIntent(context).setData(uri);\n     }\n \n-    public static Intent getSafeIntent(@NonNull final Context context) {\n+    private static Intent getSafeIntent(@NonNull final Context context) {\n         return new Intent(Intent.ACTION_VIEW).setPackage(context.getPackageName()).putExtra(INTERNAL, true);\n     }\n+\n+    @Nullable\n+    public static Intent getIntent(@NonNull final Context context, @NonNull final String link) {\n+        final Intent intent = new Intent(Intent.ACTION_VIEW).setData(Uri.parse(link));\n+        if (context.getPackageManager().queryIntentActivities(intent, 0).isEmpty()) {\n+            return null;\n+        } else {\n+            return intent;\n+        }\n+    }\n+\n+    @Nullable\n+    public static Intent getNativeOrWebViewIntent(@NonNull final Context context, @NonNull final String link) {\n+        if (link.startsWith(\"http\")) {\n+            final String webViewPath = isMP(context) ? MP_WEBVIEW_DEEPLINK : ML_WEBVIEW_DEEPLINK;\n+            final Intent intent = getIntent(context, webViewPath + link);\n+            if (intent != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4Mjc1NQ=="}, "originalCommit": {"oid": "79950e363bac80d858e65ebb1583ab3689b26209"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1760, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}