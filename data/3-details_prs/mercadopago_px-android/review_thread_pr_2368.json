{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MDY4NTQ1", "number": 2368, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjowNzo0OVrOE3rUmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjoyMzozM1rOFNwvYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODE2OTIxOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/res/layout/px_fragment_account_money.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjowNzo0OVrOHxKbNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjowNzo0OVrOHxKbNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMxMzA3Nw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r521313077", "createdAt": "2020-11-11T12:07:49Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/res/layout/px_fragment_account_money.xml", "diffHunk": "@@ -9,52 +9,26 @@\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"wrap_content\"\n         android:layout_marginBottom=\"@dimen/px_s_margin\"\n-        android:layout_marginLeft=\"@dimen/px_m_margin\"\n-        android:layout_marginRight=\"@dimen/px_m_margin\"\n+        android:layout_marginStart=\"@dimen/px_m_margin\"\n+        android:layout_marginEnd=\"@dimen/px_m_margin\"\n+        android:clipChildren=\"false\"\n         app:cardCornerRadius=\"@dimen/px_xs_margin\"\n         app:cardElevation=\"2dp\"\n         app:cardPreventCornerOverlap=\"false\">\n \n         <androidx.constraintlayout.widget.ConstraintLayout\n-            android:id=\"@+id/payment_method_account_money\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\">\n \n-            <ImageView\n-                android:id=\"@+id/background\"\n+            <com.meli.android.carddrawer.model.CardDrawerView", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63c918e5a620104a7d3a7a081956e4fd9583977a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTA5OTUzOnYy", "diffSide": "RIGHT", "path": "example/src/main/java/com/mercadopago/android/px/utils/OneTapSamples.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowODozM1rOH7El1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowODozM1rOH7El1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMzI1Mw==", "bodyText": "Este archivo hay que restaurarlo", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r531703253", "createdAt": "2020-11-27T17:08:33Z", "author": {"login": "guchito9"}, "path": "example/src/main/java/com/mercadopago/android/px/utils/OneTapSamples.java", "diffHunk": "@@ -188,7 +188,8 @@ public static void addAll(final Collection<Pair<String, MercadoPagoCheckout.Buil\n     private static MercadoPagoCheckout.Builder startOneTapWithAccountMoneyAndCardsDebitCredit() {\n \n         final IPaymentDescriptor payment = getGenericPaymentApproved();\n-        final SplitPaymentProcessor samplePaymentProcessor = new SamplePaymentProcessor(payment);\n+        final SplitPaymentProcessor samplePaymentProcessor = new SamplePaymentProcessor(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5bab21c1ba53350c0dfcb0d00d30bbc1502980c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTEwMDQxOnYy", "diffSide": "RIGHT", "path": "gradle.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowODo1MVrOH7EmSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowODo1MVrOH7EmSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMzM2OA==", "bodyText": "Esto voy a restaurarlo", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r531703368", "createdAt": "2020-11-27T17:08:51Z", "author": {"login": "guchito9"}, "path": "gradle.properties", "diffHunk": "@@ -30,7 +30,7 @@ okhttp=3.12.10\n gson=2.8.5\n retrofit=2.6.4\n # Other PX libs\n-cardDrawer=2.+\n+cardDrawer=LOCAL-2.10.0-2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5bab21c1ba53350c0dfcb0d00d30bbc1502980c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTEwMTU1OnYy", "diffSide": "RIGHT", "path": "px-checkout/build.gradle", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowOToyM1rOH7EnDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowOToyM1rOH7EnDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMzU2Ng==", "bodyText": "Esto voy a restaurarlo", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r531703566", "createdAt": "2020-11-27T17:09:23Z", "author": {"login": "guchito9"}, "path": "px-checkout/build.gradle", "diffHunk": "@@ -53,7 +53,9 @@ dependencies {\n \n     implementation \"com.google.code.gson:gson:$gson\"\n     implementation \"com.mercadolibre.android:ui:$ui\"\n-    implementation \"com.mercadolibre.android:carddrawer:$cardDrawer\"\n+    implementation(\"com.mercadolibre.android:carddrawer:$cardDrawer\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5bab21c1ba53350c0dfcb0d00d30bbc1502980c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTEwMjI2OnYy", "diffSide": "RIGHT", "path": "px-services/src/main/java/com/mercadopago/android/px/internal/services/CheckoutService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowOTozN1rOH7Endw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzowOTozN1rOH7Endw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMzY3MQ==", "bodyText": "Esto voy a restaurarlo", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r531703671", "createdAt": "2020-11-27T17:09:37Z", "author": {"login": "guchito9"}, "path": "px-services/src/main/java/com/mercadopago/android/px/internal/services/CheckoutService.java", "diffHunk": "@@ -20,7 +20,7 @@\n     String CHECKOUT_VERSION = \"v2\";\n     String ENVIRONMENT = BuildConfig.API_ENVIRONMENT_NEW;\n \n-    @POST(ENVIRONMENT + \"/px_mobile/\" + CHECKOUT_VERSION + \"/checkout\")\n+    @POST(\"https://run.mocky.io/v3/7188ceee-ed84-49e9-b303-a65d58ec3acb/\" + ENVIRONMENT + \"/px_mobile/\" + CHECKOUT_VERSION + \"/checkout\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5bab21c1ba53350c0dfcb0d00d30bbc1502980c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTExMDU4OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/AccountMoneyFragment.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzoxMzowOVrOH7EsBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzoxMzowOVrOH7EsBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwNDgzNg==", "bodyText": "ac\u00e1 podemos usar el instance.also.{ }", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r531704836", "createdAt": "2020-11-27T17:13:09Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/AccountMoneyFragment.kt", "diffHunk": "@@ -0,0 +1,44 @@\n+package com.mercadopago.android.px.internal.features.express.slider\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.fragment.app.Fragment\n+import com.meli.android.carddrawer.model.CardDrawerView\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.viewmodel.drawables.AccountMoneyDrawableFragmentItem\n+\n+internal open class AccountMoneyFragment : PaymentMethodFragment<AccountMoneyDrawableFragmentItem>() {\n+\n+    private lateinit var cardView: CardDrawerView\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+        savedInstanceState: Bundle?): View? {\n+        val view = inflater.inflate(getLayout(), container, false)\n+        cardView = view.findViewById(R.id.card)\n+        cardView.show(model.card)\n+        return view\n+    }\n+\n+    protected open fun getLayout() = R.layout.px_fragment_account_money\n+\n+    override fun disable() {\n+        super.disable()\n+        model.card.disable()\n+        storeModel(model)\n+        cardView.show(model.card)\n+    }\n+\n+    override fun getAccessibilityContentDescription(): String {\n+        return model.description\n+    }\n+\n+    companion object {\n+        @JvmStatic fun getInstance(model: AccountMoneyDrawableFragmentItem): Fragment {\n+            val instance = AccountMoneyFragment()\n+            instance.storeModel(model)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5bab21c1ba53350c0dfcb0d00d30bbc1502980c"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTExMTcxOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/AccountMoneyLowResFragment.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzoxMzo0NVrOH7EssA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzoxMzo0NVrOH7EssA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwNTAwOA==", "bodyText": "idem anterior", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r531705008", "createdAt": "2020-11-27T17:13:45Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/AccountMoneyLowResFragment.kt", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.mercadopago.android.px.internal.features.express.slider\n+\n+import androidx.fragment.app.Fragment\n+import com.mercadopago.android.px.R\n+import com.mercadopago.android.px.internal.viewmodel.drawables.AccountMoneyDrawableFragmentItem\n+\n+internal class AccountMoneyLowResFragment : AccountMoneyFragment() {\n+\n+    override fun getLayout() = R.layout.px_fragment_account_money_low_res\n+\n+    companion object {\n+        @JvmStatic fun getInstance(model: AccountMoneyDrawableFragmentItem): Fragment {\n+            val instance = AccountMoneyLowResFragment()\n+            instance.storeModel(model)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5bab21c1ba53350c0dfcb0d00d30bbc1502980c"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTEzMzUxOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/AccountMoneyDrawableFragmentItem.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzoyMzo0N1rOH7E5Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNzoyMzo0N1rOH7E5Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwODE3OA==", "bodyText": "No lo podemos mover arriba en la clase?", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r531708178", "createdAt": "2020-11-27T17:23:47Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/AccountMoneyDrawableFragmentItem.kt", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.mercadopago.android.px.internal.viewmodel.drawables\n+\n+import android.os.Parcel\n+import androidx.fragment.app.Fragment\n+import com.mercadopago.android.px.internal.util.KParcelable\n+import com.mercadopago.android.px.internal.util.parcelableCreator\n+import com.mercadopago.android.px.internal.viewmodel.CardUiConfiguration\n+\n+internal class AccountMoneyDrawableFragmentItem : DrawableFragmentItem, KParcelable {\n+\n+    val card: CardUiConfiguration\n+\n+    constructor(parameters: Parameters, card: CardUiConfiguration) : super(parameters) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5bab21c1ba53350c0dfcb0d00d30bbc1502980c"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5OTY1NjUxOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/generic_modal/Actionable.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjowNDoyNVrOISItVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjowNDoyNVrOISItVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTg4Nzk1Ng==", "bodyText": "Esto lo podemos cambiar por un check(){}?", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r555887956", "createdAt": "2021-01-12T16:04:25Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/generic_modal/Actionable.kt", "diffHunk": "@@ -1,34 +1,17 @@\n package com.mercadopago.android.px.internal.features.generic_modal\n \n-import android.os.Parcel\n-import com.mercadopago.android.px.internal.util.KParcelable\n-import com.mercadopago.android.px.internal.util.parcelableCreator\n-import java.lang.IllegalStateException\n+import android.os.Parcelable\n+import kotlinx.android.parcel.Parcelize\n \n+@Parcelize\n data class Actionable(\n     val label: String,\n     val deepLink: String?,\n-    @ActionType val action: String?) : KParcelable {\n+    @ActionType val action: String?) : Parcelable {\n \n     init {\n         if (deepLink.isNullOrEmpty() && action.isNullOrEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e5ca045ed1485e34158967f54d5b50bd619d28b"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5OTcxMjgzOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/PaymentMethodDrawableItemMapper.kt", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjoxNjo0NFrOISJQAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjoxNjo0NFrOISJQAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTg5NjgzMg==", "bodyText": "Hace falta hacer esto? CardUiMapper no es un object? En todo caso lo podemos inyectar.", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r555896832", "createdAt": "2021-01-12T16:16:44Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/PaymentMethodDrawableItemMapper.kt", "diffHunk": "@@ -1,53 +1,76 @@\n package com.mercadopago.android.px.internal.viewmodel.drawables\n \n-import android.content.Context\n+import com.meli.android.carddrawer.configuration.CardDrawerStyle\n+import com.mercadopago.android.px.internal.extensions.runIfNull\n+import com.mercadopago.android.px.internal.features.generic_modal.ActionType\n+import com.mercadopago.android.px.internal.features.generic_modal.FromModalToGenericDialogItem\n+import com.mercadopago.android.px.internal.features.generic_modal.GenericDialogItem\n import com.mercadopago.android.px.internal.repository.ChargeRepository\n import com.mercadopago.android.px.internal.repository.DisabledPaymentMethodRepository\n+import com.mercadopago.android.px.internal.repository.InitRepository\n import com.mercadopago.android.px.internal.util.TextUtil\n-import com.mercadopago.android.px.internal.viewmodel.DisableConfiguration\n import com.mercadopago.android.px.internal.viewmodel.mappers.CardUiMapper\n import com.mercadopago.android.px.internal.viewmodel.mappers.NonNullMapper\n import com.mercadopago.android.px.model.CustomSearchItem\n import com.mercadopago.android.px.model.ExpressMetadata\n-import java.util.*\n+import com.mercadopago.android.px.model.internal.InitResponse\n+import com.mercadopago.android.px.model.one_tap.CheckoutBehaviour\n+import kotlinx.coroutines.runBlocking\n \n internal class PaymentMethodDrawableItemMapper(\n     private val chargeRepository: ChargeRepository,\n-    private val disabledPaymentMethodRepository: DisabledPaymentMethodRepository? = null,\n-    context: Context? = null) : NonNullMapper<ExpressMetadata, DrawableFragmentItem?>() {\n+    private val initRepository: InitRepository,\n+    private val disabledPaymentMethodRepository: DisabledPaymentMethodRepository\n+) : NonNullMapper<ExpressMetadata, DrawableFragmentItem?>() {\n \n-    private val disableConfiguration = context?.let { DisableConfiguration(it) }\n-    private var customSearchItems: List<CustomSearchItem> = Collections.emptyList()\n+    private var initResponse: InitResponse? = null\n \n     override fun map(expressMetadata: ExpressMetadata): DrawableFragmentItem? {\n-        val parameters = getParameters(expressMetadata)\n-\n-        return when {\n-            expressMetadata.isCard -> SavedCardDrawableFragmentItem(parameters, expressMetadata.paymentMethodId,\n-                CardUiMapper(disableConfiguration).map(expressMetadata.card.displayInfo))\n-            expressMetadata.isAccountMoney -> AccountMoneyDrawableFragmentItem(parameters)\n-            expressMetadata.isConsumerCredits ->\n-                ConsumerCreditsDrawableFragmentItem(parameters, expressMetadata.consumerCredits)\n-            expressMetadata.isNewCard || expressMetadata.isOfflineMethods ->\n-                OtherPaymentMethodFragmentItem(parameters, expressMetadata.newCard, expressMetadata.offlineMethods)\n-            else -> null\n+        initResponse.runIfNull {\n+            //Ac\u00e1 asumimos que est\u00e1 cacheada la respuesta de init como en absolutamente todos lados salvo checkoutActivity\n+            runBlocking {\n+                initResponse = initRepository.loadInitResponse()\n+            }\n+        }\n+        return initResponse?.let { initResponse ->\n+            val genericDialogItem = expressMetadata.getBehaviour(CheckoutBehaviour.Type.TAP_CARD)?.modal?.let { modal ->\n+                initResponse.modals[modal]?.let {\n+                    FromModalToGenericDialogItem(ActionType.DISMISS, modal).map(it)\n+                }\n+            }\n+            val parameters = getParameters(expressMetadata, initResponse.customSearchItems, genericDialogItem)\n+            val cardUiMapper = CardUiMapper", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e5ca045ed1485e34158967f54d5b50bd619d28b"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5OTcyMTE5OnYy", "diffSide": "RIGHT", "path": "px-services/src/main/java/com/mercadopago/android/px/internal/services/CheckoutService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjoxODozOVrOISJVPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjoyMToxNVrOISJcvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTg5ODE3Mw==", "bodyText": "Esto lo vamos a sacar antes de mergearlo?", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r555898173", "createdAt": "2021-01-12T16:18:39Z", "author": {"login": "jorGonzalez291292"}, "path": "px-services/src/main/java/com/mercadopago/android/px/internal/services/CheckoutService.java", "diffHunk": "@@ -20,7 +20,7 @@\n     String CHECKOUT_VERSION = \"v2\";\n     String ENVIRONMENT = BuildConfig.API_ENVIRONMENT_NEW;\n \n-    @POST(ENVIRONMENT + \"/px_mobile/\" + CHECKOUT_VERSION + \"/checkout\")\n+    @POST(\"https://run.mocky.io/v3/f2f3e82a-d2d2-43b1-a767-24f8b9cbe935/\" + ENVIRONMENT + \"/px_mobile/\" + CHECKOUT_VERSION + \"/checkout\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e5ca045ed1485e34158967f54d5b50bd619d28b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTkwMDA5NQ==", "bodyText": "Si :P", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r555900095", "createdAt": "2021-01-12T16:21:15Z", "author": {"login": "guchito9"}, "path": "px-services/src/main/java/com/mercadopago/android/px/internal/services/CheckoutService.java", "diffHunk": "@@ -20,7 +20,7 @@\n     String CHECKOUT_VERSION = \"v2\";\n     String ENVIRONMENT = BuildConfig.API_ENVIRONMENT_NEW;\n \n-    @POST(ENVIRONMENT + \"/px_mobile/\" + CHECKOUT_VERSION + \"/checkout\")\n+    @POST(\"https://run.mocky.io/v3/f2f3e82a-d2d2-43b1-a767-24f8b9cbe935/\" + ENVIRONMENT + \"/px_mobile/\" + CHECKOUT_VERSION + \"/checkout\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTg5ODE3Mw=="}, "originalCommit": {"oid": "6e5ca045ed1485e34158967f54d5b50bd619d28b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5OTc0MzcxOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/PaymentMethodDrawableItemMapper.kt", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjoyMzozM1rOISJjUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNjoyMzozM1rOISJjUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTkwMTc3OA==", "bodyText": "creo que un takeif va a quedar mas cheto ac\u00e1", "url": "https://github.com/mercadopago/px-android/pull/2368#discussion_r555901778", "createdAt": "2021-01-12T16:23:33Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/PaymentMethodDrawableItemMapper.kt", "diffHunk": "@@ -1,53 +1,76 @@\n package com.mercadopago.android.px.internal.viewmodel.drawables\n \n-import android.content.Context\n+import com.meli.android.carddrawer.configuration.CardDrawerStyle\n+import com.mercadopago.android.px.internal.extensions.runIfNull\n+import com.mercadopago.android.px.internal.features.generic_modal.ActionType\n+import com.mercadopago.android.px.internal.features.generic_modal.FromModalToGenericDialogItem\n+import com.mercadopago.android.px.internal.features.generic_modal.GenericDialogItem\n import com.mercadopago.android.px.internal.repository.ChargeRepository\n import com.mercadopago.android.px.internal.repository.DisabledPaymentMethodRepository\n+import com.mercadopago.android.px.internal.repository.InitRepository\n import com.mercadopago.android.px.internal.util.TextUtil\n-import com.mercadopago.android.px.internal.viewmodel.DisableConfiguration\n import com.mercadopago.android.px.internal.viewmodel.mappers.CardUiMapper\n import com.mercadopago.android.px.internal.viewmodel.mappers.NonNullMapper\n import com.mercadopago.android.px.model.CustomSearchItem\n import com.mercadopago.android.px.model.ExpressMetadata\n-import java.util.*\n+import com.mercadopago.android.px.model.internal.InitResponse\n+import com.mercadopago.android.px.model.one_tap.CheckoutBehaviour\n+import kotlinx.coroutines.runBlocking\n \n internal class PaymentMethodDrawableItemMapper(\n     private val chargeRepository: ChargeRepository,\n-    private val disabledPaymentMethodRepository: DisabledPaymentMethodRepository? = null,\n-    context: Context? = null) : NonNullMapper<ExpressMetadata, DrawableFragmentItem?>() {\n+    private val initRepository: InitRepository,\n+    private val disabledPaymentMethodRepository: DisabledPaymentMethodRepository\n+) : NonNullMapper<ExpressMetadata, DrawableFragmentItem?>() {\n \n-    private val disableConfiguration = context?.let { DisableConfiguration(it) }\n-    private var customSearchItems: List<CustomSearchItem> = Collections.emptyList()\n+    private var initResponse: InitResponse? = null\n \n     override fun map(expressMetadata: ExpressMetadata): DrawableFragmentItem? {\n-        val parameters = getParameters(expressMetadata)\n-\n-        return when {\n-            expressMetadata.isCard -> SavedCardDrawableFragmentItem(parameters, expressMetadata.paymentMethodId,\n-                CardUiMapper(disableConfiguration).map(expressMetadata.card.displayInfo))\n-            expressMetadata.isAccountMoney -> AccountMoneyDrawableFragmentItem(parameters)\n-            expressMetadata.isConsumerCredits ->\n-                ConsumerCreditsDrawableFragmentItem(parameters, expressMetadata.consumerCredits)\n-            expressMetadata.isNewCard || expressMetadata.isOfflineMethods ->\n-                OtherPaymentMethodFragmentItem(parameters, expressMetadata.newCard, expressMetadata.offlineMethods)\n-            else -> null\n+        initResponse.runIfNull {\n+            //Ac\u00e1 asumimos que est\u00e1 cacheada la respuesta de init como en absolutamente todos lados salvo checkoutActivity\n+            runBlocking {\n+                initResponse = initRepository.loadInitResponse()\n+            }\n+        }\n+        return initResponse?.let { initResponse ->\n+            val genericDialogItem = expressMetadata.getBehaviour(CheckoutBehaviour.Type.TAP_CARD)?.modal?.let { modal ->\n+                initResponse.modals[modal]?.let {\n+                    FromModalToGenericDialogItem(ActionType.DISMISS, modal).map(it)\n+                }\n+            }\n+            val parameters = getParameters(expressMetadata, initResponse.customSearchItems, genericDialogItem)\n+            val cardUiMapper = CardUiMapper\n+            return when {\n+                expressMetadata.isCard -> SavedCardDrawableFragmentItem(parameters, expressMetadata.paymentMethodId,\n+                    cardUiMapper.map(expressMetadata.card.displayInfo))\n+                expressMetadata.isAccountMoney -> expressMetadata.accountMoney.displayInfo.type?.let {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e5ca045ed1485e34158967f54d5b50bd619d28b"}, "originalPosition": 64}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1726, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}