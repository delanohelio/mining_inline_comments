{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMzAxMDU2", "number": 2388, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoxMTo0N1rOE6q40w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxODowNzozMVrOE9uixA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTU1NTM5OnYy", "diffSide": "RIGHT", "path": "example/src/main/java/com/mercadopago/android/px/utils/OneTapSamples.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoxMTo0N1rOH14XhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyMDoyNVrOH14vkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MDEwMQ==", "bodyText": "por que declaramos la public key como est\u00e1tica y no as\u00ed la pref id?", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526260101", "createdAt": "2020-11-18T17:11:47Z", "author": {"login": "cgaggino"}, "path": "example/src/main/java/com/mercadopago/android/px/utils/OneTapSamples.java", "diffHunk": "@@ -579,4 +585,18 @@ private static CheckoutPreference getCheckoutPreferenceWithPayerEmail(\n                 new AdvancedConfiguration.Builder().setProductId(PRODUCT_ID).setExpressPaymentEnable(true)\n                     .build());\n     }\n+\n+    private static MercadoPagoCheckout.Builder startOneTapWithDebitCardInChile() {\n+        final SplitPaymentProcessor samplePaymentProcessor = new SamplePaymentProcessor(\n+            PaymentUtils.getGenericPaymentRejected(),\n+            PaymentUtils.getBusinessPaymentApproved());\n+\n+        return new MercadoPagoCheckout.Builder(ONE_TAP_MERCHANT_WEB_PAY_PUBLIC_KEY, \"589235406-850b749b-4dc3-4510-92ab-37e6e0b51a23\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NjI1Nw==", "bodyText": "pifie", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526266257", "createdAt": "2020-11-18T17:20:25Z", "author": {"login": "jorGonzalez291292"}, "path": "example/src/main/java/com/mercadopago/android/px/utils/OneTapSamples.java", "diffHunk": "@@ -579,4 +585,18 @@ private static CheckoutPreference getCheckoutPreferenceWithPayerEmail(\n                 new AdvancedConfiguration.Builder().setProductId(PRODUCT_ID).setExpressPaymentEnable(true)\n                     .build());\n     }\n+\n+    private static MercadoPagoCheckout.Builder startOneTapWithDebitCardInChile() {\n+        final SplitPaymentProcessor samplePaymentProcessor = new SamplePaymentProcessor(\n+            PaymentUtils.getGenericPaymentRejected(),\n+            PaymentUtils.getBusinessPaymentApproved());\n+\n+        return new MercadoPagoCheckout.Builder(ONE_TAP_MERCHANT_WEB_PAY_PUBLIC_KEY, \"589235406-850b749b-4dc3-4510-92ab-37e6e0b51a23\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MDEwMQ=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTU1ODEyOnYy", "diffSide": "RIGHT", "path": "gradle.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoxMjoxOVrOH14ZLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyMDozNFrOH14wIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MDUyNQ==", "bodyText": "Esto no puede quedar asi, imagino que van a ajustar el filtro de backend, no?", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526260525", "createdAt": "2020-11-18T17:12:19Z", "author": {"login": "cgaggino"}, "path": "gradle.properties", "diffHunk": "@@ -8,7 +8,7 @@ org.gradle.parallel=true\n org.gradle.daemon=true\n org.gradle.jvmargs=-Xmx1g\n # Current lib version\n-version_to_deploy=4.63.0\n+version_to_deploy=4.71.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NjQwMg==", "bodyText": "exacto.", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526266402", "createdAt": "2020-11-18T17:20:34Z", "author": {"login": "jorGonzalez291292"}, "path": "gradle.properties", "diffHunk": "@@ -8,7 +8,7 @@ org.gradle.parallel=true\n org.gradle.daemon=true\n org.gradle.jvmargs=-Xmx1g\n # Current lib version\n-version_to_deploy=4.63.0\n+version_to_deploy=4.71.0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MDUyNQ=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTU2NjExOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoxNDoxMlrOH14eVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyMDo1N1rOH14xLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MTg0NQ==", "bodyText": "le pondria shouldPayWithCvv o withSecurityCode, conceptualmente esta validaci\u00f3n no nos indica si se debe pagar con esc", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526261845", "createdAt": "2020-11-18T17:14:12Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -222,12 +224,37 @@ public void startPayment() {\n         }\n     }\n \n+    private boolean shouldPayWithEsc(@NonNull final CardInformation card) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NjY2OA==", "bodyText": "Dale!", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526266668", "createdAt": "2020-11-18T17:20:57Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -222,12 +224,37 @@ public void startPayment() {\n         }\n     }\n \n+    private boolean shouldPayWithEsc(@NonNull final CardInformation card) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MTg0NQ=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTU3ODIzOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoxNjo0OFrOH14lxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoxNjo0OFrOH14lxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2Mzc1MA==", "bodyText": "por que \"noRecoverable\"? creo que como lo usamos hoy en dia no importa si es recoverable o no porque queda en one tap no?", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526263750", "createdAt": "2020-11-18T17:16:48Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -222,12 +224,37 @@ public void startPayment() {\n         }\n     }\n \n+    private boolean shouldPayWithEsc(@NonNull final CardInformation card) {\n+        final int securityCodeLength = card.getSecurityCodeLength() != null ? card.getSecurityCodeLength() : 0;\n+        return securityCodeLength > 0;\n+    }\n+\n+    private void payWithoutCvv(@NonNull final Card card) {\n+        tokenRepository.createTokenWithoutEsc(Objects.requireNonNull(card)).enqueue(new Callback<Token>() {\n+            @Override\n+            public void success(final Token token) {\n+                pay();\n+            }\n+\n+            @Override\n+            public void failure(final ApiException apiException) {\n+                // No start CVV screen if fail\n+                final String tokenError = new TokenErrorWrapper(apiException).getValue();\n+                handlerWrapper.onPaymentError(MercadoPagoError.createNotRecoverable(tokenError));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTYwMzIxOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyMjoyM1rOH141ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyMzozNVrOH144zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2Nzc3MQ==", "bodyText": "Tiene pinta que pasar\u00eda a ser hasPayerCost, no?", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526267771", "createdAt": "2020-11-18T17:22:23Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -268,8 +294,7 @@ public void failure(final ApiException apiException) {\n     }\n \n     private boolean hasValidSavedCardInfo() {\n-        return userSelectionRepository.hasCardSelected()\n-            && userSelectionRepository.getPayerCost() != null;\n+        return userSelectionRepository.getPayerCost() != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2ODYyMg==", "bodyText": "jajaj sip!", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526268622", "createdAt": "2020-11-18T17:23:35Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -268,8 +294,7 @@ public void failure(final ApiException apiException) {\n     }\n \n     private boolean hasValidSavedCardInfo() {\n-        return userSelectionRepository.hasCardSelected()\n-            && userSelectionRepository.getPayerCost() != null;\n+        return userSelectionRepository.getPayerCost() != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2Nzc3MQ=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTYxMzM2OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyNDo0M1rOH1476A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyODowNFrOH15FWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2OTQxNg==", "bodyText": "tambien queda raro ac\u00e1 el nombre, \"pagar sin cvv\" y lo primero que hace es \"crear token sin esc\", deberia ser crear token sin cvv", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526269416", "createdAt": "2020-11-18T17:24:43Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -222,12 +224,37 @@ public void startPayment() {\n         }\n     }\n \n+    private boolean shouldPayWithEsc(@NonNull final CardInformation card) {\n+        final int securityCodeLength = card.getSecurityCodeLength() != null ? card.getSecurityCodeLength() : 0;\n+        return securityCodeLength > 0;\n+    }\n+\n+    private void payWithoutCvv(@NonNull final Card card) {\n+        tokenRepository.createTokenWithoutEsc(Objects.requireNonNull(card)).enqueue(new Callback<Token>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI3MTgzMw==", "bodyText": "Tenes raz\u00f3n", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526271833", "createdAt": "2020-11-18T17:28:04Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -222,12 +224,37 @@ public void startPayment() {\n         }\n     }\n \n+    private boolean shouldPayWithEsc(@NonNull final CardInformation card) {\n+        final int securityCodeLength = card.getSecurityCodeLength() != null ? card.getSecurityCodeLength() : 0;\n+        return securityCodeLength > 0;\n+    }\n+\n+    private void payWithoutCvv(@NonNull final Card card) {\n+        tokenRepository.createTokenWithoutEsc(Objects.requireNonNull(card)).enqueue(new Callback<Token>() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2OTQxNg=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTYzNzU5OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/TokenizeService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzoyOToyNFrOH15Khg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzozMTo0M1rOH15XBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI3MzE1OA==", "bodyText": "esto estar\u00eda mal, porque se est\u00e1 usando como condici\u00f3n para guardar el esc nuevo, si no ten\u00eda esc y tiene un esc nuevo hay que guardarlo", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526273158", "createdAt": "2020-11-18T17:29:24Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/TokenizeService.java", "diffHunk": "@@ -34,24 +38,44 @@ public TokenizeService(@NonNull final GatewayService gatewayService,\n \n     @Override\n     public MPCall<Token> createToken(@NonNull final Card card) {\n-        return new MPCall<Token>() {\n-            private final String esc =\n-                escManagerBehaviour.getESC(card.getId(), card.getFirstSixDigits(), card.getLastFourDigits());\n+        return callback -> {\n+            final String cardId = Objects.requireNonNull(card.getId());\n+            final String esc = escManagerBehaviour.getESC(cardId, card.getFirstSixDigits(), card.getLastFourDigits());\n \n-            @Override\n-            public void enqueue(final Callback<Token> callback) {\n-                serviceCallWrapp(card.getId(), esc).enqueue(wrap(card, esc, callback));\n-            }\n+            gatewayService.createToken(\n+                paymentSettingRepository.getPublicKey(),\n+                paymentSettingRepository.getPrivateKey(),\n+                SavedESCCardToken.createWithEsc(cardId, esc, device)).enqueue(wrap(card, esc, callback));\n+        };\n+    }\n+\n+    @Override\n+    public MPCall<Token> createTokenWithoutEsc(@NonNull final Card card) {\n+        return callback -> {\n+            final SavedCardToken savedCardToken = new SavedCardToken(Objects.requireNonNull(card.getId()));\n+            savedCardToken.setDevice(device);\n+\n+            gatewayService.createToken(\n+                paymentSettingRepository.getPublicKey(),\n+                paymentSettingRepository.getPrivateKey(),\n+                savedCardToken).enqueue(wrap(card, null, callback));\n         };\n     }\n \n-    /* default */ Callback<Token> wrap(@NonNull final Card card, final String esc, final Callback<Token> callback) {\n+    /* default */ Callback<Token> wrap(@NonNull final Card card, @Nullable final String esc,\n+        final Callback<Token> callback) {\n+\n+        final boolean hasEsc = esc != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI3NDU1OQ==", "bodyText": "aaah entiendo... lo dejo separado en dos wrap distintos.", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526274559", "createdAt": "2020-11-18T17:30:28Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/TokenizeService.java", "diffHunk": "@@ -34,24 +38,44 @@ public TokenizeService(@NonNull final GatewayService gatewayService,\n \n     @Override\n     public MPCall<Token> createToken(@NonNull final Card card) {\n-        return new MPCall<Token>() {\n-            private final String esc =\n-                escManagerBehaviour.getESC(card.getId(), card.getFirstSixDigits(), card.getLastFourDigits());\n+        return callback -> {\n+            final String cardId = Objects.requireNonNull(card.getId());\n+            final String esc = escManagerBehaviour.getESC(cardId, card.getFirstSixDigits(), card.getLastFourDigits());\n \n-            @Override\n-            public void enqueue(final Callback<Token> callback) {\n-                serviceCallWrapp(card.getId(), esc).enqueue(wrap(card, esc, callback));\n-            }\n+            gatewayService.createToken(\n+                paymentSettingRepository.getPublicKey(),\n+                paymentSettingRepository.getPrivateKey(),\n+                SavedESCCardToken.createWithEsc(cardId, esc, device)).enqueue(wrap(card, esc, callback));\n+        };\n+    }\n+\n+    @Override\n+    public MPCall<Token> createTokenWithoutEsc(@NonNull final Card card) {\n+        return callback -> {\n+            final SavedCardToken savedCardToken = new SavedCardToken(Objects.requireNonNull(card.getId()));\n+            savedCardToken.setDevice(device);\n+\n+            gatewayService.createToken(\n+                paymentSettingRepository.getPublicKey(),\n+                paymentSettingRepository.getPrivateKey(),\n+                savedCardToken).enqueue(wrap(card, null, callback));\n         };\n     }\n \n-    /* default */ Callback<Token> wrap(@NonNull final Card card, final String esc, final Callback<Token> callback) {\n+    /* default */ Callback<Token> wrap(@NonNull final Card card, @Nullable final String esc,\n+        final Callback<Token> callback) {\n+\n+        final boolean hasEsc = esc != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI3MzE1OA=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI3NjM1OA==", "bodyText": "creo que lo m\u00e1s sano va a ser hacer distintas cosas para el flujo con esc y sin esc en vez de generalizar el wrapper del callback", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526276358", "createdAt": "2020-11-18T17:31:43Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/TokenizeService.java", "diffHunk": "@@ -34,24 +38,44 @@ public TokenizeService(@NonNull final GatewayService gatewayService,\n \n     @Override\n     public MPCall<Token> createToken(@NonNull final Card card) {\n-        return new MPCall<Token>() {\n-            private final String esc =\n-                escManagerBehaviour.getESC(card.getId(), card.getFirstSixDigits(), card.getLastFourDigits());\n+        return callback -> {\n+            final String cardId = Objects.requireNonNull(card.getId());\n+            final String esc = escManagerBehaviour.getESC(cardId, card.getFirstSixDigits(), card.getLastFourDigits());\n \n-            @Override\n-            public void enqueue(final Callback<Token> callback) {\n-                serviceCallWrapp(card.getId(), esc).enqueue(wrap(card, esc, callback));\n-            }\n+            gatewayService.createToken(\n+                paymentSettingRepository.getPublicKey(),\n+                paymentSettingRepository.getPrivateKey(),\n+                SavedESCCardToken.createWithEsc(cardId, esc, device)).enqueue(wrap(card, esc, callback));\n+        };\n+    }\n+\n+    @Override\n+    public MPCall<Token> createTokenWithoutEsc(@NonNull final Card card) {\n+        return callback -> {\n+            final SavedCardToken savedCardToken = new SavedCardToken(Objects.requireNonNull(card.getId()));\n+            savedCardToken.setDevice(device);\n+\n+            gatewayService.createToken(\n+                paymentSettingRepository.getPublicKey(),\n+                paymentSettingRepository.getPrivateKey(),\n+                savedCardToken).enqueue(wrap(card, null, callback));\n         };\n     }\n \n-    /* default */ Callback<Token> wrap(@NonNull final Card card, final String esc, final Callback<Token> callback) {\n+    /* default */ Callback<Token> wrap(@NonNull final Card card, @Nullable final String esc,\n+        final Callback<Token> callback) {\n+\n+        final boolean hasEsc = esc != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI3MzE1OA=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTcwNTU0OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/events/TokenFrictionEventTracker.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzozNjoyMFrOH153kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzozNjoyMFrOH153kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI4NDY4OA==", "bodyText": "deberia extender de FrictionEventTracker", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526284688", "createdAt": "2020-11-18T17:36:20Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/events/TokenFrictionEventTracker.kt", "diffHunk": "@@ -0,0 +1,16 @@\n+package com.mercadopago.android.px.tracking.internal.events\n+\n+import com.mercadopago.android.px.tracking.internal.events.FrictionEventTracker.Companion.with\n+\n+class TokenFrictionEventTracker {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTcwOTQxOnYy", "diffSide": "RIGHT", "path": "px-services/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzozNjo0MVrOH155sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzo0MzowNlrOH16eng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI4NTIzMg==", "bodyText": "Recordar de revertir esto", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526285232", "createdAt": "2020-11-18T17:36:41Z", "author": {"login": "cgaggino"}, "path": "px-services/build.gradle", "diffHunk": "@@ -12,8 +12,8 @@ android {\n \n     buildTypes {\n         debug {\n-            buildConfigField \"String\", \"API_ENVIRONMENT\", \"\\\"v1\\\"\"\n-            buildConfigField \"String\", \"API_ENVIRONMENT_NEW\", \"\\\"production\\\"\"\n+            buildConfigField \"String\", \"API_ENVIRONMENT\", \"\\\"alpha\\\"\"\n+            buildConfigField \"String\", \"API_ENVIRONMENT_NEW\", \"\\\"alpha\\\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI5NDY4Ng==", "bodyText": "Si!", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526294686", "createdAt": "2020-11-18T17:43:06Z", "author": {"login": "jorGonzalez291292"}, "path": "px-services/build.gradle", "diffHunk": "@@ -12,8 +12,8 @@ android {\n \n     buildTypes {\n         debug {\n-            buildConfigField \"String\", \"API_ENVIRONMENT\", \"\\\"v1\\\"\"\n-            buildConfigField \"String\", \"API_ENVIRONMENT_NEW\", \"\\\"production\\\"\"\n+            buildConfigField \"String\", \"API_ENVIRONMENT\", \"\\\"alpha\\\"\"\n+            buildConfigField \"String\", \"API_ENVIRONMENT_NEW\", \"\\\"alpha\\\"\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI4NTIzMg=="}, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTcxNzIzOnYy", "diffSide": "RIGHT", "path": "px-services/src/main/java/com/mercadopago/android/px/model/SavedCardToken.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzozNzoyNVrOH15_LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzozNzoyNVrOH15_LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI4NjYzNg==", "bodyText": "no vamos a usar un nuevo modelo al final sin securityCode?", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526286636", "createdAt": "2020-11-18T17:37:25Z", "author": {"login": "cgaggino"}, "path": "px-services/src/main/java/com/mercadopago/android/px/model/SavedCardToken.java", "diffHunk": "@@ -12,11 +12,16 @@\n     private String securityCode;\n     private Device device;\n \n-    public SavedCardToken(String cardId, String securityCode) {\n+    public SavedCardToken(final String cardId, final String securityCode) {\n         this.cardId = cardId;\n         this.securityCode = securityCode;\n     }\n \n+    public SavedCardToken(final String cardId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48860932437358f9f3166c28a0e0e3c6df33e984"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDIwMzIwOnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/events/TokenFrictionEventTracker.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxOTozMjowMVrOH1-v-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDowMToyOVrOH1_2TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2NDY2Ng==", "bodyText": "deberia usar el constructor de TokenFrictionEventTracker en vez el est\u00e1tico del padre, ac\u00e1 estas devolviendo siempre un FrictionEventTracker, queda medio raro mas que nada", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526364666", "createdAt": "2020-11-18T19:32:01Z", "author": {"login": "cgaggino"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/events/TokenFrictionEventTracker.kt", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.mercadopago.android.px.tracking.internal.events\n+\n+class TokenFrictionEventTracker private constructor() : FrictionEventTracker(\n+    TOKEN_FRICTION_PATH,\n+    Id.TOKEN_API_ERROR,\n+    Style.NON_SCREEN) {\n+\n+    companion object {\n+        private const val TOKEN_FRICTION_PATH = \"/px_checkout/create_token\"\n+\n+        @JvmStatic\n+        fun create(error: String) = with(TOKEN_FRICTION_PATH, Id.TOKEN_API_ERROR, Style.NON_SCREEN, error)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "320d17f93cd043487687d383dd231bb0eb74c740"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4MjY2OA==", "bodyText": "Listo!", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r526382668", "createdAt": "2020-11-18T20:01:29Z", "author": {"login": "jorGonzalez291292"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/tracking/internal/events/TokenFrictionEventTracker.kt", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.mercadopago.android.px.tracking.internal.events\n+\n+class TokenFrictionEventTracker private constructor() : FrictionEventTracker(\n+    TOKEN_FRICTION_PATH,\n+    Id.TOKEN_API_ERROR,\n+    Style.NON_SCREEN) {\n+\n+    companion object {\n+        private const val TOKEN_FRICTION_PATH = \"/px_checkout/create_token\"\n+\n+        @JvmStatic\n+        fun create(error: String) = with(TOKEN_FRICTION_PATH, Id.TOKEN_API_ERROR, Style.NON_SCREEN, error)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2NDY2Ng=="}, "originalCommit": {"oid": "320d17f93cd043487687d383dd231bb0eb74c740"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMTYxMTU2OnYy", "diffSide": "RIGHT", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxODowNzozMVrOH6kZpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxODowNzozMVrOH6kZpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE3NTg0Ng==", "bodyText": "Creo que te qued\u00f3 al pedo al final este import", "url": "https://github.com/mercadopago/px-android/pull/2388#discussion_r531175846", "createdAt": "2020-11-26T18:07:31Z", "author": {"login": "guchito9"}, "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/datasource/PaymentService.java", "diffHunk": "@@ -51,6 +52,7 @@\n import java.util.Arrays;\n import java.util.Collections;\n import java.util.List;\n+import java.util.Objects;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "450fb76304251fab43a120cf6af13ea0bfea4e56"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1740, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}