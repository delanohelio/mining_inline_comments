{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3ODM4NjM1", "number": 36, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDo1MTo0MVrOEOhmPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNTo0ODo0NFrOEQ5fhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjY1OTgxOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/DBWorkload.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDo1MTo0MVrOGxuMXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNTozMjo1NVrOGxu6Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDIzNw==", "bodyText": "Rename these to startWarehouseIdForShard and totalWarehousesAcrossShards", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454790237", "createdAt": "2020-07-15T04:51:41Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -60,6 +60,8 @@\n \n     private static int newOrderTxnId = -1;\n     private static int numWarehouses = 10;\n+    private static int startWarehouseId = -1;\n+    private static int totalWarehousesAcrossExecutions = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgwMTk4Nw==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454801987", "createdAt": "2020-07-15T05:32:55Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -60,6 +60,8 @@\n \n     private static int newOrderTxnId = -1;\n     private static int numWarehouses = 10;\n+    private static int startWarehouseId = -1;\n+    private static int totalWarehousesAcrossExecutions = 10;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDIzNw=="}, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjY2MDQ2OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/WorkloadConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDo1MjowOVrOGxuMyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNTozNjo1NFrOGxu-sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDM0Ng==", "bodyText": "Comment that this is the number of warehouses (or better yet rename the variable)", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454790346", "createdAt": "2020-07-15T04:52:09Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/WorkloadConfiguration.java", "diffHunk": "@@ -48,7 +48,9 @@ public void setBenchmarkName(String benchmarkName) {\n   private String db_username;\n   private String db_password;\n   private String db_driver;\n-  private double scaleFactor = 1.0;\n+  private int scaleFactor = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgwMzEyMg==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454803122", "createdAt": "2020-07-15T05:36:54Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/WorkloadConfiguration.java", "diffHunk": "@@ -48,7 +48,9 @@ public void setBenchmarkName(String benchmarkName) {\n   private String db_username;\n   private String db_password;\n   private String db_driver;\n-  private double scaleFactor = 1.0;\n+  private int scaleFactor = -1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDM0Ng=="}, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjY2MTAyOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/api/BenchmarkModule.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDo1MjoyN1rOGxuNJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNTozNzowMFrOGxu-yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDQzNg==", "bodyText": "Rebase should take this out", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454790436", "createdAt": "2020-07-15T04:52:27Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/BenchmarkModule.java", "diffHunk": "@@ -135,6 +137,20 @@ public final HikariDataSource getDataSource() {\n         return listDataSource.get(r);\n     }\n \n+    public final Connection makeConnection() throws SQLException {\n+        java.util.Properties props = new java.util.Properties();\n+        props.put(\"user\", workConf.getDBUsername());\n+        props.put(\"password\", workConf.getDBPassword());\n+        props.put(\"reWriteBatchedInserts\", \"true\");\n+\n+        int r = dataSourceCounter.getAndIncrement() % workConf.getNodes().size();\n+\n+        String connectStr = String.format(\"jdbc:postgresql://%s:%d/%s\", workConf.getNodes().get(r),\n+            workConf.getPort(),\n+            workConf.getDBName());\n+        return DriverManager.getConnection(connectStr, props);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgwMzE0NA==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454803144", "createdAt": "2020-07-15T05:37:00Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/api/BenchmarkModule.java", "diffHunk": "@@ -135,6 +137,20 @@ public final HikariDataSource getDataSource() {\n         return listDataSource.get(r);\n     }\n \n+    public final Connection makeConnection() throws SQLException {\n+        java.util.Properties props = new java.util.Properties();\n+        props.put(\"user\", workConf.getDBUsername());\n+        props.put(\"password\", workConf.getDBPassword());\n+        props.put(\"reWriteBatchedInserts\", \"true\");\n+\n+        int r = dataSourceCounter.getAndIncrement() % workConf.getNodes().size();\n+\n+        String connectStr = String.format(\"jdbc:postgresql://%s:%d/%s\", workConf.getNodes().get(r),\n+            workConf.getPort(),\n+            workConf.getDBName());\n+        return DriverManager.getConnection(connectStr, props);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDQzNg=="}, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjY2MTM0OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCBenchmark.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDo1Mjo0MVrOGxuNVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNTo0MDoxNVrOGxvCow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDQ4NA==", "bodyText": "Comment on what this array stores.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454790484", "createdAt": "2020-07-15T04:52:41Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCBenchmark.java", "diffHunk": "@@ -122,9 +123,8 @@ protected Package getProcedurePackageImpl() {\n \t\t\t\tTPCCWorker terminal = new TPCCWorker(this, workerId++,\n \t\t\t\t\t\tw_id, lowerDistrictId, upperDistrictId,\n \t\t\t\t\t\tnumWarehouses);\n-\t\t\t\tterminals[lowerTerminalId + terminalId] = terminal;\n+\t\t\t\tterminals[k++] = terminal;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgwNDEzMQ==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r454804131", "createdAt": "2020-07-15T05:40:15Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCBenchmark.java", "diffHunk": "@@ -122,9 +123,8 @@ protected Package getProcedurePackageImpl() {\n \t\t\t\tTPCCWorker terminal = new TPCCWorker(this, workerId++,\n \t\t\t\t\t\tw_id, lowerDistrictId, upperDistrictId,\n \t\t\t\t\t\tnumWarehouses);\n-\t\t\t\tterminals[lowerTerminalId + terminalId] = terminal;\n+\t\t\t\tterminals[k++] = terminal;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc5MDQ4NA=="}, "originalCommit": {"oid": "a8c55afea5188c63d002c1ff9871bd2a5a09bdba"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzOTA1NjQwOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/DBWorkload.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjowOToxNlrOGyFJGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxOTo1NDowMlrOGyNjnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NjIzMg==", "bodyText": "Prefer having the unit in these metrics. So warmup_time_secs and initial_delay_secs so this is clearer.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r455166232", "createdAt": "2020-07-15T16:09:16Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -155,6 +155,8 @@ public static void main(String[] args) throws Exception {\n         options.addOption(null, \"loaderthreads\", true, \"Number of loader threads (default 10)\");\n         options.addOption(null, \"enableforeignkeys\", true, \"Whether to enable foregin keys\");\n \n+        options.addOption(null, \"warmuptime\", true, \"Warmup time in seconds for the benchmark\");\n+        options.addOption(null, \"initialdelay\", true, \"Delay in seconds for starting the benchmark\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e7b5f0794bc3b3417a5cf91a294362f55ae1566"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMwNDA5Mg==", "bodyText": "i will add secs. But none of the other variables have '_' in them. SO will rename to warmuptimesecs and initialdelaysecs.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r455304092", "createdAt": "2020-07-15T19:54:02Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -155,6 +155,8 @@ public static void main(String[] args) throws Exception {\n         options.addOption(null, \"loaderthreads\", true, \"Number of loader threads (default 10)\");\n         options.addOption(null, \"enableforeignkeys\", true, \"Whether to enable foregin keys\");\n \n+        options.addOption(null, \"warmuptime\", true, \"Warmup time in seconds for the benchmark\");\n+        options.addOption(null, \"initialdelay\", true, \"Delay in seconds for starting the benchmark\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NjIzMg=="}, "originalCommit": {"oid": "0e7b5f0794bc3b3417a5cf91a294362f55ae1566"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzOTA2MjgzOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/DBWorkload.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjoxMTowN1rOGyFNLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxOTo1MzowMlrOGyNhsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzI3OQ==", "bodyText": "Change to say \"Num Warehouses\" instead of \"Scale Factor\"", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r455167279", "createdAt": "2020-07-15T16:11:07Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -333,7 +338,7 @@ public static void main(String[] args) throws Exception {\n             initDebug.put(\"Driver\", wrkld.getDBDriver());\n             initDebug.put(\"URL\", wrkld.getNodes());\n             initDebug.put(\"Isolation\", wrkld.getIsolationString());\n-            initDebug.put(\"Scale Factor\", wrkld.getScaleFactor());\n+            initDebug.put(\"Scale Factor\", wrkld.getNumWarehouses());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e7b5f0794bc3b3417a5cf91a294362f55ae1566"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMwMzYwMQ==", "bodyText": "I already did that.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r455303601", "createdAt": "2020-07-15T19:53:02Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -333,7 +338,7 @@ public static void main(String[] args) throws Exception {\n             initDebug.put(\"Driver\", wrkld.getDBDriver());\n             initDebug.put(\"URL\", wrkld.getNodes());\n             initDebug.put(\"Isolation\", wrkld.getIsolationString());\n-            initDebug.put(\"Scale Factor\", wrkld.getScaleFactor());\n+            initDebug.put(\"Scale Factor\", wrkld.getNumWarehouses());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzI3OQ=="}, "originalCommit": {"oid": "0e7b5f0794bc3b3417a5cf91a294362f55ae1566"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MTU0MTYzOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/DBWorkload.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNTo0NjowOFrOG1Tkjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNjo0Mjo1OVrOG1U0hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0ODM2Nw==", "bodyText": "Lets change message to:\n\"Delaying execution of workload for ... seconds\"", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r458548367", "createdAt": "2020-07-22T05:46:08Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -573,6 +607,11 @@ else if (serial)\n             throw new RuntimeException(\"No StatementDialects is available for \" + bench);\n         }\n \n+        if (argsLine.hasOption(\"initial-delay\")) {\n+            int initialDelay = Integer.parseInt(argsLine.getOptionValue(\"initial-delay\"));\n+            LOG.info(\"Sleeping for \" + initialDelay);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23027da8a5268a28e9bd314aa4defce90e32a086"}, "originalPosition": 167}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU2ODgzNw==", "bodyText": "Done", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r458568837", "createdAt": "2020-07-22T06:42:59Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -573,6 +607,11 @@ else if (serial)\n             throw new RuntimeException(\"No StatementDialects is available for \" + bench);\n         }\n \n+        if (argsLine.hasOption(\"initial-delay\")) {\n+            int initialDelay = Integer.parseInt(argsLine.getOptionValue(\"initial-delay\"));\n+            LOG.info(\"Sleeping for \" + initialDelay);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0ODM2Nw=="}, "originalCommit": {"oid": "23027da8a5268a28e9bd314aa4defce90e32a086"}, "originalPosition": 167}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MTU0NjI4OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/api/BenchmarkModule.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNTo0ODo0NFrOG1Tnfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNjo0Mzo0MlrOG1U1tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0OTExOA==", "bodyText": "Comment on why we do this. Also, lets parametrize this 5000 to the xml conf.", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r458549118", "createdAt": "2020-07-22T05:48:44Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/BenchmarkModule.java", "diffHunk": "@@ -116,6 +116,9 @@ public void createDataSource() throws SQLException {\n         int numConnections =\n             (workConf.getNumDBConnections() + workConf.getNodes().size() - 1) / workConf.getNodes().size();\n         for (String ip : workConf.getNodes()) {\n+            if (listDataSource.size() != 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23027da8a5268a28e9bd314aa4defce90e32a086"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU2OTE0MQ==", "bodyText": "Done", "url": "https://github.com/yugabyte/tpcc/pull/36#discussion_r458569141", "createdAt": "2020-07-22T06:43:42Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/api/BenchmarkModule.java", "diffHunk": "@@ -116,6 +116,9 @@ public void createDataSource() throws SQLException {\n         int numConnections =\n             (workConf.getNumDBConnections() + workConf.getNodes().size() - 1) / workConf.getNodes().size();\n         for (String ip : workConf.getNodes()) {\n+            if (listDataSource.size() != 0) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0OTExOA=="}, "originalCommit": {"oid": "23027da8a5268a28e9bd314aa4defce90e32a086"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 744, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}