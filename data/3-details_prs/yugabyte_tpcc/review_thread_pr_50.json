{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3ODYzNTk1", "number": 50, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODo1MDoyMlrOEnkUfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODo1Mzo0OFrOEnkYiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5OTI0OTg5OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODo1MDoyMlrOHYO6rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOTowOToyOFrOHYPdJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3MjI3MA==", "bodyText": "nit: capitalize sql->SQL, also I think you can put the LANGUAGE clause before AS as it's clearer when reading procedures.", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495172270", "createdAt": "2020-09-25T18:50:22Z", "author": {"login": "m-iancu"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -210,6 +214,33 @@ protected void EnableForeignKeyConstraints(Connection conn) {\n     }\n   }\n \n+  protected void CreatePgSqlProcedures(Connection conn) throws SQLException {\n+    try {\n+      Statement st = conn.createStatement();\n+\n+      StringBuilder argsSb = new StringBuilder();\n+      StringBuilder updateStatements = new StringBuilder();\n+\n+      argsSb.append(\"wid int\");\n+      for (int i = 1; i <= 15; ++i) {\n+        argsSb.append(String.format(\", i%d int, q%d int, y%d int, r%d int\", i, i, i, i));\n+        updateStatements.append(String.format(\n+          \"UPDATE STOCK SET S_QUANTITY = q%d, S_YTD = y%d, S_ORDER_CNT = S_ORDER_CNT + 1, \" +\n+          \"S_REMOTE_CNT = r%d WHERE S_W_ID = wid AND S_I_ID = i%d;\",\n+          i, i, i, i));\n+        String updateStmt =\n+          String.format(\"CREATE PROCEDURE updatestock%d (%s) AS '%s' LANGUAGE sql;\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE4MTA5Mg==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495181092", "createdAt": "2020-09-25T19:09:28Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -210,6 +214,33 @@ protected void EnableForeignKeyConstraints(Connection conn) {\n     }\n   }\n \n+  protected void CreatePgSqlProcedures(Connection conn) throws SQLException {\n+    try {\n+      Statement st = conn.createStatement();\n+\n+      StringBuilder argsSb = new StringBuilder();\n+      StringBuilder updateStatements = new StringBuilder();\n+\n+      argsSb.append(\"wid int\");\n+      for (int i = 1; i <= 15; ++i) {\n+        argsSb.append(String.format(\", i%d int, q%d int, y%d int, r%d int\", i, i, i, i));\n+        updateStatements.append(String.format(\n+          \"UPDATE STOCK SET S_QUANTITY = q%d, S_YTD = y%d, S_ORDER_CNT = S_ORDER_CNT + 1, \" +\n+          \"S_REMOTE_CNT = r%d WHERE S_W_ID = wid AND S_I_ID = i%d;\",\n+          i, i, i, i));\n+        String updateStmt =\n+          String.format(\"CREATE PROCEDURE updatestock%d (%s) AS '%s' LANGUAGE sql;\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3MjI3MA=="}, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5OTI1NTU3OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/procedures/NewOrder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODo1MjoxNFrOHYO-Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOToxMTowNlrOHYPghA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3MzE0Nw==", "bodyText": "nit: why not just i?", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495173147", "createdAt": "2020-09-25T18:52:14Z", "author": {"login": "m-iancu"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/procedures/NewOrder.java", "diffHunk": "@@ -496,6 +513,56 @@ void storeInfo(int[] itemIDs, int[] supplierWhs, int[] orderQuantities,\n     }\n   }\n \n+  void updateStockUsingProcedures(int o_ol_cnt, int w_id,\n+                                  int[] itemIDs, int[] supplierWarehouseIDs,\n+                                  int[] orderQuantities, int[] s_qty_arr,\n+                                  int[] ytd_arr, int[] remote_cnt_arr,\n+                                  Connection conn) throws  SQLException {\n+\n+    Map<Integer, HashSet<Integer>> input = new HashMap<>();\n+    for (int ii = 0; ii < o_ol_cnt; ++ii) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE4MTk1Ng==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495181956", "createdAt": "2020-09-25T19:11:06Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/procedures/NewOrder.java", "diffHunk": "@@ -496,6 +513,56 @@ void storeInfo(int[] itemIDs, int[] supplierWhs, int[] orderQuantities,\n     }\n   }\n \n+  void updateStockUsingProcedures(int o_ol_cnt, int w_id,\n+                                  int[] itemIDs, int[] supplierWarehouseIDs,\n+                                  int[] orderQuantities, int[] s_qty_arr,\n+                                  int[] ytd_arr, int[] remote_cnt_arr,\n+                                  Connection conn) throws  SQLException {\n+\n+    Map<Integer, HashSet<Integer>> input = new HashMap<>();\n+    for (int ii = 0; ii < o_ol_cnt; ++ii) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3MzE0Nw=="}, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5OTI1NjA3OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/procedures/NewOrder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODo1MjoyNFrOHYO-bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOToxMToxMVrOHYPgrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3MzIyOQ==", "bodyText": "ditto", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495173229", "createdAt": "2020-09-25T18:52:24Z", "author": {"login": "m-iancu"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/procedures/NewOrder.java", "diffHunk": "@@ -496,6 +513,56 @@ void storeInfo(int[] itemIDs, int[] supplierWhs, int[] orderQuantities,\n     }\n   }\n \n+  void updateStockUsingProcedures(int o_ol_cnt, int w_id,\n+                                  int[] itemIDs, int[] supplierWarehouseIDs,\n+                                  int[] orderQuantities, int[] s_qty_arr,\n+                                  int[] ytd_arr, int[] remote_cnt_arr,\n+                                  Connection conn) throws  SQLException {\n+\n+    Map<Integer, HashSet<Integer>> input = new HashMap<>();\n+    for (int ii = 0; ii < o_ol_cnt; ++ii) {\n+      int itemId = itemIDs[ii];\n+      int supplierWh = supplierWarehouseIDs[ii];\n+      if (!input.containsKey(supplierWh)) {\n+        input.put(supplierWh, new HashSet<>());\n+      }\n+      input.get(supplierWh).add(itemId);\n+    }\n+\n+    for (Map.Entry<Integer, HashSet<Integer>> entry : input.entrySet()) {\n+      int whId = entry.getKey();\n+      int numEntries = entry.getValue().size();\n+      stmtUpdateStockProcedure =\n+        this.getPreparedStatement(conn, stmtUpdateStockProcedureSQL[numEntries - 1]);\n+\n+      int ii = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE4MTk5Nw==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495181997", "createdAt": "2020-09-25T19:11:11Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/procedures/NewOrder.java", "diffHunk": "@@ -496,6 +513,56 @@ void storeInfo(int[] itemIDs, int[] supplierWhs, int[] orderQuantities,\n     }\n   }\n \n+  void updateStockUsingProcedures(int o_ol_cnt, int w_id,\n+                                  int[] itemIDs, int[] supplierWarehouseIDs,\n+                                  int[] orderQuantities, int[] s_qty_arr,\n+                                  int[] ytd_arr, int[] remote_cnt_arr,\n+                                  Connection conn) throws  SQLException {\n+\n+    Map<Integer, HashSet<Integer>> input = new HashMap<>();\n+    for (int ii = 0; ii < o_ol_cnt; ++ii) {\n+      int itemId = itemIDs[ii];\n+      int supplierWh = supplierWarehouseIDs[ii];\n+      if (!input.containsKey(supplierWh)) {\n+        input.put(supplierWh, new HashSet<>());\n+      }\n+      input.get(supplierWh).add(itemId);\n+    }\n+\n+    for (Map.Entry<Integer, HashSet<Integer>> entry : input.entrySet()) {\n+      int whId = entry.getKey();\n+      int numEntries = entry.getValue().size();\n+      stmtUpdateStockProcedure =\n+        this.getPreparedStatement(conn, stmtUpdateStockProcedureSQL[numEntries - 1]);\n+\n+      int ii = 1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3MzIyOQ=="}, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5OTI2MDI0OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODo1Mzo0OFrOHYPBCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOToxMTozMVrOHYPhRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3Mzg5OA==", "bodyText": "nit: maybe just say CreateSqlProcedures since this isn't Postgres (rather Yugabyte/YSQL).\nDitto about using PGSQL in the summary.", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495173898", "createdAt": "2020-09-25T18:53:48Z", "author": {"login": "m-iancu"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -210,6 +214,33 @@ protected void EnableForeignKeyConstraints(Connection conn) {\n     }\n   }\n \n+  protected void CreatePgSqlProcedures(Connection conn) throws SQLException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE4MjE0OA==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/50#discussion_r495182148", "createdAt": "2020-09-25T19:11:31Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -210,6 +214,33 @@ protected void EnableForeignKeyConstraints(Connection conn) {\n     }\n   }\n \n+  protected void CreatePgSqlProcedures(Connection conn) throws SQLException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3Mzg5OA=="}, "originalCommit": {"oid": "6cd88710943bed1bbfde189fd553360dddf148a6"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 748, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}