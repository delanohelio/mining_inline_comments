{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTIyMTA4", "number": 7, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMTo1Mjo1NFrODs3hGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzoyOTo0OVrODvV5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MzczNTMxOnYy", "diffSide": "RIGHT", "path": "config/workload_all.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMTo1Mjo1NFrOF99nOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjozNjo0MFrOF9-xmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxNjkyMA==", "bodyText": "Any reason to change this default?", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400516920", "createdAt": "2020-03-30T21:52:54Z", "author": {"login": "rkarthik007"}, "path": "config/workload_all.xml", "diffHunk": "@@ -26,8 +26,11 @@\n     \t</transactiontype>\r\n    \t</transactiontypes>\r\n \r\n-    <terminals>2</terminals>\r\n     <scalefactor>2</scalefactor>\r\n+\t<!-- The number of terminals can be a max of 10 per warehouse -->\r\n+    <terminals>20</terminals>\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyNjIzMg==", "bodyText": "Because we are waiting so long and each terminal is not doing much: e.g 30 seconds on average for NewOrder, we would ideally want to increase parallelism to increase performance.\nThe maximum allowed according to specs is 10 per warehouse and we used that.\n\nAlso there are no unwanted transaction failures due to this, so we are fine here.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400526232", "createdAt": "2020-03-30T22:13:32Z", "author": {"login": "psudheer21"}, "path": "config/workload_all.xml", "diffHunk": "@@ -26,8 +26,11 @@\n     \t</transactiontype>\r\n    \t</transactiontypes>\r\n \r\n-    <terminals>2</terminals>\r\n     <scalefactor>2</scalefactor>\r\n+\t<!-- The number of terminals can be a max of 10 per warehouse -->\r\n+    <terminals>20</terminals>\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxNjkyMA=="}, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUzNTk2MA==", "bodyText": "Got it, thanks! Guessing the default number of warehouses is 2, so this looks good.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400535960", "createdAt": "2020-03-30T22:36:40Z", "author": {"login": "rkarthik007"}, "path": "config/workload_all.xml", "diffHunk": "@@ -26,8 +26,11 @@\n     \t</transactiontype>\r\n    \t</transactiontypes>\r\n \r\n-    <terminals>2</terminals>\r\n     <scalefactor>2</scalefactor>\r\n+\t<!-- The number of terminals can be a max of 10 per warehouse -->\r\n+    <terminals>20</terminals>\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxNjkyMA=="}, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4Mzc1MzAzOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/api/Worker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMTo1ODo0NlrOF99x9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNzoyODo0OFrOF-ghDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxOTY3MA==", "bodyText": "It might be good to add a comment on top of this (and the next) function with the TPCC spec and the relevant section that specifies these values.\nAlso, perhaps consider renaming this function with the units at the end, such as: getKeyingTimeMillis() if it is in millis.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400519670", "createdAt": "2020-03-30T21:58:46Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -196,6 +196,51 @@ synchronized public void setCurrStatement(Statement s) {\n         this.currStatement = s;\n     }\n \n+    private long getKeyingTime(TransactionType type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA4ODc4Mg==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r401088782", "createdAt": "2020-03-31T17:28:48Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -196,6 +196,51 @@ synchronized public void setCurrStatement(Statement s) {\n         this.currStatement = s;\n     }\n \n+    private long getKeyingTime(TransactionType type) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxOTY3MA=="}, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4Mzc1OTg2OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/api/Worker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjowMToxNlrOF992ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjoxNDoyMlrOF9-NEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMDgxMA==", "bodyText": "Do we need this variable and the following LOG.info to measure the sleep time? We should get rid of these I feel.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400520810", "createdAt": "2020-03-30T22:01:16Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -282,14 +329,28 @@ public final void run() {\n                     // Do nothing\n             }\n \n+\n             // PART 3: Execute work\n \n             // TODO: Measuring latency when not rate limited is ... a little\n             // weird because if you add more simultaneous clients, you will\n             // increase latency (queue delay) but we do this anyway since it is\n             // useful sometimes\n \n-            long start = pieceOfWork.getStartTime();\n+            if (this.wrkld.getUseKeyingTime()) {\n+                // Wait for the keying time which is a fixed number for every type of transaction.\n+                long keying_time_msecs = getKeyingTime(transactionTypes.getType(pieceOfWork.getType()));\n+                try {\n+                    long start_sleep = System.nanoTime();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyNjYxMA==", "bodyText": "I did this for debugging.\nWOuldn't be part of the final code.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400526610", "createdAt": "2020-03-30T22:14:22Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -282,14 +329,28 @@ public final void run() {\n                     // Do nothing\n             }\n \n+\n             // PART 3: Execute work\n \n             // TODO: Measuring latency when not rate limited is ... a little\n             // weird because if you add more simultaneous clients, you will\n             // increase latency (queue delay) but we do this anyway since it is\n             // useful sometimes\n \n-            long start = pieceOfWork.getStartTime();\n+            if (this.wrkld.getUseKeyingTime()) {\n+                // Wait for the keying time which is a fixed number for every type of transaction.\n+                long keying_time_msecs = getKeyingTime(transactionTypes.getType(pieceOfWork.getType()));\n+                try {\n+                    long start_sleep = System.nanoTime();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMDgxMA=="}, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4Mzc2MDQ4OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/api/Worker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjowMTozMFrOF9921A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjoxNDozOFrOF9-NeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMDkxNg==", "bodyText": "Ditto as above.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400520916", "createdAt": "2020-03-30T22:01:30Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -346,6 +407,18 @@ public final void run() {\n                     // Do nothing\n             }\n \n+            if (this.wrkld.getUseThinkTime()) {\n+                // Sleep for the think time duration.\n+                long think_time_msecs = getThinkTime(transactionTypes.getType(pieceOfWork.getType()));\n+                try {\n+                    long start_sleep = System.nanoTime();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyNjcxMg==", "bodyText": "Debugging. Won't be in the final code.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400526712", "createdAt": "2020-03-30T22:14:38Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -346,6 +407,18 @@ public final void run() {\n                     // Do nothing\n             }\n \n+            if (this.wrkld.getUseThinkTime()) {\n+                // Sleep for the think time duration.\n+                long think_time_msecs = getThinkTime(transactionTypes.getType(pieceOfWork.getType()));\n+                try {\n+                    long start_sleep = System.nanoTime();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMDkxNg=="}, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwOTYzNDI1OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/WorkloadConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzowNzo0MlrOGBtJIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDoyNDo0N1rOGBupuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0MTM3Nw==", "bodyText": "With these defaults, we'll use keying and think time for other workloads like workload_1, workload_2 etc. also. Just want to make sure that it's intentional.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r404441377", "createdAt": "2020-04-06T23:07:42Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/WorkloadConfiguration.java", "diffHunk": "@@ -47,20 +47,23 @@ public void setBenchmarkName(String benchmarkName) {\n \tprivate String db_name;\n \tprivate String db_username;\n \tprivate String db_password;\n-\tprivate String db_driver;\t\n+\tprivate String db_driver;\n \tprivate double scaleFactor = 1.0;\n \tprivate double selectivity = -1.0;\n \tprivate int terminals;\n \tprivate int loaderThreads = ThreadUtil.availableProcessors();\n \tprivate int numTxnTypes;\n     private TraceReader traceReader = null;\n+    private boolean useKeyingTime = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2NjEwNw==", "bodyText": "workload_all should be what we should run now. And all of our defaults should be to make it run easy for that.\nFor the other workloads we can still make it false and then run it.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r404466107", "createdAt": "2020-04-07T00:24:47Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/WorkloadConfiguration.java", "diffHunk": "@@ -47,20 +47,23 @@ public void setBenchmarkName(String benchmarkName) {\n \tprivate String db_name;\n \tprivate String db_username;\n \tprivate String db_password;\n-\tprivate String db_driver;\t\n+\tprivate String db_driver;\n \tprivate double scaleFactor = 1.0;\n \tprivate double selectivity = -1.0;\n \tprivate int terminals;\n \tprivate int loaderThreads = ThreadUtil.availableProcessors();\n \tprivate int numTxnTypes;\n     private TraceReader traceReader = null;\n+    private boolean useKeyingTime = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0MTM3Nw=="}, "originalCommit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwOTY4Mzc3OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzoyOTo0OVrOGBtmsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDoyNjo0M1rOGBurvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0ODk0Ng==", "bodyText": "Please add this to the description as well - since your diff includes more than just the changes for think/keying time.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r404448946", "createdAt": "2020-04-06T23:29:49Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -248,8 +248,8 @@ protected int loadWarehouse(Connection conn, int w_id) {\n \t\t\twarehouse.w_street_1 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_street_2 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_city = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n-\t\t\twarehouse.w_state = TPCCUtil.randomStr(3).toUpperCase();\n-\t\t\twarehouse.w_zip = \"123456789\";\n+\t\t\twarehouse.w_state = TPCCUtil.randomStr(2).toUpperCase();\n+\t\t\twarehouse.w_zip = TPCCUtil.randomNStr(4) + \"11111\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2NjE1NA==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r404466154", "createdAt": "2020-04-07T00:24:57Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -248,8 +248,8 @@ protected int loadWarehouse(Connection conn, int w_id) {\n \t\t\twarehouse.w_street_1 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_street_2 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_city = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n-\t\t\twarehouse.w_state = TPCCUtil.randomStr(3).toUpperCase();\n-\t\t\twarehouse.w_zip = \"123456789\";\n+\t\t\twarehouse.w_state = TPCCUtil.randomStr(2).toUpperCase();\n+\t\t\twarehouse.w_zip = TPCCUtil.randomNStr(4) + \"11111\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0ODk0Ng=="}, "originalCommit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2NjYyMA==", "bodyText": "The comment already had these details/. {point 3 in the message above}", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r404466620", "createdAt": "2020-04-07T00:26:43Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -248,8 +248,8 @@ protected int loadWarehouse(Connection conn, int w_id) {\n \t\t\twarehouse.w_street_1 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_street_2 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_city = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n-\t\t\twarehouse.w_state = TPCCUtil.randomStr(3).toUpperCase();\n-\t\t\twarehouse.w_zip = \"123456789\";\n+\t\t\twarehouse.w_state = TPCCUtil.randomStr(2).toUpperCase();\n+\t\t\twarehouse.w_zip = TPCCUtil.randomNStr(4) + \"11111\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0ODk0Ng=="}, "originalCommit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 735, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}