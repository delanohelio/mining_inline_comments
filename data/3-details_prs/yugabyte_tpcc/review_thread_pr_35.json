{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1Nzk5ODgx", "number": 35, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNToyOToxMFrOEMVf0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNToyOToxMFrOEMVf0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzcwNTc5OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/DBWorkload.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNToyOToxMFrOGuYqAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTozNDowNVrOGvimAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5MTY0OA==", "bodyText": "We should make this a parameter, say something like maxConnectionsPerNode, so that it becomes easy to change this on the fly. Similar for connectionTimeoutMillis below.", "url": "https://github.com/yugabyte/tpcc/pull/35#discussion_r451291648", "createdAt": "2020-07-08T05:29:10Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -264,7 +266,8 @@ public static void main(String[] args) throws Exception {\n             if (xmlConfig.containsKey(\"numDBConnections\")) {\n                 wrkld.setNumDBConnections(xmlConfig.getInt(\"numDBConnections\"));\n             } else {\n-                wrkld.setNumDBConnections(numWarehouses);\n+                // We use a max of 200 connections per node so as to not overwhelm the DB cluster.\n+                wrkld.setNumDBConnections(min(numWarehouses, wrkld.getNodes().size() * 200));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d7435f4b525adffca431043a76636fc1dd2d1e6"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTcyNjc4MQ==", "bodyText": "This is already something that is controlled using the xml config.\nI don't think people would need to change it often and hence can reside in the xml.\nSimilarly connectionTimeoutMillis can be an xml config.", "url": "https://github.com/yugabyte/tpcc/pull/35#discussion_r451726781", "createdAt": "2020-07-08T17:56:17Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -264,7 +266,8 @@ public static void main(String[] args) throws Exception {\n             if (xmlConfig.containsKey(\"numDBConnections\")) {\n                 wrkld.setNumDBConnections(xmlConfig.getInt(\"numDBConnections\"));\n             } else {\n-                wrkld.setNumDBConnections(numWarehouses);\n+                // We use a max of 200 connections per node so as to not overwhelm the DB cluster.\n+                wrkld.setNumDBConnections(min(numWarehouses, wrkld.getNodes().size() * 200));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5MTY0OA=="}, "originalCommit": {"oid": "1d7435f4b525adffca431043a76636fc1dd2d1e6"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyNjA3Ng==", "bodyText": "I was referring to making the 200 value a param in the following expression:\nwrkld.setNumDBConnections(min(numWarehouses, wrkld.getNodes().size() * 200));\n\nWorried that we would not be able to ask anyone to change this if needed. Should we introduce the param as maxConnectionsPerTserver so that its clear what it does, and set the default value to 200?\nWhat do you think @ndeodhar ?", "url": "https://github.com/yugabyte/tpcc/pull/35#discussion_r451826076", "createdAt": "2020-07-08T21:07:54Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -264,7 +266,8 @@ public static void main(String[] args) throws Exception {\n             if (xmlConfig.containsKey(\"numDBConnections\")) {\n                 wrkld.setNumDBConnections(xmlConfig.getInt(\"numDBConnections\"));\n             } else {\n-                wrkld.setNumDBConnections(numWarehouses);\n+                // We use a max of 200 connections per node so as to not overwhelm the DB cluster.\n+                wrkld.setNumDBConnections(min(numWarehouses, wrkld.getNodes().size() * 200));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5MTY0OA=="}, "originalCommit": {"oid": "1d7435f4b525adffca431043a76636fc1dd2d1e6"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5MzU5NA==", "bodyText": "Agree, the max should be configurable instead of being hardcoded.", "url": "https://github.com/yugabyte/tpcc/pull/35#discussion_r452493594", "createdAt": "2020-07-09T21:13:46Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -264,7 +266,8 @@ public static void main(String[] args) throws Exception {\n             if (xmlConfig.containsKey(\"numDBConnections\")) {\n                 wrkld.setNumDBConnections(xmlConfig.getInt(\"numDBConnections\"));\n             } else {\n-                wrkld.setNumDBConnections(numWarehouses);\n+                // We use a max of 200 connections per node so as to not overwhelm the DB cluster.\n+                wrkld.setNumDBConnections(min(numWarehouses, wrkld.getNodes().size() * 200));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5MTY0OA=="}, "originalCommit": {"oid": "1d7435f4b525adffca431043a76636fc1dd2d1e6"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzA0MA==", "bodyText": "Sync'd offline with Sudheer. Since we already have a param to control numDBConnections, we don't need another one for maxConnectionsPerNode", "url": "https://github.com/yugabyte/tpcc/pull/35#discussion_r452503040", "createdAt": "2020-07-09T21:34:05Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -264,7 +266,8 @@ public static void main(String[] args) throws Exception {\n             if (xmlConfig.containsKey(\"numDBConnections\")) {\n                 wrkld.setNumDBConnections(xmlConfig.getInt(\"numDBConnections\"));\n             } else {\n-                wrkld.setNumDBConnections(numWarehouses);\n+                // We use a max of 200 connections per node so as to not overwhelm the DB cluster.\n+                wrkld.setNumDBConnections(min(numWarehouses, wrkld.getNodes().size() * 200));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5MTY0OA=="}, "originalCommit": {"oid": "1d7435f4b525adffca431043a76636fc1dd2d1e6"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 743, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}