{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTIyMTA4", "number": 7, "title": "Adding the keying/think time to each transaction.", "bodyText": "Summary:\nAdded support for keying and think times for each transaction that can\nbe controlled using a configuration parameter.\nChanged the default configuration values to support running the workload\noptimally according to the specs.\nChanged some part of the Load workload to strictly follow the standard.\nReviewers:\nNeha, Karthik", "createdAt": "2020-03-30T21:47:10Z", "url": "https://github.com/yugabyte/tpcc/pull/7", "merged": true, "mergeCommit": {"oid": "658a8a21ca7e42bf43d96bdd51026b510c82b1ac"}, "closed": true, "closedAt": "2020-04-07T00:26:53Z", "author": {"login": "psudheer21"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS1nGsAH2gAyMzk1OTIyMTA4OmNhOTRlMjFlMzdhMWYwOGRjYTVlMmRmOWQ2YmVlNTNiZjIyMGM3MGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVHb_YAFqTM4ODY3OTIzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c", "author": {"user": {"login": "psudheer21", "name": "Sudheer Ponnemkunnath Rammohan"}}, "url": "https://github.com/yugabyte/tpcc/commit/ca94e21e37a1f08dca5e2df9d6bee53bf220c70c", "committedDate": "2020-03-30T21:44:24Z", "message": "[WIP] Adding the keying/think time to each transaction.\n\nSummary:\nAdded support for keying and think times for each transaction that can\nbe controlled using a configuration parameter.\n\nChanged the default configuration values to support running the workload\noptimally according to the specs.\n\nChanged some part of the Load workload to strictly follow the standard.\n\nReviewers:\nNeha, Karthik"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjU4NzU5", "url": "https://github.com/yugabyte/tpcc/pull/7#pullrequestreview-384258759", "createdAt": "2020-03-30T21:52:54Z", "commit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMTo1Mjo1NFrOF99nOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjowMTozMFrOF9921A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxNjkyMA==", "bodyText": "Any reason to change this default?", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400516920", "createdAt": "2020-03-30T21:52:54Z", "author": {"login": "rkarthik007"}, "path": "config/workload_all.xml", "diffHunk": "@@ -26,8 +26,11 @@\n     \t</transactiontype>\r\n    \t</transactiontypes>\r\n \r\n-    <terminals>2</terminals>\r\n     <scalefactor>2</scalefactor>\r\n+\t<!-- The number of terminals can be a max of 10 per warehouse -->\r\n+    <terminals>20</terminals>\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxOTY3MA==", "bodyText": "It might be good to add a comment on top of this (and the next) function with the TPCC spec and the relevant section that specifies these values.\nAlso, perhaps consider renaming this function with the units at the end, such as: getKeyingTimeMillis() if it is in millis.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400519670", "createdAt": "2020-03-30T21:58:46Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -196,6 +196,51 @@ synchronized public void setCurrStatement(Statement s) {\n         this.currStatement = s;\n     }\n \n+    private long getKeyingTime(TransactionType type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMDgxMA==", "bodyText": "Do we need this variable and the following LOG.info to measure the sleep time? We should get rid of these I feel.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400520810", "createdAt": "2020-03-30T22:01:16Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -282,14 +329,28 @@ public final void run() {\n                     // Do nothing\n             }\n \n+\n             // PART 3: Execute work\n \n             // TODO: Measuring latency when not rate limited is ... a little\n             // weird because if you add more simultaneous clients, you will\n             // increase latency (queue delay) but we do this anyway since it is\n             // useful sometimes\n \n-            long start = pieceOfWork.getStartTime();\n+            if (this.wrkld.getUseKeyingTime()) {\n+                // Wait for the keying time which is a fixed number for every type of transaction.\n+                long keying_time_msecs = getKeyingTime(transactionTypes.getType(pieceOfWork.getType()));\n+                try {\n+                    long start_sleep = System.nanoTime();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMDkxNg==", "bodyText": "Ditto as above.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r400520916", "createdAt": "2020-03-30T22:01:30Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/api/Worker.java", "diffHunk": "@@ -346,6 +407,18 @@ public final void run() {\n                     // Do nothing\n             }\n \n+            if (this.wrkld.getUseThinkTime()) {\n+                // Sleep for the think time duration.\n+                long think_time_msecs = getThinkTime(transactionTypes.getType(pieceOfWork.getType()));\n+                try {\n+                    long start_sleep = System.nanoTime();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca94e21e37a1f08dca5e2df9d6bee53bf220c70c"}, "originalPosition": 121}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236", "author": {"user": {"login": "psudheer21", "name": "Sudheer Ponnemkunnath Rammohan"}}, "url": "https://github.com/yugabyte/tpcc/commit/83d57cae3cf953d05687fd1db69485becdf75236", "committedDate": "2020-03-31T17:15:23Z", "message": "Addressed initial comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Njc5MjM2", "url": "https://github.com/yugabyte/tpcc/pull/7#pullrequestreview-388679236", "createdAt": "2020-04-06T23:07:42Z", "commit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzowNzo0MlrOGBtJIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzoyOTo0OVrOGBtmsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0MTM3Nw==", "bodyText": "With these defaults, we'll use keying and think time for other workloads like workload_1, workload_2 etc. also. Just want to make sure that it's intentional.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r404441377", "createdAt": "2020-04-06T23:07:42Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/WorkloadConfiguration.java", "diffHunk": "@@ -47,20 +47,23 @@ public void setBenchmarkName(String benchmarkName) {\n \tprivate String db_name;\n \tprivate String db_username;\n \tprivate String db_password;\n-\tprivate String db_driver;\t\n+\tprivate String db_driver;\n \tprivate double scaleFactor = 1.0;\n \tprivate double selectivity = -1.0;\n \tprivate int terminals;\n \tprivate int loaderThreads = ThreadUtil.availableProcessors();\n \tprivate int numTxnTypes;\n     private TraceReader traceReader = null;\n+    private boolean useKeyingTime = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0ODk0Ng==", "bodyText": "Please add this to the description as well - since your diff includes more than just the changes for think/keying time.", "url": "https://github.com/yugabyte/tpcc/pull/7#discussion_r404448946", "createdAt": "2020-04-06T23:29:49Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -248,8 +248,8 @@ protected int loadWarehouse(Connection conn, int w_id) {\n \t\t\twarehouse.w_street_1 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_street_2 = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n \t\t\twarehouse.w_city = TPCCUtil.randomStr(TPCCUtil.randomNumber(10, 20, benchmark.rng()));\n-\t\t\twarehouse.w_state = TPCCUtil.randomStr(3).toUpperCase();\n-\t\t\twarehouse.w_zip = \"123456789\";\n+\t\t\twarehouse.w_state = TPCCUtil.randomStr(2).toUpperCase();\n+\t\t\twarehouse.w_zip = TPCCUtil.randomNStr(4) + \"11111\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83d57cae3cf953d05687fd1db69485becdf75236"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 453, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}