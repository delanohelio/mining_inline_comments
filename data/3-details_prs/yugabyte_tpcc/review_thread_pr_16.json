{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NDc5Mjg1", "number": 16, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMzo1Nzo0OFrOD67j3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMTo1OTo1MFrOD9_M5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTE5ODM4OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMzo1Nzo0OFrOGTAQqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTozNjowMlrOGTqfEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDM5Mw==", "bodyText": "Do we need this log line?", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r422580393", "createdAt": "2020-05-10T03:57:48Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -118,10 +126,30 @@ public void load(Connection conn) throws SQLException {\n \n                     // ORDERS\n                     loadOrders(conn, w_id, TPCCConfig.configDistPerWhse, TPCCConfig.configCustPerDist);\n+\n+                    warehouseLatch.countDown();\n                 }\n             };\n             threads.add(t);\n         } // FOR\n+\n+        if (workConf.getDeferConstraintChecks()) {\n+            threads.add(new LoaderThread() {\n+                @Override\n+                public void load(Connection conn) throws SQLException {\n+                    try {\n+                        warehouseLatch.await();\n+                    } catch (InterruptedException ex) {\n+                        ex.printStackTrace();\n+                        throw new RuntimeException(ex);\n+                    }\n+                    long startTime = System.nanoTime();\n+                    EnableForeignKeyConstraints(conn);\n+                    LOG.info(\"The total Time for enabling foreign keys \" + (System.nanoTime() - startTime) / 1000 / 1000 / 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MjIwOA==", "bodyText": "We don't specifically need it.\nWill remove.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423272208", "createdAt": "2020-05-11T19:36:02Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -118,10 +126,30 @@ public void load(Connection conn) throws SQLException {\n \n                     // ORDERS\n                     loadOrders(conn, w_id, TPCCConfig.configDistPerWhse, TPCCConfig.configCustPerDist);\n+\n+                    warehouseLatch.countDown();\n                 }\n             };\n             threads.add(t);\n         } // FOR\n+\n+        if (workConf.getDeferConstraintChecks()) {\n+            threads.add(new LoaderThread() {\n+                @Override\n+                public void load(Connection conn) throws SQLException {\n+                    try {\n+                        warehouseLatch.await();\n+                    } catch (InterruptedException ex) {\n+                        ex.printStackTrace();\n+                        throw new RuntimeException(ex);\n+                    }\n+                    long startTime = System.nanoTime();\n+                    EnableForeignKeyConstraints(conn);\n+                    LOG.info(\"The total Time for enabling foreign keys \" + (System.nanoTime() - startTime) / 1000 / 1000 / 1000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDM5Mw=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTE5ODYxOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMzo1ODozMVrOGTAQxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTozNjoxMVrOGTqfhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDQyMw==", "bodyText": "Can we add comments on top of these table DDL changes so we know why we do this?", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r422580423", "createdAt": "2020-05-10T03:58:31Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -12,15 +12,15 @@ CREATE TABLE order_line (\n   ol_supply_w_id int NOT NULL,\n   ol_quantity decimal(2,0) NOT NULL,\n   ol_dist_info char(24) NOT NULL,\n-  PRIMARY KEY (ol_w_id,ol_d_id,ol_o_id,ol_number)\n+  PRIMARY KEY ((ol_w_id,ol_d_id) hash,ol_o_id,ol_number)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MjMyNw==", "bodyText": "Sure.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423272327", "createdAt": "2020-05-11T19:36:11Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -12,15 +12,15 @@ CREATE TABLE order_line (\n   ol_supply_w_id int NOT NULL,\n   ol_quantity decimal(2,0) NOT NULL,\n   ol_dist_info char(24) NOT NULL,\n-  PRIMARY KEY (ol_w_id,ol_d_id,ol_o_id,ol_number)\n+  PRIMARY KEY ((ol_w_id,ol_d_id) hash,ol_o_id,ol_number)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDQyMw=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTE5ODk3OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/DBWorkload.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMzo1ODo1NVrOGTAQ8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTozNjoyMFrOGTqfzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDQ2NA==", "bodyText": "Comments please.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r422580464", "createdAt": "2020-05-10T03:58:55Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -237,6 +237,12 @@ public static void main(String[] args) throws Exception {\n                 // Nothing to do here !\n             }\n \n+            try {\n+              wrkld.setDeferConstraintChecks(xmlConfig.getBoolean(\"deferConstraintChecks\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MjM5OA==", "bodyText": "Sure.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423272398", "createdAt": "2020-05-11T19:36:20Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -237,6 +237,12 @@ public static void main(String[] args) throws Exception {\n                 // Nothing to do here !\n             }\n \n+            try {\n+              wrkld.setDeferConstraintChecks(xmlConfig.getBoolean(\"deferConstraintChecks\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDQ2NA=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTE5OTkzOnYy", "diffSide": "LEFT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwNDowMDozNVrOGTARYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTozNjozM1rOGTqgQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDU3OQ==", "bodyText": "Can we add a comment block here about the fact that all foreign key constraints are now loaded as deferred constraints?\nAlso, can these be loaded as non-deferred constraints? Would be good to call out those details here. Otherwise, someone looking at the schema file would think there are no FKs.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r422580579", "createdAt": "2020-05-10T04:00:35Z", "author": {"login": "rkarthik007"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -144,20 +144,3 @@ CREATE TABLE warehouse (\n --add constraints and indexes\n CREATE INDEX idx_customer_name ON customer (c_w_id,c_d_id,c_last,c_first);\n CREATE INDEX idx_order ON oorder (o_w_id,o_d_id,o_c_id,o_id);\n--- tpcc-mysql create two indexes for the foreign key constraints, Is it really necessary?\n--- CREATE INDEX FKEY_STOCK_2 ON STOCK (S_I_ID);\n--- CREATE INDEX FKEY_ORDER_LINE_2 ON ORDER_LINE (OL_SUPPLY_W_ID,OL_I_ID);\n-\n---add 'ON DELETE CASCADE'  to clear table work correctly\n-\n-ALTER TABLE district  ADD CONSTRAINT fkey_district_1 FOREIGN KEY(d_w_id) REFERENCES warehouse(w_id) ON DELETE CASCADE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MjUxNA==", "bodyText": "Sure.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423272514", "createdAt": "2020-05-11T19:36:33Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -144,20 +144,3 @@ CREATE TABLE warehouse (\n --add constraints and indexes\n CREATE INDEX idx_customer_name ON customer (c_w_id,c_d_id,c_last,c_first);\n CREATE INDEX idx_order ON oorder (o_w_id,o_d_id,o_c_id,o_id);\n--- tpcc-mysql create two indexes for the foreign key constraints, Is it really necessary?\n--- CREATE INDEX FKEY_STOCK_2 ON STOCK (S_I_ID);\n--- CREATE INDEX FKEY_ORDER_LINE_2 ON ORDER_LINE (OL_SUPPLY_W_ID,OL_I_ID);\n-\n---add 'ON DELETE CASCADE'  to clear table work correctly\n-\n-ALTER TABLE district  ADD CONSTRAINT fkey_district_1 FOREIGN KEY(d_w_id) REFERENCES warehouse(w_id) ON DELETE CASCADE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4MDU3OQ=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTg4NzI2OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/DBWorkload.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo0MDowMlrOGTqmzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo0Njo1MlrOGVEr4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDE5MQ==", "bodyText": "Let's not use the term \"deferred constraints\" since that has a different meaning in postgresql and YSQL. Let's use setForeignKeysAfterLoad instead.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423274191", "createdAt": "2020-05-11T19:40:02Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -237,6 +237,12 @@ public static void main(String[] args) throws Exception {\n                 // Nothing to do here !\n             }\n \n+            try {\n+              wrkld.setDeferConstraintChecks(xmlConfig.getBoolean(\"deferConstraintChecks\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1MDA0OA==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r424750048", "createdAt": "2020-05-13T21:46:52Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/DBWorkload.java", "diffHunk": "@@ -237,6 +237,12 @@ public static void main(String[] args) throws Exception {\n                 // Nothing to do here !\n             }\n \n+            try {\n+              wrkld.setDeferConstraintChecks(xmlConfig.getBoolean(\"deferConstraintChecks\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDE5MQ=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTg5MjE1OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo0MTozNlrOGTqp7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTozODoxMFrOGVEcTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDk4OA==", "bodyText": "We can skip this log since this is not a time consuming operation.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423274988", "createdAt": "2020-05-11T19:41:36Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -67,19 +69,25 @@ public TPCCLoader(TPCCBenchmark benchmark) {\n         }\n     }\n \n+    private boolean deferConstraintChecks;\n     private int numWarehouses = 0;\n     private static final int FIRST_UNPROCESSED_O_ID = 2101;\n \n     @Override\n     public List<LoaderThread> createLoaderThreads() throws SQLException {\n         List<LoaderThread> threads = new ArrayList<LoaderThread>();\n         final CountDownLatch itemLatch = new CountDownLatch(1);\n+        final CountDownLatch warehouseLatch = new CountDownLatch(numWarehouses);\n \n         // ITEM\n         // This will be invoked first and executed in a single thread.\n         threads.add(new LoaderThread() {\n             @Override\n             public void load(Connection conn) throws SQLException {\n+                if (!workConf.getDeferConstraintChecks()) {\n+                    EnableForeignKeyConstraints(conn);\n+                    LOG.info(\"The total Time for enabling foreign keys \" + (System.nanoTime() - startTime) / 1000 / 1000 / 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0NjA2MQ==", "bodyText": "done.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r424746061", "createdAt": "2020-05-13T21:38:10Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/TPCCLoader.java", "diffHunk": "@@ -67,19 +69,25 @@ public TPCCLoader(TPCCBenchmark benchmark) {\n         }\n     }\n \n+    private boolean deferConstraintChecks;\n     private int numWarehouses = 0;\n     private static final int FIRST_UNPROCESSED_O_ID = 2101;\n \n     @Override\n     public List<LoaderThread> createLoaderThreads() throws SQLException {\n         List<LoaderThread> threads = new ArrayList<LoaderThread>();\n         final CountDownLatch itemLatch = new CountDownLatch(1);\n+        final CountDownLatch warehouseLatch = new CountDownLatch(numWarehouses);\n \n         // ITEM\n         // This will be invoked first and executed in a single thread.\n         threads.add(new LoaderThread() {\n             @Override\n             public void load(Connection conn) throws SQLException {\n+                if (!workConf.getDeferConstraintChecks()) {\n+                    EnableForeignKeyConstraints(conn);\n+                    LOG.info(\"The total Time for enabling foreign keys \" + (System.nanoTime() - startTime) / 1000 / 1000 / 1000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDk4OA=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTkwMzM4OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo0NTowM1rOGTqw7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo0Nzo0MlrOGVEtTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3Njc4Mg==", "bodyText": "Please also update stock table's PK to be (s_w_id,s_i_id hash)", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423276782", "createdAt": "2020-05-11T19:45:03Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -12,15 +12,15 @@ CREATE TABLE order_line (\n   ol_supply_w_id int NOT NULL,\n   ol_quantity decimal(2,0) NOT NULL,\n   ol_dist_info char(24) NOT NULL,\n-  PRIMARY KEY (ol_w_id,ol_d_id,ol_o_id,ol_number)\n+  PRIMARY KEY ((ol_w_id,ol_d_id) hash,ol_o_id,ol_number)\n );\n \n DROP TABLE IF EXISTS new_order;\n CREATE TABLE new_order (\n   no_w_id int NOT NULL,\n   no_d_id int NOT NULL,\n   no_o_id int NOT NULL,\n-  PRIMARY KEY (no_w_id,no_d_id,no_o_id)\n+  PRIMARY KEY ((no_w_id,no_d_id) hash,no_o_id)\n );\n \n DROP TABLE IF EXISTS stock;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1MDQxNA==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r424750414", "createdAt": "2020-05-13T21:47:42Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -12,15 +12,15 @@ CREATE TABLE order_line (\n   ol_supply_w_id int NOT NULL,\n   ol_quantity decimal(2,0) NOT NULL,\n   ol_dist_info char(24) NOT NULL,\n-  PRIMARY KEY (ol_w_id,ol_d_id,ol_o_id,ol_number)\n+  PRIMARY KEY ((ol_w_id,ol_d_id) hash,ol_o_id,ol_number)\n );\n \n DROP TABLE IF EXISTS new_order;\n CREATE TABLE new_order (\n   no_w_id int NOT NULL,\n   no_d_id int NOT NULL,\n   no_o_id int NOT NULL,\n-  PRIMARY KEY (no_w_id,no_d_id,no_o_id)\n+  PRIMARY KEY ((no_w_id,no_d_id) hash,no_o_id)\n );\n \n DROP TABLE IF EXISTS stock;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3Njc4Mg=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTkwNzM1OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo0NjoxOVrOGTqzcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTozODo0MlrOGVEdSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NzQyNA==", "bodyText": "nit: Use HASH (uppercase) so it stands out between the column names.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423277424", "createdAt": "2020-05-11T19:46:19Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -12,15 +12,15 @@ CREATE TABLE order_line (\n   ol_supply_w_id int NOT NULL,\n   ol_quantity decimal(2,0) NOT NULL,\n   ol_dist_info char(24) NOT NULL,\n-  PRIMARY KEY (ol_w_id,ol_d_id,ol_o_id,ol_number)\n+  PRIMARY KEY ((ol_w_id,ol_d_id) hash,ol_o_id,ol_number)\n );\n \n DROP TABLE IF EXISTS new_order;\n CREATE TABLE new_order (\n   no_w_id int NOT NULL,\n   no_d_id int NOT NULL,\n   no_o_id int NOT NULL,\n-  PRIMARY KEY (no_w_id,no_d_id,no_o_id)\n+  PRIMARY KEY ((no_w_id,no_d_id) hash,no_o_id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0NjMxMg==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r424746312", "createdAt": "2020-05-13T21:38:42Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -12,15 +12,15 @@ CREATE TABLE order_line (\n   ol_supply_w_id int NOT NULL,\n   ol_quantity decimal(2,0) NOT NULL,\n   ol_dist_info char(24) NOT NULL,\n-  PRIMARY KEY (ol_w_id,ol_d_id,ol_o_id,ol_number)\n+  PRIMARY KEY ((ol_w_id,ol_d_id) hash,ol_o_id,ol_number)\n );\n \n DROP TABLE IF EXISTS new_order;\n CREATE TABLE new_order (\n   no_w_id int NOT NULL,\n   no_d_id int NOT NULL,\n   no_o_id int NOT NULL,\n-  PRIMARY KEY (no_w_id,no_d_id,no_o_id)\n+  PRIMARY KEY ((no_w_id,no_d_id) hash,no_o_id)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NzQyNA=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTkxMTc3OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo0Nzo0NFrOGTq2QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo0Nzo0NFrOGTq2QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3ODE0NA==", "bodyText": "Please remove this and add a CREATE UNIQUE INDEX statement below using ((o_w_id, o_d_id) HASH, o_c_id, o_id)", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423278144", "createdAt": "2020-05-11T19:47:44Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -56,7 +56,7 @@ CREATE TABLE oorder (\n   o_ol_cnt decimal(2,0) NOT NULL,\n   o_all_local decimal(1,0) NOT NULL,\n   o_entry_d timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n-  PRIMARY KEY (o_w_id,o_d_id,o_id),\n+  PRIMARY KEY ((o_w_id,o_d_id) hash,o_id),\n   UNIQUE (o_w_id,o_d_id,o_c_id,o_id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTkxNTA4OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo0ODozOVrOGTq4YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMTo1Njo1MVrOGX0FtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3ODY4OQ==", "bodyText": "We don't need this since it's only 10 districts per warehouse.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423278689", "createdAt": "2020-05-11T19:48:39Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -112,7 +112,7 @@ CREATE TABLE district (\n   d_city varchar(20) NOT NULL,\n   d_state char(2) NOT NULL,\n   d_zip char(9) NOT NULL,\n-  PRIMARY KEY (d_w_id,d_id)\n+  PRIMARY KEY ((d_w_id,d_id) hash)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0NjUyMA==", "bodyText": "But i was thinking the rows should lie on the same tablet?\nWouldn't that be better?", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r424746520", "createdAt": "2020-05-13T21:39:11Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -112,7 +112,7 @@ CREATE TABLE district (\n   d_city varchar(20) NOT NULL,\n   d_state char(2) NOT NULL,\n   d_zip char(9) NOT NULL,\n-  PRIMARY KEY (d_w_id,d_id)\n+  PRIMARY KEY ((d_w_id,d_id) hash)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3ODY4OQ=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyMzg2MA==", "bodyText": "Not sure I fully understood. If we don't use the hash, then they will on the same tablet.\nEither way, this is a small table. So, I'm okay with any of the two options.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r427623860", "createdAt": "2020-05-19T21:56:51Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -112,7 +112,7 @@ CREATE TABLE district (\n   d_city varchar(20) NOT NULL,\n   d_state char(2) NOT NULL,\n   d_zip char(9) NOT NULL,\n-  PRIMARY KEY (d_w_id,d_id)\n+  PRIMARY KEY ((d_w_id,d_id) hash)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3ODY4OQ=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTkyMTMwOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo1MDo0NFrOGTq8oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1MToyMFrOGVEzfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3OTc3Ng==", "bodyText": "We can remove this index since there is also a unique index on the same set of columns. So, let's just have 1 index on oorder table like this:\nCREATE UNIQUE INDEX idx_order ON oorder ((o_w_id,o_d_id) HASH, o_c_id, o_id DESC);\nNote that change to use DESC for o_id since that helps with the workload queries.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423279776", "createdAt": "2020-05-11T19:50:44Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -144,20 +144,3 @@ CREATE TABLE warehouse (\n --add constraints and indexes\n CREATE INDEX idx_customer_name ON customer (c_w_id,c_d_id,c_last,c_first);\n CREATE INDEX idx_order ON oorder (o_w_id,o_d_id,o_c_id,o_id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1MTk5OQ==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r424751999", "createdAt": "2020-05-13T21:51:20Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -144,20 +144,3 @@ CREATE TABLE warehouse (\n --add constraints and indexes\n CREATE INDEX idx_customer_name ON customer (c_w_id,c_d_id,c_last,c_first);\n CREATE INDEX idx_order ON oorder (o_w_id,o_d_id,o_c_id,o_id);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3OTc3Ng=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTkyMjc2OnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTo1MTowOFrOGTq9gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1MToyOVrOGVEzvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4MDAwMg==", "bodyText": "Change this to ((c_w_id, c_d_id) HASH, c_last, c_first)", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r423280002", "createdAt": "2020-05-11T19:51:08Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -144,20 +144,3 @@ CREATE TABLE warehouse (\n --add constraints and indexes\n CREATE INDEX idx_customer_name ON customer (c_w_id,c_d_id,c_last,c_first);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1MjA2MA==", "bodyText": "Done.", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r424752060", "createdAt": "2020-05-13T21:51:29Z", "author": {"login": "psudheer21"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -144,20 +144,3 @@ CREATE TABLE warehouse (\n --add constraints and indexes\n CREATE INDEX idx_customer_name ON customer (c_w_id,c_d_id,c_last,c_first);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4MDAwMg=="}, "originalCommit": {"oid": "993a1568d02ddd247724e4edc7bea51914dfcae0"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzI1MjIyOnYy", "diffSide": "RIGHT", "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMTo1OTo1MFrOGX0Kxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMTo1OTo1MFrOGX0Kxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyNTE1OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            -- The Foreign keys constraints are enabled based on the flag 'deferConstraintChecks'. If this flag\n          \n          \n            \n            -- The Foreign keys constraints are enabled based on the flag 'enableForeignKeysAfterLoad'. If this flag", "url": "https://github.com/yugabyte/tpcc/pull/16#discussion_r427625158", "createdAt": "2020-05-19T21:59:50Z", "author": {"login": "ndeodhar"}, "path": "src/com/oltpbenchmark/benchmarks/tpcc/ddls/tpcc-postgres-ddl.sql", "diffHunk": "@@ -1,4 +1,7 @@\n -- TODO: c_since ON UPDATE CURRENT_TIMESTAMP,\n+-- The Foreign keys constraints are enabled based on the flag 'deferConstraintChecks'. If this flag", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c424379c7c252c8617799e39769a83073a919a8"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 738, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}