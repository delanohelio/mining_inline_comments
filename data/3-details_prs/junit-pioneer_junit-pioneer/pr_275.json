{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MjY2MTk3", "number": 275, "title": "Revamp/improvement of StdIoExtension", "bodyText": "Closes #274\n\nI hereby agree to the terms of the JUnit Pioneer Contributor License Agreement.", "createdAt": "2020-06-19T19:37:18Z", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275", "merged": true, "mergeCommit": {"oid": "ac723c64869d241d265ce07e6e0fdedcd6a754db"}, "closed": true, "closedAt": "2020-07-30T11:13:22Z", "author": {"login": "Michael1993"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr6FWnAH2gAyNDM3MjY2MTk3OmE0NDA1MDg5ZTQ0ZDRmNDI4NGNmZGFmNzFjNTcxYTM2NTQxZjQxOWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc58ZhogH2gAyNDM3MjY2MTk3OjFhNDEzZGI1Mzc0ZWY1NTk1YTg2NDA3YzBmODNlNDc3MDJlNDk5MzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a4405089e44d4f4284cfdaf71c571a36541f419e", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/a4405089e44d4f4284cfdaf71c571a36541f419e", "committedDate": "2020-06-16T19:05:10Z", "message": "Small edits to documentation and code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91831341534679a907befb8063a5282138040be4", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/91831341534679a907befb8063a5282138040be4", "committedDate": "2020-06-19T19:36:01Z", "message": "Complete revamp of StdIoExtension following suggestions on #274"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "590806419e67a70f00d83b3ca553ef66d7362ad0", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/590806419e67a70f00d83b3ca553ef66d7362ad0", "committedDate": "2020-06-19T20:40:29Z", "message": "Added reset (and tests) to StdIoExtension"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08a74b7960426484157fc644a8c5df9b6dd1ce58", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/08a74b7960426484157fc644a8c5df9b6dd1ce58", "committedDate": "2020-06-19T20:42:07Z", "message": "Replace star imports (I should fix my IDE settings)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/54b920f8eae5d6b7fec42d4edaa25880308a1220", "committedDate": "2020-06-19T20:50:14Z", "message": "Added some NOSONAR comments. Bad boy, SONAR, sit!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDk3MDI3", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#pullrequestreview-434497027", "createdAt": "2020-06-21T12:25:49Z", "commit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMjoyNTo0OVrOGmrq_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMzoyMjoyOFrOGmr8oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxNDU5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The extension is in two parts.\n          \n          \n            \n            An annotation (`@StdIo`) and special parameters (`StdIn` and `StdOut`).\n          \n          \n            \n            The extension is in two parts.\n          \n          \n            \n            An annotation (`@StdIo`) and special parameters (`StdIn` and `StdOut`).\n          \n      \n    \n    \n  \n\nThe extension consists of two parts which must be used together: An annotation (@StdIo) and special parameters (StdIn and StdOut).", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443214590", "createdAt": "2020-06-21T12:25:49Z", "author": {"login": "Bukama"}, "path": "docs/standard-input-output.adoc", "diffHunk": "@@ -1,59 +1,113 @@\n :page-title: Standard input/output\n :page-description: JUnit Jupiter extension for simulating standard input or catching standard output.\n \n-The `StdIOExtension` adds a simple way to test classes that read from the standard input (`System.in`) or write to the standard output (`System.out`).\n+The `StdIoExtension` adds a simple way to test classes that read from the standard input (`System.in`) or write to the standard output (`System.out`).\n+\n+WARNING: The extension redirects the standard input/output and nothing gets forwarded to `System.in` or `System.out`.\n \n == Basic use\n \n-The extension has to be registered with the annotation `@ExtendWith(StdIOExtension.class)`.\n+The extension is in two parts.\n+An annotation (`@StdIo`) and special parameters (`StdIn` and `StdOut`).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxNDgyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This is not required - you can simulate an empty input if you don't supply your own values.\n          \n          \n            \n            This is not required - you can simulate an empty input if you don't supply your own values.\n          \n      \n    \n    \n  \n\n\nIf you want to simulate an empty input, you can do this by passing an empty array.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443214825", "createdAt": "2020-06-21T12:28:01Z", "author": {"login": "Bukama"}, "path": "docs/standard-input-output.adoc", "diffHunk": "@@ -1,59 +1,113 @@\n :page-title: Standard input/output\n :page-description: JUnit Jupiter extension for simulating standard input or catching standard output.\n \n-The `StdIOExtension` adds a simple way to test classes that read from the standard input (`System.in`) or write to the standard output (`System.out`).\n+The `StdIoExtension` adds a simple way to test classes that read from the standard input (`System.in`) or write to the standard output (`System.out`).\n+\n+WARNING: The extension redirects the standard input/output and nothing gets forwarded to `System.in` or `System.out`.\n \n == Basic use\n \n-The extension has to be registered with the annotation `@ExtendWith(StdIOExtension.class)`.\n+The extension is in two parts.\n+An annotation (`@StdIo`) and special parameters (`StdIn` and `StdOut`).\n+To use a parameter, you have to use the annotation and if you use the annotation, you have to use a parameter.\n The extension provides the following two parameters:\n \n-StdIn(`org.junitpioneer.jupiter.StdIOExtension.StdIn`)::\n+StdIn(`org.junitpioneer.jupiter.StdIoExtension.StdIn`)::\n This is for simulating input from the standard in.\n-This parameter also requires that the method is annotated with `@StdInSource`.\n-The `@StdInSource` annotation takes a String array which holds the values that the test will \"read\" instead of waiting for input on the standard input.\n+The `StdIo` annotation takes a String array which holds the values that the test will \"read\" instead of waiting for input on the standard input.\n+This is not required - you can simulate an empty input if you don't supply your own values.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxNTYzOQ==", "bodyText": "I had to read it multiple times, because\n\nThis is the unit test for this class, using StdIoExtension:\n\nsuggests a non-failing unit tests. And the code seems to be okay.\nSo maybe adding an additional code line (like in the Spotbugs examples) to make the written documentation before/after the code example more representative inside the code.\n@Test\n    @StdIo({ \"line1\", \"line2\", \"line3\" })\n    void testReadLines(StdIn in) {\n        ExampleConsoleReader consoleReader = new ExampleConsoleReader();\n        consoleReader.readLines();\n       //  assertEquals(in.capturedLines(), \"line1\", \"line2\"); // Fails\n      //  assertEquals(in.capturedLines(), \"line1\", \"line2\", \"line3\"); // Correct\n    }", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443215639", "createdAt": "2020-06-21T12:38:13Z", "author": {"login": "Bukama"}, "path": "docs/standard-input-output.adoc", "diffHunk": "@@ -1,59 +1,113 @@\n :page-title: Standard input/output\n :page-description: JUnit Jupiter extension for simulating standard input or catching standard output.\n \n-The `StdIOExtension` adds a simple way to test classes that read from the standard input (`System.in`) or write to the standard output (`System.out`).\n+The `StdIoExtension` adds a simple way to test classes that read from the standard input (`System.in`) or write to the standard output (`System.out`).\n+\n+WARNING: The extension redirects the standard input/output and nothing gets forwarded to `System.in` or `System.out`.\n \n == Basic use\n \n-The extension has to be registered with the annotation `@ExtendWith(StdIOExtension.class)`.\n+The extension is in two parts.\n+An annotation (`@StdIo`) and special parameters (`StdIn` and `StdOut`).\n+To use a parameter, you have to use the annotation and if you use the annotation, you have to use a parameter.\n The extension provides the following two parameters:\n \n-StdIn(`org.junitpioneer.jupiter.StdIOExtension.StdIn`)::\n+StdIn(`org.junitpioneer.jupiter.StdIoExtension.StdIn`)::\n This is for simulating input from the standard in.\n-This parameter also requires that the method is annotated with `@StdInSource`.\n-The `@StdInSource` annotation takes a String array which holds the values that the test will \"read\" instead of waiting for input on the standard input.\n+The `StdIo` annotation takes a String array which holds the values that the test will \"read\" instead of waiting for input on the standard input.\n+This is not required - you can simulate an empty input if you don't supply your own values.\n Each value of the array represents one line of input.\n \n The following example shows how to pass the values `Hello` and `World` as standard input:\n \n [source,java]\n ----\n-    @ExtendWith(StdIOExtension.class)\n-    public class StandardInputOutputTests {\n-        ...\n+public class StandardInputOutputTests {\n+\n+    // ...\n+\n     @Test\n-    @StdInSource({\"Hello\", \"World\"})\n+    @StdIo({\"Hello\", \"World\"})\n     void test(StdIn in) {\n-        ...\n+        // ...\n+    }\n \n+}\n ----\n \n-StdOut(`org.junitpioneer.jupiter.StdIOExtension.StdOut`)::\n+StdOut(`org.junitpioneer.jupiter.StdIoExtension.StdOut`)::\n This is for catching output going to the standard out.\n-This parameter does not require any additional annotations except for the `@ExtendWith(StdIOExtension.class)` on your test class (see below).\n \n [source,java]\n ----\n-    @ExtendWith(StdIOExtension.class)\n-    public class StandardInputOutputTests {\n-        ...\n+public class StandardInputOutputTests {\n+\n+\t// ...\n+\n     @Test\n+    @StdIo\n     void test(StdOut out) {\n-        ...\n+        // ...\n+    }\n \n+}\n ----\n \n-The `StdIn` and `StdOut` classes both contain the `capturedLines()` method that returns the lines read by `StdIn` or written by `StdOut`.\n+Because the extension is in two parts, it can be harder to configure.\n+The following scenarios lead to bad configurations:\n+\n+- Having a test method annotated with `@StdIo` that does not have `StdIn` or `StdOut` parameters\n+- Having a test method with `StdIn` or `StdOut` parameters that is not annotated with `@StdIo`\n+- Supplying values to the `@StdIo` annotation on a test method that does not have an `StdIn` parameter\n+\n+The `StdIn` and `StdOut` classes both contain the `capturedLines()` method that returns the lines read by `StdIn` or written to `StdOut`.\n This array contains the redirected in- or output as lines.\n This can be used to verify interactions.\n \n For example, after calling `System.out.print(\"Hello\")` and `System.out.println(\"World\")`,  the `capturedLines()` method would contain an array of the String \"HelloWorld\".\n Note that the first method does not print a line break.\n \n-Some readers read all lines from `@StdInSource` eagerly (e.g.: `BufferedReader`) which can lead to unexpected behaviour.\n-This is the specific characteristic  of that reader and is not considered a bug within the extension.\n+Some readers read all lines from `StdIo` eagerly (e.g.: `BufferedReader`) which can lead to unexpected behavior.\n+Take the following example:\n+\n+[source,java]\n+----\n+class ExampleConsoleReader {\n+\n+    private List<String> lines = new ArrayList<>();\n \n-[source]\n+    public void readLines() {\n+        BufferedReader reader = new BufferedReader(new InputStreamReader(System.in));\n+        for (int i = 0; i < 2; i++) {\n+            String line = reader.readLine();\n+            lines.add(line);\n+        }\n+    }\n+\n+}\n+----\n+\n+This is a straightforward example class.\n+It reads two lines from `System.in`, using a `BufferedReader`.\n+This is the unit test for this class, using `StdIoExtension`:\n+\n+[source, java]\n ----\n-IMPORTANT: The extension redirects the standard input/output and nothing gets forwarded to System.in or System.out.\n-----\n\\ No newline at end of file\n+class ExampleConsoleReaderTest {\n+\n+    @Test\n+    @StdIo({ \"line1\", \"line2\", \"line3\" })\n+    void testReadLines(StdIn in) {\n+        ExampleConsoleReader consoleReader = new ExampleConsoleReader();\n+\n+        consoleReader.readLines();\n+\n+        assertEquals(in.capturedLines(), \"line1\", \"line2\");\n+    }\n+\n+}\n+----\n+\n+This fails!", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxNjQ1OA==", "bodyText": "The note about no parameter is not needed. Two sentences before you already mentioned that.\nFurthermore it interrupts  the \"surrounding\" two sentenced which belong together. I would rewrite the latter of them to something like \"If you want to provide no input/expect no output, just use the annotation without additional values\".\nThird: The arrays does not only contain values which are provided to System. in but also expected values printed by System.out.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443216458", "createdAt": "2020-06-21T12:48:20Z", "author": {"login": "Bukama"}, "path": "src/main/java/org/junitpioneer/jupiter/StdIo.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+/**\n+ * Marks a method to be extended with {@link StdIoExtension} and provided with\n+ * {@link StdIoExtension.StdIn StdIn} or {@link StdIoExtension.StdOut StdOut}.\n+ * The annotated method must take one or both parameters or an\n+ * {@link org.junit.jupiter.api.extension.ExtensionConfigurationException} will be thrown.\n+ *\n+ * Provide values that the {@link StdIoExtension extension} will read instead of reading the\n+ * standard input ({@code System.in}).\n+ * If values are provided but there is no {@link StdIoExtension.StdIn} parameter\n+ * an {@link org.junit.jupiter.api.extension.ExtensionConfigurationException} will be thrown.\n+ * The opposite is not true to enable testing for empty inputs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxNjQ4Mw==", "bodyText": "Also expected values of System.out", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443216483", "createdAt": "2020-06-21T12:48:46Z", "author": {"login": "Bukama"}, "path": "src/main/java/org/junitpioneer/jupiter/StdIo.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+/**\n+ * Marks a method to be extended with {@link StdIoExtension} and provided with\n+ * {@link StdIoExtension.StdIn StdIn} or {@link StdIoExtension.StdOut StdOut}.\n+ * The annotated method must take one or both parameters or an\n+ * {@link org.junit.jupiter.api.extension.ExtensionConfigurationException} will be thrown.\n+ *\n+ * Provide values that the {@link StdIoExtension extension} will read instead of reading the\n+ * standard input ({@code System.in}).\n+ * If values are provided but there is no {@link StdIoExtension.StdIn} parameter\n+ * an {@link org.junit.jupiter.api.extension.ExtensionConfigurationException} will be thrown.\n+ * The opposite is not true to enable testing for empty inputs.\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.METHOD)\n+@ExtendWith(StdIoExtension.class)\n+public @interface StdIo {\n+\n+\t/**\n+\t * Provides the intercepted standard input with values.\n+\t * If this is not blank, the annotated method has to\n+\t * have a {@link StdIoExtension.StdIn} parameter.\n+\t */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxNzc1NA==", "bodyText": "I don't get this. The if tests if the value array is not empty and if the parameter does not contain StdIn, but the error messages says that there are parameter but StdIn was * not* provided. Which is totally fine, if StdOut was provided and the values are the expected written values.\nDid you miss to add the check for StdOut, because you want to check if there is a) an annotation with values but b) neither StdIn or StdOut parameter?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443217754", "createdAt": "2020-06-21T13:05:02Z", "author": {"login": "Bukama"}, "path": "src/main/java/org/junitpioneer/jupiter/StdIoExtension.java", "diffHunk": "@@ -61,11 +90,34 @@ private Object getOut() {\n \tprivate String[] getSourceValuesFromAnnotation(ExtensionContext context) {\n \t\treturn context\n \t\t\t\t.getTestMethod()\n-\t\t\t\t.map(method -> method.getAnnotation(StdInSource.class))\n-\t\t\t\t.map(StdInSource::value)\n+\t\t\t\t.map(method -> method.getAnnotation(StdIo.class))\n+\t\t\t\t.map(StdIo::value)\n \t\t\t\t.orElseThrow(() -> new ParameterResolutionException(\n-\t\t\t\t\tformat(\"Can not resolve test method parameter %s. Method has to be annotated with '%s'\",\n-\t\t\t\t\t\tStdIn.class.getName(), StdInSource.class.getName())));\n+\t\t\t\t\tformat(\"Can not resolve test method parameter %s. Method has to be annotated with '%s'.\",\n+\t\t\t\t\t\tStdIn.class.getName(), StdIo.class.getName())));\n+\t}\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tOptional<Method> method = context.getTestMethod();\n+\t\tif (method.isPresent()) {\n+\t\t\tif (method.get().getAnnotation(StdIo.class) == null) {\n+\t\t\t\tthrow new ExtensionConfigurationException(\n+\t\t\t\t\tformat(\"StdIoExtension is active but no %s annotation was found.\", StdIo.class.getName()));\n+\t\t\t}\n+\t\t\tList<Class<?>> params = Arrays.asList(method.get().getParameterTypes());\n+\t\t\tif (!params.contains(StdIn.class) && !params.contains(StdOut.class)) {\n+\t\t\t\tthrow new ExtensionConfigurationException(\n+\t\t\t\t\tformat(\"Method is annotated with %s but no %s or %s parameters were found.\", StdIo.class.getName(),\n+\t\t\t\t\t\tStdIn.class.getName(), StdOut.class.getName()));\n+\t\t\t}\n+\t\t\tif (!String.join(\"\", method.get().getAnnotation(StdIo.class).value()).isEmpty()\n+\t\t\t\t\t&& !params.contains(StdIn.class)) {\n+\t\t\t\tthrow new ExtensionConfigurationException(format(\n+\t\t\t\t\t\"Method has no %s parameter but input sources were provided in the %s annotation (Did you forget to add a test parameter?).\",\n+\t\t\t\t\tStdIn.class.getName(), StdIo.class.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxODIxMQ==", "bodyText": "The method gets no values provided, so the expected result is that out.capturedLines() is empty.\nWhere do the expected lines come from? (I know - from the code itself, but you get what I mean?)", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443218211", "createdAt": "2020-06-21T13:10:48Z", "author": {"login": "Bukama"}, "path": "src/test/java/org/junitpioneer/jupiter/StdIoExtensionTests.java", "diffHunk": "@@ -10,84 +10,115 @@\n \n package org.junitpioneer.jupiter;\n \n+import static java.lang.String.format;\n import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.fail;\n+import static org.junitpioneer.testkit.PioneerTestKit.executeTestMethod;\n+import static org.junitpioneer.testkit.PioneerTestKit.executeTestMethodWithParameterTypes;\n \n import java.io.BufferedReader;\n import java.io.IOException;\n+import java.io.InputStream;\n import java.io.InputStreamReader;\n+import java.io.PrintStream;\n \n import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer.OrderAnnotation;\n import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Order;\n import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n import org.junit.jupiter.api.extension.ExtendWith;\n+import org.junit.jupiter.api.extension.ExtensionConfigurationException;\n import org.junit.jupiter.api.extension.ParameterResolutionException;\n-import org.junitpioneer.jupiter.StdIOExtension.StdIn;\n-import org.junitpioneer.jupiter.StdIOExtension.StdOut;\n+import org.junitpioneer.jupiter.StdIoExtension.StdIn;\n+import org.junitpioneer.jupiter.StdIoExtension.StdOut;\n import org.junitpioneer.testkit.ExecutionResults;\n-import org.junitpioneer.testkit.PioneerTestKit;\n \n /**\n  * Shakespeare's Sonnet VII is in the public domain.\n  */\n-@DisplayName(\"StdIOExtension \")\n+@DisplayName(\"StdIoExtension \")\n public class StdIoExtensionTests {\n \n \tfinal BasicCommandLineApp app = new BasicCommandLineApp();\n \n+\tprivate final static PrintStream STDOUT = System.out;\n+\tprivate final static InputStream STDIN = System.in;\n+\n \t@Nested\n \t@DisplayName(\"with specific configuration \")\n \tclass ConfigurationTests {\n \n+\t\t@Test\n+\t\t@DisplayName(\"fails if the method is annotated but no parameter is passed to the test\")\n+\t\tvoid needsParameter() {\n+\t\t\tExecutionResults results = executeTestMethod(StdIoExtensionConfigurations.class, \"noParameter\");\n+\n+\t\t\tassertThat(results.firstFailuresThrowable())\n+\t\t\t\t\t.isInstanceOf(ExtensionConfigurationException.class)\n+\t\t\t\t\t.hasMessage(format(\"Method is annotated with %s but no %s or %s parameters were found.\",\n+\t\t\t\t\t\tStdIo.class.getName(), StdIn.class.getName(), StdOut.class.getName()));\n+\t\t}\n+\n \t\t@Test\n \t\t@DisplayName(\"fails if the parameter type is not StdIn or StdOut\")\n \t\tvoid needsType() {\n-\t\t\tExecutionResults results = PioneerTestKit\n-\t\t\t\t\t.executeTestMethodWithParameterTypes(StdIOExtensionConfigurations.class, \"badType\",\n-\t\t\t\t\t\tBoolean.class.getName());\n+\t\t\tExecutionResults results = executeTestMethodWithParameterTypes(StdIoExtensionConfigurations.class,\n+\t\t\t\t\"badType\", Boolean.class.getName());\n \n \t\t\tassertThat(results.firstFailuresThrowable())\n-\t\t\t\t\t.isInstanceOf(ParameterResolutionException.class)\n-\t\t\t\t\t.hasMessageContaining(\"No ParameterResolver registered\");\n+\t\t\t\t\t.isInstanceOf(ExtensionConfigurationException.class)\n+\t\t\t\t\t.hasMessage(format(\"Method is annotated with %s but no %s or %s parameters were found.\",\n+\t\t\t\t\t\tStdIo.class.getName(), StdIn.class.getName(), StdOut.class.getName()));\n \t\t}\n \n \t\t@Test\n-\t\t@DisplayName(\"fails if the parameter is StdIn but test method is not annotated with @StdInSource\")\n-\t\tvoid needsAnnotation() {\n-\t\t\tExecutionResults results = PioneerTestKit\n-\t\t\t\t\t.executeTestMethodWithParameterTypes(StdIOExtensionConfigurations.class, \"noAnnotation\",\n-\t\t\t\t\t\tStdIn.class.getName());\n+\t\t@DisplayName(\"fails if the parameter is StdIn or StdOut but StdIoExtension is not active\")\n+\t\tvoid needsExtension() {\n+\t\t\tExecutionResults results = executeTestMethodWithParameterTypes(\n+\t\t\t\tNotAnnotatedStdIoExtensionConfiguration.class, \"noAnnotation\", StdOut.class.getName());\n \n \t\t\tassertThat(results.firstFailuresThrowable())\n \t\t\t\t\t.isInstanceOf(ParameterResolutionException.class)\n-\t\t\t\t\t.hasMessageContainingAll(\"Can not resolve test method parameter\", \"Method has to be annotated\");\n+\t\t\t\t\t.hasMessageStartingWith(\"No ParameterResolver registered\");\n \t\t}\n \n \t\t@Test\n-\t\t@DisplayName(\"resolves parameter for type StdIn and annotation\")\n-\t\tvoid goodConfig_stdIn() {\n-\t\t\tExecutionResults results = PioneerTestKit\n-\t\t\t\t\t.executeTestMethodWithParameterTypes(StdIOExtensionConfigurations.class, \"resolveStdIn\",\n-\t\t\t\t\t\tStdIn.class.getName());\n-\t\t\tassertThat(results.numberOfStartedTests()).isGreaterThan(0);\n+\t\t@DisplayName(\"fails if the parameter is StdIn or StdOut but test method is not annotated with @StdIo\")\n+\t\tvoid needsAnnotation() {\n+\t\t\tExecutionResults results = executeTestMethodWithParameterTypes(StdIoExtensionConfigurations.class,\n+\t\t\t\t\"noAnnotation\", StdIn.class.getName());\n+\n+\t\t\tassertThat(results.firstFailuresThrowable())\n+\t\t\t\t\t// This is because the class is annotated with @ExtendWith\n+\t\t\t\t\t.isInstanceOf(ExtensionConfigurationException.class)\n+\t\t\t\t\t.hasMessage(\n+\t\t\t\t\t\tformat(\"StdIoExtension is active but no %s annotation was found.\", StdIo.class.getName()));\n \t\t}\n \n \t\t@Test\n-\t\t@DisplayName(\"resolves parameter for type StdOut\")\n-\t\tvoid goodConfig_stdOut() {\n-\t\t\tExecutionResults results = PioneerTestKit\n-\t\t\t\t\t.executeTestMethodWithParameterTypes(StdIOExtensionConfigurations.class, \"resolveStdOut\",\n-\t\t\t\t\t\tStdOut.class.getName());\n-\t\t\tassertThat(results.numberOfStartedTests()).isGreaterThan(0);\n+\t\t@DisplayName(\"fails if the method is annotated and has input sources but no StdIn parameter\")\n+\t\tvoid needsStdIn() {\n+\t\t\tExecutionResults results = executeTestMethodWithParameterTypes(StdIoExtensionConfigurations.class,\n+\t\t\t\t\"noStdIn\", StdOut.class.getName());\n+\n+\t\t\tassertThat(results.firstFailuresThrowable())\n+\t\t\t\t\t.isInstanceOf(ExtensionConfigurationException.class)\n+\t\t\t\t\t.hasMessage(format(\n+\t\t\t\t\t\t\"Method has no %s parameter but input sources were provided in the %s annotation (Did you forget to add a test parameter?).\",\n+\t\t\t\t\t\tStdIn.class.getName(), StdIo.class.getName()));\n \t\t}\n \n \t}\n \n \t@Nested\n-\t@ExtendWith(StdIOExtension.class)\n-\tclass ExtendWithTests {\n+\t@DisplayName(\"with standard configuration \")\n+\tclass StdIoTests {\n \n \t\t@Test\n \t\t@DisplayName(\"catches the output on the standard out as lines\")\n+\t\t@StdIo\n \t\tvoid catchesOut(StdOut out) {\n \t\t\tapp.write();\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxOTEwNQ==", "bodyText": "Just a note:\nThis nested class should be thread safe due the use of @TestMethodOrder regarding to JUnit 5 User Guide\n\nThe default execution mode is applied to all nodes of the test tree with a few notable exceptions, namely test classes that use the Lifecycle.PER_CLASS mode or a MethodOrderer (except for Random).", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443219105", "createdAt": "2020-06-21T13:22:28Z", "author": {"login": "Bukama"}, "path": "src/test/java/org/junitpioneer/jupiter/StdIoExtensionTests.java", "diffHunk": "@@ -122,10 +153,55 @@ void catchesBoth(StdIn in, StdOut out) throws IOException {\n \n \t}\n \n-\t@ExtendWith(StdIOExtension.class)\n-\tstatic class StdIOExtensionConfigurations {\n+\t@Nested\n+\t@TestMethodOrder(OrderAnnotation.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b920f8eae5d6b7fec42d4edaa25880308a1220"}, "originalPosition": 170}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40233c2e619c616d23e5ab41f0019f991d2a90b1", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/40233c2e619c616d23e5ab41f0019f991d2a90b1", "committedDate": "2020-06-21T18:44:49Z", "message": "Merge branch 'master' of https://github.com/junit-pioneer/junit-pioneer into issue/274-improve-std-io\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/org/junitpioneer/jupiter/StdInSource.java\n\u0001\tsrc/main/java/org/junitpioneer/jupiter/StdIoExtension.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75cb4e6c85f8d940202b916f04199fb8bf4cfc92", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/75cb4e6c85f8d940202b916f04199fb8bf4cfc92", "committedDate": "2020-06-21T18:51:52Z", "message": "Added comment to StdIo annotation\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a51f858a70e78700a8e136acbba8b79ac13e993", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/7a51f858a70e78700a8e136acbba8b79ac13e993", "committedDate": "2020-06-21T18:55:43Z", "message": "Renamed extension in package-info\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4b54be1c58d5f2c54dbf27dae16967071288edc", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/a4b54be1c58d5f2c54dbf27dae16967071288edc", "committedDate": "2020-06-21T19:31:21Z", "message": "Removed Optional - Method is required, ensured by JUnit\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MTU1NjU1", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#pullrequestreview-435155655", "createdAt": "2020-06-22T18:00:59Z", "commit": {"oid": "a4b54be1c58d5f2c54dbf27dae16967071288edc"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MTkzMTAy", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#pullrequestreview-435193102", "createdAt": "2020-06-22T18:58:11Z", "commit": {"oid": "a4b54be1c58d5f2c54dbf27dae16967071288edc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxODo1ODoxMVrOGnNLCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOTowNTozNVrOGnNZaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2MzQ2Nw==", "bodyText": "Is this Namespace intended to be created from DefaultLocaleExtension.class?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443763467", "createdAt": "2020-06-22T18:58:11Z", "author": {"login": "NPException"}, "path": "src/main/java/org/junitpioneer/jupiter/StdIoExtension.java", "diffHunk": "@@ -20,21 +20,38 @@\n import java.io.StringReader;\n import java.io.StringWriter;\n import java.io.Writer;\n+import java.lang.reflect.Method;\n+import java.util.Arrays;\n+import java.util.List;\n \n+import org.junit.jupiter.api.extension.AfterEachCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionConfigurationException;\n import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n import org.junit.jupiter.api.extension.ParameterContext;\n-import org.junit.jupiter.api.extension.ParameterResolutionException;\n import org.junit.jupiter.api.extension.ParameterResolver;\n \n /**\n  * <p>For details and examples, see\n  * <a href=\"https://junit-pioneer.org/docs/standard-input-output/\" target=\"_top\">the documentation on <code>Standard input/output</code></a>\n  * </p>\n  */\n-public class StdIOExtension implements ParameterResolver {\n+public class StdIoExtension implements ParameterResolver, BeforeTestExecutionCallback, AfterEachCallback {\n \n \tprivate static final String SEPARATOR = System.getProperty(\"line.separator\");\n \n+\tprivate static final Namespace NAMESPACE = Namespace.create(DefaultLocaleExtension.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4b54be1c58d5f2c54dbf27dae16967071288edc"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2NzE0NA==", "bodyText": "Could this break if only one of StdIn or StdOut is used?\nSystem.in or System.out may end up being null if one of these .get(...) calls returns null.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r443767144", "createdAt": "2020-06-22T19:05:35Z", "author": {"login": "NPException"}, "path": "src/main/java/org/junitpioneer/jupiter/StdIoExtension.java", "diffHunk": "@@ -20,21 +20,38 @@\n import java.io.StringReader;\n import java.io.StringWriter;\n import java.io.Writer;\n+import java.lang.reflect.Method;\n+import java.util.Arrays;\n+import java.util.List;\n \n+import org.junit.jupiter.api.extension.AfterEachCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionConfigurationException;\n import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n import org.junit.jupiter.api.extension.ParameterContext;\n-import org.junit.jupiter.api.extension.ParameterResolutionException;\n import org.junit.jupiter.api.extension.ParameterResolver;\n \n /**\n  * <p>For details and examples, see\n  * <a href=\"https://junit-pioneer.org/docs/standard-input-output/\" target=\"_top\">the documentation on <code>Standard input/output</code></a>\n  * </p>\n  */\n-public class StdIOExtension implements ParameterResolver {\n+public class StdIoExtension implements ParameterResolver, BeforeTestExecutionCallback, AfterEachCallback {\n \n \tprivate static final String SEPARATOR = System.getProperty(\"line.separator\");\n \n+\tprivate static final Namespace NAMESPACE = Namespace.create(DefaultLocaleExtension.class);\n+\n+\tprivate static final String IN_KEY = \"StdIo_In\";\n+\tprivate static final String OUT_KEY = \"StdIo_Out\";\n+\n+\t@Override\n+\tpublic void afterEach(ExtensionContext context) {\n+\t\tSystem.setIn(context.getStore(NAMESPACE).get(IN_KEY, InputStream.class)); //NOSONAR resetting input\n+\t\tSystem.setOut(context.getStore(NAMESPACE).get(OUT_KEY, PrintStream.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4b54be1c58d5f2c54dbf27dae16967071288edc"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2fd345ef27f612a5acb03f3751c1efde1cda839", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/e2fd345ef27f612a5acb03f3751c1efde1cda839", "committedDate": "2020-07-13T16:22:40Z", "message": "Added more tests, fixed resetting and documentation.\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff9f6993bcdf1cf8d809802690ab70f1dc9da172", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/ff9f6993bcdf1cf8d809802690ab70f1dc9da172", "committedDate": "2020-07-13T16:35:49Z", "message": "Spotless and CheckStyle ganged up on me again. :(\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3ODk5ODQz", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#pullrequestreview-447899843", "createdAt": "2020-07-14T08:32:02Z", "commit": {"oid": "ff9f6993bcdf1cf8d809802690ab70f1dc9da172"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ee6dc7fb2c46e8da19dccd230c6c0f56474f81c", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/2ee6dc7fb2c46e8da19dccd230c6c0f56474f81c", "committedDate": "2020-07-21T19:29:19Z", "message": "Merge branch 'master' into issue/274-improve-std-io"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63b236399b181d8d891d5af00e3354d3c4d0fd13", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/63b236399b181d8d891d5af00e3354d3c4d0fd13", "committedDate": "2020-07-21T19:49:24Z", "message": "Make StdIn optional an parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92a6b5b58d417e94ebe5a2559a6df6aad4d7f02e", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/92a6b5b58d417e94ebe5a2559a6df6aad4d7f02e", "committedDate": "2020-07-21T20:02:18Z", "message": "[WIP] Start updating documentation to new behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03d5496f451c2e8a18c251ce66261da40fd15c32", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/03d5496f451c2e8a18c251ce66261da40fd15c32", "committedDate": "2020-07-24T12:26:34Z", "message": "Small rewrite and more poetry.\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "257981af3ace4a7fa5094bf5ed984e416020ba58", "author": {"user": {"login": "Michael1993", "name": "Mih\u00e1ly Verh\u00e1s"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/257981af3ace4a7fa5094bf5ed984e416020ba58", "committedDate": "2020-07-24T12:32:58Z", "message": "I forgot about checkstyle and spotless again.\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83539edde2e1de74b69d5152b59f08a703d13798", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/83539edde2e1de74b69d5152b59f08a703d13798", "committedDate": "2020-07-28T18:21:47Z", "message": "Update documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDIyMjAz", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#pullrequestreview-457422203", "createdAt": "2020-07-29T11:13:54Z", "commit": {"oid": "83539edde2e1de74b69d5152b59f08a703d13798"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMToxMzo1NFrOG4zxyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMToxOToxMFrOG4z7dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIyMTc2OQ==", "bodyText": "The @StdIo annotation must be present. The StdIoExtension itself is not public and can only be registered with the annotation.\nWe could delete this condition and exception because this never happens and could be confusing.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r462221769", "createdAt": "2020-07-29T11:13:54Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StdIoExtension.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.lang.String.format;\n+\n+import java.io.InputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Method;\n+\n+import org.junit.jupiter.api.extension.AfterEachCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionConfigurationException;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+import org.junit.jupiter.api.extension.ParameterContext;\n+import org.junit.jupiter.api.extension.ParameterResolutionException;\n+import org.junit.jupiter.api.extension.ParameterResolver;\n+\n+class StdIoExtension implements ParameterResolver, BeforeTestExecutionCallback, AfterEachCallback {\n+\n+\tstatic final String SEPARATOR = System.getProperty(\"line.separator\");\n+\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StdIoExtension.class);\n+\n+\tprivate static final String SYSTEM_IN_KEY = \"StdIo_System_In\";\n+\tprivate static final String STD_IN_KEY = \"StdIo_Std_In\";\n+\tprivate static final String OUT_KEY = \"StdIo_Std_Out\";\n+\n+\t@Override\n+\tpublic boolean supportsParameter(ParameterContext parameterContext, ExtensionContext extensionContext) {\n+\t\tClass<?> type = parameterContext.getParameter().getType();\n+\t\treturn (type == StdIn.class || type == StdOut.class);\n+\t}\n+\n+\t@Override\n+\tpublic Object resolveParameter(ParameterContext parameterContext, ExtensionContext extensionContext) {\n+\t\tClass<?> parameterType = parameterContext.getParameter().getType();\n+\t\tif (parameterType == StdOut.class)\n+\t\t\treturn prepareStdOut(extensionContext);\n+\t\tif (parameterType == StdIn.class) {\n+\t\t\tString[] source = extensionContext.getRequiredTestMethod().getAnnotation(StdIo.class).value();\n+\t\t\tif (source.length == 0)\n+\t\t\t\tthrow new ExtensionConfigurationException(\n+\t\t\t\t\t\"@StdIo defined no input, so System.in is still in place and no StdIn parameter can be provided. \"\n+\t\t\t\t\t\t\t+ \"If you want to define empty input, use `@StdIo(\\\"\\\")`.\");\n+\t\t\telse\n+\t\t\t\t//@formatter:off\n+\t\t\t\treturn extensionContext\n+\t\t\t\t\t\t.getStore(NAMESPACE)\n+\t\t\t\t\t\t.getOrComputeIfAbsent(\n+\t\t\t\t\t\t\t\tSTD_IN_KEY,\n+\t\t\t\t\t\t\t\t__ -> createSwapStoreStdIn(extensionContext, source),\n+\t\t\t\t\t\t\t\tStdIn.class);\n+\t\t\t\t//@formatter:on\n+\t\t}\n+\t\tthrow new ParameterResolutionException(format(\"Could not resolve parameter of type %s.\", parameterType));\n+\t}\n+\n+\tprivate StdOut prepareStdOut(ExtensionContext context) {\n+\t\tstoreStdOut(context);\n+\t\treturn createOut();\n+\t}\n+\n+\tprivate void storeStdOut(ExtensionContext context) {\n+\t\tcontext.getStore(NAMESPACE).put(OUT_KEY, System.out); //NOSONAR never writing to System.out, only storing it\n+\t}\n+\n+\tprivate StdOut createOut() {\n+\t\tStdOut out = new StdOut();\n+\t\tSystem.setOut(new PrintStream(out));\n+\t\treturn out;\n+\t}\n+\n+\tprivate StdIn createSwapStoreStdIn(ExtensionContext context, String[] source) {\n+\t\tStdIn newStdIn = new StdIn(source);\n+\t\tswapAndStoreIn(context, newStdIn);\n+\t\treturn newStdIn;\n+\t}\n+\n+\tprivate void swapAndStoreIn(ExtensionContext context, StdIn stdIn) {\n+\t\tcontext.getStore(NAMESPACE).put(SYSTEM_IN_KEY, System.in); //NOSONAR never reading from System.in, only storing it\n+\t\tcontext.getStore(NAMESPACE).put(STD_IN_KEY, stdIn);\n+\t\tSystem.setIn(stdIn); //NOSONAR required to redirect output\n+\t}\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tfinal Method method = context.getRequiredTestMethod();\n+\t\tif (!method.isAnnotationPresent(StdIo.class))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83539edde2e1de74b69d5152b59f08a703d13798"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIyNDI0NA==", "bodyText": "This exception is never thrown. Could be deleted.\nFrom the ParameterResolver::resolveParameter documentation:\n\nThis method is only called by the framework if supportsParameter(org.junit.jupiter.api.extension.ParameterContext, org.junit.jupiter.api.extension.ExtensionContext) previously returned true for the same ParameterContext and ExtensionContext.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#discussion_r462224244", "createdAt": "2020-07-29T11:19:10Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StdIoExtension.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.lang.String.format;\n+\n+import java.io.InputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Method;\n+\n+import org.junit.jupiter.api.extension.AfterEachCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionConfigurationException;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+import org.junit.jupiter.api.extension.ParameterContext;\n+import org.junit.jupiter.api.extension.ParameterResolutionException;\n+import org.junit.jupiter.api.extension.ParameterResolver;\n+\n+class StdIoExtension implements ParameterResolver, BeforeTestExecutionCallback, AfterEachCallback {\n+\n+\tstatic final String SEPARATOR = System.getProperty(\"line.separator\");\n+\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StdIoExtension.class);\n+\n+\tprivate static final String SYSTEM_IN_KEY = \"StdIo_System_In\";\n+\tprivate static final String STD_IN_KEY = \"StdIo_Std_In\";\n+\tprivate static final String OUT_KEY = \"StdIo_Std_Out\";\n+\n+\t@Override\n+\tpublic boolean supportsParameter(ParameterContext parameterContext, ExtensionContext extensionContext) {\n+\t\tClass<?> type = parameterContext.getParameter().getType();\n+\t\treturn (type == StdIn.class || type == StdOut.class);\n+\t}\n+\n+\t@Override\n+\tpublic Object resolveParameter(ParameterContext parameterContext, ExtensionContext extensionContext) {\n+\t\tClass<?> parameterType = parameterContext.getParameter().getType();\n+\t\tif (parameterType == StdOut.class)\n+\t\t\treturn prepareStdOut(extensionContext);\n+\t\tif (parameterType == StdIn.class) {\n+\t\t\tString[] source = extensionContext.getRequiredTestMethod().getAnnotation(StdIo.class).value();\n+\t\t\tif (source.length == 0)\n+\t\t\t\tthrow new ExtensionConfigurationException(\n+\t\t\t\t\t\"@StdIo defined no input, so System.in is still in place and no StdIn parameter can be provided. \"\n+\t\t\t\t\t\t\t+ \"If you want to define empty input, use `@StdIo(\\\"\\\")`.\");\n+\t\t\telse\n+\t\t\t\t//@formatter:off\n+\t\t\t\treturn extensionContext\n+\t\t\t\t\t\t.getStore(NAMESPACE)\n+\t\t\t\t\t\t.getOrComputeIfAbsent(\n+\t\t\t\t\t\t\t\tSTD_IN_KEY,\n+\t\t\t\t\t\t\t\t__ -> createSwapStoreStdIn(extensionContext, source),\n+\t\t\t\t\t\t\t\tStdIn.class);\n+\t\t\t\t//@formatter:on\n+\t\t}\n+\t\tthrow new ParameterResolutionException(format(\"Could not resolve parameter of type %s.\", parameterType));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83539edde2e1de74b69d5152b59f08a703d13798"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDI3NTIw", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/275#pullrequestreview-457427520", "createdAt": "2020-07-29T11:22:37Z", "commit": {"oid": "83539edde2e1de74b69d5152b59f08a703d13798"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7b86a4b4e75ee27a67b05ccea0aab21fa6ccf1c", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/a7b86a4b4e75ee27a67b05ccea0aab21fa6ccf1c", "committedDate": "2020-07-30T09:38:26Z", "message": "Switch to 'BeforeEach' extension point"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a413db5374ef5595a86407c0f83e47702e49931", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/1a413db5374ef5595a86407c0f83e47702e49931", "committedDate": "2020-07-30T09:41:57Z", "message": "Use annotation utils to detect @StdIo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3784, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}