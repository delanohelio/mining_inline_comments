{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2ODAyMDY3", "number": 182, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODoxNTo1OFrODnMX3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwOTozOToxN1rOFBr2Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNDIzNzczOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODoxNTo1OFrOF1DLiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxODoyMDo0N1rOF469eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MDk1Mw==", "bodyText": "I'm sorry to bother you with this but wouldn't this get overwritten if I run two test files with the @Stopwatch annotation?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r391170953", "createdAt": "2020-03-11T18:15:58Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import org.junit.jupiter.api.extension.AfterAllCallback;\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeAllCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+import org.junitpioneer.jupiter.enumerations.TestunitEnum;\n+\n+import java.time.Clock;\n+\n+import static java.lang.System.currentTimeMillis;\n+import static org.junitpioneer.jupiter.Utils.annotationPresentOnTestClass;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension\n+\t\timplements BeforeAllCallback, BeforeTestExecutionCallback, AfterTestExecutionCallback, AfterAllCallback {\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Stores the current time for the given testunit in the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tvoid storeNowAsLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tcontext.getStore(NAMESPACE).put(unit, clock.instant().toEpochMilli());\n+\t}\n+\n+\t/**\n+\t * Loads the stored time for the given testunit from the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tlong loadLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\treturn context.getStore(NAMESPACE).get(unit, long.class);\n+\t}\n+\n+\t/**\n+\t * Calculates the elapsed time for the testunit and publishs it to the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testunit for which the time should be calculated and published\n+\t */\n+\tvoid calculateAndReportElapsedTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tlong launchTime = loadLaunchTime(context, unit);\n+\t\tlong elapsedTime = currentTimeMillis() - launchTime;\n+\n+\t\tString message = String.format(\"%s '%s' took %d ms.\", unit.name(), context.getDisplayName(), elapsedTime);\n+\t\tcontext.publishReportEntry(\"stopwatch\", message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d0b0db3f874f5ab0b700eff255b119d7a262d0e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MTczMA==", "bodyText": "I'm fairly new to the TestReporter as is, so I really am just asking for information.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r391171730", "createdAt": "2020-03-11T18:17:12Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import org.junit.jupiter.api.extension.AfterAllCallback;\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeAllCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+import org.junitpioneer.jupiter.enumerations.TestunitEnum;\n+\n+import java.time.Clock;\n+\n+import static java.lang.System.currentTimeMillis;\n+import static org.junitpioneer.jupiter.Utils.annotationPresentOnTestClass;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension\n+\t\timplements BeforeAllCallback, BeforeTestExecutionCallback, AfterTestExecutionCallback, AfterAllCallback {\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Stores the current time for the given testunit in the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tvoid storeNowAsLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tcontext.getStore(NAMESPACE).put(unit, clock.instant().toEpochMilli());\n+\t}\n+\n+\t/**\n+\t * Loads the stored time for the given testunit from the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tlong loadLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\treturn context.getStore(NAMESPACE).get(unit, long.class);\n+\t}\n+\n+\t/**\n+\t * Calculates the elapsed time for the testunit and publishs it to the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testunit for which the time should be calculated and published\n+\t */\n+\tvoid calculateAndReportElapsedTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tlong launchTime = loadLaunchTime(context, unit);\n+\t\tlong elapsedTime = currentTimeMillis() - launchTime;\n+\n+\t\tString message = String.format(\"%s '%s' took %d ms.\", unit.name(), context.getDisplayName(), elapsedTime);\n+\t\tcontext.publishReportEntry(\"stopwatch\", message);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MDk1Mw=="}, "originalCommit": {"oid": "9d0b0db3f874f5ab0b700eff255b119d7a262d0e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQyOTU2NQ==", "bodyText": "I'm not sure as I used the TestReporter for the first time, but as I understand it the context is for each test case. But I'm not sure.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r391429565", "createdAt": "2020-03-12T06:52:52Z", "author": {"login": "Bukama"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import org.junit.jupiter.api.extension.AfterAllCallback;\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeAllCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+import org.junitpioneer.jupiter.enumerations.TestunitEnum;\n+\n+import java.time.Clock;\n+\n+import static java.lang.System.currentTimeMillis;\n+import static org.junitpioneer.jupiter.Utils.annotationPresentOnTestClass;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension\n+\t\timplements BeforeAllCallback, BeforeTestExecutionCallback, AfterTestExecutionCallback, AfterAllCallback {\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Stores the current time for the given testunit in the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tvoid storeNowAsLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tcontext.getStore(NAMESPACE).put(unit, clock.instant().toEpochMilli());\n+\t}\n+\n+\t/**\n+\t * Loads the stored time for the given testunit from the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tlong loadLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\treturn context.getStore(NAMESPACE).get(unit, long.class);\n+\t}\n+\n+\t/**\n+\t * Calculates the elapsed time for the testunit and publishs it to the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testunit for which the time should be calculated and published\n+\t */\n+\tvoid calculateAndReportElapsedTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tlong launchTime = loadLaunchTime(context, unit);\n+\t\tlong elapsedTime = currentTimeMillis() - launchTime;\n+\n+\t\tString message = String.format(\"%s '%s' took %d ms.\", unit.name(), context.getDisplayName(), elapsedTime);\n+\t\tcontext.publishReportEntry(\"stopwatch\", message);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MDk1Mw=="}, "originalCommit": {"oid": "9d0b0db3f874f5ab0b700eff255b119d7a262d0e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIzMDU4NQ==", "bodyText": "@sormuras Can you enlighten us?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r395230585", "createdAt": "2020-03-19T18:20:47Z", "author": {"login": "Bukama"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import org.junit.jupiter.api.extension.AfterAllCallback;\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeAllCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+import org.junitpioneer.jupiter.enumerations.TestunitEnum;\n+\n+import java.time.Clock;\n+\n+import static java.lang.System.currentTimeMillis;\n+import static org.junitpioneer.jupiter.Utils.annotationPresentOnTestClass;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension\n+\t\timplements BeforeAllCallback, BeforeTestExecutionCallback, AfterTestExecutionCallback, AfterAllCallback {\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterTestExecution(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.TEST);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterAll(ExtensionContext context) {\n+\t\tif (annotationPresentOnTestClass(context, Stopwatch.class)) {\n+\t\t\tcalculateAndReportElapsedTime(context, TestunitEnum.CLASS);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Stores the current time for the given testunit in the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tvoid storeNowAsLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tcontext.getStore(NAMESPACE).put(unit, clock.instant().toEpochMilli());\n+\t}\n+\n+\t/**\n+\t * Loads the stored time for the given testunit from the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testobject for which the time should be stored\n+\t */\n+\tlong loadLaunchTime(ExtensionContext context, TestunitEnum unit) {\n+\t\treturn context.getStore(NAMESPACE).get(unit, long.class);\n+\t}\n+\n+\t/**\n+\t * Calculates the elapsed time for the testunit and publishs it to the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t * @param unit Testunit for which the time should be calculated and published\n+\t */\n+\tvoid calculateAndReportElapsedTime(ExtensionContext context, TestunitEnum unit) {\n+\t\tlong launchTime = loadLaunchTime(context, unit);\n+\t\tlong elapsedTime = currentTimeMillis() - launchTime;\n+\n+\t\tString message = String.format(\"%s '%s' took %d ms.\", unit.name(), context.getDisplayName(), elapsedTime);\n+\t\tcontext.publishReportEntry(\"stopwatch\", message);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MDk1Mw=="}, "originalCommit": {"oid": "9d0b0db3f874f5ab0b700eff255b119d7a262d0e"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mzc0MDMyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjozODoyOVrOG0KEpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjo0MDo0NFrOG0KK6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM0NDE2Nw==", "bodyText": "I honestly think either this check is unnecessary or should throw an ExtensionConfigurationException.\nThis extension can be invoked by two things:\n\nAdding the @Stopwatch annotation (which has @ExtendWith(StopwatchExtension.class))\nAdding @ExtendWith(StopwatchExtension.class) to your test class\n\nIf the explicit registration is not considered bad configuration then this check is unnecessary.\nIf the explicit registration is considered bad configuration then this check should be the other way around, i.e.:\nif (!PioneerAnnotationUtils.isAnyAnnotationPresent(context, Stopwatch.class) {\n    throw new ExtensionConfigurationException(/* Meaningful message */);\n}\nstoreNowAsLaunchTime(context);", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r457344167", "createdAt": "2020-07-20T12:38:29Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.lang.System.currentTimeMillis;\n+\n+import java.time.Clock;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tif (PioneerAnnotationUtils.isAnyAnnotationPresent(context, Stopwatch.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a448e77aa8d4cbca1f3f506ef46c285cdc918f1"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM0NTc3MA==", "bodyText": "An additional note - you could write a test for this. Have a class annotated with @ExtendWith(StopwatchExtension.class) and a @Test not annotated with @Stopwatch. Execute it with the testkit and the result should be a failed test and an ExtensionConfigurationException.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r457345770", "createdAt": "2020-07-20T12:40:44Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.lang.System.currentTimeMillis;\n+\n+import java.time.Clock;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tif (PioneerAnnotationUtils.isAnyAnnotationPresent(context, Stopwatch.class)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM0NDE2Nw=="}, "originalCommit": {"oid": "2a448e77aa8d4cbca1f3f506ef46c285cdc918f1"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mzc0MjQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjozODo1N1rOG0KF2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjozODo1N1rOG0KF2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM0NDQ3NA==", "bodyText": "The same thing here - unnecessary or the other way around.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r457344474", "createdAt": "2020-07-20T12:38:57Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.lang.System.currentTimeMillis;\n+\n+import java.time.Clock;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tif (PioneerAnnotationUtils.isAnyAnnotationPresent(context, Stopwatch.class)) {\n+\t\t\tstoreNowAsLaunchTime(context);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void afterTestExecution(ExtensionContext context) {\n+\t\tif (PioneerAnnotationUtils.isAnyAnnotationPresent(context, Stopwatch.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a448e77aa8d4cbca1f3f506ef46c285cdc918f1"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODk3MzY5OnYy", "diffSide": "RIGHT", "path": "docs/stopwatch.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzowODowMlrOHWs-CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzowODowMlrOHWs-CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU2NzQ5Nw==", "bodyText": "I recommend linking the relevant part (about TestReporter) of the JUnit User Guide.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r493567497", "createdAt": "2020-09-23T13:08:02Z", "author": {"login": "Michael1993"}, "path": "docs/stopwatch.adoc", "diffHunk": "@@ -0,0 +1,22 @@\n+:page-title: Stopwatch\n+:page-description: Extends JUnit Jupiter with `@Stopwatch`to measure elapsed time of a test method\n+\n+== Introduction\n+\n+Test shall be fast.\n+To get a feeling how fast or slow a specific test the `@Stopwatch` annotation can be used.\n+It will measure elapsed time and pass the result to the test reporter, which will publish it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f64da9e0ded3b49db496bdce3788cc056abf4f4"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODk4OTc2OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/junitpioneer/jupiter/StopwatchExtensionTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzoxMDozOVrOHWtIaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzoxMDozOVrOHWtIaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU3MDE1Mw==", "bodyText": "Typo in classs", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r493570153", "createdAt": "2020-09-23T13:10:39Z", "author": {"login": "Michael1993"}, "path": "src/test/java/org/junitpioneer/jupiter/StopwatchExtensionTests.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+import org.junit.platform.engine.reporting.ReportEntry;\n+import org.junitpioneer.testkit.ExecutionResults;\n+import org.junitpioneer.testkit.PioneerTestKit;\n+import org.junitpioneer.testkit.assertion.PioneerAssert;\n+\n+@DisplayName(\"Stopwatch extension \")\n+public class StopwatchExtensionTests {\n+\n+\t@DisplayName(\"should be executed with annotation on class level and report an entry for test method\")\n+\t@Test\n+\tvoid runClassLevelAnnotationTest() {\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestClass(StopwatchExtensionTests.ClassLevelAnnotationTest.class);\n+\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(1);\n+\n+\t\tString methodName = \"stopwatchExtensionShouldBeExecutedWithAnnotationOnClassLevel\";\n+\t\tassertStringStartWithUnitAndContainsName(results, methodName);\n+\n+\t}\n+\n+\t@DisplayName(\"should be executed with annotation on class level and test method and report an entry for test method\")\n+\t@Test\n+\tvoid runClassAndMethodLevelAnnotationTest() {\n+\t\tString methodName = \"stopwatchExtensionShouldBeExecutedWithAnnotationOnClassAndMethodLevel\";\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestClass(StopwatchExtensionTests.ClassAndMethodLevelAnnotationTest.class);\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(1);\n+\n+\t\tassertStringStartWithUnitAndContainsName(results, methodName);\n+\t}\n+\n+\t@DisplayName(\"should be executed with annotation on test method and report an entry for test method\")\n+\t@Test\n+\tvoid runMethodLevelAnnotationTest() {\n+\t\tString methodName = \"stopwatchExtensionShouldBeExecutedOnWithAnnotationOnMethodLevel\";\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestMethod(StopwatchExtensionTests.MethodLevelAnnotationTest.class, methodName);\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(1);\n+\n+\t\tassertStringStartWithUnitAndContainsName(results, methodName);\n+\t}\n+\n+\t@DisplayName(\"should not be executed and therefore no entry should be published\")\n+\t@Test\n+\tvoid runAnnotationTest() {\n+\t\tString methodName = \"stopwatchExtensionShouldNotBeExecuted\";\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestMethod(StopwatchExtensionTests.MethodLevelAnnotationTest.class, methodName);\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(0);\n+\n+\t}\n+\n+\tprivate void assertStringStartWithUnitAndContainsName(ExecutionResults results, String name) {\n+\n+\t\tMap<String, String> reportEntry = firstReportEntry(results);\n+\n+\t\tassertThat(reportEntry).hasSize(1);\n+\n+\t\tString result = reportEntry.get(\"stopwatch\");\n+\t\tassertThat(result).isNotNull();\n+\n+\t\tString startsWith = String.format(\"Execution of '%s()' took [\", name);\n+\n+\t\tassertThat(result).startsWith(startsWith);\n+\t\tassertThat(result).endsWith(\"] ms.\");\n+\t}\n+\n+\t/**\n+\t * Retrieves the first published ReportEntry.\n+\t * The possibility to retrieve the ReportEntries of a test execution was removed during\n+\t * the improvement of the PioneerAssertions.\n+\t *\n+\t * @param results Results of the test execution\n+\t * @return The first ReportEntry\n+\t */\n+\tprivate Map<String, String> firstReportEntry(ExecutionResults results) {\n+\t\tList<Map<String, String>> reportEntries = results\n+\t\t\t\t.allEvents()\n+\t\t\t\t.reportingEntryPublished()\n+\t\t\t\t.stream()\n+\t\t\t\t.map(event -> event.getPayload(org.junit.platform.engine.reporting.ReportEntry.class))\n+\t\t\t\t.filter(Optional::isPresent)\n+\t\t\t\t.map(Optional::get)\n+\t\t\t\t.map(ReportEntry::getKeyValuePairs)\n+\t\t\t\t.collect(toList());\n+\n+\t\treturn reportEntries.get(0);\n+\t}\n+\n+\t/**\n+\t * Inner test class for testing the class level annotation.\n+\t */\n+\t@Stopwatch\n+\tstatic class ClassLevelAnnotationTest {\n+\n+\t\t@Test\n+\t\tvoid stopwatchExtensionShouldBeExecutedWithAnnotationOnClassLevel() {\n+\t\t}\n+\n+\t}\n+\n+\t/**\n+\t * Inner test class for testing the method level annotation.\n+\t */\n+\tstatic class MethodLevelAnnotationTest {\n+\n+\t\t@Stopwatch\n+\t\t@Test\n+\t\tvoid stopwatchExtensionShouldBeExecutedOnWithAnnotationOnMethodLevel() {\n+\t\t}\n+\n+\t}\n+\n+\t/**\n+\t * Inner test class for testing the class level annotation.\n+\t */\n+\t@Stopwatch\n+\tstatic class ClassAndMethodLevelAnnotationTest {\n+\n+\t\t@Stopwatch\n+\t\t@Test\n+\t\tvoid stopwatchExtensionShouldBeExecutedWithAnnotationOnClassAndMethodLevel() {\n+\t\t}\n+\n+\t}\n+\n+\t/**\n+\t * Inner test class for testing a not annotated method / classs annotation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f64da9e0ded3b49db496bdce3788cc056abf4f4"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NzM2MDE5OnYy", "diffSide": "RIGHT", "path": "docs/docs-nav.yml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwOTozMTowNlrOH_vrCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQwOTowMDowOVrOIAHa0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjYwMzQwMw==", "bodyText": "Just \"Stopwatch\"? Perhaps the title should be a bit more verbose?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r536603403", "createdAt": "2020-12-05T09:31:06Z", "author": {"login": "Michael1993"}, "path": "docs/docs-nav.yml", "diffHunk": "@@ -20,6 +20,8 @@\n         url: /docs/retrying-test/\n       - title: \"Standard Input and Output\"\n         url: /docs/standard-input-output/\n+      - title: \"Stopwatch\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a50818309fa20cafbac41b6b6b416af624f68b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMzk0MQ==", "bodyText": "Better?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r536833941", "createdAt": "2020-12-05T18:08:34Z", "author": {"login": "Bukama"}, "path": "docs/docs-nav.yml", "diffHunk": "@@ -20,6 +20,8 @@\n         url: /docs/retrying-test/\n       - title: \"Standard Input and Output\"\n         url: /docs/standard-input-output/\n+      - title: \"Stopwatch\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjYwMzQwMw=="}, "originalCommit": {"oid": "37a50818309fa20cafbac41b6b6b416af624f68b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg2MzQ1Nw==", "bodyText": "It's better, I think. But now it's not in sync with the :page_title: attribute of the actual document. \ud83d\ude22", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r536863457", "createdAt": "2020-12-05T18:57:34Z", "author": {"login": "Michael1993"}, "path": "docs/docs-nav.yml", "diffHunk": "@@ -20,6 +20,8 @@\n         url: /docs/retrying-test/\n       - title: \"Standard Input and Output\"\n         url: /docs/standard-input-output/\n+      - title: \"Stopwatch\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjYwMzQwMw=="}, "originalCommit": {"oid": "37a50818309fa20cafbac41b6b6b416af624f68b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk5MjQ2NA==", "bodyText": "Docs aligned (and sime typos fixed)", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r536992464", "createdAt": "2020-12-06T09:00:09Z", "author": {"login": "Bukama"}, "path": "docs/docs-nav.yml", "diffHunk": "@@ -20,6 +20,8 @@\n         url: /docs/retrying-test/\n       - title: \"Standard Input and Output\"\n         url: /docs/standard-input-output/\n+      - title: \"Stopwatch\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjYwMzQwMw=="}, "originalCommit": {"oid": "37a50818309fa20cafbac41b6b6b416af624f68b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NzM4Mjg4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwOTozNDoxNVrOH_v6Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwOTozNDoxNVrOH_v6Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjYwNzMwMg==", "bodyText": "You use clock.instant().toEpochMilli() earlier but currentTimeMillis() here. Any particular reason these are not in sync? Should they be in sync?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r536607302", "createdAt": "2020-12-05T09:34:15Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.lang.System.currentTimeMillis;\n+\n+import java.time.Clock;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tstoreNowAsLaunchTime(context);\n+\t}\n+\n+\t@Override\n+\tpublic void afterTestExecution(ExtensionContext context) {\n+\t\tcalculateAndReportElapsedTime(context);\n+\t}\n+\n+\t/**\n+\t * Stores the current time for the method in the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t */\n+\tvoid storeNowAsLaunchTime(ExtensionContext context) {\n+\t\tcontext.getStore(NAMESPACE).put(context.getUniqueId(), clock.instant().toEpochMilli());\n+\t}\n+\n+\t/**\n+\t * Loads the stored time for method from the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t */\n+\tlong loadLaunchTime(ExtensionContext context) {\n+\t\treturn context.getStore(NAMESPACE).get(context.getUniqueId(), long.class);\n+\t}\n+\n+\t/**\n+\t * Calculates the elapsed time method and publishes it to the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t */\n+\tvoid calculateAndReportElapsedTime(ExtensionContext context) {\n+\t\tlong launchTime = loadLaunchTime(context);\n+\t\tlong elapsedTime = currentTimeMillis() - launchTime;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a50818309fa20cafbac41b6b6b416af624f68b"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NzM5MTI2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwOTozNToyOFrOH_wAUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwOTozNToyOFrOH_wAUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjYwODg1MQ==", "bodyText": "Please extract the key to a constant - I'd also prefer if the key were \"StopwatchExtension\", but that is more or less a matter of taste.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r536608851", "createdAt": "2020-12-05T09:35:28Z", "author": {"login": "Michael1993"}, "path": "src/main/java/org/junitpioneer/jupiter/StopwatchExtension.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.lang.System.currentTimeMillis;\n+\n+import java.time.Clock;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ExtensionContext.Namespace;\n+\n+/**\n+ * The StopwatchExtension implements callback methods for the {@code @Stopwatch} annotation.\n+ */\n+class StopwatchExtension implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+\tprivate final Clock clock = Clock.systemUTC();\n+\tprivate static final Namespace NAMESPACE = Namespace.create(StopwatchExtension.class);\n+\n+\t@Override\n+\tpublic void beforeTestExecution(ExtensionContext context) {\n+\t\tstoreNowAsLaunchTime(context);\n+\t}\n+\n+\t@Override\n+\tpublic void afterTestExecution(ExtensionContext context) {\n+\t\tcalculateAndReportElapsedTime(context);\n+\t}\n+\n+\t/**\n+\t * Stores the current time for the method in the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t */\n+\tvoid storeNowAsLaunchTime(ExtensionContext context) {\n+\t\tcontext.getStore(NAMESPACE).put(context.getUniqueId(), clock.instant().toEpochMilli());\n+\t}\n+\n+\t/**\n+\t * Loads the stored time for method from the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t */\n+\tlong loadLaunchTime(ExtensionContext context) {\n+\t\treturn context.getStore(NAMESPACE).get(context.getUniqueId(), long.class);\n+\t}\n+\n+\t/**\n+\t * Calculates the elapsed time method and publishes it to the execution context.\n+\t *\n+\t * @param context Extension context of the class\n+\t */\n+\tvoid calculateAndReportElapsedTime(ExtensionContext context) {\n+\t\tlong launchTime = loadLaunchTime(context);\n+\t\tlong elapsedTime = currentTimeMillis() - launchTime;\n+\n+\t\tString message = String.format(\"Execution of '%s' took [%d] ms.\", context.getDisplayName(), elapsedTime);\n+\t\tcontext.publishReportEntry(\"stopwatch\", message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a50818309fa20cafbac41b6b6b416af624f68b"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NzYxMTA2OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/junitpioneer/jupiter/StopwatchExtensionTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxMDowNzo1OVrOH_yUNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxMDowNzo1OVrOH_yUNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjY0NjcwOQ==", "bodyText": "Since you only assert a single report entry, you could use the new and shiny andThen(Consumer<Map.Entry<String,String>>) method. Something like this:\nassertThat(results).hasNumberOfReportEntries(1).andThen(entry -> {\n\tassertThat(entry.getKey()).isEqualTo(\"stopwatch\");\n\tassertThat(entry.getValue()).matches(format(\"Execution of '%s\\\\(\\\\)' took \\\\[[0-9]*\\\\] ms.\", methodName));\n});", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r536646709", "createdAt": "2020-12-05T10:07:59Z", "author": {"login": "Michael1993"}, "path": "src/test/java/org/junitpioneer/jupiter/StopwatchExtensionTests.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+import org.junit.platform.engine.reporting.ReportEntry;\n+import org.junitpioneer.testkit.ExecutionResults;\n+import org.junitpioneer.testkit.PioneerTestKit;\n+import org.junitpioneer.testkit.assertion.PioneerAssert;\n+\n+@DisplayName(\"Stopwatch extension \")\n+public class StopwatchExtensionTests {\n+\n+\t@DisplayName(\"should be executed with annotation on class level and report an entry for test method\")\n+\t@Test\n+\tvoid runClassLevelAnnotationTest() {\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestClass(StopwatchExtensionTests.ClassLevelAnnotationTest.class);\n+\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(1);\n+\n+\t\tString methodName = \"stopwatchExtensionShouldBeExecutedWithAnnotationOnClassLevel\";\n+\t\tassertStringStartWithUnitAndContainsName(results, methodName);\n+\n+\t}\n+\n+\t@DisplayName(\"should be executed with annotation on class level and test method and report an entry for test method\")\n+\t@Test\n+\tvoid runClassAndMethodLevelAnnotationTest() {\n+\t\tString methodName = \"stopwatchExtensionShouldBeExecutedWithAnnotationOnClassAndMethodLevel\";\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestClass(StopwatchExtensionTests.ClassAndMethodLevelAnnotationTest.class);\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(1);\n+\n+\t\tassertStringStartWithUnitAndContainsName(results, methodName);\n+\t}\n+\n+\t@DisplayName(\"should be executed with annotation on test method and report an entry for test method\")\n+\t@Test\n+\tvoid runMethodLevelAnnotationTest() {\n+\t\tString methodName = \"stopwatchExtensionShouldBeExecutedOnWithAnnotationOnMethodLevel\";\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestMethod(StopwatchExtensionTests.MethodLevelAnnotationTest.class, methodName);\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(1);\n+\n+\t\tassertStringStartWithUnitAndContainsName(results, methodName);\n+\t}\n+\n+\t@DisplayName(\"should not be executed and therefore no entry should be published\")\n+\t@Test\n+\tvoid runAnnotationTest() {\n+\t\tString methodName = \"stopwatchExtensionShouldNotBeExecuted\";\n+\n+\t\tExecutionResults results = PioneerTestKit\n+\t\t\t\t.executeTestMethod(StopwatchExtensionTests.NonAnnotationTest.class, methodName);\n+\t\tPioneerAssert.assertThat(results).hasNumberOfReportEntries(0);\n+\n+\t}\n+\n+\tprivate void assertStringStartWithUnitAndContainsName(ExecutionResults results, String name) {\n+\n+\t\tMap<String, String> reportEntry = firstReportEntry(results);\n+\n+\t\tassertThat(reportEntry).hasSize(1);\n+\n+\t\tString result = reportEntry.get(\"stopwatch\");\n+\t\tassertThat(result).isNotNull();\n+\n+\t\tString startsWith = String.format(\"Execution of '%s()' took [\", name);\n+\n+\t\tassertThat(result).startsWith(startsWith);\n+\t\tassertThat(result).endsWith(\"] ms.\");\n+\t}\n+\n+\t/**\n+\t * Retrieves the first published ReportEntry.\n+\t * The possibility to retrieve the ReportEntries of a test execution was removed during\n+\t * the improvement of the PioneerAssertions.\n+\t *\n+\t * @param results Results of the test execution\n+\t * @return The first ReportEntry\n+\t */\n+\tprivate Map<String, String> firstReportEntry(ExecutionResults results) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37a50818309fa20cafbac41b6b6b416af624f68b"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3MzExMjUwOnYy", "diffSide": "RIGHT", "path": "docs/stopwatch.adoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwOTozOToxN1rOIAd6BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNzoxOTowMlrOIAxj4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM2MDkwMQ==", "bodyText": "Hm, I'm not sure if this does what you think it does. Shouldn't it be: url[`text`] instead of `url[text]`?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r537360901", "createdAt": "2020-12-07T09:39:17Z", "author": {"login": "Michael1993"}, "path": "docs/stopwatch.adoc", "diffHunk": "@@ -0,0 +1,22 @@\n+:page-title: Measuring time with a Stopwatch\n+:page-description: Extends JUnit Jupiter with `@Stopwatch` to measure elapsed time of a test method\n+\n+== Introduction\n+\n+Test shall be fast.\n+To get a feeling how fast or slow a specific test is, the `@Stopwatch` annotation can be used.\n+It will measure elapsed time and pass the result to the `https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/TestReporter.html[TestReporter]`, which will publish it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d875df9ceed34e5f96525fb237bceb39064833"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY4MjkxMw==", "bodyText": "It creates a link in the code format. And my IDEA ASCII DOC plugin tells me it works (the link is correctly clickable in the preview and opens the desired page)", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/182#discussion_r537682913", "createdAt": "2020-12-07T17:19:02Z", "author": {"login": "Bukama"}, "path": "docs/stopwatch.adoc", "diffHunk": "@@ -0,0 +1,22 @@\n+:page-title: Measuring time with a Stopwatch\n+:page-description: Extends JUnit Jupiter with `@Stopwatch` to measure elapsed time of a test method\n+\n+== Introduction\n+\n+Test shall be fast.\n+To get a feeling how fast or slow a specific test is, the `@Stopwatch` annotation can be used.\n+It will measure elapsed time and pass the result to the `https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/TestReporter.html[TestReporter]`, which will publish it.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM2MDkwMQ=="}, "originalCommit": {"oid": "c6d875df9ceed34e5f96525fb237bceb39064833"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4189, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}