{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTE1NTEx", "number": 242, "title": "Environmentvariableextension securitymanager tests", "bodyText": "resolves #241\nI hereby agree to the terms of the JUnit Pioneer Contributor License Agreement.", "createdAt": "2020-04-25T14:23:10Z", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242", "merged": true, "mergeCommit": {"oid": "bc4d50bcf972c042a9dced4c25f624dde3fbf06b"}, "closed": true, "closedAt": "2020-07-14T20:13:35Z", "author": {"login": "Hancho2009"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbGi_MgH2gAyNDA4OTE1NTExOjM4NjEzODQxNjRjOTY4NmVhNDEwYjYzNTRjYzc5YTczYWNkYmI3MzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc071qAgFqTQ0ODQzMDQ5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3861384164c9686ea410b6354cc79a73acdbb733", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/3861384164c9686ea410b6354cc79a73acdbb733", "committedDate": "2020-04-25T13:59:41Z", "message": "Add tests for EnvironmentVariableUtilsTests with SecurityManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5db87216277786121796bc0e64cef8866914a82", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/e5db87216277786121796bc0e64cef8866914a82", "committedDate": "2020-04-25T14:19:23Z", "message": "adjust comment in policy files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61099a74f850e8c8d36876b7a3b953f1d9d1eeab", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/61099a74f850e8c8d36876b7a3b953f1d9d1eeab", "committedDate": "2020-04-25T14:50:10Z", "message": "add permission for gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd69896782ff9e1a3ed69c41271b63af4e64e8af", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/fd69896782ff9e1a3ed69c41271b63af4e64e8af", "committedDate": "2020-04-25T20:49:40Z", "message": "fix gradle problesm and some refactroing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2334364fed090f1c6e0b09b1e1496b5404cecf00", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/2334364fed090f1c6e0b09b1e1496b5404cecf00", "committedDate": "2020-04-25T20:55:58Z", "message": "fix java 14 problem with assertj logger permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acca96ac66824aad9b821f8f1bb839afd3357bc0", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/acca96ac66824aad9b821f8f1bb839afd3357bc0", "committedDate": "2020-04-25T21:01:11Z", "message": "fix not enough permissions problem during test execution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNDMxNDQ4", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#pullrequestreview-400431448", "createdAt": "2020-04-25T21:06:55Z", "commit": {"oid": "acca96ac66824aad9b821f8f1bb839afd3357bc0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTowNjo1NVrOGL6Zkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTowNjo1NVrOGL6Zkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDMzOA==", "bodyText": "Does something like that needs to be called after the SystemProperty java.security.policy is reverted after the test?", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r415144338", "createdAt": "2020-04-25T21:06:55Z", "author": {"login": "Hancho2009"}, "path": "src/test/java/org/junitpioneer/jupiter/EnvironmentVariableUtilsTests.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatCode;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import java.security.AccessControlException;\n+import java.security.Policy;\n+\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+@DisplayName(\"EnvironmentVariableUtils\")\n+@ClearEnvironmentVariable(key = \"TEST\")\n+class EnvironmentVariableUtilsTests {\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/default-testing.policy\")\n+\tvoid shouldThrowAccessControlExceptionWithDefaultSecurityManager() {\n+\t\texecuteWithSecurityManager(() -> assertThatThrownBy(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\"))\n+\t\t\t\t.isInstanceOf(AccessControlException.class));\n+\t}\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/reflect-permission-testing.policy\")\n+\tvoid shouldModifyEnvironmentVariableIfPermissionIsGiven() {\n+\t\texecuteWithSecurityManager(() -> {\n+\t\t\tassertThatCode(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\")).doesNotThrowAnyException();\n+\t\t\tassertThat(System.getenv(\"TEST\")).isEqualTo(\"TEST\");\n+\t\t});\n+\t}\n+\n+\t/*\n+\t * This needs to be done during the execution of the test method and cannot be moved to setup/tear down\n+\t * because junit uses reflection and the default SecurityManager prevents that.\n+\t */\n+\tprivate void executeWithSecurityManager(Runnable runnable) {\n+\t\tPolicy.getPolicy().refresh();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acca96ac66824aad9b821f8f1bb839afd3357bc0"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjIwNDg1", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#pullrequestreview-408620485", "createdAt": "2020-05-09T07:08:56Z", "commit": {"oid": "acca96ac66824aad9b821f8f1bb839afd3357bc0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Nzk5MjU5", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#pullrequestreview-446799259", "createdAt": "2020-07-11T12:21:31Z", "commit": {"oid": "acca96ac66824aad9b821f8f1bb839afd3357bc0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxMjoyMTozMVrOGwMgdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxMjoyMTozMVrOGwMgdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE4OTc0OQ==", "bodyText": "I'd have named this variable original. Everywhere it is used it is clear that it's a SecurityManager, so naming it securityManager is redundant - however System.setSecurityManager(original) clearly communicates that we reset (and not modify) the SecurityManager.\nThis is just a sidenote, don't feel the need to modify the PR just for this.", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#discussion_r453189749", "createdAt": "2020-07-11T12:21:31Z", "author": {"login": "Michael1993"}, "path": "src/test/java/org/junitpioneer/jupiter/EnvironmentVariableUtilsTests.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.jupiter;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatCode;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import java.security.AccessControlException;\n+import java.security.Policy;\n+\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+\n+@DisplayName(\"EnvironmentVariableUtils\")\n+@ClearEnvironmentVariable(key = \"TEST\")\n+class EnvironmentVariableUtilsTests {\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/default-testing.policy\")\n+\tvoid shouldThrowAccessControlExceptionWithDefaultSecurityManager() {\n+\t\texecuteWithSecurityManager(() -> assertThatThrownBy(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\"))\n+\t\t\t\t.isInstanceOf(AccessControlException.class));\n+\t}\n+\n+\t@Test\n+\t@SetSystemProperty(key = \"java.security.policy\", value = \"file:src/test/resources/reflect-permission-testing.policy\")\n+\tvoid shouldModifyEnvironmentVariableIfPermissionIsGiven() {\n+\t\texecuteWithSecurityManager(() -> {\n+\t\t\tassertThatCode(() -> EnvironmentVariableUtils.set(\"TEST\", \"TEST\")).doesNotThrowAnyException();\n+\t\t\tassertThat(System.getenv(\"TEST\")).isEqualTo(\"TEST\");\n+\t\t});\n+\t}\n+\n+\t/*\n+\t * This needs to be done during the execution of the test method and cannot be moved to setup/tear down\n+\t * because junit uses reflection and the default SecurityManager prevents that.\n+\t */\n+\tprivate void executeWithSecurityManager(Runnable runnable) {\n+\t\tPolicy.getPolicy().refresh();\n+\t\tSecurityManager securityManager = System.getSecurityManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acca96ac66824aad9b821f8f1bb839afd3357bc0"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c46b8763a7e2da974123d2982b31fce2e637357", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/6c46b8763a7e2da974123d2982b31fce2e637357", "committedDate": "2020-07-11T19:31:41Z", "message": "renamed local variable CR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d668163932083808b29f8c03bb752c58bf877e5f", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/d668163932083808b29f8c03bb752c58bf877e5f", "committedDate": "2020-07-11T19:42:21Z", "message": "Merge pull request #2 from junit-pioneer/master\n\nUpdate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41edd0d91a045021c6b28e6c7019af7e1d29308b", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/41edd0d91a045021c6b28e6c7019af7e1d29308b", "committedDate": "2020-07-11T19:45:23Z", "message": "Merge remote-tracking branch 'origin/master' into environmentvariableextension-securitymanager-tests\n\n# Conflicts:\n#\tsrc/test/java/org/junitpioneer/jupiter/EnvironmentVariableUtilsTests.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e726aca439e2cd1b0931afa96110417c30535733", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/e726aca439e2cd1b0931afa96110417c30535733", "committedDate": "2020-07-11T19:56:26Z", "message": "- class should not be public api\n- changed exception handling so no exception is hidden if could not modify environment variables\n- adjust comment setInSystemEnvClass because it also works on osx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50ea8ee55a81ae3fbc2e661f091f09639c5b5621", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/50ea8ee55a81ae3fbc2e661f091f09639c5b5621", "committedDate": "2020-07-11T20:01:12Z", "message": "format block comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c391d1f82b7211f84236f8028d243af13ba14cf6", "author": {"user": {"login": "Hancho2009", "name": null}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/c391d1f82b7211f84236f8028d243af13ba14cf6", "committedDate": "2020-07-11T20:02:29Z", "message": "format block comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdd498db1cc03819b8855127ac815cf238b8ba76", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/fdd498db1cc03819b8855127ac815cf238b8ba76", "committedDate": "2020-07-14T20:05:03Z", "message": "Reorder code and add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4599f4e9fd8576703ca6c2dc611e87949778aeb", "author": {"user": {"login": "nipafx", "name": "Nicolai Parlog"}}, "url": "https://github.com/junit-pioneer/junit-pioneer/commit/c4599f4e9fd8576703ca6c2dc611e87949778aeb", "committedDate": "2020-07-14T20:07:32Z", "message": "Add contribution to README"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDMwNDk2", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/242#pullrequestreview-448430496", "createdAt": "2020-07-14T20:13:09Z", "commit": {"oid": "c4599f4e9fd8576703ca6c2dc611e87949778aeb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3765, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}