{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MDAwMDcw", "number": 407, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxODoxNzozMlrOEvcjAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjozNTowOVrOEvh3Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MTg2MjQyOnYy", "diffSide": "RIGHT", "path": "sdk/core/azure-core/src/test/java/com/azure/android/core/common/TestUtils.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxODoxNzozMlrOHkb2TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMDowODo1OVrOHkfy_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2NzA1Mg==", "bodyText": "Should we move any utils methods that are specific to storage or uses storage types to storage-package? core util should not have any dependency on storage or any other azure-sdk modules.", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r507967052", "createdAt": "2020-10-19T18:17:32Z", "author": {"login": "anuchandy"}, "path": "sdk/core/azure-core/src/test/java/com/azure/android/core/common/TestUtils.java", "diffHunk": "@@ -1,29 +1,176 @@\n // Copyright (c) Microsoft Corporation. All rights reserved.\n // Licensed under the MIT License.\n \n-package com.azure.android.core.common;\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.ServiceClient;\n+import com.azure.android.storage.blob.StorageBlobAsyncClient;\n+import com.azure.android.storage.blob.StorageBlobClient;\n+import com.azure.android.storage.blob.credential.SasTokenCredential;\n+import com.azure.android.storage.blob.interceptor.SasTokenCredentialInterceptor;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+\n+import org.threeten.bp.OffsetDateTime;\n \n import java.io.PrintWriter;\n import java.io.StringWriter;\n+import java.net.InetSocketAddress;\n+import java.net.Proxy;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Arrays;\n+import java.util.Base64;\n import java.util.List;\n import java.util.Map;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n \n+import okhttp3.Headers;\n import okhttp3.Interceptor;\n import okhttp3.OkHttpClient;\n import okhttp3.Request;\n import okhttp3.mockwebserver.MockWebServer;\n \n+import static org.junit.Assert.assertFalse;\n+\n public final class TestUtils {\n     private TestUtils() {\n         // Empty constructor to prevent instantiation of this class.\n     }\n \n+    // ----------------------- CONSTANT VALUES ----------------------------\n+    /*\n+    The values below are used to create data-driven tests for access conditions.\n+     */\n+    static final OffsetDateTime oldDate = OffsetDateTime.now().minusDays(1);\n+\n+    static final OffsetDateTime newDate = OffsetDateTime.now().plusDays(1);\n+\n+    /*\n+    Note that this value is only used to check if we are depending on the received etag. This value will not actually\n+    be used.\n+     */\n+\n+    static final String receivedEtag = \"received\";\n+\n+    static final String garbageEtag = \"garbage\";\n+\n+\n+    // -------------------- GENERATING CLIENTS --------------------------\n+    public static StorageBlobClient.Builder initializeDefaultSyncBlobClientBuilder(Interceptor ... interceptors) {\n+        return initializeDefaultSyncBlobClientBuilder(enableFiddler(), interceptors);\n+    }\n+\n+    public static StorageBlobClient.Builder initializeDefaultSyncBlobClientBuilder(boolean enableFiddler,\n+                                                                                   Interceptor ... interceptors) {\n+        return new StorageBlobClient.Builder(getServiceBuilderWithOptionalProxy(enableFiddler, interceptors))\n+            .setBlobServiceUrl(getDefaultEndpointString(useHttps()))\n+            .setCredentialInterceptor(new SasTokenCredentialInterceptor(new SasTokenCredential(getDefaultSasToken())));\n+    }\n+\n+    public static StorageBlobAsyncClient.Builder initializeDefaultAsyncBlobClientBuilder(Interceptor ... interceptors) {\n+        return initializeDefaultAsyncBlobClientBuilder(enableFiddler(), interceptors);\n+    }\n+\n+    public static StorageBlobAsyncClient.Builder initializeDefaultAsyncBlobClientBuilder(boolean enableFiddler,\n+                                                                                         Interceptor ... interceptors) {\n+        return new StorageBlobAsyncClient.Builder(UUID.randomUUID().toString(),\n+            getServiceBuilderWithOptionalProxy(enableFiddler, interceptors))\n+            .setBlobServiceUrl(getDefaultEndpointString(useHttps()))\n+            .setCredentialInterceptor(new SasTokenCredentialInterceptor(new SasTokenCredential(getDefaultSasToken())));\n+    }\n+\n+    public static String getDefaultEndpointString(boolean useHttps) {\n+        String protocol = useHttps ? \"https\" : \"http\";\n+        return String.format(\"%s://%s.blob.core.windows.net\", protocol, getDefaultAccountName());\n+    }\n+\n+    public static String getDefaultAccountName() {\n+        return System.getenv(\"AZURE_STORAGE_ANDROID_ACCOUNT_NAME\");\n+    }\n+\n+    public static String getDefaultSasToken() {\n+        return System.getenv(\"AZURE_STORAGE_ANDROID_SAS_TOKEN\");\n+    }\n+\n+    public static ServiceClient.Builder getServiceBuilderWithOptionalProxy(boolean enableFiddler,\n+                                                                           Interceptor ... interceptors) {\n+        ServiceClient.Builder serviceBuilder = enableFiddler ?\n+            new ServiceClient.Builder(new OkHttpClient.Builder()\n+                .proxy(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(\"localhost\", 8888)))) :\n+            new ServiceClient.Builder();\n+\n+        for (Interceptor interceptor : interceptors) {\n+            serviceBuilder.addInterceptor(interceptor);\n+        }\n+\n+       return serviceBuilder;\n+    }\n+\n+    // ---------------------- CONFIG OPTIONS -----------------------------\n+\n+    public static boolean useHttps() {\n+        return false;\n+    }\n+\n+    public static boolean enableFiddler() {\n+        return true;\n+    }\n+\n+    // --------------------- GENERATING TEST RESOURCES ------------------------\n+\n+    public static String generateResourceName() {\n+        return UUID.randomUUID().toString();\n+    }\n+\n+    public static String generateBlockID() {\n+        return Base64.getEncoder().encodeToString(UUID.randomUUID().toString().getBytes(StandardCharsets.UTF_8));\n+    }\n+\n     public static OkHttpClient buildOkHttpClientWithInterceptor(Interceptor interceptor) {\n         return new OkHttpClient().newBuilder()\n             .addInterceptor(interceptor)\n             .build();\n     }\n \n+    // -------------------------- HELPER METHODS -----------------------\n+\n+    public static void awaitOnLatch(CountDownLatch latch, String method) {\n+        try {\n+            latch.await(10, TimeUnit.SECONDS);\n+        } catch (InterruptedException e) {\n+            assertFalse(method + \" didn't produce any result.\", true);\n+        }\n+    }\n+\n+    public static boolean validateBasicHeaders(Headers headers) {\n+        return headers.get(\"etag\") != null &&\n+            // Quotes should be scrubbed from etag header values\n+            !headers.get(\"etag\").contains(\"\\\"\") &&\n+            headers.get(\"last-modified\") != null &&\n+            headers.get(\"x-ms-request-id\") != null &&\n+            headers.get(\"x-ms-version\") != null &&\n+            headers.get(\"date\") != null;\n+    }\n+\n+    public static boolean validateBlobProperties(BlobGetPropertiesHeaders headers, String cacheControl, String contentDisposition, String contentEncoding, String contentLanguage, byte[] contentMd5, String contentType) {\n+        return Objects.equals(headers.getCacheControl(), cacheControl) &&\n+            Objects.equals(headers.getContentDisposition(), contentDisposition) &&\n+            Objects.equals(headers.getContentEncoding(), contentEncoding) &&\n+            Objects.equals(headers.getContentLanguage(), contentLanguage) &&\n+            Arrays.equals(headers.getContentMD5(), contentMd5) &&\n+            Objects.equals(headers.getContentType(), contentType);\n+    }\n+\n+    public static String setupMatchCondition(StorageBlobClient client, String containerName, String blobName, String match) {\n+        if (receivedEtag.equals(match)) {\n+            return client.getBlobProperties(containerName, blobName).getETag();\n+        } else {\n+            return match;\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "309cca429440a102a9d30c3ac9c4a7c0b9f38abe"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3MDc3MQ==", "bodyText": "Yep! Will do. I think Rick just created a BlobTestUtils so I can move them there", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r507970771", "createdAt": "2020-10-19T18:23:44Z", "author": {"login": "gapra-msft"}, "path": "sdk/core/azure-core/src/test/java/com/azure/android/core/common/TestUtils.java", "diffHunk": "@@ -1,29 +1,176 @@\n // Copyright (c) Microsoft Corporation. All rights reserved.\n // Licensed under the MIT License.\n \n-package com.azure.android.core.common;\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.ServiceClient;\n+import com.azure.android.storage.blob.StorageBlobAsyncClient;\n+import com.azure.android.storage.blob.StorageBlobClient;\n+import com.azure.android.storage.blob.credential.SasTokenCredential;\n+import com.azure.android.storage.blob.interceptor.SasTokenCredentialInterceptor;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+\n+import org.threeten.bp.OffsetDateTime;\n \n import java.io.PrintWriter;\n import java.io.StringWriter;\n+import java.net.InetSocketAddress;\n+import java.net.Proxy;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Arrays;\n+import java.util.Base64;\n import java.util.List;\n import java.util.Map;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n \n+import okhttp3.Headers;\n import okhttp3.Interceptor;\n import okhttp3.OkHttpClient;\n import okhttp3.Request;\n import okhttp3.mockwebserver.MockWebServer;\n \n+import static org.junit.Assert.assertFalse;\n+\n public final class TestUtils {\n     private TestUtils() {\n         // Empty constructor to prevent instantiation of this class.\n     }\n \n+    // ----------------------- CONSTANT VALUES ----------------------------\n+    /*\n+    The values below are used to create data-driven tests for access conditions.\n+     */\n+    static final OffsetDateTime oldDate = OffsetDateTime.now().minusDays(1);\n+\n+    static final OffsetDateTime newDate = OffsetDateTime.now().plusDays(1);\n+\n+    /*\n+    Note that this value is only used to check if we are depending on the received etag. This value will not actually\n+    be used.\n+     */\n+\n+    static final String receivedEtag = \"received\";\n+\n+    static final String garbageEtag = \"garbage\";\n+\n+\n+    // -------------------- GENERATING CLIENTS --------------------------\n+    public static StorageBlobClient.Builder initializeDefaultSyncBlobClientBuilder(Interceptor ... interceptors) {\n+        return initializeDefaultSyncBlobClientBuilder(enableFiddler(), interceptors);\n+    }\n+\n+    public static StorageBlobClient.Builder initializeDefaultSyncBlobClientBuilder(boolean enableFiddler,\n+                                                                                   Interceptor ... interceptors) {\n+        return new StorageBlobClient.Builder(getServiceBuilderWithOptionalProxy(enableFiddler, interceptors))\n+            .setBlobServiceUrl(getDefaultEndpointString(useHttps()))\n+            .setCredentialInterceptor(new SasTokenCredentialInterceptor(new SasTokenCredential(getDefaultSasToken())));\n+    }\n+\n+    public static StorageBlobAsyncClient.Builder initializeDefaultAsyncBlobClientBuilder(Interceptor ... interceptors) {\n+        return initializeDefaultAsyncBlobClientBuilder(enableFiddler(), interceptors);\n+    }\n+\n+    public static StorageBlobAsyncClient.Builder initializeDefaultAsyncBlobClientBuilder(boolean enableFiddler,\n+                                                                                         Interceptor ... interceptors) {\n+        return new StorageBlobAsyncClient.Builder(UUID.randomUUID().toString(),\n+            getServiceBuilderWithOptionalProxy(enableFiddler, interceptors))\n+            .setBlobServiceUrl(getDefaultEndpointString(useHttps()))\n+            .setCredentialInterceptor(new SasTokenCredentialInterceptor(new SasTokenCredential(getDefaultSasToken())));\n+    }\n+\n+    public static String getDefaultEndpointString(boolean useHttps) {\n+        String protocol = useHttps ? \"https\" : \"http\";\n+        return String.format(\"%s://%s.blob.core.windows.net\", protocol, getDefaultAccountName());\n+    }\n+\n+    public static String getDefaultAccountName() {\n+        return System.getenv(\"AZURE_STORAGE_ANDROID_ACCOUNT_NAME\");\n+    }\n+\n+    public static String getDefaultSasToken() {\n+        return System.getenv(\"AZURE_STORAGE_ANDROID_SAS_TOKEN\");\n+    }\n+\n+    public static ServiceClient.Builder getServiceBuilderWithOptionalProxy(boolean enableFiddler,\n+                                                                           Interceptor ... interceptors) {\n+        ServiceClient.Builder serviceBuilder = enableFiddler ?\n+            new ServiceClient.Builder(new OkHttpClient.Builder()\n+                .proxy(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(\"localhost\", 8888)))) :\n+            new ServiceClient.Builder();\n+\n+        for (Interceptor interceptor : interceptors) {\n+            serviceBuilder.addInterceptor(interceptor);\n+        }\n+\n+       return serviceBuilder;\n+    }\n+\n+    // ---------------------- CONFIG OPTIONS -----------------------------\n+\n+    public static boolean useHttps() {\n+        return false;\n+    }\n+\n+    public static boolean enableFiddler() {\n+        return true;\n+    }\n+\n+    // --------------------- GENERATING TEST RESOURCES ------------------------\n+\n+    public static String generateResourceName() {\n+        return UUID.randomUUID().toString();\n+    }\n+\n+    public static String generateBlockID() {\n+        return Base64.getEncoder().encodeToString(UUID.randomUUID().toString().getBytes(StandardCharsets.UTF_8));\n+    }\n+\n     public static OkHttpClient buildOkHttpClientWithInterceptor(Interceptor interceptor) {\n         return new OkHttpClient().newBuilder()\n             .addInterceptor(interceptor)\n             .build();\n     }\n \n+    // -------------------------- HELPER METHODS -----------------------\n+\n+    public static void awaitOnLatch(CountDownLatch latch, String method) {\n+        try {\n+            latch.await(10, TimeUnit.SECONDS);\n+        } catch (InterruptedException e) {\n+            assertFalse(method + \" didn't produce any result.\", true);\n+        }\n+    }\n+\n+    public static boolean validateBasicHeaders(Headers headers) {\n+        return headers.get(\"etag\") != null &&\n+            // Quotes should be scrubbed from etag header values\n+            !headers.get(\"etag\").contains(\"\\\"\") &&\n+            headers.get(\"last-modified\") != null &&\n+            headers.get(\"x-ms-request-id\") != null &&\n+            headers.get(\"x-ms-version\") != null &&\n+            headers.get(\"date\") != null;\n+    }\n+\n+    public static boolean validateBlobProperties(BlobGetPropertiesHeaders headers, String cacheControl, String contentDisposition, String contentEncoding, String contentLanguage, byte[] contentMd5, String contentType) {\n+        return Objects.equals(headers.getCacheControl(), cacheControl) &&\n+            Objects.equals(headers.getContentDisposition(), contentDisposition) &&\n+            Objects.equals(headers.getContentEncoding(), contentEncoding) &&\n+            Objects.equals(headers.getContentLanguage(), contentLanguage) &&\n+            Arrays.equals(headers.getContentMD5(), contentMd5) &&\n+            Objects.equals(headers.getContentType(), contentType);\n+    }\n+\n+    public static String setupMatchCondition(StorageBlobClient client, String containerName, String blobName, String match) {\n+        if (receivedEtag.equals(match)) {\n+            return client.getBlobProperties(containerName, blobName).getETag();\n+        } else {\n+            return match;\n+        }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2NzA1Mg=="}, "originalCommit": {"oid": "309cca429440a102a9d30c3ac9c4a7c0b9f38abe"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAzMTc0MQ==", "bodyText": "Done!", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508031741", "createdAt": "2020-10-19T20:08:59Z", "author": {"login": "gapra-msft"}, "path": "sdk/core/azure-core/src/test/java/com/azure/android/core/common/TestUtils.java", "diffHunk": "@@ -1,29 +1,176 @@\n // Copyright (c) Microsoft Corporation. All rights reserved.\n // Licensed under the MIT License.\n \n-package com.azure.android.core.common;\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.ServiceClient;\n+import com.azure.android.storage.blob.StorageBlobAsyncClient;\n+import com.azure.android.storage.blob.StorageBlobClient;\n+import com.azure.android.storage.blob.credential.SasTokenCredential;\n+import com.azure.android.storage.blob.interceptor.SasTokenCredentialInterceptor;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+\n+import org.threeten.bp.OffsetDateTime;\n \n import java.io.PrintWriter;\n import java.io.StringWriter;\n+import java.net.InetSocketAddress;\n+import java.net.Proxy;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Arrays;\n+import java.util.Base64;\n import java.util.List;\n import java.util.Map;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n \n+import okhttp3.Headers;\n import okhttp3.Interceptor;\n import okhttp3.OkHttpClient;\n import okhttp3.Request;\n import okhttp3.mockwebserver.MockWebServer;\n \n+import static org.junit.Assert.assertFalse;\n+\n public final class TestUtils {\n     private TestUtils() {\n         // Empty constructor to prevent instantiation of this class.\n     }\n \n+    // ----------------------- CONSTANT VALUES ----------------------------\n+    /*\n+    The values below are used to create data-driven tests for access conditions.\n+     */\n+    static final OffsetDateTime oldDate = OffsetDateTime.now().minusDays(1);\n+\n+    static final OffsetDateTime newDate = OffsetDateTime.now().plusDays(1);\n+\n+    /*\n+    Note that this value is only used to check if we are depending on the received etag. This value will not actually\n+    be used.\n+     */\n+\n+    static final String receivedEtag = \"received\";\n+\n+    static final String garbageEtag = \"garbage\";\n+\n+\n+    // -------------------- GENERATING CLIENTS --------------------------\n+    public static StorageBlobClient.Builder initializeDefaultSyncBlobClientBuilder(Interceptor ... interceptors) {\n+        return initializeDefaultSyncBlobClientBuilder(enableFiddler(), interceptors);\n+    }\n+\n+    public static StorageBlobClient.Builder initializeDefaultSyncBlobClientBuilder(boolean enableFiddler,\n+                                                                                   Interceptor ... interceptors) {\n+        return new StorageBlobClient.Builder(getServiceBuilderWithOptionalProxy(enableFiddler, interceptors))\n+            .setBlobServiceUrl(getDefaultEndpointString(useHttps()))\n+            .setCredentialInterceptor(new SasTokenCredentialInterceptor(new SasTokenCredential(getDefaultSasToken())));\n+    }\n+\n+    public static StorageBlobAsyncClient.Builder initializeDefaultAsyncBlobClientBuilder(Interceptor ... interceptors) {\n+        return initializeDefaultAsyncBlobClientBuilder(enableFiddler(), interceptors);\n+    }\n+\n+    public static StorageBlobAsyncClient.Builder initializeDefaultAsyncBlobClientBuilder(boolean enableFiddler,\n+                                                                                         Interceptor ... interceptors) {\n+        return new StorageBlobAsyncClient.Builder(UUID.randomUUID().toString(),\n+            getServiceBuilderWithOptionalProxy(enableFiddler, interceptors))\n+            .setBlobServiceUrl(getDefaultEndpointString(useHttps()))\n+            .setCredentialInterceptor(new SasTokenCredentialInterceptor(new SasTokenCredential(getDefaultSasToken())));\n+    }\n+\n+    public static String getDefaultEndpointString(boolean useHttps) {\n+        String protocol = useHttps ? \"https\" : \"http\";\n+        return String.format(\"%s://%s.blob.core.windows.net\", protocol, getDefaultAccountName());\n+    }\n+\n+    public static String getDefaultAccountName() {\n+        return System.getenv(\"AZURE_STORAGE_ANDROID_ACCOUNT_NAME\");\n+    }\n+\n+    public static String getDefaultSasToken() {\n+        return System.getenv(\"AZURE_STORAGE_ANDROID_SAS_TOKEN\");\n+    }\n+\n+    public static ServiceClient.Builder getServiceBuilderWithOptionalProxy(boolean enableFiddler,\n+                                                                           Interceptor ... interceptors) {\n+        ServiceClient.Builder serviceBuilder = enableFiddler ?\n+            new ServiceClient.Builder(new OkHttpClient.Builder()\n+                .proxy(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(\"localhost\", 8888)))) :\n+            new ServiceClient.Builder();\n+\n+        for (Interceptor interceptor : interceptors) {\n+            serviceBuilder.addInterceptor(interceptor);\n+        }\n+\n+       return serviceBuilder;\n+    }\n+\n+    // ---------------------- CONFIG OPTIONS -----------------------------\n+\n+    public static boolean useHttps() {\n+        return false;\n+    }\n+\n+    public static boolean enableFiddler() {\n+        return true;\n+    }\n+\n+    // --------------------- GENERATING TEST RESOURCES ------------------------\n+\n+    public static String generateResourceName() {\n+        return UUID.randomUUID().toString();\n+    }\n+\n+    public static String generateBlockID() {\n+        return Base64.getEncoder().encodeToString(UUID.randomUUID().toString().getBytes(StandardCharsets.UTF_8));\n+    }\n+\n     public static OkHttpClient buildOkHttpClientWithInterceptor(Interceptor interceptor) {\n         return new OkHttpClient().newBuilder()\n             .addInterceptor(interceptor)\n             .build();\n     }\n \n+    // -------------------------- HELPER METHODS -----------------------\n+\n+    public static void awaitOnLatch(CountDownLatch latch, String method) {\n+        try {\n+            latch.await(10, TimeUnit.SECONDS);\n+        } catch (InterruptedException e) {\n+            assertFalse(method + \" didn't produce any result.\", true);\n+        }\n+    }\n+\n+    public static boolean validateBasicHeaders(Headers headers) {\n+        return headers.get(\"etag\") != null &&\n+            // Quotes should be scrubbed from etag header values\n+            !headers.get(\"etag\").contains(\"\\\"\") &&\n+            headers.get(\"last-modified\") != null &&\n+            headers.get(\"x-ms-request-id\") != null &&\n+            headers.get(\"x-ms-version\") != null &&\n+            headers.get(\"date\") != null;\n+    }\n+\n+    public static boolean validateBlobProperties(BlobGetPropertiesHeaders headers, String cacheControl, String contentDisposition, String contentEncoding, String contentLanguage, byte[] contentMd5, String contentType) {\n+        return Objects.equals(headers.getCacheControl(), cacheControl) &&\n+            Objects.equals(headers.getContentDisposition(), contentDisposition) &&\n+            Objects.equals(headers.getContentEncoding(), contentEncoding) &&\n+            Objects.equals(headers.getContentLanguage(), contentLanguage) &&\n+            Arrays.equals(headers.getContentMD5(), contentMd5) &&\n+            Objects.equals(headers.getContentType(), contentType);\n+    }\n+\n+    public static String setupMatchCondition(StorageBlobClient client, String containerName, String blobName, String match) {\n+        if (receivedEtag.equals(match)) {\n+            return client.getBlobProperties(containerName, blobName).getETag();\n+        } else {\n+            return match;\n+        }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2NzA1Mg=="}, "originalCommit": {"oid": "309cca429440a102a9d30c3ac9c4a7c0b9f38abe"}, "originalPosition": 173}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MjY3MDYxOnYy", "diffSide": "RIGHT", "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlobTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjoxMDo0N1rOHkjfKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjoxNDo1MVrOHkjlTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5MjIwMw==", "bodyText": "Why is this commented out?", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508092203", "createdAt": "2020-10-19T22:10:47Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlobTest.java", "diffHunk": "@@ -0,0 +1,443 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.storage.blob.models.AccessTier;\n+import com.azure.android.storage.blob.models.BlobDeleteHeaders;\n+import com.azure.android.storage.blob.models.BlobDeleteResponse;\n+import com.azure.android.storage.blob.models.BlobDownloadHeaders;\n+import com.azure.android.storage.blob.models.BlobDownloadResponse;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesResponse;\n+import com.azure.android.storage.blob.models.BlobRange;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlobType;\n+import com.azure.android.storage.blob.models.LeaseStateType;\n+import com.azure.android.storage.blob.models.LeaseStatusType;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.io.IOException;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import okhttp3.ResponseBody;\n+\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultString;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static org.junit.Assert.assertArrayEquals;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @DataProvider\n+    public static Object[][] downloadRange() {\n+        return new Object[][] {\n+            {0L, null, getDefaultString()},                       // 0\n+            {0L, 5L,   getDefaultString().substring(0, 0 + 5)},   // 1\n+            {3L, 2L,   getDefaultString().substring(3, 3 + 2)},   // 2\n+            {1L, 3L,   getDefaultString().substring(1, 1 + 3)}    // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void getPropertiesValues() {\n+        // When\n+        BlobGetPropertiesHeaders response = syncClient.getBlobProperties(containerName, blobName);\n+\n+        // Then\n+        assertNotNull(response.getETag());\n+//        assertFalse(response.getETag().contains(\"\\\"\")); // Quotes should be scrubbed from etag header values", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5Mzc3NA==", "bodyText": "I think its cause we havent scrubbed quotes from etag yet, do we plan to do it? I could just flip the check for now", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508093774", "createdAt": "2020-10-19T22:14:51Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlobTest.java", "diffHunk": "@@ -0,0 +1,443 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.storage.blob.models.AccessTier;\n+import com.azure.android.storage.blob.models.BlobDeleteHeaders;\n+import com.azure.android.storage.blob.models.BlobDeleteResponse;\n+import com.azure.android.storage.blob.models.BlobDownloadHeaders;\n+import com.azure.android.storage.blob.models.BlobDownloadResponse;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesResponse;\n+import com.azure.android.storage.blob.models.BlobRange;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlobType;\n+import com.azure.android.storage.blob.models.LeaseStateType;\n+import com.azure.android.storage.blob.models.LeaseStatusType;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.io.IOException;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import okhttp3.ResponseBody;\n+\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultString;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static org.junit.Assert.assertArrayEquals;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @DataProvider\n+    public static Object[][] downloadRange() {\n+        return new Object[][] {\n+            {0L, null, getDefaultString()},                       // 0\n+            {0L, 5L,   getDefaultString().substring(0, 0 + 5)},   // 1\n+            {3L, 2L,   getDefaultString().substring(3, 3 + 2)},   // 2\n+            {1L, 3L,   getDefaultString().substring(1, 1 + 3)}    // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void getPropertiesValues() {\n+        // When\n+        BlobGetPropertiesHeaders response = syncClient.getBlobProperties(containerName, blobName);\n+\n+        // Then\n+        assertNotNull(response.getETag());\n+//        assertFalse(response.getETag().contains(\"\\\"\")); // Quotes should be scrubbed from etag header values", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5MjIwMw=="}, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 131}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MjY3MjE5OnYy", "diffSide": "RIGHT", "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlobTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjoxMToyOVrOHkjgJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjoxNToxMlrOHkjmEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5MjQ1NA==", "bodyText": "Are these not present because we need to add them?", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508092454", "createdAt": "2020-10-19T22:11:29Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlobTest.java", "diffHunk": "@@ -0,0 +1,443 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.storage.blob.models.AccessTier;\n+import com.azure.android.storage.blob.models.BlobDeleteHeaders;\n+import com.azure.android.storage.blob.models.BlobDeleteResponse;\n+import com.azure.android.storage.blob.models.BlobDownloadHeaders;\n+import com.azure.android.storage.blob.models.BlobDownloadResponse;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesResponse;\n+import com.azure.android.storage.blob.models.BlobRange;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlobType;\n+import com.azure.android.storage.blob.models.LeaseStateType;\n+import com.azure.android.storage.blob.models.LeaseStatusType;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.io.IOException;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import okhttp3.ResponseBody;\n+\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultString;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static org.junit.Assert.assertArrayEquals;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @DataProvider\n+    public static Object[][] downloadRange() {\n+        return new Object[][] {\n+            {0L, null, getDefaultString()},                       // 0\n+            {0L, 5L,   getDefaultString().substring(0, 0 + 5)},   // 1\n+            {3L, 2L,   getDefaultString().substring(3, 3 + 2)},   // 2\n+            {1L, 3L,   getDefaultString().substring(1, 1 + 3)}    // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void getPropertiesValues() {\n+        // When\n+        BlobGetPropertiesHeaders response = syncClient.getBlobProperties(containerName, blobName);\n+\n+        // Then\n+        assertNotNull(response.getETag());\n+//        assertFalse(response.getETag().contains(\"\\\"\")); // Quotes should be scrubbed from etag header values\n+        assertNotNull(response.getLastModified());\n+        assertNotNull(response.getRequestId());\n+        assertNotNull(response.getVersion());\n+        assertNotNull(response.getDateProperty());\n+        assertTrue(response.getMetadata() == null || response.getMetadata().isEmpty());\n+        assertEquals(BlobType.BLOCK_BLOB, response.getBlobType());\n+        assertNull(response.getCopyCompletionTime()); // tested in \"copy\"\n+        assertNull(response.getCopyStatusDescription()); // only returned when the service has errors; cannot validate.\n+        assertNull(response.getCopyId()); // tested in \"abort copy\"\n+        assertNull(response.getCopyProgress()); // tested in \"copy\"\n+        assertNull(response.getCopySource()); // tested in \"copy\"\n+        assertNull(response.getCopyStatus()); // tested in \"copy\"\n+        assertTrue(response.isIncrementalCopy() == null || !response.isIncrementalCopy()); // tested in PageBlob.\"start incremental copy\"\n+        assertNull(response.getDestinationSnapshot()); // tested in PageBlob.\"start incremental copy\"\n+        assertNull(response.getLeaseDuration()); // tested in \"acquire lease\"\n+        assertEquals(LeaseStateType.AVAILABLE, response.getLeaseState());\n+        assertEquals(LeaseStatusType.UNLOCKED, response.getLeaseStatus());\n+        assertTrue(response.getContentLength() >= 0);\n+        assertNotNull(response.getContentType());\n+        assertNull(response.getContentMD5());\n+        assertNull(response.getContentEncoding()); // tested in \"set HTTP headers\"\n+        assertNull(response.getContentDisposition()); // tested in \"set HTTP headers\"\n+        assertNull(response.getContentLanguage()); // tested in \"set HTTP headers\"\n+        assertNull(response.getCacheControl()); // tested in \"set HTTP headers\"\n+        assertNull(response.getBlobSequenceNumber()); // tested in PageBlob.\"create sequence number\"\n+        assertEquals(\"bytes\", response.getAcceptRanges());\n+        assertNull(response.getBlobCommittedBlockCount()); // tested in AppendBlob.\"append block\"\n+        assertTrue(response.isServerEncrypted());\n+        assertEquals(AccessTier.HOT.toString(), response.getAccessTier());\n+        assertTrue(response.isAccessTierInferred());\n+        assertNull(response.getArchiveStatus());\n+        assertNotNull(response.getCreationTime());\n+        // Tag Count not in BlobProperties.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5Mzk3MA==", "bodyText": "Yeah we can add them when we upgrade to 73", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508093970", "createdAt": "2020-10-19T22:15:12Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlobTest.java", "diffHunk": "@@ -0,0 +1,443 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.storage.blob.models.AccessTier;\n+import com.azure.android.storage.blob.models.BlobDeleteHeaders;\n+import com.azure.android.storage.blob.models.BlobDeleteResponse;\n+import com.azure.android.storage.blob.models.BlobDownloadHeaders;\n+import com.azure.android.storage.blob.models.BlobDownloadResponse;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesResponse;\n+import com.azure.android.storage.blob.models.BlobRange;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlobType;\n+import com.azure.android.storage.blob.models.LeaseStateType;\n+import com.azure.android.storage.blob.models.LeaseStatusType;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.io.IOException;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import okhttp3.ResponseBody;\n+\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultString;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static org.junit.Assert.assertArrayEquals;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @DataProvider\n+    public static Object[][] downloadRange() {\n+        return new Object[][] {\n+            {0L, null, getDefaultString()},                       // 0\n+            {0L, 5L,   getDefaultString().substring(0, 0 + 5)},   // 1\n+            {3L, 2L,   getDefaultString().substring(3, 3 + 2)},   // 2\n+            {1L, 3L,   getDefaultString().substring(1, 1 + 3)}    // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void getPropertiesValues() {\n+        // When\n+        BlobGetPropertiesHeaders response = syncClient.getBlobProperties(containerName, blobName);\n+\n+        // Then\n+        assertNotNull(response.getETag());\n+//        assertFalse(response.getETag().contains(\"\\\"\")); // Quotes should be scrubbed from etag header values\n+        assertNotNull(response.getLastModified());\n+        assertNotNull(response.getRequestId());\n+        assertNotNull(response.getVersion());\n+        assertNotNull(response.getDateProperty());\n+        assertTrue(response.getMetadata() == null || response.getMetadata().isEmpty());\n+        assertEquals(BlobType.BLOCK_BLOB, response.getBlobType());\n+        assertNull(response.getCopyCompletionTime()); // tested in \"copy\"\n+        assertNull(response.getCopyStatusDescription()); // only returned when the service has errors; cannot validate.\n+        assertNull(response.getCopyId()); // tested in \"abort copy\"\n+        assertNull(response.getCopyProgress()); // tested in \"copy\"\n+        assertNull(response.getCopySource()); // tested in \"copy\"\n+        assertNull(response.getCopyStatus()); // tested in \"copy\"\n+        assertTrue(response.isIncrementalCopy() == null || !response.isIncrementalCopy()); // tested in PageBlob.\"start incremental copy\"\n+        assertNull(response.getDestinationSnapshot()); // tested in PageBlob.\"start incremental copy\"\n+        assertNull(response.getLeaseDuration()); // tested in \"acquire lease\"\n+        assertEquals(LeaseStateType.AVAILABLE, response.getLeaseState());\n+        assertEquals(LeaseStatusType.UNLOCKED, response.getLeaseStatus());\n+        assertTrue(response.getContentLength() >= 0);\n+        assertNotNull(response.getContentType());\n+        assertNull(response.getContentMD5());\n+        assertNull(response.getContentEncoding()); // tested in \"set HTTP headers\"\n+        assertNull(response.getContentDisposition()); // tested in \"set HTTP headers\"\n+        assertNull(response.getContentLanguage()); // tested in \"set HTTP headers\"\n+        assertNull(response.getCacheControl()); // tested in \"set HTTP headers\"\n+        assertNull(response.getBlobSequenceNumber()); // tested in PageBlob.\"create sequence number\"\n+        assertEquals(\"bytes\", response.getAcceptRanges());\n+        assertNull(response.getBlobCommittedBlockCount()); // tested in AppendBlob.\"append block\"\n+        assertTrue(response.isServerEncrypted());\n+        assertEquals(AccessTier.HOT.toString(), response.getAccessTier());\n+        assertTrue(response.isAccessTierInferred());\n+        assertNull(response.getArchiveStatus());\n+        assertNotNull(response.getCreationTime());\n+        // Tag Count not in BlobProperties.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5MjQ1NA=="}, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 164}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MjcyMzQ5OnYy", "diffSide": "RIGHT", "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlockBlobTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjozMTowMlrOHkj-fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjo0NzoyOVrOHkkWZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwMDIyMA==", "bodyText": "I think we should change the name of this header or possibly remove it", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508100220", "createdAt": "2020-10-19T22:31:02Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlockBlobTest.java", "diffHunk": "@@ -0,0 +1,427 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.CallbackWithHeader;\n+import com.azure.android.storage.blob.models.BlobErrorCode;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobHttpHeaders;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlockBlobCommitBlockListHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobItem;\n+import com.azure.android.storage.blob.models.BlockBlobStageBlockHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobsCommitBlockListResponse;\n+import com.azure.android.storage.blob.models.BlockBlobsStageBlockResponse;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CountDownLatch;\n+\n+import okhttp3.Response;\n+\n+import static com.azure.android.core.common.TestUtils.awaitOnLatch;\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBlobProperties;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlockBlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    @DataProvider\n+    public static Object[][] headers() throws NoSuchAlgorithmException {\n+        return new Object[][] {\n+            {null,      null,          null,       null,       null,                                                       null},    // 0\n+            {\"control\", \"disposition\", \"encoding\", \"language\", MessageDigest.getInstance(\"MD5\").digest(getDefaultData()), \"type\"},   // 1\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void stageBlock() {\n+        // Setup\n+        String blockId = generateBlockID();\n+\n+        // When\n+        BlockBlobsStageBlockResponse response = syncClient.stageBlockWithRestResponse(containerName, blobName, blockId, getDefaultData(), null, null, null ,null ,null ,null, null);\n+\n+        // Then\n+        assertEquals(201, response.getStatusCode());\n+        BlockBlobStageBlockHeaders headers = response.getDeserializedHeaders();\n+        assertNotNull(headers.getXMsContentCrc64());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwMjE1Ng==", "bodyText": "We can handwrite public types and then this will go away. I will add this to our list", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508102156", "createdAt": "2020-10-19T22:36:09Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlockBlobTest.java", "diffHunk": "@@ -0,0 +1,427 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.CallbackWithHeader;\n+import com.azure.android.storage.blob.models.BlobErrorCode;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobHttpHeaders;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlockBlobCommitBlockListHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobItem;\n+import com.azure.android.storage.blob.models.BlockBlobStageBlockHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobsCommitBlockListResponse;\n+import com.azure.android.storage.blob.models.BlockBlobsStageBlockResponse;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CountDownLatch;\n+\n+import okhttp3.Response;\n+\n+import static com.azure.android.core.common.TestUtils.awaitOnLatch;\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBlobProperties;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlockBlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    @DataProvider\n+    public static Object[][] headers() throws NoSuchAlgorithmException {\n+        return new Object[][] {\n+            {null,      null,          null,       null,       null,                                                       null},    // 0\n+            {\"control\", \"disposition\", \"encoding\", \"language\", MessageDigest.getInstance(\"MD5\").digest(getDefaultData()), \"type\"},   // 1\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void stageBlock() {\n+        // Setup\n+        String blockId = generateBlockID();\n+\n+        // When\n+        BlockBlobsStageBlockResponse response = syncClient.stageBlockWithRestResponse(containerName, blobName, blockId, getDefaultData(), null, null, null ,null ,null ,null, null);\n+\n+        // Then\n+        assertEquals(201, response.getStatusCode());\n+        BlockBlobStageBlockHeaders headers = response.getDeserializedHeaders();\n+        assertNotNull(headers.getXMsContentCrc64());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwMDIyMA=="}, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwNjM0MQ==", "bodyText": "Added a comment in another test that also referenced this getter", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508106341", "createdAt": "2020-10-19T22:47:29Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlockBlobTest.java", "diffHunk": "@@ -0,0 +1,427 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.CallbackWithHeader;\n+import com.azure.android.storage.blob.models.BlobErrorCode;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobHttpHeaders;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlockBlobCommitBlockListHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobItem;\n+import com.azure.android.storage.blob.models.BlockBlobStageBlockHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobsCommitBlockListResponse;\n+import com.azure.android.storage.blob.models.BlockBlobsStageBlockResponse;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CountDownLatch;\n+\n+import okhttp3.Response;\n+\n+import static com.azure.android.core.common.TestUtils.awaitOnLatch;\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBlobProperties;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlockBlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    @DataProvider\n+    public static Object[][] headers() throws NoSuchAlgorithmException {\n+        return new Object[][] {\n+            {null,      null,          null,       null,       null,                                                       null},    // 0\n+            {\"control\", \"disposition\", \"encoding\", \"language\", MessageDigest.getInstance(\"MD5\").digest(getDefaultData()), \"type\"},   // 1\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void stageBlock() {\n+        // Setup\n+        String blockId = generateBlockID();\n+\n+        // When\n+        BlockBlobsStageBlockResponse response = syncClient.stageBlockWithRestResponse(containerName, blobName, blockId, getDefaultData(), null, null, null ,null ,null ,null, null);\n+\n+        // Then\n+        assertEquals(201, response.getStatusCode());\n+        BlockBlobStageBlockHeaders headers = response.getDeserializedHeaders();\n+        assertNotNull(headers.getXMsContentCrc64());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwMDIyMA=="}, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 131}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MjczMzgzOnYy", "diffSide": "RIGHT", "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlockBlobTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjozNTowOVrOHkkEnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMjo0MTowMlrOHkkNPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwMTc4OQ==", "bodyText": "You could also maybe do a commit block list since it'll 400 or something if the block wasn't staged.", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508101789", "createdAt": "2020-10-19T22:35:09Z", "author": {"login": "rickle-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlockBlobTest.java", "diffHunk": "@@ -0,0 +1,427 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.CallbackWithHeader;\n+import com.azure.android.storage.blob.models.BlobErrorCode;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobHttpHeaders;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlockBlobCommitBlockListHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobItem;\n+import com.azure.android.storage.blob.models.BlockBlobStageBlockHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobsCommitBlockListResponse;\n+import com.azure.android.storage.blob.models.BlockBlobsStageBlockResponse;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CountDownLatch;\n+\n+import okhttp3.Response;\n+\n+import static com.azure.android.core.common.TestUtils.awaitOnLatch;\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBlobProperties;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlockBlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    @DataProvider\n+    public static Object[][] headers() throws NoSuchAlgorithmException {\n+        return new Object[][] {\n+            {null,      null,          null,       null,       null,                                                       null},    // 0\n+            {\"control\", \"disposition\", \"encoding\", \"language\", MessageDigest.getInstance(\"MD5\").digest(getDefaultData()), \"type\"},   // 1\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void stageBlock() {\n+        // Setup\n+        String blockId = generateBlockID();\n+\n+        // When\n+        BlockBlobsStageBlockResponse response = syncClient.stageBlockWithRestResponse(containerName, blobName, blockId, getDefaultData(), null, null, null ,null ,null ,null, null);\n+\n+        // Then\n+        assertEquals(201, response.getStatusCode());\n+        BlockBlobStageBlockHeaders headers = response.getDeserializedHeaders();\n+        assertNotNull(headers.getXMsContentCrc64());\n+        assertNotNull(headers.getRequestId());\n+        assertNotNull(headers.getVersion());\n+        assertNotNull(headers.getDateProperty());\n+        assertTrue(headers.isServerEncrypted() != null && headers.isServerEncrypted());\n+    }\n+\n+    @Test\n+    public void stageBlockMin() {\n+        // Setup\n+        String blockId = generateBlockID();\n+\n+        // When\n+        Void response = syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+\n+        // Then\n+        // When list block support added, check blockBlobClient.listBlocks(BlockListType.ALL).getUncommittedBlocks().size() == 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwMzk5OQ==", "bodyText": "Ah yeah", "url": "https://github.com/Azure/azure-sdk-for-android/pull/407#discussion_r508103999", "createdAt": "2020-10-19T22:41:02Z", "author": {"login": "gapra-msft"}, "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/BlockBlobTest.java", "diffHunk": "@@ -0,0 +1,427 @@\n+package com.azure.android.storage.blob;\n+\n+import com.azure.android.core.http.CallbackWithHeader;\n+import com.azure.android.storage.blob.models.BlobErrorCode;\n+import com.azure.android.storage.blob.models.BlobGetPropertiesHeaders;\n+import com.azure.android.storage.blob.models.BlobHttpHeaders;\n+import com.azure.android.storage.blob.models.BlobRequestConditions;\n+import com.azure.android.storage.blob.models.BlobStorageException;\n+import com.azure.android.storage.blob.models.BlockBlobCommitBlockListHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobItem;\n+import com.azure.android.storage.blob.models.BlockBlobStageBlockHeaders;\n+import com.azure.android.storage.blob.models.BlockBlobsCommitBlockListResponse;\n+import com.azure.android.storage.blob.models.BlockBlobsStageBlockResponse;\n+import com.tngtech.java.junit.dataprovider.DataProvider;\n+import com.tngtech.java.junit.dataprovider.DataProviderRunner;\n+import com.tngtech.java.junit.dataprovider.UseDataProvider;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.threeten.bp.OffsetDateTime;\n+\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CountDownLatch;\n+\n+import okhttp3.Response;\n+\n+import static com.azure.android.core.common.TestUtils.awaitOnLatch;\n+import static com.azure.android.storage.blob.BlobTestUtils.enableFiddler;\n+import static com.azure.android.storage.blob.BlobTestUtils.garbageEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateBlockID;\n+import static com.azure.android.storage.blob.BlobTestUtils.generateResourceName;\n+import static com.azure.android.storage.blob.BlobTestUtils.getDefaultData;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultAsyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.initializeDefaultSyncBlobClientBuilder;\n+import static com.azure.android.storage.blob.BlobTestUtils.newDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.oldDate;\n+import static com.azure.android.storage.blob.BlobTestUtils.receivedEtag;\n+import static com.azure.android.storage.blob.BlobTestUtils.setupMatchCondition;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBasicHeaders;\n+import static com.azure.android.storage.blob.BlobTestUtils.validateBlobProperties;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertThrows;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(DataProviderRunner.class)\n+@Ignore\n+public class BlockBlobTest {\n+    private String containerName;\n+    private String blobName;\n+    private static StorageBlobAsyncClient asyncClient;\n+    private static StorageBlobClient syncClient;\n+\n+    @DataProvider\n+    public static Object[][] headers() throws NoSuchAlgorithmException {\n+        return new Object[][] {\n+            {null,      null,          null,       null,       null,                                                       null},    // 0\n+            {\"control\", \"disposition\", \"encoding\", \"language\", MessageDigest.getInstance(\"MD5\").digest(getDefaultData()), \"type\"},   // 1\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsSuccess() {\n+        return new Object[][] {\n+            {null,    null,    null,         null},       // 0\n+            {oldDate, null,    null,         null},       // 1\n+            {null,    newDate, null,         null},       // 2\n+            {null,    null,    receivedEtag, null},       // 3\n+            {null,    null,    null,         garbageEtag} // 4\n+        };\n+    }\n+\n+    // TODO: (gapra) Add iftags\n+    @DataProvider\n+    public static Object[][] accessConditionsFail() {\n+        return new Object[][] {\n+            {newDate, null,    null,        null},        // 0\n+            {null,    oldDate, null,        null},        // 1\n+            {null,    null,    garbageEtag, null},        // 2\n+            {null,    null,    null,        receivedEtag} // 3\n+        };\n+    }\n+\n+    @BeforeClass\n+    public static void setupClass() {\n+        asyncClient = initializeDefaultAsyncBlobClientBuilder(enableFiddler()).build();\n+        syncClient = initializeDefaultSyncBlobClientBuilder(enableFiddler()).build();\n+    }\n+\n+    @Before\n+    public void setupTest() {\n+        // Create container\n+        containerName = generateResourceName();\n+        syncClient.createContainer(containerName);\n+\n+        // Create blob\n+        blobName = generateResourceName();\n+        String blockId = generateBlockID();\n+        syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+        List<String> blockIds = new ArrayList<>();\n+        blockIds.add(blockId);\n+        syncClient.commitBlockList(containerName, blobName, blockIds, false);\n+    }\n+\n+    @After\n+    public void teardownTest() {\n+        syncClient.deleteContainer(containerName);\n+    }\n+\n+    @Test\n+    public void stageBlock() {\n+        // Setup\n+        String blockId = generateBlockID();\n+\n+        // When\n+        BlockBlobsStageBlockResponse response = syncClient.stageBlockWithRestResponse(containerName, blobName, blockId, getDefaultData(), null, null, null ,null ,null ,null, null);\n+\n+        // Then\n+        assertEquals(201, response.getStatusCode());\n+        BlockBlobStageBlockHeaders headers = response.getDeserializedHeaders();\n+        assertNotNull(headers.getXMsContentCrc64());\n+        assertNotNull(headers.getRequestId());\n+        assertNotNull(headers.getVersion());\n+        assertNotNull(headers.getDateProperty());\n+        assertTrue(headers.isServerEncrypted() != null && headers.isServerEncrypted());\n+    }\n+\n+    @Test\n+    public void stageBlockMin() {\n+        // Setup\n+        String blockId = generateBlockID();\n+\n+        // When\n+        Void response = syncClient.stageBlock(containerName, blobName, blockId, getDefaultData(), null);\n+\n+        // Then\n+        // When list block support added, check blockBlobClient.listBlocks(BlockListType.ALL).getUncommittedBlocks().size() == 1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwMTc4OQ=="}, "originalCommit": {"oid": "3ffa8023c135c15e110422aed44013ffc1c7d5ad"}, "originalPosition": 147}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2309, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}