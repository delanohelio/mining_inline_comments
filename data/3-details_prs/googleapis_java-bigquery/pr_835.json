{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3MTIzNDQ0", "number": 835, "title": "docs(samples): create and query Amazon s3 data using external table", "bodyText": "", "createdAt": "2020-10-20T22:05:21Z", "url": "https://github.com/googleapis/java-bigquery/pull/835", "merged": true, "mergeCommit": {"oid": "53a56be8b0878edbc4bc5dd67ed63b48c96d3899"}, "closed": true, "closedAt": "2020-10-21T00:15:24Z", "author": {"login": "stephaniewang526"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUYyxfAH2gAyNTA3MTIzNDQ0OjRjN2FkNjRlNGMwNWYxM2MyM2U3NWViNTFkMjg4MDIzNjYwNjYxM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUhaWRAH2gAyNTA3MTIzNDQ0OjAxYmNjZmU5ZmFlZjU2YmRkOThkNjIyOGQ0NWM0ODZiNzIxYTgyZmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c7ad64e4c05f13c23e75eb51d2880236606613b", "author": {"user": {"login": "pmakani", "name": "Praful Makani"}}, "url": "https://github.com/googleapis/java-bigquery/commit/4c7ad64e4c05f13c23e75eb51d2880236606613b", "committedDate": "2020-10-20T13:28:54Z", "message": "docs(samples): add omni query on external table aws"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f06a8219207253decaf4145fad0f0282e880bfea", "author": {"user": {"login": "pmakani", "name": "Praful Makani"}}, "url": "https://github.com/googleapis/java-bigquery/commit/f06a8219207253decaf4145fad0f0282e880bfea", "committedDate": "2020-10-20T13:59:57Z", "message": "docs(samples): update code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "170cbbd27acc4f2748f6875e720f7e84408e3b27", "author": {"user": {"login": "pmakani", "name": "Praful Makani"}}, "url": "https://github.com/googleapis/java-bigquery/commit/170cbbd27acc4f2748f6875e720f7e84408e3b27", "committedDate": "2020-10-20T14:30:00Z", "message": "docs(samples): add user id and external id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "277071a9e1b8f7e4194a026d38ccf21fbed6c85c", "author": {"user": {"login": "pmakani", "name": "Praful Makani"}}, "url": "https://github.com/googleapis/java-bigquery/commit/277071a9e1b8f7e4194a026d38ccf21fbed6c85c", "committedDate": "2020-10-20T15:00:00Z", "message": "docs(samples): fix connection name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cbbfa053e978201445fdf593beda2dc0c15d660", "author": {"user": {"login": "stephaniewang526", "name": "Stephanie Wang"}}, "url": "https://github.com/googleapis/java-bigquery/commit/3cbbfa053e978201445fdf593beda2dc0c15d660", "committedDate": "2020-10-20T18:22:04Z", "message": "docs(samples): update create external table AWS sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e9ccc54e7a64c721826dc9fa22522c96cb76b50", "author": {"user": {"login": "stephaniewang526", "name": "Stephanie Wang"}}, "url": "https://github.com/googleapis/java-bigquery/commit/6e9ccc54e7a64c721826dc9fa22522c96cb76b50", "committedDate": "2020-10-20T18:25:03Z", "message": "update create dataset AWS sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d050989c47117de86514bb2aed25614842c3dd29", "author": {"user": {"login": "stephaniewang526", "name": "Stephanie Wang"}}, "url": "https://github.com/googleapis/java-bigquery/commit/d050989c47117de86514bb2aed25614842c3dd29", "committedDate": "2020-10-20T18:29:01Z", "message": "nit clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f98e0d27b0ec918b2a5320bff844d1bfcb2e14c", "author": {"user": {"login": "stephaniewang526", "name": "Stephanie Wang"}}, "url": "https://github.com/googleapis/java-bigquery/commit/6f98e0d27b0ec918b2a5320bff844d1bfcb2e14c", "committedDate": "2020-10-20T22:04:45Z", "message": "update query external table sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7242c725e280a4cd9a853d2a8d036b1bf172c8ce", "author": {"user": {"login": "stephaniewang526", "name": "Stephanie Wang"}}, "url": "https://github.com/googleapis/java-bigquery/commit/7242c725e280a4cd9a853d2a8d036b1bf172c8ce", "committedDate": "2020-10-20T22:07:43Z", "message": "fix checkstyle errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMTk3Mzcx", "url": "https://github.com/googleapis/java-bigquery/pull/835#pullrequestreview-513197371", "createdAt": "2020-10-20T23:05:31Z", "commit": {"oid": "7242c725e280a4cd9a853d2a8d036b1bf172c8ce"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMzowNTozMlrOHlUPsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMzoxMDoxNVrOHlUVyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg5MTA1OA==", "bodyText": "Should you explain what this SQL statement does?", "url": "https://github.com/googleapis/java-bigquery/pull/835#discussion_r508891058", "createdAt": "2020-10-20T23:05:32Z", "author": {"login": "lesv"}, "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalTableAws.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_omni_query_external_aws_s3]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.CsvOptions;\n+import com.google.cloud.bigquery.DatasetId;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.Field;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.Schema;\n+import com.google.cloud.bigquery.StandardSQLTypeName;\n+import com.google.cloud.bigquery.TableId;\n+import com.google.cloud.bigquery.TableInfo;\n+import com.google.cloud.bigquery.TableResult;\n+\n+// Sample to queries an external data source aws s3 using a permanent table\n+public class QueryExternalTableAws {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String datasetName = \"MY_DATASET_NAME\";\n+    String externalTableName = \"MY_EXTERNAL_TABLE_NAME\";\n+    String query =\n+        String.format(\n+            \"SELECT * FROM s%.%s.%s WHERE name LIKE 'W%%'\",\n+            projectId, datasetName, externalTableName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7242c725e280a4cd9a853d2a8d036b1bf172c8ce"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg5MjI4Ng==", "bodyText": "Should these be caught?  Perhaps just mention them or let them propagate?  NOTE - BigQueryException is a RuntimeException and InterruptedException is not.", "url": "https://github.com/googleapis/java-bigquery/pull/835#discussion_r508892286", "createdAt": "2020-10-20T23:09:15Z", "author": {"login": "lesv"}, "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalTableAws.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_omni_query_external_aws_s3]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.CsvOptions;\n+import com.google.cloud.bigquery.DatasetId;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.Field;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.Schema;\n+import com.google.cloud.bigquery.StandardSQLTypeName;\n+import com.google.cloud.bigquery.TableId;\n+import com.google.cloud.bigquery.TableInfo;\n+import com.google.cloud.bigquery.TableResult;\n+\n+// Sample to queries an external data source aws s3 using a permanent table\n+public class QueryExternalTableAws {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String datasetName = \"MY_DATASET_NAME\";\n+    String externalTableName = \"MY_EXTERNAL_TABLE_NAME\";\n+    String query =\n+        String.format(\n+            \"SELECT * FROM s%.%s.%s WHERE name LIKE 'W%%'\",\n+            projectId, datasetName, externalTableName);\n+    queryExternalTableAws(query);\n+  }\n+\n+  public static void queryExternalTableAws(String query) {\n+    try {\n+      // Initialize client that will be used to send requests. This client only needs to be created\n+      // once, and can be reused for multiple requests.\n+      BigQuery bigquery = BigQueryOptions.getDefaultInstance().getService();\n+\n+      // Example query to find states starting with 'W'\n+      TableResult results = bigquery.query(QueryJobConfiguration.of(query));\n+\n+      results\n+          .iterateAll()\n+          .forEach(row -> row.forEach(val -> System.out.printf(\"%s,\", val.toString())));\n+\n+      System.out.println(\"Query on aws external permanent table performed successfully.\");\n+    } catch (BigQueryException | InterruptedException e) {\n+      System.out.println(\"Query not performed \\n\" + e.toString());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7242c725e280a4cd9a853d2a8d036b1bf172c8ce"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg5MjQzMQ==", "bodyText": "More important is why might these have been thrown and what should a user really do with them?", "url": "https://github.com/googleapis/java-bigquery/pull/835#discussion_r508892431", "createdAt": "2020-10-20T23:09:42Z", "author": {"login": "lesv"}, "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalTableAws.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_omni_query_external_aws_s3]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.CsvOptions;\n+import com.google.cloud.bigquery.DatasetId;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.Field;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.Schema;\n+import com.google.cloud.bigquery.StandardSQLTypeName;\n+import com.google.cloud.bigquery.TableId;\n+import com.google.cloud.bigquery.TableInfo;\n+import com.google.cloud.bigquery.TableResult;\n+\n+// Sample to queries an external data source aws s3 using a permanent table\n+public class QueryExternalTableAws {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String datasetName = \"MY_DATASET_NAME\";\n+    String externalTableName = \"MY_EXTERNAL_TABLE_NAME\";\n+    String query =\n+        String.format(\n+            \"SELECT * FROM s%.%s.%s WHERE name LIKE 'W%%'\",\n+            projectId, datasetName, externalTableName);\n+    queryExternalTableAws(query);\n+  }\n+\n+  public static void queryExternalTableAws(String query) {\n+    try {\n+      // Initialize client that will be used to send requests. This client only needs to be created\n+      // once, and can be reused for multiple requests.\n+      BigQuery bigquery = BigQueryOptions.getDefaultInstance().getService();\n+\n+      // Example query to find states starting with 'W'\n+      TableResult results = bigquery.query(QueryJobConfiguration.of(query));\n+\n+      results\n+          .iterateAll()\n+          .forEach(row -> row.forEach(val -> System.out.printf(\"%s,\", val.toString())));\n+\n+      System.out.println(\"Query on aws external permanent table performed successfully.\");\n+    } catch (BigQueryException | InterruptedException e) {\n+      System.out.println(\"Query not performed \\n\" + e.toString());\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg5MjI4Ng=="}, "originalCommit": {"oid": "7242c725e280a4cd9a853d2a8d036b1bf172c8ce"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg5MjYxNw==", "bodyText": "Might not be your best final choice for a bucket name.", "url": "https://github.com/googleapis/java-bigquery/pull/835#discussion_r508892617", "createdAt": "2020-10-20T23:10:15Z", "author": {"login": "lesv"}, "path": "samples/snippets/src/test/java/com/example/bigquery/CreateExternalTableAwsIT.java", "diffHunk": "@@ -120,18 +90,19 @@ public void tearDown() throws IOException {\n \n   @Test\n   public void testCreateExternalTableAws() {\n-    String sourceUri = \"s3://cloud-samples-tests/us-states.csv\";\n+    String sourceUri = \"s3://steph-omni-test-bucket/us-states.csv\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7242c725e280a4cd9a853d2a8d036b1bf172c8ce"}, "originalPosition": 79}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01bccfe9faef56bdd98d6228d45c486b721a82fc", "author": {"user": {"login": "stephaniewang526", "name": "Stephanie Wang"}}, "url": "https://github.com/googleapis/java-bigquery/commit/01bccfe9faef56bdd98d6228d45c486b721a82fc", "committedDate": "2020-10-20T23:31:22Z", "message": "update based on comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1323, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}