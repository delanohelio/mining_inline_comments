{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MDg0MzQy", "number": 2321, "title": "[RHPAM-2060] - Infinite Configuration file does not exist messages in\u2026", "bodyText": "\u2026 Smart Router logs\nSee: https://issues.redhat.com/browse/RHPAM-2060\nSigned-off-by: Mauricio Magnani msmagnanijr@gmail.com\nThank you for submitting this pull request\nJIRA: (please edit the JIRA link if it exists)\nlink\nreferenced Pull Requests: (please edit the URLs of referenced pullrequests if they exist)\n\npaste the link(s) from GitHub here\nlink 2\nlink 3 etc.\n\n\n\nHow to retest this PR or trigger a specific build:\n\n\n\na pull request please add comment: Jenkins retest this\n\n\na full downstream build please add comment: Jenkins run fdb\n\n\na compile downstream build please  add comment: Jenkins run cdb\n\n\na full production downstream build please add comment: Jenkins execute product fdb\n\n\nan upstream build please add comment: Jenkins run upstream", "createdAt": "2020-11-24T00:51:43Z", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2321", "merged": true, "mergeCommit": {"oid": "4b665dd764b8e1508566d6de9a692c38dae5a122"}, "closed": true, "closedAt": "2020-12-04T07:49:11Z", "author": {"login": "msmagnanijr"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdffwAlgFqTUzNzAxNDU0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiy4-qgFqTU0NDcyMTgwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MDE0NTQy", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2321#pullrequestreview-537014542", "createdAt": "2020-11-24T01:47:01Z", "commit": {"oid": "06c6d1bfd96b42dbd36edf7a7c9ac9c89545f2c4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMTo0NzowMVrOH4mosg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMTo0ODoxM1rOH4mtJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTExNTMxNA==", "bodyText": "move this log line to th e beginning of the else clause and update it to something like, \"configuration file does not exist {0}, creating...\"", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2321#discussion_r529115314", "createdAt": "2020-11-24T01:47:01Z", "author": {"login": "spolti"}, "path": "kie-server-parent/kie-server-router/kie-server-router-proxy/src/main/java/org/kie/server/router/repository/ConfigFileWatcher.java", "diffHunk": "@@ -55,10 +58,22 @@ public ConfigFileWatcher(String configFilePath, ConfigurationMarshaller marshall\n             if(toWatch.toFile().exists()) {\n                 lastUpdate = Files.getLastModifiedTime(toWatch).toMillis();\n             } else {\n+                String cfg = marshaller.marshall(configuration);\n+                File file = new File(this.toWatch.toString() + \"kie-server-router.json\");\n+                file.createNewFile();\n+                if(file.exists()){\n+                    try (FileOutputStream fos = new FileOutputStream(file); PrintWriter writer = new PrintWriter(fos)) {\n+                        writer.write(cfg);\n+                    }\n+                }\n+                FileTime lastModified = Files.getLastModifiedTime(toWatch);\n+                lastUpdate =  lastModified.toMillis();\n                 log.warnv(\"configuration file does not exist {0} \", this.toWatch);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06c6d1bfd96b42dbd36edf7a7c9ac9c89545f2c4"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTExNjQ1NA==", "bodyText": "not sure if this test really test if the file exists, it on tests the object, and at this point it will be never null even if the cfg file is not correctly wriitten.\nprobably reflection would be a way to test it, @elguardian wdyt?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2321#discussion_r529116454", "createdAt": "2020-11-24T01:48:13Z", "author": {"login": "spolti"}, "path": "kie-server-parent/kie-server-router/kie-server-router-proxy/src/test/java/org/kie/server/router/repository/FileRepositoryTest.java", "diffHunk": "@@ -213,4 +213,15 @@ public void onConfigurationReloaded() {\n         repoWithWatcher.close();\n         repoWithWatcher.clean();\n     }\n+\n+    @Test\n+    public void testFileCreation() throws Exception {\n+\n+        File repositoryDirectory = new File(\"target\" + File.separator + UUID.randomUUID().toString());\n+        Configuration configuration = new Configuration();\n+        ConfigurationMarshaller marshaller = new ConfigurationMarshaller();\n+\n+        ConfigFileWatcher configFileWatcher = new ConfigFileWatcher(repositoryDirectory.getParentFile().getAbsolutePath(), marshaller, configuration);\n+        assertNotNull(configFileWatcher);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06c6d1bfd96b42dbd36edf7a7c9ac9c89545f2c4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MjI5MTcy", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2321#pullrequestreview-538229172", "createdAt": "2020-11-25T07:51:07Z", "commit": {"oid": "0621b4be8e7035172e630d135016e9e2666896ca"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNDU1NzU2", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2321#pullrequestreview-542455756", "createdAt": "2020-12-02T02:41:16Z", "commit": {"oid": "ff71a6f914c5d5291451affd011f323bf8128281"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "285f69aeba3d1d1714a52f66c4bf2e6b7b7957f2", "author": {"user": {"login": "msmagnanijr", "name": "Mauricio Magnani"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/285f69aeba3d1d1714a52f66c4bf2e6b7b7957f2", "committedDate": "2020-12-02T23:44:35Z", "message": "[RHPAM-2060] - Infinite Configuration file does not exist messages in Smart Router logs\n\nSee: https://issues.redhat.com/browse/RHPAM-2060\n\nSigned-off-by: Mauricio Magnani <msmagnanijr@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzIxODA3", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2321#pullrequestreview-544721807", "createdAt": "2020-12-04T07:48:09Z", "commit": {"oid": "285f69aeba3d1d1714a52f66c4bf2e6b7b7957f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1099, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}