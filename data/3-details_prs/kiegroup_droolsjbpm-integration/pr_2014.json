{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTQ2OTEy", "number": 2014, "title": "DROOLS-5020 DMN wire Validator to kie-maven-plugin Maven build", "bodyText": "please note tests are provided by takari framework here: https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-plugins-testing/src/test/projects/kjar-7-with-dmn\n@etirelli @baldimir @hellowdan\n/cc @DuncanDoyle\nIf I introduce an Error which is subject of the model analysis:\n\nThen, if I really want to try anyway, by disabling the kie-maven-plugin flag:\n\nI will get the same trouble now because the DMN compilation would, naturally, fail:\n\nOnce review approved, I will write the doc N&N", "createdAt": "2020-02-17T13:49:30Z", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014", "merged": true, "mergeCommit": {"oid": "9e67128149ed5a3cc158081564b70bb650f6815b"}, "closed": true, "closedAt": "2020-02-28T08:40:19Z", "author": {"login": "tarilabs"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFNkMQAH2gAyMzc2MTQ2OTEyOmU3MTZkZTA0ZTcxNTc0YjhhZDA4NTFhYzFkZGRmY2VhYjMxODBmMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIrUFgAFqTM2NjIxNjcyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e716de04e71574b8ad0851ac1dddfceab3180f1e", "author": {"user": {"login": "tarilabs", "name": "Matteo Mortari"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/e716de04e71574b8ad0851ac1dddfceab3180f1e", "committedDate": "2020-02-17T13:44:00Z", "message": "DROOLS-5020 DMN wire Validator to kie-maven-plugin Maven build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899", "author": {"user": {"login": "tarilabs", "name": "Matteo Mortari"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/a2ae8ac018c5e50c881f3756122cdb340cc4e899", "committedDate": "2020-02-18T13:22:54Z", "message": "update DMN to avoid failing schema check\n\nOn DMNv1.1, the import element was not extending (yet) the namedelement\nin order to allow extended attribute.\nUpdating the test model to v1.2 to avoid failing XSD checks."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMzQ5MTI1", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#pullrequestreview-363349125", "createdAt": "2020-02-24T12:19:22Z", "commit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxMjoxOToyMlrOFtes2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxMjoxOToyMlrOFtes2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIzMzI0MA==", "bodyText": "That's a big function. Could it be broken in small methods to be better tested? My other concern is because I can't see a test for this new class. In case I'm wrong, could you please write a quick explanation? Thanks.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#discussion_r383233240", "createdAt": "2020-02-24T12:19:22Z", "author": {"login": "hellowdan"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/ValidateDMNMojo.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.model.Resource;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.kproject.models.KieModuleModelImpl;\n+import org.kie.api.builder.Message.Level;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.dmn.api.core.DMNMessage;\n+import org.kie.dmn.core.assembler.DMNAssemblerService;\n+import org.kie.dmn.core.compiler.DMNProfile;\n+import org.kie.dmn.feel.util.ClassLoaderUtil;\n+import org.kie.dmn.model.api.DMNModelInstrumentedBase;\n+import org.kie.dmn.model.api.Definitions;\n+import org.kie.dmn.validation.DMNValidator;\n+import org.kie.dmn.validation.DMNValidator.Validation;\n+import org.kie.dmn.validation.DMNValidatorFactory;\n+import org.kie.internal.utils.ChainedProperties;\n+\n+@Mojo(name = \"validateDMN\",\n+      requiresDependencyResolution = ResolutionScope.NONE,\n+      requiresProject = true,\n+      defaultPhase = LifecyclePhase.PROCESS_RESOURCES)\n+public class ValidateDMNMojo extends AbstractKieMojo {\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.resources}\")\n+    private List<Resource> resources;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(property = \"validateDMN\", defaultValue = \"VALIDATE_SCHEMA,VALIDATE_MODEL\")\n+    private String validateDMN;\n+    private List<Validation> actualFlags = new ArrayList<>();\n+\n+    private DMNValidator validator;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTEyNTA2", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#pullrequestreview-363912506", "createdAt": "2020-02-25T07:15:22Z", "commit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzoxNToyMlrOFt626g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzoyMToxNlrOFt6-CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY5NDU3MA==", "bodyText": "@tarilabs\nDo I understand correctly that we are adding validator to validate DMN during plugin execution? What about to add test for invalid DMN to https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-plugins-testing/src/test/projects/kjar-7-with-dmn ? It will test that validator throws error when DMN is invalid.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#discussion_r383694570", "createdAt": "2020-02-25T07:15:22Z", "author": {"login": "jiripetrlik"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/ValidateDMNMojo.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.model.Resource;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.kproject.models.KieModuleModelImpl;\n+import org.kie.api.builder.Message.Level;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.dmn.api.core.DMNMessage;\n+import org.kie.dmn.core.assembler.DMNAssemblerService;\n+import org.kie.dmn.core.compiler.DMNProfile;\n+import org.kie.dmn.feel.util.ClassLoaderUtil;\n+import org.kie.dmn.model.api.DMNModelInstrumentedBase;\n+import org.kie.dmn.model.api.Definitions;\n+import org.kie.dmn.validation.DMNValidator;\n+import org.kie.dmn.validation.DMNValidator.Validation;\n+import org.kie.dmn.validation.DMNValidatorFactory;\n+import org.kie.internal.utils.ChainedProperties;\n+\n+@Mojo(name = \"validateDMN\",\n+      requiresDependencyResolution = ResolutionScope.NONE,\n+      requiresProject = true,\n+      defaultPhase = LifecyclePhase.PROCESS_RESOURCES)\n+public class ValidateDMNMojo extends AbstractKieMojo {\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.resources}\")\n+    private List<Resource> resources;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(property = \"validateDMN\", defaultValue = \"VALIDATE_SCHEMA,VALIDATE_MODEL\")\n+    private String validateDMN;\n+    private List<Validation> actualFlags = new ArrayList<>();\n+\n+    private DMNValidator validator;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIzMzI0MA=="}, "originalCommit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY5NTA2Nw==", "bodyText": "This seems suspicious. Maybe it would be better to rethrow this exception or at least log something.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#discussion_r383695067", "createdAt": "2020-02-25T07:17:02Z", "author": {"login": "jiripetrlik"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/ValidateDMNMojo.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.model.Resource;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.kproject.models.KieModuleModelImpl;\n+import org.kie.api.builder.Message.Level;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.dmn.api.core.DMNMessage;\n+import org.kie.dmn.core.assembler.DMNAssemblerService;\n+import org.kie.dmn.core.compiler.DMNProfile;\n+import org.kie.dmn.feel.util.ClassLoaderUtil;\n+import org.kie.dmn.model.api.DMNModelInstrumentedBase;\n+import org.kie.dmn.model.api.Definitions;\n+import org.kie.dmn.validation.DMNValidator;\n+import org.kie.dmn.validation.DMNValidator.Validation;\n+import org.kie.dmn.validation.DMNValidatorFactory;\n+import org.kie.internal.utils.ChainedProperties;\n+\n+@Mojo(name = \"validateDMN\",\n+      requiresDependencyResolution = ResolutionScope.NONE,\n+      requiresProject = true,\n+      defaultPhase = LifecyclePhase.PROCESS_RESOURCES)\n+public class ValidateDMNMojo extends AbstractKieMojo {\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.resources}\")\n+    private List<Resource> resources;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(property = \"validateDMN\", defaultValue = \"VALIDATE_SCHEMA,VALIDATE_MODEL\")\n+    private String validateDMN;\n+    private List<Validation> actualFlags = new ArrayList<>();\n+\n+    private DMNValidator validator;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        try {\n+            for (String p : validateDMN.split(\",\")) {\n+                actualFlags.add(Validation.valueOf(p));\n+            }\n+        } catch (IllegalArgumentException e) {\n+            // do nothing.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY5NTg5MQ==", "bodyText": "I agree with @hellowdan . This method is quite long and complex. Can we for example separate this loop to private methid like \"getDMNModelPaths\".", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#discussion_r383695891", "createdAt": "2020-02-25T07:19:43Z", "author": {"login": "jiripetrlik"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/ValidateDMNMojo.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.model.Resource;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.kproject.models.KieModuleModelImpl;\n+import org.kie.api.builder.Message.Level;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.dmn.api.core.DMNMessage;\n+import org.kie.dmn.core.assembler.DMNAssemblerService;\n+import org.kie.dmn.core.compiler.DMNProfile;\n+import org.kie.dmn.feel.util.ClassLoaderUtil;\n+import org.kie.dmn.model.api.DMNModelInstrumentedBase;\n+import org.kie.dmn.model.api.Definitions;\n+import org.kie.dmn.validation.DMNValidator;\n+import org.kie.dmn.validation.DMNValidator.Validation;\n+import org.kie.dmn.validation.DMNValidatorFactory;\n+import org.kie.internal.utils.ChainedProperties;\n+\n+@Mojo(name = \"validateDMN\",\n+      requiresDependencyResolution = ResolutionScope.NONE,\n+      requiresProject = true,\n+      defaultPhase = LifecyclePhase.PROCESS_RESOURCES)\n+public class ValidateDMNMojo extends AbstractKieMojo {\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.resources}\")\n+    private List<Resource> resources;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(property = \"validateDMN\", defaultValue = \"VALIDATE_SCHEMA,VALIDATE_MODEL\")\n+    private String validateDMN;\n+    private List<Validation> actualFlags = new ArrayList<>();\n+\n+    private DMNValidator validator;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        try {\n+            for (String p : validateDMN.split(\",\")) {\n+                actualFlags.add(Validation.valueOf(p));\n+            }\n+        } catch (IllegalArgumentException e) {\n+            // do nothing.\n+        }\n+        // for this phase, keep only the following flags (the rest requires the BuildMojo).\n+        actualFlags.retainAll(Arrays.asList(Validation.VALIDATE_SCHEMA, Validation.VALIDATE_MODEL));\n+        if (actualFlags.isEmpty()) {\n+            getLog().info(\"No VALIDATE_SCHEMA or VALIDATE_MODEL flags set, skipping.\");\n+            return;\n+        }\n+\n+        List<Path> resourcesPaths = resources.stream().map(r -> new File(r.getDirectory()).toPath()).collect(Collectors.toList());\n+        List<Path> dmnModelPaths = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY5NjE2MA==", "bodyText": "Same as model Paths, can we extract this piece of code to a separate method.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#discussion_r383696160", "createdAt": "2020-02-25T07:20:36Z", "author": {"login": "jiripetrlik"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/ValidateDMNMojo.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.model.Resource;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.kproject.models.KieModuleModelImpl;\n+import org.kie.api.builder.Message.Level;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.dmn.api.core.DMNMessage;\n+import org.kie.dmn.core.assembler.DMNAssemblerService;\n+import org.kie.dmn.core.compiler.DMNProfile;\n+import org.kie.dmn.feel.util.ClassLoaderUtil;\n+import org.kie.dmn.model.api.DMNModelInstrumentedBase;\n+import org.kie.dmn.model.api.Definitions;\n+import org.kie.dmn.validation.DMNValidator;\n+import org.kie.dmn.validation.DMNValidator.Validation;\n+import org.kie.dmn.validation.DMNValidatorFactory;\n+import org.kie.internal.utils.ChainedProperties;\n+\n+@Mojo(name = \"validateDMN\",\n+      requiresDependencyResolution = ResolutionScope.NONE,\n+      requiresProject = true,\n+      defaultPhase = LifecyclePhase.PROCESS_RESOURCES)\n+public class ValidateDMNMojo extends AbstractKieMojo {\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.resources}\")\n+    private List<Resource> resources;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(property = \"validateDMN\", defaultValue = \"VALIDATE_SCHEMA,VALIDATE_MODEL\")\n+    private String validateDMN;\n+    private List<Validation> actualFlags = new ArrayList<>();\n+\n+    private DMNValidator validator;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        try {\n+            for (String p : validateDMN.split(\",\")) {\n+                actualFlags.add(Validation.valueOf(p));\n+            }\n+        } catch (IllegalArgumentException e) {\n+            // do nothing.\n+        }\n+        // for this phase, keep only the following flags (the rest requires the BuildMojo).\n+        actualFlags.retainAll(Arrays.asList(Validation.VALIDATE_SCHEMA, Validation.VALIDATE_MODEL));\n+        if (actualFlags.isEmpty()) {\n+            getLog().info(\"No VALIDATE_SCHEMA or VALIDATE_MODEL flags set, skipping.\");\n+            return;\n+        }\n+\n+        List<Path> resourcesPaths = resources.stream().map(r -> new File(r.getDirectory()).toPath()).collect(Collectors.toList());\n+        List<Path> dmnModelPaths = new ArrayList<>();\n+        for (Path p : resourcesPaths) {\n+            getLog().info(\"Looking for DMN models in path: \" + p);\n+            try (Stream<Path> walk = Files.walk(p)) {\n+                walk.filter(f -> f.toString().endsWith(\".dmn\"))\n+                    .forEach(dmnModelPaths::add);\n+            } catch (Exception e) {\n+                throw new MojoExecutionException(\"Failed executing ValidateDMNMojo\", e);\n+            }\n+        }\n+\n+        if (dmnModelPaths.isEmpty()) {\n+            getLog().info(\"No DMN Models found.\");\n+            return;\n+        }\n+\n+        getLog().info(\"Initializing DMNValidator...\");\n+        ClassLoader classLoader = ClassLoaderUtil.findDefaultClassLoader();\n+        ChainedProperties chainedProperties = ChainedProperties.getChainedProperties(classLoader);\n+        List<KieModuleModel> kieModules = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY5NjM5Mw==", "bodyText": "Same as paths and kie modules. Can we extract to a separate method.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#discussion_r383696393", "createdAt": "2020-02-25T07:21:16Z", "author": {"login": "jiripetrlik"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/ValidateDMNMojo.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.model.Resource;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.kproject.models.KieModuleModelImpl;\n+import org.kie.api.builder.Message.Level;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.dmn.api.core.DMNMessage;\n+import org.kie.dmn.core.assembler.DMNAssemblerService;\n+import org.kie.dmn.core.compiler.DMNProfile;\n+import org.kie.dmn.feel.util.ClassLoaderUtil;\n+import org.kie.dmn.model.api.DMNModelInstrumentedBase;\n+import org.kie.dmn.model.api.Definitions;\n+import org.kie.dmn.validation.DMNValidator;\n+import org.kie.dmn.validation.DMNValidator.Validation;\n+import org.kie.dmn.validation.DMNValidatorFactory;\n+import org.kie.internal.utils.ChainedProperties;\n+\n+@Mojo(name = \"validateDMN\",\n+      requiresDependencyResolution = ResolutionScope.NONE,\n+      requiresProject = true,\n+      defaultPhase = LifecyclePhase.PROCESS_RESOURCES)\n+public class ValidateDMNMojo extends AbstractKieMojo {\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.resources}\")\n+    private List<Resource> resources;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(property = \"validateDMN\", defaultValue = \"VALIDATE_SCHEMA,VALIDATE_MODEL\")\n+    private String validateDMN;\n+    private List<Validation> actualFlags = new ArrayList<>();\n+\n+    private DMNValidator validator;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        try {\n+            for (String p : validateDMN.split(\",\")) {\n+                actualFlags.add(Validation.valueOf(p));\n+            }\n+        } catch (IllegalArgumentException e) {\n+            // do nothing.\n+        }\n+        // for this phase, keep only the following flags (the rest requires the BuildMojo).\n+        actualFlags.retainAll(Arrays.asList(Validation.VALIDATE_SCHEMA, Validation.VALIDATE_MODEL));\n+        if (actualFlags.isEmpty()) {\n+            getLog().info(\"No VALIDATE_SCHEMA or VALIDATE_MODEL flags set, skipping.\");\n+            return;\n+        }\n+\n+        List<Path> resourcesPaths = resources.stream().map(r -> new File(r.getDirectory()).toPath()).collect(Collectors.toList());\n+        List<Path> dmnModelPaths = new ArrayList<>();\n+        for (Path p : resourcesPaths) {\n+            getLog().info(\"Looking for DMN models in path: \" + p);\n+            try (Stream<Path> walk = Files.walk(p)) {\n+                walk.filter(f -> f.toString().endsWith(\".dmn\"))\n+                    .forEach(dmnModelPaths::add);\n+            } catch (Exception e) {\n+                throw new MojoExecutionException(\"Failed executing ValidateDMNMojo\", e);\n+            }\n+        }\n+\n+        if (dmnModelPaths.isEmpty()) {\n+            getLog().info(\"No DMN Models found.\");\n+            return;\n+        }\n+\n+        getLog().info(\"Initializing DMNValidator...\");\n+        ClassLoader classLoader = ClassLoaderUtil.findDefaultClassLoader();\n+        ChainedProperties chainedProperties = ChainedProperties.getChainedProperties(classLoader);\n+        List<KieModuleModel> kieModules = new ArrayList<>();\n+        for (Path p : resourcesPaths) {\n+            try (Stream<Path> walk = Files.walk(p)) {\n+                List<Path> collect = walk.filter(f -> f.toString().endsWith(\"kmodule.xml\")).collect(Collectors.toList());\n+                for (Path k : collect) {\n+                    kieModules.add(KieModuleModelImpl.fromXML(k.toFile()));\n+                }\n+            } catch (Exception e) {\n+                throw new MojoExecutionException(\"Failed executing ValidateDMNMojo\", e);\n+            }\n+        }\n+        for (KieModuleModel kmm : kieModules) {\n+            Properties ps = new Properties();\n+            ps.putAll(kmm.getConfigurationProperties());\n+            chainedProperties.addProperties(ps);\n+        }\n+        List<DMNProfile> dmnProfiles = new ArrayList<>();\n+        dmnProfiles.addAll(DMNAssemblerService.getDefaultDMNProfiles(chainedProperties));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2ae8ac018c5e50c881f3756122cdb340cc4e899"}, "originalPosition": 127}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eecf5889cb4c03b04dff23730ba4716e616cea9a", "author": {"user": {"login": "tarilabs", "name": "Matteo Mortari"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/eecf5889cb4c03b04dff23730ba4716e616cea9a", "committedDate": "2020-02-25T09:51:57Z", "message": "code refactor following code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjE2NzI2", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2014#pullrequestreview-366216726", "createdAt": "2020-02-28T08:05:20Z", "commit": {"oid": "eecf5889cb4c03b04dff23730ba4716e616cea9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1461, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}