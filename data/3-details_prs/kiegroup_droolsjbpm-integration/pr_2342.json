{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMjc0NjIy", "number": 2342, "title": "[JBPM-9520] KafkaServerExtension poll is not freed", "bodyText": "Using read write lock\nJIRA:\nJBPM-9520", "createdAt": "2020-12-16T16:08:47Z", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342", "merged": true, "mergeCommit": {"oid": "48948141f7697530ee81d4e7a586f24898586a7b"}, "closed": true, "closedAt": "2020-12-18T11:10:27Z", "author": {"login": "fjtirado"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmxzjegBqjQxMjA3MjcyODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnGQaFAFqTU1NDc4MDIyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51b7833516275bfb1d27083ca48d639e57cc9a4d", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/51b7833516275bfb1d27083ca48d639e57cc9a4d", "committedDate": "2020-12-16T16:07:41Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}, "afterCommit": {"oid": "49536454b1c056c7fe404c66bee1c107aefcac0b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/49536454b1c056c7fe404c66bee1c107aefcac0b", "committedDate": "2020-12-16T16:47:48Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49536454b1c056c7fe404c66bee1c107aefcac0b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/49536454b1c056c7fe404c66bee1c107aefcac0b", "committedDate": "2020-12-16T16:47:48Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}, "afterCommit": {"oid": "9e4424e9ce1d9a03dcbd6fd2fae00f8a86981c4f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/9e4424e9ce1d9a03dcbd6fd2fae00f8a86981c4f", "committedDate": "2020-12-16T17:11:40Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e4424e9ce1d9a03dcbd6fd2fae00f8a86981c4f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/9e4424e9ce1d9a03dcbd6fd2fae00f8a86981c4f", "committedDate": "2020-12-16T17:11:40Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}, "afterCommit": {"oid": "79a13347f80402d68fdae1cf612fb2b8f61001ff", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/79a13347f80402d68fdae1cf612fb2b8f61001ff", "committedDate": "2020-12-16T17:14:08Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79a13347f80402d68fdae1cf612fb2b8f61001ff", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/79a13347f80402d68fdae1cf612fb2b8f61001ff", "committedDate": "2020-12-16T17:14:08Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}, "afterCommit": {"oid": "f45cffe58cc2ba9757699d3480d446c8da785100", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f45cffe58cc2ba9757699d3480d446c8da785100", "committedDate": "2020-12-16T17:15:32Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f45cffe58cc2ba9757699d3480d446c8da785100", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f45cffe58cc2ba9757699d3480d446c8da785100", "committedDate": "2020-12-16T17:15:32Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock"}, "afterCommit": {"oid": "2b33b675edfbc3bb83ba3d4556ab946faab1132c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/2b33b675edfbc3bb83ba3d4556ab946faab1132c", "committedDate": "2020-12-16T17:55:24Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b33b675edfbc3bb83ba3d4556ab946faab1132c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/2b33b675edfbc3bb83ba3d4556ab946faab1132c", "committedDate": "2020-12-16T17:55:24Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}, "afterCommit": {"oid": "827026d7e6669e13f474ebc0606196a5d5bb556a", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/827026d7e6669e13f474ebc0606196a5d5bb556a", "committedDate": "2020-12-16T17:56:47Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "827026d7e6669e13f474ebc0606196a5d5bb556a", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/827026d7e6669e13f474ebc0606196a5d5bb556a", "committedDate": "2020-12-16T17:56:47Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}, "afterCommit": {"oid": "f836b0faf2bd27c7ea85278de21cbf3158b41644", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f836b0faf2bd27c7ea85278de21cbf3158b41644", "committedDate": "2020-12-16T17:59:52Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f836b0faf2bd27c7ea85278de21cbf3158b41644", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f836b0faf2bd27c7ea85278de21cbf3158b41644", "committedDate": "2020-12-16T17:59:52Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}, "afterCommit": {"oid": "b51199c28b28b0ba4499180d6a356070dfbcd0a6", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/b51199c28b28b0ba4499180d6a356070dfbcd0a6", "committedDate": "2020-12-16T18:06:56Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "349283d4cd378f75d2d5731528375ee44caec570", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/349283d4cd378f75d2d5731528375ee44caec570", "committedDate": "2020-12-17T09:44:10Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b51199c28b28b0ba4499180d6a356070dfbcd0a6", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/b51199c28b28b0ba4499180d6a356070dfbcd0a6", "committedDate": "2020-12-16T18:06:56Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}, "afterCommit": {"oid": "349283d4cd378f75d2d5731528375ee44caec570", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/349283d4cd378f75d2d5731528375ee44caec570", "committedDate": "2020-12-17T09:44:10Z", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NDM1MDQx", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342#pullrequestreview-554435041", "createdAt": "2020-12-17T09:46:20Z", "commit": {"oid": "349283d4cd378f75d2d5731528375ee44caec570"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwOTo0NjoyMVrOIHtIFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwOTo0NjoyMVrOIHtIFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk1MDI5NQ==", "bodyText": "This change tries to cover an edge case. System property enable when onDeploy/onActivate is called, but disable when onUndeploy/onDeactivate is invoked. This will  leak to a subscripton \"leak\". In order to avoid that, at the cost of sacrificing a bit of performance (not much in any case), it is better to clean always", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342#discussion_r544950295", "createdAt": "2020-12-17T09:46:21Z", "author": {"login": "fjtirado"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -272,12 +264,8 @@ private void updateTopics(String deploymentId, ProcessDefinition processDefiniti\n     }\n \n     private void removeTopics(String deploymentId, ProcessDefinition processDefinition) {\n-        if (processSignals()) {\n-            removeTopics(topic2Signal, deploymentId, processDefinition.getSignalsDesc());\n-        }\n-        if (processMessages()) {\n-            removeTopics(topic2Message, deploymentId, processDefinition.getMessagesDesc());\n-        }\n+        removeTopics(topic2Signal, deploymentId, processDefinition.getSignalsDesc());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "349283d4cd378f75d2d5731528375ee44caec570"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzgwMjI0", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342#pullrequestreview-554780224", "createdAt": "2020-12-17T16:36:44Z", "commit": {"oid": "349283d4cd378f75d2d5731528375ee44caec570"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjozNjo0NVrOIH-R2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjozNjo0NVrOIH-R2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIzMTMyMw==", "bodyText": "OK, agreed; it's very weird but not impossible. Anyway, performance impact is minimum and removing topics is during undeployment.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342#discussion_r545231323", "createdAt": "2020-12-17T16:36:45Z", "author": {"login": "gmunozfe"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -272,12 +264,8 @@ private void updateTopics(String deploymentId, ProcessDefinition processDefiniti\n     }\n \n     private void removeTopics(String deploymentId, ProcessDefinition processDefinition) {\n-        if (processSignals()) {\n-            removeTopics(topic2Signal, deploymentId, processDefinition.getSignalsDesc());\n-        }\n-        if (processMessages()) {\n-            removeTopics(topic2Message, deploymentId, processDefinition.getMessagesDesc());\n-        }\n+        removeTopics(topic2Signal, deploymentId, processDefinition.getSignalsDesc());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk1MDI5NQ=="}, "originalCommit": {"oid": "349283d4cd378f75d2d5731528375ee44caec570"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1139, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}