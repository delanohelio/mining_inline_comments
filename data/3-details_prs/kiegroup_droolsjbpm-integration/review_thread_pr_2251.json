{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzMTEwNzQw", "number": 2251, "reviewThreads": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODozMDoxN1rOEn-cnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoxNTowNVrOErf4hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzUzMDU1OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODozMDoxN1rOHYziwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODozMDoxN1rOHYziwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc3MjM1NA==", "bodyText": "To be removed?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495772354", "createdAt": "2020-09-28T08:30:17Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/pom.xml", "diffHunk": "@@ -27,6 +27,19 @@\n     </plugins>\n   </build>\n \n+  <!-- TODO REMOVE -->\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.kie</groupId>\n+        <artifactId>kie-pmml-bom</artifactId>\n+        <version>${project.version}</version>\n+        <type>pom</type>\n+        <scope>import</scope>\n+      </dependency>\n+    </dependencies>\n+  </dependencyManagement>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzYyNjQ0OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/pom.xml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1NTo1OVrOHY0czA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoxNTo0MlrOHdwXAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4NzIxMg==", "bodyText": "Can you please use kie-pmml-dependencies instead?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495787212", "createdAt": "2020-09-28T08:55:59Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/pom.xml", "diffHunk": "@@ -181,10 +194,27 @@\n       <scope>runtime</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-commons</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-models-drools-common</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-api</artifactId>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-core</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-evaluator-assembler</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc1MTcwMA==", "bodyText": "@danielezonca\nReason behind that is that kie-pmml-dependencies brings in all our model implementations, and that could break somehow the \"plugin\" architecture of the model implementations. Does this make sense ?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498751700", "createdAt": "2020-10-02T10:52:36Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/pom.xml", "diffHunk": "@@ -181,10 +194,27 @@\n       <scope>runtime</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-commons</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-models-drools-common</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-api</artifactId>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-core</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-evaluator-assembler</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4NzIxMg=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4MDkyMg==", "bodyText": "I see your point but we might consider to create a kie-pmml-core or similar to wrap them so that we have a clear separation. Wdyt?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500480922", "createdAt": "2020-10-06T17:41:48Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/pom.xml", "diffHunk": "@@ -181,10 +194,27 @@\n       <scope>runtime</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-commons</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-models-drools-common</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-api</artifactId>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-core</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-evaluator-assembler</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4NzIxMg=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2MzA3Mg==", "bodyText": "@danielezonca\nhttps://issues.redhat.com/browse/DROOLS-5701 - but my list of tickets is getting too long to be realistically implemented", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500963072", "createdAt": "2020-10-07T12:15:42Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/pom.xml", "diffHunk": "@@ -181,10 +194,27 @@\n       <scope>runtime</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-commons</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-models-drools-common</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-api</artifactId>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-core</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-evaluator-assembler</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4NzIxMg=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzYyNzQ5OnYy", "diffSide": "LEFT", "path": "kie-maven-plugin/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1NjoxNVrOHY0daQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDo1NTozMlrOHbpdLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4NzM2OQ==", "bodyText": "Are you sure to remove kie-pmml dep?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495787369", "createdAt": "2020-09-28T08:56:15Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/pom.xml", "diffHunk": "@@ -181,10 +194,27 @@\n       <scope>runtime</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc1MjgxNQ==", "bodyText": "@danielezonca\nrestored", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498752815", "createdAt": "2020-10-02T10:55:32Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/pom.xml", "diffHunk": "@@ -181,10 +194,27 @@\n       <scope>runtime</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4NzM2OQ=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzYzMTI2OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GenerateDMNModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1NzoxMlrOHY0frg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1NzoxMlrOHY0frg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4Nzk1MA==", "bodyText": "To be removed", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495787950", "createdAt": "2020-09-28T08:57:12Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GenerateDMNModelMojo.java", "diffHunk": "@@ -147,10 +147,12 @@ private void createDMNFile(List<String> compiledClassNames) {\n     }\n \n     private List<String> getDMNFIles(InternalKieModule kieModule) {\n-        return kieModule.getFileNames()\n-                        .stream()\n-                        .filter(f -> f.endsWith(\"dmn\"))\n-                        .collect(Collectors.toList());\n+        return getFilesByType(kieModule, \"dmn\");\n+//\n+//        return kieModule.getFileNames()\n+//                        .stream()\n+//                        .filter(f -> f.endsWith(\"dmn\"))\n+//                        .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzYzNDg0OnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1ODoxM1rOHY0iBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoxNjowNFrOHdwXyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4ODU0OA==", "bodyText": "To be removed?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495788548", "createdAt": "2020-09-28T08:58:13Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/pom.xml", "diffHunk": "@@ -35,6 +35,19 @@\n     </plugins>\n   </build>\n \n+  <!-- TODO REMOVE -->\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.kie</groupId>\n+        <artifactId>kie-pmml-bom</artifactId>\n+        <version>${project.version}</version>\n+        <type>pom</type>\n+        <scope>import</scope>\n+      </dependency>\n+    </dependencies>\n+  </dependencyManagement>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2MzI3NQ==", "bodyText": "@danielezonca\nactually needed", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500963275", "createdAt": "2020-10-07T12:16:04Z", "author": {"login": "gitgabrio"}, "path": "kie-plugins-testing/pom.xml", "diffHunk": "@@ -35,6 +35,19 @@\n     </plugins>\n   </build>\n \n+  <!-- TODO REMOVE -->\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.kie</groupId>\n+        <artifactId>kie-pmml-bom</artifactId>\n+        <version>${project.version}</version>\n+        <type>pom</type>\n+        <scope>import</scope>\n+      </dependency>\n+    </dependencies>\n+  </dependencyManagement>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4ODU0OA=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzYzNjQ1OnYy", "diffSide": "LEFT", "path": "kie-plugins-testing/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1ODozNVrOHY0i_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjozMzozMlrOHd76jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4ODc5Ng==", "bodyText": "Are you sure to remove kie-pmml dep?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495788796", "createdAt": "2020-09-28T08:58:35Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/pom.xml", "diffHunk": "@@ -171,9 +184,29 @@\n       <artifactId>drools-scorecards</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+<!--    <dependency>-->\n+<!--      <groupId>org.drools</groupId>-->\n+<!--      <artifactId>kie-pmml</artifactId>-->\n+<!--      <scope>runtime</scope>-->\n+<!--    </dependency>-->\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1MjM5Ng==", "bodyText": "@danielezonca\nMoved inside specific IT test (kjar-6-with-pmml)", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r501152396", "createdAt": "2020-10-07T16:33:32Z", "author": {"login": "gitgabrio"}, "path": "kie-plugins-testing/pom.xml", "diffHunk": "@@ -171,9 +184,29 @@\n       <artifactId>drools-scorecards</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+<!--    <dependency>-->\n+<!--      <groupId>org.drools</groupId>-->\n+<!--      <artifactId>kie-pmml</artifactId>-->\n+<!--      <scope>runtime</scope>-->\n+<!--    </dependency>-->\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4ODc5Ng=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzYzNzM2OnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1ODo1MVrOHY0jmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwODo1ODo1MVrOHY0jmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc4ODk1Mg==", "bodyText": "Can you please use kie-pmml-dependencies?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495788952", "createdAt": "2020-09-28T08:58:51Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/pom.xml", "diffHunk": "@@ -171,9 +184,29 @@\n       <artifactId>drools-scorecards</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+<!--    <dependency>-->\n+<!--      <groupId>org.drools</groupId>-->\n+<!--      <artifactId>kie-pmml</artifactId>-->\n+<!--      <scope>runtime</scope>-->\n+<!--    </dependency>-->\n     <dependency>\n-      <groupId>org.drools</groupId>\n-      <artifactId>kie-pmml</artifactId>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-commons</artifactId>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-api</artifactId>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-compiler-core</artifactId>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-evaluator-assembler</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzY0NjI5OnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/src/test/projects/kjar-12-with-pmml-trusty/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOTowMTowN1rOHY0pJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOTowMTowN1rOHY0pJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc5MDM3Mg==", "bodyText": "Are you sure about this property override? The other test modules of this repo are configured in a different way", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495790372", "createdAt": "2020-09-28T09:01:07Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/src/test/projects/kjar-12-with-pmml-trusty/pom.xml", "diffHunk": "@@ -0,0 +1,56 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>org.kie</groupId>\n+  <artifactId>kie-maven-plugin-test-kjar-12</artifactId>\n+  <version>1.0.0.Final</version>\n+\n+  <packaging>kjar</packaging>\n+\n+  <properties>\n+    <org.kie.version>7.44.0-SNAPSHOT</org.kie.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzY0ODY0OnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/src/test/projects/kjar-12-with-pmml-trusty/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOTowMTo0OVrOHY0qjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOTowMTo0OVrOHY0qjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc5MDczNQ==", "bodyText": "Why do you need this property?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r495790735", "createdAt": "2020-09-28T09:01:49Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/src/test/projects/kjar-12-with-pmml-trusty/pom.xml", "diffHunk": "@@ -0,0 +1,56 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>org.kie</groupId>\n+  <artifactId>kie-maven-plugin-test-kjar-12</artifactId>\n+  <version>1.0.0.Final</version>\n+\n+  <packaging>kjar</packaging>\n+\n+  <properties>\n+    <org.kie.version>7.44.0-SNAPSHOT</org.kie.version>\n+    <generateModel>NO</generateModel>\n+    <generateDMNModel>NO</generateDMNModel>\n+    <generatePMMLModel>YES</generatePMMLModel>\n+    <maven.compiler.target>1.8</maven.compiler.target>\n+    <maven.compiler.source>1.8</maven.compiler.source>\n+  </properties>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-model-compiler</artifactId>\n+      <version>${org.kie.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-api</artifactId>\n+      <version>${org.kie.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-dependencies</artifactId>\n+      <version>${org.kie.version}</version>\n+      <type>pom</type>\n+    </dependency>\n+  </dependencies>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.kie</groupId>\n+        <artifactId>kie-maven-plugin</artifactId>\n+        <version>${org.kie.version}</version>\n+        <extensions>true</extensions>\n+        <configuration>\n+          <properties>\n+            <drools.dialect.java.compiler.lnglevel>1.8</drools.dialect.java.compiler.lnglevel>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODkwNzM4OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjowMjozN1rOHbHHIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjowMjozN1rOHbHHIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE5MDExNQ==", "bodyText": "Not used?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498190115", "createdAt": "2020-10-01T12:02:37Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODkzODE4OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoxMToyNFrOHbHZ4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoxMToyNFrOHbHZ4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE5NDkxMg==", "bodyText": "I think this can be removed after kiegroup/drools#3117", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498194912", "createdAt": "2020-10-01T12:11:24Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODk3MDYyOnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMDozNFrOHbHt-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMDozNFrOHbHt-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMDA1OA==", "bodyText": "Not sure if File.separator can be used here, probably is better to use /.\nAs far as I remember KieFileSystem only supports / so this code could fail on Windows where File.separator is usually \\.\n@mariofusco Wdyt?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498200058", "createdAt": "2020-10-01T12:20:34Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 172}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODk3NTU4OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMTo1MVrOHbHxAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMTo1MVrOHbHxAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMDgzNA==", "bodyText": "I think you can use getFilesByType method you created in AbstractKieMojo", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498200834", "createdAt": "2020-10-01T12:21:51Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));\n+            InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+            List<String> generatedFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"java\"))\n+                    .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 177}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODk3ODUxOnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMjozNlrOHbHyuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMjozNlrOHbHyuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMTI3NQ==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498201275", "createdAt": "2020-10-01T12:22:36Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));\n+            InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+            List<String> generatedFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"java\"))\n+                    .collect(Collectors.toList());\n+\n+            Set<String> drlFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"drl\"))\n+                    .collect(Collectors.toSet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 182}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODk4MDc2OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMzowOFrOHbHz_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMzowOFrOHbHz_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMTU5Nw==", "bodyText": "Please move it to constant", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498201597", "createdAt": "2020-10-01T12:23:08Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));\n+            InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+            List<String> generatedFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"java\"))\n+                    .collect(Collectors.toList());\n+\n+            Set<String> drlFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"drl\"))\n+                    .collect(Collectors.toSet());\n+\n+            getLog().info(String.format(\"Found %d generated files in Canonical Model\", generatedFiles.size()));\n+\n+            MemoryFileSystem mfs = kieModule instanceof CanonicalKieModule ?\n+                    ((MemoryKieModule) ((CanonicalKieModule) kieModule).getInternalKieModule()).getMemoryFileSystem() :\n+                    ((MemoryKieModule) kieModule).getMemoryFileSystem();\n+\n+            final String droolsModelCompilerPath = \"/generated-sources/drools-model-compiler/main/java\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 190}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODk4MzI2OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyMzo1MFrOHbH1dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoxODoxMlrOHdwdEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMTk3NQ==", "bodyText": "What if this path doesn't exist? Is it created on the fly or it fail?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498201975", "createdAt": "2020-10-01T12:23:50Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));\n+            InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+            List<String> generatedFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"java\"))\n+                    .collect(Collectors.toList());\n+\n+            Set<String> drlFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"drl\"))\n+                    .collect(Collectors.toSet());\n+\n+            getLog().info(String.format(\"Found %d generated files in Canonical Model\", generatedFiles.size()));\n+\n+            MemoryFileSystem mfs = kieModule instanceof CanonicalKieModule ?\n+                    ((MemoryKieModule) ((CanonicalKieModule) kieModule).getInternalKieModule()).getMemoryFileSystem() :\n+                    ((MemoryKieModule) kieModule).getMemoryFileSystem();\n+\n+            final String droolsModelCompilerPath = \"/generated-sources/drools-model-compiler/main/java\";\n+            final String newCompileSourceRoot = targetDirectory.getPath() + droolsModelCompilerPath;\n+            project.addCompileSourceRoot(newCompileSourceRoot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 192}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2NDYyNA==", "bodyText": "@danielezonca\nthat path is created later", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500964624", "createdAt": "2020-10-07T12:18:12Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));\n+            InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+            List<String> generatedFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"java\"))\n+                    .collect(Collectors.toList());\n+\n+            Set<String> drlFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"drl\"))\n+                    .collect(Collectors.toSet());\n+\n+            getLog().info(String.format(\"Found %d generated files in Canonical Model\", generatedFiles.size()));\n+\n+            MemoryFileSystem mfs = kieModule instanceof CanonicalKieModule ?\n+                    ((MemoryKieModule) ((CanonicalKieModule) kieModule).getInternalKieModule()).getMemoryFileSystem() :\n+                    ((MemoryKieModule) kieModule).getMemoryFileSystem();\n+\n+            final String droolsModelCompilerPath = \"/generated-sources/drools-model-compiler/main/java\";\n+            final String newCompileSourceRoot = targetDirectory.getPath() + droolsModelCompilerPath;\n+            project.addCompileSourceRoot(newCompileSourceRoot);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMTk3NQ=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 192}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODk5NTE2OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyNjo1MlrOHbH8lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoxOToxMFrOHdwfIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMzc5Ng==", "bodyText": "What about move this line inside finally block?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498203796", "createdAt": "2020-10-01T12:26:52Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));\n+            InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+            List<String> generatedFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"java\"))\n+                    .collect(Collectors.toList());\n+\n+            Set<String> drlFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"drl\"))\n+                    .collect(Collectors.toSet());\n+\n+            getLog().info(String.format(\"Found %d generated files in Canonical Model\", generatedFiles.size()));\n+\n+            MemoryFileSystem mfs = kieModule instanceof CanonicalKieModule ?\n+                    ((MemoryKieModule) ((CanonicalKieModule) kieModule).getInternalKieModule()).getMemoryFileSystem() :\n+                    ((MemoryKieModule) kieModule).getMemoryFileSystem();\n+\n+            final String droolsModelCompilerPath = \"/generated-sources/drools-model-compiler/main/java\";\n+            final String newCompileSourceRoot = targetDirectory.getPath() + droolsModelCompilerPath;\n+            project.addCompileSourceRoot(newCompileSourceRoot);\n+\n+            for (String generatedFile : generatedFiles) {\n+                final MemoryFile f = (MemoryFile) mfs.getFile(generatedFile);\n+                final Path newFile = Paths.get(targetDirectory.getPath(),\n+                                               droolsModelCompilerPath,\n+                                               f.getPath().toPortableString());\n+\n+                try {\n+                    Files.deleteIfExists(newFile);\n+                    Files.createDirectories(newFile.getParent());\n+                    Files.copy(f.getContents(), newFile, StandardCopyOption.REPLACE_EXISTING);\n+\n+                    getLog().info(\"Generating \" + newFile);\n+                } catch (IOException e) {\n+                    e.printStackTrace();\n+                    throw new MojoExecutionException(\"Unable to write file\", e);\n+                }\n+            }\n+\n+            // copy the META-INF packages file\n+            final String path = CanonicalKieModule.getModelFileWithGAV(kieModule.getReleaseId());\n+            final MemoryFile packagesMemoryFile = (MemoryFile) mfs.getFile(path);\n+            final String packagesMemoryFilePath = packagesMemoryFile.getFolder().getPath().toPortableString();\n+            final Path packagesDestinationPath = Paths.get(targetDirectory.getPath(), CLASSES, packagesMemoryFilePath, packagesMemoryFile.getName());\n+\n+            try {\n+                if (!Files.exists(packagesDestinationPath)) {\n+                    Files.createDirectories(packagesDestinationPath.getParent());\n+                }\n+                Files.copy(packagesMemoryFile.getContents(), packagesDestinationPath, StandardCopyOption.REPLACE_EXISTING);\n+            } catch (IOException e) {\n+                e.printStackTrace();\n+                throw new MojoExecutionException(\"Unable to write file\", e);\n+            }\n+\n+            if (ExecModelMode.shouldDeleteFile(generatePMMLModel)) {\n+                deleteDrlFiles(drlFiles);\n+            }\n+\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(contextClassLoader);\n+        }\n+        // REMOVING FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+        properties.remove(\"kie-maven-plugin-launcher\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 236}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2NTE1Mw==", "bodyText": "@danielezonca\nRemoved", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500965153", "createdAt": "2020-10-07T12:19:10Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        KieServices ks = KieServices.Factory.get();\n+        try {\n+            // FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+            properties.put(\"kie-maven-plugin-launcher\", \"true\");\n+            setSystemProperties(properties);\n+\n+            final KieBuilderImpl kieBuilder = (KieBuilderImpl) ks.newKieBuilder(projectDir);\n+            kieBuilder.setPomModel(new ProjectPomModel(mavenSession));\n+            String testPath = \"src\" + File.separator + \"test\" + File.separator + \"java\";\n+            String pmmlResourcePath = \"src\" + File.separator + \"main\" + File.separator + \"resources\" + File.separator + PMMLRESOURCES;\n+            kieBuilder.buildAll(ExecutableModelMavenProject.SUPPLIER,\n+                                s -> !s.contains(testPath) && !s.contains(pmmlResourcePath));\n+            InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+            List<String> generatedFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"java\"))\n+                    .collect(Collectors.toList());\n+\n+            Set<String> drlFiles = kieModule.getFileNames()\n+                    .stream()\n+                    .filter(f -> f.endsWith(\"drl\"))\n+                    .collect(Collectors.toSet());\n+\n+            getLog().info(String.format(\"Found %d generated files in Canonical Model\", generatedFiles.size()));\n+\n+            MemoryFileSystem mfs = kieModule instanceof CanonicalKieModule ?\n+                    ((MemoryKieModule) ((CanonicalKieModule) kieModule).getInternalKieModule()).getMemoryFileSystem() :\n+                    ((MemoryKieModule) kieModule).getMemoryFileSystem();\n+\n+            final String droolsModelCompilerPath = \"/generated-sources/drools-model-compiler/main/java\";\n+            final String newCompileSourceRoot = targetDirectory.getPath() + droolsModelCompilerPath;\n+            project.addCompileSourceRoot(newCompileSourceRoot);\n+\n+            for (String generatedFile : generatedFiles) {\n+                final MemoryFile f = (MemoryFile) mfs.getFile(generatedFile);\n+                final Path newFile = Paths.get(targetDirectory.getPath(),\n+                                               droolsModelCompilerPath,\n+                                               f.getPath().toPortableString());\n+\n+                try {\n+                    Files.deleteIfExists(newFile);\n+                    Files.createDirectories(newFile.getParent());\n+                    Files.copy(f.getContents(), newFile, StandardCopyOption.REPLACE_EXISTING);\n+\n+                    getLog().info(\"Generating \" + newFile);\n+                } catch (IOException e) {\n+                    e.printStackTrace();\n+                    throw new MojoExecutionException(\"Unable to write file\", e);\n+                }\n+            }\n+\n+            // copy the META-INF packages file\n+            final String path = CanonicalKieModule.getModelFileWithGAV(kieModule.getReleaseId());\n+            final MemoryFile packagesMemoryFile = (MemoryFile) mfs.getFile(path);\n+            final String packagesMemoryFilePath = packagesMemoryFile.getFolder().getPath().toPortableString();\n+            final Path packagesDestinationPath = Paths.get(targetDirectory.getPath(), CLASSES, packagesMemoryFilePath, packagesMemoryFile.getName());\n+\n+            try {\n+                if (!Files.exists(packagesDestinationPath)) {\n+                    Files.createDirectories(packagesDestinationPath.getParent());\n+                }\n+                Files.copy(packagesMemoryFile.getContents(), packagesDestinationPath, StandardCopyOption.REPLACE_EXISTING);\n+            } catch (IOException e) {\n+                e.printStackTrace();\n+                throw new MojoExecutionException(\"Unable to write file\", e);\n+            }\n+\n+            if (ExecModelMode.shouldDeleteFile(generatePMMLModel)) {\n+                deleteDrlFiles(drlFiles);\n+            }\n+\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(contextClassLoader);\n+        }\n+        // REMOVING FLAG TO KNOW THAT BUILD HAS BEEN LAUNCHED BY MAVEN\n+        properties.remove(\"kie-maven-plugin-launcher\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwMzc5Ng=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 236}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExOTAxMjE5OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjozMToxOVrOHbIHAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoyMDo0M1rOHdwi4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwNjQ2Ng==", "bodyText": "What about add a finally block to restore contextClassLoader?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498206466", "createdAt": "2020-10-01T12:31:19Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 159}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2NjExMg==", "bodyText": "@danielezonca\nMojoExecutionException completely interrupt plugin execution, killing any thread", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500966112", "createdAt": "2020-10-07T12:20:43Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (modelParameterEnabled && modelCompilerInClassPath) {\n+            generateModel();\n+        } else if (modelParameterEnabled) { // !modelCompilerInClassPath\n+            getLog().warn(\"You're trying to build rule assets in a project from an executable rule model, but you did not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable executable rule models for your project, add the `drools-model-compiler` dependency in the `pom.xml` file of your project.\\n\");\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+\n+            ClassLoader projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]),\n+                                                                        getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new RuntimeException(e);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwNjQ2Ng=="}, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 159}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE1NDEwOnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/BuildMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozNDowNVrOHbnRaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozNDowNVrOHbnRaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzAzNQ==", "bodyText": "Can you please review this boolean? I think it could be reverted", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498717035", "createdAt": "2020-10-02T09:34:05Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/BuildMojo.java", "diffHunk": "@@ -104,9 +104,14 @@\n     @Parameter(property = \"generateModel\", defaultValue = \"no\")\n     private String generateModel;\n \n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n     public void execute() throws MojoExecutionException, MojoFailureException {\n-        // BuildMojo is executed when GenerateModelMojo isn't and vice-versa\n+        // BuildMojo is executed when GenerateModelMojo and GeneratePMMLModelMojo aren't and vice-versa\n         boolean modelParameterEnabled = modelParameterEnabled(generateModel);\n+        modelParameterEnabled = modelParameterEnabled || PMMLModelMode.modelParameterEnabled(generatePMMLModel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE1NDcwOnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GenerateModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozNDoxNVrOHbnRyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozNDoxNVrOHbnRyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzEzMQ==", "bodyText": "Can you please review this boolean? I think it could be reverted", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498717131", "createdAt": "2020-10-02T09:34:15Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GenerateModelMojo.java", "diffHunk": "@@ -97,10 +97,14 @@\n     @Parameter(property = \"generateModel\", defaultValue = \"YES_WITHDRL\")\n     private String generateModel;\n \n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n     @Override\n     public void execute() throws MojoExecutionException, MojoFailureException {\n-        // GenerateModelMojo is executed when BuildMojo isn't and vice-versa\n+        // GenerateModelMojo is executed when BuildMojo and GeneratePMMLModelMojo aren't and vice-versa\n         boolean modelParameterEnabled = modelParameterEnabled(generateModel);\n+        modelParameterEnabled = modelParameterEnabled && !PMMLModelMode.modelParameterEnabled(generatePMMLModel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjE2MDU2OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozNjozNFrOHbnVxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwOTozNjozNFrOHbnVxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxODE1MA==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r498718150", "createdAt": "2020-10-02T09:36:34Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,322 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.FileVisitResult;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.SimpleFileVisitor;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.BasicFileAttributes;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.compiler.io.Folder;\n+import org.drools.compiler.compiler.io.memory.MemoryFile;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kie.builder.impl.KieModuleKieProject;\n+import org.drools.compiler.kie.builder.impl.MemoryKieModule;\n+import org.drools.compiler.kie.builder.impl.ResultsImpl;\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.drools.modelcompiler.CanonicalKieModule;\n+import org.drools.modelcompiler.builder.CanonicalModelKieProject;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.ModelWriter;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.internal.io.ResourceTypePackage;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLFactoryModel;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final String KMODULE_XML_TEMPLATE = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\r\\n\" +\n+            \"<kmodule xmlns=\\\"http://jboss.org/kie/6.0.0/kmodule\\\">\\r\\n\" +\n+            \"\\r\\n%s\\r\\n\" +\n+            \"</kmodule>\";\n+    private static final String KBASE_TAG_TEMPLATE = \"\\t<kbase name=\\\"%s\\\" packages=\\\"%s\\\">\\r\\n\" + // defaulting that all pmml files have to be put inside PMMLResources folder\n+            \"\\t\\t<ksession name=\\\"%sSession\\\" type=\\\"stateless\\\" />\\r\\n\" +\n+            \"\\t</kbase>\\r\\n\";\n+    private static final String CLASSES = \"classes\";\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+\n+    @Parameter\n+    private Map<String, String> properties;\n+\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+\n+    @Parameter(property = \"generatePMMLModel\", defaultValue = \"no\")\n+    private String generatePMMLModel;\n+\n+    private List<Path> createdPaths = new ArrayList<>();\n+    private List<Path> movedPmmlFiles = new ArrayList<>();\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        // GeneratePMMLModelMojo is executed when BuildMojo and GenerateModelMojo aren't and vice-versa\n+        boolean modelParameterEnabled = PMMLModelMode.modelParameterEnabled(generatePMMLModel);\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "831831edb63582dcbda256336645501f8c681bfe"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMjAzMTQ4OnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/pom.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMTo1OTo1MVrOHdC3qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoyMTozMFrOHdwk1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIxNzc2OA==", "bodyText": "Please remove this or add comment with description.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500217768", "createdAt": "2020-10-06T11:59:51Z", "author": {"login": "jiripetrlik"}, "path": "kie-plugins-testing/pom.xml", "diffHunk": "@@ -171,9 +184,29 @@\n       <artifactId>drools-scorecards</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+<!--    <dependency>-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "355db707b01d973058b3232c4a5030eaa0020cae"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2NjYxMw==", "bodyText": "@jiripetrlik\ndone", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500966613", "createdAt": "2020-10-07T12:21:30Z", "author": {"login": "gitgabrio"}, "path": "kie-plugins-testing/pom.xml", "diffHunk": "@@ -171,9 +184,29 @@\n       <artifactId>drools-scorecards</artifactId>\n       <scope>runtime</scope>\n     </dependency>\n+<!--    <dependency>-->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIxNzc2OA=="}, "originalCommit": {"oid": "355db707b01d973058b3232c4a5030eaa0020cae"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzI2MzMyOnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTo1NTowNVrOHdOwXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwNzo0OTo1NFrOHdmzYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMjUwOQ==", "bodyText": "Minor comment, it should be possible avoid to iterate multiple times on the resources:\n\npreserve here Stream<PMMLResource>\nmake generateFile returns a Stream<GeneratedFile>\nfinally apply a foreach(...) to write them (line 171)\n\nMaybe the last step is not doable because of checked exception", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500412509", "createdAt": "2020-10-06T15:55:05Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(GeneratePMMLModelMojo.class);\n+\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    private static final PMMLAssemblerService PMML_ASSEMBLER_SERVICE = new PMMLAssemblerService();\n+    private static final String generatedSourcesPath = \"/generated-sources/\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+    @Parameter\n+    private Map<String, String> properties;\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+    @Parameter(defaultValue = \"${project.resources}\", required = true, readonly = true)\n+    private List<org.apache.maven.model.Resource> resourcesDirectories;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (!modelCompilerInClassPath) {\n+            getLog().warn(\"Skipping `generatePMMLModel` because you did\" +\n+                                  \" not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable it for your project, add the `drools-model-compiler`\" +\n+                                  \" dependency in the `pom.xml` file of your project.\\n\");\n+        } else {\n+            generateModel();\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        URLClassLoader projectClassLoader = null;\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+            projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]), getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+            generateFiles();\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new MojoExecutionException(e.getMessage(), e);\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(contextClassLoader);\n+            if (projectClassLoader != null) {\n+                try {\n+                    projectClassLoader.close();\n+                } catch (IOException e) {\n+                    getLog().warn(e);\n+                }\n+            }\n+        }\n+        getLog().info(\"PMML model successfully generated\");\n+    }\n+\n+    private void generateFiles() throws MojoExecutionException {\n+        final List<Resource> resources = getPMMLResources();\n+        final List<PMMLResource> pmmlResources = resources.stream()\n+                .map(this::parseResource)\n+                .collect(toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 161}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDgwNjQ5Nw==", "bodyText": "@danielezonca\ndone.\nI've refactored called methods to throw RuntimeException. Then in the calling one I'm catching all Exception and rethrowing a MojoExecutionException", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500806497", "createdAt": "2020-10-07T07:49:54Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(GeneratePMMLModelMojo.class);\n+\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    private static final PMMLAssemblerService PMML_ASSEMBLER_SERVICE = new PMMLAssemblerService();\n+    private static final String generatedSourcesPath = \"/generated-sources/\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+    @Parameter\n+    private Map<String, String> properties;\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+    @Parameter(defaultValue = \"${project.resources}\", required = true, readonly = true)\n+    private List<org.apache.maven.model.Resource> resourcesDirectories;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (!modelCompilerInClassPath) {\n+            getLog().warn(\"Skipping `generatePMMLModel` because you did\" +\n+                                  \" not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable it for your project, add the `drools-model-compiler`\" +\n+                                  \" dependency in the `pom.xml` file of your project.\\n\");\n+        } else {\n+            generateModel();\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        URLClassLoader projectClassLoader = null;\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+            projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]), getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+            generateFiles();\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new MojoExecutionException(e.getMessage(), e);\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(contextClassLoader);\n+            if (projectClassLoader != null) {\n+                try {\n+                    projectClassLoader.close();\n+                } catch (IOException e) {\n+                    getLog().warn(e);\n+                }\n+            }\n+        }\n+        getLog().info(\"PMML model successfully generated\");\n+    }\n+\n+    private void generateFiles() throws MojoExecutionException {\n+        final List<Resource> resources = getPMMLResources();\n+        final List<PMMLResource> pmmlResources = resources.stream()\n+                .map(this::parseResource)\n+                .collect(toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMjUwOQ=="}, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 161}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzI2NzUxOnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTo1NTo1OVrOHdOy8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwNzo0ODozMVrOHdmwQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMzE2OQ==", "bodyText": "I would prefer for simplicity to make generateFile return the list instead of populate generatedFiles as parameter. Wdyt?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500413169", "createdAt": "2020-10-06T15:55:59Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(GeneratePMMLModelMojo.class);\n+\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    private static final PMMLAssemblerService PMML_ASSEMBLER_SERVICE = new PMMLAssemblerService();\n+    private static final String generatedSourcesPath = \"/generated-sources/\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+    @Parameter\n+    private Map<String, String> properties;\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+    @Parameter(defaultValue = \"${project.resources}\", required = true, readonly = true)\n+    private List<org.apache.maven.model.Resource> resourcesDirectories;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (!modelCompilerInClassPath) {\n+            getLog().warn(\"Skipping `generatePMMLModel` because you did\" +\n+                                  \" not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable it for your project, add the `drools-model-compiler`\" +\n+                                  \" dependency in the `pom.xml` file of your project.\\n\");\n+        } else {\n+            generateModel();\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        URLClassLoader projectClassLoader = null;\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+            projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]), getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+            generateFiles();\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new MojoExecutionException(e.getMessage(), e);\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(contextClassLoader);\n+            if (projectClassLoader != null) {\n+                try {\n+                    projectClassLoader.close();\n+                } catch (IOException e) {\n+                    getLog().warn(e);\n+                }\n+            }\n+        }\n+        getLog().info(\"PMML model successfully generated\");\n+    }\n+\n+    private void generateFiles() throws MojoExecutionException {\n+        final List<Resource> resources = getPMMLResources();\n+        final List<PMMLResource> pmmlResources = resources.stream()\n+                .map(this::parseResource)\n+                .collect(toList());\n+        final List<GeneratedFile> generatedFiles = new ArrayList<>();\n+        generateFile(pmmlResources, generatedFiles);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 163}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDgwNTY5OQ==", "bodyText": "@danielezonca\ndone", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500805699", "createdAt": "2020-10-07T07:48:31Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(GeneratePMMLModelMojo.class);\n+\n+    private static final String PMMLRESOURCES = \"PMMLResources\";\n+    private static final String PMML = \"pmml\";\n+    private static final PMMLAssemblerService PMML_ASSEMBLER_SERVICE = new PMMLAssemblerService();\n+    private static final String generatedSourcesPath = \"/generated-sources/\";\n+    public static PathMatcher drlFileMatcher = FileSystems.getDefault().getPathMatcher(\"glob:**.drl\");\n+    @Parameter(defaultValue = \"${session}\", required = true, readonly = true)\n+    private MavenSession mavenSession;\n+    @Parameter(required = true, defaultValue = \"${project.build.directory}\")\n+    private File targetDirectory;\n+    @Parameter(required = true, defaultValue = \"${project.basedir}\")\n+    private File projectDir;\n+    @Parameter(required = true, defaultValue = \"${project.build.testSourceDirectory}\")\n+    private File testDir;\n+    @Parameter\n+    private Map<String, String> properties;\n+    @Parameter(required = true, defaultValue = \"${project}\")\n+    private MavenProject project;\n+    @Parameter(required = true, defaultValue = \"${project.build.outputDirectory}\")\n+    private File outputDirectory;\n+    @Parameter(defaultValue = \"${project.resources}\", required = true, readonly = true)\n+    private List<org.apache.maven.model.Resource> resourcesDirectories;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        boolean modelCompilerInClassPath = isModelCompilerInClassPath(project.getDependencies());\n+        if (!modelCompilerInClassPath) {\n+            getLog().warn(\"Skipping `generatePMMLModel` because you did\" +\n+                                  \" not provide the required dependency on the project classpath.\\n\" +\n+                                  \"To enable it for your project, add the `drools-model-compiler`\" +\n+                                  \" dependency in the `pom.xml` file of your project.\\n\");\n+        } else {\n+            generateModel();\n+        }\n+    }\n+\n+    private void generateModel() throws MojoExecutionException {\n+        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();\n+        URLClassLoader projectClassLoader = null;\n+        try {\n+            Set<URL> urls = new HashSet<>();\n+            for (String element : project.getCompileClasspathElements()) {\n+                urls.add(new File(element).toURI().toURL());\n+            }\n+\n+            project.setArtifactFilter(new CumulativeScopeArtifactFilter(Arrays.asList(\"compile\",\n+                                                                                      \"runtime\")));\n+            for (Artifact artifact : project.getArtifacts()) {\n+                File file = artifact.getFile();\n+                if (file != null) {\n+                    urls.add(file.toURI().toURL());\n+                }\n+            }\n+            urls.add(outputDirectory.toURI().toURL());\n+            projectClassLoader = URLClassLoader.newInstance(urls.toArray(new URL[0]), getClass().getClassLoader());\n+            Thread.currentThread().setContextClassLoader(projectClassLoader);\n+            generateFiles();\n+        } catch (DependencyResolutionRequiredException | MalformedURLException e) {\n+            throw new MojoExecutionException(e.getMessage(), e);\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(contextClassLoader);\n+            if (projectClassLoader != null) {\n+                try {\n+                    projectClassLoader.close();\n+                } catch (IOException e) {\n+                    getLog().warn(e);\n+                }\n+            }\n+        }\n+        getLog().info(\"PMML model successfully generated\");\n+    }\n+\n+    private void generateFiles() throws MojoExecutionException {\n+        final List<Resource> resources = getPMMLResources();\n+        final List<PMMLResource> pmmlResources = resources.stream()\n+                .map(this::parseResource)\n+                .collect(toList());\n+        final List<GeneratedFile> generatedFiles = new ArrayList<>();\n+        generateFile(pmmlResources, generatedFiles);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMzE2OQ=="}, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 163}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzI5NzQ5OnYy", "diffSide": "RIGHT", "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjowMjo1MVrOHdPF-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjozOTozN1rOHdxQ5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODA0MQ==", "bodyText": "Most of the code in this class is sort of copied in kogito-runtimes ( https://github.com/kiegroup/kogito-runtimes/blob/master/kogito-codegen/src/main/java/org/kie/kogito/codegen/prediction/PredictionCodegen.java ).\nDo you think it is possible to refactor it in a common class inside drools repo. Fine for me to consider a new ticket for that of course.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500418041", "createdAt": "2020-10-06T16:02:51Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc4ODU4Mg==", "bodyText": "@danielezonca\nIt is already in my plan. I've already began to move some common class (PMMLResource) in drools repo in another PR. Can't do complete refactor right now.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500788582", "createdAt": "2020-10-07T07:18:06Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODA0MQ=="}, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDgxMjEyNQ==", "bodyText": "Do you have a ticket for this?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500812125", "createdAt": "2020-10-07T07:59:01Z", "author": {"login": "danielezonca"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODA0MQ=="}, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3Nzg5NA==", "bodyText": "@danielezonca\nhttps://issues.redhat.com/browse/DROOLS-5703 - see my previous comment", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r500977894", "createdAt": "2020-10-07T12:39:37Z", "author": {"login": "gitgabrio"}, "path": "kie-maven-plugin/src/main/java/org/kie/maven/plugin/GeneratePMMLModelMojo.java", "diffHunk": "@@ -0,0 +1,326 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.maven.plugin;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.FileSystems;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.PathMatcher;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.artifact.DependencyResolutionRequiredException;\n+import org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\n+import org.apache.maven.execution.MavenSession;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderConfigurationImpl;\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.compiler.compiler.DroolsError;\n+import org.drools.compiler.kie.builder.impl.KieBuilderImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.compiler.lang.descr.PackageDescr;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.impl.KnowledgeBaseImpl;\n+import org.drools.core.io.impl.DescrResource;\n+import org.drools.core.io.impl.FileSystemResource;\n+import org.drools.modelcompiler.builder.GeneratedFile;\n+import org.drools.modelcompiler.builder.ModelBuilderImpl;\n+import org.drools.modelcompiler.builder.PackageSources;\n+import org.kie.api.KieServices;\n+import org.kie.api.io.Resource;\n+import org.kie.api.io.ResourceType;\n+import org.kie.internal.builder.CompositeKnowledgeBuilder;\n+import org.kie.pmml.commons.model.HasNestedModels;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.assembler.service.PMMLAssemblerService;\n+import org.kie.pmml.models.drools.commons.model.KiePMMLDroolsModelWithSources;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.kie.maven.plugin.ExecModelMode.isModelCompilerInClassPath;\n+import static org.kie.pmml.evaluator.assembler.service.PMMLCompilerService.getKiePMMLModelsFromResourceFromPlugin;\n+\n+@Mojo(name = \"generatePMMLModel\",\n+        requiresDependencyResolution = ResolutionScope.NONE,\n+        requiresProject = true,\n+        defaultPhase = LifecyclePhase.COMPILE)\n+public class GeneratePMMLModelMojo extends AbstractKieMojo {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODA0MQ=="}, "originalCommit": {"oid": "e8e13dcff72b36db77afea0d8d652886b5076aae"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQzNDM1OnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODowNjo1MlrOHeSsqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoxNzoxN1rOHeTE8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNTY3Mw==", "bodyText": "Is it possible to replace these lines with a computeIfAbsent?\nUsing ConcurrentHashMap the whole method is performed atomically to be thread safe", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r501525673", "createdAt": "2020-10-08T08:06:52Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "diffHunk": "@@ -54,20 +59,39 @@ protected void restoreKiePom(String projectName) throws Exception {\n     }\n \n     protected MavenExecutionResult buildKJarProject(String kjarName, String[] options, String... mavenGoals) throws Exception {\n+        logger.info(\"buildKJarProject {} {} {}\", kjarName, options, mavenGoals);\n         final MavenRuntime mavenRuntime = mavenRuntimeBuilder\n                 .forkedBuilder()\n                 // To enable logging using slf4j-simple on the internal classes of the plug-in:\n                 //.withCliOptions(\"-Dorg.slf4j.simpleLogger.defaultLogLevel=debug\")\n                 .withEnvironment(System.getenv())\n                 .withCliOptions(options)\n                 .build();\n+        StringBuilder builder = new StringBuilder();\n+        builder.append(kjarName).append(\"_\");\n+        builder.append(mavenRuntime.getMavenVersion()).append(\"_\");\n+        for (String option : options) {\n+            builder.append(option).append(\"_\");\n+        }\n+        for (String mavenGoal : mavenGoals) {\n+            builder.append(mavenGoal).append(\"_\");\n+        }\n+        final String key = builder.toString();\n+        if (!BUILT_MAP.containsKey(key)) {\n+            BUILT_MAP.put(key, getMavenExecutionResult(kjarName, mavenRuntime, mavenGoals));\n+        }\n+        return BUILT_MAP.get(key);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2504dd0c990cf82990807553cea6f03555ebcd1d"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMTg5MQ==", "bodyText": "@danielezonca\nDone", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r501531891", "createdAt": "2020-10-08T08:17:17Z", "author": {"login": "gitgabrio"}, "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "diffHunk": "@@ -54,20 +59,39 @@ protected void restoreKiePom(String projectName) throws Exception {\n     }\n \n     protected MavenExecutionResult buildKJarProject(String kjarName, String[] options, String... mavenGoals) throws Exception {\n+        logger.info(\"buildKJarProject {} {} {}\", kjarName, options, mavenGoals);\n         final MavenRuntime mavenRuntime = mavenRuntimeBuilder\n                 .forkedBuilder()\n                 // To enable logging using slf4j-simple on the internal classes of the plug-in:\n                 //.withCliOptions(\"-Dorg.slf4j.simpleLogger.defaultLogLevel=debug\")\n                 .withEnvironment(System.getenv())\n                 .withCliOptions(options)\n                 .build();\n+        StringBuilder builder = new StringBuilder();\n+        builder.append(kjarName).append(\"_\");\n+        builder.append(mavenRuntime.getMavenVersion()).append(\"_\");\n+        for (String option : options) {\n+            builder.append(option).append(\"_\");\n+        }\n+        for (String mavenGoal : mavenGoals) {\n+            builder.append(mavenGoal).append(\"_\");\n+        }\n+        final String key = builder.toString();\n+        if (!BUILT_MAP.containsKey(key)) {\n+            BUILT_MAP.put(key, getMavenExecutionResult(kjarName, mavenRuntime, mavenGoals));\n+        }\n+        return BUILT_MAP.get(key);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNTY3Mw=="}, "originalCommit": {"oid": "2504dd0c990cf82990807553cea6f03555ebcd1d"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQ0OTUxOnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoxMDo0NFrOHeS1vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODozNDo0M1rOHeTvLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNzk5OQ==", "bodyText": "Is it possible to move this code inside the if block to avoid to initialize the runtime if the value is already available?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r501527999", "createdAt": "2020-10-08T08:10:44Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "diffHunk": "@@ -54,20 +59,39 @@ protected void restoreKiePom(String projectName) throws Exception {\n     }\n \n     protected MavenExecutionResult buildKJarProject(String kjarName, String[] options, String... mavenGoals) throws Exception {\n+        logger.info(\"buildKJarProject {} {} {}\", kjarName, options, mavenGoals);\n         final MavenRuntime mavenRuntime = mavenRuntimeBuilder", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2504dd0c990cf82990807553cea6f03555ebcd1d"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU0MjcwMg==", "bodyText": "@danielezonca\nNope", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r501542702", "createdAt": "2020-10-08T08:34:43Z", "author": {"login": "gitgabrio"}, "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "diffHunk": "@@ -54,20 +59,39 @@ protected void restoreKiePom(String projectName) throws Exception {\n     }\n \n     protected MavenExecutionResult buildKJarProject(String kjarName, String[] options, String... mavenGoals) throws Exception {\n+        logger.info(\"buildKJarProject {} {} {}\", kjarName, options, mavenGoals);\n         final MavenRuntime mavenRuntime = mavenRuntimeBuilder", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNzk5OQ=="}, "originalCommit": {"oid": "2504dd0c990cf82990807553cea6f03555ebcd1d"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDQ2NTk2OnYy", "diffSide": "RIGHT", "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODoxNTowNVrOHeS_-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo1MjozM1rOHeUb1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMDYxOQ==", "bodyText": "Can you add a log line here?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r501530619", "createdAt": "2020-10-08T08:15:05Z", "author": {"login": "danielezonca"}, "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "diffHunk": "@@ -54,20 +59,39 @@ protected void restoreKiePom(String projectName) throws Exception {\n     }\n \n     protected MavenExecutionResult buildKJarProject(String kjarName, String[] options, String... mavenGoals) throws Exception {\n+        logger.info(\"buildKJarProject {} {} {}\", kjarName, options, mavenGoals);\n         final MavenRuntime mavenRuntime = mavenRuntimeBuilder\n                 .forkedBuilder()\n                 // To enable logging using slf4j-simple on the internal classes of the plug-in:\n                 //.withCliOptions(\"-Dorg.slf4j.simpleLogger.defaultLogLevel=debug\")\n                 .withEnvironment(System.getenv())\n                 .withCliOptions(options)\n                 .build();\n+        StringBuilder builder = new StringBuilder();\n+        builder.append(kjarName).append(\"_\");\n+        builder.append(mavenRuntime.getMavenVersion()).append(\"_\");\n+        for (String option : options) {\n+            builder.append(option).append(\"_\");\n+        }\n+        for (String mavenGoal : mavenGoals) {\n+            builder.append(mavenGoal).append(\"_\");\n+        }\n+        final String key = builder.toString();\n+        if (!BUILT_MAP.containsKey(key)) {\n+            BUILT_MAP.put(key, getMavenExecutionResult(kjarName, mavenRuntime, mavenGoals));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2504dd0c990cf82990807553cea6f03555ebcd1d"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1NDEzNA==", "bodyText": "@danielezonca\ndone", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2251#discussion_r501554134", "createdAt": "2020-10-08T08:52:33Z", "author": {"login": "gitgabrio"}, "path": "kie-plugins-testing/src/test/java/org/kie/maven/plugin/KieMavenPluginBaseIntegrationTest.java", "diffHunk": "@@ -54,20 +59,39 @@ protected void restoreKiePom(String projectName) throws Exception {\n     }\n \n     protected MavenExecutionResult buildKJarProject(String kjarName, String[] options, String... mavenGoals) throws Exception {\n+        logger.info(\"buildKJarProject {} {} {}\", kjarName, options, mavenGoals);\n         final MavenRuntime mavenRuntime = mavenRuntimeBuilder\n                 .forkedBuilder()\n                 // To enable logging using slf4j-simple on the internal classes of the plug-in:\n                 //.withCliOptions(\"-Dorg.slf4j.simpleLogger.defaultLogLevel=debug\")\n                 .withEnvironment(System.getenv())\n                 .withCliOptions(options)\n                 .build();\n+        StringBuilder builder = new StringBuilder();\n+        builder.append(kjarName).append(\"_\");\n+        builder.append(mavenRuntime.getMavenVersion()).append(\"_\");\n+        for (String option : options) {\n+            builder.append(option).append(\"_\");\n+        }\n+        for (String mavenGoal : mavenGoals) {\n+            builder.append(mavenGoal).append(\"_\");\n+        }\n+        final String key = builder.toString();\n+        if (!BUILT_MAP.containsKey(key)) {\n+            BUILT_MAP.put(key, getMavenExecutionResult(kjarName, mavenRuntime, mavenGoals));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMDYxOQ=="}, "originalCommit": {"oid": "2504dd0c990cf82990807553cea6f03555ebcd1d"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1944, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}