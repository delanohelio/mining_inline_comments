{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NzE3NDE3", "number": 2019, "title": "Refactor KJar builds for Kie server tests to use installed Maven binary", "bodyText": "Signed-off-by: Karel Suta ksuta@redhat.com\nThe purpose is to get rid of MavenCLI which brings undesired undeclared dependencies like Xerces, causing issues like #2014 (comment)", "createdAt": "2020-02-18T16:34:03Z", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019", "merged": true, "mergeCommit": {"oid": "1351e1d55e06d288c7a051b73a6b5c807b57a1d5"}, "closed": true, "closedAt": "2020-02-19T12:40:26Z", "author": {"login": "sutaakar"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFkkMQgH2gAyMzc2NzE3NDE3OmE4OTY4MjhiYzE1ZjZmNDUwNDVhNGY2MjlhZDVlZTIxMWRjY2YwMWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF12g8gFqTM2MTA3Njk1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f", "author": {"user": {"login": "sutaakar", "name": "Karel Suta"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/a896828bc15f6f45045a4f629ad5ee211dccf01f", "committedDate": "2020-02-18T16:31:49Z", "message": "Refactor KJar builds for Kie server tests to use installed Maven binary\n\nSigned-off-by: Karel Suta <ksuta@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDk3MTk0", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-360497194", "createdAt": "2020-02-18T16:42:53Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjIxNDI2", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-360621426", "createdAt": "2020-02-18T19:43:34Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxOTo0MzozNFrOFrP8Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxOTo0NDoxNVrOFrP9pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg5NDI2Mw==", "bodyText": "I usually have problem with embedded maven not showing error messages.\nCan this --quiet worsen the situation?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#discussion_r380894263", "createdAt": "2020-02-18T19:43:34Z", "author": {"login": "lucamolteni"}, "path": "kie-server-parent/kie-server-tests/kie-server-integ-tests-common/src/main/java/org/kie/server/integrationtests/shared/KieServerDeployer.java", "diffHunk": "@@ -61,24 +62,19 @@ public static void buildAndDeployMavenProjectFromResource(String resourcePath) {\n     }\n \n     public static void buildAndDeployMavenProject(String basedir) {\n-        // need to backup (and later restore) the current class loader, because the Maven/Plexus does some classloader\n-        // magic which then results in CNFE in RestEasy client\n         // run the Maven build which will create the kjar. The kjar is then either installed or deployed to local and\n         // remote repo\n         logger.debug(\"Building and deploying Maven project from basedir '{}'.\", basedir);\n-        ClassLoader classLoaderBak = Thread.currentThread().getContextClassLoader();\n-        System.setProperty(\"maven.multiModuleProjectDirectory\", basedir); // required by MavenCli 3.3.0+\n-        MavenCli cli = new MavenCli();\n         List<String> mvnArgs;\n         if (TestConfig.isLocalServer()) {\n             // just install into local repository when running the local server. Deploying to remote repo will fail\n             // if the repo does not exist.\n \n             // wrapping explicitly in ArrayList as we may need to update the list later (and Arrays.toList() returns\n             // just read-only list)\n-            mvnArgs = new ArrayList<String>(Arrays.asList(\"-B\", \"clean\", \"install\"));\n+            mvnArgs = new ArrayList<>(Arrays.asList(\"mvn\", \"--quiet\", \"clean\", \"install\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg5NDYyOQ==", "bodyText": "We need some better error messages here. This one is too generic and when it occured to me I had to debug to discover the real cause", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#discussion_r380894629", "createdAt": "2020-02-18T19:44:15Z", "author": {"login": "lucamolteni"}, "path": "kie-server-parent/kie-server-tests/kie-server-integ-tests-common/src/main/java/org/kie/server/integrationtests/shared/KieServerDeployer.java", "diffHunk": "@@ -87,13 +83,15 @@ public static void buildAndDeployMavenProject(String basedir) {\n             mvnArgs.add(\"-s\");\n             mvnArgs.add(kjarsBuildSettingsXml);\n         }\n-        int mvnRunResult = cli.doMain(mvnArgs.toArray(new String[mvnArgs.size()]), basedir, System.out, System.err);\n \n-        Thread.currentThread().setContextClassLoader(classLoaderBak);\n+        // Execute the Maven build using installed Maven binary\n+        try (ProcessExecutor executor = new ProcessExecutor()) {\n+            String command = mvnArgs.stream().collect(Collectors.joining(\" \"));\n+            boolean executionSuccessful = executor.executeProcessCommand(command, Paths.get(basedir));\n \n-        if (mvnRunResult != 0) {\n-            throw new RuntimeException(\"Error while building Maven project from basedir \" + basedir +\n-                    \". Return code=\" + mvnRunResult);\n+            if (!executionSuccessful) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTAzODU3", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-360903857", "createdAt": "2020-02-19T08:02:18Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTIzNDEz", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-360923413", "createdAt": "2020-02-19T08:39:09Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTYyMzI2", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-360962326", "createdAt": "2020-02-19T09:38:28Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTYzMTMx", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-360963131", "createdAt": "2020-02-19T09:39:30Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMDYzODg4", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-361063888", "createdAt": "2020-02-19T12:17:32Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMDc2OTUw", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2019#pullrequestreview-361076950", "createdAt": "2020-02-19T12:40:13Z", "commit": {"oid": "a896828bc15f6f45045a4f629ad5ee211dccf01f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1349, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}