{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NjU4Njk1", "number": 2322, "title": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events", "bodyText": "Modifying kafka server extension to publish events\nJIRA:\nJBPM-9474\ndepends on:\nkiegroup/droolsjbpm-knowledge#486\nkiegroup/jbpm#1808\nkiegroup/drools#3264", "createdAt": "2020-11-24T17:55:10Z", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322", "merged": true, "mergeCommit": {"oid": "6bbd74ef8781cd69cee447f48a05d1dfdda35cde"}, "closed": true, "closedAt": "2020-12-04T08:00:08Z", "author": {"login": "fjtirado"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfumawgBqjQwMzQzOTczMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdizC5bgFqTU0NDcyNzczMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66450f2f47637d8db27444185b36aa7c3e3ecf43", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/66450f2f47637d8db27444185b36aa7c3e3ecf43", "committedDate": "2020-11-24T17:53:42Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "fcd6193c60b55fdbf5f762b7cddcc662720e48e0", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/fcd6193c60b55fdbf5f762b7cddcc662720e48e0", "committedDate": "2020-11-24T19:06:17Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fcd6193c60b55fdbf5f762b7cddcc662720e48e0", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/fcd6193c60b55fdbf5f762b7cddcc662720e48e0", "committedDate": "2020-11-24T19:06:17Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "088f324ef5d82fbda56b5cd488bc9f933805ac6f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/088f324ef5d82fbda56b5cd488bc9f933805ac6f", "committedDate": "2020-11-25T16:34:11Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "088f324ef5d82fbda56b5cd488bc9f933805ac6f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/088f324ef5d82fbda56b5cd488bc9f933805ac6f", "committedDate": "2020-11-25T16:34:11Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "6a158d3e12234f5a773ad206c16436feddbf2796", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/6a158d3e12234f5a773ad206c16436feddbf2796", "committedDate": "2020-11-25T17:48:04Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a158d3e12234f5a773ad206c16436feddbf2796", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/6a158d3e12234f5a773ad206c16436feddbf2796", "committedDate": "2020-11-25T17:48:04Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "8474534fe94b7e06b96e880b69f02b4b10bbce3b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/8474534fe94b7e06b96e880b69f02b4b10bbce3b", "committedDate": "2020-11-25T19:28:27Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTAyODIw", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#pullrequestreview-539102820", "createdAt": "2020-11-26T08:48:45Z", "commit": {"oid": "8474534fe94b7e06b96e880b69f02b4b10bbce3b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwODo0ODo0NVrOH6RQEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwOTowNjowMFrOH6R6Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg2MjA5Ng==", "bodyText": "Could you add a system property for \"max.block.ms\" (similar than in the Kafka Emitter) with 2000 ms as default value?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r530862096", "createdAt": "2020-11-26T08:48:45Z", "author": {"login": "gmunozfe"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -180,13 +199,30 @@ public void destroy(KieServerImpl kieServer, KieServerRegistry registry) {\n         return new KafkaConsumer<>(props, new StringDeserializer(), new ByteArrayDeserializer());\n     }\n \n+    protected Producer<String, byte[]> getKafkaProducer() {\n+        Map<String, Object> configs = new HashMap<>();\n+        configs.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, System.getProperty(\n+                KAFKA_EXTENSION_PREFIX + \"boopstrap.servers\", \"localhost:9092\"));\n+        String acks = System.getProperty(KAFKA_EXTENSION_PREFIX + \"acks\");\n+        if (acks != null) {\n+            configs.put(ProducerConfig.ACKS_CONFIG, acks);\n+        }\n+        String clientId = System.getProperty(KAFKA_EXTENSION_PREFIX + \"client.id\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8474534fe94b7e06b96e880b69f02b4b10bbce3b"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg2NjUwNQ==", "bodyText": "Shouldn't producer be closed here too if producerReady is true?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r530866505", "createdAt": "2020-11-26T08:55:50Z", "author": {"login": "gmunozfe"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -180,13 +199,30 @@ public void destroy(KieServerImpl kieServer, KieServerRegistry registry) {\n         return new KafkaConsumer<>(props, new StringDeserializer(), new ByteArrayDeserializer());\n     }\n \n+    protected Producer<String, byte[]> getKafkaProducer() {\n+        Map<String, Object> configs = new HashMap<>();\n+        configs.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, System.getProperty(\n+                KAFKA_EXTENSION_PREFIX + \"boopstrap.servers\", \"localhost:9092\"));\n+        String acks = System.getProperty(KAFKA_EXTENSION_PREFIX + \"acks\");\n+        if (acks != null) {\n+            configs.put(ProducerConfig.ACKS_CONFIG, acks);\n+        }\n+        String clientId = System.getProperty(KAFKA_EXTENSION_PREFIX + \"client.id\");\n+        if (clientId != null) {\n+            configs.put(ProducerConfig.CLIENT_ID_CONFIG, clientId);\n+        }\n+        return new KafkaProducer<>(configs, new StringSerializer(), new ByteArraySerializer());\n+    }\n+\n     @Override\n     public void onDeploy(DeploymentEvent event) {\n+        processService.addProcessEventListener(event.getDeploymentId(), this);\n         updateRegistration(event, this::updateTopics);\n     }\n \n     @Override\n     public void onUnDeploy(DeploymentEvent event) {\n+        processService.removeProcessEventListener(event.getDeploymentId(), this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8474534fe94b7e06b96e880b69f02b4b10bbce3b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg3Mjg5NA==", "bodyText": "In this method, T is not used, you can remove the generics\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static <T extends SignalDescBase> String topicFromSignal(String name) {\n          \n          \n            \n                private static String topicFromSignal(String name) {", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r530872894", "createdAt": "2020-11-26T09:06:00Z", "author": {"login": "gmunozfe"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -301,18 +339,13 @@ private void unsubscribe() {\n     }\n \n     private static <T extends SignalDescBase> String topicFromSignal(T signal) {\n-        return System.getProperty(TOPIC_PREFIX + signal.getName(), signal.getName());\n+        return topicFromSignal(signal.getName());\n     }\n-\n-    @Override\n-    public void serverStarted() {\n-        // will use lazy initialization for consumer\n+    \n+    private static <T extends SignalDescBase> String topicFromSignal(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8474534fe94b7e06b96e880b69f02b4b10bbce3b"}, "originalPosition": 116}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8474534fe94b7e06b96e880b69f02b4b10bbce3b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/8474534fe94b7e06b96e880b69f02b4b10bbce3b", "committedDate": "2020-11-25T19:28:27Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "7e2ad90dd897868311b8092c83bfa50981b09533", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/7e2ad90dd897868311b8092c83bfa50981b09533", "committedDate": "2020-11-26T09:34:21Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e2ad90dd897868311b8092c83bfa50981b09533", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/7e2ad90dd897868311b8092c83bfa50981b09533", "committedDate": "2020-11-26T09:34:21Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "7a94cdd54bee359c7ea97fbac56468e2f8b6aced", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/7a94cdd54bee359c7ea97fbac56468e2f8b6aced", "committedDate": "2020-11-26T10:02:03Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MjczMDE4", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#pullrequestreview-539273018", "createdAt": "2020-11-26T12:29:47Z", "commit": {"oid": "7a94cdd54bee359c7ea97fbac56468e2f8b6aced"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMjoyOTo0N1rOH6Zc4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNTowMjoyNFrOH6e83w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDk5NjQ0OQ==", "bodyText": "I'm missing a similar approach to test write new method in CloudEvent class", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r530996449", "createdAt": "2020-11-26T12:29:47Z", "author": {"login": "afalhambra"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/test/java/org/kie/server/services/jbpm/kafka/CloudEventTest.java", "diffHunk": "@@ -34,7 +34,7 @@ public void testStringCloudEventDeserialization() throws IOException, ParseExcep\n         assertEquals(\"javi\",event.getId());\n         assertEquals(\"one\",event.getType());\n         assertEquals(\"pepe\",event.getSource());\n-        assertEquals(\"1.0\",event.getSpecVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a94cdd54bee359c7ea97fbac56468e2f8b6aced"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMjA4Mg==", "bodyText": "Why are we only taking into account incomingNodes and not outgoing ones? if for instance an EndEventHandler node is processed, we are not considering this to be updated accordingly in the list of topics? - am I missing something here? can you please clarify?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r531032082", "createdAt": "2020-11-26T13:33:17Z", "author": {"login": "afalhambra"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -214,8 +257,10 @@ private void removeTopics(String deploymentId, ProcessDefinition processDefiniti\n                                                          String deploymentId,\n                                                          Collection<T> signals) {\n         for (T signal : signals) {\n-            topic2SignalBase.computeIfAbsent(topicFromSignal(signal), k -> new HashMap<>()).computeIfAbsent(\n-                    signal, k -> new ArrayList<>()).add(deploymentId);\n+            if (!signal.getIncomingNodes().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a94cdd54bee359c7ea97fbac56468e2f8b6aced"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA4NTc3MA==", "bodyText": "Shouldn't we try to flush first? or right after sending a record? wdyt?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        producer.close();\n          \n          \n            \n                        producer.flush();\n          \n          \n            \n                        producer.close();", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r531085770", "createdAt": "2020-11-26T15:01:01Z", "author": {"login": "afalhambra"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -140,6 +159,10 @@ public void destroy(KieServerImpl kieServer, KieServerRegistry registry) {\n         if (deploymentService != null) {\n             deploymentService.removeListener(this);\n         }\n+        if (producerReady.compareAndSet(true, false)) {\n+            producer.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a94cdd54bee359c7ea97fbac56468e2f8b6aced"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA4NjU1OQ==", "bodyText": "also, shouldn't it be beneficial to call close with a timeout? maybe configurable through a system property - wdyt?", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r531086559", "createdAt": "2020-11-26T15:02:24Z", "author": {"login": "afalhambra"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -140,6 +159,10 @@ public void destroy(KieServerImpl kieServer, KieServerRegistry registry) {\n         if (deploymentService != null) {\n             deploymentService.removeListener(this);\n         }\n+        if (producerReady.compareAndSet(true, false)) {\n+            producer.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a94cdd54bee359c7ea97fbac56468e2f8b6aced"}, "originalPosition": 65}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a94cdd54bee359c7ea97fbac56468e2f8b6aced", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/7a94cdd54bee359c7ea97fbac56468e2f8b6aced", "committedDate": "2020-11-26T10:02:03Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "92ece0f918e12be2b02e3d082dfb00c3eae65d99", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/92ece0f918e12be2b02e3d082dfb00c3eae65d99", "committedDate": "2020-11-27T15:24:44Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92ece0f918e12be2b02e3d082dfb00c3eae65d99", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/92ece0f918e12be2b02e3d082dfb00c3eae65d99", "committedDate": "2020-11-27T15:24:44Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "197084eb8b8d0b84bc52e2bd2ba5d47e024cec5c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/197084eb8b8d0b84bc52e2bd2ba5d47e024cec5c", "committedDate": "2020-11-30T13:04:29Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "197084eb8b8d0b84bc52e2bd2ba5d47e024cec5c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/197084eb8b8d0b84bc52e2bd2ba5d47e024cec5c", "committedDate": "2020-11-30T13:04:29Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "08e1779336823501e3a4f59ea544599ebad94382", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/08e1779336823501e3a4f59ea544599ebad94382", "committedDate": "2020-11-30T18:20:43Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08e1779336823501e3a4f59ea544599ebad94382", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/08e1779336823501e3a4f59ea544599ebad94382", "committedDate": "2020-11-30T18:20:43Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "d76974a769d20eab76a45a3825a9632dd6a2ac35", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/d76974a769d20eab76a45a3825a9632dd6a2ac35", "committedDate": "2020-12-01T10:05:00Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNzU0MDYy", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#pullrequestreview-541754062", "createdAt": "2020-12-01T10:22:59Z", "commit": {"oid": "d76974a769d20eab76a45a3825a9632dd6a2ac35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d76974a769d20eab76a45a3825a9632dd6a2ac35", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/d76974a769d20eab76a45a3825a9632dd6a2ac35", "committedDate": "2020-12-01T10:05:00Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "1e14f134ca01ae4c69f00a902c5538cef3bfa7ed", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/1e14f134ca01ae4c69f00a902c5538cef3bfa7ed", "committedDate": "2020-12-01T11:40:27Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e14f134ca01ae4c69f00a902c5538cef3bfa7ed", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/1e14f134ca01ae4c69f00a902c5538cef3bfa7ed", "committedDate": "2020-12-01T11:40:27Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "4b6501860c0fd478b18abc3a20a1983b866fb3aa", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/4b6501860c0fd478b18abc3a20a1983b866fb3aa", "committedDate": "2020-12-01T11:48:11Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxODMyMDM0", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#pullrequestreview-541832034", "createdAt": "2020-12-01T12:07:10Z", "commit": {"oid": "4b6501860c0fd478b18abc3a20a1983b866fb3aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b6501860c0fd478b18abc3a20a1983b866fb3aa", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/4b6501860c0fd478b18abc3a20a1983b866fb3aa", "committedDate": "2020-12-01T11:48:11Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "1dbe0dcc31bc420b87a5d09d1e86780c2cbb977e", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/1dbe0dcc31bc420b87a5d09d1e86780c2cbb977e", "committedDate": "2020-12-01T12:43:03Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1dbe0dcc31bc420b87a5d09d1e86780c2cbb977e", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/1dbe0dcc31bc420b87a5d09d1e86780c2cbb977e", "committedDate": "2020-12-01T12:43:03Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "ccaedcbd36940803316a8e60d1608b5976da1978", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/ccaedcbd36940803316a8e60d1608b5976da1978", "committedDate": "2020-12-01T14:55:26Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccaedcbd36940803316a8e60d1608b5976da1978", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/ccaedcbd36940803316a8e60d1608b5976da1978", "committedDate": "2020-12-01T14:55:26Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "252af5ad1cf2907b2820f9f80dbddf8e232f583e", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/252af5ad1cf2907b2820f9f80dbddf8e232f583e", "committedDate": "2020-12-01T16:40:46Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "252af5ad1cf2907b2820f9f80dbddf8e232f583e", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/252af5ad1cf2907b2820f9f80dbddf8e232f583e", "committedDate": "2020-12-01T16:40:46Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "18c0d17284c78317d142a2359ca40eba6fb106be", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/18c0d17284c78317d142a2359ca40eba6fb106be", "committedDate": "2020-12-01T16:48:57Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTc2OTQ2", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#pullrequestreview-542576946", "createdAt": "2020-12-02T08:01:38Z", "commit": {"oid": "18c0d17284c78317d142a2359ca40eba6fb106be"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwODowMTozOFrOH9Ok4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwODowNTowMVrOH9OrRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2NDAwMw==", "bodyText": "we need two properties here.\nKAFKA_EXTENSION_PREFIX.signals.mapping=(NONE) -> (by default or AUTO)\nKAFKA_EXTENSION_PREFIX.messages.mapping=AUTO -> (or NONE)\nthe idea would be that in the future we can say extends which signals we need to map", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r533964003", "createdAt": "2020-12-02T08:01:38Z", "author": {"login": "elguardian"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -67,16 +82,20 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-public class KafkaServerExtension implements KieServerExtension, DeploymentEventListener, Runnable {\n+public class KafkaServerExtension implements KieServerExtension, DeploymentEventListener, ProcessEventListener,\n+                                  Runnable {\n \n     public static final String EXTENSION_NAME = \"Kafka\";\n     static final String KAFKA_EXTENSION_PREFIX = \"org.kie.server.jbpm-kafka.ext.\";\n     static final String TOPIC_PREFIX = KAFKA_EXTENSION_PREFIX + \"topics.\";\n+    static final String SIGNALS_ENABLED = KAFKA_EXTENSION_PREFIX + \"enableSignals\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18c0d17284c78317d142a2359ca40eba6fb106be"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2NTYzOQ==", "bodyText": "right now we have the metadata in the signal node regarding this so the behaviour should be like this.\nif the signal map property is AUTO... we should MAP unless the implementation exists says otherthing than kafka\nif it is none we should not map unless the property says kafka.\nmetadata overrides the flags.", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#discussion_r533965639", "createdAt": "2020-12-02T08:05:01Z", "author": {"login": "elguardian"}, "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -201,21 +249,27 @@ public void onDeactivate(DeploymentEvent event) {\n     }\n \n     private void updateTopics(String deploymentId, ProcessDefinition processDefinition) {\n-        updateTopics(topic2Signal, deploymentId, processDefinition.getSignalsDesc());\n+        if (Boolean.getBoolean(SIGNALS_ENABLED)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18c0d17284c78317d142a2359ca40eba6fb106be"}, "originalPosition": 141}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18c0d17284c78317d142a2359ca40eba6fb106be", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/18c0d17284c78317d142a2359ca40eba6fb106be", "committedDate": "2020-12-01T16:48:57Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "ae09049fa5b4acd591655f24055322bf5e65ddce", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/ae09049fa5b4acd591655f24055322bf5e65ddce", "committedDate": "2020-12-02T12:36:38Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae09049fa5b4acd591655f24055322bf5e65ddce", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/ae09049fa5b4acd591655f24055322bf5e65ddce", "committedDate": "2020-12-02T12:36:38Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "ff883c5ff8d704228ed92fa3cbd03e22a134b86f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/ff883c5ff8d704228ed92fa3cbd03e22a134b86f", "committedDate": "2020-12-02T14:48:55Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff883c5ff8d704228ed92fa3cbd03e22a134b86f", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/ff883c5ff8d704228ed92fa3cbd03e22a134b86f", "committedDate": "2020-12-02T14:48:55Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "1b04dcbfc699cec28fa69e770ff401f615f2b196", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/1b04dcbfc699cec28fa69e770ff401f615f2b196", "committedDate": "2020-12-02T16:40:51Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4098f41d35b46b914387d7b766cb52b8eed567c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/d4098f41d35b46b914387d7b766cb52b8eed567c", "committedDate": "2020-12-03T10:50:02Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b04dcbfc699cec28fa69e770ff401f615f2b196", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/1b04dcbfc699cec28fa69e770ff401f615f2b196", "committedDate": "2020-12-02T16:40:51Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}, "afterCommit": {"oid": "d4098f41d35b46b914387d7b766cb52b8eed567c", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/d4098f41d35b46b914387d7b766cb52b8eed567c", "committedDate": "2020-12-03T10:50:02Z", "message": "[JBPM-9474] Produce events to Kafka by Signal or Messages Events\n\nModifying kafka server extension to publish events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzI3NzMx", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2322#pullrequestreview-544727731", "createdAt": "2020-12-04T07:58:59Z", "commit": {"oid": "d4098f41d35b46b914387d7b766cb52b8eed567c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1104, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}