{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MjMxMDg5", "number": 3215, "title": "fix and update k8s deploy", "bodyText": "Tips\n\nThanks very much for contributing to Apache DolphinScheduler.\nPlease review https://dolphinscheduler.apache.org/en-us/community/index.html before opening a pull request.\n\nWhat is the purpose of the pull request\nupdate Dockerfile to add mysql-client for mysql database service test\nupdate wechat alert config replace placeholder from to {xx} because of the will be treat as env variable\nfix unit test of EnterpriseWeChatUtilsTest\nupdate values.yaml default config for helm deploy DS cluster\nupdate values.yaml default config for custom install\nupdate templates of helm for custom install\nupdate some name of env varibale, for example change from POSTGRESQL_HOST to DATABASE_HOST\ndelele the redundancy requirements.yaml for heml\nupdate README* in the docker dir and subdir\nupdate startup scripts for support mysql as backend database\n\nBrief change log\nModify ambari_plugin/common-services/DOLPHIN/1.2.1/package/scripts/params.py\nModify ambari_plugin/common-services/DOLPHIN/1.3.0/package/scripts/params.py\nModify docker/build/Dockerfile\nModify docker/build/README.md\nModify docker/build/README_zh_CN.md\nModify docker/build/conf/dolphinscheduler/alert.properties.tpl\nModify docker/build/conf/dolphinscheduler/common.properties.tpl\nModify docker/build/conf/dolphinscheduler/datasource.properties.tpl\nModify docker/build/conf/dolphinscheduler/logback/logback-alert.xml\nModify docker/build/conf/dolphinscheduler/zookeeper.properties.tpl\nModify docker/build/startup-init-conf.sh\nModify docker/build/startup.sh\nModify docker/docker-swarm/docker-compose.yml\nModify docker/docker-swarm/docker-stack.yml\nModify docker/kubernetes/dolphinscheduler/Chart.yaml\nModify docker/kubernetes/dolphinscheduler/README.md\nModify docker/kubernetes/dolphinscheduler/requirements.yaml\nModify docker/kubernetes/dolphinscheduler/templates/NOTES.txt\nModify docker/kubernetes/dolphinscheduler/templates/_helpers.tpl\nModify docker/kubernetes/dolphinscheduler/templates/configmap-dolphinscheduler-alert.yaml\nAdd docker/kubernetes/dolphinscheduler/templates/configmap-dolphinscheduler-common.yaml\nModify docker/kubernetes/dolphinscheduler/templates/deployment-dolphinscheduler-alert.yaml\nModify docker/kubernetes/dolphinscheduler/templates/deployment-dolphinscheduler-api.yaml\nModify docker/kubernetes/dolphinscheduler/templates/deployment-dolphinscheduler-frontend.yaml\nModify docker/kubernetes/dolphinscheduler/templates/statefulset-dolphinscheduler-master.yaml\nModify docker/kubernetes/dolphinscheduler/templates/statefulset-dolphinscheduler-worker.yaml\nModify docker/kubernetes/dolphinscheduler/values.yaml\nModify dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtils.java\nModify dolphinscheduler-alert/src/main/resources/alert.properties\nModify dolphinscheduler-alert/src/test/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtilsTest.java\nModify dolphinscheduler-ui/package.json\nModify script/dolphinscheduler-daemon.sh\nModify docker/docker-swarm/docker-compose.yml\nModify docker/docker-swarm/docker-stack.yml\nVerify this pull request\nThis pull request is code cleanup without any test coverage.", "createdAt": "2020-07-15T04:09:42Z", "url": "https://github.com/apache/dolphinscheduler/pull/3215", "merged": true, "mergeCommit": {"oid": "b6a0d55949d8379ff5649993361aed858a98ca13"}, "closed": true, "closedAt": "2020-07-16T08:36:30Z", "author": {"login": "rockxsj"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcziPSAgH2gAyNDQ5MjMxMDg5OjcyMTk4Y2M3NjFkYjRlNzNiMGU2ZTY5OTRjOWM3YTI0YTA2NzIxZjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1ZyLPAFqTQ0OTU2MDA5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "72198cc761db4e73b0e6e6994c9c7a24a06721f5", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/72198cc761db4e73b0e6e6994c9c7a24a06721f5", "committedDate": "2020-07-10T11:49:41Z", "message": "Modify the AWS S3 request encryption method to V4."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f9beb29049cd8f6184fa1fde0fa924c891907f3", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/2f9beb29049cd8f6184fa1fde0fa924c891907f3", "committedDate": "2020-07-13T06:55:17Z", "message": "Merge branch 'dev' into rockxsj-dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c35a6b4b9655163316af9a497c8e6a9fef7005c", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/3c35a6b4b9655163316af9a497c8e6a9fef7005c", "committedDate": "2020-07-14T06:46:12Z", "message": "* update Dockerfile to add mysql-client for mysql database service test\n* update wechat alert config replace placeholder from  to {xx} because of the  will be treat as env variable\n* fix unit test of EnterpriseWeChatUtilsTest\n* update values.yaml default config for helm deploy DS cluster\n* update values.yaml default config for custom install\n* update templates of helm for custom install\n* update some name of env varibale, for example change from POSTGRESQL_HOST to DATABASE_HOST\n* delele the redundancy requirements.yaml for heml\n* update README* in the docker dir and subdir\n* update startup scripts for support mysql as backend database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a8c47cec70abed53b909daeebe5e1b4b5fd4b00", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/3a8c47cec70abed53b909daeebe5e1b4b5fd4b00", "committedDate": "2020-07-14T06:46:20Z", "message": "Merge branch 'dev' into rockxsj-dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d08a3a794dbbcb7ebdd7667f6423aff3e8580e14", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/d08a3a794dbbcb7ebdd7667f6423aff3e8580e14", "committedDate": "2020-07-15T01:17:23Z", "message": "Merge branch 'dev' into rockxsj-dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc213f0a443f3d2b548f0b16089b67293e13b9d5", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/bc213f0a443f3d2b548f0b16089b67293e13b9d5", "committedDate": "2020-07-15T01:22:59Z", "message": "* fix the ENV name wrong in docker-compose.yml and docker-stack.yml\n* remove the didn't need port mapping in postgresql & zookeeper & dolphinscheduler-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddc38930272a9212f6ab4e73c5d9e98104f66abc", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/ddc38930272a9212f6ab4e73c5d9e98104f66abc", "committedDate": "2020-07-15T04:07:43Z", "message": "* keep expose the port of postgresql & zk & api because of unit test needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/822fcd30ceb16eb4c1e29f4e5fcf42221283cedd", "committedDate": "2020-07-15T04:07:57Z", "message": "Merge branch 'dev' into rockxsj-dev"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDc5MjY5", "url": "https://github.com/apache/dolphinscheduler/pull/3215#pullrequestreview-449479269", "createdAt": "2020-07-16T03:17:22Z", "commit": {"oid": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMzoxNzoyMlrOGyYmzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMzoyMToxM1rOGyYqxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4NTEzNA==", "bodyText": "mysql's license can not meet the requirements of apache, pls remove it", "url": "https://github.com/apache/dolphinscheduler/pull/3215#discussion_r455485134", "createdAt": "2020-07-16T03:17:22Z", "author": {"login": "khadgarmage"}, "path": "docker/build/Dockerfile", "diffHunk": "@@ -42,8 +42,8 @@ ADD ./apache-dolphinscheduler-incubating-${VERSION}-dolphinscheduler-bin.tar.gz\n RUN mv /opt/apache-dolphinscheduler-incubating-${VERSION}-dolphinscheduler-bin/ /opt/dolphinscheduler/\n ENV DOLPHINSCHEDULER_HOME /opt/dolphinscheduler\n \n-#4. install pg\n-RUN apk add postgresql postgresql-contrib\n+#4. install database\n+RUN apk add postgresql postgresql-contrib mysql-client", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4NjE0OQ==", "bodyText": "license problem", "url": "https://github.com/apache/dolphinscheduler/pull/3215#discussion_r455486149", "createdAt": "2020-07-16T03:21:13Z", "author": {"login": "khadgarmage"}, "path": "docker/build/startup.sh", "diffHunk": "@@ -22,24 +22,32 @@ DOLPHINSCHEDULER_BIN=${DOLPHINSCHEDULER_HOME}/bin\n DOLPHINSCHEDULER_SCRIPT=${DOLPHINSCHEDULER_HOME}/script\n DOLPHINSCHEDULER_LOGS=${DOLPHINSCHEDULER_HOME}/logs\n \n-# start postgresql\n-initPostgreSQL() {\n-    echo \"test postgresql service\"\n-    while ! nc -z ${POSTGRESQL_HOST} ${POSTGRESQL_PORT}; do\n+# start database\n+initDatabase() {\n+    echo \"test ${DATABASE_TYPE} service\"\n+    while ! nc -z ${DATABASE_HOST} ${DATABASE_PORT}; do\n         counter=$((counter+1))\n         if [ $counter == 30 ]; then\n-            echo \"Error: Couldn't connect to postgresql.\"\n+            echo \"Error: Couldn't connect to ${DATABASE_TYPE}.\"\n             exit 1\n         fi\n-        echo \"Trying to connect to postgresql at ${POSTGRESQL_HOST}:${POSTGRESQL_PORT}. Attempt $counter.\"\n+        echo \"Trying to connect to ${DATABASE_TYPE} at ${DATABASE_HOST}:${DATABASE_PORT}. Attempt $counter.\"\n         sleep 5\n     done\n \n-    echo \"connect postgresql service\"\n-    v=$(sudo -u postgres PGPASSWORD=${POSTGRESQL_PASSWORD} psql -h ${POSTGRESQL_HOST} -p ${POSTGRESQL_PORT} -U ${POSTGRESQL_USERNAME} -d dolphinscheduler -tAc \"select 1\")\n-    if [ \"$(echo '${v}' | grep 'FATAL' | wc -l)\" -eq 1 ]; then\n-        echo \"Error: Can't connect to database...${v}\"\n-        exit 1\n+    echo \"connect ${DATABASE_TYPE} service\"\n+    if [ ${DATABASE_TYPE} = \"mysql\" ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTIxOTg1", "url": "https://github.com/apache/dolphinscheduler/pull/3215#pullrequestreview-449521985", "createdAt": "2020-07-16T05:45:01Z", "commit": {"oid": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb6836627f840e85d350c9418f8c8bda76323ee0", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/bb6836627f840e85d350c9418f8c8bda76323ee0", "committedDate": "2020-07-16T06:36:49Z", "message": "* remove mysql-client package from dockerfile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTYwMDkx", "url": "https://github.com/apache/dolphinscheduler/pull/3215#pullrequestreview-449560091", "createdAt": "2020-07-16T07:06:30Z", "commit": {"oid": "bb6836627f840e85d350c9418f8c8bda76323ee0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1888, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}