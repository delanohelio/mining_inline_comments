{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NTkwNDk1", "number": 1684, "title": "fix get tenantCode my NPE", "bodyText": "For #1465\n1 fix get tenantCode my NPE\n2 add ResourcesServiceTest\nmodify class\nResourcesService\nadd UT\nResourcesServiceTest\nmodify root pom\n<include>**/api/service/ResourcesServiceTest.java</include>", "createdAt": "2020-01-02T08:58:26Z", "url": "https://github.com/apache/dolphinscheduler/pull/1684", "merged": true, "mergeCommit": {"oid": "15ae4dfa742f2ccbe71b45f384d14221a4c38d88"}, "closed": true, "closedAt": "2020-01-06T11:47:30Z", "author": {"login": "samz406"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb1Zi0BAH2gAyMzU4NTkwNDk1OjI1N2EzZWUzZTM3NzIwYzAyOGE5MmMzYWJkZWI4MjhlNjBkYmJjYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3quTSgFqTMzODYwMTc2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "257a3ee3e37720c028a92c3abdeb828e60dbbcc8", "author": {"user": {"login": "samz406", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/257a3ee3e37720c028a92c3abdeb828e60dbbcc8", "committedDate": "2019-12-30T10:38:34Z", "message": "Merge pull request #18 from apache/dev\n\nupdate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5fe55ad56bd902523a0868a7d4f5d2bed3e8caa", "author": {"user": {"login": "samz406", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/d5fe55ad56bd902523a0868a7d4f5d2bed3e8caa", "committedDate": "2019-12-30T10:44:03Z", "message": "modify UdfFuncServiceTest UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38e3af0dee6ec28cb99e1ce6b4fdcf66ec7ef367", "author": {"user": {"login": "samz406", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/38e3af0dee6ec28cb99e1ce6b4fdcf66ec7ef367", "committedDate": "2020-01-02T08:38:31Z", "message": "Merge pull request #19 from apache/dev\n\nupdate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67acd09f9401ea675d0231a610c23a8b58459767", "author": {"user": {"login": "samz406", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/67acd09f9401ea675d0231a610c23a8b58459767", "committedDate": "2020-01-02T08:53:07Z", "message": "fix get tenantCode my NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8", "author": {"user": {"login": "samz406", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/32604123eb94edb0148b0f38e6947e07894f0ae8", "committedDate": "2020-01-02T08:53:43Z", "message": "add  ResourcesServiceTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MDc2MDIz", "url": "https://github.com/apache/dolphinscheduler/pull/1684#pullrequestreview-338076023", "createdAt": "2020-01-03T13:22:08Z", "commit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMzoyMjowOFrOFZ_6yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMzoyMzoyMlrOFZ_8Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNTk2MA==", "bodyText": "Is necessary to putMsg and log error?", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362805960", "createdAt": "2020-01-03T13:22:08Z", "author": {"login": "khadgarmage"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -234,6 +234,12 @@ public Result updateResource(User loginUser,\n             }\n         }\n \n+        // query tenant by user id\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjI2NQ==", "bodyText": "Is necessary to putMsg and log error?", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362806265", "createdAt": "2020-01-03T13:23:07Z", "author": {"login": "khadgarmage"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -522,8 +529,11 @@ public Result readResource(int resourceId, int skipLineNum, int limit) {\n             }\n         }\n \n-        User user = userMapper.queryDetailsById(resource.getUserId());\n-        String tenantCode = tenantMapper.queryById(user.getTenantId()).getTenantCode();\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){\n+            return  result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjM0Mg==", "bodyText": "Is necessary to putMsg and log error?", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362806342", "createdAt": "2020-01-03T13:23:22Z", "author": {"login": "khadgarmage"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -644,18 +654,20 @@ public Result updateResourceContent(int resourceId, String content) {\n         if (StringUtils.isNotEmpty(resourceViewSuffixs)) {\n             List<String> strList = Arrays.asList(resourceViewSuffixs.split(\",\"));\n             if (!strList.contains(nameSuffix)) {\n-                logger.error(\"resouce suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n+                logger.error(\"resource suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n                 putMsg(result, Status.RESOURCE_SUFFIX_NOT_SUPPORT_VIEW);\n                 return result;\n             }\n         }\n \n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0d73fb7897d94e318d63748d87b271f6adf984b", "author": {"user": {"login": "samz406", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/b0d73fb7897d94e318d63748d87b271f6adf984b", "committedDate": "2020-01-04T03:40:53Z", "message": "add error log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NjAxNzY1", "url": "https://github.com/apache/dolphinscheduler/pull/1684#pullrequestreview-338601765", "createdAt": "2020-01-06T11:47:22Z", "commit": {"oid": "b0d73fb7897d94e318d63748d87b271f6adf984b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1935, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}