{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNTk2NzEw", "number": 2934, "title": "[Feature-2815][server] One worker can belong to different workergroups", "bodyText": "What is the purpose of the pull request\nImplement one worker can belong to different workergroups(#2591 ) (#2815 )\nBrief change log\n\nChange worker.properties file's worker.group conf to worker.groups\nChange server/worker/config/WorkerConfig#workerGroup to  server/worker/config/WorkerConfig#workerGroups\nChange workerRegistry to registry one worker to muti-groups\nAdd tests for this issue\n\nVerify this pull request\nThis change added tests and can be verified as follows:\n\nChanged WorkerRegistryTest to verify the change.", "createdAt": "2020-06-09T07:39:51Z", "url": "https://github.com/apache/dolphinscheduler/pull/2934", "merged": true, "mergeCommit": {"oid": "b4af3fd1764756fde4c5395639d7816d03e77bff"}, "closed": true, "closedAt": "2020-07-13T09:25:14Z", "author": {"login": "yangyichao-mango"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr05ZfgBqjM0NDg4NjY4OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0dxIFgH2gAyNDMxNTk2NzEwOjkyMGI3ZjU4ZWNkOGRkZjlkNTQyMTAxZGU3ZTNkMWMzNGFiNjJjNjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ad6b5f81b8cbd094ebe2f5d4d24e60090a98a8b", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/6ad6b5f81b8cbd094ebe2f5d4d24e60090a98a8b", "committedDate": "2020-06-11T02:03:51Z", "message": "Change the table and th tag to remove the bad smell of code style"}, "afterCommit": {"oid": "476f7877df2a7c88a34fa0c030da1ca043ec63a3", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/476f7877df2a7c88a34fa0c030da1ca043ec63a3", "committedDate": "2020-06-16T13:01:12Z", "message": "[Feature-2815][server] One worker can belong to different workergroups"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "476f7877df2a7c88a34fa0c030da1ca043ec63a3", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/476f7877df2a7c88a34fa0c030da1ca043ec63a3", "committedDate": "2020-06-16T13:01:12Z", "message": "[Feature-2815][server] One worker can belong to different workergroups"}, "afterCommit": {"oid": "425fc002afaa0163e71e20ab78dc70e4f5c8f5fe", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/425fc002afaa0163e71e20ab78dc70e4f5c8f5fe", "committedDate": "2020-06-19T07:10:12Z", "message": "[Feature-2815][server] One worker can belong to different workergroups"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01c39584a6b6eb76a8c2be634eb7c7594f4b9e19", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/01c39584a6b6eb76a8c2be634eb7c7594f4b9e19", "committedDate": "2020-06-23T13:31:28Z", "message": "Feature: optimize the worker mutigroups web UI and remove the duplicated code"}, "afterCommit": {"oid": "c8e389133811a95a095c7000dbb6971941d448ce", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/c8e389133811a95a095c7000dbb6971941d448ce", "committedDate": "2020-06-23T14:36:58Z", "message": "Feature: optimize the worker mutigroups web UI and remove the duplicated code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4OTI1NTI5", "url": "https://github.com/apache/dolphinscheduler/pull/2934#pullrequestreview-438925529", "createdAt": "2020-06-29T06:47:44Z", "commit": {"oid": "c8e389133811a95a095c7000dbb6971941d448ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNjo0Nzo0NFrOGqG4iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNjo0Nzo0NFrOGqG4iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgwNjE1Mw==", "bodyText": "Hello, is it possible to return directly here without continuing to judge? In addition, it is not very intuitive to flood with too many if else", "url": "https://github.com/apache/dolphinscheduler/pull/2934#discussion_r446806153", "createdAt": "2020-06-29T06:47:44Z", "author": {"login": "CalvinKirs"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/registry/WorkerRegistry.java", "diffHunk": "@@ -86,34 +90,39 @@ public void init(){\n      */\n     public void registry() {\n         String address = OSUtils.getHost();\n-        String localNodePath = getWorkerPath();\n-        zookeeperRegistryCenter.getZookeeperCachedOperator().persistEphemeral(localNodePath, \"\");\n-        zookeeperRegistryCenter.getZookeeperCachedOperator().getZkClient().getConnectionStateListenable().addListener(new ConnectionStateListener() {\n-            @Override\n-            public void stateChanged(CuratorFramework client, ConnectionState newState) {\n-                if(newState == ConnectionState.LOST){\n-                    logger.error(\"worker : {} connection lost from zookeeper\", address);\n-                } else if(newState == ConnectionState.RECONNECTED){\n-                    logger.info(\"worker : {} reconnected to zookeeper\", address);\n-                    zookeeperRegistryCenter.getZookeeperCachedOperator().persistEphemeral(localNodePath, \"\");\n-                } else if(newState == ConnectionState.SUSPENDED){\n-                    logger.warn(\"worker : {} connection SUSPENDED \", address);\n-                }\n-            }\n-        });\n+        Set<String> workerZkPaths = getWorkerZkPaths();\n         int workerHeartbeatInterval = workerConfig.getWorkerHeartbeatInterval();\n-        this.heartBeatExecutor.scheduleAtFixedRate(new HeartBeatTask(), workerHeartbeatInterval, workerHeartbeatInterval, TimeUnit.SECONDS);\n-        logger.info(\"worker node : {} registry to ZK successfully with heartBeatInterval : {}s\", address, workerHeartbeatInterval);\n \n+        for (String workerZKPath : workerZkPaths) {\n+            zookeeperRegistryCenter.getZookeeperCachedOperator().persistEphemeral(workerZKPath, \"\");\n+            zookeeperRegistryCenter.getZookeeperCachedOperator().getZkClient().getConnectionStateListenable().addListener(new ConnectionStateListener() {\n+                @Override\n+                public void stateChanged(CuratorFramework client, ConnectionState newState) {\n+                    if (newState == ConnectionState.LOST) {\n+                        logger.error(\"worker : {} connection lost from zookeeper\", address);\n+                    } else if (newState == ConnectionState.RECONNECTED) {\n+                        logger.info(\"worker : {} reconnected to zookeeper\", address);\n+                        zookeeperRegistryCenter.getZookeeperCachedOperator().persistEphemeral(workerZKPath, \"\");\n+                    } else if (newState == ConnectionState.SUSPENDED) {\n+                        logger.warn(\"worker : {} connection SUSPENDED \", address);\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8e389133811a95a095c7000dbb6971941d448ce"}, "originalPosition": 87}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8e389133811a95a095c7000dbb6971941d448ce", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/c8e389133811a95a095c7000dbb6971941d448ce", "committedDate": "2020-06-23T14:36:58Z", "message": "Feature: optimize the worker mutigroups web UI and remove the duplicated code"}, "afterCommit": {"oid": "26560b24bcb917f2c68d7990ceef902198ed387f", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/26560b24bcb917f2c68d7990ceef902198ed387f", "committedDate": "2020-07-02T13:36:57Z", "message": "Feature: optimize the worker mutigroups web UI and remove the duplicated code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c9acd0cdf4304ddd815d254d8c15e58fdb28866", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/7c9acd0cdf4304ddd815d254d8c15e58fdb28866", "committedDate": "2020-07-03T03:50:48Z", "message": "Feature: Change the heart beat task runner and Add the cover test cases"}, "afterCommit": {"oid": "f53450b255c385707cc1ff1b40bddd0ab1f9770c", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f53450b255c385707cc1ff1b40bddd0ab1f9770c", "committedDate": "2020-07-03T04:25:54Z", "message": "Feature: add test and optimize code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db9de61656c5d44f7c1fbb45a1cd151154ec38ec", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/db9de61656c5d44f7c1fbb45a1cd151154ec38ec", "committedDate": "2020-07-03T06:58:03Z", "message": "[Feature-2815][server] One worker can belong to different workergroups"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be652fd637aa43ab5d81049ebcd23d588fab3fe5", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/be652fd637aa43ab5d81049ebcd23d588fab3fe5", "committedDate": "2020-07-03T04:37:10Z", "message": "Feature: remove the unused comment"}, "afterCommit": {"oid": "db9de61656c5d44f7c1fbb45a1cd151154ec38ec", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/db9de61656c5d44f7c1fbb45a1cd151154ec38ec", "committedDate": "2020-07-03T06:58:03Z", "message": "[Feature-2815][server] One worker can belong to different workergroups"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ddfea802235639ad437417cc2421aa9123e6daa2", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/ddfea802235639ad437417cc2421aa9123e6daa2", "committedDate": "2020-07-03T09:38:39Z", "message": "Feature: add unit test case"}, "afterCommit": {"oid": "40f9f25ad20343def37e914ef28f5a183d16e8a2", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/40f9f25ad20343def37e914ef28f5a183d16e8a2", "committedDate": "2020-07-03T10:00:41Z", "message": "Feature: Add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cf4cb1ebb0b5d19811aee1dae1a6850ed00fd7f", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8cf4cb1ebb0b5d19811aee1dae1a6850ed00fd7f", "committedDate": "2020-07-04T10:59:38Z", "message": "Feature: Add test cases"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "655570ef5450a250dea9dcc39387c2019f762b8e", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/655570ef5450a250dea9dcc39387c2019f762b8e", "committedDate": "2020-07-03T10:49:13Z", "message": "Feature: Remove the space"}, "afterCommit": {"oid": "8cf4cb1ebb0b5d19811aee1dae1a6850ed00fd7f", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8cf4cb1ebb0b5d19811aee1dae1a6850ed00fd7f", "committedDate": "2020-07-04T10:59:38Z", "message": "Feature: Add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f18b15856281db1463d16671c3f1b1fe05cbe10", "author": {"user": {"login": "dailidong", "name": "lidongdai"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8f18b15856281db1463d16671c3f1b1fe05cbe10", "committedDate": "2020-07-09T16:05:21Z", "message": "Merge branch 'dev' into feature-2591"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b4c48ff34dbe92b6a602a69b56df49967e14c83", "author": {"user": {"login": "dailidong", "name": "lidongdai"}}, "url": "https://github.com/apache/dolphinscheduler/commit/9b4c48ff34dbe92b6a602a69b56df49967e14c83", "committedDate": "2020-07-10T23:46:37Z", "message": "Merge branch 'dev' into feature-2591"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzYyNjMw", "url": "https://github.com/apache/dolphinscheduler/pull/2934#pullrequestreview-446762630", "createdAt": "2020-07-11T00:52:36Z", "commit": {"oid": "8f18b15856281db1463d16671c3f1b1fe05cbe10"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0625c980c09e49d245d8f2d877f944d9c21a141", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/e0625c980c09e49d245d8f2d877f944d9c21a141", "committedDate": "2020-07-11T03:56:17Z", "message": "Merge branch 'dev' into feature-2591"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f28c10d81492d6cd57d90ecbb5f911d7b1284e49", "author": {"user": {"login": "dailidong", "name": "lidongdai"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f28c10d81492d6cd57d90ecbb5f911d7b1284e49", "committedDate": "2020-07-12T00:44:05Z", "message": "Update MonitorService.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cee62daa6d86f20c6c330f753d0ac9e0c4b0ee77", "author": {"user": {"login": "dailidong", "name": "lidongdai"}}, "url": "https://github.com/apache/dolphinscheduler/commit/cee62daa6d86f20c6c330f753d0ac9e0c4b0ee77", "committedDate": "2020-07-12T00:44:25Z", "message": "Merge branch 'dev' into feature-2591"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "799245acd86c0d27d029d2816946176606eb8e1f", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/799245acd86c0d27d029d2816946176606eb8e1f", "committedDate": "2020-07-13T04:59:58Z", "message": "Update MonitorService.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDYzNzEx", "url": "https://github.com/apache/dolphinscheduler/pull/2934#pullrequestreview-447063711", "createdAt": "2020-07-13T09:03:51Z", "commit": {"oid": "799245acd86c0d27d029d2816946176606eb8e1f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "920b7f58ecd8ddf9d542101de7e3d1c34ab62c60", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/920b7f58ecd8ddf9d542101de7e3d1c34ab62c60", "committedDate": "2020-07-13T09:11:03Z", "message": "Merge branch 'dev' into feature-2591"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1996, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}