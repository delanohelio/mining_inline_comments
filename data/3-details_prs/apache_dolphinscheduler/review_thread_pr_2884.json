{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2OTQ3OTQw", "number": 2884, "reviewThreads": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo0ODo0OFrOEEiBuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDowNjo1MFrOES1BOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMTg3MjU5OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo0ODo0OFrOGiNkNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMzozMjozOVrOGmG8RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyNzAyOQ==", "bodyText": "Please add parameters to ApiImplicitParams()", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r438527029", "createdAt": "2020-06-11T03:48:48Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "diffHunk": "@@ -95,27 +95,33 @@ public Result createProcessDefinition(@ApiIgnore @RequestAttribute(value = Const\n     }\n \n     /**\n-     * copy process definition\n+     * copy or move process definition\n      *\n      * @param loginUser   login user\n      * @param projectName project name\n-     * @param processId   process definition id\n+     * @param isCopy  isCopy\n+     * @param processDefinitionIds   process definition ids\n+     * @param targetProjectName target project name\n      * @return copy result code\n      */\n-    @ApiOperation(value = \"copyProcessDefinition\", notes= \"COPY_PROCESS_DEFINITION_NOTES\")\n+    @ApiOperation(value = \"copyOrMoveProcessDefinition\", notes= \"COPY_OR_MOVE_PROCESS_DEFINITION_NOTES\")\n     @ApiImplicitParams({\n-            @ApiImplicitParam(name = \"processId\", value = \"PROCESS_DEFINITION_ID\", required = true, dataType = \"Int\", example = \"100\")\n+            @ApiImplicitParam(name = \"processDefinitionIds\", value = \"PROCESS_DEFINITION_IDS\", required = true, dataType = \"String\", example = \"3,4\")\n     })\n-    @PostMapping(value = \"/copy\")\n+    @PostMapping(value = \"/copy-or-move\")\n     @ResponseStatus(HttpStatus.OK)\n-    @ApiException(COPY_PROCESS_DEFINITION_ERROR)\n-    public Result copyProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n-                                        @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n-                                        @RequestParam(value = \"processId\", required = true) int processId) throws JsonProcessingException {\n-        logger.info(\"copy process definition, login user:{}, project name:{}, process definition id:{}\",\n-                loginUser.getUserName(), projectName, processId);\n-        Map<String, Object> result = processDefinitionService.copyProcessDefinition(loginUser, projectName, processId);\n-        return returnDataList(result);\n+    @ApiException(COPY_OR_MOVE_PROCESS_DEFINITION_ERROR)\n+    public Result copyOrMoveProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n+                                              @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                              @RequestParam(value = \"processDefinitionIds\", required = true) String processDefinitionIds,\n+                                              @RequestParam(value = \"targetProjectName\",required = true) String targetProjectName,\n+                                              @RequestParam(value = \"isCopy\", required = true) boolean isCopy)  {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYxMjgwNA==", "bodyText": "problem fixed", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r442612804", "createdAt": "2020-06-19T03:32:39Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "diffHunk": "@@ -95,27 +95,33 @@ public Result createProcessDefinition(@ApiIgnore @RequestAttribute(value = Const\n     }\n \n     /**\n-     * copy process definition\n+     * copy or move process definition\n      *\n      * @param loginUser   login user\n      * @param projectName project name\n-     * @param processId   process definition id\n+     * @param isCopy  isCopy\n+     * @param processDefinitionIds   process definition ids\n+     * @param targetProjectName target project name\n      * @return copy result code\n      */\n-    @ApiOperation(value = \"copyProcessDefinition\", notes= \"COPY_PROCESS_DEFINITION_NOTES\")\n+    @ApiOperation(value = \"copyOrMoveProcessDefinition\", notes= \"COPY_OR_MOVE_PROCESS_DEFINITION_NOTES\")\n     @ApiImplicitParams({\n-            @ApiImplicitParam(name = \"processId\", value = \"PROCESS_DEFINITION_ID\", required = true, dataType = \"Int\", example = \"100\")\n+            @ApiImplicitParam(name = \"processDefinitionIds\", value = \"PROCESS_DEFINITION_IDS\", required = true, dataType = \"String\", example = \"3,4\")\n     })\n-    @PostMapping(value = \"/copy\")\n+    @PostMapping(value = \"/copy-or-move\")\n     @ResponseStatus(HttpStatus.OK)\n-    @ApiException(COPY_PROCESS_DEFINITION_ERROR)\n-    public Result copyProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n-                                        @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n-                                        @RequestParam(value = \"processId\", required = true) int processId) throws JsonProcessingException {\n-        logger.info(\"copy process definition, login user:{}, project name:{}, process definition id:{}\",\n-                loginUser.getUserName(), projectName, processId);\n-        Map<String, Object> result = processDefinitionService.copyProcessDefinition(loginUser, projectName, processId);\n-        return returnDataList(result);\n+    @ApiException(COPY_OR_MOVE_PROCESS_DEFINITION_ERROR)\n+    public Result copyOrMoveProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n+                                              @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                              @RequestParam(value = \"processDefinitionIds\", required = true) String processDefinitionIds,\n+                                              @RequestParam(value = \"targetProjectName\",required = true) String targetProjectName,\n+                                              @RequestParam(value = \"isCopy\", required = true) boolean isCopy)  {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyNzAyOQ=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMTg3MzQwOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo0OTozMVrOGiNkvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMzozMzoxM1rOGmG8zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyNzE2Nw==", "bodyText": "Please add parameters to log", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r438527167", "createdAt": "2020-06-11T03:49:31Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "diffHunk": "@@ -95,27 +95,33 @@ public Result createProcessDefinition(@ApiIgnore @RequestAttribute(value = Const\n     }\n \n     /**\n-     * copy process definition\n+     * copy or move process definition\n      *\n      * @param loginUser   login user\n      * @param projectName project name\n-     * @param processId   process definition id\n+     * @param isCopy  isCopy\n+     * @param processDefinitionIds   process definition ids\n+     * @param targetProjectName target project name\n      * @return copy result code\n      */\n-    @ApiOperation(value = \"copyProcessDefinition\", notes= \"COPY_PROCESS_DEFINITION_NOTES\")\n+    @ApiOperation(value = \"copyOrMoveProcessDefinition\", notes= \"COPY_OR_MOVE_PROCESS_DEFINITION_NOTES\")\n     @ApiImplicitParams({\n-            @ApiImplicitParam(name = \"processId\", value = \"PROCESS_DEFINITION_ID\", required = true, dataType = \"Int\", example = \"100\")\n+            @ApiImplicitParam(name = \"processDefinitionIds\", value = \"PROCESS_DEFINITION_IDS\", required = true, dataType = \"String\", example = \"3,4\")\n     })\n-    @PostMapping(value = \"/copy\")\n+    @PostMapping(value = \"/copy-or-move\")\n     @ResponseStatus(HttpStatus.OK)\n-    @ApiException(COPY_PROCESS_DEFINITION_ERROR)\n-    public Result copyProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n-                                        @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n-                                        @RequestParam(value = \"processId\", required = true) int processId) throws JsonProcessingException {\n-        logger.info(\"copy process definition, login user:{}, project name:{}, process definition id:{}\",\n-                loginUser.getUserName(), projectName, processId);\n-        Map<String, Object> result = processDefinitionService.copyProcessDefinition(loginUser, projectName, processId);\n-        return returnDataList(result);\n+    @ApiException(COPY_OR_MOVE_PROCESS_DEFINITION_ERROR)\n+    public Result copyOrMoveProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n+                                              @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                              @RequestParam(value = \"processDefinitionIds\", required = true) String processDefinitionIds,\n+                                              @RequestParam(value = \"targetProjectName\",required = true) String targetProjectName,\n+                                              @RequestParam(value = \"isCopy\", required = true) boolean isCopy)  {\n+\n+\n+        logger.info(\"batch {} process definition, login user:{}, project name:{}, process definition ids:{}\uff0ctarget project name:{}\",\n+                isCopy?\"copy\":\"move\",StringUtils.replaceNRTtoUnderline(loginUser.getUserName()), StringUtils.replaceNRTtoUnderline(projectName), StringUtils.replaceNRTtoUnderline(processDefinitionIds),StringUtils.replaceNRTtoUnderline(targetProjectName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYxMjk0MQ==", "bodyText": "Parameters already exist", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r442612941", "createdAt": "2020-06-19T03:33:13Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "diffHunk": "@@ -95,27 +95,33 @@ public Result createProcessDefinition(@ApiIgnore @RequestAttribute(value = Const\n     }\n \n     /**\n-     * copy process definition\n+     * copy or move process definition\n      *\n      * @param loginUser   login user\n      * @param projectName project name\n-     * @param processId   process definition id\n+     * @param isCopy  isCopy\n+     * @param processDefinitionIds   process definition ids\n+     * @param targetProjectName target project name\n      * @return copy result code\n      */\n-    @ApiOperation(value = \"copyProcessDefinition\", notes= \"COPY_PROCESS_DEFINITION_NOTES\")\n+    @ApiOperation(value = \"copyOrMoveProcessDefinition\", notes= \"COPY_OR_MOVE_PROCESS_DEFINITION_NOTES\")\n     @ApiImplicitParams({\n-            @ApiImplicitParam(name = \"processId\", value = \"PROCESS_DEFINITION_ID\", required = true, dataType = \"Int\", example = \"100\")\n+            @ApiImplicitParam(name = \"processDefinitionIds\", value = \"PROCESS_DEFINITION_IDS\", required = true, dataType = \"String\", example = \"3,4\")\n     })\n-    @PostMapping(value = \"/copy\")\n+    @PostMapping(value = \"/copy-or-move\")\n     @ResponseStatus(HttpStatus.OK)\n-    @ApiException(COPY_PROCESS_DEFINITION_ERROR)\n-    public Result copyProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n-                                        @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n-                                        @RequestParam(value = \"processId\", required = true) int processId) throws JsonProcessingException {\n-        logger.info(\"copy process definition, login user:{}, project name:{}, process definition id:{}\",\n-                loginUser.getUserName(), projectName, processId);\n-        Map<String, Object> result = processDefinitionService.copyProcessDefinition(loginUser, projectName, processId);\n-        return returnDataList(result);\n+    @ApiException(COPY_OR_MOVE_PROCESS_DEFINITION_ERROR)\n+    public Result copyOrMoveProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n+                                              @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                              @RequestParam(value = \"processDefinitionIds\", required = true) String processDefinitionIds,\n+                                              @RequestParam(value = \"targetProjectName\",required = true) String targetProjectName,\n+                                              @RequestParam(value = \"isCopy\", required = true) boolean isCopy)  {\n+\n+\n+        logger.info(\"batch {} process definition, login user:{}, project name:{}, process definition ids:{}\uff0ctarget project name:{}\",\n+                isCopy?\"copy\":\"move\",StringUtils.replaceNRTtoUnderline(loginUser.getUserName()), StringUtils.replaceNRTtoUnderline(projectName), StringUtils.replaceNRTtoUnderline(processDefinitionIds),StringUtils.replaceNRTtoUnderline(targetProjectName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyNzE2Nw=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMTg4MDQ0OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/enums/Status.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo1NDoxNFrOGiNo5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMzozMzozMFrOGmG9Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyODIzMA==", "bodyText": "10148 repeat\narranged in order", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r438528230", "createdAt": "2020-06-11T03:54:14Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/enums/Status.java", "diffHunk": "@@ -176,6 +176,10 @@\n     DELETE_WORKER_GROUP_FAIL(10147,\"delete worker group fail \", \"\u5220\u9664worker\u5206\u7ec4\u5931\u8d25\"),\n     COPY_PROCESS_DEFINITION_ERROR(10148,\"copy process definition error\", \"\u590d\u5236\u5de5\u4f5c\u6d41\u9519\u8bef\"),\n     USER_DISABLED(10149,\"The current user is disabled\", \"\u5f53\u524d\u7528\u6237\u5df2\u505c\u7528\"),\n+    QUERY_USER_CREATED_PROJECT_ERROR(10151,\"query user created project error error\", \"\u67e5\u8be2\u7528\u6237\u521b\u5efa\u7684\u9879\u76ee\u9519\u8bef\"),\n+    PROCESS_DEFINITION_IDS_IS_EMPTY(10152,\"process definition ids is empty\", \"\u5de5\u4f5c\u6d41IDS\u4e0d\u80fd\u4e3a\u7a7a\"),\n+    COPY_OR_MOVE_PROCESS_DEFINITION_ERROR(10148,\"copy or move process definition error\", \"\u590d\u5236\u6216\u8005\u79fb\u52a8\u5de5\u4f5c\u6d41\u9519\u8bef\"),\n+    MOVE_PROCESS_DEFINITION_ERROR(10150,\"move process definition error\", \"\u79fb\u52a8\u5de5\u4f5c\u6d41\u9519\u8bef\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYxMjk5NQ==", "bodyText": "problem fixed", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r442612995", "createdAt": "2020-06-19T03:33:30Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/enums/Status.java", "diffHunk": "@@ -176,6 +176,10 @@\n     DELETE_WORKER_GROUP_FAIL(10147,\"delete worker group fail \", \"\u5220\u9664worker\u5206\u7ec4\u5931\u8d25\"),\n     COPY_PROCESS_DEFINITION_ERROR(10148,\"copy process definition error\", \"\u590d\u5236\u5de5\u4f5c\u6d41\u9519\u8bef\"),\n     USER_DISABLED(10149,\"The current user is disabled\", \"\u5f53\u524d\u7528\u6237\u5df2\u505c\u7528\"),\n+    QUERY_USER_CREATED_PROJECT_ERROR(10151,\"query user created project error error\", \"\u67e5\u8be2\u7528\u6237\u521b\u5efa\u7684\u9879\u76ee\u9519\u8bef\"),\n+    PROCESS_DEFINITION_IDS_IS_EMPTY(10152,\"process definition ids is empty\", \"\u5de5\u4f5c\u6d41IDS\u4e0d\u80fd\u4e3a\u7a7a\"),\n+    COPY_OR_MOVE_PROCESS_DEFINITION_ERROR(10148,\"copy or move process definition error\", \"\u590d\u5236\u6216\u8005\u79fb\u52a8\u5de5\u4f5c\u6d41\u9519\u8bef\"),\n+    MOVE_PROCESS_DEFINITION_ERROR(10150,\"move process definition error\", \"\u79fb\u52a8\u5de5\u4f5c\u6d41\u9519\u8bef\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyODIzMA=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMTg4MTk3OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMzo1NToyMFrOGiNp5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMzo0MTo0MFrOGmHDvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyODQ4NQ==", "bodyText": "Annotate is wrong", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r438528485", "createdAt": "2020-06-11T03:55:20Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYxNDcxNw==", "bodyText": "problem fixed", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r442614717", "createdAt": "2020-06-19T03:41:40Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUyODQ4NQ=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMTg5MTg5OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNDowMjoyMVrOGiNv7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwMjoyMzo0NFrOGqpQuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUzMDAyOQ==", "bodyText": "It is recommended to use the project ID.\nFuture projects will be logic delete, The project name may be duplicated.", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r438530029", "createdAt": "2020-06-11T04:02:21Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     String targetProjectName) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n+\n+        ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n+        if (processDefinition == null) {\n+            putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n+            return result;\n+        } else {\n+            Project targetProject = projectMapper.queryByName(targetProjectName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYxNDc0MQ==", "bodyText": "problem fixed", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r442614741", "createdAt": "2020-06-19T03:41:46Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     String targetProjectName) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n+\n+        ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n+        if (processDefinition == null) {\n+            putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n+            return result;\n+        } else {\n+            Project targetProject = projectMapper.queryByName(targetProjectName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUzMDAyOQ=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ5ODI0Mg==", "bodyText": "Hi, This is not fixed.", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r446498242", "createdAt": "2020-06-27T07:49:02Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     String targetProjectName) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n+\n+        ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n+        if (processDefinition == null) {\n+            putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n+            return result;\n+        } else {\n+            Project targetProject = projectMapper.queryByName(targetProjectName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUzMDAyOQ=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzM2OTQwMA==", "bodyText": "What you see should be old code\uff0c the new code has fixed.", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r447369400", "createdAt": "2020-06-30T02:23:44Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     String targetProjectName) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n+\n+        ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n+        if (processDefinition == null) {\n+            putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n+            return result;\n+        } else {\n+            Project targetProject = projectMapper.queryByName(targetProjectName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUzMDAyOQ=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjA5NTQ3OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjowODozMVrOGiPsyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNzo1MDozM1rOGp0GNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2MTk5Mw==", "bodyText": "It is recommended the error message return project name.", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r438561993", "createdAt": "2020-06-11T06:08:31Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     String targetProjectName) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n+\n+        ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n+        if (processDefinition == null) {\n+            putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n+            return result;\n+        } else {\n+            Project targetProject = projectMapper.queryByName(targetProjectName);\n+            if(targetProject == null){\n+                putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectName);\n+                return result;\n+            }else{\n+                return createProcessDefinition(\n+                        loginUser,\n+                        targetProjectName,\n+                        processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n+                        processDefinition.getProcessDefinitionJson(),\n+                        processDefinition.getDescription(),\n+                        processDefinition.getLocations(),\n+                        processDefinition.getConnects());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectName targetProjectName\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          String targetProjectName, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, targetProjectName);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        if(!targetProjectName.equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProjectName);\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProjectName, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProjectName, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(result, failedIdList);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProjectName targetProjectName\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(String targetProjectName, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProjectName);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add(processDefinitionId);\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProjectName targetProjectName\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, String targetProjectName, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProjectName);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add(processDefinitionId);\n+                    logger.error((String) copyProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * check project and auth\n+     * @param loginUser\n+     * @param projectName\n+     * @return\n+     */\n+    private Map<String, Object> checkProjectAndAuth(User loginUser, String projectName) {\n         Project project = projectMapper.queryByName(projectName);\n \n+        //check user access for project\n         Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n         Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n+\n         if (resultStatus != Status.SUCCESS) {\n             return checkResult;\n         }\n+        return null;\n+    }\n+\n+    /**\n+     * move process definition\n+     * @param processId processId\n+     * @param targetProjectName targetProjectName\n+     * @return move result code\n+     */\n+    private Map<String, Object> moveProcessDefinition(Integer processId,\n+                                                     String targetProjectName) {\n+\n+        Map<String, Object> result = new HashMap<>(5);\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n-            return createProcessDefinition(\n-                    loginUser,\n-                    projectName,\n-                    processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n-                    processDefinition.getProcessDefinitionJson(),\n-                    processDefinition.getDescription(),\n-                    processDefinition.getLocations(),\n-                    processDefinition.getConnects());\n+            Project targetProject = projectMapper.queryByName(targetProjectName);\n+            if(targetProject == null){\n+                putMsg(result, Status.PROJECT_NOT_FOUNT, processId);\n+                return result;\n+            }else{\n+                processDefinition.setProjectId(targetProject.getId());\n+                processDefinition.setUpdateTime(new Date());\n+                if (processDefineMapper.updateById(processDefinition) > 0) {\n+                    putMsg(result, Status.SUCCESS);\n+                } else {\n+                    putMsg(result, Status.UPDATE_PROCESS_DEFINITION_ERROR);\n+                }\n+                return result;\n+            }\n+        }\n+    }\n+\n+    /**\n+     * check batch operate result\n+     * @param result\n+     * @param failedIdList\n+     */\n+    private void checkBatchOperateResult(Map<String, Object> result, List<String> failedIdList) {\n+        if (!failedIdList.isEmpty()) {\n+            putMsg(result, Status.MOVE_PROCESS_DEFINITION_ERROR, String.join(\",\", failedIdList));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 194}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYxNDg2OQ==", "bodyText": "already add project name", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r442614869", "createdAt": "2020-06-19T03:42:24Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     String targetProjectName) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n+\n+        ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n+        if (processDefinition == null) {\n+            putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n+            return result;\n+        } else {\n+            Project targetProject = projectMapper.queryByName(targetProjectName);\n+            if(targetProject == null){\n+                putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectName);\n+                return result;\n+            }else{\n+                return createProcessDefinition(\n+                        loginUser,\n+                        targetProjectName,\n+                        processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n+                        processDefinition.getProcessDefinitionJson(),\n+                        processDefinition.getDescription(),\n+                        processDefinition.getLocations(),\n+                        processDefinition.getConnects());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectName targetProjectName\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          String targetProjectName, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, targetProjectName);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        if(!targetProjectName.equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProjectName);\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProjectName, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProjectName, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(result, failedIdList);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProjectName targetProjectName\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(String targetProjectName, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProjectName);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add(processDefinitionId);\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProjectName targetProjectName\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, String targetProjectName, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProjectName);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add(processDefinitionId);\n+                    logger.error((String) copyProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * check project and auth\n+     * @param loginUser\n+     * @param projectName\n+     * @return\n+     */\n+    private Map<String, Object> checkProjectAndAuth(User loginUser, String projectName) {\n         Project project = projectMapper.queryByName(projectName);\n \n+        //check user access for project\n         Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n         Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n+\n         if (resultStatus != Status.SUCCESS) {\n             return checkResult;\n         }\n+        return null;\n+    }\n+\n+    /**\n+     * move process definition\n+     * @param processId processId\n+     * @param targetProjectName targetProjectName\n+     * @return move result code\n+     */\n+    private Map<String, Object> moveProcessDefinition(Integer processId,\n+                                                     String targetProjectName) {\n+\n+        Map<String, Object> result = new HashMap<>(5);\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n-            return createProcessDefinition(\n-                    loginUser,\n-                    projectName,\n-                    processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n-                    processDefinition.getProcessDefinitionJson(),\n-                    processDefinition.getDescription(),\n-                    processDefinition.getLocations(),\n-                    processDefinition.getConnects());\n+            Project targetProject = projectMapper.queryByName(targetProjectName);\n+            if(targetProject == null){\n+                putMsg(result, Status.PROJECT_NOT_FOUNT, processId);\n+                return result;\n+            }else{\n+                processDefinition.setProjectId(targetProject.getId());\n+                processDefinition.setUpdateTime(new Date());\n+                if (processDefineMapper.updateById(processDefinition) > 0) {\n+                    putMsg(result, Status.SUCCESS);\n+                } else {\n+                    putMsg(result, Status.UPDATE_PROCESS_DEFINITION_ERROR);\n+                }\n+                return result;\n+            }\n+        }\n+    }\n+\n+    /**\n+     * check batch operate result\n+     * @param result\n+     * @param failedIdList\n+     */\n+    private void checkBatchOperateResult(Map<String, Object> result, List<String> failedIdList) {\n+        if (!failedIdList.isEmpty()) {\n+            putMsg(result, Status.MOVE_PROCESS_DEFINITION_ERROR, String.join(\",\", failedIdList));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2MTk5Mw=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 194}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ5ODM1Nw==", "bodyText": "failedIdList -> failedNameList", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r446498357", "createdAt": "2020-06-27T07:50:33Z", "author": {"login": "wen-hemin"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,36 +295,188 @@ private String getResourceIds(ProcessData processData) {\n \n     /**\n      * copy process definition\n-     *\n      * @param loginUser   login user\n-     * @param projectName project name\n      * @param processId   process definition id\n      * @return copy result code\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     String targetProjectName) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n+\n+        ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n+        if (processDefinition == null) {\n+            putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n+            return result;\n+        } else {\n+            Project targetProject = projectMapper.queryByName(targetProjectName);\n+            if(targetProject == null){\n+                putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectName);\n+                return result;\n+            }else{\n+                return createProcessDefinition(\n+                        loginUser,\n+                        targetProjectName,\n+                        processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n+                        processDefinition.getProcessDefinitionJson(),\n+                        processDefinition.getDescription(),\n+                        processDefinition.getLocations(),\n+                        processDefinition.getConnects());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectName targetProjectName\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          String targetProjectName, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, targetProjectName);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        if(!targetProjectName.equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProjectName);\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProjectName, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProjectName, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(result, failedIdList);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProjectName targetProjectName\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(String targetProjectName, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProjectName);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add(processDefinitionId);\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProjectName targetProjectName\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, String targetProjectName, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProjectName);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add(processDefinitionId);\n+                    logger.error((String) copyProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * check project and auth\n+     * @param loginUser\n+     * @param projectName\n+     * @return\n+     */\n+    private Map<String, Object> checkProjectAndAuth(User loginUser, String projectName) {\n         Project project = projectMapper.queryByName(projectName);\n \n+        //check user access for project\n         Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n         Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n+\n         if (resultStatus != Status.SUCCESS) {\n             return checkResult;\n         }\n+        return null;\n+    }\n+\n+    /**\n+     * move process definition\n+     * @param processId processId\n+     * @param targetProjectName targetProjectName\n+     * @return move result code\n+     */\n+    private Map<String, Object> moveProcessDefinition(Integer processId,\n+                                                     String targetProjectName) {\n+\n+        Map<String, Object> result = new HashMap<>(5);\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n-            return createProcessDefinition(\n-                    loginUser,\n-                    projectName,\n-                    processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n-                    processDefinition.getProcessDefinitionJson(),\n-                    processDefinition.getDescription(),\n-                    processDefinition.getLocations(),\n-                    processDefinition.getConnects());\n+            Project targetProject = projectMapper.queryByName(targetProjectName);\n+            if(targetProject == null){\n+                putMsg(result, Status.PROJECT_NOT_FOUNT, processId);\n+                return result;\n+            }else{\n+                processDefinition.setProjectId(targetProject.getId());\n+                processDefinition.setUpdateTime(new Date());\n+                if (processDefineMapper.updateById(processDefinition) > 0) {\n+                    putMsg(result, Status.SUCCESS);\n+                } else {\n+                    putMsg(result, Status.UPDATE_PROCESS_DEFINITION_ERROR);\n+                }\n+                return result;\n+            }\n+        }\n+    }\n+\n+    /**\n+     * check batch operate result\n+     * @param result\n+     * @param failedIdList\n+     */\n+    private void checkBatchOperateResult(Map<String, Object> result, List<String> failedIdList) {\n+        if (!failedIdList.isEmpty()) {\n+            putMsg(result, Status.MOVE_PROCESS_DEFINITION_ERROR, String.join(\",\", failedIdList));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2MTk5Mw=="}, "originalCommit": {"oid": "a273966d4213ca48ae9234176b163d2528a06ae3"}, "originalPosition": 194}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODE4ODk3OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDoyODoxM1rOGnr86A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwMTozMDozNFrOGp5hGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Nzc1Mg==", "bodyText": "Hashmap does not recommend the initial value odd\uff0cNo need to initialize", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444267752", "createdAt": "2020-06-23T14:28:13Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxMDA1Mw==", "bodyText": "The initial value of HashMap in all Controller and Service in DolphinScheduler is 5, so if you want to modify it, then it is best to unify all changes after discussion\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\n\u5728DolphinScheduler\u4e2d\u6240\u6709\u7684Controller\u548cService\u4e2dHashMap\u7684\u521d\u59cb\u503c\u90fd\u4e3a5\uff0c\u6240\u4ee5\u5982\u679c\u8981\u4fee\u6539\u7684\u8bdd\uff0c\u90a3\u4e48\u6700\u597d\u7ecf\u8fc7\u8ba8\u8bba\u4ee5\u540e\uff0c\u7edf\u4e00\u5168\u90e8\u4fee\u6539", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444610053", "createdAt": "2020-06-24T02:30:03Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Nzc1Mg=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4MjgzNw==", "bodyText": "This was discussed before, you can send an email and change it in a unified way\n\u8fd9\u4e2a\u4e4b\u524d\u8ba8\u8bba\u8fc7\uff0c\u4f60\u53ef\u4ee5\u53d1\u4e2a\u90ae\u4ef6\uff0c\u7edf\u4e00\u6539\u4e86", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444682837", "createdAt": "2020-06-24T06:55:36Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Nzc1Mg=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NzE2MQ==", "bodyText": "OK!", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r446587161", "createdAt": "2020-06-28T01:30:34Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Nzc1Mg=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODI4MDcyOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NjozNlrOGns1pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NjozNlrOGns1pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MjI3Ng==", "bodyText": "Hashmap does not recommend the initial value odd\uff0cNo need to initialize", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444282276", "createdAt": "2020-06-23T14:46:36Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODI4MjYxOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0Njo1N1rOGns2yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0Njo1N1rOGns2yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MjU2OQ==", "bodyText": "Hashmap does not recommend the initial value odd\uff0cNo need to initialize", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444282569", "createdAt": "2020-06-23T14:46:57Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionControllerTest.java", "diffHunk": "@@ -179,16 +181,33 @@ public void testQueryProcessDefinitionById() throws Exception {\n     }\n \n     @Test\n-    public void testCopyProcessDefinition() throws Exception {\n+    public void testBatchCopyProcessDefinition() throws Exception {\n \n         String projectName = \"test\";\n-        int id = 1;\n+        int targetProjectId = 2;\n+        String id = \"1\";\n+\n+        Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODI4MzYwOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NzoxMFrOGns3fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NzoxMFrOGns3fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4Mjc0OA==", "bodyText": "Hashmap does not recommend the initial value odd\uff0cNo need to initialize", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444282748", "createdAt": "2020-06-23T14:47:10Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, processDefinitionIds);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        Project targetProject = projectMapper.queryDetailById(targetProjectId);\n+        if(targetProject == null){\n+            putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectId);\n+            return result;\n+        }\n+\n+        if(!(targetProject.getName()).equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProject.getName());\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProject, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProject, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(projectName,targetProject.getName(),result, failedIdList,isCopy);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) copyProcessDefinitionResult.get(Constants.MSG));\n+                    logger.error((String) copyProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * check project and auth\n+     * @param loginUser\n+     * @param projectName\n+     * @return\n+     */\n+    private Map<String, Object> checkProjectAndAuth(User loginUser, String projectName) {\n+        Project project = projectMapper.queryByName(projectName);\n+\n+        //check user access for project\n+        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n+        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n+\n+        if (resultStatus != Status.SUCCESS) {\n+            return checkResult;\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * move process definition\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return move result code\n+     */\n+    private Map<String, Object> moveProcessDefinition(Integer processId,\n+                                                     Project targetProject) {\n+\n+        Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 178}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODI4NTcyOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NzozN1rOGns4zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0NzozN1rOGns4zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MzA4Nw==", "bodyText": "Hashmap does not recommend the initial value odd\uff0cNo need to initialize", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444283087", "createdAt": "2020-06-23T14:47:37Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionServiceTest.java", "diffHunk": "@@ -224,8 +226,52 @@ public void testCopyProcessDefinition()  throws Exception{\n                 definition.getLocations(),\n                 definition.getConnects())).thenReturn(createProcessResult);\n \n-        Map<String, Object> successRes = processDefinitionService.copyProcessDefinition(loginUser,\n-                \"project_test1\", 46);\n+        Map<String, Object> successRes = processDefinitionService.batchCopyOrMoveProcessDefinition(loginUser,\"project_test1\",\n+                 \"46\",1,true);\n+\n+        Assert.assertEquals(Status.SUCCESS, successRes.get(Constants.STATUS));\n+    }\n+\n+    @Test\n+    public void testBatchMoveProcessDefinition()  throws Exception{\n+        String projectName = \"project_test1\";\n+        Mockito.when(projectMapper.queryByName(projectName)).thenReturn(getProject(projectName));\n+\n+        String projectName2 = \"project_test2\";\n+        Mockito.when(projectMapper.queryByName(projectName2)).thenReturn(getProject(projectName2));\n+\n+        int targetProjectId = 2;\n+        Mockito.when(projectMapper.queryDetailById(targetProjectId)).thenReturn(getProjectById(targetProjectId));\n+\n+        Project project = getProject(projectName);\n+        Project targetProject = getProjectById(targetProjectId);\n+\n+        User loginUser = new User();\n+        loginUser.setId(-1);\n+        loginUser.setUserType(UserType.GENERAL_USER);\n+\n+        Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODI4NzE4OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0Nzo1N1rOGns5yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo0Nzo1N1rOGns5yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MzMzNg==", "bodyText": "Hashmap does not recommend the initial value odd\uff0cNo need to initialize", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444283336", "createdAt": "2020-06-23T14:47:57Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionControllerTest.java", "diffHunk": "@@ -179,16 +181,33 @@ public void testQueryProcessDefinitionById() throws Exception {\n     }\n \n     @Test\n-    public void testCopyProcessDefinition() throws Exception {\n+    public void testBatchCopyProcessDefinition() throws Exception {\n \n         String projectName = \"test\";\n-        int id = 1;\n+        int targetProjectId = 2;\n+        String id = \"1\";\n+\n+        Map<String, Object> result = new HashMap<>(5);\n+        putMsg(result, Status.SUCCESS);\n+\n+        Mockito.when(processDefinitionService.batchCopyOrMoveProcessDefinition(user,projectName,id,targetProjectId,true)).thenReturn(result);\n+        Result response = processDefinitionController.copyOrMoveProcessDefinition(user, projectName,id,targetProjectId,true);\n+\n+        Assert.assertEquals(Status.SUCCESS.getCode(),response.getCode().intValue());\n+    }\n+\n+    @Test\n+    public void testBatchMoveProcessDefinition() throws Exception {\n+\n+        String projectName = \"test\";\n+        int targetProjectId = 2;\n+        String id = \"1\";\n \n         Map<String, Object> result = new HashMap<>(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODMzMTg2OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDo1NzoyNFrOGntW7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMjowMTowMVrOGoPElA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5MDc5Nw==", "bodyText": "i think failedIdList   should store the id, but there added may be a failed description statement not the id", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444290797", "createdAt": "2020-06-23T14:57:24Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, processDefinitionIds);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        Project targetProject = projectMapper.queryDetailById(targetProjectId);\n+        if(targetProject == null){\n+            putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectId);\n+            return result;\n+        }\n+\n+        if(!(targetProject.getName()).equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProject.getName());\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProject, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProject, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(projectName,targetProject.getName(),result, failedIdList,isCopy);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) copyProcessDefinitionResult.get(Constants.MSG));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwODE2NA==", "bodyText": "In my opinion, simply returning the id does not fully express the reason for the failure, I designed it to return a more complete cause of the error\n\n\u5728\u6211\u770b\u6765\uff0c\u4ec5\u4ec5\u8fd4\u56deid\u5e76\u4e0d\u80fd\u5b8c\u5168\u8868\u8fbe\u5931\u8d25\u7684\u539f\u56e0\uff0c\u6211\u8fd9\u4e48\u8bbe\u8ba1\u662f\u4e3a\u4e86\u8fd4\u56de\u66f4\u52a0\u5b8c\u6574\u7684\u9519\u8bef\u539f\u56e0", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444608164", "createdAt": "2020-06-24T02:22:57Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, processDefinitionIds);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        Project targetProject = projectMapper.queryDetailById(targetProjectId);\n+        if(targetProject == null){\n+            putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectId);\n+            return result;\n+        }\n+\n+        if(!(targetProject.getName()).equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProject.getName());\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProject, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProject, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(projectName,targetProject.getName(),result, failedIdList,isCopy);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) copyProcessDefinitionResult.get(Constants.MSG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5MDc5Nw=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NjMzNQ==", "bodyText": "I have two questions:\n1 Follow your current design. There may be a splicing return. Part of the error description and part of the id situation are not clear.\n2 I think that the id should not be returned here, the process name should be returned, and the front end should be prompted, which of the several process errors is ok. If the id is returned, the front-end operator does not understand which process problem these id refers to\n\u6211\u6709\u4e24\u70b9\u7591\u95ee\uff0c\n1 \u6309\u7167\u4f60\u73b0\u5728\u8bbe\u8ba1\u3002\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u62fc\u63a5\u8fd4\u56de \u4e00\u90e8\u5206\u662f\u9519\u8bef\u63cf\u8ff0\uff0c\u4e00\u90e8\u5206\u662fid\u60c5\u51b5 ,\u8fd9\u6837\u63cf\u8ff0\u4e0d\u6e05\u6670\u4e86\u3002\n2 \u6211\u89c9\u5f97\u8fd9\u91cc\u4e0d\u5e94\u8be5\u8fd4\u56deid\uff0c\u5e94\u8be5\u8fd4\u56de\u6d41\u7a0b\u540d\u79f0\u3002\u7ed9\u524d\u7aef\u63d0\u793a\uff0c\u54ea\u4e2a\u51e0\u4e2a\u6d41\u7a0b\u9519\u8bef\u5c31ok\u4e86\uff0c\u5982\u679c\u8fd4\u56deid\uff0c\u524d\u7aef\u64cd\u4f5c\u4eba\u5458\u4e5f\u4e0d\u7406\u89e3\u8fd9\u4e9bid\u6307\u7684\u662f\u54ea\u4e2a\u6d41\u7a0b\u95ee\u9898\u3002\u4f60\u89c9\u5f97\u4e86", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444686335", "createdAt": "2020-06-24T07:03:42Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, processDefinitionIds);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        Project targetProject = projectMapper.queryDetailById(targetProjectId);\n+        if(targetProject == null){\n+            putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectId);\n+            return result;\n+        }\n+\n+        if(!(targetProject.getName()).equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProject.getName());\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProject, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProject, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(projectName,targetProject.getName(),result, failedIdList,isCopy);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) copyProcessDefinitionResult.get(Constants.MSG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5MDc5Nw=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg0MzE1Ng==", "bodyText": "I have changed it to the name of the workflow that returned the error. If the error information is returned, it cannot be ruled out that the information is incomplete\n\u6211\u5df2\u7ecf\u5c06\u5176\u4fee\u6539\u4e3a\u8fd4\u56de\u51fa\u9519\u7684\u5de5\u4f5c\u6d41\u540d\u79f0\u4e86\uff0c\u8fd4\u56de\u9519\u8bef\u63cf\u8ff0\u7684\u8bdd\u786e\u5b9e\u4e0d\u80fd\u6392\u9664\u4fe1\u606f\u4e0d\u5b8c\u6574\u7684\u60c5\u51b5\n\u4f8b\u5b50\uff1a\u5982\u679c\u5de5\u4f5c\u6d41\u4e0d\u5b58\u5728\u7684\u8bdd\uff0c\u8fd4\u56de\u7684\u4fe1\u606f\u5982\u4e0b\uff1a\n\u4eceproject_test1\u590d\u5236\u5de5\u4f5c\u6d41\u5230project_test1\u9519\u8bef : 47[null]", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444843156", "createdAt": "2020-06-24T12:01:01Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -295,38 +294,209 @@ private String getResourceIds(ProcessData processData) {\n     /**\n      * copy process definition\n      *\n-     * @param loginUser   login user\n-     * @param projectName project name\n-     * @param processId   process definition id\n-     * @return copy result code\n+     * @param loginUser loginUser\n+     * @param processId processId\n+     * @param targetProject targetProject\n+     * @return\n+     * @throws JsonProcessingException\n      */\n-    public Map<String, Object> copyProcessDefinition(User loginUser, String projectName, Integer processId) throws JsonProcessingException {\n+    private Map<String, Object> copyProcessDefinition(User loginUser,\n+                                                     Integer processId,\n+                                                     Project targetProject) throws JsonProcessingException {\n \n         Map<String, Object> result = new HashMap<>(5);\n-        Project project = projectMapper.queryByName(projectName);\n-\n-        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n-        Status resultStatus = (Status) checkResult.get(Constants.STATUS);\n-        if (resultStatus != Status.SUCCESS) {\n-            return checkResult;\n-        }\n \n         ProcessDefinition processDefinition = processDefineMapper.selectById(processId);\n         if (processDefinition == null) {\n             putMsg(result, Status.PROCESS_DEFINE_NOT_EXIST, processId);\n             return result;\n         } else {\n+\n             return createProcessDefinition(\n                     loginUser,\n-                    projectName,\n+                    targetProject.getName(),\n                     processDefinition.getName() + \"_copy_\" + System.currentTimeMillis(),\n                     processDefinition.getProcessDefinitionJson(),\n                     processDefinition.getDescription(),\n                     processDefinition.getLocations(),\n                     processDefinition.getConnects());\n+\n+        }\n+    }\n+\n+    /**\n+     * batch copy or move process definition\n+     * @param loginUser loginUser\n+     * @param projectName projectName\n+     * @param processDefinitionIds processDefinitionIds\n+     * @param targetProjectId targetProjectId\n+     * @param isCopy isCopy\n+     * @return\n+     */\n+    public Map<String, Object> batchCopyOrMoveProcessDefinition(User loginUser,\n+                                                          String projectName,\n+                                                          String processDefinitionIds,\n+                                                          int targetProjectId, boolean isCopy){\n+        Map<String, Object> result = new HashMap<>(5);\n+        List<String> failedIdList = new ArrayList<>();\n+\n+        if (StringUtils.isEmpty(processDefinitionIds)) {\n+            putMsg(result, Status.PROCESS_DEFINITION_IDS_IS_EMPTY, processDefinitionIds);\n+            return result;\n+        }\n+\n+        //check src project auth\n+        Map<String, Object> checkResult = checkProjectAndAuth(loginUser, projectName);\n+        if (checkResult != null) {\n+            return checkResult;\n+        }\n+\n+        Project targetProject = projectMapper.queryDetailById(targetProjectId);\n+        if(targetProject == null){\n+            putMsg(result, Status.PROJECT_NOT_FOUNT, targetProjectId);\n+            return result;\n+        }\n+\n+        if(!(targetProject.getName()).equals(projectName)){\n+            Map<String, Object> checkTargetProjectResult = checkProjectAndAuth(loginUser, targetProject.getName());\n+            if (checkTargetProjectResult != null) {\n+                return checkTargetProjectResult;\n+            }\n+        }\n+\n+        String[] processDefinitionIdList = processDefinitionIds.split(Constants.COMMA);\n+        if(isCopy){\n+            doBatchCopyProcessDefinition(loginUser, targetProject, failedIdList, processDefinitionIdList);\n+        }else{\n+            doBatchMoveProcessDefinition(targetProject, failedIdList, processDefinitionIdList);\n+        }\n+\n+        checkBatchOperateResult(projectName,targetProject.getName(),result, failedIdList,isCopy);\n+\n+        return result;\n+    }\n+\n+    /**\n+     * batch move process definition\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchMoveProcessDefinition(Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> moveProcessDefinitionResult =\n+                        moveProcessDefinition(Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(moveProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                    logger.error((String) moveProcessDefinitionResult.get(Constants.MSG));\n+                }\n+            } catch (Exception e) {\n+                failedIdList.add(processDefinitionId);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * batch copy process definition\n+     * @param loginUser loginUser\n+     * @param targetProject targetProject\n+     * @param failedIdList failedIdList\n+     * @param processDefinitionIdList processDefinitionIdList\n+     */\n+    private void doBatchCopyProcessDefinition(User loginUser, Project targetProject, List<String> failedIdList, String[] processDefinitionIdList) {\n+        for(String processDefinitionId:processDefinitionIdList){\n+            try {\n+                Map<String, Object> copyProcessDefinitionResult =\n+                        copyProcessDefinition(loginUser,Integer.valueOf(processDefinitionId),targetProject);\n+                if (!Status.SUCCESS.equals(copyProcessDefinitionResult.get(Constants.STATUS))) {\n+                    failedIdList.add((String) copyProcessDefinitionResult.get(Constants.MSG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5MDc5Nw=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODM2NTc1OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProjectService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNTowNToyNFrOGnttXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTozNjoxN1rOGoOUjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5NjU0MA==", "bodyText": "Modify note description", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444296540", "createdAt": "2020-06-23T15:05:24Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProjectService.java", "diffHunk": "@@ -43,7 +43,7 @@\n  *HttpTask./", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgzMDg2Mg==", "bodyText": "Makes no sense, I changed it back", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444830862", "createdAt": "2020-06-24T11:36:17Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProjectService.java", "diffHunk": "@@ -43,7 +43,7 @@\n  *HttpTask./", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5NjU0MA=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODQzNDE1OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProjectController.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNToyMTowOFrOGnuZZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzozODozNFrOGoGgUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwNzgxNQ==", "bodyText": "queryProjectCreatedByUser can define a parameter, you can not userid", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444307815", "createdAt": "2020-06-23T15:21:08Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProjectController.java", "diffHunk": "@@ -226,6 +227,23 @@ public Result queryAuthorizedProject(@ApiIgnore @RequestAttribute(value = Consta\n         return returnDataList(result);\n     }\n \n+    /**\n+     * query user created project\n+     *\n+     * @param loginUser login user\n+     * @return projects which the user create\n+     */\n+    @ApiOperation(value = \"queryProjectCreatedByUser\", notes = \"QUERY_USER_CREATED_PROJECT_NOTES\")\n+\n+    @GetMapping(value = \"/login-user-created-project\")\n+    @ResponseStatus(HttpStatus.OK)\n+    @ApiException(QUERY_USER_CREATED_PROJECT_ERROR)\n+    public Result queryProjectCreatedByUser(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser) {\n+        logger.info(\"login user {}, query authorized project by user id: {}.\", StringUtils.replaceNRTtoUnderline(loginUser.getUserName()), StringUtils.replaceNRTtoUnderline(String.valueOf(loginUser.getId())));\n+        Map<String, Object> result = projectService.queryProjectCreatedByUser(loginUser, loginUser.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYxMjE3Mg==", "bodyText": "The purpose of this function design is to get the project created by the logged-in user, so I think there is no problem using userid\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\n\u8fd9\u4e2a\u51fd\u6570\u8bbe\u8ba1\u7684\u76ee\u7684\u5c31\u662f\u83b7\u53d6\u767b\u5f55\u7528\u6237\u6240\u521b\u5efa\u7684\u9879\u76ee\uff0c\u6240\u4ee5\u6211\u8ba4\u4e3a\u4f7f\u7528userid\u6ca1\u6709\u95ee\u9898", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444612172", "createdAt": "2020-06-24T02:38:39Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProjectController.java", "diffHunk": "@@ -226,6 +227,23 @@ public Result queryAuthorizedProject(@ApiIgnore @RequestAttribute(value = Consta\n         return returnDataList(result);\n     }\n \n+    /**\n+     * query user created project\n+     *\n+     * @param loginUser login user\n+     * @return projects which the user create\n+     */\n+    @ApiOperation(value = \"queryProjectCreatedByUser\", notes = \"QUERY_USER_CREATED_PROJECT_NOTES\")\n+\n+    @GetMapping(value = \"/login-user-created-project\")\n+    @ResponseStatus(HttpStatus.OK)\n+    @ApiException(QUERY_USER_CREATED_PROJECT_ERROR)\n+    public Result queryProjectCreatedByUser(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser) {\n+        logger.info(\"login user {}, query authorized project by user id: {}.\", StringUtils.replaceNRTtoUnderline(loginUser.getUserName()), StringUtils.replaceNRTtoUnderline(String.valueOf(loginUser.getId())));\n+        Map<String, Object> result = projectService.queryProjectCreatedByUser(loginUser, loginUser.getId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwNzgxNQ=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4MjE4Ng==", "bodyText": "queryProjectCreatedByUser \u65b9\u6cd5\u5176\u5b9e\u4f20loginUser \u503c\u5c31\u53ef\u4ee5\u4e86\u554a\u3002\u5728\u65b9\u6cd5\u91cc\u9762\u76f4\u63a5loginUser.getId() \u83b7\u53d6userid\u3002\u4e0d\u5f71\u54cd\u529f\u80fd\u554a\u3002", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444682186", "createdAt": "2020-06-24T06:54:05Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProjectController.java", "diffHunk": "@@ -226,6 +227,23 @@ public Result queryAuthorizedProject(@ApiIgnore @RequestAttribute(value = Consta\n         return returnDataList(result);\n     }\n \n+    /**\n+     * query user created project\n+     *\n+     * @param loginUser login user\n+     * @return projects which the user create\n+     */\n+    @ApiOperation(value = \"queryProjectCreatedByUser\", notes = \"QUERY_USER_CREATED_PROJECT_NOTES\")\n+\n+    @GetMapping(value = \"/login-user-created-project\")\n+    @ResponseStatus(HttpStatus.OK)\n+    @ApiException(QUERY_USER_CREATED_PROJECT_ERROR)\n+    public Result queryProjectCreatedByUser(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser) {\n+        logger.info(\"login user {}, query authorized project by user id: {}.\", StringUtils.replaceNRTtoUnderline(loginUser.getUserName()), StringUtils.replaceNRTtoUnderline(String.valueOf(loginUser.getId())));\n+        Map<String, Object> result = projectService.queryProjectCreatedByUser(loginUser, loginUser.getId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwNzgxNQ=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwMjgwMg==", "bodyText": "You're right", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r444702802", "createdAt": "2020-06-24T07:38:34Z", "author": {"login": "zixi0825"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProjectController.java", "diffHunk": "@@ -226,6 +227,23 @@ public Result queryAuthorizedProject(@ApiIgnore @RequestAttribute(value = Consta\n         return returnDataList(result);\n     }\n \n+    /**\n+     * query user created project\n+     *\n+     * @param loginUser login user\n+     * @return projects which the user create\n+     */\n+    @ApiOperation(value = \"queryProjectCreatedByUser\", notes = \"QUERY_USER_CREATED_PROJECT_NOTES\")\n+\n+    @GetMapping(value = \"/login-user-created-project\")\n+    @ResponseStatus(HttpStatus.OK)\n+    @ApiException(QUERY_USER_CREATED_PROJECT_ERROR)\n+    public Result queryProjectCreatedByUser(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser) {\n+        logger.info(\"login user {}, query authorized project by user id: {}.\", StringUtils.replaceNRTtoUnderline(loginUser.getUserName()), StringUtils.replaceNRTtoUnderline(String.valueOf(loginUser.getId())));\n+        Map<String, Object> result = projectService.queryProjectCreatedByUser(loginUser, loginUser.getId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwNzgxNQ=="}, "originalCommit": {"oid": "d49376b9f64a24b27f82915094aab6749ce0b066"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTM1MDIwOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/BaseService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjoyNjo1NlrOG4KITA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjoyNjo1NlrOG4KITA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUzOTQwNA==", "bodyText": "Hi,\nPlease revert this blank.", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r461539404", "createdAt": "2020-07-28T12:26:56Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/BaseService.java", "diffHunk": "@@ -32,7 +32,7 @@\n /**\n  * base service\n  */\n-public class BaseService {\n+public class BaseService{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76cf566b1abc022330ee2ec6b51ccf3b36edd1ea"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTM1MDIzOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/BaseService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjoyNjo1N1rOG4KIUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjoyNjo1N1rOG4KIUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUzOTQxMA==", "bodyText": "Hi,\nPlease revert this blank.", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r461539410", "createdAt": "2020-07-28T12:26:57Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/BaseService.java", "diffHunk": "@@ -32,7 +32,7 @@\n /**\n  * base service\n  */\n-public class BaseService {\n+public class BaseService{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76cf566b1abc022330ee2ec6b51ccf3b36edd1ea"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTM1NjY0OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjoyODo0MlrOG4KMOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjoyODo0MlrOG4KMOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU0MDQxMQ==", "bodyText": "Please revert this changes", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r461540411", "createdAt": "2020-07-28T12:28:42Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessDefinitionService.java", "diffHunk": "@@ -1256,7 +1427,7 @@ public void importSubProcess(User loginUser, Project targetProject, ArrayNode js\n      * @return tree view json data\n      * @throws Exception exception\n      */\n-    public Map<String, Object> viewTree(Integer processId, Integer limit) throws Exception {\n+    public Map<String, Object> viewTree(Integer processId, Integer limit) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76cf566b1abc022330ee2ec6b51ccf3b36edd1ea"}, "originalPosition": 324}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTc2OTM0OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDowMzoyNlrOG4OI0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDowMzoyNlrOG4OI0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYwNTA3Mw==", "bodyText": "Hi,\nWill it be better to split copy and move to two api for single responsibility?", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r461605073", "createdAt": "2020-07-28T14:03:26Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "diffHunk": "@@ -95,27 +95,39 @@ public Result createProcessDefinition(@ApiIgnore @RequestAttribute(value = Const\n     }\n \n     /**\n-     * copy process definition\n+     * copy or move process definition\n      *\n      * @param loginUser   login user\n      * @param projectName project name\n-     * @param processId   process definition id\n+     * @param isCopy  isCopy\n+     * @param processDefinitionIds   process definition ids\n+     * @param targetProjectId target project id\n      * @return copy result code\n      */\n-    @ApiOperation(value = \"copyProcessDefinition\", notes= \"COPY_PROCESS_DEFINITION_NOTES\")\n+    @ApiOperation(value = \"copyOrMoveProcessDefinition\", notes= \"COPY_OR_MOVE_PROCESS_DEFINITION_NOTES\")\n     @ApiImplicitParams({\n-            @ApiImplicitParam(name = \"processId\", value = \"PROCESS_DEFINITION_ID\", required = true, dataType = \"Int\", example = \"100\")\n+            @ApiImplicitParam(name = \"processDefinitionIds\", value = \"PROCESS_DEFINITION_IDS\", required = true, dataType = \"String\", example = \"3,4\"),\n+            @ApiImplicitParam(name = \"targetProjectId\", value = \"TARGET_PROJECT_ID\", required = true, type = \"Integer\"),\n+            @ApiImplicitParam(name = \"isCopy\", value = \"IS_COPY\", required = true, type = \"boolean\")\n     })\n-    @PostMapping(value = \"/copy\")\n+    @PostMapping(value = \"/copy-or-move\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76cf566b1abc022330ee2ec6b51ccf3b36edd1ea"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTc3MTY3OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDowMzo1NVrOG4OKMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDowMzo1NVrOG4OKMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYwNTQyNA==", "bodyText": "Please revert this changes.", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r461605424", "createdAt": "2020-07-28T14:03:55Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "diffHunk": "@@ -205,9 +217,9 @@ public Result updateProcessDefinition(@ApiIgnore @RequestAttribute(value = Const\n     @ResponseStatus(HttpStatus.OK)\n     @ApiException(RELEASE_PROCESS_DEFINITION_ERROR)\n     public Result releaseProcessDefinition(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n-                                            @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n-                                            @RequestParam(value = \"processId\", required = true) int processId,\n-                                            @RequestParam(value = \"releaseState\", required = true) int releaseState) {\n+                                           @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                           @RequestParam(value = \"processId\", required = true) int processId,\n+                                           @RequestParam(value = \"releaseState\", required = true) int releaseState) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76cf566b1abc022330ee2ec6b51ccf3b36edd1ea"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTc4NDkwOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDowNjo1MFrOG4OSfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDowNjo1MFrOG4OSfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYwNzU1MA==", "bodyText": "Please revert the changes about blank, thx a lot, it is suggested to add the blank according to the checkstyle.xml, you can configure the checkstyle.xml[1] to your ide.\n[1] https://github.com/apache/incubator-dolphinscheduler/blob/dev/style/checkstyle.xml", "url": "https://github.com/apache/dolphinscheduler/pull/2884#discussion_r461607550", "createdAt": "2020-07-28T14:06:50Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessDefinitionController.java", "diffHunk": "@@ -231,8 +243,8 @@ public Result releaseProcessDefinition(@ApiIgnore @RequestAttribute(value = Cons\n     @ResponseStatus(HttpStatus.OK)\n     @ApiException(QUERY_DATAIL_OF_PROCESS_DEFINITION_ERROR)\n     public Result queryProcessDefinitionById(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n-                                              @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n-                                              @RequestParam(\"processId\") Integer processId\n+                                             @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                             @RequestParam(\"processId\") Integer processId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76cf566b1abc022330ee2ec6b51ccf3b36edd1ea"}, "originalPosition": 121}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3498, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}