{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MDI5NDc5", "number": 3746, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MDo0MFrOEj4riA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MjoyOFrOEj4swQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MDY0MjY0OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/TaskManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MDo0MFrOHSf8Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTozMzoyOFrOHSohng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTc2Mg==", "bodyText": "it will be better to use log pattern\uff0cnot string format.", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489159762", "createdAt": "2020-09-16T04:50:40Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/TaskManager.java", "diffHunk": "@@ -69,8 +74,9 @@ public static AbstractTask newTask(TaskExecutionContext taskExecutionContext, Lo\n             case SQOOP:\n                 return new SqoopTask(taskExecutionContext, logger);\n             default:\n-                logger.error(\"unsupport task type: {}\", taskExecutionContext.getTaskType());\n-                throw new IllegalArgumentException(\"not support task type\");\n+                String msg = String.format(\"not support task type: %s\", taskExecutionContext.getTaskType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMDM4Mg==", "bodyText": "done", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489300382", "createdAt": "2020-09-16T09:33:28Z", "author": {"login": "zhuangchong"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/TaskManager.java", "diffHunk": "@@ -69,8 +74,9 @@ public static AbstractTask newTask(TaskExecutionContext taskExecutionContext, Lo\n             case SQOOP:\n                 return new SqoopTask(taskExecutionContext, logger);\n             default:\n-                logger.error(\"unsupport task type: {}\", taskExecutionContext.getTaskType());\n-                throw new IllegalArgumentException(\"not support task type\");\n+                String msg = String.format(\"not support task type: %s\", taskExecutionContext.getTaskType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTc2Mg=="}, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MDY0MzIxOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/TaskParametersUtils.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MTowMFrOHSf8pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTozNjoxNlrOHSooWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTg0NQ==", "bodyText": "Why not throw InvalidArgumentException?", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489159845", "createdAt": "2020-09-16T04:51:00Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/TaskParametersUtils.java", "diffHunk": "@@ -55,41 +55,42 @@ private TaskParametersUtils() {\n      * @return task parameters\n      */\n     public static AbstractParameters getParameters(String taskType, String parameter) {\n-        try {\n-            switch (EnumUtils.getEnum(TaskType.class, taskType)) {\n-                case SUB_PROCESS:\n-                    return JSONUtils.parseObject(parameter, SubProcessParameters.class);\n-                case SHELL:\n-                case WATERDROP:\n-                    return JSONUtils.parseObject(parameter, ShellParameters.class);\n-                case PROCEDURE:\n-                    return JSONUtils.parseObject(parameter, ProcedureParameters.class);\n-                case SQL:\n-                    return JSONUtils.parseObject(parameter, SqlParameters.class);\n-                case MR:\n-                    return JSONUtils.parseObject(parameter, MapreduceParameters.class);\n-                case SPARK:\n-                    return JSONUtils.parseObject(parameter, SparkParameters.class);\n-                case PYTHON:\n-                    return JSONUtils.parseObject(parameter, PythonParameters.class);\n-                case DEPENDENT:\n-                    return JSONUtils.parseObject(parameter, DependentParameters.class);\n-                case FLINK:\n-                    return JSONUtils.parseObject(parameter, FlinkParameters.class);\n-                case HTTP:\n-                    return JSONUtils.parseObject(parameter, HttpParameters.class);\n-                case DATAX:\n-                    return JSONUtils.parseObject(parameter, DataxParameters.class);\n-                case CONDITIONS:\n-                    return JSONUtils.parseObject(parameter, ConditionsParameters.class);\n-                case SQOOP:\n-                    return JSONUtils.parseObject(parameter, SqoopParameters.class);\n-                default:\n-                    return null;\n-            }\n-        } catch (Exception e) {\n-            logger.error(e.getMessage(), e);\n+        TaskType anEnum = EnumUtils.getEnum(TaskType.class, taskType);\n+        if (anEnum == null) {\n+            logger.error(\"not support task type: {}\", taskType);\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2MDIyNw==", "bodyText": "Why not throw InvalidArgumentException?\n\n+1\uff0c fail fast will be better.", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489160227", "createdAt": "2020-09-16T04:52:31Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/TaskParametersUtils.java", "diffHunk": "@@ -55,41 +55,42 @@ private TaskParametersUtils() {\n      * @return task parameters\n      */\n     public static AbstractParameters getParameters(String taskType, String parameter) {\n-        try {\n-            switch (EnumUtils.getEnum(TaskType.class, taskType)) {\n-                case SUB_PROCESS:\n-                    return JSONUtils.parseObject(parameter, SubProcessParameters.class);\n-                case SHELL:\n-                case WATERDROP:\n-                    return JSONUtils.parseObject(parameter, ShellParameters.class);\n-                case PROCEDURE:\n-                    return JSONUtils.parseObject(parameter, ProcedureParameters.class);\n-                case SQL:\n-                    return JSONUtils.parseObject(parameter, SqlParameters.class);\n-                case MR:\n-                    return JSONUtils.parseObject(parameter, MapreduceParameters.class);\n-                case SPARK:\n-                    return JSONUtils.parseObject(parameter, SparkParameters.class);\n-                case PYTHON:\n-                    return JSONUtils.parseObject(parameter, PythonParameters.class);\n-                case DEPENDENT:\n-                    return JSONUtils.parseObject(parameter, DependentParameters.class);\n-                case FLINK:\n-                    return JSONUtils.parseObject(parameter, FlinkParameters.class);\n-                case HTTP:\n-                    return JSONUtils.parseObject(parameter, HttpParameters.class);\n-                case DATAX:\n-                    return JSONUtils.parseObject(parameter, DataxParameters.class);\n-                case CONDITIONS:\n-                    return JSONUtils.parseObject(parameter, ConditionsParameters.class);\n-                case SQOOP:\n-                    return JSONUtils.parseObject(parameter, SqoopParameters.class);\n-                default:\n-                    return null;\n-            }\n-        } catch (Exception e) {\n-            logger.error(e.getMessage(), e);\n+        TaskType anEnum = EnumUtils.getEnum(TaskType.class, taskType);\n+        if (anEnum == null) {\n+            logger.error(\"not support task type: {}\", taskType);\n+            return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTg0NQ=="}, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMjEwNQ==", "bodyText": "This method is called by multiple methods in the project, which has a big impact. It still returns null according to the original logic of the method. This time, we mainly deal with the switch null pointer problem.\n\n\u8fd9\u4e2a\u65b9\u6cd5\u88ab\u9879\u76ee\u91cc\u9762\u591a\u4e2a\u65b9\u6cd5\u8c03\u7528\uff0c\u5f71\u54cd\u5927\uff0c\u8fd8\u662f\u6309\u65b9\u6cd5\u539f\u903b\u8f91\u8fd4\u56denull,\u672c\u6b21\u4e3b\u8981\u5904\u7406switch \u7a7a\u6307\u9488\u95ee\u9898\u3002", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489302105", "createdAt": "2020-09-16T09:36:16Z", "author": {"login": "zhuangchong"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/TaskParametersUtils.java", "diffHunk": "@@ -55,41 +55,42 @@ private TaskParametersUtils() {\n      * @return task parameters\n      */\n     public static AbstractParameters getParameters(String taskType, String parameter) {\n-        try {\n-            switch (EnumUtils.getEnum(TaskType.class, taskType)) {\n-                case SUB_PROCESS:\n-                    return JSONUtils.parseObject(parameter, SubProcessParameters.class);\n-                case SHELL:\n-                case WATERDROP:\n-                    return JSONUtils.parseObject(parameter, ShellParameters.class);\n-                case PROCEDURE:\n-                    return JSONUtils.parseObject(parameter, ProcedureParameters.class);\n-                case SQL:\n-                    return JSONUtils.parseObject(parameter, SqlParameters.class);\n-                case MR:\n-                    return JSONUtils.parseObject(parameter, MapreduceParameters.class);\n-                case SPARK:\n-                    return JSONUtils.parseObject(parameter, SparkParameters.class);\n-                case PYTHON:\n-                    return JSONUtils.parseObject(parameter, PythonParameters.class);\n-                case DEPENDENT:\n-                    return JSONUtils.parseObject(parameter, DependentParameters.class);\n-                case FLINK:\n-                    return JSONUtils.parseObject(parameter, FlinkParameters.class);\n-                case HTTP:\n-                    return JSONUtils.parseObject(parameter, HttpParameters.class);\n-                case DATAX:\n-                    return JSONUtils.parseObject(parameter, DataxParameters.class);\n-                case CONDITIONS:\n-                    return JSONUtils.parseObject(parameter, ConditionsParameters.class);\n-                case SQOOP:\n-                    return JSONUtils.parseObject(parameter, SqoopParameters.class);\n-                default:\n-                    return null;\n-            }\n-        } catch (Exception e) {\n-            logger.error(e.getMessage(), e);\n+        TaskType anEnum = EnumUtils.getEnum(TaskType.class, taskType);\n+        if (anEnum == null) {\n+            logger.error(\"not support task type: {}\", taskType);\n+            return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTg0NQ=="}, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MDY0NTc3OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/worker/task/TaskManagerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MjoyOFrOHSf-Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTozMzoyMlrOHSohUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2MDIxMQ==", "bodyText": "The best practice for this should be @test(expected= IllegalArgumentException.class)", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489160211", "createdAt": "2020-09-16T04:52:28Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/worker/task/TaskManagerTest.java", "diffHunk": "@@ -95,9 +97,19 @@ public void testNewTask() {\n         Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n         taskExecutionContext.setTaskType(\"SQOOP\");\n         Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n-        //taskExecutionContext.setTaskType(null);\n-        //Assert.assertNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n-        //taskExecutionContext.setTaskType(\"XXX\");\n-        //Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n+        try {\n+            taskExecutionContext.setTaskType(null);\n+            TaskManager.newTask(taskExecutionContext,taskLogger);\n+        } catch (Exception e) {\n+            logger.error(e.getMessage());\n+        }\n+\n+        try {\n+            taskExecutionContext.setTaskType(\"XXX\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMDMwNg==", "bodyText": "done", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489300306", "createdAt": "2020-09-16T09:33:22Z", "author": {"login": "zhuangchong"}, "path": "dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/worker/task/TaskManagerTest.java", "diffHunk": "@@ -95,9 +97,19 @@ public void testNewTask() {\n         Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n         taskExecutionContext.setTaskType(\"SQOOP\");\n         Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n-        //taskExecutionContext.setTaskType(null);\n-        //Assert.assertNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n-        //taskExecutionContext.setTaskType(\"XXX\");\n-        //Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n+        try {\n+            taskExecutionContext.setTaskType(null);\n+            TaskManager.newTask(taskExecutionContext,taskLogger);\n+        } catch (Exception e) {\n+            logger.error(e.getMessage());\n+        }\n+\n+        try {\n+            taskExecutionContext.setTaskType(\"XXX\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2MDIxMQ=="}, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3312, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}