{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MDU4MTcy", "number": 3748, "title": "[Fix-3616][Server] when worker akc/response master exception , async retry", "bodyText": "fix bug #3616 on 1.3.3-release", "createdAt": "2020-09-15T06:07:26Z", "url": "https://github.com/apache/dolphinscheduler/pull/3748", "merged": true, "mergeCommit": {"oid": "29f1123d1d95ddaae7b531d704fb2cc372d0cda2"}, "closed": true, "closedAt": "2020-09-17T02:07:00Z", "author": {"login": "qiaozhanwei"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIvEOdgH2gAyNDg3MDU4MTcyOjBmZWY1MmM0ZmZlOGM3ZjFlMTNkYjAyMDkxODgxNzExOTE3NDFhNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJnQNCgFqTQ5MDE5NDE0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0fef52c4ffe8c7f1e13db0209188171191741a4a", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/0fef52c4ffe8c7f1e13db0209188171191741a4a", "committedDate": "2020-09-14T08:38:47Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "669419b7a573170866dc26c6c112bf8028393ce0", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/669419b7a573170866dc26c6c112bf8028393ce0", "committedDate": "2020-09-14T11:45:43Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aba5aa7334343da39cf91de78b5bf38a942c1c0", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/8aba5aa7334343da39cf91de78b5bf38a942c1c0", "committedDate": "2020-09-15T03:28:50Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df1d6091c37476f5073318af631960c904678842", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/df1d6091c37476f5073318af631960c904678842", "committedDate": "2020-09-15T03:32:14Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2383b92b59e9b4257b175d99cacfd6ed8a655722", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/2383b92b59e9b4257b175d99cacfd6ed8a655722", "committedDate": "2020-09-15T07:32:37Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02bd10d6b5d74c2056b0e1b83334ac7114b1af03", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/02bd10d6b5d74c2056b0e1b83334ac7114b1af03", "committedDate": "2020-09-15T07:51:06Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5fbb9d95c057633192c0dfceb34d4e8d8ed80d2", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/d5fbb9d95c057633192c0dfceb34d4e8d8ed80d2", "committedDate": "2020-09-15T09:06:08Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NTI2NDk3", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-488526497", "createdAt": "2020-09-15T10:05:09Z", "commit": {"oid": "d5fbb9d95c057633192c0dfceb34d4e8d8ed80d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjYzMDA0", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-489263004", "createdAt": "2020-09-16T04:26:42Z", "commit": {"oid": "d5fbb9d95c057633192c0dfceb34d4e8d8ed80d2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDoyNjo0M1rOHSflWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDoyNjo0M1rOHSflWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1Mzg4MA==", "bodyText": "pelase remove ^M", "url": "https://github.com/apache/dolphinscheduler/pull/3748#discussion_r489153880", "createdAt": "2020-09-16T04:26:43Z", "author": {"login": "dailidong"}, "path": "dolphinscheduler-remote/src/main/java/org/apache/dolphinscheduler/remote/command/CommandType.java", "diffHunk": "@@ -1 +1 @@\n-/*\r * Licensed to the Apache Software Foundation (ASF) under one or more\r * contributor license agreements.  See the NOTICE file distributed with\r * this work for additional information regarding copyright ownership.\r * The ASF licenses this file to You under the Apache License, Version 2.0\r * (the \"License\"); you may not use this file except in compliance with\r * the License.  You may obtain a copy of the License at\r *\r *    http://www.apache.org/licenses/LICENSE-2.0\r *\r * Unless required by applicable law or agreed to in writing, software\r * distributed under the License is distributed on an \"AS IS\" BASIS,\r * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r * See the License for the specific language governing permissions and\r * limitations under the License.\r */\rpackage org.apache.dolphinscheduler.remote.command;\r\r\rpublic enum CommandType {\r\r    /**\r     * remove task log request,\r     */\r    REMOVE_TAK_LOG_REQUEST,\r\r    /**\r     * remove task log response\r     */\r    REMOVE_TAK_LOG_RESPONSE,\r\r    /**\r     *  roll view log request\r     */\r    ROLL_VIEW_LOG_REQUEST,\r\r    /**\r     *  roll view log response\r     */\r    ROLL_VIEW_LOG_RESPONSE,\r\r    /**\r     * view whole log request\r     */\r    VIEW_WHOLE_LOG_REQUEST,\r\r    /**\r     * view whole log response\r     */\r    VIEW_WHOLE_LOG_RESPONSE,\r\r    /**\r     * get log bytes request\r     */\r    GET_LOG_BYTES_REQUEST,\r\r    /**\r     * get log bytes response\r     */\r    GET_LOG_BYTES_RESPONSE,\r\r\r    WORKER_REQUEST,\r    MASTER_RESPONSE,\r\r    /**\r     * execute task request\r     */\r    TASK_EXECUTE_REQUEST,\r\r    /**\r     * execute task ack\r     */\r    TASK_EXECUTE_ACK,\r\r    /**\r     * execute task response\r     */\r    TASK_EXECUTE_RESPONSE,\r\r    /**\r     * kill task\r     */\r    TASK_KILL_REQUEST,\r\r    /**\r     * kill task response\r     */\r    TASK_KILL_RESPONSE,\r\r    /**\r     *  ping\r     */\r    PING,\r\r    /**\r     *  pong\r     */\r    PONG;\r}\r\n\\ No newline at end of file\n+/*\r * Licensed to the Apache Software Foundation (ASF) under one or more\r * contributor license agreements.  See the NOTICE file distributed with\r * this work for additional information regarding copyright ownership.\r * The ASF licenses this file to You under the Apache License, Version 2.0\r * (the \"License\"); you may not use this file except in compliance with\r * the License.  You may obtain a copy of the License at\r *\r *    http://www.apache.org/licenses/LICENSE-2.0\r *\r * Unless required by applicable law or agreed to in writing, software\r * distributed under the License is distributed on an \"AS IS\" BASIS,\r * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r * See the License for the specific language governing permissions and\r * limitations under the License.\r */\rpackage org.apache.dolphinscheduler.remote.command;\r\r\rpublic enum CommandType {\r\r    /**\r     * remove task log request,\r     */\r    REMOVE_TAK_LOG_REQUEST,\r\r    /**\r     * remove task log response\r     */\r    REMOVE_TAK_LOG_RESPONSE,\r\r    /**\r     *  roll view log request\r     */\r    ROLL_VIEW_LOG_REQUEST,\r\r    /**\r     *  roll view log response\r     */\r    ROLL_VIEW_LOG_RESPONSE,\r\r    /**\r     * view whole log request\r     */\r    VIEW_WHOLE_LOG_REQUEST,\r\r    /**\r     * view whole log response\r     */\r    VIEW_WHOLE_LOG_RESPONSE,\r\r    /**\r     * get log bytes request\r     */\r    GET_LOG_BYTES_REQUEST,\r\r    /**\r     * get log bytes response\r     */\r    GET_LOG_BYTES_RESPONSE,\r\r\r    WORKER_REQUEST,\r    MASTER_RESPONSE,\r\r    /**\r     * execute task request\r     */\r    TASK_EXECUTE_REQUEST,\r\r    /**\r     * execute task ack\r     */\r    TASK_EXECUTE_ACK,\r\r    /**\r     * execute task response\r     */\r    TASK_EXECUTE_RESPONSE,\r\r    /**\r     * db task ack\r     */\r    DB_TASK_ACK,\r\r    /**\r     * db task response\r     */\r    DB_TASK_RESPONSE,\r\r    /**\r     * kill task\r     */\r    TASK_KILL_REQUEST,\r\r    /**\r     * kill task response\r     */\r    TASK_KILL_RESPONSE,\r\r    /**\r     *  ping\r     */\r    PING,\r\r    /**\r     *  pong\r     */\r    PONG;\r}\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5fbb9d95c057633192c0dfceb34d4e8d8ed80d2"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjY3NjQw", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-489267640", "createdAt": "2020-09-16T04:43:26Z", "commit": {"oid": "d5fbb9d95c057633192c0dfceb34d4e8d8ed80d2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo0MzoyN1rOHSf1iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo0MzoyN1rOHSf1iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1ODAyNQ==", "bodyText": "Which service starts this ?", "url": "https://github.com/apache/dolphinscheduler/pull/3748#discussion_r489158025", "createdAt": "2020-09-16T04:43:27Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/runner/RetryReportTaskStatusThread.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.dolphinscheduler.server.worker.runner;\n+\n+import org.apache.dolphinscheduler.common.thread.Stopper;\n+\n+import org.apache.dolphinscheduler.common.thread.ThreadUtils;\n+import org.apache.dolphinscheduler.remote.command.Command;\n+import org.apache.dolphinscheduler.server.worker.cache.ResponceCache;\n+import org.apache.dolphinscheduler.server.worker.processor.TaskCallbackService;\n+import org.apache.dolphinscheduler.service.bean.SpringApplicationContext;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Map;\n+\n+/**\n+ * Retry Report Task Status Thread\n+ */\n+@Component\n+public class RetryReportTaskStatusThread implements Runnable {\n+\n+    private final Logger logger = LoggerFactory.getLogger(RetryReportTaskStatusThread.class);\n+\n+    /**\n+     * every 5 minutes\n+     */\n+    private static long RETRY_REPORT_TASK_STATUS_TIME = 5 * 60 * 1000L;\n+    /**\n+     *  task callback service\n+     */\n+    private final TaskCallbackService taskCallbackService;\n+\n+    public void start(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5fbb9d95c057633192c0dfceb34d4e8d8ed80d2"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "177cf0fea33b42a3c5ce6f68aca898d8278dbc25", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/177cf0fea33b42a3c5ce6f68aca898d8278dbc25", "committedDate": "2020-09-16T06:07:35Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/8231036913dfa11da2dd3d4abf3781df92058acd", "committedDate": "2020-09-16T06:08:39Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDE5Mjg1", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-489419285", "createdAt": "2020-09-16T09:00:02Z", "commit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMDowMlrOHSnNWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMDowMlrOHSnNWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI3ODgxMA==", "bodyText": "Miss java doc", "url": "https://github.com/apache/dolphinscheduler/pull/3748#discussion_r489278810", "createdAt": "2020-09-16T09:00:02Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/cache/ResponceCache.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.dolphinscheduler.server.worker.cache;\n+\n+import org.apache.dolphinscheduler.common.enums.Event;\n+import org.apache.dolphinscheduler.remote.command.Command;\n+\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+public class ResponceCache {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDIwNTYz", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-489420563", "createdAt": "2020-09-16T09:01:36Z", "commit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMTozNlrOHSnRUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMTozNlrOHSnRUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI3OTgyNg==", "bodyText": "opaque should be -1 is much better.  we can locate the issue easily.", "url": "https://github.com/apache/dolphinscheduler/pull/3748#discussion_r489279826", "createdAt": "2020-09-16T09:01:36Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/processor/NettyRemoteChannel.java", "diffHunk": "@@ -43,13 +45,21 @@\n      */\n     private final Host host;\n \n+    private final Random random = new Random();\n+\n \n     public NettyRemoteChannel(Channel channel, long opaque) {\n         this.channel = channel;\n         this.host = ChannelUtils.toAddress(channel);\n         this.opaque = opaque;\n     }\n \n+    public NettyRemoteChannel(Channel channel) {\n+        this.channel = channel;\n+        this.host = ChannelUtils.toAddress(channel);\n+        this.opaque = random.nextLong();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDIxNDYw", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-489421460", "createdAt": "2020-09-16T09:02:39Z", "commit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMjozOVrOHSnUAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMjozOVrOHSnUAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MDUxMg==", "bodyText": "Rename to add", "url": "https://github.com/apache/dolphinscheduler/pull/3748#discussion_r489280512", "createdAt": "2020-09-16T09:02:39Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/cache/ResponceCache.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.dolphinscheduler.server.worker.cache;\n+\n+import org.apache.dolphinscheduler.common.enums.Event;\n+import org.apache.dolphinscheduler.remote.command.Command;\n+\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+public class ResponceCache {\n+\n+    private static final ResponceCache instance = new ResponceCache();\n+\n+    private ResponceCache(){}\n+\n+    public static ResponceCache get(){\n+        return instance;\n+    }\n+\n+    private Map<Integer,Command> ackCache = new ConcurrentHashMap<>();\n+    private Map<Integer,Command> responseCache = new ConcurrentHashMap<>();\n+\n+\n+    public void cache(Integer taskInstanceId, Command command, Event event){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDIyMTYw", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-489422160", "createdAt": "2020-09-16T09:03:30Z", "commit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMzozMFrOHSnWEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOTowMzozMFrOHSnWEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4MTA0MA==", "bodyText": "Should sleep.", "url": "https://github.com/apache/dolphinscheduler/pull/3748#discussion_r489281040", "createdAt": "2020-09-16T09:03:30Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/runner/RetryReportTaskStatusThread.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.dolphinscheduler.server.worker.runner;\n+\n+import org.apache.dolphinscheduler.common.thread.Stopper;\n+\n+import org.apache.dolphinscheduler.common.thread.ThreadUtils;\n+import org.apache.dolphinscheduler.remote.command.Command;\n+import org.apache.dolphinscheduler.server.worker.cache.ResponceCache;\n+import org.apache.dolphinscheduler.server.worker.processor.TaskCallbackService;\n+import org.apache.dolphinscheduler.service.bean.SpringApplicationContext;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Map;\n+\n+/**\n+ * Retry Report Task Status Thread\n+ */\n+@Component\n+public class RetryReportTaskStatusThread implements Runnable {\n+\n+    private final Logger logger = LoggerFactory.getLogger(RetryReportTaskStatusThread.class);\n+\n+    /**\n+     * every 5 minutes\n+     */\n+    private static long RETRY_REPORT_TASK_STATUS_TIME = 5 * 60 * 1000L;\n+    /**\n+     *  task callback service\n+     */\n+    private final TaskCallbackService taskCallbackService;\n+\n+    public void start(){\n+        Thread thread = new Thread(this,\"RetryReportTaskStatusThread\");\n+        thread.start();\n+    }\n+\n+    public RetryReportTaskStatusThread(){\n+        this.taskCallbackService = SpringApplicationContext.getBean(TaskCallbackService.class);\n+    }\n+    @Override\n+    public void run() {\n+        ResponceCache responceCache = ResponceCache.get();\n+\n+        while (Stopper.isRunning()){\n+            if (responceCache.getAckCache().isEmpty() && responceCache.getResponseCache().isEmpty()){\n+                continue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8231036913dfa11da2dd3d4abf3781df92058acd"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2b9e254da8b70dd02b8d63dc5b427a771aa62a1", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/f2b9e254da8b70dd02b8d63dc5b427a771aa62a1", "committedDate": "2020-09-16T10:17:36Z", "message": "[Fix-3616][Server] when worker akc/response master exception , async retry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMTk0MTQ5", "url": "https://github.com/apache/dolphinscheduler/pull/3748#pullrequestreview-490194149", "createdAt": "2020-09-17T02:06:33Z", "commit": {"oid": "f2b9e254da8b70dd02b8d63dc5b427a771aa62a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1714, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}