{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NzE0NzYy", "number": 3979, "title": "[Feature-3754][Alert] Alert module support service for other service invoke", "bodyText": "#3754\nWhat is the purpose of the pull request\nIn this feature , Alert server is a message notification service , email and wechat is a plugin of this service . If you want send email message you can create an instance of email plugin in the alert group and then you can select the alert group in SqlTask . SqlTask can call the alert server api with this alert group arrguement to send the message.\nSo we need alert api to support other service invoke.\nNow the alert service sends alarms abnormally by periodically scanning the records in table t_ds_alert. It is asynchronous.\nIn the SqlTask task case, the task need send message synchronous and the final running status of this task depends on whether the message is sent successfully. So the alert api need send messages synchronously.\nthe params of alert api :\n\nalert group id : requied, One or more alert plugin instances are associated with an alert group, and these alert plugin instances will be called in turn when sending a message.\ntitle : requied, the title of this alert message.\ncontent: requied, the content of this alert message.", "createdAt": "2020-10-23T04:47:29Z", "url": "https://github.com/apache/dolphinscheduler/pull/3979", "merged": true, "mergeCommit": {"oid": "c61e536801cf01261fd7c4c0f733aae40936628f"}, "closed": true, "closedAt": "2020-11-05T11:36:53Z", "author": {"login": "zhuangchong"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVObTIAH2gAyNTA4NzE0NzYyOjJkZjZlY2IyZmNiZjY4Y2E3MDcyODY3NDMxZDY0ZjIyNmFjOTEwZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZMeDrAFqTUyMzI5MzYxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2df6ecb2fcbf68ca7072867431d64f226ac910e6", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/2df6ecb2fcbf68ca7072867431d64f226ac910e6", "committedDate": "2020-10-23T03:58:08Z", "message": " the alert module support service."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30d75f21856ec86a41db914a3c21d7606effdab0", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/30d75f21856ec86a41db914a3c21d7606effdab0", "committedDate": "2020-10-23T03:58:28Z", "message": " the alert module support service."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36cfcc43ce39f62b83144e3b62240b962a504384", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/36cfcc43ce39f62b83144e3b62240b962a504384", "committedDate": "2020-10-23T04:45:42Z", "message": "Delete blank lines."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a263455d6a7d1f596d19acf2f799179b42ac26f9", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/a263455d6a7d1f596d19acf2f799179b42ac26f9", "committedDate": "2020-10-23T05:08:07Z", "message": "add code checkstyle."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c1561a32fdb9f0e61e33c774818b995e87d08af", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/5c1561a32fdb9f0e61e33c774818b995e87d08af", "committedDate": "2020-10-23T11:03:52Z", "message": "Solve the sonar bug."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33413177aa3cfd65f33249c2bc7137bd655299f8", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/33413177aa3cfd65f33249c2bc7137bd655299f8", "committedDate": "2020-10-24T04:47:40Z", "message": "Re-execute build."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "500d481e726765fa5dbc18a3d76fc7f0ed97a696", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/500d481e726765fa5dbc18a3d76fc7f0ed97a696", "committedDate": "2020-10-27T05:32:54Z", "message": "add test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fdb001319e1f6c6385e0cffab298d2d51a7859d", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0fdb001319e1f6c6385e0cffab298d2d51a7859d", "committedDate": "2020-10-28T02:36:25Z", "message": "update ut."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54802bb531243f226c32b82c96899e54fd599488", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/54802bb531243f226c32b82c96899e54fd599488", "committedDate": "2020-10-28T09:56:28Z", "message": "add test class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTQ2MDUz", "url": "https://github.com/apache/dolphinscheduler/pull/3979#pullrequestreview-518546053", "createdAt": "2020-10-28T11:04:57Z", "commit": {"oid": "54802bb531243f226c32b82c96899e54fd599488"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTowNDo1N1rOHpkxhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTowNDo1N1rOHpkxhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM1NjE2Nw==", "bodyText": "Change to log output", "url": "https://github.com/apache/dolphinscheduler/pull/3979#discussion_r513356167", "createdAt": "2020-10-28T11:04:57Z", "author": {"login": "CalvinKirs"}, "path": "dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/AlertServer.java", "diffHunk": "@@ -118,10 +139,34 @@ public void start() {\n         }\n     }\n \n+    /**\n+     * start\n+     */\n+    public void start() {\n+        initPlugin();\n+        initRemoteServer();\n+        logger.info(\"alert server ready start \");\n+        runSender();\n+    }\n+\n+    /**\n+     * stop\n+     */\n+    public void stop() {\n+        this.server.close();\n+        logger.info(\"alert server shut down\");\n+    }\n+\n     public static void main(String[] args) {\n         System.out.println(System.getProperty(\"user.dir\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54802bb531243f226c32b82c96899e54fd599488"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72942ac32cc104d9842b54d9e395a06540708af9", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/72942ac32cc104d9842b54d9e395a06540708af9", "committedDate": "2020-10-28T12:01:38Z", "message": "update test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMzQ1OTg2", "url": "https://github.com/apache/dolphinscheduler/pull/3979#pullrequestreview-521345986", "createdAt": "2020-11-02T05:52:48Z", "commit": {"oid": "72942ac32cc104d9842b54d9e395a06540708af9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMjkzNjEy", "url": "https://github.com/apache/dolphinscheduler/pull/3979#pullrequestreview-523293612", "createdAt": "2020-11-04T11:57:02Z", "commit": {"oid": "72942ac32cc104d9842b54d9e395a06540708af9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2341, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}