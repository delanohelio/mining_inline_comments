{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3ODI2MTQ1", "number": 4108, "title": "[Improvement-4069][server] When the tenant does not exist, the task execution should throw an exception", "bodyText": "#4069\nWhat is the purpose of the pull request\nWhen the workflow task node executes, if the tenant does not exist, the worker Task should not create the tenant, but throw an exception and the task ends.\nBrief change log\nWhen the workflow task node executes, if the tenant does not exist, the Worker Task prints the log and returns it\nVerify this pull request\nThis pull request is already covered by existing tests\n\npull request\u7684\u76ee\u7684\u662f\u4ec0\u4e48\n\u5de5\u4f5c\u6d41\u4efb\u52a1\u8282\u70b9\u5728\u6267\u884c\u65f6\uff0c\u5982\u679c\u79df\u6237\u4e0d\u5b58\u5728\uff0cworker task\u4e0d\u5e94\u8be5\u53bb\u521b\u5efa\u79df\u6237\uff0c\u800c\u662f\u629b\u51fa\u5f02\u5e38\uff0c\u4efb\u52a1\u7ed3\u675f\u3002\n\u7b80\u77ed\u7684\u66f4\u6539\u65e5\u5fd7\n\u5de5\u4f5c\u6d41\u4efb\u52a1\u8282\u70b9\u5728\u6267\u884c\u65f6\uff0c\u5982\u679c\u79df\u6237\u4e0d\u5b58\u5728\uff0cworker task\u6253\u5370\u65e5\u5fd7\uff0c\u8fd4\u56de\n\u9a8c\u8bc1\u6b64pull request\n\u6b64\u62c9\u53d6\u8bf7\u6c42\u5df2\u88ab\u73b0\u6709\u6d4b\u8bd5\u8986\u76d6", "createdAt": "2020-11-26T05:08:32Z", "url": "https://github.com/apache/dolphinscheduler/pull/4108", "merged": true, "mergeCommit": {"oid": "3bcd3fbcd344983ed35f997bed1fea2c0cf6055d"}, "closed": true, "closedAt": "2020-12-20T13:17:40Z", "author": {"login": "zhuangchong"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdf9GnDgH2gAyNTI3ODI2MTQ1OjNhNDU2OTJlNDM1ZDUxMTg5YjAwYjkzOWVlNzhmNjVjMTU0MTIwMmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnkU0MAH2gAyNTI3ODI2MTQ1OmYyYzRlYTEyZDVhNjdhZGZhMGJmODkzZTNkMDcyYmE0NDJjYThhNWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3a45692e435d51189b00b939ee78f65c1541202b", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/3a45692e435d51189b00b939ee78f65c1541202b", "committedDate": "2020-11-25T12:00:19Z", "message": "when  the tenant does not exist, the task execution should throw an exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db9982272e0468b471dfc7d1b7ec9294fa2c3128", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/db9982272e0468b471dfc7d1b7ec9294fa2c3128", "committedDate": "2020-11-26T05:07:09Z", "message": "remote method createWorkDirAndUserIfAbsent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MDU1MjU2", "url": "https://github.com/apache/dolphinscheduler/pull/4108#pullrequestreview-539055256", "createdAt": "2020-11-26T07:39:41Z", "commit": {"oid": "db9982272e0468b471dfc7d1b7ec9294fa2c3128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwNzozOTo0MlrOH6O7Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwNzozOTo0MlrOH6O7Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgyMzk3MA==", "bodyText": "we can set the task status failed when the tenant code does not exist.", "url": "https://github.com/apache/dolphinscheduler/pull/4108#discussion_r530823970", "createdAt": "2020-11-26T07:39:42Z", "author": {"login": "lenboo"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/processor/TaskExecuteProcessor.java", "diffHunk": "@@ -100,6 +98,12 @@ public void process(Channel channel, Command command) {\n             logger.error(\"task execution context is null\");\n             return;\n         }\n+        // check if the OS user exists\n+        if (!OSUtils.getUserList().contains(taskExecutionContext.getTenantCode())) {\n+            logger.error(\"tenantCode:{} does not exist\",taskExecutionContext.getTenantCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db9982272e0468b471dfc7d1b7ec9294fa2c3128"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3014dc8492041718984962744bb9630f43617981", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/3014dc8492041718984962744bb9630f43617981", "committedDate": "2020-11-26T11:39:32Z", "message": "set the task status failed when the tenant code does not exist."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5d0fa44926040464e49df84ed0bbb229643aefe", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/a5d0fa44926040464e49df84ed0bbb229643aefe", "committedDate": "2020-11-27T01:34:23Z", "message": "update code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNTM1ODg1", "url": "https://github.com/apache/dolphinscheduler/pull/4108#pullrequestreview-541535885", "createdAt": "2020-12-01T07:03:41Z", "commit": {"oid": "a5d0fa44926040464e49df84ed0bbb229643aefe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "283559468a4dfa787d0f3460dd7539a86c968fb0", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/283559468a4dfa787d0f3460dd7539a86c968fb0", "committedDate": "2020-12-18T01:17:56Z", "message": "add taskLog."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MTI2NDcw", "url": "https://github.com/apache/dolphinscheduler/pull/4108#pullrequestreview-555126470", "createdAt": "2020-12-18T02:12:30Z", "commit": {"oid": "283559468a4dfa787d0f3460dd7539a86c968fb0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea481c61ee153129469c07f19ad5da817ea29565", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/ea481c61ee153129469c07f19ad5da817ea29565", "committedDate": "2020-12-18T10:55:14Z", "message": "update check os user exists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b194aa4d5700949297496c7485ce80b0feb2d260", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b194aa4d5700949297496c7485ce80b0feb2d260", "committedDate": "2020-12-18T10:59:24Z", "message": "Resolving code conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e228fb16117dd41ac65579707045249307b2aee", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/2e228fb16117dd41ac65579707045249307b2aee", "committedDate": "2020-12-18T11:56:25Z", "message": "update TaskExecuteThreadTest test method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f339ae59fbe957e5b32f7b7535f0be088c05ffa5", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f339ae59fbe957e5b32f7b7535f0be088c05ffa5", "committedDate": "2020-12-18T12:16:13Z", "message": "update TaskExecuteThreadTest test method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f60df5602c746fad0c28c55bea9515a9e6a53721", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f60df5602c746fad0c28c55bea9515a9e6a53721", "committedDate": "2020-12-18T12:18:27Z", "message": "update test checkstyle."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a5c0db978144e9777e6e49c2d4f39112ee0e444", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/1a5c0db978144e9777e6e49c2d4f39112ee0e444", "committedDate": "2020-12-18T12:40:03Z", "message": "sonar code smell."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2c4ea12d5a67adfa0bf893e3d072ba442ca8a5b", "author": {"user": {"login": "zhuangchong", "name": "Kerwin"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f2c4ea12d5a67adfa0bf893e3d072ba442ca8a5b", "committedDate": "2020-12-19T03:39:36Z", "message": "solving sonar fail."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2367, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}