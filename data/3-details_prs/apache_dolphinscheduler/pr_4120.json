{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4OTE1NjYy", "number": 4120, "title": " [Improvement][API] ignore noNodeException when get worker groups", "bodyText": "#4109  ignore noNodeException when get worker groups", "createdAt": "2020-11-28T09:11:22Z", "url": "https://github.com/apache/dolphinscheduler/pull/4120", "merged": true, "mergeCommit": {"oid": "b46044d59232dc3710cffcecd9de33a1ddb05878"}, "closed": true, "closedAt": "2020-11-30T02:39:14Z", "author": {"login": "felix-thinkingdata"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdg4c-wgH2gAyNTI4OTE1NjYyOmU0ZjU1MjkxODU0MjY4OWMwOTAxN2FjZjg1M2E1NGZmNThkMzE4YjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhcEedAFqTU0MDU2NjI0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e4f552918542689c09017acf853a54ff58d318b1", "author": {"user": {"login": "felix-thinkingdata", "name": "felix.wang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/e4f552918542689c09017acf853a54ff58d318b1", "committedDate": "2020-11-28T09:09:09Z", "message": "ignore noNodeException when get worker groups"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMzU1MTM0", "url": "https://github.com/apache/dolphinscheduler/pull/4120#pullrequestreview-540355134", "createdAt": "2020-11-28T09:39:01Z", "commit": {"oid": "e4f552918542689c09017acf853a54ff58d318b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwOTozOTowMVrOH7XZDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQwOTozOTowMVrOH7XZDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAxMTI3Ng==", "bodyText": "It's best to pull it out here, and the code will be more readable.\n\u62bd\u79bb\u8fd9\u91cc\u7684\u5224\u65ad", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532011276", "createdAt": "2020-11-28T09:39:01Z", "author": {"login": "CalvinKirs"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/WorkerGroupService.java", "diffHunk": "@@ -120,30 +121,46 @@\n         return result;\n     }\n \n-\n     /**\n-     *  get worker groups\n+     * get worker groups\n      *\n      * @param isPaging whether paging\n      * @return WorkerGroup list\n      */\n     private List<WorkerGroup> getWorkerGroups(boolean isPaging) {\n-        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot()+\"/nodes\" +\"/worker\";\n-        List<String> workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+\n+        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot() + \"/nodes\" + \"/worker\";\n+        List<WorkerGroup> workerGroups = new ArrayList<>();\n+        List<String> workerGroupList;\n+        try {\n+            workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+        } catch (Exception e) {\n+            if (e.getMessage().contains(noNodeExceptionRegex)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4f552918542689c09017acf853a54ff58d318b1"}, "originalPosition": 120}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fd2605be7bab907fd2b48a59c1506ecb4277131", "author": {"user": {"login": "felix-thinkingdata", "name": "felix.wang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8fd2605be7bab907fd2b48a59c1506ecb4277131", "committedDate": "2020-11-28T09:51:03Z", "message": "add ut"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f781f241fb0a39fc43dc45b3591c01f12ac776a7", "author": {"user": {"login": "felix-thinkingdata", "name": "felix.wang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f781f241fb0a39fc43dc45b3591c01f12ac776a7", "committedDate": "2020-11-28T10:17:45Z", "message": "fix code smell"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMzY4MTMw", "url": "https://github.com/apache/dolphinscheduler/pull/4120#pullrequestreview-540368130", "createdAt": "2020-11-28T11:04:08Z", "commit": {"oid": "e4f552918542689c09017acf853a54ff58d318b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxMTowNDowOFrOH7YWgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxMTowNDowOFrOH7YWgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNzAxMQ==", "bodyText": "i think it should be a constant variable  for worker path.", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532027011", "createdAt": "2020-11-28T11:04:08Z", "author": {"login": "lenboo"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/WorkerGroupService.java", "diffHunk": "@@ -120,30 +121,46 @@\n         return result;\n     }\n \n-\n     /**\n-     *  get worker groups\n+     * get worker groups\n      *\n      * @param isPaging whether paging\n      * @return WorkerGroup list\n      */\n     private List<WorkerGroup> getWorkerGroups(boolean isPaging) {\n-        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot()+\"/nodes\" +\"/worker\";\n-        List<String> workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+\n+        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot() + \"/nodes\" + \"/worker\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4f552918542689c09017acf853a54ff58d318b1"}, "originalPosition": 114}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2323c45afa8483579b3d7683780b89124b84e30a", "author": {"user": {"login": "felix-thinkingdata", "name": "felix.wang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/2323c45afa8483579b3d7683780b89124b84e30a", "committedDate": "2020-11-28T11:59:47Z", "message": "fix code smell"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMzgyMTk3", "url": "https://github.com/apache/dolphinscheduler/pull/4120#pullrequestreview-540382197", "createdAt": "2020-11-28T15:28:34Z", "commit": {"oid": "2323c45afa8483579b3d7683780b89124b84e30a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxNToyODozNFrOH7Z3LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxNToyODozNFrOH7Z3LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1MTc1Ng==", "bodyText": "so do the \"default\" = DEFAULT_WORKER_GROUP", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532051756", "createdAt": "2020-11-28T15:28:34Z", "author": {"login": "lenboo"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/WorkerGroupService.java", "diffHunk": "@@ -120,30 +122,46 @@\n         return result;\n     }\n \n-\n     /**\n-     *  get worker groups\n+     * get worker groups\n      *\n      * @param isPaging whether paging\n      * @return WorkerGroup list\n      */\n     private List<WorkerGroup> getWorkerGroups(boolean isPaging) {\n-        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot()+\"/nodes\" +\"/worker\";\n-        List<String> workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+\n+        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot() + Constants.ZOOKEEPER_DOLPHINSCHEDULER_WORKERS;\n+        List<WorkerGroup> workerGroups = new ArrayList<>();\n+        List<String> workerGroupList;\n+        try {\n+            workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+        } catch (Exception e) {\n+            if (e.getMessage().contains(NO_NODE_EXCEPTION_REGEX)) {\n+                if (isPaging) {\n+                    return workerGroups;\n+                } else {\n+                    //ignore noNodeException return Default\n+                    WorkerGroup wg = new WorkerGroup();\n+                    wg.setName(\"default\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2323c45afa8483579b3d7683780b89124b84e30a"}, "originalPosition": 126}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c269307c66c14b221fd795df93149802639b7bf", "author": {"user": {"login": "felix-thinkingdata", "name": "felix.wang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/7c269307c66c14b221fd795df93149802639b7bf", "committedDate": "2020-11-29T13:30:13Z", "message": "fix code smell"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNTY1MjIx", "url": "https://github.com/apache/dolphinscheduler/pull/4120#pullrequestreview-540565221", "createdAt": "2020-11-30T02:34:32Z", "commit": {"oid": "7c269307c66c14b221fd795df93149802639b7bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNTY2MjQ0", "url": "https://github.com/apache/dolphinscheduler/pull/4120#pullrequestreview-540566244", "createdAt": "2020-11-30T02:38:58Z", "commit": {"oid": "7c269307c66c14b221fd795df93149802639b7bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2269, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}