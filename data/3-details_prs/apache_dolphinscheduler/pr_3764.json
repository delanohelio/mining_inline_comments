{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MDE3MTE2", "number": 3764, "title": "[Improvement][API] simplify with stream", "bodyText": "simplify for loop with stream", "createdAt": "2020-09-18T01:44:20Z", "url": "https://github.com/apache/dolphinscheduler/pull/3764", "merged": true, "mergeCommit": {"oid": "eb597e67e35179ee627d8ba664c50e4f42854479"}, "closed": true, "closedAt": "2020-09-26T07:45:25Z", "author": {"login": "SunJiFengPlus"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKEBqjgFqTQ5MTM4NzE4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMlfTGAFqTQ5Njk1MDYwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMzg3MTgz", "url": "https://github.com/apache/dolphinscheduler/pull/3764#pullrequestreview-491387183", "createdAt": "2020-09-18T11:37:54Z", "commit": {"oid": "c0fa5fc0b9d4dc3ed4416c13f6a8557505c1d555"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMTozNzo1NFrOHUJgRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMTozNzo1NFrOHUJgRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg4OTI4Nw==", "bodyText": "Filter here is for - AbstractParameters.  not for params.getResourceFilesList(). please check.", "url": "https://github.com/apache/dolphinscheduler/pull/3764#discussion_r490889287", "createdAt": "2020-09-18T11:37:54Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/impl/ProcessDefinitionServiceImpl.java", "diffHunk": "@@ -232,25 +232,14 @@\n      * @return resource ids\n      */\n     private String getResourceIds(ProcessData processData) {\n-        List<TaskNode> tasks = processData.getTasks();\n-        Set<Integer> resourceIds = new HashSet<>();\n-        for (TaskNode taskNode : tasks) {\n-            String taskParameter = taskNode.getParams();\n-            AbstractParameters params = TaskParametersUtils.getParameters(taskNode.getType(), taskParameter);\n-            if (CollectionUtils.isNotEmpty(params.getResourceFilesList())) {\n-                Set<Integer> tempSet = params.getResourceFilesList().stream().map(t -> t.getId()).collect(Collectors.toSet());\n-                resourceIds.addAll(tempSet);\n-            }\n-        }\n-\n-        StringBuilder sb = new StringBuilder();\n-        for (int i : resourceIds) {\n-            if (sb.length() > 0) {\n-                sb.append(\",\");\n-            }\n-            sb.append(i);\n-        }\n-        return sb.toString();\n+        return processData.getTasks()\n+                .stream()\n+                .map(taskNode -> TaskParametersUtils.getParameters(taskNode.getType(), taskNode.getParams()))\n+                .filter(Objects::nonNull)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0fa5fc0b9d4dc3ed4416c13f6a8557505c1d555"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef50a3779def5de352df864c174c6fec99875ea7", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/ef50a3779def5de352df864c174c6fec99875ea7", "committedDate": "2020-09-22T02:43:18Z", "message": "simplify with stream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb50f62711ce702fdb9c4d3a3aac3d92bbbc981", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8eb50f62711ce702fdb9c4d3a3aac3d92bbbc981", "committedDate": "2020-09-22T02:43:18Z", "message": "add distinct"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34b8f5f503c262feed12e6e8364e0ddf82eaa824", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/34b8f5f503c262feed12e6e8364e0ddf82eaa824", "committedDate": "2020-09-22T02:43:18Z", "message": "compatible tasks is null"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3ef621a085560ca3fe67d6445258c74ff2eec1b", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b3ef621a085560ca3fe67d6445258c74ff2eec1b", "committedDate": "2020-09-22T02:44:35Z", "message": "Merge remote-tracking branch 'jifeng/Improvement-SimplifyWithStream' into Improvement-SimplifyWithStream\n\n# Conflicts:\n#\tdolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/impl/ProcessDefinitionServiceImpl.java"}, "afterCommit": {"oid": "0939375780c0ab1165d35991c9b90d20d5ad8f4f", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0939375780c0ab1165d35991c9b90d20d5ad8f4f", "committedDate": "2020-09-22T02:43:18Z", "message": "add unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b89682751030a4d85945efdc2ef7f6c1e9709e60", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b89682751030a4d85945efdc2ef7f6c1e9709e60", "committedDate": "2020-09-22T02:57:16Z", "message": "add unit test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0939375780c0ab1165d35991c9b90d20d5ad8f4f", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0939375780c0ab1165d35991c9b90d20d5ad8f4f", "committedDate": "2020-09-22T02:43:18Z", "message": "add unit test"}, "afterCommit": {"oid": "b89682751030a4d85945efdc2ef7f6c1e9709e60", "author": {"user": {"login": "SunJiFengPlus", "name": "\u5b59\u7ee7\u5cf0"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b89682751030a4d85945efdc2ef7f6c1e9709e60", "committedDate": "2020-09-22T02:57:16Z", "message": "add unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2OTUwNjA0", "url": "https://github.com/apache/dolphinscheduler/pull/3764#pullrequestreview-496950604", "createdAt": "2020-09-26T07:45:00Z", "commit": {"oid": "b89682751030a4d85945efdc2ef7f6c1e9709e60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1717, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}