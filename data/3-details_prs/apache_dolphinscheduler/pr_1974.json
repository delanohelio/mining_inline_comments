{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NjEwMzg5", "number": 1974, "title": "#203 add sqoop task", "bodyText": "What is the purpose of the pull request\nThis pull request adds sqoop task.\nBrief change log\n\nAdd sqoop source type : mysql,hive,hdfs.\nAdd sqoop target type : mysql,hive,hdfs.\nAdd sqoop task ui.\n\nVerify this pull request\nThis change added tests and can be verified as follows:\n\nAdded SqoopTaskTest to verify the change.", "createdAt": "2020-02-18T13:13:20Z", "url": "https://github.com/apache/dolphinscheduler/pull/1974", "merged": true, "mergeCommit": {"oid": "3d6eee5d8065fc6ac7ef73b01a5815ec4fb901ff"}, "closed": true, "closedAt": "2020-02-24T02:30:17Z", "author": {"login": "zixi0825"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFisA2gFqTM2MDM2OTM1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGbxWVAFqTM2MjQ3NjE0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzY5MzU5", "url": "https://github.com/apache/dolphinscheduler/pull/1974#pullrequestreview-360369359", "createdAt": "2020-02-18T14:14:20Z", "commit": {"oid": "dd486569038ef86bda3798a72197e9c9ac62437c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDoxNDoyMFrOFrD3VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDoxNDoyMFrOFrD3VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY5NjQwNA==", "bodyText": "sqoop tasks will be converted to mapreduce tasks, managed by yarn\uff0c SqoopTask class need extends AbstractYarnTask not ShellTask", "url": "https://github.com/apache/dolphinscheduler/pull/1974#discussion_r380696404", "createdAt": "2020-02-18T14:14:20Z", "author": {"login": "Eights-Li"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/sqoop/SqoopTask.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.dolphinscheduler.server.worker.task.sqoop;\n+\n+import com.alibaba.fastjson.JSON;\n+import org.apache.dolphinscheduler.common.task.shell.ShellParameters;\n+import org.apache.dolphinscheduler.common.task.sqoop.SqoopParameters;\n+import org.apache.dolphinscheduler.server.worker.task.TaskProps;\n+import org.apache.dolphinscheduler.server.worker.task.shell.ShellTask;\n+import org.apache.dolphinscheduler.server.worker.task.sqoop.generator.SqoopJobGenerator;\n+import org.slf4j.Logger;\n+\n+/**\n+ * sqoop task extends the shell task\n+ */\n+public class SqoopTask extends ShellTask {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd486569038ef86bda3798a72197e9c9ac62437c"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f1a9b69489004a7961cfcbc7e262d58b19d785a", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/3f1a9b69489004a7961cfcbc7e262d58b19d785a", "committedDate": "2020-02-20T13:56:09Z", "message": "add sqoop task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19dd39778f6b4eec8310e7770ed4a64a0556f983", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/19dd39778f6b4eec8310e7770ed4a64a0556f983", "committedDate": "2020-02-20T13:56:09Z", "message": "add sqoop task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5e4a6db6d37c4b0da998502e5d0fcb5316fb48f", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/a5e4a6db6d37c4b0da998502e5d0fcb5316fb48f", "committedDate": "2020-02-20T13:56:09Z", "message": "add sqoop task test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b64af608dc7f9820b9f8786a19181e50f426e90", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8b64af608dc7f9820b9f8786a19181e50f426e90", "committedDate": "2020-02-20T13:56:10Z", "message": "add sqoop task test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0de8a4e18a8850d2849e9bf1de889bb381929bba", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0de8a4e18a8850d2849e9bf1de889bb381929bba", "committedDate": "2020-02-20T13:56:10Z", "message": "add sqoop task test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cff9fec2a59c0b4141ca531706412cfdc02a6349", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/cff9fec2a59c0b4141ca531706412cfdc02a6349", "committedDate": "2020-02-20T13:56:10Z", "message": "modify add sqoop task test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63302beafb6eebc88f2fc015914ef08513c264d5", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/63302beafb6eebc88f2fc015914ef08513c264d5", "committedDate": "2020-02-20T13:56:10Z", "message": "modify sqoop task test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d910308fe934f296d9c6785a399e1d387d7bb97", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/2d910308fe934f296d9c6785a399e1d387d7bb97", "committedDate": "2020-02-20T13:56:10Z", "message": "modify sqoop task test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca36e7dd045c9bb878795ca6339f8d24f2e735c9", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/ca36e7dd045c9bb878795ca6339f8d24f2e735c9", "committedDate": "2020-02-20T13:56:10Z", "message": "modify sqoop task test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b2e45363723c2815b65dfc238c52195a8f63456", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/2b2e45363723c2815b65dfc238c52195a8f63456", "committedDate": "2020-02-20T15:33:14Z", "message": "modify sqoop task test 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ce68ac526bee8e4f7c80ddab8683998e4b9310", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/38ce68ac526bee8e4f7c80ddab8683998e4b9310", "committedDate": "2020-02-20T15:58:55Z", "message": "modify sqoop task test 3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "227c6cb975a25c444d9b6945d53921288c20a7b4", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/227c6cb975a25c444d9b6945d53921288c20a7b4", "committedDate": "2020-02-21T05:47:39Z", "message": "modify sqoop task test 3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ca0d6016956f18019689d4fac73f98e53e55c87", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/5ca0d6016956f18019689d4fac73f98e53e55c87", "committedDate": "2020-02-21T05:57:18Z", "message": "modify sqoop task test 3"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDE5Mjg1", "url": "https://github.com/apache/dolphinscheduler/pull/1974#pullrequestreview-362419285", "createdAt": "2020-02-21T06:20:30Z", "commit": {"oid": "5ca0d6016956f18019689d4fac73f98e53e55c87"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNjoyMDozMFrOFssu1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNjoyNDozM1rOFssyTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQxNDU1MQ==", "bodyText": "remove the author and time", "url": "https://github.com/apache/dolphinscheduler/pull/1974#discussion_r382414551", "createdAt": "2020-02-21T06:20:30Z", "author": {"login": "Eights-Li"}, "path": "dolphinscheduler-common/src/test/java/org/apache/dolphinscheduler/common/task/SqoopParameterEntityTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.dolphinscheduler.common.task;\n+\n+import org.apache.dolphinscheduler.common.task.sqoop.SqoopParameters;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceHdfsParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceHiveParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceMysqlParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.targets.TargetHdfsParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.targets.TargetHiveParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.targets.TargetMysqlParameter;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * @author simfo", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca0d6016956f18019689d4fac73f98e53e55c87"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQxNTQzOQ==", "bodyText": "remove this comment out code", "url": "https://github.com/apache/dolphinscheduler/pull/1974#discussion_r382415439", "createdAt": "2020-02-21T06:24:33Z", "author": {"login": "Eights-Li"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/sqoop/generator/sources/MysqlSourceGenerator.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.dolphinscheduler.server.worker.task.sqoop.generator.sources;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.dolphinscheduler.common.enums.QueryType;\n+import org.apache.dolphinscheduler.common.process.Property;\n+import org.apache.dolphinscheduler.common.task.sqoop.SqoopParameters;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceMysqlParameter;\n+import org.apache.dolphinscheduler.common.utils.JSONUtils;\n+import org.apache.dolphinscheduler.dao.datasource.BaseDataSource;\n+import org.apache.dolphinscheduler.dao.datasource.DataSourceFactory;\n+import org.apache.dolphinscheduler.service.bean.SpringApplicationContext;\n+import org.apache.dolphinscheduler.dao.entity.DataSource;\n+import org.apache.dolphinscheduler.server.worker.task.sqoop.generator.ISourceGenerator;\n+import org.apache.dolphinscheduler.service.process.ProcessService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.List;\n+\n+/**\n+ * mysql source generator\n+ */\n+public class MysqlSourceGenerator implements ISourceGenerator {\n+\n+    private Logger logger = LoggerFactory.getLogger(getClass());\n+\n+    @Override\n+    public String generate(SqoopParameters sqoopParameters) {\n+        StringBuilder result = new StringBuilder();\n+        try {\n+            SourceMysqlParameter sourceMysqlParameter\n+                    = JSONUtils.parseObject(sqoopParameters.getSourceParams(),SourceMysqlParameter.class);\n+\n+            if(sourceMysqlParameter != null){\n+                ProcessService processService = SpringApplicationContext.getBean(ProcessService.class);\n+                DataSource dataSource= processService.findDataSourceById(sourceMysqlParameter.getSrcDatasource());\n+                BaseDataSource baseDataSource = DataSourceFactory.getDatasource(dataSource.getType(),\n+                        dataSource.getConnectionParams());\n+                if(baseDataSource != null){\n+                    result.append(\" --connect \")\n+                            .append(baseDataSource.getJdbcUrl())\n+                            .append(\" --username \")\n+                            .append(baseDataSource.getUser())\n+                            .append(\" --password \")\n+                            .append(baseDataSource.getPassword());\n+\n+                    if(sourceMysqlParameter.getSrcQueryType() == QueryType.FORM.ordinal()){\n+                        if(StringUtils.isNotEmpty(sourceMysqlParameter.getSrcTable())){\n+                            result.append(\" --table \").append(sourceMysqlParameter.getSrcTable());\n+                        }\n+\n+                        if(StringUtils.isNotEmpty(sourceMysqlParameter.getSrcColumns())){\n+                            result.append(\" --columns \").append(sourceMysqlParameter.getSrcColumns());\n+                        }\n+\n+//                        StringBuilder srcWhere = new StringBuilder();\n+//                        if(sourceMysqlParameter.getSrcConditionList().size()>0){\n+//                            List<Property> items = sourceMysqlParameter.getSrcConditionList();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca0d6016956f18019689d4fac73f98e53e55c87"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08985e0a64d94c543abe398dae0073aa58d9e880", "author": {"user": {"login": "zixi0825", "name": "zixi0825"}}, "url": "https://github.com/apache/dolphinscheduler/commit/08985e0a64d94c543abe398dae0073aa58d9e880", "committedDate": "2020-02-21T08:26:15Z", "message": "modify sqoop task test 4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDc2MTQz", "url": "https://github.com/apache/dolphinscheduler/pull/1974#pullrequestreview-362476143", "createdAt": "2020-02-21T08:50:58Z", "commit": {"oid": "08985e0a64d94c543abe398dae0073aa58d9e880"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1931, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}