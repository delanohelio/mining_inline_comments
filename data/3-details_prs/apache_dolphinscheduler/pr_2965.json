{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzOTk2NjE2", "number": 2965, "title": "[Feature-2925][server] Init TaskLogger in TaskExecuteProcessor (#2925)", "bodyText": "What is the purpose of the pull request\nInit task logger before init TaskExecuteThread and pass the taskLogger in to TaskExecuteThread init method as parameter, so we can record the user and work dir creating log to task instance log, and user can read this log in front-end WebUI. #3014\nUse common ShellExecutor in FileUtils. #2925\nBrief change log\n\nAdd taskLogger parameter  to TaskExecuteThread.\nAdd three log utils to LoggerUtils.\nInit task logger before create initing TaskExecuteThread, and init task logger process to TaskExecuteProcessor.\nLog all detail when create user and working dir in FileUtils.\n\nVerify this pull request\nThis pull request is code cleanup without any test coverage.", "createdAt": "2020-06-13T11:50:34Z", "url": "https://github.com/apache/dolphinscheduler/pull/2965", "merged": true, "mergeCommit": {"oid": "38e485373de9a7301a19f57cb53dbf4cb6744696"}, "closed": true, "closedAt": "2020-06-28T09:43:15Z", "author": {"login": "yangyichao-mango"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrGc0YABqjM0NDE0NDYyNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvn6QTgBqjM0OTAwMDkzNTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcf003d4c16f8ae62dda09a83ae6df0dc5b8318a", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/bcf003d4c16f8ae62dda09a83ae6df0dc5b8318a", "committedDate": "2020-06-13T11:38:47Z", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)"}, "afterCommit": {"oid": "291b98ae729547c61dc684cfe93bbfde2192f13b", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/291b98ae729547c61dc684cfe93bbfde2192f13b", "committedDate": "2020-06-14T06:55:26Z", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "291b98ae729547c61dc684cfe93bbfde2192f13b", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/291b98ae729547c61dc684cfe93bbfde2192f13b", "committedDate": "2020-06-14T06:55:26Z", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)"}, "afterCommit": {"oid": "5482a5e080adfe62accd1f020c0de7c788d5fa28", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/5482a5e080adfe62accd1f020c0de7c788d5fa28", "committedDate": "2020-06-14T07:31:44Z", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5482a5e080adfe62accd1f020c0de7c788d5fa28", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/5482a5e080adfe62accd1f020c0de7c788d5fa28", "committedDate": "2020-06-14T07:31:44Z", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)"}, "afterCommit": {"oid": "f36af5331ea3721f9c7d2a281ff4bcfaad679547", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f36af5331ea3721f9c7d2a281ff4bcfaad679547", "committedDate": "2020-06-14T08:00:36Z", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDMyMjQ4", "url": "https://github.com/apache/dolphinscheduler/pull/2965#pullrequestreview-434432248", "createdAt": "2020-06-20T14:33:03Z", "commit": {"oid": "f36af5331ea3721f9c7d2a281ff4bcfaad679547"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDozMzowM1rOGmm1iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDozMzowM1rOGmm1iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEzNTM2OA==", "bodyText": "why swallow exception\uff1f", "url": "https://github.com/apache/dolphinscheduler/pull/2965#discussion_r443135368", "createdAt": "2020-06-20T14:33:03Z", "author": {"login": "dailidong"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/FileUtils.java", "diffHunk": "@@ -138,24 +153,39 @@ public static String getResourceViewSuffixs() {\n      * @param userName user name\n      * @throws IOException errors\n      */\n-    public static void createWorkDirAndUserIfAbsent(String execLocalPath, String userName) throws IOException{\n+    public static void createWorkDirAndUserIfAbsent(String execLocalPath, String userName) throws IOException {\n         //if work dir exists, first delete\n         File execLocalPathFile = new File(execLocalPath);\n \n-        if (execLocalPathFile.exists()){\n+        if (execLocalPathFile.exists()) {\n             org.apache.commons.io.FileUtils.forceDelete(execLocalPathFile);\n         }\n \n         //create work dir\n         org.apache.commons.io.FileUtils.forceMkdir(execLocalPathFile);\n-        logger.info(\"create dir success {}\" , execLocalPath);\n-\n+        String mkdirLog = \"create dir success \" + execLocalPath;\n+        LoggerUtils.logInfo(logger, taskLoggerThreadLocal::get, mkdirLog);\n \n         //if not exists this user,then create\n-        if (!OSUtils.getUserList().contains(userName)){\n-            OSUtils.createUser(userName);\n+        Logger taskLogger = taskLoggerThreadLocal.get();\n+        OSUtils.taskLoggerThreadLocal.set(taskLogger);\n+        try {\n+            if (!OSUtils.getUserList().contains(userName)) {\n+                boolean isSuccessCreateUser = OSUtils.createUser(userName);\n+\n+                if (isSuccessCreateUser) {\n+                    String infoLog = String.format(\"create user name success %s\", userName);\n+                    taskLogger.info(infoLog);\n+                    logger.info(infoLog);\n+                } else {\n+                    String infoLog = String.format(\"create user name fail %s\", userName);\n+                    taskLogger.error(infoLog);\n+                    logger.error(infoLog);\n+                }\n+            }\n+        } catch (Throwable ignored) {\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f36af5331ea3721f9c7d2a281ff4bcfaad679547"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDMzMzgz", "url": "https://github.com/apache/dolphinscheduler/pull/2965#pullrequestreview-434433383", "createdAt": "2020-06-20T14:50:47Z", "commit": {"oid": "f36af5331ea3721f9c7d2a281ff4bcfaad679547"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "051feaff5efb6dc224f5d25a17aa4660a357c762", "author": {"user": {"login": "gabrywu", "name": "gabry.wu"}}, "url": "https://github.com/apache/dolphinscheduler/commit/051feaff5efb6dc224f5d25a17aa4660a357c762", "committedDate": "2020-06-21T08:02:38Z", "message": "Merge branch 'dev' into feature-2925"}, "afterCommit": {"oid": "8725fdc450b06e479a73ba55278e57cc8fdc9f17", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8725fdc450b06e479a73ba55278e57cc8fdc9f17", "committedDate": "2020-06-21T14:20:55Z", "message": "optimize the logger utils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2761c3404d298f42e0b93a98c8f1da0cb4e7006d", "author": {"user": {"login": "dailidong", "name": "lidongdai"}}, "url": "https://github.com/apache/dolphinscheduler/commit/2761c3404d298f42e0b93a98c8f1da0cb4e7006d", "committedDate": "2020-06-21T15:59:33Z", "message": "Merge branch 'dev' into feature-2925"}, "afterCommit": {"oid": "1ff45c288571e53d412182194484a840f87bf03b", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/1ff45c288571e53d412182194484a840f87bf03b", "committedDate": "2020-06-26T17:02:20Z", "message": "optimize the logger utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7232960d7ca2391079112d102c9e4a3cb8d5b335", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/7232960d7ca2391079112d102c9e4a3cb8d5b335", "committedDate": "2020-06-28T08:09:56Z", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28d8be230073d00025d452d1f099770942878f11", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/28d8be230073d00025d452d1f099770942878f11", "committedDate": "2020-06-28T08:09:56Z", "message": "optimize the logger utils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ff45c288571e53d412182194484a840f87bf03b", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/1ff45c288571e53d412182194484a840f87bf03b", "committedDate": "2020-06-26T17:02:20Z", "message": "optimize the logger utils"}, "afterCommit": {"oid": "28d8be230073d00025d452d1f099770942878f11", "author": {"user": {"login": "yangyichao-mango", "name": "Yichao Yang"}}, "url": "https://github.com/apache/dolphinscheduler/commit/28d8be230073d00025d452d1f099770942878f11", "committedDate": "2020-06-28T08:09:56Z", "message": "optimize the logger utils"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2004, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}