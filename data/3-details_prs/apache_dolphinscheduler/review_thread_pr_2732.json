{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MjI3NTcw", "number": 2732, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwMzo0MDowMFrOD9Ox3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwMzo0MDowMFrOD9Ox3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NTMxODY5OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwMzo0MDowMFrOGWmm5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwODozNTozN1rOGWs7GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1NDQwNQ==", "bodyText": "change the message the user name is better.", "url": "https://github.com/apache/dolphinscheduler/pull/2732#discussion_r426354405", "createdAt": "2020-05-18T03:40:00Z", "author": {"login": "lenboo"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -355,12 +352,21 @@ public Result updateResource(User loginUser,\n         String nameWithSuffix = name;\n \n         if (!resource.isDirectory()) {\n-            //get the file suffix\n-            String suffix = originResourceName.substring(originResourceName.lastIndexOf(\".\"));\n-\n-            //if the name without suffix then add it ,else use the origin name\n-            if(!name.endsWith(suffix)){\n-                nameWithSuffix = nameWithSuffix + suffix;\n+            //get the origin file suffix\n+            String originSuffix = FileUtils.suffix(originFullName);\n+            String suffix = FileUtils.suffix(fullName);\n+            if (!suffix.equals(originSuffix)) {\n+                //need verify whether this resource is authorized to other users\n+                Map<String, Object> columnMap = new HashMap<String, Object>();\n+                columnMap.put(\"resources_id\", resourceId);\n+\n+                List<ResourcesUser> resourcesUsers = resourceUserMapper.selectByMap(columnMap);\n+                if (CollectionUtils.isNotEmpty(resourcesUsers)) {\n+                    String users = resourcesUsers.stream().map(t -> t.getUserId()).collect(Collectors.toList()).toString();\n+                    logger.error(\"resource is authorized to user {},suffix not allowed to be modified\", users);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8b19e46008f266eb6ea2add17765f8ca8a80ede"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM3MzA3Mg==", "bodyText": "or do not print user name?", "url": "https://github.com/apache/dolphinscheduler/pull/2732#discussion_r426373072", "createdAt": "2020-05-18T05:12:24Z", "author": {"login": "lenboo"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -355,12 +352,21 @@ public Result updateResource(User loginUser,\n         String nameWithSuffix = name;\n \n         if (!resource.isDirectory()) {\n-            //get the file suffix\n-            String suffix = originResourceName.substring(originResourceName.lastIndexOf(\".\"));\n-\n-            //if the name without suffix then add it ,else use the origin name\n-            if(!name.endsWith(suffix)){\n-                nameWithSuffix = nameWithSuffix + suffix;\n+            //get the origin file suffix\n+            String originSuffix = FileUtils.suffix(originFullName);\n+            String suffix = FileUtils.suffix(fullName);\n+            if (!suffix.equals(originSuffix)) {\n+                //need verify whether this resource is authorized to other users\n+                Map<String, Object> columnMap = new HashMap<String, Object>();\n+                columnMap.put(\"resources_id\", resourceId);\n+\n+                List<ResourcesUser> resourcesUsers = resourceUserMapper.selectByMap(columnMap);\n+                if (CollectionUtils.isNotEmpty(resourcesUsers)) {\n+                    String users = resourcesUsers.stream().map(t -> t.getUserId()).collect(Collectors.toList()).toString();\n+                    logger.error(\"resource is authorized to user {},suffix not allowed to be modified\", users);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1NDQwNQ=="}, "originalCommit": {"oid": "d8b19e46008f266eb6ea2add17765f8ca8a80ede"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ1Nzg4MQ==", "bodyText": "I agree with you,The message now shows  the user name instead of user id.", "url": "https://github.com/apache/dolphinscheduler/pull/2732#discussion_r426457881", "createdAt": "2020-05-18T08:35:37Z", "author": {"login": "lgcareer"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -355,12 +352,21 @@ public Result updateResource(User loginUser,\n         String nameWithSuffix = name;\n \n         if (!resource.isDirectory()) {\n-            //get the file suffix\n-            String suffix = originResourceName.substring(originResourceName.lastIndexOf(\".\"));\n-\n-            //if the name without suffix then add it ,else use the origin name\n-            if(!name.endsWith(suffix)){\n-                nameWithSuffix = nameWithSuffix + suffix;\n+            //get the origin file suffix\n+            String originSuffix = FileUtils.suffix(originFullName);\n+            String suffix = FileUtils.suffix(fullName);\n+            if (!suffix.equals(originSuffix)) {\n+                //need verify whether this resource is authorized to other users\n+                Map<String, Object> columnMap = new HashMap<String, Object>();\n+                columnMap.put(\"resources_id\", resourceId);\n+\n+                List<ResourcesUser> resourcesUsers = resourceUserMapper.selectByMap(columnMap);\n+                if (CollectionUtils.isNotEmpty(resourcesUsers)) {\n+                    String users = resourcesUsers.stream().map(t -> t.getUserId()).collect(Collectors.toList()).toString();\n+                    logger.error(\"resource is authorized to user {},suffix not allowed to be modified\", users);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1NDQwNQ=="}, "originalCommit": {"oid": "d8b19e46008f266eb6ea2add17765f8ca8a80ede"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3519, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}