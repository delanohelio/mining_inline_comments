{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MjI4MDQ3", "number": 2113, "title": "access field handle of FileDescriptor in ProcessImplForWin32 by reflection for portability", "bodyText": "What is the purpose of the pull request\nCurrent implementation relies on sun.misc.JavaIOFileDescriptorAccess\nwhich is only accessible on oraclejdk8.\nBasically the demand is getting & setting handle field of FileDescriptor,\nso we can directly do that with reflection.\nThough, I suspect the necessity we introduce ProcessImplForWin32. Maybe\nwe could have a better way to support worker server to run bat script.\nBrief change log\nReplace JavaIOFileDescriptorAccess with reflections to FileDescriptor.\nVerify this pull request\nThis pull request is already covered by existing tests, such as\n\nProcessImplForWin32Test\n\nThis closes #2111 .", "createdAt": "2020-03-08T05:20:51Z", "url": "https://github.com/apache/dolphinscheduler/pull/2113", "merged": true, "mergeCommit": {"oid": "9224b49b58b756d22c75d8929108f716283282b4"}, "closed": true, "closedAt": "2020-03-09T11:06:42Z", "author": {"login": "tisonkun"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLiX0JAFqTM3MDgwNTUxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL74tBgFqTM3MTA3NjA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODA1NTE2", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-370805516", "createdAt": "2020-03-08T05:22:01Z", "commit": {"oid": "31be59d294f24c4b47e481244100bf6064f5acfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNToyMjowMVrOFzTOqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNToyMjowMVrOFzTOqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzNjc0NQ==", "bodyText": "I'm unfamiliar with exception strategy in DolphinScheduler so it would be better our committers can check whether the exception thrown obeys conventions.", "url": "https://github.com/apache/dolphinscheduler/pull/2113#discussion_r389336745", "createdAt": "2020-03-08T05:22:01Z", "author": {"login": "tisonkun"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/process/ProcessImplForWin32.java", "diffHunk": "@@ -33,8 +34,17 @@\n import static com.sun.jna.platform.win32.WinBase.STILL_ACTIVE;\n \n public class ProcessImplForWin32 extends Process {\n-    private static final sun.misc.JavaIOFileDescriptorAccess fdAccess\n-            = sun.misc.SharedSecrets.getJavaIOFileDescriptorAccess();\n+\n+    private static final Field FD_ACCESS;\n+\n+    static{\n+        try {\n+            FD_ACCESS = FileDescriptor.class.getDeclaredField(\"fd\");\n+            FD_ACCESS.setAccessible(true);\n+        } catch (NoSuchFieldException e) {\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31be59d294f24c4b47e481244100bf6064f5acfd"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODA1NTIx", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-370805521", "createdAt": "2020-03-08T05:22:12Z", "commit": {"oid": "31be59d294f24c4b47e481244100bf6064f5acfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNToyMjoxMlrOFzTOrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNToyMjoxMlrOFzTOrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzNjc1MQ==", "bodyText": "ditto", "url": "https://github.com/apache/dolphinscheduler/pull/2113#discussion_r389336751", "createdAt": "2020-03-08T05:22:12Z", "author": {"login": "tisonkun"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/process/ProcessImplForWin32.java", "diffHunk": "@@ -46,6 +56,22 @@\n \n     private static final WinNT.HANDLE JAVA_INVALID_HANDLE_VALUE = new WinNT.HANDLE(Pointer.createConstant(-1));\n \n+    private static void setFd(FileDescriptor obj, long fd) {\n+        try {\n+            FD_ACCESS.set(obj, fd);\n+        } catch (IllegalAccessException e) {\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31be59d294f24c4b47e481244100bf6064f5acfd"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODA1NTI0", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-370805524", "createdAt": "2020-03-08T05:22:17Z", "commit": {"oid": "31be59d294f24c4b47e481244100bf6064f5acfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNToyMjoxN1rOFzTOsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNToyMjoxN1rOFzTOsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMzNjc1NQ==", "bodyText": "ditto", "url": "https://github.com/apache/dolphinscheduler/pull/2113#discussion_r389336755", "createdAt": "2020-03-08T05:22:17Z", "author": {"login": "tisonkun"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/process/ProcessImplForWin32.java", "diffHunk": "@@ -46,6 +56,22 @@\n \n     private static final WinNT.HANDLE JAVA_INVALID_HANDLE_VALUE = new WinNT.HANDLE(Pointer.createConstant(-1));\n \n+    private static void setFd(FileDescriptor obj, long fd) {\n+        try {\n+            FD_ACCESS.set(obj, fd);\n+        } catch (IllegalAccessException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    private static long getFd(FileDescriptor obj) {\n+        try {\n+            return (Long) FD_ACCESS.get(obj);\n+        } catch (IllegalAccessException e) {\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31be59d294f24c4b47e481244100bf6064f5acfd"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31be59d294f24c4b47e481244100bf6064f5acfd", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/31be59d294f24c4b47e481244100bf6064f5acfd", "committedDate": "2020-03-08T05:13:38Z", "message": "access field fd of FileDescriptor in ProcessImplForWin32 by reflection for portability\n\nCurrent implementation relies on `sun.misc.JavaIOFileDescriptorAccess`\nwhich is only accessible on oraclejdk8.\n\nBasically the demand is getting & setting `fd` field of `FileDescriptor`,\nso we can directly do that with reflection.\n\nThough, I suspect the necessity we introduce ProcessImplForWin32. Maybe\nwe could have a better way to support worker server to run bat script."}, "afterCommit": {"oid": "ed6765ae31f2bee41d373fb178cbb1f027547c4b", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/ed6765ae31f2bee41d373fb178cbb1f027547c4b", "committedDate": "2020-03-08T05:26:44Z", "message": "access field fd of FileDescriptor in ProcessImplForWin32 by reflection for portability\n\nCurrent implementation relies on `sun.misc.JavaIOFileDescriptorAccess`\nwhich is only accessible on oraclejdk8.\n\nBasically the demand is getting & setting `fd` field of `FileDescriptor`,\nso we can directly do that with reflection.\n\nThough, I suspect the necessity we introduce ProcessImplForWin32. Maybe\nwe could have a better way to support worker server to run bat script."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODA4MzY5", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-370808369", "createdAt": "2020-03-08T06:47:12Z", "commit": {"oid": "ed6765ae31f2bee41d373fb178cbb1f027547c4b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODE0Nzk2", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-370814796", "createdAt": "2020-03-08T09:02:06Z", "commit": {"oid": "ed6765ae31f2bee41d373fb178cbb1f027547c4b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODE1MjM3", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-370815237", "createdAt": "2020-03-08T09:09:20Z", "commit": {"oid": "ed6765ae31f2bee41d373fb178cbb1f027547c4b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fb86a6a419fc6e681dc78f6b8585d6c6e74103a", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/1fb86a6a419fc6e681dc78f6b8585d6c6e74103a", "committedDate": "2020-03-08T09:48:02Z", "message": "access field handle of FileDescriptor in ProcessImplForWin32 by reflection for portability\n\nCurrent implementation relies on `sun.misc.JavaIOFileDescriptorAccess`\nwhich is only accessible on oraclejdk8.\n\nBasically the demand is getting & setting `handle` field of\n`FileDescriptor`, so we can directly do that with reflection.\n\nThough, I suspect the necessity we introduce ProcessImplForWin32. Maybe\nwe could have a better way to support worker server to run bat script."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7cd9bcc22b603834edb1bac8b28c4beceb2ae947", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/7cd9bcc22b603834edb1bac8b28c4beceb2ae947", "committedDate": "2020-03-08T09:47:10Z", "message": "Correct field name 'handle'"}, "afterCommit": {"oid": "1fb86a6a419fc6e681dc78f6b8585d6c6e74103a", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/1fb86a6a419fc6e681dc78f6b8585d6c6e74103a", "committedDate": "2020-03-08T09:48:02Z", "message": "access field handle of FileDescriptor in ProcessImplForWin32 by reflection for portability\n\nCurrent implementation relies on `sun.misc.JavaIOFileDescriptorAccess`\nwhich is only accessible on oraclejdk8.\n\nBasically the demand is getting & setting `handle` field of\n`FileDescriptor`, so we can directly do that with reflection.\n\nThough, I suspect the necessity we introduce ProcessImplForWin32. Maybe\nwe could have a better way to support worker server to run bat script."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9042b83f6fccc9d49634f05c506d9dbe0715c443", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/9042b83f6fccc9d49634f05c506d9dbe0715c443", "committedDate": "2020-03-09T01:57:21Z", "message": "harden initialization of ProcessImplForWin32"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c30fbc5a84742a98a1bc091e65e44dc3ecea5dd3", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/c30fbc5a84742a98a1bc091e65e44dc3ecea5dd3", "committedDate": "2020-03-09T01:58:39Z", "message": "ignore ShellTaskTest#testHandleForWindows outside Windows"}, "afterCommit": {"oid": "b22bce61d2e15fa4239cb9ee358fb5a3f7a69fc6", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b22bce61d2e15fa4239cb9ee358fb5a3f7a69fc6", "committedDate": "2020-03-09T02:42:17Z", "message": "ignore ShellTaskTest#testHandleForWindows outside Windows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b22bce61d2e15fa4239cb9ee358fb5a3f7a69fc6", "author": {"user": {"login": "tisonkun", "name": "tison"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b22bce61d2e15fa4239cb9ee358fb5a3f7a69fc6", "committedDate": "2020-03-09T02:42:17Z", "message": "ignore ShellTaskTest#testHandleForWindows outside Windows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODk0ODA4", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-370894808", "createdAt": "2020-03-09T02:54:30Z", "commit": {"oid": "b22bce61d2e15fa4239cb9ee358fb5a3f7a69fc6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMDc2MDYz", "url": "https://github.com/apache/dolphinscheduler/pull/2113#pullrequestreview-371076063", "createdAt": "2020-03-09T11:05:35Z", "commit": {"oid": "b22bce61d2e15fa4239cb9ee358fb5a3f7a69fc6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2053, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}