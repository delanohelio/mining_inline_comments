{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3NTYxMTM2", "number": 3188, "title": "[Bug-3187]close Heartbeat thread pool when MasterRegistry unRegistry", "bodyText": "fix #3187\nTips\n\nThanks very much for contributing to Apache DolphinScheduler.\nPlease review https://dolphinscheduler.apache.org/en-us/community/index.html before opening a pull request.\n\nWhat is the purpose of the pull request\n(For example: This pull request adds checkstyle plugin.)\nBrief change log\nClose Heartbeat thread pool when MasterRegistry unRegistry.\nAdd unit test\nVerify this pull request\n(Please pick either of the following options)\nThis pull request is code cleanup without any test coverage.\n(or)\nThis pull request is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded dolphinscheduler-dao tests for end-to-end.\nAdded CronUtilsTest to verify the change.\nManually verified the change by testing locally.", "createdAt": "2020-07-10T17:38:10Z", "url": "https://github.com/apache/dolphinscheduler/pull/3188", "merged": true, "mergeCommit": {"oid": "88f9bed726d479d4be4a46fb599161d5e61f496f"}, "closed": true, "closedAt": "2020-07-13T06:27:39Z", "author": {"login": "tswstarplanet"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcznLhRAH2gAyNDQ3NTYxMTM2OmE0MzIwYTkzNjE0M2FjYmUwYTIxMWVkMDk0MzRlNDBjZGEzMmRhOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0bUmggFqTQ0NzAwNjQzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a4320a936143acbe0a211ed09434e40cda32da92", "author": {"user": {"login": "tswstarplanet", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/a4320a936143acbe0a211ed09434e40cda32da92", "committedDate": "2020-07-10T17:35:06Z", "message": "[Bug-3187]close Heartbeat thread pool when MasterRegistry unRegistry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTk2NTEw", "url": "https://github.com/apache/dolphinscheduler/pull/3188#pullrequestreview-446596510", "createdAt": "2020-07-10T18:04:41Z", "commit": {"oid": "a4320a936143acbe0a211ed09434e40cda32da92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxODowNDo0MVrOGwAlDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxODowNDo0MVrOGwAlDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk5NDMxNw==", "bodyText": "It\u2019s a bit redundant here. If it\u2019s just for testing, I don\u2019t think it\u2019s necessary.", "url": "https://github.com/apache/dolphinscheduler/pull/3188#discussion_r452994317", "createdAt": "2020-07-10T18:04:41Z", "author": {"login": "CalvinKirs"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/registry/MasterRegistry.java", "diffHunk": "@@ -137,4 +142,7 @@ private String getLocalAddress(){\n \n     }\n \n+    public ScheduledExecutorService getHeartBeatExecutor() {\n+        return heartBeatExecutor;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4320a936143acbe0a211ed09434e40cda32da92"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Nzc0NTU4", "url": "https://github.com/apache/dolphinscheduler/pull/3188#pullrequestreview-446774558", "createdAt": "2020-07-11T03:39:24Z", "commit": {"oid": "a4320a936143acbe0a211ed09434e40cda32da92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMzozOToyNFrOGwKEoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMzozOToyNFrOGwKEoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0OTg1Nw==", "bodyText": "Hi,\nGood job, is it better to refer to WorkerRegistry[1] to use heartBeatExecutor.shutdownNow()?\n[1] https://github.com/apache/incubator-dolphinscheduler/blob/dev/dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/registry/WorkerRegistry.java", "url": "https://github.com/apache/dolphinscheduler/pull/3188#discussion_r453149857", "createdAt": "2020-07-11T03:39:24Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/registry/MasterRegistry.java", "diffHunk": "@@ -113,6 +110,14 @@ public void stateChanged(CuratorFramework client, ConnectionState newState) {\n     public void unRegistry() {\n         String address = getLocalAddress();\n         String localNodePath = getMasterPath();\n+        heartBeatExecutor.shutdown();\n+        try {\n+            if (heartBeatExecutor.awaitTermination(masterConfig.getMasterHeartbeatInterval(), TimeUnit.SECONDS)) {\n+                logger.warn(\"The heartbeat executor does not shutdown\");\n+            }\n+        } catch (InterruptedException e) {\n+            logger.warn(\"The heartbeat executor is interrupted\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4320a936143acbe0a211ed09434e40cda32da92"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b0e157b3c2833f05478c7dc4408e69f73a74008", "author": {"user": {"login": "tswstarplanet", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/5b0e157b3c2833f05478c7dc4408e69f73a74008", "committedDate": "2020-07-11T04:21:02Z", "message": "Merge branch 'dev' into close_thread_pool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a97d8ecc1902e8e884d19e7541ab4550981bf74d", "author": {"user": {"login": "tswstarplanet", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/a97d8ecc1902e8e884d19e7541ab4550981bf74d", "committedDate": "2020-07-11T04:27:43Z", "message": "use shutdownNow; delete redundant code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODAwMTMx", "url": "https://github.com/apache/dolphinscheduler/pull/3188#pullrequestreview-446800131", "createdAt": "2020-07-11T12:37:56Z", "commit": {"oid": "a97d8ecc1902e8e884d19e7541ab4550981bf74d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODAyNjEw", "url": "https://github.com/apache/dolphinscheduler/pull/3188#pullrequestreview-446802610", "createdAt": "2020-07-11T13:27:48Z", "commit": {"oid": "a97d8ecc1902e8e884d19e7541ab4550981bf74d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f291078fd3c5522a08fbbf0703e765969c5fc2", "author": {"user": {"login": "tswstarplanet", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/26f291078fd3c5522a08fbbf0703e765969c5fc2", "committedDate": "2020-07-12T03:34:42Z", "message": "Merge branch 'dev' into close_thread_pool"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDA2NDM3", "url": "https://github.com/apache/dolphinscheduler/pull/3188#pullrequestreview-447006437", "createdAt": "2020-07-13T06:20:05Z", "commit": {"oid": "26f291078fd3c5522a08fbbf0703e765969c5fc2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1883, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}