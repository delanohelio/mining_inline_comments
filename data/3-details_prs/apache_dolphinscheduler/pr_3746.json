{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MDI5NDc5", "number": 3746, "title": "[fix-3745][server] server get tasktype NPE exception", "bodyText": "What is the purpose of the pull request\n#3745\nswitch (EnumUtils.getEnum(TaskType.class,taskExecutionContext.getTaskType()))\n\nWhen the task type does not exist in the enumeration class TaskType, EnumUtils.getEnum() returns null, and switch will report a null pointer exception\nBrief change log\n1.TaskParametersUtils  switch tasktype param is not null\n1.TaskManager switch tasktype  param is not null\nVerify this pull request\nThis pull request is already covered by existing tests, such as (please describe tests).\nTaskParametersUtilsTest\nTaskManagerTest", "createdAt": "2020-09-15T04:41:56Z", "url": "https://github.com/apache/dolphinscheduler/pull/3746", "merged": true, "mergeCommit": {"oid": "36d534961020f7a44c9e4e2ac7594446597d88c6"}, "closed": true, "closedAt": "2020-09-17T05:58:44Z", "author": {"login": "zhuangchong"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI9tivgH2gAyNDg3MDI5NDc5OmQxMDk3MmFlNDAxNjdiNGY4ZDQyZGU5ZGU4NzRjMjFlMjcwZmU4NTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJpsZIgFqTQ5MDI0MjcxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d10972ae40167b4f8d42de9de874c21e270fe851", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/d10972ae40167b4f8d42de9de874c21e270fe851", "committedDate": "2020-09-15T01:42:35Z", "message": "server task type npe fix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b152c9c40f05f3d840c1da989cb49d30ff791d22", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/b152c9c40f05f3d840c1da989cb49d30ff791d22", "committedDate": "2020-09-15T04:28:13Z", "message": "server task type npe fix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/30f8f27643efeac8576983105db0fea37f7f0bb9", "committedDate": "2020-09-15T05:23:53Z", "message": "add checkstyle."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjY5NjM4", "url": "https://github.com/apache/dolphinscheduler/pull/3746#pullrequestreview-489269638", "createdAt": "2020-09-16T04:51:00Z", "commit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MTowMFrOHSf8pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MTowMFrOHSf8pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTg0NQ==", "bodyText": "Why not throw InvalidArgumentException?", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489159845", "createdAt": "2020-09-16T04:51:00Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/TaskParametersUtils.java", "diffHunk": "@@ -55,41 +55,42 @@ private TaskParametersUtils() {\n      * @return task parameters\n      */\n     public static AbstractParameters getParameters(String taskType, String parameter) {\n-        try {\n-            switch (EnumUtils.getEnum(TaskType.class, taskType)) {\n-                case SUB_PROCESS:\n-                    return JSONUtils.parseObject(parameter, SubProcessParameters.class);\n-                case SHELL:\n-                case WATERDROP:\n-                    return JSONUtils.parseObject(parameter, ShellParameters.class);\n-                case PROCEDURE:\n-                    return JSONUtils.parseObject(parameter, ProcedureParameters.class);\n-                case SQL:\n-                    return JSONUtils.parseObject(parameter, SqlParameters.class);\n-                case MR:\n-                    return JSONUtils.parseObject(parameter, MapreduceParameters.class);\n-                case SPARK:\n-                    return JSONUtils.parseObject(parameter, SparkParameters.class);\n-                case PYTHON:\n-                    return JSONUtils.parseObject(parameter, PythonParameters.class);\n-                case DEPENDENT:\n-                    return JSONUtils.parseObject(parameter, DependentParameters.class);\n-                case FLINK:\n-                    return JSONUtils.parseObject(parameter, FlinkParameters.class);\n-                case HTTP:\n-                    return JSONUtils.parseObject(parameter, HttpParameters.class);\n-                case DATAX:\n-                    return JSONUtils.parseObject(parameter, DataxParameters.class);\n-                case CONDITIONS:\n-                    return JSONUtils.parseObject(parameter, ConditionsParameters.class);\n-                case SQOOP:\n-                    return JSONUtils.parseObject(parameter, SqoopParameters.class);\n-                default:\n-                    return null;\n-            }\n-        } catch (Exception e) {\n-            logger.error(e.getMessage(), e);\n+        TaskType anEnum = EnumUtils.getEnum(TaskType.class, taskType);\n+        if (anEnum == null) {\n+            logger.error(\"not support task type: {}\", taskType);\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjcwMDI5", "url": "https://github.com/apache/dolphinscheduler/pull/3746#pullrequestreview-489270029", "createdAt": "2020-09-16T04:52:28Z", "commit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MjoyOFrOHSf-Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MjoyOFrOHSf-Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2MDIxMQ==", "bodyText": "The best practice for this should be @test(expected= IllegalArgumentException.class)", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489160211", "createdAt": "2020-09-16T04:52:28Z", "author": {"login": "Technoboy-"}, "path": "dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/worker/task/TaskManagerTest.java", "diffHunk": "@@ -95,9 +97,19 @@ public void testNewTask() {\n         Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n         taskExecutionContext.setTaskType(\"SQOOP\");\n         Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n-        //taskExecutionContext.setTaskType(null);\n-        //Assert.assertNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n-        //taskExecutionContext.setTaskType(\"XXX\");\n-        //Assert.assertNotNull(TaskManager.newTask(taskExecutionContext,taskLogger));\n+        try {\n+            taskExecutionContext.setTaskType(null);\n+            TaskManager.newTask(taskExecutionContext,taskLogger);\n+        } catch (Exception e) {\n+            logger.error(e.getMessage());\n+        }\n+\n+        try {\n+            taskExecutionContext.setTaskType(\"XXX\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjY5NTM0", "url": "https://github.com/apache/dolphinscheduler/pull/3746#pullrequestreview-489269534", "createdAt": "2020-09-16T04:50:39Z", "commit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MDo0MFrOHSf8Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDo1MjozMVrOHSf-Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTc2Mg==", "bodyText": "it will be better to use log pattern\uff0cnot string format.", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489159762", "createdAt": "2020-09-16T04:50:40Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/TaskManager.java", "diffHunk": "@@ -69,8 +74,9 @@ public static AbstractTask newTask(TaskExecutionContext taskExecutionContext, Lo\n             case SQOOP:\n                 return new SqoopTask(taskExecutionContext, logger);\n             default:\n-                logger.error(\"unsupport task type: {}\", taskExecutionContext.getTaskType());\n-                throw new IllegalArgumentException(\"not support task type\");\n+                String msg = String.format(\"not support task type: %s\", taskExecutionContext.getTaskType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2MDIyNw==", "bodyText": "Why not throw InvalidArgumentException?\n\n+1\uff0c fail fast will be better.", "url": "https://github.com/apache/dolphinscheduler/pull/3746#discussion_r489160227", "createdAt": "2020-09-16T04:52:31Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/TaskParametersUtils.java", "diffHunk": "@@ -55,41 +55,42 @@ private TaskParametersUtils() {\n      * @return task parameters\n      */\n     public static AbstractParameters getParameters(String taskType, String parameter) {\n-        try {\n-            switch (EnumUtils.getEnum(TaskType.class, taskType)) {\n-                case SUB_PROCESS:\n-                    return JSONUtils.parseObject(parameter, SubProcessParameters.class);\n-                case SHELL:\n-                case WATERDROP:\n-                    return JSONUtils.parseObject(parameter, ShellParameters.class);\n-                case PROCEDURE:\n-                    return JSONUtils.parseObject(parameter, ProcedureParameters.class);\n-                case SQL:\n-                    return JSONUtils.parseObject(parameter, SqlParameters.class);\n-                case MR:\n-                    return JSONUtils.parseObject(parameter, MapreduceParameters.class);\n-                case SPARK:\n-                    return JSONUtils.parseObject(parameter, SparkParameters.class);\n-                case PYTHON:\n-                    return JSONUtils.parseObject(parameter, PythonParameters.class);\n-                case DEPENDENT:\n-                    return JSONUtils.parseObject(parameter, DependentParameters.class);\n-                case FLINK:\n-                    return JSONUtils.parseObject(parameter, FlinkParameters.class);\n-                case HTTP:\n-                    return JSONUtils.parseObject(parameter, HttpParameters.class);\n-                case DATAX:\n-                    return JSONUtils.parseObject(parameter, DataxParameters.class);\n-                case CONDITIONS:\n-                    return JSONUtils.parseObject(parameter, ConditionsParameters.class);\n-                case SQOOP:\n-                    return JSONUtils.parseObject(parameter, SqoopParameters.class);\n-                default:\n-                    return null;\n-            }\n-        } catch (Exception e) {\n-            logger.error(e.getMessage(), e);\n+        TaskType anEnum = EnumUtils.getEnum(TaskType.class, taskType);\n+        if (anEnum == null) {\n+            logger.error(\"not support task type: {}\", taskType);\n+            return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1OTg0NQ=="}, "originalCommit": {"oid": "30f8f27643efeac8576983105db0fea37f7f0bb9"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9cb3cc9af23048c67a70ba087a0647c7d7cfccb", "author": {"user": null}, "url": "https://github.com/apache/dolphinscheduler/commit/f9cb3cc9af23048c67a70ba087a0647c7d7cfccb", "committedDate": "2020-09-16T09:16:07Z", "message": "update."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMTk0NTY4", "url": "https://github.com/apache/dolphinscheduler/pull/3746#pullrequestreview-490194568", "createdAt": "2020-09-17T02:07:57Z", "commit": {"oid": "f9cb3cc9af23048c67a70ba087a0647c7d7cfccb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMjQyNzE3", "url": "https://github.com/apache/dolphinscheduler/pull/3746#pullrequestreview-490242717", "createdAt": "2020-09-17T04:57:09Z", "commit": {"oid": "f9cb3cc9af23048c67a70ba087a0647c7d7cfccb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1711, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}