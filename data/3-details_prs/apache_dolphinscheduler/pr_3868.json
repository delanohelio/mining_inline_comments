{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3ODcwOTI3", "number": 3868, "title": "[FIX_BUG_1.3#3789][remote]support netty heart beat", "bodyText": "this closes #3789", "createdAt": "2020-10-05T13:51:58Z", "url": "https://github.com/apache/dolphinscheduler/pull/3868", "merged": true, "mergeCommit": {"oid": "08dc6913dcfa9205bab3ccbffd23902e326bdc4e"}, "closed": true, "closedAt": "2020-10-12T15:29:39Z", "author": {"login": "CalvinKirs"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPPwURgH2gAyNDk3ODcwOTI3OjRiNzc0ZjEyYjcxNzlmNDlhMzE1ZTA4MjEzNjA1YzE5NDgzNGUxMTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR1sazAFqTUwNjcxOTA1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4b774f12b7179f49a315e08213605c194834e114", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/4b774f12b7179f49a315e08213605c194834e114", "committedDate": "2020-10-04T14:07:27Z", "message": "[FIX_BUG_1.3#3789][remote]support netty heart beat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72bb9c336b11d6ab9e0a5f8b30694830dd05ae22", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/72bb9c336b11d6ab9e0a5f8b30694830dd05ae22", "committedDate": "2020-10-05T13:50:05Z", "message": " netty heart beat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f14e6b94b870104c10d8ef54d1cd93a7cd833c25", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/f14e6b94b870104c10d8ef54d1cd93a7cd833c25", "committedDate": "2020-10-08T06:20:32Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaf7ea0d74939a09223caae1ee9b662e66a4c6da", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/aaf7ea0d74939a09223caae1ee9b662e66a4c6da", "committedDate": "2020-10-08T06:40:55Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3463483ab7f495e8eac25aff2f2bc791001dabc", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/c3463483ab7f495e8eac25aff2f2bc791001dabc", "committedDate": "2020-10-08T06:44:23Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e06e14151da4a08a6e88c87b731d105444bad65e", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/e06e14151da4a08a6e88c87b731d105444bad65e", "committedDate": "2020-10-08T09:20:42Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3932af57185d7db06c1e5fb84777db26193ec2f1", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/3932af57185d7db06c1e5fb84777db26193ec2f1", "committedDate": "2020-10-08T09:34:36Z", "message": "code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDU2Mzk0", "url": "https://github.com/apache/dolphinscheduler/pull/3868#pullrequestreview-506056394", "createdAt": "2020-10-10T02:11:14Z", "commit": {"oid": "3932af57185d7db06c1e5fb84777db26193ec2f1"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwMjoxMToxNFrOHfcZaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwMjoxMjoxMFrOHfcZyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczMzE2MA==", "bodyText": "It's better if we distinguish the READER_IDLE and WRITER_IDLE event", "url": "https://github.com/apache/dolphinscheduler/pull/3868#discussion_r502733160", "createdAt": "2020-10-10T02:11:14Z", "author": {"login": "gabrywu"}, "path": "dolphinscheduler-remote/src/main/java/org/apache/dolphinscheduler/remote/handler/NettyClientHandler.java", "diffHunk": "@@ -175,4 +183,16 @@ public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws E\n         ctx.channel().close();\n     }\n \n+    @Override\n+    public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception {\n+        if (evt instanceof IdleStateEvent) {\n+            Command heartBeat = new Command();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3932af57185d7db06c1e5fb84777db26193ec2f1"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczMzI1OQ==", "bodyText": "It's better if we distinguish the READER_IDLE and WRITER_IDLE event", "url": "https://github.com/apache/dolphinscheduler/pull/3868#discussion_r502733259", "createdAt": "2020-10-10T02:12:10Z", "author": {"login": "gabrywu"}, "path": "dolphinscheduler-remote/src/main/java/org/apache/dolphinscheduler/remote/handler/NettyServerHandler.java", "diffHunk": "@@ -158,16 +168,26 @@ public void channelWritabilityChanged(ChannelHandlerContext ctx) throws Exceptio\n         if (!ch.isWritable()) {\n             if (logger.isWarnEnabled()) {\n                 logger.warn(\"{} is not writable, over high water level : {}\",\n-                        ch, config.getWriteBufferHighWaterMark());\n+                    ch, config.getWriteBufferHighWaterMark());\n             }\n \n             config.setAutoRead(false);\n         } else {\n             if (logger.isWarnEnabled()) {\n                 logger.warn(\"{} is writable, to low water : {}\",\n-                        ch, config.getWriteBufferLowWaterMark());\n+                    ch, config.getWriteBufferLowWaterMark());\n             }\n             config.setAutoRead(true);\n         }\n     }\n+\n+    @Override\n+    public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception {\n+        // send heartbeat when read idle.\n+        if (evt instanceof IdleStateEvent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3932af57185d7db06c1e5fb84777db26193ec2f1"}, "originalPosition": 162}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cadf8d56db1add1a45e54e36c8de7db1dd3cca58", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/cadf8d56db1add1a45e54e36c8de7db1dd3cca58", "committedDate": "2020-10-10T03:33:04Z", "message": "delete code docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3801147d92a11fc0b13d286fefae8d48975ec9a7", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/3801147d92a11fc0b13d286fefae8d48975ec9a7", "committedDate": "2020-10-12T02:52:52Z", "message": "client fail-close"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzE5MDU2", "url": "https://github.com/apache/dolphinscheduler/pull/3868#pullrequestreview-506719056", "createdAt": "2020-10-12T15:27:26Z", "commit": {"oid": "3801147d92a11fc0b13d286fefae8d48975ec9a7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2321, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}