{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNDMwOTcw", "number": 3582, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo1Njo0MlrOEclnrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo1Njo0MlrOEclnrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDExOTQ4OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/impl/ProcessDefinitionServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzo1Njo0MlrOHHNX4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODowNzo1MFrOHIFH9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMTE4NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<ProcessInstance> processInstances =  processInstanceMapper.queryByProcessDefineIdAndStatus(processDefinitionId, Constants.NOT_TERMINATED_STATES);\n          \n          \n            \n                    if (CollectionUtils.isNotEmpty(processInstances)) {\n          \n          \n            \n                        putMsg(result, Status.DELETE_PROCESS_DEFINITION_BY_ID_FAIL,processInstances.size());\n          \n          \n            \n                        return result;\n          \n          \n            \n                    }\n          \n          \n            \n                    List<ProcessInstance> processInstances =  processInstanceService.queryByProcessDefineIdAndStatus(processDefinitionId, Constants.NOT_TERMINATED_STATES);\n          \n          \n            \n                    if (CollectionUtils.isNotEmpty(processInstances)) {\n          \n          \n            \n                        putMsg(result, Status.DELETE_PROCESS_DEFINITION_BY_ID_FAIL,processInstances.size());\n          \n          \n            \n                        return result;\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nHi,\nIn processDefinitionService service layer, it is not recommended straightly use processInstanceMapper dao layer, this part should be in processInstanceService, use processInstanceService here.", "url": "https://github.com/apache/dolphinscheduler/pull/3582#discussion_r477321185", "createdAt": "2020-08-26T13:56:42Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/impl/ProcessDefinitionServiceImpl.java", "diffHunk": "@@ -488,6 +488,12 @@ private String getResourceIds(ProcessData processData) {\n             putMsg(result, Status.PROCESS_DEFINE_STATE_ONLINE, processDefinitionId);\n             return result;\n         }\n+        // check process instances is already running\n+        List<ProcessInstance> processInstances =  processInstanceMapper.queryByProcessDefineIdAndStatus(processDefinitionId, Constants.NOT_TERMINATED_STATES);\n+        if (CollectionUtils.isNotEmpty(processInstances)) {\n+            putMsg(result, Status.DELETE_PROCESS_DEFINITION_BY_ID_FAIL,processInstances.size());\n+            return result;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f927f0fac150f822d5e9bd219db3284b99373ed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIzNDYxMw==", "bodyText": "Processinstanceservice has been used. Processinstanceservice should implement the interface. There are contributors who have submitted branches. I have not changed this.\n\n\u5df2\u4f7f\u7528processInstanceService \uff0cprocessInstanceService \u5e94\u8be5\u5b9e\u73b0\u63a5\u53e3\uff0c\u5df2\u7ecf\u6709\u8d21\u732e\u8005\u63d0\u4ea4\u5206\u652f\uff0c\u8fd9\u5757\u6211\u6ca1\u6709\u6539.", "url": "https://github.com/apache/dolphinscheduler/pull/3582#discussion_r478234613", "createdAt": "2020-08-27T08:07:50Z", "author": {"login": "zhuangchong"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/impl/ProcessDefinitionServiceImpl.java", "diffHunk": "@@ -488,6 +488,12 @@ private String getResourceIds(ProcessData processData) {\n             putMsg(result, Status.PROCESS_DEFINE_STATE_ONLINE, processDefinitionId);\n             return result;\n         }\n+        // check process instances is already running\n+        List<ProcessInstance> processInstances =  processInstanceMapper.queryByProcessDefineIdAndStatus(processDefinitionId, Constants.NOT_TERMINATED_STATES);\n+        if (CollectionUtils.isNotEmpty(processInstances)) {\n+            putMsg(result, Status.DELETE_PROCESS_DEFINITION_BY_ID_FAIL,processInstances.size());\n+            return result;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMTE4NQ=="}, "originalCommit": {"oid": "2f927f0fac150f822d5e9bd219db3284b99373ed"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3336, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}