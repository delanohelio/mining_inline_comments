{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2ODY2NjM2", "number": 3315, "title": "add feature : query top n success process instance order by running duration", "bodyText": "What is the purpose of the pull request\nclose (#3191)\nBrief change log\n\nadd function in ProcessInstanceController.java , ProcessInstanceService.java , ProcessInstanceMapper.java\nadd some test in ProcessInstanceServiceTest.java , ProcessInstanceMapperTest.java\nadd some constant/status in Status.java , Constants.java\nadd some sql in ProcessInstanceMapper.xml\n\nVerify this pull request\nManually verified the change by testing locally.", "createdAt": "2020-07-27T02:55:19Z", "url": "https://github.com/apache/dolphinscheduler/pull/3315", "merged": true, "mergeCommit": {"oid": "0c5754c3f2216d3262c12bee0ecb9ea559a85419"}, "closed": true, "closedAt": "2020-07-30T10:39:00Z", "author": {"login": "RedemptionC"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc44uHrAH2gAyNDU2ODY2NjM2OjZkM2M0Mzc4ZTljODUwYjdhYmJhZWJmN2EyOWI0OWNmNWVjNDhmM2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc59NHZAFqTQ1ODI4NDE3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6d3c4378e9c850b7abbaebf7a29b49cf5ec48f3e", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/6d3c4378e9c850b7abbaebf7a29b49cf5ec48f3e", "committedDate": "2020-07-27T02:50:54Z", "message": "add feature : query top n success process instance order by running duration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05cd5f5bcb85dfbaa8fe350f0c85b92b2576a63a", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/05cd5f5bcb85dfbaa8fe350f0c85b92b2576a63a", "committedDate": "2020-07-27T03:25:49Z", "message": "add feature : add params check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8970b544854320deac83f64afdb7c3249d4ac335", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/8970b544854320deac83f64afdb7c3249d4ac335", "committedDate": "2020-07-27T10:39:58Z", "message": "add feature : remove code smell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcb6999dd9d20e5126811bfea4865444d1261bdf", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/fcb6999dd9d20e5126811bfea4865444d1261bdf", "committedDate": "2020-07-27T11:53:00Z", "message": "add feature : remove code smell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "333add157d16d5667d0d7298091a25f2a24f2d84", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/333add157d16d5667d0d7298091a25f2a24f2d84", "committedDate": "2020-07-27T12:04:49Z", "message": "add feature : add param check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NzI5MzI1", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-455729325", "createdAt": "2020-07-27T12:22:24Z", "commit": {"oid": "333add157d16d5667d0d7298091a25f2a24f2d84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMjoyMjoyNFrOG3gF_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMjoyMjoyNFrOG3gF_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg1MDY4Ng==", "bodyText": "You should improve the handleEscapes method, this is a historical problem.  like this:return inputString.replace(\"%\", \"////%\").replaceAll(\"[\\n|\\r|\\t]\", \"_\");", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r460850686", "createdAt": "2020-07-27T12:22:24Z", "author": {"login": "CalvinKirs"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessInstanceController.java", "diffHunk": "@@ -204,6 +205,29 @@ public Result queryProcessInstanceById(@ApiIgnore @RequestAttribute(value = Cons\n         return returnDataList(result);\n     }\n \n+    @ApiOperation(value = \"queryTopNLongestRunningProcessInstance\", notes = \"QUERY_TOPN_LONGEST_RUNNING_PROCESS_INSTANCE_NOTES\")\n+    @ApiImplicitParams({\n+            @ApiImplicitParam(name = \"size\", value = \"PROCESS_INSTANCE_SIZE\", dataType = \"Int\", example = \"10\"),\n+            @ApiImplicitParam(name = \"startTime\", value = \"PROCESS_INSTANCE_START_TIME\", dataType = \"String\"),\n+            @ApiImplicitParam(name = \"endTime\", value = \"PROCESS_INSTANCE_END_TIME\", dataType = \"String\"),\n+    })\n+    @GetMapping(value = \"/top-n\")\n+    @ResponseStatus(HttpStatus.OK)\n+    @ApiException(QUERY_PROCESS_INSTANCE_BY_ID_ERROR)\n+    public Result<ProcessInstance> queryTopNLongestRunningProcessInstance(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n+                                                         @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                                         @RequestParam(\"size\") Integer size,\n+                                                         @RequestParam(value = \"startTime\",required = true) String startTime,\n+                                                         @RequestParam(value = \"endTime\",required = true) String endTime\n+\n+    ){\n+        projectName=projectName.replaceAll(\"[\\n|\\r\\t]\", \"_\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333add157d16d5667d0d7298091a25f2a24f2d84"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/a5d0557bf30ee757e0c259a4aedc650ac37f4fd4", "committedDate": "2020-07-27T12:27:48Z", "message": "add feature : add param check\nimprove handleEscape method in ParameterUtils.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ0MDcw", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457444070", "createdAt": "2020-07-29T11:48:52Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo0ODo1MlrOG400Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo0ODo1MlrOG400Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIzODcyMg==", "bodyText": "Hi,\nIt will be better to add the java docs like[1] here. can you do it?\n[1]", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462238722", "createdAt": "2020-07-29T11:48:52Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessInstanceController.java", "diffHunk": "@@ -204,6 +205,29 @@ public Result queryProcessInstanceById(@ApiIgnore @RequestAttribute(value = Cons\n         return returnDataList(result);\n     }\n \n+    @ApiOperation(value = \"queryTopNLongestRunningProcessInstance\", notes = \"QUERY_TOPN_LONGEST_RUNNING_PROCESS_INSTANCE_NOTES\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ0NzU4", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457444758", "createdAt": "2020-07-29T11:49:59Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ1ODI0", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457445824", "createdAt": "2020-07-29T11:51:34Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MTozNVrOG405qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MTozNVrOG405qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MDE3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Date end=DateUtils.stringToDate(endTime);\n          \n          \n            \n                    Date end = DateUtils.stringToDate(endTime);", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462240170", "createdAt": "2020-07-29T11:51:35Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessInstanceService.java", "diffHunk": "@@ -98,6 +98,53 @@\n     @Autowired\n     UsersService usersService;\n \n+    /**\n+     * return top n SUCCESS process instance order by running time which started between startTime and endTime\n+     * @param loginUser\n+     * @param projectName\n+     * @param size\n+     * @param startTime\n+     * @param endTime\n+     * @return\n+     */\n+    public Map<String, Object> queryTopNLongestRunningProcessInstance(User loginUser,String projectName,int size, String startTime, String endTime) {\n+        Map<String, Object> result = new HashMap<>();\n+\n+        Project project = projectMapper.queryByName(projectName);\n+        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n+        Status resultEnum = (Status) checkResult.get(Constants.STATUS);\n+        if (resultEnum != Status.SUCCESS) {\n+            return checkResult;\n+        }\n+\n+        if (0 > size) {\n+            putMsg(result, Status.NEGTIVE_SIZE_NUMBER_ERROR, size);\n+            return result;\n+        }\n+        if (Objects.isNull(startTime)) {\n+            putMsg(result, Status.DATA_IS_NULL, Constants.START_TIME);\n+            return result;\n+        }\n+        Date start=DateUtils.stringToDate(startTime);\n+        if (Objects.isNull(endTime)) {\n+            putMsg(result, Status.DATA_IS_NULL, Constants.END_TIME);\n+            return result;\n+        }\n+        Date end=DateUtils.stringToDate(endTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ1OTk5", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457445999", "createdAt": "2020-07-29T11:51:51Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MTo1MVrOG406Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MTo1MVrOG406Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MDMwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Date start=DateUtils.stringToDate(startTime);\n          \n          \n            \n                    Date start = DateUtils.stringToDate(startTime);", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462240307", "createdAt": "2020-07-29T11:51:51Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessInstanceService.java", "diffHunk": "@@ -98,6 +98,53 @@\n     @Autowired\n     UsersService usersService;\n \n+    /**\n+     * return top n SUCCESS process instance order by running time which started between startTime and endTime\n+     * @param loginUser\n+     * @param projectName\n+     * @param size\n+     * @param startTime\n+     * @param endTime\n+     * @return\n+     */\n+    public Map<String, Object> queryTopNLongestRunningProcessInstance(User loginUser,String projectName,int size, String startTime, String endTime) {\n+        Map<String, Object> result = new HashMap<>();\n+\n+        Project project = projectMapper.queryByName(projectName);\n+        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n+        Status resultEnum = (Status) checkResult.get(Constants.STATUS);\n+        if (resultEnum != Status.SUCCESS) {\n+            return checkResult;\n+        }\n+\n+        if (0 > size) {\n+            putMsg(result, Status.NEGTIVE_SIZE_NUMBER_ERROR, size);\n+            return result;\n+        }\n+        if (Objects.isNull(startTime)) {\n+            putMsg(result, Status.DATA_IS_NULL, Constants.START_TIME);\n+            return result;\n+        }\n+        Date start=DateUtils.stringToDate(startTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ2MTYx", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457446161", "createdAt": "2020-07-29T11:52:08Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MjowOFrOG406sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MjowOFrOG406sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MDQzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Map<String, Object> queryTopNLongestRunningProcessInstance(User loginUser,String projectName,int size, String startTime, String endTime) {\n          \n          \n            \n                public Map<String, Object> queryTopNLongestRunningProcessInstance(User loginUser, String projectName, int size, String startTime, String endTime) {", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462240435", "createdAt": "2020-07-29T11:52:08Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessInstanceService.java", "diffHunk": "@@ -98,6 +98,53 @@\n     @Autowired\n     UsersService usersService;\n \n+    /**\n+     * return top n SUCCESS process instance order by running time which started between startTime and endTime\n+     * @param loginUser\n+     * @param projectName\n+     * @param size\n+     * @param startTime\n+     * @param endTime\n+     * @return\n+     */\n+    public Map<String, Object> queryTopNLongestRunningProcessInstance(User loginUser,String projectName,int size, String startTime, String endTime) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ2NDg1", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457446485", "createdAt": "2020-07-29T11:52:40Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1Mjo0MFrOG4070Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1Mjo0MFrOG4070Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MDcyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final String START_TIME=\"start time\";\n          \n          \n            \n                public static final String END_TIME=\"end time\";\n          \n          \n            \n                public static final String START_TIME = \"start time\";\n          \n          \n            \n                public static final String END_TIME = \"end time\";", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462240721", "createdAt": "2020-07-29T11:52:40Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/Constants.java", "diffHunk": "@@ -978,6 +978,8 @@ private Constants() {\n     public static final int NORAML_NODE_STATUS = 0;\n     public static final int ABNORMAL_NODE_STATUS = 1;\n \n+    public static final String START_TIME=\"start time\";\n+    public static final String END_TIME=\"end time\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ3MDQ3", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457447047", "createdAt": "2020-07-29T11:53:37Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MzozOFrOG409pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1MzozOFrOG409pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MTE5MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testQueryTopNLongestRunningProcessInstance(){\n          \n          \n            \n                public void testQueryTopNLongestRunningProcessInstance() {", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462241191", "createdAt": "2020-07-29T11:53:38Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/test/java/org/apache/dolphinscheduler/api/service/ProcessInstanceServiceTest.java", "diffHunk": "@@ -147,6 +147,40 @@ public void testQueryProcessInstanceList() {\n \n     }\n \n+    @Test\n+    public void testQueryTopNLongestRunningProcessInstance(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ3MTYz", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457447163", "createdAt": "2020-07-29T11:53:46Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1Mzo0NlrOG40-Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1Mzo0NlrOG40-Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MTI5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(start == null || end == null){\n          \n          \n            \n                    if(start == null || end == null) {", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462241290", "createdAt": "2020-07-29T11:53:46Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ProcessInstanceService.java", "diffHunk": "@@ -98,6 +98,53 @@\n     @Autowired\n     UsersService usersService;\n \n+    /**\n+     * return top n SUCCESS process instance order by running time which started between startTime and endTime\n+     * @param loginUser\n+     * @param projectName\n+     * @param size\n+     * @param startTime\n+     * @param endTime\n+     * @return\n+     */\n+    public Map<String, Object> queryTopNLongestRunningProcessInstance(User loginUser,String projectName,int size, String startTime, String endTime) {\n+        Map<String, Object> result = new HashMap<>();\n+\n+        Project project = projectMapper.queryByName(projectName);\n+        Map<String, Object> checkResult = projectService.checkProjectAndAuth(loginUser, project, projectName);\n+        Status resultEnum = (Status) checkResult.get(Constants.STATUS);\n+        if (resultEnum != Status.SUCCESS) {\n+            return checkResult;\n+        }\n+\n+        if (0 > size) {\n+            putMsg(result, Status.NEGTIVE_SIZE_NUMBER_ERROR, size);\n+            return result;\n+        }\n+        if (Objects.isNull(startTime)) {\n+            putMsg(result, Status.DATA_IS_NULL, Constants.START_TIME);\n+            return result;\n+        }\n+        Date start=DateUtils.stringToDate(startTime);\n+        if (Objects.isNull(endTime)) {\n+            putMsg(result, Status.DATA_IS_NULL, Constants.END_TIME);\n+            return result;\n+        }\n+        Date end=DateUtils.stringToDate(endTime);\n+        if(start == null || end == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ3Mzk1", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457447395", "createdAt": "2020-07-29T11:54:08Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1NDowOVrOG40-2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1NDowOVrOG40-2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MTQ5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                ){\n          \n          \n            \n                ) {", "url": "https://github.com/apache/dolphinscheduler/pull/3315#discussion_r462241499", "createdAt": "2020-07-29T11:54:09Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ProcessInstanceController.java", "diffHunk": "@@ -204,6 +205,29 @@ public Result queryProcessInstanceById(@ApiIgnore @RequestAttribute(value = Cons\n         return returnDataList(result);\n     }\n \n+    @ApiOperation(value = \"queryTopNLongestRunningProcessInstance\", notes = \"QUERY_TOPN_LONGEST_RUNNING_PROCESS_INSTANCE_NOTES\")\n+    @ApiImplicitParams({\n+            @ApiImplicitParam(name = \"size\", value = \"PROCESS_INSTANCE_SIZE\", dataType = \"Int\", example = \"10\"),\n+            @ApiImplicitParam(name = \"startTime\", value = \"PROCESS_INSTANCE_START_TIME\", dataType = \"String\"),\n+            @ApiImplicitParam(name = \"endTime\", value = \"PROCESS_INSTANCE_END_TIME\", dataType = \"String\"),\n+    })\n+    @GetMapping(value = \"/top-n\")\n+    @ResponseStatus(HttpStatus.OK)\n+    @ApiException(QUERY_PROCESS_INSTANCE_BY_ID_ERROR)\n+    public Result<ProcessInstance> queryTopNLongestRunningProcessInstance(@ApiIgnore @RequestAttribute(value = Constants.SESSION_USER) User loginUser,\n+                                                         @ApiParam(name = \"projectName\", value = \"PROJECT_NAME\", required = true) @PathVariable String projectName,\n+                                                         @RequestParam(\"size\") Integer size,\n+                                                         @RequestParam(value = \"startTime\",required = true) String startTime,\n+                                                         @RequestParam(value = \"endTime\",required = true) String endTime\n+\n+    ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDQ3ODM0", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457447834", "createdAt": "2020-07-29T11:54:51Z", "commit": {"oid": "a5d0557bf30ee757e0c259a4aedc650ac37f4fd4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "372b83b55bd10ab5c8c62224a6df824a14257902", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/372b83b55bd10ab5c8c62224a6df824a14257902", "committedDate": "2020-07-29T12:23:05Z", "message": "top n : add  java doc and format code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "135ffe4c9973790a239f253a67a8cf0fb04b0582", "author": {"user": {"login": "RedemptionC", "name": null}}, "url": "https://github.com/apache/dolphinscheduler/commit/135ffe4c9973790a239f253a67a8cf0fb04b0582", "committedDate": "2020-07-29T12:23:23Z", "message": "Merge branch 'dev' of https://github.com/apache/incubator-dolphinscheduler into dev"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NjUzMzIz", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-457653323", "createdAt": "2020-07-29T15:45:23Z", "commit": {"oid": "135ffe4c9973790a239f253a67a8cf0fb04b0582"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4Mjg0MTcz", "url": "https://github.com/apache/dolphinscheduler/pull/3315#pullrequestreview-458284173", "createdAt": "2020-07-30T10:38:18Z", "commit": {"oid": "135ffe4c9973790a239f253a67a8cf0fb04b0582"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1806, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}