{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTcxMjgz", "number": 2677, "title": "Optimization of enumerated values method", "bodyText": "The values method of enum is a deep copy, it is not recommended to use the value method. Specifically see jmh results\nTips\n\nThanks very much for contributing to Apache DolphinScheduler.\nPlease review https://dolphinscheduler.apache.org/en-us/community/index.html before opening a pull request.\n\nWhat is the purpose of the pull request\nAs mentioned above,The value method of enum is a deep copy, it is not recommended to use the value method. Specifically see jmh results.\nBrief change log\nOptimization of enumerated values method\nVerify this pull request\n(Please pick either of the following options)\nThis pull request is code cleanup without any test coverage.\n(or)\nThis pull request is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\njmh test and junit test", "createdAt": "2020-05-11T09:13:25Z", "url": "https://github.com/apache/dolphinscheduler/pull/2677", "merged": true, "mergeCommit": {"oid": "c8ab27acb0cd6d0b4e251a2d4cf7e4a7aa33ae89"}, "closed": true, "closedAt": "2020-05-31T02:29:47Z", "author": {"login": "CalvinKirs"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgL8eQAH2gAyNDE1OTcxMjgzOmUwNmMzMWU3N2NhNzkwYTVjMDkwMjQ3ZDg3NDI5OGJmZDQ3ZjM1OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmYsdKgH2gAyNDE1OTcxMjgzOjM2OThlODEyMjA5MmNiYjI3M2Q4NzY2YTQxY2QzYmY3NjEyYTBmOTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e06c31e77ca790a5c090247d874298bfd47f3599", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/e06c31e77ca790a5c090247d874298bfd47f3599", "committedDate": "2020-05-11T09:06:40Z", "message": "The value method of enum is a deep copy. If there are many parameters, it is not recommended to use the value method. Specifically see jmh results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0de5d0ffebef233ee6de0024f27a7de09cb7a97e", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0de5d0ffebef233ee6de0024f27a7de09cb7a97e", "committedDate": "2020-05-11T09:14:02Z", "message": "Merge branch 'dev' into enum"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTMzMzc4", "url": "https://github.com/apache/dolphinscheduler/pull/2677#pullrequestreview-409933378", "createdAt": "2020-05-12T11:07:03Z", "commit": {"oid": "0de5d0ffebef233ee6de0024f27a7de09cb7a97e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTowNzowM1rOGUBgNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTowNzowM1rOGUBgNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY0OTMzNQ==", "bodyText": "do you have better idea? I think the map key will be easy to make wrong with the enum self ,  actually , it write twice now, these number  will be easy to wrong", "url": "https://github.com/apache/dolphinscheduler/pull/2677#discussion_r423649335", "createdAt": "2020-05-12T11:07:03Z", "author": {"login": "dailidong"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/enums/CommandType.java", "diffHunk": "@@ -66,11 +69,26 @@ public String getDescp() {\n         return descp;\n     }\n \n-    public static CommandType of(Integer status){\n-        for(CommandType cmdType : values()){\n-            if(cmdType.getCode() == status){\n-                return cmdType;\n-            }\n+    private static final Map<Integer, CommandType> COMMAND_TYPE_MAP = new HashMap<>();\n+\n+    static {\n+        COMMAND_TYPE_MAP.put(0, START_PROCESS);\n+        COMMAND_TYPE_MAP.put(1, START_CURRENT_TASK_PROCESS);\n+        COMMAND_TYPE_MAP.put(2, RECOVER_TOLERANCE_FAULT_PROCESS);\n+        COMMAND_TYPE_MAP.put(3, RECOVER_SUSPENDED_PROCESS);\n+        COMMAND_TYPE_MAP.put(4, START_FAILURE_TASK_PROCESS);\n+        COMMAND_TYPE_MAP.put(5, COMPLEMENT_DATA);\n+        COMMAND_TYPE_MAP.put(6, SCHEDULER);\n+        COMMAND_TYPE_MAP.put(7, REPEAT_RUNNING);\n+        COMMAND_TYPE_MAP.put(8, PAUSE);\n+        COMMAND_TYPE_MAP.put(9, STOP);\n+        COMMAND_TYPE_MAP.put(10, RECOVER_WAITTING_THREAD);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0de5d0ffebef233ee6de0024f27a7de09cb7a97e"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "063625112dc9c0e7dffb437f8bba4adfba3e9007", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/063625112dc9c0e7dffb437f8bba4adfba3e9007", "committedDate": "2020-05-12T11:45:26Z", "message": "beautiful misunderstanding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa38e050ead8ab9b6cbabae65ebb09fd100ea82", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/8aa38e050ead8ab9b6cbabae65ebb09fd100ea82", "committedDate": "2020-05-14T04:47:55Z", "message": "Merge branch 'dev' into enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5326ac68e255cb0cd6f0d74cb6056a8e125512e", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b5326ac68e255cb0cd6f0d74cb6056a8e125512e", "committedDate": "2020-05-14T11:24:15Z", "message": "Merge branch 'dev' into enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00f1613c030e76d69f80b4f25fefde41ea4f69d2", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/00f1613c030e76d69f80b4f25fefde41ea4f69d2", "committedDate": "2020-05-14T11:38:11Z", "message": "Merge branch 'dev' into enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf626af6c85900ddcf770e266c671c57160bf955", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/cf626af6c85900ddcf770e266c671c57160bf955", "committedDate": "2020-05-19T03:54:42Z", "message": "Merge branch 'dev' into enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24acd92fcd0ce65579f1a13d8f09f5db977c7e84", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/24acd92fcd0ce65579f1a13d8f09f5db977c7e84", "committedDate": "2020-05-20T03:35:25Z", "message": "Merge branch 'dev' into enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61bf032b69766a40906f34fb44a9d0cd34fd4bae", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/61bf032b69766a40906f34fb44a9d0cd34fd4bae", "committedDate": "2020-05-21T06:56:06Z", "message": "Merge branch 'dev' into enum"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDIxNzU4", "url": "https://github.com/apache/dolphinscheduler/pull/2677#pullrequestreview-421421758", "createdAt": "2020-05-30T15:21:22Z", "commit": {"oid": "61bf032b69766a40906f34fb44a9d0cd34fd4bae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3698e8122092cbb273d8766a41cd3bf7612a0f90", "author": {"user": {"login": "dailidong", "name": "lidongdai"}}, "url": "https://github.com/apache/dolphinscheduler/commit/3698e8122092cbb273d8766a41cd3bf7612a0f90", "committedDate": "2020-05-30T15:21:29Z", "message": "Merge branch 'dev' into enum"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2009, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}