{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NTkwNDk1", "number": 1684, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMzoyMjowOFrODVqBCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMzoyMzoyMlrODVqCIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MDM1MDgzOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMzoyMjowOFrOFZ_6yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQwMzo0NDowNFrOFaMnDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNTk2MA==", "bodyText": "Is necessary to putMsg and log error?", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362805960", "createdAt": "2020-01-03T13:22:08Z", "author": {"login": "khadgarmage"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -234,6 +234,12 @@ public Result updateResource(User loginUser,\n             }\n         }\n \n+        // query tenant by user id\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAxMzkwMQ==", "bodyText": "add error log in getTenantCode method", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r363013901", "createdAt": "2020-01-04T03:44:04Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -234,6 +234,12 @@ public Result updateResource(User loginUser,\n             }\n         }\n \n+        // query tenant by user id\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNTk2MA=="}, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MDM1MzA1OnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMzoyMzowN1rOFZ_7-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQwMzo0NDoxOFrOFaMnEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjI2NQ==", "bodyText": "Is necessary to putMsg and log error?", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362806265", "createdAt": "2020-01-03T13:23:07Z", "author": {"login": "khadgarmage"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -522,8 +529,11 @@ public Result readResource(int resourceId, int skipLineNum, int limit) {\n             }\n         }\n \n-        User user = userMapper.queryDetailsById(resource.getUserId());\n-        String tenantCode = tenantMapper.queryById(user.getTenantId()).getTenantCode();\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){\n+            return  result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAxMzkwNw==", "bodyText": "add error log in getTenantCode method", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r363013907", "createdAt": "2020-01-04T03:44:18Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -522,8 +529,11 @@ public Result readResource(int resourceId, int skipLineNum, int limit) {\n             }\n         }\n \n-        User user = userMapper.queryDetailsById(resource.getUserId());\n-        String tenantCode = tenantMapper.queryById(user.getTenantId()).getTenantCode();\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){\n+            return  result;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjI2NQ=="}, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MDM1MzYwOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxMzoyMzoyMlrOFZ_8Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQwMzo0MzozMFrOFaMm7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjM0Mg==", "bodyText": "Is necessary to putMsg and log error?", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362806342", "createdAt": "2020-01-03T13:23:22Z", "author": {"login": "khadgarmage"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -644,18 +654,20 @@ public Result updateResourceContent(int resourceId, String content) {\n         if (StringUtils.isNotEmpty(resourceViewSuffixs)) {\n             List<String> strList = Arrays.asList(resourceViewSuffixs.split(\",\"));\n             if (!strList.contains(nameSuffix)) {\n-                logger.error(\"resouce suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n+                logger.error(\"resource suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n                 putMsg(result, Status.RESOURCE_SUFFIX_NOT_SUPPORT_VIEW);\n                 return result;\n             }\n         }\n \n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxMjIyNA==", "bodyText": "Since a tenant is required to upload a resource, the resource and tenant are associated through the user. If the user on resouce is illegal. Then the tenant cannot be obtained, and the null pointer exception will be thrown when the tenantCode is obtained.\n\u7531\u4e8e\u4e0a\u4f20resource\u9700\u8981tenant\uff0cresource\u548ctenant\u662f\u901a\u8fc7\u7528\u6237\u5173\u8054\uff0c\u5982\u679cresource\u4e0a\u7684\u7528\u6237\u662f\u975e\u6cd5\u7684\u3002\u90a3\u4e48\u5c31\u83b7\u53d6\u4e0d\u5230tenant\u4e86\uff0c \u83b7\u53d6tenantCode\u4e5f\u5c31\u4f1a\u629b\u7a7a\u6307\u9488\u5f02\u5e38", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362812224", "createdAt": "2020-01-03T13:42:08Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -644,18 +654,20 @@ public Result updateResourceContent(int resourceId, String content) {\n         if (StringUtils.isNotEmpty(resourceViewSuffixs)) {\n             List<String> strList = Arrays.asList(resourceViewSuffixs.split(\",\"));\n             if (!strList.contains(nameSuffix)) {\n-                logger.error(\"resouce suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n+                logger.error(\"resource suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n                 putMsg(result, Status.RESOURCE_SUFFIX_NOT_SUPPORT_VIEW);\n                 return result;\n             }\n         }\n \n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjM0Mg=="}, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAxMzg3MA==", "bodyText": "add error log  in getTenantCode method", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r363013870", "createdAt": "2020-01-04T03:43:30Z", "author": {"login": "samz406"}, "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -644,18 +654,20 @@ public Result updateResourceContent(int resourceId, String content) {\n         if (StringUtils.isNotEmpty(resourceViewSuffixs)) {\n             List<String> strList = Arrays.asList(resourceViewSuffixs.split(\",\"));\n             if (!strList.contains(nameSuffix)) {\n-                logger.error(\"resouce suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n+                logger.error(\"resource suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n                 putMsg(result, Status.RESOURCE_SUFFIX_NOT_SUPPORT_VIEW);\n                 return result;\n             }\n         }\n \n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjM0Mg=="}, "originalCommit": {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3451, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}