{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMjI1NTk2", "number": 4139, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODoxODoxN1rOFCyphQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODoxODoxN1rOFCyphQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NDcxMzAxOnYy", "diffSide": "RIGHT", "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/consumer/TaskPriorityQueueConsumer.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwODoxODoxN1rOICH4kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo0Mjo0MVrOIDC1Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA5NzIzNQ==", "bodyText": "\"taskPriorityQueue.size() <= failedDispatchTasks.size()\" is better.", "url": "https://github.com/apache/dolphinscheduler/pull/4139#discussion_r539097235", "createdAt": "2020-12-09T08:18:17Z", "author": {"login": "lenboo"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/consumer/TaskPriorityQueueConsumer.java", "diffHunk": "@@ -139,7 +140,13 @@ public void run() {\n                 for (String dispatchFailedTask : failedDispatchTasks) {\n                     taskPriorityQueue.put(dispatchFailedTask);\n                 }\n+                // If there are tasks in a cycle that cannot find the worker group,\n+                // sleep for 1 second\n+                if (!failedDispatchTasks.isEmpty()  && taskPriorityQueue.size() <= fetchTaskNum) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e308595bc0c42f2f14bdf0f4bd73dd139f88117f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MzA1MQ==", "bodyText": "same.\nBecause the failed failedDispatchTasks queue can only have fetchTaskNum tasks at most", "url": "https://github.com/apache/dolphinscheduler/pull/4139#discussion_r539153051", "createdAt": "2020-12-09T09:39:06Z", "author": {"login": "BoYiZhang"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/consumer/TaskPriorityQueueConsumer.java", "diffHunk": "@@ -139,7 +140,13 @@ public void run() {\n                 for (String dispatchFailedTask : failedDispatchTasks) {\n                     taskPriorityQueue.put(dispatchFailedTask);\n                 }\n+                // If there are tasks in a cycle that cannot find the worker group,\n+                // sleep for 1 second\n+                if (!failedDispatchTasks.isEmpty()  && taskPriorityQueue.size() <= fetchTaskNum) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA5NzIzNQ=="}, "originalCommit": {"oid": "e308595bc0c42f2f14bdf0f4bd73dd139f88117f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA1ODU2Ng==", "bodyText": "it is not same.\nthe situation that do not need sleep. : failedNumber=1; queueSize=2; fetchTaskNumber=3", "url": "https://github.com/apache/dolphinscheduler/pull/4139#discussion_r540058566", "createdAt": "2020-12-10T10:36:14Z", "author": {"login": "lenboo"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/consumer/TaskPriorityQueueConsumer.java", "diffHunk": "@@ -139,7 +140,13 @@ public void run() {\n                 for (String dispatchFailedTask : failedDispatchTasks) {\n                     taskPriorityQueue.put(dispatchFailedTask);\n                 }\n+                // If there are tasks in a cycle that cannot find the worker group,\n+                // sleep for 1 second\n+                if (!failedDispatchTasks.isEmpty()  && taskPriorityQueue.size() <= fetchTaskNum) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA5NzIzNQ=="}, "originalCommit": {"oid": "e308595bc0c42f2f14bdf0f4bd73dd139f88117f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA2Mjk5OA==", "bodyText": "it is not same.\nthe situation that do not need sleep. : failedNumber=1; queueSize=2; fetchTaskNumber=3\n\nIt has been dealt with, but now the main problem is to try many ways. Code coverage has not been able to", "url": "https://github.com/apache/dolphinscheduler/pull/4139#discussion_r540062998", "createdAt": "2020-12-10T10:42:41Z", "author": {"login": "BoYiZhang"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/consumer/TaskPriorityQueueConsumer.java", "diffHunk": "@@ -139,7 +140,13 @@ public void run() {\n                 for (String dispatchFailedTask : failedDispatchTasks) {\n                     taskPriorityQueue.put(dispatchFailedTask);\n                 }\n+                // If there are tasks in a cycle that cannot find the worker group,\n+                // sleep for 1 second\n+                if (!failedDispatchTasks.isEmpty()  && taskPriorityQueue.size() <= fetchTaskNum) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA5NzIzNQ=="}, "originalCommit": {"oid": "e308595bc0c42f2f14bdf0f4bd73dd139f88117f"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3228, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}