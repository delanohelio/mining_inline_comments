{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwODQ4Nzc1", "number": 4237, "title": "[FIX-3177]Task time parameter parsing error", "bodyText": "", "createdAt": "2020-12-16T02:45:19Z", "url": "https://github.com/apache/dolphinscheduler/pull/4237", "merged": true, "mergeCommit": {"oid": "55447348ed654f2a3d4f77efdf15212dc57eaa36"}, "closed": true, "closedAt": "2020-12-21T07:54:40Z", "author": {"login": "CalvinKirs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmlryEAH2gAyNTQwODQ4Nzc1OjlkNmFkNGQ4ODM3ZTliODNlZmIwYzE5OWFmYmY5MGYxOWRjMzcwMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmvKZTgH2gAyNTQwODQ4Nzc1OjBmNDJmMTU4OGZmNWQxZTUxNThjNTc5ZDhjOGU5MmRjYzdhYzBkMTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d6ad4d8837e9b83efb0c199afbf90f19dc37022", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/9d6ad4d8837e9b83efb0c199afbf90f19dc37022", "committedDate": "2020-12-16T02:40:40Z", "message": "fix date_convert null"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMzI3ODM3", "url": "https://github.com/apache/dolphinscheduler/pull/4237#pullrequestreview-553327837", "createdAt": "2020-12-16T03:20:18Z", "commit": {"oid": "9d6ad4d8837e9b83efb0c199afbf90f19dc37022"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMzYyNTI5", "url": "https://github.com/apache/dolphinscheduler/pull/4237#pullrequestreview-553362529", "createdAt": "2020-12-16T05:15:01Z", "commit": {"oid": "9d6ad4d8837e9b83efb0c199afbf90f19dc37022"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNToxNTowMVrOIGxFBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNToxNTowMVrOIGxFBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk2NjQ2OA==", "bodyText": "I think you should make sure that the parameters within the Dateutils.parse method are not null\nif (StringUtils.isBlank(date) || StringUtils.isBlank(format)) {\n            return null;\n        }\n\n public static String convertParameterPlaceholders(String parameterString, Map<String, String> parameterMap) {\n        if (StringUtils.isEmpty(parameterString)) {\n            return parameterString;\n        }\n\n        if (parameterMap == null || parameterMap.isEmpty()) {\n            return dateTemplateParse(parameterString, new Date());\n        }\n\n        //Get current time, schedule execute time\n        String cronTimeStr = parameterMap.get(Constants.PARAMETER_DATETIME);\n        Date cronTime = DateUtils.parse(cronTimeStr, Constants.PARAMETER_FORMAT_TIME);\n        if (cronTime == null) {\n            return parameterString;\n        }\n        // replace variable ${} form,refers to the replacement of system variables and custom variables\n        parameterString = PlaceholderUtils.replacePlaceholders(parameterString, parameterMap, true);\n        return dateTemplateParse(parameterString, cronTime);\n    }", "url": "https://github.com/apache/dolphinscheduler/pull/4237#discussion_r543966468", "createdAt": "2020-12-16T05:15:01Z", "author": {"login": "zhuangchong"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/ParameterUtils.java", "diffHunk": "@@ -66,11 +66,13 @@ public static String convertParameterPlaceholders(String parameterString, Map<St\n         }\n         Date cronTime;\n         if (parameterMap != null && !parameterMap.isEmpty()) {\n+            // replace variable ${} form,refers to the replacement of system variables and custom variables\n+            parameterString = PlaceholderUtils.replacePlaceholders(parameterString, parameterMap, true);\n+        }\n+        if (parameterMap != null && null != parameterMap.get(Constants.PARAMETER_DATETIME)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d6ad4d8837e9b83efb0c199afbf90f19dc37022"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7df03d91a1351d52a8197cccce0c30797ff827e4", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/7df03d91a1351d52a8197cccce0c30797ff827e4", "committedDate": "2020-12-16T05:30:09Z", "message": "fix time cover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ae6437bb3433ce0faddbc809965a999dd58315", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/54ae6437bb3433ce0faddbc809965a999dd58315", "committedDate": "2020-12-16T05:31:59Z", "message": "fix time cover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c11a0c42f338f38d1b6d508eda320662aa55e524", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/c11a0c42f338f38d1b6d508eda320662aa55e524", "committedDate": "2020-12-16T08:41:52Z", "message": "reformat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f42f1588ff5d1e5158c579d8c8e92dcc7ac0d11", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0f42f1588ff5d1e5158c579d8c8e92dcc7ac0d11", "committedDate": "2020-12-16T13:43:15Z", "message": "add ut"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2296, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}