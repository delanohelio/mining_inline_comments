{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxNjgxOTky", "number": 3235, "title": "[Feature#3234][cluster]enhanced load balancing", "bodyText": "weight-based load balancing algorithm\nthis closes #3234\nWhat is the purpose of the pull request\nweight-based load balancing algorithm\nImplementation of load balancing based on weight.\nImplementation of load balancing based on workgroups.\nRelated mail\uff1ahttps://lists.apache.org/thread.html/r06af73b0897d8a0c97a16ca1b9316d5d0bc29de833f60c10ca46415a%40%3Cdev.dolphinscheduler.apache.org%3E\nhttps://lists.apache.org/thread.html/r5a70a5f43aa49973923ef23d5b079b883cda746a14e91f9c083a985a%40%3Cdev.dolphinscheduler.apache.org%3E\nthis closes #3234\nVerify this pull request\nThis pull request is already covered by existing tests, such as (please describe tests).\nThis change added tests and can be verified as follows:", "createdAt": "2020-07-18T04:04:23Z", "url": "https://github.com/apache/dolphinscheduler/pull/3235", "merged": true, "mergeCommit": {"oid": "d6a32ac65225fa4f8d9a80c09c5ea8a29e392dac"}, "closed": true, "closedAt": "2020-08-10T11:05:22Z", "author": {"login": "CalvinKirs"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2AWuigH2gAyNDUxNjgxOTkyOjBjYjllYzM0ZGY5ZmViNWY2ZDg4ZjZhNDFmZDczYjBhZjZlYTA1MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9enXqgFqTQ2NDAxMTAxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0cb9ec34df9feb5f6d88f6a41fd73b0af6ea051b", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0cb9ec34df9feb5f6d88f6a41fd73b0af6ea051b", "committedDate": "2020-07-18T04:02:49Z", "message": "[Future#3234][cluster]enhanced load balancing\nweight-based load balancing algorithm\nthis close # 3234"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc4ba7703fbfc79f0954c8a10789b7ce831a9e39", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/dc4ba7703fbfc79f0954c8a10789b7ce831a9e39", "committedDate": "2020-07-18T04:24:58Z", "message": "remove useless parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d80129667aaf0378a59a38e5b4ff289aad017cbb", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/d80129667aaf0378a59a38e5b4ff289aad017cbb", "committedDate": "2020-07-18T07:26:34Z", "message": "code smell"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDQxMzY3", "url": "https://github.com/apache/dolphinscheduler/pull/3235#pullrequestreview-451041367", "createdAt": "2020-07-18T08:19:18Z", "commit": {"oid": "d80129667aaf0378a59a38e5b4ff289aad017cbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwODoxOToxOFrOGzmu-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwODoxOToxOFrOGzmu-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc2NTE3Ng==", "bodyText": "Hi,\nThis variable is not used in this project, please delete.\nIf you have any question or suggestion, please put forward~", "url": "https://github.com/apache/dolphinscheduler/pull/3235#discussion_r456765176", "createdAt": "2020-07-18T08:19:18Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/Constants.java", "diffHunk": "@@ -249,6 +249,8 @@ private Constants() {\n \n     public static final String WORKER_RESERVED_MEMORY = \"worker.reserved.memory\";\n \n+    public static final String WORKER_WEIGHT = \"worker.weight\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80129667aaf0378a59a38e5b4ff289aad017cbb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDQxNTQw", "url": "https://github.com/apache/dolphinscheduler/pull/3235#pullrequestreview-451041540", "createdAt": "2020-07-18T08:23:08Z", "commit": {"oid": "d80129667aaf0378a59a38e5b4ff289aad017cbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwODoyMzowOFrOGzmwHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwODoyMzowOFrOGzmwHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc2NTQ2OA==", "bodyText": "Hi,\nIf user choose to use RoundRobinSelector, there will be no need to add the weight to zk heartbeat info. Maybe we can design this feature better.\nIf you have any question or suggestion, please put forward~", "url": "https://github.com/apache/dolphinscheduler/pull/3235#discussion_r456765468", "createdAt": "2020-07-18T08:23:08Z", "author": {"login": "yangyichao-mango"}, "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/registry/WorkerRegistry.java", "diffHunk": "@@ -152,6 +152,7 @@ public void unRegistry() {\n             // trim and lower case is need\n             workerZkPathBuilder.append(workGroup.trim().toLowerCase()).append(SLASH);\n             workerZkPathBuilder.append(address);\n+            workerZkPathBuilder.append(weight).append(SLASH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d80129667aaf0378a59a38e5b4ff289aad017cbb"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d984fc05a0945d8d32e9dfe4bb1950606de4631", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/4d984fc05a0945d8d32e9dfe4bb1950606de4631", "committedDate": "2020-07-18T13:47:41Z", "message": "load balancing according to work group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a2c00eeb4cb13c806b4e9ea70cc400ea431b93", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/88a2c00eeb4cb13c806b4e9ea70cc400ea431b93", "committedDate": "2020-07-19T05:33:50Z", "message": "add smooth weight round robin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38a04ae55f1160484a91a4e457c3768b2173c23f", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/38a04ae55f1160484a91a4e457c3768b2173c23f", "committedDate": "2020-07-19T05:35:57Z", "message": "remove unused constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f268b62b7e576de76591ec012dcbc920324794d", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0f268b62b7e576de76591ec012dcbc920324794d", "committedDate": "2020-07-19T05:49:48Z", "message": "perfect unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6312c558c75a3ad1c18976294667ed69ade97d3", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/e6312c558c75a3ad1c18976294667ed69ade97d3", "committedDate": "2020-07-19T06:03:09Z", "message": "code smell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05e17a18d92a8ea0e85083155a528bba77112b22", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/05e17a18d92a8ea0e85083155a528bba77112b22", "committedDate": "2020-07-19T06:25:28Z", "message": "code smell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b508581ff2a36f0a9ffae198af0f8813464fb96d", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/b508581ff2a36f0a9ffae198af0f8813464fb96d", "committedDate": "2020-07-19T07:24:41Z", "message": "add work weight config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bfe7e7c38484d359a0df7e9441456e17475b9a5", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/0bfe7e7c38484d359a0df7e9441456e17475b9a5", "committedDate": "2020-08-10T07:48:55Z", "message": "fix config error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c704472b3a419296ea5fd0a2b2ac808bf0c4590", "author": {"user": {"login": "CalvinKirs", "name": "Kirs"}}, "url": "https://github.com/apache/dolphinscheduler/commit/1c704472b3a419296ea5fd0a2b2ac808bf0c4590", "committedDate": "2020-08-10T07:49:37Z", "message": "add weight docs to readme.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDExMDE0", "url": "https://github.com/apache/dolphinscheduler/pull/3235#pullrequestreview-464011014", "createdAt": "2020-08-10T07:37:14Z", "commit": {"oid": "b508581ff2a36f0a9ffae198af0f8813464fb96d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNzozNzoxNFrOG-EIaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNzozNzoxNFrOG-EIaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzczMjU4NA==", "bodyText": "worker.properties  worker.group change to worker.groups", "url": "https://github.com/apache/dolphinscheduler/pull/3235#discussion_r467732584", "createdAt": "2020-08-10T07:37:14Z", "author": {"login": "qiaozhanwei"}, "path": "docker/build/conf/dolphinscheduler/worker.properties.tpl", "diffHunk": "@@ -34,4 +34,7 @@ worker.reserved.memory=${WORKER_RESERVED_MEMORY}\n #worker.listen.port=${WORKER_LISTEN_PORT}\n \n # default worker group\n-#worker.group=${WORKER_GROUP}\n\\ No newline at end of file\n+#worker.group=${WORKER_GROUP}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b508581ff2a36f0a9ffae198af0f8813464fb96d"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1891, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}