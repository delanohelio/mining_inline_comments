{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MDczMDEx", "number": 1978, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTo1NToyOFrODhS_wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjoxNDoxN1rODhTfzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjQwODMzOnYy", "diffSide": "LEFT", "path": "dockerfile/Dockerfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTo1NToyOFrOFr-zFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMzowODo1NlrOFsBMxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2MTk3NQ==", "bodyText": "Why delete license announcement?", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381661975", "createdAt": "2020-02-20T01:55:28Z", "author": {"login": "khadgarmage"}, "path": "dockerfile/Dockerfile", "diffHunk": "@@ -1,136 +1,74 @@\n-#", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTcwMTMxNg==", "bodyText": "I have forgot it, because this dockerfile is new.", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381701316", "createdAt": "2020-02-20T03:08:56Z", "author": {"login": "liwenhe1993"}, "path": "dockerfile/Dockerfile", "diffHunk": "@@ -1,136 +1,74 @@\n-#", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2MTk3NQ=="}, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjQyMzYxOnYy", "diffSide": "RIGHT", "path": "dockerfile/Dockerfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMTo1ODozM1rOFr-6Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMzowNDo1N1rOFsBEyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2MzgyMg==", "bodyText": "Can Alibaba Cloud Mirror make download quickly abroad?", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381663822", "createdAt": "2020-02-20T01:58:33Z", "author": {"login": "khadgarmage"}, "path": "dockerfile/Dockerfile", "diffHunk": "@@ -1,136 +1,74 @@\n-#\n-# Licensed to the Apache Software Foundation (ASF) under one or more\n-# contributor license agreements.  See the NOTICE file distributed with\n-# this work for additional information regarding copyright ownership.\n-# The ASF licenses this file to You under the Apache License, Version 2.0\n-# (the \"License\"); you may not use this file except in compliance with\n-# the License.  You may obtain a copy of the License at\n-#\n-#     http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n-#\n+FROM nginx:alpine\n \n-FROM ubuntu:18.04\n+ARG VERSION\n \n-ENV LANG=C.UTF-8\n-ENV DEBIAN_FRONTEND=noninteractive\n+ENV TZ Asia/Shanghai\n+ENV LANG C.UTF-8\n+ENV DEBIAN_FRONTEND noninteractive\n \n-ARG version\n-ARG tar_version\n+#1. using aliyun mirror, and install dos2unix shadow bash openrc python sudo vim wget iputils net-tools ssh pip kazoo\n+RUN sed -i \"s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\" /etc/apk/repositories && \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY5OTI3NQ==", "bodyText": "I will remove it", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381699275", "createdAt": "2020-02-20T03:04:57Z", "author": {"login": "liwenhe1993"}, "path": "dockerfile/Dockerfile", "diffHunk": "@@ -1,136 +1,74 @@\n-#\n-# Licensed to the Apache Software Foundation (ASF) under one or more\n-# contributor license agreements.  See the NOTICE file distributed with\n-# this work for additional information regarding copyright ownership.\n-# The ASF licenses this file to You under the Apache License, Version 2.0\n-# (the \"License\"); you may not use this file except in compliance with\n-# the License.  You may obtain a copy of the License at\n-#\n-#     http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n-#\n+FROM nginx:alpine\n \n-FROM ubuntu:18.04\n+ARG VERSION\n \n-ENV LANG=C.UTF-8\n-ENV DEBIAN_FRONTEND=noninteractive\n+ENV TZ Asia/Shanghai\n+ENV LANG C.UTF-8\n+ENV DEBIAN_FRONTEND noninteractive\n \n-ARG version\n-ARG tar_version\n+#1. using aliyun mirror, and install dos2unix shadow bash openrc python sudo vim wget iputils net-tools ssh pip kazoo\n+RUN sed -i \"s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\" /etc/apk/repositories && \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2MzgyMg=="}, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjQ2MTY0OnYy", "diffSide": "RIGHT", "path": "dockerfile/Dockerfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjowNzoyNlrOFr_NSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMzowMzozOVrOFsBCUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2ODY4MQ==", "bodyText": "Why dos2unix, not sh?", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381668681", "createdAt": "2020-02-20T02:07:26Z", "author": {"login": "khadgarmage"}, "path": "dockerfile/Dockerfile", "diffHunk": "@@ -1,136 +1,74 @@\n-#\n-# Licensed to the Apache Software Foundation (ASF) under one or more\n-# contributor license agreements.  See the NOTICE file distributed with\n-# this work for additional information regarding copyright ownership.\n-# The ASF licenses this file to You under the Apache License, Version 2.0\n-# (the \"License\"); you may not use this file except in compliance with\n-# the License.  You may obtain a copy of the License at\n-#\n-#     http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n-#\n+FROM nginx:alpine\n \n-FROM ubuntu:18.04\n+ARG VERSION\n \n-ENV LANG=C.UTF-8\n-ENV DEBIAN_FRONTEND=noninteractive\n+ENV TZ Asia/Shanghai\n+ENV LANG C.UTF-8\n+ENV DEBIAN_FRONTEND noninteractive\n \n-ARG version\n-ARG tar_version\n+#1. using aliyun mirror, and install dos2unix shadow bash openrc python sudo vim wget iputils net-tools ssh pip kazoo\n+RUN sed -i \"s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\" /etc/apk/repositories && \\\n+    apk update && \\\n+    apk add dos2unix shadow bash openrc python sudo vim wget iputils net-tools openssh-server py2-pip && \\\n+    apk add --update procps && \\\n+    openrc boot && \\\n+    pip install kazoo\n \n-#1,install jdk\n-\n-RUN apt-get update \\\n-    && apt-get -y install openjdk-8-jdk \\\n-    && rm -rf /var/lib/apt/lists/*\n-\n-ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64\n+#2. install jdk\n+RUN apk add openjdk8\n+ENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdk\n ENV PATH $JAVA_HOME/bin:$PATH\n \n-\n-#install wget\n-RUN apt-get update && \\\n-        apt-get -y install wget\n-#2,install ZK\n-\n+#3. install zk\n RUN cd /opt && \\\n-    wget https://www-us.apache.org/dist/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz  && \\\n-    tar -zxvf zookeeper-3.4.14.tar.gz  && \\\n-    mv zookeeper-3.4.14 zookeeper && \\\n-    rm -rf ./zookeeper-*tar.gz && \\\n+    wget https://downloads.apache.org/zookeeper/zookeeper-3.5.7/apache-zookeeper-3.5.7-bin.tar.gz && \\\n+    tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz && \\\n+    mv apache-zookeeper-3.5.7-bin zookeeper && \\\n     mkdir -p /tmp/zookeeper && \\\n+    rm -rf ./zookeeper-*tar.gz && \\\n     rm -rf /opt/zookeeper/conf/zoo_sample.cfg\n-\n-ADD ./dockerfile/conf/zookeeper/zoo.cfg /opt/zookeeper/conf\n-ENV ZK_HOME=/opt/zookeeper\n-ENV PATH $PATH:$ZK_HOME/bin\n-\n-#3,install maven\n-RUN cd /opt && \\\n-    wget http://apache-mirror.rbc.ru/pub/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz && \\\n-    tar -zxvf apache-maven-3.3.9-bin.tar.gz && \\\n-    mv apache-maven-3.3.9 maven && \\\n-    rm -rf ./apache-maven-*tar.gz && \\\n-    rm -rf /opt/maven/conf/settings.xml\n-ADD ./dockerfile/conf/maven/settings.xml /opt/maven/conf\n-ENV MAVEN_HOME=/opt/maven\n-ENV PATH $PATH:$MAVEN_HOME/bin\n-\n-#4,install node\n-RUN cd /opt && \\\n-    wget https://nodejs.org/download/release/v8.9.4/node-v8.9.4-linux-x64.tar.gz && \\\n-    tar -zxvf node-v8.9.4-linux-x64.tar.gz && \\\n-    mv node-v8.9.4-linux-x64 node && \\\n-    rm -rf ./node-v8.9.4-*tar.gz\n-ENV NODE_HOME=/opt/node\n-ENV PATH $PATH:$NODE_HOME/bin\n-\n-#5,install postgresql\n-RUN apt-get update && \\\n-    apt-get install -y postgresql postgresql-contrib sudo && \\\n-    sed -i 's/localhost/*/g' /etc/postgresql/10/main/postgresql.conf\n-\n-#6,install nginx\n-RUN apt-get update && \\\n-  apt-get install -y nginx && \\\n-  rm -rf /var/lib/apt/lists/* && \\\n-  echo \"\\ndaemon off;\" >> /etc/nginx/nginx.conf && \\\n-  chown -R www-data:www-data /var/lib/nginx\n-\n-#7,install sudo,python,vim,ping and ssh command\n-RUN apt-get update && \\\n-  apt-get -y install sudo && \\\n-  apt-get -y install python && \\\n-  apt-get -y install vim && \\\n-  apt-get -y install iputils-ping && \\\n-  apt-get -y install net-tools && \\\n-  apt-get -y install openssh-server && \\\n-  apt-get -y install python-pip && \\\n-  pip install kazoo\n-\n-#8,add dolphinscheduler source code to /opt/dolphinscheduler_source\n-ADD . /opt/dolphinscheduler_source\n-\n-\n-#9,backend compilation\n-RUN cd /opt/dolphinscheduler_source && \\\n-    mvn clean package -Prelease -Dmaven.test.skip=true\n-\n-#10,frontend compilation\n-RUN chmod -R 777 /opt/dolphinscheduler_source/dolphinscheduler-ui && \\\n-    cd /opt/dolphinscheduler_source/dolphinscheduler-ui && \\\n-    rm -rf /opt/dolphinscheduler_source/dolphinscheduler-ui/node_modules && \\\n-    npm install node-sass --unsafe-perm && \\\n-    npm install && \\\n-    npm run build\n-\n-#11,modify dolphinscheduler configuration file\n-#backend configuration\n-RUN tar -zxvf /opt/dolphinscheduler_source/dolphinscheduler-dist/dolphinscheduler-backend/target/apache-dolphinscheduler-incubating-${tar_version}-dolphinscheduler-backend-bin.tar.gz -C /opt && \\\n-    mv /opt/apache-dolphinscheduler-incubating-${tar_version}-dolphinscheduler-backend-bin /opt/dolphinscheduler && \\\n-    rm -rf /opt/dolphinscheduler/conf\n-\n-ADD ./dockerfile/conf/dolphinscheduler/conf /opt/dolphinscheduler/conf\n-#frontend nginx configuration\n-ADD ./dockerfile/conf/nginx/dolphinscheduler.conf /etc/nginx/conf.d\n-\n-#12,open port\n-EXPOSE 2181 2888 3888 3306 80 12345 8888\n-\n-COPY ./dockerfile/startup.sh /root/startup.sh\n-#13,modify permissions and set soft links\n-RUN chmod +x /root/startup.sh && \\\n-  chmod +x /opt/dolphinscheduler/script/create-dolphinscheduler.sh && \\\n-  chmod +x /opt/zookeeper/bin/zkServer.sh && \\\n-  chmod +x /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh && \\\n-  rm -rf /bin/sh && \\\n-  ln -s /bin/bash /bin/sh && \\\n-  mkdir -p /tmp/xls\n-\n+ADD ./conf/zookeeper/zoo.cfg /opt/zookeeper/conf\n+ENV ZK_HOME /opt/zookeeper\n+ENV PATH $ZK_HOME/bin:$PATH\n+\n+#4. install pg\n+RUN apk add postgresql postgresql-contrib\n+\n+#5. add dolphinscheduler\n+ADD ./apache-dolphinscheduler-incubating-${VERSION}-SNAPSHOT-dolphinscheduler-bin.tar.gz /opt/\n+RUN mv /opt/apache-dolphinscheduler-incubating-${VERSION}-SNAPSHOT-dolphinscheduler-bin/ /opt/dolphinscheduler/\n+ENV DOLPHINSCHEDULER_HOME /opt/dolphinscheduler\n+\n+#6. modify nginx\n+RUN echo \"daemon off;\" >> /etc/nginx/nginx.conf && \\\n+    rm -rf /etc/nginx/conf.d/*\n+ADD ./conf/nginx/dolphinscheduler.conf /etc/nginx/conf.d\n+\n+#7. add configuration and modify permissions and set soft links\n+ADD ./startup-init-conf.sh /root/startup-init-conf.sh\n+ADD ./startup.sh /root/startup.sh\n+ADD ./conf/dolphinscheduler/*.tpl /opt/dolphinscheduler/conf/\n+ADD ./conf/dolphinscheduler/env/dolphinscheduler_env /opt/dolphinscheduler/conf/env/\n+RUN chmod +x /root/startup-init-conf.sh && \\\n+    chmod +x /root/startup.sh && \\\n+    chmod +x /opt/dolphinscheduler/conf/env/dolphinscheduler_env && \\\n+    chmod +x /opt/dolphinscheduler/script/*.sh && \\\n+    chmod +x /opt/dolphinscheduler/bin/*.sh && \\\n+    chmod +x /opt/zookeeper/bin/*.sh && \\\n+    dos2unix /root/startup-init-conf.sh && \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY5ODY0Mw==", "bodyText": "Because bash script with Windows line-ending CRLF won't work on Linux.\nUNIX and UNIX-like operating systems (including Mac OS X) represent line endings as LF alone.\nConverting line-ending using dos2unix.", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381698643", "createdAt": "2020-02-20T03:03:39Z", "author": {"login": "liwenhe1993"}, "path": "dockerfile/Dockerfile", "diffHunk": "@@ -1,136 +1,74 @@\n-#\n-# Licensed to the Apache Software Foundation (ASF) under one or more\n-# contributor license agreements.  See the NOTICE file distributed with\n-# this work for additional information regarding copyright ownership.\n-# The ASF licenses this file to You under the Apache License, Version 2.0\n-# (the \"License\"); you may not use this file except in compliance with\n-# the License.  You may obtain a copy of the License at\n-#\n-#     http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n-#\n+FROM nginx:alpine\n \n-FROM ubuntu:18.04\n+ARG VERSION\n \n-ENV LANG=C.UTF-8\n-ENV DEBIAN_FRONTEND=noninteractive\n+ENV TZ Asia/Shanghai\n+ENV LANG C.UTF-8\n+ENV DEBIAN_FRONTEND noninteractive\n \n-ARG version\n-ARG tar_version\n+#1. using aliyun mirror, and install dos2unix shadow bash openrc python sudo vim wget iputils net-tools ssh pip kazoo\n+RUN sed -i \"s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\" /etc/apk/repositories && \\\n+    apk update && \\\n+    apk add dos2unix shadow bash openrc python sudo vim wget iputils net-tools openssh-server py2-pip && \\\n+    apk add --update procps && \\\n+    openrc boot && \\\n+    pip install kazoo\n \n-#1,install jdk\n-\n-RUN apt-get update \\\n-    && apt-get -y install openjdk-8-jdk \\\n-    && rm -rf /var/lib/apt/lists/*\n-\n-ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64\n+#2. install jdk\n+RUN apk add openjdk8\n+ENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdk\n ENV PATH $JAVA_HOME/bin:$PATH\n \n-\n-#install wget\n-RUN apt-get update && \\\n-        apt-get -y install wget\n-#2,install ZK\n-\n+#3. install zk\n RUN cd /opt && \\\n-    wget https://www-us.apache.org/dist/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz  && \\\n-    tar -zxvf zookeeper-3.4.14.tar.gz  && \\\n-    mv zookeeper-3.4.14 zookeeper && \\\n-    rm -rf ./zookeeper-*tar.gz && \\\n+    wget https://downloads.apache.org/zookeeper/zookeeper-3.5.7/apache-zookeeper-3.5.7-bin.tar.gz && \\\n+    tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz && \\\n+    mv apache-zookeeper-3.5.7-bin zookeeper && \\\n     mkdir -p /tmp/zookeeper && \\\n+    rm -rf ./zookeeper-*tar.gz && \\\n     rm -rf /opt/zookeeper/conf/zoo_sample.cfg\n-\n-ADD ./dockerfile/conf/zookeeper/zoo.cfg /opt/zookeeper/conf\n-ENV ZK_HOME=/opt/zookeeper\n-ENV PATH $PATH:$ZK_HOME/bin\n-\n-#3,install maven\n-RUN cd /opt && \\\n-    wget http://apache-mirror.rbc.ru/pub/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz && \\\n-    tar -zxvf apache-maven-3.3.9-bin.tar.gz && \\\n-    mv apache-maven-3.3.9 maven && \\\n-    rm -rf ./apache-maven-*tar.gz && \\\n-    rm -rf /opt/maven/conf/settings.xml\n-ADD ./dockerfile/conf/maven/settings.xml /opt/maven/conf\n-ENV MAVEN_HOME=/opt/maven\n-ENV PATH $PATH:$MAVEN_HOME/bin\n-\n-#4,install node\n-RUN cd /opt && \\\n-    wget https://nodejs.org/download/release/v8.9.4/node-v8.9.4-linux-x64.tar.gz && \\\n-    tar -zxvf node-v8.9.4-linux-x64.tar.gz && \\\n-    mv node-v8.9.4-linux-x64 node && \\\n-    rm -rf ./node-v8.9.4-*tar.gz\n-ENV NODE_HOME=/opt/node\n-ENV PATH $PATH:$NODE_HOME/bin\n-\n-#5,install postgresql\n-RUN apt-get update && \\\n-    apt-get install -y postgresql postgresql-contrib sudo && \\\n-    sed -i 's/localhost/*/g' /etc/postgresql/10/main/postgresql.conf\n-\n-#6,install nginx\n-RUN apt-get update && \\\n-  apt-get install -y nginx && \\\n-  rm -rf /var/lib/apt/lists/* && \\\n-  echo \"\\ndaemon off;\" >> /etc/nginx/nginx.conf && \\\n-  chown -R www-data:www-data /var/lib/nginx\n-\n-#7,install sudo,python,vim,ping and ssh command\n-RUN apt-get update && \\\n-  apt-get -y install sudo && \\\n-  apt-get -y install python && \\\n-  apt-get -y install vim && \\\n-  apt-get -y install iputils-ping && \\\n-  apt-get -y install net-tools && \\\n-  apt-get -y install openssh-server && \\\n-  apt-get -y install python-pip && \\\n-  pip install kazoo\n-\n-#8,add dolphinscheduler source code to /opt/dolphinscheduler_source\n-ADD . /opt/dolphinscheduler_source\n-\n-\n-#9,backend compilation\n-RUN cd /opt/dolphinscheduler_source && \\\n-    mvn clean package -Prelease -Dmaven.test.skip=true\n-\n-#10,frontend compilation\n-RUN chmod -R 777 /opt/dolphinscheduler_source/dolphinscheduler-ui && \\\n-    cd /opt/dolphinscheduler_source/dolphinscheduler-ui && \\\n-    rm -rf /opt/dolphinscheduler_source/dolphinscheduler-ui/node_modules && \\\n-    npm install node-sass --unsafe-perm && \\\n-    npm install && \\\n-    npm run build\n-\n-#11,modify dolphinscheduler configuration file\n-#backend configuration\n-RUN tar -zxvf /opt/dolphinscheduler_source/dolphinscheduler-dist/dolphinscheduler-backend/target/apache-dolphinscheduler-incubating-${tar_version}-dolphinscheduler-backend-bin.tar.gz -C /opt && \\\n-    mv /opt/apache-dolphinscheduler-incubating-${tar_version}-dolphinscheduler-backend-bin /opt/dolphinscheduler && \\\n-    rm -rf /opt/dolphinscheduler/conf\n-\n-ADD ./dockerfile/conf/dolphinscheduler/conf /opt/dolphinscheduler/conf\n-#frontend nginx configuration\n-ADD ./dockerfile/conf/nginx/dolphinscheduler.conf /etc/nginx/conf.d\n-\n-#12,open port\n-EXPOSE 2181 2888 3888 3306 80 12345 8888\n-\n-COPY ./dockerfile/startup.sh /root/startup.sh\n-#13,modify permissions and set soft links\n-RUN chmod +x /root/startup.sh && \\\n-  chmod +x /opt/dolphinscheduler/script/create-dolphinscheduler.sh && \\\n-  chmod +x /opt/zookeeper/bin/zkServer.sh && \\\n-  chmod +x /opt/dolphinscheduler/bin/dolphinscheduler-daemon.sh && \\\n-  rm -rf /bin/sh && \\\n-  ln -s /bin/bash /bin/sh && \\\n-  mkdir -p /tmp/xls\n-\n+ADD ./conf/zookeeper/zoo.cfg /opt/zookeeper/conf\n+ENV ZK_HOME /opt/zookeeper\n+ENV PATH $ZK_HOME/bin:$PATH\n+\n+#4. install pg\n+RUN apk add postgresql postgresql-contrib\n+\n+#5. add dolphinscheduler\n+ADD ./apache-dolphinscheduler-incubating-${VERSION}-SNAPSHOT-dolphinscheduler-bin.tar.gz /opt/\n+RUN mv /opt/apache-dolphinscheduler-incubating-${VERSION}-SNAPSHOT-dolphinscheduler-bin/ /opt/dolphinscheduler/\n+ENV DOLPHINSCHEDULER_HOME /opt/dolphinscheduler\n+\n+#6. modify nginx\n+RUN echo \"daemon off;\" >> /etc/nginx/nginx.conf && \\\n+    rm -rf /etc/nginx/conf.d/*\n+ADD ./conf/nginx/dolphinscheduler.conf /etc/nginx/conf.d\n+\n+#7. add configuration and modify permissions and set soft links\n+ADD ./startup-init-conf.sh /root/startup-init-conf.sh\n+ADD ./startup.sh /root/startup.sh\n+ADD ./conf/dolphinscheduler/*.tpl /opt/dolphinscheduler/conf/\n+ADD ./conf/dolphinscheduler/env/dolphinscheduler_env /opt/dolphinscheduler/conf/env/\n+RUN chmod +x /root/startup-init-conf.sh && \\\n+    chmod +x /root/startup.sh && \\\n+    chmod +x /opt/dolphinscheduler/conf/env/dolphinscheduler_env && \\\n+    chmod +x /opt/dolphinscheduler/script/*.sh && \\\n+    chmod +x /opt/dolphinscheduler/bin/*.sh && \\\n+    chmod +x /opt/zookeeper/bin/*.sh && \\\n+    dos2unix /root/startup-init-conf.sh && \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY2ODY4MQ=="}, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 183}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MjQ5MDM3OnYy", "diffSide": "RIGHT", "path": "dockerfile/hooks/build", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjoxNDoxN1rOFr_cHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMzoyMTo0NlrOFsBmJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY3MjQ3OA==", "bodyText": "It is better to build image based on the current branch code, both CI and release can be used, rather than build based on the package", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381672478", "createdAt": "2020-02-20T02:14:17Z", "author": {"login": "khadgarmage"}, "path": "dockerfile/hooks/build", "diffHunk": "@@ -15,10 +15,21 @@\n # See the License for the specific language governing permissions and\n # limitations under the License.\n #\n-\n echo \"------ dolphinscheduler start - build -------\"\n printenv\n \n-docker build --build-arg version=$version --build-arg tar_version=$tar_version  -t $DOCKER_REPO:$version .\n+echo -e \"Current Directory is $(pwd)\\n\"\n+\n+# maven package(Project Directory)\n+echo -e \"mvn clean compile package -Prelease\"\n+mvn clean compile package -Prelease\n+\n+# mv dolphinscheduler-bin.tar.gz file to dockerfile directory\n+echo -e \"mv $(pwd)/dolphinscheduler-dist/target/apache-dolphinscheduler-incubating-${VERSION}-SNAPSHOT-dolphinscheduler-bin.tar.gz $(pwd)/dockerfile/\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTcwNzgxMw==", "bodyText": "User can use it, and CI can also use it.", "url": "https://github.com/apache/dolphinscheduler/pull/1978#discussion_r381707813", "createdAt": "2020-02-20T03:21:46Z", "author": {"login": "liwenhe1993"}, "path": "dockerfile/hooks/build", "diffHunk": "@@ -15,10 +15,21 @@\n # See the License for the specific language governing permissions and\n # limitations under the License.\n #\n-\n echo \"------ dolphinscheduler start - build -------\"\n printenv\n \n-docker build --build-arg version=$version --build-arg tar_version=$tar_version  -t $DOCKER_REPO:$version .\n+echo -e \"Current Directory is $(pwd)\\n\"\n+\n+# maven package(Project Directory)\n+echo -e \"mvn clean compile package -Prelease\"\n+mvn clean compile package -Prelease\n+\n+# mv dolphinscheduler-bin.tar.gz file to dockerfile directory\n+echo -e \"mv $(pwd)/dolphinscheduler-dist/target/apache-dolphinscheduler-incubating-${VERSION}-SNAPSHOT-dolphinscheduler-bin.tar.gz $(pwd)/dockerfile/\\n\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY3MjQ3OA=="}, "originalCommit": {"oid": "c6f9306260088bcc59250c3acb73526db29bdde8"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3551, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}