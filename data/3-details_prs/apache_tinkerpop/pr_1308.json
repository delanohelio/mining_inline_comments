{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDI3Njgw", "number": 1308, "title": "TINKERPOP-2389 Authorization support in TinkerPop", "bodyText": "https://issues.apache.org/jira/browse/TINKERPOP-2389\nThis work is by no means finished, but is a first shot along the lines of the discussion linked to in the JIRA ticket. The work includes and Authorized API, called from the AbstractChannelizer, as well as a small WhitelistAuthorizer demo implementation included in the gremlin-server tests. The current WIP PR is only intended to simplify a review of this first concept.\nAs the RequestMessage object passed to the authorize() method is not easy to handle, I thought it useful to do some first preprocessing common to future Authorizer implementations:\n\nsplit authorization requests in those for bytecode requests and those for string-based requests\nget and cast the object corresponding to Token.ARGS_GREMLIN\nThis is not entirely consistent though as the other Token.ARGS_XYZ are left unpacked in the original RequestMessage.\n\nAny feedback is welcomed.", "createdAt": "2020-08-06T13:28:11Z", "url": "https://github.com/apache/tinkerpop/pull/1308", "merged": true, "mergeCommit": {"oid": "61f7b8c08ac6a1232b460e100b3ff7c91ab4142d"}, "closed": true, "closedAt": "2020-12-24T13:02:46Z", "author": {"login": "vtslab"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWR_p6gFqTUxNjY1MjIyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpA87mgH2gAyNDY0MDI3NjgwOmQ1MzE3ZDM4MDgzZTE4YzlmZjdiOTYwNjJhODBjMzM5ZmQ3ZWNjOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjUyMjIy", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-516652222", "createdAt": "2020-10-26T10:41:29Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjIzMDky", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517623092", "createdAt": "2020-10-27T11:56:34Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMTo1NjozNFrOHo4mIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMTo1NjozNFrOHo4mIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzMjM1Mg==", "bodyText": "nit: Capital \"A\" in \"Authorization\" please since it's a title.\nnit: There's a bit more formatting to do in the text like enclosing class names in backticks.\nI think it would be worth adding some note here to providers to say that while Gremlin Server supports this authorization feature it is not a feature that TinkerPop requires of graph providers as part of the agreement between client and server. Graph providers may choose to implement their own methods for authorization in the manner they see fit.  I would say a similar \"IMPORTANT\" callout box should probably be added to the reference documentation to alert users to this notion. Finally, as you draw closer to a final body of work, this is a neat new feature that should have upgrade documentation. (and perhaps more user facing documentation?))\nUPDATE: I read a bit further on and saw you linked from the user documentation to this page....that could suffice, but if I'm thinking of this feature right I sense that users will write these authorizors and i think it could be a popular feature which means more front facing documentation.", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512632352", "createdAt": "2020-10-27T11:56:34Z", "author": {"login": "spmallette"}, "path": "docs/src/dev/provider/index.asciidoc", "diffHunk": "@@ -1147,25 +1147,64 @@ one key value pair present (since only one `Traversal` is being submitted, there\n single alias).\n |=========================================================\n \n-=== Authentication\n+=== Authentication and authorization", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjI0Mzc5", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517624379", "createdAt": "2020-10-27T11:58:09Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMTo1ODowOVrOHo4pwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMTo1ODowOVrOHo4pwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzMzI4Mg==", "bodyText": "graph system providers can choose to do so\n\nis it just up to graph system providers? couldn't users write them as well?", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512633282", "createdAt": "2020-10-27T11:58:09Z", "author": {"login": "spmallette"}, "path": "docs/src/reference/gremlin-applications.asciidoc", "diffHunk": "@@ -942,8 +942,10 @@ The following table describes the various YAML configuration options that Gremli\n |authentication.authenticator |The fully qualified classname of an `Authenticator` implementation to use.  If this setting is not present, then authentication is effectively disabled. |`AllowAllAuthenticator`\n |authentication.authenticationHandler | The fully qualified classname of an `AbstractAuthenticationHandler` implementation to use. If this setting is not present, but the `authentication.authenticator` is, it will use that authenticator with the default `AbstractAuthenticationHandler` implementation for the specified `Channelizer` |_none_\n |authentication.config |A `Map` of configuration settings to be passes to the `Authenticator` when it is constructed.  The settings available are dependent on the implementation. |_none_\n-|authentication.enableAuditLog |The available authenticators can issue audit logging messages, binding the authenticated user to his remote socket address and binding requests with a gremlin query to the remote socket address. For privacy reasons, the default value of this setting is false. The audit logging messages are logged at the INFO level via the `audit.org.apache.tinkerpop.gremlin.server` logger, which can be configured using the log4j.properties file. |false\n+|authentication.authorizer |The fully qualified classname of an `Authorizer` implementation to use.  Gremlin server does not offer `Authorizer` implementations, but link:https://tinkerpop.apache.org/docs/x.y.z/dev/provider/#_authentication_and_authorization[graph system providers can choose to do so]. |_none_", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjI4MTU0", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517628154", "createdAt": "2020-10-27T12:03:09Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjowMzowOVrOHo40nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjowMzowOVrOHo40nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYzNjA2MA==", "bodyText": "I think you can safely put 3.5.0 as the version.", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512636060", "createdAt": "2020-10-27T12:03:09Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/main/java/org/apache/tinkerpop/gremlin/server/Settings.java", "diffHunk": "@@ -418,7 +426,10 @@ public SerializerSettings() {}\n \n         /**\n          * Enable audit logging of authenticated users and gremlin evaluation requests.\n+         * @deprecated As of release x.y.z, replaced by {@link Settings#enableAuditLog} with slight changes in the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjMzNDYx", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517633461", "createdAt": "2020-10-27T12:10:04Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjoxMDowNVrOHo5FCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjoxMDowNVrOHo5FCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY0MDI2Nw==", "bodyText": "I haven't thought this through at all but is it desirable that we would double-log here if the user has somehow used both settings (the new and deprecated one as true)? I see this sort of code in the AbstractEvalOpProcessor as well. Perhaps setting both to true should be considered an \"illegal\" configuration or the setting of the new one to true should override the old to false? Perhaps, setting the old to true and the new to false should result in a WARN to the logger to let them know they are using a deprecated settings?", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512640267", "createdAt": "2020-10-27T12:10:05Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/main/java/org/apache/tinkerpop/gremlin/server/handler/HttpGremlinEndpointHandler.java", "diffHunk": "@@ -189,6 +191,12 @@ public void channelRead(final ChannelHandlerContext ctx, final Object msg) {\n             try {\n                 logger.debug(\"Processing request containing script [{}] and bindings of [{}] on {}\",\n                         requestArguments.getValue0(), requestArguments.getValue1(), Thread.currentThread().getName());\n+                if (settings.enableAuditLog) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjM0Mjg1", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517634285", "createdAt": "2020-10-27T12:11:09Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjoxMTowOVrOHo5HZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjoxMTowOVrOHo5HZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY0MDg2OQ==", "bodyText": "nit: looks like your IDE is making a mockery of our code style by doing a wildcard import \ud83d\ude04", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512640869", "createdAt": "2020-10-27T12:11:09Z", "author": {"login": "spmallette"}, "path": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/BytecodeUtil.java", "diffHunk": "@@ -18,9 +18,12 @@\n  */\n package org.apache.tinkerpop.gremlin.process.traversal.util;\n \n-import org.apache.tinkerpop.gremlin.process.traversal.Bytecode;\n-import org.apache.tinkerpop.gremlin.process.traversal.TraversalSource;\n-import org.apache.tinkerpop.gremlin.process.traversal.TraversalStrategy;\n+import org.apache.tinkerpop.gremlin.jsr223.JavaTranslator;\n+import org.apache.tinkerpop.gremlin.process.traversal.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjQ4NDcw", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517648470", "createdAt": "2020-10-27T12:29:19Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjoyOToxOVrOHo5w-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjoyOToxOVrOHo5w-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY1MTUxMg==", "bodyText": "I sense that we will do more with Bytecode analysis so this class will grow in functionality. Perhaps this PR is not the time to think it all through, but I'd offer that I think that we would want to avoid doing a Translator operation here and try to work on pure bytecode when doing these sorts of operations. I see the main use for this method in this PR is to detect lambdas. If that is the case, then I would instead write a hasLambda() function here and have it simply dig through the bytecode to look for Lambda objects.", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512651512", "createdAt": "2020-10-27T12:29:19Z", "author": {"login": "spmallette"}, "path": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/BytecodeUtil.java", "diffHunk": "@@ -43,4 +47,16 @@ private BytecodeUtil() {}\n                         s -> s.getOperator().equals(TraversalSource.Symbols.withStrategies) && clazz.isAssignableFrom(s.getArguments()[0].getClass())),\n                 os -> (A) os.getArguments()[0]);\n     }\n+\n+    /**\n+     * Parses {@link Bytecode} to find {@link Step} objects in the step instructions.\n+     * @return\n+     */\n+    public static Iterator<Step> findSteps(final Bytecode bytecode, final Class<?> clazz) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjU0NDEw", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517654410", "createdAt": "2020-10-27T12:36:55Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjozNjo1NlrOHo6CZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjozNjo1NlrOHo6CZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY1NTk3Mw==", "bodyText": "setup() for authentication and configure() for authorization - could we simply unify these and go with setup() for both? As long as the two methods have the same name/signature then it should look like one method from an inheritance perspective, no?", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512655973", "createdAt": "2020-10-27T12:36:56Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/main/java/org/apache/tinkerpop/gremlin/server/AbstractChannelizer.java", "diffHunk": "@@ -200,6 +211,35 @@ private Authenticator createAuthenticator(final Settings.AuthenticationSettings\n         }\n     }\n \n+    private Authorizer createAuthorizer(final Settings.AuthorizationSettings config) {\n+        final String authorizerClass = config.authorizer;\n+        if (null == authorizerClass) {\n+            return null;\n+        }\n+        try {\n+            final Class<?> clazz = Class.forName(authorizerClass);\n+            final Authorizer authorizer = (Authorizer) clazz.newInstance();\n+            authorizer.configure(config.config);\n+            return authorizer;\n+        } catch (Exception ex) {\n+            logger.warn(ex.getMessage());\n+            throw new IllegalStateException(String.format(\"Could not create/configure Authorizer %s\", authorizer), ex);\n+        }\n+    }\n+\n+    private AuthenticatorAuthorizer createAuthenticatorAuthorizer(final Settings settings) {\n+        try {\n+            final Class<?> clazz = Class.forName(settings.authentication.authenticator);\n+            final AuthenticatorAuthorizer authenticatorAuthorizer = (AuthenticatorAuthorizer) clazz.newInstance();\n+            authenticatorAuthorizer.setup(settings.authentication.config);\n+            authenticatorAuthorizer.configure(settings.authorization.config);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjYzMjkx", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517663291", "createdAt": "2020-10-27T12:47:56Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjo0Nzo1NlrOHo6chw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjo0Nzo1NlrOHo6chw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2MjY2Mw==", "bodyText": "Under what circumstance does it happen that we get a OPS_BYTECODE but its value remains a GraphSON 2.0 string that needs to be deserialized? if so, i would think we would want to figure out how to not let that happen and keep deserialization details out of the Authorizer?", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512662663", "createdAt": "2020-10-27T12:47:56Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/main/java/org/apache/tinkerpop/gremlin/server/authz/AbstractAuthorizer.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.tinkerpop.gremlin.server.authz;\n+\n+import org.apache.tinkerpop.gremlin.driver.Tokens;\n+import org.apache.tinkerpop.gremlin.driver.message.RequestMessage;\n+import org.apache.tinkerpop.gremlin.process.computer.traversal.strategy.decoration.VertexProgramStrategy;\n+import org.apache.tinkerpop.gremlin.process.traversal.Bytecode;\n+import org.apache.tinkerpop.gremlin.process.traversal.step.LambdaHolder;\n+import org.apache.tinkerpop.gremlin.process.traversal.util.BytecodeUtil;\n+import org.apache.tinkerpop.gremlin.server.auth.AuthenticatedUser;\n+import org.apache.tinkerpop.gremlin.structure.io.graphson.GraphSONMapper;\n+import org.apache.tinkerpop.gremlin.structure.io.graphson.GraphSONVersion;\n+import org.apache.tinkerpop.shaded.jackson.databind.ObjectMapper;\n+\n+import java.io.IOException;\n+\n+\n+/**\n+ * Provides utilities for implementing the {@link Authorizer} interface.\n+ *\n+ * @author Marc de Lignie\n+ */\n+public abstract class AbstractAuthorizer implements Authorizer{\n+    private static final ObjectMapper mapper = GraphSONMapper.build().version(GraphSONVersion.V2_0).create().createMapper();\n+\n+    /**\n+     * Authorizes a user for a request.\n+     *\n+     * @param user {@link AuthenticatedUser} to be used for the authorization\n+     * @param msg RequestMessage to authorize the user for\n+     */\n+    public void authorize(final AuthenticatedUser user, final RequestMessage msg) throws AuthorizationException {\n+        switch (msg.getOp()) {\n+            case Tokens.OPS_EVAL:\n+                final String script = (String) msg.getArgs().get(Tokens.ARGS_GREMLIN);\n+                authorizeString(user, script, msg);\n+                break;\n+            case Tokens.OPS_BYTECODE:\n+                final Bytecode bytecode;\n+                try {\n+                    final Object bytecodeObj = msg.getArgs().get(Tokens.ARGS_GREMLIN);\n+                    bytecode = bytecodeObj instanceof Bytecode ? (Bytecode) bytecodeObj :\n+                            mapper.readValue(bytecodeObj.toString(), Bytecode.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjcxNzMw", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517671730", "createdAt": "2020-10-27T12:57:41Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjo1Nzo0MVrOHo61mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMjo1Nzo0MVrOHo61mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2OTA4MQ==", "bodyText": "nice. looks like this body of work will also close:\nhttps://issues.apache.org/jira/browse/TINKERPOP-2418\nWe will need to remember to close that issue too when this merges", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512669081", "createdAt": "2020-10-27T12:57:41Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/main/java/org/apache/tinkerpop/gremlin/server/handler/StateKey.java", "diffHunk": "@@ -57,4 +58,9 @@ private StateKey() {}\n      * The key for the current request.\n      */\n     public static final AttributeKey<RequestMessage> REQUEST_MESSAGE = AttributeKey.valueOf(\"request\");\n+\n+    /**\n+     * The key for the current {@link AuthenticatedUser}.\n+     */\n+    public static final AttributeKey<AuthenticatedUser> AUTHENTICATED_USER = AttributeKey.valueOf(\"authenticatedUser\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjgzMzI3", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517683327", "createdAt": "2020-10-27T13:10:27Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMDoyN1rOHo7V_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMDoyN1rOHo7V_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NzM3Mw==", "bodyText": "i suppose the addition of the marko user was the change here:\nhttps://github.com/apache/tinkerpop/pull/1308/files#diff-a73da218a425ffa2b99f8c287c3ff3477426bb72748d0c21894d5067485b12a8R47\njust a new user...is that right? perhaps now would be a smart time to add a README.md to gremlin-server/data to remind us what the contents of those files are. i'm not even sure what gremlin-server/data/sample.kryo contains anymore.", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512677373", "createdAt": "2020-10-27T13:10:27Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/test/java/org/apache/tinkerpop/gremlin/server/GremlinServerAuthIntegrateTest.java", "diffHunk": "@@ -56,7 +56,7 @@ public Settings overrideSettings(final Settings settings) {\n         final Settings.AuthenticationSettings authSettings = new Settings.AuthenticationSettings();\n         authSettings.authenticator = SimpleAuthenticator.class.getName();\n \n-        // use a credentials graph with one user in it: stephen/password\n+        // use a credentials graph with two users in it: stephen/password and marko/rainbow-dash", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3Njg1Mzky", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517685392", "createdAt": "2020-10-27T13:12:42Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMjo0MlrOHo7b1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMjo0MlrOHo7b1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3ODg2OA==", "bodyText": "I know this is just for testing but could you please change the naming (to this class and related ones) to AllowList?", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512678868", "createdAt": "2020-10-27T13:12:42Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/test/java/org/apache/tinkerpop/gremlin/server/authz/Whitelist.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.tinkerpop.gremlin.server.authz;\n+\n+import org.yaml.snakeyaml.TypeDescription;\n+import org.yaml.snakeyaml.Yaml;\n+import org.yaml.snakeyaml.constructor.Constructor;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.InputStream;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+\n+/**\n+ * Whitelist for the WhitelistAuthorizer as configured by a YAML file.\n+ *\n+ * @author Marc de Lignie\n+ */\n+public class Whitelist {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3Njg4MDQ5", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-517688049", "createdAt": "2020-10-27T13:15:26Z", "commit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxNToyN1rOHo7jYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxNToyN1rOHo7jYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4MDgwMQ==", "bodyText": "This is a fairly advanced implementation for testing. It should provide a nice example for folks to learn from. would it be good to write user docs around this example and then snippet this code explicitly in the reference documentation?", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r512680801", "createdAt": "2020-10-27T13:15:27Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/test/java/org/apache/tinkerpop/gremlin/server/authz/WhitelistAuthorizer.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.tinkerpop.gremlin.server.authz;\n+\n+import org.apache.tinkerpop.gremlin.driver.Tokens;\n+import org.apache.tinkerpop.gremlin.driver.message.RequestMessage;\n+import org.apache.tinkerpop.gremlin.process.traversal.Bytecode;\n+import org.apache.tinkerpop.gremlin.process.traversal.TraversalSource;\n+import org.apache.tinkerpop.gremlin.server.Settings.AuthenticationSettings;\n+import org.apache.tinkerpop.gremlin.server.auth.AuthenticatedUser;\n+import org.apache.tinkerpop.gremlin.server.auth.Authenticator;\n+import org.apache.tinkerpop.gremlin.server.auth.SimpleAuthenticator;\n+\n+import java.util.*;\n+\n+\n+/**\n+ * Authorizes a user per request, based on a whitelist that grants access to {@link TraversalSource} instances for\n+ * bytecode requests and to gremlin server's sandbox for string requests and lambdas. The {@link\n+ * AuthenticationSettings}.config must have an authorizationWhitelist entry that contains the filename of the whitelist.\n+ * This authorizer is for demonstration purposes only. It does not scale well in the number of users regarding\n+ * memory usage and administrative burden.\n+ *\n+ * @author Marc de Lignie\n+ */\n+public class WhitelistAuthorizer extends AbstractAuthorizer {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc99bf01216eb24351435a5334ea4d10944db89c", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/bc99bf01216eb24351435a5334ea4d10944db89c", "committedDate": "2020-11-13T15:42:10Z", "message": "Adds the squashed work on the authorization feature until 2020-11-09\n\n  - Adds an AuthorizationHandler, an unfinished WhitelistAuthorizer and tests\n\n  - Adds Whitelist implementation and tests\n\n  - Extends WhitelistAuthorizer - abandoned first version\n\n  - Improves WhitelistAuthorizer: second version\n\n  - Adds WhiteList integration test for EVAL over websockets\n\n  - Extends Whitelist integration test with bytecode request over websockets\n\n  - Extends/improves whitelist integration tests\n\n  - Moves whitelist authorization to the gremlin server tests\n\n  - Simplifies and improves the WhiteListAuthorizer\n\n  - Embellishes the authorizer classes\n\n  - Adapts lambda and OLAP detection for authorization and naming of authz tests\n\n  - Addresses comments from the initial review and adds documentation.\n\n  - Extends provider documentation and resets AuthenticatedUser\n\n  - Extends audit logging\n\n  - Simplifies Authorizer API\n\n  - Adds AuthenticatorAuthorizer\n\n  - Addresses code issues from oct2020 review\n\n  - Addresses QwentB requirement for manipulating the RequestMessage\n\n  - Adds reference documentation for authorization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "221dc340eb5147138f89a3bd60875daf7f588777", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/221dc340eb5147138f89a3bd60875daf7f588777", "committedDate": "2020-11-14T10:14:20Z", "message": "Fixes the issues caused and discovered due to rebasing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "709f812af2046f5bf45f99155405d3fa7ccedd4f", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/709f812af2046f5bf45f99155405d3fa7ccedd4f", "committedDate": "2020-10-25T20:09:01Z", "message": "Adds AuthenticatorAuthorizer"}, "afterCommit": {"oid": "221dc340eb5147138f89a3bd60875daf7f588777", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/221dc340eb5147138f89a3bd60875daf7f588777", "committedDate": "2020-11-14T10:14:20Z", "message": "Fixes the issues caused and discovered due to rebasing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a25f015fff4ab8f89b458fdb96856b20201281c", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/5a25f015fff4ab8f89b458fdb96856b20201281c", "committedDate": "2020-11-14T11:08:25Z", "message": "Fixes minor oversights"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f92e764eb091802fa4d1fd355ccbde804bd37879", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/f92e764eb091802fa4d1fd355ccbde804bd37879", "committedDate": "2020-11-20T08:28:40Z", "message": "Fixes issue with and adds test for authorization with http transport\n\nFixes issue with and adds test for authorization with http transport"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea40044125793f9c03d71cded3f347563644479e", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/ea40044125793f9c03d71cded3f347563644479e", "committedDate": "2020-11-20T10:42:24Z", "message": "Fixes audit logging for unauthorized http request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "779430beddfc5580285009ff1b032738628b01c7", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/779430beddfc5580285009ff1b032738628b01c7", "committedDate": "2020-11-20T14:40:21Z", "message": "Adds code and test for VertexProgramDenyStrategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d41ede25ff3a4cea751155db423c071ae8d4351d", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/d41ede25ff3a4cea751155db423c071ae8d4351d", "committedDate": "2020-11-22T09:53:25Z", "message": "Adds documentation on the application of TraversalStrategy instances"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9140c2240d0d366e1b445d607e00363c9bc5565", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/d9140c2240d0d366e1b445d607e00363c9bc5565", "committedDate": "2020-11-27T09:16:24Z", "message": "Refactors the Authorizer interface and all classes associated with it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "786207f24f2239db34e3fdff11c0fd61ce60ea83", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/786207f24f2239db34e3fdff11c0fd61ce60ea83", "committedDate": "2020-11-29T09:53:31Z", "message": "Adds true-false-true test to GremlinServerAuthzIntegrateTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4d7bb486de94404d52cbcd7e1f767c350332e7c", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/f4d7bb486de94404d52cbcd7e1f767c350332e7c", "committedDate": "2020-12-04T09:26:40Z", "message": "Fixes issues regarding Authorizer usage with AlowAllAuthenticator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f95b1bb0424049a324ea321538972992e9c10e0", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/2f95b1bb0424049a324ea321538972992e9c10e0", "committedDate": "2020-12-05T10:57:29Z", "message": "Extends AllowListAuthorizer with checks on mutations and SubgraphStrategy alterations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41e2257378f53e5ae99d3b286b9a18a4c1f6fcf4", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/41e2257378f53e5ae99d3b286b9a18a4c1f6fcf4", "committedDate": "2020-12-05T14:33:29Z", "message": "Does some more refinement on the AllowListAuthorizer and related documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39db2b60da01125a2049a7e8a38a133e38cbcd57", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/39db2b60da01125a2049a7e8a38a133e38cbcd57", "committedDate": "2020-12-05T16:14:51Z", "message": "Adds sessioned string requests to GremlinServerAuthzIntegrateTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NDIwOTE1", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-548420915", "createdAt": "2020-12-09T17:25:14Z", "commit": {"oid": "39db2b60da01125a2049a7e8a38a133e38cbcd57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoyNToxNFrOICgdkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoyNToxNFrOICgdkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ5OTkyMw==", "bodyText": "As they are all static methods I think you could refactor to create a small final utility class to house them - HttpUtil or something like that?", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r539499923", "createdAt": "2020-12-09T17:25:14Z", "author": {"login": "spmallette"}, "path": "gremlin-server/src/main/java/org/apache/tinkerpop/gremlin/server/handler/HttpBasicAuthorizationHandler.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.tinkerpop.gremlin.server.handler;\n+\n+import io.netty.channel.ChannelFutureListener;\n+import io.netty.channel.ChannelHandler;\n+import io.netty.channel.ChannelHandlerContext;\n+import io.netty.channel.ChannelInboundHandlerAdapter;\n+import io.netty.handler.codec.http.DefaultFullHttpResponse;\n+import io.netty.handler.codec.http.FullHttpMessage;\n+import io.netty.handler.codec.http.FullHttpRequest;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.netty.util.ReferenceCountUtil;\n+import org.apache.tinkerpop.gremlin.driver.Tokens;\n+import org.apache.tinkerpop.gremlin.driver.message.RequestMessage;\n+import org.apache.tinkerpop.gremlin.server.GremlinServer;\n+import org.apache.tinkerpop.gremlin.server.auth.AuthenticatedUser;\n+import org.apache.tinkerpop.gremlin.server.authz.AuthorizationException;\n+import org.apache.tinkerpop.gremlin.server.authz.Authorizer;\n+import org.javatuples.Quartet;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.Map;\n+\n+import static io.netty.handler.codec.http.HttpResponseStatus.BAD_REQUEST;\n+import static io.netty.handler.codec.http.HttpResponseStatus.INTERNAL_SERVER_ERROR;\n+import static io.netty.handler.codec.http.HttpResponseStatus.UNAUTHORIZED;\n+import static io.netty.handler.codec.http.HttpVersion.HTTP_1_1;\n+\n+\n+/**\n+ *  An authorization handler for the http channel that allows the {@link Authorizer} to be plugged into it.\n+ *\n+ * @author Marc de Lignie\n+ */\n+@ChannelHandler.Sharable\n+public class HttpBasicAuthorizationHandler extends ChannelInboundHandlerAdapter {\n+    private static final Logger logger = LoggerFactory.getLogger(HttpBasicAuthorizationHandler.class);\n+    private static final Logger auditLogger = LoggerFactory.getLogger(GremlinServer.AUDIT_LOGGER_NAME);\n+\n+    private AuthenticatedUser user;\n+    private final Authorizer authorizer;\n+\n+    public HttpBasicAuthorizationHandler(Authorizer authorizer) {\n+        this.authorizer = authorizer;\n+    }\n+\n+    @Override\n+    public void channelRead(final ChannelHandlerContext ctx, final Object msg) {\n+        if (msg instanceof FullHttpMessage){\n+            final FullHttpMessage request = (FullHttpMessage) msg;\n+            try {\n+                user = ctx.channel().attr(StateKey.AUTHENTICATED_USER).get();\n+                if (null == user) {    // This is expected when using the AllowAllAuthenticator\n+                    user = AuthenticatedUser.ANONYMOUS_USER;\n+                }\n+                // ToDo: move getRequestArguments to a new preceding pipeline step in the Channelizer, but @Stephen,\n+                //       how about the sendAndCleanupConnection logic in HttpGremlinEndpointHandler?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39db2b60da01125a2049a7e8a38a133e38cbcd57"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMzc1MDMx", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-552375031", "createdAt": "2020-12-15T11:54:10Z", "commit": {"oid": "39db2b60da01125a2049a7e8a38a133e38cbcd57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMTo1NDoxMVrOIGHL1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMTo1NDoxMVrOIGHL1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI4MDA4NA==", "bodyText": "Please use the template variable for the documentation version in your link, thus: https://tinkerpop.apache.org/docs/x.y.z/reference/#security", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r543280084", "createdAt": "2020-12-15T11:54:11Z", "author": {"login": "spmallette"}, "path": "docs/src/dev/provider/index.asciidoc", "diffHunk": "@@ -1147,25 +1147,43 @@ one key value pair present (since only one `Traversal` is being submitted, there\n single alias).\n |=========================================================\n \n-=== Authentication\n+=== Authentication and Authorization\n \n Gremlin Server supports link:https://en.wikipedia.org/wiki/Simple_Authentication_and_Security_Layer[SASL-based]\n authentication.  A SASL implementation provides a series of challenges and responses that a driver must comply with\n-in order to authenticate.  By default, Gremlin Server only supports the \"PLAIN\" SASL mechanism, which is a cleartext\n-password system.  When authentication is enabled, an incoming request is intercepted before it is evaluated by the\n-`ScriptEngine`.  The request is saved on the server and a `AUTHENTICATE` challenge response (status code `407`) is\n-returned to the client.\n-\n-The client will detect the `AUTHENTICATE` and respond with an `authentication` for the `op` and an `arg` named `sasl`\n-that contains the password.  The password should be either, an encoded sequence of UTF-8 bytes, delimited by 0\n-(US-ASCII NUL), where the form is : `<NUL>username<NUL>password`, or a Base64 encoded string of the former (which\n-in this instance would be `AHVzZXJuYW1lAHBhc3N3b3Jk`).  Should Gremlin Server be able to authenticate with the\n-provided credentials, the server will return the results of the original request as it normally does without\n-authentication.  If it cannot authenticate given the challenge response from the client, it will return `UNAUTHORIZED`\n-(status code `401`).\n+in order to authenticate.  Gremlin Server supports the \"PLAIN\" SASL mechanism, which is a cleartext\n+password system, for all link:https://tinkerpop.apache.org/docs/current/tutorials/gremlin-language-variants/[Gremlin Language Variants].\n+Other SASL mechanisms supported for selected clients are listed in the\n+link:https://tinkerpop.apache.org/docs/current/reference/#security[security section of the Gremlin Server reference documentation].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39db2b60da01125a2049a7e8a38a133e38cbcd57"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMzc1MjY3", "url": "https://github.com/apache/tinkerpop/pull/1308#pullrequestreview-552375267", "createdAt": "2020-12-15T11:54:30Z", "commit": {"oid": "39db2b60da01125a2049a7e8a38a133e38cbcd57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMTo1NDozMFrOIGHMog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMTo1NDozMFrOIGHMog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI4MDI5MA==", "bodyText": "Please use the template variable for the documentation version in your link, thus: https://tinkerpop.apache.org/docs/x.y.z/reference/#security", "url": "https://github.com/apache/tinkerpop/pull/1308#discussion_r543280290", "createdAt": "2020-12-15T11:54:30Z", "author": {"login": "spmallette"}, "path": "docs/src/dev/provider/index.asciidoc", "diffHunk": "@@ -1147,25 +1147,43 @@ one key value pair present (since only one `Traversal` is being submitted, there\n single alias).\n |=========================================================\n \n-=== Authentication\n+=== Authentication and Authorization\n \n Gremlin Server supports link:https://en.wikipedia.org/wiki/Simple_Authentication_and_Security_Layer[SASL-based]\n authentication.  A SASL implementation provides a series of challenges and responses that a driver must comply with\n-in order to authenticate.  By default, Gremlin Server only supports the \"PLAIN\" SASL mechanism, which is a cleartext\n-password system.  When authentication is enabled, an incoming request is intercepted before it is evaluated by the\n-`ScriptEngine`.  The request is saved on the server and a `AUTHENTICATE` challenge response (status code `407`) is\n-returned to the client.\n-\n-The client will detect the `AUTHENTICATE` and respond with an `authentication` for the `op` and an `arg` named `sasl`\n-that contains the password.  The password should be either, an encoded sequence of UTF-8 bytes, delimited by 0\n-(US-ASCII NUL), where the form is : `<NUL>username<NUL>password`, or a Base64 encoded string of the former (which\n-in this instance would be `AHVzZXJuYW1lAHBhc3N3b3Jk`).  Should Gremlin Server be able to authenticate with the\n-provided credentials, the server will return the results of the original request as it normally does without\n-authentication.  If it cannot authenticate given the challenge response from the client, it will return `UNAUTHORIZED`\n-(status code `401`).\n+in order to authenticate.  Gremlin Server supports the \"PLAIN\" SASL mechanism, which is a cleartext\n+password system, for all link:https://tinkerpop.apache.org/docs/current/tutorials/gremlin-language-variants/[Gremlin Language Variants].\n+Other SASL mechanisms supported for selected clients are listed in the\n+link:https://tinkerpop.apache.org/docs/current/reference/#security[security section of the Gremlin Server reference documentation].\n+\n+When authentication is enabled, an incoming request is intercepted before it is evaluated by the `ScriptEngine`.  The\n+request is saved on the server and a `AUTHENTICATE` challenge response (status code `407`) is returned to the client.\n+\n+The client will detect the `AUTHENTICATE` and respond with an `authentication` for the `op` and an `arg` named `sasl`.\n+In case of the \"PLAIN\" SASL mechanism the `arg` contains the password.  The password should be either, an encoded\n+sequence of UTF-8 bytes, delimited by 0 (US-ASCII NUL), where the form is : `<NUL>username<NUL>password`, or a Base64\n+encoded string of the former (which in this instance would be `AHVzZXJuYW1lAHBhc3N3b3Jk`).  Should Gremlin Server be\n+able to authenticate with the provided credentials, the server will return the results of the original request as it\n+normally does without authentication.  If it cannot authenticate given the challenge response from the client, it will\n+return `UNAUTHORIZED` (status code `401`).\n \n NOTE: Gremlin Server does not support the \"authorization identity\" as described in link:https://tools.ietf.org/html/rfc4616[RFC4616].\n \n+In addition to authenticating users at the start of a connection, Gremlin Server allows providers to authorize users on\n+a per request basis. If\n+link:https://tinkerpop.apache.org/docs/x.y.z/reference/#_configuring_2[a java class is configured] that implements the\n+link:https://tinkerpop.apache.org/javadocs/x.y.z/full/org/apache/tinkerpop/gremlin/server/authz/Authorizer.html[Authorizer interface],\n+Gremlin Server passes each request to this `Authorizer`. The `Authorizer` can deny authorization for the request by\n+throwing an exception and Gremlin Server returns `UNAUTHORIZED` (status code `401`) to the client. The `Authorizer`\n+authorizes the request by returning the original request or the request with some additional constraints. Gremlin Server\n+proceeds with the returned request and on its turn returns the result of the request to the client. More details on\n+implementing authorization can be found in the\n+link:https://tinkerpop.apache.org/docs/current/reference/#security[reference documentation for Gremlin Server security].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39db2b60da01125a2049a7e8a38a133e38cbcd57"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26d916fe21e8baedcd51e6fbc9dd865583e13d87", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/26d916fe21e8baedcd51e6fbc9dd865583e13d87", "committedDate": "2020-12-18T09:59:22Z", "message": "Makes HttpBasicAuthorizationHandler consistent with HttpGremlinEndpointhandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2c578dbc90d712fc4a882c79e3fe5c75273f063", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/f2c578dbc90d712fc4a882c79e3fe5c75273f063", "committedDate": "2020-12-18T10:22:04Z", "message": "Corrects https://tinkerpop.apache.org/docs/current/ref* links in the asciidoc as requested in review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5317d38083e18c9ff7b96062a80c339fd7ecc9f", "author": {"user": null}, "url": "https://github.com/apache/tinkerpop/commit/d5317d38083e18c9ff7b96062a80c339fd7ecc9f", "committedDate": "2020-12-23T15:34:41Z", "message": "Reconstructs incomplete paragraph in new doc section"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4358, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}