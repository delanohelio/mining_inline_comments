{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NzQ1NDIz", "number": 6937, "title": "Issue-6931 LocalRunner", "bodyText": "Describe the bug\nThe LocalRunner class does not start a local thread runner instance for Java functions.\nTo Reproduce\nSteps to reproduce the behavior:\n\nCreate an instance of the LocalRunner class inside a Java class\nInitialize it like so:\n\nFunctionConfig functionConfig =  FunctionConfig.builder() .className(WordCountFunction.class.getName()) .maxPendingAsyncRequests(Integer.valueOf(500)) .name(\"word-counter\") .runtime(FunctionConfig.Runtime.JAVA) .build()\n  LocalRunner localRunner = \n    \tLocalRunner.builder()\n    \t\t.brokerServiceUrl(BROKER_URL)\n    \t\t.functionConfig(functionConfig)\n    \t\t.build();`\n\n\nAttach to the process with a debugger and set a breakpoint at line 360 of the LocalRunner class and attempt to step through to line 361\nSee a \"silent\" NullPointerException is thrown in the following call;\ninstanceConfig.setMaxPendingAsyncRequests(functionConfig.getMaxPendingAsyncRequests());  This is because the call to getMaxPendingAsyncRequests() returns null, even though I set it to a value in the FunctionConfig\n\nExpected behavior\nOne would expect the value I passed in to be set and for the LocalRunner to start the function inside a local thread\nScreenshots\nIf applicable, add screenshots to help explain your problem.\nDesktop (please complete the following information):\n\nOS: [e.g. iOS]\n\nAdditional context\nI have the code fix and will attach it to this ticket. Basically the issue is that there is a default value for that field inside the FunctionConfig class that is set as a direct assignment. However, since the class is Lombok annotated, that assignment gets ignored AND prevents assignments from occurring inside the builder as well.\nI have removed that assignment, and added an equivalent logic block to the FunctionConfigUtils.inferMissingArguments method to set a default value of 1000 if none is provided.", "createdAt": "2020-05-10T16:27:56Z", "url": "https://github.com/apache/pulsar/pull/6937", "merged": true, "mergeCommit": {"oid": "8664aea199f2001c8172683582d6d83fd5c11576"}, "closed": true, "closedAt": "2020-05-18T21:31:20Z", "author": {"login": "david-streamlio"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcf9mcWAH2gAyNDE1NzQ1NDIzOjNmZmQ4NzhkYzQ1ZDc0YTFhZjU2ZmJkOTM0MDU3MTg2YTcxYzE1OWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchI8liAFqTQxMTU2MzA4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ffd878dc45d74a1af56fbd934057186a71c159d", "author": {"user": {"login": "david-streamlio", "name": "David Kjerrumgaard"}}, "url": "https://github.com/apache/pulsar/commit/3ffd878dc45d74a1af56fbd934057186a71c159d", "committedDate": "2020-05-10T16:23:56Z", "message": "Fixes issue-6931"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjE3MjAw", "url": "https://github.com/apache/pulsar/pull/6937#pullrequestreview-409617200", "createdAt": "2020-05-12T00:19:12Z", "commit": {"oid": "3ffd878dc45d74a1af56fbd934057186a71c159d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMDoxOToxMlrOGTxzCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMDoxOToxMlrOGTxzCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5MjAwOA==", "bodyText": "Can you have a static default value inside the FunctionConfig itself and use that to init here", "url": "https://github.com/apache/pulsar/pull/6937#discussion_r423392008", "createdAt": "2020-05-12T00:19:12Z", "author": {"login": "srkukarni"}, "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionConfigUtils.java", "diffHunk": "@@ -367,6 +367,10 @@ public static void inferMissingArguments(FunctionConfig functionConfig) {\n         if (functionConfig.getParallelism() == null) {\n             functionConfig.setParallelism(1);\n         }\n+        \n+        if (functionConfig.getMaxPendingAsyncRequests() == null) {\n+        \tfunctionConfig.setMaxPendingAsyncRequests(Integer.valueOf(1000));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffd878dc45d74a1af56fbd934057186a71c159d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5647ab43c175e2a5853b1e1bd4f6ed13f3fa7b8", "author": {"user": {"login": "david-streamlio", "name": "David Kjerrumgaard"}}, "url": "https://github.com/apache/pulsar/commit/d5647ab43c175e2a5853b1e1bd4f6ed13f3fa7b8", "committedDate": "2020-05-12T02:31:28Z", "message": "Added constants to FunctionConfigUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTYzMDgy", "url": "https://github.com/apache/pulsar/pull/6937#pullrequestreview-411563082", "createdAt": "2020-05-14T08:11:00Z", "commit": {"oid": "d5647ab43c175e2a5853b1e1bd4f6ed13f3fa7b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2805, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}