{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NDI2MDM2", "number": 6758, "title": "change test case code org.apache.pulsar.io.PulsarFunctionE2ETest#testFunctionAutomaticSubCleanup", "bodyText": "in testcase org.apache.pulsar.io.PulsarFunctionE2ETest#testFunctionAutomaticSubCleanup,\n\n\nthere is one test checkpoint, we should not check admin.functions().getFunction(tenant, namespacePortion, functionName).getCleanupSubscription(),\nwe shold check admin.functions().getFunction(tenant, namespacePortion, functionName) is not null,\nand admin.functions().getFunction(tenant, namespacePortion, functionName).getCleanupSubscription() should not be null\n\n\nwe should not check Parallelism, because the code here is 1 instead of 2", "createdAt": "2020-04-18T01:44:44Z", "url": "https://github.com/apache/pulsar/pull/6758", "merged": true, "mergeCommit": {"oid": "225baf5fac4051b04e87bb1d351d85273449b761"}, "closed": true, "closedAt": "2020-05-19T13:47:21Z", "author": {"login": "zplinuxlover"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYr0I-AH2gAyNDA1NDI2MDM2OjZiY2JiZjdkNzQ0YWE2ODc0NWY2OWY5MTg2ZTcwZjlkZjBiOWY4MWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci0wC9gFqTQxNDQ2MjQ5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6bcbbf7d744aa68745f69f9186e70f9df0b9f81c", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/6bcbbf7d744aa68745f69f9186e70f9df0b9f81c", "committedDate": "2020-04-18T01:43:08Z", "message": "in testcase org.apache.pulsar.io.PulsarFunctionE2ETest#testFunctionAutomaticSubCleanup:\n1.  there is one test checkpoint, we should not check `admin.functions().getFunction(tenant, namespacePortion, functionName).getCleanupSubscription()`, instead\nwe should check `admin.functions().getFunction(tenant, namespacePortion, functionName)` is not null,\nand `admin.functions().getFunction(tenant, namespacePortion, functionName).getCleanupSubscription()` should not be null\n\n2. we should not check `Parallelism`, because the code here is 1 instead of 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d42ee4ceae1fab22f1cf70aa68e45963326d3092", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/d42ee4ceae1fab22f1cf70aa68e45963326d3092", "committedDate": "2020-04-20T09:18:07Z", "message": "when I run testcase `org.apache.pulsar.broker.admin.AdminApiOffloadTest.testOffloadPolicies`, there is an error,\nI debug the code, I found that there is possibility that `offloadPolicies.getManagedLedgerOffloadDeletionLagInMillis()`\nis null. so I change the code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTQyNzAx", "url": "https://github.com/apache/pulsar/pull/6758#pullrequestreview-396542701", "createdAt": "2020-04-20T15:05:59Z", "commit": {"oid": "d42ee4ceae1fab22f1cf70aa68e45963326d3092"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTowNTo1OVrOGIZKkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTowNTo1OVrOGIZKkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ1NDA5Nw==", "bodyText": "Looks not related to this PR right?", "url": "https://github.com/apache/pulsar/pull/6758#discussion_r411454097", "createdAt": "2020-04-20T15:05:59Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "diffHunk": "@@ -2552,9 +2552,10 @@ protected void internalSetOffloadPolicies(AsyncResponse asyncResponse, OffloadPo\n             final String path = path(POLICIES, namespaceName.toString());\n             byte[] content = globalZk().getData(path, null, nodeStat);\n             Policies policies = jsonMapper().readValue(content, Policies.class);\n-\n-            if (offloadPolicies.getManagedLedgerOffloadDeletionLagInMillis()\n-                    .equals(OffloadPolicies.DEFAULT_OFFLOAD_DELETION_LAG_IN_MILLIS)) {\n+            // there is possibility that `offloadPolicies.getManagedLedgerOffloadDeletionLagInMillis()` is null.\n+            if (offloadPolicies.getManagedLedgerOffloadDeletionLagInMillis() == null && OffloadPolicies.DEFAULT_OFFLOAD_DELETION_LAG_IN_MILLIS == null\n+                    || offloadPolicies.getManagedLedgerOffloadDeletionLagInMillis() != null\n+                    && offloadPolicies.getManagedLedgerOffloadDeletionLagInMillis().equals(OffloadPolicies.DEFAULT_OFFLOAD_DELETION_LAG_IN_MILLIS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d42ee4ceae1fab22f1cf70aa68e45963326d3092"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b0ce6c46785f964fac9c9e22f52269fc91688c8", "author": {"user": {"login": "zplinuxlover", "name": "luceneReader"}}, "url": "https://github.com/apache/pulsar/commit/9b0ce6c46785f964fac9c9e22f52269fc91688c8", "committedDate": "2020-05-05T08:11:25Z", "message": "Merge branch 'master' into bugfix-testcase-func"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MTc3ODg5", "url": "https://github.com/apache/pulsar/pull/6758#pullrequestreview-407177889", "createdAt": "2020-05-07T06:21:54Z", "commit": {"oid": "9b0ce6c46785f964fac9c9e22f52269fc91688c8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjoyMTo1NFrOGRv--Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNjozNDoyNFrOGRwRGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2NTE0NQ==", "bodyText": "Shall we need to add this comment? look we already have a null check for deletion lag.", "url": "https://github.com/apache/pulsar/pull/6758#discussion_r421265145", "createdAt": "2020-05-07T06:21:54Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "diffHunk": "@@ -2595,7 +2595,7 @@ protected void internalSetOffloadPolicies(AsyncResponse asyncResponse, OffloadPo\n             final String path = path(POLICIES, namespaceName.toString());\n             byte[] content = globalZk().getData(path, null, nodeStat);\n             Policies policies = jsonMapper().readValue(content, Policies.class);\n-\n+            // there is possibility that `offloadPolicies.getManagedLedgerOffloadDeletionLagInMillis()` is null.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0ce6c46785f964fac9c9e22f52269fc91688c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2OTc4NA==", "bodyText": "You can fix the wrong assert directly.", "url": "https://github.com/apache/pulsar/pull/6758#discussion_r421269784", "createdAt": "2020-05-07T06:34:24Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/io/PulsarFunctionE2ETest.java", "diffHunk": "@@ -1509,8 +1513,9 @@ public void testFunctionAutomaticSubCleanup() throws Exception {\n \n         retryStrategically((test) -> {\n             try {\n+                // should remove `result.getParallelism() == 2` because the parallelism here should 1\n                 FunctionConfig result = admin.functions().getFunction(tenant, namespacePortion, functionName);\n-                return result.getParallelism() == 2 && result.getCleanupSubscription() == false;\n+                return /*result.getParallelism() == 2 &&*/ result.getCleanupSubscription() == false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0ce6c46785f964fac9c9e22f52269fc91688c8"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "118e7499de720b23ba756eacee1933bde29493f7", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/118e7499de720b23ba756eacee1933bde29493f7", "committedDate": "2020-05-12T09:42:12Z", "message": "remove unnecessary comment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDYyNDk5", "url": "https://github.com/apache/pulsar/pull/6758#pullrequestreview-414462499", "createdAt": "2020-05-19T13:47:03Z", "commit": {"oid": "118e7499de720b23ba756eacee1933bde29493f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3566, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}