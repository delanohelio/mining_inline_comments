{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NTI1ODI1", "number": 6905, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjowODo0OFrOD6UcJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNToyNjo0M1rOD7fq_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDc4ODg0OnYy", "diffSide": "RIGHT", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/JacksonJsonReader.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjowODo0OFrOGSF0vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNDo1Nzo1N1rOGSZDgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyMjk3NQ==", "bodyText": "Can we be sure nobody is using this class (since renaming is a backward-breaking change)? (Same question for the writer.)", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421622975", "createdAt": "2020-05-07T16:08:48Z", "author": {"login": "hansenc"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/JacksonJsonReader.java", "diffHunk": "@@ -27,11 +27,11 @@\n import java.io.IOException;\n import java.io.InputStream;\n \n-public class JsonReader<T> implements SchemaReader<T> {\n+public class JacksonJsonReader<T> implements SchemaReader<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0OTUxOQ==", "bodyText": "Well .. yeah someone could have used this class, for whatever reason from outside the framework. But it's original name is bad chosen, probably keep both and make the old class deprecated?", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421649519", "createdAt": "2020-05-07T16:50:56Z", "author": {"login": "Persi"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/JacksonJsonReader.java", "diffHunk": "@@ -27,11 +27,11 @@\n import java.io.IOException;\n import java.io.InputStream;\n \n-public class JsonReader<T> implements SchemaReader<T> {\n+public class JacksonJsonReader<T> implements SchemaReader<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyMjk3NQ=="}, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3NDA2MA==", "bodyText": "The rename is not worth it, IMO, but I defer to maintainers.", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421674060", "createdAt": "2020-05-07T17:31:50Z", "author": {"login": "hansenc"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/JacksonJsonReader.java", "diffHunk": "@@ -27,11 +27,11 @@\n import java.io.IOException;\n import java.io.InputStream;\n \n-public class JsonReader<T> implements SchemaReader<T> {\n+public class JacksonJsonReader<T> implements SchemaReader<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyMjk3NQ=="}, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzODA1MQ==", "bodyText": "I kept both versions and deprecated the old ones.", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421938051", "createdAt": "2020-05-08T04:57:57Z", "author": {"login": "Persi"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/JacksonJsonReader.java", "diffHunk": "@@ -27,11 +27,11 @@\n import java.io.IOException;\n import java.io.InputStream;\n \n-public class JsonReader<T> implements SchemaReader<T> {\n+public class JacksonJsonReader<T> implements SchemaReader<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyMjk3NQ=="}, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDc5ODc1OnYy", "diffSide": "RIGHT", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjoxMToyMFrOGSF7Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjo0NDoyMFrOGSHM7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyNDU5NQ==", "bodyText": "I think you meant return this;, which begs the question, can we have some tests?", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421624595", "createdAt": "2020-05-07T16:11:20Z", "author": {"login": "hansenc"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "diffHunk": "@@ -114,6 +120,18 @@\n         return this;\n     }\n \n+    @Override\n+    public SchemaDefinitionBuilder<T> withSchemaReader(SchemaReader<T> reader) {\n+        this.reader=reader;\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0NTU0OA==", "bodyText": "Welll ... obviously I meant that ... you should never do two things at once ...", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421645548", "createdAt": "2020-05-07T16:44:20Z", "author": {"login": "Persi"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "diffHunk": "@@ -114,6 +120,18 @@\n         return this;\n     }\n \n+    @Override\n+    public SchemaDefinitionBuilder<T> withSchemaReader(SchemaReader<T> reader) {\n+        this.reader=reader;\n+        return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyNDU5NQ=="}, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDc5OTkyOnYy", "diffSide": "RIGHT", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjoxMTozN1rOGSF70Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjoxMTozN1rOGSF70Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyNDc4NQ==", "bodyText": "return this;", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421624785", "createdAt": "2020-05-07T16:11:37Z", "author": {"login": "hansenc"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "diffHunk": "@@ -114,6 +120,18 @@\n         return this;\n     }\n \n+    @Override\n+    public SchemaDefinitionBuilder<T> withSchemaReader(SchemaReader<T> reader) {\n+        this.reader=reader;\n+        return null;\n+    }\n+\n+    @Override\n+    public SchemaDefinitionBuilder<T> withSchemaWriter(SchemaWriter<T> writer) {\n+        this.writer = writer;\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDg1NzUyOnYy", "diffSide": "RIGHT", "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinition.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjoyNjoyNlrOGSGg2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNzoxODoyNFrOGSIcuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYzNDI2NA==", "bodyText": "This interface is used for more than just JSON schemas, right? If so, it will be confusing for users to be able to set a reader and writer for any type of schema when they will only be used for JSON schemas and ignored otherwise. So we either need to support this broadly, or instead we can overload JSONSchema.of() for a more targeted approach.", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421634264", "createdAt": "2020-05-07T16:26:26Z", "author": {"login": "hansenc"}, "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinition.java", "diffHunk": "@@ -76,4 +78,18 @@\n      * @return the flag of supportSchemaVersioning\n      */\n     boolean getSupportSchemaVersioning();\n+\n+    /**\n+     * Get a configured schema reader.\n+     *\n+     * @return optional containing configured schema reader or empty optional if none is configure\n+     */\n+    Optional<SchemaReader<T>> getSchemaReaderOpt();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0ODMyNQ==", "bodyText": "This interface can be used for other schemas as well, but both SchemaReader and SchemaWriter as well. I see what you mean, did not recognize the Producer and Consumer instantiators with Schema as parameter. But I am not sure if Schema class is meant to be used like that from outside the framework. As they already introduced some default Schema instantiators in the client api Schema class, I would not promote Schema.of for public use, as it is an internal of the framework.", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421648325", "createdAt": "2020-05-07T16:49:03Z", "author": {"login": "Persi"}, "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinition.java", "diffHunk": "@@ -76,4 +78,18 @@\n      * @return the flag of supportSchemaVersioning\n      */\n     boolean getSupportSchemaVersioning();\n+\n+    /**\n+     * Get a configured schema reader.\n+     *\n+     * @return optional containing configured schema reader or empty optional if none is configure\n+     */\n+    Optional<SchemaReader<T>> getSchemaReaderOpt();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYzNDI2NA=="}, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY2NTk3Nw==", "bodyText": "Hmm, you'll probably want to overload Schema.JSON(Class<T>) and Schema.JSON(SchemaDefinition) as well as JSONSchema.of(). All of these are referenced in the docs so presumably they are meant for public use. (Though I would have guessed JSONSchema.of is not meant for public use since it's in the impl package. \ud83e\udd37)", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r421665977", "createdAt": "2020-05-07T17:18:24Z", "author": {"login": "hansenc"}, "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinition.java", "diffHunk": "@@ -76,4 +78,18 @@\n      * @return the flag of supportSchemaVersioning\n      */\n     boolean getSupportSchemaVersioning();\n+\n+    /**\n+     * Get a configured schema reader.\n+     *\n+     * @return optional containing configured schema reader or empty optional if none is configure\n+     */\n+    Optional<SchemaReader<T>> getSchemaReaderOpt();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYzNDI2NA=="}, "originalCommit": {"oid": "5af0792d16dd868274f6be8297dc5f6244096a94"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzExNDg2OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/BrokerClientIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNToyNjo0M1rOGT2ihQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNToyNjo0M1rOGT2ihQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ2OTcwMQ==", "bodyText": "Avoid using import .*", "url": "https://github.com/apache/pulsar/pull/6905#discussion_r423469701", "createdAt": "2020-05-12T05:26:43Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/BrokerClientIntegrationTest.java", "diffHunk": "@@ -67,16 +71,14 @@\n import org.apache.pulsar.broker.service.Topic;\n import org.apache.pulsar.broker.service.persistent.PersistentTopic;\n import org.apache.pulsar.client.admin.PulsarAdminException;\n-import org.apache.pulsar.client.api.Consumer;\n-import org.apache.pulsar.client.api.ConsumerBuilder;\n-import org.apache.pulsar.client.api.Message;\n-import org.apache.pulsar.client.api.MessageId;\n-import org.apache.pulsar.client.api.Producer;\n-import org.apache.pulsar.client.api.ProducerConsumerBase;\n-import org.apache.pulsar.client.api.PulsarClient;\n-import org.apache.pulsar.client.api.PulsarClientException;\n-import org.apache.pulsar.client.api.SubscriptionType;\n+import org.apache.pulsar.client.api.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed8cc7bb618f479417d7ed263f56fe1ee3cde88d"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1849, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}