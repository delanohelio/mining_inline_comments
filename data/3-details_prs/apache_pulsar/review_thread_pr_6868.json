{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyODY0MTc2", "number": 6868, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjo1OTo0OVrOD9lGFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjozODo0OFrOEDiJUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODk3NDkzOnYy", "diffSide": "RIGHT", "path": "pulsar-functions/proto/src/main/proto/Function.proto", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjo1OTo0OVrOGXKLJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwNzoxNTo1N1rOGZn9Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNzEyNQ==", "bodyText": "I don't think it is a good design to add these two settings directly. Because these two settings are only applied to AVRO or Struct schemas. It doesn't provide any extensibility to the framework of Pulsar functions. We should provide the ability to allow specifying properties for the schema for the input topic and properties for the schema for the output topic.\nSo ideally, it should be:\nmap<string, string> schemaProperties = 6;.", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r426937125", "createdAt": "2020-05-18T22:59:49Z", "author": {"login": "sijie"}, "path": "pulsar-functions/proto/src/main/proto/Function.proto", "diffHunk": "@@ -91,6 +91,8 @@ message ConsumerSpec {\n         int32 value = 1;\n     }\n     ReceiverQueueSize receiverQueueSize = 4;\n+    bool jsr310ConversionEnabled = 5;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f29f7e679a8ca78745765152b35f5c8152be866e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNzQ0NA==", "bodyText": "We should also add the schemaProperties to both SourceSpec and SinkSpec.", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r426937444", "createdAt": "2020-05-18T23:00:38Z", "author": {"login": "sijie"}, "path": "pulsar-functions/proto/src/main/proto/Function.proto", "diffHunk": "@@ -91,6 +91,8 @@ message ConsumerSpec {\n         int32 value = 1;\n     }\n     ReceiverQueueSize receiverQueueSize = 4;\n+    bool jsr310ConversionEnabled = 5;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNzEyNQ=="}, "originalCommit": {"oid": "f29f7e679a8ca78745765152b35f5c8152be866e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUyMjE5NA==", "bodyText": "Properties have been merged into schemaProperties, and configuration is added, we can set the schema of SinkSpec", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r429522194", "createdAt": "2020-05-23T07:15:57Z", "author": {"login": "315157973"}, "path": "pulsar-functions/proto/src/main/proto/Function.proto", "diffHunk": "@@ -91,6 +91,8 @@ message ConsumerSpec {\n         int32 value = 1;\n     }\n     ReceiverQueueSize receiverQueueSize = 4;\n+    bool jsr310ConversionEnabled = 5;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNzEyNQ=="}, "originalCommit": {"oid": "f29f7e679a8ca78745765152b35f5c8152be866e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODcwNTQwOnYy", "diffSide": "RIGHT", "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMDo1MDoxMlrOGgM4XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTo0NTo1OFrOGgWi6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQxODY1Mg==", "bodyText": "Please use SchemaDefinitionBuilder#withProperties to construct the schema definition and avoid adding this kind of customization code. Also, the schema properties should be passed to other schemas as well.", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r436418652", "createdAt": "2020-06-08T00:50:12Z", "author": {"login": "sijie"}, "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "diffHunk": "@@ -158,6 +173,20 @@ private static SchemaType getDefaultSchemaType(Class<?> clazz) {\n         }\n     }\n \n+    private static <T> AvroSchema<T> buildAvroSchema(Class<T> clazz, ConsumerConfig conf) {\n+        String jsr310ConversionEnabled = null;\n+        String alwaysAllowNull = null;\n+        if (conf.getSchemaProperties() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9022d8421ec0a527c47cac0e126e17667b9031e"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3NzAwMA==", "bodyText": "Please use SchemaDefinitionBuilder#withProperties to construct the schema definition and avoid adding this kind of customization code. Also, the schema properties should be passed to other schemas as well.\n\nModify as follows:\n1 Since the map generated by protobuf is immutable, a new Map is added to TopicSchema line 161.\n2 Since the parameters such as JSR310 in SchemaDefinitionBuilder are underlined,the incoming parameters will be converted\n@sijie", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r436577000", "createdAt": "2020-06-08T09:45:58Z", "author": {"login": "315157973"}, "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "diffHunk": "@@ -158,6 +173,20 @@ private static SchemaType getDefaultSchemaType(Class<?> clazz) {\n         }\n     }\n \n+    private static <T> AvroSchema<T> buildAvroSchema(Class<T> clazz, ConsumerConfig conf) {\n+        String jsr310ConversionEnabled = null;\n+        String alwaysAllowNull = null;\n+        if (conf.getSchemaProperties() != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQxODY1Mg=="}, "originalCommit": {"oid": "d9022d8421ec0a527c47cac0e126e17667b9031e"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTQwNjI2OnYy", "diffSide": "RIGHT", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjozODo0OFrOGgmzTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMzoxODoyM1rOGg3ZGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg0MzM0MQ==", "bodyText": "Can you explain why do you introduce two new settings without underscores?", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r436843341", "createdAt": "2020-06-08T16:38:48Z", "author": {"login": "sijie"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "diffHunk": "@@ -35,7 +35,9 @@\n public class SchemaDefinitionBuilderImpl<T> implements SchemaDefinitionBuilder<T> {\n \n     public static final String ALWAYS_ALLOW_NULL = \"__alwaysAllowNull\";\n+    public static final String ALWAYS_ALLOW_NULL_NO_UNDERLINED = \"alwaysAllowNull\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "338d72c38a9e968140fe960e4c76fc2c220a0cb6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg0MzkwMA==", "bodyText": "Why can't we use the existing settings?", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r436843900", "createdAt": "2020-06-08T16:39:45Z", "author": {"login": "sijie"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "diffHunk": "@@ -35,7 +35,9 @@\n public class SchemaDefinitionBuilderImpl<T> implements SchemaDefinitionBuilder<T> {\n \n     public static final String ALWAYS_ALLOW_NULL = \"__alwaysAllowNull\";\n+    public static final String ALWAYS_ALLOW_NULL_NO_UNDERLINED = \"alwaysAllowNull\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg0MzM0MQ=="}, "originalCommit": {"oid": "338d72c38a9e968140fe960e4c76fc2c220a0cb6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNTE2MQ==", "bodyText": "Already use existing settings\u3002This may cause some parameters to be underscores, some not\n@sijie", "url": "https://github.com/apache/pulsar/pull/6868#discussion_r437115161", "createdAt": "2020-06-09T03:18:23Z", "author": {"login": "315157973"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "diffHunk": "@@ -35,7 +35,9 @@\n public class SchemaDefinitionBuilderImpl<T> implements SchemaDefinitionBuilder<T> {\n \n     public static final String ALWAYS_ALLOW_NULL = \"__alwaysAllowNull\";\n+    public static final String ALWAYS_ALLOW_NULL_NO_UNDERLINED = \"alwaysAllowNull\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg0MzM0MQ=="}, "originalCommit": {"oid": "338d72c38a9e968140fe960e4c76fc2c220a0cb6"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1839, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}