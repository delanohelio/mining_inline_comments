{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNjU4MTUw", "number": 7744, "title": "[broker] Make resetting cursor in REST API asynchronous", "bodyText": "Motivation\nAs mentioned in #7478, PersistentSubscription#resetCursor() may not complete for unknown reasons. This blocks pulsar-web threads, so it can cause the broker server to be unable to respond to HTTP requests.\nModifications\nGet the result of PersistentSubscription#resetCursor() asynchronously so as not to block pulsar-web threads.", "createdAt": "2020-08-04T09:52:21Z", "url": "https://github.com/apache/pulsar/pull/7744", "merged": true, "mergeCommit": {"oid": "69cbd26eafb87b8e84b3abfe4d0f0b915fd75320"}, "closed": true, "closedAt": "2020-08-06T10:02:43Z", "author": {"login": "massakam"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7jvjfAFqTQ2MDY3NTE1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8M4x2gFqTQ2MjM4MDUzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNjc1MTUx", "url": "https://github.com/apache/pulsar/pull/7744#pullrequestreview-460675151", "createdAt": "2020-08-04T10:06:14Z", "commit": {"oid": "942063fc7d46f977213e5119ff80d36dd42a82ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDI0OTk3", "url": "https://github.com/apache/pulsar/pull/7744#pullrequestreview-461024997", "createdAt": "2020-08-04T17:32:19Z", "commit": {"oid": "942063fc7d46f977213e5119ff80d36dd42a82ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11e6e3f17a519101ece6d35090bd37b143185c70", "author": {"user": {"login": "massakam", "name": "Masahiro Sakamoto"}}, "url": "https://github.com/apache/pulsar/commit/11e6e3f17a519101ece6d35090bd37b143185c70", "committedDate": "2020-08-05T00:58:08Z", "message": "Make resetting cursor in REST API asynchronous"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fe7e5fc2937d4b8baa99d798083b89974072819", "author": {"user": {"login": "massakam", "name": "Masahiro Sakamoto"}}, "url": "https://github.com/apache/pulsar/commit/5fe7e5fc2937d4b8baa99d798083b89974072819", "committedDate": "2020-08-05T00:58:09Z", "message": "Enable automatic topic creation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cbf719459753d3b89d50d88e268b943c5700ed80", "author": {"user": {"login": "massakam", "name": "Masahiro Sakamoto"}}, "url": "https://github.com/apache/pulsar/commit/cbf719459753d3b89d50d88e268b943c5700ed80", "committedDate": "2020-08-04T18:28:56Z", "message": "Enable automatic topic creation"}, "afterCommit": {"oid": "5fe7e5fc2937d4b8baa99d798083b89974072819", "author": {"user": {"login": "massakam", "name": "Masahiro Sakamoto"}}, "url": "https://github.com/apache/pulsar/commit/5fe7e5fc2937d4b8baa99d798083b89974072819", "committedDate": "2020-08-05T00:58:09Z", "message": "Enable automatic topic creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d8f2397f36ecbaf5661c772d2c4a1e154c899cf", "author": {"user": {"login": "massakam", "name": "Masahiro Sakamoto"}}, "url": "https://github.com/apache/pulsar/commit/0d8f2397f36ecbaf5661c772d2c4a1e154c899cf", "committedDate": "2020-08-05T05:01:08Z", "message": "Get cause of CompletionException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNjEwNDk0", "url": "https://github.com/apache/pulsar/pull/7744#pullrequestreview-461610494", "createdAt": "2020-08-05T12:22:03Z", "commit": {"oid": "0d8f2397f36ecbaf5661c772d2c4a1e154c899cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMjoyMjowM1rOG8HPFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMjoyMjowM1rOG8HPFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY4NjI5Mw==", "bodyText": "This test fails if allowAutoTopicCreation is false.\nWe are testing if the subscription creation is successful here. However, if allowAutoTopicCreation is false, the topic cannot be created and the subscription creation should also fail.\n\n  \n    \n      pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java\n    \n    \n        Lines 1787 to 1789\n      in\n      8061c54\n    \n    \n    \n    \n\n        \n          \n           boolean isAllowAutoTopicCreation = pulsar().getConfiguration().isAllowAutoTopicCreation(); \n        \n\n        \n          \n           PersistentTopic topic = (PersistentTopic) pulsar().getBrokerService() \n        \n\n        \n          \n                   .getTopic(topicName.toString(), isAllowAutoTopicCreation).thenApply(Optional::get).join(); \n        \n    \n  \n\n\nI think it's a mistake to set allowAutoTopicCreation to false here. Previously this test passed because the REST API was not able to return the error response correctly.", "url": "https://github.com/apache/pulsar/pull/7744#discussion_r465686293", "createdAt": "2020-08-05T12:22:03Z", "author": {"login": "massakam"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "diffHunk": "@@ -232,7 +232,6 @@ public void testTerminatePartitionedTopic() {\n \n     @Test\n     public void testNonPartitionedTopics() {\n-        pulsar.getConfiguration().setAllowAutoTopicCreation(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d8f2397f36ecbaf5661c772d2c4a1e154c899cf"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMzgwNTM5", "url": "https://github.com/apache/pulsar/pull/7744#pullrequestreview-462380539", "createdAt": "2020-08-06T10:02:25Z", "commit": {"oid": "0d8f2397f36ecbaf5661c772d2c4a1e154c899cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 482, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}