{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMzY3NTcz", "number": 6192, "title": "[deployement] make kubernetes yamls for aws operational", "bodyText": "Motivation\nSupplied Kubernetes yaml's for AWS are outdated and just don't work.\nModifications\nUpdate yaml files and so that appying them on AWS EKS will actually set up a working Pulsar environment.\nVerifying this change\nThis change is a trivial rework / code cleanup without any test coverage.\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (no)\nThe default values of configurations: (no)\nThe wire protocol: (no)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)\nIf yes, how is the feature documented? (not applicable)\nIf a feature is not applicable for documentation, explain why?\nHow to apply the yaml's is already documented, it just didn't work.", "createdAt": "2020-02-03T15:08:24Z", "url": "https://github.com/apache/pulsar/pull/6192", "merged": true, "mergeCommit": {"oid": "d631156d9d1843aa44aa1cb1a4bb0c760064c0c2"}, "closed": true, "closedAt": "2020-02-07T00:29:26Z", "author": {"login": "trexinc"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAtS-QAH2gAyMzcwMzY3NTczOjRlM2Q1YTNmNmQ4YTdhY2Q5MzU0YTliMWJmMGEwMzZjNjFiYmMxZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB0M3DgFqTM1NDg2NTY3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e3d5a3f6d8a7acd9354a9b1bf0a036c61bbc1f4", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/4e3d5a3f6d8a7acd9354a9b1bf0a036c61bbc1f4", "committedDate": "2020-02-03T13:52:32Z", "message": "make kubernetes yamls for aws operational"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDQ0NjY2", "url": "https://github.com/apache/pulsar/pull/6192#pullrequestreview-352444666", "createdAt": "2020-02-03T17:52:57Z", "commit": {"oid": "4e3d5a3f6d8a7acd9354a9b1bf0a036c61bbc1f4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNzo1Mjo1OFrOFk6Tsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNzo1Mjo1OFrOFk6Tsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI0ODM3MA==", "bodyText": "I think you can just use the headless service name for zookeeperServers and configurationStoreServers. You don't need to write down all the pods here. because this will not work if people deploy a zookeeper with less than 3 pods.", "url": "https://github.com/apache/pulsar/pull/6192#discussion_r374248370", "createdAt": "2020-02-03T17:52:58Z", "author": {"login": "sijie"}, "path": "deployment/kubernetes/aws/proxy.yaml", "diffHunk": "@@ -23,10 +23,11 @@ metadata:\n   name: pulsar-proxy-config\n data:\n   PULSAR_MEM: \"\\\" -Xms4g -Xmx4g -XX:MaxDirectMemorySize=4g\\\"\"\n-  PULSAR_PREFIX_brokerServiceURL: pulsar://broker:6650\n-  PULSAR_PREFIX_brokerWebServiceURL: http://broker:8080\n-  PULSAR_PREFIX_clusterName: pulsar-eks\n-\n+  brokerServiceURL: pulsar://broker:6650\n+  brokerWebServiceURL: http://broker:8080\n+  clusterName: us-east\n+  zookeeperServers: zk-0.zookeeper,zk-1.zookeeper,zk-2.zookeeper", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e3d5a3f6d8a7acd9354a9b1bf0a036c61bbc1f4"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDU0OTY3", "url": "https://github.com/apache/pulsar/pull/6192#pullrequestreview-352454967", "createdAt": "2020-02-03T18:10:11Z", "commit": {"oid": "4e3d5a3f6d8a7acd9354a9b1bf0a036c61bbc1f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODoxMDoxMVrOFk6y1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODoxMDoxMVrOFk6y1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI1NjM0Mg==", "bodyText": "You should also take out the garbage collector settings and put them into BOOKIE_GC. You would also need to add bin/apply-config-from-env.py conf/bkenv.sh && in the command section if you want these changes to take effect.", "url": "https://github.com/apache/pulsar/pull/6192#discussion_r374256342", "createdAt": "2020-02-03T18:10:11Z", "author": {"login": "roman-popenov"}, "path": "deployment/kubernetes/aws/bookkeeper.yaml", "diffHunk": "@@ -55,13 +53,14 @@ metadata:\n   name: bookie-config\n data:\n   PULSAR_MEM: \"\\\"-Dio.netty.leakDetectionLevel=disabled -Dio.netty.recycler.linkCapacity=1024 -XX:+UseG1GC -XX:MaxGCPauseMillis=10 -XX:+ParallelRefProcEnabled -XX:+UnlockExperimentalVMOptions -XX:+AggressiveOpts -XX:+DoEscapeAnalysis -XX:ParallelGCThreads=32 -XX:ConcGCThreads=32 -XX:G1NewSizePercent=50 -XX:+DisableExplicitGC -XX:-ResizePLAB -XX:+ExitOnOutOfMemoryError -XX:+PerfDisableSharedMem -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest -Xms28g -Xmx28g -XX:MaxDirectMemorySize=28g\\\"\"\n-  PULSAR_PREFIX_dbStorage_writeCacheMaxSizeMb: \"2048\" # Write cache size (direct memory)\n-  PULSAR_PREFIX_dbStorage_readAheadCacheMaxSizeMb: \"2048\" # Read cache size (direct memory)\n-  PULSAR_PREFIX_dbStorage_rocksDB_blockCacheSize: \"4294967296\"\n-  PULSAR_PREFIX_journalMaxSizeMB: \"2048\"\n-  PULSAR_PREFIX_zkServers: zk-0.zookeeper,zk-1.zookeeper,zk-2.zookeeper\n-  PULSAR_PREFIX_statsProviderClass: org.apache.bookkeeper.stats.prometheus.PrometheusMetricsProvider\n-  PULSAR_PREFIX_useHostNameAsBookieID: \"true\"\n+  BOOKIE_MEM: \"\\\"-Dio.netty.leakDetectionLevel=disabled -Dio.netty.recycler.linkCapacity=1024 -XX:+UseG1GC -XX:MaxGCPauseMillis=10 -XX:+ParallelRefProcEnabled -XX:+UnlockExperimentalVMOptions -XX:+AggressiveOpts -XX:+DoEscapeAnalysis -XX:ParallelGCThreads=32 -XX:ConcGCThreads=32 -XX:G1NewSizePercent=50 -XX:+DisableExplicitGC -XX:-ResizePLAB -XX:+ExitOnOutOfMemoryError -XX:+PerfDisableSharedMem -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest -Xms28g -Xmx28g -XX:MaxDirectMemorySize=28g\\\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e3d5a3f6d8a7acd9354a9b1bf0a036c61bbc1f4"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e443182dfc9e2f770e9656899345969b9a9f6a13", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/e443182dfc9e2f770e9656899345969b9a9f6a13", "committedDate": "2020-02-05T11:45:23Z", "message": "use correct bookie env variables to set memory and gc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODY1Njc0", "url": "https://github.com/apache/pulsar/pull/6192#pullrequestreview-354865674", "createdAt": "2020-02-07T00:29:07Z", "commit": {"oid": "e443182dfc9e2f770e9656899345969b9a9f6a13"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1374, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}