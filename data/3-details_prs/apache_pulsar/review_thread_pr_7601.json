{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyNzgyMjU2", "number": 7601, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoyMDo0MlrOEQTD7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzo1NToxMlrOEQT1ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTI0OTczOnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoyMDo0MlrOG0X4GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzo1MzoxNlrOG0ZBnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDMyOA==", "bodyText": "I think the url path would be more clean if it is /cluster/leader/ready.  We can add more API under \"/leader\" in future", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457570328", "createdAt": "2020-07-20T17:20:42Z", "author": {"login": "jerrypeng"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leaderready\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f84d5b1780533c74e5a42da511c03880b728980"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDcyMA==", "bodyText": "Beside we already have have the url path \"/cluster/leader\"", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457570720", "createdAt": "2020-07-20T17:21:22Z", "author": {"login": "jerrypeng"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leaderready\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDMyOA=="}, "originalCommit": {"oid": "8f84d5b1780533c74e5a42da511c03880b728980"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU4OTE1MQ==", "bodyText": "Changed", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457589151", "createdAt": "2020-07-20T17:53:16Z", "author": {"login": "srkukarni"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leaderready\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDMyOA=="}, "originalCommit": {"oid": "8f84d5b1780533c74e5a42da511c03880b728980"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTM3Njc0OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzo1NToxM1rOG0ZGMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxODowODozNlrOG0ZjbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MDMyMg==", "bodyText": "I think it is more appropriate to just return 200 for OK or 503 (service not available).  That is more idiomatic for HTTP REST calls", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457590322", "createdAt": "2020-07-20T17:55:13Z", "author": {"login": "jerrypeng"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leader/ready\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public String isLeaderReady() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82572742f80133cf520398f18418211664fe7cd3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MTMwOA==", "bodyText": "Something like\nhttps://github.com/apache/pulsar/blob/master/pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/WorkerReadinessResource.java#L65", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457591308", "createdAt": "2020-07-20T17:56:55Z", "author": {"login": "jerrypeng"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leader/ready\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public String isLeaderReady() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MDMyMg=="}, "originalCommit": {"oid": "82572742f80133cf520398f18418211664fe7cd3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5NzgwNQ==", "bodyText": "Changed", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457597805", "createdAt": "2020-07-20T18:08:36Z", "author": {"login": "srkukarni"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leader/ready\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public String isLeaderReady() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MDMyMg=="}, "originalCommit": {"oid": "82572742f80133cf520398f18418211664fe7cd3"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2302, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}