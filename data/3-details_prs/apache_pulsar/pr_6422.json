{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5OTM1MTg5", "number": 6422, "title": "[Issue 6283][tiered-storage] Offload policies per namespace", "bodyText": "Fixes #6283\nModifications\nDefine and use custom deletionLag and threshold for offloadpolicies per ns.\nAll is stuff is required for #6354.\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\nThis change is already covered by existing tests, such as .\nDoes this pull request potentially affect one of the following parts:\n\nThe public API: yes, new fields to add to offloadpolicies\nThe admin cli options: yes, new fields to add to offloadpolicies\n\nDocumentation\n\nDoes this pull request introduce a new feature? yes\nIf yes, how is the feature documented? not documented", "createdAt": "2020-02-26T01:14:28Z", "url": "https://github.com/apache/pulsar/pull/6422", "merged": true, "mergeCommit": {"oid": "347d3851b6e62be99b0953a21d8c1a6d502ae111"}, "closed": true, "closedAt": "2020-03-28T10:35:54Z", "author": {"login": "KannarFr"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIE7c5ABqjMwNzMyNjE1MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSC16cgFqTM4MzMwMTg3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "acb38ef2a0fb0c3078effc6b3013f8348e0e196e", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/acb38ef2a0fb0c3078effc6b3013f8348e0e196e", "committedDate": "2020-02-26T10:53:21Z", "message": "make tests use offloadpolicies"}, "afterCommit": {"oid": "4adb758864f03baa5d73193ec5931384b95598b7", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/4adb758864f03baa5d73193ec5931384b95598b7", "committedDate": "2020-02-26T11:21:53Z", "message": "make tests use offloadpolicies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODE1Mzgy", "url": "https://github.com/apache/pulsar/pull/6422#pullrequestreview-370815382", "createdAt": "2020-03-08T09:11:32Z", "commit": {"oid": "0038227fba13108bd3eafb1a2c998833d2072262"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwOToxMTozMlrOFzUDvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwOToxMTozMlrOFzUDvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1MDMzMw==", "bodyText": "Can we delete offloadAutoTriggerSizeThresholdBytes and offloadLedgerDeletionLagMs in  ManagedLedgerConfig? since there is OffloadPolicies in LedgerOffloader.", "url": "https://github.com/apache/pulsar/pull/6422#discussion_r389350333", "createdAt": "2020-03-08T09:11:32Z", "author": {"login": "codelipenghui"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "diffHunk": "@@ -1869,6 +1876,10 @@ private void maybeOffload(CompletableFuture<PositionImpl> finalPromise) {\n                 });\n \n             long threshold = config.getOffloadAutoTriggerSizeThresholdBytes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0038227fba13108bd3eafb1a2c998833d2072262"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33f1c2fb1a22e093bd64245e91a6b4e09cd95c0a", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/33f1c2fb1a22e093bd64245e91a6b4e09cd95c0a", "committedDate": "2020-03-12T12:33:58Z", "message": "fix inconsistency"}, "afterCommit": {"oid": "c5370804c1e83aaece0de2c4d3b1a17158c6769b", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/c5370804c1e83aaece0de2c4d3b1a17158c6769b", "committedDate": "2020-03-12T12:36:18Z", "message": "fix inconsistency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTIwMzYz", "url": "https://github.com/apache/pulsar/pull/6422#pullrequestreview-373520363", "createdAt": "2020-03-12T12:42:30Z", "commit": {"oid": "c5370804c1e83aaece0de2c4d3b1a17158c6769b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5814fa2d274e7229ef3dcfb6dd50f3bce0c2b42a", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/5814fa2d274e7229ef3dcfb6dd50f3bce0c2b42a", "committedDate": "2020-03-12T16:44:19Z", "message": "wip: try get ledgeroffloader with offloadpolicies"}, "afterCommit": {"oid": "099c42d245015dc9d66d3c3cbb7d3c512ab1ed46", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/099c42d245015dc9d66d3c3cbb7d3c512ab1ed46", "committedDate": "2020-03-17T12:10:56Z", "message": "fix tests using mock"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "099c42d245015dc9d66d3c3cbb7d3c512ab1ed46", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/099c42d245015dc9d66d3c3cbb7d3c512ab1ed46", "committedDate": "2020-03-17T12:10:56Z", "message": "fix tests using mock"}, "afterCommit": {"oid": "198338e16ca1ee3550716382176b377a97b92d1d", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/198338e16ca1ee3550716382176b377a97b92d1d", "committedDate": "2020-03-17T12:15:03Z", "message": "fix tests using mock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8325aac321dad34e5d54b2471be3d681a833bdd", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/d8325aac321dad34e5d54b2471be3d681a833bdd", "committedDate": "2020-03-17T12:31:14Z", "message": "introduce new properties to offloadpolicies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e563b0494c922508f140b7242336b191f7866729", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/e563b0494c922508f140b7242336b191f7866729", "committedDate": "2020-03-17T12:31:14Z", "message": "add offload_policies deletion lag/threshold cmds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aa73e586a89f4f69265755a16d2b7bafd40b6c4", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/2aa73e586a89f4f69265755a16d2b7bafd40b6c4", "committedDate": "2020-03-17T12:31:14Z", "message": "test: add deletion_lag/threshold to offload policies cmds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fec04cbd894390b3d48fa37ab256114011ef0d8", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/3fec04cbd894390b3d48fa37ab256114011ef0d8", "committedDate": "2020-03-17T12:31:14Z", "message": "get offload_policies when they exist"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2256dde065254c68c5578d58c779316ee2b841f5", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/2256dde065254c68c5578d58c779316ee2b841f5", "committedDate": "2020-03-17T12:31:14Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5726d333f91f282f46a123a8ec0c08d0fac28ebf", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/5726d333f91f282f46a123a8ec0c08d0fac28ebf", "committedDate": "2020-03-17T12:31:14Z", "message": "add offload test that use offloadpolicies over ns default config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9c7fda6aba97bcb8e4f1d746c8ef6a85a355ebb", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/b9c7fda6aba97bcb8e4f1d746c8ef6a85a355ebb", "committedDate": "2020-03-17T12:31:14Z", "message": "add deletion_lag/threshold to doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7af53e2dfdd3a886dff9ce163bee8b96aa0d18d1", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/7af53e2dfdd3a886dff9ce163bee8b96aa0d18d1", "committedDate": "2020-03-17T12:31:14Z", "message": "merge threshold/deletion_lag to use offloadpolicies when they exist"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11c9cc3ee5ca66653b8bf53e8a08df9e756866ec", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/11c9cc3ee5ca66653b8bf53e8a08df9e756866ec", "committedDate": "2020-03-17T12:31:14Z", "message": "make tests use offloadpolicies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddd11fd331c2f67c57c854e2ea6cda4523c00433", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/ddd11fd331c2f67c57c854e2ea6cda4523c00433", "committedDate": "2020-03-17T12:31:14Z", "message": "typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ab465f7b4897e7e7d0fa75eaa05239331c6fc43", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/7ab465f7b4897e7e7d0fa75eaa05239331c6fc43", "committedDate": "2020-03-17T12:31:14Z", "message": "use offloadpolicies, remove offload ms/bytes from managedledgerconfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e16c766b6569bf88c3508a13a79d4d0865697c3", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/7e16c766b6569bf88c3508a13a79d4d0865697c3", "committedDate": "2020-03-17T12:31:14Z", "message": "fix inconsistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a60e8112a7471ba7d954122ac4423efb307e7c5a", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/a60e8112a7471ba7d954122ac4423efb307e7c5a", "committedDate": "2020-03-17T12:31:14Z", "message": "create default offloadpolicies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39e929e421e6ae919bba3e2c0f6b6bb068c76916", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/39e929e421e6ae919bba3e2c0f6b6bb068c76916", "committedDate": "2020-03-17T12:31:14Z", "message": "fix tests using mock"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "198338e16ca1ee3550716382176b377a97b92d1d", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/198338e16ca1ee3550716382176b377a97b92d1d", "committedDate": "2020-03-17T12:15:03Z", "message": "fix tests using mock"}, "afterCommit": {"oid": "39e929e421e6ae919bba3e2c0f6b6bb068c76916", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/39e929e421e6ae919bba3e2c0f6b6bb068c76916", "committedDate": "2020-03-17T12:31:14Z", "message": "fix tests using mock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffe29c30d8963850770f55db86bbcd9ea2f2a095", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/ffe29c30d8963850770f55db86bbcd9ea2f2a095", "committedDate": "2020-03-17T13:08:05Z", "message": "remove unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzAxODc5", "url": "https://github.com/apache/pulsar/pull/6422#pullrequestreview-383301879", "createdAt": "2020-03-28T10:35:25Z", "commit": {"oid": "ffe29c30d8963850770f55db86bbcd9ea2f2a095"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4947, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}