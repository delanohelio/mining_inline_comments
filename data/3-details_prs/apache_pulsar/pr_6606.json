{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzOTEwMDUy", "number": 6606, "title": "Fix non-atomic volatile update", "bodyText": "", "createdAt": "2020-03-26T01:41:53Z", "url": "https://github.com/apache/pulsar/pull/6606", "merged": true, "mergeCommit": {"oid": "d298c8b3bfe42643d2e6b5f0ba0b606bf4a1294d"}, "closed": true, "closedAt": "2020-03-26T18:17:42Z", "author": {"login": "yjshen"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRRy93gH2gAyMzkzOTEwMDUyOjRiYTE2YWEzNGFhM2IyMTQzOWMzMDgwNzYxYzFhNDNjYWRmMmEyOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVrnb2gFqTM5MDE5NjczMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ba16aa34aa3b21439c3080761c1a43cadf2a29f", "author": {"user": {"login": "yjshen", "name": "Yijie Shen"}}, "url": "https://github.com/apache/pulsar/commit/4ba16aa34aa3b21439c3080761c1a43cadf2a29f", "committedDate": "2020-03-26T01:26:51Z", "message": "fix non-atomic update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acfae2d3542b63b217344efeca58c3e8af681387", "author": {"user": {"login": "yjshen", "name": "Yijie Shen"}}, "url": "https://github.com/apache/pulsar/commit/acfae2d3542b63b217344efeca58c3e8af681387", "committedDate": "2020-03-26T01:37:00Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87bc3619121df2ab9d004eead544162d03a04633", "author": {"user": {"login": "yjshen", "name": "Yijie Shen"}}, "url": "https://github.com/apache/pulsar/commit/87bc3619121df2ab9d004eead544162d03a04633", "committedDate": "2020-03-26T01:40:00Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNzA3MDkx", "url": "https://github.com/apache/pulsar/pull/6606#pullrequestreview-381707091", "createdAt": "2020-03-26T05:14:05Z", "commit": {"oid": "87bc3619121df2ab9d004eead544162d03a04633"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43699877ef70fab10132fca7cfbd35c210dfb318", "author": {"user": {"login": "yjshen", "name": "Yijie Shen"}}, "url": "https://github.com/apache/pulsar/commit/43699877ef70fab10132fca7cfbd35c210dfb318", "committedDate": "2020-03-26T07:35:43Z", "message": "fix seq"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTk1OTQw", "url": "https://github.com/apache/pulsar/pull/6606#pullrequestreview-390195940", "createdAt": "2020-04-08T17:46:22Z", "commit": {"oid": "43699877ef70fab10132fca7cfbd35c210dfb318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzo0NjoyMlrOGC6J8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzo0NjoyMlrOGC6J8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwMzE1NQ==", "bodyText": "This is already protected by a write lock. No need to use updater. The volatile is only used to ensure readers are reading the last value of the size.", "url": "https://github.com/apache/pulsar/pull/6606#discussion_r405703155", "createdAt": "2020-04-08T17:46:22Z", "author": {"login": "merlimat"}, "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/GrowablePriorityLongPairQueue.java", "diffHunk": "@@ -204,7 +207,7 @@ private LongPair removeAtWithoutLock(int index) {\n             LongPair item = new LongPair(data[index], data[index + 1]);\n             data[index] = EmptyItem;\n             data[index + 1] = EmptyItem;\n-            --this.size;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43699877ef70fab10132fca7cfbd35c210dfb318"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTk2NzMw", "url": "https://github.com/apache/pulsar/pull/6606#pullrequestreview-390196730", "createdAt": "2020-04-08T17:47:29Z", "commit": {"oid": "43699877ef70fab10132fca7cfbd35c210dfb318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzo0NzoyOVrOGC6MVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzo0NzoyOVrOGC6MVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwMzc2Nw==", "bodyText": "All operations on a connection are happening on same thread", "url": "https://github.com/apache/pulsar/pull/6606#discussion_r405703767", "createdAt": "2020-04-08T17:47:29Z", "author": {"login": "merlimat"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "diffHunk": "@@ -1759,7 +1762,7 @@ public boolean isWritable() {\n     }\n \n     public void startSendOperation(Producer producer, int msgSize) {\n-        messagePublishBufferSize += msgSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43699877ef70fab10132fca7cfbd35c210dfb318"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4864, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}