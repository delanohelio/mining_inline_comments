{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NTU3MDk1", "number": 6622, "title": "ISSUE-6612 FIX: parse long field in GenricJsonRecord (#6612)", "bodyText": "Fixes #6612\nMotivation\nIf message sent in json schema, long field will be decoded as int if its value below Integer.MAX_VALUE, other wise decoded as string.\nFor example, the json message below:\n{\n    \"timestamp\": 1585204833128\n}\nwill be decoded as\n{\n    \"timestamp\": \"1585204833128\"\n}\nModifications\nAdd field type check in GenericJsonRecord\nVerifying this change\n\n Make sure that the change passes the CI checks.\n Unit test added\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency):  no\nThe public API:  no\nThe schema: don't know\nThe default values of configurations: no\nThe wire protocol: no\nThe rest endpoints: no\nThe admin cli options: no\nAnything that affects deployment: no\n\nDocumentation\n\nDoes this pull request introduce a new feature? no", "createdAt": "2020-03-27T05:18:30Z", "url": "https://github.com/apache/pulsar/pull/6622", "merged": true, "mergeCommit": {"oid": "1aad3b73efe2a2afe0cd2598987f112416117159"}, "closed": true, "closedAt": "2020-04-05T19:17:13Z", "author": {"login": "lynnmatrix"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRtn3aAFqTM4MjcxMzM2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUvFUfgFqTM4Nzg1MTE5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNzEzMzY5", "url": "https://github.com/apache/pulsar/pull/6622#pullrequestreview-382713369", "createdAt": "2020-03-27T09:52:04Z", "commit": {"oid": "c6d75e6967755e2c71fcb5d13e55fbf56a008446"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDgxNDE2", "url": "https://github.com/apache/pulsar/pull/6622#pullrequestreview-383481416", "createdAt": "2020-03-30T01:08:02Z", "commit": {"oid": "c6d75e6967755e2c71fcb5d13e55fbf56a008446"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjA4NDc4", "url": "https://github.com/apache/pulsar/pull/6622#pullrequestreview-384208478", "createdAt": "2020-03-30T20:33:46Z", "commit": {"oid": "c6d75e6967755e2c71fcb5d13e55fbf56a008446"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMDozMzo0NlrOF97IhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMDozMzo0NlrOF97IhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjI5Mg==", "bodyText": "I think the integration tests failed due to this change.\nI think we should keep the original behavior and add the following\nelse if (fn.isLong()) {\n    return fn.asLong();\n} else if (fn.isNumber()) {\n    return fn.numberValue();\n}", "url": "https://github.com/apache/pulsar/pull/6622#discussion_r400476292", "createdAt": "2020-03-30T20:33:46Z", "author": {"login": "sijie"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonRecord.java", "diffHunk": "@@ -55,12 +55,8 @@ public Object getField(String fieldName) {\n             return new GenericJsonRecord(schemaVersion, fields, fn);\n         } else if (fn.isBoolean()) {\n             return fn.asBoolean();\n-        } else if (fn.isInt()) {\n-            return fn.asInt();\n-        } else if (fn.isFloatingPointNumber()) {\n-            return fn.asDouble();\n-        } else if (fn.isDouble()) {\n-            return fn.asDouble();\n+        } else if (fn.isNumber()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d75e6967755e2c71fcb5d13e55fbf56a008446"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDQ1MzE2", "url": "https://github.com/apache/pulsar/pull/6622#pullrequestreview-386045316", "createdAt": "2020-04-02T00:56:33Z", "commit": {"oid": "c6d75e6967755e2c71fcb5d13e55fbf56a008446"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9f57f03a383aac402afccb0fe987f277db00c1b", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/f9f57f03a383aac402afccb0fe987f277db00c1b", "committedDate": "2020-04-02T18:41:24Z", "message": "TMP: test ci"}, "afterCommit": {"oid": "26cd98edfe76d9d19f29ef47bc004290f54e3799", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/26cd98edfe76d9d19f29ef47bc004290f54e3799", "committedDate": "2020-04-03T01:08:50Z", "message": "TMP: test ci"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26cd98edfe76d9d19f29ef47bc004290f54e3799", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/26cd98edfe76d9d19f29ef47bc004290f54e3799", "committedDate": "2020-04-03T01:08:50Z", "message": "TMP: test ci"}, "afterCommit": {"oid": "03b803d192f7bfbd5d09c16b165ba95e1cf44bdb", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/03b803d192f7bfbd5d09c16b165ba95e1cf44bdb", "committedDate": "2020-04-03T16:07:46Z", "message": "TMP: test ci"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "03b803d192f7bfbd5d09c16b165ba95e1cf44bdb", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/03b803d192f7bfbd5d09c16b165ba95e1cf44bdb", "committedDate": "2020-04-03T16:07:46Z", "message": "TMP: test ci"}, "afterCommit": {"oid": "d4ee5a6b3938fd8a6f1aca795434591f36e16411", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/d4ee5a6b3938fd8a6f1aca795434591f36e16411", "committedDate": "2020-04-03T18:17:48Z", "message": "TMP: test ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77663acd0ce86251e76f665d278ec8c504c2436d", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/77663acd0ce86251e76f665d278ec8c504c2436d", "committedDate": "2020-04-04T08:07:35Z", "message": "FIX: parse long field in GenricJsonRecord (#6612)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "committedDate": "2020-04-04T08:07:35Z", "message": "Cast BigDecimal to double, BigInteger to long or text(#6612)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4ee5a6b3938fd8a6f1aca795434591f36e16411", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/d4ee5a6b3938fd8a6f1aca795434591f36e16411", "committedDate": "2020-04-03T18:17:48Z", "message": "TMP: test ci"}, "afterCommit": {"oid": "6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "author": {"user": {"login": "lynnmatrix", "name": "Lin Yiming"}}, "url": "https://github.com/apache/pulsar/commit/6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "committedDate": "2020-04-04T08:07:35Z", "message": "Cast BigDecimal to double, BigInteger to long or text(#6612)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODUxMTky", "url": "https://github.com/apache/pulsar/pull/6622#pullrequestreview-387851192", "createdAt": "2020-04-05T19:15:55Z", "commit": {"oid": "6905380c1ceccc1d26b1af1d5cd2e201ec5ec707"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4872, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}