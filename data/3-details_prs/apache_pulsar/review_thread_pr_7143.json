{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2NTUzMTA2", "number": 7143, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMToyNTozMFrOEDR0xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODo0NTowM1rOEDWgiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODczMjIxOnYy", "diffSide": "RIGHT", "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMToyNTozMFrOGgNHdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMTozMDo0N1rOGgNKXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyMjUxNg==", "bodyText": "overall looks good to me. I see there are two sets of settings here, one is for listeners and the other one is for interceptors? I think we should just rename the listener interfaces to Interceptors. So it is consistent with client-side interceptor.", "url": "https://github.com/apache/pulsar/pull/7143#discussion_r436422516", "createdAt": "2020-06-08T01:25:30Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "diffHunk": "@@ -1769,6 +1783,20 @@\n     )\n     private Set<String> brokerClientTlsProtocols = Sets.newTreeSet();\n \n+    /**** --- Interceptor variables --- ****/\n+\n+    @FieldContext(\n+        category = CATEGORY_INTERCEPTORS,\n+        doc = \"The directory to locate interceptors\"\n+    )\n+    private String interceptorDirectory = \"./interceptors\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89440cbf507e41b0c3f05e2d6fafca996fda39fd"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyMzI2MQ==", "bodyText": "Ok.", "url": "https://github.com/apache/pulsar/pull/7143#discussion_r436423261", "createdAt": "2020-06-08T01:30:47Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "diffHunk": "@@ -1769,6 +1783,20 @@\n     )\n     private Set<String> brokerClientTlsProtocols = Sets.newTreeSet();\n \n+    /**** --- Interceptor variables --- ****/\n+\n+    @FieldContext(\n+        category = CATEGORY_INTERCEPTORS,\n+        doc = \"The directory to locate interceptors\"\n+    )\n+    private String interceptorDirectory = \"./interceptors\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyMjUxNg=="}, "originalCommit": {"oid": "89440cbf507e41b0c3f05e2d6fafca996fda39fd"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxOTQ5OTYzOnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODo0NTowM1rOGgUa2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMDowOToxN1rOGgXTkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU0MjE2OQ==", "bodyText": "We should support multiple broker interceptors.  Can you add a broker interceptor implementation that wraps a list of interceptors into one interceptor?", "url": "https://github.com/apache/pulsar/pull/7143#discussion_r436542169", "createdAt": "2020-06-08T08:45:03Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "diffHunk": "@@ -450,7 +453,9 @@ public void start() throws PulsarServerException {\n \n             this.defaultOffloader = createManagedLedgerOffloader(\n                     OffloadPolicies.create(this.getConfiguration().getProperties()));\n-\n+            this.brokerInterceptor = BrokerInterceptors.load(config);\n+            brokerService.setInterceptor(getBrokerInterceptor());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0e776b48f8dcce4251f2da0a375a1afaef1df10"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU4OTQ1Ng==", "bodyText": "The current implementation is supporting multiple broker interceptors, I added BrokerInterceptors.java also implement BrokerInterceptor interface.", "url": "https://github.com/apache/pulsar/pull/7143#discussion_r436589456", "createdAt": "2020-06-08T10:09:17Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "diffHunk": "@@ -450,7 +453,9 @@ public void start() throws PulsarServerException {\n \n             this.defaultOffloader = createManagedLedgerOffloader(\n                     OffloadPolicies.create(this.getConfiguration().getProperties()));\n-\n+            this.brokerInterceptor = BrokerInterceptors.load(config);\n+            brokerService.setInterceptor(getBrokerInterceptor());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU0MjE2OQ=="}, "originalCommit": {"oid": "d0e776b48f8dcce4251f2da0a375a1afaef1df10"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1709, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}