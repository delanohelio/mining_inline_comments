{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NzU5NTg1", "number": 7817, "title": "[ISSUE 7757] Support Persistence Policies on topic level", "bodyText": "Link #7757 and master issue #2688\nMotivation\nSupport set/get/remove persistence  policies on topic level.\nVerifying this change\nnew unit test added.", "createdAt": "2020-08-14T04:26:13Z", "url": "https://github.com/apache/pulsar/pull/7817", "merged": true, "mergeCommit": {"oid": "ff1780c0be9ca7b80d72b42faeee3f5b61f4c805"}, "closed": true, "closedAt": "2020-08-17T13:13:25Z", "author": {"login": "zhanghaou"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-r319AH2gAyNDY3NzU5NTg1OjdkZDllMGU3NjgyNmU4Y2RlNmNjNWY3NTM5NGEyZGUxZDc1NDcwZDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_yMNZAFqTQ2ODQ0ODc1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7dd9e0e76826e8cde6cc5f75394a2de1d75470d4", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/7dd9e0e76826e8cde6cc5f75394a2de1d75470d4", "committedDate": "2020-08-14T03:16:18Z", "message": "[ISSUE 7757] Support Persistence Policy on topic level."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c191054d1ab57ec3f52fbbce29d6a41e190f584c", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/c191054d1ab57ec3f52fbbce29d6a41e190f584c", "committedDate": "2020-08-14T04:06:27Z", "message": "Merge pull request #1 from apache/master\n\nmerge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f43c748a360d1582c6d8c2448c7481a0f21144b6", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/f43c748a360d1582c6d8c2448c7481a0f21144b6", "committedDate": "2020-08-14T04:13:21Z", "message": "Merge remote-tracking branch 'origin/master' into persistence-policies-on-topic-level\n\n# Conflicts:\n#\tpulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java\n#\tpulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/Topics.java\n#\tpulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NTY2NDY3", "url": "https://github.com/apache/pulsar/pull/7817#pullrequestreview-467566467", "createdAt": "2020-08-14T13:17:48Z", "commit": {"oid": "f43c748a360d1582c6d8c2448c7481a0f21144b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMzoxNzo0OFrOHA0OQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMzoxNzo0OFrOHA0OQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYxNzY2NA==", "bodyText": "minor: there is no need to use asyncResponse", "url": "https://github.com/apache/pulsar/pull/7817#discussion_r470617664", "createdAt": "2020-08-14T13:17:48Z", "author": {"login": "jianyun8023"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "diffHunk": "@@ -2294,6 +2295,48 @@ protected void internalGetRetention(AsyncResponse asyncResponse){\n         return pulsar().getTopicPoliciesService().updateTopicPoliciesAsync(topicName, topicPolicies.get());\n     }\n \n+    protected void internalGetPersistence(AsyncResponse asyncResponse){\n+        validateAdminAccessForTenant(namespaceName.getTenant());\n+        validatePoliciesReadOnlyAccess();\n+        if (topicName.isGlobal()) {\n+            validateGlobalNamespaceOwnership(namespaceName);\n+        }\n+        Optional<PersistencePolicies> retention = getTopicPolicies(topicName)\n+                .map(TopicPolicies::getPersistence);\n+        if (!retention.isPresent()) {\n+            asyncResponse.resume(Response.noContent().build());\n+        }else {\n+            asyncResponse.resume(retention.get());\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f43c748a360d1582c6d8c2448c7481a0f21144b6"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjM1Nzcx", "url": "https://github.com/apache/pulsar/pull/7817#pullrequestreview-467635771", "createdAt": "2020-08-14T14:45:31Z", "commit": {"oid": "f43c748a360d1582c6d8c2448c7481a0f21144b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4600c1fb57edf68c118428c8032318f3133d728b", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/4600c1fb57edf68c118428c8032318f3133d728b", "committedDate": "2020-08-15T06:45:16Z", "message": "Bug fix."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTY4NTIy", "url": "https://github.com/apache/pulsar/pull/7817#pullrequestreview-467968522", "createdAt": "2020-08-15T12:25:22Z", "commit": {"oid": "4600c1fb57edf68c118428c8032318f3133d728b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NDQ4NzU3", "url": "https://github.com/apache/pulsar/pull/7817#pullrequestreview-468448757", "createdAt": "2020-08-17T13:11:54Z", "commit": {"oid": "4600c1fb57edf68c118428c8032318f3133d728b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 272, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}