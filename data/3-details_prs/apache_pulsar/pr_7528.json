{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4Njg0OTY2", "number": 7528, "title": "Fix: function BC issue introduced in 2.6", "bodyText": "Motivation\nThere was a backwards compatibility breakage introduced in:\n#5985\nIf running function workers separately from brokers, updating workers and brokers independently from 2.5 to 2.6 will cause the following error:\njava.lang.NullPointerException: null\\n\\tat java.net.URI$Parser.parse(URI.java:3104) ~[?:?]\\n\\tat java.net.URI.<init>(URI.java:600) ~[?:?]\\n\\tat java.net.URI.create(URI.java:881) ~[?:?]\\n\\tat org.apache.pulsar.functions.worker.WorkerUtils.initializeDlogNamespace(WorkerUtils.java:160) ~[org.apache.pulsar-pulsar-functions-worker-2.7.0-SNAPSHOT.jar:2.7.0-SNAPSHOT]\\n\\tat org.apache.pulsar.functions.worker.Worker.initialize(Worker.java:155) ~[org.apache.pulsar-pulsar-functions-worker-2.7.0-SNAPSHOT.jar:2.7.0-SNAPSHOT]\\n\\tat org.apache.pulsar.functions.worker.Worker.start(Worker.java:69) ~[org.apache.pulsar-pulsar-functions-worker-2.7.0-SNAPSHOT.jar:2.7.0-SNAPSHOT]\\n\\tat org.apache.pulsar.functions.worker.FunctionWorkerStarter.main(FunctionWorkerStarter.java:67) [org.apache.pulsar-pulsar-functions-worker-2.7.0-SNAPSHOT.jar:2.7.0-SNAPSHOT]\\n\nThis is because a 2.5 broker will response will have \"bookkeeperMetadataServiceUri\" and the admin client will return the field as null:\nInternalConfigurationData{zookeeperServers=zookeeper-dev-0.zookeeper-dev:2181,zookeeper-dev-1.zookeeper-dev:2181,zookeeper-dev-2.zookeeper-dev:2181, configurationStoreServers=zookeeper-dev-0.zookeeper-dev:2181,zookeeper-dev-1.zookeeper-dev:2181,zookeeper-dev-2.zookeeper-dev:2181, ledgersRootPath=/ledgers, bookkeeperMetadataServiceUri=null, stateStorageServiceUrl=null}\nThus causing the NPE.\nWill also need a fix on the broker side for if broker was updated to 2.6 before the worker is.", "createdAt": "2020-07-14T06:52:15Z", "url": "https://github.com/apache/pulsar/pull/7528", "merged": true, "mergeCommit": {"oid": "eef63deeeee897d67b2f3a781c4bbf8dbbe17683"}, "closed": true, "closedAt": "2020-07-14T21:02:30Z", "author": {"login": "jerrypeng"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0wSkQAH2gAyNDQ4Njg0OTY2Ojg2MTEyZmZhMTkwMTFjODE1YWEzNmU5Mzc4OGM2ZmFkYjA3YzJlNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc06hzzAFqTQ0ODM2ODk0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86112ffa19011c815aa36e93788c6fadb07c2e78", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/86112ffa19011c815aa36e93788c6fadb07c2e78", "committedDate": "2020-07-14T06:45:52Z", "message": "Fix: function BC issue introduced in 2.6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3ODM1OTk4", "url": "https://github.com/apache/pulsar/pull/7528#pullrequestreview-447835998", "createdAt": "2020-07-14T06:56:11Z", "commit": {"oid": "86112ffa19011c815aa36e93788c6fadb07c2e78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3ODQxOTQ5", "url": "https://github.com/apache/pulsar/pull/7528#pullrequestreview-447841949", "createdAt": "2020-07-14T07:06:48Z", "commit": {"oid": "86112ffa19011c815aa36e93788c6fadb07c2e78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d397193a4799a04991f26d0ecfea8d725cd99f5", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/3d397193a4799a04991f26d0ecfea8d725cd99f5", "committedDate": "2020-07-14T16:56:18Z", "message": "adding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adb131c99ff833a09aca6de030dda94b3d86f4f3", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/adb131c99ff833a09aca6de030dda94b3d86f4f3", "committedDate": "2020-07-14T17:02:55Z", "message": "fixing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzEwOTAz", "url": "https://github.com/apache/pulsar/pull/7528#pullrequestreview-448310903", "createdAt": "2020-07-14T17:22:03Z", "commit": {"oid": "adb131c99ff833a09aca6de030dda94b3d86f4f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzoyMjowNFrOGxdmEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzoyMjowNFrOGxdmEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxODI4OQ==", "bodyText": "System.exit() is not always guaranteed to take the process down (eg: hanging threads). Use Runtime.halt() instead", "url": "https://github.com/apache/pulsar/pull/7528#discussion_r454518289", "createdAt": "2020-07-14T17:22:04Z", "author": {"login": "merlimat"}, "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionWorkerStarter.java", "diffHunk": "@@ -66,11 +66,12 @@ public static void main(String[] args) throws Exception {\n         try {\n             worker.start();\n         } catch (Throwable th) {\n+            log.error(\"Encountered error in function worker.\", th);\n             worker.stop();\n             System.exit(-1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb131c99ff833a09aca6de030dda94b3d86f4f3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a831a1cc18fc9b5327feb8953c8d5593d21a12e1", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/a831a1cc18fc9b5327feb8953c8d5593d21a12e1", "committedDate": "2020-07-14T18:30:19Z", "message": "addressing comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzY4OTQw", "url": "https://github.com/apache/pulsar/pull/7528#pullrequestreview-448368940", "createdAt": "2020-07-14T18:41:34Z", "commit": {"oid": "a831a1cc18fc9b5327feb8953c8d5593d21a12e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 600, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}