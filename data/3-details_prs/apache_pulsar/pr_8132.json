{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTY3NjIy", "number": 8132, "title": "[component/functions|component/go] Propagate user-config parameter into instances of Golang pulsar functions", "bodyText": "Motivation\nCurrently, pulsar functions written in Golang have no access to the content of the user-config parameter from admin CLI.\nThat's the simplest way to pass custom configuration into a go function right now because neither secretsMap nor Kubernetes runtime is available for Golang functions yet.\nNote: For the secretsMap parameter, the same technique can be used, but this has to be addressed in a separate PR.\nModifications\n\nAdded String GoInstanceConfig#userConfig attribute\nPropagated user-config parameter in RuntimeUtils.getGoInstanceCmd\nExposed userConfig in pulsar-function-go and made it available in the FunctionContext\nAdd unit tests for the affected code\n\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\nThis change added tests and can be verified as follows:\n\nAdded unit tests for RuntimeUtils.getGoInstanceCmd in pulsar-functions\nAdded unit tests for instanceConf and FunctionContext in pulsar-function-go\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes)\n\nRun go mod tidy in pulsar-function-go.\n\n\nThe public API: (no)\nThe schema: (yes)\n\nNew attribute in GoInstanceConfig.java\n\n\nThe default values of configurations: (no)\nThe wire protocol: (no)\nThe rest endpoints: (no)\nAnything that affects deployment: (don't know)\n\nDocumentation\nThe respective documentation has to be updated: User Config#Go\nQuestion: Does it have to be done in the scope of current PR?", "createdAt": "2020-09-25T10:01:23Z", "url": "https://github.com/apache/pulsar/pull/8132", "merged": true, "mergeCommit": {"oid": "d6f18ab993a547539c402f8732b81e69dfee58c4"}, "closed": true, "closedAt": "2020-10-05T22:39:23Z", "author": {"login": "vaihtovirta"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdM9TWKAH2gAyNDkyOTY3NjIyOjhhMmUzNjE0ZWY0OThlODgyZTk5ZWM1NTNkNTRhNDhiYTJkZTM2ZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOn2rqAFqTUwMTI0MjkzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a2e3614ef498e882e99ec553d54a48ba2de36d1", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/8a2e3614ef498e882e99ec553d54a48ba2de36d1", "committedDate": "2020-09-27T11:29:40Z", "message": "feat(pulsar-functions): Add user-config support to Golang function instance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb8df8b0cd1ad7f48347a139e8c0517eb84ca967", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/eb8df8b0cd1ad7f48347a139e8c0517eb84ca967", "committedDate": "2020-09-27T11:29:40Z", "message": "feat(pulsar-function-go): Add userConfig field to function instance configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3240ad4bb20d205a49b0bed5af5cf3ba4608a271", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/3240ad4bb20d205a49b0bed5af5cf3ba4608a271", "committedDate": "2020-09-27T11:29:40Z", "message": "feat(pulsar-function-go): Expose user config in FunctionContext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b91888dbd525ac94729143d1a1f5a18d11523b7", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/0b91888dbd525ac94729143d1a1f5a18d11523b7", "committedDate": "2020-09-27T11:29:40Z", "message": "feat(pulsar-function-go): Run go mod tidy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "354ed6af698087e58d7b0a25bd2fed4e84fa2656", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/354ed6af698087e58d7b0a25bd2fed4e84fa2656", "committedDate": "2020-09-25T08:58:22Z", "message": "feat(pulsar-function-go): Run go mod tidy"}, "afterCommit": {"oid": "0b91888dbd525ac94729143d1a1f5a18d11523b7", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/0b91888dbd525ac94729143d1a1f5a18d11523b7", "committedDate": "2020-09-27T11:29:40Z", "message": "feat(pulsar-function-go): Run go mod tidy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMDMwMDkx", "url": "https://github.com/apache/pulsar/pull/8132#pullrequestreview-500030091", "createdAt": "2020-10-01T06:05:20Z", "commit": {"oid": "0b91888dbd525ac94729143d1a1f5a18d11523b7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjowNToyMFrOHa7n3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjowNTozMVrOHa7oLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMTg4Nw==", "bodyText": "Why do you change the SchemaType to an empty string?", "url": "https://github.com/apache/pulsar/pull/8132#discussion_r498001887", "createdAt": "2020-10-01T06:05:20Z", "author": {"login": "sijie"}, "path": "pulsar-function-go/pf/instanceConf.go", "diffHunk": "@@ -72,8 +73,8 @@ func newInstanceConf() *instanceConf {\n \t\t\t\tSubscriptionType: pb.SubscriptionType(cfg.SubscriptionType),\n \t\t\t\tInputSpecs: map[string]*pb.ConsumerSpec{\n \t\t\t\t\tcfg.SourceSpecTopic: {\n-\t\t\t\t\t\tSchemaType:     cfg.SourceSchemaType,\n-\t\t\t\t\t\tIsRegexPattern: cfg.IsRegexPatternSubscription,\n+\t\t\t\t\t\tSchemaType:     \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b91888dbd525ac94729143d1a1f5a18d11523b7"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMTk2NA==", "bodyText": "Why do you change this to false?", "url": "https://github.com/apache/pulsar/pull/8132#discussion_r498001964", "createdAt": "2020-10-01T06:05:31Z", "author": {"login": "sijie"}, "path": "pulsar-function-go/pf/instanceConf.go", "diffHunk": "@@ -72,8 +73,8 @@ func newInstanceConf() *instanceConf {\n \t\t\t\tSubscriptionType: pb.SubscriptionType(cfg.SubscriptionType),\n \t\t\t\tInputSpecs: map[string]*pb.ConsumerSpec{\n \t\t\t\t\tcfg.SourceSpecTopic: {\n-\t\t\t\t\t\tSchemaType:     cfg.SourceSchemaType,\n-\t\t\t\t\t\tIsRegexPattern: cfg.IsRegexPatternSubscription,\n+\t\t\t\t\t\tSchemaType:     \"\",\n+\t\t\t\t\t\tIsRegexPattern: false,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b91888dbd525ac94729143d1a1f5a18d11523b7"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69f9873b09cbdea11d838bec38e34a2d2bf481f9", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/69f9873b09cbdea11d838bec38e34a2d2bf481f9", "committedDate": "2020-10-01T07:46:43Z", "message": "feat(pulsar-function-go): Revert incorrectly changed values in instanceConf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjQyOTM0", "url": "https://github.com/apache/pulsar/pull/8132#pullrequestreview-501242934", "createdAt": "2020-10-02T15:38:12Z", "commit": {"oid": "69f9873b09cbdea11d838bec38e34a2d2bf481f9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 114, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}