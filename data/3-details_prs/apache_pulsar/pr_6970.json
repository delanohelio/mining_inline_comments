{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjYyMDc2", "number": 6970, "title": "Add a pulsar perf document and performance section", "bodyText": "(If this PR fixes a github issue, please add Fixes #<xyz>.)\nFixes #\n(or if this PR is one task of a github issue, please add Master Issue: #<xyz> to link to the master issue.)\nMaster Issue: #\nMotivation\nExplain here the context, and why you're making that change. What is the problem you're trying to solve.\nModifications\nDescribe the modifications you've done.\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\n(Please pick either of the following options)\nThis change is a trivial rework / code cleanup without any test coverage.\n(or)\nThis change is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end deployment with large payloads (10MB)\nExtended integration test for recovery after broker failure\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes)\nIf yes, how is the feature documented? ( docs)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-05-15T15:38:27Z", "url": "https://github.com/apache/pulsar/pull/6970", "merged": true, "mergeCommit": {"oid": "1a46666e90883ae63cd8396bcb8c4611e2c35108"}, "closed": true, "closedAt": "2020-05-18T21:12:48Z", "author": {"login": "Huanli-Meng"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchj690AH2gAyNDE4NjYyMDc2OjYxMWYyOTg5ZDkyYTNmOTk3YmI5YTc3MmE4ZTc4MTg3YzliYTZkMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcimhS4AFqTQxMzk0MjQ0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "611f2989d92a3f997bb9a772a8e78187c9ba6d16", "author": {"user": {"login": "Huanli-Meng", "name": "Huanli Meng"}}, "url": "https://github.com/apache/pulsar/commit/611f2989d92a3f997bb9a772a8e78187c9ba6d16", "committedDate": "2020-05-15T15:36:40Z", "message": "Add a pulsar perf document and performance section"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDE3NTk0", "url": "https://github.com/apache/pulsar/pull/6970#pullrequestreview-413017594", "createdAt": "2020-05-15T23:29:53Z", "commit": {"oid": "611f2989d92a3f997bb9a772a8e78187c9ba6d16"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMzoyOTo1NFrOGWWUgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMzoyOTo1NFrOGWWUgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA4NzU1Mw==", "bodyText": "Install through maven", "url": "https://github.com/apache/pulsar/pull/6970#discussion_r426087553", "createdAt": "2020-05-15T23:29:54Z", "author": {"login": "codelipenghui"}, "path": "site2/docs/performance-pulsar-perf.md", "diffHunk": "@@ -0,0 +1,181 @@\n+---\n+id: performance-pulsar-perf\n+title: Pulsar Perf\n+sidebar_label: Pulsar Perf\n+---\n+\n+This document describes how to use the Pulsar Perf for performance testing. For detailed information about performance tuning, see [here](https://streamnative.io/whitepaper/taking-a-deep-dive-into-apache-pulsar-architecture-for-performance-tuning/).\n+\n+## Pulsar Perf\n+\n+The Pulsar Perf is a built-in performance test tool for Apache Pulsar. You can use the Pulsar Perf to test message writing or reading performance.\n+\n+### Produce messages\n+\n+This example shows how the Pulsar Perf produces messages with default options. For all configuration options available for the `pulsar-perf produce` command, see [configuration options](#configuration-options-for-pulsar-perf-produce).\n+\n+```\n+bin/pulsar-perf produce my-topic\n+```\n+\n+After the command is executed, the test data is continuously output on the Console.\n+\n+**Output**\n+\n+```\n+19:53:31.459 [pulsar-perf-producer-exec-1-1] INFO  org.apache.pulsar.testclient.PerformanceProducer - Created 1 producers\n+19:53:31.482 [pulsar-timer-5-1] WARN  com.scurrilous.circe.checksum.Crc32cIntChecksum - Failed to load Circe JNI library. Falling back to Java based CRC32c provider\n+19:53:40.861 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:     93.7  msg/s ---      0.7 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   3.575 ms - med:   3.460 - 95pct:   4.790 - 99pct:   5.308 - 99.9pct:   5.834 - 99.99pct:   6.609 - Max:   6.609\n+19:53:50.909 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:    100.0  msg/s ---      0.8 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   3.437 ms - med:   3.328 - 95pct:   4.656 - 99pct:   5.071 - 99.9pct:   5.519 - 99.99pct:   5.588 - Max:   5.588\n+19:54:00.926 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:    100.0  msg/s ---      0.8 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   3.376 ms - med:   3.276 - 95pct:   4.520 - 99pct:   4.939 - 99.9pct:   5.440 - 99.99pct:   5.490 - Max:   5.490\n+19:54:10.940 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:    100.0  msg/s ---      0.8 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   3.298 ms - med:   3.220 - 95pct:   4.474 - 99pct:   4.926 - 99.9pct:   5.645 - 99.99pct:   5.654 - Max:   5.654\n+19:54:20.956 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:    100.1  msg/s ---      0.8 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   3.308 ms - med:   3.199 - 95pct:   4.532 - 99pct:   4.871 - 99.9pct:   5.291 - 99.99pct:   5.323 - Max:   5.323\n+19:54:30.972 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:    100.0  msg/s ---      0.8 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   3.249 ms - med:   3.144 - 95pct:   4.437 - 99pct:   4.970 - 99.9pct:   5.329 - 99.99pct:   5.414 - Max:   5.414\n+19:54:40.987 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:    100.0  msg/s ---      0.8 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   3.435 ms - med:   3.361 - 95pct:   4.772 - 99pct:   5.150 - 99.9pct:   5.373 - 99.99pct:   5.837 - Max:   5.837\n+^C19:54:44.325 [Thread-1] INFO  org.apache.pulsar.testclient.PerformanceProducer - Aggregated throughput stats --- 7286 records sent --- 99.140 msg/s --- 0.775 Mbit/s\n+19:54:44.336 [Thread-1] INFO  org.apache.pulsar.testclient.PerformanceProducer - Aggregated latency stats --- Latency: mean:   3.383 ms - med:   3.293 - 95pct:   4.610 - 99pct:   5.059 - 99.9pct:   5.588 - 99.99pct:   5.837 - 99.999pct:   6.609 - Max:   6.609\n+```\n+\n+From the above test data, you can get the throughput statistics and the write latency statistics. The aggregated statistics is printed when the Pulsar Perf is stopped. You can press **Ctrl**+**C** to stop the Pulsar Perf. After the Pulsar Perf is stopped, the [HdrHistogram](http://hdrhistogram.github.io/HdrHistogram/) formatted test result appears under your directory. The document looks like `perf-producer-1589370810837.hgrm`. You can also check the test result through [HdrHistogram Plotter](https://hdrhistogram.github.io/HdrHistogram/plotFiles.html). For details about how to check the test result through [HdrHistogram Plotter](https://hdrhistogram.github.io/HdrHistogram/plotFiles.html), see [HdrHistogram Plotter](#hdrhistogram-plotter).\n+\n+#### Configuration options for `pulsar-perf produce`\n+\n+You can get all options by executing the `bin/pulsar-perf produce -h` command. Therefore, you can modify these options as required.\n+\n+The following table lists configuration options available for the `pulsar-perf produce` command.\n+\n+| Option | Description | Default value|\n+|----|----|----|\n+| auth-params | Set the authentication parameters, whose format is determined by the implementation of the `configure` method in the authentication plugin class, such as \"key1:val1,key2:val2\" or \"{\"key1\":\"val1\",\"key2\":\"val2\"}\". | N/A |\n+| auth_plugin | Set the authentication plugin class name. | N/A |\n+| batch-max-bytes | Set the maximum number of bytes for each batch. | 4194304 |\n+| batch-max-messages | Set the maximum number of messages for each batch. | 1000 |\n+| batch-time-window | Set a window for a batch of messages. | 1 ms |\n+| compression | Compress the message payload. | N/A |\n+| conf-file | Set the configuration file. | N/A |\n+| delay | Mark messages with a given delay. | 0s |\n+| encryption-key-name | Set the name of the public key used to encrypt the payload. | N/A |\n+| encryption-key-value-file | Set the file which contains the public key used to encrypt the payload. | N/A |\n+| exit-on-failure | Configure whether to exit from the process on publish failure. | false |\n+| help | Configure the help message. | false |\n+| max-connections | Set the maximum number of TCP connections to a single broker. | 100 |\n+| max-outstanding | Set the maximum number of outstanding messages. | 1000 |\n+| max-outstanding-across-partitions | Set the maximum number of outstanding messages across partitions. | 50000 |\n+| num-messages | Set the number of messages to be published in total. If it is set to 0, it keeps publishing messages. | 0 |\n+| num-producers | Set the number of producers for each topic. | 1 |\n+| num-test-threads |  Set the number of test threads. | 1 |\n+| num-topic | Set the number of topics. | 1 |\n+| payload-delimiter | Set the delimiter used to split lines when using payload from a file. | \\n |\n+| payload-file | Use the payload from an UTF-8 encoded text file and a payload is randomly selected when messages are published. | N/A |\n+| rate | Set the publish rate of messages across topics. | 100 |\n+| service-url | Set the Pulsar service URL. | |\n+| size | Set the message size. | 1024 bytes |\n+| stats-interval-seconds | Set the statistics interval. If it is set to 0, statistics is disabled. | 0 |\n+| test-duration | Set the test duration. If it is set to 0, it keeps publishing tests. | 0s |\n+| trust-cert-file | Set the path for the trusted TLS certificate file. | <empty string> |\n+| warmup-time | Set the warm-up time. | 1s |\n+\n+### Consume messages\n+\n+This example shows how the Pulsar Perf consumes messages with default options.\n+\n+```\n+bin/pulsar-perf consume my-topic\n+```\n+\n+After the command is executed, the test data is continuously output on the Console.\n+\n+**Output**\n+\n+```\n+20:35:37.071 [main] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Start receiving from 1 consumers on 1 topics\n+20:35:41.150 [pulsar-client-io-1-9] WARN  com.scurrilous.circe.checksum.Crc32cIntChecksum - Failed to load Circe JNI library. Falling back to Java based CRC32c provider\n+20:35:47.092 [main] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Throughput received: 59.572  msg/s -- 0.465 Mbit/s --- Latency: mean: 11.298 ms - med: 10 - 95pct: 15 - 99pct: 98 - 99.9pct: 137 - 99.99pct: 152 - Max: 152\n+20:35:57.104 [main] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Throughput received: 99.958  msg/s -- 0.781 Mbit/s --- Latency: mean: 9.176 ms - med: 9 - 95pct: 15 - 99pct: 16 - 99.9pct: 17 - 99.99pct: 18 - Max: 18\n+20:36:07.115 [main] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Throughput received: 100.006  msg/s -- 0.781 Mbit/s --- Latency: mean: 9.316 ms - med: 9 - 95pct: 15 - 99pct: 16 - 99.9pct: 17 - 99.99pct: 17 - Max: 17\n+20:36:17.125 [main] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Throughput received: 100.085  msg/s -- 0.782 Mbit/s --- Latency: mean: 9.327 ms - med: 9 - 95pct: 15 - 99pct: 16 - 99.9pct: 17 - 99.99pct: 17 - Max: 17\n+20:36:27.136 [main] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Throughput received: 99.900  msg/s -- 0.780 Mbit/s --- Latency: mean: 9.404 ms - med: 9 - 95pct: 15 - 99pct: 16 - 99.9pct: 17 - 99.99pct: 17 - Max: 17\n+20:36:37.147 [main] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Throughput received: 99.985  msg/s -- 0.781 Mbit/s --- Latency: mean: 8.998 ms - med: 9 - 95pct: 15 - 99pct: 16 - 99.9pct: 17 - 99.99pct: 17 - Max: 17\n+^C20:36:42.755 [Thread-1] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Aggregated throughput stats --- 6051 records received --- 92.125 msg/s --- 0.720 Mbit/s\n+20:36:42.759 [Thread-1] INFO  org.apache.pulsar.testclient.PerformanceConsumer - Aggregated latency stats --- Latency: mean: 9.422 ms - med: 9 - 95pct: 15 - 99pct: 16 - 99.9pct: 98 - 99.99pct: 137 - 99.999pct: 152 - Max: 152\n+```\n+\n+From the output test data, you can get the throughput statistics and the end-to-end latency statistics. The aggregated statistics is printed after the Pulsar Perf is stopped. You can press **Ctrl**+**C** to stop the Pulsar Perf.\n+\n+#### Configuration options for `pulsar-perf consume`\n+\n+You can get all options by executing the `bin/pulsar-perf consume -h` command. Therefore, you can modify these options as required.\n+\n+The following table lists configuration options available for the `pulsar-perf consume` command.\n+\n+| Option | Description | Default value |\n+|----|----|----|\n+| acks-delay-millis | Set the acknowledgment grouping delay in milliseconds. | 100 ms |\n+| auth-params | Set the authentication parameters, whose format is determined by the implementation of the `configure` method in the authentication plugin class, such as \"key1:val1,key2:val2\" or \"{\"key1\":\"val1\",\"key2\":\"val2\"}\". | N/A |\n+| auth_plugin | Set the authentication plugin class name. | N/A |\n+| conf-file | Set the configuration file. | N/A |\n+| encryption-key-name | Set the name of the public key used to encrypt the payload. | N/A |\n+| encryption-key-value-file | Set the file which contains the public key used to encrypt the payload. | N/A |\n+| help | Configure the help message. | false |\n+| max-connections | Set the maximum number of TCP connections to a single broker. | 100 |\n+| num-consumers | Set the number of consumers for each topic. | 1 |\n+| num-topic | Set the number of topics. | 1 |\n+| rate | Simulate a slow message consumer (rate in msg/s). | 0.0 |\n+| receiver-queue-size | Set the size of the receiver queue. | 1000 |\n+| replicated | Configure whether the subscription status should be replicated. | false |\n+| service-url | Set the Pulsar service URL. | |\n+| stats-interval-seconds | Set the statistics interval. If it is set to 0, statistics is disabled. | 0 |\n+| subscriber-name | Set the subscriber name prefix. | sub |\n+| subscription-type | Set the subscription type. <li> Exclusive <li> Shared <li> Failover <li> Key_Shared | Exclusive |\n+| trust-cert-file | Set the path for the trusted TLS certificate file. | <empty string> |\n+\n+### Configurations\n+\n+By default, the Pulsar Perf uses `conf/client.conf` as the default configuration and uses `conf/log4j2.yaml` as the default Log4j configuration. If you want to connect to other Pulsar clusters, you can update the `brokerServiceUrl` in the client configuration.\n+\n+You can use the following commands to change the configuration file and the Log4j configuration file.\n+\n+```\n+export PULSAR_CLIENT_CONF=<your-config-file>\n+export PULSAR_LOG_CONF=<your-log-config-file>\n+```\n+\n+In addition, you can use the following command to configure the JVM configuration through environment variables:\n+\n+```\n+export PULSAR_EXTRA_OPTS='-Xms4g -Xmx4g -XX:MaxDirectMemorySize=4g'\n+```\n+\n+## HdrHistogram Plotter\n+\n+The [HdrHistogram Plotter](https://hdrhistogram.github.io/HdrHistogram/plotFiles.html) is a visualization tool for checking Pulsar Perf test results, which makes it easier to observe the test results.\n+\n+To check test results through the HdrHistogram Plotter, follow these steps:\n+\n+1. Clone the HdrHistogram repository from GitHub to the local.\n+\n+    ```\n+    git clone https://github.com/HdrHistogram/HdrHistogram.git\n+    ```\n+\n+2. Switch to the HdrHistogram folder.\n+\n+    ```\n+    cd HdrHistogram\n+    ```\n+3. Install DskipTests through Maven.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "611f2989d92a3f997bb9a772a8e78187c9ba6d16"}, "originalPosition": 166}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de2861afb1013604b9614ca79650b8cab640e12d", "author": {"user": {"login": "Huanli-Meng", "name": "Huanli Meng"}}, "url": "https://github.com/apache/pulsar/commit/de2861afb1013604b9614ca79650b8cab640e12d", "committedDate": "2020-05-18T06:12:35Z", "message": "Update the doc based on Penghui's comment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTQyNDQ0", "url": "https://github.com/apache/pulsar/pull/6970#pullrequestreview-413942444", "createdAt": "2020-05-18T21:12:16Z", "commit": {"oid": "de2861afb1013604b9614ca79650b8cab640e12d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1740, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}