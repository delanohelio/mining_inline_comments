{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2Njc3NjI1", "number": 8687, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNjo0NzowMFrOE9UCCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNjo0NzowMFrOE9UCCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNzI2Nzk0OnYy", "diffSide": "RIGHT", "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionAssignmentTailer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNjo0NzowMFrOH579Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMzoxNzoyNVrOH6Gs2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUxMzIxMQ==", "bodyText": "It's dangerous to have a timeout here, because we might miss messages. Instead we should rely on the timeout in the GetLastMessageId RPC (which should be already there now)", "url": "https://github.com/apache/pulsar/pull/8687#discussion_r530513211", "createdAt": "2020-11-25T16:47:00Z", "author": {"login": "merlimat"}, "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionAssignmentTailer.java", "diffHunk": "@@ -145,7 +145,7 @@ private Thread getTailerThread() {\n                 try {\n                     Message<byte[]> msg = reader.readNext(1, TimeUnit.SECONDS);\n                     if (msg == null) {\n-                        if (exitOnEndOfTopic && !reader.hasMessageAvailable()) {\n+                        if (exitOnEndOfTopic && !reader.hasMessageAvailableAsync().get(10, TimeUnit.SECONDS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d8536e2b2cb6a346669e2c715b8d8749b8fd8c9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY4OTI0Mw==", "bodyText": "When the timeout expires, a TimeoutException will be thrown and which will force the worker to shutdown and restart.  Another worker can more process to becoming leader.", "url": "https://github.com/apache/pulsar/pull/8687#discussion_r530689243", "createdAt": "2020-11-25T23:17:25Z", "author": {"login": "jerrypeng"}, "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionAssignmentTailer.java", "diffHunk": "@@ -145,7 +145,7 @@ private Thread getTailerThread() {\n                 try {\n                     Message<byte[]> msg = reader.readNext(1, TimeUnit.SECONDS);\n                     if (msg == null) {\n-                        if (exitOnEndOfTopic && !reader.hasMessageAvailable()) {\n+                        if (exitOnEndOfTopic && !reader.hasMessageAvailableAsync().get(10, TimeUnit.SECONDS)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUxMzIxMQ=="}, "originalCommit": {"oid": "3d8536e2b2cb6a346669e2c715b8d8749b8fd8c9"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2726, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}