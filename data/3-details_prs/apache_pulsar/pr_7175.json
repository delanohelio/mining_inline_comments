{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MTg4NjAx", "number": 7175, "title": "[doc] Clarify the impact of batch message in key_shared subscription", "bodyText": "Fixes #7121\nMotivation\nFollowing the java example at http://pulsar.apache.org/docs/en/client-libraries-java/#key_shared. The messages sometimes may send to only one consumer if the producer sends the batched messages. It's better to clarify in the doc to introduce the right way to use key_shared subscription.\nModifications\nUpdate Java client documentation.", "createdAt": "2020-06-05T02:44:29Z", "url": "https://github.com/apache/pulsar/pull/7175", "merged": true, "mergeCommit": {"oid": "958398e88f34af840e21aeb90756511db13a6706"}, "closed": true, "closedAt": "2020-06-05T07:05:13Z", "author": {"login": "codelipenghui"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoJcWjAH2gAyNDI4MTg4NjAxOjRkOWVjYzEyNTlkNjZlMWNmNzcwYzg2YjUxNzQ2Y2ZkM2MwMjU1YTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoM52VAH2gAyNDI4MTg4NjAxOmUyZDdiNDRhYmI2ZGFmZjVkZTUyMjc2MTdlMjliMWM1YWJkYTZlMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/4d9ecc1259d66e1cf770c86b51746cfd3c0255a6", "committedDate": "2020-06-05T02:43:10Z", "message": "[doc] Clarify the impact of batch message in key_shared subscription"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MDI2MDMw", "url": "https://github.com/apache/pulsar/pull/7175#pullrequestreview-425026030", "createdAt": "2020-06-05T06:27:02Z", "commit": {"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MDI2NzQ3", "url": "https://github.com/apache/pulsar/pull/7175#pullrequestreview-425026747", "createdAt": "2020-06-05T06:28:40Z", "commit": {"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyODo0MFrOGfh54A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyOTozNVrOGfh7EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxNDUyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.\n          \n          \n            \n            If batching is enabled at the producer side, messages with different keys are added to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer needs to use the `KeyBasedBatcher`.", "url": "https://github.com/apache/pulsar/pull/7175#discussion_r435714528", "createdAt": "2020-06-05T06:28:40Z", "author": {"login": "Huanli-Meng"}, "path": "site2/docs/client-libraries-java.md", "diffHunk": "@@ -608,6 +608,22 @@ consumer2 receives the follwoing information.\n (\"key-4\", \"message-4-2\")\n ```\n \n+If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxNDgzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Or the producer can disable the message batch mechanism.\n          \n          \n            \n            Or the producer can disable batching.", "url": "https://github.com/apache/pulsar/pull/7175#discussion_r435714832", "createdAt": "2020-06-05T06:29:35Z", "author": {"login": "Huanli-Meng"}, "path": "site2/docs/client-libraries-java.md", "diffHunk": "@@ -608,6 +608,22 @@ consumer2 receives the follwoing information.\n (\"key-4\", \"message-4-2\")\n ```\n \n+If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.\n+\n+```java\n+Producer producer = client.newProducer()\n+        .topic(\"my-topic\")\n+        .batcherBuilder(BatcherBuilder.KEY_BASED)\n+        .create();\n+```\n+Or the producer can disable the message batch mechanism.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1893ce30b2fc216786e7908a9d63c12cd0298be", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/d1893ce30b2fc216786e7908a9d63c12cd0298be", "committedDate": "2020-06-05T06:44:52Z", "message": "Update site2/docs/client-libraries-java.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d7b44abb6daff5de5227617e29b1c5abda6e01", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/e2d7b44abb6daff5de5227617e29b1c5abda6e01", "committedDate": "2020-06-05T06:45:06Z", "message": "Update site2/docs/client-libraries-java.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2774, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}