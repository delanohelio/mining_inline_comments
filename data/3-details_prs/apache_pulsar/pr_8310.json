{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2ODUzMDQ1", "number": 8310, "title": "[Offload] Make the field name in `OffloadPolicies` match with config file", "bodyText": "Fixes #8220\nMotivation\nCurrently, the fields' values couldn't be set properly by the Pulsar broker config file(broker.conf or standalone.conf).\nModifications\nchanged fields in OffloadPolicies\n\nmanagedLedgerOffloadAutoTriggerSizeThresholdBytes\nmanagedLedgerOffloadDeletionLagMs\n\nVerifying this change\nThis change added tests and can be verified as follows:\n\norg.apache.pulsar.common.policies.data.OffloadPoliciesTest\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (no)\nThe default values of configurations: (no)\nThe wire protocol: (no)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)", "createdAt": "2020-10-20T14:30:30Z", "url": "https://github.com/apache/pulsar/pull/8310", "merged": true, "mergeCommit": {"oid": "a8eaeb5eb6ddabcbc59030ea14207b43ca76237a"}, "closed": true, "closedAt": "2020-10-28T08:53:32Z", "author": {"login": "gaoran10"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUZiTegH2gAyNTA2ODUzMDQ1OmFiNjVjYjZlMGRjYjQ4ZWYwMWM4OGY5NjIzMTkxOGFhNzQwOTE4NWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW5KH-gFqTUxODQxMjc0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab65cb6e0dcb48ef01c88f96231918aa7409185b", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/ab65cb6e0dcb48ef01c88f96231918aa7409185b", "committedDate": "2020-10-20T14:20:49Z", "message": "make the field name in `OffloadPolicies` match with config file.\n\n1. managedLedgerOffloadAutoTriggerSizeThresholdBytes\n2. managedLedgerOffloadDeletionLagMs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjQ3MTQ3", "url": "https://github.com/apache/pulsar/pull/8310#pullrequestreview-513247147", "createdAt": "2020-10-21T01:38:29Z", "commit": {"oid": "ab65cb6e0dcb48ef01c88f96231918aa7409185b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjQ5OTA4", "url": "https://github.com/apache/pulsar/pull/8310#pullrequestreview-513249908", "createdAt": "2020-10-21T01:47:33Z", "commit": {"oid": "ab65cb6e0dcb48ef01c88f96231918aa7409185b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc3741dddcdde2d56b8d330a1f75ac6e5316dd5a", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/cc3741dddcdde2d56b8d330a1f75ac6e5316dd5a", "committedDate": "2020-10-21T02:09:53Z", "message": "fix license header"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMzEzOTMw", "url": "https://github.com/apache/pulsar/pull/8310#pullrequestreview-513313930", "createdAt": "2020-10-21T05:20:16Z", "commit": {"oid": "cc3741dddcdde2d56b8d330a1f75ac6e5316dd5a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNToyMDoxNlrOHlapzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNToyMDoxNlrOHlapzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk5NjA0NQ==", "bodyText": "What is the backward compatibility story here because we are changing the field name for OffloadPolicies? If there is already a namespace policy written using previous field names, how do we guarantee the new code is able to read the offload policies written using the old code?", "url": "https://github.com/apache/pulsar/pull/8310#discussion_r508996045", "createdAt": "2020-10-21T05:20:16Z", "author": {"login": "sijie"}, "path": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/OffloadPolicies.java", "diffHunk": "@@ -51,8 +51,8 @@\n     private String managedLedgerOffloadDriver = null;\n     private int managedLedgerOffloadMaxThreads = DEFAULT_OFFLOAD_MAX_THREADS;\n     private int managedLedgerOffloadPrefetchRounds = DEFAULT_OFFLOAD_MAX_PREFETCH_ROUNDS;\n-    private long managedLedgerOffloadThresholdInBytes = DEFAULT_OFFLOAD_THRESHOLD_IN_BYTES;\n-    private Long managedLedgerOffloadDeletionLagInMillis = DEFAULT_OFFLOAD_DELETION_LAG_IN_MILLIS;\n+    private long managedLedgerOffloadAutoTriggerSizeThresholdBytes = DEFAULT_OFFLOAD_THRESHOLD_IN_BYTES;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc3741dddcdde2d56b8d330a1f75ac6e5316dd5a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ff8da4e695913ee68c30db649178d4ad1a1f109", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/0ff8da4e695913ee68c30db649178d4ad1a1f109", "committedDate": "2020-10-21T16:41:50Z", "message": "make offload policies configurations are compatible with the broker config file(`broker.conf` or `standalone.conf`)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5085627dbf5b1d4818e354f8eefda8edca35fc9b", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/5085627dbf5b1d4818e354f8eefda8edca35fc9b", "committedDate": "2020-10-22T07:52:44Z", "message": "fix stylecheck"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0458642f361754030c4bef462537682d7aab3a06", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/0458642f361754030c4bef462537682d7aab3a06", "committedDate": "2020-10-22T15:23:42Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb47a83bd682252793d53501a4839bca62f4c77d", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/eb47a83bd682252793d53501a4839bca62f4c77d", "committedDate": "2020-10-22T15:31:49Z", "message": "fix set offload threshold command and set offload deletion command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67acaf451714a95c953fba383ee70481722dd26a", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/67acaf451714a95c953fba383ee70481722dd26a", "committedDate": "2020-10-25T13:21:46Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ffd9629d2fc4dd1bf040706a55483e041b4ca2", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/c5ffd9629d2fc4dd1bf040706a55483e041b4ca2", "committedDate": "2020-10-25T17:40:49Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a5308577fc024e22326ad97cf2085ef041296a", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/39a5308577fc024e22326ad97cf2085ef041296a", "committedDate": "2020-10-26T01:40:55Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cea5fd9b900d1926ad726bbe31e5baeca2e4ec8", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/6cea5fd9b900d1926ad726bbe31e5baeca2e4ec8", "committedDate": "2020-10-26T02:44:13Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "454a382509236fe64a3d5a743762aefd8c22fb20", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/454a382509236fe64a3d5a743762aefd8c22fb20", "committedDate": "2020-10-26T17:55:27Z", "message": "offload policies merged by topic level policies, namespace level policies, broker level configuration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8147326df12253c57c614404aebede304807d40", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/b8147326df12253c57c614404aebede304807d40", "committedDate": "2020-10-26T18:24:26Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf14c5b46e8132e86b1ec77271b65290514c1b0e", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/cf14c5b46e8132e86b1ec77271b65290514c1b0e", "committedDate": "2020-10-26T18:35:37Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f525f829264a70f6308b469e34c7f28d5be33d1", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/2f525f829264a70f6308b469e34c7f28d5be33d1", "committedDate": "2020-10-26T18:52:41Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c4589a565f0cbfc708b673c5267099aa829ea94", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/9c4589a565f0cbfc708b673c5267099aa829ea94", "committedDate": "2020-10-26T19:17:51Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fba947b31091f8b74bec7d8059b19f428532ab3", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/3fba947b31091f8b74bec7d8059b19f428532ab3", "committedDate": "2020-10-26T20:01:20Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97717f2f4b391520ae051f29126b7c0c28bf1a42", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/97717f2f4b391520ae051f29126b7c0c28bf1a42", "committedDate": "2020-10-27T02:05:40Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "820d6a039cf580101aab06772fee0b5c3aa133fb", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/820d6a039cf580101aab06772fee0b5c3aa133fb", "committedDate": "2020-10-27T05:44:10Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07288e179b5f7bdeef50ac6467daa3c1ef5c2ae8", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/07288e179b5f7bdeef50ac6467daa3c1ef5c2ae8", "committedDate": "2020-10-27T06:26:43Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa3332294677fa610b951016a4277076e6b0292", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/8aa3332294677fa610b951016a4277076e6b0292", "committedDate": "2020-10-27T07:45:39Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTM1NTUy", "url": "https://github.com/apache/pulsar/pull/8310#pullrequestreview-517535552", "createdAt": "2020-10-27T10:10:47Z", "commit": {"oid": "8aa3332294677fa610b951016a4277076e6b0292"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b51fd1479bcb3e4427ba8e58b230c08df00965a9", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/b51fd1479bcb3e4427ba8e58b230c08df00965a9", "committedDate": "2020-10-27T11:19:07Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "405180f4cc3f69aec0950410916c449bafb1343d", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/405180f4cc3f69aec0950410916c449bafb1343d", "committedDate": "2020-10-27T11:39:39Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e912cc3341c9071fce9d2ee37f2eaf51a7d8d10", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/1e912cc3341c9071fce9d2ee37f2eaf51a7d8d10", "committedDate": "2020-10-27T12:35:15Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDEyNzQ4", "url": "https://github.com/apache/pulsar/pull/8310#pullrequestreview-518412748", "createdAt": "2020-10-28T08:19:13Z", "commit": {"oid": "1e912cc3341c9071fce9d2ee37f2eaf51a7d8d10"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1261, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}