{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNzE0NTg2", "number": 7388, "title": "Implement rebalance mechanism in Pulsar Functions", "bodyText": "Motivation\nCurrently there no mechanism for rebalancing functions scheduler on workers.  Workload for functions may become skewed.\nModifications\n\nAdd interface for rebalance strategy.\nAllow users to trigger a rebalance on-demand\n\nWill add mechanism to run the rebalance periodically automatically in subsequent PR.", "createdAt": "2020-06-30T00:27:44Z", "url": "https://github.com/apache/pulsar/pull/7388", "merged": true, "mergeCommit": {"oid": "8e4906caf1c8794ff8681aacacde40dbf2d7218f"}, "closed": true, "closedAt": "2020-07-02T05:07:44Z", "author": {"login": "jerrypeng"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwN6BHgFqTQzOTY2MDkwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw3c8BAFqTQ0MTM0ODQzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NjYwOTA5", "url": "https://github.com/apache/pulsar/pull/7388#pullrequestreview-439660909", "createdAt": "2020-06-30T04:26:34Z", "commit": {"oid": "5c2d86686fbf9854277e2db368a3e8ec62746d45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNDoyNjozNFrOGqrNjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNDoyNjozNFrOGqrNjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQwMTM1OQ==", "bodyText": "nit: IRebalancer?", "url": "https://github.com/apache/pulsar/pull/7388#discussion_r447401359", "createdAt": "2020-06-30T04:26:34Z", "author": {"login": "srkukarni"}, "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/SchedulerManager.java", "diffHunk": "@@ -93,6 +94,8 @@\n \n     private final IScheduler scheduler;\n \n+    private final IRebalance rebalancer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2d86686fbf9854277e2db368a3e8ec62746d45"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDg0MTg0", "url": "https://github.com/apache/pulsar/pull/7388#pullrequestreview-440484184", "createdAt": "2020-07-01T01:11:54Z", "commit": {"oid": "b1a0135c442c16f8984c345aeb33a6c4d4525150"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMToxMTo1NFrOGrTivw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMToxMjoyMFrOGrTjNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA2MjE0Mw==", "bodyText": "Should we have a default implementation that just returns the current assignment?", "url": "https://github.com/apache/pulsar/pull/7388#discussion_r448062143", "createdAt": "2020-07-01T01:11:54Z", "author": {"login": "merlimat"}, "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/scheduler/IScheduler.java", "diffHunk": "@@ -38,4 +39,12 @@\n      */\n     List<Assignment> schedule(List<Instance> unassignedFunctionInstances, List<Assignment> currentAssignments,\n             Set<String> workers);\n+\n+    /**\n+     *\n+     * @param currentAssignments\n+     * @param workers\n+     * @return\n+     */\n+    List<Function.Assignment> rebalance(List<Function.Assignment> currentAssignments, Set<String> workers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a0135c442c16f8984c345aeb33a6c4d4525150"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA2MjI2Mg==", "bodyText": "This shouldn't be needed anymore, no?", "url": "https://github.com/apache/pulsar/pull/7388#discussion_r448062262", "createdAt": "2020-07-01T01:12:20Z", "author": {"login": "merlimat"}, "path": "conf/functions_worker.yml", "diffHunk": "@@ -78,6 +78,7 @@ numHttpServerThreads: 8\n # function assignment and scheduler\n \n schedulerClassName: \"org.apache.pulsar.functions.worker.scheduler.RoundRobinScheduler\"\n+rebalancerClassName: \"org.apache.pulsar.functions.worker.scheduler.RoundRobinScheduler\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a0135c442c16f8984c345aeb33a6c4d4525150"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNTAwMDgw", "url": "https://github.com/apache/pulsar/pull/7388#pullrequestreview-440500080", "createdAt": "2020-07-01T02:06:41Z", "commit": {"oid": "22ee6d685794dabd2b9f5c89c2ea6bd45f850775"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ac832cb06a8ceb65e0baf249d2d15c0c85885cc", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/0ac832cb06a8ceb65e0baf249d2d15c0c85885cc", "committedDate": "2020-07-01T21:09:50Z", "message": "Implement rebalance mechanism in Pulsar Functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22ee6d685794dabd2b9f5c89c2ea6bd45f850775", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/22ee6d685794dabd2b9f5c89c2ea6bd45f850775", "committedDate": "2020-07-01T01:20:01Z", "message": "address comments"}, "afterCommit": {"oid": "0ac832cb06a8ceb65e0baf249d2d15c0c85885cc", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/0ac832cb06a8ceb65e0baf249d2d15c0c85885cc", "committedDate": "2020-07-01T21:09:50Z", "message": "Implement rebalance mechanism in Pulsar Functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzQ4NDM2", "url": "https://github.com/apache/pulsar/pull/7388#pullrequestreview-441348436", "createdAt": "2020-07-02T04:50:50Z", "commit": {"oid": "0ac832cb06a8ceb65e0baf249d2d15c0c85885cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 763, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}