{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNDQ0Njk4", "number": 7430, "title": "Handle NotAllowed Exception at the client side.", "bodyText": "Motivation\nHandle NotAllowed Exception at the client-side. Currently, if disable the key_shared feature at the broker side, the client will get a UnknownError from the broker and then the client will reconnect again. The reasonable behavior is to return a specific exception to users and let the client stop reconnect.\nModifications\nAdd NotAllowedError in the ServerError\nVerifying this change\ntestDisableKeySharedSubscription can cover this change.\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (no)\nThe default values of configurations: (no)\nThe wire protocol: (yes)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)", "createdAt": "2020-07-02T11:06:54Z", "url": "https://github.com/apache/pulsar/pull/7430", "merged": true, "mergeCommit": {"oid": "f8b2a2334fb7d2dc5266242a6393c9cc434fba60"}, "closed": true, "closedAt": "2020-07-17T01:22:41Z", "author": {"login": "codelipenghui"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw8v2cgH2gAyNDQzNDQ0Njk4OjVlOWNjMjBkYzM1N2EyMTk0ZDQ3NmM2ZDE2ZjA1NWY2ZjlmMjFjYmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1fDEwgH2gAyNDQzNDQ0Njk4OjI0YjMxMWZmNTBjMjdlMjQ2NjA0NDdlODVjYWZjNDkxZTU2OWVjNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5e9cc20dc357a2194d476c6d16f055f6f9f21cbb", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/5e9cc20dc357a2194d476c6d16f055f6f9f21cbb", "committedDate": "2020-07-02T11:01:01Z", "message": "Handle NotAllowed Exception at the client side."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjY3Mzcz", "url": "https://github.com/apache/pulsar/pull/7430#pullrequestreview-443267373", "createdAt": "2020-07-06T17:16:54Z", "commit": {"oid": "5e9cc20dc357a2194d476c6d16f055f6f9f21cbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjk3NDE3", "url": "https://github.com/apache/pulsar/pull/7430#pullrequestreview-443297417", "createdAt": "2020-07-06T18:02:47Z", "commit": {"oid": "5e9cc20dc357a2194d476c6d16f055f6f9f21cbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjY2NzIx", "url": "https://github.com/apache/pulsar/pull/7430#pullrequestreview-443666721", "createdAt": "2020-07-07T08:20:36Z", "commit": {"oid": "5e9cc20dc357a2194d476c6d16f055f6f9f21cbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Nzc2MTY5", "url": "https://github.com/apache/pulsar/pull/7430#pullrequestreview-446776169", "createdAt": "2020-07-11T04:11:02Z", "commit": {"oid": "5e9cc20dc357a2194d476c6d16f055f6f9f21cbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNDoxMTowMlrOGwKOrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNDoxMTowMlrOGwKOrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MjQzMQ==", "bodyText": "From the ci error. we need to handle this new error type in ClientConnection.cc", "url": "https://github.com/apache/pulsar/pull/7430#discussion_r453152431", "createdAt": "2020-07-11T04:11:02Z", "author": {"login": "jiazhai"}, "path": "pulsar-common/src/main/proto/PulsarApi.proto", "diffHunk": "@@ -196,6 +196,7 @@ enum ServerError {\n \n     TransactionCoordinatorNotFound = 20; // Transaction coordinator not found error\n     InvalidTxnStatus = 21; // Invalid txn status error\n+    NotAllowedError = 22; // Not allowed error", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e9cc20dc357a2194d476c6d16f055f6f9f21cbb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb20085947eb47b3fe6b1c93ca019b41aad3d235", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/bb20085947eb47b3fe6b1c93ca019b41aad3d235", "committedDate": "2020-07-13T15:44:33Z", "message": "Fix tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b311ff50c27e24660447e85cafc491e569ec53", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/24b311ff50c27e24660447e85cafc491e569ec53", "committedDate": "2020-07-16T13:14:29Z", "message": "Fix Tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 531, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}