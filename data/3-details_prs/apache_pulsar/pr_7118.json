{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NjMxNjc2", "number": 7118, "title": "fix NullPointerException with SubscriptionMode.NonDurable", "bodyText": "Fixes #7046\nMotivation\nThis code is to enable non-persistent subscriptions to continue to consume\uff0c based on the Id of the first message in the client's ReceiverQueue when reconnection is triggered.\nBut it's not considered the case that there is no messageId for the first connection. Therefore, we need to determine whether the MessageId is null.\nModifications\nVerifying this change\nunit test: NonDurableSubscriptionTest\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-05-31T15:55:14Z", "url": "https://github.com/apache/pulsar/pull/7118", "merged": true, "mergeCommit": {"oid": "3a49ad5f6e2217bc56f4d8e9d159260337234c11"}, "closed": true, "closedAt": "2020-06-02T07:52:04Z", "author": {"login": "315157973"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmtukiAH2gAyNDI1NjMxNjc2OjU1NDI0ODg1ZmQyZjNiZWE0NmYzZTQ0OTUzMzg1NmQwNjFlYzg4MmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnIzNNAFqTQyMjI0NDk2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "55424885fd2f3bea46f3e449533856d061ec882c", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/55424885fd2f3bea46f3e449533856d061ec882c", "committedDate": "2020-05-31T15:51:48Z", "message": "fix NPE of non durable subscription"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTQyMTUx", "url": "https://github.com/apache/pulsar/pull/7118#pullrequestreview-421542151", "createdAt": "2020-06-01T00:17:41Z", "commit": {"oid": "55424885fd2f3bea46f3e449533856d061ec882c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjMyNjI1", "url": "https://github.com/apache/pulsar/pull/7118#pullrequestreview-421632625", "createdAt": "2020-06-01T07:02:08Z", "commit": {"oid": "55424885fd2f3bea46f3e449533856d061ec882c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNzowMjowOFrOGdAsOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNzowMjowOFrOGdAsOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA3MzIxMA==", "bodyText": "looks like in line 742 below, there is also a reference to startMessageId. Will it also throw NPE\uff1f", "url": "https://github.com/apache/pulsar/pull/7118#discussion_r433073210", "createdAt": "2020-06-01T07:02:08Z", "author": {"login": "jiazhai"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "diffHunk": "@@ -715,11 +715,11 @@ public void connectionOpened(final ClientCnx cnx) {\n         }\n \n         boolean isDurable = subscriptionMode == SubscriptionMode.Durable;\n-        MessageIdData startMessageIdData;\n+        MessageIdData startMessageIdData = null;\n         if (isDurable) {\n             // For regular durable subscriptions, the message id from where to restart will be determined by the broker.\n             startMessageIdData = null;\n-        } else {\n+        } else if (startMessageId != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55424885fd2f3bea46f3e449533856d061ec882c"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b616950e4514de389e61455c10f8f83fdfc5000", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/8b616950e4514de389e61455c10f8f83fdfc5000", "committedDate": "2020-06-01T09:21:52Z", "message": "fix potential NPE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjQ0OTYx", "url": "https://github.com/apache/pulsar/pull/7118#pullrequestreview-422244961", "createdAt": "2020-06-01T23:24:18Z", "commit": {"oid": "8b616950e4514de389e61455c10f8f83fdfc5000"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2745, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}