{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMwMjc3MjA3", "number": 7193, "title": "function to read compacted topics", "bodyText": "Fixes #5538\nMotivation\nModifications\nIn function mode and sink mode, PulsarSource can read compacted topic\u3002\nBy inputSpecs parameter, each topic can independently decide whether to read compacted\nVerifying this change\nunit test:\norg.apache.pulsar.io.PulsarFunctionE2ETest#testReadCompactedFunction\norg.apache.pulsar.io.PulsarFunctionE2ETest#testReadCompactedSink\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-06-07T18:32:03Z", "url": "https://github.com/apache/pulsar/pull/7193", "merged": true, "mergeCommit": {"oid": "7a80ca98c87a611b36713c82cc1901a81ab0014c"}, "closed": true, "closedAt": "2020-07-02T07:14:31Z", "author": {"login": "315157973"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABco8K-ugH2gAyNDMwMjc3MjA3OmEyOTBjZTJkYjMwNzc1ODMzZmRkYWU3NWEyMWQwMmM1MGU4MGM0OGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw3pczAFqTQ0MTM1MjQwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a290ce2db30775833fddae75a21d02c50e80c48d", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/a290ce2db30775833fddae75a21d02c50e80c48d", "committedDate": "2020-06-07T13:49:21Z", "message": "add read compacted for function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d644a4fc9042cdcb7b6fc852e18694b81a4ea98a", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/d644a4fc9042cdcb7b6fc852e18694b81a4ea98a", "committedDate": "2020-06-07T18:25:50Z", "message": "add read compacted for sink"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d5b4115706e7f87367189744b4caccfbcfea643", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/3d5b4115706e7f87367189744b4caccfbcfea643", "committedDate": "2020-06-08T01:25:48Z", "message": "fix npe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1OTA0MzQw", "url": "https://github.com/apache/pulsar/pull/7193#pullrequestreview-425904340", "createdAt": "2020-06-08T04:06:51Z", "commit": {"oid": "3d5b4115706e7f87367189744b4caccfbcfea643"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNDowNjo1MVrOGgOqZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNDowNjo1OFrOGgOqeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ0Nzg0Ng==", "bodyText": "Is this related to this PR?", "url": "https://github.com/apache/pulsar/pull/7193#discussion_r436447846", "createdAt": "2020-06-08T04:06:51Z", "author": {"login": "codelipenghui"}, "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdFunctions.java", "diffHunk": "@@ -233,6 +234,8 @@ void processArguments() throws Exception {\n         protected String customSerdeInputString;\n         @Parameter(names = \"--custom-schema-inputs\", description = \"The map of input topics to Schema class names (as a JSON string)\")\n         protected String customSchemaInputString;\n+        @Parameter(names = \"--input-specs\", description = \"The map of inputs to custom configuration (as a JSON string)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d5b4115706e7f87367189744b4caccfbcfea643"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ0Nzg2NQ==", "bodyText": "Is this related to this PR?", "url": "https://github.com/apache/pulsar/pull/7193#discussion_r436447865", "createdAt": "2020-06-08T04:06:58Z", "author": {"login": "codelipenghui"}, "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdSinks.java", "diffHunk": "@@ -276,6 +277,9 @@ protected void validateSinkConfigs(SinkConfig sinkConfig) {\n         @Parameter(names = \"--custom-schema-inputs\", description = \"The map of input topics to Schema types or class names (as a JSON string)\")\n         protected String customSchemaInputString;\n \n+        @Parameter(names = \"--input-specs\", description = \"The map of inputs to custom configuration (as a JSON string)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d5b4115706e7f87367189744b4caccfbcfea643"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDIyMTU4", "url": "https://github.com/apache/pulsar/pull/7193#pullrequestreview-426022158", "createdAt": "2020-06-08T08:40:40Z", "commit": {"oid": "3d5b4115706e7f87367189744b4caccfbcfea643"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODo0MDo0MFrOGgURoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODo0MDo0MFrOGgURoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUzOTgwOA==", "bodyText": "I think a more generic approach is to add a Map<String, String> to the consumer spec. So we can use \n  \n    \n      pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBuilderImpl.java\n    \n    \n         Line 86\n      in\n      870a637\n    \n    \n    \n    \n\n        \n          \n           public ConsumerBuilder<T> loadConf(Map<String, Object> config) { \n        \n    \n  \n\n to load the consumer configuration when building the consumers.", "url": "https://github.com/apache/pulsar/pull/7193#discussion_r436539808", "createdAt": "2020-06-08T08:40:40Z", "author": {"login": "sijie"}, "path": "pulsar-functions/proto/src/main/proto/Function.proto", "diffHunk": "@@ -94,6 +94,7 @@ message ConsumerSpec {\n         int32 value = 1;\n     }\n     ReceiverQueueSize receiverQueueSize = 4;\n+    bool readCompacted = 5;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d5b4115706e7f87367189744b4caccfbcfea643"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c2b3d989b4a47306580b1ee70ad727445595526", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/3c2b3d989b4a47306580b1ee70ad727445595526", "committedDate": "2020-06-10T12:58:44Z", "message": "merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee1c480c95ac17894e45fa3f108998b962ea2086", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/ee1c480c95ac17894e45fa3f108998b962ea2086", "committedDate": "2020-06-14T03:57:23Z", "message": "use generic map to set consumer parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6107e460d5a7b2c3ff9bf2a216c4a0828a61795a", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/6107e460d5a7b2c3ff9bf2a216c4a0828a61795a", "committedDate": "2020-06-14T06:11:27Z", "message": "fix npe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzUyNDA3", "url": "https://github.com/apache/pulsar/pull/7193#pullrequestreview-441352407", "createdAt": "2020-07-02T05:04:30Z", "commit": {"oid": "6107e460d5a7b2c3ff9bf2a216c4a0828a61795a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2790, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}