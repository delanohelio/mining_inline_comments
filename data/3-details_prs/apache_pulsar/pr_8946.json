{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MDY1NzU5", "number": 8946, "title": "make ledger rollover check task internal", "bodyText": "Fix #7195\nChanges\n\nadd a schedulerTask to rollover the ledger in ManagedLedgerImpl instead of BrokerService\nadd the test.", "createdAt": "2020-12-14T01:14:24Z", "url": "https://github.com/apache/pulsar/pull/8946", "merged": true, "mergeCommit": {"oid": "b4ef76ec66069cb1c8632c21e48e088a48efd17c"}, "closed": true, "closedAt": "2021-01-07T17:47:17Z", "author": {"login": "hangc0276"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdl9E-0gFqTU1MTAxOTUyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdt10S7gFqTU2MzU3NzUxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMDE5NTIx", "url": "https://github.com/apache/pulsar/pull/8946#pullrequestreview-551019521", "createdAt": "2020-12-14T03:22:05Z", "commit": {"oid": "c4b411912691e8e9dc54493a01d0df483a810251"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwMzoyMjowNVrOIE-Rdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwMzoyMjowNVrOIE-Rdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjA4NTQ5NA==", "bodyText": "I think it would be better to separate the timing task of checking that current ledger is full from scheduleTimeoutTask and put it in the ledger initialize method.", "url": "https://github.com/apache/pulsar/pull/8946#discussion_r542085494", "createdAt": "2020-12-14T03:22:05Z", "author": {"login": "wuzhanpeng"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "diffHunk": "@@ -3300,6 +3305,13 @@ private void scheduleTimeoutTask() {\n                 checkReadTimeout();\n             }), timeoutSec, timeoutSec, TimeUnit.SECONDS);\n         }\n+\n+        if (config.getMaximumRolloverTimeMs() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4b411912691e8e9dc54493a01d0df483a810251"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjA2OTU3", "url": "https://github.com/apache/pulsar/pull/8946#pullrequestreview-558206957", "createdAt": "2020-12-23T20:09:56Z", "commit": {"oid": "7fce8e3b33b01f07da65fc424b080004756e3890"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDowOTo1NlrOIKzRPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDowOTo1NlrOIKzRPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODE5NjY2OQ==", "bodyText": "@hangc0276 we shouldn't remove a method from an interface directly. we should keep the method and mark it as deprecated.", "url": "https://github.com/apache/pulsar/pull/8946#discussion_r548196669", "createdAt": "2020-12-23T20:09:56Z", "author": {"login": "sijie"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedLedger.java", "diffHunk": "@@ -515,9 +515,4 @@ void asyncSetProperties(Map<String, String> properties, final AsyncCallbacks.Upd\n      * @param promise\n      */\n     void trimConsumedLedgersInBackground(CompletableFuture<?> promise);\n-\n-    /**\n-     * Roll current ledger if it is full\n-     */\n-    void rollCurrentLedgerIfFull();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fce8e3b33b01f07da65fc424b080004756e3890"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMzAxNTQ4", "url": "https://github.com/apache/pulsar/pull/8946#pullrequestreview-561301548", "createdAt": "2021-01-04T19:55:56Z", "commit": {"oid": "0745183ebca45ed5c651307489b69e4e4eafe1c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96f7eb2a54385c3dd5e03ebd7e5e4f9b575e6b8b", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/96f7eb2a54385c3dd5e03ebd7e5e4f9b575e6b8b", "committedDate": "2021-01-07T05:18:43Z", "message": "mmake ledger rollover check task internal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9465d2903dbf458df1f52d62e0428acb6f0e8c2b", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/9465d2903dbf458df1f52d62e0428acb6f0e8c2b", "committedDate": "2021-01-07T05:18:43Z", "message": "move roll over ledger task into individual method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "facd007dfc6540a981c05a3924381edfd8bca48f", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/facd007dfc6540a981c05a3924381edfd8bca48f", "committedDate": "2021-01-07T05:19:21Z", "message": "mark rollCurrentLedgerIfFull interface as Deprecated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "534326d168f86e98e60ac9c3c1c106235dbd8391", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/534326d168f86e98e60ac9c3c1c106235dbd8391", "committedDate": "2021-01-07T05:19:21Z", "message": "fix run test case failed."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fe915ad17ba0666c6f9e855771750e505c10b58", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/9fe915ad17ba0666c6f9e855771750e505c10b58", "committedDate": "2021-01-07T05:08:37Z", "message": "fix run test case failed."}, "afterCommit": {"oid": "534326d168f86e98e60ac9c3c1c106235dbd8391", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/534326d168f86e98e60ac9c3c1c106235dbd8391", "committedDate": "2021-01-07T05:19:21Z", "message": "fix run test case failed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "766e9c69dcb262dd53d8cdc1b85ffe430d59b53b", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/766e9c69dcb262dd53d8cdc1b85ffe430d59b53b", "committedDate": "2021-01-07T12:36:13Z", "message": "fix run test case failed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f94c36e311b6215ea4f3eec54e7b00e1cf198890", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/f94c36e311b6215ea4f3eec54e7b00e1cf198890", "committedDate": "2021-01-07T12:52:03Z", "message": "fix run test case failed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNTc3NTEx", "url": "https://github.com/apache/pulsar/pull/8946#pullrequestreview-563577511", "createdAt": "2021-01-07T15:25:55Z", "commit": {"oid": "f94c36e311b6215ea4f3eec54e7b00e1cf198890"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 929, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}