{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5OTE2NTIx", "number": 6983, "title": "Added ability to add annotations to Connector Configs ", "bodyText": "(If this PR fixes a github issue, please add Fixes #<xyz>.)\nFixes #\n(or if this PR is one task of a github issue, please add Master Issue: #<xyz> to link to the master issue.)\nMaster Issue: #\nMotivation\nThis pr adds the ability for pulsar io sources and sinks to define annotations in their configs and have them checked at submission time. This means that creation/update of connectors with improper config can be rejected outright at request time rather than at runtime which is the current case. This will lead to faster troubleshooting when developing and running connectors. We make this check gated by a worker config parameter.\nModifications\nDescribe the modifications you've done.\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\n(Please pick either of the following options)\nThis change is a trivial rework / code cleanup without any test coverage.\n(or)\nThis change is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end deployment with large payloads (10MB)\nExtended integration test for recovery after broker failure\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-05-19T06:55:41Z", "url": "https://github.com/apache/pulsar/pull/6983", "merged": true, "mergeCommit": {"oid": "c8170b7c9f0232c9a005b65b6b146e0417ec3190"}, "closed": true, "closedAt": "2020-05-22T15:24:14Z", "author": {"login": "srkukarni"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchbiMTAH2gAyNDE5OTE2NTIxOmE5ODAyMmZiYTJhNWJhZDRjNzA2YjIwNDA5YWU2NDg2Njg5ZWRmZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjxmiCAH2gAyNDE5OTE2NTIxOmRmNTQ0YjkwODQ0NWE1NDBjNzcwNjU4NGE1NjBiYzYwZDdkZWRiNzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a98022fba2a5bad4c706b20409ae6486689edfd6", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/a98022fba2a5bad4c706b20409ae6486689edfd6", "committedDate": "2020-05-15T05:50:22Z", "message": "Added sourceConfigClass and sinkConfigClass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6edf815a07eabf82755fb3b074510e60f79ee87", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/d6edf815a07eabf82755fb3b074510e60f79ee87", "committedDate": "2020-05-15T23:29:18Z", "message": "Add Validator annotation helpers to validate class parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68a21cf08fa96997da1277cfba30eb65c5f62870", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/68a21cf08fa96997da1277cfba30eb65c5f62870", "committedDate": "2020-05-16T00:40:42Z", "message": "Fix build errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64001f84f3b1b38a0f56b51366c6dc13207a1dfb", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/64001f84f3b1b38a0f56b51366c6dc13207a1dfb", "committedDate": "2020-05-16T20:26:30Z", "message": "Take feedback into account"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6771904932ad7cfc3016b7c137be2ddd82a82f2f", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/6771904932ad7cfc3016b7c137be2ddd82a82f2f", "committedDate": "2020-05-18T16:05:45Z", "message": "Merge branch 'validators' into connector_annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dc67273219d927442b179553f14d8f78383cd9e", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/3dc67273219d927442b179553f14d8f78383cd9e", "committedDate": "2020-05-18T20:53:52Z", "message": "Merge branch 'master' into connector_annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6da462336e5698485f31ad4e56639978fbeafd57", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/6da462336e5698485f31ad4e56639978fbeafd57", "committedDate": "2020-05-18T23:18:11Z", "message": "Connected with validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e021a89011b259d764227f4d7f4f849dfdc0815c", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/e021a89011b259d764227f4d7f4f849dfdc0815c", "committedDate": "2020-05-19T02:07:59Z", "message": "Fix bugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c9b8665f58f10828d3148facf478eac2a53d75c", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/6c9b8665f58f10828d3148facf478eac2a53d75c", "committedDate": "2020-05-19T06:45:10Z", "message": "Added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cb0bd2b0170fd28d0c4d6c474cca9c7a29e8bce", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/2cb0bd2b0170fd28d0c4d6c474cca9c7a29e8bce", "committedDate": "2020-05-19T07:03:14Z", "message": "Merge branch 'master' into connector_annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7642fdf61833fe974e38b2a0652cd7d18c45893", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/c7642fdf61833fe974e38b2a0652cd7d18c45893", "committedDate": "2020-05-19T22:02:47Z", "message": "Merge branch 'master' into connector_annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "550f585fcb60571220b2f5ed6b5deb1b06b3edf4", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/550f585fcb60571220b2f5ed6b5deb1b06b3edf4", "committedDate": "2020-05-20T14:24:44Z", "message": "Merge branch 'master' into connector_annotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzM5NTEy", "url": "https://github.com/apache/pulsar/pull/6983#pullrequestreview-415739512", "createdAt": "2020-05-20T21:49:42Z", "commit": {"oid": "550f585fcb60571220b2f5ed6b5deb1b06b3edf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMTo0OTo0MlrOGYfDEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMTo0OTo0MlrOGYfDEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMyNzY5OQ==", "bodyText": "Please use ObjectMapperFactory.getThreadLocal", "url": "https://github.com/apache/pulsar/pull/6983#discussion_r428327699", "createdAt": "2020-05-20T21:49:42Z", "author": {"login": "jerrypeng"}, "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/SinkConfigUtils.java", "diffHunk": "@@ -580,4 +595,24 @@ public static SinkConfig validateUpdate(SinkConfig existingConfig, SinkConfig ne\n         }\n         return mergedConfig;\n     }\n+\n+    public static void validateConnectorConfig(SinkConfig sinkConfig, ClassLoader classLoader) {\n+        try {\n+            ConnectorDefinition defn = ConnectorUtils.getConnectorDefinition(classLoader);\n+            if (defn.getSinkConfigClass() != null) {\n+                Class configClass = Class.forName(defn.getSinkConfigClass(),  true, classLoader);\n+                ObjectMapper mapper = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "550f585fcb60571220b2f5ed6b5deb1b06b3edf4"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzQwNjE2", "url": "https://github.com/apache/pulsar/pull/6983#pullrequestreview-415740616", "createdAt": "2020-05-20T21:51:47Z", "commit": {"oid": "550f585fcb60571220b2f5ed6b5deb1b06b3edf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMTo1MTo0N1rOGYfGoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMTo1MTo0N1rOGYfGoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMyODYwOQ==", "bodyText": "You can achieve the same thing by using the following method\nmapper.convertValue(map, MyPojo.class);", "url": "https://github.com/apache/pulsar/pull/6983#discussion_r428328609", "createdAt": "2020-05-20T21:51:47Z", "author": {"login": "jerrypeng"}, "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/SinkConfigUtils.java", "diffHunk": "@@ -580,4 +595,24 @@ public static SinkConfig validateUpdate(SinkConfig existingConfig, SinkConfig ne\n         }\n         return mergedConfig;\n     }\n+\n+    public static void validateConnectorConfig(SinkConfig sinkConfig, ClassLoader classLoader) {\n+        try {\n+            ConnectorDefinition defn = ConnectorUtils.getConnectorDefinition(classLoader);\n+            if (defn.getSinkConfigClass() != null) {\n+                Class configClass = Class.forName(defn.getSinkConfigClass(),  true, classLoader);\n+                ObjectMapper mapper = new ObjectMapper();\n+                Object configObject = mapper.readValue(new ObjectMapper().writeValueAsString(sinkConfig.getConfigs()), configClass);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "550f585fcb60571220b2f5ed6b5deb1b06b3edf4"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67d1028b39670955db81f370f75546cdcfaae2ec", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/67d1028b39670955db81f370f75546cdcfaae2ec", "committedDate": "2020-05-20T22:05:48Z", "message": "Fix class name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d60e4fb99d15032c996fd1f01b4eeb6aeb143de", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/3d60e4fb99d15032c996fd1f01b4eeb6aeb143de", "committedDate": "2020-05-20T22:15:05Z", "message": "Address feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2Mzk5NTkw", "url": "https://github.com/apache/pulsar/pull/6983#pullrequestreview-416399590", "createdAt": "2020-05-21T18:44:20Z", "commit": {"oid": "3d60e4fb99d15032c996fd1f01b4eeb6aeb143de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df544b908445a540c7706584a560bc60d7dedb76", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/df544b908445a540c7706584a560bc60d7dedb76", "committedDate": "2020-05-22T12:40:52Z", "message": "Merge branch 'master' into connector_annotations"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3521, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}