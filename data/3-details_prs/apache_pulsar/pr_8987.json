{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxOTA2MTQx", "number": 8987, "title": "Support create and update sink with package name", "bodyText": "Master Issue: #8676\nMotivation\nWe have a new package management service that can manage all\nthe sink packages. We can use that in the Pulsar Sink to manage\nsink packages.\nI reuse the 'packageUrl' for downloading the package from the packages\nmanagement service. So user can use the package name as the 'packageUrl'\nto download it.\nModifications\n\nSupport create and update sink with the package name\nAdd test for this", "createdAt": "2020-12-17T14:33:54Z", "url": "https://github.com/apache/pulsar/pull/8987", "merged": true, "mergeCommit": {"oid": "92fc2244d15170d61416bf4648b0eca7ae8ef274"}, "closed": true, "closedAt": "2020-12-30T10:24:57Z", "author": {"login": "zymap"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnER3cgH2gAyNTQxOTA2MTQxOmE5MmUxYWFlMTFjYzkwNWVlOGQ4ZDJmYWVjMGJjYWVmYWQ1M2FkMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrMtnkAFqTU1OTk5MDI5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a92e1aae11cc905ee8d8d2faec0bcaefad53ad27", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/a92e1aae11cc905ee8d8d2faec0bcaefad53ad27", "committedDate": "2020-12-17T14:19:25Z", "message": "Support create and update sink with package name\n---\n\nMaster Issue: #8676\n\n*Motivation*\n\nWe have a new package management service that can manage all\nthe sink packages. We can use that in the Pulsar Sink to manage\nsink pakcages.\n\n*Modifications*\n\n- Support create and update sink with package name\n- Add test for this"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MjYwODY0", "url": "https://github.com/apache/pulsar/pull/8987#pullrequestreview-557260864", "createdAt": "2020-12-22T17:56:36Z", "commit": {"oid": "a92e1aae11cc905ee8d8d2faec0bcaefad53ad27"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNzo1NjozNlrOIKDx1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNzo1NjozNlrOIKDx1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQxODU4Mg==", "bodyText": "Same comment in #8988. Why do we need to download the package?", "url": "https://github.com/apache/pulsar/pull/8987#discussion_r547418582", "createdAt": "2020-12-22T17:56:36Z", "author": {"login": "sijie"}, "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/SinksImpl.java", "diffHunk": "@@ -317,10 +321,14 @@ public void updateSink(final String tenant,\n             // validate parameters\n             try {\n                 if (isNotBlank(sinkPkgUrl)) {\n-                    try {\n-                        componentPackageFile = FunctionCommon.extractFileFromPkgURL(sinkPkgUrl);\n-                    } catch (Exception e) {\n-                        throw new IllegalArgumentException(String.format(\"Encountered error \\\"%s\\\" when getting %s package from %s\", e.getMessage(), ComponentTypeUtils.toString(componentType), sinkPkgUrl));\n+                    if (hasPackageTypePrefix(sinkPkgUrl)) {\n+                        componentPackageFile = downloadPackageFile(sinkPkgUrl);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a92e1aae11cc905ee8d8d2faec0bcaefad53ad27"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTkwMjkx", "url": "https://github.com/apache/pulsar/pull/8987#pullrequestreview-559990291", "createdAt": "2020-12-30T10:24:40Z", "commit": {"oid": "a92e1aae11cc905ee8d8d2faec0bcaefad53ad27"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 789, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}