{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNDAzODUy", "number": 9019, "title": "Allow Pulsar to use BookieID instead of Bookie Network Addresses (Update BK to 4.12.1)", "bodyText": "This change allows ZkBookieRackAffinityMapping to deal with BookieId instead of raw BookieSocketAddresses.\nSummary of changes:\n\nupgrade to BK 4.12.1\nuse BookieAddressResolver in ZkBookieRackAffinityMapping\nStart BookieServer passing \"null\" as BookieServiceInfo provider instead of BookieServiceInfo.NO_INFO (this change allows the Bookie bundled with Pulsar to publish local endpoints)\nindirectly the update of BK to 4.12.1 brings the update of Apache Curator from 4.x to 5.1. It is used by BK StreamStorage\n\nDocumentation\n\nDoes this pull request introduce a new feature? yes\nIf yes, how is the feature documented? not documented\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation\n\nI will create a followup issue once the patch is ready to be reviewed and merged", "createdAt": "2020-12-21T10:51:23Z", "url": "https://github.com/apache/pulsar/pull/9019", "merged": true, "mergeCommit": {"oid": "4c6026213b743a7f23ae2a5a6d37ee7404b066db"}, "closed": true, "closedAt": "2021-01-14T08:32:58Z", "author": {"login": "eolivelli"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqidrzgH2gAyNTQzNDAzODUyOjkzZTA2NDE1Y2MwODkzMmMyNzE5MzllZGFhYzU3ZmI3YjE5OGM4MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwAGcHAFqTU2ODAwOTQ5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "93e06415cc08932c271939edaac57fb7b198c802", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/93e06415cc08932c271939edaac57fb7b198c802", "committedDate": "2020-12-28T09:11:15Z", "message": "Allow Pulsar to use BookieID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2494d4edeac0af6e38c1b684cbbb868db984acf", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/a2494d4edeac0af6e38c1b684cbbb868db984acf", "committedDate": "2020-12-28T09:11:15Z", "message": "use BookieAddressResolver"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a08041092e2f3b1c746b335331c1d19b1e29947e", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/a08041092e2f3b1c746b335331c1d19b1e29947e", "committedDate": "2020-12-28T09:11:15Z", "message": "fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14b3e09619132b090395202e3187af92e9b600b8", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/14b3e09619132b090395202e3187af92e9b600b8", "committedDate": "2020-12-21T11:20:36Z", "message": "add configuration file examples"}, "afterCommit": {"oid": "2cf106356b383975d56523888f8076eb7f7dd93b", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/2cf106356b383975d56523888f8076eb7f7dd93b", "committedDate": "2020-12-28T09:11:15Z", "message": "add configuration file examples"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1MDY1ODI5", "url": "https://github.com/apache/pulsar/pull/9019#pullrequestreview-565065829", "createdAt": "2021-01-11T04:31:53Z", "commit": {"oid": "2cf106356b383975d56523888f8076eb7f7dd93b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwNDozMTo1M1rOIRAi8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwNDozMTo1M1rOIRAi8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDcwNTY0OA==", "bodyText": "We need clear documentation on how to use this and what is the path for migrating the existing cluster to use BookieId.", "url": "https://github.com/apache/pulsar/pull/9019#discussion_r554705648", "createdAt": "2021-01-11T04:31:53Z", "author": {"login": "sijie"}, "path": "conf/bookkeeper.conf", "diffHunk": "@@ -23,6 +23,10 @@\n ## Server parameters\n #############################################################################\n \n+# Bookie identifier, by default it is computed using the advertised bookies address\n+# This value cannot be changed once the bookie is started for the first time\n+#bookieId=", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cf106356b383975d56523888f8076eb7f7dd93b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac562d102ed542f669c73ead00ef7f4a344d5596", "author": {"user": {"login": "eolivelli", "name": "Enrico Olivelli"}}, "url": "https://github.com/apache/pulsar/commit/ac562d102ed542f669c73ead00ef7f4a344d5596", "committedDate": "2021-01-11T13:26:19Z", "message": "Use BookKeeper 4.12.1"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2cf106356b383975d56523888f8076eb7f7dd93b", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/2cf106356b383975d56523888f8076eb7f7dd93b", "committedDate": "2020-12-28T09:11:15Z", "message": "add configuration file examples"}, "afterCommit": {"oid": "ac562d102ed542f669c73ead00ef7f4a344d5596", "author": {"user": {"login": "eolivelli", "name": "Enrico Olivelli"}}, "url": "https://github.com/apache/pulsar/commit/ac562d102ed542f669c73ead00ef7f4a344d5596", "committedDate": "2021-01-11T13:26:19Z", "message": "Use BookKeeper 4.12.1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a665f81dfed5650a055786cf01fc8911c4e1f663", "author": {"user": {"login": "eolivelli", "name": "Enrico Olivelli"}}, "url": "https://github.com/apache/pulsar/commit/a665f81dfed5650a055786cf01fc8911c4e1f663", "committedDate": "2021-01-11T13:32:37Z", "message": "Fix LICENSE files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e23a8b707b292571bff30a55610ce507245aa5f", "author": {"user": {"login": "eolivelli", "name": "Enrico Olivelli"}}, "url": "https://github.com/apache/pulsar/commit/6e23a8b707b292571bff30a55610ce507245aa5f", "committedDate": "2021-01-11T14:44:00Z", "message": "Fix license"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1OTk2MjA5", "url": "https://github.com/apache/pulsar/pull/9019#pullrequestreview-565996209", "createdAt": "2021-01-12T07:27:33Z", "commit": {"oid": "6e23a8b707b292571bff30a55610ce507245aa5f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNzoyNzozM1rOIR0wpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQwNzoyNzo1NlrOIR0xLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTU2MTEyNQ==", "bodyText": "@eolivelli thank you for your contribution.\nI was wondering do we have a way to keep it as a variable, so it will be changed with the bk release automatically in the future. Otherwise, we might need to manually update the versions.", "url": "https://github.com/apache/pulsar/pull/9019#discussion_r555561125", "createdAt": "2021-01-12T07:27:33Z", "author": {"login": "Jennifer88huang"}, "path": "distribution/server/src/assemble/LICENSE.bin.txt", "diffHunk": "@@ -395,32 +395,32 @@ The Apache Software License, Version 2.0\n     - org.apache.logging.log4j-log4j-1.2-api-2.14.0.jar\n  * Java Native Access JNA -- net.java.dev.jna-jna-4.2.0.jar\n  * BookKeeper\n-    - org.apache.bookkeeper-bookkeeper-common-4.12.0.jar\n-    - org.apache.bookkeeper-bookkeeper-common-allocator-4.12.0.jar\n-    - org.apache.bookkeeper-bookkeeper-proto-4.12.0.jar\n-    - org.apache.bookkeeper-bookkeeper-server-4.12.0.jar\n-    - org.apache.bookkeeper-bookkeeper-tools-framework-4.12.0.jar\n-    - org.apache.bookkeeper-circe-checksum-4.12.0.jar\n-    - org.apache.bookkeeper-cpu-affinity-4.12.0.jar\n-    - org.apache.bookkeeper-statelib-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-api-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-common-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-java-client-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-java-client-base-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-proto-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-server-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-service-api-4.12.0.jar\n-    - org.apache.bookkeeper-stream-storage-service-impl-4.12.0.jar\n-    - org.apache.bookkeeper.http-http-server-4.12.0.jar\n-    - org.apache.bookkeeper.http-vertx-http-server-4.12.0.jar\n-    - org.apache.bookkeeper.stats-bookkeeper-stats-api-4.12.0.jar\n-    - org.apache.bookkeeper.stats-prometheus-metrics-provider-4.12.0.jar\n-    - org.apache.bookkeeper.tests-stream-storage-tests-common-4.12.0.jar\n-    - org.apache.distributedlog-distributedlog-common-4.12.0.jar\n-    - org.apache.distributedlog-distributedlog-core-4.12.0-tests.jar\n-    - org.apache.distributedlog-distributedlog-core-4.12.0.jar\n-    - org.apache.distributedlog-distributedlog-protocol-4.12.0.jar\n-    - org.apache.bookkeeper.stats-codahale-metrics-provider-4.12.0.jar\n+    - org.apache.bookkeeper-bookkeeper-common-4.12.1.jar\n+    - org.apache.bookkeeper-bookkeeper-common-allocator-4.12.1.jar\n+    - org.apache.bookkeeper-bookkeeper-proto-4.12.1.jar\n+    - org.apache.bookkeeper-bookkeeper-server-4.12.1.jar\n+    - org.apache.bookkeeper-bookkeeper-tools-framework-4.12.1.jar\n+    - org.apache.bookkeeper-circe-checksum-4.12.1.jar\n+    - org.apache.bookkeeper-cpu-affinity-4.12.1.jar\n+    - org.apache.bookkeeper-statelib-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-api-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-common-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-java-client-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-java-client-base-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-proto-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-server-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-service-api-4.12.1.jar\n+    - org.apache.bookkeeper-stream-storage-service-impl-4.12.1.jar\n+    - org.apache.bookkeeper.http-http-server-4.12.1.jar\n+    - org.apache.bookkeeper.http-vertx-http-server-4.12.1.jar\n+    - org.apache.bookkeeper.stats-bookkeeper-stats-api-4.12.1.jar\n+    - org.apache.bookkeeper.stats-prometheus-metrics-provider-4.12.1.jar\n+    - org.apache.bookkeeper.tests-stream-storage-tests-common-4.12.1.jar\n+    - org.apache.distributedlog-distributedlog-common-4.12.1.jar\n+    - org.apache.distributedlog-distributedlog-core-4.12.1-tests.jar\n+    - org.apache.distributedlog-distributedlog-core-4.12.1.jar\n+    - org.apache.distributedlog-distributedlog-protocol-4.12.1.jar\n+    - org.apache.bookkeeper.stats-codahale-metrics-provider-4.12.1.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e23a8b707b292571bff30a55610ce507245aa5f"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTU2MTI2MA==", "bodyText": "same concern here.", "url": "https://github.com/apache/pulsar/pull/9019#discussion_r555561260", "createdAt": "2021-01-12T07:27:56Z", "author": {"login": "Jennifer88huang"}, "path": "distribution/server/src/assemble/LICENSE.bin.txt", "diffHunk": "@@ -476,9 +476,9 @@ The Apache Software License, Version 2.0\n     - org.apache.avro-avro-1.9.1.jar\n     - org.apache.avro-avro-protobuf-1.9.1.jar\n   * Apache Curator\n-    - org.apache.curator-curator-client-4.0.1.jar\n-    - org.apache.curator-curator-framework-4.0.1.jar\n-    - org.apache.curator-curator-recipes-4.0.1.jar\n+    - org.apache.curator-curator-client-5.1.0.jar\n+    - org.apache.curator-curator-framework-5.1.0.jar\n+    - org.apache.curator-curator-recipes-5.1.0.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e23a8b707b292571bff30a55610ce507245aa5f"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bc811b61ee76b355f52ed9a7dd4ee87640d1a14", "author": {"user": {"login": "eolivelli", "name": "Enrico Olivelli"}}, "url": "https://github.com/apache/pulsar/commit/3bc811b61ee76b355f52ed9a7dd4ee87640d1a14", "committedDate": "2021-01-12T07:36:30Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2MDQzOTg3", "url": "https://github.com/apache/pulsar/pull/9019#pullrequestreview-566043987", "createdAt": "2021-01-12T08:42:58Z", "commit": {"oid": "3bc811b61ee76b355f52ed9a7dd4ee87640d1a14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MDA5NDkz", "url": "https://github.com/apache/pulsar/pull/9019#pullrequestreview-568009493", "createdAt": "2021-01-14T08:32:38Z", "commit": {"oid": "3bc811b61ee76b355f52ed9a7dd4ee87640d1a14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 818, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}