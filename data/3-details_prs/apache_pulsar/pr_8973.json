{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMTk3MzU5", "number": 8973, "title": "Make function supports to use package command", "bodyText": "Master Issue: #8676\nMotivation\nWe have a new package management service which can manage all\nthe packages. We can use that in the Pulsar Function will make the\nfunction packages are easier to manage.\nI reuse the 'packageUrl' for downloading the package from the packages\nmanagement service. So user can use the package name as the 'packageUrl'\nto download it.\nModifications\n\nSupport new package type URL for creating and updating functions\nSupport to use package download command for Kubernetes runtime\nAdd tests for the changes", "createdAt": "2020-12-16T14:18:30Z", "url": "https://github.com/apache/pulsar/pull/8973", "merged": true, "mergeCommit": {"oid": "7b60d29a6abeaa70ae62dfddb23c8b93913ffee7"}, "closed": true, "closedAt": "2020-12-30T06:19:29Z", "author": {"login": "zymap"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmvmHuAH2gAyNTQxMTk3MzU5OjFhNTM0YjYxZjllYWRlNjUwZjczYmE3MDRkZWQzYjMxYzk1MDBiMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrJM6tAFqTU1OTg5MDA4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a534b61f9eade650f73ba704ded3b31c9500b2a", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/1a534b61f9eade650f73ba704ded3b31c9500b2a", "committedDate": "2020-12-16T14:13:32Z", "message": "Make function supports to use package command\n---\n\nMaster Issue: #8676\n\n*Motivation*\n\nWe have a new package management service which can manage all\nthe packages. We can use that in the Pulsar Function which will\nmake the function packages are easier to manage.\n\n*Modifications*\n\n- Support new package type url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e40e17d09bed496d92856817b409b51d94090b4", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/5e40e17d09bed496d92856817b409b51d94090b4", "committedDate": "2020-12-17T09:40:29Z", "message": "Add unit tests and support package name for update function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjEzMDUz", "url": "https://github.com/apache/pulsar/pull/8973#pullrequestreview-558213053", "createdAt": "2020-12-23T20:24:40Z", "commit": {"oid": "5e40e17d09bed496d92856817b409b51d94090b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDoyNDo0MVrOIKz3dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDoyNDo0MVrOIKz3dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIwNjQ1Mg==", "bodyText": "Don't we need authentication and authorization plugin for downloading the packages?", "url": "https://github.com/apache/pulsar/pull/8973#discussion_r548206452", "createdAt": "2020-12-23T20:24:41Z", "author": {"login": "sijie"}, "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntime.java", "diffHunk": "@@ -868,6 +876,39 @@ public void deleteService() throws InterruptedException {\n                 userCodeFilePath);\n     }\n \n+    private List<String> getPackageDownloadCommand(String packageName, String userCodeFilePath) {\n+        // add auth plugin and parameters if necessary\n+        if (authenticationEnabled && authConfig != null) {\n+            if (isNotBlank(authConfig.getClientAuthenticationPlugin())\n+                && isNotBlank(authConfig.getClientAuthenticationParameters())\n+                && instanceConfig.getFunctionAuthenticationSpec() != null) {\n+                return Arrays.asList(\n+                    pulsarRootDir + configAdminCLI,\n+                    \"--auth-plugin\",\n+                    authConfig.getClientAuthenticationPlugin(),\n+                    \"--auth-params\",\n+                    authConfig.getClientAuthenticationParameters(),\n+                    \"--admin-url\",\n+                    pulsarAdminUrl,\n+                    \"packages\",\n+                    \"download\",\n+                    packageName,\n+                    \"--path\",\n+                    userCodeFilePath);\n+            }\n+        }\n+\n+        return Arrays.asList(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e40e17d09bed496d92856817b409b51d94090b4"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3b8dfb2bbf8826e8999398f9346b46d890c44b8", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/f3b8dfb2bbf8826e8999398f9346b46d890c44b8", "committedDate": "2020-12-29T01:02:56Z", "message": "Merge remote-tracking branch 'apache/master' into package-management-function-runtime"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDM5NDI1", "url": "https://github.com/apache/pulsar/pull/8973#pullrequestreview-559439425", "createdAt": "2020-12-29T09:05:40Z", "commit": {"oid": "f3b8dfb2bbf8826e8999398f9346b46d890c44b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5ODkwMDg4", "url": "https://github.com/apache/pulsar/pull/8973#pullrequestreview-559890088", "createdAt": "2020-12-30T06:19:14Z", "commit": {"oid": "f3b8dfb2bbf8826e8999398f9346b46d890c44b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 954, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}