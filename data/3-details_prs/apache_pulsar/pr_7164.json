{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NTcxNzY3", "number": 7164, "title": "fix get partitioned metadata  throws NullPointerException", "bodyText": "Master Issue: #7163\nMotivation\nSometimes get partitioned metadata will throws NullPointerException, because the NamespaceService not initialized yet , so needed a judgment .\nModifications\nBrokerService\n        if(pulsar.getNamespaceService() == null){\n            return CompletableFuture.completedFuture(null);\n        }", "createdAt": "2020-06-04T03:53:25Z", "url": "https://github.com/apache/pulsar/pull/7164", "merged": true, "mergeCommit": {"oid": "844b2ec7816cba2e9c75b1fba151b065f631d5f6"}, "closed": true, "closedAt": "2020-06-08T02:30:24Z", "author": {"login": "liudezhi2098"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn2n6kABqjM0MDUwMjcyNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpHDg2gFqTQyNTg4NTExOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd40922b6867d0e629d8f1d8f416226b80883024", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/dd40922b6867d0e629d8f1d8f416226b80883024", "committedDate": "2020-06-04T03:43:40Z", "message": "fix get partitioned metadata  throws NullPointerException"}, "afterCommit": {"oid": "419fd5c7b8c8282c25b1731df65a2ce56ffd5687", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/419fd5c7b8c8282c25b1731df65a2ce56ffd5687", "committedDate": "2020-06-04T04:46:54Z", "message": "fix get partitioned metadata  throws NullPointerException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NDA1NDg2", "url": "https://github.com/apache/pulsar/pull/7164#pullrequestreview-424405486", "createdAt": "2020-06-04T12:48:52Z", "commit": {"oid": "419fd5c7b8c8282c25b1731df65a2ce56ffd5687"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NTcwNzEz", "url": "https://github.com/apache/pulsar/pull/7164#pullrequestreview-424570713", "createdAt": "2020-06-04T15:30:12Z", "commit": {"oid": "419fd5c7b8c8282c25b1731df65a2ce56ffd5687"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozMDoxMlrOGfLl2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozMDoxMlrOGfLl2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM0ODk1NQ==", "bodyText": "We should return an error in the future at this point, otherwise we're moving the NPE somewhere else", "url": "https://github.com/apache/pulsar/pull/7164#discussion_r435348955", "createdAt": "2020-06-04T15:30:12Z", "author": {"login": "merlimat"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "diffHunk": "@@ -1918,6 +1918,9 @@ private void createPendingLoadTopic() {\n     }\n \n     public CompletableFuture<PartitionedTopicMetadata> fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(TopicName topicName) {\n+        if(pulsar.getNamespaceService() == null){\n+            return CompletableFuture.completedFuture(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "419fd5c7b8c8282c25b1731df65a2ce56ffd5687"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5a16778683fbc87955b010dfe97872a75231fd9", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/e5a16778683fbc87955b010dfe97872a75231fd9", "committedDate": "2020-06-05T06:13:05Z", "message": "fix get partitioned metadata  throws NullPointerException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db934b901479aa62a70634762467a4867ecd5d25", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/db934b901479aa62a70634762467a4867ecd5d25", "committedDate": "2020-06-05T06:13:05Z", "message": " return an error in the future"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a632177af609ff39b1ab99bdd6103a54c2f400e", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/3a632177af609ff39b1ab99bdd6103a54c2f400e", "committedDate": "2020-06-05T03:57:50Z", "message": " return an error in the future"}, "afterCommit": {"oid": "db934b901479aa62a70634762467a4867ecd5d25", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/db934b901479aa62a70634762467a4867ecd5d25", "committedDate": "2020-06-05T06:13:05Z", "message": " return an error in the future"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODcyNzQz", "url": "https://github.com/apache/pulsar/pull/7164#pullrequestreview-425872743", "createdAt": "2020-06-08T01:19:17Z", "commit": {"oid": "db934b901479aa62a70634762467a4867ecd5d25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMToxOToxN1rOGgNEYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMToxOToxN1rOGgNEYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyMTczMA==", "bodyText": "I think we should return an explicit error to tell the application that the namespace service is not ready.", "url": "https://github.com/apache/pulsar/pull/7164#discussion_r436421730", "createdAt": "2020-06-08T01:19:17Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "diffHunk": "@@ -1918,6 +1918,9 @@ private void createPendingLoadTopic() {\n     }\n \n     public CompletableFuture<PartitionedTopicMetadata> fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(TopicName topicName) {\n+        if(pulsar.getNamespaceService() == null){\n+            return FutureUtil.failedFuture(new NullPointerException(\"namespaceService is null\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db934b901479aa62a70634762467a4867ecd5d25"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODg1MTE4", "url": "https://github.com/apache/pulsar/pull/7164#pullrequestreview-425885118", "createdAt": "2020-06-08T02:30:09Z", "commit": {"oid": "db934b901479aa62a70634762467a4867ecd5d25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2766, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}