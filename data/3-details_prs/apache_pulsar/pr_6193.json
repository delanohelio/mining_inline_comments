{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNDExMDI4", "number": 6193, "title": "Fix get schema version in HttpLookupService.", "bodyText": "Motivation\nFix get schema version in HttpLookupService.  The com.yahoo.sketches.Util.bytesToLong method need to flip the byte[]. Otherwise, will get a wrong long value. So use ByteBuffer to convert byte[] version to long.\nThis issue will happens when users use http protocol client and multiple version schemas.\nVerifying this change\nNew tests added for HttpLookupService and BinaryLookupService.\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (yes)\nThe default values of configurations: (no)\nThe wire protocol: (no)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (no)", "createdAt": "2020-02-03T16:35:44Z", "url": "https://github.com/apache/pulsar/pull/6193", "merged": true, "mergeCommit": {"oid": "44dd4129941ebf4018509ac77b9dda7efc64febe"}, "closed": true, "closedAt": "2020-02-07T00:43:03Z", "author": {"login": "codelipenghui"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAvfqKAH2gAyMzcwNDExMDI4OjEwZWM4ZmVjZTc4MGQ2ZTAzYzM5NDY2ZDJlNTQ1ZjkxZTRjZDI2MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBzp_nAH2gAyMzcwNDExMDI4OjYzZjhjNWE5NjdmYjJkNTQ2NzkzZjVmZTY0MTViN2EzYjIwZDc3MTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "10ec8fece780d6e03c39466d2e545f91e4cd2634", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/10ec8fece780d6e03c39466d2e545f91e4cd2634", "committedDate": "2020-02-03T16:26:12Z", "message": "Fix get schema version in HttpLookupService."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDQ5MTUw", "url": "https://github.com/apache/pulsar/pull/6193#pullrequestreview-352449150", "createdAt": "2020-02-03T18:00:08Z", "commit": {"oid": "10ec8fece780d6e03c39466d2e545f91e4cd2634"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODowMDowOVrOFk6hOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxODowMDowOVrOFk6hOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI1MTgzMw==", "bodyText": "hmm. this would result in copying memory. and it is not thread-safe.\nI would suggest just using ByteBuffer.wrap(bytes) to get a ByteBuffer and then read the long number.", "url": "https://github.com/apache/pulsar/pull/6193#discussion_r374251833", "createdAt": "2020-02-03T18:00:09Z", "author": {"login": "sijie"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java", "diffHunk": "@@ -176,5 +176,12 @@ public void close() throws Exception {\n         httpClient.close();\n     }\n \n+    private long bytesToLong(byte[] bytes) {\n+        schemaVersionConvertBuffer.clear();\n+        schemaVersionConvertBuffer.put(bytes, 0, bytes.length);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10ec8fece780d6e03c39466d2e545f91e4cd2634"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c5455a3748484cd1f75e35ce90f11cdfcfb20ff", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/1c5455a3748484cd1f75e35ce90f11cdfcfb20ff", "committedDate": "2020-02-04T00:39:14Z", "message": "Apply comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjY5MDEx", "url": "https://github.com/apache/pulsar/pull/6193#pullrequestreview-352669011", "createdAt": "2020-02-04T01:08:47Z", "commit": {"oid": "1c5455a3748484cd1f75e35ce90f11cdfcfb20ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9f0b74b131f3d8c90a3edc4dc72e415e6d0f1f5", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/c9f0b74b131f3d8c90a3edc4dc72e415e6d0f1f5", "committedDate": "2020-02-04T19:26:02Z", "message": "Merge remote-tracking branch 'apache/master' into fix_get_schema_by_version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d62818e4b6c24f4f8e0f81b340a5a1fe41ef3901", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/d62818e4b6c24f4f8e0f81b340a5a1fe41ef3901", "committedDate": "2020-02-06T13:04:16Z", "message": "Fix get schema version in HttpLookupService."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb079061013c53d8b0a9d284d95afab0c755efd", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/8eb079061013c53d8b0a9d284d95afab0c755efd", "committedDate": "2020-02-06T13:04:16Z", "message": "Apply comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9f0b74b131f3d8c90a3edc4dc72e415e6d0f1f5", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/c9f0b74b131f3d8c90a3edc4dc72e415e6d0f1f5", "committedDate": "2020-02-04T19:26:02Z", "message": "Merge remote-tracking branch 'apache/master' into fix_get_schema_by_version"}, "afterCommit": {"oid": "8eb079061013c53d8b0a9d284d95afab0c755efd", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/8eb079061013c53d8b0a9d284d95afab0c755efd", "committedDate": "2020-02-06T13:04:16Z", "message": "Apply comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca8886e64c2f36731bf8bae8e758886abc5258dd", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/ca8886e64c2f36731bf8bae8e758886abc5258dd", "committedDate": "2020-02-06T23:50:41Z", "message": "Merge remote-tracking branch 'codelipenghui/fix_get_schema_by_version' into fix_get_schema_by_version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63f8c5a967fb2d546793f5fe6415b7a3b20d7718", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/63f8c5a967fb2d546793f5fe6415b7a3b20d7718", "committedDate": "2020-02-06T23:51:02Z", "message": "Merge remote-tracking branch 'apache/master' into fix_get_schema_by_version"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1378, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}