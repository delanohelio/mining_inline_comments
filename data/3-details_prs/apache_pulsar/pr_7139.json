{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2NDUzMTgw", "number": 7139, "title": "Support KeyValue Schema Use Null Key And Null Value", "bodyText": "Fixes #4804\nThanks, @nlu90, work at #6384.\nMotivation\nCurrently, the KeyValue schema doesn't handle null key and null value well.\nModifications\nMake the KeyValue schema support null key and null value\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\nThis change added tests and can be verified as follows:\n\nAdd unit test.\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (no)\nThe default values of configurations: (no)\nThe wire protocol: (yes)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes)\nIf yes, how is the feature documented? (JavaDocs)", "createdAt": "2020-06-02T09:08:49Z", "url": "https://github.com/apache/pulsar/pull/7139", "merged": true, "mergeCommit": {"oid": "1d5ff26ba42fb7ce6d9284d5bcffc1e3686a6f64"}, "closed": true, "closedAt": "2020-06-04T14:01:14Z", "author": {"login": "gaoran10"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnRXrvgBqjMzOTY3MjM4OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn9pBugFqTQyNDQxMzA0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdd94ecd49cf7435bb05012e87876c24d02e626b", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/cdd94ecd49cf7435bb05012e87876c24d02e626b", "committedDate": "2020-06-02T08:56:18Z", "message": "support keyValue schema use null key or null value"}, "afterCommit": {"oid": "c1e56ed90a46844394af1a684da26e976966746f", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/c1e56ed90a46844394af1a684da26e976966746f", "committedDate": "2020-06-02T09:18:14Z", "message": "support keyValue schema use null key or null value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25fcd02d2a49631c9d485dbae63286541bf06a02", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/25fcd02d2a49631c9d485dbae63286541bf06a02", "committedDate": "2020-06-03T13:45:26Z", "message": "support keyValue schema use null key or null value"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f028365bc3ade32e0cdbf6984c7653ddef2d160", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/1f028365bc3ade32e0cdbf6984c7653ddef2d160", "committedDate": "2020-06-03T11:35:19Z", "message": "Merge remote-tracking branch 'apache/master' into support-keyvalue-null"}, "afterCommit": {"oid": "25fcd02d2a49631c9d485dbae63286541bf06a02", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/25fcd02d2a49631c9d485dbae63286541bf06a02", "committedDate": "2020-06-03T13:45:26Z", "message": "support keyValue schema use null key or null value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDE5MzE1", "url": "https://github.com/apache/pulsar/pull/7139#pullrequestreview-424019315", "createdAt": "2020-06-04T00:15:18Z", "commit": {"oid": "25fcd02d2a49631c9d485dbae63286541bf06a02"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMDoxNToxOFrOGexp9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMDoxNTo0MVrOGexqVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkyNDAyMg==", "bodyText": "It's better to use null_partition_key here since we have partition_key and ordering key in the proto. Use null_partition_key will be more accurate.", "url": "https://github.com/apache/pulsar/pull/7139#discussion_r434924022", "createdAt": "2020-06-04T00:15:18Z", "author": {"login": "codelipenghui"}, "path": "pulsar-common/src/main/proto/PulsarApi.proto", "diffHunk": "@@ -143,6 +143,9 @@ message MessageMetadata {\n \toptional int32 num_chunks_from_msg = 27;\n \toptional int32 total_chunk_msg_size = 28;\n \toptional int32 chunk_id = 29;\n+\n+    // Indicate if the message key is set\n+    optional bool null_key = 30 [default = false];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25fcd02d2a49631c9d485dbae63286541bf06a02"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkyNDExOA==", "bodyText": "Same as the above comment.", "url": "https://github.com/apache/pulsar/pull/7139#discussion_r434924118", "createdAt": "2020-06-04T00:15:41Z", "author": {"login": "codelipenghui"}, "path": "pulsar-common/src/main/proto/PulsarApi.proto", "diffHunk": "@@ -161,6 +164,8 @@ message SingleMessageMetadata {\n     optional uint64 sequence_id = 8;\n     // Indicate if the message payload value is set\n     optional bool null_value = 9 [ default = false ];\n+    // Indicate if the message key is set\n+    optional bool null_key = 10 [ default = false];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25fcd02d2a49631c9d485dbae63286541bf06a02"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc1b81da0f4ad4ffe3023687c78605aa438483c", "author": {"user": {"login": "gaoran10", "name": "ran"}}, "url": "https://github.com/apache/pulsar/commit/6dc1b81da0f4ad4ffe3023687c78605aa438483c", "committedDate": "2020-06-04T05:55:54Z", "message": "change `null_key` to `null_partition_key`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MTcwMzE4", "url": "https://github.com/apache/pulsar/pull/7139#pullrequestreview-424170318", "createdAt": "2020-06-04T07:25:48Z", "commit": {"oid": "6dc1b81da0f4ad4ffe3023687c78605aa438483c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NDEzMDQ1", "url": "https://github.com/apache/pulsar/pull/7139#pullrequestreview-424413045", "createdAt": "2020-06-04T12:58:09Z", "commit": {"oid": "6dc1b81da0f4ad4ffe3023687c78605aa438483c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2751, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}