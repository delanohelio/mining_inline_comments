{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NjQ4OTA5", "number": 8173, "title": "[Issue 8154] [Python client] Expose schema version (of writerSchema) in Message", "bodyText": "Fixes #8176", "createdAt": "2020-09-30T16:55:50Z", "url": "https://github.com/apache/pulsar/pull/8173", "merged": true, "mergeCommit": {"oid": "54d6811bf163fae6cae569c77c2537e33012cfdc"}, "closed": true, "closedAt": "2020-10-28T08:50:55Z", "author": {"login": "shiv4289"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN_b2CgH2gAyNDk1NjQ4OTA5OjYxYmE3ZGQ1MmI5OWFjMjIyMGE2OTBlZTc5MmY5MmJiODZlN2Y5OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABesBjyXgFqTcwOTkzNTY2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61ba7dd52b99ac2220a690ee792f92bb86e7f995", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/61ba7dd52b99ac2220a690ee792f92bb86e7f995", "committedDate": "2020-09-30T16:32:41Z", "message": "[Issue 8154] Expose schema version (of writerSchema) in python client message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d99fa6978ad808b745958a9a52b0e8e3fd85c1a4", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/d99fa6978ad808b745958a9a52b0e8e3fd85c1a4", "committedDate": "2020-10-01T11:05:59Z", "message": "Adding formating suggestion on PR#8173 to fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "488f9c822cfd3be45d649a55d26411bf8389058e", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/488f9c822cfd3be45d649a55d26411bf8389058e", "committedDate": "2020-10-01T12:40:02Z", "message": "Fixing build issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dce3c2bac1c5f4d4d9f6acc946b0882b7845cfc", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/4dce3c2bac1c5f4d4d9f6acc946b0882b7845cfc", "committedDate": "2020-10-01T14:57:34Z", "message": "Added a test for python client returning schema version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7b013c7ef26c1148665b4e87b77fae3fec6aa1d", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/d7b013c7ef26c1148665b4e87b77fae3fec6aa1d", "committedDate": "2020-10-02T01:58:53Z", "message": "Added one more test case for python client returning schema version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c52c51dbd21193ef4cd35647b98382458c5739e3", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/c52c51dbd21193ef4cd35647b98382458c5739e3", "committedDate": "2020-10-21T17:34:18Z", "message": "Merge remote-tracking branch 'apache/master' into schema-version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MzEzNDEy", "url": "https://github.com/apache/pulsar/pull/8173#pullrequestreview-517313412", "createdAt": "2020-10-27T02:56:55Z", "commit": {"oid": "c52c51dbd21193ef4cd35647b98382458c5739e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMjo1Njo1NlrOHopnyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMjo1Njo1NlrOHopnyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4NzAxNg==", "bodyText": "We should call subscribe before send like what other unit tests do, otherwise the consumer will stuck at receive.", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r512387016", "createdAt": "2020-10-27T02:56:56Z", "author": {"login": "BewareMyPower"}, "path": "pulsar-client-cpp/python/schema_test.py", "diffHunk": "@@ -354,6 +354,32 @@ class Example(Record):\n         self.assertEqual(r2.__class__.__name__, 'Example')\n         self.assertEqual(r2, r)\n \n+    def test_schema_version(self):\n+        class Example(Record):\n+            a = Integer()\n+            b = Integer()\n+\n+        client = pulsar.Client(self.serviceUrl)\n+        producer = client.create_producer(\n+                        'my-avro-python-schema-version-topic',\n+                        schema=AvroSchema(Example))\n+\n+        r = Example(a=1, b=2)\n+        producer.send(r)\n+\n+        consumer = client.subscribe('my-avro-python-schema-version-topic', 'sub-1',\n+                                    schema=AvroSchema(Example))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c52c51dbd21193ef4cd35647b98382458c5739e3"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "519ef04b3d55a0593df8f905a9f676ae097e8122", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/519ef04b3d55a0593df8f905a9f676ae097e8122", "committedDate": "2020-10-28T04:15:06Z", "message": "Fix test- move subscribe before send so the consumer offset is ahead of new data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MzI1Njkx", "url": "https://github.com/apache/pulsar/pull/8173#pullrequestreview-518325691", "createdAt": "2020-10-28T05:02:27Z", "commit": {"oid": "519ef04b3d55a0593df8f905a9f676ae097e8122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwNTowMjoyN1rOHpaJ6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwNTowMjoyN1rOHpaJ6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE4MjE4Ng==", "bodyText": "int.from_bytes is a Python3 method, but CI environment use Python2 to test. You need to use another method to convert bytes to int.", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r513182186", "createdAt": "2020-10-28T05:02:27Z", "author": {"login": "BewareMyPower"}, "path": "pulsar-client-cpp/python/schema_test.py", "diffHunk": "@@ -354,6 +354,32 @@ class Example(Record):\n         self.assertEqual(r2.__class__.__name__, 'Example')\n         self.assertEqual(r2, r)\n \n+    def test_schema_version(self):\n+        class Example(Record):\n+            a = Integer()\n+            b = Integer()\n+\n+        client = pulsar.Client(self.serviceUrl)\n+        producer = client.create_producer(\n+                        'my-avro-python-schema-version-topic',\n+                        schema=AvroSchema(Example))\n+\n+        consumer = client.subscribe('my-avro-python-schema-version-topic', 'sub-1',\n+                                    schema=AvroSchema(Example))\n+        \n+        r = Example(a=1, b=2)\n+        producer.send(r)\n+\n+        msg = consumer.receive()\n+\n+        self.assertIsNotNone(msg.schema_version())\n+\n+        self.assertEqual(0, int.from_bytes(msg.schema_version().encode(), byteorder='big'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "519ef04b3d55a0593df8f905a9f676ae097e8122"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28", "committedDate": "2020-10-28T05:42:25Z", "message": "Fix test to make it run on python 2 and 3 both"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDM1Mzgy", "url": "https://github.com/apache/pulsar/pull/8173#pullrequestreview-518435382", "createdAt": "2020-10-28T08:49:41Z", "commit": {"oid": "02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzA5OTM1NjYw", "url": "https://github.com/apache/pulsar/pull/8173#pullrequestreview-709935660", "createdAt": "2021-07-19T20:10:03Z", "commit": {"oid": "02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xOVQyMDoxMDowM1rOKBcDJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xOVQyMDoxMDowM1rOKBcDJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjU5Njc3NQ==", "bodyText": "Am I correct that this (and other two) functions were never implemented?", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r672596775", "createdAt": "2021-07-19T20:10:03Z", "author": {"login": "migmit"}, "path": "pulsar-client-cpp/include/pulsar/c/message.h", "diffHunk": "@@ -200,6 +200,12 @@ PULSAR_PUBLIC const char *pulsar_message_get_topic_name(pulsar_message_t *messag\n \n PULSAR_PUBLIC int pulsar_message_get_redelivery_count(pulsar_message_t *message);\n \n+PULSAR_PUBLIC int pulsar_message_has_schema_version(pulsar_message_t *message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 132, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}