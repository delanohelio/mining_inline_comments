{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NTg4ODIx", "number": 6489, "title": "[broker] Timeout API calls in BrokerService", "bodyText": "See #6416. This change ensures that all futures within BrokerService\nhave a guranteed timeout. As stated in #6416, we see cases where it\nappears that loading or creating a topic fails to resolve the future for\nunknown reasons. It appears that these futures may not be returning.\nMotivation\nThis commit just adds a deadline for all the futures created in brokerService.\nThis seems like a sane change to make to ensure that these futures\nfinish, however, it still isn't understood under what conditions these\nfutures may not be returning, so this fix is mostly a workaround for\nsome underlying issues.\nVerifying this change\nThis change is already covered by existing tests, such as the broker tests\n(or)\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): n\nThe public API:n\nThe schema: n\nThe default values of configurations: n\nThe wire protocol:n\nThe rest endpoints: n\nThe admin cli options: n\nAnything that affects deployment: n\n\nDocumentation\n\nDoes this pull request introduce a new feature? n\nIf yes, how is the feature documented? n/a\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-03-06T01:31:02Z", "url": "https://github.com/apache/pulsar/pull/6489", "merged": true, "mergeCommit": {"oid": "4a4cce9c2047e1ae1102756d1f53532fcf2dced5"}, "closed": true, "closedAt": "2020-03-18T01:49:13Z", "author": {"login": "addisonj"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK1ytggH2gAyMzg0NTg4ODIxOjdhOTJhNmYyYjVmZDlhNzMyNThhYmI0ZTVhN2RjNGEzYTQwMDU2NGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOtUcmgFqTM3NjUxMzU3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a92a6f2b5fd9a73258abb4e5a7dc4a3a400564b", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/7a92a6f2b5fd9a73258abb4e5a7dc4a3a400564b", "committedDate": "2020-03-06T01:25:41Z", "message": "[broker] Timeout API calls in BrokerService\n\nSee #6416. This change ensures that all futures within BrokerService\nhave a guranteed timeout. As stated in #6416, we see cases where it\nappears that loading or creating a topic fails to resolve the future for\nunknown reasons. It appears that these futures *may* not be returning.\nThis seems like a sane change to make to ensure that these futures\nfinish, however, it still isn't understood under what conditions these\nfutures may not be returning, so this fix is mostly a workaround for\nsome underlying issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjc4NDQw", "url": "https://github.com/apache/pulsar/pull/6489#pullrequestreview-370678440", "createdAt": "2020-03-06T23:04:25Z", "commit": {"oid": "7a92a6f2b5fd9a73258abb4e5a7dc4a3a400564b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMzowNDoyNVrOFzKBkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMzowNDoyNVrOFzKBkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE4NTkzNg==", "bodyText": "Can we move this into FutureUtil class?", "url": "https://github.com/apache/pulsar/pull/6489#discussion_r389185936", "createdAt": "2020-03-06T23:04:25Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "diffHunk": "@@ -732,6 +733,20 @@ public void unloadNamespaceBundlesGracefully() {\n         return future;\n     }\n \n+    private <T> CompletableFuture<T> futureWithDeadline(Long delay, TimeUnit unit, Exception exp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a92a6f2b5fd9a73258abb4e5a7dc4a3a400564b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTEzNTc2", "url": "https://github.com/apache/pulsar/pull/6489#pullrequestreview-376513576", "createdAt": "2020-03-18T01:49:06Z", "commit": {"oid": "7a92a6f2b5fd9a73258abb4e5a7dc4a3a400564b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4992, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}