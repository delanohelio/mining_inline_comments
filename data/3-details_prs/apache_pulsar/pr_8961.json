{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMDU4Njk5", "number": 8961, "title": "Fixes the recovery not respect to the isolation group settings", "bodyText": "Motivation\nWhen users configure to use ZkIsolatedBookieEnsemblePlacementPolicy,\nit is hard to configure AutoRecovery to respect to the isolation group\nsettings. Because we don't store the isolation group information as\npart of ledger metadata, the framework doesn't have any information\nto use for choosing the bookies.\nModifications\n\nChange the ZkIsolatedBookieEnsemblePlacementPolicy to use the policy\npassed from the custom metadata", "createdAt": "2020-12-15T08:04:45Z", "url": "https://github.com/apache/pulsar/pull/8961", "merged": true, "mergeCommit": {"oid": "bddd030aa1a0b8b3b1767b337880baeb35662ffd"}, "closed": true, "closedAt": "2020-12-30T10:24:22Z", "author": {"login": "zymap"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmVqsmAH2gAyNTQwMDU4Njk5OjhmMDg0ODNjODM5MmYzNDU3OWY5MGViZjE0NDEzMGFiZjZkMzExYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrMs8mAFqTU1OTk5MDA4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/8f08483c8392f34579f90ebf144130abf6d311a3", "committedDate": "2020-12-15T08:01:00Z", "message": "Fixes the recovery not respect to the isolation group settings\n---\n\n*Motivation*\n\nWhen users configure to use ZkIsolatedBookieEnsemblePlacementPolicy,\nit is hard to configure AutoRecovery to respect to the isolation group\nsettings. Because we don't store the isolation group information as\npart of ledger metadata, the framework doesn't have any information\nto use for choosing the bookies.\n\n*Modifications*\n\n- Change the ZkIsolatedBookieEnsemblePlacementPolicy to use the policy\npassed from the custommetadata"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMjg2OTE1", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-552286915", "createdAt": "2020-12-15T10:02:36Z", "commit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDowMjozNlrOIGCs3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDowMjozNlrOIGCs3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIwNjYyMA==", "bodyText": "for auto recovery case, here should be a clear and add; only add is not enough", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r543206620", "createdAt": "2020-12-15T10:02:36Z", "author": {"login": "jiazhai"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -74,23 +78,26 @@ public RackawareEnsemblePlacementPolicyImpl initialize(ClientConfiguration conf,\n         if (conf.getProperty(ISOLATION_BOOKIE_GROUPS) != null) {\n             String isolationGroupsString = castToString(conf.getProperty(ISOLATION_BOOKIE_GROUPS));\n             if (!isolationGroupsString.isEmpty()) {\n-                for (String isolationGroup : isolationGroupsString.split(\",\")) {\n-                    primaryIsolationGroups.add(isolationGroup);\n-                }\n+                fillIsolationGroup(isolationGroupsString, \"\");\n                 bookieMappingCache = getAndSetZkCache(conf);\n             }\n         }\n         if (conf.getProperty(SECONDARY_ISOLATION_BOOKIE_GROUPS) != null) {\n             String secondaryIsolationGroupsString = castToString(conf.getProperty(SECONDARY_ISOLATION_BOOKIE_GROUPS));\n-            if (!secondaryIsolationGroupsString.isEmpty()) {\n-                for (String isolationGroup : secondaryIsolationGroupsString.split(\",\")) {\n-                    secondaryIsolationGroups.add(isolationGroup);\n-                }\n-            }\n+            fillIsolationGroup(\"\", secondaryIsolationGroupsString);\n         }\n         return super.initialize(conf, optionalDnsResolver, timer, featureProvider, statsLogger, bookieAddressResolver);\n     }\n \n+    private void fillIsolationGroup(String isolationBookieGroups, String secondaryIsolationBookieGroups) {\n+        if (!isolationBookieGroups.isEmpty()) {\n+            primaryIsolationGroups.addAll(Arrays.asList(isolationBookieGroups.split(\",\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNTExMzc2", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-552511376", "createdAt": "2020-12-15T14:25:15Z", "commit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNDoyNToxNVrOIGN7fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNDoyNzo0M1rOIGOETw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5MDU5MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // parse the ensemble placement policy from the custom metadata, if it present, we will apply it to\n          \n          \n            \n                    // parse the ensemble placement policy from the custom metadata, if it's present, we will apply it to", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r543390591", "createdAt": "2020-12-15T14:25:15Z", "author": {"login": "jbampton"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -134,6 +141,11 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n     public PlacementResult<List<BookieId>> newEnsemble(int ensembleSize, int writeQuorumSize, int ackQuorumSize,\n             Map<String, byte[]> customMetadata, Set<BookieId> excludeBookies)\n             throws BKNotEnoughBookiesException {\n+        // parse the ensemble placement policy from the custom metadata, if it present, we will apply it to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5MTQ1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // the isolation groups for filter the bookies.\n          \n          \n            \n                    // the isolation groups for filtering the bookies.", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r543391455", "createdAt": "2020-12-15T14:26:07Z", "author": {"login": "jbampton"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -134,6 +141,11 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n     public PlacementResult<List<BookieId>> newEnsemble(int ensembleSize, int writeQuorumSize, int ackQuorumSize,\n             Map<String, byte[]> customMetadata, Set<BookieId> excludeBookies)\n             throws BKNotEnoughBookiesException {\n+        // parse the ensemble placement policy from the custom metadata, if it present, we will apply it to\n+        // the isolation groups for filter the bookies.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5MTg4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // parse the ensemble placement policy from the custom metadata, if it present, we will apply it to\n          \n          \n            \n                    // parse the ensemble placement policy from the custom metadata, if it's present, we will apply it to", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r543391882", "createdAt": "2020-12-15T14:26:37Z", "author": {"login": "jbampton"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -147,6 +159,11 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n             Map<String, byte[]> customMetadata, List<BookieId> currentEnsemble,\n             BookieId bookieToReplace, Set<BookieId> excludeBookies)\n             throws BKNotEnoughBookiesException {\n+        // parse the ensemble placement policy from the custom metadata, if it present, we will apply it to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5Mjg0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // the isolation groups for filter the bookies.\n          \n          \n            \n                    // the isolation groups for filtering the bookies.", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r543392847", "createdAt": "2020-12-15T14:27:43Z", "author": {"login": "jbampton"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -147,6 +159,11 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n             Map<String, byte[]> customMetadata, List<BookieId> currentEnsemble,\n             BookieId bookieToReplace, Set<BookieId> excludeBookies)\n             throws BKNotEnoughBookiesException {\n+        // parse the ensemble placement policy from the custom metadata, if it present, we will apply it to\n+        // the isolation groups for filter the bookies.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f08483c8392f34579f90ebf144130abf6d311a3"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84328ad9944a09414ffcb6f7bfcd804b51d225b9", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/84328ad9944a09414ffcb6f7bfcd804b51d225b9", "committedDate": "2020-12-16T01:23:42Z", "message": "Add tests for the changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e788dee5d34dce0278e53e41af8bf65b49bec7cf", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/e788dee5d34dce0278e53e41af8bf65b49bec7cf", "committedDate": "2020-12-16T04:17:28Z", "message": "Fix the tests and address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNDQyNTY0", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-553442564", "createdAt": "2020-12-16T08:13:11Z", "commit": {"oid": "e788dee5d34dce0278e53e41af8bf65b49bec7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODoxMzoxMVrOIG42xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODoxMzoxMVrOIG42xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA5Mzg5Mg==", "bodyText": "it's better to move the placement policy ledger metadata to the LedgerMetadataUtils.java. Currently, all of the different types of ledger metadata is generated from the LedgerMetadataUtils.java", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r544093892", "createdAt": "2020-12-16T08:13:11Z", "author": {"login": "codelipenghui"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "diffHunk": "@@ -3239,6 +3250,21 @@ protected void asyncCreateLedger(BookKeeper bookKeeper, ManagedLedgerConfig conf\n         Map<String, byte[]> finalMetadata = new HashMap<>();\n         finalMetadata.putAll(ledgerMetadata);\n         finalMetadata.putAll(metadata);\n+        if (config.getBookKeeperEnsemblePlacementPolicyClassName() != null) {\n+            EnsemblePlacementPolicyConfig ensemblePlacementPolicyConfig = new EnsemblePlacementPolicyConfig(\n+                config.getBookKeeperEnsemblePlacementPolicyClassName(),\n+                config.getBookKeeperEnsemblePlacementPolicyProperties()\n+            );\n+            try {\n+                finalMetadata.put(EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG,\n+                    ensemblePlacementPolicyConfig.encode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e788dee5d34dce0278e53e41af8bf65b49bec7cf"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c6bdffb87a07f53b1e12ca6a2e0467d3b15a04f", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/9c6bdffb87a07f53b1e12ca6a2e0467d3b15a04f", "committedDate": "2020-12-16T10:09:29Z", "message": "Address the comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNzQyOTgz", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-553742983", "createdAt": "2020-12-16T14:32:49Z", "commit": {"oid": "e788dee5d34dce0278e53e41af8bf65b49bec7cf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDozMjo0OVrOIHIL8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDozMjo0OVrOIHIL8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM0NTA3Mw==", "bodyText": "so this is the fix.\ncan you please remove all unnecessary code formatting ?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r544345073", "createdAt": "2020-12-16T14:32:49Z", "author": {"login": "eolivelli"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -142,11 +141,6 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n     public PlacementResult<List<BookieId>> newEnsemble(int ensembleSize, int writeQuorumSize, int ackQuorumSize,\n             Map<String, byte[]> customMetadata, Set<BookieId> excludeBookies)\n             throws BKNotEnoughBookiesException {\n-        // parse the ensemble placement policy from the custom metadata, if it present, we will apply it to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e788dee5d34dce0278e53e41af8bf65b49bec7cf"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e69713c91493d723a921aca7e9ecb0f3d92f6cc", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/6e69713c91493d723a921aca7e9ecb0f3d92f6cc", "committedDate": "2020-12-17T01:05:34Z", "message": "Remove unused import iterms"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Mjk1OTUy", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-554295952", "createdAt": "2020-12-17T05:47:57Z", "commit": {"oid": "6e69713c91493d723a921aca7e9ecb0f3d92f6cc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNTo0Nzo1OFrOIHltGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNTo0Nzo1OFrOIHltGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgyODY5OA==", "bodyText": "The change here has concurrent access issues. Because it resets the primary and secondary isolation groups. It will cause replacing bookies using the wrong group.\nAlso, I don't think the logic here is correct.\nI think we should record the group information in the custom metadata. when replacing a bookie, we need to lookup the bookies in the same group. If it is not an easy change to make here, we should try to build a new bookie ensemble placement policy to achieve this goal and can be used for autorecovery.", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r544828698", "createdAt": "2020-12-17T05:47:58Z", "author": {"login": "sijie"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -147,6 +157,11 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n             Map<String, byte[]> customMetadata, List<BookieId> currentEnsemble,\n             BookieId bookieToReplace, Set<BookieId> excludeBookies)\n             throws BKNotEnoughBookiesException {\n+        // parse the ensemble placement policy from the custom metadata, if it is present, we will apply it to\n+        // the isolation groups for filtering the bookies.\n+        Optional<EnsemblePlacementPolicyConfig> ensemblePlacementPolicyConfig =\n+            getEnsemblePlacementPolicyConfig(customMetadata);\n+        ensemblePlacementPolicyConfig.ifPresent(this::fillIsolationGroupWithEnsemblePlacementPolicyConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e69713c91493d723a921aca7e9ecb0f3d92f6cc"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MTU1MjYw", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-556155260", "createdAt": "2020-12-21T06:30:34Z", "commit": {"oid": "6e69713c91493d723a921aca7e9ecb0f3d92f6cc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNjozMDozNFrOIJNn8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwNjozMDozNFrOIJNn8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjUzMTMxMw==", "bodyText": "Here we are modification shared data structures.\nI think this is the problem that @sijie is pointing out", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r546531313", "createdAt": "2020-12-21T06:30:34Z", "author": {"login": "eolivelli"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -156,6 +171,38 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n                 bookieToReplace, excludeBookies);\n     }\n \n+    private Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(\n+        Map<String, byte[]> customMetadata) {\n+\n+        byte[] ensemblePlacementPolicyConfigData = customMetadata.get(\n+            EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG);\n+        if (ensemblePlacementPolicyConfigData != null) {\n+            try {\n+                return Optional.ofNullable(EnsemblePlacementPolicyConfig.decode(ensemblePlacementPolicyConfigData));\n+            } catch (JsonUtil.ParseJsonException e) {\n+                LOG.error(\"Failed to parse the ensemble placement policy config from the custom metadata\", e);\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private void fillIsolationGroupWithEnsemblePlacementPolicyConfig(\n+        EnsemblePlacementPolicyConfig ensemblePlacementPolicyConfig) {\n+\n+        String className = ZkIsolatedBookieEnsemblePlacementPolicy.class.getName();\n+        if (ensemblePlacementPolicyConfig.getPolicyClass().getName().equals(className)) {\n+            Map<String, Object> properties = ensemblePlacementPolicyConfig.getProperties();\n+            // Because of we may have different ensemblePolicyConfig from different ledgers, so clear\n+            // the isolation groups before refilling it.\n+            primaryIsolationGroups.clear();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e69713c91493d723a921aca7e9ecb0f3d92f6cc"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e71abedeb0d2b1ca985c68ed2288a2371de86ba2", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/e71abedeb0d2b1ca985c68ed2288a2371de86ba2", "committedDate": "2020-12-21T10:57:08Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NzYwODcy", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-556760872", "createdAt": "2020-12-22T01:24:08Z", "commit": {"oid": "e71abedeb0d2b1ca985c68ed2288a2371de86ba2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34b0818ac85c07663f18c734930768ecaa996e40", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/34b0818ac85c07663f18c734930768ecaa996e40", "committedDate": "2020-12-25T13:40:06Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d575f8e9631157ec6429bb9a47d61c0cfd907ecd", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/d575f8e9631157ec6429bb9a47d61c0cfd907ecd", "committedDate": "2020-12-28T00:33:00Z", "message": "Merge branch 'master' into fix-ledger-recover-isolation-group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5523613f99fd4fe377d449a5bec1cfd580f6778d", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/5523613f99fd4fe377d449a5bec1cfd580f6778d", "committedDate": "2020-12-28T02:48:25Z", "message": "Reduce the code duplicate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4OTg4ODQ2", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-558988846", "createdAt": "2020-12-28T04:07:29Z", "commit": {"oid": "5523613f99fd4fe377d449a5bec1cfd580f6778d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MDIyMTQz", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-559022143", "createdAt": "2020-12-28T07:16:37Z", "commit": {"oid": "e788dee5d34dce0278e53e41af8bf65b49bec7cf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNzoxNjozN1rOILzADA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNzoyMjozMlrOILzFmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MDg0NA==", "bodyText": "static ?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549240844", "createdAt": "2020-12-28T07:16:37Z", "author": {"login": "eolivelli"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -174,8 +168,11 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n                 bookieToReplace, excludeBookies);\n     }\n \n-    private Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(Map<String, byte[]> customMetadata) {\n-        byte[] ensemblePlacementPolicyConfigData = customMetadata.get(EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG);\n+    private Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e788dee5d34dce0278e53e41af8bf65b49bec7cf"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MTQ1MA==", "bodyText": "static ?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549241450", "createdAt": "2020-12-28T07:19:01Z", "author": {"login": "eolivelli"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -156,34 +177,79 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n                 bookieToReplace, excludeBookies);\n     }\n \n-    private Set<BookieId> getBlacklistedBookies(int ensembleSize) {\n-        Set<BookieId> blacklistedBookies = new HashSet<BookieId>();\n+    private Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(\n+        Map<String, byte[]> customMetadata) {\n+\n+        byte[] ensemblePlacementPolicyConfigData = customMetadata.get(\n+            EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG);\n+        if (ensemblePlacementPolicyConfigData != null) {\n+            try {\n+                return Optional.ofNullable(EnsemblePlacementPolicyConfig.decode(ensemblePlacementPolicyConfigData));\n+            } catch (JsonUtil.ParseJsonException e) {\n+                LOG.error(\"Failed to parse the ensemble placement policy config from the custom metadata\", e);\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private Map<String, List<String>> getDefaultIsolationGroups() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5523613f99fd4fe377d449a5bec1cfd580f6778d"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MTUzNA==", "bodyText": "static ?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549241534", "createdAt": "2020-12-28T07:19:14Z", "author": {"login": "eolivelli"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -156,34 +177,79 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n                 bookieToReplace, excludeBookies);\n     }\n \n-    private Set<BookieId> getBlacklistedBookies(int ensembleSize) {\n-        Set<BookieId> blacklistedBookies = new HashSet<BookieId>();\n+    private Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(\n+        Map<String, byte[]> customMetadata) {\n+\n+        byte[] ensemblePlacementPolicyConfigData = customMetadata.get(\n+            EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG);\n+        if (ensemblePlacementPolicyConfigData != null) {\n+            try {\n+                return Optional.ofNullable(EnsemblePlacementPolicyConfig.decode(ensemblePlacementPolicyConfigData));\n+            } catch (JsonUtil.ParseJsonException e) {\n+                LOG.error(\"Failed to parse the ensemble placement policy config from the custom metadata\", e);\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private Map<String, List<String>> getDefaultIsolationGroups() {\n+        Map<String, List<String>> isolationGroup = new HashMap<>();\n+        isolationGroup.put(ISOLATION_BOOKIE_GROUPS, primaryIsolationGroups);\n+        isolationGroup.put(SECONDARY_ISOLATION_BOOKIE_GROUPS, secondaryIsolationGroups);\n+        return isolationGroup;\n+    }\n+\n+    private Map<String, List<String>> getIsolationGroup(EnsemblePlacementPolicyConfig ensemblePlacementPolicyConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5523613f99fd4fe377d449a5bec1cfd580f6778d"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MjI2Ng==", "bodyText": "can we make this method 'static' ?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549242266", "createdAt": "2020-12-28T07:22:32Z", "author": {"login": "eolivelli"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -156,34 +177,79 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n                 bookieToReplace, excludeBookies);\n     }\n \n-    private Set<BookieId> getBlacklistedBookies(int ensembleSize) {\n-        Set<BookieId> blacklistedBookies = new HashSet<BookieId>();\n+    private Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(\n+        Map<String, byte[]> customMetadata) {\n+\n+        byte[] ensemblePlacementPolicyConfigData = customMetadata.get(\n+            EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG);\n+        if (ensemblePlacementPolicyConfigData != null) {\n+            try {\n+                return Optional.ofNullable(EnsemblePlacementPolicyConfig.decode(ensemblePlacementPolicyConfigData));\n+            } catch (JsonUtil.ParseJsonException e) {\n+                LOG.error(\"Failed to parse the ensemble placement policy config from the custom metadata\", e);\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private Map<String, List<String>> getDefaultIsolationGroups() {\n+        Map<String, List<String>> isolationGroup = new HashMap<>();\n+        isolationGroup.put(ISOLATION_BOOKIE_GROUPS, primaryIsolationGroups);\n+        isolationGroup.put(SECONDARY_ISOLATION_BOOKIE_GROUPS, secondaryIsolationGroups);\n+        return isolationGroup;\n+    }\n+\n+    private Map<String, List<String>> getIsolationGroup(EnsemblePlacementPolicyConfig ensemblePlacementPolicyConfig) {\n+        Map<String, List<String>> groups = new HashMap<>();\n+        String className = ZkIsolatedBookieEnsemblePlacementPolicy.class.getName();\n+        if (ensemblePlacementPolicyConfig.getPolicyClass().getName().equals(className)) {\n+            Map<String, Object> properties = ensemblePlacementPolicyConfig.getProperties();\n+            String primaryIsolationGroupString = castToString(properties.getOrDefault(ISOLATION_BOOKIE_GROUPS, \"\"));\n+            String secondaryIsolationGroupString = castToString(properties.getOrDefault(SECONDARY_ISOLATION_BOOKIE_GROUPS, \"\"));\n+            if (!primaryIsolationGroupString.isEmpty()) {\n+                List<String> primaryGroup = Arrays.asList(primaryIsolationGroupString.split(\",\"));\n+                groups.put(ISOLATION_BOOKIE_GROUPS, primaryGroup);\n+            }\n+            if (!secondaryIsolationGroupString.isEmpty()) {\n+                List<String> secondaryGroup = Arrays.asList(secondaryIsolationGroupString.split(\",\"));\n+                groups.put(SECONDARY_ISOLATION_BOOKIE_GROUPS, secondaryGroup);\n+            }\n+        }\n+        return groups;\n+    }\n+\n+    private Set<BookieId> getBlacklistedBookiesWithIsolationGroups(int ensembleSize,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5523613f99fd4fe377d449a5bec1cfd580f6778d"}, "originalPosition": 115}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5d6e138dc16b5665771a9262b579e8a7eac1ed3", "author": {"user": {"login": "codelipenghui", "name": "lipenghui"}}, "url": "https://github.com/apache/pulsar/commit/a5d6e138dc16b5665771a9262b579e8a7eac1ed3", "committedDate": "2020-12-28T11:42:52Z", "message": "Merge remote-tracking branch 'apache/master' into fix-ledger-recover-isolation-group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6d1c0cd25ea109d3f7908d7d8b0855c51470b1c", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/d6d1c0cd25ea109d3f7908d7d8b0855c51470b1c", "committedDate": "2020-12-29T00:59:25Z", "message": "Make some method static"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDAzOTk3", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-559403997", "createdAt": "2020-12-29T07:11:48Z", "commit": {"oid": "d6d1c0cd25ea109d3f7908d7d8b0855c51470b1c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNzoxMTo0OFrOIMImCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNzoyMTozNlrOIMIv2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NDYzNQ==", "bodyText": "Can we avoid introducing manager-ledger as the dependency of pulsar-zookeeper-utils?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549594635", "createdAt": "2020-12-29T07:11:48Z", "author": {"login": "sijie"}, "path": "pulsar-zookeeper-utils/pom.xml", "diffHunk": "@@ -106,6 +106,13 @@\n       <artifactId>simpleclient_caffeine</artifactId>\n     </dependency>\n \n+    <dependency>\n+      <groupId>${project.groupId}</groupId>\n+      <artifactId>managed-ledger</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6d1c0cd25ea109d3f7908d7d8b0855c51470b1c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NjI3NA==", "bodyText": "I'd suggest moving EnsemblePlacementPolicyConfig to pulsar-common. So it can be used in both pulsar-zookeeper-utils and managed-ledger.", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549596274", "createdAt": "2020-12-29T07:18:43Z", "author": {"login": "sijie"}, "path": "pulsar-zookeeper-utils/pom.xml", "diffHunk": "@@ -106,6 +106,13 @@\n       <artifactId>simpleclient_caffeine</artifactId>\n     </dependency>\n \n+    <dependency>\n+      <groupId>${project.groupId}</groupId>\n+      <artifactId>managed-ledger</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NDYzNQ=="}, "originalCommit": {"oid": "d6d1c0cd25ea109d3f7908d7d8b0855c51470b1c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NjczOQ==", "bodyText": "I think you can use Pair<Set<String>, Set<String>> instead of a HashMap. Because you only have two sets of groups, one is the primary group and the other one is a secondary group. A HashHamp introduces a lot of overheads.", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549596739", "createdAt": "2020-12-29T07:19:57Z", "author": {"login": "sijie"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -156,34 +177,79 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n                 bookieToReplace, excludeBookies);\n     }\n \n-    private Set<BookieId> getBlacklistedBookies(int ensembleSize) {\n-        Set<BookieId> blacklistedBookies = new HashSet<BookieId>();\n+    private static Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(\n+        Map<String, byte[]> customMetadata) {\n+\n+        byte[] ensemblePlacementPolicyConfigData = customMetadata.get(\n+            EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG);\n+        if (ensemblePlacementPolicyConfigData != null) {\n+            try {\n+                return Optional.ofNullable(EnsemblePlacementPolicyConfig.decode(ensemblePlacementPolicyConfigData));\n+            } catch (JsonUtil.ParseJsonException e) {\n+                LOG.error(\"Failed to parse the ensemble placement policy config from the custom metadata\", e);\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private Map<String, List<String>> getDefaultIsolationGroups() {\n+        Map<String, List<String>> isolationGroup = new HashMap<>();\n+        isolationGroup.put(ISOLATION_BOOKIE_GROUPS, primaryIsolationGroups);\n+        isolationGroup.put(SECONDARY_ISOLATION_BOOKIE_GROUPS, secondaryIsolationGroups);\n+        return isolationGroup;\n+    }\n+\n+    private static Map<String, List<String>> getIsolationGroup(EnsemblePlacementPolicyConfig ensemblePlacementPolicyConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6d1c0cd25ea109d3f7908d7d8b0855c51470b1c"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NzE0NQ==", "bodyText": "Can you create the defaultIsolationGroups when creating the ensemble placement policy? Because the default isolation groups don't change after creations, correct?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549597145", "createdAt": "2020-12-29T07:21:36Z", "author": {"login": "sijie"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "diffHunk": "@@ -156,34 +177,79 @@ private ZooKeeperCache getAndSetZkCache(Configuration conf) {\n                 bookieToReplace, excludeBookies);\n     }\n \n-    private Set<BookieId> getBlacklistedBookies(int ensembleSize) {\n-        Set<BookieId> blacklistedBookies = new HashSet<BookieId>();\n+    private static Optional<EnsemblePlacementPolicyConfig> getEnsemblePlacementPolicyConfig(\n+        Map<String, byte[]> customMetadata) {\n+\n+        byte[] ensemblePlacementPolicyConfigData = customMetadata.get(\n+            EnsemblePlacementPolicyConfig.ENSEMBLE_PLACEMENT_POLICY_CONFIG);\n+        if (ensemblePlacementPolicyConfigData != null) {\n+            try {\n+                return Optional.ofNullable(EnsemblePlacementPolicyConfig.decode(ensemblePlacementPolicyConfigData));\n+            } catch (JsonUtil.ParseJsonException e) {\n+                LOG.error(\"Failed to parse the ensemble placement policy config from the custom metadata\", e);\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    private Map<String, List<String>> getDefaultIsolationGroups() {\n+        Map<String, List<String>> isolationGroup = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6d1c0cd25ea109d3f7908d7d8b0855c51470b1c"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56ec9dda7106b61d9c55055bda68bb268aa2bea9", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/56ec9dda7106b61d9c55055bda68bb268aa2bea9", "committedDate": "2020-12-29T08:46:24Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDMzMDAy", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-559433002", "createdAt": "2020-12-29T08:47:49Z", "commit": {"oid": "56ec9dda7106b61d9c55055bda68bb268aa2bea9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwODo0Nzo0OVrOIMKMSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwODo0Nzo0OVrOIMKMSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyMDgxMQ==", "bodyText": "@sijie Is it ok to introduce the bookkeeper-server into the pulsar-common?", "url": "https://github.com/apache/pulsar/pull/8961#discussion_r549620811", "createdAt": "2020-12-29T08:47:49Z", "author": {"login": "zymap"}, "path": "pulsar-common/pom.xml", "diffHunk": "@@ -101,6 +101,16 @@\n       </exclusions>\n     </dependency>\n \n+    <dependency>\n+      <groupId>org.apache.bookkeeper</groupId>\n+      <artifactId>bookkeeper-common</artifactId>\n+    </dependency>\n+\n+    <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56ec9dda7106b61d9c55055bda68bb268aa2bea9"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22d6d89dfc4449eb0145f45f2e68847ae6b67927", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/22d6d89dfc4449eb0145f45f2e68847ae6b67927", "committedDate": "2020-12-29T09:24:33Z", "message": "Remove the bookkeeper-server dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8379b429cd64071d699729d971ee8e6ce358f16", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/b8379b429cd64071d699729d971ee8e6ce358f16", "committedDate": "2020-12-29T13:47:46Z", "message": "Fix the tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7cbb5a78d45f04c092e26a24d7a569e534e6c0f", "author": {"user": {"login": "zymap", "name": "Yong Zhang"}}, "url": "https://github.com/apache/pulsar/commit/a7cbb5a78d45f04c092e26a24d7a569e534e6c0f", "committedDate": "2020-12-30T02:09:25Z", "message": "Fix the tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTkwMDg4", "url": "https://github.com/apache/pulsar/pull/8961#pullrequestreview-559990088", "createdAt": "2020-12-30T10:23:56Z", "commit": {"oid": "a7cbb5a78d45f04c092e26a24d7a569e534e6c0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 947, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}