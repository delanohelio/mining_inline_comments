{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0OTA1MjU5", "number": 7093, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDowMTowOFrOEBEa_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMjoxNzozN1rOEBJm6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NTU2NDc5OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMDowMTowOFrOGcvO6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMjoxMjoxMlrOGc2Sfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc4NzE3OQ==", "bodyText": "How is this supposed to be activated?\nInstead, we need a namespace policy, attached to https://pulsar.apache.org/admin-rest-api/?version=2.5.2#operation/setAutoTopicCreation that adds the auto-deletion override configuration, on top of the auto-creation", "url": "https://github.com/apache/pulsar/pull/7093#discussion_r432787179", "createdAt": "2020-05-30T00:01:08Z", "author": {"login": "merlimat"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "diffHunk": "@@ -423,5 +428,13 @@ public long getBytesOutCounter() {\n         return getStats(false).bytesOutCounter;\n     }\n \n+    public boolean isBrokerDeleteInactiveTopicsEnabled() {\n+        return brokerDeleteInactiveTopicsEnabled;\n+    }\n+\n+    public void setBrokerDeleteInactiveTopicsEnabled(boolean brokerDeleteInactiveTopicsEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9adb53867fee4a13b9ee0843270c3cba6a22b2e3"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMjc4Mw==", "bodyText": "@merlimat This is used by the protocol handlers who want to ensure some topics under the namespace does not delete by the broker. But do not want to change the namespace level policy. Now, we don't have a topic level policy, without this change, we must create a virtual producer or consume.", "url": "https://github.com/apache/pulsar/pull/7093#discussion_r432902783", "createdAt": "2020-05-31T02:12:12Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "diffHunk": "@@ -423,5 +428,13 @@ public long getBytesOutCounter() {\n         return getStats(false).bytesOutCounter;\n     }\n \n+    public boolean isBrokerDeleteInactiveTopicsEnabled() {\n+        return brokerDeleteInactiveTopicsEnabled;\n+    }\n+\n+    public void setBrokerDeleteInactiveTopicsEnabled(boolean brokerDeleteInactiveTopicsEnabled) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc4NzE3OQ=="}, "originalCommit": {"oid": "9adb53867fee4a13b9ee0843270c3cba6a22b2e3"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjQxMzQ5OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMjoxNDo1NVrOGc2S_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxMTo0NTo0N1rOGc4eWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMjkxMA==", "bodyText": "I think it's better to named deleteWhileInactive.", "url": "https://github.com/apache/pulsar/pull/7093#discussion_r432902910", "createdAt": "2020-05-31T02:14:55Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "diffHunk": "@@ -63,6 +63,9 @@\n \n     protected volatile boolean isFenced;\n \n+    // When set to false, this inactive topic can not be deleted\n+    protected boolean brokerDeleteInactiveTopicsEnabled;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9adb53867fee4a13b9ee0843270c3cba6a22b2e3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzODU4NA==", "bodyText": "Done.", "url": "https://github.com/apache/pulsar/pull/7093#discussion_r432938584", "createdAt": "2020-05-31T11:45:47Z", "author": {"login": "zhanghaou"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "diffHunk": "@@ -63,6 +63,9 @@\n \n     protected volatile boolean isFenced;\n \n+    // When set to false, this inactive topic can not be deleted\n+    protected boolean brokerDeleteInactiveTopicsEnabled;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMjkxMA=="}, "originalCommit": {"oid": "9adb53867fee4a13b9ee0843270c3cba6a22b2e3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjQxNDI4OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMjoxNzowMVrOGc2TZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMjoxNzowMVrOGc2TZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMzAxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (brokerDeleteInactiveTopicsEnabled) {\n          \n          \n            \n                    if (! brokerDeleteInactiveTopicsEnabled) {", "url": "https://github.com/apache/pulsar/pull/7093#discussion_r432903012", "createdAt": "2020-05-31T02:17:01Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java", "diffHunk": "@@ -830,6 +830,10 @@ public boolean isActive() {\n \n     @Override\n     public void checkGC(int maxInactiveDurationInSec, InactiveTopicDeleteMode deleteMode) {\n+        if (brokerDeleteInactiveTopicsEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9adb53867fee4a13b9ee0843270c3cba6a22b2e3"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjQxNDQ4OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMjoxNzozN1rOGc2Tew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMjoxNzozN1rOGc2Tew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMzAzNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (brokerDeleteInactiveTopicsEnabled) {\n          \n          \n            \n                    if (!brokerDeleteInactiveTopicsEnabled) {", "url": "https://github.com/apache/pulsar/pull/7093#discussion_r432903035", "createdAt": "2020-05-31T02:17:37Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "diffHunk": "@@ -1636,6 +1629,10 @@ private boolean hasBacklogs() {\n \n     @Override\n     public void checkGC(int maxInactiveDurationInSec, InactiveTopicDeleteMode deleteMode) {\n+        if (brokerDeleteInactiveTopicsEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9adb53867fee4a13b9ee0843270c3cba6a22b2e3"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1695, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}