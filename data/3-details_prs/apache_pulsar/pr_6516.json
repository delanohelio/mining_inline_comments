{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NDI0NzI5", "number": 6516, "title": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats", "bodyText": "Motivation\nNote: This PR is top on #6473\nIn PR: #6473 we have added REST-API to get stats for the pulsar-proxy.\nHowever, we also need cli tool to call such api and retrieve stats.\nModification\nAdded CLI for proxy-stats.\nNote:\nI will rebase this PR once, #6473 changes are reviewed and merged.", "createdAt": "2020-03-11T00:22:16Z", "url": "https://github.com/apache/pulsar/pull/6516", "merged": true, "mergeCommit": {"oid": "f9fd59f72dd43b45373a37d0489170b5e2765068"}, "closed": true, "closedAt": "2020-04-22T09:20:08Z", "author": {"login": "rdhabalia"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNbFWtgBqjMxMjg4MzE0ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaEu-1gFqTM5ODAwMTI2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "152362dbaa1d09eec7a1ae1185ebc5c2b356418c", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/152362dbaa1d09eec7a1ae1185ebc5c2b356418c", "committedDate": "2020-03-11T00:17:20Z", "message": "add cli command"}, "afterCommit": {"oid": "fc3ef6150c6f3136b4ad6eb169dc1085534688c3", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/fc3ef6150c6f3136b4ad6eb169dc1085534688c3", "committedDate": "2020-03-14T01:58:36Z", "message": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc3ef6150c6f3136b4ad6eb169dc1085534688c3", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/fc3ef6150c6f3136b4ad6eb169dc1085534688c3", "committedDate": "2020-03-14T01:58:36Z", "message": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats"}, "afterCommit": {"oid": "59fc32234ae010eb55df4860cf6a3df63244ef01", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/59fc32234ae010eb55df4860cf6a3df63244ef01", "committedDate": "2020-03-14T02:01:39Z", "message": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTE0MjIw", "url": "https://github.com/apache/pulsar/pull/6516#pullrequestreview-376514220", "createdAt": "2020-03-18T01:51:17Z", "commit": {"oid": "59fc32234ae010eb55df4860cf6a3df63244ef01"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzY4ODMw", "url": "https://github.com/apache/pulsar/pull/6516#pullrequestreview-377368830", "createdAt": "2020-03-19T01:53:07Z", "commit": {"oid": "59fc32234ae010eb55df4860cf6a3df63244ef01"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMTo1NDo1NVrOF4demw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMTo1NToxMlrOF4de2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc0NzU0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @Parameters(commandDescription = \"Operations to collect broker statistics\")\n          \n          \n            \n            @Parameters(commandDescription = \"Operations to collect proxy statistics\")", "url": "https://github.com/apache/pulsar/pull/6516#discussion_r394747547", "createdAt": "2020-03-19T01:54:55Z", "author": {"login": "codelipenghui"}, "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdProxyStats.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pulsar.admin.cli;\n+\n+import java.io.IOException;\n+\n+import org.apache.pulsar.client.admin.PulsarAdmin;\n+\n+import com.beust.jcommander.Parameter;\n+import com.beust.jcommander.Parameters;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+@Parameters(commandDescription = \"Operations to collect broker statistics\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59fc32234ae010eb55df4860cf6a3df63244ef01"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc0NzYwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    super(\"broker-stats\", admin);\n          \n          \n            \n                    super(\"proxy-stats\", admin);", "url": "https://github.com/apache/pulsar/pull/6516#discussion_r394747608", "createdAt": "2020-03-19T01:55:12Z", "author": {"login": "codelipenghui"}, "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdProxyStats.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pulsar.admin.cli;\n+\n+import java.io.IOException;\n+\n+import org.apache.pulsar.client.admin.PulsarAdmin;\n+\n+import com.beust.jcommander.Parameter;\n+import com.beust.jcommander.Parameters;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+@Parameters(commandDescription = \"Operations to collect broker statistics\")\n+public class CmdProxyStats extends CmdBase {\n+    private static final String DEFAULT_INDENTATION = \"    \";\n+\n+    @Parameters(commandDescription = \"dump connections metrics for Monitoring\")\n+    private class CmdConnectionMetrics extends CliCommand {\n+        @Parameter(names = { \"-i\", \"--indent\" }, description = \"Indent JSON output\", required = false)\n+        private boolean indent = false;\n+\n+        @Override\n+        void run() throws Exception {\n+            JsonArray stats = admin.proxyStats().getConnections();\n+            printStats(stats, indent);\n+        }\n+    }\n+\n+    @Parameters(commandDescription = \"dump topics metrics for Monitoring\")\n+    private class CmdTopicsMetrics extends CliCommand {\n+        @Parameter(names = { \"-i\", \"--indent\" }, description = \"Indent JSON output\", required = false)\n+        private boolean indent = false;\n+\n+        @Override\n+        void run() throws Exception {\n+            JsonObject stats = admin.proxyStats().getTopics();\n+            printStats(stats, indent);\n+        }\n+    }\n+\n+    public void printStats(JsonElement json, boolean indent) throws IOException {\n+        GsonBuilder builder = new GsonBuilder();\n+        Gson gson = indent ? builder.setPrettyPrinting().create() : builder.create();\n+        System.out.println(gson.toJson(json));\n+    }\n+\n+    public CmdProxyStats(PulsarAdmin admin) {\n+        super(\"broker-stats\", admin);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59fc32234ae010eb55df4860cf6a3df63244ef01"}, "originalPosition": 68}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "763aee5531cfb4180327d8f7eb3e33ebdd7f12d5", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/763aee5531cfb4180327d8f7eb3e33ebdd7f12d5", "committedDate": "2020-04-15T02:27:52Z", "message": "fix broker typo"}, "afterCommit": {"oid": "b8e94df9a48551d4352e5daf30db32dcfad85dd1", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/b8e94df9a48551d4352e5daf30db32dcfad85dd1", "committedDate": "2020-04-15T02:28:35Z", "message": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats\n\nfix broker typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9c7c2bc50698aeda7975c01f2a67810b8d5f4fe", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/f9c7c2bc50698aeda7975c01f2a67810b8d5f4fe", "committedDate": "2020-04-15T02:28:52Z", "message": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats\n\nfix broker typo"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8e94df9a48551d4352e5daf30db32dcfad85dd1", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/b8e94df9a48551d4352e5daf30db32dcfad85dd1", "committedDate": "2020-04-15T02:28:35Z", "message": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats\n\nfix broker typo"}, "afterCommit": {"oid": "f9c7c2bc50698aeda7975c01f2a67810b8d5f4fe", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/f9c7c2bc50698aeda7975c01f2a67810b8d5f4fe", "committedDate": "2020-04-15T02:28:52Z", "message": "[pulsar-proxy] Add CLI support to get pulsar-proxy stats\n\nfix broker typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60d95670a01deab97408d219e3dbb976d7b7e7af", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/60d95670a01deab97408d219e3dbb976d7b7e7af", "committedDate": "2020-04-15T06:05:46Z", "message": "fix imports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3e86f08854d78e02343ea5014461a7b3cfa0c14", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/a3e86f08854d78e02343ea5014461a7b3cfa0c14", "committedDate": "2020-04-15T05:23:44Z", "message": "fix imports"}, "afterCommit": {"oid": "60d95670a01deab97408d219e3dbb976d7b7e7af", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/60d95670a01deab97408d219e3dbb976d7b7e7af", "committedDate": "2020-04-15T06:05:46Z", "message": "fix imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjM3MTM1", "url": "https://github.com/apache/pulsar/pull/6516#pullrequestreview-397637135", "createdAt": "2020-04-21T20:08:35Z", "commit": {"oid": "60d95670a01deab97408d219e3dbb976d7b7e7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MDAxMjY2", "url": "https://github.com/apache/pulsar/pull/6516#pullrequestreview-398001266", "createdAt": "2020-04-22T09:19:03Z", "commit": {"oid": "60d95670a01deab97408d219e3dbb976d7b7e7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}