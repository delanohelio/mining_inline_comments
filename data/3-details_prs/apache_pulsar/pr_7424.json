{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMjA4Nzgx", "number": 7424, "title": "[Issue: 7379] Improve security setting of Pulsar Functions", "bodyText": "Signed-off-by: xiaolong.ran rxl@apache.org\nFixes #7379\nMotivation\nRename some settings to make those broker-client TLS settings clearer.\nModifications\n\nreplace clientAuthenticationParameters with brokerClientAuthenticationParameters\nreplace clientAuthenticationPlugin with brokerClientAuthenticationPlugin\nreplace tlsHostnameVerificationEnable with tlsEnableHostnameVerification", "createdAt": "2020-07-02T02:49:05Z", "url": "https://github.com/apache/pulsar/pull/7424", "merged": true, "mergeCommit": {"oid": "e99b66933e4775efbb7c7df8ea3a38047d879d6b"}, "closed": true, "closedAt": "2020-07-03T06:36:13Z", "author": {"login": "wolfstudy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw1oh0gH2gAyNDQzMjA4NzgxOjQ2YTkwZTRkOWE1MTk0YmYyOThhYmMxYzQxY2EzN2JhZmQ5OTM2Yjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxNjfRAFqTQ0MjE3NjkxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "author": {"user": {"login": "wolfstudy", "name": "xiaolong ran"}}, "url": "https://github.com/apache/pulsar/commit/46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "committedDate": "2020-07-02T02:43:41Z", "message": "Improve security setting of Pulsar Functions\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzUyNjU3", "url": "https://github.com/apache/pulsar/pull/7424#pullrequestreview-441352657", "createdAt": "2020-07-02T05:05:20Z", "commit": {"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNTowNToyMFrOGr9lPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNTowOToxN1rOGr9pNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MDkxMA==", "bodyText": "Can you move this to end of the file and mark them as @Deprecated?", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448750910", "createdAt": "2020-07-02T05:05:20Z", "author": {"login": "sijie"}, "path": "conf/functions_worker.yml", "diffHunk": "@@ -48,13 +48,25 @@ downloadDirectory: download/pulsar_functions\n \n # Configure the pulsar client used by function metadata management\n #\n-# points \n+# points\n+# Whether to enable TLS when clients connect to broker\n+useTls: false\n+# For TLS:\n+# brokerServiceUrl=pulsar+ssl://localhost:6651/\n pulsarServiceUrl: pulsar://localhost:6650\n+# For TLS:\n+# webServiceUrl=https://localhost:8443/\n pulsarWebServiceUrl: http://localhost:8080\n+\n+############################################\n+# security settings for pulsar broker client\n+############################################\n+# The path to trusted certificates used by the Pulsar client to authenticate with Pulsar brokers\n+# brokerClientTrustCertsFilePath:\n # the authentication plugin to be used by the pulsar client used in worker service\n-# clientAuthenticationPlugin:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MTc2Nw==", "bodyText": "You need to consider backward compatibility. You can add getBrokerClientAuthenticationPlugin() method in WorkerConfig.\nString getBrokerClientAuthenticationPlugin() {\n    if (null == brokerClientAuthenticationParameters) {\n        return clientAuthenticationParameters;\n    } else {\n        return brokerClientAuthenticationParameters;\n    }\n}\n\nWe should do the same thing for getBrokerClientAuthenticationPlugin.", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448751767", "createdAt": "2020-07-02T05:08:48Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/functions/worker/PulsarFunctionE2ESecurityTest.java", "diffHunk": "@@ -177,10 +177,10 @@ void setup(Method method) throws Exception {\n \n         ClientBuilder clientBuilder = PulsarClient.builder().serviceUrl(this.workerConfig.getPulsarServiceUrl())\n                 .operationTimeout(1000, TimeUnit.MILLISECONDS);\n-        if (isNotBlank(workerConfig.getClientAuthenticationPlugin())\n-                && isNotBlank(workerConfig.getClientAuthenticationParameters())) {\n-            clientBuilder.authentication(workerConfig.getClientAuthenticationPlugin(),\n-                    workerConfig.getClientAuthenticationParameters());\n+        if (isNotBlank(workerConfig.getBrokerClientAuthenticationPlugin())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MTkyNQ==", "bodyText": "Please keep the original settings and mark them as deprecated.", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448751925", "createdAt": "2020-07-02T05:09:17Z", "author": {"login": "sijie"}, "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java", "diffHunk": "@@ -258,12 +258,12 @@\n         category = CATEGORY_CLIENT_SECURITY,\n         doc = \"The authentication plugin used by function workers to talk to brokers\"\n     )\n-    private String clientAuthenticationPlugin;\n+    private String brokerClientAuthenticationPlugin;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzUzOTY4", "url": "https://github.com/apache/pulsar/pull/7424#pullrequestreview-441353968", "createdAt": "2020-07-02T05:09:40Z", "commit": {"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1ff3e765d911b78f7b9455e9d37c870e990374c", "author": {"user": {"login": "wolfstudy", "name": "xiaolong ran"}}, "url": "https://github.com/apache/pulsar/commit/b1ff3e765d911b78f7b9455e9d37c870e990374c", "committedDate": "2020-07-02T06:29:29Z", "message": "fix comments\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "031c94cb981c3d6361afe69f0c1645e9adf273a1", "author": {"user": {"login": "wolfstudy", "name": "xiaolong ran"}}, "url": "https://github.com/apache/pulsar/commit/031c94cb981c3d6361afe69f0c1645e9adf273a1", "committedDate": "2020-07-02T07:14:45Z", "message": "fix comments\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTYyMDc3", "url": "https://github.com/apache/pulsar/pull/7424#pullrequestreview-442162077", "createdAt": "2020-07-03T05:55:54Z", "commit": {"oid": "031c94cb981c3d6361afe69f0c1645e9adf273a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTc2OTE2", "url": "https://github.com/apache/pulsar/pull/7424#pullrequestreview-442176916", "createdAt": "2020-07-03T06:35:54Z", "commit": {"oid": "031c94cb981c3d6361afe69f0c1645e9adf273a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 522, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}