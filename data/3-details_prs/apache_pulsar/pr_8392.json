{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwODk3MjIz", "number": 8392, "title": "Try to fix flaky test in the InactiveTopicDeleteTest.java", "bodyText": "1\uff09testTopicLevelInActiveTopicApi\uff1aThe error is caused by getInactiveTopicPolicies(), due to the slow startup of the broker, the cache has not been initialized yet.\n2)testTopicLevelInactivePolicyUpdateAndClean\uff1aWe previously updated the event trigger timing of topic-policies. The update is triggered after the event is consumed. Therefore, it is not enough to judge that the policy in the cache is null. We need to sleep and wait for the event to be consumed.", "createdAt": "2020-10-27T16:44:39Z", "url": "https://github.com/apache/pulsar/pull/8392", "merged": true, "mergeCommit": {"oid": "98bd0c2d1c17adb0a6308171254e5316336be42d"}, "closed": true, "closedAt": "2020-10-28T05:48:43Z", "author": {"login": "315157973"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWrq_vgH2gAyNTEwODk3MjIzOmIzM2QxMjMzYmUzZDZmZmQwOTIyYzlkZGI1NjJjMTY2YmFmYWJjZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW1sDFgFqTUxODMxMjUyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b33d1233be3d6ffd0922c9ddb562c166bafabce6", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/b33d1233be3d6ffd0922c9ddb562c166bafabce6", "committedDate": "2020-10-27T16:36:27Z", "message": "fix unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1e6bc4184776702e1712f3bde19b9877718a574", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/e1e6bc4184776702e1712f3bde19b9877718a574", "committedDate": "2020-10-27T17:38:16Z", "message": "Comment out some code first to see the real cause of the error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb76379f5ddd2241a28797961e4a17600e961b4b", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/bb76379f5ddd2241a28797961e4a17600e961b4b", "committedDate": "2020-10-27T17:45:37Z", "message": "Comment out some code first to see the real cause of the error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MDEwOTcx", "url": "https://github.com/apache/pulsar/pull/8392#pullrequestreview-518010971", "createdAt": "2020-10-27T18:18:21Z", "commit": {"oid": "bb76379f5ddd2241a28797961e4a17600e961b4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxODoxODoyMlrOHpKiOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxODoxODoyMlrOHpKiOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkyNjI2Nw==", "bodyText": "Can we find a better solution here rather than Thread.sleep?", "url": "https://github.com/apache/pulsar/pull/8392#discussion_r512926267", "createdAt": "2020-10-27T18:18:22Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/InactiveTopicDeleteTest.java", "diffHunk": "@@ -303,10 +303,10 @@ public void testTopicLevelInActiveTopicApi() throws Exception {\n         conf.setSystemTopicEnabled(true);\n         conf.setTopicLevelPoliciesEnabled(true);\n         super.baseSetup();\n-        //wait for init\n-        Thread.sleep(2000);\n         final String topicName = \"persistent://prop/ns-abc/testMaxInactiveDuration-\" + UUID.randomUUID().toString();\n         admin.topics().createPartitionedTopic(topicName, 3);\n+        //wait for init\n+        Thread.sleep(3000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb76379f5ddd2241a28797961e4a17600e961b4b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98bb47d076a5d4349591cb55ea3a4b629c350616", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/98bb47d076a5d4349591cb55ea3a4b629c350616", "committedDate": "2020-10-28T00:17:54Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdc0385d15abc54b9cf2399e9deacd0f13a4772d", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/bdc0385d15abc54b9cf2399e9deacd0f13a4772d", "committedDate": "2020-10-28T00:26:08Z", "message": "fix unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09fc8006d5602aab473624d83710a1c2bfeb7855", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/09fc8006d5602aab473624d83710a1c2bfeb7855", "committedDate": "2020-10-28T00:42:06Z", "message": "Re-trigger CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6bd4c889978927b46c4b2630e440c25339f73d7", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/c6bd4c889978927b46c4b2630e440c25339f73d7", "committedDate": "2020-10-28T00:54:16Z", "message": "Determine whether the cache has been initialized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aff89472b203c3b4107f852299c10701aa0a5c6d", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/aff89472b203c3b4107f852299c10701aa0a5c6d", "committedDate": "2020-10-28T02:28:28Z", "message": "add wait for cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92499830e32632e9e2f0a3759277acc28d247ff0", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/92499830e32632e9e2f0a3759277acc28d247ff0", "committedDate": "2020-10-28T02:29:44Z", "message": "code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85053d418057fbc177b314753c140f14eead814a", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/85053d418057fbc177b314753c140f14eead814a", "committedDate": "2020-10-28T03:28:39Z", "message": "fix duplicate unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MzEyNTI4", "url": "https://github.com/apache/pulsar/pull/8392#pullrequestreview-518312528", "createdAt": "2020-10-28T04:16:39Z", "commit": {"oid": "85053d418057fbc177b314753c140f14eead814a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1133, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}