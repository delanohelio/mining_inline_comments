{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMDA2NjEx", "number": 7863, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxMTo1MjoxM1rOEbNeWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQyMzozNzoyMFrOEbQwJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2OTY3NzY4OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxMTo1MjoxM1rOHFEv9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QwNDozMToxN1rOHFKAaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA4Mjc0Mg==", "bodyText": "It is recommended to return CompletableFuture instead of passing in the parameter AsyncResponse", "url": "https://github.com/apache/pulsar/pull/7863#discussion_r475082742", "createdAt": "2020-08-22T11:52:13Z", "author": {"login": "jianyun8023"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "diffHunk": "@@ -3056,4 +3057,53 @@ protected void internalGetLastMessageId(AsyncResponse asyncResponse, boolean aut\n         });\n \n     }\n+\n+    protected void internalGetDispatchRate(AsyncResponse asyncResponse) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE2ODg3Mw==", "bodyText": "I have updated the implement interface, please take a look again. Thanks", "url": "https://github.com/apache/pulsar/pull/7863#discussion_r475168873", "createdAt": "2020-08-23T04:31:17Z", "author": {"login": "hangc0276"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "diffHunk": "@@ -3056,4 +3057,53 @@ protected void internalGetLastMessageId(AsyncResponse asyncResponse, boolean aut\n         });\n \n     }\n+\n+    protected void internalGetDispatchRate(AsyncResponse asyncResponse) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA4Mjc0Mg=="}, "originalCommit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MDIxNDc3OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQyMzozNzoyMFrOHFIz-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QwNDowMDozNVrOHFJ4FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE0OTMwNA==", "bodyText": "wouldn't this remove all listeners for a given topic?", "url": "https://github.com/apache/pulsar/pull/7863#discussion_r475149304", "createdAt": "2020-08-22T23:37:20Z", "author": {"login": "MarvinCai"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java", "diffHunk": "@@ -329,5 +337,15 @@ Boolean getPoliciesCacheInit(NamespaceName namespaceName) {\n         return policyCacheInitMap.get(namespaceName);\n     }\n \n+    @Override\n+    public void registerListener(TopicName topicName, TopicPolicyListener<TopicPolicies> listener) {\n+        listeners.computeIfAbsent(topicName, k -> Lists.newCopyOnWriteArrayList()).add(listener);\n+    }\n+\n+    @Override\n+    public void unregisterListener(TopicName topicName, TopicPolicyListener<TopicPolicies> listener) {\n+        listeners.computeIfAbsent(topicName, k -> Lists.newCopyOnWriteArrayList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE2Njc0MQ==", "bodyText": "It should remove the specific listener,  and i have updated the code, please take a look again. Thanks", "url": "https://github.com/apache/pulsar/pull/7863#discussion_r475166741", "createdAt": "2020-08-23T04:00:35Z", "author": {"login": "hangc0276"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java", "diffHunk": "@@ -329,5 +337,15 @@ Boolean getPoliciesCacheInit(NamespaceName namespaceName) {\n         return policyCacheInitMap.get(namespaceName);\n     }\n \n+    @Override\n+    public void registerListener(TopicName topicName, TopicPolicyListener<TopicPolicies> listener) {\n+        listeners.computeIfAbsent(topicName, k -> Lists.newCopyOnWriteArrayList()).add(listener);\n+    }\n+\n+    @Override\n+    public void unregisterListener(TopicName topicName, TopicPolicyListener<TopicPolicies> listener) {\n+        listeners.computeIfAbsent(topicName, k -> Lists.newCopyOnWriteArrayList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE0OTMwNA=="}, "originalCommit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2271, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}