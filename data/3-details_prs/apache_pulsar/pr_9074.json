{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MzIxNjQy", "number": 9074, "title": "[feature][cpp-client]Expose cpp end to end encryption interface", "bodyText": "Motivation\nCurrently some users want to use end-to-end encryption on other clients, such as python or node clients, and this pr is used to expose the end-to-end encryption interface.\nModifications\n\nAdd a default class DefaultCryptoKeyReader to implement reading public and private keys\nThe client calls the pulsar_consumer_configuration_set_default_crypto_key_reader function to specify the path of the public and private keys to be passed to the cpp client\nAdd DefaultCryptoKeyReader class to the test\n\nVerifying this change\n\nUpdate test\n\nThe end-to-end tests already exist in the cpp client, so let's go ahead and use this example \n  \n    \n      pulsar/pulsar-client-cpp/tests/BasicEndToEndTest.cc\n    \n    \n         Line 1320\n      in\n      041424c\n    \n    \n    \n    \n\n        \n          \n           TEST(BasicEndToEndTest, testRSAEncryption) { \n        \n    \n  \n\n to test our code\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-12-29T04:38:10Z", "url": "https://github.com/apache/pulsar/pull/9074", "merged": true, "mergeCommit": {"oid": "956328d84e4109583dfb6f5a90c48a06e5a53aa6"}, "closed": true, "closedAt": "2020-12-31T03:44:35Z", "author": {"login": "tuteng"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqzBOWgH2gAyNTQ2MzIxNjQyOmY0NzEyMjg1Y2JjZTQ3NzljYzY0NzNlNzExNGJlNzIxOTA2M2FlYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrblWsgFqTU2MDI1NjM2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f4712285cbce4779cc6473e7114be7219063aea5", "author": {"user": {"login": "tuteng", "name": "Guangning E"}}, "url": "https://github.com/apache/pulsar/commit/f4712285cbce4779cc6473e7114be7219063aea5", "committedDate": "2020-12-29T04:28:33Z", "message": "Expose cpp end to end encryption interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca392ac1d9b2a07b8ed8f8bb625acab6383565df", "author": {"user": {"login": "tuteng", "name": "Guangning E"}}, "url": "https://github.com/apache/pulsar/commit/ca392ac1d9b2a07b8ed8f8bb625acab6383565df", "committedDate": "2020-12-29T09:04:16Z", "message": "Fixed build error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce", "author": {"user": {"login": "tuteng", "name": "Guangning E"}}, "url": "https://github.com/apache/pulsar/commit/041424cf06f16bedf4ef5787c9b96b7c5daf5fce", "committedDate": "2020-12-29T10:15:42Z", "message": "Format code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDcwODIx", "url": "https://github.com/apache/pulsar/pull/9074#pullrequestreview-559470821", "createdAt": "2020-12-29T10:30:05Z", "commit": {"oid": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMDozMDowNlrOIMMK3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMDozMDowNlrOIMMK3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MzIxMg==", "bodyText": "The naming style should be consistent with other enum values, i.e. change pulsar_producerFail to pulsar_ProducerFail.", "url": "https://github.com/apache/pulsar/pull/9074#discussion_r549653212", "createdAt": "2020-12-29T10:30:06Z", "author": {"login": "BewareMyPower"}, "path": "pulsar-client-cpp/include/pulsar/c/producer_configuration.h", "diffHunk": "@@ -63,8 +63,17 @@ typedef enum {\n     pulsar_AutoPublish = -4,\n } pulsar_schema_type;\n \n+typedef enum {\n+    // This is the default option to fail send if crypto operation fails\n+    pulsar_producerFail,\n+    // Ignore crypto failure and proceed with sending unencrypted messages\n+    pulsar_producerSend", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDcxODM0", "url": "https://github.com/apache/pulsar/pull/9074#pullrequestreview-559471834", "createdAt": "2020-12-29T10:32:12Z", "commit": {"oid": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMDozMjoxMlrOIMMNfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMDozMjoxMlrOIMMNfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1Mzg4Nw==", "bodyText": "Should EncKeyReader in testEncryptionFailure also be replaced with the default crypto key reader? Then the implementation of EncKeyReader could be removed.", "url": "https://github.com/apache/pulsar/pull/9074#discussion_r549653887", "createdAt": "2020-12-29T10:32:12Z", "author": {"login": "BewareMyPower"}, "path": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "diffHunk": "@@ -1323,7 +1324,14 @@ TEST(BasicEndToEndTest, testRSAEncryption) {\n     std::string subName = \"my-sub-name\";\n     Producer producer;\n \n-    std::shared_ptr<EncKeyReader> keyReader = std::make_shared<EncKeyReader>();\n+    std::string PUBLIC_CERT_FILE_PATH =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e8cff27c533ac562667c9fa46e435fbe3a42e15", "author": {"user": {"login": "tuteng", "name": "Guangning E"}}, "url": "https://github.com/apache/pulsar/commit/7e8cff27c533ac562667c9fa46e435fbe3a42e15", "committedDate": "2020-12-29T11:06:29Z", "message": "Fixed import error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb1bf76ea007ca3fddd9679347ab4ad35b23185d", "author": {"user": {"login": "tuteng", "name": "Guangning E"}}, "url": "https://github.com/apache/pulsar/commit/bb1bf76ea007ca3fddd9679347ab4ad35b23185d", "committedDate": "2020-12-29T13:46:55Z", "message": "Fixed comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NTUxMzA4", "url": "https://github.com/apache/pulsar/pull/9074#pullrequestreview-559551308", "createdAt": "2020-12-29T14:16:18Z", "commit": {"oid": "bb1bf76ea007ca3fddd9679347ab4ad35b23185d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72f4555420fab9e32a4dc2dde9fc5325e4c50da5", "author": {"user": {"login": "tuteng", "name": "Guangning E"}}, "url": "https://github.com/apache/pulsar/commit/72f4555420fab9e32a4dc2dde9fc5325e4c50da5", "committedDate": "2020-12-30T10:23:58Z", "message": "Update comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a7a0ed806ee2c396302d3e3a084e2a078f7d2e9", "author": {"user": {"login": "tuteng", "name": "Guangning E"}}, "url": "https://github.com/apache/pulsar/commit/1a7a0ed806ee2c396302d3e3a084e2a078f7d2e9", "committedDate": "2020-12-30T10:36:19Z", "message": "Fixed style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMDU3NDkx", "url": "https://github.com/apache/pulsar/pull/9074#pullrequestreview-560057491", "createdAt": "2020-12-30T13:56:37Z", "commit": {"oid": "1a7a0ed806ee2c396302d3e3a084e2a078f7d2e9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMjU2MzY4", "url": "https://github.com/apache/pulsar/pull/9074#pullrequestreview-560256368", "createdAt": "2020-12-31T03:44:13Z", "commit": {"oid": "1a7a0ed806ee2c396302d3e3a084e2a078f7d2e9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 857, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}