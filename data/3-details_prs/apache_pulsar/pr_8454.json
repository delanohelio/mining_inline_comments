{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MjgyODEz", "number": 8454, "title": "[pulsar-broker] Security-Recommendation: Remove verbose error message with system info for admin-api", "bodyText": "Motivation\none of the security-recommendation report has listed system internal info in error-response which should be fixed.\nurl: curl -X DELETE -H 'Content-Type: application/json'  http://localhost:8080/admin/namespaces/sample/standalone/ns1/maxConsumerPerSubscription\nError-response:\n --- An unexpected error occurred in the server ---\n\nMessage: Invalid bundle range\n\nStacktrace:\n\njava.lang.IllegalArgumentException: Invalid bundle range\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:141)\n\tat org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleRange(PulsarWebResource.java:480)\n\tat org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnership(PulsarWebResource.java:522)\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.internalDeleteNamespaceBundle(NamespacesBase.java:541)\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.internalDeleteNamespaceBundle(NamespacesBase.java:488)\n\tat org.apache.pulsar.broker.admin.v1.Namespaces.deleteNamespaceBundle(Namespaces.java:229)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n\nModification\nReturn informative response without system info\nResult\ncurl -X DELETE -H 'Content-Type: application/json'  http://localhost:8080/admin/namespaces/sample/standalone/ns1/my-range\n\n{\"reason\":\"Invalid bundle range: my-range\"}", "createdAt": "2020-11-05T19:14:02Z", "url": "https://github.com/apache/pulsar/pull/8454", "merged": true, "mergeCommit": {"oid": "de7da895d979f79b574139d7473344d811d472a3"}, "closed": true, "closedAt": "2020-11-07T01:54:34Z", "author": {"login": "rdhabalia"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZnTIQAH2gAyNTE2MjgyODEzOjQ4MzdmNzY4OWE5Y2FhOTVlMTU0ZmViZmQ4MTk2NWNjZGRiOGYyZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdaBpOaAFqTUyNTU4MTA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4837f7689a9caa95e154febfd81965ccddb8f2de", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/4837f7689a9caa95e154febfd81965ccddb8f2de", "committedDate": "2020-11-05T19:12:32Z", "message": "[pulsar-broker] Security-Recommendation: Remove verbose error message with system info for admin-api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjIyNDA3", "url": "https://github.com/apache/pulsar/pull/8454#pullrequestreview-524622407", "createdAt": "2020-11-05T20:01:43Z", "commit": {"oid": "4837f7689a9caa95e154febfd81965ccddb8f2de"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77071a21713f23225de1b2ccf48d122d8379b713", "author": {"user": {"login": "rdhabalia", "name": "Rajan Dhabalia"}}, "url": "https://github.com/apache/pulsar/commit/77071a21713f23225de1b2ccf48d122d8379b713", "committedDate": "2020-11-05T22:27:54Z", "message": "add unit-test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTE5NTI5", "url": "https://github.com/apache/pulsar/pull/8454#pullrequestreview-524919529", "createdAt": "2020-11-06T07:49:05Z", "commit": {"oid": "77071a21713f23225de1b2ccf48d122d8379b713"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzo0OTowNVrOHujS4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzo0OTowNVrOHujS4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU3NDgxOQ==", "bodyText": "thank you for adding the test @rdhabalia\nI asked for a test, because IIUC the issue here is that we want a new message for security reasons,\nmessages in exceptions sometimes change due to refactors and it is probable that in the future someone will change the error message if there is no test case.\nthe implementation is that we are now referring to the bundleRange in the message\nIMHO the test should test that actually the message contains that value.\nAlso I would add here a comment that states that it is better to not change the message for security reasons (with a minimal explanation, not just \"for security reasons\")", "url": "https://github.com/apache/pulsar/pull/8454#discussion_r518574819", "createdAt": "2020-11-06T07:49:05Z", "author": {"login": "eolivelli"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest2.java", "diffHunk": "@@ -1338,6 +1338,16 @@ public void testMaxNamespacesPerTenant() throws Exception {\n \n     }\n \n+    @Test\n+    public void testInvalidBundleErrorResponse() throws Exception {\n+        try {\n+            admin.namespaces().deleteNamespaceBundle(\"prop-xyz/ns1\", \"invalid-bundle\");\n+            fail(\"should have failed due to invalid bundle\");\n+        } catch (PreconditionFailedException e) {\n+            assertTrue(e.getMessage().startsWith(\"Invalid bundle range\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77071a21713f23225de1b2ccf48d122d8379b713"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzQ3Njcy", "url": "https://github.com/apache/pulsar/pull/8454#pullrequestreview-525347672", "createdAt": "2020-11-06T17:19:44Z", "commit": {"oid": "77071a21713f23225de1b2ccf48d122d8379b713"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTgxMDYz", "url": "https://github.com/apache/pulsar/pull/8454#pullrequestreview-525581063", "createdAt": "2020-11-07T01:54:12Z", "commit": {"oid": "77071a21713f23225de1b2ccf48d122d8379b713"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1169, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}