{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4ODY4ODQ0", "number": 6407, "title": "[Java client] MultiTopics discovery is broken due to discovery task scheduled twice instead of pendingBatchRecei\u2026", "bodyText": "I wanted to use the topicPattern feature and found out it is broken due to the discovery task being called twice at the same time for the same topic.\nI realized that it is called twice because  ConsumerBase class adds itself to the timer upon initialization and its derived class MultiTopicsConsumerImpl is doing the same.\nI changed ConsumerBase class to add a specific task without using this.\nThis change is a trivial\nI tested the change in my environment and verified the issue was fixed.\nI don't know how to add integration tests yet", "createdAt": "2020-02-24T08:37:59Z", "url": "https://github.com/apache/pulsar/pull/6407", "merged": true, "mergeCommit": {"oid": "40995a06901457101cd9e953d097fa1f6af01a1b"}, "closed": true, "closedAt": "2020-03-18T02:47:07Z", "author": {"login": "avimas"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHtMEqAFqTM2MzkyMzQ0MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOi3hFAH2gAyMzc4ODY4ODQ0OmRlMDQ2MDdkMzU2OGJhZDcyYTNjZmU1MmQ2YjE4NDQzZTA2YTFmMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTIzNDQw", "url": "https://github.com/apache/pulsar/pull/6407#pullrequestreview-363923440", "createdAt": "2020-02-25T07:42:27Z", "commit": {"oid": "4db09817a45d5f7f8c7d6098ac29c69bcb64f07c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzo0MjoyN1rOFt7aVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzo0MjoyN1rOFt7aVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcwMzYzOA==", "bodyText": "Please not use * in the import.", "url": "https://github.com/apache/pulsar/pull/6407#discussion_r383703638", "createdAt": "2020-02-25T07:42:27Z", "author": {"login": "jiazhai"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "diffHunk": "@@ -18,31 +18,9 @@\n  */\n package org.apache.pulsar.client.impl;\n \n-import static com.google.common.base.Preconditions.checkArgument;\n-\n import com.google.common.collect.Queues;\n-import java.util.Collections;\n-import java.util.Map;\n-import java.util.Set;\n-import java.util.concurrent.BlockingQueue;\n-import java.util.concurrent.CompletableFuture;\n-import java.util.concurrent.ConcurrentLinkedQueue;\n-import java.util.concurrent.ExecutorService;\n-import java.util.concurrent.TimeUnit;\n-import java.util.concurrent.atomic.AtomicLongFieldUpdater;\n-\n import io.netty.util.Timeout;\n-import io.netty.util.TimerTask;\n-import org.apache.pulsar.client.api.BatchReceivePolicy;\n-import org.apache.pulsar.client.api.Consumer;\n-import org.apache.pulsar.client.api.ConsumerEventListener;\n-import org.apache.pulsar.client.api.Message;\n-import org.apache.pulsar.client.api.MessageId;\n-import org.apache.pulsar.client.api.MessageListener;\n-import org.apache.pulsar.client.api.Messages;\n-import org.apache.pulsar.client.api.PulsarClientException;\n-import org.apache.pulsar.client.api.Schema;\n-import org.apache.pulsar.client.api.SubscriptionType;\n+import org.apache.pulsar.client.api.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4db09817a45d5f7f8c7d6098ac29c69bcb64f07c"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTI0Mjg4", "url": "https://github.com/apache/pulsar/pull/6407#pullrequestreview-363924288", "createdAt": "2020-02-25T07:44:28Z", "commit": {"oid": "4db09817a45d5f7f8c7d6098ac29c69bcb64f07c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzo0NDoyOFrOFt7dBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwNzo0NDoyOFrOFt7dBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcwNDMyNg==", "bodyText": "also here. please not use *", "url": "https://github.com/apache/pulsar/pull/6407#discussion_r383704326", "createdAt": "2020-02-25T07:44:28Z", "author": {"login": "jiazhai"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "diffHunk": "@@ -52,7 +30,15 @@\n import org.apache.pulsar.common.util.FutureUtil;\n import org.apache.pulsar.common.util.collections.GrowableArrayBlockingQueue;\n \n-public abstract class ConsumerBase<T> extends HandlerState implements TimerTask, Consumer<T> {\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4db09817a45d5f7f8c7d6098ac29c69bcb64f07c"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODE5NTQ3", "url": "https://github.com/apache/pulsar/pull/6407#pullrequestreview-366819547", "createdAt": "2020-02-29T20:52:42Z", "commit": {"oid": "9b10d9efa66b347edd99fa2dc80e6abf96aa72f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MDQwNjYy", "url": "https://github.com/apache/pulsar/pull/6407#pullrequestreview-368040662", "createdAt": "2020-03-03T14:48:19Z", "commit": {"oid": "9b10d9efa66b347edd99fa2dc80e6abf96aa72f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5c7cb51257d1b6a5f5aca54f403ec5ef6845af9", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/e5c7cb51257d1b6a5f5aca54f403ec5ef6845af9", "committedDate": "2020-03-17T13:38:25Z", "message": "fix topic discovery task scheduled twice instead of pendingBatchReceiveTask"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de04607d3568bad72a3cfe52d6b18443e06a1f25", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/de04607d3568bad72a3cfe52d6b18443e06a1f25", "committedDate": "2020-03-17T13:38:26Z", "message": "remove wildcard imports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4938, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}