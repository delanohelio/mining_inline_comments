{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMzI2NjU5", "number": 6028, "title": "[Issue 5690][pulsar-io] Make type name of Elasticsearch sink connector configurable.", "bodyText": "Fixes #5690\nMotivation\nThe default type name cannot be compatible with Elasticsearch versions both before 6.2 and after 7.0, so this change makes it configurable.\nModifications\nMake type name configurable, and set the default value to \"_doc\" to make it compatible with Elasticsearch versions after 6.2 by default.\nVerifying this change\nAdded unit tests and local integration tests.\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: yes\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-01-10T08:11:59Z", "url": "https://github.com/apache/pulsar/pull/6028", "merged": true, "mergeCommit": {"oid": "e23c6a8b2657d0db611c9c2bfd715a79aeb734b9"}, "closed": true, "closedAt": "2020-01-23T08:30:25Z", "author": {"login": "fantapsody"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb45JHZAH2gAyMzYxMzI2NjU5OmVjOWFiY2ZmYzFmODNhOGM2YTQxZWUwOTVlNTgyN2RhMWU1NWFhZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb58U_xgFqTM0MTgzOTk3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec9abcffc1f83a8c6a41ee095e5827da1e55aae2", "author": {"user": {"login": "fantapsody", "name": "Yang Yang"}}, "url": "https://github.com/apache/pulsar/commit/ec9abcffc1f83a8c6a41ee095e5827da1e55aae2", "committedDate": "2020-01-10T07:09:14Z", "message": "[pulsar-io-elastic-search] Made type name configurable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94f9b32baeb84ec2df815e0fac451d1b7c92187a", "author": {"user": {"login": "fantapsody", "name": "Yang Yang"}}, "url": "https://github.com/apache/pulsar/commit/94f9b32baeb84ec2df815e0fac451d1b7c92187a", "committedDate": "2020-01-10T08:23:22Z", "message": "[pulsar-io-elastic-search] Made type name configurable."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMTIyNTY2", "url": "https://github.com/apache/pulsar/pull/6028#pullrequestreview-341122566", "createdAt": "2020-01-10T12:07:16Z", "commit": {"oid": "94f9b32baeb84ec2df815e0fac451d1b7c92187a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMjowNzoxNlrOFcSUTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMjowNzoxNlrOFcSUTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIwNDU1Ng==", "bodyText": "Please align the indentation level with other annotations", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365204556", "createdAt": "2020-01-10T12:07:16Z", "author": {"login": "vzhikserg"}, "path": "pulsar-io/elastic-search/src/main/java/org/apache/pulsar/io/elasticsearch/ElasticSearchConfig.java", "diffHunk": "@@ -52,6 +52,15 @@\n     )\n     private String indexName;\n \n+    @FieldDoc(\n+            required = false,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94f9b32baeb84ec2df815e0fac451d1b7c92187a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0630f3a1d5b94f75c82e5866246076628a8fa24", "author": {"user": {"login": "fantapsody", "name": "Yang Yang"}}, "url": "https://github.com/apache/pulsar/commit/e0630f3a1d5b94f75c82e5866246076628a8fa24", "committedDate": "2020-01-10T22:12:12Z", "message": "[pulsar-io-elastic-search] Fixed indention."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca", "author": {"user": {"login": "fantapsody", "name": "Yang Yang"}}, "url": "https://github.com/apache/pulsar/commit/c686e19f597f3248c7094baa70e73bfc80defaca", "committedDate": "2020-01-12T16:23:41Z", "message": "[pulsar-io-elasticsearch] Adds an example in the doc of Elasticsearch connector."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNzA0NDAw", "url": "https://github.com/apache/pulsar/pull/6028#pullrequestreview-341704400", "createdAt": "2020-01-13T09:07:54Z", "commit": {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwOTowNzo1NFrOFcwYng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwOTowNzo1NFrOFcwYng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY5NzE4Mg==", "bodyText": "IMHO this example section should still belong to the ## Configuration part.  ### Configuration looks weird in this context.", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365697182", "createdAt": "2020-01-13T09:07:54Z", "author": {"login": "vzhikserg"}, "path": "site2/docs/io-elasticsearch-sink.md", "diffHunk": "@@ -16,21 +16,26 @@ The configuration of the ElasticSearch sink connector has the following properti\n |------|----------|----------|---------|-------------|\n | `elasticSearchUrl` | String| true |\" \" (empty string)| The URL of elastic search cluster to which the connector connects. |\n | `indexName` | String| true |\" \" (empty string)| The index name to which the connector writes messages. |\n+| `typeName` | String | false | \"_doc\" | The type name to which the connector writes messages to. <br><br> The value should be set explicitly to a valid type name other than \"_doc\" for Elasticsearch version before 6.2, and left to default otherwise. |\n | `indexNumberOfShards` | int| false |1| The number of shards of the index. |\n | `indexNumberOfReplicas` | int| false |1 | The number of replicas of the index. |\n | `username` | String| false |\" \" (empty string)| The username used by the connector to connect to the elastic search cluster. <br><br>If `username` is set, then `password` should also be provided. |\n | `password` | String| false | \" \" (empty string)|The password used by the connector to connect to the elastic search cluster. <br><br>If `username` is set, then `password` should also be provided.  |\n \n-### Example\n+## Example", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNzU0Njg2", "url": "https://github.com/apache/pulsar/pull/6028#pullrequestreview-341754686", "createdAt": "2020-01-13T10:38:53Z", "commit": {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNzk4NDYy", "url": "https://github.com/apache/pulsar/pull/6028#pullrequestreview-341798462", "createdAt": "2020-01-13T12:05:22Z", "commit": {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMjowNToyMlrOFc0zCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMjowNToyMlrOFc0zCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc2OTQ4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ```bash\n          \n          \n            \n                    ```json", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365769483", "createdAt": "2020-01-13T12:05:22Z", "author": {"login": "vzhikserg"}, "path": "site2/docs/io-elasticsearch-sink.md", "diffHunk": "@@ -40,10 +45,95 @@ Before using the ElasticSearch sink connector, you need to create a configuratio\n \n     ```yaml\n     configs:\n-        elasticSearchUrl: \"http://localhost:90902\"\n-        indexName: \"myIndex\"\n+        elasticSearchUrl: \"http://localhost:9200\"\n+        indexName: \"my_index\"\n         username: \"scooby\"\n         password: \"doobie\"\n     ```\n \n+#### For Elasticsearch Before 6.2\n+\n+* JSON \n+\n+    ```json\n+    {\n+        \"elasticSearchUrl\": \"http://localhost:9200\",\n+        \"indexName\": \"my_index\",\n+        \"typeName\": \"doc\",\n+        \"username\": \"scooby\",\n+        \"password\": \"doobie\"\n+    }\n+    ```\n+\n+* YAML\n+\n+    ```yaml\n+    configs:\n+        elasticSearchUrl: \"http://localhost:9200\"\n+        indexName: \"my_index\"\n+        typeName: \"doc\"\n+        username: \"scooby\"\n+        password: \"doobie\"\n+    ```\n+\n+### Usage\n+\n+1. Start a single node Elasticsearch cluster.\n+\n+    ```bash\n+    $ docker run -p 9200:9200 -p 9300:9300 \\\n+        -e \"discovery.type=single-node\" \\\n+        docker.elastic.co/elasticsearch/elasticsearch:7.5.1\n+    ```\n+\n+2. Start a Pulsar service locally in standalone mode.\n+    ```bash\n+    $ bin/pulsar standalone\n+    ```\n+    Make sure the nar file is available at `connectors/pulsar-io-elastic-search-{{pulsar:version}}.nar`.\n+\n+3. Start the Pulsar Elasticsearch connector in local run mode using one of the following methods.\n+    * Use the **JSON** configuration as shown previously. \n+        ```bash\n+        $ bin/pulsar-admin sinks localrun \\\n+            --archive connectors/pulsar-io-elastic-search-{{pulsar:version}}.nar \\\n+            --tenant public \\\n+            --namespace default \\\n+            --name elasticsearch-test-sink \\\n+            --sink-type elastic_search \\\n+            --sink-config '{\"elasticSearchUrl\":\"http://localhost:9200\",\"indexName\": \"my_index\",\"username\": \"scooby\",\"password\": \"doobie\"}' \\\n+            --inputs elasticsearch_test\n+        ```\n+    * Use the **YAML** configuration file as shown previously.\n+    \n+        ```bash\n+        $ bin/pulsar-admin sinks localrun \\\n+            --archive connectors/pulsar-io-elastic-search-{{pulsar:version}}.nar \\\n+            --tenant public \\\n+            --namespace default \\\n+            --name elasticsearch-test-sink \\\n+            --sink-type elastic_search \\\n+            --sink-config-file elasticsearch-sink.yml \\\n+            --inputs elasticsearch_test\n+        ```\n+\n+4. Publish records to the topic.\n+\n+    ```bash\n+    $ bin/pulsar-client produce elasticsearch_test --messages \"{\\\"a\\\":1}\"\n+    ```\n \n+5. Check documents in Elasticsearch.\n+    \n+    * refresh the index\n+        ```bash\n+            $ curl -s http://localhost:9200/my_index/_refresh\n+        ``` \n+    * search documents\n+        ```bash\n+            $ curl -s http://localhost:9200/my_index/_search\n+        ```\n+        You can see the record that published earlier has been successfully written into Elasticsearch.\n+        ```bash", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxODA0OTI0", "url": "https://github.com/apache/pulsar/pull/6028#pullrequestreview-341804924", "createdAt": "2020-01-13T12:18:29Z", "commit": {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea407473c9fdce7f48402fcdb5cb3bc71600fb8c", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/ea407473c9fdce7f48402fcdb5cb3bc71600fb8c", "committedDate": "2020-01-13T13:24:22Z", "message": "Update site2/docs/io-elasticsearch-sink.md\n\nCo-Authored-By: Sergii Zhevzhyk <vzhikserg@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxODM5OTc5", "url": "https://github.com/apache/pulsar/pull/6028#pullrequestreview-341839979", "createdAt": "2020-01-13T13:25:51Z", "commit": {"oid": "ea407473c9fdce7f48402fcdb5cb3bc71600fb8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1439, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}