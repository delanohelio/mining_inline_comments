{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzOTQyMzQw", "number": 7266, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMToxOToxOFrOEFv6RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xNFQyMDowMDowMFrOF-fFAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NDYzMzAwOnYy", "diffSide": "RIGHT", "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/Entry.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMToxOToxOFrOGkH84Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xM1QwNzoyNzo0NVrOJaXHfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzMjE5Mw==", "bodyText": "I think we better not add message related concepts to the entry. Maybe we can add a context carrier in the entry. What do you think?", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r440532193", "createdAt": "2020-06-16T01:19:18Z", "author": {"login": "codelipenghui"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/Entry.java", "diffHunk": "@@ -65,4 +65,39 @@\n      */\n     boolean release();\n \n+    /**\n+     * Get number of batch messages into the entry.\n+     * @return\n+     */\n+    int getNumberOfBatchMessages();\n+\n+    /**\n+     * Set number of batch messages into the entry.\n+     * @param numberOfBatchMessages\n+     */\n+    void setNumberOfBatchMessages(int numberOfBatchMessages);\n+\n+    /**\n+     * Set data size of the entry.\n+     * @param totalSizeInBytes\n+     */\n+    void setTotalSizeInBytes(int totalSizeInBytes);\n+\n+    /**\n+     * Set total number of chunked messages in entry.\n+     * @param totalChunkedMessages\n+     */\n+    void setTotalChunkedMessages(int totalChunkedMessages);\n+\n+    /**\n+     * Get total data size of the entry.\n+     * @return\n+     */\n+    int getTotalSizeInBytes();\n+\n+    /**\n+     * Get total number of chuncked messages.\n+     * @return\n+     */\n+    int getTotalChunkedMessages();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed8073efd83226bbb5f4ef06ec2088eb24a7174d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMTgxNDY3MQ==", "bodyText": "Hi @codelipenghui , could you please provide a little more detail on what you mean by a \"context carrier\"?", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r621814671", "createdAt": "2021-04-28T04:59:55Z", "author": {"login": "devinbost"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/Entry.java", "diffHunk": "@@ -65,4 +65,39 @@\n      */\n     boolean release();\n \n+    /**\n+     * Get number of batch messages into the entry.\n+     * @return\n+     */\n+    int getNumberOfBatchMessages();\n+\n+    /**\n+     * Set number of batch messages into the entry.\n+     * @param numberOfBatchMessages\n+     */\n+    void setNumberOfBatchMessages(int numberOfBatchMessages);\n+\n+    /**\n+     * Set data size of the entry.\n+     * @param totalSizeInBytes\n+     */\n+    void setTotalSizeInBytes(int totalSizeInBytes);\n+\n+    /**\n+     * Set total number of chunked messages in entry.\n+     * @param totalChunkedMessages\n+     */\n+    void setTotalChunkedMessages(int totalChunkedMessages);\n+\n+    /**\n+     * Get total data size of the entry.\n+     * @return\n+     */\n+    int getTotalSizeInBytes();\n+\n+    /**\n+     * Get total number of chuncked messages.\n+     * @return\n+     */\n+    int getTotalChunkedMessages();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzMjE5Mw=="}, "originalCommit": {"oid": "ed8073efd83226bbb5f4ef06ec2088eb24a7174d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTYyMTUwMg==", "bodyText": "I agree with @codelipenghui\nit is unfortunate to add these methods here.\nwe are going to use them (and the underlying fields) only on the Dispatcher.\nit would be better (for instance) to have some EntryWithMetatadata object in Dispatcher that wraps the Entry and adds these fields", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r631621502", "createdAt": "2021-05-13T07:27:45Z", "author": {"login": "eolivelli"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/Entry.java", "diffHunk": "@@ -65,4 +65,39 @@\n      */\n     boolean release();\n \n+    /**\n+     * Get number of batch messages into the entry.\n+     * @return\n+     */\n+    int getNumberOfBatchMessages();\n+\n+    /**\n+     * Set number of batch messages into the entry.\n+     * @param numberOfBatchMessages\n+     */\n+    void setNumberOfBatchMessages(int numberOfBatchMessages);\n+\n+    /**\n+     * Set data size of the entry.\n+     * @param totalSizeInBytes\n+     */\n+    void setTotalSizeInBytes(int totalSizeInBytes);\n+\n+    /**\n+     * Set total number of chunked messages in entry.\n+     * @param totalChunkedMessages\n+     */\n+    void setTotalChunkedMessages(int totalChunkedMessages);\n+\n+    /**\n+     * Get total data size of the entry.\n+     * @return\n+     */\n+    int getTotalSizeInBytes();\n+\n+    /**\n+     * Get total number of chuncked messages.\n+     * @return\n+     */\n+    int getTotalChunkedMessages();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzMjE5Mw=="}, "originalCommit": {"oid": "ed8073efd83226bbb5f4ef06ec2088eb24a7174d"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDAxMDY1MjE4OnYy", "diffSide": "RIGHT", "path": "conf/bkenv.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xNFQyMDowMDowMFrOJbc93w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xNFQyMjozNDo1OFrOJbhwog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjc2NTkxOQ==", "bodyText": "Are you sure?", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r632765919", "createdAt": "2021-05-14T20:00:00Z", "author": {"login": "eolivelli"}, "path": "conf/bkenv.sh", "diffHunk": "@@ -39,7 +39,7 @@ BOOKIE_MEM=${BOOKIE_MEM:-${PULSAR_MEM:-\"-Xms2g -Xmx2g -XX:MaxDirectMemorySize=2g\n BOOKIE_GC=${BOOKIE_GC:-${PULSAR_GC:-\"-XX:+UseG1GC -XX:MaxGCPauseMillis=10 -XX:+ParallelRefProcEnabled -XX:+UnlockExperimentalVMOptions -XX:+DoEscapeAnalysis -XX:ParallelGCThreads=32 -XX:ConcGCThreads=32 -XX:G1NewSizePercent=50 -XX:+DisableExplicitGC -XX:-ResizePLAB\"}}\n \n # Extra options to be passed to the jvm\n-BOOKIE_EXTRA_OPTS=\"${BOOKIE_EXTRA_OPTS:-\"-Dio.netty.leakDetectionLevel=disabled ${PULSAR_EXTRA_OPTS:-\"-Dio.netty.recycler.maxCapacity.default=1000 -Dio.netty.recycler.linkCapacity=1024\"}\"} ${BOOKIE_MEM} ${BOOKIE_GC}\"\n+BOOKIE_EXTRA_OPTS=\"${BOOKIE_EXTRA_OPTS:-\"-Dio.netty.leakDetectionLevel=advanced ${PULSAR_EXTRA_OPTS:-\"-Dio.netty.recycler.maxCapacity.default=1000 -Dio.netty.recycler.linkCapacity=1024\"}\"} ${BOOKIE_MEM} ${BOOKIE_GC}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cac9f3af35a9bdd4041d71b0de331125787caedd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjg0NDQ1MA==", "bodyText": "oops.. good catch. I kept it for testing. fixed it.", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r632844450", "createdAt": "2021-05-14T22:34:58Z", "author": {"login": "rdhabalia"}, "path": "conf/bkenv.sh", "diffHunk": "@@ -39,7 +39,7 @@ BOOKIE_MEM=${BOOKIE_MEM:-${PULSAR_MEM:-\"-Xms2g -Xmx2g -XX:MaxDirectMemorySize=2g\n BOOKIE_GC=${BOOKIE_GC:-${PULSAR_GC:-\"-XX:+UseG1GC -XX:MaxGCPauseMillis=10 -XX:+ParallelRefProcEnabled -XX:+UnlockExperimentalVMOptions -XX:+DoEscapeAnalysis -XX:ParallelGCThreads=32 -XX:ConcGCThreads=32 -XX:G1NewSizePercent=50 -XX:+DisableExplicitGC -XX:-ResizePLAB\"}}\n \n # Extra options to be passed to the jvm\n-BOOKIE_EXTRA_OPTS=\"${BOOKIE_EXTRA_OPTS:-\"-Dio.netty.leakDetectionLevel=disabled ${PULSAR_EXTRA_OPTS:-\"-Dio.netty.recycler.maxCapacity.default=1000 -Dio.netty.recycler.linkCapacity=1024\"}\"} ${BOOKIE_MEM} ${BOOKIE_GC}\"\n+BOOKIE_EXTRA_OPTS=\"${BOOKIE_EXTRA_OPTS:-\"-Dio.netty.leakDetectionLevel=advanced ${PULSAR_EXTRA_OPTS:-\"-Dio.netty.recycler.maxCapacity.default=1000 -Dio.netty.recycler.linkCapacity=1024\"}\"} ${BOOKIE_MEM} ${BOOKIE_GC}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjc2NTkxOQ=="}, "originalCommit": {"oid": "cac9f3af35a9bdd4041d71b0de331125787caedd"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2508, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}