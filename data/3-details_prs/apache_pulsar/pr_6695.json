{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwOTEyNDIy", "number": 6695, "title": "[issue 6694][AVRO ENCODE] Reset cursor if message encode fails.", "bodyText": "Fixes #6694\nMotivation\nIf the avro encode for message fails after writing a few bytes, the cursor in the stream is not reset. The following flush() that would normally reset the cursor is skipped in the event of an exception.\nModifications\nAdd flush() in the finally block.\nTest\nAdded test for verifying the fix", "createdAt": "2020-04-08T15:15:40Z", "url": "https://github.com/apache/pulsar/pull/6695", "merged": true, "mergeCommit": {"oid": "7cffe2ab7420b0001f1337ef6007448124fecf18"}, "closed": true, "closedAt": "2020-04-14T08:43:47Z", "author": {"login": "shiv4289"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVpVdFAH2gAyNDAwOTEyNDIyOjE1ZWRiYzY1NjdlNjkzYTJiMTUwYjc2MWY3NjM1ZWVmNDdmM2Q3Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXfbh4AFqTM5MjcyMTY3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15edbc6567e693a2b150b761f7635eef47f3d769", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/15edbc6567e693a2b150b761f7635eef47f3d769", "committedDate": "2020-04-08T15:08:02Z", "message": "[issue#6694][AVRO ENCODE] Reset cursor if encode fails."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTc3MjIw", "url": "https://github.com/apache/pulsar/pull/6695#pullrequestreview-390177220", "createdAt": "2020-04-08T17:20:23Z", "commit": {"oid": "15edbc6567e693a2b150b761f7635eef47f3d769"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoyMDoyNFrOGC5N3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoyMDoyNFrOGC5N3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4Nzc3Mw==", "bodyText": "If this encoder is already flushed, shall we skip flushing it again?", "url": "https://github.com/apache/pulsar/pull/6695#discussion_r405687773", "createdAt": "2020-04-08T17:20:24Z", "author": {"login": "sijie"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/writer/AvroWriter.java", "diffHunk": "@@ -47,6 +47,11 @@ public AvroWriter(Schema schema) {\n         } catch (Exception e) {\n             throw new SchemaSerializationException(e);\n         } finally {\n+            try {\n+                this.encoder.flush();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15edbc6567e693a2b150b761f7635eef47f3d769"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDUxNjI2", "url": "https://github.com/apache/pulsar/pull/6695#pullrequestreview-390451626", "createdAt": "2020-04-09T02:26:24Z", "commit": {"oid": "15edbc6567e693a2b150b761f7635eef47f3d769"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c516a8cae8da80436dc1521d09fb25fc04ac077d", "author": {"user": {"login": "shiv4289", "name": "Shivji Kumar Jha"}}, "url": "https://github.com/apache/pulsar/commit/c516a8cae8da80436dc1521d09fb25fc04ac077d", "committedDate": "2020-04-13T08:11:24Z", "message": "Add junit test, skip flush if already done"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNTI3MTI4", "url": "https://github.com/apache/pulsar/pull/6695#pullrequestreview-392527128", "createdAt": "2020-04-14T00:32:53Z", "commit": {"oid": "c516a8cae8da80436dc1521d09fb25fc04ac077d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzIxNjc2", "url": "https://github.com/apache/pulsar/pull/6695#pullrequestreview-392721676", "createdAt": "2020-04-14T08:43:28Z", "commit": {"oid": "c516a8cae8da80436dc1521d09fb25fc04ac077d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4906, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}