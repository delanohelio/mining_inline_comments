{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NzEwOTQy", "number": 8647, "title": "Use  Awaitility  instead Thread.sleep in InactiveTopicDeleteTest.java", "bodyText": "In many cases, we don\u2019t need to sleep for that long. Using Awaitility can make the test faster", "createdAt": "2020-11-20T13:37:48Z", "url": "https://github.com/apache/pulsar/pull/8647", "merged": true, "mergeCommit": {"oid": "1b790ba4a64af36749c96a27f9b2e3baf5e3003a"}, "closed": true, "closedAt": "2020-11-21T05:59:29Z", "author": {"login": "315157973"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddD8GcAH2gAyNTI0NzEwOTQyOjZjZDNkNGY5NDZlNjdmNTUzZTdkNzBmZTZjYzczMzI3ZjJiNTY2YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeliZIgFqTUzNTg5Nzc3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6cd3d4f946e67f553e7d70fe6cc73327f2b566c6", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/6cd3d4f946e67f553e7d70fe6cc73327f2b566c6", "committedDate": "2020-11-16T12:16:24Z", "message": "Avoid sleep"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDM4Mjgx", "url": "https://github.com/apache/pulsar/pull/8647#pullrequestreview-535438281", "createdAt": "2020-11-20T13:44:57Z", "commit": {"oid": "6cd3d4f946e67f553e7d70fe6cc73327f2b566c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NTEzMTEy", "url": "https://github.com/apache/pulsar/pull/8647#pullrequestreview-535513112", "createdAt": "2020-11-20T15:12:37Z", "commit": {"oid": "6cd3d4f946e67f553e7d70fe6cc73327f2b566c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNToxMjozOFrOH3Tv1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNToxMjozOFrOH3Tv1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc1NzI3MQ==", "bodyText": "It can simplify by untilAssert(), Please check all.", "url": "https://github.com/apache/pulsar/pull/8647#discussion_r527757271", "createdAt": "2020-11-20T15:12:38Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/InactiveTopicDeleteTest.java", "diffHunk": "@@ -82,12 +84,14 @@ public void testDeleteWhenNoSubscriptions() throws Exception {\n         consumer.close();\n         producer.close();\n \n-        Thread.sleep(2000);\n+        Awaitility.await().atMost(2, TimeUnit.SECONDS).until(() -> admin.topics().getList(\"prop/ns-abc\")\n+                .contains(topic));\n         Assert.assertTrue(admin.topics().getList(\"prop/ns-abc\")\n             .contains(topic));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd3d4f946e67f553e7d70fe6cc73327f2b566c6"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83ea194a969458ee47cefc1dfadedad46d3769c8", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/83ea194a969458ee47cefc1dfadedad46d3769c8", "committedDate": "2020-11-20T16:31:48Z", "message": "fix unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a145c38237e0c0a490889c3fdef03265812988a4", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/a145c38237e0c0a490889c3fdef03265812988a4", "committedDate": "2020-11-20T16:43:24Z", "message": "fix unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODc0Njcw", "url": "https://github.com/apache/pulsar/pull/8647#pullrequestreview-535874670", "createdAt": "2020-11-21T02:30:16Z", "commit": {"oid": "a145c38237e0c0a490889c3fdef03265812988a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODg2NjA4", "url": "https://github.com/apache/pulsar/pull/8647#pullrequestreview-535886608", "createdAt": "2020-11-21T05:35:20Z", "commit": {"oid": "a145c38237e0c0a490889c3fdef03265812988a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwNTozNToyMFrOH3nNSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwNTozNToyMFrOH3nNSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODA3NjEwNw==", "bodyText": "This one should also can instead by Awaitility", "url": "https://github.com/apache/pulsar/pull/8647#discussion_r528076107", "createdAt": "2020-11-21T05:35:20Z", "author": {"login": "codelipenghui"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/InactiveTopicDeleteTest.java", "diffHunk": "@@ -538,13 +523,8 @@ public void testDeleteWhenNoSubscriptionsWithTopicLevelPolicies() throws Excepti\n         admin.topics().setInactiveTopicPolicies(topic2, inactiveTopicPolicies);\n \n         //wait for update\n-        for (int i = 0; i < 50; i++) {\n-            if (admin.topics().getInactiveTopicPolicies(topic2) != null) {\n-                break;\n-            }\n-            Thread.sleep(100);\n-        }\n-\n+        Awaitility.await().atMost(5, TimeUnit.SECONDS).until(()\n+                -> admin.topics().getInactiveTopicPolicies(topic2) != null);\n         // topic should still exist\n         Thread.sleep(2000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a145c38237e0c0a490889c3fdef03265812988a4"}, "originalPosition": 308}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODk3Nzc1", "url": "https://github.com/apache/pulsar/pull/8647#pullrequestreview-535897775", "createdAt": "2020-11-21T05:59:01Z", "commit": {"oid": "a145c38237e0c0a490889c3fdef03265812988a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1115, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}