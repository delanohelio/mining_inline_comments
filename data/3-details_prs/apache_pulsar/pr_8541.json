{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NjkwMzkw", "number": 8541, "title": "[Transaction] Fix the Github CI Test", "bodyText": "Motivation\nTry to fix the Github CI.\nimplement\nbecause we consume all transaction messages than have been produced. but commit marker may not delete, because when a commit marker operation is processing, when we ack the position will not allow to do delete operation of commit marker, so the commit marker may not delete. we should handle this case.\nVerifying this change\nAdd the tests for it\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (no)\nThe default values of configurations: (no)\nThe wire protocol: (no)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)", "createdAt": "2020-11-12T07:46:46Z", "url": "https://github.com/apache/pulsar/pull/8541", "merged": true, "mergeCommit": {"oid": "f684cf0382de01f831a127bed3607495fe617b9f"}, "closed": true, "closedAt": "2020-11-16T09:36:41Z", "author": {"login": "congbobo184"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbtmMPAH2gAyNTE5NjkwMzkwOjQ5M2ZiYTlmMjFlZTk2YWZmODUyMzhmMmViNGZlM2NiNTU5NjhlYjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdc717WgH2gAyNTE5NjkwMzkwOjQwNGVlNTNiZWRkMjNmM2Y1OGE1YWMzMjMwMmJkMzMwMzkwYjIwYzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "493fba9f21ee96aff85238f2eb4fe3cb55968eb4", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/493fba9f21ee96aff85238f2eb4fe3cb55968eb4", "committedDate": "2020-11-12T07:40:38Z", "message": "Fix the Github CI Test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4ODQzMTY4", "url": "https://github.com/apache/pulsar/pull/8541#pullrequestreview-528843168", "createdAt": "2020-11-12T08:19:03Z", "commit": {"oid": "493fba9f21ee96aff85238f2eb4fe3cb55968eb4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoxOTowNFrOHxvGZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoxOTowNFrOHxvGZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxMzk1Nw==", "bodyText": "this is not usually a good fix,\nyou should wait until a given condition is met, other wise the test will be only \"less flaky\"", "url": "https://github.com/apache/pulsar/pull/8541#discussion_r521913957", "createdAt": "2020-11-12T08:19:04Z", "author": {"login": "eolivelli"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TransactionEndToEndTest.java", "diffHunk": "@@ -365,7 +365,7 @@ public void txnMessageAckTest() throws Exception {\n \n         message = consumer.receive(2, TimeUnit.SECONDS);\n         Assert.assertNull(message);\n-\n+        Thread.sleep(500);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "493fba9f21ee96aff85238f2eb4fe3cb55968eb4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64f331baa73f23934245d4da75aff7284fea8576", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/64f331baa73f23934245d4da75aff7284fea8576", "committedDate": "2020-11-12T09:24:00Z", "message": "Merge remote-tracking branch 'apache/master' into congbobo184_transaction_txnmessageacktest_modify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06a60cb3e9e7f2156b22bbe289210f8fa0efd63d", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/06a60cb3e9e7f2156b22bbe289210f8fa0efd63d", "committedDate": "2020-11-12T16:54:41Z", "message": "Fix the test and add the optional when commit marker don't delete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NjU1MDQ0", "url": "https://github.com/apache/pulsar/pull/8541#pullrequestreview-529655044", "createdAt": "2020-11-13T02:15:34Z", "commit": {"oid": "06a60cb3e9e7f2156b22bbe289210f8fa0efd63d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "341391d8663d69b483753507b472297616aa812b", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/341391d8663d69b483753507b472297616aa812b", "committedDate": "2020-11-13T03:13:18Z", "message": "Merge remote-tracking branch 'apache/master' into congbobo184_transaction_txnmessageacktest_modify\n\n# Conflicts:\n#\tpulsar-broker/src/test/java/org/apache/pulsar/client/impl/TransactionEndToEndTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "404ee53bedd23f3f58a5ac32302bd330390b20c6", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/404ee53bedd23f3f58a5ac32302bd330390b20c6", "committedDate": "2020-11-16T02:50:25Z", "message": "Merge remote-tracking branch 'apache/master' into congbobo184_transaction_txnmessageacktest_modify\n\n# Conflicts:\n#\tpulsar-broker/src/test/java/org/apache/pulsar/client/impl/TransactionEndToEndTest.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1052, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}