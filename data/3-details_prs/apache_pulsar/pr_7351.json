{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4OTk3MjUy", "number": 7351, "title": "Fix race condition in which exitFuture in FunctionAssignmentTailer never gets completed even though the tailer thread has exited", "bodyText": "Motivation\nMethod \"startFromMessage()\" can be called after method \"triggerReadToTheEndAndExit()\". Method \"startFromMessage()\" will reset the future to a new future, thus when the tailer thread exits the new future will be completed and the future returned by method \"triggerReadToTheEndAndExit()\" will never be completed\nModifications\nMove the resetting the future in the close() method", "createdAt": "2020-06-24T06:43:10Z", "url": "https://github.com/apache/pulsar/pull/7351", "merged": true, "mergeCommit": {"oid": "14ac1162d5e506fc0ff3625605f01e3b363c3972"}, "closed": true, "closedAt": "2020-06-24T19:28:55Z", "author": {"login": "jerrypeng"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuULVmgH2gAyNDM4OTk3MjUyOjBlOGQwZTJlMjk4MmJhZjBkYzhhYWM2MDY4MGU0NDJmNzYyZTg0NzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcufN4WgFqTQzNjk0MzMyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e8d0e2e2982baf0dc8aac60680e442f762e8473", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/0e8d0e2e2982baf0dc8aac60680e442f762e8473", "committedDate": "2020-06-24T06:37:05Z", "message": "fix race condition in which exitFuture in FunctionAssignmentTailer never gets completed even though the tailer thread has exited"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MzY3NDA4", "url": "https://github.com/apache/pulsar/pull/7351#pullrequestreview-436367408", "createdAt": "2020-06-24T06:47:22Z", "commit": {"oid": "0e8d0e2e2982baf0dc8aac60680e442f762e8473"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNjo0NzoyMlrOGoFFGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNjo0NzoyMlrOGoFFGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY3OTQ0OA==", "bodyText": "What are you trying to do assign a completed future ?", "url": "https://github.com/apache/pulsar/pull/7351#discussion_r444679448", "createdAt": "2020-06-24T06:47:22Z", "author": {"login": "aahmed-se"}, "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionAssignmentTailer.java", "diffHunk": "@@ -113,6 +112,11 @@ public synchronized void close() {\n                     }\n                 }\n                 tailerThread = null;\n+\n+                // complete exit future to be safe\n+                exitFuture.complete(null);\n+                // reset the future\n+                exitFuture = new CompletableFuture<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e8d0e2e2982baf0dc8aac60680e442f762e8473"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49862307c1528e25bd7e17b8c184cce798557016", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/49862307c1528e25bd7e17b8c184cce798557016", "committedDate": "2020-06-24T06:47:23Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTQzMzIz", "url": "https://github.com/apache/pulsar/pull/7351#pullrequestreview-436943323", "createdAt": "2020-06-24T19:28:49Z", "commit": {"oid": "49862307c1528e25bd7e17b8c184cce798557016"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 741, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}