{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2ODIwNjMw", "number": 7668, "title": "update aws deployment for 2.6.0", "bodyText": "Motivation\nI tried to follow the Aws deployment guide at https://pulsar.apache.org/docs/en/deploy-aws/ but found it was pretty outdated - It was trying to install pulsar 2.1.0-incubating. This PR updates it to install 2.6.0.\nModifications\n\nUpdated the pulsar version to 2.6.0\n\nFixed download location for 2.6.0\nUpdated config files for 2.6.0\nFixed connector installation for 2.6.0\nFixed Ansible's yum warning about installing multiple packages\n\n\n\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\nThis change does not change any code\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): no\nThe public API: no\nThe schema: no\nThe default values of configurations: no\nThe wire protocol: no\nThe rest endpoints: no\nThe admin cli options: no\nAnything that affects deployment: only the aws tutorial deployment\n\nDocumentation\n\nDoes this pull request introduce a new feature? no\nIf yes, how is the feature documented? not applicable\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation\n\nalready documented at https://pulsar.apache.org/docs/en/deploy-aws/", "createdAt": "2020-07-26T23:26:11Z", "url": "https://github.com/apache/pulsar/pull/7668", "merged": true, "mergeCommit": {"oid": "3e13b9b383d1743a53b8e025f089f73826abacfe"}, "closed": true, "closedAt": "2020-08-06T21:17:43Z", "author": {"login": "kristi"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc414V4gBqjM1ODc1MDc1MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8M0fcAFqTQ2MjM3NzIwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b639a235adcd444860b30af03c16777f41f58ae", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/5b639a235adcd444860b30af03c16777f41f58ae", "committedDate": "2020-07-26T23:31:12Z", "message": "ignore whitespace changes"}, "afterCommit": {"oid": "fe308ca675060e1eb879cf319b821c8ab747d536", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/fe308ca675060e1eb879cf319b821c8ab747d536", "committedDate": "2020-07-26T23:32:01Z", "message": "ignore whitespace changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe308ca675060e1eb879cf319b821c8ab747d536", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/fe308ca675060e1eb879cf319b821c8ab747d536", "committedDate": "2020-07-26T23:32:01Z", "message": "ignore whitespace changes"}, "afterCommit": {"oid": "3e46b2d194832ab455c0a8e18589a70904e40913", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/3e46b2d194832ab455c0a8e18589a70904e40913", "committedDate": "2020-07-26T23:32:53Z", "message": "ignore whitespace changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTUxNzUx", "url": "https://github.com/apache/pulsar/pull/7668#pullrequestreview-455951751", "createdAt": "2020-07-27T16:39:22Z", "commit": {"oid": "3e46b2d194832ab455c0a8e18589a70904e40913"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNjozOToyMlrOG3qjGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNjozOToyMlrOG3qjGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyMTk3OA==", "bodyText": "Should these go uncommented by default, to keep it consistent with previous behavior?", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r461021978", "createdAt": "2020-07-27T16:39:22Z", "author": {"login": "merlimat"}, "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -123,12 +124,45 @@\n   connection: ssh\n   become: true\n   tasks:\n-    - name: Download Pulsar IO package\n-      unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-io-connectors-{{ pulsar_version }}-bin.tar.gz\n-        remote_src: yes\n-        dest: /opt/pulsar\n-        extra_opts: [\"--strip-components=1\"]\n+    - name: Create connectors directory\n+      file:\n+        path: \"/opt/pulsar/{{ item }}\"\n+        state: directory\n+      loop:\n+        - connectors\n+    - name: Download Pulsar IO packages\n+      get_url:\n+        url: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+        dest: /opt/pulsar/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+      loop:\n+#        - aerospike", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e46b2d194832ab455c0a8e18589a70904e40913"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "177a21d3077d381c01d0a977789e6bf151674c71", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/177a21d3077d381c01d0a977789e6bf151674c71", "committedDate": "2020-07-28T01:23:31Z", "message": "update aws deployment for 2.6.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9349b66caacd6b5acab22a0d1442b524e69011a", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/f9349b66caacd6b5acab22a0d1442b524e69011a", "committedDate": "2020-07-28T01:23:31Z", "message": "ignore whitespace changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61f8223130ff531e574da99b988b8b1ef77d2123", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/61f8223130ff531e574da99b988b8b1ef77d2123", "committedDate": "2020-07-28T01:23:31Z", "message": "actually mount volumes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/23b212b57ee0ab57c804cc81a9227bde837ed64a", "committedDate": "2020-07-28T01:23:31Z", "message": "add a note in the instructions on using connectors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "612d075fb3a3ece650691e682bec6244d296b0fd", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/612d075fb3a3ece650691e682bec6244d296b0fd", "committedDate": "2020-07-27T18:10:06Z", "message": "add a note in the instructions on using connectors"}, "afterCommit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/23b212b57ee0ab57c804cc81a9227bde837ed64a", "committedDate": "2020-07-28T01:23:31Z", "message": "add a note in the instructions on using connectors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NjUzMzg3", "url": "https://github.com/apache/pulsar/pull/7668#pullrequestreview-457653387", "createdAt": "2020-07-29T15:45:27Z", "commit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo0NToyN1rOG4-sYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo0NToyN1rOG4-sYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwMDYxMA==", "bodyText": "This only works for the latest version. It doesn't work for old versions. Did you encounter any troubles using the archive path?", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r462400610", "createdAt": "2020-07-29T15:45:27Z", "author": {"login": "sijie"}, "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -28,20 +28,21 @@\n         state: directory\n       with_items: [\"/opt/pulsar\"]\n     - name: Install RPM packages\n-      yum: pkg={{ item }} state=latest\n-      with_items:\n-        - wget\n-        - java\n-        - sysstat\n-        - vim\n+      yum:\n+        state: latest\n+        name:\n+          - wget\n+          - java\n+          - sysstat\n+          - vim\n     - set_fact:\n-        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '(.*)', '\\\\1:2181') | join(',') }}\"\n-        service_url: \"pulsar://{{ hostvars[groups['proxy'][0]].public_ip }}:6650/\"\n-        http_url: \"http://{{ hostvars[groups['proxy'][0]].public_ip }}:8080/\"\n-        pulsar_version: \"2.1.0-incubating\"\n+        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '^(.*)$', '\\\\1:2181') | join(',') }}\"\n+        service_url: \"{{ pulsar_service_url }}\"\n+        http_url: \"{{ pulsar_web_url }}\"\n+        pulsar_version: \"2.6.0\"\n     - name: Download Pulsar binary package\n       unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz\n+        src: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjk3ODM1", "url": "https://github.com/apache/pulsar/pull/7668#pullrequestreview-461297835", "createdAt": "2020-08-05T02:30:20Z", "commit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjozMDoyMFrOG737qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjozMDoyMFrOG737qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzNTU2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            (Optional) If you want to use any [builtin IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use. \n          \n          \n            \n            (Optional) If you want to use any [built-in IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use.", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r465435562", "createdAt": "2020-08-05T02:30:20Z", "author": {"login": "Huanli-Meng"}, "path": "site2/docs/deploy-aws.md", "diffHunk": "@@ -173,7 +173,11 @@ Remember to enter this command just only once. If you attempt to enter this comm\n \n ## Run the Pulsar playbook\n \n-Once you have created the necessary AWS resources using Terraform, you can install and run Pulsar on the Terraform-created EC2 instances using Ansible. To do so, enter this command:\n+Once you have created the necessary AWS resources using Terraform, you can install and run Pulsar on the Terraform-created EC2 instances using Ansible. \n+\n+(Optional) If you want to use any [builtin IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b113e5d8971f4fb2caceda74daa4a43c6650397e", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/b113e5d8971f4fb2caceda74daa4a43c6650397e", "committedDate": "2020-08-06T09:57:34Z", "message": "Update site2/docs/deploy-aws.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMzc3MjA3", "url": "https://github.com/apache/pulsar/pull/7668#pullrequestreview-462377207", "createdAt": "2020-08-06T09:57:44Z", "commit": {"oid": "b113e5d8971f4fb2caceda74daa4a43c6650397e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 423, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}