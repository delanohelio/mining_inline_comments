{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMjU5MzA3", "number": 8261, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMDoxMDowMFrOEtaaOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo0OTozN1rOEuD5gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDU0MDc1OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMDoxMDowMFrOHhL5oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMDoxMDowMFrOHhL5oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU2MDAzMw==", "bodyText": "So we can have a race and see that this limit is not enforced.\nprobably this is not a big deal (and enforcing it would be very costly) but we should state it clearly at least in the description of this pull request", "url": "https://github.com/apache/pulsar/pull/8261#discussion_r504560033", "createdAt": "2020-10-14T10:10:00Z", "author": {"login": "eolivelli"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "diffHunk": "@@ -105,6 +105,12 @@ public void createTenant(\n \n         try {\n             NamedEntity.checkName(tenant);\n+            List<String> tenants = globalZk().getChildren(path(POLICIES), false);\n+            int maxTenants = pulsar().getConfiguration().getMaxTenants();\n+            //No locks for precise control", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "630272f69af2cd26fa9bcd612dd35f95899fec5b"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NzMzODI0OnYy", "diffSide": "RIGHT", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo0OTozN1rOHiOiqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo0OTozN1rOHiOiqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY1MTg4MQ==", "bodyText": "You shouldn't get the list of tenants from zookeeper first. You should check maxTenants first. If maxTenants is larger than 0, this feature is enabled. Then you get the list of tenants.", "url": "https://github.com/apache/pulsar/pull/8261#discussion_r505651881", "createdAt": "2020-10-15T15:49:37Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "diffHunk": "@@ -105,6 +105,13 @@ public void createTenant(\n \n         try {\n             NamedEntity.checkName(tenant);\n+            List<String> tenants = globalZk().getChildren(path(POLICIES), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0137f54e6ce70e95327d8b738bc23f324fd0118"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2917, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}