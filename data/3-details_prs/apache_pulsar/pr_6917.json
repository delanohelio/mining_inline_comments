{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MDk4Nzc4", "number": 6917, "title": "Make ZkBookieRackAffinityMapping work as expected", "bodyText": "Motivation\nThe current bookie rack affinity logic is problematic. The rack map is expecting a host:port pair but the bookkeeper DNS resolver is expecting a hostname or a host address.\nModification\n\nIntroduce a new HashMap to keep a mapping between hostname and bookie info. It maintains the mapping for bookkeeper DNS resolver to lookup the network location.\n\nVerification\nI have verified it worked well in setting up rackware placement policy.", "createdAt": "2020-05-08T07:46:43Z", "url": "https://github.com/apache/pulsar/pull/6917", "merged": true, "mergeCommit": {"oid": "5d0e3b35957674f1390b1bd220d5a205472e082c"}, "closed": true, "closedAt": "2020-05-19T04:53:13Z", "author": {"login": "sijie"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfM480AH2gAyNDE1MDk4Nzc4OjljNDg1YWYxYWNjYjNjNDEwZWU3ZTVkMDZiYWIyZGEyZDdlY2NjMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcinJB2AH2gAyNDE1MDk4Nzc4OmIyNzUyZDhmNTQzZWNjZDljMDFjN2Y1NWQ0ODVjOTVhNjg5YzgyZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9c485af1accb3c410ee7e5d06bab2da2d7eccc13", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/9c485af1accb3c410ee7e5d06bab2da2d7eccc13", "committedDate": "2020-05-08T07:38:48Z", "message": "Refresh the bookie info map when cache misses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDYzODk2", "url": "https://github.com/apache/pulsar/pull/6917#pullrequestreview-408063896", "createdAt": "2020-05-08T07:47:41Z", "commit": {"oid": "9c485af1accb3c410ee7e5d06bab2da2d7eccc13"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MjUxNjQ0", "url": "https://github.com/apache/pulsar/pull/6917#pullrequestreview-408251644", "createdAt": "2020-05-08T13:48:58Z", "commit": {"oid": "9c485af1accb3c410ee7e5d06bab2da2d7eccc13"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzY0MjI0", "url": "https://github.com/apache/pulsar/pull/6917#pullrequestreview-409764224", "createdAt": "2020-05-12T07:21:47Z", "commit": {"oid": "9c485af1accb3c410ee7e5d06bab2da2d7eccc13"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzoyMTo0N1rOGT5Vow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzoyMTo0N1rOGT5Vow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUxNTU1NQ==", "bodyText": "Do we need to update it here? seems this is a  get operation, If it is not present, there is no need to update?", "url": "https://github.com/apache/pulsar/pull/6917#discussion_r423515555", "createdAt": "2020-05-12T07:21:47Z", "author": {"login": "jiazhai"}, "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkBookieRackAffinityMapping.java", "diffHunk": "@@ -162,10 +180,19 @@ private String getRack(String bookieAddress) {\n             throw new RuntimeException(e);\n         }\n \n+        BookieInfo bi = bookieInfoMap.get(bookieAddress);\n+        if (bi == null) {\n+            Optional<BookieInfo> biOpt = racksWithHost.getBookie(bookieAddress);\n+            if (biOpt.isPresent()) {\n+                bi = biOpt.get();\n+            } else {\n+                updateRacksWithHost(racksWithHost);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c485af1accb3c410ee7e5d06bab2da2d7eccc13"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46d761dc74b568abcefa91775a638f66a5b372cb", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/46d761dc74b568abcefa91775a638f66a5b372cb", "committedDate": "2020-05-18T21:36:40Z", "message": "Merge remote-tracking branch 'apache/master' into fix_rack_placement_policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2752d8f543eccd9c01c7f55d485c95a689c82db", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/b2752d8f543eccd9c01c7f55d485c95a689c82db", "committedDate": "2020-05-18T21:55:40Z", "message": "Racks map expects hostname:port pair"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4856, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}