{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4ODgyMDU2", "number": 8735, "title": "Fix reader always has message available", "bodyText": "Fixes #8721\nMotivation\nWhenever you create a new Reader with startMessageId set to latest and startMessageIdInclusive, hasMessageAvailable will be always true even if the topic is freshly created without any messages inside. If you remove message inclusiveness, then the issue is not appearing.\nModifications\nIf the returned entryId is illegal, it means there is no message\nVerifying this change\nReaderTest#testReaderHasMessageAvailable", "createdAt": "2020-11-28T03:00:53Z", "url": "https://github.com/apache/pulsar/pull/8735", "merged": true, "mergeCommit": {"oid": "4d8974d8581af53b386dd1d58edca42250e377fe"}, "closed": true, "closedAt": "2020-12-01T02:55:08Z", "author": {"login": "315157973"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgylsNAH2gAyNTI4ODgyMDU2OjY0NzU5NTgwMTJkNGM4NTBlYTI4NWMzOWI3OTIxNzNmOTRmOGY0YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhdBCbgH2gAyNTI4ODgyMDU2OmI0OTU1MjczNDZlNTNiNzEyZWI2NDYxMTJkZjFjNTU1MjE3NGIyYTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6475958012d4c850ea285c39b792173f94f8f4c0", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/6475958012d4c850ea285c39b792173f94f8f4c0", "committedDate": "2020-11-28T02:19:14Z", "message": "fix reader always `hasMessageAvailable`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNTY4NDMx", "url": "https://github.com/apache/pulsar/pull/8735#pullrequestreview-540568431", "createdAt": "2020-11-30T02:48:09Z", "commit": {"oid": "6475958012d4c850ea285c39b792173f94f8f4c0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwMjo0ODowOVrOH7qQig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwMjo0ODowOVrOH7qQig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMyMDM5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    .thenCompose((msgId)-> seekAsync(msgId).thenApply((ignore)-> msgId))\n          \n          \n            \n                                    .thenCompose((msgId) -> seekAsync(msgId).thenApply((ignore)-> msgId))", "url": "https://github.com/apache/pulsar/pull/8735#discussion_r532320394", "createdAt": "2020-11-30T02:48:09Z", "author": {"login": "sijie"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "diffHunk": "@@ -2010,11 +2010,16 @@ public boolean hasMessageAvailable() throws PulsarClientException {\n                     startMessageId.partitionIndex == -1) {\n \n                 getLastMessageIdAsync()\n-                        .thenCompose(this::seekAsync)\n-                        .whenComplete((ignore, e) -> {\n+                        .thenCompose((msgId)-> seekAsync(msgId).thenApply((ignore)-> msgId))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6475958012d4c850ea285c39b792173f94f8f4c0"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f213878b866ab5e9643f829e4c019514731901d7", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/f213878b866ab5e9643f829e4c019514731901d7", "committedDate": "2020-11-30T03:43:26Z", "message": "Update pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java\n\nCo-authored-by: Sijie Guo <sg@streamnative.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b495527346e53b712eb646112df1c5552174b2a2", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/b495527346e53b712eb646112df1c5552174b2a2", "committedDate": "2020-11-30T03:45:07Z", "message": "close reader"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 995, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}