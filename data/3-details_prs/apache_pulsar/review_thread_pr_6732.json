{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNjg3NDI5", "number": 6732, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTo0Mjo1OFrODykB8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTo0Mjo1OFrODykB8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MzQ1NzE0OnYy", "diffSide": "RIGHT", "path": "pulsar-client-cpp/lib/PartitionedConsumerImpl.cc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTo0Mjo1OFrOGGrlxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjoxNDoxOVrOGGs63g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1ODgyMQ==", "bodyText": "Could this change be avoid? Seems brings in lot of un-needed changes, also a little confusing to made numPartitions_ and numPartitions mix-used together in this file.", "url": "https://github.com/apache/pulsar/pull/6732#discussion_r409658821", "createdAt": "2020-04-16T15:42:58Z", "author": {"login": "jiazhai"}, "path": "pulsar-client-cpp/lib/PartitionedConsumerImpl.cc", "diffHunk": "@@ -162,14 +174,17 @@ void PartitionedConsumerImpl::handleUnsubscribeAsync(Result result, unsigned int\n         callback(ResultUnknownError);\n         return;\n     }\n-    assert(unsubscribedSoFar_ <= numPartitions_);\n-    assert(consumerIndex <= numPartitions_);\n+    Lock consumersLock(consumersMutex_);\n+    const auto numPartitions = numPartitions_;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b2e55ef9d074a86a9ff619b71ae0ca24b187dd6"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY4MDYwNg==", "bodyText": "I'll change soon, here I should've called method like getNumPartitionsWithLock() (like I did in PartitionedConsumerImpl.\nBecause producers_/consumers_ may be modified in timer's callback, the code that accessed producers_/consumers_ and some other members (see comments in headers) should be protected by lock()/unlock(), except in start().", "url": "https://github.com/apache/pulsar/pull/6732#discussion_r409680606", "createdAt": "2020-04-16T16:14:19Z", "author": {"login": "BewareMyPower"}, "path": "pulsar-client-cpp/lib/PartitionedConsumerImpl.cc", "diffHunk": "@@ -162,14 +174,17 @@ void PartitionedConsumerImpl::handleUnsubscribeAsync(Result result, unsigned int\n         callback(ResultUnknownError);\n         return;\n     }\n-    assert(unsubscribedSoFar_ <= numPartitions_);\n-    assert(consumerIndex <= numPartitions_);\n+    Lock consumersLock(consumersMutex_);\n+    const auto numPartitions = numPartitions_;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1ODgyMQ=="}, "originalCommit": {"oid": "6b2e55ef9d074a86a9ff619b71ae0ca24b187dd6"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1897, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}