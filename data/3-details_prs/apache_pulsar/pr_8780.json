{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwODM4NjU4", "number": 8780, "title": "Fix single-quotes added to user-conf", "bodyText": "Signed-off-by: xiaolong.ran rxl@apache.org\nFixes #8757\nMotivation\nFor the config content of Go Function, different runtime types require different parameters. Under Process Runtime, we only need the json string of config content itself; for k8s runtime, since we need to use the config content object to splice the command line in the pod, we need to add single quotes to the config content for processing.\nModifications\nIn this pull request, we introduced a k8sRuntime flag label, which is used to identify different runtime forms.", "createdAt": "2020-12-02T08:19:50Z", "url": "https://github.com/apache/pulsar/pull/8780", "merged": true, "mergeCommit": {"oid": "03f5b54841ea021553e1fc67c3a5b88ed3ac8d68"}, "closed": true, "closedAt": "2020-12-04T07:40:49Z", "author": {"login": "wolfstudy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiJxPBgH2gAyNTMwODM4NjU4OjAxMjczMjJhYTI0MGM5ZWNkNDk5NmIyM2NmOTk2YWI0MjkwZjQ2OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiyxs2AFqTU0NDcxNzA3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0127322aa240c9ecd4996b23cf996ab4290f4693", "author": {"user": {"login": "wolfstudy", "name": "xiaolong ran"}}, "url": "https://github.com/apache/pulsar/commit/0127322aa240c9ecd4996b23cf996ab4290f4693", "committedDate": "2020-12-02T07:53:35Z", "message": "Fix single-quotes added to user-conf\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d2d5b6863ffa99b8435f5db83fba5b189b86ca0", "author": {"user": {"login": "wolfstudy", "name": "xiaolong ran"}}, "url": "https://github.com/apache/pulsar/commit/0d2d5b6863ffa99b8435f5db83fba5b189b86ca0", "committedDate": "2020-12-02T08:52:40Z", "message": "add test case\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179eccc86f6251114767fcc8f57b8e967d10c65e", "author": {"user": {"login": "wolfstudy", "name": "xiaolong ran"}}, "url": "https://github.com/apache/pulsar/commit/179eccc86f6251114767fcc8f57b8e967d10c65e", "committedDate": "2020-12-02T08:53:35Z", "message": "remove unused code\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNjU3ODQz", "url": "https://github.com/apache/pulsar/pull/8780#pullrequestreview-542657843", "createdAt": "2020-12-02T09:44:29Z", "commit": {"oid": "179eccc86f6251114767fcc8f57b8e967d10c65e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTo0NDoyOVrOH9Se2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwOTo0NDoyOVrOH9Se2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAyNzk5NA==", "bodyText": "Why cannot we use a similar approach as for the Java and Python runtimes (JsonFormat.printer)?\n\n  \n    \n      pulsar/pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java\n    \n    \n         Line 349\n      in\n      a045d92\n    \n    \n    \n    \n\n        \n          \n           args.add(\"'\" + JsonFormat.printer().omittingInsignificantWhitespace().print(instanceConfig.getFunctionDetails()) + \"'\"); \n        \n    \n  \n\n\nYou're fixing the issue for non-k8s runtimes, but wouldn't the problem with json parsing still occur in k8s runtime?", "url": "https://github.com/apache/pulsar/pull/8780#discussion_r534027994", "createdAt": "2020-12-02T09:44:29Z", "author": {"login": "vaihtovirta"}, "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java", "diffHunk": "@@ -224,11 +226,13 @@\n         ObjectMapper objectMapper = ObjectMapperFactory.getThreadLocal();\n         String configContent = objectMapper.writeValueAsString(goInstanceConfig);\n \n-        // Nit: at present, the implementation of go function depends on pulsar-client-go,\n-        // pulsar-client-go uses cgo, so the currently uploaded executable doesn't support cross-compilation.\n         args.add(originalCodeFileName);\n         args.add(\"-instance-conf\");\n-        args.add(\"'\" + configContent + \"'\");\n+        if (k8sRuntime) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "179eccc86f6251114767fcc8f57b8e967d10c65e"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f0436ae5ecaf989a048be7d5c1f403eb2752d7e", "author": {"user": {"login": "wolfstudy", "name": "xiaolong ran"}}, "url": "https://github.com/apache/pulsar/commit/1f0436ae5ecaf989a048be7d5c1f403eb2752d7e", "committedDate": "2020-12-03T00:21:11Z", "message": "Merge branch 'master' into xiaolong/fix-single-quotes-for-go-function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDMxMjcw", "url": "https://github.com/apache/pulsar/pull/8780#pullrequestreview-544031270", "createdAt": "2020-12-03T14:50:45Z", "commit": {"oid": "1f0436ae5ecaf989a048be7d5c1f403eb2752d7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzE3MDc4", "url": "https://github.com/apache/pulsar/pull/8780#pullrequestreview-544717078", "createdAt": "2020-12-04T07:40:12Z", "commit": {"oid": "1f0436ae5ecaf989a048be7d5c1f403eb2752d7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1011, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}