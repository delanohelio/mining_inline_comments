{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMzMwMjE5", "number": 8824, "title": "[Issue 8338][Function Worker] Splitting the authentication logic of function worker and client", "bodyText": "Signed-off-by: Zixuan Liu nodeces@gmail.com\nFixes #8338\nMotivation\n\nIn some scenarios, users use their own function-worker to connect to an existing pulsar cluster. Their own function-worker and pulsar cluster have different authentication methods, In the following code, when both function-worker and client have enabled the authentication and authorization services, the authentication and authorization can take effect. A better way is to separate them. function-worker can enable and disable the authentication service, and the broker-client can also enable and disable the authentication service according to the configuration.\n\nModifications\nAdd a configuration called brokerClientAuthenticationEnabled in the configuration file, which is disabled by default. It is used to control whether the broker-client of function-worker enable or disable the authentication.\nVerifying this change\n\n Make sure that the change passes the CI checks.", "createdAt": "2020-12-04T06:49:33Z", "url": "https://github.com/apache/pulsar/pull/8824", "merged": true, "mergeCommit": {"oid": "3464f46f1b2bc1a6f3eca4cab682e3a81bc2591c"}, "closed": true, "closedAt": "2020-12-07T08:33:36Z", "author": {"login": "nodece"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiy7FbgFqTU0NDcyMjk1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjxU91AFqTU0NTkyMzQxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzIyOTU3", "url": "https://github.com/apache/pulsar/pull/8824#pullrequestreview-544722957", "createdAt": "2020-12-04T07:50:21Z", "commit": {"oid": "ea3adcff255e62950dc4b26288bfe1ec6ddeaa48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNzo1MDoyMVrOH_Evhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNzo1MDoyMVrOH_Evhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwMDAzOA==", "bodyText": "Don't use boolean. This would cause a compatibility issue. The worker service is not able to start with an old configuration.\nUse boxed Boolean.\nprivate Boolean brokerClientAuthenticationEnabled = null;\n\nThen add an implementation isBrokerClientAuthenticationEnabled to check if brokerClientAuthenticationEnabled is set or not. If brokerClientAuthenticationEnabled is not set, fall back to use authenticationEnabled.\npublic boolean isBrokerClientAuthenticationEnabled() {\n    if (brokerClientAuthenticationEnabled != null) {\n        return brokerClientAuthenticationEnabled;\n    } else {\n        return authenticationEnabled;\n    }\n}", "url": "https://github.com/apache/pulsar/pull/8824#discussion_r535900038", "createdAt": "2020-12-04T07:50:21Z", "author": {"login": "sijie"}, "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java", "diffHunk": "@@ -273,6 +273,11 @@\n         doc = \"The frequency of instance liveness check, in milliseconds\"\n     )\n     private long instanceLivenessCheckFreqMs;\n+    @FieldContext(\n+            category = CATEGORY_CLIENT_SECURITY,\n+            doc = \"Whether to enable the broker client authentication used by function workers to talk to brokers\"\n+    )\n+    private boolean brokerClientAuthenticationEnabled = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3adcff255e62950dc4b26288bfe1ec6ddeaa48"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f", "author": {"user": {"login": "nodece", "name": "Zixuan Liu"}}, "url": "https://github.com/apache/pulsar/commit/c4f197d7ac8f93303068c57cece05cbbf029c11f", "committedDate": "2020-12-04T08:05:38Z", "message": "Splitting the authentication logic of function worker and client\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea3adcff255e62950dc4b26288bfe1ec6ddeaa48", "author": {"user": {"login": "nodece", "name": "Zixuan Liu"}}, "url": "https://github.com/apache/pulsar/commit/ea3adcff255e62950dc4b26288bfe1ec6ddeaa48", "committedDate": "2020-12-04T06:47:41Z", "message": "Splitting the authentication logic of function worker and client\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>"}, "afterCommit": {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f", "author": {"user": {"login": "nodece", "name": "Zixuan Liu"}}, "url": "https://github.com/apache/pulsar/commit/c4f197d7ac8f93303068c57cece05cbbf029c11f", "committedDate": "2020-12-04T08:05:38Z", "message": "Splitting the authentication logic of function worker and client\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzQ0NDY5", "url": "https://github.com/apache/pulsar/pull/8824#pullrequestreview-544744469", "createdAt": "2020-12-04T08:27:11Z", "commit": {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0ODE3MjIy", "url": "https://github.com/apache/pulsar/pull/8824#pullrequestreview-544817222", "createdAt": "2020-12-04T10:04:29Z", "commit": {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0ODI1OTg4", "url": "https://github.com/apache/pulsar/pull/8824#pullrequestreview-544825988", "createdAt": "2020-12-04T10:16:06Z", "commit": {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1Nzk2MjMx", "url": "https://github.com/apache/pulsar/pull/8824#pullrequestreview-545796231", "createdAt": "2020-12-07T02:43:56Z", "commit": {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1OTIzNDE2", "url": "https://github.com/apache/pulsar/pull/8824#pullrequestreview-545923416", "createdAt": "2020-12-07T08:32:50Z", "commit": {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 879, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}