{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2ODIwNjMw", "number": 7668, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNjozOToyMlrOESd72g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjozMDoyMFrOEVPAug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3ODAwMjgyOnYy", "diffSide": "RIGHT", "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNjozOToyMlrOG3qjGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxODoxMDo1MFrOG3t2mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyMTk3OA==", "bodyText": "Should these go uncommented by default, to keep it consistent with previous behavior?", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r461021978", "createdAt": "2020-07-27T16:39:22Z", "author": {"login": "merlimat"}, "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -123,12 +124,45 @@\n   connection: ssh\n   become: true\n   tasks:\n-    - name: Download Pulsar IO package\n-      unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-io-connectors-{{ pulsar_version }}-bin.tar.gz\n-        remote_src: yes\n-        dest: /opt/pulsar\n-        extra_opts: [\"--strip-components=1\"]\n+    - name: Create connectors directory\n+      file:\n+        path: \"/opt/pulsar/{{ item }}\"\n+        state: directory\n+      loop:\n+        - connectors\n+    - name: Download Pulsar IO packages\n+      get_url:\n+        url: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+        dest: /opt/pulsar/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+      loop:\n+#        - aerospike", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e46b2d194832ab455c0a8e18589a70904e40913"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2NzYzMw==", "bodyText": "I'm not sure that the previous setup was widely used, given how out of date it was. I feel like it's more of a tutorial / jumping off point, rather than something that someone would use regularly and be confused by its behavior.\nIt's just a lot of time to download all of them.  Feels a bit more friendly to only download a couple, given that these are optional and that people using this are probably trying it out for the first time.", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r461067633", "createdAt": "2020-07-27T17:55:34Z", "author": {"login": "kristi"}, "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -123,12 +124,45 @@\n   connection: ssh\n   become: true\n   tasks:\n-    - name: Download Pulsar IO package\n-      unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-io-connectors-{{ pulsar_version }}-bin.tar.gz\n-        remote_src: yes\n-        dest: /opt/pulsar\n-        extra_opts: [\"--strip-components=1\"]\n+    - name: Create connectors directory\n+      file:\n+        path: \"/opt/pulsar/{{ item }}\"\n+        state: directory\n+      loop:\n+        - connectors\n+    - name: Download Pulsar IO packages\n+      get_url:\n+        url: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+        dest: /opt/pulsar/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+      loop:\n+#        - aerospike", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyMTk3OA=="}, "originalCommit": {"oid": "3e46b2d194832ab455c0a8e18589a70904e40913"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA3NjEyMA==", "bodyText": "I added a note in the documentation page about the connectors", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r461076120", "createdAt": "2020-07-27T18:10:50Z", "author": {"login": "kristi"}, "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -123,12 +124,45 @@\n   connection: ssh\n   become: true\n   tasks:\n-    - name: Download Pulsar IO package\n-      unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-io-connectors-{{ pulsar_version }}-bin.tar.gz\n-        remote_src: yes\n-        dest: /opt/pulsar\n-        extra_opts: [\"--strip-components=1\"]\n+    - name: Create connectors directory\n+      file:\n+        path: \"/opt/pulsar/{{ item }}\"\n+        state: directory\n+      loop:\n+        - connectors\n+    - name: Download Pulsar IO packages\n+      get_url:\n+        url: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+        dest: /opt/pulsar/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+      loop:\n+#        - aerospike", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyMTk3OA=="}, "originalCommit": {"oid": "3e46b2d194832ab455c0a8e18589a70904e40913"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4Njg4Njg4OnYy", "diffSide": "RIGHT", "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo0NToyN1rOG4-sYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNjo0MzowN1rOG6mUVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwMDYxMA==", "bodyText": "This only works for the latest version. It doesn't work for old versions. Did you encounter any troubles using the archive path?", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r462400610", "createdAt": "2020-07-29T15:45:27Z", "author": {"login": "sijie"}, "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -28,20 +28,21 @@\n         state: directory\n       with_items: [\"/opt/pulsar\"]\n     - name: Install RPM packages\n-      yum: pkg={{ item }} state=latest\n-      with_items:\n-        - wget\n-        - java\n-        - sysstat\n-        - vim\n+      yum:\n+        state: latest\n+        name:\n+          - wget\n+          - java\n+          - sysstat\n+          - vim\n     - set_fact:\n-        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '(.*)', '\\\\1:2181') | join(',') }}\"\n-        service_url: \"pulsar://{{ hostvars[groups['proxy'][0]].public_ip }}:6650/\"\n-        http_url: \"http://{{ hostvars[groups['proxy'][0]].public_ip }}:8080/\"\n-        pulsar_version: \"2.1.0-incubating\"\n+        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '^(.*)$', '\\\\1:2181') | join(',') }}\"\n+        service_url: \"{{ pulsar_service_url }}\"\n+        http_url: \"{{ pulsar_web_url }}\"\n+        pulsar_version: \"2.6.0\"\n     - name: Download Pulsar binary package\n       unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz\n+        src: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA5ODM5MQ==", "bodyText": "Oh, thanks for testing this. I eventually hit the archive download limit after testing a bunch. I can see if there is a mirror url for other versions, or else I'll revert to the archive url.", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r464098391", "createdAt": "2020-08-02T16:43:07Z", "author": {"login": "kristi"}, "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -28,20 +28,21 @@\n         state: directory\n       with_items: [\"/opt/pulsar\"]\n     - name: Install RPM packages\n-      yum: pkg={{ item }} state=latest\n-      with_items:\n-        - wget\n-        - java\n-        - sysstat\n-        - vim\n+      yum:\n+        state: latest\n+        name:\n+          - wget\n+          - java\n+          - sysstat\n+          - vim\n     - set_fact:\n-        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '(.*)', '\\\\1:2181') | join(',') }}\"\n-        service_url: \"pulsar://{{ hostvars[groups['proxy'][0]].public_ip }}:6650/\"\n-        http_url: \"http://{{ hostvars[groups['proxy'][0]].public_ip }}:8080/\"\n-        pulsar_version: \"2.1.0-incubating\"\n+        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '^(.*)$', '\\\\1:2181') | join(',') }}\"\n+        service_url: \"{{ pulsar_service_url }}\"\n+        http_url: \"{{ pulsar_web_url }}\"\n+        pulsar_version: \"2.6.0\"\n     - name: Download Pulsar binary package\n       unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz\n+        src: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwMDYxMA=="}, "originalCommit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNzAxNDk4OnYy", "diffSide": "RIGHT", "path": "site2/docs/deploy-aws.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjozMDoyMFrOG737qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjozMDoyMFrOG737qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzNTU2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            (Optional) If you want to use any [builtin IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use. \n          \n          \n            \n            (Optional) If you want to use any [built-in IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use.", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r465435562", "createdAt": "2020-08-05T02:30:20Z", "author": {"login": "Huanli-Meng"}, "path": "site2/docs/deploy-aws.md", "diffHunk": "@@ -173,7 +173,11 @@ Remember to enter this command just only once. If you attempt to enter this comm\n \n ## Run the Pulsar playbook\n \n-Once you have created the necessary AWS resources using Terraform, you can install and run Pulsar on the Terraform-created EC2 instances using Ansible. To do so, enter this command:\n+Once you have created the necessary AWS resources using Terraform, you can install and run Pulsar on the Terraform-created EC2 instances using Ansible. \n+\n+(Optional) If you want to use any [builtin IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2343, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}