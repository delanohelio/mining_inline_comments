{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2ODEyODcx", "number": 9091, "title": "fix BKIncorrectParameterException", "bodyText": "Fixes #9090\nMotivation\nThis PR add pre-condition before read entry from BookKeeper to fix BKIncorrectParameterException", "createdAt": "2020-12-30T06:26:48Z", "url": "https://github.com/apache/pulsar/pull/9091", "merged": true, "mergeCommit": {"oid": "796dc0fe89bf6eb57e96f84901cd0889936db964"}, "closed": true, "closedAt": "2021-01-04T17:26:34Z", "author": {"login": "aloyszhang"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrJldBAFqTU1OTkyNjcwMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdsr6FiABqjQxNjMwMDg0OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTI2NzAx", "url": "https://github.com/apache/pulsar/pull/9091#pullrequestreview-559926701", "createdAt": "2020-12-30T06:45:36Z", "commit": {"oid": "80bec8fc924b49f749fb098e1a10cf42edec8bf1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNjo0NTozNlrOIMeiaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNjo0NTozNlrOIMeiaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk1NDE1Mw==", "bodyText": "Using instanceof is a bad practice, not Object oriented.\nIt is not in the scope of this PR but it would be better to have a more OO approach, using polymorphism", "url": "https://github.com/apache/pulsar/pull/9091#discussion_r549954153", "createdAt": "2020-12-30T06:45:36Z", "author": {"login": "eolivelli"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/intercept/ManagedLedgerInterceptorImpl.java", "diffHunk": "@@ -83,9 +83,9 @@ public void onManagedLedgerPropertiesInitialize(Map<String, String> propertiesMa\n     public void onManagedLedgerLastLedgerInitialize(String name, LedgerHandle lh) {\n         try {\n             for (BrokerEntryMetadataInterceptor interceptor : brokerEntryMetadataInterceptors) {\n-                if (interceptor instanceof AppendIndexMetadataInterceptor) {\n+                if (interceptor instanceof AppendIndexMetadataInterceptor && lh.getLastAddConfirmed() >= 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80bec8fc924b49f749fb098e1a10cf42edec8bf1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTg5NDI4", "url": "https://github.com/apache/pulsar/pull/9091#pullrequestreview-559989428", "createdAt": "2020-12-30T10:21:58Z", "commit": {"oid": "80bec8fc924b49f749fb098e1a10cf42edec8bf1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d3ab5ba0968e0817bdeb218465647dc494ebccc", "author": {"user": {"login": "aloyszhang", "name": "Aloys"}}, "url": "https://github.com/apache/pulsar/commit/3d3ab5ba0968e0817bdeb218465647dc494ebccc", "committedDate": "2021-01-04T01:19:02Z", "message": "fix BKIncorrectParameterException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80bec8fc924b49f749fb098e1a10cf42edec8bf1", "author": {"user": {"login": "aloyszhang", "name": "Aloys"}}, "url": "https://github.com/apache/pulsar/commit/80bec8fc924b49f749fb098e1a10cf42edec8bf1", "committedDate": "2020-12-30T02:39:51Z", "message": "fix BKIncorrectParameterException"}, "afterCommit": {"oid": "3d3ab5ba0968e0817bdeb218465647dc494ebccc", "author": {"user": {"login": "aloyszhang", "name": "Aloys"}}, "url": "https://github.com/apache/pulsar/commit/3d3ab5ba0968e0817bdeb218465647dc494ebccc", "committedDate": "2021-01-04T01:19:02Z", "message": "fix BKIncorrectParameterException"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 868, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}