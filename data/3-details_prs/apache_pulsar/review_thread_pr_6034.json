{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxODIyNTA0", "number": 6034, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNTowOFrODd3fCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxMzo1Nzo0NVrODzOW7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjQ0MzYzOnYy", "diffSide": "RIGHT", "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNTowOFrOFmt5CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNTowOFrOFmt5CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE0MjA4OQ==", "bodyText": "I don't think this needs to be a class variable. what method is using this variable except the constructor?", "url": "https://github.com/apache/pulsar/pull/6034#discussion_r376142089", "createdAt": "2020-02-06T23:35:08Z", "author": {"login": "sijie"}, "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "diffHunk": "@@ -188,15 +198,48 @@ public void close() {\n         @Getter\n         Optional<String> destinationTopic;\n \n+        private final AvroData avroData;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema keyAvroSchema;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde744ddb6abe80850dc4357e0ec1de7ed9e86a2"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjQ0NDAzOnYy", "diffSide": "RIGHT", "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNToyMFrOFmt5SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNToyMFrOFmt5SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE0MjE1Mg==", "bodyText": "same comments as above.", "url": "https://github.com/apache/pulsar/pull/6034#discussion_r376142152", "createdAt": "2020-02-06T23:35:20Z", "author": {"login": "sijie"}, "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "diffHunk": "@@ -188,15 +198,48 @@ public void close() {\n         @Getter\n         Optional<String> destinationTopic;\n \n+        private final AvroData avroData;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema keyAvroSchema;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema valueAvroSchema;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde744ddb6abe80850dc4357e0ec1de7ed9e86a2"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjQ0NzA4OnYy", "diffSide": "RIGHT", "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNjo1NlrOFmt7Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNjo1NlrOFmt7Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE0MjYxMA==", "bodyText": "why do we need to make this variable a class variable? it is only used in the constructor.", "url": "https://github.com/apache/pulsar/pull/6034#discussion_r376142610", "createdAt": "2020-02-06T23:36:56Z", "author": {"login": "sijie"}, "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "diffHunk": "@@ -188,15 +198,48 @@ public void close() {\n         @Getter\n         Optional<String> destinationTopic;\n \n+        private final AvroData avroData;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema keyAvroSchema;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema valueAvroSchema;\n+\n+        private final KafkaSchema keySchema;\n+\n+        private final KafkaSchema valueSchema;\n+\n+        private byte[] keyBytes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde744ddb6abe80850dc4357e0ec1de7ed9e86a2"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjQ0NzU0OnYy", "diffSide": "RIGHT", "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNzowNlrOFmt7SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozNzowNlrOFmt7SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE0MjY2NA==", "bodyText": "same comment as above.", "url": "https://github.com/apache/pulsar/pull/6034#discussion_r376142664", "createdAt": "2020-02-06T23:37:06Z", "author": {"login": "sijie"}, "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "diffHunk": "@@ -188,15 +198,48 @@ public void close() {\n         @Getter\n         Optional<String> destinationTopic;\n \n+        private final AvroData avroData;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema keyAvroSchema;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema valueAvroSchema;\n+\n+        private final KafkaSchema keySchema;\n+\n+        private final KafkaSchema valueSchema;\n+\n+        private byte[] keyBytes;\n+\n+        private byte[] valueBytes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde744ddb6abe80850dc4357e0ec1de7ed9e86a2"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjQ1MjkwOnYy", "diffSide": "RIGHT", "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozOTo1N1rOFmt-oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMzozOTo1N1rOFmt-oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE0MzUyMA==", "bodyText": "actually I think the cache here is incorrect. you need a cache from kafka connect schema to pulsar schema.\nCache<org.apache.kafka.connect.data.Schema, KafkaSchema>", "url": "https://github.com/apache/pulsar/pull/6034#discussion_r376143520", "createdAt": "2020-02-06T23:39:57Z", "author": {"login": "sijie"}, "path": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "diffHunk": "@@ -188,15 +198,48 @@ public void close() {\n         @Getter\n         Optional<String> destinationTopic;\n \n+        private final AvroData avroData;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema keyAvroSchema;\n+\n+        private org.apache.pulsar.kafka.shade.avro.Schema valueAvroSchema;\n+\n+        private final KafkaSchema keySchema;\n+\n+        private final KafkaSchema valueSchema;\n+\n+        private byte[] keyBytes;\n+\n+        private byte[] valueBytes;\n+\n         KafkaSourceRecord(SourceRecord srcRecord) {\n-            byte[] keyBytes = keyConverter.fromConnectData(\n+            keyBytes = keyConverter.fromConnectData(\n                 srcRecord.topic(), srcRecord.keySchema(), srcRecord.key());\n-            byte[] valueBytes = valueConverter.fromConnectData(\n+            valueBytes = valueConverter.fromConnectData(\n                 srcRecord.topic(), srcRecord.valueSchema(), srcRecord.value());\n+            this.avroData = new AvroData(1000);\n             this.key = keyBytes != null ? Optional.of(Base64.getEncoder().encodeToString(keyBytes)) : Optional.empty();\n             this.value = new KeyValue(keyBytes, valueBytes);\n \n             this.topicName = Optional.of(srcRecord.topic());\n+            String keyName = this.topicName.get() + \"-key\";\n+            String valueName = this.topicName.get() + \"-value\";\n+\n+            if (readerCache.getIfPresent(keyName) == null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde744ddb6abe80850dc4357e0ec1de7ed9e86a2"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MDM5MjEzOnYy", "diffSide": "RIGHT", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroReader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxMzo1Nzo0NVrOGHrOSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxMzo1Nzo0NVrOGHrOSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcwMTM4Nw==", "bodyText": "There are two properties name definition in the SchemaDefinitionBuilderImpl.  I think you can move all of them to SchemaDefinition and keep the with prefix \"__\".", "url": "https://github.com/apache/pulsar/pull/6034#discussion_r410701387", "createdAt": "2020-04-18T13:57:45Z", "author": {"login": "codelipenghui"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroReader.java", "diffHunk": "@@ -47,6 +47,10 @@\n     private final List<Field> fields;\n     private final Schema schema;\n     private final byte[] schemaVersion;\n+\n+    private int offset;\n+    public final static String OFFSET_PROP = \"AVRO_READ_OFFSET\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a94785f875bbce78d830f54b221b4b0d4a8b4dd5"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2066, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}