{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MTcwMTU4", "number": 7833, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODowNDoxNFrOEdG6Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODoyMzozOFrOEdHVlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTU3Mzc0OnYy", "diffSide": "RIGHT", "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODowNDoxNFrOHIFAPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjozNDoxNFrOHIYWWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIzMjYzNw==", "bodyText": "batchDeletedIndexes.computeIfAbsent().", "url": "https://github.com/apache/pulsar/pull/7833#discussion_r478232637", "createdAt": "2020-08-27T08:04:14Z", "author": {"login": "codelipenghui"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java", "diffHunk": "@@ -2857,5 +2857,14 @@ private int applyMaxSizeCap(int maxEntries, long maxSizeBytes) {\n \n         return Math.min(maxEntriesBasedOnSize, maxEntries);\n     }\n+\n+    public void internalInitBatchDeletedIndex(PositionImpl position, int totalNumMessageInBatch) {\n+        if (!batchDeletedIndexes.containsKey(position)) {\n+            BitSetRecyclable bitSetRecyclable = BitSetRecyclable.create();\n+            bitSetRecyclable.set(0, totalNumMessageInBatch);\n+            batchDeletedIndexes.put(position, bitSetRecyclable);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b19df42411233d9717160a6e6024a4d29382f0e1"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU0OTU5NQ==", "bodyText": "I'll use this method instead.", "url": "https://github.com/apache/pulsar/pull/7833#discussion_r478549595", "createdAt": "2020-08-27T16:34:14Z", "author": {"login": "gaoran10"}, "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java", "diffHunk": "@@ -2857,5 +2857,14 @@ private int applyMaxSizeCap(int maxEntries, long maxSizeBytes) {\n \n         return Math.min(maxEntriesBasedOnSize, maxEntries);\n     }\n+\n+    public void internalInitBatchDeletedIndex(PositionImpl position, int totalNumMessageInBatch) {\n+        if (!batchDeletedIndexes.containsKey(position)) {\n+            BitSetRecyclable bitSetRecyclable = BitSetRecyclable.create();\n+            bitSetRecyclable.set(0, totalNumMessageInBatch);\n+            batchDeletedIndexes.put(position, bitSetRecyclable);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIzMjYzNw=="}, "originalCommit": {"oid": "b19df42411233d9717160a6e6024a4d29382f0e1"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTY0Mzc0OnYy", "diffSide": "RIGHT", "path": ".github/workflows/ci-unit-broker-broker-gp1.yaml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODoyMzozOFrOHIFsYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwODoyMzozOFrOHIFsYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MzkzOQ==", "bodyText": "Shall we need this change?", "url": "https://github.com/apache/pulsar/pull/7833#discussion_r478243939", "createdAt": "2020-08-27T08:23:38Z", "author": {"login": "codelipenghui"}, "path": ".github/workflows/ci-unit-broker-broker-gp1.yaml", "diffHunk": "@@ -65,13 +65,13 @@ jobs:\n         if: steps.docs.outputs.changed_only == 'no'\n         run: ./build/retry.sh mvn -B -ntp test -pl pulsar-broker -Dinclude='**/AdminApiOffloadTest.java' -DtestForkCount=1 -DtestReuseFork=true\n \n-      - name: run flaky test '**/TransactionProduceTest.java'\n+      - name: run transaction test\n         if: steps.docs.outputs.changed_only == 'no'\n-        run: ./build/retry.sh mvn -B -ntp test -pl pulsar-broker -Dinclude='**/TransactionProduceTest.java' -DtestForkCount=1 -DtestReuseFork=true\n+        run: ./build/retry.sh mvn -B -ntp test -pl pulsar-broker -Dinclude='org/apache/pulsar/broker/transaction/**/*.java,org/apache/pulsar/client/transaction/**/*.java' -DfailIfNoTests=false -DtestForkCount=1 -DtestReuseFork=true\n \n       - name: run unit tests for pulsar-broker\n         if: steps.docs.outputs.changed_only == 'no'\n-        run: ./build/retry.sh mvn -B -ntp test -pl pulsar-broker -Dinclude='org/apache/pulsar/broker/**/*.java' -Dexclude='org/apache/pulsar/broker/zookeeper/**/*.java,org/apache/pulsar/broker/loadbalance/**/*.java,org/apache/pulsar/broker/service/**/*.java,**/AdminApiOffloadTest.java,**/TransactionProduceTest.java'\n+        run: ./build/retry.sh mvn -B -ntp test -pl pulsar-broker -Dinclude='org/apache/pulsar/broker/**/*.java' -Dexclude='org/apache/pulsar/broker/zookeeper/**/*.java,org/apache/pulsar/broker/loadbalance/**/*.java,org/apache/pulsar/broker/service/**/*.java,**/AdminApiOffloadTest.java,org/apache/pulsar/broker/transaction/**/*.java,org/apache/pulsar/client/transaction/**/*.java'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b19df42411233d9717160a6e6024a4d29382f0e1"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2253, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}