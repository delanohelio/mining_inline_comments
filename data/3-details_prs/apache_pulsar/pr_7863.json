{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMDA2NjEx", "number": 7863, "title": "support message dispatch rate on topic level", "bodyText": "Motivation\nSupport message dispatch rate on topic level.\nBased on the system topic function.\nModifications\nSupport set message dispatch rate on topic level.\nSupport get message dispatch rate on topic level.\nSupport remove message dispatch rate on topic level.\nVerifying this change\nThis change added tests and can be verified as follows:\n\ntest set topic message dispatch rate\ntest remove topic message dispatch rate\ntest get topic message dispatch rate\ntest disabled topic message dispatch rate\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes)\nAnything that affects deployment: (no)\n\nDocumentation\nDoes this pull request introduce a new feature? (yes)\nIf yes, how is the feature documented? (docs / JavaDocs)", "createdAt": "2020-08-20T15:45:51Z", "url": "https://github.com/apache/pulsar/pull/7863", "merged": true, "mergeCommit": {"oid": "395037e9cfb03a3cbbc22347e95fa76dae282898"}, "closed": true, "closedAt": "2020-08-28T13:33:12Z", "author": {"login": "hangc0276"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBYtC8gFqTQ3MjkyMTE0MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDVFRDAFqTQ3NzczMTEwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTIxMTQw", "url": "https://github.com/apache/pulsar/pull/7863#pullrequestreview-472921140", "createdAt": "2020-08-22T11:52:13Z", "commit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxMTo1MjoxM1rOHFEv9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxMTo1MjoxM1rOHFEv9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA4Mjc0Mg==", "bodyText": "It is recommended to return CompletableFuture instead of passing in the parameter AsyncResponse", "url": "https://github.com/apache/pulsar/pull/7863#discussion_r475082742", "createdAt": "2020-08-22T11:52:13Z", "author": {"login": "jianyun8023"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "diffHunk": "@@ -3056,4 +3057,53 @@ protected void internalGetLastMessageId(AsyncResponse asyncResponse, boolean aut\n         });\n \n     }\n+\n+    protected void internalGetDispatchRate(AsyncResponse asyncResponse) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTY4NjM5", "url": "https://github.com/apache/pulsar/pull/7863#pullrequestreview-472968639", "createdAt": "2020-08-22T23:37:19Z", "commit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQyMzozNzoyMFrOHFIz-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQyMzozNzoyMFrOHFIz-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE0OTMwNA==", "bodyText": "wouldn't this remove all listeners for a given topic?", "url": "https://github.com/apache/pulsar/pull/7863#discussion_r475149304", "createdAt": "2020-08-22T23:37:20Z", "author": {"login": "MarvinCai"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java", "diffHunk": "@@ -329,5 +337,15 @@ Boolean getPoliciesCacheInit(NamespaceName namespaceName) {\n         return policyCacheInitMap.get(namespaceName);\n     }\n \n+    @Override\n+    public void registerListener(TopicName topicName, TopicPolicyListener<TopicPolicies> listener) {\n+        listeners.computeIfAbsent(topicName, k -> Lists.newCopyOnWriteArrayList()).add(listener);\n+    }\n+\n+    @Override\n+    public void unregisterListener(TopicName topicName, TopicPolicyListener<TopicPolicies> listener) {\n+        listeners.computeIfAbsent(topicName, k -> Lists.newCopyOnWriteArrayList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "532d3d64034f831d7e1d57efeb7ed3afe04f34dd"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMDA2MzY4", "url": "https://github.com/apache/pulsar/pull/7863#pullrequestreview-473006368", "createdAt": "2020-08-23T12:15:05Z", "commit": {"oid": "b6712de59b63524aea7a6da421ce9822cf854444"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fd4efb048a62f54c9adad9326f34f9cc32d47bd", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/0fd4efb048a62f54c9adad9326f34f9cc32d47bd", "committedDate": "2020-08-28T10:58:44Z", "message": "support message dispatch rate on topic level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62b452d90ab4a18393ffdb0c41135486c1a97348", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/62b452d90ab4a18393ffdb0c41135486c1a97348", "committedDate": "2020-08-28T10:58:44Z", "message": "add topic policy listener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3999f47afeb11b1bd7c1425df0f9d581f05f970a", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/3999f47afeb11b1bd7c1425df0f9d581f05f970a", "committedDate": "2020-08-28T10:58:44Z", "message": "add license"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb6314789534641fd2d93449cc58adfdf6140026", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/cb6314789534641fd2d93449cc58adfdf6140026", "committedDate": "2020-08-28T10:58:44Z", "message": "fix unregister listener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90fe76946138059005beaa23c5e421d2b7c75dac", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/90fe76946138059005beaa23c5e421d2b7c75dac", "committedDate": "2020-08-28T10:58:44Z", "message": "change internalGetDispatchRate request interfac3e"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6712de59b63524aea7a6da421ce9822cf854444", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/b6712de59b63524aea7a6da421ce9822cf854444", "committedDate": "2020-08-23T04:21:57Z", "message": "change internalGetDispatchRate request interfac3e"}, "afterCommit": {"oid": "90fe76946138059005beaa23c5e421d2b7c75dac", "author": {"user": {"login": "hangc0276", "name": "Hang Chen"}}, "url": "https://github.com/apache/pulsar/commit/90fe76946138059005beaa23c5e421d2b7c75dac", "committedDate": "2020-08-28T10:58:44Z", "message": "change internalGetDispatchRate request interfac3e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NzMxMTA1", "url": "https://github.com/apache/pulsar/pull/7863#pullrequestreview-477731105", "createdAt": "2020-08-28T13:32:46Z", "commit": {"oid": "90fe76946138059005beaa23c5e421d2b7c75dac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 334, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}