{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMTc3NTU1", "number": 6039, "title": "[Issue 6024][pulsar_storm] PulsarSpout emit to multiple streams", "bodyText": "Fixes #6024\nMotivation\nThis is all described in detail in #6024, but in short, an insurmountable obstacle to using Pulsar in our storm topology is the fact that PulsarSpout only emits to the \"default\" stream. In our environment, we need to emit on different streams based on the content of each received message. This change extends PulsarSpout to recognize a Values extension that specifies an alternate output stream, and uses that stream when given.\nModifications\nA new PulsarTuple class is added. It extends Values and adds a method to return the output stream.\nWhen emitting a tuple after calling toValues(msg), PulsarSpout checks if the returned Values is a PulsarTuple. If so, it emits to the designated stream, otherwise it emits as before.\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\nThis change added tests and can be verified as follows:\n\nA test case was added to PulsarSpoutTest to verify that when PulsarTuple is used, the tuple is emitted in the specified stream.\n\nDoes this pull request potentially affect one of the following parts:\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (yes?) Existing APIs don't change, but a new class is added that carries additional information.\nThe schema: (no)\nThe default values of configurations: (no)\nThe wire protocol: (no)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes)\nIf yes, how is the feature documented? JavaDocs", "createdAt": "2020-01-13T15:28:31Z", "url": "https://github.com/apache/pulsar/pull/6039", "merged": true, "mergeCommit": {"oid": "af6b5f6632a64a31c1fdbb8d69196b632a48ef34"}, "closed": true, "closedAt": "2020-02-03T18:03:20Z", "author": {"login": "dawillcox"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5-B_XAH2gAyMzYyMTc3NTU1OjM5Yzk4YzBjNzU3OTQzZTU2OWY2OWEwZjYyYjQ5ZmZlMDRmY2ZhMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAw4OIAFqTM1MjQ1MDgxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "39c98c0c757943e569f69a0f62b49ffe04fcfa27", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/39c98c0c757943e569f69a0f62b49ffe04fcfa27", "committedDate": "2020-01-13T15:24:54Z", "message": "[Issue 6024][pulsar_storm] PulsarSpout emit to multiple streams"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxOTI3NTY4", "url": "https://github.com/apache/pulsar/pull/6039#pullrequestreview-341927568", "createdAt": "2020-01-13T15:31:27Z", "commit": {"oid": "39c98c0c757943e569f69a0f62b49ffe04fcfa27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNTozMToyN1rOFc6vkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNTozMToyN1rOFc6vkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg2Njg5Nw==", "bodyText": "public is redundant. Interface methods must be public.", "url": "https://github.com/apache/pulsar/pull/6039#discussion_r365866897", "createdAt": "2020-01-13T15:31:27Z", "author": {"login": "dawillcox"}, "path": "pulsar-storm/src/main/java/org/apache/pulsar/storm/MessageToValuesMapper.java", "diffHunk": "@@ -33,12 +33,12 @@\n      * @param msg\n      * @return\n      */\n-    public Values toValues(Message<byte[]> msg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39c98c0c757943e569f69a0f62b49ffe04fcfa27"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMTkyMzU1", "url": "https://github.com/apache/pulsar/pull/6039#pullrequestreview-342192355", "createdAt": "2020-01-13T22:48:17Z", "commit": {"oid": "39c98c0c757943e569f69a0f62b49ffe04fcfa27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QyMjo0ODoxN1rOFdHKtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QyMjo0ODoxN1rOFdHKtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA3MDQ1NQ==", "bodyText": "Please add the license for this file.", "url": "https://github.com/apache/pulsar/pull/6039#discussion_r366070455", "createdAt": "2020-01-13T22:48:17Z", "author": {"login": "rdhabalia"}, "path": "pulsar-storm/src/main/java/org/apache/pulsar/storm/PulsarTuple.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.apache.pulsar.storm;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39c98c0c757943e569f69a0f62b49ffe04fcfa27"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "942a403e2692e345820f5172f03fff0351cefe89", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/942a403e2692e345820f5172f03fff0351cefe89", "committedDate": "2020-01-13T23:00:12Z", "message": "Add license"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MzA5NTM3", "url": "https://github.com/apache/pulsar/pull/6039#pullrequestreview-346309537", "createdAt": "2020-01-22T02:07:56Z", "commit": {"oid": "942a403e2692e345820f5172f03fff0351cefe89"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMjowNzo1N1rOFgOrsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMjowNzo1N1rOFgOrsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzOTMxNQ==", "bodyText": "please remove the ;", "url": "https://github.com/apache/pulsar/pull/6039#discussion_r369339315", "createdAt": "2020-01-22T02:07:57Z", "author": {"login": "rdhabalia"}, "path": "pulsar-storm/src/main/java/org/apache/pulsar/storm/PulsarSpout.java", "diffHunk": "@@ -326,7 +326,11 @@ private boolean mapToValueAndEmit(Message<byte[]> msg) {\n                 }\n                 ack(msg);\n             } else {\n-                collector.emit(values, msg);\n+                if (values instanceof PulsarTuple) {\n+                    collector.emit(((PulsarTuple) values).getOutputStream(), values, msg);\n+                } else {\n+                    collector.emit(values, msg);\n+                };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "942a403e2692e345820f5172f03fff0351cefe89"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1625982b6c73247a5b4b876ac1c327c71b5e5334", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/1625982b6c73247a5b4b876ac1c327c71b5e5334", "committedDate": "2020-01-22T15:03:18Z", "message": "[Issue 6024][pulsar_storm] review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDUwODE3", "url": "https://github.com/apache/pulsar/pull/6039#pullrequestreview-352450817", "createdAt": "2020-02-03T18:02:56Z", "commit": {"oid": "1625982b6c73247a5b4b876ac1c327c71b5e5334"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1451, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}