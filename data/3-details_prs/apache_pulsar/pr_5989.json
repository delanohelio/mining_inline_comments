{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MTQ5MjU4", "number": 5989, "title": "[docs] Improve documentation about batching", "bodyText": "I noticed the documentation around batching didn't clarify some important details about how batching works in Pulsar, and particularly how it interacts with acknowledgements and redeliveries. This is my attempt to provide some clarity.", "createdAt": "2020-01-03T23:01:00Z", "url": "https://github.com/apache/pulsar/pull/5989", "merged": true, "mergeCommit": {"oid": "f4ad1e83f91e70c11452a9719da8c46a69c0ae80"}, "closed": true, "closedAt": "2020-01-23T08:28:50Z", "author": {"login": "gmethvin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb22ihMgH2gAyMzU5MTQ5MjU4OjE1NDkyZDdhM2E4MjYyNTE2NjAxYjNkOTY1N2Q5NDZjM2ExNzU3ZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb57kcWgH2gAyMzU5MTQ5MjU4Ojg0MmE3ZTU0ZmRjYWI2NTg2OWY3MTg5NGMyZTU3YzNjNTAwYzY0NGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15492d7a3a8262516601b3d9657d946c3a1757d6", "author": {"user": {"login": "gmethvin", "name": "Greg Methvin"}}, "url": "https://github.com/apache/pulsar/commit/15492d7a3a8262516601b3d9657d946c3a1757d6", "committedDate": "2020-01-03T22:59:25Z", "message": "Improve documentation about batching"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzM4ODc4", "url": "https://github.com/apache/pulsar/pull/5989#pullrequestreview-338338878", "createdAt": "2020-01-04T05:37:50Z", "commit": {"oid": "15492d7a3a8262516601b3d9657d946c3a1757d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzUxMDk3", "url": "https://github.com/apache/pulsar/pull/5989#pullrequestreview-338351097", "createdAt": "2020-01-04T12:21:59Z", "commit": {"oid": "15492d7a3a8262516601b3d9657d946c3a1757d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxMjoyMjowMFrOFaNvug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxMjoyMjowMFrOFaNvug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzMjUwNg==", "bodyText": "I think just noting is not enough, it should be pointed out that this is a buggy behavior and should be fixed in future releases.", "url": "https://github.com/apache/pulsar/pull/5989#discussion_r363032506", "createdAt": "2020-01-04T12:22:00Z", "author": {"login": "Lanayx"}, "path": "site2/docs/concepts-messaging.md", "diffHunk": "@@ -49,7 +49,14 @@ Messages published by producers can be compressed during transportation in order\n \n ### Batching\n \n-If batching is enabled, the producer will accumulate and send a batch of messages in a single request. Batching size is defined by the maximum number of messages and maximum publish latency.\n+If batching is enabled, the producer will accumulate and send a batch of messages in a single request. Batch size is defined by the maximum number of messages and maximum publish latency.\n+\n+Batches are tracked and stored by Pulsar as batches rather than as individual messages. Under the hood the consumer unbundles these batches into individual messages. Since the messages are stored as batches, the backlog size will also represent the total number of batches rather than the total number of messages.\n+\n+Scheduled messages (using `deliverAt` or `deliverAfter`) are always sent as individual messages even when batching is enabled.\n+\n+> Note\n+> Since batches are tracked as single units, a batch will only be considered acknowledged when all its messages are acknowledged by the consumer. This means unexpected failures, negative acknowledgements, and acknowledgement timeouts can result in redelivery of all messages in the batch, even if some of the messages have already been acknowledged.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15492d7a3a8262516601b3d9657d946c3a1757d6"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzk4Njg2", "url": "https://github.com/apache/pulsar/pull/5989#pullrequestreview-338398686", "createdAt": "2020-01-05T12:51:38Z", "commit": {"oid": "15492d7a3a8262516601b3d9657d946c3a1757d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NDYzMDgw", "url": "https://github.com/apache/pulsar/pull/5989#pullrequestreview-338463080", "createdAt": "2020-01-06T04:22:49Z", "commit": {"oid": "15492d7a3a8262516601b3d9657d946c3a1757d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "842a7e54fdcab65869f71894c2e57c3c500c644a", "author": {"user": {"login": "sijie", "name": "Sijie Guo"}}, "url": "https://github.com/apache/pulsar/commit/842a7e54fdcab65869f71894c2e57c3c500c644a", "committedDate": "2020-01-13T12:32:49Z", "message": "Merge remote-tracking branch 'apache/master' into batching-docs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1409, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}