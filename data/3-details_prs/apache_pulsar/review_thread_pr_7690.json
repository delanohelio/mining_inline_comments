{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MzgwNTY1", "number": 7690, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo0MDo1NFrOETUCVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo0MDo1NFrOETUCVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4Njg2Njc2OnYy", "diffSide": "RIGHT", "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/util/ZookeeperCacheLoader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo0MDo1NFrOG4-fyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwODoxMzoxM1rOG5YsMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM5NzM4NQ==", "bodyText": "Do we need a blocking call here? Why can't we just make this method async? So we don't need to introduce another thread.", "url": "https://github.com/apache/pulsar/pull/7690#discussion_r462397385", "createdAt": "2020-07-29T15:40:54Z", "author": {"login": "sijie"}, "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/util/ZookeeperCacheLoader.java", "diffHunk": "@@ -78,11 +84,14 @@ public LoadManagerReport deserialize(String key, byte[] content) throws Exceptio\n \n         this.availableBrokersCache = new ZooKeeperChildrenCache(getLocalZkCache(), LOADBALANCE_BROKERS_ROOT);\n         this.availableBrokersCache.registerListener((path, brokerNodes, stat) -> {\n-            try {\n-                updateBrokerList(brokerNodes);\n-            } catch (Exception e) {\n-                log.warn(\"Error updating broker info after broker list changed.\", e);\n-            }\n+            // Run in a separate thread to avoid deadlocks\n+            brokerListUpdater.execute(() -> {\n+                try {\n+                    updateBrokerList(brokerNodes);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed630b9d67474990cf5575ae16edde2bee569742"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgyNjU0Nw==", "bodyText": "I don't think we need a blocking call here. Made the updateBrokerList() method asynchronous.", "url": "https://github.com/apache/pulsar/pull/7690#discussion_r462826547", "createdAt": "2020-07-30T08:13:13Z", "author": {"login": "massakam"}, "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/util/ZookeeperCacheLoader.java", "diffHunk": "@@ -78,11 +84,14 @@ public LoadManagerReport deserialize(String key, byte[] content) throws Exceptio\n \n         this.availableBrokersCache = new ZooKeeperChildrenCache(getLocalZkCache(), LOADBALANCE_BROKERS_ROOT);\n         this.availableBrokersCache.registerListener((path, brokerNodes, stat) -> {\n-            try {\n-                updateBrokerList(brokerNodes);\n-            } catch (Exception e) {\n-                log.warn(\"Error updating broker info after broker list changed.\", e);\n-            }\n+            // Run in a separate thread to avoid deadlocks\n+            brokerListUpdater.execute(() -> {\n+                try {\n+                    updateBrokerList(brokerNodes);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM5NzM4NQ=="}, "originalCommit": {"oid": "ed630b9d67474990cf5575ae16edde2bee569742"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2347, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}