{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1OTMwNzYz", "number": 8045, "title": "Add an REST endpoint to trigger backlogQuotaCheck", "bodyText": "Fixes #4980\nMotivation\nExpose an REST endpoint to trigger backlogQuotaCheck. That will make integration tests easier in future without forcing it to sleep and wait the block to kick in backlog quota check.\nModifications\nExpose an REST endpoint\nVerifying this change\nunit test\norg.apache.pulsar.broker.service.BacklogQuotaManagerTest#testTriggerBacklogQuotaWithReader", "createdAt": "2020-09-12T15:05:46Z", "url": "https://github.com/apache/pulsar/pull/8045", "merged": true, "mergeCommit": {"oid": "36d4c68f78b42759ccc4186927e6974c3cfb13a9"}, "closed": true, "closedAt": "2020-09-23T07:26:52Z", "author": {"login": "315157973"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdILVWHAH2gAyNDg1OTMwNzYzOmM3NjVkYzMxNjMyNGU5OTdiYzBhYjNkNjc1MDAyMTJjNWZkOWU3MGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLMUV-gFqTQ5MzA1NDg5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c765dc316324e997bc0ab3d67500212c5fd9e70f", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/c765dc316324e997bc0ab3d67500212c5fd9e70f", "committedDate": "2020-09-12T15:00:54Z", "message": "add an REST endpoint to trigger backlogQuotaCheck"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e85b45ceadaea6f17e557278dd8bb533f46ed45", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/9e85b45ceadaea6f17e557278dd8bb533f46ed45", "committedDate": "2020-09-12T16:02:30Z", "message": "fix testDuplication often fails"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzgzNDQz", "url": "https://github.com/apache/pulsar/pull/8045#pullrequestreview-488383443", "createdAt": "2020-09-15T07:05:52Z", "commit": {"oid": "9e85b45ceadaea6f17e557278dd8bb533f46ed45"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzowNTo1M1rOHRzprg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzowNjo0NFrOHRzrVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNDA5NA==", "bodyText": "I don't think we use CamelCase for naming the endpoint. We can rename it to /backlog-quota-check.", "url": "https://github.com/apache/pulsar/pull/8045#discussion_r488434094", "createdAt": "2020-09-15T07:05:53Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java", "diffHunk": "@@ -255,6 +256,26 @@ public InternalConfigurationData getInternalConfigurationData() {\n         return pulsar().getInternalConfigurationData();\n     }\n \n+    @GET\n+    @Path(\"/backlogQuotaCheck\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e85b45ceadaea6f17e557278dd8bb533f46ed45"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNDMyMw==", "bodyText": "why do we need to add sleep here?", "url": "https://github.com/apache/pulsar/pull/8045#discussion_r488434323", "createdAt": "2020-09-15T07:06:20Z", "author": {"login": "sijie"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/TopicDuplicationTest.java", "diffHunk": "@@ -69,6 +69,7 @@ public void testDuplicationApi() throws Exception {\n         assertNull(enabled);\n \n         admin.topics().enableDeduplication(topicName, true);\n+        Thread.sleep(1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e85b45ceadaea6f17e557278dd8bb533f46ed45"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNDUxOA==", "bodyText": "same comment as above.", "url": "https://github.com/apache/pulsar/pull/8045#discussion_r488434518", "createdAt": "2020-09-15T07:06:44Z", "author": {"login": "sijie"}, "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBrokers.java", "diffHunk": "@@ -135,5 +146,6 @@ public CmdBrokers(PulsarAdmin admin) {\n         jcommander.addCommand(\"get-internal-config\", new GetInternalConfigurationCmd());\n         jcommander.addCommand(\"get-runtime-config\", new GetRuntimeConfigCmd());\n         jcommander.addCommand(\"healthcheck\", new HealthcheckCmd());\n+        jcommander.addCommand(\"backlogQuotaCheck\", new BacklogQuotaCheckCmd());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e85b45ceadaea6f17e557278dd8bb533f46ed45"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1ccce0930eef34903c56e7d231327a7705e8059", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/e1ccce0930eef34903c56e7d231327a7705e8059", "committedDate": "2020-09-15T07:37:33Z", "message": "fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aa76cc600eb78956cd5960a7c5982487e9c71a5", "author": {"user": {"login": "315157973", "name": "feynmanlin"}}, "url": "https://github.com/apache/pulsar/commit/2aa76cc600eb78956cd5960a7c5982487e9c71a5", "committedDate": "2020-09-17T02:25:21Z", "message": "Merge branch 'master' into endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDU0ODk0", "url": "https://github.com/apache/pulsar/pull/8045#pullrequestreview-493054894", "createdAt": "2020-09-21T23:51:29Z", "commit": {"oid": "2aa76cc600eb78956cd5960a7c5982487e9c71a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 206, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}