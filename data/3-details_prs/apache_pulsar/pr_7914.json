{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0Mzg2ODY5", "number": 7914, "title": "[ISSUE 7758] Support set Max Producer on topic level.", "bodyText": "Link #7758 and master issue #2688\nMotivation\nSupport set/get/remove maxProducers on a topic level.\nVerifying this change\nnew unit test added.", "createdAt": "2020-08-27T01:17:18Z", "url": "https://github.com/apache/pulsar/pull/7914", "merged": true, "mergeCommit": {"oid": "2e88fdb9c3fb67e5e7d2f67ad075c114c6a60358"}, "closed": true, "closedAt": "2020-09-03T08:39:38Z", "author": {"login": "zhanghaou"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC17wFgH2gAyNDc0Mzg2ODY5OjQ1ZGRjNTJmNTQyOGVjODcyODU3MDM1YjQ4MjVlZWNkNWY1MTdjMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFFkAxgH2gAyNDc0Mzg2ODY5OjM3YjAzZGEyNjk2MmM5NjM5ODBjYjRlYzczMTlkZWI1NjM5ZTVjNWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "45ddc52f5428ec872857035b4825eecd5f517c32", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/45ddc52f5428ec872857035b4825eecd5f517c32", "committedDate": "2020-08-27T01:15:19Z", "message": "[ISSUE 7758] Support set Max Producer on topic level."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2522a08430dc5ec8fdd0f534038e3183aea4dc8c", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/2522a08430dc5ec8fdd0f534038e3183aea4dc8c", "committedDate": "2020-08-28T02:05:01Z", "message": "Merge pull request #1 from apache/master\n\nmerge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a9fc4564896818f476b75cac4d7f1c7a311c279", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/0a9fc4564896818f476b75cac4d7f1c7a311c279", "committedDate": "2020-08-28T02:09:27Z", "message": "Merge branch 'master' into set-max-producer\n\n# Conflicts:\n#\tpulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3880bb4ab7d82b4f58efeca351a9ebb1b601147", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/a3880bb4ab7d82b4f58efeca351a9ebb1b601147", "committedDate": "2020-08-31T01:04:34Z", "message": "Merge pull request #2 from apache/master\n\nmerge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b5f07578d1dcfe34832c2063b65226847ac25fe", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/2b5f07578d1dcfe34832c2063b65226847ac25fe", "committedDate": "2020-08-31T01:14:22Z", "message": "Merge remote-tracking branch 'origin/master' into set-max-producer\n\n# Conflicts:\n#\tpulsar-broker/src/test/java/org/apache/pulsar/broker/admin/TopicPoliciesDisableTest.java\n#\tpulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/Topics.java\n#\tpulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java\n#\tpulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4Mjc5NzUz", "url": "https://github.com/apache/pulsar/pull/7914#pullrequestreview-478279753", "createdAt": "2020-08-31T02:59:27Z", "commit": {"oid": "2b5f07578d1dcfe34832c2063b65226847ac25fe"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMjo1OToyN1rOHJokXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMzowMDoyNVrOHJolVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg2MzkwMA==", "bodyText": "Please return CompletableFuture< Integer > instead of passing in AsyncResponse.", "url": "https://github.com/apache/pulsar/pull/7914#discussion_r479863900", "createdAt": "2020-08-31T02:59:27Z", "author": {"login": "jianyun8023"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "diffHunk": "@@ -2368,6 +2371,53 @@ protected void internalGetPersistence(AsyncResponse asyncResponse){\n         return pulsar().getTopicPoliciesService().updateTopicPoliciesAsync(topicName, topicPolicies.get());\n     }\n \n+    protected void internalGetMaxProducers(AsyncResponse asyncResponse) {\n+        validateAdminAccessForTenant(namespaceName.getTenant());\n+        validatePoliciesReadOnlyAccess();\n+        if (topicName.isGlobal()) {\n+            validateGlobalNamespaceOwnership(namespaceName);\n+        }\n+        checkTopicLevelPolicyEnable();\n+        Optional<Integer> maxProducers = getTopicPolicies(topicName)\n+                .map(TopicPolicies::getMaxProducerPerTopic);\n+        if (!maxProducers.isPresent()) {\n+            asyncResponse.resume(Response.noContent().build());\n+        } else {\n+            asyncResponse.resume(maxProducers.get());\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b5f07578d1dcfe34832c2063b65226847ac25fe"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg2NDE1MA==", "bodyText": "Or directly return Integer.", "url": "https://github.com/apache/pulsar/pull/7914#discussion_r479864150", "createdAt": "2020-08-31T03:00:25Z", "author": {"login": "jianyun8023"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "diffHunk": "@@ -2368,6 +2371,53 @@ protected void internalGetPersistence(AsyncResponse asyncResponse){\n         return pulsar().getTopicPoliciesService().updateTopicPoliciesAsync(topicName, topicPolicies.get());\n     }\n \n+    protected void internalGetMaxProducers(AsyncResponse asyncResponse) {\n+        validateAdminAccessForTenant(namespaceName.getTenant());\n+        validatePoliciesReadOnlyAccess();\n+        if (topicName.isGlobal()) {\n+            validateGlobalNamespaceOwnership(namespaceName);\n+        }\n+        checkTopicLevelPolicyEnable();\n+        Optional<Integer> maxProducers = getTopicPolicies(topicName)\n+                .map(TopicPolicies::getMaxProducerPerTopic);\n+        if (!maxProducers.isPresent()) {\n+            asyncResponse.resume(Response.noContent().build());\n+        } else {\n+            asyncResponse.resume(maxProducers.get());\n+        }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg2MzkwMA=="}, "originalCommit": {"oid": "2b5f07578d1dcfe34832c2063b65226847ac25fe"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5MjI3OTEz", "url": "https://github.com/apache/pulsar/pull/7914#pullrequestreview-479227913", "createdAt": "2020-09-01T00:53:31Z", "commit": {"oid": "2b5f07578d1dcfe34832c2063b65226847ac25fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13df37f3e29e3c4f1696ed92405940c2405aab85", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/13df37f3e29e3c4f1696ed92405940c2405aab85", "committedDate": "2020-09-03T00:03:30Z", "message": "Merge pull request #3 from apache/master\n\nmerge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55e92d0020fc1e428422ff01d16127294e373492", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/55e92d0020fc1e428422ff01d16127294e373492", "committedDate": "2020-09-03T00:09:40Z", "message": "Merge remote-tracking branch 'origin/master' into set-max-producer\n\n# Conflicts:\n#\tpulsar-broker/src/test/java/org/apache/pulsar/broker/admin/TopicPoliciesDisableTest.java\n#\tpulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/Topics.java\n#\tpulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java\n#\tpulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37b03da26962c963980cb4ec7319deb5639e5c5d", "author": {"user": {"login": "zhanghaou", "name": "Hao Zhang"}}, "url": "https://github.com/apache/pulsar/commit/37b03da26962c963980cb4ec7319deb5639e5c5d", "committedDate": "2020-09-03T00:35:43Z", "message": "fix merge error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 155, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}