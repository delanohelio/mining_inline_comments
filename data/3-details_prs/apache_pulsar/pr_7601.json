{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyNzgyMjU2", "number": 7601, "title": "Add readiness api for the worker leader", "bodyText": "(If this PR fixes a github issue, please add Fixes #<xyz>.)\nFixes #\n(or if this PR is one task of a github issue, please add Master Issue: #<xyz> to link to the master issue.)\nMaster Issue: #\nMotivation\nThis mr adds an api to check if the worker is ready to serve requests.\nModifications\nDescribe the modifications you've done.\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\n(Please pick either of the following options)\nThis change is a trivial rework / code cleanup without any test coverage.\n(or)\nThis change is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end deployment with large payloads (10MB)\nExtended integration test for recovery after broker failure\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-07-19T21:21:43Z", "url": "https://github.com/apache/pulsar/pull/7601", "merged": true, "mergeCommit": {"oid": "b5aa109e0e157f7eeb462068653b5e60d0c3d33d"}, "closed": true, "closedAt": "2020-07-24T20:12:35Z", "author": {"login": "srkukarni"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyqm03gH2gAyNDUyNzgyMjU2OmNkN2NiZTVmMTJkMzU5Yzk1OGE1ZTY2MTEyNDVkMWYxM2Q3ZTA5M2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4GpnyAH2gAyNDUyNzgyMjU2OmFjMzJlOWQyMzk5ZTg0ODQwMjAxNDFmMzBlMWQxOGJmZmNmZjhlZTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd7cbe5f12d359c958a5e6611245d1f13d7e093d", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/cd7cbe5f12d359c958a5e6611245d1f13d7e093d", "committedDate": "2020-07-07T19:00:43Z", "message": "Added upgrade notes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83b4c58c8466a402229de9f1ad4fcdeb4e0b83ef", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/83b4c58c8466a402229de9f1ad4fcdeb4e0b83ef", "committedDate": "2020-07-08T20:35:54Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3ba7f344b8056adb759c040f529094f5ca9d67f", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/a3ba7f344b8056adb759c040f529094f5ca9d67f", "committedDate": "2020-07-12T16:17:19Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89c8048f57e46a0a336d6b59a73aa19fd9bcfe94", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/89c8048f57e46a0a336d6b59a73aa19fd9bcfe94", "committedDate": "2020-07-12T22:43:18Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0728460c11e7babb09d47427818bda7092846cd", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/b0728460c11e7babb09d47427818bda7092846cd", "committedDate": "2020-07-13T20:40:54Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77bb46778d1ef87c5c14694b634ba9d14e945b74", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/77bb46778d1ef87c5c14694b634ba9d14e945b74", "committedDate": "2020-07-13T23:47:34Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "000336c993a9c92871470b5ded18724d94cd41c6", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/000336c993a9c92871470b5ded18724d94cd41c6", "committedDate": "2020-07-14T18:53:11Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9231d29d8ec4dc3e4451436ec6f7eaa3aae6cb4", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/f9231d29d8ec4dc3e4451436ec6f7eaa3aae6cb4", "committedDate": "2020-07-15T15:39:38Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee44e3ba01e6793331134ac43e7ca636d49a03ab", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/ee44e3ba01e6793331134ac43e7ca636d49a03ab", "committedDate": "2020-07-16T23:33:16Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b02b546faad21540133e66b63d9e691561f4c45", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/4b02b546faad21540133e66b63d9e691561f4c45", "committedDate": "2020-07-17T05:44:01Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edb2f412a5c025c43d122cb34762402070850b1d", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/edb2f412a5c025c43d122cb34762402070850b1d", "committedDate": "2020-07-17T21:01:04Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4419645fd3675b675afa4b57824c05d9a0731431", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/4419645fd3675b675afa4b57824c05d9a0731431", "committedDate": "2020-07-19T20:33:06Z", "message": "Merge remote-tracking branch 'apache/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f84d5b1780533c74e5a42da511c03880b728980", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/8f84d5b1780533c74e5a42da511c03880b728980", "committedDate": "2020-07-19T21:20:34Z", "message": "Add new end point to verify leader readiness"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODA3Njgz", "url": "https://github.com/apache/pulsar/pull/7601#pullrequestreview-451807683", "createdAt": "2020-07-20T17:20:41Z", "commit": {"oid": "8f84d5b1780533c74e5a42da511c03880b728980"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoyMDo0MlrOG0X4GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoyMDo0MlrOG0X4GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDMyOA==", "bodyText": "I think the url path would be more clean if it is /cluster/leader/ready.  We can add more API under \"/leader\" in future", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457570328", "createdAt": "2020-07-20T17:20:42Z", "author": {"login": "jerrypeng"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leaderready\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f84d5b1780533c74e5a42da511c03880b728980"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82572742f80133cf520398f18418211664fe7cd3", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/82572742f80133cf520398f18418211664fe7cd3", "committedDate": "2020-07-20T17:53:06Z", "message": "Address feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODMyNTY5", "url": "https://github.com/apache/pulsar/pull/7601#pullrequestreview-451832569", "createdAt": "2020-07-20T17:55:12Z", "commit": {"oid": "82572742f80133cf520398f18418211664fe7cd3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzo1NToxM1rOG0ZGMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzo1NToxM1rOG0ZGMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MDMyMg==", "bodyText": "I think it is more appropriate to just return 200 for OK or 503 (service not available).  That is more idiomatic for HTTP REST calls", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457590322", "createdAt": "2020-07-20T17:55:13Z", "author": {"login": "jerrypeng"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leader/ready\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public String isLeaderReady() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82572742f80133cf520398f18418211664fe7cd3"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bab58b6a4e757736b956c7fa84043879a2663dcf", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/bab58b6a4e757736b956c7fa84043879a2663dcf", "committedDate": "2020-07-20T18:08:20Z", "message": "Address feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODc1MDI2", "url": "https://github.com/apache/pulsar/pull/7601#pullrequestreview-451875026", "createdAt": "2020-07-20T18:56:54Z", "commit": {"oid": "bab58b6a4e757736b956c7fa84043879a2663dcf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "943fe9de2f96733c729e6414b1a1b61b16d3a0f1", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/943fe9de2f96733c729e6414b1a1b61b16d3a0f1", "committedDate": "2020-07-21T06:28:21Z", "message": "Add new end point to verify leader readiness"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf78f70856e84227cbc8384cf62cd1744ff9c40d", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/cf78f70856e84227cbc8384cf62cd1744ff9c40d", "committedDate": "2020-07-21T06:28:21Z", "message": "Address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8207aa908a1a32b42d602c9065b858a4d5f6082b", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/8207aa908a1a32b42d602c9065b858a4d5f6082b", "committedDate": "2020-07-21T06:28:21Z", "message": "Address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f751a34649e52ee6c46dcfedca2155642ef36fd", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/3f751a34649e52ee6c46dcfedca2155642ef36fd", "committedDate": "2020-07-21T06:28:31Z", "message": "Merge branch 'worker_healthcheck' of github.com:srkukarni/incubator-pulsar into worker_healthcheck"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f910e2ee6636554cb1c84b32c5cc2a3f9d86d878", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/f910e2ee6636554cb1c84b32c5cc2a3f9d86d878", "committedDate": "2020-07-23T08:52:08Z", "message": "Merge branch 'master' into worker_healthcheck"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac32e9d2399e8484020141f30e1d18bffcff8ee5", "author": {"user": null}, "url": "https://github.com/apache/pulsar/commit/ac32e9d2399e8484020141f30e1d18bffcff8ee5", "committedDate": "2020-07-24T16:30:44Z", "message": "Merge branch 'master' into worker_healthcheck"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 377, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}