{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4OTM4MjM4", "number": 8518, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNjoxMTowMlrOE3kTvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNjoxMTowMlrOE3kTvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NzAyMDE0OnYy", "diffSide": "RIGHT", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNjoxMTowMlrOHw_d9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNjozMTo0MlrOHw_3Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzMzU1Ng==", "bodyText": "if there is a cast exception, shouldn't we handle it?  If the client somehow is returned a wrong request id that is for a different request type, a cast exception may happen here. If it does, the requestFuture will never get completed and may cause the client api call to block forever.", "url": "https://github.com/apache/pulsar/pull/8518#discussion_r521133556", "createdAt": "2020-11-11T06:11:02Z", "author": {"login": "jerrypeng"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java", "diffHunk": "@@ -465,7 +443,7 @@ protected void handleGetLastMessageIdSuccess(CommandGetLastMessageIdResponse suc\n             log.debug(\"{} Received success GetLastMessageId response from server: {}\", ctx.channel(), success.getRequestId());\n         }\n         long requestId = success.getRequestId();\n-        CompletableFuture<MessageIdData> requestFuture = pendingGetLastMessageIdRequests.remove(requestId);\n+        CompletableFuture<MessageIdData> requestFuture = (CompletableFuture<MessageIdData>) pendingRequests.remove(requestId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecc5bdca0c2ab7fd40a0feb513c293615407114a"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzODQ1OQ==", "bodyText": "The connection will get automatically closed and therefore the future will be completed there.", "url": "https://github.com/apache/pulsar/pull/8518#discussion_r521138459", "createdAt": "2020-11-11T06:26:52Z", "author": {"login": "merlimat"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java", "diffHunk": "@@ -465,7 +443,7 @@ protected void handleGetLastMessageIdSuccess(CommandGetLastMessageIdResponse suc\n             log.debug(\"{} Received success GetLastMessageId response from server: {}\", ctx.channel(), success.getRequestId());\n         }\n         long requestId = success.getRequestId();\n-        CompletableFuture<MessageIdData> requestFuture = pendingGetLastMessageIdRequests.remove(requestId);\n+        CompletableFuture<MessageIdData> requestFuture = (CompletableFuture<MessageIdData>) pendingRequests.remove(requestId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzMzU1Ng=="}, "originalCommit": {"oid": "ecc5bdca0c2ab7fd40a0feb513c293615407114a"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE0MDA1NQ==", "bodyText": "i see", "url": "https://github.com/apache/pulsar/pull/8518#discussion_r521140055", "createdAt": "2020-11-11T06:31:42Z", "author": {"login": "jerrypeng"}, "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java", "diffHunk": "@@ -465,7 +443,7 @@ protected void handleGetLastMessageIdSuccess(CommandGetLastMessageIdResponse suc\n             log.debug(\"{} Received success GetLastMessageId response from server: {}\", ctx.channel(), success.getRequestId());\n         }\n         long requestId = success.getRequestId();\n-        CompletableFuture<MessageIdData> requestFuture = pendingGetLastMessageIdRequests.remove(requestId);\n+        CompletableFuture<MessageIdData> requestFuture = (CompletableFuture<MessageIdData>) pendingRequests.remove(requestId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzMzU1Ng=="}, "originalCommit": {"oid": "ecc5bdca0c2ab7fd40a0feb513c293615407114a"}, "originalPosition": 97}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2900, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}