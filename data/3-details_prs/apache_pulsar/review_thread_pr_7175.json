{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MTg4NjAx", "number": 7175, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyODo0MFrOEC1RtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyOTozNVrOEC1SYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNDA1NDkyOnYy", "diffSide": "RIGHT", "path": "site2/docs/client-libraries-java.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyODo0MFrOGfh54A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyODo0MFrOGfh54A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxNDUyOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.\n          \n          \n            \n            If batching is enabled at the producer side, messages with different keys are added to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer needs to use the `KeyBasedBatcher`.", "url": "https://github.com/apache/pulsar/pull/7175#discussion_r435714528", "createdAt": "2020-06-05T06:28:40Z", "author": {"login": "Huanli-Meng"}, "path": "site2/docs/client-libraries-java.md", "diffHunk": "@@ -608,6 +608,22 @@ consumer2 receives the follwoing information.\n (\"key-4\", \"message-4-2\")\n ```\n \n+If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNDA1NjY2OnYy", "diffSide": "RIGHT", "path": "site2/docs/client-libraries-java.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyOTozNVrOGfh7EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNjoyOTozNVrOGfh7EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxNDgzMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Or the producer can disable the message batch mechanism.\n          \n          \n            \n            Or the producer can disable batching.", "url": "https://github.com/apache/pulsar/pull/7175#discussion_r435714832", "createdAt": "2020-06-05T06:29:35Z", "author": {"login": "Huanli-Meng"}, "path": "site2/docs/client-libraries-java.md", "diffHunk": "@@ -608,6 +608,22 @@ consumer2 receives the follwoing information.\n (\"key-4\", \"message-4-2\")\n ```\n \n+If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.\n+\n+```java\n+Producer producer = client.newProducer()\n+        .topic(\"my-topic\")\n+        .batcherBuilder(BatcherBuilder.KEY_BASED)\n+        .create();\n+```\n+Or the producer can disable the message batch mechanism.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1719, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}