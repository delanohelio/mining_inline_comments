{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMjU4OTI3", "number": 7712, "title": "[Issue 7711][pulsar-broker] Use original role instead of proxy role to check permissions", "bodyText": "Fixes #7711\nMotivation\nA client can have more permissions than its original role allows and it is a security violation.\nModifications\nUse the original role (if available) instead of the proxy role to check if a client is allowed to consume or produce messages.\nVerifying this change\n\n Make sure that the change passes the CI checks.\n\n(Please pick either of the following options)\nThis change is a trivial rework / code cleanup without any test coverage.\n(or)\nThis change is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end deployment with large payloads (10MB)\nExtended integration test for recovery after broker failure\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (yes / no)\nThe public API: (yes / no)\nThe schema: (yes / no / don't know)\nThe default values of configurations: (yes / no)\nThe wire protocol: (yes / no)\nThe rest endpoints: (yes / no)\nThe admin cli options: (yes / no)\nAnything that affects deployment: (yes / no / don't know)\n\nDocumentation\n\nDoes this pull request introduce a new feature? (yes / no)\nIf yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)\nIf a feature is not applicable for documentation, explain why?\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "createdAt": "2020-07-31T15:40:31Z", "url": "https://github.com/apache/pulsar/pull/7712", "merged": true, "mergeCommit": {"oid": "5546c5fed6487faf7e7bb5023eb936573aa929bf"}, "closed": true, "closedAt": "2020-08-05T08:50:12Z", "author": {"login": "vzhikserg"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6WDpVgH2gAyNDYwMjU4OTI3OjYyOWYyZWQ4ZDc2ZTFhODJjMDBhMmEwMmE4NzE3NDA1ODc3ZWI1OGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc73P_4AFqTQ2MTQ2NTU1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "629f2ed8d76e1a82c00a2a02a8717405877eb58c", "author": {"user": {"login": "vzhikserg", "name": "Sergii Zhevzhyk"}}, "url": "https://github.com/apache/pulsar/commit/629f2ed8d76e1a82c00a2a02a8717405877eb58c", "committedDate": "2020-07-31T15:35:35Z", "message": "[Issue 7711][pulsar-broker] Use the original role (if available) instead of the proxy role to check if a client is allowed to consume or produce"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8de141d02f3b6a603d11e9e6ccb6d1afe4638b90", "author": {"user": {"login": "vzhikserg", "name": "Sergii Zhevzhyk"}}, "url": "https://github.com/apache/pulsar/commit/8de141d02f3b6a603d11e9e6ccb6d1afe4638b90", "committedDate": "2020-07-31T15:55:49Z", "message": "[Issue 7313] Add the class name for the isBlank method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTM3MDE4", "url": "https://github.com/apache/pulsar/pull/7712#pullrequestreview-459537018", "createdAt": "2020-08-01T01:04:47Z", "commit": {"oid": "8de141d02f3b6a603d11e9e6ccb6d1afe4638b90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMTowNDo0N1rOG6aRAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMTowNDo0N1rOG6aRAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkwMDkzMA==", "bodyText": "does lookup also need a change?", "url": "https://github.com/apache/pulsar/pull/7712#discussion_r463900930", "createdAt": "2020-08-01T01:04:47Z", "author": {"login": "jiazhai"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -557,9 +557,9 @@ private void validatePoliciesReadOnlyAccess() {\n         switch (operation) {\n             case LOOKUP: isAuthorizedFuture = canLookupAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8de141d02f3b6a603d11e9e6ccb6d1afe4638b90"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e653b7021c56fd4ffda42a7b6f2dbc86363996cf", "author": {"user": {"login": "vzhikserg", "name": "Sergii Zhevzhyk"}}, "url": "https://github.com/apache/pulsar/commit/e653b7021c56fd4ffda42a7b6f2dbc86363996cf", "committedDate": "2020-08-01T05:37:25Z", "message": "[Issue 7711] Use original role for the lookup action"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NzA1MjI1", "url": "https://github.com/apache/pulsar/pull/7712#pullrequestreview-459705225", "createdAt": "2020-08-03T01:41:51Z", "commit": {"oid": "e653b7021c56fd4ffda42a7b6f2dbc86363996cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e2935cb9259d71bd0bac0bf013f51a8fd9dcacf", "author": {"user": {"login": "vzhikserg", "name": "Sergii Zhevzhyk"}}, "url": "https://github.com/apache/pulsar/commit/9e2935cb9259d71bd0bac0bf013f51a8fd9dcacf", "committedDate": "2020-08-04T20:51:45Z", "message": "Merge branch 'master' into use-original-role-instead-of-proxy-role-where-possible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNDY1NTUw", "url": "https://github.com/apache/pulsar/pull/7712#pullrequestreview-461465550", "createdAt": "2020-08-05T08:49:52Z", "commit": {"oid": "9e2935cb9259d71bd0bac0bf013f51a8fd9dcacf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 452, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}