{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MjczNTU5", "number": 7523, "title": "[Issue 5720][authz] - add topics authz granularity", "bodyText": "Fixes a part of #5720\nMotivation\nadd granularity in topics api authz", "createdAt": "2020-07-13T13:56:22Z", "url": "https://github.com/apache/pulsar/pull/7523", "merged": true, "mergeCommit": {"oid": "5dc5de849b582c7f312764db043da9483c17146a"}, "closed": true, "closedAt": "2021-05-08T08:23:32Z", "author": {"login": "KannarFr"}, "timelineItems": {"totalCount": 55, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1LTNEABqjM1NDg3Nzg0NjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeUsSPMgFqTYxMzc1NzkxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ad16ca3a73909ae61d8d9dd8edb49ffbacb52db", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/6ad16ca3a73909ae61d8d9dd8edb49ffbacb52db", "committedDate": "2020-07-13T13:53:01Z", "message": "topics authz granularity"}, "afterCommit": {"oid": "9c4d9090b0fb1218f82b70386a3d383462561c7b", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/9c4d9090b0fb1218f82b70386a3d383462561c7b", "committedDate": "2020-07-15T14:13:50Z", "message": "topics authz granularity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c4d9090b0fb1218f82b70386a3d383462561c7b", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/9c4d9090b0fb1218f82b70386a3d383462561c7b", "committedDate": "2020-07-15T14:13:50Z", "message": "topics authz granularity"}, "afterCommit": {"oid": "b1c7751c656abb15caff450204ded508d3c4d4a8", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/b1c7751c656abb15caff450204ded508d3c4d4a8", "committedDate": "2020-07-15T14:53:50Z", "message": "topics authz granularity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1c7751c656abb15caff450204ded508d3c4d4a8", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/b1c7751c656abb15caff450204ded508d3c4d4a8", "committedDate": "2020-07-15T14:53:50Z", "message": "topics authz granularity"}, "afterCommit": {"oid": "ed4a34f246b00df43774d2fedc89aa35140cf362", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/ed4a34f246b00df43774d2fedc89aa35140cf362", "committedDate": "2020-07-15T15:22:20Z", "message": "topics authz granularity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac94b055812b5dac59d99a211f96b24accf96cf0", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/ac94b055812b5dac59d99a211f96b24accf96cf0", "committedDate": "2020-07-30T15:49:50Z", "message": "add full topicoperations management and clean skip_message to skip"}, "afterCommit": {"oid": "477865ecf9590320b0b23c34ed302525db96d5cb", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/477865ecf9590320b0b23c34ed302525db96d5cb", "committedDate": "2020-08-12T13:47:47Z", "message": "add full topicoperations management and clean skip_message to skip"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb749d4eff688c48a0ee62e5c64241b034ecedae", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/fb749d4eff688c48a0ee62e5c64241b034ecedae", "committedDate": "2020-08-12T14:12:50Z", "message": "bump"}, "afterCommit": {"oid": "e619c2e5fd9e1973f69805ed115ee20d4b4b212f", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/e619c2e5fd9e1973f69805ed115ee20d4b4b212f", "committedDate": "2020-08-12T14:18:35Z", "message": "bump"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1980e50865f8a95736969a5aa2cc33ab07418566", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/1980e50865f8a95736969a5aa2cc33ab07418566", "committedDate": "2020-08-12T14:31:34Z", "message": "check is super user"}, "afterCommit": {"oid": "e321f31d0b9e806dcc074a48275b5aea58e89aab", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/e321f31d0b9e806dcc074a48275b5aea58e89aab", "committedDate": "2020-08-12T18:08:12Z", "message": "check is super user"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cea7617c03435b4e272c1e4e3f8d60b1a5b080c6", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/cea7617c03435b4e272c1e4e3f8d60b1a5b080c6", "committedDate": "2020-08-13T00:31:16Z", "message": "match recent updates"}, "afterCommit": {"oid": "7c54688434fba2339c23af52b03204b33d69e4ef", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/7c54688434fba2339c23af52b03204b33d69e4ef", "committedDate": "2020-08-13T00:34:51Z", "message": "match recent updates"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c54688434fba2339c23af52b03204b33d69e4ef", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/7c54688434fba2339c23af52b03204b33d69e4ef", "committedDate": "2020-08-13T00:34:51Z", "message": "match recent updates"}, "afterCommit": {"oid": "44d334eb0c0d818a1cfb1da8def5a01c11f10a35", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/44d334eb0c0d818a1cfb1da8def5a01c11f10a35", "committedDate": "2020-08-13T14:12:48Z", "message": "format doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44d334eb0c0d818a1cfb1da8def5a01c11f10a35", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/44d334eb0c0d818a1cfb1da8def5a01c11f10a35", "committedDate": "2020-08-13T14:12:48Z", "message": "format doc"}, "afterCommit": {"oid": "b3597bb14ff8753eaac1f85e07f891abd3befbdc", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/b3597bb14ff8753eaac1f85e07f891abd3befbdc", "committedDate": "2020-08-13T14:13:26Z", "message": "format doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3597bb14ff8753eaac1f85e07f891abd3befbdc", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/b3597bb14ff8753eaac1f85e07f891abd3befbdc", "committedDate": "2020-08-13T14:13:26Z", "message": "format doc"}, "afterCommit": {"oid": "0472a1ce24d1c113f83aaeb2d94318003aca5e0b", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/0472a1ce24d1c113f83aaeb2d94318003aca5e0b", "committedDate": "2020-08-13T23:38:22Z", "message": "format doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0472a1ce24d1c113f83aaeb2d94318003aca5e0b", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/0472a1ce24d1c113f83aaeb2d94318003aca5e0b", "committedDate": "2020-08-13T23:38:22Z", "message": "format doc"}, "afterCommit": {"oid": "089b5299b3fad03ed562cbf1e27e489235746cc5", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/089b5299b3fad03ed562cbf1e27e489235746cc5", "committedDate": "2020-08-13T23:44:41Z", "message": "format doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "089b5299b3fad03ed562cbf1e27e489235746cc5", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/089b5299b3fad03ed562cbf1e27e489235746cc5", "committedDate": "2020-08-13T23:44:41Z", "message": "format doc"}, "afterCommit": {"oid": "359a44a264b059133ebec1032ba6f585a633cc77", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/359a44a264b059133ebec1032ba6f585a633cc77", "committedDate": "2020-08-14T00:03:14Z", "message": "format doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e719855d8a61ced2f500cd591ab39e52014b008", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/5e719855d8a61ced2f500cd591ab39e52014b008", "committedDate": "2020-08-18T01:48:45Z", "message": "typo"}, "afterCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/f39303fe260bf8458188706fc109aa8e6c150a81", "committedDate": "2020-08-25T04:44:10Z", "message": "typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTM4ODYx", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-478138861", "createdAt": "2020-08-29T16:21:53Z", "commit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxNjoyMTo1M1rOHJcc0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxNjoyMjowNFrOHJcc3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY2NTM2MQ==", "bodyText": "Probably should return Status.UNAUTHORIZED rather than Status.FORBIDDEN to avoid confusion?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r479665361", "createdAt": "2020-08-29T16:21:53Z", "author": {"login": "frankjkelly"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java", "diffHunk": "@@ -846,4 +847,36 @@ public void validateNamespacePolicyOperation(NamespaceName namespaceName,\n             }\n         }\n     }\n+\n+    public void validateTopicPolicyOperation(TopicName topicName, PolicyName policy, PolicyOperation operation) {\n+        if (pulsar().getConfiguration().isAuthenticationEnabled() && pulsar().getBrokerService().isAuthorizationEnabled()) {\n+            if (!isClientAuthenticated(clientAppId())) {\n+                throw new RestException(Status.FORBIDDEN, \"Need to authenticate to perform the request\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY2NTM3Mw==", "bodyText": "Same as above?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r479665373", "createdAt": "2020-08-29T16:22:04Z", "author": {"login": "frankjkelly"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java", "diffHunk": "@@ -846,4 +847,36 @@ public void validateNamespacePolicyOperation(NamespaceName namespaceName,\n             }\n         }\n     }\n+\n+    public void validateTopicPolicyOperation(TopicName topicName, PolicyName policy, PolicyOperation operation) {\n+        if (pulsar().getConfiguration().isAuthenticationEnabled() && pulsar().getBrokerService().isAuthorizationEnabled()) {\n+            if (!isClientAuthenticated(clientAppId())) {\n+                throw new RestException(Status.FORBIDDEN, \"Need to authenticate to perform the request\");\n+            }\n+\n+            Boolean isAuthorized = pulsar().getBrokerService().getAuthorizationService()\n+                    .allowTopicPolicyOperation(topicName, policy, operation, originalPrincipal(), clientAppId(), clientAuthData());\n+\n+            if (!isAuthorized) {\n+                throw new RestException(Status.FORBIDDEN, String.format(\"Unauthorized to validateTopicPolicyOperation for\" +\n+                        \" operation [%s] on topic [%s] on policy [%s]\", operation.toString(), topicName, policy.toString()));\n+            }\n+        }\n+    }\n+\n+    public void validateTopicOperation(TopicName topicName, TopicOperation operation) {\n+        if (pulsar().getConfiguration().isAuthenticationEnabled() && pulsar().getBrokerService().isAuthorizationEnabled()) {\n+            if (!isClientAuthenticated(clientAppId())) {\n+                throw new RestException(Status.UNAUTHORIZED, \"Need to authenticate to perform the request\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzQ2NjA0", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-482346604", "createdAt": "2020-09-04T04:20:46Z", "commit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNDoyMDo0NlrOHM-_uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNDoyNTowOVrOHM_DmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzA4MQ==", "bodyText": "Can you make the default implementation to use the existing method? If people wrote its own plugin, it will fail all the topic policy operations when it upgrades to a newer version of Pulsar.", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377081", "createdAt": "2020-09-04T04:20:46Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/AuthorizationProvider.java", "diffHunk": "@@ -489,4 +490,36 @@ default Boolean allowTopicOperation(TopicName topicName,\n             throw new RestException(e.getCause());\n         }\n     }\n+\n+    /**\n+     * Check if a given <tt>role</tt> is allowed to execute a given topic <tt>operation</tt> on topic's <tt>policy</tt>.\n+     *\n+     * @param topic topic name\n+     * @param role role name\n+     * @param operation topic operation\n+     * @param authData authenticated data\n+     * @return CompletableFuture<Boolean>\n+     */\n+    default CompletableFuture<Boolean> allowTopicPolicyOperationAsync(TopicName topic,\n+                                                                      String role,\n+                                                                      PolicyName policy,\n+                                                                      PolicyOperation operation,\n+                                                                      AuthenticationDataSource authData) {\n+        return FutureUtil.failedFuture(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzMwMQ==", "bodyText": "Can you avoid formatting the file with other changes?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377301", "createdAt": "2020-09-04T04:21:46Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/AuthorizationService.java", "diffHunk": "@@ -364,13 +353,11 @@ private boolean isProxyRole(String role) {\n      * Grant authorization-action permission on a tenant to the given client\n      *\n      * @param tenantName tenant name\n-     * @param operation tenant operation\n-     * @param role role name\n-     * @param authData\n-     *            additional authdata in json for targeted authorization provider\n+     * @param operation  tenant operation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 176}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzU2MQ==", "bodyText": "expire messages is a consume operation, correct?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377561", "createdAt": "2020-09-04T04:22:58Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case EXPIRE_MESSAGES: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzY1OA==", "bodyText": "compact should be an admin operation, correct?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377658", "createdAt": "2020-09-04T04:23:25Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzY4NQ==", "bodyText": "admin?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377685", "createdAt": "2020-09-04T04:23:33Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case EXPIRE_MESSAGES: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case OFFLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3Nzg4NQ==", "bodyText": "consume?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377885", "createdAt": "2020-09-04T04:24:34Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case EXPIRE_MESSAGES: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case OFFLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case PEEK_MESSAGES: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case RESET_CURSOR: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzkxNA==", "bodyText": "admin?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377914", "createdAt": "2020-09-04T04:24:42Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case EXPIRE_MESSAGES: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case OFFLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case PEEK_MESSAGES: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case RESET_CURSOR: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case SKIP: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case TERMINATE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case UNLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3Nzk0NQ==", "bodyText": "admin?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377945", "createdAt": "2020-09-04T04:24:48Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case EXPIRE_MESSAGES: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case OFFLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case PEEK_MESSAGES: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case RESET_CURSOR: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case SKIP: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case TERMINATE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case UNLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case ADD_BUNDLE_RANGE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3Nzk5Ng==", "bodyText": "admin?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483377996", "createdAt": "2020-09-04T04:24:55Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case EXPIRE_MESSAGES: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case OFFLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case PEEK_MESSAGES: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case RESET_CURSOR: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case SKIP: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case TERMINATE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case UNLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case ADD_BUNDLE_RANGE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case GET_BUNDLE_RANGE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3ODA3Mw==", "bodyText": "admin?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r483378073", "createdAt": "2020-09-04T04:25:09Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -564,6 +564,36 @@ private void validatePoliciesReadOnlyAccess() {\n                 break;\n             case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n                 break;\n+            case COMPACT: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case EXPIRE_MESSAGES: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case OFFLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case PEEK_MESSAGES: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case RESET_CURSOR: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case SKIP: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n+                break;\n+            case TERMINATE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case UNLOAD: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case ADD_BUNDLE_RANGE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case GET_BUNDLE_RANGE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case DELETE_BUNDLE_RANGE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/f39303fe260bf8458188706fc109aa8e6c150a81", "committedDate": "2020-08-25T04:44:10Z", "message": "typo"}, "afterCommit": {"oid": "f7a79fb3d2f6bbf47237c7689604779f33646527", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/f7a79fb3d2f6bbf47237c7689604779f33646527", "committedDate": "2020-09-04T10:03:17Z", "message": "fix rights checks"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30dacfeb8872c3fae56aab918138fb4ddffa29be", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/30dacfeb8872c3fae56aab918138fb4ddffa29be", "committedDate": "2020-09-11T13:00:49Z", "message": "validate ownership"}, "afterCommit": {"oid": "0f0ec4076a6c501bf2fb0ec54404b4131fb61c19", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/0f0ec4076a6c501bf2fb0ec54404b4131fb61c19", "committedDate": "2020-09-11T13:18:51Z", "message": "validate ownership"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f0ec4076a6c501bf2fb0ec54404b4131fb61c19", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/0f0ec4076a6c501bf2fb0ec54404b4131fb61c19", "committedDate": "2020-09-11T13:18:51Z", "message": "validate ownership"}, "afterCommit": {"oid": "aa43845b8fb8f1454ab2f5fcae0cebac5893ad0c", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/aa43845b8fb8f1454ab2f5fcae0cebac5893ad0c", "committedDate": "2020-09-14T14:12:20Z", "message": "validate ownership"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a73014833ffd276a97b03ff4f6497dbf07bbdf5", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/3a73014833ffd276a97b03ff4f6497dbf07bbdf5", "committedDate": "2020-09-14T14:25:59Z", "message": "add granularity to non persistenttopics"}, "afterCommit": {"oid": "5ff9d179264ebd1d1d32daa642b77caf3dbf7942", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/5ff9d179264ebd1d1d32daa642b77caf3dbf7942", "committedDate": "2020-10-26T11:14:29Z", "message": "add granularity to non persistenttopics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ff9d179264ebd1d1d32daa642b77caf3dbf7942", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/5ff9d179264ebd1d1d32daa642b77caf3dbf7942", "committedDate": "2020-10-26T11:14:29Z", "message": "add granularity to non persistenttopics"}, "afterCommit": {"oid": "6cc8f6db7bdf95e273262000e79947319213b44f", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/6cc8f6db7bdf95e273262000e79947319213b44f", "committedDate": "2020-10-26T11:34:57Z", "message": "add granularity to non persistenttopics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ca3d5c99b721267fa45c50936593e369f20b634", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/5ca3d5c99b721267fa45c50936593e369f20b634", "committedDate": "2020-10-26T12:02:29Z", "message": "use isAdmin for related actions"}, "afterCommit": {"oid": "9bd64f388b9fbe64b7947280dddfaac31b7ccb88", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/9bd64f388b9fbe64b7947280dddfaac31b7ccb88", "committedDate": "2020-12-10T16:13:46Z", "message": "use isAdmin for related actions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9bd64f388b9fbe64b7947280dddfaac31b7ccb88", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/9bd64f388b9fbe64b7947280dddfaac31b7ccb88", "committedDate": "2020-12-10T16:13:46Z", "message": "use isAdmin for related actions"}, "afterCommit": {"oid": "84d131fca996e179ad69a590f89530c31daf0f33", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/84d131fca996e179ad69a590f89530c31daf0f33", "committedDate": "2021-01-13T16:37:30Z", "message": "use isAdmin for related actions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a223b0f19856cbd5b52aeb292268d42acd31e20c", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/a223b0f19856cbd5b52aeb292268d42acd31e20c", "committedDate": "2021-01-13T22:43:36Z", "message": "fix"}, "afterCommit": {"oid": "d17dab993bdd8100982a84679934e28d4ce04dc2", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/d17dab993bdd8100982a84679934e28d4ce04dc2", "committedDate": "2021-01-13T22:44:08Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMTQ1NTUz", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-570145553", "createdAt": "2021-01-18T03:10:10Z", "commit": {"oid": "d17dab993bdd8100982a84679934e28d4ce04dc2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwMzoxMDoxMFrOIVYopw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwMzoxMDozOFrOIVYo6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI5NDYzMQ==", "bodyText": "Can we merge some operations like this? For example:\ncase CONSUME:\ncase EXPIRE_MESAGES:\n...\ncase SKIP:\n    isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n    break;", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r559294631", "createdAt": "2021-01-18T03:10:10Z", "author": {"login": "zymap"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -557,28 +557,65 @@ private void validatePoliciesReadOnlyAccess() {\n                                                                AuthenticationDataSource authData) {\n         CompletableFuture<Boolean> isAuthorizedFuture;\n \n-        switch (operation) {\n-            case LOOKUP: isAuthorizedFuture = canLookupAsync(topicName, role, authData);\n-                break;\n-            case PRODUCE: isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n-                break;\n-            case CONSUME: isAuthorizedFuture = canConsumeAsync(topicName, role, authData, authData.getSubscription());\n-                break;\n-            default: isAuthorizedFuture = FutureUtil.failedFuture(\n-                    new IllegalStateException(\"TopicOperation is not supported.\"));\n-        }\n+        try {\n+            TenantInfo tenantInfo = configCache.propertiesCache().get(path(POLICIES, topicName.getTenant())).get();\n+\n+            switch (operation) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d17dab993bdd8100982a84679934e28d4ce04dc2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI5NDY5OA==", "bodyText": "Overall looks good. This PR looks like only add the validation for the topic level authorization.", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r559294698", "createdAt": "2021-01-18T03:10:38Z", "author": {"login": "zymap"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/AuthorizationProvider.java", "diffHunk": "@@ -489,4 +490,36 @@ default Boolean allowTopicOperation(TopicName topicName,\n             throw new RestException(e.getCause());\n         }\n     }\n+\n+    /**\n+     * Check if a given <tt>role</tt> is allowed to execute a given topic <tt>operation</tt> on topic's <tt>policy</tt>.\n+     *\n+     * @param topic topic name\n+     * @param role role name\n+     * @param operation topic operation\n+     * @param authData authenticated data\n+     * @return CompletableFuture<Boolean>\n+     */\n+    default CompletableFuture<Boolean> allowTopicPolicyOperationAsync(TopicName topic,\n+                                                                      String role,\n+                                                                      PolicyName policy,\n+                                                                      PolicyOperation operation,\n+                                                                      AuthenticationDataSource authData) {\n+        return FutureUtil.failedFuture(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzA4MQ=="}, "originalCommit": {"oid": "f39303fe260bf8458188706fc109aa8e6c150a81"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d17dab993bdd8100982a84679934e28d4ce04dc2", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/d17dab993bdd8100982a84679934e28d4ce04dc2", "committedDate": "2021-01-13T22:44:08Z", "message": "fix"}, "afterCommit": {"oid": "fcfee520416b0b726774ca2fbc70ee25187265e5", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/fcfee520416b0b726774ca2fbc70ee25187265e5", "committedDate": "2021-02-02T14:38:12Z", "message": "fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8008c60397ab88dd9abc0d0834cdc1aa6fa28bd", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/c8008c60397ab88dd9abc0d0834cdc1aa6fa28bd", "committedDate": "2021-02-02T14:42:32Z", "message": "merge rights check switch"}, "afterCommit": {"oid": "6ea53cdbf45d77f9c6ba4ef6d68a578b4c157943", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/6ea53cdbf45d77f9c6ba4ef6d68a578b4c157943", "committedDate": "2021-02-09T13:31:47Z", "message": "merge rights check switch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bae419b41a20a98177cfa66dac582a2498565c93", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/bae419b41a20a98177cfa66dac582a2498565c93", "committedDate": "2021-02-09T15:24:58Z", "message": "dedup"}, "afterCommit": {"oid": "c30c4374dc858a15d6ce3ebe7877e913c949204d", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/c30c4374dc858a15d6ce3ebe7877e913c949204d", "committedDate": "2021-02-09T23:59:29Z", "message": "fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99f95106f6cc7293671814c5eca5c825cc51395c", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/99f95106f6cc7293671814c5eca5c825cc51395c", "committedDate": "2021-02-10T02:19:03Z", "message": "simplify code"}, "afterCommit": {"oid": "db618d6c09817af5c3ea43361eafe8bce02a8375", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/db618d6c09817af5c3ea43361eafe8bce02a8375", "committedDate": "2021-02-10T02:33:47Z", "message": "simplify code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81026a1cdb310d83d30e9fb57b6c2c45ef573b02", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/81026a1cdb310d83d30e9fb57b6c2c45ef573b02", "committedDate": "2021-02-10T12:17:13Z", "message": "ensure operations"}, "afterCommit": {"oid": "be6848c541e80854ea77b49714259e998d991328", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/be6848c541e80854ea77b49714259e998d991328", "committedDate": "2021-02-10T12:28:28Z", "message": "ensure operations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dde8c2a5a32a8a1cf00e38b6b3d9199201f349f", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/7dde8c2a5a32a8a1cf00e38b6b3d9199201f349f", "committedDate": "2021-02-10T22:59:35Z", "message": "fix"}, "afterCommit": {"oid": "73ce0365c6258ff6754140299e36a168d4f13581", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/73ce0365c6258ff6754140299e36a168d4f13581", "committedDate": "2021-02-23T12:48:49Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk4MTcxNDU5", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-598171459", "createdAt": "2021-02-25T03:40:35Z", "commit": {"oid": "bbbf3c9afac83f94d0a9863b9c7665efade38560"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bbbf3c9afac83f94d0a9863b9c7665efade38560", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/bbbf3c9afac83f94d0a9863b9c7665efade38560", "committedDate": "2021-02-23T19:52:22Z", "message": "fix rebase"}, "afterCommit": {"oid": "cace4c1b8066ec3aa29dd4a55b271e009379f97c", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/cace4c1b8066ec3aa29dd4a55b271e009379f97c", "committedDate": "2021-03-03T16:47:16Z", "message": "fix rebase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cace4c1b8066ec3aa29dd4a55b271e009379f97c", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/cace4c1b8066ec3aa29dd4a55b271e009379f97c", "committedDate": "2021-03-03T16:47:16Z", "message": "fix rebase"}, "afterCommit": {"oid": "538ce78b25aeb97ebca547a5680c006dbf898f9e", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/538ce78b25aeb97ebca547a5680c006dbf898f9e", "committedDate": "2021-03-09T09:57:18Z", "message": "fix rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjA4OTQzMTcy", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-608943172", "createdAt": "2021-03-10T16:54:13Z", "commit": {"oid": "538ce78b25aeb97ebca547a5680c006dbf898f9e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xMFQxNjo1NDoxM1rOI0SRYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xMFQxNjo1NDo1MlrOI0STbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTY5NjIyNg==", "bodyText": "for LOOKUP, the original behavior is checking canLookupAsync. Why do we need to check validateTenantAdminAccess?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r591696226", "createdAt": "2021-03-10T16:54:13Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -545,29 +546,88 @@ private void validatePoliciesReadOnlyAccess() {\n         CompletableFuture<Boolean> isAuthorizedFuture;\n \n         switch (operation) {\n-            case LOOKUP: isAuthorizedFuture = canLookupAsync(topicName, role, authData);\n+            case LOOKUP:\n+            case GET_STATS:\n+            case GET_SUBSCRIPTIONS:\n+                isAuthorizedFuture = canLookupAsync(topicName, role, authData)\n+                        .thenCombine(validateTenantAdminAccess(topicName.getTenant(), role, authData),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "538ce78b25aeb97ebca547a5680c006dbf898f9e"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTY5Njc0OA==", "bodyText": "why do we need to check canProduceAsync for TERMINATE?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r591696748", "createdAt": "2021-03-10T16:54:52Z", "author": {"login": "sijie"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -545,29 +546,88 @@ private void validatePoliciesReadOnlyAccess() {\n         CompletableFuture<Boolean> isAuthorizedFuture;\n \n         switch (operation) {\n-            case LOOKUP: isAuthorizedFuture = canLookupAsync(topicName, role, authData);\n+            case LOOKUP:\n+            case GET_STATS:\n+            case GET_SUBSCRIPTIONS:\n+                isAuthorizedFuture = canLookupAsync(topicName, role, authData)\n+                        .thenCombine(validateTenantAdminAccess(topicName.getTenant(), role, authData),\n+                            (isTenantAdmin, isAuthorized) -> {\n+                                if (log.isDebugEnabled()) {\n+                                    log.debug(\"Verify if role {} is allowed to {} to topic {}:\"\n+                                                    + \" isSuperUser={}, isTenantAdmin={}\",\n+                                            role, operation, topicName, isTenantAdmin, isAuthorized);\n+                                }\n+                                return isTenantAdmin || isAuthorized;\n+                            });\n+                break;\n+            case PRODUCE:\n+                isAuthorizedFuture = canProduceAsync(topicName, role, authData);\n+                break;\n+            case TERMINATE:\n+                isAuthorizedFuture = canProduceAsync(topicName, role, authData)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "538ce78b25aeb97ebca547a5680c006dbf898f9e"}, "originalPosition": 49}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "538ce78b25aeb97ebca547a5680c006dbf898f9e", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/538ce78b25aeb97ebca547a5680c006dbf898f9e", "committedDate": "2021-03-09T09:57:18Z", "message": "fix rebase"}, "afterCommit": {"oid": "82078d931b1a5063ccb9813278da2d5307da815c", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/82078d931b1a5063ccb9813278da2d5307da815c", "committedDate": "2021-03-11T11:58:28Z", "message": "lookup check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c0c893de32c5bcaa509445cc53c5a6cfdde445d", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/0c0c893de32c5bcaa509445cc53c5a6cfdde445d", "committedDate": "2021-03-11T18:45:11Z", "message": "admintenant should have all rights"}, "afterCommit": {"oid": "6324f10f4535c3e52b8d9392576f3a853f0301ad", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/6324f10f4535c3e52b8d9392576f3a853f0301ad", "committedDate": "2021-03-12T00:02:26Z", "message": "fix test: as anonymousUser is tenantadmin, and cluster anonymousRole is anonymousUser this test must pass"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6324f10f4535c3e52b8d9392576f3a853f0301ad", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/6324f10f4535c3e52b8d9392576f3a853f0301ad", "committedDate": "2021-03-12T00:02:26Z", "message": "fix test: as anonymousUser is tenantadmin, and cluster anonymousRole is anonymousUser this test must pass"}, "afterCommit": {"oid": "011a6858cfe41000c467835d59e2ea7dca396ee5", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/011a6858cfe41000c467835d59e2ea7dca396ee5", "committedDate": "2021-03-12T00:52:45Z", "message": "fix test: as anonymousUser is tenantadmin, and cluster anonymousRole is anonymousUser this test must pass"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "011a6858cfe41000c467835d59e2ea7dca396ee5", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/011a6858cfe41000c467835d59e2ea7dca396ee5", "committedDate": "2021-03-12T00:52:45Z", "message": "fix test: as anonymousUser is tenantadmin, and cluster anonymousRole is anonymousUser this test must pass"}, "afterCommit": {"oid": "92685b7cb34b0a453a79743e7f84031ad0ef8a93", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/92685b7cb34b0a453a79743e7f84031ad0ef8a93", "committedDate": "2021-03-12T00:56:50Z", "message": "fix test: as anonymousUser is tenantadmin, and cluster anonymousRole is anonymousUser this test must pass"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEzMTA5ODE1", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-613109815", "createdAt": "2021-03-16T11:04:02Z", "commit": {"oid": "fc93828fe04fdfed0beb9494766c0cd3cf0a1fa7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxMTowNDowMlrOI3f7aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQxMTowNDowMlrOI3f7aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NTA2NTcwNw==", "bodyText": "@sijie can you confirm that this change is correct regarding the test anonymousUser has all rights to the topics so this new consumer should pass. Correct?", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r595065707", "createdAt": "2021-03-16T11:04:02Z", "author": {"login": "KannarFr"}, "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/AuthenticatedProducerConsumerTest.java", "diffHunk": "@@ -245,15 +245,8 @@ public void testAnonymousSyncProducerAndConsumer(int batchMessageDelayMs) throws\n         replacePulsarClient(PulsarClient.builder().serviceUrl(pulsar.getBrokerServiceUrl())\n                 .operationTimeout(1, TimeUnit.SECONDS));\n \n-        // unauthorized topic test\n-        Exception pulsarClientException = null;\n-        try {\n-            pulsarClient.newConsumer().topic(\"persistent://my-property/my-ns/other-topic\")\n-                    .subscriptionName(\"my-subscriber-name\").subscribe();\n-        } catch (Exception e) {\n-            pulsarClientException = e;\n-        }\n-        Assert.assertTrue(pulsarClientException instanceof PulsarClientException);\n+        pulsarClient.newConsumer().topic(\"persistent://my-property/my-ns/other-topic\")\n+                .subscriptionName(\"my-subscriber-name\").subscribe();\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc93828fe04fdfed0beb9494766c0cd3cf0a1fa7"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc93828fe04fdfed0beb9494766c0cd3cf0a1fa7", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/fc93828fe04fdfed0beb9494766c0cd3cf0a1fa7", "committedDate": "2021-03-12T14:37:05Z", "message": "fix test: add missing validateTopicOwnership"}, "afterCommit": {"oid": "058ed63a0a27dd88f3987e55c131fe66a8bcdf0f", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/058ed63a0a27dd88f3987e55c131fe66a8bcdf0f", "committedDate": "2021-03-18T12:37:06Z", "message": "fix test: add missing validateTopicOwnership"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjI3NDU0MDQ5", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-627454049", "createdAt": "2021-04-03T12:23:30Z", "commit": {"oid": "058ed63a0a27dd88f3987e55c131fe66a8bcdf0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wM1QxMjoyMzozMFrOJCjgaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0wM1QxMjoyMzozMFrOJCjgaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNjY1ODY2NA==", "bodyText": "I checked the get subscriptions API, originally, it uses validationReadOperationOnTopic which requires a tenant admin permission or a consume permission. After this change, it will also request produce permission.", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r606658664", "createdAt": "2021-04-03T12:23:30Z", "author": {"login": "zymap"}, "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "diffHunk": "@@ -542,30 +543,56 @@ private void validatePoliciesReadOnlyAccess() {\n                                                                String role,\n                                                                TopicOperation operation,\n                                                                AuthenticationDataSource authData) {\n+        log.debug(\"Check allowTopicOperationAsync [\" + operation.name() + \"] on [\" + topicName.toString() + \"].\");\n+\n         CompletableFuture<Boolean> isAuthorizedFuture;\n \n         switch (operation) {\n-            case LOOKUP: isAuthorizedFuture = canLookupAsync(topicName, role, authData);\n+            case LOOKUP:\n+            case GET_STATS:\n+            case GET_SUBSCRIPTIONS:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "058ed63a0a27dd88f3987e55c131fe66a8bcdf0f"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8aa1deaf2a0d76712081beda609850f8d54fecb1", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/8aa1deaf2a0d76712081beda609850f8d54fecb1", "committedDate": "2021-04-20T15:41:41Z", "message": "Merge branch 'master' into topics-api"}, "afterCommit": {"oid": "727b7a9fb38f87bce72e658a012dee8516787279", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/727b7a9fb38f87bce72e658a012dee8516787279", "committedDate": "2021-04-20T21:39:41Z", "message": "get_subscriptions must check consumption rights"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "727b7a9fb38f87bce72e658a012dee8516787279", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/727b7a9fb38f87bce72e658a012dee8516787279", "committedDate": "2021-04-20T21:39:41Z", "message": "get_subscriptions must check consumption rights"}, "afterCommit": {"oid": "4dd06537b20363305785a75437bc68b2fa3a01d8", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/4dd06537b20363305785a75437bc68b2fa3a01d8", "committedDate": "2021-04-20T21:42:27Z", "message": "topics authz granularity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eab411f39f96c1a2a67a0b1137cdadaf8b596854", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/eab411f39f96c1a2a67a0b1137cdadaf8b596854", "committedDate": "2021-04-21T00:25:44Z", "message": "support Prefix"}, "afterCommit": {"oid": "a395c702116a2d21883fafc7559904f6ac451beb", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/a395c702116a2d21883fafc7559904f6ac451beb", "committedDate": "2021-04-21T11:26:08Z", "message": "support Prefix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a395c702116a2d21883fafc7559904f6ac451beb", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/a395c702116a2d21883fafc7559904f6ac451beb", "committedDate": "2021-04-21T11:26:08Z", "message": "support Prefix"}, "afterCommit": {"oid": "3546f720ae9a35fc058fc08fca35c5f9bbff48fb", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/3546f720ae9a35fc058fc08fca35c5f9bbff48fb", "committedDate": "2021-04-23T10:30:46Z", "message": "support Prefix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjUzOTAxOTk3", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-653901997", "createdAt": "2021-05-06T21:15:02Z", "commit": {"oid": "bf33f043989bdd2c8946cd38e2e9d35b95c35289"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQyMToxNTowMlrOJWr_kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQyMToxNTowMlrOJWr_kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzc2OTIzNA==", "bodyText": "Do we need to log here? The exception would be expected if the client is not authorized and since it's already bubbled up, we would end up logging that twice.", "url": "https://github.com/apache/pulsar/pull/7523#discussion_r627769234", "createdAt": "2021-05-06T21:15:02Z", "author": {"login": "merlimat"}, "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/lookup/TopicLookupBase.java", "diffHunk": "@@ -126,14 +128,17 @@ protected void internalLookupTopicAsync(TopicName topicName, boolean authoritati\n \n     private void validateAdminAndClientPermission(TopicName topic) throws RestException, Exception {\n         try {\n-            validateAdminAccessForTenant(topic.getTenant());\n+            validateTopicOperation(topic, TopicOperation.LOOKUP);\n         } catch (Exception e) {\n-            checkConnect(topic);\n+            // unknown error marked as internal server error\n+            log.warn(\"Unexpected error while authorizing TopicOperation.LOOKUP. topic={}, role={}. Error: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf33f043989bdd2c8946cd38e2e9d35b95c35289"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a5399f4cd08b3a1838a7bb0f8933a18338e39da", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/9a5399f4cd08b3a1838a7bb0f8933a18338e39da", "committedDate": "2021-05-06T21:26:35Z", "message": "topics authz granularity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f19530a7aca1db6c06ea37bbe9af5a615f4fe7b", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/2f19530a7aca1db6c06ea37bbe9af5a615f4fe7b", "committedDate": "2021-05-06T21:26:36Z", "message": "support Prefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72d095f7a225896e9c62aa3c88be220645dd122b", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/72d095f7a225896e9c62aa3c88be220645dd122b", "committedDate": "2021-05-06T21:26:36Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "596d85f418efe40b50114da3d4a6d126cb796882", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/596d85f418efe40b50114da3d4a6d126cb796882", "committedDate": "2021-05-06T21:29:00Z", "message": "drop log"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf33f043989bdd2c8946cd38e2e9d35b95c35289", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/bf33f043989bdd2c8946cd38e2e9d35b95c35289", "committedDate": "2021-04-23T18:58:36Z", "message": "fix test"}, "afterCommit": {"oid": "596d85f418efe40b50114da3d4a6d126cb796882", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/596d85f418efe40b50114da3d4a6d126cb796882", "committedDate": "2021-05-06T21:29:00Z", "message": "drop log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjUzOTYxNzYz", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-653961763", "createdAt": "2021-05-06T23:04:47Z", "commit": {"oid": "6dcba8d32261458f4db5b95511f68c1a24cf5ebb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dcba8d32261458f4db5b95511f68c1a24cf5ebb", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/6dcba8d32261458f4db5b95511f68c1a24cf5ebb", "committedDate": "2021-05-06T22:47:33Z", "message": "make subscription immutable"}, "afterCommit": {"oid": "596d85f418efe40b50114da3d4a6d126cb796882", "author": {"user": {"login": "KannarFr", "name": "Alexandre DUVAL"}}, "url": "https://github.com/apache/pulsar/commit/596d85f418efe40b50114da3d4a6d126cb796882", "committedDate": "2021-05-06T21:29:00Z", "message": "drop log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjU0MDk0ODMz", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-654094833", "createdAt": "2021-05-07T05:37:00Z", "commit": {"oid": "596d85f418efe40b50114da3d4a6d126cb796882"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEzNzU3OTE3", "url": "https://github.com/apache/pulsar/pull/7523#pullrequestreview-613757917", "createdAt": "2021-03-16T21:55:07Z", "commit": {"oid": "fc93828fe04fdfed0beb9494766c0cd3cf0a1fa7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 594, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}