{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2Mzk3MjUx", "number": 1140, "title": "Use AdminClient for topic creation and config updates.", "bodyText": "Addresses the issue #1096.", "createdAt": "2020-03-10T22:36:36Z", "url": "https://github.com/linkedin/cruise-control/pull/1140", "merged": true, "mergeCommit": {"oid": "47a248825fca145dc1de498c053308cac7dd1f64"}, "closed": true, "closedAt": "2020-04-01T18:31:48Z", "author": {"login": "efeg"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMabYogH2gAyMzg2Mzk3MjUxOmNiNTRhYmI5ODMwMmUyYWJiMTcyZTk0MGQzNjczNmFkY2Q0MTdhNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTbWX1gH2gAyMzg2Mzk3MjUxOmUyM2Y4ZWE3MTAwOWNhMjBiMzM4ZDY5OTliMmI3ODkzMGE3NGY2MmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/cb54abb98302e2abb172e940d36736adcd417a51", "committedDate": "2020-03-10T22:40:37Z", "message": "Use AdminClient for topic creation and config updates."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ac7566ce4d72bd8e5384e95316a11b018531e94", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/4ac7566ce4d72bd8e5384e95316a11b018531e94", "committedDate": "2020-03-10T22:35:19Z", "message": "Use AdminClient for topic creation and config updates."}, "afterCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/cb54abb98302e2abb172e940d36736adcd417a51", "committedDate": "2020-03-10T22:40:37Z", "message": "Use AdminClient for topic creation and config updates."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTc2ODIz", "url": "https://github.com/linkedin/cruise-control/pull/1140#pullrequestreview-385176823", "createdAt": "2020-03-31T23:40:48Z", "commit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMzo0MDo0OFrOF-r-Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwMDoxMTowMVrOF-shLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI3NjQ1OQ==", "bodyText": "nit: bad indention.", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401276459", "createdAt": "2020-03-31T23:40:48Z", "author": {"login": "kidkun"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/monitor/sampling/SamplingUtils.java", "diffHunk": "@@ -324,4 +344,127 @@ private static boolean skipBuildingBrokerMetricSample(BrokerLoad brokerLoad, int\n \n     return false;\n   }\n+\n+  /**\n+   * Build a wrapper around the topic with the given desired properties and {@link #DEFAULT_CLEANUP_POLICY}.\n+   *\n+   * @param topic The name of the topic.\n+   * @param partitionCount Desired partition count.\n+   * @param replicationFactor Desired replication factor.\n+   * @param retentionMs Desired retention in milliseconds.\n+   * @return A wrapper around the topic with the given desired properties.\n+   */\n+  public static NewTopic wrapTopic(String topic, int partitionCount, short replicationFactor, long retentionMs) {\n+    if (partitionCount <= 0 || replicationFactor <= 0 || retentionMs <= 0) {\n+      throw new IllegalArgumentException(String.format(\"Partition count (%d), replication factor (%d), and retention ms (%d)\"\n+                                                       + \" must be positive for the topic (%s).\", partitionCount,\n+                                                       replicationFactor, retentionMs, topic));\n+    }\n+\n+    NewTopic newTopic = new NewTopic(topic, partitionCount, replicationFactor);\n+    Map<String, String> config = new HashMap<>(2);\n+    config.put(RetentionMsProp(), Long.toString(retentionMs));\n+    config.put(CleanupPolicyProp(), DEFAULT_CLEANUP_POLICY);\n+    newTopic.configs(config);\n+\n+    return newTopic;\n+  }\n+\n+  /**\n+   * Add config altering operations to the given configs to alter for configs that differ between current and desired.\n+   *\n+   * @param configsToAlter A set of config altering operations to be populated.\n+   * @param desiredConfig Desired config value by name.\n+   * @param currentConfig Current config.\n+   */\n+  private static void maybeUpdateConfig(Set<AlterConfigOp> configsToAlter, Map<String, String> desiredConfig, Config currentConfig) {\n+    for (Map.Entry<String, String> entry : desiredConfig.entrySet()) {\n+      String configName = entry.getKey();\n+      String targetConfigValue = entry.getValue();\n+      ConfigEntry currentConfigEntry = currentConfig.get(configName);\n+      if (currentConfigEntry == null || !currentConfigEntry.value().equals(targetConfigValue)) {\n+        configsToAlter.add(new AlterConfigOp(new ConfigEntry(configName, targetConfigValue), AlterConfigOp.OpType.SET));\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Update topic configurations with the desired configs specified in the given topicToUpdateConfigs.\n+   *\n+   * @param adminClient The adminClient to send describeConfigs and incrementalAlterConfigs requests.\n+   * @param topicToUpdateConfigs Existing topic to update selected configs if needed -- cannot be {@code null}.\n+   * @return {@code true} if the request is completed successfully, {@code false} if there are any exceptions.\n+   */\n+  public static boolean maybeUpdateTopicConfig(AdminClient adminClient, NewTopic topicToUpdateConfigs) {\n+    String topicName = topicToUpdateConfigs.name();\n+    // Retrieve topic config to check if it needs an update.\n+    ConfigResource topicResource = new ConfigResource(ConfigResource.Type.TOPIC, topicName);\n+    DescribeConfigsResult describeConfigsResult = adminClient.describeConfigs(Collections.singleton(topicResource));\n+    Config topicConfig;\n+    try {\n+      topicConfig = describeConfigsResult.values().get(topicResource).get(CLIENT_REQUEST_TIMEOUT_MS,\n+                                                                          TimeUnit.MILLISECONDS);\n+    } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+      LOG.warn(\"Config check for topic {} failed due to failure to describe its configs.\", topicName, e);\n+      return false;\n+    }\n+\n+    // Update configs if needed.\n+    Map<String, String> desiredConfig = topicToUpdateConfigs.configs();\n+    if (desiredConfig != null) {\n+      Set<AlterConfigOp> alterConfigOps = new HashSet<>(desiredConfig.size());\n+      maybeUpdateConfig(alterConfigOps, desiredConfig, topicConfig);\n+      if (!alterConfigOps.isEmpty()) {\n+        AlterConfigsResult\n+            alterConfigsResult = adminClient.incrementalAlterConfigs(Collections.singletonMap(topicResource, alterConfigOps));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI3NzU0OA==", "bodyText": "should we also log the error if cause is not ReassignmentInProgressException here?", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401277548", "createdAt": "2020-03-31T23:44:22Z", "author": {"login": "kidkun"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/monitor/sampling/SamplingUtils.java", "diffHunk": "@@ -324,4 +344,127 @@ private static boolean skipBuildingBrokerMetricSample(BrokerLoad brokerLoad, int\n \n     return false;\n   }\n+\n+  /**\n+   * Build a wrapper around the topic with the given desired properties and {@link #DEFAULT_CLEANUP_POLICY}.\n+   *\n+   * @param topic The name of the topic.\n+   * @param partitionCount Desired partition count.\n+   * @param replicationFactor Desired replication factor.\n+   * @param retentionMs Desired retention in milliseconds.\n+   * @return A wrapper around the topic with the given desired properties.\n+   */\n+  public static NewTopic wrapTopic(String topic, int partitionCount, short replicationFactor, long retentionMs) {\n+    if (partitionCount <= 0 || replicationFactor <= 0 || retentionMs <= 0) {\n+      throw new IllegalArgumentException(String.format(\"Partition count (%d), replication factor (%d), and retention ms (%d)\"\n+                                                       + \" must be positive for the topic (%s).\", partitionCount,\n+                                                       replicationFactor, retentionMs, topic));\n+    }\n+\n+    NewTopic newTopic = new NewTopic(topic, partitionCount, replicationFactor);\n+    Map<String, String> config = new HashMap<>(2);\n+    config.put(RetentionMsProp(), Long.toString(retentionMs));\n+    config.put(CleanupPolicyProp(), DEFAULT_CLEANUP_POLICY);\n+    newTopic.configs(config);\n+\n+    return newTopic;\n+  }\n+\n+  /**\n+   * Add config altering operations to the given configs to alter for configs that differ between current and desired.\n+   *\n+   * @param configsToAlter A set of config altering operations to be populated.\n+   * @param desiredConfig Desired config value by name.\n+   * @param currentConfig Current config.\n+   */\n+  private static void maybeUpdateConfig(Set<AlterConfigOp> configsToAlter, Map<String, String> desiredConfig, Config currentConfig) {\n+    for (Map.Entry<String, String> entry : desiredConfig.entrySet()) {\n+      String configName = entry.getKey();\n+      String targetConfigValue = entry.getValue();\n+      ConfigEntry currentConfigEntry = currentConfig.get(configName);\n+      if (currentConfigEntry == null || !currentConfigEntry.value().equals(targetConfigValue)) {\n+        configsToAlter.add(new AlterConfigOp(new ConfigEntry(configName, targetConfigValue), AlterConfigOp.OpType.SET));\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Update topic configurations with the desired configs specified in the given topicToUpdateConfigs.\n+   *\n+   * @param adminClient The adminClient to send describeConfigs and incrementalAlterConfigs requests.\n+   * @param topicToUpdateConfigs Existing topic to update selected configs if needed -- cannot be {@code null}.\n+   * @return {@code true} if the request is completed successfully, {@code false} if there are any exceptions.\n+   */\n+  public static boolean maybeUpdateTopicConfig(AdminClient adminClient, NewTopic topicToUpdateConfigs) {\n+    String topicName = topicToUpdateConfigs.name();\n+    // Retrieve topic config to check if it needs an update.\n+    ConfigResource topicResource = new ConfigResource(ConfigResource.Type.TOPIC, topicName);\n+    DescribeConfigsResult describeConfigsResult = adminClient.describeConfigs(Collections.singleton(topicResource));\n+    Config topicConfig;\n+    try {\n+      topicConfig = describeConfigsResult.values().get(topicResource).get(CLIENT_REQUEST_TIMEOUT_MS,\n+                                                                          TimeUnit.MILLISECONDS);\n+    } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+      LOG.warn(\"Config check for topic {} failed due to failure to describe its configs.\", topicName, e);\n+      return false;\n+    }\n+\n+    // Update configs if needed.\n+    Map<String, String> desiredConfig = topicToUpdateConfigs.configs();\n+    if (desiredConfig != null) {\n+      Set<AlterConfigOp> alterConfigOps = new HashSet<>(desiredConfig.size());\n+      maybeUpdateConfig(alterConfigOps, desiredConfig, topicConfig);\n+      if (!alterConfigOps.isEmpty()) {\n+        AlterConfigsResult\n+            alterConfigsResult = adminClient.incrementalAlterConfigs(Collections.singletonMap(topicResource, alterConfigOps));\n+        try {\n+          alterConfigsResult.values().get(topicResource).get(CLIENT_REQUEST_TIMEOUT_MS, TimeUnit.MILLISECONDS);\n+        } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+          LOG.warn(\"Config change for topic {} failed.\", topicName, e);\n+          return false;\n+        }\n+      }\n+    }\n+\n+    return true;\n+  }\n+\n+  /**\n+   * Increase the partition count of the given existing topic to the desired partition count (if needed).\n+   *\n+   * @param adminClient The adminClient to send describeTopics and createPartitions requests.\n+   * @param topicToAddPartitions Existing topic to add more partitions if needed -- cannot be {@code null}.\n+   * @return {@code true} if the request is completed successfully, {@code false} if there are any exceptions.\n+   */\n+  public static boolean maybeIncreasePartitionCount(AdminClient adminClient, NewTopic topicToAddPartitions) {\n+    String topicName = topicToAddPartitions.name();\n+\n+    // Retrieve partition count of topic to check if it needs a partition count update.\n+    TopicDescription topicDescription;\n+    try {\n+      topicDescription = adminClient.describeTopics(Collections.singletonList(topicName)).values()\n+                                    .get(topicName).get(CLIENT_REQUEST_TIMEOUT_MS, TimeUnit.MILLISECONDS);\n+    } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+      LOG.warn(\"Partition count increase check for topic {} failed due to failure to describe cluster.\", topicName, e);\n+      return false;\n+    }\n+\n+    // Update partition count of topic if needed.\n+    if (topicDescription.partitions().size() < topicToAddPartitions.numPartitions()) {\n+      CreatePartitionsResult createPartitionsResult = adminClient.createPartitions(\n+          Collections.singletonMap(topicName, NewPartitions.increaseTo(topicToAddPartitions.numPartitions())));\n+\n+      try {\n+        createPartitionsResult.values().get(topicName).get(CLIENT_REQUEST_TIMEOUT_MS,\n+                                                           TimeUnit.MILLISECONDS);\n+      } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+        if (e.getCause() instanceof ReassignmentInProgressException) {\n+          LOG.warn(\"Partition count increase for topic {} failed due to ongoing reassignment.\", topicName, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "originalPosition": 165}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4MTA0Mg==", "bodyText": "should we also have special handling of ReassignmentInProgressException like SamplingUtils?", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401281042", "createdAt": "2020-03-31T23:55:19Z", "author": {"login": "kidkun"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -220,18 +217,19 @@ protected void maybeUpdateTopicConfig() {\n   }\n \n   protected void maybeIncreaseTopicPartitionCount() {\n+    String cruiseControlMetricsTopic = _metricsTopic.name();\n     try {\n       // Retrieve topic partition count to check and update.\n       TopicDescription topicDescription =\n-          _adminClient.describeTopics(Collections.singletonList(_cruiseControlMetricsTopic)).values()\n-                      .get(_cruiseControlMetricsTopic).get(CLIENT_REQUEST_TIMEOUT_MS, TimeUnit.MILLISECONDS);\n+          _adminClient.describeTopics(Collections.singletonList(cruiseControlMetricsTopic)).values()\n+                      .get(cruiseControlMetricsTopic).get(CLIENT_REQUEST_TIMEOUT_MS, TimeUnit.MILLISECONDS);\n       if (topicDescription.partitions().size() < _metricsTopic.numPartitions()) {\n-        _adminClient.createPartitions(Collections.singletonMap(_cruiseControlMetricsTopic,\n+        _adminClient.createPartitions(Collections.singletonMap(cruiseControlMetricsTopic,\n                                                                NewPartitions.increaseTo(_metricsTopic.numPartitions())));\n       }\n     } catch (InterruptedException | ExecutionException | TimeoutException e) {\n-      LOG.warn(\"Unable to increase Cruise Cruise Control metrics topic {} partition number to {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4MTgxOA==", "bodyText": "what's the benefit of use local variable instead of the field _cruiseControlMetricsTopic here?", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401281818", "createdAt": "2020-03-31T23:57:59Z", "author": {"login": "kidkun"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -220,18 +217,19 @@ protected void maybeUpdateTopicConfig() {\n   }\n \n   protected void maybeIncreaseTopicPartitionCount() {\n+    String cruiseControlMetricsTopic = _metricsTopic.name();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4Mzg5NQ==", "bodyText": "if we reaches here numberOfBrokersInCluster is guaranteed to be equal or larger than DEFAULT_SAMPLE_STORE_TOPIC_REPLICATION_FACTOR(which is 2), looks the  Math.min() is redundant here.", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401283895", "createdAt": "2020-04-01T00:05:34Z", "author": {"login": "kidkun"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/monitor/sampling/KafkaSampleStore.java", "diffHunk": "@@ -168,6 +168,56 @@ public void configure(Map<String, ?> config) {\n     ensureTopicsCreated(config);\n   }\n \n+  /**\n+   * Retrieve the desired replication factor of sample store topics.\n+   *\n+   * @param config The configurations for Cruise Control.\n+   * @param adminClient The adminClient to send describeCluster request.\n+   * @return Desired replication factor of sample store topics, or {@link null} if failed to resolve replication factor.\n+   */\n+  protected Short sampleStoreTopicReplicationFactor(Map<String, ?> config, AdminClient adminClient) {\n+    if (_sampleStoreTopicReplicationFactor == null) {\n+      short numberOfBrokersInCluster;\n+      try {\n+        numberOfBrokersInCluster = (short) adminClient.describeCluster().nodes().get(CLIENT_REQUEST_TIMEOUT_MS,\n+                                                                                     TimeUnit.MILLISECONDS).size();\n+      } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+        LOG.warn(\"Auto creation of sample store topics failed due to failure to describe cluster.\", e);\n+        return null;\n+      }\n+      if (numberOfBrokersInCluster <= 1) {\n+        throw new IllegalStateException(String.format(\"Kafka cluster has less than 2 brokers (brokers in cluster=%d, zookeeper.connect=%s)\",\n+                                                      numberOfBrokersInCluster, config.get(ExecutorConfig.ZOOKEEPER_CONNECT_CONFIG)));\n+      }\n+\n+      return (short) Math.min(DEFAULT_SAMPLE_STORE_TOPIC_REPLICATION_FACTOR, numberOfBrokersInCluster);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4NDk5OA==", "bodyText": "If we are unable to create topic here, shouldn't we throw out exception? I think if this topic does not exist and is fail to be created,  KafkaSampleStore is unable to work.", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401284998", "createdAt": "2020-04-01T00:09:28Z", "author": {"login": "kidkun"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/monitor/sampling/KafkaSampleStore.java", "diffHunk": "@@ -168,6 +168,56 @@ public void configure(Map<String, ?> config) {\n     ensureTopicsCreated(config);\n   }\n \n+  /**\n+   * Retrieve the desired replication factor of sample store topics.\n+   *\n+   * @param config The configurations for Cruise Control.\n+   * @param adminClient The adminClient to send describeCluster request.\n+   * @return Desired replication factor of sample store topics, or {@link null} if failed to resolve replication factor.\n+   */\n+  protected Short sampleStoreTopicReplicationFactor(Map<String, ?> config, AdminClient adminClient) {\n+    if (_sampleStoreTopicReplicationFactor == null) {\n+      short numberOfBrokersInCluster;\n+      try {\n+        numberOfBrokersInCluster = (short) adminClient.describeCluster().nodes().get(CLIENT_REQUEST_TIMEOUT_MS,\n+                                                                                     TimeUnit.MILLISECONDS).size();\n+      } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+        LOG.warn(\"Auto creation of sample store topics failed due to failure to describe cluster.\", e);\n+        return null;\n+      }\n+      if (numberOfBrokersInCluster <= 1) {\n+        throw new IllegalStateException(String.format(\"Kafka cluster has less than 2 brokers (brokers in cluster=%d, zookeeper.connect=%s)\",\n+                                                      numberOfBrokersInCluster, config.get(ExecutorConfig.ZOOKEEPER_CONNECT_CONFIG)));\n+      }\n+\n+      return (short) Math.min(DEFAULT_SAMPLE_STORE_TOPIC_REPLICATION_FACTOR, numberOfBrokersInCluster);\n+    }\n+\n+    return _sampleStoreTopicReplicationFactor;\n+  }\n+\n+  /**\n+   * Creates the given topic if it does not exist.\n+   *\n+   * @param adminClient The adminClient to send createTopics request.\n+   * @param topicToBeCreated A wrapper around the topic to be created.\n+   * @return {@code false} if the topic to be created already exists, {@code true} otherwise.\n+   */\n+  protected static boolean createTopic(AdminClient adminClient, NewTopic topicToBeCreated) {\n+    try {\n+      CreateTopicsResult createTopicsResult = adminClient.createTopics(Collections.singletonList(topicToBeCreated));\n+      createTopicsResult.values().get(topicToBeCreated.name()).get(CruiseControlMetricsUtils.CLIENT_REQUEST_TIMEOUT_MS,\n+                                                                   TimeUnit.MILLISECONDS);\n+      LOG.info(\"Topic {} has been created.\", topicToBeCreated.name());\n+    } catch (InterruptedException | ExecutionException | TimeoutException e) {\n+      if (e.getCause() instanceof TopicExistsException) {\n+        return false;\n+      }\n+      LOG.warn(\"Unable to create topic {}.\", topicToBeCreated.name(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI4NTQyMQ==", "bodyText": "Looks like sampleStoreTopicReplicationFactor(config, adminClient) could return null here, will this be an issue in unboxing?", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401285421", "createdAt": "2020-04-01T00:11:01Z", "author": {"login": "kidkun"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/monitor/sampling/KafkaSampleStore.java", "diffHunk": "@@ -215,16 +265,11 @@ public void configure(Map<String, ?> config) {\n \n   @SuppressWarnings(\"unchecked\")\n   protected void ensureTopicsCreated(Map<String, ?> config) {\n-    String connectString = (String) config.get(ExecutorConfig.ZOOKEEPER_CONNECT_CONFIG);\n-    boolean zkSecurityEnabled = (Boolean) config.get(ExecutorConfig.ZOOKEEPER_SECURITY_ENABLED_CONFIG);\n-    KafkaZkClient kafkaZkClient = KafkaCruiseControlUtils.createKafkaZkClient(connectString,\n-                                                                              \"KafkaSampleStore\",\n-                                                                              \"EnsureTopicCreated\",\n-                                                                              zkSecurityEnabled);\n-    AdminZkClient adminZkClient = new AdminZkClient(kafkaZkClient);\n     AdminClient adminClient = KafkaCruiseControlUtils.createAdminClient((Map<String, Object>) config);\n     try {\n-      Map<String, List<PartitionInfo>> topics = _consumers.get(0).listTopics();\n+      short replicationFactor = sampleStoreTopicReplicationFactor(config, adminClient);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb54abb98302e2abb172e940d36736adcd417a51"}, "originalPosition": 159}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e67d8b5018a084a31fb605aa5a2edcf11c8c5785", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/e67d8b5018a084a31fb605aa5a2edcf11c8c5785", "committedDate": "2020-04-01T01:29:41Z", "message": "Address the feedback."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NzE3Nzg0", "url": "https://github.com/linkedin/cruise-control/pull/1140#pullrequestreview-385717784", "createdAt": "2020-04-01T15:48:43Z", "commit": {"oid": "e67d8b5018a084a31fb605aa5a2edcf11c8c5785"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNTo0ODo0NFrOF_HCNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNTo0ODo0NFrOF_HCNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcxOTg2Mw==", "bodyText": "Why don't you just rethrow e.getCause()?", "url": "https://github.com/linkedin/cruise-control/pull/1140#discussion_r401719863", "createdAt": "2020-04-01T15:48:44Z", "author": {"login": "viktorsomogyi"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -182,15 +183,12 @@ protected void createCruiseControlMetricsTopic() throws TopicExistsException {\n     try {\n       CreateTopicsResult createTopicsResult = _adminClient.createTopics(Collections.singletonList(_metricsTopic));\n       createTopicsResult.values().get(_metricsTopic.name()).get(CLIENT_REQUEST_TIMEOUT_MS, TimeUnit.MILLISECONDS);\n-      LOG.info(\"Cruise Control metrics topic {} is created.\", _cruiseControlMetricsTopic);\n-    } catch (ExecutionException e) {\n+      LOG.info(\"Cruise Control metrics topic {} is created.\", _metricsTopic.name());\n+    } catch (InterruptedException | ExecutionException | TimeoutException e) {\n       if (e.getCause() instanceof TopicExistsException) {\n         throw new TopicExistsException(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e67d8b5018a084a31fb605aa5a2edcf11c8c5785"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1Nzc0OTA2", "url": "https://github.com/linkedin/cruise-control/pull/1140#pullrequestreview-385774906", "createdAt": "2020-04-01T16:57:09Z", "commit": {"oid": "e67d8b5018a084a31fb605aa5a2edcf11c8c5785"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e23f8ea71009ca20b338d6999b2b78930a74f62a", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/e23f8ea71009ca20b338d6999b2b78930a74f62a", "committedDate": "2020-04-01T17:42:31Z", "message": "Address the feedback."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 189, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}