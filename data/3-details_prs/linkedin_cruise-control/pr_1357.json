{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MDc4MTI1", "number": 1357, "title": "Add check to validate that time range start time is smaller than end time", "bodyText": "This PR resolves #1355.\nNotes for code reviewer:\nThis PR adds the below methods ParameterUtils.endMsOrDefault and ParameterUtils.startMsOrDefault. The reason is that it should be up to the caller to decide the default values for start time and end time. Depending on which AbstractParameters class parses the request, they might have different default values for start time and/or end time.\nThe original startMs and endMs returns null if no start/end time is set in the request.", "createdAt": "2020-10-16T20:07:55Z", "url": "https://github.com/linkedin/cruise-control/pull/1357", "merged": true, "mergeCommit": {"oid": "2ead05d8c936615d67718ba55259d31b81321221"}, "closed": true, "closedAt": "2020-10-23T00:43:17Z", "author": {"login": "Lincong"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTP0qxAFqTUxMDg0Nzk4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVLWuEgFqTUxNTIwNDY4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODQ3OTg3", "url": "https://github.com/linkedin/cruise-control/pull/1357#pullrequestreview-510847987", "createdAt": "2020-10-16T23:36:57Z", "commit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMzozNjo1N1rOHjSX1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QwMDoyNzowOFrOHjS3KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2MzIyMA==", "bodyText": "Repeated code (also applies to endMsOrDefault) -- please see comment on removing startMs and endMs.", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506763220", "createdAt": "2020-10-16T23:36:57Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -408,16 +409,31 @@ static Long time(HttpServletRequest request) {\n     return timeString.toUpperCase().equals(\"NOW\") ? System.currentTimeMillis() : Long.parseLong(timeString);\n   }\n \n-  static long startMs(HttpServletRequest request) {\n-    String parameterString = caseSensitiveParameterName(request.getParameterMap(), START_MS_PARAM);\n-    return parameterString == null ? DEFAULT_START_TIME_FOR_CLUSTER_MODEL\n-                                   : Long.parseLong(request.getParameter(parameterString));\n+  @Nullable\n+  static Long startMs(HttpServletRequest request) {\n+    return parseParamAsLong(request, START_MS_PARAM);\n   }\n \n-  static long endMs(HttpServletRequest request) {\n-    String parameterString = caseSensitiveParameterName(request.getParameterMap(), END_MS_PARAM);\n-    return parameterString == null ? System.currentTimeMillis()\n-                                   : Long.parseLong(request.getParameter(parameterString));\n+  @Nullable\n+  static Long endMs(HttpServletRequest request) {\n+    return parseParamAsLong(request, END_MS_PARAM);\n+  }\n+\n+  static long startMsOrDefault(HttpServletRequest request, long defaultStartMs) {\n+    Long startMs = parseParamAsLong(request, START_MS_PARAM);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2NjI1NQ==", "bodyText": "Nit: For consistency across util functions, can we implement this similar to we parse a Boolean -- e.g.replace parseParamAsLong with getLongParam\n  public static long getLongParam(HttpServletRequest request, String parameter, long defaultIfMissing) {\n    String parameterString = caseSensitiveParameterName(request.getParameterMap(), parameter);\n    return parameterString == null ? defaultIfMissing : Long.parseLong(request.getParameter(parameterString));\n  }", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506766255", "createdAt": "2020-10-16T23:54:30Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -1058,6 +1074,12 @@ static boolean fetchCompletedTask(HttpServletRequest request) {\n     return getBooleanParam(request, FETCH_COMPLETED_TASK_PARAM, false);\n   }\n \n+  @Nullable\n+  private static Long parseParamAsLong(HttpServletRequest request, String paramName) {\n+    String parameterString = caseSensitiveParameterName(request.getParameterMap(), paramName);\n+    return parameterString == null ? null : Long.parseLong(request.getParameter(parameterString));\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2ODU3NA==", "bodyText": "Having separate functions for startMs and startMsOrDefault (same issue for end) seems a little redundant (e.g. see code repetition for parseParamAsLong(request, START_MS_PARAM) between these functions).\nI wonder if we can make it more concise by dropping endMs and startMs functions. Their callers can call startMsOrDefault and endMsOrDefault with null as the default parameter.", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506768574", "createdAt": "2020-10-17T00:09:09Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -408,16 +409,31 @@ static Long time(HttpServletRequest request) {\n     return timeString.toUpperCase().equals(\"NOW\") ? System.currentTimeMillis() : Long.parseLong(timeString);\n   }\n \n-  static long startMs(HttpServletRequest request) {\n-    String parameterString = caseSensitiveParameterName(request.getParameterMap(), START_MS_PARAM);\n-    return parameterString == null ? DEFAULT_START_TIME_FOR_CLUSTER_MODEL\n-                                   : Long.parseLong(request.getParameter(parameterString));\n+  @Nullable\n+  static Long startMs(HttpServletRequest request) {\n+    return parseParamAsLong(request, START_MS_PARAM);\n   }\n \n-  static long endMs(HttpServletRequest request) {\n-    String parameterString = caseSensitiveParameterName(request.getParameterMap(), END_MS_PARAM);\n-    return parameterString == null ? System.currentTimeMillis()\n-                                   : Long.parseLong(request.getParameter(parameterString));\n+  @Nullable\n+  static Long endMs(HttpServletRequest request) {\n+    return parseParamAsLong(request, END_MS_PARAM);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2OTA1NA==", "bodyText": "For consistency of the parameter name for missing default values defaultEndMs -> defaultIfMissing.\nAlso, can we make the return type and the type of the default parameter Long? Clearly, if the response is null, it would only be possible via a null default parameter passed to this function.", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506769054", "createdAt": "2020-10-17T00:11:58Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -408,16 +409,31 @@ static Long time(HttpServletRequest request) {\n     return timeString.toUpperCase().equals(\"NOW\") ? System.currentTimeMillis() : Long.parseLong(timeString);\n   }\n \n-  static long startMs(HttpServletRequest request) {\n-    String parameterString = caseSensitiveParameterName(request.getParameterMap(), START_MS_PARAM);\n-    return parameterString == null ? DEFAULT_START_TIME_FOR_CLUSTER_MODEL\n-                                   : Long.parseLong(request.getParameter(parameterString));\n+  @Nullable\n+  static Long startMs(HttpServletRequest request) {\n+    return parseParamAsLong(request, START_MS_PARAM);\n   }\n \n-  static long endMs(HttpServletRequest request) {\n-    String parameterString = caseSensitiveParameterName(request.getParameterMap(), END_MS_PARAM);\n-    return parameterString == null ? System.currentTimeMillis()\n-                                   : Long.parseLong(request.getParameter(parameterString));\n+  @Nullable\n+  static Long endMs(HttpServletRequest request) {\n+    return parseParamAsLong(request, END_MS_PARAM);\n+  }\n+\n+  static long startMsOrDefault(HttpServletRequest request, long defaultStartMs) {\n+    Long startMs = parseParamAsLong(request, START_MS_PARAM);\n+    return startMs == null ? defaultStartMs : startMs;\n+  }\n+\n+  static long endMsOrDefault(HttpServletRequest request, long defaultEndMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2OTk1Ng==", "bodyText": "2017 -> 2020 (i.e. date of creation)", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506769956", "createdAt": "2020-10-17T00:18:06Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2017 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3MDUxOA==", "bodyText": "Is it acceptable for these mocked responses to be called anyTimes? Is it possible to be more specific?", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506770518", "createdAt": "2020-10-17T00:21:58Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2017 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.servlet.parameters;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import org.easymock.EasyMock;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+\n+public class ParameterUtilsTest {\n+\n+  private static final Long DEFAULT_START_TIME_MS = -1L;\n+  private static final Long DEFAULT_END_TIME_MS = -2L;\n+\n+  @Test\n+  public void testParseTimeRangeSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    String startTimeString = \"12345\";\n+    String endTimeString = \"23456\";\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.START_MS_PARAM, new String[]{ParameterUtils.START_MS_PARAM});\n+    paramMap.put(ParameterUtils.END_MS_PARAM, new String[]{ParameterUtils.END_MS_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).anyTimes();\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.START_MS_PARAM)).andReturn(startTimeString).anyTimes();\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.END_MS_PARAM)).andReturn(endTimeString).anyTimes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3MDgyNw==", "bodyText": "Why don't we use the .longValue() of start and endMs?", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506770827", "createdAt": "2020-10-17T00:24:32Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2017 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.servlet.parameters;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import org.easymock.EasyMock;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+\n+public class ParameterUtilsTest {\n+\n+  private static final Long DEFAULT_START_TIME_MS = -1L;\n+  private static final Long DEFAULT_END_TIME_MS = -2L;\n+\n+  @Test\n+  public void testParseTimeRangeSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    String startTimeString = \"12345\";\n+    String endTimeString = \"23456\";\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.START_MS_PARAM, new String[]{ParameterUtils.START_MS_PARAM});\n+    paramMap.put(ParameterUtils.END_MS_PARAM, new String[]{ParameterUtils.END_MS_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).anyTimes();\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.START_MS_PARAM)).andReturn(startTimeString).anyTimes();\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.END_MS_PARAM)).andReturn(endTimeString).anyTimes();\n+    EasyMock.replay(mockRequest);\n+\n+    Long startMs = ParameterUtils.startMs(mockRequest);\n+    Long endMs = ParameterUtils.endMs(mockRequest);\n+    Assert.assertNotNull(startMs);\n+    Assert.assertNotNull(endMs);\n+    Assert.assertEquals((Long) Long.parseLong(startTimeString), startMs);\n+    Assert.assertEquals((Long) Long.parseLong(endTimeString), endMs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3MTI0MA==", "bodyText": "Can we avoid hardcoding test values and move them to static variables?", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r506771240", "createdAt": "2020-10-17T00:27:08Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2017 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.servlet.parameters;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import org.easymock.EasyMock;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+\n+public class ParameterUtilsTest {\n+\n+  private static final Long DEFAULT_START_TIME_MS = -1L;\n+  private static final Long DEFAULT_END_TIME_MS = -2L;\n+\n+  @Test\n+  public void testParseTimeRangeSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    String startTimeString = \"12345\";\n+    String endTimeString = \"23456\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b35d593d947cb1eb6c3a401b8199f9c2506fcfa5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMzU2NTU0", "url": "https://github.com/linkedin/cruise-control/pull/1357#pullrequestreview-511356554", "createdAt": "2020-10-19T00:56:48Z", "commit": {"oid": "644e80a67b9fab367b26086e2213174a41a87c77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMDo1Njo0OFrOHjzJEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwMDo1Njo0OFrOHjzJEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzMwMDExMw==", "bodyText": "Should other Long parameters in this class also use of this function for parsing -- e.g. EXECUTION_PROGRESS_CHECK_INTERVAL_MS_PARAM?", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r507300113", "createdAt": "2020-10-19T00:56:48Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -246,6 +247,19 @@ public static boolean getBooleanParam(HttpServletRequest request, String paramet\n     return parameterString == null ? defaultIfMissing : Boolean.parseBoolean(request.getParameter(parameterString));\n   }\n \n+  /**\n+   * Get the long parameter parameter.\n+   *\n+   * @param request HTTP request received by Cruise Control.\n+   * @param parameter Parameter to parse from the request.\n+   * @param defaultIfMissing Default value to set if the request does not contain the parameter.\n+   * @return The specified value for the parameter, or defaultIfMissing if the parameter is missing.\n+   */\n+  public static Long getLongParam(HttpServletRequest request, String parameter, @Nullable Long defaultIfMissing) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "644e80a67b9fab367b26086e2213174a41a87c77"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab74edec730889bfd82978fe3740ed48a09d6662", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/ab74edec730889bfd82978fe3740ed48a09d6662", "committedDate": "2020-10-21T23:23:58Z", "message": "Add check to validate that time range start time is smaller than end time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21dcf79a570d8ab4ff2e96ca14f63262967504be", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/21dcf79a570d8ab4ff2e96ca14f63262967504be", "committedDate": "2020-10-21T23:23:58Z", "message": "Add unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abd34dfa010765f0812674341f60ca499ed2c571", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/abd34dfa010765f0812674341f60ca499ed2c571", "committedDate": "2020-10-21T23:23:58Z", "message": "Fixed issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9e927cf1e00912127e9752176e8fbb352c8afc0", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/d9e927cf1e00912127e9752176e8fbb352c8afc0", "committedDate": "2020-10-21T23:23:58Z", "message": "Replace Long.parseLong with Long.valueOf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b153fe1064f5db645ae9c4511732b4dfc81e78d8", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/b153fe1064f5db645ae9c4511732b4dfc81e78d8", "committedDate": "2020-10-21T23:23:58Z", "message": "Apply getLongParam method to more get long static method in ParamUtils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c23f032d505e1d5b3970307dffe4b8e815ce8e9", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/3c23f032d505e1d5b3970307dffe4b8e815ce8e9", "committedDate": "2020-10-20T03:11:49Z", "message": "Fixed conflicts"}, "afterCommit": {"oid": "b153fe1064f5db645ae9c4511732b4dfc81e78d8", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/b153fe1064f5db645ae9c4511732b4dfc81e78d8", "committedDate": "2020-10-21T23:23:58Z", "message": "Apply getLongParam method to more get long static method in ParamUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0OTYwMzUw", "url": "https://github.com/linkedin/cruise-control/pull/1357#pullrequestreview-514960350", "createdAt": "2020-10-22T17:27:24Z", "commit": {"oid": "b153fe1064f5db645ae9c4511732b4dfc81e78d8"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNzoyNzoyNVrOHmsZZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNzozNToxNVrOHmssGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMzNTMzNA==", "bodyText": "(Applies to other similar uses in this test):\nNit: times(1) -> once() -- i.e. calling one time is special :)", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r510335334", "createdAt": "2020-10-22T17:27:25Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.servlet.parameters;\n+\n+import com.linkedin.kafka.cruisecontrol.config.KafkaCruiseControlConfig;\n+import com.linkedin.kafka.cruisecontrol.config.constants.ExecutorConfig;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import org.easymock.EasyMock;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+\n+public class ParameterUtilsTest {\n+\n+  private static final Long DEFAULT_START_TIME_MS = -1L;\n+  private static final Long DEFAULT_END_TIME_MS = -2L;\n+  private static final String START_TIME_STRING = \"12345\";\n+  private static final String END_TIME_STRING = \"23456\";\n+  private static final String REPLICATION_THROTTLE_STRING = \"1000\";\n+  private static final String DEFAULT_REPLICATION_THROTTLE_STRING = \"2000\";\n+  private static final String EXECUTION_PROGRESS_CHECK_INTERVAL_STRING = \"1500\";\n+\n+  @Test\n+  public void testParseTimeRangeSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.START_MS_PARAM, new String[]{ParameterUtils.START_MS_PARAM});\n+    paramMap.put(ParameterUtils.END_MS_PARAM, new String[]{ParameterUtils.END_MS_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).times(4);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.START_MS_PARAM)).andReturn(START_TIME_STRING).times(2);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.END_MS_PARAM)).andReturn(END_TIME_STRING).times(2);\n+    EasyMock.replay(mockRequest);\n+\n+    Long startMs = ParameterUtils.startMsOrDefault(mockRequest, null);\n+    Long endMs = ParameterUtils.endMsOrDefault(mockRequest, null);\n+    Assert.assertNotNull(startMs);\n+    Assert.assertNotNull(endMs);\n+    Assert.assertEquals(Long.valueOf(START_TIME_STRING), startMs);\n+    Assert.assertEquals(Long.valueOf(END_TIME_STRING), endMs);\n+    ParameterUtils.validateTimeRange(startMs, endMs);\n+\n+    startMs = ParameterUtils.startMsOrDefault(mockRequest, DEFAULT_START_TIME_MS);\n+    endMs = ParameterUtils.endMsOrDefault(mockRequest, DEFAULT_END_TIME_MS);\n+\n+    Assert.assertEquals(Long.valueOf(START_TIME_STRING), startMs);\n+    Assert.assertEquals(Long.valueOf(END_TIME_STRING), endMs);\n+  }\n+\n+  @Test\n+  public void testParseTimeRangeNotSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    // Mock the request so that it does not contain start/end time\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(Collections.emptyMap()).times(4);\n+    EasyMock.replay(mockRequest);\n+\n+    Long startMs = ParameterUtils.startMsOrDefault(mockRequest, null);\n+    Long endMs = ParameterUtils.endMsOrDefault(mockRequest, null);\n+    Assert.assertNull(startMs);\n+    Assert.assertNull(endMs);\n+\n+    startMs = ParameterUtils.startMsOrDefault(mockRequest, DEFAULT_START_TIME_MS);\n+    endMs = ParameterUtils.endMsOrDefault(mockRequest, DEFAULT_END_TIME_MS);\n+\n+    Assert.assertEquals(DEFAULT_START_TIME_MS, startMs);\n+    Assert.assertEquals(DEFAULT_END_TIME_MS, endMs);\n+  }\n+\n+  @Test\n+  public void testParseReplicationThrottleWithNoDefault() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    KafkaCruiseControlConfig controlConfig = EasyMock.mock(KafkaCruiseControlConfig.class);\n+\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.REPLICATION_THROTTLE_PARAM, new String[]{ParameterUtils.REPLICATION_THROTTLE_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).times(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b153fe1064f5db645ae9c4511732b4dfc81e78d8"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMzNzc5Mw==", "bodyText": "(One more similar use above):\nNit: This is a map with a single element -- should we use a singletonMap? -- i.e.\n    Map<String, String[]> paramMap = Collections.singletonMap(ParameterUtils.EXECUTION_PROGRESS_CHECK_INTERVAL_MS_PARAM,\n                                                              new String[]{ParameterUtils.EXECUTION_PROGRESS_CHECK_INTERVAL_MS_PARAM});", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r510337793", "createdAt": "2020-10-22T17:31:28Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.servlet.parameters;\n+\n+import com.linkedin.kafka.cruisecontrol.config.KafkaCruiseControlConfig;\n+import com.linkedin.kafka.cruisecontrol.config.constants.ExecutorConfig;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import org.easymock.EasyMock;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+\n+public class ParameterUtilsTest {\n+\n+  private static final Long DEFAULT_START_TIME_MS = -1L;\n+  private static final Long DEFAULT_END_TIME_MS = -2L;\n+  private static final String START_TIME_STRING = \"12345\";\n+  private static final String END_TIME_STRING = \"23456\";\n+  private static final String REPLICATION_THROTTLE_STRING = \"1000\";\n+  private static final String DEFAULT_REPLICATION_THROTTLE_STRING = \"2000\";\n+  private static final String EXECUTION_PROGRESS_CHECK_INTERVAL_STRING = \"1500\";\n+\n+  @Test\n+  public void testParseTimeRangeSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.START_MS_PARAM, new String[]{ParameterUtils.START_MS_PARAM});\n+    paramMap.put(ParameterUtils.END_MS_PARAM, new String[]{ParameterUtils.END_MS_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).times(4);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.START_MS_PARAM)).andReturn(START_TIME_STRING).times(2);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.END_MS_PARAM)).andReturn(END_TIME_STRING).times(2);\n+    EasyMock.replay(mockRequest);\n+\n+    Long startMs = ParameterUtils.startMsOrDefault(mockRequest, null);\n+    Long endMs = ParameterUtils.endMsOrDefault(mockRequest, null);\n+    Assert.assertNotNull(startMs);\n+    Assert.assertNotNull(endMs);\n+    Assert.assertEquals(Long.valueOf(START_TIME_STRING), startMs);\n+    Assert.assertEquals(Long.valueOf(END_TIME_STRING), endMs);\n+    ParameterUtils.validateTimeRange(startMs, endMs);\n+\n+    startMs = ParameterUtils.startMsOrDefault(mockRequest, DEFAULT_START_TIME_MS);\n+    endMs = ParameterUtils.endMsOrDefault(mockRequest, DEFAULT_END_TIME_MS);\n+\n+    Assert.assertEquals(Long.valueOf(START_TIME_STRING), startMs);\n+    Assert.assertEquals(Long.valueOf(END_TIME_STRING), endMs);\n+  }\n+\n+  @Test\n+  public void testParseTimeRangeNotSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    // Mock the request so that it does not contain start/end time\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(Collections.emptyMap()).times(4);\n+    EasyMock.replay(mockRequest);\n+\n+    Long startMs = ParameterUtils.startMsOrDefault(mockRequest, null);\n+    Long endMs = ParameterUtils.endMsOrDefault(mockRequest, null);\n+    Assert.assertNull(startMs);\n+    Assert.assertNull(endMs);\n+\n+    startMs = ParameterUtils.startMsOrDefault(mockRequest, DEFAULT_START_TIME_MS);\n+    endMs = ParameterUtils.endMsOrDefault(mockRequest, DEFAULT_END_TIME_MS);\n+\n+    Assert.assertEquals(DEFAULT_START_TIME_MS, startMs);\n+    Assert.assertEquals(DEFAULT_END_TIME_MS, endMs);\n+  }\n+\n+  @Test\n+  public void testParseReplicationThrottleWithNoDefault() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    KafkaCruiseControlConfig controlConfig = EasyMock.mock(KafkaCruiseControlConfig.class);\n+\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.REPLICATION_THROTTLE_PARAM, new String[]{ParameterUtils.REPLICATION_THROTTLE_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).times(1);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.REPLICATION_THROTTLE_PARAM)).andReturn(REPLICATION_THROTTLE_STRING).times(1);\n+    EasyMock.expect(controlConfig.getLong(ExecutorConfig.DEFAULT_REPLICATION_THROTTLE_CONFIG)).andReturn(null); // No default\n+\n+    EasyMock.replay(mockRequest);\n+    EasyMock.replay(controlConfig);\n+\n+    Long replicationThrottle = ParameterUtils.replicationThrottle(mockRequest, controlConfig);\n+    Assert.assertEquals(Long.valueOf(REPLICATION_THROTTLE_STRING), replicationThrottle);\n+  }\n+\n+  @Test\n+  public void testParseReplicationThrottleWithDefault() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    KafkaCruiseControlConfig controlConfig = EasyMock.mock(KafkaCruiseControlConfig.class);\n+    // No parameter string value in the parameter map\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(Collections.emptyMap()).times(1);\n+    EasyMock.expect(controlConfig.getLong(ExecutorConfig.DEFAULT_REPLICATION_THROTTLE_CONFIG))\n+            .andReturn(Long.valueOf(DEFAULT_REPLICATION_THROTTLE_STRING));\n+\n+    EasyMock.replay(mockRequest);\n+    EasyMock.replay(controlConfig);\n+\n+    Long replicationThrottle = ParameterUtils.replicationThrottle(mockRequest, controlConfig);\n+    Assert.assertEquals(Long.valueOf(DEFAULT_REPLICATION_THROTTLE_STRING), replicationThrottle);\n+  }\n+\n+  @Test\n+  public void testParseExecutionProgressCheckIntervalMsNoValue() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(Collections.emptyMap()).times(1);\n+    EasyMock.replay(mockRequest);\n+    Assert.assertNull(ParameterUtils.executionProgressCheckIntervalMs(mockRequest));\n+  }\n+\n+  @Test\n+  public void testParseExecutionProgressCheckIntervalMsWithValue() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(\n+        ParameterUtils.EXECUTION_PROGRESS_CHECK_INTERVAL_MS_PARAM,\n+        new String[]{ParameterUtils.EXECUTION_PROGRESS_CHECK_INTERVAL_MS_PARAM});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b153fe1064f5db645ae9c4511732b4dfc81e78d8"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMzODk2OQ==", "bodyText": "Looks the mocks are not verified in tests -- i.e. there is no actual verification of whether mock functions are called or how many times they are called.\nCan we call EasyMock.verify(...) for each test after mocks are replayed and actual calls are made?", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r510338969", "createdAt": "2020-10-22T17:33:26Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.servlet.parameters;\n+\n+import com.linkedin.kafka.cruisecontrol.config.KafkaCruiseControlConfig;\n+import com.linkedin.kafka.cruisecontrol.config.constants.ExecutorConfig;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import org.easymock.EasyMock;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+\n+public class ParameterUtilsTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b153fe1064f5db645ae9c4511732b4dfc81e78d8"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM0MDEyMQ==", "bodyText": "(There are other similar uses in this test):\nThis function takes Object... as input; hence, we can pass all mocks in a single call rather than sequential calls.", "url": "https://github.com/linkedin/cruise-control/pull/1357#discussion_r510340121", "createdAt": "2020-10-22T17:35:15Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.servlet.parameters;\n+\n+import com.linkedin.kafka.cruisecontrol.config.KafkaCruiseControlConfig;\n+import com.linkedin.kafka.cruisecontrol.config.constants.ExecutorConfig;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import org.easymock.EasyMock;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+\n+public class ParameterUtilsTest {\n+\n+  private static final Long DEFAULT_START_TIME_MS = -1L;\n+  private static final Long DEFAULT_END_TIME_MS = -2L;\n+  private static final String START_TIME_STRING = \"12345\";\n+  private static final String END_TIME_STRING = \"23456\";\n+  private static final String REPLICATION_THROTTLE_STRING = \"1000\";\n+  private static final String DEFAULT_REPLICATION_THROTTLE_STRING = \"2000\";\n+  private static final String EXECUTION_PROGRESS_CHECK_INTERVAL_STRING = \"1500\";\n+\n+  @Test\n+  public void testParseTimeRangeSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.START_MS_PARAM, new String[]{ParameterUtils.START_MS_PARAM});\n+    paramMap.put(ParameterUtils.END_MS_PARAM, new String[]{ParameterUtils.END_MS_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).times(4);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.START_MS_PARAM)).andReturn(START_TIME_STRING).times(2);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.END_MS_PARAM)).andReturn(END_TIME_STRING).times(2);\n+    EasyMock.replay(mockRequest);\n+\n+    Long startMs = ParameterUtils.startMsOrDefault(mockRequest, null);\n+    Long endMs = ParameterUtils.endMsOrDefault(mockRequest, null);\n+    Assert.assertNotNull(startMs);\n+    Assert.assertNotNull(endMs);\n+    Assert.assertEquals(Long.valueOf(START_TIME_STRING), startMs);\n+    Assert.assertEquals(Long.valueOf(END_TIME_STRING), endMs);\n+    ParameterUtils.validateTimeRange(startMs, endMs);\n+\n+    startMs = ParameterUtils.startMsOrDefault(mockRequest, DEFAULT_START_TIME_MS);\n+    endMs = ParameterUtils.endMsOrDefault(mockRequest, DEFAULT_END_TIME_MS);\n+\n+    Assert.assertEquals(Long.valueOf(START_TIME_STRING), startMs);\n+    Assert.assertEquals(Long.valueOf(END_TIME_STRING), endMs);\n+  }\n+\n+  @Test\n+  public void testParseTimeRangeNotSet() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    // Mock the request so that it does not contain start/end time\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(Collections.emptyMap()).times(4);\n+    EasyMock.replay(mockRequest);\n+\n+    Long startMs = ParameterUtils.startMsOrDefault(mockRequest, null);\n+    Long endMs = ParameterUtils.endMsOrDefault(mockRequest, null);\n+    Assert.assertNull(startMs);\n+    Assert.assertNull(endMs);\n+\n+    startMs = ParameterUtils.startMsOrDefault(mockRequest, DEFAULT_START_TIME_MS);\n+    endMs = ParameterUtils.endMsOrDefault(mockRequest, DEFAULT_END_TIME_MS);\n+\n+    Assert.assertEquals(DEFAULT_START_TIME_MS, startMs);\n+    Assert.assertEquals(DEFAULT_END_TIME_MS, endMs);\n+  }\n+\n+  @Test\n+  public void testParseReplicationThrottleWithNoDefault() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    KafkaCruiseControlConfig controlConfig = EasyMock.mock(KafkaCruiseControlConfig.class);\n+\n+    Map<String, String[]> paramMap = new HashMap<>();\n+    paramMap.put(ParameterUtils.REPLICATION_THROTTLE_PARAM, new String[]{ParameterUtils.REPLICATION_THROTTLE_PARAM});\n+\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(paramMap).times(1);\n+    EasyMock.expect(mockRequest.getParameter(ParameterUtils.REPLICATION_THROTTLE_PARAM)).andReturn(REPLICATION_THROTTLE_STRING).times(1);\n+    EasyMock.expect(controlConfig.getLong(ExecutorConfig.DEFAULT_REPLICATION_THROTTLE_CONFIG)).andReturn(null); // No default\n+\n+    EasyMock.replay(mockRequest);\n+    EasyMock.replay(controlConfig);\n+\n+    Long replicationThrottle = ParameterUtils.replicationThrottle(mockRequest, controlConfig);\n+    Assert.assertEquals(Long.valueOf(REPLICATION_THROTTLE_STRING), replicationThrottle);\n+  }\n+\n+  @Test\n+  public void testParseReplicationThrottleWithDefault() {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    KafkaCruiseControlConfig controlConfig = EasyMock.mock(KafkaCruiseControlConfig.class);\n+    // No parameter string value in the parameter map\n+    EasyMock.expect(mockRequest.getParameterMap()).andReturn(Collections.emptyMap()).times(1);\n+    EasyMock.expect(controlConfig.getLong(ExecutorConfig.DEFAULT_REPLICATION_THROTTLE_CONFIG))\n+            .andReturn(Long.valueOf(DEFAULT_REPLICATION_THROTTLE_STRING));\n+\n+    EasyMock.replay(mockRequest);\n+    EasyMock.replay(controlConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b153fe1064f5db645ae9c4511732b4dfc81e78d8"}, "originalPosition": 103}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb653eac73493a95ecf40d68143809ef43ace5d4", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/fb653eac73493a95ecf40d68143809ef43ace5d4", "committedDate": "2020-10-22T21:13:03Z", "message": "Verify mocks in unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f9d423538a5c317d4160440185ae999607ba088", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/0f9d423538a5c317d4160440185ae999607ba088", "committedDate": "2020-10-22T21:17:05Z", "message": "Use singleton map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4618f96f3c1a74697175980cd4299f51ccf3e9b2", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/4618f96f3c1a74697175980cd4299f51ccf3e9b2", "committedDate": "2020-10-22T21:24:05Z", "message": "Replace all times(1) with once()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MjA0Njgz", "url": "https://github.com/linkedin/cruise-control/pull/1357#pullrequestreview-515204683", "createdAt": "2020-10-23T00:23:25Z", "commit": {"oid": "4618f96f3c1a74697175980cd4299f51ccf3e9b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 82, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}