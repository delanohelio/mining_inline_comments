{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTA1OTE4", "number": 1186, "title": "Further filter detected slow broker against pre-defined flush time threshold.", "bodyText": "Addresses the issue #1185 .", "createdAt": "2020-05-04T18:16:47Z", "url": "https://github.com/linkedin/cruise-control/pull/1186", "merged": true, "mergeCommit": {"oid": "7b76ec93bcffa75d1c022b2a9b1a1b64f5857bf3"}, "closed": true, "closedAt": "2020-05-05T16:35:03Z", "author": {"login": "kidkun"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceDm_lgH2gAyNDEzMTA1OTE4OmVhNDAyNjY5NGZjY2MyYWU0ZGUzZTMyODlmNDE4MDA4OWFhMjRkYzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceOlekgFqTQwNTUzNjIzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea4026694fccc2ae4de3e3289f4180089aa24dc0", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/ea4026694fccc2ae4de3e3289f4180089aa24dc0", "committedDate": "2020-05-04T18:16:07Z", "message": "Further filter detected slow broker against pre-defined flush time threshold."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5215e0d98b6189de5b64879d660be8c3553d0c3", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/e5215e0d98b6189de5b64879d660be8c3553d0c3", "committedDate": "2020-05-04T18:19:37Z", "message": "change threshold to 150ms."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mjg3MDEw", "url": "https://github.com/linkedin/cruise-control/pull/1186#pullrequestreview-405287010", "createdAt": "2020-05-04T19:35:42Z", "commit": {"oid": "e5215e0d98b6189de5b64879d660be8c3553d0c3"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTozNTo0M1rOGQPJ6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTo0NTowMVrOGQPeww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY3ODY5OQ==", "bodyText": "Can we avoid passing private variable _logFlushTimeThresholdMs to non-static function detectMetricAnomaliesFromThreshold and update the name of the function to indicate its custom role regarding log flush time?\nActually it is a little confusing that we have another function in this class called getMetricAnomalies, which is also used for detecting metric anomalies -- can we merge/rename them to make the logic more clear?", "url": "https://github.com/linkedin/cruise-control/pull/1186#discussion_r419678699", "createdAt": "2020-05-04T19:35:43Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/detector/SlowBrokerFinder.java", "diffHunk": "@@ -174,6 +184,7 @@ public SlowBrokerFinder() {\n     }\n \n     Set<BrokerEntity> detectMetricAnomalies = getMetricAnomalies(historicalLogFlushTimeMetricValues, currentLogFlushTimeMetricValues);\n+    detectMetricAnomalies.retainAll(detectMetricAnomaliesFromThreshold(currentLogFlushTimeMetricValues, _logFlushTimeThresholdMs));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5215e0d98b6189de5b64879d660be8c3553d0c3"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY3OTIyMg==", "bodyText": "Nit: detectMetricAnomalies -> detectedMetricAnomalies?", "url": "https://github.com/linkedin/cruise-control/pull/1186#discussion_r419679222", "createdAt": "2020-05-04T19:36:36Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/detector/SlowBrokerFinder.java", "diffHunk": "@@ -174,6 +184,7 @@ public SlowBrokerFinder() {\n     }\n \n     Set<BrokerEntity> detectMetricAnomalies = getMetricAnomalies(historicalLogFlushTimeMetricValues, currentLogFlushTimeMetricValues);\n+    detectMetricAnomalies.retainAll(detectMetricAnomaliesFromThreshold(currentLogFlushTimeMetricValues, _logFlushTimeThresholdMs));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5215e0d98b6189de5b64879d660be8c3553d0c3"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MTkyNw==", "bodyText": "The loop uses only the key, but iterates over entities. Can we either iterate over keySet() or update the logic to use getValue(), as well?", "url": "https://github.com/linkedin/cruise-control/pull/1186#discussion_r419681927", "createdAt": "2020-05-04T19:41:18Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/detector/SlowBrokerFinder.java", "diffHunk": "@@ -286,6 +297,16 @@ private void detectMetricAnomaliesFromPeers(Map<BrokerEntity, Double> currentVal\n     }\n   }\n \n+  private Set<BrokerEntity> detectMetricAnomaliesFromThreshold(Map<BrokerEntity, Double> currentValue, double threshold) {\n+    Set<BrokerEntity> detectedMetricAnomalies = new HashSet<>();\n+    for (Map.Entry<BrokerEntity, Double> entry : currentValue.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5215e0d98b6189de5b64879d660be8c3553d0c3"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4Mjk3Mw==", "bodyText": "This function (i.e. configure) is full of repeated code fragments. Can we use util functions to eliminate code repetition and be more concise?", "url": "https://github.com/linkedin/cruise-control/pull/1186#discussion_r419682973", "createdAt": "2020-05-04T19:43:01Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/detector/SlowBrokerFinder.java", "diffHunk": "@@ -416,6 +437,21 @@ public void configure(Map<String, ?> configs) {\n       }\n     }\n \n+    String logFlushTimeThresholdMs = (String) originalConfig.get(SLOW_BROKER_LOG_FLUSH_TIME_THRESHOLD_MS_CONFIG);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5215e0d98b6189de5b64879d660be8c3553d0c3"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4NDAzNQ==", "bodyText": "Nit: Enumerating functions does not give much information about the difference between testNoFalsePositiveDetection() and testNoFalsePositiveDetection2(). Can we rename them with a suffix that describes what each function are?", "url": "https://github.com/linkedin/cruise-control/pull/1186#discussion_r419684035", "createdAt": "2020-05-04T19:45:01Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/detector/SlowBrokerFinderTest.java", "diffHunk": "@@ -161,6 +161,36 @@ public void testNoFalsePositiveDetection() {\n     assertTrue(anomalies.isEmpty());\n   }\n \n+  /**\n+   * Test slow broker finder does not report false positive anomaly when the broker's absolute log flush time is small.\n+   */\n+  @Test\n+  public void testNoFalsePositiveDetection2() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5215e0d98b6189de5b64879d660be8c3553d0c3"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb435d115c1f366301c4d9d1ff56b0e654c96ba0", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/eb435d115c1f366301c4d9d1ff56b0e654c96ba0", "committedDate": "2020-05-04T21:32:31Z", "message": "Address the feedback."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bacfdfec0e9da87479fcf90628bd89629aeda25a", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/bacfdfec0e9da87479fcf90628bd89629aeda25a", "committedDate": "2020-05-04T21:36:18Z", "message": "Fix build failure."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTM2MjMw", "url": "https://github.com/linkedin/cruise-control/pull/1186#pullrequestreview-405536230", "createdAt": "2020-05-05T07:03:25Z", "commit": {"oid": "bacfdfec0e9da87479fcf90628bd89629aeda25a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 217, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}