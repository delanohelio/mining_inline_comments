{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwOTg1NzQw", "number": 1184, "title": "Fix 1183 chained replica movement strategies", "bodyText": "Addresses the issue #1183, #1126\n\nChange test case to re-produce the IllegalStateException in #1183.\nCopy commits made from liftoffio#1 and bring into master branch\nForce chaining with BaseReplicaMovementStrategy when strategy changes dynamically", "createdAt": "2020-04-29T22:24:37Z", "url": "https://github.com/linkedin/cruise-control/pull/1184", "merged": true, "mergeCommit": {"oid": "30f89251a54317fe723edcfb06450ffae65d97e4"}, "closed": true, "closedAt": "2020-05-13T00:34:39Z", "author": {"login": "matthinograb"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccdd6igH2gAyNDEwOTg1NzQwOjNhZDY3MTQ1Y2I3NzJkMTk3YmM0N2Q2Yjc0NzRmNTkxZDllMTg2NWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgtzY3gFqTQxMDUxMTcxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ad67145cb772d197bc47d6b7474f591d9e1865b", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/3ad67145cb772d197bc47d6b7474f591d9e1865b", "committedDate": "2020-04-29T19:15:53Z", "message": "Update test to reproduce exception - multiple partitions with same size cause failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "272ea8831e0cf5c33bdc129a59f0e07d2150bfb9", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/272ea8831e0cf5c33bdc129a59f0e07d2150bfb9", "committedDate": "2020-04-29T22:04:02Z", "message": "Chain taskComparator's properly when using custom replica movement strategies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e95545b7fb3117f140ac12a8e24e9acd3323568", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/0e95545b7fb3117f140ac12a8e24e9acd3323568", "committedDate": "2020-04-29T22:20:48Z", "message": "Allow different source brokers for same destination brokers and skip getting more replica movements if one is in progress"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDg4NTk1", "url": "https://github.com/linkedin/cruise-control/pull/1184#pullrequestreview-403088595", "createdAt": "2020-04-29T22:37:09Z", "commit": {"oid": "0e95545b7fb3117f140ac12a8e24e9acd3323568"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjozNzowOVrOGOThIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjozNzowOVrOGOThIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1MzAyNw==", "bodyText": "Note: We didn't need to change the PrioritizeLargeReplicaRebalance strategy tests after making this change, because of: #1183 (comment).", "url": "https://github.com/linkedin/cruise-control/pull/1184#discussion_r417653027", "createdAt": "2020-04-29T22:37:09Z", "author": {"login": "matthinograb"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/executor/ExecutionTaskPlannerTest.java", "diffHunk": "@@ -62,7 +62,7 @@\n       new ExecutionProposal(new TopicPartition(TOPIC1, 3), 0, _r3, Arrays.asList(_r3, _r2), Arrays.asList(_r2, _r3));\n \n   private final ExecutionProposal _partitionMovement1 =\n-      new ExecutionProposal(new TopicPartition(TOPIC2, 0), 4, _r0, Arrays.asList(_r0, _r2), Arrays.asList(_r2, _r1));\n+      new ExecutionProposal(new TopicPartition(TOPIC2, 0), 1, _r0, Arrays.asList(_r0, _r2), Arrays.asList(_r2, _r1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e95545b7fb3117f140ac12a8e24e9acd3323568"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0Mzc4NTE3", "url": "https://github.com/linkedin/cruise-control/pull/1184#pullrequestreview-404378517", "createdAt": "2020-05-01T20:17:42Z", "commit": {"oid": "0e95545b7fb3117f140ac12a8e24e9acd3323568"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMDoxNzo0M1rOGPUmyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMDoxNzo0M1rOGPUmyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxOTQzNQ==", "bodyText": "Would this alliviate the issue described in #1167 (comment) ? @efeg can you please comment?", "url": "https://github.com/linkedin/cruise-control/pull/1184#discussion_r418719435", "createdAt": "2020-05-01T20:17:43Z", "author": {"login": "amuraru"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/executor/ExecutionTaskPlanner.java", "diffHunk": "@@ -315,6 +317,13 @@ private void maybeAddLeaderChangeTasks(Collection<ExecutionProposal> proposals,\n                                                                 Set<TopicPartition> inProgressPartitions) {\n     LOG.trace(\"Getting inter-broker replica movement tasks for brokers with concurrency {}\", readyBrokers);\n     List<ExecutionTask> executableReplicaMovements = new ArrayList<>();\n+\n+    // Kafka doesn't allow new replica movements if there is an ongoing rebalance\n+    if (!inProgressPartitions.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e95545b7fb3117f140ac12a8e24e9acd3323568"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11f3c8379704e324a7199b6ae809f3b31a07e618", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/11f3c8379704e324a7199b6ae809f3b31a07e618", "committedDate": "2020-05-12T04:17:02Z", "message": "Remove unecessary inProgressPartition check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbb105c66800d9322ef16647acc1c94d38063d4f", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/cbb105c66800d9322ef16647acc1c94d38063d4f", "committedDate": "2020-05-12T04:19:21Z", "message": "Remove unrelated change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTExNzE3", "url": "https://github.com/linkedin/cruise-control/pull/1184#pullrequestreview-410511717", "createdAt": "2020-05-13T00:33:31Z", "commit": {"oid": "cbb105c66800d9322ef16647acc1c94d38063d4f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 214, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}