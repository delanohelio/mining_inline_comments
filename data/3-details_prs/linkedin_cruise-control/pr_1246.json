{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3Nzg3MzYz", "number": 1246, "title": "modify how to get kafka port", "bodyText": "The port of kafka may not be 9092 and should be determined according to the user's configuration.", "createdAt": "2020-06-22T08:54:12Z", "url": "https://github.com/linkedin/cruise-control/pull/1246", "merged": true, "mergeCommit": {"oid": "31a3cedf8c5951aedc4942a41ae1e82770837198"}, "closed": true, "closedAt": "2020-12-02T22:05:18Z", "author": {"login": "sasukerui"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcttrutABqjM0Njc1MDc3NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiV71GgFqTU0MzI3NTUxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3482212bfdd15b8b2f606a5c0fad36d12bfde651", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/3482212bfdd15b8b2f606a5c0fad36d12bfde651", "committedDate": "2020-06-22T08:50:12Z", "message": "modify how to get kafka port"}, "afterCommit": {"oid": "7b94c5257e62db996adede2f9a03451163e2a7de", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/7b94c5257e62db996adede2f9a03451163e2a7de", "committedDate": "2020-06-22T09:45:08Z", "message": "Change the way to get kafka port"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b94c5257e62db996adede2f9a03451163e2a7de", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/7b94c5257e62db996adede2f9a03451163e2a7de", "committedDate": "2020-06-22T09:45:08Z", "message": "Change the way to get kafka port"}, "afterCommit": {"oid": "18decdf12a34e0b0d3f00d475fb718ac8f3127f1", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/18decdf12a34e0b0d3f00d475fb718ac8f3127f1", "committedDate": "2020-06-22T11:12:43Z", "message": "Change the way to get kafka port"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18decdf12a34e0b0d3f00d475fb718ac8f3127f1", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/18decdf12a34e0b0d3f00d475fb718ac8f3127f1", "committedDate": "2020-06-22T11:12:43Z", "message": "Change the way to get kafka port"}, "afterCommit": {"oid": "b2cdda341b096a022a31a741a8b43a7f84749e73", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/b2cdda341b096a022a31a741a8b43a7f84749e73", "committedDate": "2020-06-22T11:21:52Z", "message": "Change the way to get kafka port"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDY1MTIw", "url": "https://github.com/linkedin/cruise-control/pull/1246#pullrequestreview-440465120", "createdAt": "2020-07-01T00:07:20Z", "commit": {"oid": "b2cdda341b096a022a31a741a8b43a7f84749e73"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMDowNzoyMFrOGrShCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMDoxNTo1NlrOGrSqbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA0NTMyMA==", "bodyText": "To ensure backwards compatibility and robustness, can we ensure that\n\nif configs.get(\"port\") is not null, use this as port\notherwise if configs.get(\"listeners\") is not null and it has a non-empty port, use that as port\notherwise use the default hostname and port -- i.e. localhost and 9092.\n\nAlso can we move the parsing of port to a small function with this priority of retrieval documented?", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r448045320", "createdAt": "2020-07-01T00:07:20Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,8 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = listeners == null ? \"localhost:9092\" : listeners.substring(listeners.lastIndexOf(\"/\") + 1, listeners.length());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2cdda341b096a022a31a741a8b43a7f84749e73"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA0NzUwMw==", "bodyText": "Note that listeners config can be specified without a host -- such as SSL://:9091 (see https://kafka.apache.org/documentation/#listeners). However, providing an empty hostname in bootstrap.servers config will cause an exception.\nShould we limit this parsing to retrieval of port?", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r448047503", "createdAt": "2020-07-01T00:15:08Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,8 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = listeners == null ? \"localhost:9092\" : listeners.substring(listeners.lastIndexOf(\"/\") + 1, listeners.length());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2cdda341b096a022a31a741a8b43a7f84749e73"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA0NzcyNg==", "bodyText": "Nit: (not introduced in this patch) Can we move the hardcoded values (e.g. localhost, 9092) to static variables?", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r448047726", "createdAt": "2020-07-01T00:15:56Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,8 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = listeners == null ? \"localhost:9092\" : listeners.substring(listeners.lastIndexOf(\"/\") + 1, listeners.length());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2cdda341b096a022a31a741a8b43a7f84749e73"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTA1NTE4", "url": "https://github.com/linkedin/cruise-control/pull/1246#pullrequestreview-442105518", "createdAt": "2020-07-03T02:01:45Z", "commit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMjowMTo0NVrOGshkZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMjoxNzo1MlrOGshxTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MDUxOA==", "bodyText": "Thanks for the update!\n#1246 (comment) from the first round of review seems not addressed. This patch drops parsing the value of port. However, existing users might depend on value retrieval via port config.\n\nCan we make sure that the behavior is the same as before if port config exists?\nCan we move this parsing logic to a small function with this priority of retrieval documented?\n\n-- please let me know if you have any questions.", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449340518", "createdAt": "2020-07-03T02:01:45Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {\n+          bootstrapServers = \"0.0.0.0:\" + allListeners[2];\n+        } else {\n+          bootstrapServers = allListeners[1].substring(2, allListeners[1].length()) + \":\" + allListeners[2];\n+        }\n+      } else {\n+        bootstrapServers = \"localhost:9092\";\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MTQ3OA==", "bodyText": "#1246 (comment) does not seem to be addressed.\nCan we avoid using hardcoded values such as \"listeners\" or \"0.0.0.0:\"?\n\nFor config names, we can use the original source of the config names, such as (1) KafkaConfig.ListenersProp() and (2) KafkaConfig.PortProp().\nFor default values, we can use static variables -- e.g.\n\n  protected static final String DEFAULT_BOOTSTRAP_SERVERS_PORT = \"9092\";\n  protected static final String DEFAULT_BOOTSTRAP_SERVERS_HOST = \"localhost\";", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449341478", "createdAt": "2020-07-03T02:06:35Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {\n+          bootstrapServers = \"0.0.0.0:\" + allListeners[2];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MjczNQ==", "bodyText": "What is the expected structure if allListeners[1].length() == 2 is true (and what is expected when it is false)?", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449342735", "createdAt": "2020-07-03T02:12:44Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0Mjg5MQ==", "bodyText": "Why do we switch to 0.0.0.0 from localhost?", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449342891", "createdAt": "2020-07-03T02:13:34Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -113,8 +113,19 @@ public void configure(Map<String, ?> configs) {\n \n     //Add BootstrapServers if not set\n     if (!producerProps.containsKey(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG)) {\n-      Object port = configs.get(\"port\");\n-      String bootstrapServers = \"localhost:\" + (port == null ? \"9092\" : String.valueOf(port));\n+      String listeners = configs.get(\"listeners\") == null ? null : String.valueOf(configs.get(\"listeners\"));\n+      String bootstrapServers = null;\n+      if (listeners != null && listeners.length() != 0) {\n+        String firstListener = listeners.split(\"\\\\s*,\\\\s*\")[0];\n+        String[] allListeners = firstListener.split(\":\");\n+        if (allListeners[1].length() == 2) {\n+          bootstrapServers = \"0.0.0.0:\" + allListeners[2];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MzE2Nw==", "bodyText": "Can we refer to KafkaConfig.ListenersProp() instead of hardcoding \"listeners\"?", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449343167", "createdAt": "2020-07-03T02:14:53Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/test/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporterTest.java", "diffHunk": "@@ -202,4 +202,15 @@ public void testUpdatingMetricsTopicConfig() throws ExecutionException, Interrup\n     topicDescription = adminClient.describeTopics(Collections.singleton(TOPIC)).values().get(TOPIC).get();\n     assertEquals(2, topicDescription.partitions().size());\n   }\n+  @Test\n+  public void testGetKafkaBootstrapServersConfigure() throws ExecutionException, InterruptedException {\n+    String bootstrapServers = \"\";\n+    for (Map<Object, Object> brokerConfig : buildBrokerConfigs()) {\n+      if (brokerConfig.containsKey(\"listeners\")) {\n+         String listeners = String.valueOf(brokerConfig.get(\"listeners\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0MzgyMQ==", "bodyText": "Should we update this test to handle cases described on #1246 (comment)?", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r449343821", "createdAt": "2020-07-03T02:17:52Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/test/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporterTest.java", "diffHunk": "@@ -202,4 +202,15 @@ public void testUpdatingMetricsTopicConfig() throws ExecutionException, Interrup\n     topicDescription = adminClient.describeTopics(Collections.singleton(TOPIC)).values().get(TOPIC).get();\n     assertEquals(2, topicDescription.partitions().size());\n   }\n+  @Test\n+  public void testGetKafkaBootstrapServersConfigure() throws ExecutionException, InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb06c2e661e25f337b9cb86c3b8e979caff395fa", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/eb06c2e661e25f337b9cb86c3b8e979caff395fa", "committedDate": "2020-07-02T08:50:04Z", "message": "modify get kafka port existing problems"}, "afterCommit": {"oid": "1c37ef8b395a29122a79292c096dffa3708055f8", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/1c37ef8b395a29122a79292c096dffa3708055f8", "committedDate": "2020-07-09T01:28:46Z", "message": "Change the way to get kafka port"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c37ef8b395a29122a79292c096dffa3708055f8", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/1c37ef8b395a29122a79292c096dffa3708055f8", "committedDate": "2020-07-09T01:28:46Z", "message": "Change the way to get kafka port"}, "afterCommit": {"oid": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "committedDate": "2020-07-10T06:24:34Z", "message": "modify how to get kafka port"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTc4NjMw", "url": "https://github.com/linkedin/cruise-control/pull/1246#pullrequestreview-449178630", "createdAt": "2020-07-15T17:28:31Z", "commit": {"oid": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyODozMVrOGyIJQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzo1MjoxMVrOGyJRtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTQyNA==", "bodyText": ": should not be part of DEFAULT_BOOTSTRAP_SERVERS_HOST.", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r455215424", "createdAt": "2020-07-15T17:28:31Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -73,6 +73,7 @@\n   private int _metricsTopicAutoCreateRetries;\n   protected static final String CRUISE_CONTROL_METRICS_TOPIC_CLEAN_UP_POLICY = \"delete\";\n   protected static final Duration PRODUCER_CLOSE_TIMEOUT = Duration.ofSeconds(5);\n+  protected static final String DEFAULT_BOOTSTRAP_SERVERS_HOST = \"localhost:\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIzMzk3Mw==", "bodyText": "This change(1) breaks backwards compatibility and (2) uses null as port if neither port nor listeners configs are specified.\nBreaks backwards compatibility:\nIn this new logic, if a user has both listeners and port configs specified, then the port config will be ignored now -- which was not the case in the existing logic.\nPlease ensure that\n\nif configs.get(KafkaConfig.PortProp()) is not null, use this as port (this is regardless of whether listeners has been specified in configs or not)\notherwise if configs.get(\"listeners\") is not null and it has a non-empty port, use that as port\notherwise use the default hostname and port -- i.e. localhost and 9092.\n\nPlease see #1246 (comment).\nMay assign null as the port\nIf neither port nor listeners configs are specified, then bootstrapServers will be localhost:null.", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r455233973", "createdAt": "2020-07-15T17:52:11Z", "author": {"login": "efeg"}, "path": "cruise-control-metrics-reporter/src/main/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporter.java", "diffHunk": "@@ -107,14 +108,29 @@ public void close() {\n     }\n   }\n \n+  static String getBootstrapServers(Map<String, ?> configs) {\n+    String listeners = String.valueOf(configs.get(KafkaConfig.ListenersProp()));\n+    if (listeners != null && listeners.length() != 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b363d125539a67bb7ef01409518b76e865f140cd", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/b363d125539a67bb7ef01409518b76e865f140cd", "committedDate": "2020-11-25T01:03:26Z", "message": "Modify how to get kafka port"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "068336947fbbf3986de8f9c780acd634d99863aa", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/068336947fbbf3986de8f9c780acd634d99863aa", "committedDate": "2020-11-25T03:46:19Z", "message": "Address the feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/fca09add7f10eec20c44ebcfe2c1c3a92d7b91e6", "committedDate": "2020-07-10T06:24:34Z", "message": "modify how to get kafka port"}, "afterCommit": {"oid": "068336947fbbf3986de8f9c780acd634d99863aa", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/068336947fbbf3986de8f9c780acd634d99863aa", "committedDate": "2020-11-25T03:46:19Z", "message": "Address the feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMjY3Nzc2", "url": "https://github.com/linkedin/cruise-control/pull/1246#pullrequestreview-543267776", "createdAt": "2020-12-02T21:53:02Z", "commit": {"oid": "068336947fbbf3986de8f9c780acd634d99863aa"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTo1MzowMlrOH9vq2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTo1MzowMlrOH9vq2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUwNjIwMA==", "bodyText": "Nit: how about renaming this variable as urlParsePattern. compile seems to be too vague to me", "url": "https://github.com/linkedin/cruise-control/pull/1246#discussion_r534506200", "createdAt": "2020-12-02T21:53:02Z", "author": {"login": "Lincong"}, "path": "cruise-control-metrics-reporter/src/test/java/com/linkedin/kafka/cruisecontrol/metricsreporter/CruiseControlMetricsReporterTest.java", "diffHunk": "@@ -202,4 +205,33 @@ public void testUpdatingMetricsTopicConfig() throws ExecutionException, Interrup\n     topicDescription = adminClient.describeTopics(Collections.singleton(TOPIC)).values().get(TOPIC).get();\n     assertEquals(2, topicDescription.partitions().size());\n   }\n+\n+  @Test\n+  public void testGetKafkaBootstrapServersConfigure() {\n+    // Test with a \"listeners\" config with a host\n+    Map<Object, Object> brokerConfig = buildBrokerConfigs().get(0);\n+    Map<String, Object> listenersMap = Collections.singletonMap(KafkaConfig.ListenersProp(), brokerConfig.get(KafkaConfig.ListenersProp()));\n+    String bootstrapServers = CruiseControlMetricsReporter.getBootstrapServers(listenersMap);\n+    String urlParse = \"\\\\[?([0-9a-zA-Z\\\\-%._:]*)]?:(-?[0-9]+)\";\n+    Pattern compile = Pattern.compile(urlParse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "068336947fbbf3986de8f9c780acd634d99863aa"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04e7456d687214d44cf1a01af46c3b570c2e3eba", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/04e7456d687214d44cf1a01af46c3b570c2e3eba", "committedDate": "2020-12-02T21:58:13Z", "message": "Address the feedback."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMjc1NTEw", "url": "https://github.com/linkedin/cruise-control/pull/1246#pullrequestreview-543275510", "createdAt": "2020-12-02T22:04:01Z", "commit": {"oid": "04e7456d687214d44cf1a01af46c3b570c2e3eba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 259, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}