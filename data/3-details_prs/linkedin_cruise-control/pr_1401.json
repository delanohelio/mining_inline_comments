{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MTc0OTM0", "number": 1401, "title": "Honor webserver.api.urlprefix config", "bodyText": "This PR resolves #1336 .", "createdAt": "2020-11-24T05:03:06Z", "url": "https://github.com/linkedin/cruise-control/pull/1401", "merged": true, "mergeCommit": {"oid": "526bf88ebf6c9d7b023ecc6fd50e1090d2d02bbb"}, "closed": true, "closedAt": "2020-12-03T20:55:24Z", "author": {"login": "Lincong"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfyzQ0AFqTUzODA0NzYyMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdipdMFgH2gAyNTI2MTc0OTM0Ojg2NDg0NGFlODNmNTAwZTRjMmQyZWRkMThiNjE2NTBmNDExNjQ0N2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MDQ3NjIz", "url": "https://github.com/linkedin/cruise-control/pull/1401#pullrequestreview-538047623", "createdAt": "2020-11-24T23:27:04Z", "commit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMzoyNzowNVrOH5cuZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMzo1MToyOVrOH5dw6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAwMTUxMA==", "bodyText": "Can we avoid wildcard imports?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530001510", "createdAt": "2020-11-24T23:27:05Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/SessionManager.java", "diffHunk": "@@ -30,6 +30,8 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import static com.linkedin.kafka.cruisecontrol.servlet.KafkaCruiseControlServletUtils.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAwMTc4NQ==", "bodyText": "If this PR honors configurable request URI, can we drop this hardcoded value?\n\n  \n    \n      cruise-control/cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletUtils.java\n    \n    \n        Lines 38 to 39\n      in\n      5ed774e\n    \n    \n    \n    \n\n        \n          \n           // FIXME: Read this from a configuration \n        \n\n        \n          \n           public static final String REQUEST_URI = \"/KAFKACRUISECONTROL/\";", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530001785", "createdAt": "2020-11-24T23:27:24Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletUtils.java", "diffHunk": "@@ -193,7 +193,7 @@ static String urlEncode(String s) throws UnsupportedEncodingException {\n    */\n   static CruiseControlEndPoint getValidEndpoint(HttpServletRequest request, HttpServletResponse response, KafkaCruiseControlConfig config)\n       throws IOException {\n-    CruiseControlEndPoint endPoint = endPoint(request);\n+    CruiseControlEndPoint endPoint = endPoint(request, config.getString(WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG));\n     if (endPoint == null) {\n       String method = request.getMethod();\n       String errorMessage = String.format(\"Unrecognized endpoint in request '%s'%nSupported %s endpoints: %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAwOTM1OA==", "bodyText": "According to the Java Servlet specification, the config WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG must end with /* suffix.\n\nThe following comment seems incomplete:\n\n\n  \n    \n      cruise-control/config/cruisecontrol.properties\n    \n    \n        Lines 325 to 327\n      in\n      5ed774e\n    \n    \n    \n    \n\n        \n          \n           # REST API default prefix \n        \n\n        \n          \n           # (dont forget the ending *) \n        \n\n        \n          \n           webserver.api.urlprefix=/kafkacruisecontrol/* \n        \n    \n  \n\n\nCan we update it to say:\n# REST API default prefix (dont forget the ending /*)\n\n\nWe don't have any sanity check to enforce this suffix upon configuration time. Can we add a sanity check for WEBSERVER_API_URLPREFIX_CONFIG under KafkaCruiseControlConfig?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530009358", "createdAt": "2020-11-24T23:35:22Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletUtils.java", "diffHunk": "@@ -193,7 +193,7 @@ static String urlEncode(String s) throws UnsupportedEncodingException {\n    */\n   static CruiseControlEndPoint getValidEndpoint(HttpServletRequest request, HttpServletResponse response, KafkaCruiseControlConfig config)\n       throws IOException {\n-    CruiseControlEndPoint endPoint = endPoint(request);\n+    CruiseControlEndPoint endPoint = endPoint(request, config.getString(WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG));\n     if (endPoint == null) {\n       String method = request.getMethod();\n       String errorMessage = String.format(\"Unrecognized endpoint in request '%s'%nSupported %s endpoints: %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxMjM4Ng==", "bodyText": "apiUrlPrefix must end with /* -- i.e. failure of this condition must result in a configuration time failure.\nHence, this if check is redundant.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530012386", "createdAt": "2020-11-24T23:38:35Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -177,7 +177,11 @@ public static CruiseControlEndPoint endPoint(HttpServletRequest request) {\n         throw new UserRequestException(\"Unsupported request method: \" + request.getMethod() + \".\");\n     }\n \n-    String path = request.getRequestURI().toUpperCase().replace(REQUEST_URI, \"\");\n+    if (apiUrlPrefix.endsWith(\"/*\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxNjI3NQ==", "bodyText": "Do we have to do this pruning and upper case conversion for apiUrlPrefix for every single request that hits a CC endpoint?\napiUrlPrefix is already known at configuration time -- i.e. it won't change throughout the lifetime of this CC instance. So can't we initialize this static util class with the well-formatted REQUEST_URI (which is constructed by pruning and upper case conversion of WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG once) and use that here as before?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530016275", "createdAt": "2020-11-24T23:44:49Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -177,7 +177,11 @@ public static CruiseControlEndPoint endPoint(HttpServletRequest request) {\n         throw new UserRequestException(\"Unsupported request method: \" + request.getMethod() + \".\");\n     }\n \n-    String path = request.getRequestURI().toUpperCase().replace(REQUEST_URI, \"\");\n+    if (apiUrlPrefix.endsWith(\"/*\")) {\n+      // Ignore the last character '*'\n+      apiUrlPrefix = apiUrlPrefix.substring(0, apiUrlPrefix.length() - 1);\n+    }\n+    String path = request.getRequestURI().toUpperCase().replace(apiUrlPrefix.toUpperCase(), \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxNjk1OA==", "bodyText": "Passing config.getString(WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG) to endpoint seems redundant (please see my comment on ParameterUtils#endPoint )", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530016958", "createdAt": "2020-11-24T23:46:44Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletUtils.java", "diffHunk": "@@ -193,7 +193,7 @@ static String urlEncode(String s) throws UnsupportedEncodingException {\n    */\n   static CruiseControlEndPoint getValidEndpoint(HttpServletRequest request, HttpServletResponse response, KafkaCruiseControlConfig config)\n       throws IOException {\n-    CruiseControlEndPoint endPoint = endPoint(request);\n+    CruiseControlEndPoint endPoint = endPoint(request, config.getString(WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxODUzNg==", "bodyText": "REQUEST_URI is a malformed _apiUrlPrefix -- i.e. it does not end with * -- hence, it shall not be used interchangeably here.\nWith the proposed change in ParameterUtils (please see earlier comment), we can drop these changes.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530018536", "createdAt": "2020-11-24T23:51:29Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManager.java", "diffHunk": "@@ -136,6 +138,7 @@ protected boolean removeEldestEntry(Map.Entry<UUID, UserTaskInfo> eldest) {\n     }\n     _sessionExpiryMs = sessionExpiryMs;\n     _maxActiveUserTasks = maxActiveUserTasks;\n+    _apiUrlPrefix = KafkaCruiseControlServletUtils.REQUEST_URI;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22bba336d1fed726f402e881ae976de1b5dbcacc", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/22bba336d1fed726f402e881ae976de1b5dbcacc", "committedDate": "2020-11-24T05:01:14Z", "message": "Make the endpoint parsing method parse endpoint using a given API URL prefix string"}, "afterCommit": {"oid": "26edfc01890b825a2dfef1fa38aa32f4697d1b41", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/26edfc01890b825a2dfef1fa38aa32f4697d1b41", "committedDate": "2020-11-25T04:17:29Z", "message": "Fix some issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26edfc01890b825a2dfef1fa38aa32f4697d1b41", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/26edfc01890b825a2dfef1fa38aa32f4697d1b41", "committedDate": "2020-11-25T04:17:29Z", "message": "Fix some issues"}, "afterCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/14ade8d35919d7b5a86c03aff54c4ce4533332a2", "committedDate": "2020-11-26T00:09:42Z", "message": "Fix some issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTIxMzM4", "url": "https://github.com/linkedin/cruise-control/pull/1401#pullrequestreview-538921338", "createdAt": "2020-11-26T00:34:27Z", "commit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMDozNDoyOFrOH6H3Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQwMDo1OTowOFrOH6IQ6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcwODMwMg==", "bodyText": "Nit: We are using the expectedUrlPrefixEnd to check both webserverApiUrlPrefix and webserverUiUrlPrefix. Should we name it to something that applies to both? -- e.g. expectedSuffix", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530708302", "createdAt": "2020-11-26T00:34:28Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/config/KafkaCruiseControlConfig.java", "diffHunk": "@@ -464,6 +464,25 @@ void sanityCheckSecurity() { // visible for testing\n     }\n   }\n \n+  /**\n+   * Sanity check to ensure that webserver URL prefix is set up correctly. This means the following:\n+   *  <code>webserver.api.urlprefix</code> and <code>webserver.ui.urlprefix</code> must end with \"/*\"\n+   */\n+  void sanityCheckWebServerUrlPrefix() { // visible for testing\n+    String expectedUrlPrefixEnd = \"/*\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcwOTEzMA==", "bodyText": "Looks like we use this function only in tests. Should we move it to a relevant test utility class?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530709130", "createdAt": "2020-11-26T00:37:23Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletUtils.java", "diffHunk": "@@ -283,4 +281,10 @@ static void ensureHeaderNotPresent(HttpServletRequest request, String headerName\n   public static String httpServletRequestToString(HttpServletRequest request) {\n     return String.format(\"%s %s\", request.getMethod(), request.getRequestURI());\n   }\n+\n+  public static String getDefaultWebServerApiUrlPrefix() {\n+    // Strip off the '*' from the end of the default web server API URL prefix\n+    return WebServerConfig.DEFAULT_WEBSERVER_API_URLPREFIX\n+        .substring(0, WebServerConfig.DEFAULT_WEBSERVER_API_URLPREFIX.length() - 1);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcxMTc5NA==", "bodyText": "Can we avoid wildcard import?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530711794", "createdAt": "2020-11-26T00:48:19Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/config/WebserverUrlPrefixConfigTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.config;\n+\n+import com.linkedin.kafka.cruisecontrol.config.constants.WebServerConfig;\n+import org.apache.kafka.common.config.ConfigException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.ExpectedException;\n+\n+import static org.easymock.EasyMock.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcxMjE0Mg==", "bodyText": "Let's not use the deprecated API any more. We can instead use Assert.assertThrows to check for expected exceptions.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530712142", "createdAt": "2020-11-26T00:49:48Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/config/WebserverUrlPrefixConfigTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.config;\n+\n+import com.linkedin.kafka.cruisecontrol.config.constants.WebServerConfig;\n+import org.apache.kafka.common.config.ConfigException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.ExpectedException;\n+\n+import static org.easymock.EasyMock.*;\n+\n+\n+public class WebserverUrlPrefixConfigTest {\n+\n+  @Rule\n+  public ExpectedException _expectedException = ExpectedException.none();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcxMjYxNQ==", "bodyText": "Can we move all occurrences of the hardcoded \"getString\" to a static final variable?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530712615", "createdAt": "2020-11-26T00:51:36Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/config/WebserverUrlPrefixConfigTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.config;\n+\n+import com.linkedin.kafka.cruisecontrol.config.constants.WebServerConfig;\n+import org.apache.kafka.common.config.ConfigException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.ExpectedException;\n+\n+import static org.easymock.EasyMock.*;\n+\n+\n+public class WebserverUrlPrefixConfigTest {\n+\n+  @Rule\n+  public ExpectedException _expectedException = ExpectedException.none();\n+\n+  @Test\n+  public void testWebserverUrlPrefixConfigsCorrectSetup() {\n+    KafkaCruiseControlConfig config = partialMockBuilder(KafkaCruiseControlConfig.class)\n+        .addMockedMethod(\"getString\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcxMzU1Nw==", "bodyText": "Since we already have testWebserverUrlPrefixConfigsCorrectSetup can we drop this test?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530713557", "createdAt": "2020-11-26T00:54:23Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/config/WebserverUrlPrefixConfigTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+\n+package com.linkedin.kafka.cruisecontrol.config;\n+\n+import com.linkedin.kafka.cruisecontrol.config.constants.WebServerConfig;\n+import org.apache.kafka.common.config.ConfigException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.ExpectedException;\n+\n+import static org.easymock.EasyMock.*;\n+\n+\n+public class WebserverUrlPrefixConfigTest {\n+\n+  @Rule\n+  public ExpectedException _expectedException = ExpectedException.none();\n+\n+  @Test\n+  public void testWebserverUrlPrefixConfigsCorrectSetup() {\n+    KafkaCruiseControlConfig config = partialMockBuilder(KafkaCruiseControlConfig.class)\n+        .addMockedMethod(\"getString\")\n+        .createNiceMock();\n+\n+    expect(config.getString(WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG)).andReturn(\"a/b/c/d/*\");\n+    expect(config.getString(WebServerConfig.WEBSERVER_UI_URLPREFIX_CONFIG)).andReturn(\"a/b/c/*\");\n+    replay(config);\n+    config.sanityCheckWebServerUrlPrefix();\n+    verify(config);\n+  }\n+\n+  @Test\n+  public void testWebserverUrlPrefixConfigCorrectSetupOnDefault() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcxMzY0NQ==", "bodyText": "Can we avoid using wildcard import?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530713645", "createdAt": "2020-11-26T00:54:40Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletEndpointTest.java", "diffHunk": "@@ -34,8 +35,7 @@\n import static com.linkedin.kafka.cruisecontrol.servlet.CruiseControlEndPoint.REBALANCE;\n import static com.linkedin.kafka.cruisecontrol.servlet.CruiseControlEndPoint.REMOVE_BROKER;\n import static com.linkedin.kafka.cruisecontrol.servlet.CruiseControlEndPoint.USER_TASKS;\n-import static com.linkedin.kafka.cruisecontrol.servlet.KafkaCruiseControlServletUtils.GET_METHOD;\n-import static com.linkedin.kafka.cruisecontrol.servlet.KafkaCruiseControlServletUtils.POST_METHOD;\n+import static com.linkedin.kafka.cruisecontrol.servlet.KafkaCruiseControlServletUtils.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcxMzg3Mg==", "bodyText": "Can we avoid wildcard import?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530713872", "createdAt": "2020-11-26T00:55:20Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -14,6 +16,8 @@\n import org.junit.Assert;\n import org.junit.Test;\n \n+import static com.linkedin.kafka.cruisecontrol.servlet.KafkaCruiseControlServletUtils.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcxNDg1Nw==", "bodyText": "Is apiUrlPrefix expected to be the same as apiUrlPrefixParam w/o an * at the end? If so, can we drop apiUrlPrefix from the parameters of this function and infer its value from apiUrlPrefixParam?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r530714857", "createdAt": "2020-11-26T00:59:08Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -136,4 +140,40 @@ public void testParseExecutionProgressCheckIntervalMsWithValue() {\n     EasyMock.verify(mockRequest);\n     Assert.assertEquals(Long.valueOf(EXECUTION_PROGRESS_CHECK_INTERVAL_STRING), executionProgressCheckIntervalMs);\n   }\n+\n+  @Test\n+  public void testGetEndpoint() {\n+    verifyGetEndpoint(\"/a/\", \"/a/*\");\n+    verifyGetEndpoint(\"/kafkacruisecontrol/\", WebServerConfig.DEFAULT_WEBSERVER_API_URLPREFIX);\n+  }\n+\n+  /**\n+   * Verifies that {@link ParameterUtils#endPoint} can parse out all endpoints\n+   *\n+   * @param apiUrlPrefix API URL prefix used to concatenate with \"/endpoint_name\" to mock the URL in a request\n+   * @param apiUrlPrefixParam API URL prefix parameter passed to the {@link ParameterUtils#endPoint}\n+   */\n+  private void verifyGetEndpoint(String apiUrlPrefix, String apiUrlPrefixParam) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14ade8d35919d7b5a86c03aff54c4ce4533332a2"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMTY5MTA2", "url": "https://github.com/linkedin/cruise-control/pull/1401#pullrequestreview-542169106", "createdAt": "2020-12-01T18:12:09Z", "commit": {"oid": "540f22f46f69bde7bc97b77472aa484c68df4055"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxODoxMjoxMFrOH85msw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxODoxMjo1N1rOH85oaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYyMDQwMw==", "bodyText": "Looks like this change modifies and breaks the indentation formatting. Can we avoid such changes?\nImporting the project style file on IntelliJ may help: https://github.com/linkedin/cruise-control/blob/master/docs/code-style.xml", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533620403", "createdAt": "2020-12-01T18:12:10Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/SessionManager.java", "diffHunk": "@@ -51,8 +52,8 @@\n   private final Time _time;\n   private final ScheduledExecutorService _sessionCleaner =\n       Executors.newSingleThreadScheduledExecutor(new KafkaCruiseControlThreadFactory(\"SessionCleaner\",\n-                                                                                     true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540f22f46f69bde7bc97b77472aa484c68df4055"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYyMDg0MQ==", "bodyText": "Bad indentation -- please see the earlier comment.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533620841", "createdAt": "2020-12-01T18:12:57Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/SessionManagerTest.java", "diffHunk": "@@ -36,8 +36,8 @@ public void testCreateAndCloseSession() {\n     SessionManager sessionManager = new SessionManager(1, 1000, context.time(), new MetricRegistry(), null);\n \n     sessionManager.getAndCreateSessionIfNotExist(context.request(0),\n-                                                 () -> new OperationFuture(\"testCreateSession\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540f22f46f69bde7bc97b77472aa484c68df4055"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "540f22f46f69bde7bc97b77472aa484c68df4055", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/540f22f46f69bde7bc97b77472aa484c68df4055", "committedDate": "2020-11-26T04:14:05Z", "message": "Fix PR issues"}, "afterCommit": {"oid": "8ae006f1d8ee2583a7dc0fa116dba5036fcdb411", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/8ae006f1d8ee2583a7dc0fa116dba5036fcdb411", "committedDate": "2020-12-02T02:55:31Z", "message": "Removed redundant unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNDY5MDUy", "url": "https://github.com/linkedin/cruise-control/pull/1401#pullrequestreview-542469052", "createdAt": "2020-12-02T03:20:34Z", "commit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMzoyMDozNFrOH9I1EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMzo0MzoxNVrOH9JPdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg2OTg0MA==", "bodyText": "Was this added intentionally?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533869840", "createdAt": "2020-12-02T03:20:34Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServlet.java", "diffHunk": "@@ -74,6 +74,10 @@ public void destroy() {\n     }\n   }\n \n+  public String apiUrlPrefix() {\n+    return _config.getString(WebServerConfig.WEBSERVER_API_URLPREFIX_CONFIG);\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3Mjc5NQ==", "bodyText": "I am not sure if extending an abstract class like this by SecurityAndSslConfigTest and WebserverUrlPrefixConfigTest is the best approach.\n\nSecurityAndSslConfigTest does not use GET_CLASS_METHOD_NAME anywhere, and\nWebserverUrlPrefixConfigTest does not use GET_BOOLEAN_METHOD_NAME and HASH_CODE_METHOD_NAME anywhere.\n\nInheritance should imply that everything in the abstract class applies to the classes that extend from it. If the goal here is to share common constants across classes, can we move these constants to a utility class within config package?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533872795", "createdAt": "2020-12-02T03:29:22Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/config/AbstractConfigTest.java", "diffHunk": "@@ -0,0 +1,15 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+package com.linkedin.kafka.cruisecontrol.config;\n+\n+abstract class AbstractConfigTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3MzE0Mg==", "bodyText": "There are some missing cases below -- see:\n        .addMockedMethod(\"getBoolean\")\n        .addMockedMethod(\"getClass\")\n        .addMockedMethod(\"hashCode\")", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533873142", "createdAt": "2020-12-02T03:30:27Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/config/SecurityAndSslConfigTest.java", "diffHunk": "@@ -16,17 +16,17 @@\n import static org.easymock.EasyMock.replay;\n import static org.easymock.EasyMock.verify;\n \n-public class SecurityAndSslConfigTest {\n+public class SecurityAndSslConfigTest extends AbstractConfigTest {\n \n   @Rule\n   public ExpectedException _expectedException = ExpectedException.none();\n \n   @Test\n   public void testSslConfigsSetUpThrowsExceptionOnNullKeystoreLocation() {\n     KafkaCruiseControlConfig config = partialMockBuilder(KafkaCruiseControlConfig.class)\n-        .addMockedMethod(\"getBoolean\")\n-        .addMockedMethod(\"getString\")\n-        .addMockedMethod(\"hashCode\")\n+        .addMockedMethod(GET_BOOLEAN_METHOD_NAME)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3NDcwMQ==", "bodyText": "Nit: It is common practice / convention to make utility classes final.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533874701", "createdAt": "2020-12-02T03:36:19Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletTestUtils.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 LinkedIn Corp. Licensed under the BSD 2-Clause License (the \"License\"). See License in the project root for license information.\n+ */\n+package com.linkedin.kafka.cruisecontrol.servlet;\n+\n+import com.linkedin.kafka.cruisecontrol.config.constants.WebServerConfig;\n+\n+\n+public class KafkaCruiseControlServletTestUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3NDg2MQ==", "bodyText": "Nit: times(1) -> once()", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533874861", "createdAt": "2020-12-02T03:36:55Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -136,4 +141,39 @@ public void testParseExecutionProgressCheckIntervalMsWithValue() {\n     EasyMock.verify(mockRequest);\n     Assert.assertEquals(Long.valueOf(EXECUTION_PROGRESS_CHECK_INTERVAL_STRING), executionProgressCheckIntervalMs);\n   }\n+\n+  @Test\n+  public void testGetEndpoint() {\n+    verifyGetEndpoint(\"/a/*\");\n+    verifyGetEndpoint(WebServerConfig.DEFAULT_WEBSERVER_API_URLPREFIX);\n+  }\n+\n+  /**\n+   * Verifies that {@link ParameterUtils#endPoint} can parse out all endpoints\n+   *\n+   * @param apiUrlPrefixParam API URL prefix parameter passed to the {@link ParameterUtils#endPoint}\n+   */\n+  private void verifyGetEndpoint(String apiUrlPrefixParam) {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    String apiUrlPrefix = apiUrlPrefixParam.substring(0, apiUrlPrefixParam.length() - 1);\n+    for (CruiseControlEndPoint getEndPoint : CruiseControlEndPoint.getEndpoints()) {\n+      String mockRequestUri = apiUrlPrefix + getEndPoint;\n+      EasyMock.expect(mockRequest.getMethod()).andReturn(GET_METHOD).times(1);\n+      EasyMock.expect(mockRequest.getRequestURI()).andReturn(mockRequestUri).times(1);\n+      EasyMock.replay(mockRequest);\n+      CruiseControlEndPoint endPoint = ParameterUtils.endPoint(mockRequest, apiUrlPrefixParam);\n+      Assert.assertEquals(getEndPoint, endPoint);\n+      EasyMock.reset(mockRequest);\n+    }\n+\n+    for (CruiseControlEndPoint postEndPoint : CruiseControlEndPoint.postEndpoints()) {\n+      String mockRequestUri = apiUrlPrefix + postEndPoint;\n+      EasyMock.expect(mockRequest.getMethod()).andReturn(POST_METHOD).times(1);\n+      EasyMock.expect(mockRequest.getRequestURI()).andReturn(mockRequestUri).times(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3NTcxMQ==", "bodyText": "I'd recommend dropping the test for the default -- i.e.\nverifyGetEndpoint(WebServerConfig.DEFAULT_WEBSERVER_API_URLPREFIX);\n\nand moving the content of the private function verifyGetEndpoint inside this test function as it is not used anywhere else and contains all the logic of this test.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533875711", "createdAt": "2020-12-02T03:40:02Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -136,4 +141,39 @@ public void testParseExecutionProgressCheckIntervalMsWithValue() {\n     EasyMock.verify(mockRequest);\n     Assert.assertEquals(Long.valueOf(EXECUTION_PROGRESS_CHECK_INTERVAL_STRING), executionProgressCheckIntervalMs);\n   }\n+\n+  @Test\n+  public void testGetEndpoint() {\n+    verifyGetEndpoint(\"/a/*\");\n+    verifyGetEndpoint(WebServerConfig.DEFAULT_WEBSERVER_API_URLPREFIX);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3NjU5Nw==", "bodyText": "Does reset call also verify the mock? -- i.e. if not do we need EasyMock.verify()? (similar use above)", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r533876597", "createdAt": "2020-12-02T03:43:15Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtilsTest.java", "diffHunk": "@@ -136,4 +141,39 @@ public void testParseExecutionProgressCheckIntervalMsWithValue() {\n     EasyMock.verify(mockRequest);\n     Assert.assertEquals(Long.valueOf(EXECUTION_PROGRESS_CHECK_INTERVAL_STRING), executionProgressCheckIntervalMs);\n   }\n+\n+  @Test\n+  public void testGetEndpoint() {\n+    verifyGetEndpoint(\"/a/*\");\n+    verifyGetEndpoint(WebServerConfig.DEFAULT_WEBSERVER_API_URLPREFIX);\n+  }\n+\n+  /**\n+   * Verifies that {@link ParameterUtils#endPoint} can parse out all endpoints\n+   *\n+   * @param apiUrlPrefixParam API URL prefix parameter passed to the {@link ParameterUtils#endPoint}\n+   */\n+  private void verifyGetEndpoint(String apiUrlPrefixParam) {\n+    HttpServletRequest mockRequest = EasyMock.mock(HttpServletRequest.class);\n+    String apiUrlPrefix = apiUrlPrefixParam.substring(0, apiUrlPrefixParam.length() - 1);\n+    for (CruiseControlEndPoint getEndPoint : CruiseControlEndPoint.getEndpoints()) {\n+      String mockRequestUri = apiUrlPrefix + getEndPoint;\n+      EasyMock.expect(mockRequest.getMethod()).andReturn(GET_METHOD).times(1);\n+      EasyMock.expect(mockRequest.getRequestURI()).andReturn(mockRequestUri).times(1);\n+      EasyMock.replay(mockRequest);\n+      CruiseControlEndPoint endPoint = ParameterUtils.endPoint(mockRequest, apiUrlPrefixParam);\n+      Assert.assertEquals(getEndPoint, endPoint);\n+      EasyMock.reset(mockRequest);\n+    }\n+\n+    for (CruiseControlEndPoint postEndPoint : CruiseControlEndPoint.postEndpoints()) {\n+      String mockRequestUri = apiUrlPrefix + postEndPoint;\n+      EasyMock.expect(mockRequest.getMethod()).andReturn(POST_METHOD).times(1);\n+      EasyMock.expect(mockRequest.getRequestURI()).andReturn(mockRequestUri).times(1);\n+      EasyMock.replay(mockRequest);\n+      CruiseControlEndPoint endPoint = ParameterUtils.endPoint(mockRequest, apiUrlPrefixParam);\n+      Assert.assertEquals(postEndPoint, endPoint);\n+      EasyMock.reset(mockRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48038e7c7620b259769a99eb5ad0b09c343edd94"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzNDIwOTcz", "url": "https://github.com/linkedin/cruise-control/pull/1401#pullrequestreview-543420973", "createdAt": "2020-12-03T03:45:49Z", "commit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwMzo0NTo0OVrOH94NIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwNDowNTo0NlrOH94lsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDY0NjA0OQ==", "bodyText": "If the URL does not have any extra path information, request.getPathInfo() can return null. In this case, I believe this method should return null.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r534646049", "createdAt": "2020-12-03T03:45:49Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -177,7 +176,7 @@ public static CruiseControlEndPoint endPoint(HttpServletRequest request) {\n         throw new UserRequestException(\"Unsupported request method: \" + request.getMethod() + \".\");\n     }\n \n-    String path = request.getRequestURI().toUpperCase().replace(REQUEST_URI, \"\");\n+    String path = request.getPathInfo().substring(1); // Skip the first character '/'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDY0NjMwOQ==", "bodyText": "Can we drop the unused apiUrlPrefix?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r534646309", "createdAt": "2020-12-03T03:46:36Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/parameters/ParameterUtils.java", "diffHunk": "@@ -881,7 +880,7 @@ static int partitionBoundary(HttpServletRequest request, boolean isUpperBound) {\n     return Integer.parseInt(boundaries[isUpperBound ? 1 : 0]);\n   }\n \n-  static Set<Integer> brokerIds(HttpServletRequest request, boolean isOptional) throws UnsupportedEncodingException {\n+  static Set<Integer> brokerIds(HttpServletRequest request, String apiUrlPrefix, boolean isOptional) throws UnsupportedEncodingException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDY0NzQ5OQ==", "bodyText": "Nit: Why do we break the line -- i.e. are there any code changes here?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r534647499", "createdAt": "2020-12-03T03:50:17Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletEndpointTest.java", "diffHunk": "@@ -234,7 +234,8 @@ private static UserTasksParameters mockUserTasksParameters(HttpServletRequest an\n     EasyMock.expect(parameters.userTaskIds()).andReturn(ParameterUtils.userTaskIds(answerQueryRequest)).anyTimes();\n     EasyMock.expect(parameters.clientIds()).andReturn(ParameterUtils.clientIds(answerQueryRequest)).anyTimes();\n     EasyMock.expect(parameters.endPoints()).andReturn(ParameterUtils.endPoints(answerQueryRequest)).anyTimes();\n-    EasyMock.expect(parameters.endPoint()).andReturn(ParameterUtils.endPoint(answerQueryRequest)).anyTimes();\n+    EasyMock.expect(parameters.endPoint()).andReturn(ParameterUtils\n+        .endPoint(answerQueryRequest)).anyTimes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDY1MTA0Mw==", "bodyText": "(Not introduced in this patch) Looks like this class has no EasyMock.verify(XXX) calls; hence, it is hard to verify if the expected calls are made as many as required. Should we add verify before appropriate EasyMock.reset() calls? -- e.g. for the first one in testUserTaskParameters\n    EasyMock.verify(answerQueryRequest1, parameters1, _mockUUIDGenerator, _mockHttpSession, _mockHttpServletResponse);", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r534651043", "createdAt": "2020-12-03T04:01:31Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletEndpointTest.java", "diffHunk": "@@ -260,8 +261,10 @@ private HttpServletRequest prepareRequest(HttpSession session, String userTaskId\n     EasyMock.expect(request.getSession()).andReturn(session).anyTimes();\n     EasyMock.expect(request.getSession(false)).andReturn(session).anyTimes();\n     EasyMock.expect(request.getMethod()).andReturn(method).anyTimes();\n-    EasyMock.expect(request.getRequestURI()).andReturn(KafkaCruiseControlServletUtils.REQUEST_URI + resource).anyTimes();\n+    EasyMock.expect(request.getRequestURI())\n+        .andReturn(KafkaCruiseControlServletTestUtils.getDefaultWebServerApiUrlPrefix() + resource).anyTimes();\n     EasyMock.expect(request.getParameterMap()).andReturn(params).anyTimes();\n+    EasyMock.expect(request.getPathInfo()).andReturn(\"/\" + resource).anyTimes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDY1MjMzOA==", "bodyText": "(Not introduced in this PR) Can we add verify for mocks? (please see earlier similar comment)", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r534652338", "createdAt": "2020-12-03T04:05:46Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManagerTest.java", "diffHunk": "@@ -296,6 +296,7 @@ private HttpServletRequest prepareRequest(HttpSession session, String userTaskId\n     EasyMock.expect(request.getSession(false)).andReturn(session).anyTimes();\n     EasyMock.expect(request.getMethod()).andReturn(GET_METHOD).anyTimes();\n     EasyMock.expect(request.getRequestURI()).andReturn(resource).anyTimes();\n+    EasyMock.expect(request.getPathInfo()).andReturn(resource).anyTimes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a939ff9936ced5cc256193ea5286c3adb307cab", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/8a939ff9936ced5cc256193ea5286c3adb307cab", "committedDate": "2020-12-03T04:57:45Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a7b573d1c88b22d0b2c0e3d694b176fc7125b68", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/1a7b573d1c88b22d0b2c0e3d694b176fc7125b68", "committedDate": "2020-12-03T04:57:45Z", "message": "Make the endpoint parsing method parse endpoint using a given API URL prefix string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "311d635339dd9961dbf9adbf85f5293e74e32ba5", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/311d635339dd9961dbf9adbf85f5293e74e32ba5", "committedDate": "2020-12-03T04:57:45Z", "message": "Fix some issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97e76dc8641e43276240e80cb50d333fc2cd8755", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/97e76dc8641e43276240e80cb50d333fc2cd8755", "committedDate": "2020-12-03T04:57:45Z", "message": "Fix PR issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71034c98512391248b2eec29a2b3a5f42d18b692", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/71034c98512391248b2eec29a2b3a5f42d18b692", "committedDate": "2020-12-03T04:57:45Z", "message": "Add a getter on the CC servlet to expose API URL prefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d47729774eb5540c6524768fb682ba131513b29", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/5d47729774eb5540c6524768fb682ba131513b29", "committedDate": "2020-12-03T04:57:45Z", "message": "Removed redundant unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e814f6c1fc9d8d9ffcfe7a7b098ade6710d7707b", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/e814f6c1fc9d8d9ffcfe7a7b098ade6710d7707b", "committedDate": "2020-12-03T04:57:45Z", "message": "Remove session manager and its test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "056797f32248f364011e6f988391b81da391ffee", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/056797f32248f364011e6f988391b81da391ffee", "committedDate": "2020-12-03T04:57:45Z", "message": "Change the endpoint method so that it gets resource information from the request object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f37e15727064de1b5f4ed1925d7743c11a5b200", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/2f37e15727064de1b5f4ed1925d7743c11a5b200", "committedDate": "2020-12-03T04:57:45Z", "message": "Fix issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee819293751b6263b7e7f394ac830fd2bbea7762", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/ee819293751b6263b7e7f394ac830fd2bbea7762", "committedDate": "2020-12-03T17:19:41Z", "message": "Fixed PR issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/5ede61bc8158263994bc7864f10e39dc4919b6be", "committedDate": "2020-12-02T05:34:39Z", "message": "Fix issues"}, "afterCommit": {"oid": "ee819293751b6263b7e7f394ac830fd2bbea7762", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/ee819293751b6263b7e7f394ac830fd2bbea7762", "committedDate": "2020-12-03T17:19:41Z", "message": "Fixed PR issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NDE2NzIz", "url": "https://github.com/linkedin/cruise-control/pull/1401#pullrequestreview-544416723", "createdAt": "2020-12-03T20:40:15Z", "commit": {"oid": "ee819293751b6263b7e7f394ac830fd2bbea7762"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDo0MDoxNVrOH-xgsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDo0MToyOVrOH-xmHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU4NDk0Nw==", "bodyText": "Nit: This line still has the line break even after this issue is marked as resolved.", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r535584947", "createdAt": "2020-12-03T20:40:15Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/KafkaCruiseControlServletEndpointTest.java", "diffHunk": "@@ -234,7 +234,8 @@ private static UserTasksParameters mockUserTasksParameters(HttpServletRequest an\n     EasyMock.expect(parameters.userTaskIds()).andReturn(ParameterUtils.userTaskIds(answerQueryRequest)).anyTimes();\n     EasyMock.expect(parameters.clientIds()).andReturn(ParameterUtils.clientIds(answerQueryRequest)).anyTimes();\n     EasyMock.expect(parameters.endPoints()).andReturn(ParameterUtils.endPoints(answerQueryRequest)).anyTimes();\n-    EasyMock.expect(parameters.endPoint()).andReturn(ParameterUtils.endPoint(answerQueryRequest)).anyTimes();\n+    EasyMock.expect(parameters.endPoint()).andReturn(ParameterUtils\n+        .endPoint(answerQueryRequest)).anyTimes();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDY0NzQ5OQ=="}, "originalCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU4NjMzMw==", "bodyText": "Sure, we can address them in a separate PR -- can we create an issue about them?", "url": "https://github.com/linkedin/cruise-control/pull/1401#discussion_r535586333", "createdAt": "2020-12-03T20:41:29Z", "author": {"login": "efeg"}, "path": "cruise-control/src/test/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManagerTest.java", "diffHunk": "@@ -296,6 +296,7 @@ private HttpServletRequest prepareRequest(HttpSession session, String userTaskId\n     EasyMock.expect(request.getSession(false)).andReturn(session).anyTimes();\n     EasyMock.expect(request.getMethod()).andReturn(GET_METHOD).anyTimes();\n     EasyMock.expect(request.getRequestURI()).andReturn(resource).anyTimes();\n+    EasyMock.expect(request.getPathInfo()).andReturn(resource).anyTimes();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDY1MjMzOA=="}, "originalCommit": {"oid": "5ede61bc8158263994bc7864f10e39dc4919b6be"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "864844ae83f500e4c2d2edd18b61650f4116447c", "author": {"user": {"login": "Lincong", "name": "Lincong Li"}}, "url": "https://github.com/linkedin/cruise-control/commit/864844ae83f500e4c2d2edd18b61650f4116447c", "committedDate": "2020-12-03T20:48:39Z", "message": "Remove unnecessary line wrap"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 120, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}