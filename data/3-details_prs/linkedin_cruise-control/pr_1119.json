{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNDQyODEx", "number": 1119, "title": "Fix ConcurrentModificationException thrown by SlowBrokerFinder.", "bodyText": "Addresses the issue #1118 .", "createdAt": "2020-02-26T18:43:35Z", "url": "https://github.com/linkedin/cruise-control/pull/1119", "merged": true, "mergeCommit": {"oid": "acac77cc7610835ecaa26bdec50ef12bb14992f0"}, "closed": true, "closedAt": "2020-02-27T00:37:16Z", "author": {"login": "kidkun"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcILOjuAH2gAyMzgwNDQyODExOmM1MjU0NjQzZDlmZGExNDFlZTUwNmY4YTBhNDJmNGEzYjkzMjI5YmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIQAvbAFqTM2NTMzNjg4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c5254643d9fda141ee506f8a0a42f4a3b93229bc", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/c5254643d9fda141ee506f8a0a42f4a3b93229bc", "committedDate": "2020-02-26T18:42:20Z", "message": "Fix ConcurrentModificationException thrown by SlowBrokerFinder."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTc5MTEx", "url": "https://github.com/linkedin/cruise-control/pull/1119#pullrequestreview-365179111", "createdAt": "2020-02-26T19:29:02Z", "commit": {"oid": "c5254643d9fda141ee506f8a0a42f4a3b93229bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxOToyOTowM1rOFu5DIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxOToyOTowM1rOFu5DIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcxMzUwNw==", "bodyText": "If this loop only uses the key of the _brokerSlownessScore map, why does it iterate over its entries rather than its keys?", "url": "https://github.com/linkedin/cruise-control/pull/1119#discussion_r384713507", "createdAt": "2020-02-26T19:29:03Z", "author": {"login": "efeg"}, "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/detector/SlowBrokerFinder.java", "diffHunk": "@@ -235,17 +235,21 @@ private void updateBrokerSlownessScore(Set<BrokerEntity> detectedMetricAnomalies\n     }\n     // For brokers which are previously detected as slow brokers, decrease their slowness score if their metrics has\n     // recovered back to normal range.\n+    Set<BrokerEntity> brokersRecovered = new HashSet<>();\n     for (Map.Entry<BrokerEntity, Integer> entry : _brokerSlownessScore.entrySet()) {\n       BrokerEntity broker = entry.getKey();\n       if (!detectedMetricAnomalies.contains(broker)) {\n         Integer score = _brokerSlownessScore.get(broker);\n-        // If the score reaches zero, remove its suspicion.\n         if (score != null && --score == 0) {\n-          _brokerSlownessScore.remove(broker);\n-          _detectedSlowBrokers.remove(broker);\n+          brokersRecovered.add(broker);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5254643d9fda141ee506f8a0a42f4a3b93229bc"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f938b866fcf5576126d92dfb8dd73b6a5ee1aa7c", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/f938b866fcf5576126d92dfb8dd73b6a5ee1aa7c", "committedDate": "2020-02-26T19:42:56Z", "message": "Address the feedback."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bb1a4d4baf022a5808bd3dd1fc42d4f1289996f", "author": {"user": null}, "url": "https://github.com/linkedin/cruise-control/commit/1bb1a4d4baf022a5808bd3dd1fc42d4f1289996f", "committedDate": "2020-02-26T19:57:16Z", "message": "Fix build failure and another bug."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzM2ODg1", "url": "https://github.com/linkedin/cruise-control/pull/1119#pullrequestreview-365336885", "createdAt": "2020-02-27T00:16:46Z", "commit": {"oid": "1bb1a4d4baf022a5808bd3dd1fc42d4f1289996f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 171, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}