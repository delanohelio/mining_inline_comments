{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNjkwNDM1", "number": 2757, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMTowOTo0OVrODp1AGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMDowOTozM1rODqL5Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MTg2NTg1OnYy", "diffSide": "RIGHT", "path": "open-metadata-implementation/access-services/governance-engine/governance-engine-server/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMTowOTo0OVrOF5PlkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMjo0Mzo1NlrOF5SMFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU2ODUyOQ==", "bodyText": "This version identification needs removing -- versions should only be in dependencyManagement in our top level pom", "url": "https://github.com/odpi/egeria/pull/2757#discussion_r395568529", "createdAt": "2020-03-20T11:09:49Z", "author": {"login": "planetf1"}, "path": "open-metadata-implementation/access-services/governance-engine/governance-engine-server/pom.xml", "diffHunk": "@@ -75,11 +75,10 @@\n             <artifactId>governance-engine-api</artifactId>\n         </dependency>\n \n-        <!-- Spring for calling REST APIs -->\n-\n         <dependency>\n             <groupId>org.springframework</groupId>\n             <artifactId>spring-core</artifactId>\n+            <version>5.2.4.RELEASE</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc1280aa8723353faa1885f7e4669aeea67dcb0b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYxMTE1Nw==", "bodyText": "thanks! I removed it in the last commit.", "url": "https://github.com/odpi/egeria/pull/2757#discussion_r395611157", "createdAt": "2020-03-20T12:43:56Z", "author": {"login": "danielaotelea"}, "path": "open-metadata-implementation/access-services/governance-engine/governance-engine-server/pom.xml", "diffHunk": "@@ -75,11 +75,10 @@\n             <artifactId>governance-engine-api</artifactId>\n         </dependency>\n \n-        <!-- Spring for calling REST APIs -->\n-\n         <dependency>\n             <groupId>org.springframework</groupId>\n             <artifactId>spring-core</artifactId>\n+            <version>5.2.4.RELEASE</version>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU2ODUyOQ=="}, "originalCommit": {"oid": "fc1280aa8723353faa1885f7e4669aeea67dcb0b"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTYxNDAzOnYy", "diffSide": "RIGHT", "path": "open-metadata-implementation/access-services/governance-engine/governance-engine-server/src/main/java/org/odpi/openmetadata/accessservices/governanceengine/server/publisher/GovernanceEnginePublisher.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMDowNTozMVrOF5yKzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMDowNTozMVrOF5yKzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNTExOA==", "bodyText": "debug log is OK but e Exception should be logged with error level or thrown", "url": "https://github.com/odpi/egeria/pull/2757#discussion_r396135118", "createdAt": "2020-03-22T20:05:31Z", "author": {"login": "bogdan-sava"}, "path": "open-metadata-implementation/access-services/governance-engine/governance-engine-server/src/main/java/org/odpi/openmetadata/accessservices/governanceengine/server/publisher/GovernanceEnginePublisher.java", "diffHunk": "@@ -2,187 +2,49 @@\n /* Copyright Contributors to the ODPi Egeria project. */\n package org.odpi.openmetadata.accessservices.governanceengine.server.publisher;\n \n-import org.odpi.openmetadata.accessservices.governanceengine.server.processor.GovernanceEngineEventProcessor;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.EntityDetail;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.InstanceGraph;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.InstanceProvenanceType;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.Relationship;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.typedefs.TypeDefSummary;\n-import org.odpi.openmetadata.repositoryservices.events.OMRSInstanceEvent;\n-import org.odpi.openmetadata.repositoryservices.events.OMRSInstanceEventProcessor;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.EntityNotKnownException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.EntityProxyOnlyException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.FunctionNotSupportedException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.InvalidParameterException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.PagingErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.PropertyErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.RepositoryErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.TypeDefNotKnownException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.TypeErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.UserNotAuthorizedException;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.odpi.openmetadata.accessservices.governanceengine.api.events.GovernanceEngineEvent;\n+import org.odpi.openmetadata.frameworks.auditlog.AuditLog;\n+import org.odpi.openmetadata.frameworks.connectors.ffdc.ConnectorCheckedException;\n+import org.odpi.openmetadata.repositoryservices.connectors.openmetadatatopic.OpenMetadataTopicConnector;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n /**\n  * GovernanceEnginePublisher is responsible for publishing events about governed asset components .  It is called\n  * when an interesting OMRS Event is added to the Enterprise OMRS Topic.\n  */\n-public class GovernanceEnginePublisher extends OMRSInstanceEventProcessor {\n-\n-    private static final String eventPublisherName = \"Governance Engine OMAS Event Publisher\";\n+public class GovernanceEnginePublisher {\n \n     private static final Logger log = LoggerFactory.getLogger(GovernanceEnginePublisher.class);\n-    private GovernanceEngineEventProcessor governanceEngineEventProcessor;\n-\n-    public GovernanceEnginePublisher(GovernanceEngineEventProcessor governanceEngineEventProcessor) {\n-        super(eventPublisherName);\n-\n-        this.governanceEngineEventProcessor = governanceEngineEventProcessor;\n-    }\n-\n-    @Override\n-    public void sendInstanceEvent(String sourceName, OMRSInstanceEvent instanceEvent) {\n-    }\n-\n-    @Override\n-    public void processNewEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-    }\n+    private OpenMetadataTopicConnector connector;\n+    private AuditLog auditLog;\n \n-    @Override\n-    public void processUpdatedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail oldEntity, EntityDetail newEntity) {\n+    public GovernanceEnginePublisher(OpenMetadataTopicConnector openMetadataTopicConnector, AuditLog auditLog) {\n+        this.connector = openMetadataTopicConnector;\n+        this.auditLog = auditLog;\n     }\n \n-    @Override\n-    public void processUndoneEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-    }\n-\n-    @Override\n-    public void processClassifiedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-        log.info(\"GE Process Classified Entity\");\n-\n-        try {\n-            governanceEngineEventProcessor.processClassifiedEntity(entity);\n-        } catch (RepositoryErrorException | EntityProxyOnlyException | InvalidParameterException | UserNotAuthorizedException | PagingErrorException | TypeDefNotKnownException | EntityNotKnownException | PropertyErrorException | FunctionNotSupportedException | TypeErrorException e) {\n-            log.debug(\"Governance Engine OMAS is unable to process a Classified Entity event\");\n-        }\n-    }\n-\n-    @Override\n-    public void processDeclassifiedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-        log.info(\"GE Process De-Classified Entity\");\n-\n+    public void publishEvent(GovernanceEngineEvent event) {\n         try {\n-            governanceEngineEventProcessor.processDeclassifiedEntityEvent(entity);\n-        } catch (EntityProxyOnlyException | RepositoryErrorException | InvalidParameterException | UserNotAuthorizedException | PagingErrorException | TypeDefNotKnownException | EntityNotKnownException | PropertyErrorException | FunctionNotSupportedException | TypeErrorException e) {\n-            log.debug(\"Governance Engine OMAS is unable to process Declassified Entity event\");\n+            connector.sendEvent(eventToString(event));\n+            log.info(\"[Governance Engine]event send\");\n+        } catch (ConnectorCheckedException e) {\n+            log.error(\"[Governance Engine] Unable to send event {}\", event);\n         }\n     }\n \n-    @Override\n-    public void processReclassifiedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-        log.info(\"GE Process Re-Classified Entity\");\n+    private String eventToString(GovernanceEngineEvent engineEvent) {\n+        ObjectMapper mapper = new ObjectMapper();\n \n         try {\n-            governanceEngineEventProcessor.processReclassifiedEntity(entity);\n-        } catch (EntityProxyOnlyException | RepositoryErrorException | InvalidParameterException | UserNotAuthorizedException | PagingErrorException | TypeDefNotKnownException | EntityNotKnownException | PropertyErrorException | FunctionNotSupportedException | TypeErrorException e) {\n-            log.debug(\"Governance Engine OMAS is unable to process a Re-Classified Entity event\");\n+            return mapper.writeValueAsString(engineEvent);\n+        } catch (JsonProcessingException e) {\n+            log.debug(\"[Governance Engine] Unable to map the event {} to string.\", engineEvent);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc65f9f2079f5c455f11be12eaf296f75649694d"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTYxNjg3OnYy", "diffSide": "RIGHT", "path": "open-metadata-implementation/governance-servers/security-sync-services/security-sync-services-server/src/main/java/org/odpi/openmetadata/securitysyncservices/processor/SecuritySyncEventProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMDowOTozM1rOF5yMQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMDowOTozM1rOF5yMQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNTQ4OA==", "bodyText": "same here, exception should be logged with error level or thrown\ndebug message might  not be shown and is not very helpful without more info about request", "url": "https://github.com/odpi/egeria/pull/2757#discussion_r396135488", "createdAt": "2020-03-22T20:09:33Z", "author": {"login": "bogdan-sava"}, "path": "open-metadata-implementation/governance-servers/security-sync-services/security-sync-services-server/src/main/java/org/odpi/openmetadata/securitysyncservices/processor/SecuritySyncEventProcessor.java", "diffHunk": "@@ -168,7 +168,7 @@ private GovernedAssetListAPIResponse getGovernedAssets() {\n         try {\n \n             ResponseEntity<String> result = restTemplate.exchange(governanceEngineURL, HttpMethod.GET, entity, String.class);\n-            return (GovernedAssetListAPIResponse) mapToObject(result, GovernedAssetListAPIResponse.class);\n+            return (GovernedAssetListResponse) mapToObject(result, GovernedAssetListResponse.class);\n         } catch (HttpStatusCodeException exception) {\n             log.debug(\"Unable to get the governed assets!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc65f9f2079f5c455f11be12eaf296f75649694d"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2429, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}