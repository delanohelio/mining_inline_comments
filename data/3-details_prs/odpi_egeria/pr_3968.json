{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNjE3MTc3", "number": 3968, "title": "Janus Connector - Adding transaction commits to lineage queries", "bodyText": "Signed-off-by: Liviu Popa liviu-constantin.popa@ing.com", "createdAt": "2020-10-27T09:50:47Z", "url": "https://github.com/odpi/egeria/pull/3968", "merged": true, "mergeCommit": {"oid": "652a3edd670c04b82d1f3540aa55ecb45bcbec14"}, "closed": true, "closedAt": "2020-10-27T11:19:02Z", "author": {"login": "lcpopa"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWl0l1AH2gAyNTEwNjE3MTc3Ojg3ZjI0ODYxM2I3MTRjZjQzM2Q3YWRhMDQ0YzhhZGJmY2FmNzhkNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWmxbYgFqTUxNzU3MzgxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "87f248613b714cf433d7ada044c8adbfcaf78d5b", "author": {"user": {"login": "lcpopa", "name": null}}, "url": "https://github.com/odpi/egeria/commit/87f248613b714cf433d7ada044c8adbfcaf78d5b", "committedDate": "2020-10-27T09:47:30Z", "message": "Adding transaction commits to lineage queries\n\nSigned-off-by: Liviu Popa <liviu-constantin.popa@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea85837efc818d297e9a1b8a6c40a3c0a98e563c", "author": {"user": {"login": "lcpopa", "name": null}}, "url": "https://github.com/odpi/egeria/commit/ea85837efc818d297e9a1b8a6c40a3c0a98e563c", "committedDate": "2020-10-27T10:10:52Z", "message": "Merge branch 'master' of https://github.com/odpi/egeria"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTE5OTYx", "url": "https://github.com/odpi/egeria/pull/3968#pullrequestreview-517519961", "createdAt": "2020-10-27T09:53:11Z", "commit": {"oid": "87f248613b714cf433d7ada044c8adbfcaf78d5b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTo1MzoxMVrOHoznSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTo1MzozNVrOHozoUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU1MDcyOA==", "bodyText": "Lets remove e.printStackTrace();", "url": "https://github.com/odpi/egeria/pull/3968#discussion_r512550728", "createdAt": "2020-10-27T09:53:11Z", "author": {"login": "lpalashevski"}, "path": "open-metadata-implementation/adapters/open-connectors/governance-daemon-connectors/open-lineage-connectors/open-lineage-janus-connector/src/main/java/org/odpi/openmetadata/openconnectors/governancedaemonconnectors/openlineageconnectors/janusconnector/graph/LineageGraphConnectorHelper.java", "diffHunk": "@@ -113,17 +119,32 @@ public LineageGraphConnectorHelper(GraphTraversalSource graphTraversalSource) {\n             return Optional.empty();\n         }\n         String edgeLabel = edgeLabelOptional.get();\n-\n-        Graph sourceGraph = (Graph)\n-                g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n-                        until(inE(edgeLabel).count().is(0)).\n-                        repeat((Traversal) inE(edgeLabel).subgraph(\"subGraph\").outV().simplePath()).\n-                        cap(\"subGraph\").next();\n-\n-        List<Vertex> sourcesList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n-                until(inE(edgeLabel).count().is(0)).\n-                repeat(inE(edgeLabel).outV().simplePath()).\n-                dedup().toList();\n+        Graph sourceGraph = null;\n+        List<Vertex> sourcesList = null;\n+\n+        try {\n+            sourceGraph = (Graph)\n+                    g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n+                            until(inE(edgeLabel).count().is(0)).\n+                            repeat((Traversal) inE(edgeLabel).subgraph(\"subGraph\").outV().simplePath()).\n+                            cap(\"subGraph\").next();\n+\n+            sourcesList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n+                    until(inE(edgeLabel).count().is(0)).\n+                    repeat(inE(edgeLabel).outV().simplePath()).\n+                    dedup().toList();\n+\n+            if(supportingTransactions){\n+                g.tx().commit();\n+            }\n+        }catch (Exception e){\n+            if(supportingTransactions) {\n+                g.tx().rollback();\n+            }\n+            log.error(\"Exception while querying ultimate source horizontal lineage of guid \" + guid + \". Executed rollback.\");\n+            log.error(\"Message: \" + e.getMessage());\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87f248613b714cf433d7ada044c8adbfcaf78d5b"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU1MDk5NQ==", "bodyText": "same here, lets remove e.printStackTrace() from all related methods", "url": "https://github.com/odpi/egeria/pull/3968#discussion_r512550995", "createdAt": "2020-10-27T09:53:35Z", "author": {"login": "lpalashevski"}, "path": "open-metadata-implementation/adapters/open-connectors/governance-daemon-connectors/open-lineage-connectors/open-lineage-janus-connector/src/main/java/org/odpi/openmetadata/openconnectors/governancedaemonconnectors/openlineageconnectors/janusconnector/graph/LineageGraphConnectorHelper.java", "diffHunk": "@@ -142,17 +163,32 @@ public LineageGraphConnectorHelper(GraphTraversalSource graphTraversalSource) {\n             return Optional.empty();\n         }\n         String edgeLabel = edgeLabelOptional.get();\n-\n-        Graph destinationGraph = (Graph)\n-                g.V().has(PROPERTY_KEY_ENTITY_GUID, guid)\n-                        .until(outE(edgeLabel).count().is(0))\n-                        .repeat((Traversal) outE(edgeLabel).subgraph(\"subGraph\").inV().simplePath())\n-                        .cap(\"subGraph\").next();\n-\n-        List<Vertex> destinationsList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n-                until(outE(edgeLabel).count().is(0)).\n-                repeat(outE(edgeLabel).inV().simplePath()).\n-                dedup().toList();\n+        Graph destinationGraph = null;\n+        List<Vertex> destinationsList = null;\n+\n+        try{\n+            destinationGraph = (Graph)\n+                    g.V().has(PROPERTY_KEY_ENTITY_GUID, guid)\n+                            .until(outE(edgeLabel).count().is(0))\n+                            .repeat((Traversal) outE(edgeLabel).subgraph(\"subGraph\").inV().simplePath())\n+                            .cap(\"subGraph\").next();\n+\n+            destinationsList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n+                    until(outE(edgeLabel).count().is(0)).\n+                    repeat(outE(edgeLabel).inV().simplePath()).\n+                    dedup().toList();\n+\n+            if(supportingTransactions){\n+                g.tx().commit();\n+            }\n+        }catch (Exception e){\n+            if(supportingTransactions) {\n+                g.tx().rollback();\n+            }\n+            log.error(\"Exception while querying ultimate destination horizontal lineage of guid \" + guid + \". Executed rollback.\");\n+            log.error(\"Message: \" + e.getMessage());\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87f248613b714cf433d7ada044c8adbfcaf78d5b"}, "originalPosition": 117}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0e6f6c27040ac2c080e02fef90cb3791dee8974", "author": {"user": {"login": "lcpopa", "name": null}}, "url": "https://github.com/odpi/egeria/commit/a0e6f6c27040ac2c080e02fef90cb3791dee8974", "committedDate": "2020-10-27T10:52:49Z", "message": "Adding transaction commits to lineage queries\n\nSigned-off-by: Liviu Popa <liviu-constantin.popa@ing.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTczODEx", "url": "https://github.com/odpi/egeria/pull/3968#pullrequestreview-517573811", "createdAt": "2020-10-27T10:53:57Z", "commit": {"oid": "a0e6f6c27040ac2c080e02fef90cb3791dee8974"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3850, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}