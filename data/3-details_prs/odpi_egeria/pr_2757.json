{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNjkwNDM1", "number": 2757, "title": "Governance Engine OMAS - Refactoring", "bodyText": "", "createdAt": "2020-03-18T22:11:09Z", "url": "https://github.com/odpi/egeria/pull/2757", "merged": true, "mergeCommit": {"oid": "806c3b84500f0eaf8ecdb3053614ccb190086bfc"}, "closed": true, "closedAt": "2020-03-23T08:38:24Z", "author": {"login": "danielaotelea"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOqAwwAH2gAyMzkwNjkwNDM1OjkwMWUzMjkyMjgxYzg5OTE1MDA0NmQzMzZhNGIyNTkwMTY5NWZhY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQaKnkAFqTM3OTIxOTY5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "901e3292281c899150046d336a4b25901695facf", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/901e3292281c899150046d336a4b25901695facf", "committedDate": "2020-03-17T21:57:52Z", "message": "Governance Engine OMAS - Refactoring\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95accfbbf4d9c7b75fef5dc3817a46d22e02403b", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/95accfbbf4d9c7b75fef5dc3817a46d22e02403b", "committedDate": "2020-03-18T18:53:23Z", "message": "Governance Engine OMAS - unit tests for spring module\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b69d8d00ddf6445b1210ac534949484e5dd3148b", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/b69d8d00ddf6445b1210ac534949484e5dd3148b", "committedDate": "2020-03-18T18:58:48Z", "message": "Governance Engine OMAS - removed unused error codes\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fdd24517b9e5c8a28913433febc02f2b469f251", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/5fdd24517b9e5c8a28913433febc02f2b469f251", "committedDate": "2020-03-18T19:08:09Z", "message": "Governance Engine OMAS - renamaned the model pkt from api\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "095eec930504a5d5a204a00dc03d4afcb47ec1f3", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/095eec930504a5d5a204a00dc03d4afcb47ec1f3", "committedDate": "2020-03-18T19:08:42Z", "message": "Governance Engine OMAS - removed unused imported\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cdee318f777a61c0762bf2a1a86902f85378c0a", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/4cdee318f777a61c0762bf2a1a86902f85378c0a", "committedDate": "2020-03-18T19:09:58Z", "message": "Merge branch 'master' into ge-omas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61d58a8eb640260ae2aaf61fb5354cf1abe94a5a", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/61d58a8eb640260ae2aaf61fb5354cf1abe94a5a", "committedDate": "2020-03-18T20:33:37Z", "message": "Governance Engine OMAS - client tests\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10e29fb11370b8bc311249a6fffd40228e30b455", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/10e29fb11370b8bc311249a6fffd40228e30b455", "committedDate": "2020-03-18T21:05:25Z", "message": "Governance Engine OMAS - server tests for rest\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2af67b9655e75d85046cb0960e9a25b5b71f059", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/c2af67b9655e75d85046cb0960e9a25b5b71f059", "committedDate": "2020-03-18T21:11:42Z", "message": "Governance Engine OMAS - pom updated\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e1feecd3ba9c69338da90cd6be60c94b2d6fce5", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/1e1feecd3ba9c69338da90cd6be60c94b2d6fce5", "committedDate": "2020-03-18T22:08:06Z", "message": "Governance Engine OMAS - test for server handler\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9641d3f7c66a2c4ddc4140dcdeb64f1e5235e50a", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/9641d3f7c66a2c4ddc4140dcdeb64f1e5235e50a", "committedDate": "2020-03-19T13:01:49Z", "message": "Governance Engine OMAS - merged + conflict resolved\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "500c66f7f0f3472b2a151d3530982bb3daec4bb5", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/500c66f7f0f3472b2a151d3530982bb3daec4bb5", "committedDate": "2020-03-19T13:03:03Z", "message": "Merge branch 'master' into ge-omas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1b55de0ffbbdd863c79d414f81c28fb04b71adf", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/a1b55de0ffbbdd863c79d414f81c28fb04b71adf", "committedDate": "2020-03-20T08:07:23Z", "message": "Merge branch 'master' into ge-omas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjkzOTg1", "url": "https://github.com/odpi/egeria/pull/2757#pullrequestreview-378293985", "createdAt": "2020-03-20T08:22:09Z", "commit": {"oid": "a1b55de0ffbbdd863c79d414f81c28fb04b71adf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc1280aa8723353faa1885f7e4669aeea67dcb0b", "author": {"user": {"login": "mandy-chessell", "name": "Mandy Chessell"}}, "url": "https://github.com/odpi/egeria/commit/fc1280aa8723353faa1885f7e4669aeea67dcb0b", "committedDate": "2020-03-20T08:23:42Z", "message": "Merge branch 'master' into ge-omas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4Mzk0NzI2", "url": "https://github.com/odpi/egeria/pull/2757#pullrequestreview-378394726", "createdAt": "2020-03-20T11:09:49Z", "commit": {"oid": "fc1280aa8723353faa1885f7e4669aeea67dcb0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMTowOTo0OVrOF5PlkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMTowOTo0OVrOF5PlkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU2ODUyOQ==", "bodyText": "This version identification needs removing -- versions should only be in dependencyManagement in our top level pom", "url": "https://github.com/odpi/egeria/pull/2757#discussion_r395568529", "createdAt": "2020-03-20T11:09:49Z", "author": {"login": "planetf1"}, "path": "open-metadata-implementation/access-services/governance-engine/governance-engine-server/pom.xml", "diffHunk": "@@ -75,11 +75,10 @@\n             <artifactId>governance-engine-api</artifactId>\n         </dependency>\n \n-        <!-- Spring for calling REST APIs -->\n-\n         <dependency>\n             <groupId>org.springframework</groupId>\n             <artifactId>spring-core</artifactId>\n+            <version>5.2.4.RELEASE</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc1280aa8723353faa1885f7e4669aeea67dcb0b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4Mzk1MjQ4", "url": "https://github.com/odpi/egeria/pull/2757#pullrequestreview-378395248", "createdAt": "2020-03-20T11:10:41Z", "commit": {"oid": "fc1280aa8723353faa1885f7e4669aeea67dcb0b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3de75e654354257df2ddaf1ece12b566f70b00d7", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/3de75e654354257df2ddaf1ece12b566f70b00d7", "committedDate": "2020-03-20T12:40:43Z", "message": "Merge branch 'master' into ge-omas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b4bcc9678c0e24c9cbef753c0bd6eb0423130cf", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/3b4bcc9678c0e24c9cbef753c0bd6eb0423130cf", "committedDate": "2020-03-20T12:42:37Z", "message": "versions should only be in dependencyManagement in our top level pom - removed spring core version\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc65f9f2079f5c455f11be12eaf296f75649694d", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/fc65f9f2079f5c455f11be12eaf296f75649694d", "committedDate": "2020-03-20T13:02:35Z", "message": "Merge branch 'master' into ge-omas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDQyMjc1", "url": "https://github.com/odpi/egeria/pull/2757#pullrequestreview-379042275", "createdAt": "2020-03-22T20:05:31Z", "commit": {"oid": "fc65f9f2079f5c455f11be12eaf296f75649694d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMDowNTozMVrOF5yKzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMDowOTozM1rOF5yMQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNTExOA==", "bodyText": "debug log is OK but e Exception should be logged with error level or thrown", "url": "https://github.com/odpi/egeria/pull/2757#discussion_r396135118", "createdAt": "2020-03-22T20:05:31Z", "author": {"login": "bogdan-sava"}, "path": "open-metadata-implementation/access-services/governance-engine/governance-engine-server/src/main/java/org/odpi/openmetadata/accessservices/governanceengine/server/publisher/GovernanceEnginePublisher.java", "diffHunk": "@@ -2,187 +2,49 @@\n /* Copyright Contributors to the ODPi Egeria project. */\n package org.odpi.openmetadata.accessservices.governanceengine.server.publisher;\n \n-import org.odpi.openmetadata.accessservices.governanceengine.server.processor.GovernanceEngineEventProcessor;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.EntityDetail;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.InstanceGraph;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.InstanceProvenanceType;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.instances.Relationship;\n-import org.odpi.openmetadata.repositoryservices.connectors.stores.metadatacollectionstore.properties.typedefs.TypeDefSummary;\n-import org.odpi.openmetadata.repositoryservices.events.OMRSInstanceEvent;\n-import org.odpi.openmetadata.repositoryservices.events.OMRSInstanceEventProcessor;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.EntityNotKnownException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.EntityProxyOnlyException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.FunctionNotSupportedException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.InvalidParameterException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.PagingErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.PropertyErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.RepositoryErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.TypeDefNotKnownException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.TypeErrorException;\n-import org.odpi.openmetadata.repositoryservices.ffdc.exception.UserNotAuthorizedException;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.odpi.openmetadata.accessservices.governanceengine.api.events.GovernanceEngineEvent;\n+import org.odpi.openmetadata.frameworks.auditlog.AuditLog;\n+import org.odpi.openmetadata.frameworks.connectors.ffdc.ConnectorCheckedException;\n+import org.odpi.openmetadata.repositoryservices.connectors.openmetadatatopic.OpenMetadataTopicConnector;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n /**\n  * GovernanceEnginePublisher is responsible for publishing events about governed asset components .  It is called\n  * when an interesting OMRS Event is added to the Enterprise OMRS Topic.\n  */\n-public class GovernanceEnginePublisher extends OMRSInstanceEventProcessor {\n-\n-    private static final String eventPublisherName = \"Governance Engine OMAS Event Publisher\";\n+public class GovernanceEnginePublisher {\n \n     private static final Logger log = LoggerFactory.getLogger(GovernanceEnginePublisher.class);\n-    private GovernanceEngineEventProcessor governanceEngineEventProcessor;\n-\n-    public GovernanceEnginePublisher(GovernanceEngineEventProcessor governanceEngineEventProcessor) {\n-        super(eventPublisherName);\n-\n-        this.governanceEngineEventProcessor = governanceEngineEventProcessor;\n-    }\n-\n-    @Override\n-    public void sendInstanceEvent(String sourceName, OMRSInstanceEvent instanceEvent) {\n-    }\n-\n-    @Override\n-    public void processNewEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-    }\n+    private OpenMetadataTopicConnector connector;\n+    private AuditLog auditLog;\n \n-    @Override\n-    public void processUpdatedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail oldEntity, EntityDetail newEntity) {\n+    public GovernanceEnginePublisher(OpenMetadataTopicConnector openMetadataTopicConnector, AuditLog auditLog) {\n+        this.connector = openMetadataTopicConnector;\n+        this.auditLog = auditLog;\n     }\n \n-    @Override\n-    public void processUndoneEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-    }\n-\n-    @Override\n-    public void processClassifiedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-        log.info(\"GE Process Classified Entity\");\n-\n-        try {\n-            governanceEngineEventProcessor.processClassifiedEntity(entity);\n-        } catch (RepositoryErrorException | EntityProxyOnlyException | InvalidParameterException | UserNotAuthorizedException | PagingErrorException | TypeDefNotKnownException | EntityNotKnownException | PropertyErrorException | FunctionNotSupportedException | TypeErrorException e) {\n-            log.debug(\"Governance Engine OMAS is unable to process a Classified Entity event\");\n-        }\n-    }\n-\n-    @Override\n-    public void processDeclassifiedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-        log.info(\"GE Process De-Classified Entity\");\n-\n+    public void publishEvent(GovernanceEngineEvent event) {\n         try {\n-            governanceEngineEventProcessor.processDeclassifiedEntityEvent(entity);\n-        } catch (EntityProxyOnlyException | RepositoryErrorException | InvalidParameterException | UserNotAuthorizedException | PagingErrorException | TypeDefNotKnownException | EntityNotKnownException | PropertyErrorException | FunctionNotSupportedException | TypeErrorException e) {\n-            log.debug(\"Governance Engine OMAS is unable to process Declassified Entity event\");\n+            connector.sendEvent(eventToString(event));\n+            log.info(\"[Governance Engine]event send\");\n+        } catch (ConnectorCheckedException e) {\n+            log.error(\"[Governance Engine] Unable to send event {}\", event);\n         }\n     }\n \n-    @Override\n-    public void processReclassifiedEntityEvent(String sourceName, String originatorMetadataCollectionId, String originatorServerName, String originatorServerType, String originatorOrganizationName, EntityDetail entity) {\n-        log.info(\"GE Process Re-Classified Entity\");\n+    private String eventToString(GovernanceEngineEvent engineEvent) {\n+        ObjectMapper mapper = new ObjectMapper();\n \n         try {\n-            governanceEngineEventProcessor.processReclassifiedEntity(entity);\n-        } catch (EntityProxyOnlyException | RepositoryErrorException | InvalidParameterException | UserNotAuthorizedException | PagingErrorException | TypeDefNotKnownException | EntityNotKnownException | PropertyErrorException | FunctionNotSupportedException | TypeErrorException e) {\n-            log.debug(\"Governance Engine OMAS is unable to process a Re-Classified Entity event\");\n+            return mapper.writeValueAsString(engineEvent);\n+        } catch (JsonProcessingException e) {\n+            log.debug(\"[Governance Engine] Unable to map the event {} to string.\", engineEvent);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc65f9f2079f5c455f11be12eaf296f75649694d"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNTQ4OA==", "bodyText": "same here, exception should be logged with error level or thrown\ndebug message might  not be shown and is not very helpful without more info about request", "url": "https://github.com/odpi/egeria/pull/2757#discussion_r396135488", "createdAt": "2020-03-22T20:09:33Z", "author": {"login": "bogdan-sava"}, "path": "open-metadata-implementation/governance-servers/security-sync-services/security-sync-services-server/src/main/java/org/odpi/openmetadata/securitysyncservices/processor/SecuritySyncEventProcessor.java", "diffHunk": "@@ -168,7 +168,7 @@ private GovernedAssetListAPIResponse getGovernedAssets() {\n         try {\n \n             ResponseEntity<String> result = restTemplate.exchange(governanceEngineURL, HttpMethod.GET, entity, String.class);\n-            return (GovernedAssetListAPIResponse) mapToObject(result, GovernedAssetListAPIResponse.class);\n+            return (GovernedAssetListResponse) mapToObject(result, GovernedAssetListResponse.class);\n         } catch (HttpStatusCodeException exception) {\n             log.debug(\"Unable to get the governed assets!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc65f9f2079f5c455f11be12eaf296f75649694d"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9329b39c947c39f5c7ec9bf0e437f08d59cbda5", "author": {"user": {"login": "danielaotelea", "name": "Daniela Otelea"}}, "url": "https://github.com/odpi/egeria/commit/b9329b39c947c39f5c7ec9bf0e437f08d59cbda5", "committedDate": "2020-03-22T21:58:15Z", "message": "fix the error logging\n\nSigned-off-by: Daniela Otelea <daniela-valentina.otelea@ing.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MjE5Njk3", "url": "https://github.com/odpi/egeria/pull/2757#pullrequestreview-379219697", "createdAt": "2020-03-23T08:38:00Z", "commit": {"oid": "b9329b39c947c39f5c7ec9bf0e437f08d59cbda5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3748, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}