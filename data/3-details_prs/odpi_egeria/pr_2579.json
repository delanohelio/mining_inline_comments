{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMzM4NzQ3", "number": 2579, "title": "Improve docker images & fix distribution", "bodyText": "Improvements (changes?!)  to docker image build\n\nNow uses the 'proper' egeria distribution - the same as we tell others to use, rather than copying files . Fixes #2375\nRemoved javadoc & source jars from the main distribution - for runtime these are not needed & add to the size.\nAdded the UI (missing) Fixes #2215\nAdded Janus connector for OLS (missing)\nAn image is now self-contained. Rather than downloading the jar from jfrog, we now build in-situ. This makes it easier to build a dev image for testing, in future for PRs if we wish, as well as easier to integrate into a build (merge) without complexity around intermediate repos - will help with #1630\nMoved 'latest' tag to an optional profile (-Ptaglatest or -Dtaglatest) - this makes it easier to build docker images for a release or master, and then only use latest on master - so we can have good 1.3, 1.3-SNAPSHOT etc images as well as latest, and in future refer from our charts/compose . Should also help with #1595 - as will other changes\nUse OCI spec metadata instead of label schema - more cross platform standard\nInject git metadata into image metadata - much easier to answer 'what am I running' - have had issues with this. We also record the repo & if dirty as well as build/latest git update time.  Set to 'unknown' if built outside\nset LOADER_PATH by default for loadable connectors\n\nMay help with #1734 in future\nDraft for now - will need to test more, check charts, but opening for review comments", "createdAt": "2020-02-10T20:32:07Z", "url": "https://github.com/odpi/egeria/pull/2579", "merged": true, "mergeCommit": {"oid": "069f6a1ec397c85bfce71949eb01dd40d21a03a1"}, "closed": true, "closedAt": "2020-02-12T17:40:48Z", "author": {"login": "planetf1"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC_jR0gH2gAyMzczMzM4NzQ3OjIzZWU3OTU2NDZmYmJhYzBiYWUzZjZiMDgwZjRjNjhhNGVmOTQ0Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDpkGyAFqTM1NzYzNDk5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "23ee795646fbbac0bae3f6b080f4c68a4ef944cb", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/23ee795646fbbac0bae3f6b080f4c68a4ef944cb", "committedDate": "2020-02-10T16:16:29Z", "message": "#2375 Build egeria docker image with full egeria distro\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "271ff14a1f9c3d92c601fa06ef6acd95d45d12cc", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/271ff14a1f9c3d92c601fa06ef6acd95d45d12cc", "committedDate": "2020-02-10T16:42:30Z", "message": "#2215 Add UI into assembly\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd555205e711ab70efbd4af7df956a19350e46c2", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/cd555205e711ab70efbd4af7df956a19350e46c2", "committedDate": "2020-02-10T16:50:18Z", "message": "#2375 Add Janus OLS connector to assembly to replace download\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "095c9727f7d4d3b2da10c69768b01c511bb07213", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/095c9727f7d4d3b2da10c69768b01c511bb07213", "committedDate": "2020-02-10T19:23:14Z", "message": "#2375 Add extended metadata tags to aid in querying image at runtime\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8194ef530dd84418baffd380d18aad27c8442b8b", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/8194ef530dd84418baffd380d18aad27c8442b8b", "committedDate": "2020-02-10T19:32:23Z", "message": "#2375 Switch Egeria image to opencontainers spec for metadata labelling\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "badb08d0ea27e6fedc38ce681cf72f125fd5cf74", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/badb08d0ea27e6fedc38ce681cf72f125fd5cf74", "committedDate": "2020-02-10T20:00:03Z", "message": "#2375 move tagging of latest to optional profile -Ptaglatest\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MjQ5NTM3", "url": "https://github.com/odpi/egeria/pull/2579#pullrequestreview-356249537", "createdAt": "2020-02-10T20:45:20Z", "commit": {"oid": "badb08d0ea27e6fedc38ce681cf72f125fd5cf74"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "480e507370ac8283bbb2c8087f5f67e0beb1be36", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/480e507370ac8283bbb2c8087f5f67e0beb1be36", "committedDate": "2020-02-10T22:05:00Z", "message": "#2375 Update lab compose environment to be compatible with new docker images\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb1a6e33f33d7aa6cca9bb708dd49e3d879298b1", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/fb1a6e33f33d7aa6cca9bb708dd49e3d879298b1", "committedDate": "2020-02-11T16:03:01Z", "message": "#2375 Update lab helm chart for new docker images\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f9455addbe54fda23c64bb30c7e82a17b2d1499", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/6f9455addbe54fda23c64bb30c7e82a17b2d1499", "committedDate": "2020-02-11T16:10:24Z", "message": "#2574 rename egeriaversion -> egeria.version\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a827cb6c00bf86a92b60530fdea4cf6d49ebccc", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/6a827cb6c00bf86a92b60530fdea4cf6d49ebccc", "committedDate": "2020-02-11T16:19:10Z", "message": "#2574 Update vdc chart to be compatible with new docker egeria image\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a110ea9296b2f203041095c56ab2e59c8392418", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/0a110ea9296b2f203041095c56ab2e59c8392418", "committedDate": "2020-02-11T16:35:12Z", "message": "#2574 Update egeria-configure docker image to same as that used for core image\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5916058dd510de07248018a2bd0333ae0b2f7a1e", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/5916058dd510de07248018a2bd0333ae0b2f7a1e", "committedDate": "2020-02-11T17:54:51Z", "message": "#2574 Update vdc/lab helm charts to use new configure image\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e93abf494c835c62bb647e6b83ffdb5b3ada060", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/1e93abf494c835c62bb647e6b83ffdb5b3ada060", "committedDate": "2020-02-11T18:35:54Z", "message": "#2574 remove omrsmonitor from vdc chart\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8af97239c85bba903f40d3121723c01f80eb3bcc", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/8af97239c85bba903f40d3121723c01f80eb3bcc", "committedDate": "2020-02-11T18:55:30Z", "message": "#2574 Add profiles to allow selection of base vs extended docker image (for build integration)\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02e64e78001a48c73b780651c554b83c735af73f", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/02e64e78001a48c73b780651c554b83c735af73f", "committedDate": "2020-02-11T19:02:29Z", "message": "#2574 move egeria/configure docker build to standard merge build. others remain daily\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "651c96e347343ea865aff9aa3e46babcc354afb4", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/651c96e347343ea865aff9aa3e46babcc354afb4", "committedDate": "2020-02-11T19:08:07Z", "message": "Merge branch 'master' of https://github.com/odpi/egeria into issue2375a"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98e02d760530a6ec2ef386657ec0b898f3840bb0", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/98e02d760530a6ec2ef386657ec0b898f3840bb0", "committedDate": "2020-02-11T19:22:38Z", "message": "#2574 ensure latest tag for current builds (master)\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MTIyMDYx", "url": "https://github.com/odpi/egeria/pull/2579#pullrequestreview-357122061", "createdAt": "2020-02-12T00:45:45Z", "commit": {"oid": "98e02d760530a6ec2ef386657ec0b898f3840bb0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca60d3b8baf71837e42c31af8245adbb5143f41d", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/ca60d3b8baf71837e42c31af8245adbb5143f41d", "committedDate": "2020-02-12T12:06:13Z", "message": "Merge branch 'master' into issue2375a"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3Mzk4MjQ4", "url": "https://github.com/odpi/egeria/pull/2579#pullrequestreview-357398248", "createdAt": "2020-02-12T12:02:57Z", "commit": {"oid": "98e02d760530a6ec2ef386657ec0b898f3840bb0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMjowMjo1N1rOFosD8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMjowMjo1N1rOFosD8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIwOTI2NA==", "bodyText": "Is this the right way around?  I would expect to take .Values.image.egeria.version and only if that is empty to default to the default tag (which I would expect would always be latest)...\nEven then, though, we need to be careful here keeping in mind the specific semantics of latest and the pull policy (ie. this makes it further critical that the default pull policy remains Always so that non-latest images will be forcibly replaced by k8s and it won't leave stale / old x.x-SNAPSHOT images around)...", "url": "https://github.com/odpi/egeria/pull/2579#discussion_r378209264", "createdAt": "2020-02-12T12:02:57Z", "author": {"login": "cmgrote"}, "path": "open-metadata-resources/open-metadata-deployment/charts/odpi-egeria-lab/templates/egeria-core.yaml", "diffHunk": "@@ -57,7 +57,7 @@ spec:\n           image: \"{{ if (.Values.image.egeria.registry | default .Values.imageDefaults.registry) }}{{ .Values.image.egeria.registry | default .Values.imageDefaults.registry }}/{{ end }}\\\n                   {{ if (.Values.image.egeria.namespace | default .Values.imageDefaults.namespace) }}{{ .Values.image.egeria.namespace | default .Values.imageDefaults.namespace }}/{{ end }}\\\n                   {{ .Values.image.egeria.name }}\\\n-                  :{{ .Values.image.egeria.tag | default .Values.imageDefaults.tag }}\"\n+                  :{{ .Values.image.egeria.tag | default .Values.egeria.version }}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98e02d760530a6ec2ef386657ec0b898f3840bb0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDA1MjE2", "url": "https://github.com/odpi/egeria/pull/2579#pullrequestreview-357405216", "createdAt": "2020-02-12T12:15:16Z", "commit": {"oid": "ca60d3b8baf71837e42c31af8245adbb5143f41d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMjoxNToxNlrOFosYlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMjoxNToxNlrOFosYlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIxNDU1MA==", "bodyText": "One example (others in solr, egeria, ibm-igc, and the init jobs) -- for consistency this needs to be .Values.image.egeria.tag rather than .Values.image.configure.tag (to pickup the singular Egeria version rather than a configure-specific tag); though see previous comments about whether this condition is not backwards at the moment...", "url": "https://github.com/odpi/egeria/pull/2579#discussion_r378214550", "createdAt": "2020-02-12T12:15:16Z", "author": {"login": "cmgrote"}, "path": "open-metadata-resources/open-metadata-deployment/charts/odpi-egeria-vdc/templates/apache-ranger-admin.yaml", "diffHunk": "@@ -74,7 +74,7 @@ spec:\n           image: \"{{ if (.Values.image.configure.registry | default .Values.imageDefaults.registry) }}{{ .Values.image.configure.registry | default .Values.imageDefaults.registry }}/{{ end }}\\\n                   {{ if (.Values.image.configure.namespace | default .Values.imageDefaults.namespace) }}{{ .Values.image.configure.namespace | default .Values.imageDefaults.namespace }}/{{ end }}\\\n                   {{ .Values.image.configure.name }}\\\n-                  :{{ .Values.image.configure.tag | default .Values.imageDefaults.tag }}\"\n+                  :{{ .Values.image.configure.tag | default .Values.egeria.version }}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca60d3b8baf71837e42c31af8245adbb5143f41d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fc734064ecff1d44aaff38d2b3382bd24bc60d0", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/9fc734064ecff1d44aaff38d2b3382bd24bc60d0", "committedDate": "2020-02-12T16:24:33Z", "message": "Merge branch 'master' of https://github.com/odpi/egeria into issue2375a"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NjIwMjY1", "url": "https://github.com/odpi/egeria/pull/2579#pullrequestreview-357620265", "createdAt": "2020-02-12T16:54:03Z", "commit": {"oid": "ca60d3b8baf71837e42c31af8245adbb5143f41d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNjo1NDowM1rOFo2lKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNjo1NDowM1rOFo2lKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM4MTYwOA==", "bodyText": "This value is different from the others -- there were one or two other spots with this setup, too.  Here you have:\n:{{ .Values.image.egeria.tag | default .Values.egeria.version }}\n\nwhereas elsewhere you have:\n:{{ .Values.image.configure.tag | default .Values.egeria.version }}\n\nI had assumed you meant to use the former everywhere (having a single tag for all Egeria images: both the Egeria core and the configure image), but perhaps it's these few places with the first setup that were a mistake (?)", "url": "https://github.com/odpi/egeria/pull/2579#discussion_r378381608", "createdAt": "2020-02-12T16:54:03Z", "author": {"login": "cmgrote"}, "path": "open-metadata-resources/open-metadata-deployment/charts/odpi-egeria-vdc/templates/apache-atlas.yaml", "diffHunk": "@@ -76,7 +76,7 @@ spec:\n           image: \"{{ if (.Values.image.configure.registry | default .Values.imageDefaults.registry) }}{{ .Values.image.configure.registry | default .Values.imageDefaults.registry }}/{{ end }}\\\n                   {{ if (.Values.image.configure.namespace | default .Values.imageDefaults.namespace) }}{{ .Values.image.configure.namespace | default .Values.imageDefaults.namespace }}/{{ end }}\\\n                   {{ .Values.image.configure.name }}\\\n-                  :{{ .Values.image.configure.tag | default .Values.imageDefaults.tag }}\"\n+                  :{{ .Values.image.egeria.tag | default .Values.egeria.version }}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca60d3b8baf71837e42c31af8245adbb5143f41d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d176763d339bcd4106127dae2adb0c401b96ec8e", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/d176763d339bcd4106127dae2adb0c401b96ec8e", "committedDate": "2020-02-12T17:07:44Z", "message": "Correct tag used for configure image in atlas deployment (vdc)\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "048a695b35a00b1a886cfe52d8cd8a95fa453817", "author": {"user": {"login": "planetf1", "name": "Nigel Jones"}}, "url": "https://github.com/odpi/egeria/commit/048a695b35a00b1a886cfe52d8cd8a95fa453817", "committedDate": "2020-02-12T17:08:28Z", "message": "Merge branch 'issue2375a' of https://github.com/planetf1/egeria into issue2375a"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NjM0OTk4", "url": "https://github.com/odpi/egeria/pull/2579#pullrequestreview-357634998", "createdAt": "2020-02-12T17:13:24Z", "commit": {"oid": "048a695b35a00b1a886cfe52d8cd8a95fa453817"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3764, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}