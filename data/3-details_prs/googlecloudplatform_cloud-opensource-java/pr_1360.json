{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1Mjg5NTky", "number": 1360, "title": "Integration Tests using Maven-invoker-plugin", "bodyText": "Fixes #1345\nmaven-invoker-plugin:\n\nThis plugin is in particular handy to perform integration tests for other Maven plugins.\n\nCircleCI runs the integration tests successfully (link):\n[INFO] --- maven-invoker-plugin:3.2.1:run (integration-test) @ linkage-checker-enforcer-rules ---\n[INFO] Building: fail-build-for-linkage-errors/pom.xml\n[INFO] run post-build script verify.groovy\n[INFO]           fail-build-for-linkage-errors/pom.xml ............ SUCCESS (47.1 s)\n[INFO] Building: report-only-reachable/pom.xml\n[INFO] run post-build script verify.groovy\n[INFO]           report-only-reachable/pom.xml .................... SUCCESS (4.5 s)\n[INFO] -------------------------------------------------\n[INFO] Build Summary:\n[INFO]   Passed: 2, Failed: 0, Errors: 0, Skipped: 0\n[INFO] -------------------------------------------------\n\nverify.groovy\nMaven-invoker-plugin has two ways to verify the build result: BeanShell and Groovy. As we'll be working with Gradle plugins soon, I choose Groovy that powers build.gradle files.\nmvnw\nKokoro build has outdated Maven version (3.3.9), which prevents the maven-invoker-plugin integration tests, causing diamond dependency conflicts with aether classes  (#1361 ). To solve this, this PR uses https://github.com/takari/maven-wrapper to have consistent Maven version across CI servers. I referenced spring-cloud-gcp for mvnw usage.", "createdAt": "2020-04-17T18:55:36Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360", "merged": true, "mergeCommit": {"oid": "e163bd4d4a51590d15d3ed934da388e1d90373d5"}, "closed": true, "closedAt": "2020-04-22T20:47:08Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYlwRugH2gAyNDA1Mjg5NTkyOjAwZGY2MDk1YWE4MTJiNWM5NTNmZjgwNWYwNTI4MDA1OWZiZDE0YWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaNCJ9AH2gAyNDA1Mjg5NTkyOjM0MWZiZmE5ODA1NmYyZmI5MmRjZDdmZWU0OGJjMjg2ZWFlMWE4NWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "00df6095aa812b5c953ff805f05280059fbd14ae", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/00df6095aa812b5c953ff805f05280059fbd14ae", "committedDate": "2020-04-17T18:39:29Z", "message": "integration test first step"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b1ea33a307cd16262850e729a1440cf91c5641b", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3b1ea33a307cd16262850e729a1440cf91c5641b", "committedDate": "2020-04-17T18:52:12Z", "message": "Adding success and failure cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93dfd37dca3fe8851eef4ddea387744ac37d0373", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/93dfd37dca3fe8851eef4ddea387744ac37d0373", "committedDate": "2020-04-17T19:08:50Z", "message": "Removed unnecessary comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7034c72c50b7925e5c04e960507d1cf026b5b10a", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/7034c72c50b7925e5c04e960507d1cf026b5b10a", "committedDate": "2020-04-17T19:13:52Z", "message": "Updated comment in the pom xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzA2ODc2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#pullrequestreview-395706876", "createdAt": "2020-04-17T19:09:32Z", "commit": {"oid": "93dfd37dca3fe8851eef4ddea387744ac37d0373"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTowOTozMlrOGHZ8aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOToxMToyMlrOGHZ_sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQxODI4MQ==", "bodyText": "Document for the parameters: http://maven.apache.org/plugins/maven-invoker-plugin/run-mojo.html#cloneProjectsTo", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r410418281", "createdAt": "2020-04-17T19:09:32Z", "author": {"login": "suztomo"}, "path": "enforcer-rules/pom.xml", "diffHunk": "@@ -128,4 +128,27 @@\n       <scope>test</scope>\n     </dependency>\n   </dependencies>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <artifactId>maven-invoker-plugin</artifactId>\n+        <version>3.2.1</version>\n+        <configuration>\n+          <cloneProjectsTo>${project.build.directory}/it</cloneProjectsTo>\n+          <localRepositoryPath>${project.build.directory}/local-repo</localRepositoryPath>\n+          <postBuildHookScript>verify</postBuildHookScript>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93dfd37dca3fe8851eef4ddea387744ac37d0373"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQxOTEyMg==", "bodyText": "This is groovy script specified by \"postBuildHookScript\".\nMaven-checkstyle-plugin also uses groovy script to verify the build https://github.com/apache/maven-checkstyle-plugin/tree/master/src/it/MCHECKSTYLE-338", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r410419122", "createdAt": "2020-04-17T19:11:22Z", "author": {"login": "suztomo"}, "path": "enforcer-rules/src/it/fail-build-for-linkage-errors/verify.groovy", "diffHunk": "@@ -0,0 +1,8 @@\n+def buildLog = new File(basedir, \"build.log\")\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93dfd37dca3fe8851eef4ddea387744ac37d0373"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5924d9a78c288676f631768c249350fcae00b583", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/5924d9a78c288676f631768c249350fcae00b583", "committedDate": "2020-04-17T21:03:32Z", "message": "Maven-resolver-api non-provided"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Nzg4NjQ2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#pullrequestreview-395788646", "createdAt": "2020-04-17T21:40:07Z", "commit": {"oid": "5924d9a78c288676f631768c249350fcae00b583"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTo0MDowOFrOGHd47Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTo0MDowOFrOGHd47Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4MjkyNQ==", "bodyText": "Given maven-resolver-api was at the end of the class path (log), I thought controlling the order of the dependency would solve the issue.\nIt did not help. https://gist.github.com/suztomo/d35ffca4e31387591a3f7b18b7366a2b", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r410482925", "createdAt": "2020-04-17T21:40:08Z", "author": {"login": "suztomo"}, "path": "enforcer-rules/pom.xml", "diffHunk": "@@ -105,7 +105,6 @@\n     <dependency>\n       <groupId>org.apache.maven.resolver</groupId>\n       <artifactId>maven-resolver-api</artifactId>\n-      <scope>provided</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5924d9a78c288676f631768c249350fcae00b583"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e4a1cd75d7c523bdc2f5e6a3123ac2441e7fc88", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/2e4a1cd75d7c523bdc2f5e6a3123ac2441e7fc88", "committedDate": "2020-04-20T14:35:36Z", "message": "Merge remote-tracking branch 'origin/master' into i1345"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60f77906a0e483d6120d2190debb5922bf086972", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/60f77906a0e483d6120d2190debb5922bf086972", "committedDate": "2020-04-21T14:41:19Z", "message": "Debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0808883eab587cb7923fed87be23b5657bb92c68", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/0808883eab587cb7923fed87be23b5657bb92c68", "committedDate": "2020-04-21T15:13:35Z", "message": "Using Maven wrapper to use consistent version among CI\n\nThe mvnw scripts are generated via\nmvn -N io.takari:maven:wrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b41d35ef1f96b14b5e364be262a53065258b8d37", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b41d35ef1f96b14b5e364be262a53065258b8d37", "committedDate": "2020-04-21T15:17:49Z", "message": "Adding wrapper files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fab8122b79dd995fa03dbbeb452e09f55c4ab8eb", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/fab8122b79dd995fa03dbbeb452e09f55c4ab8eb", "committedDate": "2020-04-21T15:26:47Z", "message": "Reverting debug settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82c09516e0d1bb2a99296c8bbfec8395ba756c56", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/82c09516e0d1bb2a99296c8bbfec8395ba756c56", "committedDate": "2020-04-21T15:31:15Z", "message": "Required maven updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/ad42caa170bfa0a34ece8861e051659edd705e42", "committedDate": "2020-04-21T17:26:00Z", "message": "Windows \\r character"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTQxMjE5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#pullrequestreview-397541219", "createdAt": "2020-04-21T17:54:29Z", "commit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzo1NDozMFrOGJRBnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzo1NTo1NVrOGJRFZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2OTMwOA==", "bodyText": "This file is from mvn -N io.takari:maven:wrapper https://github.com/takari/maven-wrapper.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r412369308", "createdAt": "2020-04-21T17:54:30Z", "author": {"login": "suztomo"}, "path": ".mvn/wrapper/MavenWrapperDownloader.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2OTU1Ng==", "bodyText": "This file is from mvn -N io.takari:maven:wrapper https://github.com/takari/maven-wrapper. This sets the Maven version that runs for mvnw command.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r412369556", "createdAt": "2020-04-21T17:54:51Z", "author": {"login": "suztomo"}, "path": ".mvn/wrapper/maven-wrapper.properties", "diffHunk": "@@ -0,0 +1,2 @@\n+distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.6.3/apache-maven-3.6.3-bin.zip", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3MDAwMw==", "bodyText": "I found Maven 3.5.0 does not work for the enforcer rule because of the dependency conflict #1361", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r412370003", "createdAt": "2020-04-21T17:55:29Z", "author": {"login": "suztomo"}, "path": "README.md", "diffHunk": "@@ -35,7 +35,7 @@ This project is built using _Maven_.\n \n ## Requirements\n \n-1. Maven 3.5.0 or later.\n+1. Maven 3.6.0 or later.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3MDE4Mw==", "bodyText": "This file is from mvn -N io.takari:maven:wrapper https://github.com/takari/maven-wrapper.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r412370183", "createdAt": "2020-04-21T17:55:45Z", "author": {"login": "suztomo"}, "path": "mvnw", "diffHunk": "@@ -0,0 +1,310 @@\n+#!/bin/sh", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3MDI3OA==", "bodyText": "This file is from mvn -N io.takari:maven:wrapper https://github.com/takari/maven-wrapper.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r412370278", "createdAt": "2020-04-21T17:55:55Z", "author": {"login": "suztomo"}, "path": "mvnw.cmd", "diffHunk": "@@ -0,0 +1,182 @@\n+@REM ----------------------------------------------------------------------------", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjE1NDM3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#pullrequestreview-397615437", "createdAt": "2020-04-21T19:36:44Z", "commit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxOTozNjo0NVrOGJVLBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxOTozNjo0NVrOGJVLBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQzNzI1NQ==", "bodyText": "I'm surprised this isn't available as a jar on maven central.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1360#discussion_r412437255", "createdAt": "2020-04-21T19:36:45Z", "author": {"login": "elharo"}, "path": ".mvn/wrapper/MavenWrapperDownloader.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2OTMwOA=="}, "originalCommit": {"oid": "ad42caa170bfa0a34ece8861e051659edd705e42"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "341fbfa98056f2fb92dcd7fee48bc286eae1a85e", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/341fbfa98056f2fb92dcd7fee48bc286eae1a85e", "committedDate": "2020-04-22T18:59:14Z", "message": "Merge branch 'master' into i1345"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 363, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}