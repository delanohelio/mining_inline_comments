{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzMTIzNjY1", "number": 1681, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo0NToyN1rOEnfI_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMToyNDowN1rOEnnANg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODQwMTI1OnYy", "diffSide": "LEFT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo0NToyN1rOHYGvKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo0NToyN1rOHYGvKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAzODI0OA==", "bodyText": "\"is not found\" message is gone.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495038248", "createdAt": "2020-09-25T14:45:27Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODQwMjk1OnYy", "diffSide": "RIGHT", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo0NTo1NFrOHYGwLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo0NTo1NFrOHYGwLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAzODUxMQ==", "bodyText": "Because of the missing equals method, this test was not using correct expected value.\nThe last argument of ReturnTypeChangedProblem is the actual type. protobuf-java 3.12.4 expects flip() method to return java.nio.CharBuffer but in JDK 8 the method actually has return type java.nio.Buffer.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495038511", "createdAt": "2020-09-25T14:45:54Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -1145,7 +1145,7 @@ public void testFindLinkageProblems_referenceToJava11Method() throws IOException\n             new ClassFile(jars.get(0), \"com.google.protobuf.TextFormat\"),\n             null,\n             methodSymbol,\n-            \"java.nio.CharBuffer\");\n+            \"java.nio.Buffer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODQwNjY1OnYy", "diffSide": "RIGHT", "path": "enforcer-rules/src/it/return-type-mismatch/verify.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo0Njo1M1rOHYGyjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo0Njo1M1rOHYGyjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAzOTExOQ==", "bodyText": "This is the effect of this PR.\n(The backslash at the end is not to break the line there.)", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495039119", "createdAt": "2020-09-25T14:46:53Z", "author": {"login": "suztomo"}, "path": "enforcer-rules/src/it/return-type-mismatch/verify.groovy", "diffHunk": "@@ -0,0 +1,16 @@\n+def buildLog = new File(basedir, \"build.log\").text.replaceAll(\"\\\\r\\\\n\", \"\\n\")\n+\n+// protobuf-java 3.12.4 has wrong reference to ByteBuffer's methods that are unavailable in Java 8.\n+// In this message below, the expectation is wrong.\n+assert buildLog.contains('''\\\n+java.nio.ByteBuffer's method position(int) is expected to return java.nio.ByteBuffer\\\n+ but the actual type is java.nio.Buffer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODQyMjkzOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNDo1MDo1NFrOHYG8vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOTowNjozN1rOHYPYIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTcyNQ==", "bodyText": "These overrides have been missing and allowed testFindLinkageProblems_referenceToJava11Method to ignore the actualType field.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495041725", "createdAt": "2020-09-25T14:50:54Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,\n+        \"is expected to return \"\n+            + Utility.methodSignatureReturnType(expectedMethodSymbol.getDescriptor())\n+            + \" but the actual type is \"\n+            + actualType,\n         sourceClass,\n         expectedMethodSymbol,\n         targetClass);\n+    this.actualType = actualType;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(super.hashCode(), actualType);\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    return super.equals(other) // this checks the class equality\n+        && Objects.equals(actualType, ((ReturnTypeChangedProblem) other).actualType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1NDQ2NQ==", "bodyText": "Good catch. The equals method in the supertype should perhaps be testing for class equality.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495154465", "createdAt": "2020-09-25T18:14:08Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,\n+        \"is expected to return \"\n+            + Utility.methodSignatureReturnType(expectedMethodSymbol.getDescriptor())\n+            + \" but the actual type is \"\n+            + actualType,\n         sourceClass,\n         expectedMethodSymbol,\n         targetClass);\n+    this.actualType = actualType;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(super.hashCode(), actualType);\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    return super.equals(other) // this checks the class equality\n+        && Objects.equals(actualType, ((ReturnTypeChangedProblem) other).actualType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTcyNQ=="}, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3OTgwOQ==", "bodyText": "Added test with ReturnTypeChangedProblem.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495179809", "createdAt": "2020-09-25T19:06:37Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,\n+        \"is expected to return \"\n+            + Utility.methodSignatureReturnType(expectedMethodSymbol.getDescriptor())\n+            + \" but the actual type is \"\n+            + actualType,\n         sourceClass,\n         expectedMethodSymbol,\n         targetClass);\n+    this.actualType = actualType;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(super.hashCode(), actualType);\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    return super.equals(other) // this checks the class equality\n+        && Objects.equals(actualType, ((ReturnTypeChangedProblem) other).actualType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0MTcyNQ=="}, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5OTEzMTAzOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODoxMjozMFrOHYNyJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOTowNDo1OVrOHYPVBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1MzcwMQ==", "bodyText": "why a com.sun class?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495153701", "createdAt": "2020-09-25T18:12:30Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n+import com.sun.org.apache.bcel.internal.classfile.Utility;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3OTAxNA==", "bodyText": "Fixed. It was fetching the class from rt.jar. Interesting.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495179014", "createdAt": "2020-09-25T19:04:59Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n+import com.sun.org.apache.bcel.internal.classfile.Utility;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1MzcwMQ=="}, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5OTEzMzIxOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxODoxMzoxMVrOHYNzdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxOTowNTo1MlrOHYPWvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1NDAzOQ==", "bodyText": "\"the actual type is\" --> but instead returns", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495154039", "createdAt": "2020-09-25T18:13:11Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,\n+        \"is expected to return \"\n+            + Utility.methodSignatureReturnType(expectedMethodSymbol.getDescriptor())\n+            + \" but the actual type is \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE3OTQ1Mw==", "bodyText": "Nice. Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495179453", "createdAt": "2020-09-25T19:05:52Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -24,15 +26,32 @@\n  * actualTypeName}).\n  */\n class ReturnTypeChangedProblem extends LinkageProblem {\n+  private String actualType;\n+\n   ReturnTypeChangedProblem(\n       ClassFile sourceClass,\n       @Nullable ClassFile targetClass,\n       MethodSymbol expectedMethodSymbol,\n       String actualType) {\n     super(\n-        \"is not found. The expected return type does not match the actual type \" + actualType,\n+        \"is expected to return \"\n+            + Utility.methodSignatureReturnType(expectedMethodSymbol.getDescriptor())\n+            + \" but the actual type is \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1NDAzOQ=="}, "originalCommit": {"oid": "1aad4f6e75c03b4f6bf10a5a108de4ea10450d99"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5OTY4OTUwOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMToyNDowN1rOHYTJHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjozMTo1M1rOHYVykA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0MTUwMg==", "bodyText": "sort imports", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495241502", "createdAt": "2020-09-25T21:24:07Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n+import org.apache.bcel.classfile.Utility;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "789f017cd36655efb8b82378b2c1264a35816472"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI4NDg4MA==", "bodyText": "Fixed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1681#discussion_r495284880", "createdAt": "2020-09-25T22:31:53Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ReturnTypeChangedProblem.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n+import org.apache.bcel.classfile.Utility;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0MTUwMg=="}, "originalCommit": {"oid": "789f017cd36655efb8b82378b2c1264a35816472"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2562, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}