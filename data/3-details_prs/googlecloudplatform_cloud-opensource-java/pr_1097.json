{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNTc3MDMz", "number": 1097, "title": "Make DependencyGraphBuilder nonstatic to hold repositories", "bodyText": "Make DependencyGraphBuilder and ClassPathBuilder non-static because\n\nDependencyGraphBuilder can hold repositories in its instance variable (rather than a global variable of RepositoryUtility)\nClassPathBuilder to hold DependencyGraphBuilder instance\n\nRemoving AggregatedRepositoryException in favor of ArtifactProblem.", "createdAt": "2020-01-10T18:48:44Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097", "merged": true, "mergeCommit": {"oid": "6e92154e84d7f195ff5a8efd3f058ccdb3072342"}, "closed": true, "closedAt": "2020-01-16T15:51:58Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5BsPBAH2gAyMzYxNTc3MDMzOmI2N2QyY2E4NTBhZDJmODY3OTI3ZDg1Mzk1YWZhMDA2YTQ2OGMxMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb678umAFqTM0NDAwMTgwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b67d2ca850ad2f867927d85395afa006a468c113", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b67d2ca850ad2f867927d85395afa006a468c113", "committedDate": "2020-01-10T17:06:50Z", "message": "Non-static ClassPathBuilder and DependencyGraphBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d1b8c35e6c1ce23acb2032064763daf4856417ed", "committedDate": "2020-01-10T18:32:23Z", "message": "Nonstatic dependencygraphbuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDEwMzAy", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-341410302", "createdAt": "2020-01-10T20:40:05Z", "commit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDo0MDowNlrOFcfjgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDo0MjowOFrOFcfmDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyMTQ0Mw==", "bodyText": "why would this method need to change?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365421443", "createdAt": "2020-01-10T20:40:06Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -74,7 +77,7 @@\n    * @return an ordered map of absolute paths of jar files to one or more Maven dependency paths\n    * @throws RepositoryException when there is a problem retrieving jar files\n    */\n-  public static LinkedListMultimap<Path, DependencyPath> artifactsToDependencyPaths(\n+  public LinkedListMultimap<Path, DependencyPath> artifactsToDependencyPaths(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyMTY4MA==", "bodyText": "why not final?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365421680", "createdAt": "2020-01-10T20:40:48Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -57,13 +57,15 @@\n   private static final CharMatcher LOWER_ALPHA_NUMERIC =\n       CharMatcher.inRange('a', 'z').or(CharMatcher.inRange('0', '9'));\n \n+  private final List<UnresolvableArtifactProblem> artifactProblems = new ArrayList<>();\n+\n   static {\n     detectOsProperties().forEach(System::setProperty);\n   }\n \n   // caching cuts time by about a factor of 4. Dependency class's equality includes exclusions.\n-  private static final Map<Dependency, DependencyNode> cacheWithProvidedScope = new HashMap<>();\n-  private static final Map<Dependency, DependencyNode> cacheWithoutProvidedScope = new HashMap<>();\n+  private static Map<Dependency, DependencyNode> cacheWithProvidedScope = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyMjA5NA==", "bodyText": "There's no configuration here, which suggests this should still be static.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365422094", "createdAt": "2020-01-10T20:42:08Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/UpdateReport.java", "diffHunk": "@@ -40,9 +39,9 @@ public static void main(String[] args) throws RepositoryException {\n     \n     try {\n       DefaultArtifact artifact = new DefaultArtifact(args[0]);\n-      \n-      DependencyGraph graph =\n-          DependencyGraphBuilder.getCompleteDependencies(artifact);\n+\n+      DependencyGraphBuilder dependencyGraphBuilder = new DependencyGraphBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDE1Mjc0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-341415274", "createdAt": "2020-01-10T20:51:36Z", "commit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDo1MTozNlrOFcfypQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDo1MTozNlrOFcfypQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyNTMxNw==", "bodyText": "@elharo This is the reason to make DependencyGraphBuilder non-static. Once DependencyGraphBuilder becomes non-static, then ClassPathBuilder also becomes non-static to hold the instance of DependencyGraphBuilder.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365425317", "createdAt": "2020-01-10T20:51:36Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -57,13 +57,15 @@\n   private static final CharMatcher LOWER_ALPHA_NUMERIC =\n       CharMatcher.inRange('a', 'z').or(CharMatcher.inRange('0', '9'));\n \n+  private final List<UnresolvableArtifactProblem> artifactProblems = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f587ab2392a7c15a156a89449285f6ed20d769c2", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f587ab2392a7c15a156a89449285f6ed20d769c2", "committedDate": "2020-01-10T21:08:50Z", "message": "Merge remote-tracking branch 'origin/master' into dependency_error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDIzMzk5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-341423399", "createdAt": "2020-01-10T21:09:39Z", "commit": {"oid": "f587ab2392a7c15a156a89449285f6ed20d769c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMTowOTozOVrOFcgJsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMTowOTozOVrOFcgJsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQzMTIxOQ==", "bodyText": "LevelOrder touching artifactProblems requires the method to be non-static.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365431219", "createdAt": "2020-01-10T21:09:39Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -336,17 +335,13 @@ private static DependencyGraph levelOrder(\n               DependencyNode failedDependencyNode = artifactResult.getRequest().getDependencyNode();\n               ExceptionAndPath failure =\n                   ExceptionAndPath.create(parentNodes, failedDependencyNode, resolutionException);\n-              if (requiredDependency(failure.getPath())) {\n-                resolutionFailures.add(failure);\n-              }\n+              artifactProblems.add(new UnresolvableArtifactProblem(failure.getPath()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f587ab2392a7c15a156a89449285f6ed20d769c2"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6dd0e5664d88ef78f55888c921f5f7aa66107c9", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d6dd0e5664d88ef78f55888c921f5f7aa66107c9", "committedDate": "2020-01-13T04:16:15Z", "message": "DependencyGraphBuilder to have repository URLs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "040d63f807ba4f9f1311a35310c1825933ea31bb", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/040d63f807ba4f9f1311a35310c1825933ea31bb", "committedDate": "2020-01-13T04:19:02Z", "message": "javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2d3fd571acf98bd0a80235b162a3549744241ce", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b2d3fd571acf98bd0a80235b162a3549744241ce", "committedDate": "2020-01-13T04:23:27Z", "message": "Removed field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec6581b3f1f88a27513e8cd0676e9a35dcab0df8", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/ec6581b3f1f88a27513e8cd0676e9a35dcab0df8", "committedDate": "2020-01-13T04:24:35Z", "message": "Deleted mavenRepositories field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNjM0NTk2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-341634596", "createdAt": "2020-01-13T04:17:42Z", "commit": {"oid": "d6dd0e5664d88ef78f55888c921f5f7aa66107c9"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwNDoxNzo0M1rOFctGIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwNDoyNTo0MFrOFctJfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY0MzI5OA==", "bodyText": "In this idea, DependencyGraphBuilder takes repository URL configuration.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365643298", "createdAt": "2020-01-13T04:17:43Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerMain.java", "diffHunk": "@@ -44,12 +46,21 @@ public static void main(String[] arguments)\n     LinkageCheckerArguments linkageCheckerArguments =\n         LinkageCheckerArguments.readCommandLine(arguments);\n \n-    RepositoryUtility.setRepositories(linkageCheckerArguments.getExtraMavenRepositoryUrls(),\n-        linkageCheckerArguments.getAddMavenCentral());\n+    DependencyGraphBuilder dependencyGraphBuilder =\n+        new DependencyGraphBuilder(\n+            linkageCheckerArguments.getExtraMavenRepositoryUrls(),\n+            linkageCheckerArguments.getAddMavenCentral());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6dd0e5664d88ef78f55888c921f5f7aa66107c9"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY0Mzg1MA==", "bodyText": "DependencyGraphBuilder to take configuration of repository URLs. As of now, a static field of RepositoryUtility holds the repository URLs. I believe they should be an instance variable of DependencyGraphBuilder.\nFrom old comment on the static mutable field in by Elliotte:\n\nMutable static state suggests we're growing past the point where this class can plausibly be static. OK, for now but consider whether refactoring might help. Either to use more instance methods or to pass the repsositoryURLs as arguments to a method instead.\nhttps://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/349/files#r249024802", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365643850", "createdAt": "2020-01-13T04:22:17Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -108,20 +115,42 @@ private static String osDetectedArch() {\n     }\n   }\n \n-  private static DependencyNode resolveCompileTimeDependencies(\n-      DependencyNode rootDependencyArtifact)\n+  /**\n+   * @param mavenRepositoryUrls Maven repository URLs to search for dependencies\n+   * @param addMavenCentral if true, add Maven Central to the end of the repository list\n+   * @throws IllegalArgumentException if a URL is malformed or not having an allowed scheme\n+   */\n+  public DependencyGraphBuilder(Iterable<String> mavenRepositoryUrls, boolean addMavenCentral) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "040d63f807ba4f9f1311a35310c1825933ea31bb"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY0Mzg5Nw==", "bodyText": "Repository URLs are the configuration of DependencyGraphBuilder.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365643897", "createdAt": "2020-01-13T04:22:50Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -57,13 +60,17 @@\n   private static final CharMatcher LOWER_ALPHA_NUMERIC =\n       CharMatcher.inRange('a', 'z').or(CharMatcher.inRange('0', '9'));\n \n+  private final List<UnresolvableArtifactProblem> artifactProblems = new ArrayList<>();\n+\n+  private final ImmutableList<RemoteRepository> repositories;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "040d63f807ba4f9f1311a35310c1825933ea31bb"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY0NDE1OQ==", "bodyText": "It was a mutable static variable. A global variable I want to eliminate.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r365644159", "createdAt": "2020-01-13T04:25:40Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/RepositoryUtility.java", "diffHunk": "@@ -90,8 +90,6 @@\n   public static final RemoteRepository CENTRAL =\n       new RemoteRepository.Builder(\"central\", \"default\", \"http://repo1.maven.org/maven2/\").build();\n \n-  private static ImmutableList<RemoteRepository> mavenRepositories = ImmutableList.of(CENTRAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec6581b3f1f88a27513e8cd0676e9a35dcab0df8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7525d4a9b0cffd3c90bf00d2639412d8a5f8bf7", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d7525d4a9b0cffd3c90bf00d2639412d8a5f8bf7", "committedDate": "2020-01-13T20:13:22Z", "message": "Merge remote-tracking branch 'origin/master' into dependency_error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d4281ccba2b556638cf5c384b0d47aed4a75670", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/9d4281ccba2b556638cf5c384b0d47aed4a75670", "committedDate": "2020-01-13T21:30:44Z", "message": "ClassPathBuilder and DependencyGraphBuilder nonstatic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bac195b1f7db098b6af7e82435c42b9c14cc3e8a", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/bac195b1f7db098b6af7e82435c42b9c14cc3e8a", "committedDate": "2020-01-13T21:42:21Z", "message": "Removing ignored test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e13cc24a32c1aa73d437cd551436e1159d5112d", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/8e13cc24a32c1aa73d437cd551436e1159d5112d", "committedDate": "2020-01-13T21:44:05Z", "message": "final DependencyGraphBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7110ec3b0c8d01b02a3c1ecf39949c350f4e94f1", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/7110ec3b0c8d01b02a3c1ecf39949c350f4e94f1", "committedDate": "2020-01-13T21:50:28Z", "message": "Test message on fail"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMTU1ODE5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-342155819", "createdAt": "2020-01-13T21:37:02Z", "commit": {"oid": "9d4281ccba2b556638cf5c384b0d47aed4a75670"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QyMTozNzowMlrOFdFZvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QyMTo0OToxMVrOFdFuHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA0MTUzNQ==", "bodyText": "Now we don't need to have these methods that use mavenRepositories, a mutable global variable.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366041535", "createdAt": "2020-01-13T21:37:02Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/RepositoryUtility.java", "diffHunk": "@@ -289,34 +296,6 @@ public static boolean shouldSkipBomMember(Artifact artifact) {\n     return false;\n   }\n \n-  /**\n-   * Sets {@link #mavenRepositories} to search for dependencies.\n-   *\n-   * @param addMavenCentral if true, add Maven Central to the end of the repository list\n-   * @throws IllegalArgumentException if a URL is malformed or not having an allowed scheme\n-   */\n-  public static void setRepositories(\n-      Iterable<String> mavenRepositoryUrls, boolean addMavenCentral) {\n-    ImmutableList.Builder<RemoteRepository> repositoryListBuilder = ImmutableList.builder();\n-    for (String mavenRepositoryUrl : mavenRepositoryUrls) {\n-      RemoteRepository repository = mavenRepositoryFromUrl(mavenRepositoryUrl);\n-      repositoryListBuilder.add(repository);\n-    }\n-\n-    if (addMavenCentral) {\n-      repositoryListBuilder.add(CENTRAL);\n-    }\n-\n-    mavenRepositories = repositoryListBuilder.build();\n-  }\n-\n-  /** Adds {@link #mavenRepositories} to {@code collectRequest}. */\n-  public static void addRepositoriesToRequest(CollectRequest collectRequest) {\n-    for (RemoteRepository repository : mavenRepositories) {\n-      collectRequest.addRepository(repository);\n-    }\n-  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d4281ccba2b556638cf5c384b0d47aed4a75670"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA0NjMyMg==", "bodyText": "No need to cleanup the mutable global variable any more.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366046322", "createdAt": "2020-01-13T21:48:12Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArgumentsTest.java", "diffHunk": "@@ -16,29 +16,14 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n-import com.google.cloud.tools.opensource.dependencies.RepositoryUtility;\n-import com.google.common.collect.ImmutableList;\n import com.google.common.truth.Truth;\n-import java.nio.file.Path;\n-import java.util.List;\n import org.apache.commons.cli.ParseException;\n import org.eclipse.aether.RepositoryException;\n-import org.eclipse.aether.artifact.Artifact;\n-import org.eclipse.aether.artifact.DefaultArtifact;\n-import org.eclipse.aether.collection.CollectRequest;\n-import org.eclipse.aether.repository.RemoteRepository;\n-import org.junit.After;\n import org.junit.Assert;\n import org.junit.Test;\n \n public class LinkageCheckerArgumentsTest {\n \n-  @After\n-  public void cleanup() {\n-    // Resets the effect of setRepositories\n-    RepositoryUtility.setRepositories(ImmutableList.of(), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e13cc24a32c1aa73d437cd551436e1159d5112d"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA0Njc0OQ==", "bodyText": "These tests have moved to DependencyGraphBuilderTest.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366046749", "createdAt": "2020-01-13T21:49:11Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArgumentsTest.java", "diffHunk": "@@ -89,42 +74,6 @@ public void parseCommandLineArguments_invalidOption() {\n     }\n   }\n \n-  @Test\n-  public void testConfigureAdditionalMavenRepositories_addingGoogleAndroidRepository()\n-      throws ParseException, RepositoryException {\n-    // Previously this test was using https://repo.spring.io/milestone and artifact\n-    // org.springframework:spring-asm:3.1.0.RC2 but the repository was not stable.\n-    LinkageCheckerArguments parsedArguments =\n-        LinkageCheckerArguments.readCommandLine(\n-            \"-j\", \"dummy.jar\", \"-m\", \"https://dl.google.com/dl/android/maven2\");\n-    RepositoryUtility.setRepositories(\n-        parsedArguments.getExtraMavenRepositoryUrls(), parsedArguments.getAddMavenCentral());\n-\n-    // This artifact does not exist in Maven central, but it is in Spring's repository\n-    // Spring-asm is used here because it does not have complex dependencies\n-    Artifact artifact = new DefaultArtifact(\"androidx.lifecycle:lifecycle-common-java8:2.0.0\");\n-\n-    List<Path> paths = ClassPathBuilder.artifactsToClasspath(ImmutableList.of(artifact));\n-    Truth.assertThat(paths).isNotEmpty();\n-  }\n-\n-  @Test\n-  public void testConfigureAdditionalMavenRepositories_notToUseMavenCentral()\n-      throws ParseException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e13cc24a32c1aa73d437cd551436e1159d5112d"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e834c2b5040703a946dc62d06ee4fcf4cc8891ab", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e834c2b5040703a946dc62d06ee4fcf4cc8891ab", "committedDate": "2020-01-13T22:01:23Z", "message": "Fixed typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbbdb185badb64aaa98d23c802b15dd4c28c28e8", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/bbbdb185badb64aaa98d23c802b15dd4c28c28e8", "committedDate": "2020-01-13T23:57:47Z", "message": "Merge branch 'master' into dependency_error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/ef3fee84df2d58df0d77d1be0b5d3e7bd107f022", "committedDate": "2020-01-14T01:44:04Z", "message": "Merge branch 'master' into dependency_error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNDk3OTIy", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-342497922", "createdAt": "2020-01-14T12:33:22Z", "commit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMjozMzoyMlrOFdV7xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMjo0MjoxNlrOFdWK0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxMjM5MQ==", "bodyText": "I agree. That's a reason to not make it a field, static or instance. artifactProblems is invocation state, not object state. This can cause problems even in single threaded environments.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366312391", "createdAt": "2020-01-14T12:33:22Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -57,13 +57,15 @@\n   private static final CharMatcher LOWER_ALPHA_NUMERIC =\n       CharMatcher.inRange('a', 'z').or(CharMatcher.inRange('0', '9'));\n \n+  private final List<UnresolvableArtifactProblem> artifactProblems = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyNTMxNw=="}, "originalCommit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxMjc5OQ==", "bodyText": "This one does make sense as a field.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366312799", "createdAt": "2020-01-14T12:34:15Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -57,13 +60,17 @@\n   private static final CharMatcher LOWER_ALPHA_NUMERIC =\n       CharMatcher.inRange('a', 'z').or(CharMatcher.inRange('0', '9'));\n \n+  private final List<UnresolvableArtifactProblem> artifactProblems = new ArrayList<>();\n+\n+  private final ImmutableList<RemoteRepository> repositories;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY0Mzg5Nw=="}, "originalCommit": {"oid": "040d63f807ba4f9f1311a35310c1825933ea31bb"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxMzAzMw==", "bodyText": "not having --> does not have", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366313033", "createdAt": "2020-01-14T12:34:45Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -108,20 +115,41 @@ private static String osDetectedArch() {\n     }\n   }\n \n-  private static DependencyNode resolveCompileTimeDependencies(\n-      DependencyNode rootDependencyArtifact)\n+  public DependencyGraphBuilder() {\n+    this(ImmutableList.of(CENTRAL.getUrl()));\n+  }\n+\n+  /**\n+   * @param mavenRepositoryUrls Maven repository URLs to search for dependencies\n+   * @throws IllegalArgumentException if a URL is malformed or not having an allowed scheme", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxMzgzMA==", "bodyText": "during constructing a --> while constructing the", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366313830", "createdAt": "2020-01-14T12:36:38Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -108,20 +115,41 @@ private static String osDetectedArch() {\n     }\n   }\n \n-  private static DependencyNode resolveCompileTimeDependencies(\n-      DependencyNode rootDependencyArtifact)\n+  public DependencyGraphBuilder() {\n+    this(ImmutableList.of(CENTRAL.getUrl()));\n+  }\n+\n+  /**\n+   * @param mavenRepositoryUrls Maven repository URLs to search for dependencies\n+   * @throws IllegalArgumentException if a URL is malformed or not having an allowed scheme\n+   */\n+  public DependencyGraphBuilder(Iterable<String> mavenRepositoryUrls) {\n+    ImmutableList.Builder<RemoteRepository> repositoryListBuilder = ImmutableList.builder();\n+    for (String mavenRepositoryUrl : mavenRepositoryUrls) {\n+      RemoteRepository repository = mavenRepositoryFromUrl(mavenRepositoryUrl);\n+      repositoryListBuilder.add(repository);\n+    }\n+    this.repositories = repositoryListBuilder.build();\n+  }\n+\n+  /** Returns unresolved artifact problems encountered during constructing a dependency graph. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxNTU5Nw==", "bodyText": "This object can only be used once. The instance state makes it not reusable. I suspect what we really need here is a static method that uses private classes and objects to keep track of the invocation state. However none of that should be exposed in the published API.\nAnd in any case, that's just an implementation detail. Looking at this, what you have is a static method. Everything that's being stored in the fields could be passed along through method arguments from one method call to the next.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366315597", "createdAt": "2020-01-14T12:40:48Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyLister.java", "diffHunk": "@@ -33,10 +32,10 @@ public static void main(String[] args) throws RepositoryException {\n     \n     try {\n       DefaultArtifact artifact = new DefaultArtifact(args[0]);\n-    \n-      DependencyGraph graph =\n-          DependencyGraphBuilder.getCompleteDependencies(artifact);\n-      \n+\n+      DependencyGraphBuilder dependencyGraphBuilder = new DependencyGraphBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxNjI0MA==", "bodyText": "Implementation detail. This should not change the public API.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366316240", "createdAt": "2020-01-14T12:42:16Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/UpdateReport.java", "diffHunk": "@@ -40,9 +39,9 @@ public static void main(String[] args) throws RepositoryException {\n     \n     try {\n       DefaultArtifact artifact = new DefaultArtifact(args[0]);\n-      \n-      DependencyGraph graph =\n-          DependencyGraphBuilder.getCompleteDependencies(artifact);\n+\n+      DependencyGraphBuilder dependencyGraphBuilder = new DependencyGraphBuilder();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyMjA5NA=="}, "originalCommit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e82a010b991b148ce395ccbd0db922aa2b99ca5f", "committedDate": "2020-01-15T02:14:16Z", "message": "DependencyGraphResult"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c077e811f41b4f126589fab11c5cd3fdbd62ae4d", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c077e811f41b4f126589fab11c5cd3fdbd62ae4d", "committedDate": "2020-01-15T02:15:19Z", "message": "Format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c9c4bb3c1edb364d5df4ab18d33383c1fbbdb82", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/8c9c4bb3c1edb364d5df4ab18d33383c1fbbdb82", "committedDate": "2020-01-15T02:26:01Z", "message": "javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24c68953a5df12034d8c5795116b157a4250bea9", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/24c68953a5df12034d8c5795116b157a4250bea9", "committedDate": "2020-01-15T02:26:40Z", "message": "Merge remote-tracking branch 'origin/master' into dependency_error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTU1Mzcz", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-342955373", "createdAt": "2020-01-15T02:18:47Z", "commit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMjoxODo0OFrOFdrotg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMjoyNDoxNVrOFdrtHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY2Nzk1OA==", "bodyText": "This field has been removed", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366667958", "createdAt": "2020-01-15T02:18:48Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -57,13 +57,15 @@\n   private static final CharMatcher LOWER_ALPHA_NUMERIC =\n       CharMatcher.inRange('a', 'z').or(CharMatcher.inRange('0', '9'));\n \n+  private final List<UnresolvableArtifactProblem> artifactProblems = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyNTMxNw=="}, "originalCommit": {"oid": "d1b8c35e6c1ce23acb2032064763daf4856417ed"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY2ODEyMA==", "bodyText": "Fixed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366668120", "createdAt": "2020-01-15T02:19:44Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -108,20 +115,41 @@ private static String osDetectedArch() {\n     }\n   }\n \n-  private static DependencyNode resolveCompileTimeDependencies(\n-      DependencyNode rootDependencyArtifact)\n+  public DependencyGraphBuilder() {\n+    this(ImmutableList.of(CENTRAL.getUrl()));\n+  }\n+\n+  /**\n+   * @param mavenRepositoryUrls Maven repository URLs to search for dependencies\n+   * @throws IllegalArgumentException if a URL is malformed or not having an allowed scheme", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxMzAzMw=="}, "originalCommit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY2ODIyNQ==", "bodyText": "Fixed in DependencyGraphResult.getArtifactProblems.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366668225", "createdAt": "2020-01-15T02:20:16Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -108,20 +115,41 @@ private static String osDetectedArch() {\n     }\n   }\n \n-  private static DependencyNode resolveCompileTimeDependencies(\n-      DependencyNode rootDependencyArtifact)\n+  public DependencyGraphBuilder() {\n+    this(ImmutableList.of(CENTRAL.getUrl()));\n+  }\n+\n+  /**\n+   * @param mavenRepositoryUrls Maven repository URLs to search for dependencies\n+   * @throws IllegalArgumentException if a URL is malformed or not having an allowed scheme\n+   */\n+  public DependencyGraphBuilder(Iterable<String> mavenRepositoryUrls) {\n+    ImmutableList.Builder<RemoteRepository> repositoryListBuilder = ImmutableList.builder();\n+    for (String mavenRepositoryUrl : mavenRepositoryUrls) {\n+      RemoteRepository repository = mavenRepositoryFromUrl(mavenRepositoryUrl);\n+      repositoryListBuilder.add(repository);\n+    }\n+    this.repositories = repositoryListBuilder.build();\n+  }\n+\n+  /** Returns unresolved artifact problems encountered during constructing a dependency graph. */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxMzgzMA=="}, "originalCommit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY2ODc3Mw==", "bodyText": "LinkageCheckerMain configures DependencyGraphBuilder's repository URLs.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366668773", "createdAt": "2020-01-15T02:22:42Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerMain.java", "diffHunk": "@@ -44,12 +47,20 @@ public static void main(String[] arguments)\n     LinkageCheckerArguments linkageCheckerArguments =\n         LinkageCheckerArguments.readCommandLine(arguments);\n \n-    RepositoryUtility.setRepositories(linkageCheckerArguments.getExtraMavenRepositoryUrls(),\n-        linkageCheckerArguments.getAddMavenCentral());\n+    DependencyGraphBuilder dependencyGraphBuilder =\n+        new DependencyGraphBuilder(linkageCheckerArguments.getMavenRepositoryUrls());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c077e811f41b4f126589fab11c5cd3fdbd62ae4d"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY2OTA4NQ==", "bodyText": "New class to hold dependency graph and artifact problems.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r366669085", "createdAt": "2020-01-15T02:24:15Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphResult.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+/** Result of dependency graph building with {@link UnresolvableArtifactProblem}s if any. */\n+public final class DependencyGraphResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c077e811f41b4f126589fab11c5cd3fdbd62ae4d"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05fc4612f030233d3644c0dc2743f4efa7823dc8", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/05fc4612f030233d3644c0dc2743f4efa7823dc8", "committedDate": "2020-01-15T15:28:35Z", "message": "Merge branch 'master' into dependency_error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29bd0ea1774ca1e355bead68acc7cac4054f52d6", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/29bd0ea1774ca1e355bead68acc7cac4054f52d6", "committedDate": "2020-01-15T16:17:55Z", "message": "Merge branch 'master' into dependency_error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c3d9882cfff9760f0d83a8266ebd5b790ea0dfe", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/6c3d9882cfff9760f0d83a8266ebd5b790ea0dfe", "committedDate": "2020-01-15T17:06:19Z", "message": "Merge branch 'master' into dependency_error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4395837ad68c0b18f6012d67ebcaa40a184d4bb2", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/4395837ad68c0b18f6012d67ebcaa40a184d4bb2", "committedDate": "2020-01-15T17:12:12Z", "message": "Fixed tests for HTTPS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d11d750662dcf09c55b99be1e94546b24ca622ad", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d11d750662dcf09c55b99be1e94546b24ca622ad", "committedDate": "2020-01-15T17:13:39Z", "message": "Merge branch 'dependency_error' of https://github.com/GoogleCloudPlatform/cloud-opensource-java into dependency_error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzODgyOTI3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-343882927", "createdAt": "2020-01-16T12:41:30Z", "commit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMjo0MTozMVrOFeYEoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMjo0NjoxOVrOFeYL7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5NjAwMQ==", "bodyText": "in resolving or collecting dependency --> resolving or collecting dependencies", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r367396001", "createdAt": "2020-01-16T12:41:31Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -229,7 +220,7 @@ private DependencyNode resolveCompileTimeDependencies(\n    * @return dependency graph representing the tree of Maven artifacts\n    * @throws RepositoryException when there is a problem in resolving or collecting dependency", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5NjY5NQ==", "bodyText": "public final (or just final if it doesn't need to be public)", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r367396695", "createdAt": "2020-01-16T12:43:22Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphResult.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+/** Result of dependency graph building with {@link UnresolvableArtifactProblem}s if any. */\n+final public class DependencyGraphResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5Nzg3MQ==", "bodyText": "We don't seem to use this method except in tests. What am I missing?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r367397871", "createdAt": "2020-01-16T12:46:19Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphResult.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+/** Result of dependency graph building with {@link UnresolvableArtifactProblem}s if any. */\n+final public class DependencyGraphResult {\n+\n+  private final DependencyGraph dependencyGraph;\n+  private final ImmutableList<UnresolvableArtifactProblem> artifactProblems;\n+\n+  DependencyGraphResult(\n+      DependencyGraph dependencyGraph, Iterable<UnresolvableArtifactProblem> artifactProblems) {\n+    this.dependencyGraph = checkNotNull(dependencyGraph);\n+    this.artifactProblems = ImmutableList.copyOf(artifactProblems);\n+  };\n+\n+  public DependencyGraph getDependencyGraph() {\n+    return dependencyGraph;\n+  }\n+\n+  /**\n+   * Returns problems encountered while constructing the dependency graph.\n+   */\n+  ImmutableList<UnresolvableArtifactProblem> getArtifactProblems() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfeef922b0430c51417d3ddacee3b6a726e1d56e", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/cfeef922b0430c51417d3ddacee3b6a726e1d56e", "committedDate": "2020-01-16T13:49:32Z", "message": "Merge remote-tracking branch 'origin/master' into dependency_error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b95d9910f87bbaf7e7981bec202970fe17622a5e", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b95d9910f87bbaf7e7981bec202970fe17622a5e", "committedDate": "2020-01-16T13:58:31Z", "message": "Applied review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTI1MTI3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-343925127", "createdAt": "2020-01-16T13:52:30Z", "commit": {"oid": "d11d750662dcf09c55b99be1e94546b24ca622ad"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMzo1MjozMFrOFeaAUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMzo1NzoxOVrOFeaKbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQyNzY2Ng==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r367427666", "createdAt": "2020-01-16T13:52:30Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -229,7 +220,7 @@ private DependencyNode resolveCompileTimeDependencies(\n    * @return dependency graph representing the tree of Maven artifacts\n    * @throws RepositoryException when there is a problem in resolving or collecting dependency", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5NjAwMQ=="}, "originalCommit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQyODc2NQ==", "bodyText": "Marked as @VisibleForTesting for now.\nThis PR is second step of the change to show unresolved artifact at the end, focusing on DependencyGraphBuilder non-static. I will create next PR to use getArtifactProblems in ClassPathBuilder and LinkageCheckerMain to show them.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r367428765", "createdAt": "2020-01-16T13:54:33Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphResult.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+/** Result of dependency graph building with {@link UnresolvableArtifactProblem}s if any. */\n+final public class DependencyGraphResult {\n+\n+  private final DependencyGraph dependencyGraph;\n+  private final ImmutableList<UnresolvableArtifactProblem> artifactProblems;\n+\n+  DependencyGraphResult(\n+      DependencyGraph dependencyGraph, Iterable<UnresolvableArtifactProblem> artifactProblems) {\n+    this.dependencyGraph = checkNotNull(dependencyGraph);\n+    this.artifactProblems = ImmutableList.copyOf(artifactProblems);\n+  };\n+\n+  public DependencyGraph getDependencyGraph() {\n+    return dependencyGraph;\n+  }\n+\n+  /**\n+   * Returns problems encountered while constructing the dependency graph.\n+   */\n+  ImmutableList<UnresolvableArtifactProblem> getArtifactProblems() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5Nzg3MQ=="}, "originalCommit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQyOTI1Ng==", "bodyText": "As discussed, I'll make DependencyGraphBuilder non-static.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r367429256", "createdAt": "2020-01-16T13:55:33Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyLister.java", "diffHunk": "@@ -33,10 +32,10 @@ public static void main(String[] args) throws RepositoryException {\n     \n     try {\n       DefaultArtifact artifact = new DefaultArtifact(args[0]);\n-    \n-      DependencyGraph graph =\n-          DependencyGraphBuilder.getCompleteDependencies(artifact);\n-      \n+\n+      DependencyGraphBuilder dependencyGraphBuilder = new DependencyGraphBuilder();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxNTU5Nw=="}, "originalCommit": {"oid": "ef3fee84df2d58df0d77d1be0b5d3e7bd107f022"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQzMDI1NA==", "bodyText": "Updated to public final. This is public because ClassPathBuilder in a different package touches this.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#discussion_r367430254", "createdAt": "2020-01-16T13:57:19Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphResult.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.common.collect.ImmutableList;\n+\n+/** Result of dependency graph building with {@link UnresolvableArtifactProblem}s if any. */\n+final public class DependencyGraphResult {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5NjY5NQ=="}, "originalCommit": {"oid": "e82a010b991b148ce395ccbd0db922aa2b99ca5f"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MDAxODA0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1097#pullrequestreview-344001804", "createdAt": "2020-01-16T15:33:16Z", "commit": {"oid": "b95d9910f87bbaf7e7981bec202970fe17622a5e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1259, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}