{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3OTkzNDk0", "number": 1239, "title": "LevelOrder not to call resolveCompileDependencies", "bodyText": "Fixes #1188 .\nThis fixes the bug of DependencyGraphBuilder applying exclusions elements only to its child's dependencies, rather than the entire subtree.\nIn go/jdd-tree-comparison, this bug is marked in the red rectable below", "createdAt": "2020-02-20T21:51:25Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239", "merged": true, "mergeCommit": {"oid": "3105f29a55a38a2a51d04151154861c006f7b437"}, "closed": true, "closedAt": "2020-02-24T19:10:54Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFmGWfAH2gAyMzc3OTkzNDk0OmFjMWQzNTEwYTkxMjg0NDRhZGJkNDU3MGE2ZjViNTk3YzE0ODI1NWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHiGkdAH2gAyMzc3OTkzNDk0OjFkNjg1MzA5MTE4YzMyYzE1MzU2ZmQ1NzdhZGIzNzMwOGE3NDgwMWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac1d3510a9128444adbd4570a6f5b597c148255f", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/ac1d3510a9128444adbd4570a6f5b597c148255f", "committedDate": "2020-02-18T18:19:02Z", "message": "CycleBreakingGraphTransformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51b56f138abf1ea650069461755a721598390bc8", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/51b56f138abf1ea650069461755a721598390bc8", "committedDate": "2020-02-20T21:10:26Z", "message": "Merge remote-tracking branch 'origin/master' into resolveCompileDependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a0a508dbc5919fabe6e05390f949c3934312ea22", "committedDate": "2020-02-20T21:49:32Z", "message": "fixed dashboard test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjYyMTg0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#pullrequestreview-362262184", "createdAt": "2020-02-20T21:55:20Z", "commit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMTo1NToyMVrOFskfhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMTo1NToyMVrOFskfhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI3OTU1OA==", "bodyText": "Before this fix the artifact report for grpc-google-common-protos was showing Upper Bound Fixes for jsr305 version 3.0.1. But that version should not appear in the tree because grpc-core declares exclusions.\nTree: https://screenshot.googleplex.com/g8cQ3BXq36O.png", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382279558", "createdAt": "2020-02-20T21:55:21Z", "author": {"login": "suztomo"}, "path": "dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java", "diffHunk": "@@ -332,10 +332,13 @@ public void testComponent_success() throws IOException, ParsingException {\n   public void testComponent_failure() throws IOException, ParsingException {\n     Document document = parseOutputFile(\n         \"com.google.api.grpc_grpc-google-common-protos_1.14.0.html\");\n+\n+    // com.google.api.grpc:grpc-google-common-protos:1.14.0 selects the highest version of all dependencies.\n     Nodes greens = document.query(\"//h3[@style='color: green']\");\n-    Assert.assertEquals(0, greens.size());\n+    Assert.assertEquals(1, greens.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjgwMTc1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#pullrequestreview-362280175", "createdAt": "2020-02-20T22:27:35Z", "commit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48366c22eace4310fd99682cd8672bb180899c41", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/48366c22eace4310fd99682cd8672bb180899c41", "committedDate": "2020-02-20T22:35:00Z", "message": "Javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjYzMDE5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#pullrequestreview-362263019", "createdAt": "2020-02-20T21:56:45Z", "commit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMTo1Njo0NVrOFskh_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMTo1OTo0MFrOFsknOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDE5MQ==", "bodyText": "This is the main purpose of this fix. The levelOrder does not need to call resolveCompileTimeDependencies.\nThis implementation was not preserving exclusions element.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382280191", "createdAt": "2020-02-20T21:56:45Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -358,29 +351,6 @@ private DependencyGraphResult levelOrder(\n         path.add(dependencyNode.getDependency());\n         parentNodes.push(dependencyNode);\n         graph.addPath(path);\n-\n-        if (resolveFullDependency && !\"system\".equals(dependencyNode.getDependency().getScope())) {\n-          try {\n-            dependencyNode =\n-                resolveCompileTimeDependencies(\n-                    ImmutableList.of(dependencyNode), resolveFullDependency);\n-          } catch (DependencyResolutionException resolutionException) {\n-            // A dependency may be unavailable. For example, com.google.guava:guava-gwt:jar:20.0\n-            // has a transitive dependency to org.eclipse.jdt.core.compiler:ecj:jar:4.4RC4 (not\n-            // found in Maven central)\n-            for (ArtifactResult artifactResult :\n-                resolutionException.getResult().getArtifactResults()) {\n-              if (artifactResult.getArtifact() == null) {\n-                DependencyNode failedDependencyNode =\n-                    artifactResult.getRequest().getDependencyNode();\n-                \n-                List<DependencyNode> fullPath = makeFullPath(parentNodes, failedDependencyNode);\n-                \n-                artifactProblems.add(new UnresolvableArtifactProblem(fullPath));\n-              }\n-            }\n-          }\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDkwOQ==", "bodyText": "Before this PR, this test would fail because levelOrder was not respecting exclusion elements.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382280909", "createdAt": "2020-02-20T21:58:16Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilderTest.java", "diffHunk": "@@ -250,4 +250,36 @@ public void testBuildLinkageCheckDependencyGraph_catchRootException() throws Rep\n             \"xml-apis:xml-apis:jar:2.6.2 was not resolved. Dependency path: ant:ant:jar:1.6.2\"\n                 + \" (compile) > xml-apis:xml-apis:jar:2.6.2 (compile?)\");\n   }\n+\n+  @Test\n+  public void testAlts_exclusionElements() throws RepositoryException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MTUyOQ==", "bodyText": "The nodes in the tree changed because now exclusion elements take effect entire subtree.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382281529", "createdAt": "2020-02-20T21:59:40Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphIntegrationTest.java", "diffHunk": "@@ -74,8 +74,6 @@ public void testFindUpdates() throws RepositoryException {\n                 + \"upgrade com.google.protobuf:protobuf-java:3.5.1 to 3.6.0\",\n             \"com.google.api.grpc:proto-google-iam-v1:0.12.0 needs to \"\n                 + \"upgrade com.google.protobuf:protobuf-java:3.5.1 to 3.6.0\",\n-            \"com.google.guava:guava-jdk5:17.0 needs to \"\n-                + \"upgrade com.google.code.findbugs:jsr305:1.3.9 to 3.0.2\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0a508dbc5919fabe6e05390f949c3934312ea22"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "844032beb979db4fab09fb690b9e8be65a3f6c6c", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/844032beb979db4fab09fb690b9e8be65a3f6c6c", "committedDate": "2020-02-21T16:42:55Z", "message": "Added test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0ad980e85bd36cc49f470c46a759eda527d8050", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c0ad980e85bd36cc49f470c46a759eda527d8050", "committedDate": "2020-02-21T16:50:33Z", "message": "Merge remote-tracking branch 'origin/master' into resolveCompileDependencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzcxMzc1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#pullrequestreview-362771375", "createdAt": "2020-02-21T16:52:21Z", "commit": {"oid": "c0ad980e85bd36cc49f470c46a759eda527d8050"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNjo1MjoyMVrOFs9qxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNjo1Mzo1M1rOFs9t3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY5MjAzNw==", "bodyText": "No need to wrap DependencyGraph with DependencyGraphResult. Because this function does not encounter UnresolvedArtifactProblem any more.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382692037", "createdAt": "2020-02-21T16:52:21Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -316,15 +313,11 @@ public static UnresolvableArtifactProblem createUnresolvableArtifactProblem(\n    * just follows the given dependency tree starting with firstNode.\n    *\n    * @param firstNode node to start traversal\n-   * @param graphTraversalOption option to recursively resolve the dependency to build complete\n-   *     dependency tree, with or without dependencies of provided scope\n    */\n-  private DependencyGraphResult levelOrder(\n-      DependencyNode firstNode, GraphTraversalOption graphTraversalOption) {\n+  private DependencyGraph levelOrder(DependencyNode firstNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0ad980e85bd36cc49f470c46a759eda527d8050"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY5MjgzMA==", "bodyText": "Without this class, this test would throw StackOverflowError.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382692830", "createdAt": "2020-02-21T16:53:53Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformerTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import org.eclipse.aether.DefaultRepositorySystemSession;\n+import org.eclipse.aether.RepositorySystem;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n+import org.eclipse.aether.collection.CollectRequest;\n+import org.eclipse.aether.graph.Dependency;\n+import org.eclipse.aether.resolution.DependencyRequest;\n+import org.eclipse.aether.resolution.DependencyResolutionException;\n+import org.eclipse.aether.util.graph.selector.ScopeDependencySelector;\n+import org.eclipse.aether.util.graph.transformer.ChainedDependencyGraphTransformer;\n+import org.eclipse.aether.util.graph.transformer.JavaDependencyContextRefiner;\n+import org.junit.Test;\n+\n+public class CycleBreakerGraphTransformerTest {\n+\n+  @Test\n+  public void testCycleBreaking() throws DependencyResolutionException {\n+    RepositorySystem system = RepositoryUtility.newRepositorySystem();\n+    DefaultRepositorySystemSession session =\n+        RepositoryUtility.createDefaultRepositorySystemSession(system);\n+\n+    // This dependencySelector selects everything except test scope. This creates a dependency tree\n+    // with a cycle of dom4j:dom4j:jar:1.6.1 (optional) and jaxen:jaxen:jar:1.1-beta-6 (optional).\n+    session.setDependencySelector(new ScopeDependencySelector(\"test\"));\n+\n+    session.setDependencyGraphTransformer(\n+        new ChainedDependencyGraphTransformer(\n+            new CycleBreakerGraphTransformer(), // This prevents StackOverflowError", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0ad980e85bd36cc49f470c46a759eda527d8050"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b2bca2da44558c206986852490ce1913945e33d6", "committedDate": "2020-02-21T16:58:02Z", "message": "Explicitly specifying repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39ed66436a98cd40bed2130c9866180b9a07c1de", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/39ed66436a98cd40bed2130c9866180b9a07c1de", "committedDate": "2020-02-21T18:39:12Z", "message": "Merge remote-tracking branch 'origin/master' into resolveCompileDependencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODU1OTMw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#pullrequestreview-362855930", "createdAt": "2020-02-21T19:15:02Z", "commit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOToxNTowM1rOFtBtlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOToyMTowN1rOFtB38Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1ODI5NQ==", "bodyText": "There's only one parent. Perhaps this is ancestors? e.g. like in XPath", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382758295", "createdAt": "2020-02-21T19:15:03Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1ODg3MA==", "bodyText": "Is node the child to remove? If so, rename to child.\nAlso it could be a tad clearer if the argument order match the method name. That is,\nremoveChildFromParent( DependencyNode child, DependencyNode parent)", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382758870", "createdAt": "2020-02-21T19:16:15Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {\n+    Artifact artifact = node.getArtifact();\n+    if (parents.contains(artifact)) {\n+      // parent is not null when parents is not empty\n+      removeChildFromParent(parent, node);\n+      return;\n+    }\n+\n+    parents.add(artifact);\n+    for (DependencyNode child : node.getChildren()) {\n+      removeCycle(node, child, parents);\n+    }\n+    parents.remove(artifact);\n+  }\n+\n+  private void removeChildFromParent(DependencyNode parent, DependencyNode node) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1OTE1Ng==", "bodyText": "I think this method can be static", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382759156", "createdAt": "2020-02-21T19:16:57Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {\n+    Artifact artifact = node.getArtifact();\n+    if (parents.contains(artifact)) {\n+      // parent is not null when parents is not empty\n+      removeChildFromParent(parent, node);\n+      return;\n+    }\n+\n+    parents.add(artifact);\n+    for (DependencyNode child : node.getChildren()) {\n+      removeCycle(node, child, parents);\n+    }\n+    parents.remove(artifact);\n+  }\n+\n+  private void removeChildFromParent(DependencyNode parent, DependencyNode node) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2MDUyNA==", "bodyText": "Set feels wrong for parents, because these are ordered, even if we're not using the order here.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382760524", "createdAt": "2020-02-21T19:20:15Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {\n+    Artifact artifact = node.getArtifact();\n+    if (parents.contains(artifact)) {\n+      // parent is not null when parents is not empty\n+      removeChildFromParent(parent, node);\n+      return;\n+    }\n+\n+    parents.add(artifact);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2MDk0NQ==", "bodyText": "static", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382760945", "createdAt": "2020-02-21T19:21:07Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "098b05b1dd748a52b6b050f2b8caae5d15660aee", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/098b05b1dd748a52b6b050f2b8caae5d15660aee", "committedDate": "2020-02-21T19:28:42Z", "message": "Merge remote-tracking branch 'origin/master' into resolveCompileDependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4f71cf0f00daca89b37e3cad64584fab071c5a1", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b4f71cf0f00daca89b37e3cad64584fab071c5a1", "committedDate": "2020-02-21T19:36:44Z", "message": "Applied review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "643618d01abca073b5dadb7f42cb936c63769983", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/643618d01abca073b5dadb7f42cb936c63769983", "committedDate": "2020-02-21T19:37:04Z", "message": "Format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODY1NjUw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#pullrequestreview-362865650", "createdAt": "2020-02-21T19:31:27Z", "commit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTozMToyN1rOFtCK-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTozNTowM1rOFtCRTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2NTgxNg==", "bodyText": "Updated", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382765816", "createdAt": "2020-02-21T19:31:27Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2MDk0NQ=="}, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2NTg5NA==", "bodyText": "Nice. Updated to ancestor.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382765894", "createdAt": "2020-02-21T19:31:37Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1ODI5NQ=="}, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2NzExNw==", "bodyText": "Set is preferred here. Using a Set for ancestors gives O(1) lookup. At line 47:\nif (ancestors.contains(artifact)) {", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382767117", "createdAt": "2020-02-21T19:34:19Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {\n+    Artifact artifact = node.getArtifact();\n+    if (parents.contains(artifact)) {\n+      // parent is not null when parents is not empty\n+      removeChildFromParent(parent, node);\n+      return;\n+    }\n+\n+    parents.add(artifact);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2MDUyNA=="}, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2NzMyOA==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382767328", "createdAt": "2020-02-21T19:34:48Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {\n+    Artifact artifact = node.getArtifact();\n+    if (parents.contains(artifact)) {\n+      // parent is not null when parents is not empty\n+      removeChildFromParent(parent, node);\n+      return;\n+    }\n+\n+    parents.add(artifact);\n+    for (DependencyNode child : node.getChildren()) {\n+      removeCycle(node, child, parents);\n+    }\n+    parents.remove(artifact);\n+  }\n+\n+  private void removeChildFromParent(DependencyNode parent, DependencyNode node) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1ODg3MA=="}, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2NzQzNg==", "bodyText": "Updated to static.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382767436", "createdAt": "2020-02-21T19:35:03Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private void removeCycle(DependencyNode parent, DependencyNode node, Set<Artifact> parents) {\n+    Artifact artifact = node.getArtifact();\n+    if (parents.contains(artifact)) {\n+      // parent is not null when parents is not empty\n+      removeChildFromParent(parent, node);\n+      return;\n+    }\n+\n+    parents.add(artifact);\n+    for (DependencyNode child : node.getChildren()) {\n+      removeCycle(node, child, parents);\n+    }\n+    parents.remove(artifact);\n+  }\n+\n+  private void removeChildFromParent(DependencyNode parent, DependencyNode node) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1OTE1Ng=="}, "originalCommit": {"oid": "b2bca2da44558c206986852490ce1913945e33d6"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyOTMyNjkw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#pullrequestreview-362932690", "createdAt": "2020-02-21T21:38:25Z", "commit": {"oid": "643618d01abca073b5dadb7f42cb936c63769983"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMTozODoyNVrOFtFWEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMTozODoyNVrOFtFWEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgxNzgwOA==", "bodyText": "How many elements are we talking about though? 10? Maybe 20 at the outside? Even if it were 1000 the difference is unlikely to be measurable.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1239#discussion_r382817808", "createdAt": "2020-02-21T21:38:25Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/CycleBreakerGraphTransformer.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.dependencies;\n+\n+import com.google.common.collect.ImmutableList;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.eclipse.aether.RepositoryException;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.collection.DependencyGraphTransformationContext;\n+import org.eclipse.aether.collection.DependencyGraphTransformer;\n+import org.eclipse.aether.graph.DependencyNode;\n+\n+/**\n+ * Transforms a dependency graph so that it will not contain cycles.\n+ *\n+ * <p>A cycle in a dependency graph is a situation where a path to a node from the root contains the\n+ * same node. For example, jaxen 1.1-beta-6 is known to have cycle with dom4j 1.6.1.\n+ */\n+final class CycleBreakerGraphTransformer implements DependencyGraphTransformer {\n+\n+  @Override\n+  public DependencyNode transformGraph(\n+      DependencyNode dependencyNode, DependencyGraphTransformationContext context)\n+      throws RepositoryException {\n+\n+    removeCycle(null, dependencyNode, new HashSet<>());\n+    return dependencyNode;\n+  }\n+\n+  private static void removeCycle(\n+      DependencyNode parent, DependencyNode node, Set<Artifact> ancestors) {\n+    Artifact artifact = node.getArtifact();\n+\n+    if (ancestors.contains(artifact)) { // Set (rather than List) gives O(1) lookup here\n+      // parent is not null when ancestors is not empty", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "643618d01abca073b5dadb7f42cb936c63769983"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1577c3d7a28cacfb0a79907f6eadaaeb01ab17e", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e1577c3d7a28cacfb0a79907f6eadaaeb01ab17e", "committedDate": "2020-02-21T22:16:33Z", "message": "Merge branch 'master' into resolveCompileDependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c341ce268767b22b31ebda3d228cb184804ef5a", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1c341ce268767b22b31ebda3d228cb184804ef5a", "committedDate": "2020-02-24T17:28:25Z", "message": "Merge branch 'master' into resolveCompileDependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d685309118c32c15356fd577adb37308a74801f", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1d685309118c32c15356fd577adb37308a74801f", "committedDate": "2020-02-24T18:47:30Z", "message": "Merge branch 'master' into resolveCompileDependencies"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 488, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}