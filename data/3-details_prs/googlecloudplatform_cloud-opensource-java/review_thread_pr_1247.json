{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MDk4MjI5", "number": 1247, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo1MToxNlrODicCDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo1MzoxOVrODidPiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDM3NDUzOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo1MToxNlrOFtr0pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOToxMzoxM1rOFtsgXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0ODIzMA==", "bodyText": "It feels very strange that there's a classpath result hiding inside the command line arguments class. Is there a more appropriate abstraction here?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383448230", "createdAt": "2020-02-24T18:51:16Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -60,7 +58,7 @@\n   private static final HelpFormatter helpFormatter = new HelpFormatter();\n \n   private final CommandLine commandLine;\n-  private ImmutableList<Path> cachedInputClasspath;\n+  private ClassPathResult classPathResult;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782ff55a174e2190ebe3ce607df64c85ebd5082c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ1OTQyMQ==", "bodyText": "I've been feeling that strangeness. Let me update them.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383459421", "createdAt": "2020-02-24T19:13:13Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -60,7 +58,7 @@\n   private static final HelpFormatter helpFormatter = new HelpFormatter();\n \n   private final CommandLine commandLine;\n-  private ImmutableList<Path> cachedInputClasspath;\n+  private ClassPathResult classPathResult;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0ODIzMA=="}, "originalCommit": {"oid": "782ff55a174e2190ebe3ce607df64c85ebd5082c"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDUzNjM2OnYy", "diffSide": "LEFT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo0MjoxOFrOFttaMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo0MjoxOFrOFttaMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3NDIyNQ==", "bodyText": "Now it's LinkageCheckerMain's responsibility to resolve the class path through dependency graphs.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383474225", "createdAt": "2020-02-24T19:42:18Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -190,47 +184,15 @@ private static Options configureOptions() {\n     }\n   }\n \n-  /**\n-   * Returns a list of absolute paths to jar files for the option. The list includes dependencies if\n-   * BOM or Maven coordinates are specified in the option.\n-   */\n-  ImmutableList<Path> getInputClasspath() throws RepositoryException {\n-    if (cachedInputClasspath != null) {\n-      // Avoid unnecessary dependency resolution, which Cloud OSS BOM takes around 4 seconds\n-      return cachedInputClasspath;\n-    }\n-\n-    if (commandLine.hasOption(\"b\") || commandLine.hasOption(\"a\")) {\n-      List<Artifact> artifacts = getArtifacts();\n-      ClassPathResult result = classPathBuilder.resolve(artifacts);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2d5b88d32d0c17a5603c0518a575214b3e9afa7"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDU2Nzg5OnYy", "diffSide": "LEFT", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo1MTozNlrOFtttPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo1MTozNlrOFtttPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3OTEwMA==", "bodyText": "This test has been moved to LinkageCheckerArgumentTest.testGetJarFiles_jarFileList", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383479100", "createdAt": "2020-02-24T19:51:36Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -658,44 +663,32 @@ public void testGenerateInputClasspathFromLinkageCheckOption_mavenCoordinates_mi\n     LinkageCheckerArguments parsedArguments =\n         LinkageCheckerArguments.readCommandLine(\"--artifacts\", \"com.google.guava:guava-gwt:20.0\");\n \n-    ImmutableList<Path> inputClasspath = parsedArguments.getInputClasspath();\n+    ImmutableList<Path> inputClasspath =\n+        classPathBuilder.resolve(parsedArguments.getArtifacts()).getClassPath();\n \n     Truth.assertThat(inputClasspath)\n         .comparingElementsUsing(PATH_FILE_NAMES)\n         .contains(\"apache-jsp-8.0.9.M3.jar\");\n   }\n \n   @Test\n-  public void testGenerateInputClasspathFromLinkageCheckOption_failOnMissingDependency()\n-      throws ParseException {\n+  public void testGenerateInputClasspathFromLinkageCheckOption_recordMissingDependency()\n+      throws ParseException, RepositoryException {\n     // tomcat-jasper has missing dependency (not optional):\n     //   org.apache.tomcat:tomcat-jasper:jar:8.0.9\n     //     org.eclipse.jdt.core.compiler:ecj:jar:4.4RC4 (not found in Maven central)\n     LinkageCheckerArguments parsedArguments =\n         LinkageCheckerArguments.readCommandLine(\n             \"--artifacts\", \"org.apache.tomcat:tomcat-jasper:8.0.9\");\n \n-    try {\n-      parsedArguments.getInputClasspath();\n-      Assert.fail(\n-          \"Because the unavailable dependency is not optional, it should throw an exception\");\n-    } catch (RepositoryException ex) {\n-      Truth.assertThat(ex.getMessage())\n-          .startsWith(\"Unresolved artifacts: org.eclipse.jdt.core.compiler:ecj:jar:4.4RC4\");\n-    }\n-  }\n-\n-  @Test\n-  public void testGenerateInputClasspath_jarFileList()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDU2OTk3OnYy", "diffSide": "LEFT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo1MjoyNFrOFttujg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo1MjoyNFrOFttujg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3OTQzOA==", "bodyText": "LinkageCheckerArguments is no longer responsible to resolve the class path.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383479438", "createdAt": "2020-02-24T19:52:24Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -60,12 +56,10 @@\n   private static final HelpFormatter helpFormatter = new HelpFormatter();\n \n   private final CommandLine commandLine;\n-  private ImmutableList<Path> cachedInputClasspath;\n   private ImmutableList<Artifact> cachedArtifacts;\n   private final ImmutableList<String> extraMavenRepositoryUrls;\n   private final boolean addMavenCentral;\n   private final boolean reportOnlyReachable;\n-  private final ClassPathBuilder classPathBuilder = new ClassPathBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDU3Mjg4OnYy", "diffSide": "LEFT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo1MzoxOVrOFttwXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTo1MzoxOVrOFttwXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3OTkwMw==", "bodyText": "LinkageCheckerArguments is no longer responsible to resolve the class path. Therefore it does not know class path (cachedInputClasspath variable).", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1247#discussion_r383479903", "createdAt": "2020-02-24T19:53:19Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerArguments.java", "diffHunk": "@@ -60,12 +56,10 @@\n   private static final HelpFormatter helpFormatter = new HelpFormatter();\n \n   private final CommandLine commandLine;\n-  private ImmutableList<Path> cachedInputClasspath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c8d895cdeb55b5fa0cc20e5513a7f8bf55dd048"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2829, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}