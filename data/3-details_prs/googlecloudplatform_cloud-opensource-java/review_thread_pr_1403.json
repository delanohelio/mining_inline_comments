{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NjMxOTM2", "number": 1403, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1NDoxNVrOD8QAhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozMDo0MlrOD9cgdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NTAzNDMwOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1NDoxNVrOGVE4Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1NDoxNVrOGVE4Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1MzIyNw==", "bodyText": "This is the root cause of the problem. LinkageChecker was checking the existence of a class by class binary name (e.g., pzrep.ReportServlet), while the ClassPathEntry.getClassNames() returns a set of class file names (e.g., WEB-INF.classes.pzrep.ReportServlet).", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r424753227", "createdAt": "2020-05-13T21:54:15Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -202,9 +209,12 @@ private LinkageChecker(\n         classToSymbols.getClassToFieldSymbols();\n     for (ClassFile classFile : classToFieldSymbols.keySet()) {\n       ImmutableSet<FieldSymbol> fieldSymbols = classToFieldSymbols.get(classFile);\n+      ImmutableSet<String> classFileNamesInSource =\n+          classFile.getClassPathEntry().getClassFileNames();\n       for (FieldSymbol fieldSymbol : fieldSymbols) {\n-        if (!classFile.getClassPathEntry().getClassNames()\n-            .contains(fieldSymbol.getClassBinaryName())) {\n+        String classBinaryName = fieldSymbol.getClassBinaryName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NTA0MzU1OnYy", "diffSide": "RIGHT", "path": "enforcer-rules/src/it/war-project-private-modifier/src/main/java/com.google.example/Dummy.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1Nzo0MVrOGVE94g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1Nzo0MVrOGVE94g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1NDY1OA==", "bodyText": "This integration test case would fail with the latest enforcer rule 1.4.0:\nhttps://gist.github.com/suztomo/859543af569e53c7ba06fde6ec1f68ba", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r424754658", "createdAt": "2020-05-13T21:57:41Z", "author": {"login": "suztomo"}, "path": "enforcer-rules/src/it/war-project-private-modifier/src/main/java/com.google.example/Dummy.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.example;\n+\n+class Dummy {\n+  private int privateField = 0;\n+\n+  private int privateMethod() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzE3MTc5OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjoyMzoyMlrOGVZs-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDowNTozMVrOGVd60A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NDM5Mg==", "bodyText": "\"Returns class file name\" --> Converts a binary name to a class file name.\nIt is not a location. It is a name.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425094392", "createdAt": "2020-05-14T12:23:22Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE2MzQ3Mg==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425163472", "createdAt": "2020-05-14T14:05:31Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NDM5Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzE3NTI4OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjoyNDoyN1rOGVZvPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDowMzoxOFrOGVd0og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NDk3Mg==", "bodyText": "a framework-specific", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425094972", "createdAt": "2020-05-14T12:24:27Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE2MTg5MA==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425161890", "createdAt": "2020-05-14T14:03:18Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NDk3Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzE4MzM0OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjoyNjo0NlrOGVZ0PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTowNzoxMVrOGWIyKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NjI1Mg==", "bodyText": "This logic belongs in ClassPathEntry and ClassFile, not here.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425096252", "createdAt": "2020-05-14T12:26:46Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-\n+   * specific prefix such as \"WEB-INF.classes\".\n+   */\n+  String getClassFileName(String classBinaryName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE2MTEyNw==", "bodyText": "ClassPathEntry cannot convert class binary names to class file names, because it does not read the content of .class files. On the other hand, ClassDumper (through classRepository) already reads the content of class files and thus can convert class binary names to class file names.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425161127", "createdAt": "2020-05-14T14:02:14Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-\n+   * specific prefix such as \"WEB-INF.classes\".\n+   */\n+  String getClassFileName(String classBinaryName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NjI1Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1NDEyNA==", "bodyText": "How is BCEL getting these names? Is it reading the individual .class files? Or does it know something we don't know about the format of JAR files?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425254124", "createdAt": "2020-05-14T16:05:22Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-\n+   * specific prefix such as \"WEB-INF.classes\".\n+   */\n+  String getClassFileName(String classBinaryName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NjI1Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1ODE4MA==", "bodyText": "BCEL's JavaClass reads class name from class file's constant pool: https://github.com/apache/commons-bcel/blob/master/src/main/java/org/apache/bcel/classfile/JavaClass.java#L157", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425258180", "createdAt": "2020-05-14T16:11:11Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-\n+   * specific prefix such as \"WEB-INF.classes\".\n+   */\n+  String getClassFileName(String classBinaryName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NjI1Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI4NTM5NQ==", "bodyText": "It feels right that readClassFileNames be the place this happens, if necessary by reading the byte code, though perhaps there's a simpler way to do this. For instance we could strip off known prefixes.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425285395", "createdAt": "2020-05-14T16:49:44Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-\n+   * specific prefix such as \"WEB-INF.classes\".\n+   */\n+  String getClassFileName(String classBinaryName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NjI1Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg2NTc3MA==", "bodyText": "As the classRepository maintains the mappings, we do not need to read the class files again in ClassPathEntry.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425865770", "createdAt": "2020-05-15T15:07:11Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -334,6 +334,19 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(classFileNameToClassPathEntry.get(specialLocation), null);\n   }\n \n+  /**\n+   * Returns class file name which is a location of a class file within a JAR file. Usually it is\n+   * the same as {@code classBinaryName}, however it may be different if the JAR file has framework-\n+   * specific prefix such as \"WEB-INF.classes\".\n+   */\n+  String getClassFileName(String classBinaryName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NjI1Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzE5MDUyOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjoyODo0N1rOGVZ4pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDowNzozNVrOGVeAxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NzM4Mg==", "bodyText": "I'm hesitant to expose implementation details in API doc", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425097382", "createdAt": "2020-05-14T12:28:47Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -112,13 +113,18 @@ private void readClassFileNames() throws IOException {\n       this.classFileNames = classNames.build();\n     }\n   }\n-  \n+\n   /**\n-   * Returns the fully qualified names of the classes in this entry's jar file.\n-   * \n+   * Returns a list of class file names in {@link #jar} as in {@link JavaClass#getFileName()}. This\n+   * class file name is usually a fully qualified class name. However a class file name may have a\n+   * framework-specific prefix. Example: {@code BOOT-INF.classes.com.google.Foo}.\n+   *\n+   * <p>This function caches the result. Therefore the caller does not need to worry about the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE2NDk5Ng==", "bodyText": "Removed the mention about the caching.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425164996", "createdAt": "2020-05-14T14:07:35Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -112,13 +113,18 @@ private void readClassFileNames() throws IOException {\n       this.classFileNames = classNames.build();\n     }\n   }\n-  \n+\n   /**\n-   * Returns the fully qualified names of the classes in this entry's jar file.\n-   * \n+   * Returns a list of class file names in {@link #jar} as in {@link JavaClass#getFileName()}. This\n+   * class file name is usually a fully qualified class name. However a class file name may have a\n+   * framework-specific prefix. Example: {@code BOOT-INF.classes.com.google.Foo}.\n+   *\n+   * <p>This function caches the result. Therefore the caller does not need to worry about the", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5NzM4Mg=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzE5NjE4OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjozMDoxNVrOGVZ8Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDoxNjozOVrOGVebqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5ODI2Ng==", "bodyText": "Avoid moving data between classes. Instead ClassSymbol should be able to return the classFileName if that's what we need.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425098266", "createdAt": "2020-05-14T12:30:15Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -163,9 +166,10 @@ private LinkageChecker(\n             }\n           }\n         }\n-        if (!classFile.getClassPathEntry().getClassNames()\n-            .contains(classSymbol.getClassBinaryName())) {\n \n+        String classBinaryName = classSymbol.getClassBinaryName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE3MTg4Mg==", "bodyText": "A ClassSymbol cannot know the class file name. A symbol is an abstract entity apart from concrete class files. For example, when a class file's constant pool references a class symbol of \"com.google.Foo\", it does not know the class symbol is materialized by a class file \"BOOT-INF/classes/com/google/Foo.class\", another class file \"WEB-INF/classes/com/google/Foo.class\", or just \"com/google/Foo.class\".", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425171882", "createdAt": "2020-05-14T14:16:39Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -163,9 +166,10 @@ private LinkageChecker(\n             }\n           }\n         }\n-        if (!classFile.getClassPathEntry().getClassNames()\n-            .contains(classSymbol.getClassBinaryName())) {\n \n+        String classBinaryName = classSymbol.getClassBinaryName();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5ODI2Ng=="}, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzE5OTgyOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjozMToxNFrOGVZ-Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMjozMToxNFrOGVZ-Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5ODg1MQ==", "bodyText": "again, just methodSymbol.getClassFileName()", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425098851", "createdAt": "2020-05-14T12:31:14Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -189,9 +193,12 @@ private LinkageChecker(\n         classToSymbols.getClassToMethodSymbols();\n     for (ClassFile classFile : classToMethodSymbols.keySet()) {\n       ImmutableSet<MethodSymbol> methodSymbols = classToMethodSymbols.get(classFile);\n+      ImmutableSet<String> classFileNamesInSource =\n+          classFile.getClassPathEntry().getClassFileNames();\n       for (MethodSymbol methodSymbol : methodSymbols) {\n-        if (!classFile.getClassPathEntry().getClassNames()\n-            .contains(methodSymbol.getClassBinaryName())) {\n+        String classBinaryName = methodSymbol.getClassBinaryName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f6b0bc14f070deb535daa414446526347c30f9e"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NzgwNzgzOnYy", "diffSide": "LEFT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDo1MjowN1rOGVgFZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDo1MjowN1rOGVgFZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5ODk0OQ==", "bodyText": "The previous javadoc was incorrect. It is not fully qualified class names. It returns class file names in a JAR.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425198949", "createdAt": "2020-05-14T14:52:07Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -112,13 +114,15 @@ private void readClassFileNames() throws IOException {\n       this.classFileNames = classNames.build();\n     }\n   }\n-  \n+\n   /**\n-   * Returns the fully qualified names of the classes in this entry's jar file.\n-   * ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32a08359c8479d9a0d8b074b577def230eb0a025"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MTg5MjU0OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo1Mzo0MFrOGWIPPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo1Mzo0MFrOGWIPPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg1NjgzMA==", "bodyText": "I was thinking to rename this variable to fileName or fileNameOfClass. But classFileName fits best.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r425856830", "createdAt": "2020-05-15T14:53:40Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -163,9 +165,10 @@ private LinkageChecker(\n             }\n           }\n         }\n-        if (!classFile.getClassPathEntry().getFileNames()\n-            .contains(classSymbol.getClassBinaryName())) {\n \n+        String classBinaryName = classSymbol.getClassBinaryName();\n+        String classFileName = classDumper.getFileName(classBinaryName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NzI1MDg5OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDoxOTowN1rOGW5Uyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDo1NzozN1rOGW7A3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY2MTA2Nw==", "bodyText": "a fully qualified class name --> fully qualified class names", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426661067", "createdAt": "2020-05-18T14:19:07Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -92,11 +93,11 @@ public String toString() {\n   }\n \n   /**\n-   * Returns a list of class file names in {@link #jar} as in {@link JavaClass#getFileName()}. This\n-   * class file name is usually a fully qualified class name. However a class file name may have a\n-   * framework-specific prefix. Example: {@code BOOT-INF.classes.com.google.Foo}.\n+   * Populates {@link #fileNames} through the classes in {@link #jar}. These file names are usually\n+   * a fully qualified class name. However a class file name may have a framework-specific prefix.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY4ODczMw==", "bodyText": "Fixed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426688733", "createdAt": "2020-05-18T14:57:37Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -92,11 +93,11 @@ public String toString() {\n   }\n \n   /**\n-   * Returns a list of class file names in {@link #jar} as in {@link JavaClass#getFileName()}. This\n-   * class file name is usually a fully qualified class name. However a class file name may have a\n-   * framework-specific prefix. Example: {@code BOOT-INF.classes.com.google.Foo}.\n+   * Populates {@link #fileNames} through the classes in {@link #jar}. These file names are usually\n+   * a fully qualified class name. However a class file name may have a framework-specific prefix.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY2MTA2Nw=="}, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NzI2OTYwOnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDoyMzoyMlrOGW5gfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoyMDowM1rOGW-gLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY2NDA2MA==", "bodyText": "Not new in this PR, but I notice this is another case where the OO API is turned inside out. This should be classFile.getClassSymbols.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426664060", "createdAt": "2020-05-18T14:23:22Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -150,6 +150,8 @@ private LinkageChecker(\n     \n     for (ClassFile classFile : classToClassSymbols.keySet()) {\n       ImmutableSet<ClassSymbol> classSymbols = classToClassSymbols.get(classFile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY5NjM1Mg==", "bodyText": "The mismatch from OO API might came from my mental design of Linkage Checker:\n\nGet class path (JAR files) from input artifact\nGet symbol references in class files (such as this classToClassSymbols) from the class path\nGet linkage errors by validating the symbol references\n\nI was feeling that this fits declarative/functional-programming style, not object-oriented:\nlinkageCheck = \n  artifact <- input\n  classPath <- resolve(artifact)\n  symbolReferences <- read(classPath)\n  linkageErrors <- validate(symbolReferences)\n  return linkageErrors\n\nWith that, I think I wanted to keep the clear separation of the value classes (e.g., ClassFile) from implementing IO operations. LinkageChecker and ClassDumper are responsible for the IO operations and logic to generate the value classes.\n(This is not saying I'm against the object-oriented API, but sharing my finding.)", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426696352", "createdAt": "2020-05-18T15:08:02Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -150,6 +150,8 @@ private LinkageChecker(\n     \n     for (ClassFile classFile : classToClassSymbols.keySet()) {\n       ImmutableSet<ClassSymbol> classSymbols = classToClassSymbols.get(classFile);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY2NDA2MA=="}, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0NTkwMQ==", "bodyText": "Writing functional code in a non-functional language such as Java is a recipe for confusion. Case in point: I am constantly confused while reading our code. I usually have to review several classes to remind myself what the code does and how in each PR.\nSeparating I/O makes sense, but we shouldn't be storing the results of those I/O operations outside of the relevant classes.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426745901", "createdAt": "2020-05-18T16:20:03Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -150,6 +150,8 @@ private LinkageChecker(\n     \n     for (ClassFile classFile : classToClassSymbols.keySet()) {\n       ImmutableSet<ClassSymbol> classSymbols = classToClassSymbols.get(classFile);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY2NDA2MA=="}, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NzI3Mzg3OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDoyNDoyNVrOGW5jPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNToxMzoyNVrOGW7tmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY2NDc2Nw==", "bodyText": "why \"InSource\"? Would just classFileNames work?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426664767", "createdAt": "2020-05-18T14:24:25Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -150,6 +150,8 @@ private LinkageChecker(\n     \n     for (ClassFile classFile : classToClassSymbols.keySet()) {\n       ImmutableSet<ClassSymbol> classSymbols = classToClassSymbols.get(classFile);\n+      ImmutableSet<String> classFileNamesInSource = classFile.getClassPathEntry().getFileNames();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwMDE4Ng==", "bodyText": "classFileNames works. Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426700186", "createdAt": "2020-05-18T15:13:25Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -150,6 +150,8 @@ private LinkageChecker(\n     \n     for (ClassFile classFile : classToClassSymbols.keySet()) {\n       ImmutableSet<ClassSymbol> classSymbols = classToClassSymbols.get(classFile);\n+      ImmutableSet<String> classFileNamesInSource = classFile.getClassPathEntry().getFileNames();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY2NDc2Nw=="}, "originalCommit": {"oid": "11d4a5da15854e9936e9821c8e726671e5e5b915"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NzU2Nzg5OnYy", "diffSide": "RIGHT", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozMDo0MlrOGW8c5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozMDo0MlrOGW8c5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxMjI5Mw==", "bodyText": "just \"className\" might be enough here.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1403#discussion_r426712293", "createdAt": "2020-05-18T15:30:42Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassDumper.java", "diffHunk": "@@ -326,6 +326,14 @@ ClassPathEntry findClassLocation(String className) {\n     return Iterables.getFirst(fileNameToClassPathEntry.get(filename), null);\n   }\n \n+  /**\n+   * Converts a binary name to the file name of a class. Read {@link FixedSizeClassPathRepository}\n+   * for the difference.\n+   */\n+  String getFileName(String classBinaryName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa8f11eeb15c1e496963f241f788c84d80e0321e"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2752, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}