{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MjAyOTgz", "number": 1535, "title": "LinkageProblemCause that explains why there is an invalid reference", "bodyText": "With this PR, LinkageCheckerMain -a com.google.api-client:google-api-client:1.27.0,io.grpc:grpc-core:1.17.1 generates \"Cause: \" message.\n...\n(com.google.guava:guava:20.0) com.google.common.base.Verify's method verify(boolean, String, Object) is not found;\n  referenced by 3 class files\n    io.grpc.internal.ServiceConfigInterceptor (io.grpc:grpc-core:1.17.1)\n    io.grpc.internal.JndiResourceResolverFactory (io.grpc:grpc-core:1.17.1)\n    io.grpc.internal.DnsNameResolver (io.grpc:grpc-core:1.17.1)\n  Cause:\n    Dependency conflict: com.google.guava:guava:20.0 does not define com.google.common.base.Verify's method verify(boolean, String, Object) but com.google.guava:guava:26.0-android defines it.\n      selected: com.google.api-client:google-api-client:1.27.0 (compile) / com.google.guava:guava:20.0 (compile)\n      unselected: io.grpc:grpc-core:1.17.1 (compile) / com.google.guava:guava:26.0-android (compile)\n...", "createdAt": "2020-07-15T02:16:43Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535", "merged": true, "mergeCommit": {"oid": "27018d05418bae891187d729e8007180aa18f915"}, "closed": true, "closedAt": "2020-07-23T17:13:59Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1ABT5AH2gAyNDQ5MjAyOTgzOjczNGUyNjJiYzQ1MTFlZTdhMWRmNDIzNmM1ZWFjYzA2MThjOWUzOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3xlVvgH2gAyNDQ5MjAyOTgzOmM1NGNjMTUyYjFhZTc3ZTcyNGFiYWQwMDJjMmY2ZDBiZjc5YmFlMmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "734e262bc4511ee7a1df4236c5eacc0618c9e39d", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/734e262bc4511ee7a1df4236c5eacc0618c9e39d", "committedDate": "2020-07-15T01:05:30Z", "message": "Test passsed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94163352007e060e6009f0fd5a996c90a5c66ed5", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/94163352007e060e6009f0fd5a996c90a5c66ed5", "committedDate": "2020-07-15T02:14:17Z", "message": "Added to LinkageCheckerMain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2149c080cc35bc6ab6c50d2f37f0001c72164a4", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e2149c080cc35bc6ab6c50d2f37f0001c72164a4", "committedDate": "2020-07-15T02:37:35Z", "message": "Format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a24e3ab750eccfeda11cdb24cb9c9aa6a1b4eff2", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a24e3ab750eccfeda11cdb24cb9c9aa6a1b4eff2", "committedDate": "2020-07-15T02:44:56Z", "message": "Format even if cause is null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/89c89478911b56a384dbff2e926ce4dd0ed2e7b9", "committedDate": "2020-07-15T03:09:14Z", "message": "Reverted provided dependency testAnnotate_parquetProvidedDependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4ODgwMzYx", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-448880361", "createdAt": "2020-07-15T11:54:33Z", "commit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMTo1NDozM1rOGx6rOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMjoyMTo1MVrOGx7jlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NDc0NA==", "bodyText": "why are we passing multimaps again?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454994744", "createdAt": "2020-07-15T11:54:33Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -58,9 +59,8 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n    *     included. If false, optional dependencies are not included.\n    */\n   public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n-    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();\n     if (artifacts.isEmpty()) {\n-      return new ClassPathResult(multimap, ImmutableList.of());\n+      return new ClassPathResult(LinkedListMultimap.create(), ImmutableList.of());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTI3OA==", "bodyText": "Is this variable used anywhere?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454995278", "createdAt": "2020-07-15T11:55:32Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -69,13 +69,30 @@ public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n     } else {\n       result = dependencyGraphBuilder.buildVerboseDependencyGraph(artifacts);\n     }\n-    List<DependencyPath> dependencyPaths = result.list();\n+    return performMediation(result);\n+  }\n \n+  /**\n+   * Builds a class path from the dependency graph with {@code artifact} as the root, in the same\n+   * way as Maven would do when the artifact was built.\n+   *\n+   * <p>Compared to {@link #resolve(List, boolean)}, this method includes direct optional\n+   * dependencies of {@code artifact} but excludes its transitive optional dependencies.\n+   */\n+  ClassPathResult resolveWithMaven(Artifact artifact) {\n+    DependencyGraph result =\n+        dependencyGraphBuilder.buildMavenDependencyGraph(new Dependency(artifact, \"compile\"));\n+    return performMediation(result);\n+  }\n+\n+  private ClassPathResult performMediation(DependencyGraph result) {\n     // TODO should DependencyGraphResult have a mediate() method that returns a ClassPathResult?\n-    \n+\n     // To remove duplicates on (groupId:artifactId) for dependency mediation\n     MavenDependencyMediation mediation = new MavenDependencyMediation();\n \n+    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTUxNw==", "bodyText": "delete \"FromSource\"", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454995517", "createdAt": "2020-07-15T11:55:57Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.util.Objects;\n+\n+/**\n+ * Diamond dependency conflict caused a {@link LinkageProblem} where the {@link LinkageProblem}'s\n+ * invalid reference points to the symbol in {@code pathToSelectedArtifact.getLeaf()} but a valid\n+ * symbol is in {@code pathToUnselectedArtifact.getLeaf()}.\n+ */\n+class DependencyConflict extends LinkageProblemCause {\n+  DependencyPath pathToUnselectedArtifact;\n+  DependencyPath pathToSelectedArtifact;\n+\n+  DependencyConflict(\n+      DependencyPath pathToSelectedArtifact, DependencyPath pathToUnselectedArtifactFromSource) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTg5Ng==", "bodyText": "in reading JAR files. --> reading JAR files", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454995896", "createdAt": "2020-07-15T11:56:45Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import com.google.common.base.Verify;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem in reading JAR files.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NjExOA==", "bodyText": "Handle null appropriately if it can happen. Verify has all but one of the problems assertions have", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454996118", "createdAt": "2020-07-15T11:57:08Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import com.google.common.base.Verify;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem in reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+      Verify.verify(sourceArtifact != null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5ODY5MQ==", "bodyText": "matches", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454998691", "createdAt": "2020-07-15T12:02:09Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import com.google.common.base.Verify;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem in reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+      Verify.verify(sourceArtifact != null);\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(new UnknownCause());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(new UnknownCause());\n+          }\n+        } else {\n+          // No artifact that match groupId and artifactId in rootResult.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5OTYzMg==", "bodyText": "This tempts me to suggest a singleton.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454999632", "createdAt": "2020-07-15T12:04:03Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/UnknownCause.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * Linkage Checker cannot determine the cause of the linkage error.\n+ *\n+ * <p>This occurs when the POM file that used in building a library and the published POM file are\n+ * different.\n+ */\n+public class UnknownCause extends LinkageProblemCause {\n+\n+  @Override\n+  public String toString() {\n+    return \"Unknown\";\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    return obj instanceof UnknownCause;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5OTcxNQ==", "bodyText": "nice class", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r454999715", "createdAt": "2020-07-15T12:04:15Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/MissingDependency.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.util.Objects;\n+import org.eclipse.aether.artifact.Artifact;\n+import org.eclipse.aether.graph.Dependency;\n+\n+/** An optional or provided-scope dependency is not supplied. */\n+class MissingDependency extends LinkageProblemCause {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwMDQxNQ==", "bodyText": "don't static import unfamiliar classes", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455000415", "createdAt": "2020-07-15T12:05:38Z", "author": {"login": "elharo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/ClassDumperTest.java", "diffHunk": "@@ -16,8 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n-import static com.google.cloud.tools.opensource.classpath.LinkageCheckerTest.resolvePaths;\n import static com.google.cloud.tools.opensource.classpath.TestHelper.classPathEntryOfResource;\n+import static com.google.cloud.tools.opensource.classpath.TestHelper.resolve;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwODk4Nw==", "bodyText": "don't static import here", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455008987", "createdAt": "2020-07-15T12:21:28Z", "author": {"login": "elharo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -18,6 +18,7 @@\n \n import static com.google.cloud.tools.opensource.classpath.TestHelper.COORDINATES;\n import static com.google.cloud.tools.opensource.classpath.TestHelper.classPathEntryOfResource;\n+import static com.google.cloud.tools.opensource.classpath.TestHelper.resolve;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwOTE3Mw==", "bodyText": "don't static import this", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455009173", "createdAt": "2020-07-15T12:21:51Z", "author": {"login": "elharo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotatorTest.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.cloud.tools.opensource.classpath.TestHelper.resolve;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a52cd414d9edb47a333529f7b3354fc5cba2e4b", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/5a52cd414d9edb47a333529f7b3354fc5cba2e4b", "committedDate": "2020-07-15T13:34:56Z", "message": "Applied review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3723748b09a4dedd8b9a0fb9a82e9f2e7687e8fe", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3723748b09a4dedd8b9a0fb9a82e9f2e7687e8fe", "committedDate": "2020-07-15T13:44:14Z", "message": "Applied review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5b8a4da28d1d74e3ba54ea899ca68a75d65d9d4", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e5b8a4da28d1d74e3ba54ea899ca68a75d65d9d4", "committedDate": "2020-07-15T13:56:33Z", "message": "Empty input test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/375f4da57d319186d3e88514fcdd65d6eb7a4066", "committedDate": "2020-07-15T14:11:36Z", "message": "Not special-casing empty input"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4OTM0NDA0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-448934404", "createdAt": "2020-07-15T13:08:21Z", "commit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzowODoyMVrOGx9PhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMzo0NDozNFrOGx-z0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzNjgwNQ==", "bodyText": "ClassPathResult maintains the multimap from ClassPathEntry to DependencyPath. We didn't change that.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455036805", "createdAt": "2020-07-15T13:08:21Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -58,9 +59,8 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n    *     included. If false, optional dependencies are not included.\n    */\n   public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n-    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();\n     if (artifacts.isEmpty()) {\n-      return new ClassPathResult(multimap, ImmutableList.of());\n+      return new ClassPathResult(LinkedListMultimap.create(), ImmutableList.of());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NDc0NA=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzNzE1OA==", "bodyText": "It's used at 7 lines below.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455037158", "createdAt": "2020-07-15T13:08:51Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -69,13 +69,30 @@ public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n     } else {\n       result = dependencyGraphBuilder.buildVerboseDependencyGraph(artifacts);\n     }\n-    List<DependencyPath> dependencyPaths = result.list();\n+    return performMediation(result);\n+  }\n \n+  /**\n+   * Builds a class path from the dependency graph with {@code artifact} as the root, in the same\n+   * way as Maven would do when the artifact was built.\n+   *\n+   * <p>Compared to {@link #resolve(List, boolean)}, this method includes direct optional\n+   * dependencies of {@code artifact} but excludes its transitive optional dependencies.\n+   */\n+  ClassPathResult resolveWithMaven(Artifact artifact) {\n+    DependencyGraph result =\n+        dependencyGraphBuilder.buildMavenDependencyGraph(new Dependency(artifact, \"compile\"));\n+    return performMediation(result);\n+  }\n+\n+  private ClassPathResult performMediation(DependencyGraph result) {\n     // TODO should DependencyGraphResult have a mediate() method that returns a ClassPathResult?\n-    \n+\n     // To remove duplicates on (groupId:artifactId) for dependency mediation\n     MavenDependencyMediation mediation = new MavenDependencyMediation();\n \n+    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTI3OA=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzNzQ4Mw==", "bodyText": "Deleted.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455037483", "createdAt": "2020-07-15T13:09:20Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.util.Objects;\n+\n+/**\n+ * Diamond dependency conflict caused a {@link LinkageProblem} where the {@link LinkageProblem}'s\n+ * invalid reference points to the symbol in {@code pathToSelectedArtifact.getLeaf()} but a valid\n+ * symbol is in {@code pathToUnselectedArtifact.getLeaf()}.\n+ */\n+class DependencyConflict extends LinkageProblemCause {\n+  DependencyPath pathToUnselectedArtifact;\n+  DependencyPath pathToSelectedArtifact;\n+\n+  DependencyConflict(\n+      DependencyPath pathToSelectedArtifact, DependencyPath pathToUnselectedArtifactFromSource) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTUxNw=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzODEyMA==", "bodyText": "Removed 'in'.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455038120", "createdAt": "2020-07-15T13:10:14Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import com.google.common.base.Verify;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem in reading JAR files.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NTg5Ng=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzOTg3Mg==", "bodyText": "Removed this. This was redundant as all ClassPathEntries from ClassPathResult have artifacts.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455039872", "createdAt": "2020-07-15T13:12:49Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import com.google.common.base.Verify;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem in reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+      Verify.verify(sourceArtifact != null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NjExOA=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0MDMwMg==", "bodyText": "Fixed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455040302", "createdAt": "2020-07-15T13:13:25Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import com.google.common.base.Verify;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem in reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+      Verify.verify(sourceArtifact != null);\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(new UnknownCause());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(new UnknownCause());\n+          }\n+        } else {\n+          // No artifact that match groupId and artifactId in rootResult.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5ODY5MQ=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA1MTQ0NQ==", "bodyText": "Made this as singleton.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455051445", "createdAt": "2020-07-15T13:29:08Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/UnknownCause.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * Linkage Checker cannot determine the cause of the linkage error.\n+ *\n+ * <p>This occurs when the POM file that used in building a library and the published POM file are\n+ * different.\n+ */\n+public class UnknownCause extends LinkageProblemCause {\n+\n+  @Override\n+  public String toString() {\n+    return \"Unknown\";\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    return obj instanceof UnknownCause;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5OTYzMg=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA1MjY1Ng==", "bodyText": "Moved to nonstatic import.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455052656", "createdAt": "2020-07-15T13:30:45Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/ClassDumperTest.java", "diffHunk": "@@ -16,8 +16,8 @@\n \n package com.google.cloud.tools.opensource.classpath;\n \n-import static com.google.cloud.tools.opensource.classpath.LinkageCheckerTest.resolvePaths;\n import static com.google.cloud.tools.opensource.classpath.TestHelper.classPathEntryOfResource;\n+import static com.google.cloud.tools.opensource.classpath.TestHelper.resolve;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwMDQxNQ=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA1NDI2OQ==", "bodyText": "Changed to nonstatic import", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455054269", "createdAt": "2020-07-15T13:33:06Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -18,6 +18,7 @@\n \n import static com.google.cloud.tools.opensource.classpath.TestHelper.COORDINATES;\n import static com.google.cloud.tools.opensource.classpath.TestHelper.classPathEntryOfResource;\n+import static com.google.cloud.tools.opensource.classpath.TestHelper.resolve;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwODk4Nw=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA1NDYxMA==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455054610", "createdAt": "2020-07-15T13:33:38Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotatorTest.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.cloud.tools.opensource.classpath.TestHelper.resolve;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAwOTE3Mw=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2MjQ4MQ==", "bodyText": "I found this logic of handling empty input is redundant. When the list is empty, the subsequent operations return an empty ClassPathResult.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455062481", "createdAt": "2020-07-15T13:44:34Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -58,9 +59,8 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n    *     included. If false, optional dependencies are not included.\n    */\n   public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n-    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();\n     if (artifacts.isEmpty()) {\n-      return new ClassPathResult(multimap, ImmutableList.of());\n+      return new ClassPathResult(LinkedListMultimap.create(), ImmutableList.of());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk5NDc0NA=="}, "originalCommit": {"oid": "89c89478911b56a384dbff2e926ce4dd0ed2e7b9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDQxNzg5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-449041789", "createdAt": "2020-07-15T14:53:56Z", "commit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNDo1Mzo1NlrOGyCC3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNTowNTo0OVrOGyCoZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNTQ4NQ==", "bodyText": "performMediation --> mediate", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455115485", "createdAt": "2020-07-15T14:53:56Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -48,34 +49,47 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n   }\n \n   /**\n-   * Builds a classpath from the transitive dependency graph of a list of artifacts.\n-   * When there are multiple versions of an artifact in\n-   * the dependency tree, the closest to the root in breadth-first order is picked up. This \"pick\n-   * closest\" strategy follows Maven's dependency mediation.\n+   * Builds a classpath from the transitive dependency graph from {@code artifacts}. When there are\n+   * multiple versions of an artifact in the dependency tree, the closest to the root in\n+   * breadth-first order is picked up. This \"pick closest\" strategy follows Maven's dependency\n+   * mediation.\n    *\n    * @param artifacts the first artifacts that appear in the classpath, in order\n-   * @param full if true all optional dependencies and their transitive dependencies are\n-   *     included. If false, optional dependencies are not included.\n+   * @param full if true all optional dependencies and their transitive dependencies are included.\n+   *     If false, optional dependencies are not included.\n    */\n   public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n-    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();\n-    if (artifacts.isEmpty()) {\n-      return new ClassPathResult(multimap, ImmutableList.of());\n-    }\n     // dependencyGraph holds multiple versions for one artifact key (groupId:artifactId)\n     DependencyGraph result;\n     if (full) {\n       result = dependencyGraphBuilder.buildFullDependencyGraph(artifacts);\n     } else {\n       result = dependencyGraphBuilder.buildVerboseDependencyGraph(artifacts);\n     }\n-    List<DependencyPath> dependencyPaths = result.list();\n+    return performMediation(result);\n+  }\n+\n+  /**\n+   * Builds a class path from the dependency graph with {@code artifact} as the root, in the same\n+   * way as Maven would do when the artifact was built.\n+   *\n+   * <p>Compared to {@link #resolve(List, boolean)}, this method includes direct optional\n+   * dependencies of {@code artifact} but excludes its transitive optional dependencies.\n+   */\n+  ClassPathResult resolveWithMaven(Artifact artifact) {\n+    DependencyGraph result =\n+        dependencyGraphBuilder.buildMavenDependencyGraph(new Dependency(artifact, \"compile\"));\n+    return performMediation(result);\n+  }\n \n+  private ClassPathResult performMediation(DependencyGraph result) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExODA2Ng==", "bodyText": "Not quite. The difference is that this method takes a root artifact and that method takes a list of artifacts from non-root dependencies.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455118066", "createdAt": "2020-07-15T14:56:00Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -48,34 +49,47 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n   }\n \n   /**\n-   * Builds a classpath from the transitive dependency graph of a list of artifacts.\n-   * When there are multiple versions of an artifact in\n-   * the dependency tree, the closest to the root in breadth-first order is picked up. This \"pick\n-   * closest\" strategy follows Maven's dependency mediation.\n+   * Builds a classpath from the transitive dependency graph from {@code artifacts}. When there are\n+   * multiple versions of an artifact in the dependency tree, the closest to the root in\n+   * breadth-first order is picked up. This \"pick closest\" strategy follows Maven's dependency\n+   * mediation.\n    *\n    * @param artifacts the first artifacts that appear in the classpath, in order\n-   * @param full if true all optional dependencies and their transitive dependencies are\n-   *     included. If false, optional dependencies are not included.\n+   * @param full if true all optional dependencies and their transitive dependencies are included.\n+   *     If false, optional dependencies are not included.\n    */\n   public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n-    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();\n-    if (artifacts.isEmpty()) {\n-      return new ClassPathResult(multimap, ImmutableList.of());\n-    }\n     // dependencyGraph holds multiple versions for one artifact key (groupId:artifactId)\n     DependencyGraph result;\n     if (full) {\n       result = dependencyGraphBuilder.buildFullDependencyGraph(artifacts);\n     } else {\n       result = dependencyGraphBuilder.buildVerboseDependencyGraph(artifacts);\n     }\n-    List<DependencyPath> dependencyPaths = result.list();\n+    return performMediation(result);\n+  }\n+\n+  /**\n+   * Builds a class path from the dependency graph with {@code artifact} as the root, in the same\n+   * way as Maven would do when the artifact was built.\n+   *\n+   * <p>Compared to {@link #resolve(List, boolean)}, this method includes direct optional", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExODY3Mw==", "bodyText": "no period", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455118673", "createdAt": "2020-07-15T14:56:42Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExODk0Mg==", "bodyText": "no period", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455118942", "createdAt": "2020-07-15T14:57:06Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMDQ0OQ==", "bodyText": "I'm a little worried this might blow up in memory or CPU or both. Have you tested this with the Beam projects that cause us problems?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455120449", "createdAt": "2020-07-15T14:59:10Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMTMyNw==", "bodyText": "findEntryById since it's not just the artifact ID", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455121327", "createdAt": "2020-07-15T15:00:29Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMjIyNg==", "bodyText": "This works better as an instance method in ClassPathResult than a static method elsewhere.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455122226", "createdAt": "2020-07-15T15:01:47Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMjkwOA==", "bodyText": "This also feels like it fits naturally as an instance method in ClasspathResult", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455122908", "createdAt": "2020-07-15T15:02:38Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(\n+      ClassPathResult classPathResult, String groupId, String artifactId) {\n+    for (ClassPathEntry entry : classPathResult.getClassPath()) {\n+      Artifact artifact = entry.getArtifact();\n+      if (artifact.getGroupId().equals(groupId) && artifact.getArtifactId().equals(artifactId)) {\n+        return entry;\n+      }\n+    }\n+    return null;\n+  }\n+\n+  /**\n+   * Returns the {@link ClassPathEntry} in {@code classPathResult} that contains the class of {@code\n+   * symbol}. {@code Null} if no matching entry is found.\n+   */\n+  private static ClassPathEntry findClassPathEntryForSymbol(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNDEyMg==", "bodyText": "Another instance method for ClasspathResult. I suspect what you have here is three overloaded findEntry methods with different argument types.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455124122", "createdAt": "2020-07-15T15:04:23Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(\n+      ClassPathResult classPathResult, String groupId, String artifactId) {\n+    for (ClassPathEntry entry : classPathResult.getClassPath()) {\n+      Artifact artifact = entry.getArtifact();\n+      if (artifact.getGroupId().equals(groupId) && artifact.getArtifactId().equals(artifactId)) {\n+        return entry;\n+      }\n+    }\n+    return null;\n+  }\n+\n+  /**\n+   * Returns the {@link ClassPathEntry} in {@code classPathResult} that contains the class of {@code\n+   * symbol}. {@code Null} if no matching entry is found.\n+   */\n+  private static ClassPathEntry findClassPathEntryForSymbol(\n+      ClassPathResult classPathResult, Symbol symbol) throws IOException {\n+    String className = symbol.getClassBinaryName();\n+    for (ClassPathEntry entry : classPathResult.getClassPath()) {\n+      if (entry.getFileNames().contains(className)) {\n+        return entry;\n+      }\n+    }\n+    return null;\n+  }\n+\n+  /**\n+   * Returns the dependency path of the first {@link ClassPathEntry} in {@code classPathResult} that\n+   * contains the class of {@code symbol}. Null if no such entry is found.\n+   */\n+  private static DependencyPath findDependencyPathForSymbol(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNTA5Mw==", "bodyText": "2020", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455125093", "createdAt": "2020-07-15T15:05:49Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DirectProvidedDependencySelector.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2019 Google LLC.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76c56bd2e32cea5a716ef82a59b2d2c27dc8cafa", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/76c56bd2e32cea5a716ef82a59b2d2c27dc8cafa", "committedDate": "2020-07-15T16:20:14Z", "message": "Measuring performance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c18512649a879a32ca45bfbfa46c19a155731715", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c18512649a879a32ca45bfbfa46c19a155731715", "committedDate": "2020-07-15T16:41:55Z", "message": "Cache at annotator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDkxMTgw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-449091180", "createdAt": "2020-07-15T15:52:15Z", "commit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNTo1MjoxNVrOGyEhpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjo0MDo1NlrOGyGTrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1NjEzMg==", "bodyText": "Done.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455156132", "createdAt": "2020-07-15T15:52:15Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -48,34 +49,47 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n   }\n \n   /**\n-   * Builds a classpath from the transitive dependency graph of a list of artifacts.\n-   * When there are multiple versions of an artifact in\n-   * the dependency tree, the closest to the root in breadth-first order is picked up. This \"pick\n-   * closest\" strategy follows Maven's dependency mediation.\n+   * Builds a classpath from the transitive dependency graph from {@code artifacts}. When there are\n+   * multiple versions of an artifact in the dependency tree, the closest to the root in\n+   * breadth-first order is picked up. This \"pick closest\" strategy follows Maven's dependency\n+   * mediation.\n    *\n    * @param artifacts the first artifacts that appear in the classpath, in order\n-   * @param full if true all optional dependencies and their transitive dependencies are\n-   *     included. If false, optional dependencies are not included.\n+   * @param full if true all optional dependencies and their transitive dependencies are included.\n+   *     If false, optional dependencies are not included.\n    */\n   public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n-    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();\n-    if (artifacts.isEmpty()) {\n-      return new ClassPathResult(multimap, ImmutableList.of());\n-    }\n     // dependencyGraph holds multiple versions for one artifact key (groupId:artifactId)\n     DependencyGraph result;\n     if (full) {\n       result = dependencyGraphBuilder.buildFullDependencyGraph(artifacts);\n     } else {\n       result = dependencyGraphBuilder.buildVerboseDependencyGraph(artifacts);\n     }\n-    List<DependencyPath> dependencyPaths = result.list();\n+    return performMediation(result);\n+  }\n+\n+  /**\n+   * Builds a class path from the dependency graph with {@code artifact} as the root, in the same\n+   * way as Maven would do when the artifact was built.\n+   *\n+   * <p>Compared to {@link #resolve(List, boolean)}, this method includes direct optional\n+   * dependencies of {@code artifact} but excludes its transitive optional dependencies.\n+   */\n+  ClassPathResult resolveWithMaven(Artifact artifact) {\n+    DependencyGraph result =\n+        dependencyGraphBuilder.buildMavenDependencyGraph(new Dependency(artifact, \"compile\"));\n+    return performMediation(result);\n+  }\n \n+  private ClassPathResult performMediation(DependencyGraph result) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNTQ4NQ=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1OTY1MA==", "bodyText": "Updated the javadoc \"This method takes the root artifact of a dependency graph, while {@link #resolve(List, boolean)} takes a list of artifacts as the dependencies of a pseudo root artifact.\"\nDoes this read better?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455159650", "createdAt": "2020-07-15T15:57:48Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -48,34 +49,47 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n   }\n \n   /**\n-   * Builds a classpath from the transitive dependency graph of a list of artifacts.\n-   * When there are multiple versions of an artifact in\n-   * the dependency tree, the closest to the root in breadth-first order is picked up. This \"pick\n-   * closest\" strategy follows Maven's dependency mediation.\n+   * Builds a classpath from the transitive dependency graph from {@code artifacts}. When there are\n+   * multiple versions of an artifact in the dependency tree, the closest to the root in\n+   * breadth-first order is picked up. This \"pick closest\" strategy follows Maven's dependency\n+   * mediation.\n    *\n    * @param artifacts the first artifacts that appear in the classpath, in order\n-   * @param full if true all optional dependencies and their transitive dependencies are\n-   *     included. If false, optional dependencies are not included.\n+   * @param full if true all optional dependencies and their transitive dependencies are included.\n+   *     If false, optional dependencies are not included.\n    */\n   public ClassPathResult resolve(List<Artifact> artifacts, boolean full) {\n-    LinkedListMultimap<ClassPathEntry, DependencyPath> multimap = LinkedListMultimap.create();\n-    if (artifacts.isEmpty()) {\n-      return new ClassPathResult(multimap, ImmutableList.of());\n-    }\n     // dependencyGraph holds multiple versions for one artifact key (groupId:artifactId)\n     DependencyGraph result;\n     if (full) {\n       result = dependencyGraphBuilder.buildFullDependencyGraph(artifacts);\n     } else {\n       result = dependencyGraphBuilder.buildVerboseDependencyGraph(artifacts);\n     }\n-    List<DependencyPath> dependencyPaths = result.list();\n+    return performMediation(result);\n+  }\n+\n+  /**\n+   * Builds a class path from the dependency graph with {@code artifact} as the root, in the same\n+   * way as Maven would do when the artifact was built.\n+   *\n+   * <p>Compared to {@link #resolve(List, boolean)}, this method includes direct optional", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExODA2Ng=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1OTkwOA==", "bodyText": "Removed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455159908", "createdAt": "2020-07-15T15:58:16Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExODY3Mw=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1OTk0Mw==", "bodyText": "Removed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455159943", "createdAt": "2020-07-15T15:58:20Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExODk0Mg=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MTc2OQ==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455161769", "createdAt": "2020-07-15T16:01:19Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMTMyNw=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MTg2Mg==", "bodyText": "Nice idea. Moved to ClassPathResult.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455161862", "createdAt": "2020-07-15T16:01:27Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMjIyNg=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MzI2Mg==", "bodyText": "Yes, moved.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455163262", "createdAt": "2020-07-15T16:03:59Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(\n+      ClassPathResult classPathResult, String groupId, String artifactId) {\n+    for (ClassPathEntry entry : classPathResult.getClassPath()) {\n+      Artifact artifact = entry.getArtifact();\n+      if (artifact.getGroupId().equals(groupId) && artifact.getArtifactId().equals(artifactId)) {\n+        return entry;\n+      }\n+    }\n+    return null;\n+  }\n+\n+  /**\n+   * Returns the {@link ClassPathEntry} in {@code classPathResult} that contains the class of {@code\n+   * symbol}. {@code Null} if no matching entry is found.\n+   */\n+  private static ClassPathEntry findClassPathEntryForSymbol(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMjkwOA=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MzUyOQ==", "bodyText": "This method has been removed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455163529", "createdAt": "2020-07-15T16:04:30Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);\n+\n+      ClassPathEntry entryInSubtree =\n+          findClassPathEntryForSymbol(subtreeResult, linkageProblem.getSymbol());\n+      if (entryInSubtree == null) {\n+        linkageProblem.setCause(UnknownCause.getInstance());\n+      } else {\n+        Artifact artifactInSubtree = entryInSubtree.getArtifact();\n+        DependencyPath pathToSourceEntry = rootResult.getDependencyPaths(sourceEntry).get(0);\n+        DependencyPath pathFromSourceEntryToUnselectedEntry =\n+            subtreeResult.getDependencyPaths(entryInSubtree).get(0);\n+        DependencyPath pathToUnselectedEntry =\n+            pathToSourceEntry.concat(pathFromSourceEntryToUnselectedEntry);\n+\n+        ClassPathEntry selectedEntry =\n+            findEntryByArtifactId(\n+                rootResult, artifactInSubtree.getGroupId(), artifactInSubtree.getArtifactId());\n+        if (selectedEntry != null) {\n+          Artifact selectedArtifact = selectedEntry.getArtifact();\n+          if (!selectedArtifact.getVersion().equals(artifactInSubtree.getVersion())) {\n+            // Different version of that artifact is selected in rootResult\n+            linkageProblem.setCause(\n+                new DependencyConflict(\n+                    rootResult.getDependencyPaths(selectedEntry).get(0), pathToUnselectedEntry));\n+          } else {\n+            // A linkage error was already there when sourceArtifact was built.\n+            linkageProblem.setCause(UnknownCause.getInstance());\n+          }\n+        } else {\n+          // No artifact that matches groupId and artifactId in rootResult.\n+          linkageProblem.setCause(new MissingDependency(pathToUnselectedEntry));\n+        }\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Returns the class path entry in {@code classPathResult} for the artifact that matches {@code\n+   * groupId} and {@code artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  private static ClassPathEntry findEntryByArtifactId(\n+      ClassPathResult classPathResult, String groupId, String artifactId) {\n+    for (ClassPathEntry entry : classPathResult.getClassPath()) {\n+      Artifact artifact = entry.getArtifact();\n+      if (artifact.getGroupId().equals(groupId) && artifact.getArtifactId().equals(artifactId)) {\n+        return entry;\n+      }\n+    }\n+    return null;\n+  }\n+\n+  /**\n+   * Returns the {@link ClassPathEntry} in {@code classPathResult} that contains the class of {@code\n+   * symbol}. {@code Null} if no matching entry is found.\n+   */\n+  private static ClassPathEntry findClassPathEntryForSymbol(\n+      ClassPathResult classPathResult, Symbol symbol) throws IOException {\n+    String className = symbol.getClassBinaryName();\n+    for (ClassPathEntry entry : classPathResult.getClassPath()) {\n+      if (entry.getFileNames().contains(className)) {\n+        return entry;\n+      }\n+    }\n+    return null;\n+  }\n+\n+  /**\n+   * Returns the dependency path of the first {@link ClassPathEntry} in {@code classPathResult} that\n+   * contains the class of {@code symbol}. Null if no such entry is found.\n+   */\n+  private static DependencyPath findDependencyPathForSymbol(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNDEyMg=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NDM1Ng==", "bodyText": "Fixed.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455164356", "createdAt": "2020-07-15T16:05:47Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DirectProvidedDependencySelector.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2019 Google LLC.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNTA5Mw=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE4NTMyNg==", "bodyText": "I added a cache for class path resolution. Then I tried with org.apache.beam:beam-sdks-java-io-hcatalog:2.19.0 with a debug output (76c56bd#diff-237bbf9f02edc92dbe22580599219834R51). It took 30 seconds to annotate linkage problems.\nhttps://gist.github.com/suztomo/e40eb79989d20317eb61784a9c8de654", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r455185326", "createdAt": "2020-07-15T16:40:56Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblemCauseAnnotator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.io.IOException;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/** Annotates {@link LinkageProblem}s with {@link LinkageProblemCause}s. */\n+public class LinkageProblemCauseAnnotator {\n+\n+  /**\n+   * Annotates the cause field of {@link LinkageProblem}s with the {@link LinkageProblemCause}.\n+   *\n+   * @param rootResult the class path used for generating the linkage problems.\n+   * @param linkageProblems linkage problems to annotate\n+   * @throws IOException when there is a problem reading JAR files.\n+   */\n+  static void annotate(ClassPathResult rootResult, Iterable<LinkageProblem> linkageProblems)\n+      throws IOException {\n+\n+    for (LinkageProblem linkageProblem : linkageProblems) {\n+      ClassFile sourceClass = linkageProblem.getSourceClass();\n+      ClassPathEntry sourceEntry = sourceClass.getClassPathEntry();\n+\n+      Artifact sourceArtifact = sourceEntry.getArtifact();\n+\n+      // Resolves the dependency graph with the source artifact at the root.\n+      ClassPathBuilder classPathBuilder = new ClassPathBuilder();\n+      ClassPathResult subtreeResult = classPathBuilder.resolveWithMaven(sourceArtifact);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMDQ0OQ=="}, "originalCommit": {"oid": "375f4da57d319186d3e88514fcdd65d6eb7a4066"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76bb9d6e91f12d08b63841103a9dd93c39c1c44b", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/76bb9d6e91f12d08b63841103a9dd93c39c1c44b", "committedDate": "2020-07-15T16:52:00Z", "message": "reverting verbose tree"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ae34b128aa4fc18bdf07ef1205b7837d25e4ea0", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/5ae34b128aa4fc18bdf07ef1205b7837d25e4ea0", "committedDate": "2020-07-15T19:39:44Z", "message": "Merge remote-tracking branch 'origin/master' into cause"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwODUxODQ4", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-450851848", "createdAt": "2020-07-17T17:55:00Z", "commit": {"oid": "5ae34b128aa4fc18bdf07ef1205b7837d25e4ea0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9aaba8c13352932ffebb991270c8798ca74798f", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d9aaba8c13352932ffebb991270c8798ca74798f", "committedDate": "2020-07-17T18:05:07Z", "message": "Merge remote-tracking branch 'origin/master' into cause"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d21d2ecb1ec54358264f8b49fc5a8f0a41a30eb1", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d21d2ecb1ec54358264f8b49fc5a8f0a41a30eb1", "committedDate": "2020-07-17T18:31:04Z", "message": "multiline dependency conflict toString"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223fa5321f65306ec25f6c4f24e6c7cc80b2bb02", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/223fa5321f65306ec25f6c4f24e6c7cc80b2bb02", "committedDate": "2020-07-17T18:31:33Z", "message": "format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwODc4NTk2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-450878596", "createdAt": "2020-07-17T18:39:01Z", "commit": {"oid": "223fa5321f65306ec25f6c4f24e6c7cc80b2bb02"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxODozOTowMlrOGzdYLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxODozOTowMlrOGzdYLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMTg4Nw==", "bodyText": "Example output:\n(com.google.guava:guava:20.0) com.google.common.base.Verify's method verify(boolean arg1, String arg2, Object arg3) is not found;\n  referenced by 3 class files\n    io.grpc.internal.ServiceConfigInterceptor (io.grpc:grpc-core:1.17.1)\n    io.grpc.internal.JndiResourceResolverFactory (io.grpc:grpc-core:1.17.1)\n    io.grpc.internal.DnsNameResolver (io.grpc:grpc-core:1.17.1)\n  Cause:\n    Dependency conflict: com.google.guava:guava:20.0 was in the class path but version '26.0-android' has a valid symbol.\n      selected: com.google.api-client:google-api-client:1.27.0 (compile) / com.google.guava:guava:20.0 (compile)\n      unselected: io.grpc:grpc-core:1.17.1 (compile) / com.google.guava:guava:26.0-android (compile)\n\nNote that when there's an invalid reference between ArtifactX and ArtifactY, it's not always true that we should upgrade ArtifactY. Users may have to upgrade or downgrade Artifact X or Artifact Y.\nA DependencyConflict class does not know the symbol. It's LinkageProblem's field.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r456611887", "createdAt": "2020-07-17T18:39:02Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.cloud.tools.opensource.dependencies.Artifacts;\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.util.Objects;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/**\n+ * Diamond dependency conflict caused a {@link LinkageProblem} where the {@link LinkageProblem}'s\n+ * invalid reference points to the symbol in {@code pathToSelectedArtifact.getLeaf()} but a valid\n+ * symbol is in {@code pathToUnselectedArtifact.getLeaf()}.\n+ */\n+class DependencyConflict extends LinkageProblemCause {\n+  DependencyPath pathToUnselectedArtifact;\n+  DependencyPath pathToSelectedArtifact;\n+\n+  DependencyConflict(\n+      DependencyPath pathToSelectedArtifact, DependencyPath pathToUnselectedArtifact) {\n+    this.pathToUnselectedArtifact = checkNotNull(pathToUnselectedArtifact);\n+    this.pathToSelectedArtifact = checkNotNull(pathToSelectedArtifact);\n+  }\n+\n+  public DependencyPath getPathToUnselectedArtifact() {\n+    return pathToUnselectedArtifact;\n+  }\n+\n+  public DependencyPath getPathToSelectedArtifact() {\n+    return pathToSelectedArtifact;\n+  }\n+\n+  @Override\n+  public String toString() {\n+    Artifact selected = pathToSelectedArtifact.getLeaf();\n+    Artifact unselected = pathToUnselectedArtifact.getLeaf();\n+\n+    return \"Dependency conflict: \"\n+        + Artifacts.toCoordinates(selected)\n+        + \" was in the class path \"\n+        + \"but version '\"\n+        + unselected.getVersion()\n+        + \"' has a valid symbol.\\n\"\n+        + \"  selected: \"\n+        + pathToSelectedArtifact\n+        + \"\\n  unselected: \"\n+        + pathToUnselectedArtifact;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223fa5321f65306ec25f6c4f24e6c7cc80b2bb02"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwOTM5MDkw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-450939090", "createdAt": "2020-07-17T20:29:28Z", "commit": {"oid": "223fa5321f65306ec25f6c4f24e6c7cc80b2bb02"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwOTQ4MDc3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-450948077", "createdAt": "2020-07-17T20:47:18Z", "commit": {"oid": "223fa5321f65306ec25f6c4f24e6c7cc80b2bb02"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/31f6049a80cffc0fcc701db082da2e2b49cba364", "committedDate": "2020-07-20T16:06:24Z", "message": "Better toString with symbol"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzYwMzAw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-451760300", "createdAt": "2020-07-20T16:17:46Z", "commit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoxNzo0NlrOG0VlgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoxOTozMVrOG0Vp0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMjgwMQ==", "bodyText": "arg1 means nothing. You can drop it.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r457532801", "createdAt": "2020-07-20T16:17:46Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -50,13 +54,15 @@ public DependencyPath getPathToSelectedArtifact() {\n   public String toString() {\n     Artifact selected = pathToSelectedArtifact.getLeaf();\n     Artifact unselected = pathToUnselectedArtifact.getLeaf();\n-\n+    //    com.google:foo:1 (selected in the class path) does not have symbol 'java.lang.Object's\n+    // method equals(Object arg1)' but version '2' has it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMzcwOA==", "bodyText": "I'm not sure you need the word \"symbol\" here. I think this can be\ncom.google:foo:1 (selected in the class path) does not have the method 'java.lang.Object#equals(Object)' but version 2 has it.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r457533708", "createdAt": "2020-07-20T16:19:12Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -50,13 +54,15 @@ public DependencyPath getPathToSelectedArtifact() {\n   public String toString() {\n     Artifact selected = pathToSelectedArtifact.getLeaf();\n     Artifact unselected = pathToUnselectedArtifact.getLeaf();\n-\n+    //    com.google:foo:1 (selected in the class path) does not have symbol 'java.lang.Object's", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMzkwNA==", "bodyText": "no need to use quote marks here.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r457533904", "createdAt": "2020-07-20T16:19:31Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -50,13 +54,15 @@ public DependencyPath getPathToSelectedArtifact() {\n   public String toString() {\n     Artifact selected = pathToSelectedArtifact.getLeaf();\n     Artifact unselected = pathToUnselectedArtifact.getLeaf();\n-\n+    //    com.google:foo:1 (selected in the class path) does not have symbol 'java.lang.Object's\n+    // method equals(Object arg1)' but version '2' has it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f33b20b16c9ae456ffeb76e40f332e4bdd094790", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f33b20b16c9ae456ffeb76e40f332e4bdd094790", "committedDate": "2020-07-20T16:20:11Z", "message": "Removed arg1, arg2 in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "568bc25407498d281f7e205f3010914d02f5b167", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/568bc25407498d281f7e205f3010914d02f5b167", "committedDate": "2020-07-20T16:42:52Z", "message": "Removed 'the symbol'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzU4NzUw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-451758750", "createdAt": "2020-07-20T16:15:45Z", "commit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoxNTo0NVrOG0VggQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoyMDo0OVrOG0X4Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMTUyMQ==", "bodyText": "This change removes \"arg0, arg1, ...\" in the method arguments.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r457531521", "createdAt": "2020-07-20T16:15:45Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/MethodSymbol.java", "diffHunk": "@@ -77,10 +79,15 @@ public int hashCode() {\n     return Objects.hash(this.getClassBinaryName(), name, descriptor, isInterfaceMethod);\n   }\n \n+  // This empty table removes the argument name in toString()\n+  private static LocalVariableTable emptyLocalVariableTable =\n+      new LocalVariableTable(0, 0, new LocalVariable[0], null);\n+\n   @Override\n   public String toString() {\n     // https://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html#jls-8.4.2\n-    String signaturePlusReturnType = Utility.methodSignatureToString(descriptor, name, \"\");\n+    String signaturePlusReturnType =\n+        Utility.methodSignatureToString(descriptor, name, \"\", true, emptyLocalVariableTable);\n     String signature = signaturePlusReturnType.substring(signaturePlusReturnType.indexOf(' ') + 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDEwOA==", "bodyText": "Removed arg.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r457570108", "createdAt": "2020-07-20T17:20:25Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -50,13 +54,15 @@ public DependencyPath getPathToSelectedArtifact() {\n   public String toString() {\n     Artifact selected = pathToSelectedArtifact.getLeaf();\n     Artifact unselected = pathToUnselectedArtifact.getLeaf();\n-\n+    //    com.google:foo:1 (selected in the class path) does not have symbol 'java.lang.Object's\n+    // method equals(Object arg1)' but version '2' has it.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMjgwMQ=="}, "originalCommit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDEyMw==", "bodyText": "Removed \"the symbol\"", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r457570123", "createdAt": "2020-07-20T17:20:26Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -50,13 +54,15 @@ public DependencyPath getPathToSelectedArtifact() {\n   public String toString() {\n     Artifact selected = pathToSelectedArtifact.getLeaf();\n     Artifact unselected = pathToUnselectedArtifact.getLeaf();\n-\n+    //    com.google:foo:1 (selected in the class path) does not have symbol 'java.lang.Object's", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMzcwOA=="}, "originalCommit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDM5NA==", "bodyText": "This version part is replaced with artifact coordinates without quotes, because now the two artifact coordinates are placed a bit far.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r457570394", "createdAt": "2020-07-20T17:20:49Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -50,13 +54,15 @@ public DependencyPath getPathToSelectedArtifact() {\n   public String toString() {\n     Artifact selected = pathToSelectedArtifact.getLeaf();\n     Artifact unselected = pathToUnselectedArtifact.getLeaf();\n-\n+    //    com.google:foo:1 (selected in the class path) does not have symbol 'java.lang.Object's\n+    // method equals(Object arg1)' but version '2' has it.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMzkwNA=="}, "originalCommit": {"oid": "31f6049a80cffc0fcc701db082da2e2b49cba364"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODM1MTcy", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-451835172", "createdAt": "2020-07-20T17:58:57Z", "commit": {"oid": "568bc25407498d281f7e205f3010914d02f5b167"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50601b09dd8b1a602d59f77fc81d9c09f9a572e1", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/50601b09dd8b1a602d59f77fc81d9c09f9a572e1", "committedDate": "2020-07-20T18:17:06Z", "message": "Simplifying the message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjkzMjIz", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-452693223", "createdAt": "2020-07-21T17:48:56Z", "commit": {"oid": "50601b09dd8b1a602d59f77fc81d9c09f9a572e1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0ODo1NlrOG1DNJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo1MToxNlrOG1DSeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MDIzMQ==", "bodyText": "How does this handle the case where there's more than one unselected artifact? I.e. when there's three or more versions in the tree?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r458280231", "createdAt": "2020-07-21T17:48:56Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/DependencyConflict.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.cloud.tools.opensource.dependencies.Artifacts;\n+import com.google.cloud.tools.opensource.dependencies.DependencyPath;\n+import java.util.Objects;\n+import org.eclipse.aether.artifact.Artifact;\n+\n+/**\n+ * Diamond dependency conflict caused a {@link LinkageProblem} where the {@link LinkageProblem}'s\n+ * invalid reference points to the symbol in {@code pathToSelectedArtifact.getLeaf()} but a valid\n+ * symbol is in {@code pathToUnselectedArtifact.getLeaf()}.\n+ */\n+class DependencyConflict extends LinkageProblemCause {\n+  private Symbol symbol;\n+  private DependencyPath pathToUnselectedArtifact;\n+  private DependencyPath pathToSelectedArtifact;\n+\n+  DependencyConflict(\n+      Symbol symbol,\n+      DependencyPath pathToSelectedArtifact,\n+      DependencyPath pathToUnselectedArtifact) {\n+    this.symbol = checkNotNull(symbol);\n+    this.pathToUnselectedArtifact = checkNotNull(pathToUnselectedArtifact);\n+    this.pathToSelectedArtifact = checkNotNull(pathToSelectedArtifact);\n+  }\n+\n+  public DependencyPath getPathToUnselectedArtifact() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50601b09dd8b1a602d59f77fc81d9c09f9a572e1"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MTU5NA==", "bodyText": "perhaps final", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r458281594", "createdAt": "2020-07-21T17:51:16Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/UnknownCause.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * Linkage Checker cannot determine the cause of the linkage error.\n+ *\n+ * <p>This occurs when the POM file that used in building a library and the published POM file are\n+ * different.\n+ */\n+public class UnknownCause extends LinkageProblemCause {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50601b09dd8b1a602d59f77fc81d9c09f9a572e1"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0c017277201c12314b5afc48d70e2f7cf7075b3", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a0c017277201c12314b5afc48d70e2f7cf7075b3", "committedDate": "2020-07-21T18:50:42Z", "message": "final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf4678ca72e9715a00277fe623cad5c3cf5959bd", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/cf4678ca72e9715a00277fe623cad5c3cf5959bd", "committedDate": "2020-07-21T18:51:38Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69385cface6c64edce2ac85472daf2b7289073d3", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/69385cface6c64edce2ac85472daf2b7289073d3", "committedDate": "2020-07-21T20:25:50Z", "message": "pathToTheArtifactThruSource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODA2Njc3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-452806677", "createdAt": "2020-07-21T20:32:02Z", "commit": {"oid": "69385cface6c64edce2ac85472daf2b7289073d3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9964c6a8beb4e12ff31e4a8405c92abfff77cb2", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e9964c6a8beb4e12ff31e4a8405c92abfff77cb2", "committedDate": "2020-07-23T15:01:05Z", "message": "Merge remote-tracking branch 'origin/master' into cause"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa022566eb8f6a09935434dc4a83f1d28a28c14a", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/fa022566eb8f6a09935434dc4a83f1d28a28c14a", "committedDate": "2020-07-23T15:15:02Z", "message": "Removing 'the'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjU4MjQ4", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#pullrequestreview-454258248", "createdAt": "2020-07-23T15:35:33Z", "commit": {"oid": "fa022566eb8f6a09935434dc4a83f1d28a28c14a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNTozNTozM1rOG2QNAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNTozNjozOFrOG2QPwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU0MTc2Mw==", "bodyText": "except we don't handle version ranges :-(", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r459541763", "createdAt": "2020-07-23T15:35:33Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilder.java", "diffHunk": "@@ -48,34 +48,47 @@ public ClassPathBuilder(DependencyGraphBuilder dependencyGraphBuilder) {\n   }\n \n   /**\n-   * Builds a classpath from the transitive dependency graph of a list of artifacts.\n-   * When there are multiple versions of an artifact in\n-   * the dependency tree, the closest to the root in breadth-first order is picked up. This \"pick\n-   * closest\" strategy follows Maven's dependency mediation.\n+   * Builds a classpath from the transitive dependency graph from {@code artifacts}. When there are\n+   * multiple versions of an artifact in the dependency tree, the closest to the root in\n+   * breadth-first order is picked up. This \"pick closest\" strategy follows Maven's dependency\n+   * mediation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa022566eb8f6a09935434dc4a83f1d28a28c14a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU0MjQ2NA==", "bodyText": "findEntryBySymbol to parallel findEntryById", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1535#discussion_r459542464", "createdAt": "2020-07-23T15:36:38Z", "author": {"login": "elharo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathResult.java", "diffHunk": "@@ -111,5 +112,32 @@ public String formatDependencyPaths(Iterable<ClassPathEntry> entries) {\n     }\n     return builder.build();\n   }\n-  \n+\n+  /**\n+   * Returns the class path entry for the artifact that matches {@code groupId} and {@code\n+   * artifactId}. {@code Null} if no matching artifact is found.\n+   */\n+  ClassPathEntry findEntryById(String groupId, String artifactId) {\n+    for (ClassPathEntry entry : getClassPath()) {\n+      Artifact artifact = entry.getArtifact();\n+      if (artifact.getGroupId().equals(groupId) && artifact.getArtifactId().equals(artifactId)) {\n+        return entry;\n+      }\n+    }\n+    return null;\n+  }\n+\n+  /**\n+   * Returns the class path entry that contains the class of {@code symbol}. {@code Null} if no\n+   * matching entry is found.\n+   */\n+  ClassPathEntry findClassPathEntryForSymbol(Symbol symbol) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa022566eb8f6a09935434dc4a83f1d28a28c14a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c54cc152b1ae77e724abad002c2f6d0bf79bae2d", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c54cc152b1ae77e724abad002c2f6d0bf79bae2d", "committedDate": "2020-07-23T15:58:03Z", "message": "findEntryBySymbol"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 252, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}