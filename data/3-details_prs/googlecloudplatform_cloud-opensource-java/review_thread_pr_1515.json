{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0OTI0OTMx", "number": 1515, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNDo1NFrOELym0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODoyOTowNVrOELzGDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzk4OTI4OnYy", "diffSide": "RIGHT", "path": "gradle-plugin/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNDo1NFrOGth0Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNDo1NFrOGth0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5MzE0Mw==", "bodyText": "Jib also uses this plugin https://github.com/GoogleContainerTools/jib/blob/master/jib-gradle-plugin/build.gradle#L3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1515#discussion_r450393143", "createdAt": "2020-07-06T18:04:54Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/build.gradle", "diffHunk": "@@ -18,6 +18,8 @@ plugins {\n   id 'com.gradle.plugin-publish' version \"0.12.0\"\n   id 'groovy'\n   id 'java-gradle-plugin'\n+  id 'maven-publish'\n+  id 'net.researchgate.release' version '2.8.1'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bc5fe13bad64b2cf0df33aad3502ddf94d6e577"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzk5NDY5OnYy", "diffSide": "RIGHT", "path": "gradle-plugin/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNjoxMlrOGth3OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNjoxMlrOGth3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5MzkxMw==", "bodyText": "The plugin tags the version \"vX.Y.Z-gradle\"", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1515#discussion_r450393913", "createdAt": "2020-07-06T18:06:12Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/build.gradle", "diffHunk": "@@ -74,3 +65,12 @@ pluginBundle {\n   description = 'A plugin to detect Java diamond dependency conflicts'\n   tags = ['google', 'java', 'dependency','verification']\n }\n+\n+release {\n+  tagTemplate = 'v$version-gradle'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bc5fe13bad64b2cf0df33aad3502ddf94d6e577"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwODAwMDEyOnYy", "diffSide": "RIGHT", "path": "scripts/prepare_release.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNzozM1rOGth6WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODowNzozM1rOGth6WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5NDcxMw==", "bodyText": "For \"bom\" and \"dependencies\", this script uses \"mvn versions\" to set version.\nFor \"gradle\", this script uses net.researchgate.release plugin.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1515#discussion_r450394713", "createdAt": "2020-07-06T18:07:33Z", "author": {"login": "suztomo"}, "path": "scripts/prepare_release.sh", "diffHunk": "@@ -65,27 +65,33 @@ git pull\n git checkout -b ${VERSION}-${SUFFIX}\n \n \n-if [[ \"${SUFFIX}\" = \"bom\" ]]; then\n-  cd boms/cloud-oss-bom\n-fi\n-\n-# Updates the pom.xml with the version to release.\n-mvn versions:set versions:commit -DnewVersion=${VERSION} -DgenerateBackupPoms=false\n-\n-# Tags a new commit for this release.\n-git commit -am \"preparing release ${VERSION}-${SUFFIX}\"\n-git tag v${VERSION}-${SUFFIX}\n-\n # Updates the pom.xml with the next snapshot version.\n # For example, when releasing 1.5.7, the next snapshot version would be 1.5.8-SNAPSHOT.\n NEXT_SNAPSHOT=${NEXT_VERSION}\n if [[ \"${NEXT_SNAPSHOT}\" != *-SNAPSHOT ]]; then\n   NEXT_SNAPSHOT=${NEXT_SNAPSHOT}-SNAPSHOT\n fi\n-mvn versions:set versions:commit -DnewVersion=${NEXT_SNAPSHOT} -DgenerateBackupPoms=false\n \n-# Commits this next snapshot version.\n-git commit -am \"${NEXT_SNAPSHOT}\"\n+if [[ \"${SUFFIX}\" = \"bom\" ]]; then\n+  cd boms/cloud-oss-bom\n+fi\n+\n+if [[ \"${SUFFIX}\" = \"gradle\" ]]; then\n+  cd gradle-plugin\n+  # Changes the version for release and creates the commits/tags.\n+  echo | ./gradlew release -Prelease.releaseVersion=${VERSION} \\\n+      -Prelease.newVersion=${NEXT_SNAPSHOT}\n+else\n+  # Updates the pom.xml with the version to release.\n+  mvn versions:set versions:commit -DnewVersion=${VERSION} -DgenerateBackupPoms=false\n+  # Tags a new commit for this release.\n+  git commit -am \"preparing release ${VERSION}-${SUFFIX}\"\n+  git tag v${VERSION}-${SUFFIX}\n+  mvn versions:set versions:commit -DnewVersion=${NEXT_SNAPSHOT} -DgenerateBackupPoms=false\n+\n+  # Commits this next snapshot version.\n+  git commit -am \"${NEXT_SNAPSHOT}\"\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bc5fe13bad64b2cf0df33aad3502ddf94d6e577"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwODAyMjIxOnYy", "diffSide": "LEFT", "path": "scripts/prepare_release.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODoxNDozOVrOGtiH8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODoxNDozOVrOGtiH8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5ODE5Mg==", "bodyText": "These \"mvn versions:set\" and \"git commit\" are moving to 10 lines below.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1515#discussion_r450398192", "createdAt": "2020-07-06T18:14:39Z", "author": {"login": "suztomo"}, "path": "scripts/prepare_release.sh", "diffHunk": "@@ -65,27 +65,33 @@ git pull\n git checkout -b ${VERSION}-${SUFFIX}\n \n \n-if [[ \"${SUFFIX}\" = \"bom\" ]]; then\n-  cd boms/cloud-oss-bom\n-fi\n-\n-# Updates the pom.xml with the version to release.\n-mvn versions:set versions:commit -DnewVersion=${VERSION} -DgenerateBackupPoms=false\n-\n-# Tags a new commit for this release.\n-git commit -am \"preparing release ${VERSION}-${SUFFIX}\"\n-git tag v${VERSION}-${SUFFIX}\n-\n # Updates the pom.xml with the next snapshot version.\n # For example, when releasing 1.5.7, the next snapshot version would be 1.5.8-SNAPSHOT.\n NEXT_SNAPSHOT=${NEXT_VERSION}\n if [[ \"${NEXT_SNAPSHOT}\" != *-SNAPSHOT ]]; then\n   NEXT_SNAPSHOT=${NEXT_SNAPSHOT}-SNAPSHOT\n fi\n-mvn versions:set versions:commit -DnewVersion=${NEXT_SNAPSHOT} -DgenerateBackupPoms=false\n \n-# Commits this next snapshot version.\n-git commit -am \"${NEXT_SNAPSHOT}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12e7814b3e41bbde707c2bc5ed1e636fe5f7fbb"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwODA2OTI0OnYy", "diffSide": "RIGHT", "path": "gradle-plugin/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODoyOTowNVrOGtikfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODoyOTowNVrOGtikfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwNTUwMw==", "bodyText": "The official \"publish\" plugin does not seem to support BOM (platform) when it generates pom.xml :(\nHardcoding the version from https://search.maven.org/artifact/com.google.cloud.tools/dependencies-parent/1.4.3/pom for now. #1516 to followup.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1515#discussion_r450405503", "createdAt": "2020-07-06T18:29:05Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/build.gradle", "diffHunk": "@@ -27,10 +28,9 @@ group = 'com.google.cloud.tools'\n sourceCompatibility = 1.8\n \n dependencies {\n-  implementation platform('com.google.cloud.tools:dependencies-parent:1.4.3')\n   implementation 'com.google.cloud.tools:dependencies:1.4.3'\n-  implementation 'com.google.guava:guava'\n-  implementation 'org.apache.maven.resolver:maven-resolver-api'\n+  implementation 'com.google.guava:guava:29.0-jre'\n+  implementation 'org.apache.maven.resolver:maven-resolver-api:1.4.2'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea764daa12072aa4872aac669b7c83abe12ff9d0"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2628, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}