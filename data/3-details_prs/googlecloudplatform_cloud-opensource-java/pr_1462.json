{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNTczOTc2", "number": 1462, "title": "Gradle plugins to run Linkage Checker for Configurations", "bodyText": "With this PR, the plugin reads the configurations of a project and runs LinkageChecker against the class path of the configuration.\nA \"configuration\" is (almost similar to) a class path in Gradle terms. Gradle uses different configurations for different tasks. For example, the configurations for \"compileJava\" task and \"test\" task are different.", "createdAt": "2020-06-10T16:36:13Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462", "merged": true, "mergeCommit": {"oid": "08f8636e07792b0f74dcbd05e26ac302839dec89"}, "closed": true, "closedAt": "2020-06-11T13:30:13Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp73aVAH2gAyNDMyNTczOTc2OjRiNjkwNTdjOTBjMjIzMzFlODY5MDJmNGM4M2E1MWUyYzU5NTM3Zjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqOO7ugFqTQyODkwMzM3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4b69057c90c22331e86902f4c83a51e2c59537f9", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/4b69057c90c22331e86902f4c83a51e2c59537f9", "committedDate": "2020-06-10T16:01:54Z", "message": "Ignore gradle files created by IDE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df3986a2abc6db1db8b9cc6d38fb996df878d806", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/df3986a2abc6db1db8b9cc6d38fb996df878d806", "committedDate": "2020-06-10T16:02:24Z", "message": "Example project to detect dependency conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9c23273797b3b2354709af82e4918aecf22ad10", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f9c23273797b3b2354709af82e4918aecf22ad10", "committedDate": "2020-06-10T16:09:50Z", "message": "Task to run Linkage Checker with dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff40fb538d1a158f10fce6877069840c31822761", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/ff40fb538d1a158f10fce6877069840c31822761", "committedDate": "2020-06-10T16:26:19Z", "message": "message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9d4367c072c13b632ab73c456631a0669efa204", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c9d4367c072c13b632ab73c456631a0669efa204", "committedDate": "2020-06-10T16:43:27Z", "message": "Merge remote-tracking branch 'origin/master' into gradle_linkage_checker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b", "committedDate": "2020-06-10T16:47:08Z", "message": "TODO for reportOnlyReachable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjUzOTI2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#pullrequestreview-428253926", "createdAt": "2020-06-10T16:57:21Z", "commit": {"oid": "e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo1NzoyMVrOGh-HNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjo1ODowNVrOGh-JOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3Mzg0NA==", "bodyText": "rewrite without continue", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438273844", "createdAt": "2020-06-10T16:57:21Z", "author": {"login": "elharo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,109 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      logger.info(\"Checking {}\", configuration);\n+      ImmutableList.Builder<ClassPathEntry> classPathBuilder = ImmutableList.builder();\n+\n+      // TODO(suztomo): Should this include optional dependencies?\n+      //  Once we decide what to do with the optional dependencies, let's revisit this logic.\n+      for (ResolvedArtifact resolvedArtifact :\n+          configuration.getResolvedConfiguration().getResolvedArtifacts()) {\n+        ModuleVersionIdentifier moduleVersionId = resolvedArtifact.getModuleVersion().getId();\n+        DefaultArtifact artifact =\n+            new DefaultArtifact(\n+                moduleVersionId.getGroup(),\n+                moduleVersionId.getName(),\n+                null,\n+                null,\n+                moduleVersionId.getVersion(),\n+                null,\n+                resolvedArtifact.getFile());\n+        classPathBuilder.add(new ClassPathEntry(artifact));\n+      }\n+\n+      ImmutableList<ClassPathEntry> classPath = classPathBuilder.build();\n+      if (classPath.isEmpty()) {\n+        // No artifact for this configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3NDM2Mw==", "bodyText": "There are three placeholders but only two placefillers", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438274363", "createdAt": "2020-06-10T16:58:05Z", "author": {"login": "elharo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,109 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      logger.info(\"Checking {}\", configuration);\n+      ImmutableList.Builder<ClassPathEntry> classPathBuilder = ImmutableList.builder();\n+\n+      // TODO(suztomo): Should this include optional dependencies?\n+      //  Once we decide what to do with the optional dependencies, let's revisit this logic.\n+      for (ResolvedArtifact resolvedArtifact :\n+          configuration.getResolvedConfiguration().getResolvedArtifacts()) {\n+        ModuleVersionIdentifier moduleVersionId = resolvedArtifact.getModuleVersion().getId();\n+        DefaultArtifact artifact =\n+            new DefaultArtifact(\n+                moduleVersionId.getGroup(),\n+                moduleVersionId.getName(),\n+                null,\n+                null,\n+                moduleVersionId.getVersion(),\n+                null,\n+                resolvedArtifact.getFile());\n+        classPathBuilder.add(new ClassPathEntry(artifact));\n+      }\n+\n+      ImmutableList<ClassPathEntry> classPath = classPathBuilder.build();\n+      if (classPath.isEmpty()) {\n+        // No artifact for this configuration\n+        continue;\n+      }\n+      // TODO(suztomo): Specify entry points if reportOnlyReachable is true.\n+      LinkageChecker linkageChecker = LinkageChecker.create(classPath);\n+\n+      ImmutableSetMultimap<SymbolProblem, ClassFile> symbolProblems =\n+          linkageChecker.findSymbolProblems();\n+\n+      int errorCount = symbolProblems.keySet().size();\n+\n+      // TODO(suztomo): Show the dependency paths to the problematic artifacts.\n+      logger.error(\n+          \"Linkage Checker rule found {} error{}. Linkage error report:\\n{}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca393f5be30e5eeec168eb74477835b7f044fc2", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/8ca393f5be30e5eeec168eb74477835b7f044fc2", "committedDate": "2020-06-10T17:22:08Z", "message": "removed continue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjcyMzE2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#pullrequestreview-428272316", "createdAt": "2020-06-10T17:21:19Z", "commit": {"oid": "e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzoyMToxOVrOGh--MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzoyMjozNVrOGh_A_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI4NzkyMA==", "bodyText": "The 3 lines below are the 3 placefillers for the three {}.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438287920", "createdAt": "2020-06-10T17:21:19Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,109 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      logger.info(\"Checking {}\", configuration);\n+      ImmutableList.Builder<ClassPathEntry> classPathBuilder = ImmutableList.builder();\n+\n+      // TODO(suztomo): Should this include optional dependencies?\n+      //  Once we decide what to do with the optional dependencies, let's revisit this logic.\n+      for (ResolvedArtifact resolvedArtifact :\n+          configuration.getResolvedConfiguration().getResolvedArtifacts()) {\n+        ModuleVersionIdentifier moduleVersionId = resolvedArtifact.getModuleVersion().getId();\n+        DefaultArtifact artifact =\n+            new DefaultArtifact(\n+                moduleVersionId.getGroup(),\n+                moduleVersionId.getName(),\n+                null,\n+                null,\n+                moduleVersionId.getVersion(),\n+                null,\n+                resolvedArtifact.getFile());\n+        classPathBuilder.add(new ClassPathEntry(artifact));\n+      }\n+\n+      ImmutableList<ClassPathEntry> classPath = classPathBuilder.build();\n+      if (classPath.isEmpty()) {\n+        // No artifact for this configuration\n+        continue;\n+      }\n+      // TODO(suztomo): Specify entry points if reportOnlyReachable is true.\n+      LinkageChecker linkageChecker = LinkageChecker.create(classPath);\n+\n+      ImmutableSetMultimap<SymbolProblem, ClassFile> symbolProblems =\n+          linkageChecker.findSymbolProblems();\n+\n+      int errorCount = symbolProblems.keySet().size();\n+\n+      // TODO(suztomo): Show the dependency paths to the problematic artifacts.\n+      logger.error(\n+          \"Linkage Checker rule found {} error{}. Linkage error report:\\n{}\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3NDM2Mw=="}, "originalCommit": {"oid": "e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI4ODYzNw==", "bodyText": "Done.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438288637", "createdAt": "2020-06-10T17:22:35Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,109 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      logger.info(\"Checking {}\", configuration);\n+      ImmutableList.Builder<ClassPathEntry> classPathBuilder = ImmutableList.builder();\n+\n+      // TODO(suztomo): Should this include optional dependencies?\n+      //  Once we decide what to do with the optional dependencies, let's revisit this logic.\n+      for (ResolvedArtifact resolvedArtifact :\n+          configuration.getResolvedConfiguration().getResolvedArtifacts()) {\n+        ModuleVersionIdentifier moduleVersionId = resolvedArtifact.getModuleVersion().getId();\n+        DefaultArtifact artifact =\n+            new DefaultArtifact(\n+                moduleVersionId.getGroup(),\n+                moduleVersionId.getName(),\n+                null,\n+                null,\n+                moduleVersionId.getVersion(),\n+                null,\n+                resolvedArtifact.getFile());\n+        classPathBuilder.add(new ClassPathEntry(artifact));\n+      }\n+\n+      ImmutableList<ClassPathEntry> classPath = classPathBuilder.build();\n+      if (classPath.isEmpty()) {\n+        // No artifact for this configuration", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3Mzg0NA=="}, "originalCommit": {"oid": "e8855b8c4ded4dbfd1b3a868ea9d55c295d98b4b"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzQ4ODU0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#pullrequestreview-428348854", "createdAt": "2020-06-10T19:06:14Z", "commit": {"oid": "8ca393f5be30e5eeec168eb74477835b7f044fc2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTowNjoxNFrOGiCmAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTowNzozNFrOGiCo1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NzI2Ng==", "bodyText": "Linkage", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438347266", "createdAt": "2020-06-10T19:06:14Z", "author": {"login": "elharo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckerPluginExtension.java", "diffHunk": "@@ -16,20 +16,33 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.common.collect.ImmutableSet;\n+import java.util.List;\n+\n /**\n  * Properties to control the behavior of the Linakge Checker plugin.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ca393f5be30e5eeec168eb74477835b7f044fc2"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0Nzk5MQ==", "bodyText": "does this log if errorCount is zero?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438347991", "createdAt": "2020-06-10T19:07:34Z", "author": {"login": "elharo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,107 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      logger.info(\"Checking {}\", configuration);\n+      ImmutableList.Builder<ClassPathEntry> classPathBuilder = ImmutableList.builder();\n+\n+      // TODO(suztomo): Should this include optional dependencies?\n+      //  Once we decide what to do with the optional dependencies, let's revisit this logic.\n+      for (ResolvedArtifact resolvedArtifact :\n+          configuration.getResolvedConfiguration().getResolvedArtifacts()) {\n+        ModuleVersionIdentifier moduleVersionId = resolvedArtifact.getModuleVersion().getId();\n+        DefaultArtifact artifact =\n+            new DefaultArtifact(\n+                moduleVersionId.getGroup(),\n+                moduleVersionId.getName(),\n+                null,\n+                null,\n+                moduleVersionId.getVersion(),\n+                null,\n+                resolvedArtifact.getFile());\n+        classPathBuilder.add(new ClassPathEntry(artifact));\n+      }\n+\n+      ImmutableList<ClassPathEntry> classPath = classPathBuilder.build();\n+      if (!classPath.isEmpty()) {\n+        // TODO(suztomo): Specify entry points if reportOnlyReachable is true.\n+        LinkageChecker linkageChecker = LinkageChecker.create(classPath);\n+\n+        ImmutableSetMultimap<SymbolProblem, ClassFile> symbolProblems =\n+            linkageChecker.findSymbolProblems();\n+\n+        int errorCount = symbolProblems.keySet().size();\n+\n+        // TODO(suztomo): Show the dependency paths to the problematic artifacts.\n+        logger.error(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ca393f5be30e5eeec168eb74477835b7f044fc2"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07ddad343913030c1b28ae995fdbc6a21b0b7fc2", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/07ddad343913030c1b28ae995fdbc6a21b0b7fc2", "committedDate": "2020-06-10T21:17:10Z", "message": "Merge remote-tracking branch 'origin/master' into gradle_linkage_checker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b5fc217ef92700d7420d4a9a99b00bedbc0e449", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/9b5fc217ef92700d7420d4a9a99b00bedbc0e449", "committedDate": "2020-06-10T21:17:21Z", "message": "Error message only when there are errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2cb7797082860863c41b2063ecb732e3c2dcda9", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d2cb7797082860863c41b2063ecb732e3c2dcda9", "committedDate": "2020-06-10T21:19:17Z", "message": "Fixed typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e30fef0bcb89ac588adce4ede15c79c912f7e596", "committedDate": "2020-06-10T21:25:40Z", "message": "Extracted findLinkageErrors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDQyNTI5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#pullrequestreview-428442529", "createdAt": "2020-06-10T21:30:18Z", "commit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTozMDoxOFrOGiG_hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTozMDoxOFrOGiG_hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQxOTMzMg==", "bodyText": "Memo: accessing the logger field is the reason why this method is not a static method, while I see making this static does not provide advantage.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438419332", "createdAt": "2020-06-10T21:30:18Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,115 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      foundError |= findLinkageErrors(configuration);\n+    }\n+\n+    if (foundError) {\n+      throw new GradleException(\n+          \"Linkage Checker found errors in configurations. See above for the details.\");\n+    }\n+  }\n+\n+  /** Returns true iff {@code configuration}'s artifacts contain linkage errors. */\n+  private boolean findLinkageErrors(Configuration configuration) throws IOException {\n+    ImmutableList.Builder<ClassPathEntry> classPathBuilder = ImmutableList.builder();\n+\n+    // TODO(suztomo): Should this include optional dependencies?\n+    //  Once we decide what to do with the optional dependencies, let's revisit this logic.\n+    for (ResolvedArtifact resolvedArtifact :\n+        configuration.getResolvedConfiguration().getResolvedArtifacts()) {\n+      ModuleVersionIdentifier moduleVersionId = resolvedArtifact.getModuleVersion().getId();\n+      DefaultArtifact artifact =\n+          new DefaultArtifact(\n+              moduleVersionId.getGroup(),\n+              moduleVersionId.getName(),\n+              null,\n+              null,\n+              moduleVersionId.getVersion(),\n+              null,\n+              resolvedArtifact.getFile());\n+      classPathBuilder.add(new ClassPathEntry(artifact));\n+    }\n+\n+    ImmutableList<ClassPathEntry> classPath = classPathBuilder.build();\n+    if (!classPath.isEmpty()) {\n+      // TODO(suztomo): Specify entry points if reportOnlyReachable is true.\n+      LinkageChecker linkageChecker = LinkageChecker.create(classPath);\n+\n+      ImmutableSetMultimap<SymbolProblem, ClassFile> symbolProblems =\n+          linkageChecker.findSymbolProblems();\n+\n+      int errorCount = symbolProblems.keySet().size();\n+\n+      // TODO(suztomo): Show the dependency paths to the problematic artifacts.\n+      if (errorCount > 0) {\n+        logger.error(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDcxNTE1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#pullrequestreview-428471515", "createdAt": "2020-06-10T22:28:34Z", "commit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMjoyODozNFrOGiIY-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMjozMDo1NFrOGiIcbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0MjIzNQ==", "bodyText": "private", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438442235", "createdAt": "2020-06-10T22:28:34Z", "author": {"login": "elharo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,115 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0MjQ0MA==", "bodyText": "why do we have a logger field at all? Can we just call getLogger when we need it?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438442440", "createdAt": "2020-06-10T22:29:07Z", "author": {"login": "elharo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,115 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0MzExNg==", "bodyText": "I'm not sure I've ever actually seen this operator used before. Bitwise assignment equal is strange. Consider simply\nif (findLinkageErrors(...))\n  foundError = true;\n}", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438443116", "createdAt": "2020-06-10T22:30:54Z", "author": {"login": "elharo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,115 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      foundError |= findLinkageErrors(configuration);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09655a4172b54dbc7c0b3360a754dbca8baad9dd", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/09655a4172b54dbc7c0b3360a754dbca8baad9dd", "committedDate": "2020-06-10T22:43:56Z", "message": "Removed logger field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDc4MzUx", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#pullrequestreview-428478351", "createdAt": "2020-06-10T22:44:37Z", "commit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMjo0NDozN1rOGiIuKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMjo0NjoyNFrOGiIwjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0NzY1OQ==", "bodyText": "Removed the field.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438447659", "createdAt": "2020-06-10T22:44:37Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,115 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0MjIzNQ=="}, "originalCommit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0NzcyMw==", "bodyText": "That's a nice idea. Removed the logger field.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438447723", "createdAt": "2020-06-10T22:44:47Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,115 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0MjQ0MA=="}, "originalCommit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0ODI3MQ==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#discussion_r438448271", "createdAt": "2020-06-10T22:46:24Z", "author": {"login": "suztomo"}, "path": "gradle-plugin/src/main/java/com/google/cloud/tools/dependencies/gradle/LinkageCheckTask.java", "diffHunk": "@@ -16,27 +16,115 @@\n \n package com.google.cloud.tools.dependencies.gradle;\n \n+import com.google.cloud.tools.opensource.classpath.ClassFile;\n+import com.google.cloud.tools.opensource.classpath.ClassPathEntry;\n import com.google.cloud.tools.opensource.classpath.LinkageChecker;\n+import com.google.cloud.tools.opensource.classpath.SymbolProblem;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableSetMultimap;\n import java.io.IOException;\n+import org.eclipse.aether.artifact.DefaultArtifact;\n import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.Project;\n+import org.gradle.api.artifacts.Configuration;\n+import org.gradle.api.artifacts.ModuleVersionIdentifier;\n+import org.gradle.api.artifacts.ResolvedArtifact;\n+import org.gradle.api.logging.Logger;\n import org.gradle.api.tasks.TaskAction;\n \n /**\n  * Task to run Linkage Checker for the dependencies of the Gradle project.\n  */\n public class LinkageCheckTask extends DefaultTask {\n+\n+  Logger logger;\n+\n   @TaskAction\n   public void run() throws IOException {\n+    logger = getLogger();\n+\n     LinkageCheckerPluginExtension extension =\n         getProject().getExtensions().findByType(LinkageCheckerPluginExtension.class);\n     if (extension == null) {\n       extension = new LinkageCheckerPluginExtension();\n     }\n \n-    // TODO(suztomo): run linkage checker for the dependencies of the Gradle project.\n-    String message = extension.getMessage();\n-    LinkageChecker linkageChecker = LinkageChecker.create(ImmutableList.of());\n-    System.out.println(\"Hello from \" + linkageChecker + \": \" + message);\n+    Project project = getProject();\n+    ImmutableSet.Builder<Configuration> configurationsBuilder = ImmutableSet.builder();\n+    if (extension.getConfigurations().isEmpty()) {\n+      // Should this default to runtime?\n+      logger.trace(\"No configuration specified, defaulting to all configurations\");\n+      for (Configuration configuration : project.getConfigurations()) {\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    } else {\n+      for (String configurationName : extension.getConfigurations()) {\n+        Configuration configuration = project.getConfigurations().getByName(configurationName);\n+        if (configuration.isCanBeResolved()) {\n+          configurationsBuilder.add(configuration);\n+        }\n+      }\n+    }\n+\n+    ImmutableSet<Configuration> configurations = configurationsBuilder.build();\n+\n+    boolean foundError = false;\n+    for (Configuration configuration : configurations) {\n+      foundError |= findLinkageErrors(configuration);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ0MzExNg=="}, "originalCommit": {"oid": "e30fef0bcb89ac588adce4ede15c79c912f7e596"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTAzMzcy", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1462#pullrequestreview-428903372", "createdAt": "2020-06-11T13:25:53Z", "commit": {"oid": "09655a4172b54dbc7c0b3360a754dbca8baad9dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 196, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}