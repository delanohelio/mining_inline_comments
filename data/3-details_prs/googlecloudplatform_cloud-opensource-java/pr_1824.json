{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MTk2NDY1", "number": 1824, "title": "No tools.jar in testFindLinkageProblems_unusedClassReferenceInByteCode", "bodyText": "Fixes #1823\ntools.jar does not exist in Java 11. The test should not rely on the jar file.\nThe two classes com.sun.tools.ws.wscompile.WsgenOptions and com.sun.xml.ws.api.BindingID$SOAPHTTPImpl the test needed from the tools.jar are available in com.sun.xml.ws:jaxws-tools:2.3.3 and com.sun.xml.ws:jaxws-rt:2.3.3.", "createdAt": "2020-11-19T19:59:16Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1824", "merged": true, "mergeCommit": {"oid": "eaf0f202186628898e1171d762ab5cfa17112afb"}, "closed": true, "closedAt": "2020-11-19T21:07:27Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeIVphgH2gAyNTI0MTk2NDY1Ojc0NmQwMWM0MTMzZDg1MTc4YzEyNzZhMTQ4OWFmMzJlNjZlMjZiMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeIisfAFqTUzNDgxMTg0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "746d01c4133d85178c1276a1489af32e66e26b39", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/746d01c4133d85178c1276a1489af32e66e26b39", "committedDate": "2020-11-19T19:57:51Z", "message": "No tools.jar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0ODA0NTM5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1824#pullrequestreview-534804539", "createdAt": "2020-11-19T20:01:53Z", "commit": {"oid": "746d01c4133d85178c1276a1489af32e66e26b39"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0550bb0741314746e22ac9e2517a0cec0b6195c6", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/0550bb0741314746e22ac9e2517a0cec0b6195c6", "committedDate": "2020-11-19T20:02:25Z", "message": "javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0ODEwOTcz", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1824#pullrequestreview-534810973", "createdAt": "2020-11-19T20:10:59Z", "commit": {"oid": "0550bb0741314746e22ac9e2517a0cec0b6195c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxMDo1OVrOH2vwRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxMDo1OVrOH2vwRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2NzU1Nw==", "bodyText": "This class is a private class.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1824#discussion_r527167557", "createdAt": "2020-11-19T20:10:59Z", "author": {"login": "suztomo"}, "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/LinkageCheckerTest.java", "diffHunk": "@@ -1152,22 +1151,39 @@ public void testFindLinkageProblems_referenceToJava11Method() throws IOException\n \n   @Test\n   public void testFindLinkageProblems_unusedClassReferenceInByteCode() throws IOException {\n-    // JDK's tools.jar contains com.sun.tools.internal.ws.wscompile.WsgenOptions class. The class\n-    // has the class reference to JDK's com.sun.xml.internal.ws.api.BindingID$SOAPHTTPImpl in its\n-    // constant pool section. The referenced class is private but it's not used in the JVM\n-    // instructions in the class file.\n-    // https://github.com/GoogleCloudPlatform/cloud-opensource-java/issues/1608\n-\n-    String javaHomeDirectory = System.getProperty(\"java.home\");\n-    Path toolsJar = Paths.get(javaHomeDirectory, \"..\", \"lib\", \"tools.jar\");\n-    Artifact toolsArtifact =\n-        new DefaultArtifact(\"com.sun:tools:jar:1.8\").setFile(toolsJar.toFile());\n-\n-    LinkageChecker linkageChecker =\n-        LinkageChecker.create(ImmutableList.of(new ClassPathEntry(toolsArtifact)));\n+    // com.sun.tools.ws.wscompile.WsgenOptions in jaxws-tools has the class reference to\n+    // com.sun.xml.ws.api.BindingID$SOAPHTTPImpl in its constant pool section. The referenced class\n+    // is private but it's not used in the JVM instruction in the referencing class file. Therefore\n+    // the Linkage Checker should not report it as a symbol problem.\n+    // The problem was observed in Java 8's tools.jar (\n+    // https://github.com/GoogleCloudPlatform/cloud-opensource-java/issues/1608). In Java 11, the\n+    // JDK does not provide the class any more. The two artifacts below have the classes with\n+    // different packages (they are no longer 'internal').\n+    ImmutableList<ClassPathEntry> classPath =\n+        TestHelper.resolve(\n+            \"com.sun.xml.ws:jaxws-tools:2.3.3\", // This contains WsgenOptions\n+            \"com.sun.xml.ws:jaxws-rt:2.3.3\"); // This contains BindingID$SOAPHTTPImpl\n+    String wsgenOptionsClassName = \"com.sun.tools.ws.wscompile.WsgenOptions\";\n+\n+    // Ensure the class path contains the two classes in the issue (#1608).\n+    ClassDumper classDumper = ClassDumper.create(classPath);\n+    SymbolReferences symbolReferences = classDumper.findSymbolReferences();\n+    ImmutableSet<ClassSymbol> classSymbols =\n+        symbolReferences.getClassSymbols(new ClassFile(classPath.get(0), wsgenOptionsClassName));\n+    Truth.assertThat(classSymbols)\n+        .contains(new ClassSymbol(\"com.sun.xml.ws.api.BindingID$SOAPHTTPImpl\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0550bb0741314746e22ac9e2517a0cec0b6195c6"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0ODExODQw", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1824#pullrequestreview-534811840", "createdAt": "2020-11-19T20:12:06Z", "commit": {"oid": "0550bb0741314746e22ac9e2517a0cec0b6195c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1366, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}