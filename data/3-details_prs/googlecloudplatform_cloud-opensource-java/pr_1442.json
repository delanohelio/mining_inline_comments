{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTYzNTk1", "number": 1442, "title": "Remove DependencyGraphResult", "bodyText": "@suztomo This is a major refactoring to remove the DependencyGraphResult class so that DependencyGraph holds everything and does more of the work of building that was previously done by DependencyGraphBuilder. In other words, this much more completely encapsulates DependencyGraph logic inside DependencyGraph, which is essential to migrate to a different implementation based on Guava graphs, JGraphT, or something else. Indeed we might now be able to support multiple, parallel DependencyGraph implementations so we can compare them to each other.", "createdAt": "2020-06-04T16:47:31Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1442", "merged": true, "mergeCommit": {"oid": "f8c04620375602ab72cdd7a8aac7de7ee5e21211"}, "closed": true, "closedAt": "2020-06-05T13:03:25Z", "author": {"login": "elharo"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn_MTPgH2gAyNDI3OTYzNTk1OjE2OTMzNzMyNzcxY2U3MTc5NDYyYTcxZDgyZjdjMDI3MTJiNzUwOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoRQBEAH2gAyNDI3OTYzNTk1OjkyNmEzMTc2NmU5ZWVmMjZjODUwZTc5Yzg2NTVjYzE1ZmI0MDgwMmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16933732771ce7179462a71d82f7c02712b75098", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/16933732771ce7179462a71d82f7c02712b75098", "committedDate": "2020-06-04T14:46:35Z", "message": "make unresolvable artifct problems part of depednency graph"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e45d907288e6087aa9ba95848467ed23e5845c12", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e45d907288e6087aa9ba95848467ed23e5845c12", "committedDate": "2020-06-04T15:01:01Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21847b93b917e12884aef9b43b9d87de7af76e9a", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/21847b93b917e12884aef9b43b9d87de7af76e9a", "committedDate": "2020-06-04T15:17:11Z", "message": "fix integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e821c47c4995296a5ed9986ec2958105760f6a0a", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e821c47c4995296a5ed9986ec2958105760f6a0a", "committedDate": "2020-06-04T15:26:32Z", "message": "fix integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2acaad099b9d2d753f29b7b82d7fa93337d3d499", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/2acaad099b9d2d753f29b7b82d7fa93337d3d499", "committedDate": "2020-06-04T15:44:45Z", "message": "fix integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f40c000300b40d9b724f5836a0aa08b4f456a2e9", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f40c000300b40d9b724f5836a0aa08b4f456a2e9", "committedDate": "2020-06-04T15:59:38Z", "message": "push unresolve artifact problems deeper into dependency graph"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb2f624dec6fbfc19a62764d99ef2bed52d17fa", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/feb2f624dec6fbfc19a62764d99ef2bed52d17fa", "committedDate": "2020-06-04T16:24:43Z", "message": "remove method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b0f4b3d01f079532abb5794bfef46d429afec8a", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/2b0f4b3d01f079532abb5794bfef46d429afec8a", "committedDate": "2020-06-04T16:41:54Z", "message": "remove DependencyGra[hResult"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f6e228aaa5845c423b4a96fbbd0ddd486afe652", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/1f6e228aaa5845c423b4a96fbbd0ddd486afe652", "committedDate": "2020-06-04T16:49:59Z", "message": "remove legacy method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "887aadc1baedfdc67413d8cc908cc0c488540c88", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/887aadc1baedfdc67413d8cc908cc0c488540c88", "committedDate": "2020-06-04T17:02:50Z", "message": "remove visible for testing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0Njk4MTQ2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1442#pullrequestreview-424698146", "createdAt": "2020-06-04T18:02:48Z", "commit": {"oid": "887aadc1baedfdc67413d8cc908cc0c488540c88"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxODowMjo0OFrOGfRmjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxODoxNjozOVrOGfSE4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0NzQzNw==", "bodyText": "This method checks whether the artifact is already checked or not. Good.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1442#discussion_r435447437", "createdAt": "2020-06-04T18:02:48Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -177,68 +173,37 @@ public DependencyGraphResult buildFullDependencyGraph(List<Artifact> artifacts)\n    * In the event of I/O errors, missing artifacts, and other problems, it can\n    * return an incomplete graph.\n    */\n-  public DependencyGraphResult buildMavenDependencyGraph(Dependency dependency) {\n+  public DependencyGraph buildMavenDependencyGraph(Dependency dependency) {\n     return buildDependencyGraph(\n         ImmutableList.of(new DefaultDependencyNode(dependency)), GraphTraversalOption.MAVEN);\n   }\n \n-  private DependencyGraphResult buildDependencyGraph(\n+  private DependencyGraph buildDependencyGraph(\n       List<DependencyNode> dependencyNodes, GraphTraversalOption traversalOption) {\n     boolean fullDependency = traversalOption == GraphTraversalOption.FULL;\n+    \n+    DependencyGraph graph;\n     DependencyNode node;\n-    ImmutableSet.Builder<UnresolvableArtifactProblem> artifactProblems = ImmutableSet.builder();\n-\n     try {\n       node = resolveCompileTimeDependencies(dependencyNodes, fullDependency);\n+      graph = new DependencyGraph(node);\n     } catch (DependencyResolutionException ex) {\n       DependencyResult result = ex.getResult();\n       node = result.getRoot();\n+      graph = new DependencyGraph(node);\n \n-      Set<Artifact> checkedArtifacts = new HashSet<>();\n       for (ArtifactResult artifactResult : result.getArtifactResults()) {\n         Artifact resolvedArtifact = artifactResult.getArtifact();\n \n         if (resolvedArtifact == null) {\n           Artifact requestedArtifact = artifactResult.getRequest().getArtifact();\n-          if (checkedArtifacts.add(requestedArtifact)) {\n-            artifactProblems.add(createUnresolvableArtifactProblem(node, requestedArtifact));\n-          }\n+          graph.addUnresolvableArtifactProblem(requestedArtifact);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "887aadc1baedfdc67413d8cc908cc0c488540c88"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0ODk4NQ==", "bodyText": "Is this package-visible constructor still needed? I see tests uses new DependencyGraph(null).", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1442#discussion_r435448985", "createdAt": "2020-06-04T18:05:21Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraph.java", "diffHunk": "@@ -59,9 +63,14 @@\n   \n   // map of groupId:artifactId:version to paths\n   private SetMultimap<String, DependencyPath> paths = HashMultimap.create();\n+\n+  private DependencyNode root;\n   \n-  @VisibleForTesting\n-  public DependencyGraph() {\n+  DependencyGraph() {\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "887aadc1baedfdc67413d8cc908cc0c488540c88"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ1NTIwMA==", "bodyText": "Thinking about other implementation of DependencyGraph, this levelOrder method of converting DependencyNode to DependencyGraph is specific to DependencyNode. It's because graph.addPath(path); in this method comes from the fact that current DependencyGraph consists of DependnecyPaths.\nDo you think moving this method inside DependencyGraph, as DependencyGraph.from(DependencyNode root) is a good idea?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1442#discussion_r435455200", "createdAt": "2020-06-04T18:16:39Z", "author": {"login": "suztomo"}, "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -271,9 +236,12 @@ public static UnresolvableArtifactProblem createUnresolvableArtifactProblem(\n    * @param firstNode node to start traversal\n    */\n   public static DependencyGraph levelOrder(DependencyNode firstNode) {\n-\n     DependencyGraph graph = new DependencyGraph();\n \n+    return levelOrder(firstNode, graph);\n+  }\n+\n+  private static DependencyGraph levelOrder(DependencyNode firstNode, DependencyGraph graph) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "887aadc1baedfdc67413d8cc908cc0c488540c88"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63e9ba0923cbf73c0499268b9a1e0f9b4adce9af", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/63e9ba0923cbf73c0499268b9a1e0f9b4adce9af", "committedDate": "2020-06-04T21:04:25Z", "message": "code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1dc87d9449b35e2d3c74c8790aea05d29672088", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c1dc87d9449b35e2d3c74c8790aea05d29672088", "committedDate": "2020-06-04T21:11:35Z", "message": "DependencyGraph.from"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0OTY5MTcx", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1442#pullrequestreview-424969171", "createdAt": "2020-06-05T03:12:46Z", "commit": {"oid": "c1dc87d9449b35e2d3c74c8790aea05d29672088"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a0c436afa6ef929356dd618d49561017e13f6c8", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/9a0c436afa6ef929356dd618d49561017e13f6c8", "committedDate": "2020-06-05T11:37:55Z", "message": "Merge branch 'master' into result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "926a31766e9eef26c850e79c8655cc15fb40802c", "author": {"user": {"login": "elharo", "name": "Elliotte Rusty Harold"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/926a31766e9eef26c850e79c8655cc15fb40802c", "committedDate": "2020-06-05T11:48:56Z", "message": "mark method visible for testing"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 181, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}