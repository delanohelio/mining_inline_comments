{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NzUzMzM3", "number": 1171, "title": "Linkage Monitor to ignore Gradle's build directory", "bodyText": "Fixes #1170 . The problem was gax-java's Gradle build directory contains multiple pom.xml files that have the same artifactId.\nThis change worked fine for a manually-created bad entry in gax-bom: https://gist.github.com/suztomo/85ba6c8f27b40db1809dbdbad8991c85", "createdAt": "2020-01-31T20:13:58Z", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171", "merged": true, "mergeCommit": {"oid": "cf5ce6da189be88c2830e79c4c93e69a1f702e32"}, "closed": true, "closedAt": "2020-02-04T18:50:13Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_059sAH2gAyMzY5NzUzMzM3OmEzYmExNzRjMGIxODZlMWI3NjU0OWJhMTcwZTA0N2UwMTc3MWI2YjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBGHH2gFqTM1MzIxNDUzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a3ba174c0b186e1b76549ba170e047e01771b6b5", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a3ba174c0b186e1b76549ba170e047e01771b6b5", "committedDate": "2020-01-31T20:10:32Z", "message": "Linkage Monitor to ignore build directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6632398639feff188e548705ecfc48691f975d63", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/6632398639feff188e548705ecfc48691f975d63", "committedDate": "2020-01-31T20:13:13Z", "message": "README for Gradle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzUxNzc3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#pullrequestreview-351751777", "createdAt": "2020-01-31T20:14:38Z", "commit": {"oid": "6632398639feff188e548705ecfc48691f975d63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMDoxNDozOFrOFkWxzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMDoxNDozOFrOFkWxzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY2NjI1NA==", "bodyText": "LinkageMonitorTest.testFindLocalArtifacts ensures this file is not picked up.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#discussion_r373666254", "createdAt": "2020-01-31T20:14:38Z", "author": {"login": "suztomo"}, "path": "linkage-monitor/src/test/resources/testproject/testsubproject/build/pom.xml", "diffHunk": "@@ -0,0 +1,14 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6632398639feff188e548705ecfc48691f975d63"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzY0NjU0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#pullrequestreview-351764654", "createdAt": "2020-01-31T20:40:35Z", "commit": {"oid": "6632398639feff188e548705ecfc48691f975d63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMDo0MDozNVrOFkXXgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMDo0MDozNVrOFkXXgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY3NTkwNg==", "bodyText": "Is this truly necessary? Usually there's a cleaner approach that does not use continue. Here I think you can reverse the if and avoid continue.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#discussion_r373675906", "createdAt": "2020-01-31T20:40:35Z", "author": {"login": "elharo"}, "path": "linkage-monitor/src/main/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitor.java", "diffHunk": "@@ -105,10 +105,20 @@ public static void main(String[] arguments)\n       RepositorySystem repositorySystem, RepositorySystemSession session, Path projectDirectory) {\n     ImmutableMap.Builder<String, String> artifactToVersion = ImmutableMap.builder();\n     Iterable<Path> paths = MoreFiles.fileTraverser().breadthFirst(projectDirectory);\n+\n+    PATHS_LOOP:\n     for (Path path : paths) {\n       if (!path.getFileName().endsWith(\"pom.xml\")) {\n         continue;\n       }\n+      for (Path pathElement : path) {\n+        String name = pathElement.toString();\n+        if (name.equals(\"build\") || name.equals(\"target\")) {\n+          // Exclude Gradle's build directory and Maven's target directory.\n+          continue PATHS_LOOP;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6632398639feff188e548705ecfc48691f975d63"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72da6d2f5794a3a2c0af5d0babfaf8343799a42", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e72da6d2f5794a3a2c0af5d0babfaf8343799a42", "committedDate": "2020-01-31T21:27:17Z", "message": "Path elements as set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzk3MTQ1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#pullrequestreview-351797145", "createdAt": "2020-01-31T21:47:07Z", "commit": {"oid": "e72da6d2f5794a3a2c0af5d0babfaf8343799a42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0NzowN1rOFkY2JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0NzowN1rOFkY2JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwMDEzMg==", "bodyText": "Does it matter where in the path this directory occurs? Can it be only at the end? What if a something several levels up has the name build or target?", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#discussion_r373700132", "createdAt": "2020-01-31T21:47:07Z", "author": {"login": "elharo"}, "path": "linkage-monitor/src/main/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitor.java", "diffHunk": "@@ -105,10 +105,18 @@ public static void main(String[] arguments)\n       RepositorySystem repositorySystem, RepositorySystemSession session, Path projectDirectory) {\n     ImmutableMap.Builder<String, String> artifactToVersion = ImmutableMap.builder();\n     Iterable<Path> paths = MoreFiles.fileTraverser().breadthFirst(projectDirectory);\n+\n     for (Path path : paths) {\n       if (!path.getFileName().endsWith(\"pom.xml\")) {\n         continue;\n       }\n+\n+      ImmutableSet<Path> elements = ImmutableSet.copyOf(path);\n+      if (elements.contains(Paths.get(\"build\")) || elements.contains(Paths.get(\"target\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e72da6d2f5794a3a2c0af5d0babfaf8343799a42"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a47d7420209dde5961db2690f619de929bca66d0", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a47d7420209dde5961db2690f619de929bca66d0", "committedDate": "2020-02-03T21:12:47Z", "message": "Merge remote-tracking branch 'origin/master' into linkage-monitor-gradle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTY3NTI5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#pullrequestreview-352967529", "createdAt": "2020-02-04T13:20:59Z", "commit": {"oid": "a47d7420209dde5961db2690f619de929bca66d0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzoyMTowMFrOFlTvXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzoyMTozNFrOFlTwoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY2NTA1Mw==", "bodyText": "Perhaps we can talk about this offline, but I don't think this one is answered. As written, this seems buggy to me.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#discussion_r374665053", "createdAt": "2020-02-04T13:21:00Z", "author": {"login": "elharo"}, "path": "linkage-monitor/src/main/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitor.java", "diffHunk": "@@ -105,10 +105,18 @@ public static void main(String[] arguments)\n       RepositorySystem repositorySystem, RepositorySystemSession session, Path projectDirectory) {\n     ImmutableMap.Builder<String, String> artifactToVersion = ImmutableMap.builder();\n     Iterable<Path> paths = MoreFiles.fileTraverser().breadthFirst(projectDirectory);\n+\n     for (Path path : paths) {\n       if (!path.getFileName().endsWith(\"pom.xml\")) {\n         continue;\n       }\n+\n+      ImmutableSet<Path> elements = ImmutableSet.copyOf(path);\n+      if (elements.contains(Paths.get(\"build\")) || elements.contains(Paths.get(\"target\"))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwMDEzMg=="}, "originalCommit": {"oid": "e72da6d2f5794a3a2c0af5d0babfaf8343799a42"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY2NTM3Nw==", "bodyText": "to --> in the", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#discussion_r374665377", "createdAt": "2020-02-04T13:21:34Z", "author": {"login": "elharo"}, "path": "linkage-monitor/README.md", "diffHunk": "@@ -21,6 +21,9 @@ set -e # fail if any of command fails\n # Install artifacts to local Maven repository. The command depends on build system of the project.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a47d7420209dde5961db2690f619de929bca66d0"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c7feebb161174cb06b7c5bbf48ab88d4541dcde", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/9c7feebb161174cb06b7c5bbf48ab88d4541dcde", "committedDate": "2020-02-04T17:07:12Z", "message": "Merge remote-tracking branch 'origin/master' into linkage-monitor-gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3df642ae1fdac168a2d65bbff1ee3bc9a3495d3b", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3df642ae1fdac168a2d65bbff1ee3bc9a3495d3b", "committedDate": "2020-02-04T17:12:52Z", "message": "Ensure releative path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f488463a24d4d6960ef727dff636f851b73d041", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3f488463a24d4d6960ef727dff636f851b73d041", "committedDate": "2020-02-04T17:13:54Z", "message": "\"in the local Maven repository\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49741ccc40092e2cf1f3a0810d2c101455c887b8", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/49741ccc40092e2cf1f3a0810d2c101455c887b8", "committedDate": "2020-02-04T17:16:11Z", "message": "Clarify the target of exclusion in comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMTU1MzQ0", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#pullrequestreview-353155344", "createdAt": "2020-02-04T17:16:12Z", "commit": {"oid": "3df642ae1fdac168a2d65bbff1ee3bc9a3495d3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNzoxNjoxMlrOFlcd7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNzoxNjoxMlrOFlcd7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgwODA0NA==", "bodyText": "This will throw an exception the calling code isn't prepared to handle. This method should handle both cases here.", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#discussion_r374808044", "createdAt": "2020-02-04T17:16:12Z", "author": {"login": "elharo"}, "path": "linkage-monitor/src/main/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitor.java", "diffHunk": "@@ -112,13 +113,18 @@ public static void main(String[] arguments)\n   static ImmutableMap<String, String> findLocalArtifacts(\n       RepositorySystem repositorySystem, RepositorySystemSession session, Path projectDirectory) {\n     ImmutableMap.Builder<String, String> artifactToVersion = ImmutableMap.builder();\n+\n+    // Relative paths to the files in the project\n     Iterable<Path> paths = MoreFiles.fileTraverser().breadthFirst(projectDirectory);\n \n     for (Path path : paths) {\n       if (!path.getFileName().endsWith(\"pom.xml\")) {\n         continue;\n       }\n \n+      Verify.verify(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3df642ae1fdac168a2d65bbff1ee3bc9a3495d3b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28881f7481cf504b1086874a3d10e5a41861c4d7", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/28881f7481cf504b1086874a3d10e5a41861c4d7", "committedDate": "2020-02-04T17:27:28Z", "message": "Handling absolute path"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjE0NTM3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1171#pullrequestreview-353214537", "createdAt": "2020-02-04T18:47:13Z", "commit": {"oid": "28881f7481cf504b1086874a3d10e5a41861c4d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 439, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}