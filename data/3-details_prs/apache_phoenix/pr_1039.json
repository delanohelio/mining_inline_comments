{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2Njk1MjAz", "number": 1039, "title": "PHOENIX-6277 upsert into data error after HBASE-24850,HBASE-24754 merged", "bodyText": "", "createdAt": "2020-12-30T01:52:05Z", "url": "https://github.com/apache/phoenix/pull/1039", "merged": true, "mergeCommit": {"oid": "86f3181714f15ef3e191a54413c120b0af8409cd"}, "closed": true, "closedAt": "2020-12-31T15:19:48Z", "author": {"login": "wangchao316"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrFV1OgH2gAyNTQ2Njk1MjAzOmUzMzE0Njk0ODRkZGExNjVjOTFmODc2ZWQyZGEyNzI2NTMwMDNlZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrlhcqAFqTU2MDQ1MDY0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e331469484dda165c91f876ed2da272653003efc", "author": {"user": {"login": "wangchao316", "name": null}}, "url": "https://github.com/apache/phoenix/commit/e331469484dda165c91f876ed2da272653003efc", "committedDate": "2020-12-30T01:49:21Z", "message": "PHOENIX-6277 upsert into data error after HBASE-24850,HBASE-24754 merged"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NzU5OTg1", "url": "https://github.com/apache/phoenix/pull/1039#pullrequestreview-559759985", "createdAt": "2020-12-30T02:17:03Z", "commit": {"oid": "e331469484dda165c91f876ed2da272653003efc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwMjoxNzowM1rOIMcBpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwMjoxNzozOVrOIMcB4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkxMjk5OA==", "bodyText": "nit: formatting of comment is mixed up now. (should be \"for backward compatibility\")", "url": "https://github.com/apache/phoenix/pull/1039#discussion_r549912998", "createdAt": "2020-12-30T02:17:03Z", "author": {"login": "gjacoby126"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/MetaDataEndpointImpl.java", "diffHunk": "@@ -867,7 +868,9 @@ private void addColumnToTable(List<Cell> results, PName colName, PName famName,\n         PDataType dataType =\n                 PDataType.fromTypeId(PInteger.INSTANCE.getCodec().decodeInt(\n                         dataTypeKv.getValueArray(), dataTypeKv.getValueOffset(), SortOrder.getDefault()));\n-        if (maxLength == null && dataType == PBinary.INSTANCE) dataType = PVarbinary.INSTANCE;   // For\n+        if (maxLength == null && dataType == PBinary.INSTANCE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e331469484dda165c91f876ed2da272653003efc"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkxMzA1Nw==", "bodyText": "This entire file can be removed; I believe it's been causing ASF license failures and it doesn't do anything. I think a previous JIRA checked it in by mistake.", "url": "https://github.com/apache/phoenix/pull/1039#discussion_r549913057", "createdAt": "2020-12-30T02:17:39Z", "author": {"login": "gjacoby126"}, "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/Dummy.java", "diffHunk": "@@ -1,3 +1,20 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e331469484dda165c91f876ed2da272653003efc"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d649c729258fcdb4f2171ea2c772c981f04ea2e7", "author": {"user": {"login": "wangchao316", "name": null}}, "url": "https://github.com/apache/phoenix/commit/d649c729258fcdb4f2171ea2c772c981f04ea2e7", "committedDate": "2020-12-30T02:49:42Z", "message": "PHOENIX-6277 upsert into data error after HBASE-24850,HBASE-24754 merged"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5ODYxMDg5", "url": "https://github.com/apache/phoenix/pull/1039#pullrequestreview-559861089", "createdAt": "2020-12-30T06:00:28Z", "commit": {"oid": "d649c729258fcdb4f2171ea2c772c981f04ea2e7"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNjowMDoyOVrOIMd9pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwNjowNToyNlrOIMeAag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0NDc0MQ==", "bodyText": "Better replace with placeholder?\nLOGGER.debug(\"Reloading table {} data from server\", e.getTableName());", "url": "https://github.com/apache/phoenix/pull/1039#discussion_r549944741", "createdAt": "2020-12-30T06:00:29Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/jdbc/PhoenixStatement.java", "diffHunk": "@@ -342,12 +341,12 @@ public PhoenixResultSet call() throws SQLException {\n                     }\n                     //Force update cache and retry if meta not found error occurs\n                     catch (MetaDataEntityNotFoundException e) {\n-                        if(doRetryOnMetaNotFoundError && e.getTableName()!=null){\n-                            if(LOGGER.isDebugEnabled())\n-                                LOGGER.debug(\"Reloading table \"\n-                                        + e.getTableName()+\" data from server\");\n-                            if(new MetaDataClient(connection).updateCache(connection.getTenantId(),\n-                                e.getSchemaName(), e.getTableName(), true).wasUpdated()){\n+                        if (doRetryOnMetaNotFoundError && e.getTableName() != null) {\n+                            if (LOGGER.isDebugEnabled()) {\n+                                LOGGER.debug(\"Reloading table \" + e.getTableName() + \" data from server\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d649c729258fcdb4f2171ea2c772c981f04ea2e7"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0NDgxNQ==", "bodyText": "same here", "url": "https://github.com/apache/phoenix/pull/1039#discussion_r549944815", "createdAt": "2020-12-30T06:01:02Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/jdbc/PhoenixStatement.java", "diffHunk": "@@ -430,12 +429,12 @@ public Integer call() throws SQLException {\n                             }\n                             //Force update cache and retry if meta not found error occurs\n                             catch (MetaDataEntityNotFoundException e) {\n-                                if(doRetryOnMetaNotFoundError && e.getTableName()!=null){\n-                                    if(LOGGER.isDebugEnabled())\n-                                        LOGGER.debug(\"Reloading table \"+ e.getTableName()\n-                                                +\" data from server\");\n-                                    if(new MetaDataClient(connection).updateCache(connection.getTenantId(),\n-                                        e.getSchemaName(), e.getTableName(), true).wasUpdated()){\n+                                if (doRetryOnMetaNotFoundError && e.getTableName() != null) {\n+                                    if (LOGGER.isDebugEnabled()) {\n+                                        LOGGER.debug(\"Reloading table \" + e.getTableName() + \" data from server\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d649c729258fcdb4f2171ea2c772c981f04ea2e7"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0NDkxMg==", "bodyText": "same here", "url": "https://github.com/apache/phoenix/pull/1039#discussion_r549944912", "createdAt": "2020-12-30T06:01:41Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/MetaDataEndpointImpl.java", "diffHunk": "@@ -2461,11 +2464,11 @@ public Object run() throws Exception {\n                         try (PhoenixConnection connection =\n                                      QueryUtil.getConnectionOnServer(env.getConfiguration())\n                                              .unwrap(PhoenixConnection.class)) {\n-                            try{\n+                            try {\n                                 MetaDataUtil.deleteFromStatsTable(connection, deletedTable,\n                                         physicalTableNames, sharedTableStates);\n-                                LOGGER.info(\"Table stats deleted successfully. \"+\n-                                        deletedTable.getPhysicalName().getString());\n+                                LOGGER.info(\"Table stats deleted successfully. \"\n+                                    + deletedTable.getPhysicalName().getString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d649c729258fcdb4f2171ea2c772c981f04ea2e7"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTk0NTQ1MA==", "bodyText": "Since we are sorting list, we can directly use sort():\nCOLUMN_KV_COLUMNS.sort(CellComparator.getInstance());", "url": "https://github.com/apache/phoenix/pull/1039#discussion_r549945450", "createdAt": "2020-12-30T06:05:26Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/MetaDataEndpointImpl.java", "diffHunk": "@@ -456,7 +457,7 @@\n     );\n \n     static {\n-        Collections.sort(COLUMN_KV_COLUMNS, KeyValue.COMPARATOR);\n+        Collections.sort(COLUMN_KV_COLUMNS, CellComparator.getInstance());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d649c729258fcdb4f2171ea2c772c981f04ea2e7"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b75130c585b0daeb7755a4b74aaa91a19a51704d", "author": {"user": {"login": "wangchao316", "name": null}}, "url": "https://github.com/apache/phoenix/commit/b75130c585b0daeb7755a4b74aaa91a19a51704d", "committedDate": "2020-12-30T07:36:16Z", "message": "PHOENIX-6277 upsert into data error after HBASE-24850,HBASE-24754 merged"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33a9182ee42bbf55b75f512c9bc82548420a153d", "author": {"user": {"login": "wangchao316", "name": null}}, "url": "https://github.com/apache/phoenix/commit/33a9182ee42bbf55b75f512c9bc82548420a153d", "committedDate": "2020-12-30T07:47:08Z", "message": "PHOENIX-6277 upsert into data error after HBASE-24850,HBASE-24754 merged"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28e5768338856d78107cd7648350c504a0742b8b", "author": {"user": {"login": "wangchao316", "name": null}}, "url": "https://github.com/apache/phoenix/commit/28e5768338856d78107cd7648350c504a0742b8b", "committedDate": "2020-12-31T01:46:13Z", "message": "Merge branch 'master' of https://github.com/apache/phoenix into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNDUwNjQ1", "url": "https://github.com/apache/phoenix/pull/1039#pullrequestreview-560450645", "createdAt": "2020-12-31T15:19:00Z", "commit": {"oid": "28e5768338856d78107cd7648350c504a0742b8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1802, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}