{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MDk3ODky", "number": 857, "title": "PHOENIX-5881 - Port PHOENIX-5645 (MaxLookbackAge) to 5.x", "bodyText": "", "createdAt": "2020-08-14T17:26:26Z", "url": "https://github.com/apache/phoenix/pull/857", "merged": true, "mergeCommit": {"oid": "cabab87e6c18db5eb2b69c24885c28806dc404e7"}, "closed": true, "closedAt": "2020-08-19T22:53:17Z", "author": {"login": "gjacoby126"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_4cfjgBqjM2NjM0OTg3NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAjsNWABqjM2NzI4NzQxNzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "983f3f538d9d8d153da75ebf40a75204bce6a78d", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/983f3f538d9d8d153da75ebf40a75204bce6a78d", "committedDate": "2020-08-14T17:14:00Z", "message": "PHOENIX-5881 - Port PHOENIX-5645 (MaxLookbackAge) to 5.x"}, "afterCommit": {"oid": "69e0550c30a87df82d350961b7512004077c8a88", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/69e0550c30a87df82d350961b7512004077c8a88", "committedDate": "2020-08-17T20:17:58Z", "message": "PHOENIX-5881 - Port PHOENIX-5645 (MaxLookbackAge) to 5.x"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5MDA1MTIx", "url": "https://github.com/apache/phoenix/pull/857#pullrequestreview-469005121", "createdAt": "2020-08-18T05:41:27Z", "commit": {"oid": "69e0550c30a87df82d350961b7512004077c8a88"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNTo0MToyN1rOHCEHyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNTo0NjoyM1rOHCEN3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyNjcyOQ==", "bodyText": "This doesn't seem to be referenced anywhere.", "url": "https://github.com/apache/phoenix/pull/857#discussion_r471926729", "createdAt": "2020-08-18T05:41:27Z", "author": {"login": "stoty"}, "path": "phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/ScanInfoUtil.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hbase.regionserver;\n+\n+import org.apache.hadoop.conf.Configuration;\n+\n+public class ScanInfoUtil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69e0550c30a87df82d350961b7512004077c8a88"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyODEzNg==", "bodyText": "This doesn't seem to do anything since the subclassing.", "url": "https://github.com/apache/phoenix/pull/857#discussion_r471928136", "createdAt": "2020-08-18T05:45:54Z", "author": {"login": "stoty"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/BaseScannerRegionObserver.java", "diffHunk": "@@ -367,4 +374,16 @@ RegionScanner getWrappedScanner(final ObserverContext<RegionCoprocessorEnvironme\n                 dataRegion, indexMaintainer, null, viewConstants, null, null, projector, ptr, useQualiferAsListIndex);\n     }\n \n+    @Override\n+    public void preStoreScannerOpen(ObserverContext<RegionCoprocessorEnvironment> ctx, Store store,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69e0550c30a87df82d350961b7512004077c8a88"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTkyODI4NQ==", "bodyText": "Nit: indent like above in both files?", "url": "https://github.com/apache/phoenix/pull/857#discussion_r471928285", "createdAt": "2020-08-18T05:46:23Z", "author": {"login": "stoty"}, "path": "phoenix-hbase-compat-2.2.1/src/main/java/org/apache/phoenix/compat/hbase/HbaseCompatCapabilities.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.phoenix.compat.hbase;\n+\n+import org.apache.hadoop.conf.Configuration;\n+\n+public class HbaseCompatCapabilities {\n+\n+    public static boolean isMaxLookbackTimeSupported() {\n+        return false;\n+    }\n+\n+    //In HBase 2.1 and 2.2, a lookback query won't return any results if covered by a future delete\n+    public static boolean isLookbackBeyondDeletesSupported() { return false; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69e0550c30a87df82d350961b7512004077c8a88"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTUzNDY1", "url": "https://github.com/apache/phoenix/pull/857#pullrequestreview-470553465", "createdAt": "2020-08-19T15:06:46Z", "commit": {"oid": "61fb82f94372e980e587f6961bbec3fc585b4acf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwOTMyMTU0", "url": "https://github.com/apache/phoenix/pull/857#pullrequestreview-470932154", "createdAt": "2020-08-19T20:49:32Z", "commit": {"oid": "09694033b829e80597d01cea695a784c4d66ba85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMDo0OTozMlrOHDYjhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMDo0OTozMlrOHDYjhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMxMDA4NQ==", "bodyText": "nit: would be good in understanding if s -> ms conversion happens outside of if condition.", "url": "https://github.com/apache/phoenix/pull/857#discussion_r473310085", "createdAt": "2020-08-19T20:49:32Z", "author": {"login": "swaroopak"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/compile/QueryCompiler.java", "diffHunk": "@@ -172,6 +178,28 @@ public QueryPlan compile() throws SQLException{\n         return plan;\n     }\n \n+    private void verifySCN() throws SQLException {\n+        if (!HbaseCompatCapabilities.isMaxLookbackTimeSupported()) {\n+            return;\n+        }\n+        PhoenixConnection conn = statement.getConnection();\n+        Long scn = conn.getSCN();\n+        if (scn == null) {\n+            return;\n+        }\n+        ColumnResolver resolver =\n+            FromCompiler.getResolverForQuery(select, conn);\n+        int maxLookBackAge = conn.getQueryServices().\n+            getConfiguration().getInt(CompatBaseScannerRegionObserver.PHOENIX_MAX_LOOKBACK_AGE_CONF_KEY,\n+            CompatBaseScannerRegionObserver.DEFAULT_PHOENIX_MAX_LOOKBACK_AGE);\n+        long now = EnvironmentEdgeManager.currentTimeMillis();\n+        if (maxLookBackAge > 0 && now - maxLookBackAge * 1000L > scn){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09694033b829e80597d01cea695a784c4d66ba85"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwOTg1ODk0", "url": "https://github.com/apache/phoenix/pull/857#pullrequestreview-470985894", "createdAt": "2020-08-19T21:42:49Z", "commit": {"oid": "09694033b829e80597d01cea695a784c4d66ba85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aa7d60cf861af8dda2f4bcb19ef4624fcc4e9f2", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/1aa7d60cf861af8dda2f4bcb19ef4624fcc4e9f2", "committedDate": "2020-08-19T22:51:39Z", "message": "PHOENIX-5881 - Port PHOENIX-5645 (MaxLookbackAge) to 5.x"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf40d1203d3972035c819e18cc8314739dec1fb5", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/bf40d1203d3972035c819e18cc8314739dec1fb5", "committedDate": "2020-08-19T22:46:34Z", "message": "PHOENIX-5881 - Port PHOENIX-5645 (MaxLookbackAge) to 5.x"}, "afterCommit": {"oid": "1aa7d60cf861af8dda2f4bcb19ef4624fcc4e9f2", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/1aa7d60cf861af8dda2f4bcb19ef4624fcc4e9f2", "committedDate": "2020-08-19T22:51:39Z", "message": "PHOENIX-5881 - Port PHOENIX-5645 (MaxLookbackAge) to 5.x"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1897, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}