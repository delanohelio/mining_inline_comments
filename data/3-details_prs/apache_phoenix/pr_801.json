{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMzE0ODg4", "number": 801, "title": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback row\u2026", "bodyText": "\u2026s should be configurable", "createdAt": "2020-06-11T20:25:36Z", "url": "https://github.com/apache/phoenix/pull/801", "merged": true, "mergeCommit": {"oid": "a228552d32da8ff2a0062de2631fccdcf000bfda"}, "closed": true, "closedAt": "2020-06-29T20:07:27Z", "author": {"login": "gjacoby126"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqmoytgFqTQyOTkzMDM3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwFQtAgFqTQzOTM5MjU3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5OTMwMzc5", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-429930379", "createdAt": "2020-06-12T17:48:34Z", "commit": {"oid": "d873b8c87a4a1178d912d5f8f42d62affc846ad7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNzo0ODozNVrOGjMsbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNzo1MToxNFrOGjMxXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU2MTMyNg==", "bodyText": "Let's remove the *", "url": "https://github.com/apache/phoenix/pull/801#discussion_r439561326", "createdAt": "2020-06-12T17:48:35Z", "author": {"login": "gokceni"}, "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/index/IndexVerificationOutputRepositoryIT.java", "diffHunk": "@@ -53,6 +54,7 @@\n import java.util.Map;\n \n import static org.apache.phoenix.coprocessor.MetaDataProtocol.DEFAULT_LOG_TTL;\n+import static org.apache.phoenix.mapreduce.index.IndexVerificationOutputRepository.IndexVerificationErrorType.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b8c87a4a1178d912d5f8f42d62affc846ad7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU2MjU5MA==", "bodyText": "Should this be false? I feel like \"beyond max lookback\" is kind of analogy to debug log. Why don't we make it false?", "url": "https://github.com/apache/phoenix/pull/801#discussion_r439562590", "createdAt": "2020-06-12T17:51:14Z", "author": {"login": "gokceni"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -98,6 +103,9 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(IndexRebuildRegionScanner.class);\n \n+    public static final String PHOENIX_LOG_BEYOND_MAX_LOOKBACK_INVALID_ROWS_CONF_KEY =\n+        \"phoenix.log.beyond.max.lookback.age.invalid.rows\";\n+    public static final boolean DEFAULT_PHOENIX_LOG_BEYOND_MAX_LOOKBACK_INVALID_ROWS = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b8c87a4a1178d912d5f8f42d62affc846ad7"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5OTgyMDYw", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-429982060", "createdAt": "2020-06-12T19:16:29Z", "commit": {"oid": "d873b8c87a4a1178d912d5f8f42d62affc846ad7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOToxNjoyOVrOGjPElw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOToxNjoyOVrOGjPElw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYwMDI3OQ==", "bodyText": "invalid and missing, right?", "url": "https://github.com/apache/phoenix/pull/801#discussion_r439600279", "createdAt": "2020-06-12T19:16:29Z", "author": {"login": "swaroopak"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -98,6 +103,9 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(IndexRebuildRegionScanner.class);\n \n+    public static final String PHOENIX_LOG_BEYOND_MAX_LOOKBACK_INVALID_ROWS_CONF_KEY =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b8c87a4a1178d912d5f8f42d62affc846ad7"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5OTgyNjE2", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-429982616", "createdAt": "2020-06-12T19:17:33Z", "commit": {"oid": "d873b8c87a4a1178d912d5f8f42d62affc846ad7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOToxNzozNFrOGjPGIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOToxNzozNFrOGjPGIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYwMDY3NQ==", "bodyText": "shall we be specific with INVALID_INDEX_ROW and same for others?", "url": "https://github.com/apache/phoenix/pull/801#discussion_r439600675", "createdAt": "2020-06-12T19:17:34Z", "author": {"login": "swaroopak"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/mapreduce/index/IndexVerificationOutputRepository.java", "diffHunk": "@@ -85,6 +88,15 @@\n     public static final byte[] PHASE_BEFORE_VALUE = Bytes.toBytes(\"BEFORE\");\n     public static final byte[] PHASE_AFTER_VALUE = Bytes.toBytes(\"AFTER\");\n \n+\n+    public enum IndexVerificationErrorType {\n+        INVALID_ROW,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b8c87a4a1178d912d5f8f42d62affc846ad7"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDcyOTcz", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-430072973", "createdAt": "2020-06-12T22:46:18Z", "commit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDc4MTkw", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-430078190", "createdAt": "2020-06-12T23:07:44Z", "commit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzowNzo0NFrOGjToxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzowNzo0NFrOGjToxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NTA3Ng==", "bodyText": "Can this property be modified via -D option from the client-side? Good to have a test for that.", "url": "https://github.com/apache/phoenix/pull/801#discussion_r439675076", "createdAt": "2020-06-12T23:07:44Z", "author": {"login": "swaroopak"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -152,6 +158,9 @@ public IndexRebuildRegionScanner(final RegionScanner innerScanner, final Region\n             verifyType = IndexTool.IndexVerifyType.fromValue(valueBytes);\n             if (verifyType != IndexTool.IndexVerifyType.NONE) {\n                 verify = true;\n+                boolean shouldLogBeyondMaxLookbackInvalidRows =\n+                    config.getBoolean(PHOENIX_LOG_BEYOND_MAX_LOOKBACK_ERROR_ROWS_CONF_KEY,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDc4MzIz", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-430078323", "createdAt": "2020-06-12T23:08:22Z", "commit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzkwOTEx", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-430790911", "createdAt": "2020-06-15T16:09:45Z", "commit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjowOTo0NlrOGj5B1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjowOTo0NlrOGj5B1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI4NzcwMw==", "bodyText": "Can we please have this config be named consistently like the previous one?\n\"phoenix.mr.index.IndexDisableLoggingType=BEFORE\" .. It would make it easier to find and put those together whenever they need non-default values.", "url": "https://github.com/apache/phoenix/pull/801#discussion_r440287703", "createdAt": "2020-06-15T16:09:46Z", "author": {"login": "priyankporwal"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -91,13 +95,15 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import com.google.common.base.Throwables;\n import com.google.common.collect.Maps;\n \n public class IndexRebuildRegionScanner extends GlobalIndexRegionScanner {\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(IndexRebuildRegionScanner.class);\n \n+    public static final String PHOENIX_LOG_BEYOND_MAX_LOOKBACK_ERROR_ROWS_CONF_KEY =\n+        \"phoenix.log.beyond.max.lookback.age.error.rows\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDYzOTY1", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-431063965", "createdAt": "2020-06-15T23:41:39Z", "commit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7434f798e4b965124e1ffd6eadbdf9979acdf3fb", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/7434f798e4b965124e1ffd6eadbdf9979acdf3fb", "committedDate": "2020-06-12T22:27:28Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}, "afterCommit": {"oid": "c44c19f3d8c007996190366461aba628101ef80d", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/c44c19f3d8c007996190366461aba628101ef80d", "committedDate": "2020-06-18T00:42:15Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c44c19f3d8c007996190366461aba628101ef80d", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/c44c19f3d8c007996190366461aba628101ef80d", "committedDate": "2020-06-18T00:42:15Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}, "afterCommit": {"oid": "548afaeba0ceccaca7e65426d84b8bfee368f27e", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/548afaeba0ceccaca7e65426d84b8bfee368f27e", "committedDate": "2020-06-26T17:56:35Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "114cf9b71ab6cbd2e1d745f7a1e29cd82f5422d7", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/114cf9b71ab6cbd2e1d745f7a1e29cd82f5422d7", "committedDate": "2020-06-26T22:28:13Z", "message": "PHOENIX-5951 - IndexTool output logging for past-max-lookback rows should be configurable"}, "afterCommit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/1f79bf1e21f7c68992f3bd0073f178050ec166b6", "committedDate": "2020-06-27T00:21:59Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjYyNjM5", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-438662639", "createdAt": "2020-06-27T01:49:16Z", "commit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMTo0OToxNlrOGpyWBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwMTo0OToxNlrOGpyWBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2OTYzOQ==", "bodyText": "nit: looks like this made its way in the rebase?", "url": "https://github.com/apache/phoenix/pull/801#discussion_r446469639", "createdAt": "2020-06-27T01:49:16Z", "author": {"login": "swaroopak"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -96,6 +102,11 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(IndexRebuildRegionScanner.class);\n \n+    public static final String PHOENIX_INDEX_MR_LOG_BEYOND_MAX_LOOKBACK_ERRORS =\n+        \"phoenix.index.mr.log.beyond.max.lookback.errors\";\n+    public static final boolean DEFAULT_PHOENIX_INDEX_MR_LOG_BEYOND_MAX_LOOKBACK_ERRORS = false;\n+    private boolean useProto = true;\n+    private byte[] indexRowKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjYyOTA2", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-438662906", "createdAt": "2020-06-27T01:53:24Z", "commit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Njc2Njkz", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-438676693", "createdAt": "2020-06-27T06:21:37Z", "commit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNjoyMTozN1rOGpzrvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNjoyMTozN1rOGpzrvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ5MTU4MQ==", "bodyText": "This is not the right conf key to set here", "url": "https://github.com/apache/phoenix/pull/801#discussion_r446491581", "createdAt": "2020-06-27T06:21:37Z", "author": {"login": "kadirozde"}, "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/IndexToolForNonTxGlobalIndexIT.java", "diffHunk": "@@ -1006,6 +1011,72 @@ public void testDisableOutputLogging() throws Exception {\n         }\n     }\n \n+    @Test\n+    public void testEnableOutputLoggingForMaxLookback() throws Exception {\n+        //by default we don't log invalid or missing rows past max lookback age to the\n+        // PHOENIX_INDEX_TOOL table. Verify that we can flip that logging on from the client-side\n+        // using a system property (such as from the command line) and have it log rows on the\n+        // server-side\n+        if (!mutable) {\n+            return;\n+        }\n+        String schemaName = generateUniqueName();\n+        String dataTableName = generateUniqueName();\n+        String dataTableFullName = SchemaUtil.getTableName(schemaName, dataTableName);\n+        String indexTableName = generateUniqueName();\n+        String indexTableFullName = SchemaUtil.getTableName(schemaName, indexTableName);\n+\n+        try(Connection conn = DriverManager.getConnection(getUrl())) {\n+            ManualEnvironmentEdge injectEdge = new ManualEnvironmentEdge();\n+            injectEdge.setValue(EnvironmentEdgeManager.currentTimeMillis());\n+            EnvironmentEdgeManager.injectEdge(injectEdge);\n+            deleteAllRows(conn,\n+                TableName.valueOf(IndexVerificationOutputRepository.OUTPUT_TABLE_NAME));\n+            String stmString1 =\n+                \"CREATE TABLE \" + dataTableFullName\n+                    + \" (ID INTEGER NOT NULL PRIMARY KEY, NAME VARCHAR, ZIP INTEGER) \";\n+            conn.createStatement().execute(stmString1);\n+\n+            injectEdge.incrementValue(1L);\n+            String upsertQuery = String.format(\"UPSERT INTO %s VALUES(?, ?, ?)\", dataTableFullName);\n+            PreparedStatement stmt1 = conn.prepareStatement(upsertQuery);\n+\n+            // insert two rows\n+            IndexToolIT.upsertRow(stmt1, 1);\n+            IndexToolIT.upsertRow(stmt1, 2);\n+            conn.commit();\n+            injectEdge.incrementValue(1L); //we have to increment time to see our writes\n+            //now create an index async so it won't have the two rows in the base table\n+\n+            String stmtString2 =\n+                String.format(\n+                    \"CREATE INDEX %s ON %s (LPAD(UPPER(NAME, 'en_US'),8,'x')||'_xyz') ASYNC \",\n+                    indexTableName, dataTableFullName);\n+            conn.createStatement().execute(stmtString2);\n+            conn.commit();\n+            injectEdge.incrementValue(MAX_LOOKBACK_AGE * 1000);\n+            deleteAllRows(conn, TableName.valueOf(IndexVerificationOutputRepository.OUTPUT_TABLE_NAME));\n+            getUtility().getConfiguration().\n+                set(IndexRebuildRegionScanner.INDEX_VERIFY_ROW_COUNTS_PER_TASK_CONF_KEY, \"true\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "originalPosition": 98}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Njc2OTA5", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-438676909", "createdAt": "2020-06-27T06:25:53Z", "commit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNjoyNTo1M1rOGpztIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNjoyNTo1M1rOGpztIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ5MTkzNw==", "bodyText": "Thanks for correcting the comment", "url": "https://github.com/apache/phoenix/pull/801#discussion_r446491937", "createdAt": "2020-06-27T06:25:53Z", "author": {"login": "kadirozde"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -1223,7 +1254,7 @@ public int prepareIndexMutations(Put put, Delete del, Map<byte[], List<Mutation>\n                                      Set<byte[]> mostRecentIndexRowKeys) throws IOException {\n         List<Mutation> indexMutations = prepareIndexMutationsForRebuild(indexMaintainer, put, del);\n         boolean mostRecentDone = false;\n-        // Do not populate mostRecentIndexRowKeys when verifyType != IndexTool.IndexVerifyType.ONLY\n+        // Do not populate mostRecentIndexRowKeys when verifyType is NONE or AFTER", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "originalPosition": 180}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Njc2OTgz", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-438676983", "createdAt": "2020-06-27T06:27:10Z", "commit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNjoyNzoxMFrOGpzthQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QwNjoyNzoxMFrOGpzthQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ5MjAzNw==", "bodyText": "PHOENIX_INDEX_MR_LOG_BEYOND_MAX_LOOKBACK_ERRORS rather than INDEX_VERIFY_ROW_COUNTS_PER_TASK_CONF_KEY", "url": "https://github.com/apache/phoenix/pull/801#discussion_r446492037", "createdAt": "2020-06-27T06:27:10Z", "author": {"login": "kadirozde"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/mapreduce/PhoenixServerBuildIndexInputFormat.java", "diffHunk": "@@ -108,6 +109,12 @@ protected QueryPlan getQueryPlan(final JobContext context, final Configuration c\n                 scan.setAttribute(BaseScannerRegionObserver.INDEX_RETRY_VERIFY, Bytes.toBytes(lastVerifyTimeValue));\n                 scan.setAttribute(BaseScannerRegionObserver.INDEX_REBUILD_DISABLE_LOGGING_VERIFY_TYPE,\n                     getDisableLoggingVerifyType(configuration).toBytes());\n+                String shouldLogMaxLookbackOutput =\n+                    configuration.get(IndexRebuildRegionScanner.INDEX_VERIFY_ROW_COUNTS_PER_TASK_CONF_KEY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c39f932198fcf0273413902f42e593f020ec515a", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/c39f932198fcf0273413902f42e593f020ec515a", "committedDate": "2020-06-29T04:41:33Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f79bf1e21f7c68992f3bd0073f178050ec166b6", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/1f79bf1e21f7c68992f3bd0073f178050ec166b6", "committedDate": "2020-06-27T00:21:59Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}, "afterCommit": {"oid": "c39f932198fcf0273413902f42e593f020ec515a", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/c39f932198fcf0273413902f42e593f020ec515a", "committedDate": "2020-06-29T04:41:33Z", "message": "PHOENIX-5951 - Index rebuild output logging for past-max-lookback rows should be configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ffe578d52c8be925c3e39fcc49f1d2fda0265d6", "author": {"user": {"login": "gjacoby126", "name": "Geoffrey Jacoby"}}, "url": "https://github.com/apache/phoenix/commit/0ffe578d52c8be925c3e39fcc49f1d2fda0265d6", "committedDate": "2020-06-29T16:37:41Z", "message": "PHOENIX-5951 - IndexTool output logging for past-max-lookback rows should be configurable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MzkyNTcx", "url": "https://github.com/apache/phoenix/pull/801#pullrequestreview-439392571", "createdAt": "2020-06-29T18:22:13Z", "commit": {"oid": "0ffe578d52c8be925c3e39fcc49f1d2fda0265d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2043, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}