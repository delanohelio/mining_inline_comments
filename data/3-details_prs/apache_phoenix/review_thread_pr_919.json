{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMzEwNTcx", "number": 919, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToxMjoyN1rOEuC2yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODozNDowMVrOEuH6AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NzE2NzQ1OnYy", "diffSide": "RIGHT", "path": "phoenix-core/src/main/java/org/apache/phoenix/exception/SQLExceptionCode.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToxMjoyOFrOHiM4cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToxMjoyOFrOHiM4cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYyNDY4OQ==", "bodyText": "info.getMessage() != null ? info.getMessage() : \"\"\n\nIn else condition, can we use OPERATION_TIMED_OUT.getMessage(). Atleast we will know it was operation timed out.", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505624689", "createdAt": "2020-10-15T15:12:28Z", "author": {"login": "shahrs87"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/exception/SQLExceptionCode.java", "diffHunk": "@@ -453,8 +453,13 @@ public SQLException newException(SQLExceptionInfo info) {\n     OPERATION_TIMED_OUT(6000, \"TIM01\", \"Operation timed out.\", new Factory() {\n         @Override\n         public SQLException newException(SQLExceptionInfo info) {\n-            return new SQLTimeoutException(OPERATION_TIMED_OUT.getMessage(),\n-                    OPERATION_TIMED_OUT.getSQLState(), OPERATION_TIMED_OUT.getErrorCode());\n+            final String reason =\n+                (info.getMessage() != null ? info.getMessage() : \"\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "185654888a2e596b1f807bee73ed3aef42110448"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NzIxNzMzOnYy", "diffSide": "RIGHT", "path": "phoenix-core/src/main/java/org/apache/phoenix/exception/SQLExceptionCode.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToyMzoxN1rOHiNX0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTozNTo1MlrOHiN8Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzMjcyMQ==", "bodyText": "Sorry missed this in my previous review.\nIf there is root cause exception present, you should use this constructor to create SQLtimeoutException\npublic SQLTimeoutException(String reason,\n                   String SQLState,\n                   int vendorCode,\n                   Throwable cause)", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505632721", "createdAt": "2020-10-15T15:23:17Z", "author": {"login": "shahrs87"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/exception/SQLExceptionCode.java", "diffHunk": "@@ -453,8 +453,13 @@ public SQLException newException(SQLExceptionInfo info) {\n     OPERATION_TIMED_OUT(6000, \"TIM01\", \"Operation timed out.\", new Factory() {\n         @Override\n         public SQLException newException(SQLExceptionInfo info) {\n-            return new SQLTimeoutException(OPERATION_TIMED_OUT.getMessage(),\n-                    OPERATION_TIMED_OUT.getSQLState(), OPERATION_TIMED_OUT.getErrorCode());\n+            final String reason =\n+                (info.getMessage() != null ? info.getMessage() : \"\")\n+                    + (info.getRootCause() != null ? \" , rootCause: \"\n+                    + info.getRootCause() : \"\");\n+            return new SQLTimeoutException(reason,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "185654888a2e596b1f807bee73ed3aef42110448"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY0MjAxOA==", "bodyText": "Done", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505642018", "createdAt": "2020-10-15T15:35:52Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/exception/SQLExceptionCode.java", "diffHunk": "@@ -453,8 +453,13 @@ public SQLException newException(SQLExceptionInfo info) {\n     OPERATION_TIMED_OUT(6000, \"TIM01\", \"Operation timed out.\", new Factory() {\n         @Override\n         public SQLException newException(SQLExceptionInfo info) {\n-            return new SQLTimeoutException(OPERATION_TIMED_OUT.getMessage(),\n-                    OPERATION_TIMED_OUT.getSQLState(), OPERATION_TIMED_OUT.getErrorCode());\n+            final String reason =\n+                (info.getMessage() != null ? info.getMessage() : \"\")\n+                    + (info.getRootCause() != null ? \" , rootCause: \"\n+                    + info.getRootCause() : \"\");\n+            return new SQLTimeoutException(reason,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzMjcyMQ=="}, "originalCommit": {"oid": "185654888a2e596b1f807bee73ed3aef42110448"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2Nzc3ODQyOnYy", "diffSide": "RIGHT", "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/OperationTimeoutWithReasonIT.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNzozODo1NFrOHiS3Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODozMDowOFrOHiU4wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcyMjY2Mg==", "bodyText": "Should we check that e.getCause() != null ?", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505722662", "createdAt": "2020-10-15T17:38:54Z", "author": {"login": "shahrs87"}, "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/OperationTimeoutWithReasonIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.phoenix.end2end;\n+\n+import org.apache.phoenix.util.EnvironmentEdge;\n+import org.apache.phoenix.util.EnvironmentEdgeManager;\n+import org.junit.Test;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+import static org.apache.phoenix.exception.SQLExceptionCode.OPERATION_TIMED_OUT;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+public class OperationTimeoutWithReasonIT extends ParallelStatsDisabledIT {\n+\n+    private static final class MyClock extends EnvironmentEdge {\n+        private long time;\n+        private final long delay;\n+\n+        public MyClock (long time, long delay) {\n+            this.time = time;\n+            this.delay = delay;\n+        }\n+\n+        @Override\n+        public long currentTime() {\n+            long currentTime = this.time;\n+            this.time += this.delay;\n+            return currentTime;\n+        }\n+    }\n+\n+    @Test\n+    public void testOperationTimeout() throws SQLException {\n+        final String tableName = generateUniqueName();\n+        final String ddl = \"CREATE TABLE \" + tableName\n+            + \" (COL1 VARCHAR NOT NULL PRIMARY KEY, COL2 VARCHAR)\";\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+                 Statement stmt = conn.createStatement()) {\n+            stmt.execute(ddl);\n+            final String dml = String.format(\"UPSERT INTO %s VALUES (?, ?)\",\n+                tableName);\n+            try(PreparedStatement prepStmt = conn.prepareStatement(dml)) {\n+                for (int i = 1; i <= 100; i++) {\n+                    prepStmt.setString(1, \"key\" + i);\n+                    prepStmt.setString(2, \"value\" + i);\n+                    prepStmt.executeUpdate();\n+                }\n+            }\n+            conn.commit();\n+        }\n+\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+             Statement stmt = conn.createStatement()) {\n+            stmt.setQueryTimeout(5); // 5 sec\n+            ResultSet rs = stmt.executeQuery(String.format(\"SELECT * FROM %s\",\n+                tableName));\n+            // Use custom EnvironmentEdge to timeout query with a longer delay in ms\n+            MyClock clock = new MyClock(10, 10000);\n+            EnvironmentEdgeManager.injectEdge(clock);\n+            try {\n+                rs.next();\n+                fail();\n+            } catch (SQLException e) {\n+                assertEquals(OPERATION_TIMED_OUT.getErrorCode(),\n+                    e.getErrorCode());\n+                assertTrue(e.getMessage().contains(\"Query couldn't be \" +\n+                    \"completed in the allotted time: 5000 ms\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce86a9076b88cb778ae91582eceea486cdf088f7"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTczMDM0MQ==", "bodyText": "Actually it is null in this case because for the test, rootCause is not provided here (BaseResultIterators):\n    throw new SQLExceptionInfo.Builder(OPERATION_TIMED_OUT).setMessage(\n            \". Query couldn't be completed in the allotted time: \"\n                    + queryTimeOut + \" ms\").build().buildException();\n\nHowever, I tested by manually adding rootCause and receiving on test side. Hence, it is working fine but since relevant source code does not add root cause, e.getCause() != null would not be true here.", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505730341", "createdAt": "2020-10-15T17:51:45Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/OperationTimeoutWithReasonIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.phoenix.end2end;\n+\n+import org.apache.phoenix.util.EnvironmentEdge;\n+import org.apache.phoenix.util.EnvironmentEdgeManager;\n+import org.junit.Test;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+import static org.apache.phoenix.exception.SQLExceptionCode.OPERATION_TIMED_OUT;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+public class OperationTimeoutWithReasonIT extends ParallelStatsDisabledIT {\n+\n+    private static final class MyClock extends EnvironmentEdge {\n+        private long time;\n+        private final long delay;\n+\n+        public MyClock (long time, long delay) {\n+            this.time = time;\n+            this.delay = delay;\n+        }\n+\n+        @Override\n+        public long currentTime() {\n+            long currentTime = this.time;\n+            this.time += this.delay;\n+            return currentTime;\n+        }\n+    }\n+\n+    @Test\n+    public void testOperationTimeout() throws SQLException {\n+        final String tableName = generateUniqueName();\n+        final String ddl = \"CREATE TABLE \" + tableName\n+            + \" (COL1 VARCHAR NOT NULL PRIMARY KEY, COL2 VARCHAR)\";\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+                 Statement stmt = conn.createStatement()) {\n+            stmt.execute(ddl);\n+            final String dml = String.format(\"UPSERT INTO %s VALUES (?, ?)\",\n+                tableName);\n+            try(PreparedStatement prepStmt = conn.prepareStatement(dml)) {\n+                for (int i = 1; i <= 100; i++) {\n+                    prepStmt.setString(1, \"key\" + i);\n+                    prepStmt.setString(2, \"value\" + i);\n+                    prepStmt.executeUpdate();\n+                }\n+            }\n+            conn.commit();\n+        }\n+\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+             Statement stmt = conn.createStatement()) {\n+            stmt.setQueryTimeout(5); // 5 sec\n+            ResultSet rs = stmt.executeQuery(String.format(\"SELECT * FROM %s\",\n+                tableName));\n+            // Use custom EnvironmentEdge to timeout query with a longer delay in ms\n+            MyClock clock = new MyClock(10, 10000);\n+            EnvironmentEdgeManager.injectEdge(clock);\n+            try {\n+                rs.next();\n+                fail();\n+            } catch (SQLException e) {\n+                assertEquals(OPERATION_TIMED_OUT.getErrorCode(),\n+                    e.getErrorCode());\n+                assertTrue(e.getMessage().contains(\"Query couldn't be \" +\n+                    \"completed in the allotted time: 5000 ms\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcyMjY2Mg=="}, "originalCommit": {"oid": "ce86a9076b88cb778ae91582eceea486cdf088f7"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTczMzQ5Nw==", "bodyText": "@virajjasani  Can we just write a unit test creating OPERATION_TIMED_OUT exception with custom message and custom fake exception. Ideally we wouldn't even need integration test but the test that you wrote is very nice.", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505733497", "createdAt": "2020-10-15T17:56:46Z", "author": {"login": "shahrs87"}, "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/OperationTimeoutWithReasonIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.phoenix.end2end;\n+\n+import org.apache.phoenix.util.EnvironmentEdge;\n+import org.apache.phoenix.util.EnvironmentEdgeManager;\n+import org.junit.Test;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+import static org.apache.phoenix.exception.SQLExceptionCode.OPERATION_TIMED_OUT;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+public class OperationTimeoutWithReasonIT extends ParallelStatsDisabledIT {\n+\n+    private static final class MyClock extends EnvironmentEdge {\n+        private long time;\n+        private final long delay;\n+\n+        public MyClock (long time, long delay) {\n+            this.time = time;\n+            this.delay = delay;\n+        }\n+\n+        @Override\n+        public long currentTime() {\n+            long currentTime = this.time;\n+            this.time += this.delay;\n+            return currentTime;\n+        }\n+    }\n+\n+    @Test\n+    public void testOperationTimeout() throws SQLException {\n+        final String tableName = generateUniqueName();\n+        final String ddl = \"CREATE TABLE \" + tableName\n+            + \" (COL1 VARCHAR NOT NULL PRIMARY KEY, COL2 VARCHAR)\";\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+                 Statement stmt = conn.createStatement()) {\n+            stmt.execute(ddl);\n+            final String dml = String.format(\"UPSERT INTO %s VALUES (?, ?)\",\n+                tableName);\n+            try(PreparedStatement prepStmt = conn.prepareStatement(dml)) {\n+                for (int i = 1; i <= 100; i++) {\n+                    prepStmt.setString(1, \"key\" + i);\n+                    prepStmt.setString(2, \"value\" + i);\n+                    prepStmt.executeUpdate();\n+                }\n+            }\n+            conn.commit();\n+        }\n+\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+             Statement stmt = conn.createStatement()) {\n+            stmt.setQueryTimeout(5); // 5 sec\n+            ResultSet rs = stmt.executeQuery(String.format(\"SELECT * FROM %s\",\n+                tableName));\n+            // Use custom EnvironmentEdge to timeout query with a longer delay in ms\n+            MyClock clock = new MyClock(10, 10000);\n+            EnvironmentEdgeManager.injectEdge(clock);\n+            try {\n+                rs.next();\n+                fail();\n+            } catch (SQLException e) {\n+                assertEquals(OPERATION_TIMED_OUT.getErrorCode(),\n+                    e.getErrorCode());\n+                assertTrue(e.getMessage().contains(\"Query couldn't be \" +\n+                    \"completed in the allotted time: 5000 ms\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcyMjY2Mg=="}, "originalCommit": {"oid": "ce86a9076b88cb778ae91582eceea486cdf088f7"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1NTg0Mg==", "bodyText": "Done. Let's keep both unit and IT.\nThanks", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505755842", "createdAt": "2020-10-15T18:30:08Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/it/java/org/apache/phoenix/end2end/OperationTimeoutWithReasonIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.phoenix.end2end;\n+\n+import org.apache.phoenix.util.EnvironmentEdge;\n+import org.apache.phoenix.util.EnvironmentEdgeManager;\n+import org.junit.Test;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+import static org.apache.phoenix.exception.SQLExceptionCode.OPERATION_TIMED_OUT;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+public class OperationTimeoutWithReasonIT extends ParallelStatsDisabledIT {\n+\n+    private static final class MyClock extends EnvironmentEdge {\n+        private long time;\n+        private final long delay;\n+\n+        public MyClock (long time, long delay) {\n+            this.time = time;\n+            this.delay = delay;\n+        }\n+\n+        @Override\n+        public long currentTime() {\n+            long currentTime = this.time;\n+            this.time += this.delay;\n+            return currentTime;\n+        }\n+    }\n+\n+    @Test\n+    public void testOperationTimeout() throws SQLException {\n+        final String tableName = generateUniqueName();\n+        final String ddl = \"CREATE TABLE \" + tableName\n+            + \" (COL1 VARCHAR NOT NULL PRIMARY KEY, COL2 VARCHAR)\";\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+                 Statement stmt = conn.createStatement()) {\n+            stmt.execute(ddl);\n+            final String dml = String.format(\"UPSERT INTO %s VALUES (?, ?)\",\n+                tableName);\n+            try(PreparedStatement prepStmt = conn.prepareStatement(dml)) {\n+                for (int i = 1; i <= 100; i++) {\n+                    prepStmt.setString(1, \"key\" + i);\n+                    prepStmt.setString(2, \"value\" + i);\n+                    prepStmt.executeUpdate();\n+                }\n+            }\n+            conn.commit();\n+        }\n+\n+        try (Connection conn = DriverManager.getConnection(getUrl());\n+             Statement stmt = conn.createStatement()) {\n+            stmt.setQueryTimeout(5); // 5 sec\n+            ResultSet rs = stmt.executeQuery(String.format(\"SELECT * FROM %s\",\n+                tableName));\n+            // Use custom EnvironmentEdge to timeout query with a longer delay in ms\n+            MyClock clock = new MyClock(10, 10000);\n+            EnvironmentEdgeManager.injectEdge(clock);\n+            try {\n+                rs.next();\n+                fail();\n+            } catch (SQLException e) {\n+                assertEquals(OPERATION_TIMED_OUT.getErrorCode(),\n+                    e.getErrorCode());\n+                assertTrue(e.getMessage().contains(\"Query couldn't be \" +\n+                    \"completed in the allotted time: 5000 ms\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcyMjY2Mg=="}, "originalCommit": {"oid": "ce86a9076b88cb778ae91582eceea486cdf088f7"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2Nzk5NDg5OnYy", "diffSide": "RIGHT", "path": "phoenix-core/src/test/java/org/apache/phoenix/util/SQLExceptionCodeTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODozNDowMVrOHiVBOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODozNTo0NlrOHiVFQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1ODAxMA==", "bodyText": "Do we use exceptions from this package anywhere else ? Haven't come across this library. Can we add some generic exception ?", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505758010", "createdAt": "2020-10-15T18:34:01Z", "author": {"login": "shahrs87"}, "path": "phoenix-core/src/test/java/org/apache/phoenix/util/SQLExceptionCodeTest.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one or more\n+ *  contributor license agreements.  See the NOTICE file distributed with\n+ *  this work for additional information regarding copyright ownership.\n+ *  The ASF licenses this file to You under the Apache License, Version 2.0\n+ *  (the \"License\"); you may not use this file except in compliance with\n+ *  the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.apache.phoenix.util;\n+\n+import com.sun.javaws.exceptions.InvalidArgumentException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b54804dee6df883f06b0d714185951e712fa83c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1OTA0MA==", "bodyText": "Oh, I actually meant IllegalArgumentException, let me change it.", "url": "https://github.com/apache/phoenix/pull/919#discussion_r505759040", "createdAt": "2020-10-15T18:35:46Z", "author": {"login": "virajjasani"}, "path": "phoenix-core/src/test/java/org/apache/phoenix/util/SQLExceptionCodeTest.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one or more\n+ *  contributor license agreements.  See the NOTICE file distributed with\n+ *  this work for additional information regarding copyright ownership.\n+ *  The ASF licenses this file to You under the Apache License, Version 2.0\n+ *  (the \"License\"); you may not use this file except in compliance with\n+ *  the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.apache.phoenix.util;\n+\n+import com.sun.javaws.exceptions.InvalidArgumentException;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1ODAxMA=="}, "originalCommit": {"oid": "4b54804dee6df883f06b0d714185951e712fa83c"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4615, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}