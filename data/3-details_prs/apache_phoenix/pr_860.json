{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MDY5ODY4", "number": 860, "title": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closi\u2026", "bodyText": "\u2026ng before every inner batch", "createdAt": "2020-08-17T21:11:26Z", "url": "https://github.com/apache/phoenix/pull/860", "merged": true, "mergeCommit": {"oid": "48970e98e8c0038455942a10e0604fba80885ddb"}, "closed": true, "closedAt": "2020-08-21T17:04:56Z", "author": {"login": "swaroopak"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_6PkygBqjM2NjM4NTE5MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA9DZIgFqTQ3MjEzNjAwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a12cdc5eb81fb4302923af5642111f3ed174267", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/8a12cdc5eb81fb4302923af5642111f3ed174267", "committedDate": "2020-08-17T21:08:56Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "c80c1cfe3b87f1f5d582c241be08705ec08cd62c", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/c80c1cfe3b87f1f5d582c241be08705ec08cd62c", "committedDate": "2020-08-17T22:34:29Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4ODk3MDQ5", "url": "https://github.com/apache/phoenix/pull/860#pullrequestreview-468897049", "createdAt": "2020-08-17T23:30:50Z", "commit": {"oid": "c80c1cfe3b87f1f5d582c241be08705ec08cd62c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMzozMDo1MFrOHB-Mag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMzozMDo1MFrOHB-Mag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgyOTYxMA==", "bodyText": "@swaroopak - do we need the region.closeRegionOperation() and localScanner.close() calls? They appear to already be called in the finally block, which will execute even if we return false early. And a finally block seems like a safer place for them so some other code path doesn't miss them in the future.", "url": "https://github.com/apache/phoenix/pull/860#discussion_r471829610", "createdAt": "2020-08-17T23:30:50Z", "author": {"login": "gjacoby126"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -1301,11 +1301,24 @@ public boolean next(List<Cell> results) throws IOException {\n         try {\n             localScanner = getLocalScanner();\n             if (localScanner == null) {\n+                region.closeRegionOperation();\n                 return false;\n             }\n             synchronized (localScanner) {\n                 if (!shouldVerify()) {\n                     skipped = true;\n+                    region.closeRegionOperation();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c80c1cfe3b87f1f5d582c241be08705ec08cd62c"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c80c1cfe3b87f1f5d582c241be08705ec08cd62c", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/c80c1cfe3b87f1f5d582c241be08705ec08cd62c", "committedDate": "2020-08-17T22:34:29Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "e0c80024f03c5078d8a3583cdc6b416204a61cf2", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/e0c80024f03c5078d8a3583cdc6b416204a61cf2", "committedDate": "2020-08-18T01:35:42Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0c80024f03c5078d8a3583cdc6b416204a61cf2", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/e0c80024f03c5078d8a3583cdc6b416204a61cf2", "committedDate": "2020-08-18T01:35:42Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "221791033e0c0cb2786b41876c08f0793bd35990", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/221791033e0c0cb2786b41876c08f0793bd35990", "committedDate": "2020-08-18T02:06:50Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "221791033e0c0cb2786b41876c08f0793bd35990", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/221791033e0c0cb2786b41876c08f0793bd35990", "committedDate": "2020-08-18T02:06:50Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "7c155a28589c65000587f39a359b08f286bb7ced", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/7c155a28589c65000587f39a359b08f286bb7ced", "committedDate": "2020-08-18T16:30:09Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c155a28589c65000587f39a359b08f286bb7ced", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/7c155a28589c65000587f39a359b08f286bb7ced", "committedDate": "2020-08-18T16:30:09Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "72ca20d51a4377834fbe9108d651224961da0788", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/72ca20d51a4377834fbe9108d651224961da0788", "committedDate": "2020-08-18T17:52:05Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72ca20d51a4377834fbe9108d651224961da0788", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/72ca20d51a4377834fbe9108d651224961da0788", "committedDate": "2020-08-18T17:52:05Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "eb07ca62a0ff6529837b654c6dcc137532d3ed8a", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/eb07ca62a0ff6529837b654c6dcc137532d3ed8a", "committedDate": "2020-08-18T22:25:58Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb07ca62a0ff6529837b654c6dcc137532d3ed8a", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/eb07ca62a0ff6529837b654c6dcc137532d3ed8a", "committedDate": "2020-08-18T22:25:58Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "d7477ed617fa033fff26ff2b0571521ef53bb41e", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/d7477ed617fa033fff26ff2b0571521ef53bb41e", "committedDate": "2020-08-19T00:13:38Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQyMzc0", "url": "https://github.com/apache/phoenix/pull/860#pullrequestreview-471942374", "createdAt": "2020-08-20T19:58:05Z", "commit": {"oid": "d7477ed617fa033fff26ff2b0571521ef53bb41e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo1ODowNVrOHERPNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo1ODowNVrOHERPNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzODc3NA==", "bodyText": "You missed the for loop before this (line 903)", "url": "https://github.com/apache/phoenix/pull/860#discussion_r474238774", "createdAt": "2020-08-20T19:58:05Z", "author": {"login": "kadirozde"}, "path": "phoenix-core/src/main/java/org/apache/phoenix/coprocessor/IndexRebuildRegionScanner.java", "diffHunk": "@@ -899,6 +906,7 @@ private void rebuildIndexRows(Map<byte[], List<Mutation>> indexKeyToMutationMap,\n                 }\n             }\n             if (batchSize > 0) {\n+                ungroupedAggregateRegionObserver.checkForRegionClosing();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7477ed617fa033fff26ff2b0571521ef53bb41e"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5246ae833931b4972624b5d74eb3090690832901", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/5246ae833931b4972624b5d74eb3090690832901", "committedDate": "2020-08-20T21:41:59Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7477ed617fa033fff26ff2b0571521ef53bb41e", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/d7477ed617fa033fff26ff2b0571521ef53bb41e", "committedDate": "2020-08-19T00:13:38Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}, "afterCommit": {"oid": "5246ae833931b4972624b5d74eb3090690832901", "author": {"user": null}, "url": "https://github.com/apache/phoenix/commit/5246ae833931b4972624b5d74eb3090690832901", "committedDate": "2020-08-20T21:41:59Z", "message": "PHOENIX-6080: Add a check to Index Rebuild jobs to check region closing before every inner batch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMTM2MDA4", "url": "https://github.com/apache/phoenix/pull/860#pullrequestreview-472136008", "createdAt": "2020-08-21T04:25:09Z", "commit": {"oid": "5246ae833931b4972624b5d74eb3090690832901"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1900, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}