{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2ODA0Mzgy", "number": 1580, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyODoyNFrOEoJHAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjozODo0NVrOEoK6qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTI3NzQ2OnYy", "diffSide": "RIGHT", "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyODoyNFrOHZD7RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyODoyNFrOHZD7RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA0MDc3Mg==", "bodyText": "This should be WorkflowOperationException", "url": "https://github.com/opencast/opencast/pull/1580#discussion_r496040772", "createdAt": "2020-09-28T15:28:24Z", "author": {"login": "gregorydlogan"}, "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "diffHunk": "@@ -119,6 +119,20 @@ public WorkflowOperationResult start(WorkflowInstance workflowInstance, JobConte\n       elementSelector.addTag(tag);\n     }\n \n+    boolean wildcardInTargetFlavorType = false;\n+    boolean wildcardInTargetFlavorSubtype = false;\n+    if (configuredTargetFlavor != null) {\n+      String[] targetFlavorTypes = configuredTargetFlavor.split(\"/\");\n+      if (targetFlavorTypes.length != 2) {\n+        String errorMsg = String.format(\"The configured target flavor has a wrong format. \"\n+                + \"The configured target flavor: '%s'.\", configuredTargetFlavor);\n+        logger.error(errorMsg);\n+        throw new RuntimeException(errorMsg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae3986b8d69562a72ac9fcae6bd211139952ad32"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTI3OTgxOnYy", "diffSide": "RIGHT", "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyODo1MlrOHZD8yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyODo1MlrOHZD8yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA0MTE2MA==", "bodyText": "Ideally this should be a class level constant.", "url": "https://github.com/opencast/opencast/pull/1580#discussion_r496041160", "createdAt": "2020-09-28T15:28:52Z", "author": {"login": "gregorydlogan"}, "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "diffHunk": "@@ -119,6 +119,20 @@ public WorkflowOperationResult start(WorkflowInstance workflowInstance, JobConte\n       elementSelector.addTag(tag);\n     }\n \n+    boolean wildcardInTargetFlavorType = false;\n+    boolean wildcardInTargetFlavorSubtype = false;\n+    if (configuredTargetFlavor != null) {\n+      String[] targetFlavorTypes = configuredTargetFlavor.split(\"/\");\n+      if (targetFlavorTypes.length != 2) {\n+        String errorMsg = String.format(\"The configured target flavor has a wrong format. \"\n+                + \"The configured target flavor: '%s'.\", configuredTargetFlavor);\n+        logger.error(errorMsg);\n+        throw new RuntimeException(errorMsg);\n+      }\n+      wildcardInTargetFlavorType = \"*\".equals(targetFlavorTypes[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae3986b8d69562a72ac9fcae6bd211139952ad32"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTI4MzMyOnYy", "diffSide": "RIGHT", "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyOTo0NFrOHZD_KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyOTo0NFrOHZD_KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA0MTc2OA==", "bodyText": "This call escapes the *, the following one does not.  They should be the same, right?", "url": "https://github.com/opencast/opencast/pull/1580#discussion_r496041768", "createdAt": "2020-09-28T15:29:44Z", "author": {"login": "gregorydlogan"}, "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "diffHunk": "@@ -127,8 +141,21 @@ public WorkflowOperationResult start(WorkflowInstance workflowInstance, JobConte\n         element.setIdentifier(null);\n         element.setURI(e.getURI()); // use the same URI as the original\n       }\n-      if (configuredTargetFlavor != null)\n-        element.setFlavor(MediaPackageElementFlavor.parseFlavor(configuredTargetFlavor));\n+\n+      if (configuredTargetFlavor != null) {\n+        String targetFlavor = configuredTargetFlavor;\n+\n+        if (wildcardInTargetFlavorType) {\n+          targetFlavor = targetFlavor.replaceFirst(\"\\\\*\", element.getFlavor().getType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae3986b8d69562a72ac9fcae6bd211139952ad32"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTU3MzUyOnYy", "diffSide": "RIGHT", "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjozODo0NVrOHZGxBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjozODo0NVrOHZGxBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA4NzMwMw==", "bodyText": "Don't log an error when you throw an exception anyway. The result will just be that you see the same error twice in the logs. Also, I like short messages ;-)\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String errorMsg = String.format(\"The configured target flavor has a wrong format. \"\n          \n          \n            \n                            + \"The configured target flavor: '%s'.\", configuredTargetFlavor);\n          \n          \n            \n                    logger.error(errorMsg);\n          \n          \n            \n                    throw new RuntimeException(errorMsg);\n          \n          \n            \n                    final String errorMsg = String.format(\"The configured target flavor `%s` has a wrong format.\", configuredTargetFlavor);\n          \n          \n            \n                    throw new RuntimeException(errorMsg);", "url": "https://github.com/opencast/opencast/pull/1580#discussion_r496087303", "createdAt": "2020-09-28T16:38:45Z", "author": {"login": "lkiesow"}, "path": "modules/workflow-workflowoperation/src/main/java/org/opencastproject/workflow/handler/workflow/TagWorkflowOperationHandler.java", "diffHunk": "@@ -119,6 +119,20 @@ public WorkflowOperationResult start(WorkflowInstance workflowInstance, JobConte\n       elementSelector.addTag(tag);\n     }\n \n+    boolean wildcardInTargetFlavorType = false;\n+    boolean wildcardInTargetFlavorSubtype = false;\n+    if (configuredTargetFlavor != null) {\n+      String[] targetFlavorTypes = configuredTargetFlavor.split(\"/\");\n+      if (targetFlavorTypes.length != 2) {\n+        String errorMsg = String.format(\"The configured target flavor has a wrong format. \"\n+                + \"The configured target flavor: '%s'.\", configuredTargetFlavor);\n+        logger.error(errorMsg);\n+        throw new RuntimeException(errorMsg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae3986b8d69562a72ac9fcae6bd211139952ad32"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3240, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}