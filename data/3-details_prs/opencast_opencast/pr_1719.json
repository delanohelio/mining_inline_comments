{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3MDIwNzUz", "number": 1719, "title": "Download button in theodul player", "bodyText": "Added the possibility to download the currently playing video in the theodul player. The plugin can be activated in \"etc/ui-config/mh_default_org/theodul/config.yml\". The configuration name is \"allow_video_download\". There is also an option that specifies which users are allowed to download a video, it's called \"allowed_roles_for_video_download\". It contains a regular expression and will only allow users who has at least one role that matches the regex.", "createdAt": "2020-07-27T09:11:40Z", "url": "https://github.com/opencast/opencast/pull/1719", "merged": true, "mergeCommit": {"oid": "cd0d53fedecbfe7594a1ba003a115ca71a7ba880"}, "closed": true, "closedAt": "2020-09-10T23:02:04Z", "author": {"login": "marwyg"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4-ockABqjM1ODkwMjc3MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHoh2igH2gAyNDU3MDIwNzUzOmIxZTQ1MTJmOWFkMDYwNzgzNTg5NTU5NjAzYzkwNzAzYjE5OWM5NWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d461474c00cfa9593fd65e95c9f70cfeee87decf", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/d461474c00cfa9593fd65e95c9f70cfeee87decf", "committedDate": "2020-07-27T08:52:41Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "fea91e1287adce3267d9019760ebc95a6fd9baab", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/fea91e1287adce3267d9019760ebc95a6fd9baab", "committedDate": "2020-07-27T09:43:14Z", "message": "Download button in theodul player"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fea91e1287adce3267d9019760ebc95a6fd9baab", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/fea91e1287adce3267d9019760ebc95a6fd9baab", "committedDate": "2020-07-27T09:43:14Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "7f3cee62216a4031c72761c38170591a2c94e84d", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/7f3cee62216a4031c72761c38170591a2c94e84d", "committedDate": "2020-07-27T09:58:57Z", "message": "Download button in theodul player"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f3cee62216a4031c72761c38170591a2c94e84d", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/7f3cee62216a4031c72761c38170591a2c94e84d", "committedDate": "2020-07-27T09:58:57Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/50190ad3881a0193074c9425e8a939fe7e9391d2", "committedDate": "2020-07-27T10:11:05Z", "message": "Download button in theodul player"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NjY1MjU5", "url": "https://github.com/opencast/opencast/pull/1719#pullrequestreview-455665259", "createdAt": "2020-07-27T10:34:21Z", "commit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDozNDoyMVrOG3c8Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMDo1Mjo1OVrOG3demg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5OTAyNw==", "bodyText": "This shouldn't be in here", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460799027", "createdAt": "2020-07-27T10:34:21Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/main/java/org/opencast/engage/theodul/plugin/tab/downloads/App.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package org.opencast.engage.theodul.plugin.tab.downloads;\n+\n+/**\n+ * Hello world!\n+ *\n+ */\n+public class App \n+{\n+    public static void main( String[] args )\n+    {\n+        System.out.println( \"Hello World!\" );\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5OTc2MA==", "bodyText": "Can we use OSGi annotations instead of specifying this in XML?", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460799760", "createdAt": "2020-07-27T10:35:52Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/main/resources/OSGI-INF/engage-plugin.xml", "diffHunk": "@@ -0,0 +1,21 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<scr:component xmlns:scr=\"http://www.osgi.org/xmlns/scr/v1.1.0\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwMTM0Mw==", "bodyText": "This can probably go", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460801343", "createdAt": "2020-07-27T10:39:30Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/main/resources/static/styles/desktop.css", "diffHunk": "@@ -0,0 +1,37 @@\n+#engage_description_tab_content {\n+    width: 100%;\n+    padding-top: 15px;\n+    padding-right: 20px;\n+}\n+\n+.description-item {\n+    border-radius: 4px;\n+    padding: 5px;\n+/*\n+  color: #000000;\n+  background-color: #F1F1F1;\n+  border-color: #969696;\n+  */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwMTk1NQ==", "bodyText": "This test does not make any sense, does it?\nDrop it.", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460801955", "createdAt": "2020-07-27T10:40:51Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/test/java/org/opencast/engage/theodul/plugin/tab/downloads/AppTest.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package org.opencast.engage.theodul.plugin.tab.downloads;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import org.junit.Test;\n+\n+/**\n+ * Unit test for simple App.\n+ */\n+public class AppTest \n+{\n+    /**\n+     * Rigorous Test :-)\n+     */\n+    @Test\n+    public void shouldAnswerWithTrue()\n+    {\n+        assertTrue( true );\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwMjY2Nw==", "bodyText": "Are these tests intended to be used?", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460802667", "createdAt": "2020-07-27T10:42:26Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/test/resources/js/engage/core.js", "diffHunk": "@@ -0,0 +1,66 @@\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwNTY1NA==", "bodyText": "Instead of checking this here, could we check it in modules/engage-theodul-plugin-tab-downloads/src/main/resources/static/main.js and have the plugin potentially do nothing instead? That way, we have no plug-in specific code in here.", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460805654", "createdAt": "2020-07-27T10:48:33Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-core/src/main/resources/ui/js/engage/core.js", "diffHunk": "@@ -459,6 +459,23 @@ define(['require', 'jquery', 'underscore', 'backbone', 'mousetrap', 'bowser', 'b\n   }\n \n   function loadTemplate(plugin, plugin_name, plugin_path) {\n+\n+    // The following code block contains the logic for the download tab in the theodul player.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwNTg4MA==", "bodyText": "Why embed these files if they are empty anyway?", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460805880", "createdAt": "2020-07-27T10:49:06Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/main/resources/static/main.js", "diffHunk": "@@ -0,0 +1,241 @@\n+/**\n+ * Copyright 2009-2011 The Regents of the University of California Licensed\n+ * under the Educational Community License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.osedu.org/licenses/ECL-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+/*jslint browser: true, nomen: true*/\n+/*global define*/\n+define([\"jquery\", \"underscore\", \"backbone\", \"engage/core\"], function($, _, Backbone, Engage) {\n+    \"use strict\";\n+\n+    var insertIntoDOM = true;\n+    var PLUGIN_NAME = \"Downloads\";\n+    var PLUGIN_TYPE = \"engage_tab\";\n+    var PLUGIN_VERSION = \"1.0\";\n+    var PLUGIN_TEMPLATE_DESKTOP = \"templates/desktop.html\";\n+    var PLUGIN_TEMPLATE_MOBILE = \"templates/mobile.html\";\n+    var PLUGIN_TEMPLATE_EMBED = \"templates/embed.html\";\n+    var PLUGIN_STYLES_DESKTOP = [\n+        \"styles/desktop.css\"\n+    ];\n+    var PLUGIN_STYLES_EMBED = [\n+        \"styles/embed.css\"\n+    ];\n+    var PLUGIN_STYLES_MOBILE = [\n+        \"styles/mobile.css\"\n+    ];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwNjM4Mw==", "bodyText": "From what I can tell, these modes do the same thing: nothing.\nWhy handle them separately?", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460806383", "createdAt": "2020-07-27T10:50:06Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/main/resources/static/main.js", "diffHunk": "@@ -0,0 +1,241 @@\n+/**\n+ * Copyright 2009-2011 The Regents of the University of California Licensed\n+ * under the Educational Community License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.osedu.org/licenses/ECL-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+/*jslint browser: true, nomen: true*/\n+/*global define*/\n+define([\"jquery\", \"underscore\", \"backbone\", \"engage/core\"], function($, _, Backbone, Engage) {\n+    \"use strict\";\n+\n+    var insertIntoDOM = true;\n+    var PLUGIN_NAME = \"Downloads\";\n+    var PLUGIN_TYPE = \"engage_tab\";\n+    var PLUGIN_VERSION = \"1.0\";\n+    var PLUGIN_TEMPLATE_DESKTOP = \"templates/desktop.html\";\n+    var PLUGIN_TEMPLATE_MOBILE = \"templates/mobile.html\";\n+    var PLUGIN_TEMPLATE_EMBED = \"templates/embed.html\";\n+    var PLUGIN_STYLES_DESKTOP = [\n+        \"styles/desktop.css\"\n+    ];\n+    var PLUGIN_STYLES_EMBED = [\n+        \"styles/embed.css\"\n+    ];\n+    var PLUGIN_STYLES_MOBILE = [\n+        \"styles/mobile.css\"\n+    ];\n+\n+    var plugin;\n+    var events = {\n+        plugin_load_done: new Engage.Event(\"Core:plugin_load_done\", \"\", \"handler\"),\n+        mediaPackageModelError: new Engage.Event(\"MhConnection:mediaPackageModelError\", \"\", \"handler\")\n+    };\n+\n+    var isDesktopMode = false;\n+    var isEmbedMode = false;\n+    var isMobileMode = false;\n+\n+    // desktop, embed and mobile logic\n+    switch (Engage.model.get(\"mode\")) {\n+        case \"embed\":\n+            plugin = {\n+                insertIntoDOM: insertIntoDOM,\n+                name: PLUGIN_NAME,\n+                type: PLUGIN_TYPE,\n+                version: PLUGIN_VERSION,\n+                styles: PLUGIN_STYLES_EMBED,\n+                template: PLUGIN_TEMPLATE_EMBED,\n+                events: events\n+            };\n+            isEmbedMode = true;\n+            break;\n+        case \"mobile\":\n+            plugin = {\n+                insertIntoDOM: insertIntoDOM,\n+                name: PLUGIN_NAME,\n+                type: PLUGIN_TYPE,\n+                version: PLUGIN_VERSION,\n+                styles: PLUGIN_STYLES_MOBILE,\n+                template: PLUGIN_TEMPLATE_MOBILE,\n+                events: events\n+            };\n+            isMobileMode = true;\n+            break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgwNzgzNA==", "bodyText": "The maven-dependency-plugin complains about several dependencies in here.\nYou are also not really using any Jasmine or JUnit tests, are you?", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r460807834", "createdAt": "2020-07-27T10:52:59Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/pom.xml", "diffHunk": "@@ -0,0 +1,136 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50190ad3881a0193074c9425e8a939fe7e9391d2", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/50190ad3881a0193074c9425e8a939fe7e9391d2", "committedDate": "2020-07-27T10:11:05Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "48d961a83d30da69499aebddc7242a3182d4f109", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/48d961a83d30da69499aebddc7242a3182d4f109", "committedDate": "2020-07-27T11:27:06Z", "message": "Download button in theodul player"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48d961a83d30da69499aebddc7242a3182d4f109", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/48d961a83d30da69499aebddc7242a3182d4f109", "committedDate": "2020-07-27T11:27:06Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "ff8c06bab35fdd23384c6fbd1393b50a7458d28d", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/ff8c06bab35fdd23384c6fbd1393b50a7458d28d", "committedDate": "2020-07-28T08:19:46Z", "message": "Download button in theodul player"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff8c06bab35fdd23384c6fbd1393b50a7458d28d", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/ff8c06bab35fdd23384c6fbd1393b50a7458d28d", "committedDate": "2020-07-28T08:19:46Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "1d56009d8e842ecc2777c36d22489193d829e8df", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/1d56009d8e842ecc2777c36d22489193d829e8df", "committedDate": "2020-08-06T09:15:57Z", "message": "Download button in theodul player"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d56009d8e842ecc2777c36d22489193d829e8df", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/1d56009d8e842ecc2777c36d22489193d829e8df", "committedDate": "2020-08-06T09:15:57Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "53263a8bfc788986f290c2019af62d0c93b99f6d", "author": {"user": {"login": "gregorydlogan", "name": "Greg Logan"}}, "url": "https://github.com/opencast/opencast/commit/53263a8bfc788986f290c2019af62d0c93b99f6d", "committedDate": "2020-07-08T17:04:59Z", "message": "Merge branch 'embedding_code' of git://github.com/jchssystems/opencast into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMzA1NTUw", "url": "https://github.com/opencast/opencast/pull/1719#pullrequestreview-463305550", "createdAt": "2020-08-07T13:20:02Z", "commit": {"oid": "8bd8ef60f17ff189485169f433a8e4ea6c364314"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzoyMTo0N1rOG9Zn9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzozNzozN1rOG9aL3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAzNjE0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Default: false\n          \n          \n            \n            allow_video_download: false\n          \n          \n            \n            # Default: true\n          \n          \n            \n            allow_video_download: true", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r467036149", "createdAt": "2020-08-07T13:21:47Z", "author": {"login": "lkiesow"}, "path": "etc/ui-config/mh_default_org/theodul/config.yml", "diffHunk": "@@ -65,6 +65,18 @@ link_mediamodule: true\n # Default: false\n show_embed_links: true\n \n+# Shows/Hides the download tab under the theodul player.\n+# In order to show up, the user also needs a role that matches the\n+# regex in the following configuration 'allowed_roles_for_video_download'\n+# Allowed values: true, false\n+# Default: false\n+allow_video_download: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bd8ef60f17ff189485169f433a8e4ea6c364314"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAzNzczOA==", "bodyText": "Let's be a bit more open by default but let's also make sure people understand that this is no security option.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Configures the roles that are allowed to see the download plugin\n          \n          \n            \n            # Allowed values: regular expressions (if any role of the user matches this regex, the download tab will be shown)\n          \n          \n            \n            # Default: ROLE_ADMIN\n          \n          \n            \n            allowed_roles_for_video_download: ROLE_ADMIN\n          \n          \n            \n            # Configures the roles that are allowed to see the download plugin.\n          \n          \n            \n            # Note that this does not restrict access to the media files itself.\n          \n          \n            \n            # Allowed values: regular expressions (if any role of the user matches this regex, the download tab will be shown)\n          \n          \n            \n            # Default: ROLE_USER\n          \n          \n            \n            allowed_roles_for_video_download: ROLE_USER", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r467037738", "createdAt": "2020-08-07T13:24:39Z", "author": {"login": "lkiesow"}, "path": "etc/ui-config/mh_default_org/theodul/config.yml", "diffHunk": "@@ -65,6 +65,18 @@ link_mediamodule: true\n # Default: false\n show_embed_links: true\n \n+# Shows/Hides the download tab under the theodul player.\n+# In order to show up, the user also needs a role that matches the\n+# regex in the following configuration 'allowed_roles_for_video_download'\n+# Allowed values: true, false\n+# Default: false\n+allow_video_download: false\n+\n+# Configures the roles that are allowed to see the download plugin\n+# Allowed values: regular expressions (if any role of the user matches this regex, the download tab will be shown)\n+# Default: ROLE_ADMIN\n+allowed_roles_for_video_download: ROLE_ADMIN", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bd8ef60f17ff189485169f433a8e4ea6c364314"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAzOTA2MA==", "bodyText": "Let's use a recent ESLint version from the start:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                \"eslint\": \"^6.6.0\",\n          \n          \n            \n                \"eslint\": \"^7.6.0\",", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r467039060", "createdAt": "2020-08-07T13:26:54Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/package.json", "diffHunk": "@@ -0,0 +1,11 @@\n+{\n+  \"name\": \"engage-theodul-plugin-controls\",\n+  \"private\": true,\n+  \"scripts\": {\n+    \"eslint\": \"eslint --config ../../docs/checkstyle/eslintrc.js --rule '{\\\"no-unused-vars\\\": \\\"off\\\"}' src/main/resources/**/*.js\"\n+  },\n+  \"devDependencies\": {\n+    \"eslint\": \"^6.6.0\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bd8ef60f17ff189485169f433a8e4ea6c364314"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA0MjM2MQ==", "bodyText": "There can be many more languages. This should probably be something like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (language == 'de') {\n          \n          \n            \n                  Engage.log('Tab:Downloads: Chosing german translations');\n          \n          \n            \n                  jsonstr += 'language/de.json';\n          \n          \n            \n                } else { // No other languages supported, yet\n          \n          \n            \n                  Engage.log('Tab:Downloads: Chosing english translations');\n          \n          \n            \n                  jsonstr += 'language/en.json';\n          \n          \n            \n                }\n          \n          \n            \n                Engage.log('Tab:Downloads: Chosing ' + language + ' translations');\n          \n          \n            \n                jsonstr += 'language/' + language + '.json';", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r467042361", "createdAt": "2020-08-07T13:32:41Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/main/resources/static/main.js", "diffHunk": "@@ -0,0 +1,216 @@\n+/**\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ *\n+ * The Apereo Foundation licenses this file to you under the Educational\n+ * Community License, Version 2.0 (the \"License\"); you may not use this file\n+ * except in compliance with the License. You may obtain a copy of the License\n+ * at:\n+ *\n+ *   http://opensource.org/licenses/ecl2.txt\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ *\n+ */\n+/*jslint browser: true, nomen: true*/\n+/*global define*/\n+/*global require*/\n+define(['jquery', 'underscore', 'backbone', 'engage/core'], function ($, _, Backbone, Engage) {\n+  'use strict';\n+\n+  var insertIntoDOM = false;\n+  var PLUGIN_NAME = 'Downloads';\n+  var PLUGIN_TYPE = 'engage_tab';\n+  var PLUGIN_VERSION = '1.0';\n+  var PLUGIN_TEMPLATE_DESKTOP = 'templates/desktop.html';\n+  var PLUGIN_STYLES_DESKTOP = [\n+    'styles/desktop.css'\n+  ];\n+\n+  var isDesktopMode = Engage.model.get('mode') === 'desktop';\n+\n+  // The following code block contains the logic for the download tab in the theodul player.\n+  // The download tab should only be displayed if it's explicitly allowed in the 'config.yml' file and\n+  // when the user has a role that matches a specific regex. The regex is also configured in the 'config.yml'.\n+  const video_download_allowed = Engage.model.get('meInfo').get('allow_video_download');\n+  if (video_download_allowed) {\n+    const userRoles = Engage.model.get('meInfo').get('roles');\n+    const roleRegex = new RegExp(Engage.model.get('meInfo').get('allowed_roles_for_video_download'));\n+    const roleMatches = userRoles.some(function (role) {\n+      return roleRegex.exec(role);\n+    });\n+    if (roleMatches) {\n+      insertIntoDOM = true;\n+    }\n+  }\n+\n+  var events = {\n+    plugin_load_done: new Engage.Event('Core:plugin_load_done', '', 'handler'),\n+    mediaPackageModelError: new Engage.Event('MhConnection:mediaPackageModelError', '', 'handler')\n+  };\n+\n+  var plugin = {\n+    insertIntoDOM: insertIntoDOM,\n+    name: PLUGIN_NAME,\n+    type: PLUGIN_TYPE,\n+    version: PLUGIN_VERSION,\n+    styles: PLUGIN_STYLES_DESKTOP,\n+    template: PLUGIN_TEMPLATE_DESKTOP,\n+    events: events\n+  };\n+\n+  /* don't change these variables */\n+  var viewsModelChange = 'change:views';\n+  var mediapackageChange = 'change:mediaPackage';\n+  var initCount = 4;\n+  var mediapackageError = false;\n+  var translations = new Array();\n+  var Utils;\n+\n+\n+  function initTranslate(language, funcSuccess, funcError) {\n+    var path = Engage.getPluginPath('EngagePluginTabDownloads').replace(/(\\.\\.\\/)/g, '');\n+    var jsonstr = window.location.origin + '/engage/theodul/' + path; // this solution is really bad, fix it...\n+\n+    if (language == 'de') {\n+      Engage.log('Tab:Downloads: Chosing german translations');\n+      jsonstr += 'language/de.json';\n+    } else { // No other languages supported, yet\n+      Engage.log('Tab:Downloads: Chosing english translations');\n+      jsonstr += 'language/en.json';\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bd8ef60f17ff189485169f433a8e4ea6c364314"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA0NTM0MA==", "bodyText": "indentation + don't use tabs. use two spaces.", "url": "https://github.com/opencast/opencast/pull/1719#discussion_r467045340", "createdAt": "2020-08-07T13:37:37Z", "author": {"login": "lkiesow"}, "path": "modules/engage-theodul-plugin-tab-downloads/src/main/resources/static/templates/desktop.html", "diffHunk": "@@ -0,0 +1,47 @@\n+\n+\n+\n+<% if((typeof str_type !== \"undefined\")\n+    && (typeof str_mimetype !== \"undefined\")\n+    && (typeof str_resolution !== \"undefined\")\n+    && (typeof str_download !== \"undefined\")) { %>\n+<div id=\"engage_tab_downloadableVideos_content\">\n+<table class=\"table table-bordered table-hover\">\n+<thead>\n+\t<tr>\n+\t\t<th><%= str_type %></th>\n+\t\t<th><%= str_mimetype %></th>\n+\t\t<th><%= str_resolution %></th>\n+\t\t<th><%= str_download %></th>\n+\t</tr>\n+</thead>\n+\t<tbody>\n+\t<% if(typeof tracks !== \"undefined\" \n+\t\t&& tracks.length !== \"undefined\") { %>\n+\t\t<% _.each(tracks, function(item) { %>\n+\t\t\t<tr>\n+\t\t\t\t<td>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bd8ef60f17ff189485169f433a8e4ea6c364314"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be62ebad5cc19dfb365a5a9182a89dd4216a1057", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/be62ebad5cc19dfb365a5a9182a89dd4216a1057", "committedDate": "2020-08-13T12:30:22Z", "message": "Download button in theodul player"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8bd8ef60f17ff189485169f433a8e4ea6c364314", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/8bd8ef60f17ff189485169f433a8e4ea6c364314", "committedDate": "2020-08-06T15:19:51Z", "message": "Download button in theodul player"}, "afterCommit": {"oid": "be62ebad5cc19dfb365a5a9182a89dd4216a1057", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/be62ebad5cc19dfb365a5a9182a89dd4216a1057", "committedDate": "2020-08-13T12:30:22Z", "message": "Download button in theodul player"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59fab7b7c589eb82e573aca3c75f0e236584bfd0", "author": {"user": null}, "url": "https://github.com/opencast/opencast/commit/59fab7b7c589eb82e573aca3c75f0e236584bfd0", "committedDate": "2020-08-13T12:42:49Z", "message": "Merge branch 'theodul_download_plugin' of https://github.com/marwyg/opencast into theodul_download_plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c63609238a31b6638bc1ad5f5e27f3ac8b679ed", "author": {"user": {"login": "lkiesow", "name": "Lars Kiesow"}}, "url": "https://github.com/opencast/opencast/commit/0c63609238a31b6638bc1ad5f5e27f3ac8b679ed", "committedDate": "2020-09-10T22:27:01Z", "message": "Update JS Dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b224ad0ec58ddd9b5d218b7592fe115a8a8e1b0", "author": {"user": {"login": "lkiesow", "name": "Lars Kiesow"}}, "url": "https://github.com/opencast/opencast/commit/0b224ad0ec58ddd9b5d218b7592fe115a8a8e1b0", "committedDate": "2020-09-10T22:27:37Z", "message": "Remove unused, broken plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e4512f9ad060783589559603c90703b199c95b", "author": {"user": {"login": "lkiesow", "name": "Lars Kiesow"}}, "url": "https://github.com/opencast/opencast/commit/b1e4512f9ad060783589559603c90703b199c95b", "committedDate": "2020-09-10T22:27:53Z", "message": "Java code formatting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1864, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}