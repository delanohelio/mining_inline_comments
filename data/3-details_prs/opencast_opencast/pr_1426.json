{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NDI5MzU1", "number": 1426, "title": "Autodetect browsers for admin ui tests, fix phantomJS openssl issue", "bodyText": "This PR introduces autodetection for the admin ui unit tests.  If no browsers are detected it falls back to PhantomJS, but if a real browser is installed it prefers that.  If multiple browsers are installed it tests with all of them.\nThis PR also resolves the Debian 10 OpenSSL issue, where the config file breaks PhantomJS.  It works around this by setting the config file location to blank, which causes file load warnings/errors, but does not affect the build.\nFixes #1424", "createdAt": "2020-02-21T19:09:16Z", "url": "https://github.com/opencast/opencast/pull/1426", "merged": true, "mergeCommit": {"oid": "21bd1b1c4cebbec2b6618b66a1b0de718aa75771"}, "closed": true, "closedAt": "2020-04-22T06:52:55Z", "author": {"login": "gregorydlogan"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGjGa1gH2gAyMzc4NDI5MzU1OjM4MzEwYzBhZTRlZmI1MDBjODA4NzljYThiZDdmOTkwNzUyNDQ4NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZf-UhgFqTM5NjUwODAzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38310c0ae4efb500c80879ca8bd7f99075244872", "author": {"user": {"login": "gregorydlogan", "name": "Greg Logan"}}, "url": "https://github.com/opencast/opencast/commit/38310c0ae4efb500c80879ca8bd7f99075244872", "committedDate": "2020-02-21T17:23:19Z", "message": "Introduces auto-detection of installed browsers for use in testing the admin UI, falling back to PhantomJS if none are detected.\n\nFixed #1424"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODY4Mjk1", "url": "https://github.com/opencast/opencast/pull/1426#pullrequestreview-362868295", "createdAt": "2020-02-21T19:35:57Z", "commit": {"oid": "38310c0ae4efb500c80879ca8bd7f99075244872"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTozNTo1OFrOFtCTHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo0MzozOVrOFtCgsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2NzkwMA==", "bodyText": "This can be removed, right?", "url": "https://github.com/opencast/opencast/pull/1426#discussion_r382767900", "createdAt": "2020-02-21T19:35:58Z", "author": {"login": "lkiesow"}, "path": "modules/admin-ui/src/test/resources/karma.conf.js", "diffHunk": "@@ -52,14 +52,41 @@ module.exports = function (config) {\n \n         autoWatch : true,\n \n-        frameworks: ['jasmine'],\n+        frameworks: ['detectBrowsers', 'jasmine'],\n \n-        browsers : ['PhantomJS'],\n+        detectBrowsers: {\n+            enabled: true,\n+            usePhantomJS: true,\n+            preferHeadless: true,\n+            // post processing of browsers list\n+            // here you can edit the list of browsers used by karma\n+            postDetection: function(availableBrowsers) {\n+                /* Karma configuration with custom launchers\n+                customLaunchers: {\n+                    IE9: {\n+                        base: 'IE',\n+                        'x-ua-compatible': 'IE=EmulateIE9'\n+                    }\n+                }\n+                */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38310c0ae4efb500c80879ca8bd7f99075244872"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MTM3Ng==", "bodyText": "Since PhantomJS is long since abanfoned, do we want to continue using it? For a lot of the other test dependencies (ffprobe, sox, synfig, \u2026) we just don't run the tests if the dependency is not present and we could do that here as well. That would also make the build system a bit simpler since we don't need to check for special cases and would make things way easier on systems like Alpine Linux.\nThat said, I don't have a very stromg opinion here and if you want to keep it, I won't start a fight ;-P", "url": "https://github.com/opencast/opencast/pull/1426#discussion_r382771376", "createdAt": "2020-02-21T19:43:39Z", "author": {"login": "lkiesow"}, "path": "modules/admin-ui/src/test/resources/karma.conf.js", "diffHunk": "@@ -52,14 +52,41 @@ module.exports = function (config) {\n \n         autoWatch : true,\n \n-        frameworks: ['jasmine'],\n+        frameworks: ['detectBrowsers', 'jasmine'],\n \n-        browsers : ['PhantomJS'],\n+        detectBrowsers: {\n+            enabled: true,\n+            usePhantomJS: true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38310c0ae4efb500c80879ca8bd7f99075244872"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8ab64a123bd87487077ec028f75d9d28b51c840", "author": {"user": {"login": "gregorydlogan", "name": "Greg Logan"}}, "url": "https://github.com/opencast/opencast/commit/e8ab64a123bd87487077ec028f75d9d28b51c840", "committedDate": "2020-02-24T15:57:01Z", "message": "1424: Removing PhantomJS support, and adding hard dependency on a browser for developers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92d53c474d72bbd867828f83c54ab72929e4e3a8", "author": {"user": {"login": "gregorydlogan", "name": "Greg Logan"}}, "url": "https://github.com/opencast/opencast/commit/92d53c474d72bbd867828f83c54ab72929e4e3a8", "committedDate": "2020-03-05T22:04:56Z", "message": "1424: Detecting that *no* browsers are installed and failing the build, rather than hanging.  It does not appear to be possible to skip the tests at this point."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e927e5378a2f25a2348c9aadff53527ae6269f6a", "author": {"user": {"login": "gregorydlogan", "name": "Greg Logan"}}, "url": "https://github.com/opencast/opencast/commit/e927e5378a2f25a2348c9aadff53527ae6269f6a", "committedDate": "2020-03-06T16:50:34Z", "message": "Adding Safari support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35cb8fde10e3c4e0e1f0eb764b1e50732573436c", "author": {"user": {"login": "gregorydlogan", "name": "Greg Logan"}}, "url": "https://github.com/opencast/opencast/commit/35cb8fde10e3c4e0e1f0eb764b1e50732573436c", "committedDate": "2020-03-10T14:10:47Z", "message": "Removing explicit plugins so that detect-browsers can detect and load plugins as needed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NzQ4NjYy", "url": "https://github.com/opencast/opencast/pull/1426#pullrequestreview-389748662", "createdAt": "2020-04-08T08:16:11Z", "commit": {"oid": "35cb8fde10e3c4e0e1f0eb764b1e50732573436c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwODoxNjozMlrOGCkB8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwODozMTozOVrOGCkmAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM0MDY1OQ==", "bodyText": "We're no longer using PhantomJS, right? So this can be removed?", "url": "https://github.com/opencast/opencast/pull/1426#discussion_r405340659", "createdAt": "2020-04-08T08:16:32Z", "author": {"login": "KatrinIhler"}, "path": "modules/admin-ui/Gruntfile.js", "diffHunk": "@@ -1,6 +1,10 @@\n // Generated on 2016-03-07 using generator-angular 0.15.1\n 'use strict';\n \n+// Prevents Debian 10 (at least) from erroring out if PhantomJS is being used\n+// Appears to be related to something in the config file, but we can't exactly ship our own config\n+process.env.OPENSSL_CONF='';\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35cb8fde10e3c4e0e1f0eb764b1e50732573436c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM0OTExMQ==", "bodyText": "So we don't know exactly which browsers work and which don't, right?", "url": "https://github.com/opencast/opencast/pull/1426#discussion_r405349111", "createdAt": "2020-04-08T08:30:26Z", "author": {"login": "KatrinIhler"}, "path": "docs/guides/developer/docs/installation/source-linux.md", "diffHunk": "@@ -25,6 +25,7 @@ Required:\n     ffmpeg >= 3.2.4\n     maven >= 3.1\n     python >= 2.6, < 3.0\n+    firefox/chrome/some other major browser", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35cb8fde10e3c4e0e1f0eb764b1e50732573436c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM0OTM4Mw==", "bodyText": "Since the plugin list was removed, does this still have to be here?", "url": "https://github.com/opencast/opencast/pull/1426#discussion_r405349383", "createdAt": "2020-04-08T08:30:52Z", "author": {"login": "KatrinIhler"}, "path": "modules/admin-ui/package.json", "diffHunk": "@@ -36,11 +36,11 @@\n     \"karma\": \"^4.1.0\",\n     \"karma-chrome-launcher\": \"^2.2.0\",\n     \"karma-coverage\": \"^1.1.2\",\n+    \"karma-detect-browsers\": \"^2.0\",\n     \"karma-firefox-launcher\": \"^1.1.0\",\n     \"karma-jasmine\": \"^1.1.2\",\n     \"karma-ng-html2js-preprocessor\": \"^1.0.0\",\n-    \"karma-phantomjs-launcher\": \"^1.0.4\",\n-    \"phantomjs-prebuilt\": \"^2.1.16\",\n+    \"karma-safari-launcher\": \"^1.0.0\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35cb8fde10e3c4e0e1f0eb764b1e50732573436c"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM0OTg5MA==", "bodyText": "Same question as below.", "url": "https://github.com/opencast/opencast/pull/1426#discussion_r405349890", "createdAt": "2020-04-08T08:31:39Z", "author": {"login": "KatrinIhler"}, "path": "modules/admin-ui/package-lock.json", "diffHunk": "@@ -4506,20 +4493,10 @@\n       \"integrity\": \"sha1-ENjIz6pBNvHIp22RpMvO7evsSjE=\",\n       \"dev\": true\n     },\n-    \"karma-phantomjs-launcher\": {\n-      \"version\": \"1.0.4\",\n-      \"resolved\": \"https://registry.npmjs.org/karma-phantomjs-launcher/-/karma-phantomjs-launcher-1.0.4.tgz\",\n-      \"integrity\": \"sha1-0jyjSAG9qYY60xjju0vUBisTrNI=\",\n-      \"dev\": true,\n-      \"requires\": {\n-        \"lodash\": \"^4.0.1\",\n-        \"phantomjs-prebuilt\": \"^2.1.7\"\n-      }\n-    },\n-    \"kew\": {\n-      \"version\": \"0.7.0\",\n-      \"resolved\": \"https://registry.npmjs.org/kew/-/kew-0.7.0.tgz\",\n-      \"integrity\": \"sha1-edk9LTM2PW/dKXCzNdkUGtWR15s=\",\n+    \"karma-safari-launcher\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35cb8fde10e3c4e0e1f0eb764b1e50732573436c"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "339817147ad97cccca07f5bbc492bedb56348f64", "author": {"user": {"login": "gregorydlogan", "name": "Greg Logan"}}, "url": "https://github.com/opencast/opencast/commit/339817147ad97cccca07f5bbc492bedb56348f64", "committedDate": "2020-04-09T19:40:45Z", "message": "Removing bits to support Phantom on Deb10 since we no longer use Phantom"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTA4MDM4", "url": "https://github.com/opencast/opencast/pull/1426#pullrequestreview-396508038", "createdAt": "2020-04-20T14:29:19Z", "commit": {"oid": "339817147ad97cccca07f5bbc492bedb56348f64"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1908, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}