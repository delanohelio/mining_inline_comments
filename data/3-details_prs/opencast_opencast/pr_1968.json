{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0MzkyNTMx", "number": 1968, "title": "Allow addMediaPackage to Accept ACLs", "bodyText": "This patch allows the single request ingest to accept access control\nlists:\ncurl http://localhost:8080/ingest/addMediaPackage/fast \\\n  -u admin:opencast \\\n  -F 'flavor=presentation/source' \\\n  -F 'BODY=@sintel_trailer-1080p.mp4' \\\n  -F title=test \\\n  -F acl='{\"acl\": {\"ace\": [\n      {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"read\"},\n      {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"write\"},\n      {\"allow\": true,\"role\": \"ROLE_USER\",\"action\": \"read\"}]}}'\n\nYour pull request should\u2026\n\n have a concise title\n close an accompanying issue if one exists\n be against the correct branch (features can only go into develop)\n include migration scripts and documentation, if appropriate\n pass automated testing\n have a clean commit history\n have proper commit messages (title and body) for all commits\n have appropriate tags applied", "createdAt": "2020-10-15T21:16:28Z", "url": "https://github.com/opencast/opencast/pull/1968", "merged": true, "mergeCommit": {"oid": "a9f5c961bd2886e6283a895d7d0843b9fccf5da2"}, "closed": true, "closedAt": "2020-11-17T19:16:42Z", "author": {"login": "lkiesow"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdS465MgH2gAyNTA0MzkyNTMxOjNlZjcyMDVmOTMwYTBlMjI4ZjQxZjQ0NjE4YjllYmI0MjQ2ZjZlMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddarQUgFqTUzMjQzNDI0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08", "author": {"user": {"login": "lkiesow", "name": "Lars Kiesow"}}, "url": "https://github.com/opencast/opencast/commit/3ef7205f930a0e228f41f44618b9ebb4246f6e08", "committedDate": "2020-10-15T21:46:53Z", "message": "Allow addMediaPackage to Accept ACLs\n\nThis patch allows the single request ingest to accept access control\nlists:\n\n    curl http://localhost:8080/ingest/addMediaPackage/fast \\\n      -u admin:opencast \\\n      -F 'flavor=presentation/source' \\\n      -F 'BODY=@sintel_trailer-1080p.mp4' \\\n      -F title=test \\\n      -F acl='{\"acl\": {\"ace\": [\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"read\"},\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"write\"},\n          {\"allow\": true,\"role\": \"ROLE_USER\",\"action\": \"read\"}]}}'"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5cf70aec1dff342f6d6fd0eceab2af7f155e5d2", "author": {"user": {"login": "lkiesow", "name": "Lars Kiesow"}}, "url": "https://github.com/opencast/opencast/commit/e5cf70aec1dff342f6d6fd0eceab2af7f155e5d2", "committedDate": "2020-10-15T21:11:25Z", "message": "Allow addMediaPackage to Accept ACLs\n\nThis patch allows the single request ingest to accept access control\nlists:\n\n    curl http://localhost:8080/ingest/addMediaPackage/fast \\\n      -u admin:opencast \\\n      -F 'flavor=presentation/source' \\\n      -F 'BODY=@sintel_trailer-1080p.mp4' \\\n      -F title=test \\\n      -F acl='{\"acl\": {\"ace\": [\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"read\"},\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"write\"},\n          {\"allow\": true,\"role\": \"ROLE_USER\",\"action\": \"read\"}]}}'"}, "afterCommit": {"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08", "author": {"user": {"login": "lkiesow", "name": "Lars Kiesow"}}, "url": "https://github.com/opencast/opencast/commit/3ef7205f930a0e228f41f44618b9ebb4246f6e08", "committedDate": "2020-10-15T21:46:53Z", "message": "Allow addMediaPackage to Accept ACLs\n\nThis patch allows the single request ingest to accept access control\nlists:\n\n    curl http://localhost:8080/ingest/addMediaPackage/fast \\\n      -u admin:opencast \\\n      -F 'flavor=presentation/source' \\\n      -F 'BODY=@sintel_trailer-1080p.mp4' \\\n      -F title=test \\\n      -F acl='{\"acl\": {\"ace\": [\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"read\"},\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"write\"},\n          {\"allow\": true,\"role\": \"ROLE_USER\",\"action\": \"read\"}]}}'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDMzNTIy", "url": "https://github.com/opencast/opencast/pull/1968#pullrequestreview-532433522", "createdAt": "2020-11-17T14:44:21Z", "commit": {"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NDoyMVrOH04LTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NDoyMVrOH04LTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwODM5OA==", "bodyText": "maybe a variable, longer then two chars would be nice? \"inputstream\"", "url": "https://github.com/opencast/opencast/pull/1968#discussion_r525208398", "createdAt": "2020-11-17T14:44:21Z", "author": {"login": "CGreweling"}, "path": "modules/ingest-service-impl/src/main/java/org/opencastproject/ingest/endpoint/IngestRestService.java", "diffHunk": "@@ -796,6 +804,19 @@ public Response addMediaPackage(@Context HttpServletRequest request, @PathParam(\n               InputStream is = new ByteArrayInputStream(value.getBytes(\"UTF-8\"));\n               ingestService.addCatalog(is, fileName, MediaPackageElements.SERIES, mp);\n \n+              // Add ACL in JSON, XML or XACML format\n+            } else if (\"acl\".equals(fieldName)) {\n+              InputStream is = new ByteArrayInputStream(value.getBytes(StandardCharsets.UTF_8));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDM0MjQ4", "url": "https://github.com/opencast/opencast/pull/1968#pullrequestreview-532434248", "createdAt": "2020-11-17T14:45:02Z", "commit": {"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NTowMlrOH04NqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo0NTowMlrOH04NqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwOTAwMA==", "bodyText": "logger.debug would be nice here. instead of a comentar in the code", "url": "https://github.com/opencast/opencast/pull/1968#discussion_r525209000", "createdAt": "2020-11-17T14:45:02Z", "author": {"login": "CGreweling"}, "path": "modules/ingest-service-impl/src/main/java/org/opencastproject/ingest/endpoint/IngestRestService.java", "diffHunk": "@@ -796,6 +804,19 @@ public Response addMediaPackage(@Context HttpServletRequest request, @PathParam(\n               InputStream is = new ByteArrayInputStream(value.getBytes(\"UTF-8\"));\n               ingestService.addCatalog(is, fileName, MediaPackageElements.SERIES, mp);\n \n+              // Add ACL in JSON, XML or XACML format\n+            } else if (\"acl\".equals(fieldName)) {\n+              InputStream is = new ByteArrayInputStream(value.getBytes(StandardCharsets.UTF_8));\n+              AccessControlList acl;\n+              try {\n+                acl = AccessControlParser.parseAcl(is);\n+                is = new ByteArrayInputStream(XACMLUtils.getXacml(mp, acl).getBytes(StandardCharsets.UTF_8));\n+              } catch (AccessControlParsingException e) {\n+                // Couldn't parse this \u2192 already XACML. Why again are we using three different formats?\n+                is.reset();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1787, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}