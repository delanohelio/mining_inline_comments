{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMTkyNzU5", "number": 2166, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjowOToxNlrOFMr59Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjoxMzoxMVrOFMr8-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4ODQ2NTgxOnYy", "diffSide": "RIGHT", "path": "docs/guides/admin/docs/configuration/firewall.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjowOToxNlrOIQi-TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjowOToxNlrOIQi-TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMTEzMg==", "bodyText": "Elasticsearch", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554221132", "createdAt": "2021-01-08T22:09:16Z", "author": {"login": "gregorydlogan"}, "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.\n+- Opencast nodes communicate among each other via HTTP(S)\n+- Often Elasticsaecrh and ActiveMQ are run on the admin node since most communication then happens on the server", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4ODQ2ODY0OnYy", "diffSide": "RIGHT", "path": "docs/guides/admin/docs/configuration/firewall.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjoxMDo0M1rOIQjAMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjoxMDo0M1rOIQjAMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMTYxNg==", "bodyText": "network storage access perhaps?  Something to make it clear that something like NFS is required.", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554221616", "createdAt": "2021-01-08T22:10:43Z", "author": {"login": "gregorydlogan"}, "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.\n+- Opencast nodes communicate among each other via HTTP(S)\n+- Often Elasticsaecrh and ActiveMQ are run on the admin node since most communication then happens on the server\n+    - The admin node communicates with Elasticsaecrh exclusively\n+    - Some messages are sent to ActiveMQ from other nodes\n+- All servers should get storage access", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4ODQ3MTMxOnYy", "diffSide": "RIGHT", "path": "docs/guides/admin/docs/configuration/firewall.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjoxMjowM1rOIQjB8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjoxMjowM1rOIQjB8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMjA2Ng==", "bodyText": "Allow all nodes access to the storage infrastructure ?\nI get that you're deliberately excluding other services (cf SSH), but I can see how people might be confused here if we don't mention it.", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554222066", "createdAt": "2021-01-08T22:12:03Z", "author": {"login": "gregorydlogan"}, "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.\n+- Opencast nodes communicate among each other via HTTP(S)\n+- Often Elasticsaecrh and ActiveMQ are run on the admin node since most communication then happens on the server\n+    - The admin node communicates with Elasticsaecrh exclusively\n+    - Some messages are sent to ActiveMQ from other nodes\n+- All servers should get storage access\n+- All Opencast nodes need database access\n+\n+A visual representation of the communication within a three-node cluster will look like this:\n+\n+```graphviz dot network.png\n+digraph G {\n+  user[label = \"User\"];\n+  activemq[label = \"ActiveMQ\"];\n+  oc1[label = \"Opencast Admin\"];\n+  oc2[label = \"Opencast Worker\"];\n+  oc3[label = \"Opencast Presentation\"];\n+  db[label = \"Database\"];\n+  es[label = \"Elasticsearch\"];\n+  storage[label = \"Storage\"];\n+  ca[label = \"Capture Agent\"];\n+\n+  user -> oc1 [label = \"80, 443\"];\n+  user -> oc2 [style = \"dashed\", label = \"80\u00b9, 443\u00b9\"];\n+  user -> oc3 [label = \"80, 443\"];\n+  oc1 -> oc2 [dir = \"both\", label = \"80, 443\"];\n+  oc2 -> oc3 [dir = \"both\", label = \"80, 443\"];\n+  oc3 -> oc1 [dir = \"both\", label = \"80, 443\"];\n+  oc1 -> db [label = \"3306\u00b2\"];\n+  oc2 -> db [label = \"3306\u00b2\"];\n+  oc3 -> db [label = \"3306\u00b2\"];\n+  oc1 -> activemq [label = \"61616\"];\n+  oc2 -> activemq [label = \"61616\"];\n+  oc3 -> activemq [label = \"61616\"];\n+  oc1 -> es[label = \"9300\"];\n+  oc1 -> storage;\n+  oc2 -> storage;\n+  oc3 -> storage;\n+  ca -> oc1[label = \"80, 443\"];\n+}\n+```\n+\n+Notes:\n+\n+- _The numbers in the diagram describe TCP ports_\n+- _\u00b9) Communication between users and workers if often not necessary_\n+- _\u00b2) If you use a database other than MariaDB, the port may differ_\n+\n+\n+Suggested Firewall Configurations\n+---------------------------------\n+\n+Note that none of these instructions take additional services like SSH into account.\n+They are focused just on what Opencast needs for communication.\n+\n+\n+### Simple\n+\n+For a very simple configuration catching most of the important attack vectors, implement the following firewall rules:\n+\n+1. Allow HTTP and HTTPS to all Opencast nodes from the outside\n+2. Allow all TCP communication within the cluster\n+\n+\n+### Complex\n+\n+If you want a more complex, stricter set of rules:\n+\n+1. Allow external HTTP and HTTPS communication to admin, presentation and possibly ingest\n+2. Allow all Opencast nodes to access ActiveMQ and the database\n+3. Allow the admin node to access Elasticsearch", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4ODQ3MzU1OnYy", "diffSide": "RIGHT", "path": "docs/guides/admin/docs/configuration/firewall.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjoxMzoxMVrOIQjDXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQyMjoxMzoxMVrOIQjDXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIyMjQzMA==", "bodyText": "This is the only item with periods.  The lines in the diagram are already directional, maybe omit the last sentence.  Or add periods to all of them :)", "url": "https://github.com/opencast/opencast/pull/2166#discussion_r554222430", "createdAt": "2021-01-08T22:13:11Z", "author": {"login": "gregorydlogan"}, "path": "docs/guides/admin/docs/configuration/firewall.md", "diffHunk": "@@ -0,0 +1,83 @@\n+Firewall\n+========\n+\n+Opencast relies on a lot of network communication and although not strictly necessary,\n+it usually makes sense to configure a firewall for additional protection\n+\n+This describes a lot of the communication happening between servers in the most common use cases.\n+In certain set-ups and with certain types of integrations, these may deviate slightly.\n+\n+General rules are:\n+\n+- Users communicate with Opencast via HTTP(S)\n+- Capture agents communicate with Opencast via HTTP(S). All communication is established by the agent.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e603455ecd2c10b1e771cadb8e4f14ca705d7b83"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3083, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}