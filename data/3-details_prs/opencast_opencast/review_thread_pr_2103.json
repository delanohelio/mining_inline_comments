{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3OTUxMjA1", "number": 2103, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOFQyMToyMTozNVrOFnw1VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOFQyMToyNzowNlrOFnw8dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc3MjM4ODY4OnYy", "diffSide": "RIGHT", "path": "modules/security-lti/src/main/java/org/opencastproject/security/lti/LtiLaunchAuthenticationHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOFQyMToyMTozNVrOI5lSoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNVQxMTo0MDoyNFrOJJjOOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzI1MDcyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /** Contains the LTI roles where a JpaUserReference shall be created. The default is 'instructor'. */\n          \n          \n            \n              /** LTI roles a user must have so a JpaUserReference is created. */", "url": "https://github.com/opencast/opencast/pull/2103#discussion_r597250720", "createdAt": "2021-03-18T21:21:35Z", "author": {"login": "lkiesow"}, "path": "modules/security-lti/src/main/java/org/opencastproject/security/lti/LtiLaunchAuthenticationHandler.java", "diffHunk": "@@ -160,8 +162,8 @@\n   /** concurrent attemtps */\n   private Map<String, Boolean> activePersistenceTransactions = new ConcurrentHashMap<>(128);\n \n-  /** Determines whether a JpaUserReference should be created on lti login */\n-  private boolean createJpaUserReference = true;\n+  /** Contains the LTI roles where a JpaUserReference shall be created. The default is 'instructor'. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503a0df7c11fee93592dce01ae8deff740c95519"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk5NDA0MA==", "bodyText": "The key \"createJpaUserReference\" is included again (default true).", "url": "https://github.com/opencast/opencast/pull/2103#discussion_r613994040", "createdAt": "2021-04-15T11:40:24Z", "author": {"login": "marwyg"}, "path": "modules/security-lti/src/main/java/org/opencastproject/security/lti/LtiLaunchAuthenticationHandler.java", "diffHunk": "@@ -160,8 +162,8 @@\n   /** concurrent attemtps */\n   private Map<String, Boolean> activePersistenceTransactions = new ConcurrentHashMap<>(128);\n \n-  /** Determines whether a JpaUserReference should be created on lti login */\n-  private boolean createJpaUserReference = true;\n+  /** Contains the LTI roles where a JpaUserReference shall be created. The default is 'instructor'. */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzI1MDcyMA=="}, "originalCommit": {"oid": "503a0df7c11fee93592dce01ae8deff740c95519"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc3MjM5NzYxOnYy", "diffSide": "RIGHT", "path": "etc/org.opencastproject.security.lti.LtiLaunchAuthenticationHandler.cfg", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOFQyMToyNDoxMFrOI5lYLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOFQyMToyNDoxMFrOI5lYLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzI1MjE0MA==", "bodyText": "Setting a default should be unnecessary:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            lti.create_jpa_user_reference.roles = *\n          \n          \n            \n            #lti.create_jpa_user_reference.roles = *", "url": "https://github.com/opencast/opencast/pull/2103#discussion_r597252140", "createdAt": "2021-03-18T21:24:10Z", "author": {"login": "lkiesow"}, "path": "etc/org.opencastproject.security.lti.LtiLaunchAuthenticationHandler.cfg", "diffHunk": "@@ -48,12 +48,23 @@\n # Default: no blacklisted users\n #lti.blacklist.user.1=\n \n-# Determines whether a JpaUserReference should be created on LTI User Login.\n-#\n-# This persists the LTI Users in the database, giving them the ability to create long running tasks like ingesting a video.\n-#\n-# Default: true\n-#lti.create_jpa_user_reference=true\n+# Determines if a user reference should be persisted in the database on LTI user logins.\n+# Persisting references gives the users the ability to create long running tasks like ingesting a video.\n+# The value can be a list of LTI roles identifying users to be persisted or the special value * causing all users to be persisted.\n+# The value is not case sensitive.\n+#\n+# Examples:\n+#  - Persist only instructors:\n+#    lti.create_jpa_user_reference = instructor\n+#  - Persist only instructors and administrators:\n+#    lti.create_jpa_user_reference.roles = instructor, administrator\n+#  - Persist all users:\n+#    lti.create_jpa_user_reference.roles = *\n+#  - No persistence:\n+#    lti.create_jpa_user_reference.roles =\n+#\n+# Default: *\n+lti.create_jpa_user_reference.roles = *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503a0df7c11fee93592dce01ae8deff740c95519"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzc3MjQwNjk0OnYy", "diffSide": "RIGHT", "path": "modules/security-lti/src/main/java/org/opencastproject/security/lti/LtiLaunchAuthenticationHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xOFQyMToyNzowNlrOI5leEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNVQxMTo0MTo0NlrOJJjROA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzI1MzY0OQ==", "bodyText": "Actually set the default you claim to set:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                ltiRolesForUserCreation = extractLtiRolesForUserCreation(\n          \n          \n            \n                        (String) properties.get(LTI_ROLES_TO_CREATE_JPA_USER_REFERENCES_FROM));\n          \n          \n            \n                ltiRolesForUserCreation = extractLtiRolesForUserCreation(\n          \n          \n            \n                        Objects.toString(properties.get(LTI_ROLES_TO_CREATE_JPA_USER_REFERENCES_FROM), \"*\");", "url": "https://github.com/opencast/opencast/pull/2103#discussion_r597253649", "createdAt": "2021-03-18T21:27:06Z", "author": {"login": "lkiesow"}, "path": "modules/security-lti/src/main/java/org/opencastproject/security/lti/LtiLaunchAuthenticationHandler.java", "diffHunk": "@@ -237,9 +239,8 @@ protected void activate(ComponentContext cc) {\n       usernameBlacklist.add(username);\n     }\n \n-    createJpaUserReference = BooleanUtils.toBooleanDefaultIfNull(\n-      BooleanUtils.toBooleanObject(StringUtils.trimToNull((String) properties.get(CREATE_JPA_USER_REFERENCE_KEY))),\n-      true);\n+    ltiRolesForUserCreation = extractLtiRolesForUserCreation(\n+            (String) properties.get(LTI_ROLES_TO_CREATE_JPA_USER_REFERENCES_FROM));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503a0df7c11fee93592dce01ae8deff740c95519"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMzk5NDgwOA==", "bodyText": "The default (*) is set programmatically now.", "url": "https://github.com/opencast/opencast/pull/2103#discussion_r613994808", "createdAt": "2021-04-15T11:41:46Z", "author": {"login": "marwyg"}, "path": "modules/security-lti/src/main/java/org/opencastproject/security/lti/LtiLaunchAuthenticationHandler.java", "diffHunk": "@@ -237,9 +239,8 @@ protected void activate(ComponentContext cc) {\n       usernameBlacklist.add(username);\n     }\n \n-    createJpaUserReference = BooleanUtils.toBooleanDefaultIfNull(\n-      BooleanUtils.toBooleanObject(StringUtils.trimToNull((String) properties.get(CREATE_JPA_USER_REFERENCE_KEY))),\n-      true);\n+    ltiRolesForUserCreation = extractLtiRolesForUserCreation(\n+            (String) properties.get(LTI_ROLES_TO_CREATE_JPA_USER_REFERENCES_FROM));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NzI1MzY0OQ=="}, "originalCommit": {"oid": "503a0df7c11fee93592dce01ae8deff740c95519"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3117, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}