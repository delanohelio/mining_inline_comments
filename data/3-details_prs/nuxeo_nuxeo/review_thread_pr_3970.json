{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NTIyNjE3", "number": 3970, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNjozNVrOD7iZWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTowMjozNFrOD-H-DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzU2MTIzOnYy", "diffSide": "RIGHT", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNjozNVrOGT65vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNjozNVrOGT65vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MTE4Mg==", "bodyText": "We should enable compact for a production configuration which is the intent of this file.\nFurthemore, I think eventEol should be enable too in order to have one log per line.\ncomplete looks like a debug option to me and shouldn't be changed:\n\nIf true, the appender includes the JSON header and footer, and comma between records. Defaults to false.", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423541182", "createdAt": "2020-05-12T08:06:35Z", "author": {"login": "kevinleturc"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,208 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout complete=\"false\" compact=\"false\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzU2MzYwOnYy", "diffSide": "RIGHT", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNzoxMVrOGT67Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNzoxMVrOGT67Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MTU1OQ==", "bodyText": "This appender is not defined.", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423541559", "createdAt": "2020-05-12T08:07:11Z", "author": {"login": "kevinleturc"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,208 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout complete=\"false\" compact=\"false\"/>\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzU2Mzg3OnYy", "diffSide": "RIGHT", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNzoxNVrOGT67WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNzoxNVrOGT67WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MTU5Mg==", "bodyText": "This appender is not defined.", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423541592", "createdAt": "2020-05-12T08:07:15Z", "author": {"login": "kevinleturc"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,208 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout complete=\"false\" compact=\"false\"/>\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />\n+    </Logger>\n+    <Logger name=\"org.apache.catalina.core.AprLifecycleListener\" level=\"info\" additivity=\"false\">\n+      <AppenderRef ref=\"TOMCAT\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzU2ODgzOnYy", "diffSide": "RIGHT", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker/lib/log4j2.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowODozMlrOGT6-fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowODozMlrOGT6-fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MjM5OA==", "bodyText": "Appender not defined", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423542398", "createdAt": "2020-05-12T08:08:32Z", "author": {"login": "kevinleturc"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,209 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"CONSOLE\" target=\"SYSTEM_OUT\">\n+      <ThresholdFilter level=\"INFO\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%c{1}] %m%n\" />\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c"}, "originalPosition": 139}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzU2OTQwOnYy", "diffSide": "RIGHT", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker/lib/log4j2.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowODo0MVrOGT6-0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowODo0MVrOGT6-0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MjQ4Mw==", "bodyText": "Appender not defined.", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423542483", "createdAt": "2020-05-12T08:08:41Z", "author": {"login": "kevinleturc"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,209 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"CONSOLE\" target=\"SYSTEM_OUT\">\n+      <ThresholdFilter level=\"INFO\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%c{1}] %m%n\" />\n+    </Console>\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <File name=\"CLUSTER\" fileName=\"${sys:nuxeo.log.dir}/cluster.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <File name=\"STORAGE\" fileName=\"${sys:nuxeo.log.dir}/storage.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+    <!-- Elasticsearch logging -->\n+    <!--\n+    <File name=\"ELASTIC\" fileName=\"${sys:nuxeo.log.dir}/elastic.log\" append=\"false\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+    </File>\n+    -->\n+\n+    <!-- ====================== -->\n+    <!-- More Appender examples -->\n+    <!-- ====================== -->\n+\n+    <!-- Automation Trace appender - add ref into automation.core category\n+    <RollingFile name=\"AUTOMATION\" fileName=\"${sys:nuxeo.log.dir}/automation.log\"\n+                 filePattern=\"${sys:nuxeo.log.dir}/automation-%d{yyyy-MM-dd}.log.gz\" append=\"true\">\n+      <PatternLayout pattern=\"%d{ISO8601} %-5p [%t] [%c] %m%n\" />\n+      <CronTriggeringPolicy schedule=\"0 0 0 * * ?\" evaluateOnStartup=\"true\" />\n+      <DefaultRolloverStrategy />\n+    </RollingFile>\n+    -->\n+\n+    <!-- Buffer events and log them asynchronously\n+    <Async name=\"ASYNC\" >\n+      <AppenderRef ref=\"FILE\" />\n+      <AppenderRef ref=\"CONSOLE\" />\n+      <AppenderRef ref=\"SMTP\" />\n+    </Async>\n+    -->\n+\n+    <!-- EMail events to an administrator\n+    <SMTP name=\"SMTP\" subject=\"Tomcat Server Errors\" to=\"admin@myhost.domain.com\" from=\"nobody@myhost.domain.com\"\n+          smtpHost=\"localhost\" smtpPort=\"25\" bufferSize=\"10\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </SMTP>\n+    -->\n+\n+    <!-- Syslog events\n+    <Syslog name=\"SYSLOG\" host=\"localhost\" facility=\"LOCAL7\">\n+      <PatternLayout pattern=\"[%d{ABSOLUTE},%c{1}] %m%n\" />\n+    </Syslog>\n+    -->\n+    <!-- Log events to JMS (requires a topic to be created)\n+    <JMS name=\"JMS\" destinationBindingName=\"topic/MyErrorsTopic\" factoryBindingName=\"java:/ConnectionFactory\">\n+      <ThresholdFilter level=\"ERROR\" onMatch=\"ACCEPT\" />\n+    </JMS>\n+    -->\n+  </Appenders>\n+  <Loggers>\n+    <!-- ============= -->\n+    <!-- Nuxeo Loggers -->\n+    <!-- ============= -->\n+\n+    <Logger name=\"org.nuxeo\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.core.storage.dbs.DBSCachingRepository\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.ElasticSearchComponent\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditBackend\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.elasticsearch.audit.ESAuditMigrationWork\" level=\"warn\" />\n+    <Logger name=\"org.nuxeo.ecm.platform.query.core.PageProviderClassReplacerRegistry\" level=\"warn\" />\n+\n+    <!-- Uncomment to debug fragments pre-processing\n+    <Logger name=\"org.nuxeo.runtime.deployment.preprocessor\" level=\"info\" />\n+    -->\n+    <!-- Uncomment to debug SQL statements\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" />\n+    -->\n+    <!-- Uncomment to debug concurrent session execution errors on thread\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.SessionImpl\" level=\"debug\" />\n+    -->\n+    <!-- Display INFO logs for automation traces when activated -->\n+    <!-- Add <appender-ref ref=\"AUTOMATION\" /> if using AUTOMATION appender-->\n+    <Logger name=\"org.nuxeo.ecm.automation.core\" level=\"warn\" />\n+    <!-- Display by default WARN logs for Automation Scripting -->\n+    <Logger name=\"org.nuxeo.ecm.automation.scripting\" level=\"warn\" />\n+\n+    <Logger name=\"org.nuxeo.runtime.reload\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.osgi.OSGiRuntimeService\" level=\"info\" />\n+    <!-- Uncomment for components registration info\n+    <Logger name=\"org.nuxeo.runtime.model.impl\" level=\"info\" />\n+    -->\n+    <Logger name=\"org.nuxeo.osgi.application.loader.FrameworkLoader\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.StandaloneApplication\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.osgi.application.FrameworkBootstrap\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.jboss.deployment.NuxeoDeployer\" level=\"info\" />\n+    <Logger name=\"org.nuxeo.runtime.tomcat.NuxeoDeployer\" level=\"info\" />\n+\n+    <!-- Clustering logging -->\n+    <!-- Uncomment the following to redirect the org.jgroups and org.jboss.ha categories to a cluster.log file.\n+    <Logger name=\"org.jgroups\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    <Logger name=\"org.jboss.ha\" level=\"debug\" additivity=\"false\">\n+      <AppenderRef ref=\"CLUSTER\" />\n+    </Logger>\n+    -->\n+    <!-- VCS Storage logging -->\n+    <!--\n+    <Logger name=\"org.nuxeo.ecm.core.management.jtajca\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    <Logger name=\"org.nuxeo.ecm.core.storage.sql.jdbc\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"STORAGE\" />\n+    </Logger>\n+    -->\n+    <!--\n+    <Logger name=\"org.nuxeo.elasticsearch\" level=\"trace\" additivity=\"false\">\n+      <AppenderRef ref=\"ELASTIC\" />\n+    </Logger>\n+    -->\n+\n+    <!-- =================== -->\n+    <!-- Third Party Loggers -->\n+    <!-- =================== -->\n+    <Logger name=\"org.apache.catalina.loader\" level=\"warn\" additivity=\"false\">\n+      <AppenderRef ref=\"CLASSLOADER\" />\n+    </Logger>\n+    <Logger name=\"org.apache.catalina.core.AprLifecycleListener\" level=\"info\" additivity=\"false\">\n+      <AppenderRef ref=\"TOMCAT\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c"}, "originalPosition": 142}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNzU4Mjk3OnYy", "diffSide": "RIGHT", "path": "server/nuxeo-server-tomcat/src/main/assemble/assembly.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODoxMjoyNlrOGT7HlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMDo1NDozMVrOGUBHHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0NDcyNQ==", "bodyText": "The two lines preceding the one you introduced also deals with JSON and was added for NXP-25096.\nThe ticket is mainly about log4j 1 so we should be able to remove these lines.\nNote: Link the given ticket to yours as it is the same topic just a different logging backend.", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423544725", "createdAt": "2020-05-12T08:12:26Z", "author": {"login": "kevinleturc"}, "path": "server/nuxeo-server-tomcat/src/main/assemble/assembly.xml", "diffHunk": "@@ -180,6 +180,8 @@\n         <include name=\"log4j-*\" /> <!-- log4j2 / bridges: jcl, slf4j, log4j -->\n         <include name=\"json-smart-*\" />\n         <include name=\"jsonevent-layout-*\" />\n+        <!-- install log4j2 JSON logging dependencies in container classpath -->\n+        <include name=\"jackson-*\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY0MjkxMA==", "bodyText": "I added it as related to this issue explaining it was config for log4j1", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r423642910", "createdAt": "2020-05-12T10:54:31Z", "author": {"login": "NourNuxeo"}, "path": "server/nuxeo-server-tomcat/src/main/assemble/assembly.xml", "diffHunk": "@@ -180,6 +180,8 @@\n         <include name=\"log4j-*\" /> <!-- log4j2 / bridges: jcl, slf4j, log4j -->\n         <include name=\"json-smart-*\" />\n         <include name=\"jsonevent-layout-*\" />\n+        <!-- install log4j2 JSON logging dependencies in container classpath -->\n+        <include name=\"jackson-*\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0NDcyNQ=="}, "originalCommit": {"oid": "8ef070990bb061b75ef982f084a1ef1b2a19a70c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NDY4ODc3OnYy", "diffSide": "RIGHT", "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTowMjozNFrOGYCHTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTowMjozNFrOGYCHTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg1MzY0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <JsonLayout eventEol=\"true\" compact=\"true\"/>\n          \n          \n            \n                  <JsonLayout eventEol=\"true\" compact=\"true\"/>", "url": "https://github.com/nuxeo/nuxeo/pull/3970#discussion_r427853644", "createdAt": "2020-05-20T09:02:34Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/docker-json/lib/log4j2.xml", "diffHunk": "@@ -0,0 +1,201 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- Log4j Configuration - For more configuration information and examples see https://logging.apache.org/log4j/2.x/ -->\n+<Configuration monitorInterval=\"30\">\n+  <Appenders>\n+    <!-- ============================== -->\n+    <!-- Append messages to the console -->\n+    <!-- ============================== -->\n+    <Console name=\"ConsoleJSONAppender\" target=\"SYSTEM_OUT\">\n+        <JsonLayout eventEol=\"true\" compact=\"true\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a7822f6995c692f9609af94f5a58d79c5c1523d"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4186, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}