{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NTA0NTE3", "number": 4040, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDoyNTo0OFrOD80WRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDo1MzoyN1rOD800lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MDk4ODIyOnYy", "diffSide": "RIGHT", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDoyNTo0OFrOGV_R1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDo1NToyOVrOGWAH0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxMDAzNw==", "bodyText": "Can't a lambda be used here?", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425710037", "createdAt": "2020-05-15T10:25:48Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -196,9 +202,27 @@ protected void storeWindowHandle() {\n     }\n \n     protected void switchToNewWindow() {\n-        for (String winHandle : driver.getWindowHandles()) {\n-            driver.switchTo().window(winHandle);\n+        Wait<WebDriver> wait = Locator.getFluentWait();\n+        wait.until((new Function<WebDriver, Boolean>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3286998dbbb73daf2daeb1f9f75477aa48dec4"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxODM4Mg==", "bodyText": "Maybe, but we need to cleanup these logics in Locator then (where we use this everywhere so i took example on it).\nI can clean this up later if needed.", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425718382", "createdAt": "2020-05-15T10:43:14Z", "author": {"login": "atchertchian"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -196,9 +202,27 @@ protected void storeWindowHandle() {\n     }\n \n     protected void switchToNewWindow() {\n-        for (String winHandle : driver.getWindowHandles()) {\n-            driver.switchTo().window(winHandle);\n+        Wait<WebDriver> wait = Locator.getFluentWait();\n+        wait.until((new Function<WebDriver, Boolean>() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxMDAzNw=="}, "originalCommit": {"oid": "8f3286998dbbb73daf2daeb1f9f75477aa48dec4"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcyMzg1OQ==", "bodyText": "Actually we can't use a lambda as com.google.common.base.Function is not a SAM-type (single abstract method) required for lambda use despite being annotated @FunctionalInterface", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425723859", "createdAt": "2020-05-15T10:55:29Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -196,9 +202,27 @@ protected void storeWindowHandle() {\n     }\n \n     protected void switchToNewWindow() {\n-        for (String winHandle : driver.getWindowHandles()) {\n-            driver.switchTo().window(winHandle);\n+        Wait<WebDriver> wait = Locator.getFluentWait();\n+        wait.until((new Function<WebDriver, Boolean>() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxMDAzNw=="}, "originalCommit": {"oid": "8f3286998dbbb73daf2daeb1f9f75477aa48dec4"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MDk5MjY0OnYy", "diffSide": "RIGHT", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDoyNzoxNFrOGV_Umg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDozNzozOFrOGV_oEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxMDc0Ng==", "bodyText": "Remove debug println", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425710746", "createdAt": "2020-05-15T10:27:14Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -196,9 +202,27 @@ protected void storeWindowHandle() {\n     }\n \n     protected void switchToNewWindow() {\n-        for (String winHandle : driver.getWindowHandles()) {\n-            driver.switchTo().window(winHandle);\n+        Wait<WebDriver> wait = Locator.getFluentWait();\n+        wait.until((new Function<WebDriver, Boolean>() {\n+            @Override\n+            public Boolean apply(WebDriver driver) {\n+                try {\n+                    // wait for one more window to be opened\n+                    return driver.getWindowHandles().size() > 1;\n+                } catch (StaleElementReferenceException e) {\n+                    return null;\n+                }\n+            }\n+        }));\n+        // select last handle\n+        String handle = null;\n+        Iterator<String> handleIt = driver.getWindowHandles().iterator();\n+        while (handleIt.hasNext()) {\n+            handle = handleIt.next();\n         }\n+        System.err.println(driver.getWindowHandles());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3286998dbbb73daf2daeb1f9f75477aa48dec4"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxNTczMQ==", "bodyText": "oops, thanks", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425715731", "createdAt": "2020-05-15T10:37:38Z", "author": {"login": "atchertchian"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -196,9 +202,27 @@ protected void storeWindowHandle() {\n     }\n \n     protected void switchToNewWindow() {\n-        for (String winHandle : driver.getWindowHandles()) {\n-            driver.switchTo().window(winHandle);\n+        Wait<WebDriver> wait = Locator.getFluentWait();\n+        wait.until((new Function<WebDriver, Boolean>() {\n+            @Override\n+            public Boolean apply(WebDriver driver) {\n+                try {\n+                    // wait for one more window to be opened\n+                    return driver.getWindowHandles().size() > 1;\n+                } catch (StaleElementReferenceException e) {\n+                    return null;\n+                }\n+            }\n+        }));\n+        // select last handle\n+        String handle = null;\n+        Iterator<String> handleIt = driver.getWindowHandles().iterator();\n+        while (handleIt.hasNext()) {\n+            handle = handleIt.next();\n         }\n+        System.err.println(driver.getWindowHandles());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxMDc0Ng=="}, "originalCommit": {"oid": "8f3286998dbbb73daf2daeb1f9f75477aa48dec4"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MTAwNzg2OnYy", "diffSide": "RIGHT", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDozMjoyNFrOGV_eTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDo0MDo1NFrOGV_uCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxMzIyOA==", "bodyText": "You can use\nfor (String h : driver.getWindowHandles()) {\n    handle = h;\n}\n\nOr if you feel fancy\nString handle = driver.getWindowHandles().stream().reduce((prev, next) -> next).orElse(null);", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425713228", "createdAt": "2020-05-15T10:32:24Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -196,9 +202,27 @@ protected void storeWindowHandle() {\n     }\n \n     protected void switchToNewWindow() {\n-        for (String winHandle : driver.getWindowHandles()) {\n-            driver.switchTo().window(winHandle);\n+        Wait<WebDriver> wait = Locator.getFluentWait();\n+        wait.until((new Function<WebDriver, Boolean>() {\n+            @Override\n+            public Boolean apply(WebDriver driver) {\n+                try {\n+                    // wait for one more window to be opened\n+                    return driver.getWindowHandles().size() > 1;\n+                } catch (StaleElementReferenceException e) {\n+                    return null;\n+                }\n+            }\n+        }));\n+        // select last handle\n+        String handle = null;\n+        Iterator<String> handleIt = driver.getWindowHandles().iterator();\n+        while (handleIt.hasNext()) {\n+            handle = handleIt.next();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f3286998dbbb73daf2daeb1f9f75477aa48dec4"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxNzI1OQ==", "bodyText": "\ud83d\udc4d i won't be fancy for clarity :)", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425717259", "createdAt": "2020-05-15T10:40:54Z", "author": {"login": "atchertchian"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -196,9 +202,27 @@ protected void storeWindowHandle() {\n     }\n \n     protected void switchToNewWindow() {\n-        for (String winHandle : driver.getWindowHandles()) {\n-            driver.switchTo().window(winHandle);\n+        Wait<WebDriver> wait = Locator.getFluentWait();\n+        wait.until((new Function<WebDriver, Boolean>() {\n+            @Override\n+            public Boolean apply(WebDriver driver) {\n+                try {\n+                    // wait for one more window to be opened\n+                    return driver.getWindowHandles().size() > 1;\n+                } catch (StaleElementReferenceException e) {\n+                    return null;\n+                }\n+            }\n+        }));\n+        // select last handle\n+        String handle = null;\n+        Iterator<String> handleIt = driver.getWindowHandles().iterator();\n+        while (handleIt.hasNext()) {\n+            handle = handleIt.next();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxMzIyOA=="}, "originalCommit": {"oid": "8f3286998dbbb73daf2daeb1f9f75477aa48dec4"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MTA2NTgyOnYy", "diffSide": "RIGHT", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDo1MzoyN1rOGWAEVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMDo1MzoyN1rOGWAEVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcyMjk2NA==", "bodyText": "Import not needed anymore", "url": "https://github.com/nuxeo/nuxeo/pull/4040#discussion_r425722964", "createdAt": "2020-05-15T10:53:27Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/AbstractExplorerTest.java", "diffHunk": "@@ -24,6 +24,7 @@\n import java.io.IOException;\n import java.net.URL;\n import java.nio.charset.StandardCharsets;\n+import java.util.Iterator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde1043bab16ddf980fe3df6bba6b2360ac65dd6"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4117, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}