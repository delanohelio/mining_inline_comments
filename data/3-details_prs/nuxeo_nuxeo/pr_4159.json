{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NjgxOTY0", "number": 4159, "title": "NXP-28918: add a 'nx:arrayContains' function in the EL context", "bodyText": "This function is used to test if an array contains a given element.", "createdAt": "2020-06-17T08:15:41Z", "url": "https://github.com/nuxeo/nuxeo/pull/4159", "merged": true, "mergeCommit": {"oid": "19d691af4c54c50e4912b0579a262962d159a180"}, "closed": true, "closedAt": "2020-06-23T08:51:08Z", "author": {"login": "troger"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsG9DaAFqTQzMjI1MTEyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs06tCAFqTQzNDE3MjEyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjUxMTIw", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-432251120", "createdAt": "2020-06-17T10:04:51Z", "commit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDowNDo1MVrOGk-7sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDowNDo1MVrOGk-7sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQzMzAwOA==", "bodyText": "For consistency:\nReturns {@code true} if the given {@code arr} contains the given {@code o}.\nor\nReturns {@code true} if the given array contains the given object.", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r441433008", "createdAt": "2020-06-17T10:04:51Z", "author": {"login": "ataillefer"}, "path": "modules/core/nuxeo-core-el/src/main/java/org/nuxeo/ecm/platform/el/Functions.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Thomas Roger <troger@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.platform.el;\n+\n+import java.util.Arrays;\n+\n+/**\n+ * Helper functions injected in the {@link ExpressionContext} instance.\n+ *\n+ * @since 11.2\n+ */\n+public class Functions {\n+\n+    /**\n+     * Returns {@code true} if the given {@code arr} contains the specified element.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjY2ODE2", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-432266816", "createdAt": "2020-06-17T10:27:05Z", "commit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDoyNzowNVrOGk_rfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDoyNzowNVrOGk_rfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ0NTI0Ng==", "bodyText": "Could add @since 11.2", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r441445246", "createdAt": "2020-06-17T10:27:05Z", "author": {"login": "ataillefer"}, "path": "modules/core/nuxeo-core-el/src/test/java/org/nuxeo/platform/el/TestExpressionEvaluator.java", "diffHunk": "@@ -106,4 +107,21 @@ public void testList() {\n         assertNotNull(value);\n     }\n \n+    /**\n+     * NXP-28918\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjY3MTEy", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-432267112", "createdAt": "2020-06-17T10:27:31Z", "commit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDoyNzozMVrOGk_sYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMDoyNzozMVrOGk_sYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ0NTQ3NA==", "bodyText": "@since 11.2", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r441445474", "createdAt": "2020-06-17T10:27:31Z", "author": {"login": "ataillefer"}, "path": "modules/platform/nuxeo-platform-imaging/nuxeo-platform-imaging-core/src/test/java/org/nuxeo/ecm/platform/picture/core/test/TestPictureConversions.java", "diffHunk": "@@ -194,6 +194,32 @@ public void shouldFilterPictureConversions() throws Exception {\n         assertNull(multiviewPicture.getView(\"anotherSmallConversion\"));\n     }\n \n+    /**\n+     * NXP-28918\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDAwNzQ3", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-432400747", "createdAt": "2020-06-17T13:29:03Z", "commit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzoyOTowM1rOGlFw-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzozMDo1OVrOGlF2WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU0NDk1NQ==", "bodyText": "You should specify in the Javadoc what happens for a null array (it's fine to make it behave like an empty one).", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r441544955", "createdAt": "2020-06-17T13:29:03Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-el/src/main/java/org/nuxeo/ecm/platform/el/Functions.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Thomas Roger <troger@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.platform.el;\n+\n+import java.util.Arrays;\n+\n+/**\n+ * Helper functions injected in the {@link ExpressionContext} instance.\n+ *\n+ * @since 11.2\n+ */\n+public class Functions {\n+\n+    /**\n+     * Returns {@code true} if the given {@code arr} contains the specified element.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQzMzAwOA=="}, "originalCommit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU0NTQ2NQ==", "bodyText": "Please also test the null case.", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r441545465", "createdAt": "2020-06-17T13:29:49Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-el/src/test/java/org/nuxeo/platform/el/TestExpressionEvaluator.java", "diffHunk": "@@ -106,4 +107,21 @@ public void testList() {\n         assertNotNull(value);\n     }\n \n+    /**\n+     * NXP-28918\n+     */\n+    @Test\n+    public void testArrayContainsFunction() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU0NjMyOA==", "bodyText": "While we're at it wouldn't it be useful to also code now an arrayContainsAll and arrayContainsAny? And maybe arrayContainsNone?", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r441546328", "createdAt": "2020-06-17T13:30:59Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-el/src/main/java/org/nuxeo/ecm/platform/el/Functions.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Thomas Roger <troger@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.platform.el;\n+\n+import java.util.Arrays;\n+\n+/**\n+ * Helper functions injected in the {@link ExpressionContext} instance.\n+ *\n+ * @since 11.2\n+ */\n+public class Functions {\n+\n+    /**\n+     * Returns {@code true} if the given {@code arr} contains the specified element.\n+     */\n+    public static boolean arrayContains(Object[] arr, Object o) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6343aab04c2685b267fb481a8f97b6ec0a95647f", "author": {"user": {"login": "troger", "name": "Thomas Roger"}}, "url": "https://github.com/nuxeo/nuxeo/commit/6343aab04c2685b267fb481a8f97b6ec0a95647f", "committedDate": "2020-06-17T08:12:32Z", "message": "NXP-28918: add a 'nx:arrayContains' function in the EL context\n\nThis function is used to test if an array contains a given element."}, "afterCommit": {"oid": "217b8a2d34c6b0d2378f8dd7a855ece34dc6293c", "author": {"user": {"login": "troger", "name": "Thomas Roger"}}, "url": "https://github.com/nuxeo/nuxeo/commit/217b8a2d34c6b0d2378f8dd7a855ece34dc6293c", "committedDate": "2020-06-19T14:09:06Z", "message": "NXP-28918: add 'nx:arrayContains*' functions in the EL context\n\nFunctions added:\n- nx:arrayContains\n- nx:arrayContainsAll\n- nx:arrayContainsAny\n- nx:arrayContainsNone"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "217b8a2d34c6b0d2378f8dd7a855ece34dc6293c", "author": {"user": {"login": "troger", "name": "Thomas Roger"}}, "url": "https://github.com/nuxeo/nuxeo/commit/217b8a2d34c6b0d2378f8dd7a855ece34dc6293c", "committedDate": "2020-06-19T14:09:06Z", "message": "NXP-28918: add 'nx:arrayContains*' functions in the EL context\n\nFunctions added:\n- nx:arrayContains\n- nx:arrayContainsAll\n- nx:arrayContainsAny\n- nx:arrayContainsNone"}, "afterCommit": {"oid": "7b4f19491d2f0c4a0036058d114939fcb3683471", "author": {"user": {"login": "troger", "name": "Thomas Roger"}}, "url": "https://github.com/nuxeo/nuxeo/commit/7b4f19491d2f0c4a0036058d114939fcb3683471", "committedDate": "2020-06-19T14:36:39Z", "message": "NXP-28918: add 'nx:arrayContains*' functions in the EL context\n\nFunctions added:\n- nx:arrayContains\n- nx:arrayContainsAll\n- nx:arrayContainsAny\n- nx:arrayContainsNone"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTE3MTM3", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-434117137", "createdAt": "2020-06-19T14:23:06Z", "commit": {"oid": "217b8a2d34c6b0d2378f8dd7a855ece34dc6293c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTMyODUw", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-434132850", "createdAt": "2020-06-19T14:43:31Z", "commit": {"oid": "7b4f19491d2f0c4a0036058d114939fcb3683471"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDo0MzozMVrOGmXUSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDo0MzozMVrOGmXUSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg4MTA5Nw==", "bodyText": "No need for isPublic, as getMethods only returns public methods", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r442881097", "createdAt": "2020-06-19T14:43:31Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-el/src/main/java/org/nuxeo/ecm/platform/el/ExpressionContext.java", "diffHunk": "@@ -30,6 +35,12 @@\n \n public class ExpressionContext extends ELContext {\n \n+    private static final Map<String, Method> DEFAULT_FUNCTIONS = //\n+            Stream.of(Functions.class.getMethods())\n+                  .filter(m -> Modifier.isStatic(m.getModifiers()))\n+                  .filter(m -> Modifier.isPublic(m.getModifiers()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b4f19491d2f0c4a0036058d114939fcb3683471"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTU2NDU1", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-434156455", "createdAt": "2020-06-19T15:15:06Z", "commit": {"oid": "7b4f19491d2f0c4a0036058d114939fcb3683471"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNToxNTowNlrOGmYYSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNToxNTowNlrOGmYYSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg5ODUwNQ==", "bodyText": "String.format is overkill and costly (and you don't use it in mapFunction anyway).", "url": "https://github.com/nuxeo/nuxeo/pull/4159#discussion_r442898505", "createdAt": "2020-06-19T15:15:06Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-el/src/main/java/org/nuxeo/ecm/platform/el/ExpressionContext.java", "diffHunk": "@@ -51,7 +62,13 @@ public ValueExpression setVariable(String variable, ValueExpression expression)\n \n         @Override\n         public Method resolveFunction(String prefix, String localName) {\n-            return map.get(prefix + \":\" + localName);\n+            String key = String.format(\"%s:%s\", prefix, localName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b4f19491d2f0c4a0036058d114939fcb3683471"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d3aee5d7ace39f9e320854bc0e065fa60509d08", "author": {"user": {"login": "troger", "name": "Thomas Roger"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3d3aee5d7ace39f9e320854bc0e065fa60509d08", "committedDate": "2020-06-19T15:31:52Z", "message": "NXP-28918: add 'nx:arrayContains*' functions in the EL context\n\nFunctions added:\n- nx:arrayContains\n- nx:arrayContainsAll\n- nx:arrayContainsAny\n- nx:arrayContainsNone"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b4f19491d2f0c4a0036058d114939fcb3683471", "author": {"user": {"login": "troger", "name": "Thomas Roger"}}, "url": "https://github.com/nuxeo/nuxeo/commit/7b4f19491d2f0c4a0036058d114939fcb3683471", "committedDate": "2020-06-19T14:36:39Z", "message": "NXP-28918: add 'nx:arrayContains*' functions in the EL context\n\nFunctions added:\n- nx:arrayContains\n- nx:arrayContainsAll\n- nx:arrayContainsAny\n- nx:arrayContainsNone"}, "afterCommit": {"oid": "3d3aee5d7ace39f9e320854bc0e065fa60509d08", "author": {"user": {"login": "troger", "name": "Thomas Roger"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3d3aee5d7ace39f9e320854bc0e065fa60509d08", "committedDate": "2020-06-19T15:31:52Z", "message": "NXP-28918: add 'nx:arrayContains*' functions in the EL context\n\nFunctions added:\n- nx:arrayContains\n- nx:arrayContainsAll\n- nx:arrayContainsAny\n- nx:arrayContainsNone"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTcxNzc2", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-434171776", "createdAt": "2020-06-19T15:37:24Z", "commit": {"oid": "3d3aee5d7ace39f9e320854bc0e065fa60509d08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTcyMTI4", "url": "https://github.com/nuxeo/nuxeo/pull/4159#pullrequestreview-434172128", "createdAt": "2020-06-19T15:37:56Z", "commit": {"oid": "3d3aee5d7ace39f9e320854bc0e065fa60509d08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4710, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}