{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjExMzc5", "number": 4041, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNjo1Nzo0MVrOD9LqfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowODoyM1rOD9LtWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NDgwODI5OnYy", "diffSide": "RIGHT", "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNjo1Nzo0MVrOGWiNQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwODowMToyNVrOGWrqrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MjMwNw==", "bodyText": "This is really obsolete (I can't even remember when it was used). I don't think it's worth keeping.", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426282307", "createdAt": "2020-05-17T16:57:41Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -321,7 +365,10 @@ public void checkPaths() throws ConfigurationException {\n             log.warn(\"NXP-8014 Packages cache location changed. You can safely delete {} or move its content to {}\",\n                     () -> oldPackagesPath, this::getPackagesDir);\n         }\n-\n+        File oldPath = new File(getRuntimeHome(), \"data\" + File.separator + \"vcsh2repo\");\n+        String message = String.format(\"NXP-5370, NXP-5460. \" + \"Please rename 'vcsh2repo' directory from %s to %s\",\n+                oldPath, new File(generator.getDataDir(), \"h2\" + File.separator + \"nuxeo\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ac83f07c7d79018b7466f160e45badd28a101a"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzNzI5NA==", "bodyText": "I removed it.", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426437294", "createdAt": "2020-05-18T08:01:25Z", "author": {"login": "kevinleturc"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -321,7 +365,10 @@ public void checkPaths() throws ConfigurationException {\n             log.warn(\"NXP-8014 Packages cache location changed. You can safely delete {} or move its content to {}\",\n                     () -> oldPackagesPath, this::getPackagesDir);\n         }\n-\n+        File oldPath = new File(getRuntimeHome(), \"data\" + File.separator + \"vcsh2repo\");\n+        String message = String.format(\"NXP-5370, NXP-5460. \" + \"Please rename 'vcsh2repo' directory from %s to %s\",\n+                oldPath, new File(generator.getDataDir(), \"h2\" + File.separator + \"nuxeo\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MjMwNw=="}, "originalCommit": {"oid": "99ac83f07c7d79018b7466f160e45badd28a101a"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NDgxMTQ4OnYy", "diffSide": "RIGHT", "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ConfigurationGenerator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowMjozMlrOGWiPAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowMjozMlrOGWiPAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4Mjc1NA==", "bodyText": "I think you can just call mkdirs() on all the dirs wihtout the isDirectory check, it shouldn't fail if the directory already exists.", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426282754", "createdAt": "2020-05-17T17:02:32Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ConfigurationGenerator.java", "diffHunk": "@@ -1274,15 +1224,20 @@ public File getDataDir() {\n      */\n     public void verifyInstallation() throws ConfigurationException {\n         checkJavaVersion();\n-        ifNotExistsAndIsDirectoryThenCreate(getLogDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getPidDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getDataDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getTmpDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getPackagesDir());\n+        createDirectoryIfDoesntExist(getLogDir());\n+        createDirectoryIfDoesntExist(getPidDir());\n+        createDirectoryIfDoesntExist(getDataDir());\n+        createDirectoryIfDoesntExist(getTmpDir());\n+        createDirectoryIfDoesntExist(getPackagesDir());\n         checkAddressesAndPorts();\n         serverConfigurator.verifyInstallation();\n         backingServicesConfigurator.verifyInstallation();\n+    }\n \n+    private void createDirectoryIfDoesntExist(File directory) {\n+        if (!directory.isDirectory()) {\n+            directory.mkdirs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec56196f09ce9378816f6c498543d3cdb4ac53e1"}, "originalPosition": 406}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NDgxNTYzOnYy", "diffSide": "RIGHT", "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowODoyM1rOGWiRNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowODoyM1rOGWiRNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MzMxOA==", "bodyText": "Maybe Files.exists(generator.getNuxeoHome().toPath().resolve(Path.of(\"conf\", \"Catalina\", \"localhost\", getContextName() + \".xml\")))", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426283318", "createdAt": "2020-05-17T17:08:23Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -111,16 +111,14 @@ public ServerConfigurator(ConfigurationGenerator configurationGenerator) {\n      * @return true if server configuration files already exist\n      */\n     protected boolean isConfigured() {\n-        return new File(generator.getNuxeoHome(), getTomcatConfig()).exists();\n-    }\n-\n-    /**\n-     * @since 5.4.2\n-     * @return Path to Tomcat configuration of Nuxeo context\n-     */\n-    public String getTomcatConfig() {\n-        return \"conf\" + File.separator + \"Catalina\" + File.separator + \"localhost\" + File.separator + getContextName()\n-                + \".xml\";\n+        return generator.getNuxeoHome()\n+                        .toPath()\n+                        .resolve(\"conf\")\n+                        .resolve(\"Catalina\")\n+                        .resolve(\"localhost\")\n+                        .resolve(getContextName() + \".xml\")\n+                        .toFile()\n+                        .exists();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec56196f09ce9378816f6c498543d3cdb4ac53e1"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4120, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}