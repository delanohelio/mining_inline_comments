{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NjA3OTgz", "number": 3820, "title": "fix-NXP-28727-Document-created-under-a-placeless-document-Mustnt-be-a-placeless", "bodyText": "PR created from https://qa.nuxeo.org/jenkins/job/TestAndPush/job/ondemand-testandpush-saouana/211/\nNew T&P OK (before merge): https://qa.nuxeo.org/jenkins/job/TestAndPush/job/ondemand-testandpush-saouana/217/", "createdAt": "2020-03-09T14:05:03Z", "url": "https://github.com/nuxeo/nuxeo/pull/3820", "merged": true, "mergeCommit": {"oid": "a31a9a557df1360df93e7f2963d738d1dc6f58cd"}, "closed": true, "closedAt": "2020-03-13T08:43:16Z", "author": {"login": "nuxeojenkins"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL_TIhABqjMxMTEwNDQ2MDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM8g33gFqTM3MzYwMDQyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5cd99b95f6f299eebdf2f38f1f7828ee8a33e228", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/5cd99b95f6f299eebdf2f38f1f7828ee8a33e228", "committedDate": "2020-03-09T09:51:15Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}, "afterCommit": {"oid": "e46c9ef99dea43bdc4e253dae9a3152e712dbe3a", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e46c9ef99dea43bdc4e253dae9a3152e712dbe3a", "committedDate": "2020-03-09T14:56:45Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e46c9ef99dea43bdc4e253dae9a3152e712dbe3a", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e46c9ef99dea43bdc4e253dae9a3152e712dbe3a", "committedDate": "2020-03-09T14:56:45Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}, "afterCommit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/b4782bf0081c1bea749fc98179b6765c5dbf376f", "committedDate": "2020-03-09T15:08:59Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTM5MzM1", "url": "https://github.com/nuxeo/nuxeo/pull/3820#pullrequestreview-372939335", "createdAt": "2020-03-11T16:45:45Z", "commit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTM3Mjg1", "url": "https://github.com/nuxeo/nuxeo/pull/3820#pullrequestreview-372937285", "createdAt": "2020-03-11T16:43:19Z", "commit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNjo0MzoxOVrOF0_f-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNjo1MzozN1rOF0_7Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExMDY1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @since 10.10-HF23\n          \n          \n            \n                 * @since 11.1", "url": "https://github.com/nuxeo/nuxeo/pull/3820#discussion_r391110651", "createdAt": "2020-03-11T16:43:19Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/CoreSession.java", "diffHunk": "@@ -477,6 +477,22 @@\n      */\n     DocumentModel createDocumentModel(String parentPath, String name, String typeName);\n \n+    /**\n+     * Creates a new document model using required information.\n+     * <p>\n+     * Used to fetch initial datamodels from the type definition.\n+     * <p>\n+     * DocumentModel creation notifies a {@link DocumentEventTypes#EMPTY_DOCUMENTMODEL_CREATED} so that core event\n+     * listener can initialize its content with computed properties.\n+     *\n+     * @param parentRef the parent document ref {@link DocumentRef}\n+     * @param name The destination name\n+     * @param typeName the type name\n+     * @return the initial document model\n+     * @since 10.10-HF23", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExMzgxMw==", "bodyText": "Don't we want to use this new API with parentRef for former methods with String? I'm talking about the setPathInfo in this method which could be removed I think.", "url": "https://github.com/nuxeo/nuxeo/pull/3820#discussion_r391113813", "createdAt": "2020-03-11T16:48:05Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-core/nuxeo-core/src/main/java/org/nuxeo/ecm/core/api/AbstractSession.java", "diffHunk": "@@ -616,12 +616,16 @@ public void cancel() {\n     }\n \n     private DocumentModel createDocumentModelFromTypeName(String typeName, Map<String, Serializable> options) {\n-        SchemaManager schemaManager = Framework.getService(SchemaManager.class);\n-        DocumentType docType = schemaManager.getDocumentType(typeName);\n+        return createDocumentModelFromParentAndType(null, typeName, options);\n+    }\n+\n+    private DocumentModel createDocumentModelFromParentAndType(DocumentRef parentRef, String typeName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExNzA1Mg==", "bodyText": "Since 11.1", "url": "https://github.com/nuxeo/nuxeo/pull/3820#discussion_r391117052", "createdAt": "2020-03-11T16:52:51Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-core/nuxeo-core/src/main/java/org/nuxeo/ecm/core/api/DocumentModelFactory.java", "diffHunk": "@@ -166,8 +166,23 @@ public static DocumentModelImpl createDocumentModel(String docType) {\n      * @return the document model\n      */\n     public static DocumentModelImpl createDocumentModel(String sessionId, DocumentType docType) {\n-        DocumentModelImpl docModel = new DocumentModelImpl(sessionId, docType.getName(), null, null, null, null, null,\n-                null, null, null, null);\n+        return createDocumentModel(sessionId, docType, null);\n+    }\n+\n+    /**\n+     * Creates a document model for a new document.\n+     * <p>\n+     * Initializes the proper data models according to the type info.\n+     *\n+     * @param sessionId the CoreSession id\n+     * @param docType the document type\n+     * @param parentRef the parent ref\n+     * @return the document model\n+     * @since 10.10-HF23", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExNzU4Nw==", "bodyText": "since 11.1", "url": "https://github.com/nuxeo/nuxeo/pull/3820#discussion_r391117587", "createdAt": "2020-03-11T16:53:37Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/main/java/org/nuxeo/ecm/platform/comment/impl/TreeCommentManager.java", "diffHunk": "@@ -308,21 +308,26 @@ public void deleteComment(DocumentModel doc, DocumentModel comment) {\n         throw new UnsupportedOperationException(SERVICE_WITHOUT_IMPLEMENTATION_MESSAGE);\n     }\n \n-    @Override\n-    public String getLocationOfCommentCreation(CoreSession session, DocumentModel commentedDoc) {\n+    /**\n+     * Returns the {@link DocumentRef} of the comments location in repository for the given commented document model.\n+     *\n+     * @param session the session needs to be privileged\n+     * @return the document model container of the comments of the given {@code commentedDoc}\n+     * @since 10.10-HF23", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4782bf0081c1bea749fc98179b6765c5dbf376f", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/b4782bf0081c1bea749fc98179b6765c5dbf376f", "committedDate": "2020-03-09T15:08:59Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}, "afterCommit": {"oid": "3dfc72c5ef3efb355e49583a5f47d2a123570824", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3dfc72c5ef3efb355e49583a5f47d2a123570824", "committedDate": "2020-03-12T08:32:58Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3dfc72c5ef3efb355e49583a5f47d2a123570824", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3dfc72c5ef3efb355e49583a5f47d2a123570824", "committedDate": "2020-03-12T08:32:58Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}, "afterCommit": {"oid": "1db9568191545b007a70e3a68cc030d36f3b06d5", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1db9568191545b007a70e3a68cc030d36f3b06d5", "committedDate": "2020-03-12T13:54:13Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b3253a6f2b38353bc1b05ee1704679a939633cc", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8b3253a6f2b38353bc1b05ee1704679a939633cc", "committedDate": "2020-03-12T14:00:02Z", "message": "NXP-28727: Document created under a placeless document Mustnt be a placeless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0f62f76712c026c8d2de67f5ecad24116cc8438", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c0f62f76712c026c8d2de67f5ecad24116cc8438", "committedDate": "2020-03-12T14:00:03Z", "message": "NXP-28731: Create comments on a placeless document must be effective"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8d8ffdea5888643567a1875785b4e5e3f886ba6", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d8d8ffdea5888643567a1875785b4e5e3f886ba6", "committedDate": "2020-03-12T14:00:03Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1db9568191545b007a70e3a68cc030d36f3b06d5", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1db9568191545b007a70e3a68cc030d36f3b06d5", "committedDate": "2020-03-12T13:54:13Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}, "afterCommit": {"oid": "d8d8ffdea5888643567a1875785b4e5e3f886ba6", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d8d8ffdea5888643567a1875785b4e5e3f886ba6", "committedDate": "2020-03-12T14:00:03Z", "message": "NXP-28719: Fix Comment Migration failure due to versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTg0OTUx", "url": "https://github.com/nuxeo/nuxeo/pull/3820#pullrequestreview-373584951", "createdAt": "2020-03-12T14:06:07Z", "commit": {"oid": "d8d8ffdea5888643567a1875785b4e5e3f886ba6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjAwNDI0", "url": "https://github.com/nuxeo/nuxeo/pull/3820#pullrequestreview-373600424", "createdAt": "2020-03-12T14:23:23Z", "commit": {"oid": "d8d8ffdea5888643567a1875785b4e5e3f886ba6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4802, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}