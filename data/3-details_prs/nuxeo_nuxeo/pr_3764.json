{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MjI2MTEz", "number": 3764, "title": "NXP-27654: add a unique index on ecm:id in MongoDB", "bodyText": "", "createdAt": "2020-02-19T15:11:42Z", "url": "https://github.com/nuxeo/nuxeo/pull/3764", "merged": true, "mergeCommit": {"oid": "65bca0daac75ec710d5d38fed13055eaaf0a3aca"}, "closed": true, "closedAt": "2020-02-21T13:23:10Z", "author": {"login": "efge"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF3bxagH2gAyMzc3MjI2MTEzOjFjM2I3MzU2MTY5MjQwZTcyMWI3YmM3ZmFkZWMyZWUzYjg2NDllZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGforbgFqTM2MjYyMjk2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1c3b7356169240e721b7bc7fadec2ee3b8649ee8", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1c3b7356169240e721b7bc7fadec2ee3b8649ee8", "committedDate": "2020-02-19T14:30:49Z", "message": "NXP-27654: add a unique index on ecm:id in MongoDB"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzY0Mzc5", "url": "https://github.com/nuxeo/nuxeo/pull/3764#pullrequestreview-361364379", "createdAt": "2020-02-19T19:14:41Z", "commit": {"oid": "1c3b7356169240e721b7bc7fadec2ee3b8649ee8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxOToxNDo0MVrOFr0JwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxOToxNDo0MVrOFr0JwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ4NzU1Mg==", "bodyText": "is the message useful, or could it be richer?", "url": "https://github.com/nuxeo/nuxeo/pull/3764#discussion_r381487552", "createdAt": "2020-02-19T19:14:41Z", "author": {"login": "ataillefer"}, "path": "nuxeo-core/nuxeo-core-storage-mongodb/src/main/java/org/nuxeo/ecm/core/storage/mongodb/MongoDBRepository.java", "diffHunk": "@@ -345,7 +345,7 @@ public void createStates(List<State> states) {\n             // Avoid hiding any others bulk errors\n             if (duplicates.size() == mbwe.getWriteErrors().size()) {\n                 log.trace(\"MongoDB:    -> DUPLICATE KEY: {}\", duplicates);\n-                ConcurrentUpdateException concurrentUpdateException = new ConcurrentUpdateException();\n+                ConcurrentUpdateException concurrentUpdateException = new ConcurrentUpdateException(\"Concurrent update\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c3b7356169240e721b7bc7fadec2ee3b8649ee8"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzY2MzQ1", "url": "https://github.com/nuxeo/nuxeo/pull/3764#pullrequestreview-361366345", "createdAt": "2020-02-19T19:17:30Z", "commit": {"oid": "1c3b7356169240e721b7bc7fadec2ee3b8649ee8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxOToxNzozMFrOFr0PvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxOToxNzozMFrOFr0PvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ4OTA4NA==", "bodyText": "could/should these 2 lines be replaced by\ntransactionalFeature.nextTransaction()\n\nThough it's probably for backport purpose, don't we want to benefit from it on master?", "url": "https://github.com/nuxeo/nuxeo/pull/3764#discussion_r381489084", "createdAt": "2020-02-19T19:17:30Z", "author": {"login": "ataillefer"}, "path": "nuxeo-core/nuxeo-core-test/src/test/java/org/nuxeo/ecm/core/TestSQLRepositoryAPI.java", "diffHunk": "@@ -3743,6 +3743,61 @@ public void testImport() {\n         assertFalse(doc.isProxy());\n     }\n \n+    @Test\n+    public void testImportDuplicateIdSameSession() {\n+        DocumentModel doc = session.createDocumentModel(\"/\", \"doc\", \"File\");\n+        doc = session.createDocument(doc);\n+        session.save();\n+        nextTransaction();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c3b7356169240e721b7bc7fadec2ee3b8649ee8"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzE5NzY0", "url": "https://github.com/nuxeo/nuxeo/pull/3764#pullrequestreview-361719764", "createdAt": "2020-02-20T08:47:43Z", "commit": {"oid": "1c3b7356169240e721b7bc7fadec2ee3b8649ee8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNjIyOTY4", "url": "https://github.com/nuxeo/nuxeo/pull/3764#pullrequestreview-362622968", "createdAt": "2020-02-21T13:21:07Z", "commit": {"oid": "1c3b7356169240e721b7bc7fadec2ee3b8649ee8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4854, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}