{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTg2Mzkz", "number": 3882, "title": "fix-NXP-19849-explorer-multiple-contribs", "bodyText": "PR created from https://qa.nuxeo.org/jenkins/job/TestAndPush/job/ondemand-testandpush-atchertchian-master/197/", "createdAt": "2020-04-01T13:12:44Z", "url": "https://github.com/nuxeo/nuxeo/pull/3882", "merged": true, "mergeCommit": {"oid": "7848727d3309e4c9ff0d9a6f4a33e233ede36744"}, "closed": true, "closedAt": "2020-04-06T10:56:55Z", "author": {"login": "nuxeojenkins"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTZbS4gFqTM4NTY5ODMzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcU8S_igFqTM4ODEyODQyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1Njk4MzMx", "url": "https://github.com/nuxeo/nuxeo/pull/3882#pullrequestreview-385698331", "createdAt": "2020-04-01T15:27:46Z", "commit": {"oid": "88eabbeefcad092f239936ed34b6300e0e8cd568"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNToyNzo0N1rOF_GE4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNToyNzo0N1rOF_GE4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcwNDE2Mw==", "bodyText": "Could be simplified to:\nString id = ei.getId();\ncomps.computeIfPresent(id, (k,v) -> v + 1);\ncomps.computeIfAbsent(id, k -> Integer.valueOf(0));", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r401704163", "createdAt": "2020-04-01T15:27:47Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/repository/SnapshotPersister.java", "diffHunk": "@@ -302,8 +303,16 @@ public void persistComponent(DistributionSnapshot snapshot, ComponentInfo ci, Co\n         for (ExtensionPointInfo epi : ci.getExtensionPoints()) {\n             createExtensionPointDoc(snapshot, session, label, epi, componentDoc);\n         }\n+        Map<String, Integer> comps = new HashMap<String, Integer>();\n         for (ExtensionInfo ei : ci.getExtensions()) {\n-            createContributionDoc(snapshot, session, label, ei, componentDoc);\n+            // handle multiple contributions to the same extension point\n+            String id = ei.getId();\n+            if (comps.containsKey(id)) {\n+                comps.put(id, comps.get(id) + 1);\n+            } else {\n+                comps.put(id, Integer.valueOf(0));\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88eabbeefcad092f239936ed34b6300e0e8cd568"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "833af3a571386a8226af9273b0cae5f08f2bf599", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/833af3a571386a8226af9273b0cae5f08f2bf599", "committedDate": "2020-04-01T15:54:48Z", "message": "NXP-19849: simplify code"}, "afterCommit": {"oid": "d0fa2adadb9bd84641b83efcd8d0afe55b98003f", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d0fa2adadb9bd84641b83efcd8d0afe55b98003f", "committedDate": "2020-04-02T14:18:22Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0fa2adadb9bd84641b83efcd8d0afe55b98003f", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d0fa2adadb9bd84641b83efcd8d0afe55b98003f", "committedDate": "2020-04-02T14:18:22Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}, "afterCommit": {"oid": "0c59ae5a422b768f0edb2dfffa3cb6ae97ef5a80", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/0c59ae5a422b768f0edb2dfffa3cb6ae97ef5a80", "committedDate": "2020-04-02T16:10:35Z", "message": "NXP-19849: remove dupe test deployment, already handled by RepositoryElasticSearchFeature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92f76f93ef885b11e341639c7becc6949158af20", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/92f76f93ef885b11e341639c7becc6949158af20", "committedDate": "2020-04-02T16:14:06Z", "message": "NXP-19849: remove dupe test deployment, already handled by RepositoryElasticSearchFeature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3354a2c1401f3f7f90be8ac4224cb71c7b5d279", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d3354a2c1401f3f7f90be8ac4224cb71c7b5d279", "committedDate": "2020-04-02T16:14:06Z", "message": "NXP-19849: cleanup deprecated test dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9914c4474a79d963c3f6cfca7ee6ea4204ca7db", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c9914c4474a79d963c3f6cfca7ee6ea4204ca7db", "committedDate": "2020-04-02T16:14:06Z", "message": "NXP-19849: add explicit tests for the test runtime being introspected and persisted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e3b401539c7839a2361e49e6ce9c96a2b047c4a", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/4e3b401539c7839a2361e49e6ce9c96a2b047c4a", "committedDate": "2020-04-02T16:14:06Z", "message": "NXP-19849: make changes revealed/needed by tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c59ae5a422b768f0edb2dfffa3cb6ae97ef5a80", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/0c59ae5a422b768f0edb2dfffa3cb6ae97ef5a80", "committedDate": "2020-04-02T16:10:35Z", "message": "NXP-19849: remove dupe test deployment, already handled by RepositoryElasticSearchFeature"}, "afterCommit": {"oid": "8f010f40ef424099c27fe078c3a9b1d57f201121", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8f010f40ef424099c27fe078c3a9b1d57f201121", "committedDate": "2020-04-02T16:14:06Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MjM4MTY4", "url": "https://github.com/nuxeo/nuxeo/pull/3882#pullrequestreview-387238168", "createdAt": "2020-04-03T13:08:03Z", "commit": {"oid": "8f010f40ef424099c27fe078c3a9b1d57f201121"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzIxNTIx", "url": "https://github.com/nuxeo/nuxeo/pull/3882#pullrequestreview-387321521", "createdAt": "2020-04-03T14:43:57Z", "commit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNDo0Mzo1N1rOGAYm4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTowMzo1NlrOGAZdwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA1NjM1Mw==", "bodyText": "Integer -> int", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403056353", "createdAt": "2020-04-03T14:43:57Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/adapters/ExtensionInfoDocAdapter.java", "diffHunk": "@@ -41,21 +41,27 @@\n \n public class ExtensionInfoDocAdapter extends BaseNuxeoArtifactDocAdapter implements ExtensionInfo {\n \n-    public static ExtensionInfoDocAdapter create(ExtensionInfo xi, CoreSession session, String containerPath) {\n+    public static ExtensionInfoDocAdapter create(ExtensionInfo xi, Integer index, CoreSession session,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA1Njc0OQ==", "bodyText": "\"-\" + index is enough", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403056749", "createdAt": "2020-04-03T14:44:32Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/adapters/ExtensionInfoDocAdapter.java", "diffHunk": "@@ -41,21 +41,27 @@\n \n public class ExtensionInfoDocAdapter extends BaseNuxeoArtifactDocAdapter implements ExtensionInfo {\n \n-    public static ExtensionInfoDocAdapter create(ExtensionInfo xi, CoreSession session, String containerPath) {\n+    public static ExtensionInfoDocAdapter create(ExtensionInfo xi, Integer index, CoreSession session,\n+            String containerPath) {\n \n         DocumentModel doc = session.createDocumentModel(TYPE_NAME);\n \n-        String name = computeDocumentName(\"contrib-\" + xi.getId());\n+        String id = xi.getId();\n+        if (index > 0) {\n+            id += \"-\" + String.valueOf(index);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2MDgwOQ==", "bodyText": "You should make the map a Map<String, AtomicInteger> then do\n                 if (comps.containsKey(id)) {\n                     int num = comps.get(id).incrementAndGet();\n                     id += \"-\" + num;\n                 } else {\n                     comps.put(id, new AtomicInteger());\n                 }", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403060809", "createdAt": "2020-04-03T14:50:34Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/RuntimeSnapshot.java", "diffHunk": "@@ -170,8 +170,18 @@ protected void index() {\n                     extensionPoints.put(epi.getId(), epi);\n                 }\n \n+                Map<String, Integer> comps = new HashMap<String, Integer>();\n                 for (ExtensionInfo ei : cInfo.getExtensions()) {\n-                    contributions.put(ei.getId(), ei);\n+                    // handle multiple contributions to the same extension point\n+                    String id = ei.getId();\n+                    if (comps.containsKey(id)) {\n+                        Integer num = comps.get(id);\n+                        comps.put(id, num + 1);\n+                        id += \"-\" + String.valueOf(num + 1);\n+                    } else {\n+                        comps.put(id, Integer.valueOf(0));\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2MTI0MA==", "bodyText": "new HashMap<>() (you should configure your IDE to warn you about this)", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403061240", "createdAt": "2020-04-03T14:51:11Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/RuntimeSnapshot.java", "diffHunk": "@@ -170,8 +170,18 @@ protected void index() {\n                     extensionPoints.put(epi.getId(), epi);\n                 }\n \n+                Map<String, Integer> comps = new HashMap<String, Integer>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2MzE0OA==", "bodyText": "Integer -> int", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403063148", "createdAt": "2020-04-03T14:53:44Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/ExtensionInfoImpl.java", "diffHunk": "@@ -56,8 +56,12 @@\n \n     protected Object[] contribution;\n \n-    public ExtensionInfoImpl(ComponentInfoImpl component, String xpoint) {\n-        id = component.getId() + \"--\" + xpoint;\n+    public ExtensionInfoImpl(ComponentInfoImpl component, String xpoint, Integer index) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NTMxMA==", "bodyText": "Simplify also, use AtomicInteger in the map then do just:\n                comps.computeIfAbsent(id, k -> new AtomicInteger(-1)).incrementAndGet();\n                ExtensionInfoImpl xtinfo = new ExtensionInfoImpl(component, xt.getExtensionPoint(), comps.get(id).get());\n\n(no need for computeIfPresent with this)", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403065310", "createdAt": "2020-04-03T14:56:40Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/ServerInfo.java", "diffHunk": "@@ -353,8 +353,13 @@ public static ServerInfo build(String name, String version) {\n             }\n \n             if (ri.getExtensions() != null) {\n+                Map<String, Integer> comps = new HashMap<String, Integer>();\n                 for (Extension xt : ri.getExtensions()) {\n-                    ExtensionInfoImpl xtinfo = new ExtensionInfoImpl(component, xt.getExtensionPoint());\n+                    // handle multiple contributions to the same extension point\n+                    String id = xt.getExtensionPoint();\n+                    comps.computeIfPresent(id, (k, v) -> v + 1);\n+                    comps.computeIfAbsent(id, k -> Integer.valueOf(0));\n+                    ExtensionInfoImpl xtinfo = new ExtensionInfoImpl(component, xt.getExtensionPoint(), comps.get(id));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NTgyOQ==", "bodyText": "Same as above", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403065829", "createdAt": "2020-04-03T14:57:25Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/repository/SnapshotPersister.java", "diffHunk": "@@ -305,8 +306,13 @@ public void persistComponent(DistributionSnapshot snapshot, ComponentInfo ci, Co\n         for (ExtensionPointInfo epi : ci.getExtensionPoints()) {\n             createExtensionPointDoc(snapshot, session, label, epi, componentDoc);\n         }\n+        Map<String, Integer> comps = new HashMap<String, Integer>();\n         for (ExtensionInfo ei : ci.getExtensions()) {\n-            createContributionDoc(snapshot, session, label, ei, componentDoc);\n+            // handle multiple contributions to the same extension point\n+            String id = ei.getId();\n+            comps.computeIfPresent(id, (k, v) -> v + 1);\n+            comps.computeIfAbsent(id, k -> Integer.valueOf(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NjEwMw==", "bodyText": "Integer -> int", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403066103", "createdAt": "2020-04-03T14:57:49Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/repository/SnapshotPersister.java", "diffHunk": "@@ -315,8 +321,8 @@ public void persistComponent(DistributionSnapshot snapshot, ComponentInfo ci, Co\n     }\n \n     protected DocumentModel createContributionDoc(DistributionSnapshot snapshot, CoreSession session, String label,\n-            ExtensionInfo ei, DocumentModel parent) {\n-        return ExtensionInfoDocAdapter.create(ei, session, parent.getPathAsString()).getDoc();\n+            ExtensionInfo ei, Integer index, DocumentModel parent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NjQwMw==", "bodyText": "Not sure why you'd need to wrap point=\"queues\"", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403066403", "createdAt": "2020-04-03T14:58:16Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-repo/src/test/resources/apidoc-works-test-contrib.xml", "diffHunk": "@@ -1,11 +1,22 @@\n <?xml version=\"1.0\"?>\n <component name=\"org.nuxeo.apidoc.test.works\" version=\"1.0\">\n \n-  <extension target=\"org.nuxeo.ecm.core.work.service\" point=\"queues\">\n+  <extension target=\"org.nuxeo.ecm.core.work.service\"\n+    point=\"queues\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e039164f873c719e99abf5b448164c5a2c1a9f32"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NzE2Ng==", "bodyText": "You should make the constant start with a space to avoid + \" \"  in all uses.", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403067166", "createdAt": "2020-04-03T14:59:11Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/api/QueryHelper.java", "diffHunk": "@@ -32,6 +32,11 @@ private QueryHelper() {\n \n     public static final String NOT_DELETED = NXQL.ECM_ISTRASHED + \" = 0\";\n \n+    /**\n+     * @since 11.1\n+     */\n+    public static final String ORDER_BY_POS = \"ORDER BY ecm:pos\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f010f40ef424099c27fe078c3a9b1d57f201121"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2ODE0MQ==", "bodyText": "Second comment is probably useless, the usage is obvious.", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403068141", "createdAt": "2020-04-03T15:00:38Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-repo/src/test/java/org/nuxeo/apidoc/test/TestSnapshotPersist.java", "diffHunk": "@@ -15,169 +15,219 @@\n  *\n  * Contributors:\n  *     Thierry Delprat\n+ *     Anahide Tchertchian\n  */\n package org.nuxeo.apidoc.test;\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n \n+import java.io.ByteArrayInputStream;\n import java.io.File;\n-import java.io.FileInputStream;\n-import java.io.FileOutputStream;\n import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStream;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n import java.util.Collections;\n+import java.util.Comparator;\n import java.util.List;\n \n import javax.inject.Inject;\n \n-import org.apache.commons.logging.Log;\n-import org.apache.commons.logging.LogFactory;\n+import org.apache.commons.lang.SystemUtils;\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.ComparisonFailure;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.nuxeo.apidoc.api.BundleGroupFlatTree;\n import org.nuxeo.apidoc.api.BundleGroupTreeHelper;\n-import org.nuxeo.apidoc.api.BundleInfo;\n-import org.nuxeo.apidoc.api.ComponentInfo;\n-import org.nuxeo.apidoc.api.ExtensionInfo;\n-import org.nuxeo.apidoc.api.ExtensionPointInfo;\n-import org.nuxeo.apidoc.api.ServiceInfo;\n+import org.nuxeo.apidoc.api.NuxeoArtifact;\n+import org.nuxeo.apidoc.api.OperationInfo;\n import org.nuxeo.apidoc.snapshot.DistributionSnapshot;\n import org.nuxeo.apidoc.snapshot.SnapshotManager;\n+import org.nuxeo.common.utils.FileUtils;\n import org.nuxeo.ecm.core.api.CoreSession;\n-import org.nuxeo.ecm.core.api.DocumentModel;\n-import org.nuxeo.runtime.api.Framework;\n import org.nuxeo.runtime.test.runner.Features;\n import org.nuxeo.runtime.test.runner.FeaturesRunner;\n \n @RunWith(FeaturesRunner.class)\n @Features({ RuntimeSnaphotFeature.class })\n public class TestSnapshotPersist {\n \n-    private static final Log log = LogFactory.getLog(TestSnapshotPersist.class);\n+    // helper for quicker update when running tests locally\n+    // public static final boolean UPDATE_REFERENCE_FILES_ON_FAILURE = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9914c4474a79d963c3f6cfca7ee6ea4204ca7db"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2OTE3Mg==", "bodyText": "Collections.sort(ops, Comparator.comparing(OperationInfo::getId))", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403069172", "createdAt": "2020-04-03T15:02:10Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-repo/src/test/java/org/nuxeo/apidoc/test/TestSnapshotPersist.java", "diffHunk": "@@ -15,169 +15,219 @@\n  *\n  * Contributors:\n  *     Thierry Delprat\n+ *     Anahide Tchertchian\n  */\n package org.nuxeo.apidoc.test;\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n \n+import java.io.ByteArrayInputStream;\n import java.io.File;\n-import java.io.FileInputStream;\n-import java.io.FileOutputStream;\n import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStream;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n import java.util.Collections;\n+import java.util.Comparator;\n import java.util.List;\n \n import javax.inject.Inject;\n \n-import org.apache.commons.logging.Log;\n-import org.apache.commons.logging.LogFactory;\n+import org.apache.commons.lang.SystemUtils;\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.ComparisonFailure;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.nuxeo.apidoc.api.BundleGroupFlatTree;\n import org.nuxeo.apidoc.api.BundleGroupTreeHelper;\n-import org.nuxeo.apidoc.api.BundleInfo;\n-import org.nuxeo.apidoc.api.ComponentInfo;\n-import org.nuxeo.apidoc.api.ExtensionInfo;\n-import org.nuxeo.apidoc.api.ExtensionPointInfo;\n-import org.nuxeo.apidoc.api.ServiceInfo;\n+import org.nuxeo.apidoc.api.NuxeoArtifact;\n+import org.nuxeo.apidoc.api.OperationInfo;\n import org.nuxeo.apidoc.snapshot.DistributionSnapshot;\n import org.nuxeo.apidoc.snapshot.SnapshotManager;\n+import org.nuxeo.common.utils.FileUtils;\n import org.nuxeo.ecm.core.api.CoreSession;\n-import org.nuxeo.ecm.core.api.DocumentModel;\n-import org.nuxeo.runtime.api.Framework;\n import org.nuxeo.runtime.test.runner.Features;\n import org.nuxeo.runtime.test.runner.FeaturesRunner;\n \n @RunWith(FeaturesRunner.class)\n @Features({ RuntimeSnaphotFeature.class })\n public class TestSnapshotPersist {\n \n-    private static final Log log = LogFactory.getLog(TestSnapshotPersist.class);\n+    // helper for quicker update when running tests locally\n+    // public static final boolean UPDATE_REFERENCE_FILES_ON_FAILURE = true;\n+    public static final boolean UPDATE_REFERENCE_FILES_ON_FAILURE = false;\n \n     @Inject\n     protected CoreSession session;\n \n     @Inject\n     protected SnapshotManager snapshotManager;\n \n-    protected String dumpSnapshot(DistributionSnapshot snap) {\n-        StringBuilder sb = new StringBuilder();\n+    @Test\n+    public void testSnapshot() throws IOException {\n+        DistributionSnapshot snapshot = snapshotManager.getRuntimeSnapshot();\n+        checkDistributionSnapshot(snapshot);\n+    }\n \n-        BundleGroupTreeHelper bgth = new BundleGroupTreeHelper(snap);\n+    @Test\n+    public void testPersist() throws IOException {\n+        DistributionSnapshot snapshot = snapshotManager.persistRuntimeSnapshot(session);\n+        assertNotNull(snapshot);\n+        checkDistributionSnapshot(snapshot);\n+\n+        DistributionSnapshot persisted = snapshotManager.getSnapshot(snapshot.getKey(), session);\n+        assertNotNull(persisted);\n+        checkDistributionSnapshot(persisted);\n+    }\n+\n+    protected void checkDistributionSnapshot(DistributionSnapshot snapshot) throws IOException {\n+        checkBundleGroups(snapshot);\n+        checkBundles(snapshot);\n+        checkComponents(snapshot);\n+        checkServices(snapshot);\n+        checkExtensionPoints(snapshot);\n+        checkContributions(snapshot);\n+        checkOperations(snapshot);\n+    }\n+\n+    protected void checkBundleGroups(DistributionSnapshot snapshot) throws IOException {\n+        StringBuilder sb = new StringBuilder();\n+        BundleGroupTreeHelper bgth = new BundleGroupTreeHelper(snapshot);\n         List<BundleGroupFlatTree> tree = bgth.getBundleGroupTree();\n         for (BundleGroupFlatTree info : tree) {\n-            String pad = \" \";\n-            for (int i = 0; i <= info.getLevel(); i++) {\n-                pad += \" \";\n-            }\n-            sb.append(pad)\n-            .append(\"- \")\n-            .append(info.getGroup().getName())\n-            .append(\"(\")\n-            .append(info.getGroup().getId())\n-            .append(\")\");\n-            sb.append(\" *** \");\n-            sb.append(info.getGroup().getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(String.format(\"%s- %s (%s) *** %s\\n\", //\n+                    StringUtils.repeat(\"  \", info.getLevel()), //\n+                    info.getGroup().getName(), //\n+                    info.getGroup().getId(), //\n+                    info.getGroup().getHierarchyPath()) //\n+            );\n         }\n+        checkContentEquals(\"apidoc_snapshot/bundlegroups.txt\", sb.toString());\n+    }\n \n-        List<String> bids = snap.getBundleIds();\n-        List<String> cids = snap.getComponentIds();\n-        List<String> sids = snap.getServiceIds();\n-        List<String> epids = snap.getExtensionPointIds();\n-        List<String> exids = snap.getContributionIds();\n+    protected String represent(NuxeoArtifact artifact) {\n+        return String.format(\"%s: %s *** %s\\n\", //\n+                artifact.getArtifactType(), //\n+                artifact.getId(), //\n+                artifact.getHierarchyPath() //\n+        );\n+    }\n \n+    protected void checkBundles(DistributionSnapshot snapshot) throws IOException {\n+        List<String> bids = snapshot.getBundleIds();\n         Collections.sort(bids);\n-        Collections.sort(cids);\n-        Collections.sort(sids);\n-        Collections.sort(epids);\n-        Collections.sort(exids);\n \n+        StringBuilder sb = new StringBuilder();\n         for (String bid : bids) {\n-            sb.append(\"bundle : \").append(bid);\n-            BundleInfo bi = snap.getBundle(bid);\n-            sb.append(\" *** \");\n-            sb.append(bi.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getBundle(bid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/bundles.txt\", sb.toString());\n+    }\n+\n+    protected void checkComponents(DistributionSnapshot snapshot) throws IOException {\n+        List<String> cids = snapshot.getComponentIds();\n+        Collections.sort(cids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String cid : cids) {\n-            sb.append(\"component : \").append(cid);\n-            sb.append(\" *** \");\n-            ComponentInfo ci = snap.getComponent(cid);\n-            sb.append(ci.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getComponent(cid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/components.txt\", sb.toString());\n+    }\n+\n+    protected void checkServices(DistributionSnapshot snapshot) throws IOException {\n+        List<String> sids = snapshot.getServiceIds();\n+        Collections.sort(sids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String sid : sids) {\n-            sb.append(\"service : \").append(sid);\n-            sb.append(\" *** \");\n-            ServiceInfo si = snap.getService(sid);\n-            sb.append(si.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getService(sid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/services.txt\", sb.toString());\n+    }\n+\n+    protected void checkExtensionPoints(DistributionSnapshot snapshot) throws IOException {\n+        List<String> epids = snapshot.getExtensionPointIds();\n+        Collections.sort(epids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String epid : epids) {\n-            sb.append(\"extensionPoint : \").append(epid);\n-            sb.append(\" *** \");\n-            ExtensionPointInfo epi = snap.getExtensionPoint(epid);\n-            sb.append(epi.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getExtensionPoint(epid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/extensionpoints.txt\", sb.toString());\n+    }\n+\n+    protected void checkContributions(DistributionSnapshot snapshot) throws IOException {\n+        List<String> exids = snapshot.getContributionIds();\n+        Collections.sort(exids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String exid : exids) {\n-            sb.append(\"contribution : \").append(exid);\n-            sb.append(\" *** \");\n-            ExtensionInfo exi = snap.getContribution(exid);\n-            sb.append(exi.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getContribution(exid)));\n         }\n-        return sb.toString();\n+\n+        checkContentEquals(\"apidoc_snapshot/contributions.txt\", sb.toString());\n     }\n \n-    @Test\n-    public void testPersist() throws Exception {\n-        DistributionSnapshot runtimeSnapshot = snapshotManager.getRuntimeSnapshot();\n-        String rtDump = dumpSnapshot(runtimeSnapshot);\n-\n-        DistributionSnapshot persistent = snapshotManager.persistRuntimeSnapshot(session);\n-        assertNotNull(persistent);\n-\n-        persistent = snapshotManager.getSnapshot(runtimeSnapshot.getKey(), session);\n-        assertNotNull(persistent);\n-\n-        // DocumentModelList docs = session.query(\"select * from NXBundle\");\n-        // for (DocumentModel doc : docs) {\n-        // log.info(\"Bundle : \" + doc.getTitle() + \" --- \" +\n-        // doc.getPathAsString());\n-        // }\n-        String pDump = dumpSnapshot(persistent);\n-\n-        // String[] rtDumpLines = rtDump.trim().split(\"\\n\");\n-        // String[] pDumpLines = pDump.trim().split(\"\\n\");\n-        // assertEquals(rtDumpLines.length, pDumpLines.length);\n-        // for (int i = 0; i < rtDumpLines.length; i++) {\n-        // assertEquals(rtDumpLines[i], pDumpLines[i]);\n-        // }\n-        assertEquals(rtDump, pDump);\n+    protected void checkOperations(DistributionSnapshot snapshot) throws IOException {\n+        List<OperationInfo> ops = snapshot.getOperations();\n+        Collections.sort(ops, new Comparator<OperationInfo>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9914c4474a79d963c3f6cfca7ee6ea4204ca7db"}, "originalPosition": 261}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA3MDQwMg==", "bodyText": "ops.forEach(op -> sb.append(represent(op)))", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403070402", "createdAt": "2020-04-03T15:03:56Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-repo/src/test/java/org/nuxeo/apidoc/test/TestSnapshotPersist.java", "diffHunk": "@@ -15,169 +15,219 @@\n  *\n  * Contributors:\n  *     Thierry Delprat\n+ *     Anahide Tchertchian\n  */\n package org.nuxeo.apidoc.test;\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n \n+import java.io.ByteArrayInputStream;\n import java.io.File;\n-import java.io.FileInputStream;\n-import java.io.FileOutputStream;\n import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStream;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n import java.util.Collections;\n+import java.util.Comparator;\n import java.util.List;\n \n import javax.inject.Inject;\n \n-import org.apache.commons.logging.Log;\n-import org.apache.commons.logging.LogFactory;\n+import org.apache.commons.lang.SystemUtils;\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.ComparisonFailure;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.nuxeo.apidoc.api.BundleGroupFlatTree;\n import org.nuxeo.apidoc.api.BundleGroupTreeHelper;\n-import org.nuxeo.apidoc.api.BundleInfo;\n-import org.nuxeo.apidoc.api.ComponentInfo;\n-import org.nuxeo.apidoc.api.ExtensionInfo;\n-import org.nuxeo.apidoc.api.ExtensionPointInfo;\n-import org.nuxeo.apidoc.api.ServiceInfo;\n+import org.nuxeo.apidoc.api.NuxeoArtifact;\n+import org.nuxeo.apidoc.api.OperationInfo;\n import org.nuxeo.apidoc.snapshot.DistributionSnapshot;\n import org.nuxeo.apidoc.snapshot.SnapshotManager;\n+import org.nuxeo.common.utils.FileUtils;\n import org.nuxeo.ecm.core.api.CoreSession;\n-import org.nuxeo.ecm.core.api.DocumentModel;\n-import org.nuxeo.runtime.api.Framework;\n import org.nuxeo.runtime.test.runner.Features;\n import org.nuxeo.runtime.test.runner.FeaturesRunner;\n \n @RunWith(FeaturesRunner.class)\n @Features({ RuntimeSnaphotFeature.class })\n public class TestSnapshotPersist {\n \n-    private static final Log log = LogFactory.getLog(TestSnapshotPersist.class);\n+    // helper for quicker update when running tests locally\n+    // public static final boolean UPDATE_REFERENCE_FILES_ON_FAILURE = true;\n+    public static final boolean UPDATE_REFERENCE_FILES_ON_FAILURE = false;\n \n     @Inject\n     protected CoreSession session;\n \n     @Inject\n     protected SnapshotManager snapshotManager;\n \n-    protected String dumpSnapshot(DistributionSnapshot snap) {\n-        StringBuilder sb = new StringBuilder();\n+    @Test\n+    public void testSnapshot() throws IOException {\n+        DistributionSnapshot snapshot = snapshotManager.getRuntimeSnapshot();\n+        checkDistributionSnapshot(snapshot);\n+    }\n \n-        BundleGroupTreeHelper bgth = new BundleGroupTreeHelper(snap);\n+    @Test\n+    public void testPersist() throws IOException {\n+        DistributionSnapshot snapshot = snapshotManager.persistRuntimeSnapshot(session);\n+        assertNotNull(snapshot);\n+        checkDistributionSnapshot(snapshot);\n+\n+        DistributionSnapshot persisted = snapshotManager.getSnapshot(snapshot.getKey(), session);\n+        assertNotNull(persisted);\n+        checkDistributionSnapshot(persisted);\n+    }\n+\n+    protected void checkDistributionSnapshot(DistributionSnapshot snapshot) throws IOException {\n+        checkBundleGroups(snapshot);\n+        checkBundles(snapshot);\n+        checkComponents(snapshot);\n+        checkServices(snapshot);\n+        checkExtensionPoints(snapshot);\n+        checkContributions(snapshot);\n+        checkOperations(snapshot);\n+    }\n+\n+    protected void checkBundleGroups(DistributionSnapshot snapshot) throws IOException {\n+        StringBuilder sb = new StringBuilder();\n+        BundleGroupTreeHelper bgth = new BundleGroupTreeHelper(snapshot);\n         List<BundleGroupFlatTree> tree = bgth.getBundleGroupTree();\n         for (BundleGroupFlatTree info : tree) {\n-            String pad = \" \";\n-            for (int i = 0; i <= info.getLevel(); i++) {\n-                pad += \" \";\n-            }\n-            sb.append(pad)\n-            .append(\"- \")\n-            .append(info.getGroup().getName())\n-            .append(\"(\")\n-            .append(info.getGroup().getId())\n-            .append(\")\");\n-            sb.append(\" *** \");\n-            sb.append(info.getGroup().getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(String.format(\"%s- %s (%s) *** %s\\n\", //\n+                    StringUtils.repeat(\"  \", info.getLevel()), //\n+                    info.getGroup().getName(), //\n+                    info.getGroup().getId(), //\n+                    info.getGroup().getHierarchyPath()) //\n+            );\n         }\n+        checkContentEquals(\"apidoc_snapshot/bundlegroups.txt\", sb.toString());\n+    }\n \n-        List<String> bids = snap.getBundleIds();\n-        List<String> cids = snap.getComponentIds();\n-        List<String> sids = snap.getServiceIds();\n-        List<String> epids = snap.getExtensionPointIds();\n-        List<String> exids = snap.getContributionIds();\n+    protected String represent(NuxeoArtifact artifact) {\n+        return String.format(\"%s: %s *** %s\\n\", //\n+                artifact.getArtifactType(), //\n+                artifact.getId(), //\n+                artifact.getHierarchyPath() //\n+        );\n+    }\n \n+    protected void checkBundles(DistributionSnapshot snapshot) throws IOException {\n+        List<String> bids = snapshot.getBundleIds();\n         Collections.sort(bids);\n-        Collections.sort(cids);\n-        Collections.sort(sids);\n-        Collections.sort(epids);\n-        Collections.sort(exids);\n \n+        StringBuilder sb = new StringBuilder();\n         for (String bid : bids) {\n-            sb.append(\"bundle : \").append(bid);\n-            BundleInfo bi = snap.getBundle(bid);\n-            sb.append(\" *** \");\n-            sb.append(bi.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getBundle(bid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/bundles.txt\", sb.toString());\n+    }\n+\n+    protected void checkComponents(DistributionSnapshot snapshot) throws IOException {\n+        List<String> cids = snapshot.getComponentIds();\n+        Collections.sort(cids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String cid : cids) {\n-            sb.append(\"component : \").append(cid);\n-            sb.append(\" *** \");\n-            ComponentInfo ci = snap.getComponent(cid);\n-            sb.append(ci.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getComponent(cid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/components.txt\", sb.toString());\n+    }\n+\n+    protected void checkServices(DistributionSnapshot snapshot) throws IOException {\n+        List<String> sids = snapshot.getServiceIds();\n+        Collections.sort(sids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String sid : sids) {\n-            sb.append(\"service : \").append(sid);\n-            sb.append(\" *** \");\n-            ServiceInfo si = snap.getService(sid);\n-            sb.append(si.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getService(sid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/services.txt\", sb.toString());\n+    }\n+\n+    protected void checkExtensionPoints(DistributionSnapshot snapshot) throws IOException {\n+        List<String> epids = snapshot.getExtensionPointIds();\n+        Collections.sort(epids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String epid : epids) {\n-            sb.append(\"extensionPoint : \").append(epid);\n-            sb.append(\" *** \");\n-            ExtensionPointInfo epi = snap.getExtensionPoint(epid);\n-            sb.append(epi.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getExtensionPoint(epid)));\n         }\n \n+        checkContentEquals(\"apidoc_snapshot/extensionpoints.txt\", sb.toString());\n+    }\n+\n+    protected void checkContributions(DistributionSnapshot snapshot) throws IOException {\n+        List<String> exids = snapshot.getContributionIds();\n+        Collections.sort(exids);\n+\n+        StringBuilder sb = new StringBuilder();\n         for (String exid : exids) {\n-            sb.append(\"contribution : \").append(exid);\n-            sb.append(\" *** \");\n-            ExtensionInfo exi = snap.getContribution(exid);\n-            sb.append(exi.getHierarchyPath());\n-            sb.append(\"\\n\");\n+            sb.append(represent(snapshot.getContribution(exid)));\n         }\n-        return sb.toString();\n+\n+        checkContentEquals(\"apidoc_snapshot/contributions.txt\", sb.toString());\n     }\n \n-    @Test\n-    public void testPersist() throws Exception {\n-        DistributionSnapshot runtimeSnapshot = snapshotManager.getRuntimeSnapshot();\n-        String rtDump = dumpSnapshot(runtimeSnapshot);\n-\n-        DistributionSnapshot persistent = snapshotManager.persistRuntimeSnapshot(session);\n-        assertNotNull(persistent);\n-\n-        persistent = snapshotManager.getSnapshot(runtimeSnapshot.getKey(), session);\n-        assertNotNull(persistent);\n-\n-        // DocumentModelList docs = session.query(\"select * from NXBundle\");\n-        // for (DocumentModel doc : docs) {\n-        // log.info(\"Bundle : \" + doc.getTitle() + \" --- \" +\n-        // doc.getPathAsString());\n-        // }\n-        String pDump = dumpSnapshot(persistent);\n-\n-        // String[] rtDumpLines = rtDump.trim().split(\"\\n\");\n-        // String[] pDumpLines = pDump.trim().split(\"\\n\");\n-        // assertEquals(rtDumpLines.length, pDumpLines.length);\n-        // for (int i = 0; i < rtDumpLines.length; i++) {\n-        // assertEquals(rtDumpLines[i], pDumpLines[i]);\n-        // }\n-        assertEquals(rtDump, pDump);\n+    protected void checkOperations(DistributionSnapshot snapshot) throws IOException {\n+        List<OperationInfo> ops = snapshot.getOperations();\n+        Collections.sort(ops, new Comparator<OperationInfo>() {\n+            @Override\n+            public int compare(OperationInfo arg0, OperationInfo arg1) {\n+                return arg0.getId().compareTo(arg1.getId());\n+            }\n+        });\n \n+        StringBuilder sb = new StringBuilder();\n+        for (OperationInfo op : ops) {\n+            sb.append(represent(op));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9914c4474a79d963c3f6cfca7ee6ea4204ca7db"}, "originalPosition": 270}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f010f40ef424099c27fe078c3a9b1d57f201121", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8f010f40ef424099c27fe078c3a9b1d57f201121", "committedDate": "2020-04-02T16:14:06Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}, "afterCommit": {"oid": "ed485431be78fc33d5db9e32f2589e1b155d9888", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/ed485431be78fc33d5db9e32f2589e1b155d9888", "committedDate": "2020-04-03T15:38:43Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8033a39575170ba1e83f35b6cb2ac42a7e70860d", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8033a39575170ba1e83f35b6cb2ac42a7e70860d", "committedDate": "2020-04-03T16:09:53Z", "message": "NXP-19849: handle multiple contributions to the same extension point in the same component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3db25078152a1d12a1653ad1cd65518501532c07", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3db25078152a1d12a1653ad1cd65518501532c07", "committedDate": "2020-04-03T16:09:53Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed485431be78fc33d5db9e32f2589e1b155d9888", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/ed485431be78fc33d5db9e32f2589e1b155d9888", "committedDate": "2020-04-03T15:38:43Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}, "afterCommit": {"oid": "3db25078152a1d12a1653ad1cd65518501532c07", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3db25078152a1d12a1653ad1cd65518501532c07", "committedDate": "2020-04-03T16:09:53Z", "message": "NXP-19849: order contribs so that it matches order in the original XML file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3Mzk5MTE2", "url": "https://github.com/nuxeo/nuxeo/pull/3882#pullrequestreview-387399116", "createdAt": "2020-04-03T16:18:17Z", "commit": {"oid": "3db25078152a1d12a1653ad1cd65518501532c07"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MTA1OTI2", "url": "https://github.com/nuxeo/nuxeo/pull/3882#pullrequestreview-388105926", "createdAt": "2020-04-06T10:06:24Z", "commit": {"oid": "3db25078152a1d12a1653ad1cd65518501532c07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMDowNjoyNFrOGBQpMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMDowNjoyNFrOGBQpMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk3NDQ1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @Features({ RuntimeSnaphotFeature.class })\n          \n          \n            \n            @Features(RuntimeSnaphotFeature.class)", "url": "https://github.com/nuxeo/nuxeo/pull/3882#discussion_r403974451", "createdAt": "2020-04-06T10:06:24Z", "author": {"login": "troger"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-repo/src/test/java/org/nuxeo/apidoc/test/TestExportImport.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * (C) Copyright 2006-2016 Nuxeo SA (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Thierry Delprat\n+ */\n+package org.nuxeo.apidoc.test;\n+\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.apidoc.snapshot.DistributionSnapshot;\n+import org.nuxeo.apidoc.snapshot.SnapshotManager;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.runtime.api.Framework;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features({ RuntimeSnaphotFeature.class })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3db25078152a1d12a1653ad1cd65518501532c07"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58f3fcb18036f527443176280e523df820fcb2b3", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/58f3fcb18036f527443176280e523df820fcb2b3", "committedDate": "2020-04-06T10:16:59Z", "message": "NXP-19849: cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MTI4MDc3", "url": "https://github.com/nuxeo/nuxeo/pull/3882#pullrequestreview-388128077", "createdAt": "2020-04-06T10:39:04Z", "commit": {"oid": "58f3fcb18036f527443176280e523df820fcb2b3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MTI4NDIx", "url": "https://github.com/nuxeo/nuxeo/pull/3882#pullrequestreview-388128421", "createdAt": "2020-04-06T10:39:37Z", "commit": {"oid": "58f3fcb18036f527443176280e523df820fcb2b3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4818, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}