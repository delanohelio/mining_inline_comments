{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNjEwNDMw", "number": 4144, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMToyNDoyOFrOEFBnjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjoxNjowM1rOEFCZpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzA0ODQ3OnYy", "diffSide": "RIGHT", "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/reporter/DatadogTraceReporter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMToyNDoyOFrOGjAkgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODowMDo1OVrOGjnOzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM2MjY5MA==", "bodyText": "Is this really needed as a WARN? Some for all other existing reporters actually...", "url": "https://github.com/nuxeo/nuxeo/pull/4144#discussion_r439362690", "createdAt": "2020-06-12T11:24:28Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/reporter/DatadogTraceReporter.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     bdelbosc\n+ */\n+package org.nuxeo.runtime.metrics.reporter;\n+\n+import java.net.MalformedURLException;\n+import java.util.Set;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.nuxeo.common.utils.DurationUtils;\n+import org.nuxeo.runtime.metrics.AbstractMetricsReporter;\n+\n+import io.dropwizard.metrics5.MetricAttribute;\n+import io.dropwizard.metrics5.MetricFilter;\n+import io.dropwizard.metrics5.MetricRegistry;\n+import io.opencensus.common.Duration;\n+import io.opencensus.exporter.trace.datadog.DatadogTraceConfiguration;\n+import io.opencensus.exporter.trace.datadog.DatadogTraceExporter;\n+\n+/**\n+ * Reports traces to Datadog agent.\n+ *\n+ * @since 11.1\n+ */\n+public class DatadogTraceReporter extends AbstractMetricsReporter {\n+\n+    private static final Logger log = LogManager.getLogger(DatadogTraceReporter.class);\n+\n+    protected static final String TYPE_OPTION = \"type\";\n+\n+    protected static final String DEFAULT_TYPE = \"web\";\n+\n+    protected boolean activated;\n+\n+    @Override\n+    public void start(MetricRegistry registry, MetricFilter filter, Set<MetricAttribute> deniedExpansions) {\n+        log.warn(\"Creating Datadog Trace reporter\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4e647481e051956c9f56d57e88545073fd9edf"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5NjEwOQ==", "bodyText": "yes, it should be done at info level with proper log4j2 conf, this will be part of another cleaning PR with the other reporters.", "url": "https://github.com/nuxeo/nuxeo/pull/4144#discussion_r439996109", "createdAt": "2020-06-15T08:00:59Z", "author": {"login": "bdelbosc"}, "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/reporter/DatadogTraceReporter.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     bdelbosc\n+ */\n+package org.nuxeo.runtime.metrics.reporter;\n+\n+import java.net.MalformedURLException;\n+import java.util.Set;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.nuxeo.common.utils.DurationUtils;\n+import org.nuxeo.runtime.metrics.AbstractMetricsReporter;\n+\n+import io.dropwizard.metrics5.MetricAttribute;\n+import io.dropwizard.metrics5.MetricFilter;\n+import io.dropwizard.metrics5.MetricRegistry;\n+import io.opencensus.common.Duration;\n+import io.opencensus.exporter.trace.datadog.DatadogTraceConfiguration;\n+import io.opencensus.exporter.trace.datadog.DatadogTraceExporter;\n+\n+/**\n+ * Reports traces to Datadog agent.\n+ *\n+ * @since 11.1\n+ */\n+public class DatadogTraceReporter extends AbstractMetricsReporter {\n+\n+    private static final Logger log = LogManager.getLogger(DatadogTraceReporter.class);\n+\n+    protected static final String TYPE_OPTION = \"type\";\n+\n+    protected static final String DEFAULT_TYPE = \"web\";\n+\n+    protected boolean activated;\n+\n+    @Override\n+    public void start(MetricRegistry registry, MetricFilter filter, Set<MetricAttribute> deniedExpansions) {\n+        log.warn(\"Creating Datadog Trace reporter\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM2MjY5MA=="}, "originalCommit": {"oid": "3c4e647481e051956c9f56d57e88545073fd9edf"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzE2MjkwOnYy", "diffSide": "RIGHT", "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/AbstractMetricsReporter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjoxMDo0NlrOGjBrdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjoxMDo0NlrOGjBrdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM4MDg1NA==", "bodyText": "Import it?", "url": "https://github.com/nuxeo/nuxeo/pull/4144#discussion_r439380854", "createdAt": "2020-06-12T12:10:46Z", "author": {"login": "troger"}, "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/AbstractMetricsReporter.java", "diffHunk": "@@ -28,15 +28,60 @@\n \n import org.nuxeo.runtime.api.Framework;\n \n+import io.opencensus.trace.Tracing;\n+import io.opencensus.trace.config.TraceConfig;\n+import io.opencensus.trace.config.TraceParams;\n+import io.opencensus.trace.samplers.Samplers;\n+\n /**\n  * @since 11.1\n  */\n public abstract class AbstractMetricsReporter implements MetricsReporter {\n \n+    public static final String URL_OPTION = \"url\";\n+\n+    public static final String TIMEOUT_OPTION = \"timeout\";\n+\n+    public static final java.time.Duration DEFAULT_TIMEOUT = java.time.Duration.ofSeconds(10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4e647481e051956c9f56d57e88545073fd9edf"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzE3NjY4OnYy", "diffSide": "RIGHT", "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/reporter/PrometheusReporter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjoxNjowM1rOGjB0Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODowODo0MVrOGjnfCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM4MzA4Mw==", "bodyText": "IllegalStateException maybe? or the IOException is always linked to the port param?", "url": "https://github.com/nuxeo/nuxeo/pull/4144#discussion_r439383083", "createdAt": "2020-06-12T12:16:03Z", "author": {"login": "troger"}, "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/reporter/PrometheusReporter.java", "diffHunk": "@@ -69,7 +71,7 @@ public void start(MetricRegistry registry, MetricFilter filter, Set<MetricAttrib\n         try {\n             server = new HTTPServer(port, true);\n         } catch (IOException e) {\n-            throw new RuntimeException(\"Cannot start Prometheus on port \" + port, e);\n+            throw new IllegalArgumentException(\"Cannot start Prometheus on port \" + port, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4e647481e051956c9f56d57e88545073fd9edf"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMDI2NQ==", "bodyText": "Yes, port conflict is the main cause of IOException here.", "url": "https://github.com/nuxeo/nuxeo/pull/4144#discussion_r440000265", "createdAt": "2020-06-15T08:08:41Z", "author": {"login": "bdelbosc"}, "path": "modules/runtime/nuxeo-runtime-metrics/src/main/java/org/nuxeo/runtime/metrics/reporter/PrometheusReporter.java", "diffHunk": "@@ -69,7 +71,7 @@ public void start(MetricRegistry registry, MetricFilter filter, Set<MetricAttrib\n         try {\n             server = new HTTPServer(port, true);\n         } catch (IOException e) {\n-            throw new RuntimeException(\"Cannot start Prometheus on port \" + port, e);\n+            throw new IllegalArgumentException(\"Cannot start Prometheus on port \" + port, e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM4MzA4Mw=="}, "originalCommit": {"oid": "3c4e647481e051956c9f56d57e88545073fd9edf"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4108, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}