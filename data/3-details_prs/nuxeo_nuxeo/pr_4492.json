{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NDQyMjI5", "number": 4492, "title": "Feature NXP-29836 gcp chunk upload", "bodyText": "", "createdAt": "2020-11-24T12:23:54Z", "url": "https://github.com/nuxeo/nuxeo/pull/4492", "merged": true, "mergeCommit": {"oid": "cc38b75b4e38061a19a2c6bdbe8327e6098bf1af"}, "closed": true, "closedAt": "2020-11-25T11:59:41Z", "author": {"login": "kevinleturc"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfmwjngH2gAyNTI2NDQyMjI5OjYzNGIzOGViNjgzMTM3ODlkNDNjYzVmMTViY2QwMTk2NjdmY2I1OWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdf45ALAFqTUzODIwNDgzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "634b38eb68313789d43cc5f15bcd019667fcb59c", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/634b38eb68313789d43cc5f15bcd019667fcb59c", "committedDate": "2020-11-24T09:58:19Z", "message": "NXP-29836: Cleanup / Format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NDQyMjY2", "url": "https://github.com/nuxeo/nuxeo/pull/4492#pullrequestreview-537442266", "createdAt": "2020-11-24T12:28:15Z", "commit": {"oid": "9aa9d8476c28e3627c5f431f546eec5349dfdd49"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMjoyODoxNVrOH4-mGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMjozNDoyOVrOH4-z5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUwNzg2Nw==", "bodyText": "Mo -> MB", "url": "https://github.com/nuxeo/nuxeo/pull/4492#discussion_r529507867", "createdAt": "2020-11-24T12:28:15Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-binarymanager-cloud/nuxeo-core-binarymanager-gcp/src/main/java/org/nuxeo/ecm/core/storage/gcp/GoogleStorageBinaryManager.java", "diffHunk": "@@ -76,6 +79,16 @@\n \n     public static final String BUCKET_PREFIX_PROPERTY = \"storage.bucket_prefix\";\n \n+    /** @since 11.4 */\n+    public static final String UPLOAD_CHUNK_SIZE_PROPERTY = \"storage.upload.chunk.size\";\n+\n+    /**\n+     * Default is taken from {@link com.google.cloud.BaseWriteChannel}.\n+     *\n+     * @since 11.4\n+     */\n+    public static final int DEFAULT_UPLOAD_CHUNK_SIZE = 2048 * 1024; // 2 Mo", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aa9d8476c28e3627c5f431f546eec5349dfdd49"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUxMTM5OA==", "bodyText": "bufferLength definition can be moved inside the try.\nProbably buffer too.", "url": "https://github.com/nuxeo/nuxeo/pull/4492#discussion_r529511398", "createdAt": "2020-11-24T12:34:29Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-binarymanager-cloud/nuxeo-core-binarymanager-gcp/src/main/java/org/nuxeo/ecm/core/storage/gcp/GoogleStorageBinaryManager.java", "diffHunk": "@@ -186,8 +203,14 @@ public void storeFile(String digest, File file) {\n             String key = bucketPrefix + digest;\n             // try to get the blob's metadata to check if it exists\n             if (bucket.get(key) == null) {\n-                try (var fis = new FileInputStream(file)) {\n-                    bucket.create(key, fis);\n+                int bufferLength;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aa9d8476c28e3627c5f431f546eec5349dfdd49"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b4b89d7b58087ab87e50307528db8cdf2875e12", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/2b4b89d7b58087ab87e50307528db8cdf2875e12", "committedDate": "2020-11-24T12:22:03Z", "message": "NXP-29836: Fix gcp-credentials.json retrieval when property is empty"}, "afterCommit": {"oid": "ab5d776c5b692fcb89dfd2b49cea92bcd0cfa0ad", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/ab5d776c5b692fcb89dfd2b49cea92bcd0cfa0ad", "committedDate": "2020-11-24T12:57:32Z", "message": "NXP-29836: Fix gcp-credentials.json retrieval when property is empty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "746a434b58224a82e5dc43a2e3cd2ba1b853fb57", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/746a434b58224a82e5dc43a2e3cd2ba1b853fb57", "committedDate": "2020-11-24T13:08:56Z", "message": "NXP-29836: Upload to GCS by chunks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b980b16ad5ac7087cee994d0e4c85938923a499", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/4b980b16ad5ac7087cee994d0e4c85938923a499", "committedDate": "2020-11-24T13:08:59Z", "message": "NXP-29836: Fix gcp-credentials.json retrieval when property is empty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab5d776c5b692fcb89dfd2b49cea92bcd0cfa0ad", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/ab5d776c5b692fcb89dfd2b49cea92bcd0cfa0ad", "committedDate": "2020-11-24T12:57:32Z", "message": "NXP-29836: Fix gcp-credentials.json retrieval when property is empty"}, "afterCommit": {"oid": "4b980b16ad5ac7087cee994d0e4c85938923a499", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/4b980b16ad5ac7087cee994d0e4c85938923a499", "committedDate": "2020-11-24T13:08:59Z", "message": "NXP-29836: Fix gcp-credentials.json retrieval when property is empty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NDgxMDUx", "url": "https://github.com/nuxeo/nuxeo/pull/4492#pullrequestreview-537481051", "createdAt": "2020-11-24T13:17:50Z", "commit": {"oid": "4b980b16ad5ac7087cee994d0e4c85938923a499"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MjA0ODMx", "url": "https://github.com/nuxeo/nuxeo/pull/4492#pullrequestreview-538204831", "createdAt": "2020-11-25T07:05:50Z", "commit": {"oid": "4b980b16ad5ac7087cee994d0e4c85938923a499"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4904, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}