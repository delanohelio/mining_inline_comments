{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNjYzODI2", "number": 4008, "title": "NXP-28798: Gracefully log missing DocumentRoutes", "bodyText": "", "createdAt": "2020-05-05T17:51:18Z", "url": "https://github.com/nuxeo/nuxeo/pull/4008", "merged": true, "mergeCommit": {"oid": "bf0d78ef34f34bb7660ce7a348027eab40edccc4"}, "closed": true, "closedAt": "2020-06-09T13:42:49Z", "author": {"login": "NourNuxeo"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceX_oqAFqTQwNjAyODUwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcplRPpAFqTQyNzE2MjcwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDI4NTA3", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-406028507", "createdAt": "2020-05-05T18:00:40Z", "commit": {"oid": "cb9bbbae1bc29ffae3bb8011b875b8651927473b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODowMDo0MFrOGQ1PHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODowMDo0MFrOGQ1PHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwMjYyMw==", "bodyText": "If you want to log the stack trace you need log.error(e, e).\nIf you don't, please add a comment saying so because it's surprising to hide it.", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r420302623", "createdAt": "2020-05-05T18:00:40Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-platform-document-routing/nuxeo-routing-core/src/main/java/org/nuxeo/ecm/platform/routing/core/io/TaskWriter.java", "diffHunk": "@@ -219,6 +224,9 @@ public void writeEntityBody(Task item, JsonGenerator jg) throws IOException {\n \n                 jg.writeEndObject();\n             }\n+        } catch (DocumentNotFoundException e) {\n+            // If the DocumentRoute is not found (deleted for example), the TaskWriter fails.\n+            log.error(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb9bbbae1bc29ffae3bb8011b875b8651927473b"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb9bbbae1bc29ffae3bb8011b875b8651927473b", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/cb9bbbae1bc29ffae3bb8011b875b8651927473b", "committedDate": "2020-05-05T17:49:56Z", "message": "NXP-28798: Gracefully log missing document routs"}, "afterCommit": {"oid": "242974b82be90e4da47a3742b1055151d85c636b", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/242974b82be90e4da47a3742b1055151d85c636b", "committedDate": "2020-05-05T18:07:18Z", "message": "NXP-28798: Gracefully log missing document routs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "242974b82be90e4da47a3742b1055151d85c636b", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/242974b82be90e4da47a3742b1055151d85c636b", "committedDate": "2020-05-05T18:07:18Z", "message": "NXP-28798: Gracefully log missing document routs"}, "afterCommit": {"oid": "a875bf2a02bafa3d8935390a0c386216164d46cd", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a875bf2a02bafa3d8935390a0c386216164d46cd", "committedDate": "2020-05-05T18:58:11Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDg5MzQ0", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-406089344", "createdAt": "2020-05-05T19:26:10Z", "commit": {"oid": "a875bf2a02bafa3d8935390a0c386216164d46cd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToyNjoxMVrOGQ4RxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToyNjoxMVrOGQ4RxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1MjQ1Mw==", "bodyText": "If a sysadmin can't do much about it and the application can keep functioning, I'd prefer a WARN.\nAlso where is the exception being thrown exactly? Could you add a full stack trace in the NXP ticket please. I'm asking because the try/catch has a very large scope, which is bad if we can have a smaller one.\nFrom a quick test it seems to appear in nodeAccessRunner.runUnrestricted() so the try/catch should be around that, and you should log.warn(\"Failed to get workflow instance\", e)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r420352453", "createdAt": "2020-05-05T19:26:11Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-platform-document-routing/nuxeo-routing-core/src/main/java/org/nuxeo/ecm/platform/routing/core/io/TaskWriter.java", "diffHunk": "@@ -219,6 +224,9 @@ public void writeEntityBody(Task item, JsonGenerator jg) throws IOException {\n \n                 jg.writeEndObject();\n             }\n+        } catch (DocumentNotFoundException e) {\n+            // If the DocumentRoute is not found (deleted for example), the TaskWriter fails.\n+            log.error(e, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a875bf2a02bafa3d8935390a0c386216164d46cd"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a875bf2a02bafa3d8935390a0c386216164d46cd", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a875bf2a02bafa3d8935390a0c386216164d46cd", "committedDate": "2020-05-05T18:58:11Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}, "afterCommit": {"oid": "cf17228d10bda9b5de0422fe7e35979c73a6c9d1", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/cf17228d10bda9b5de0422fe7e35979c73a6c9d1", "committedDate": "2020-05-05T23:11:39Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf17228d10bda9b5de0422fe7e35979c73a6c9d1", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/cf17228d10bda9b5de0422fe7e35979c73a6c9d1", "committedDate": "2020-05-05T23:11:39Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}, "afterCommit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/05f3fc68aeed664c0c0f8ebf306cae1be4682c33", "committedDate": "2020-05-06T06:39:07Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MzQ5MzA5", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-406349309", "createdAt": "2020-05-06T07:06:48Z", "commit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNzowNjo0OFrOGRGaiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNzowNjo0OFrOGRGaiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU4NDA3Mw==", "bodyText": "Why not fixing the root cause in NodeAccessRunner instead of catching?", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r420584073", "createdAt": "2020-05-06T07:06:48Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-platform-document-routing/nuxeo-routing-core/src/main/java/org/nuxeo/ecm/platform/routing/core/io/TaskWriter.java", "diffHunk": "@@ -108,7 +113,12 @@ public void writeEntityBody(Task item, JsonGenerator jg) throws IOException {\n             if (StringUtils.isNotBlank(workflowInstanceId)) {\n                 NodeAccessRunner nodeAccessRunner = new NodeAccessRunner(wrapper.getSession(), workflowInstanceId,\n                         nodeId);\n-                nodeAccessRunner.runUnrestricted();\n+                try {\n+                    nodeAccessRunner.runUnrestricted();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NTA4MjYy", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-406508262", "createdAt": "2020-05-06T11:06:06Z", "commit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NDY1NzY1", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-407465765", "createdAt": "2020-05-07T13:23:08Z", "commit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMzoyMzowOFrOGR-SEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMzoyNDozOVrOGR-WTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5OTQxMA==", "bodyText": "As @efge said in one of his comments, you should log something meaningful if possible:\nlog.warn(\"Failed to get workflow instance\", e)\n\nBTW, do we want the whole stack trace for a WARN? (cc @kevinleturc)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r421499410", "createdAt": "2020-05-07T13:23:08Z", "author": {"login": "troger"}, "path": "modules/platform/nuxeo-platform-document-routing/nuxeo-routing-core/src/main/java/org/nuxeo/ecm/platform/routing/core/io/TaskWriter.java", "diffHunk": "@@ -108,7 +113,12 @@ public void writeEntityBody(Task item, JsonGenerator jg) throws IOException {\n             if (StringUtils.isNotBlank(workflowInstanceId)) {\n                 NodeAccessRunner nodeAccessRunner = new NodeAccessRunner(wrapper.getSession(), workflowInstanceId,\n                         nodeId);\n-                nodeAccessRunner.runUnrestricted();\n+                try {\n+                    nodeAccessRunner.runUnrestricted();\n+                } catch (DocumentNotFoundException e) {\n+                    // If the DocumentRoute is not found (deleted for example), the TaskWriter fails.\n+                    log.warn(e, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTUwMDQ5NA==", "bodyText": "The comment is not accurate, the TaskWriter does not fail anymore with your fix. Keep it simple...\n// Workflow instance not found\n\nI'm not sure it's even needed according to the DocumentNotFoundException and the log message?", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r421500494", "createdAt": "2020-05-07T13:24:39Z", "author": {"login": "troger"}, "path": "modules/platform/nuxeo-platform-document-routing/nuxeo-routing-core/src/main/java/org/nuxeo/ecm/platform/routing/core/io/TaskWriter.java", "diffHunk": "@@ -108,7 +113,12 @@ public void writeEntityBody(Task item, JsonGenerator jg) throws IOException {\n             if (StringUtils.isNotBlank(workflowInstanceId)) {\n                 NodeAccessRunner nodeAccessRunner = new NodeAccessRunner(wrapper.getSession(), workflowInstanceId,\n                         nodeId);\n-                nodeAccessRunner.runUnrestricted();\n+                try {\n+                    nodeAccessRunner.runUnrestricted();\n+                } catch (DocumentNotFoundException e) {\n+                    // If the DocumentRoute is not found (deleted for example), the TaskWriter fails.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05f3fc68aeed664c0c0f8ebf306cae1be4682c33", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/05f3fc68aeed664c0c0f8ebf306cae1be4682c33", "committedDate": "2020-05-06T06:39:07Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}, "afterCommit": {"oid": "19e6e7255150b49435aad16f49bd344eac6e9f96", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/19e6e7255150b49435aad16f49bd344eac6e9f96", "committedDate": "2020-05-07T13:48:32Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19e6e7255150b49435aad16f49bd344eac6e9f96", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/19e6e7255150b49435aad16f49bd344eac6e9f96", "committedDate": "2020-05-07T13:48:32Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}, "afterCommit": {"oid": "53cdce0b4a8c15ca319b9416037f3d95b38ed2ca", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/53cdce0b4a8c15ca319b9416037f3d95b38ed2ca", "committedDate": "2020-05-07T13:49:41Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02c2abecd0a6b8f10c6bc54132e0f41b9d6e1b92", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/02c2abecd0a6b8f10c6bc54132e0f41b9d6e1b92", "committedDate": "2020-05-12T16:49:56Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "32b83de855f85bcc38b0e397b5bce412996b19a6", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/32b83de855f85bcc38b0e397b5bce412996b19a6", "committedDate": "2020-05-12T16:51:43Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32b83de855f85bcc38b0e397b5bce412996b19a6", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/32b83de855f85bcc38b0e397b5bce412996b19a6", "committedDate": "2020-05-12T16:51:43Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "95fb469720cd0cd415e5b81fa2a4e258605a430f", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/95fb469720cd0cd415e5b81fa2a4e258605a430f", "committedDate": "2020-05-12T16:56:28Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95fb469720cd0cd415e5b81fa2a4e258605a430f", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/95fb469720cd0cd415e5b81fa2a4e258605a430f", "committedDate": "2020-05-12T16:56:28Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "6d6596b558ea5ac0a7f0923622370e07892ac840", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/6d6596b558ea5ac0a7f0923622370e07892ac840", "committedDate": "2020-05-13T08:36:55Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d6596b558ea5ac0a7f0923622370e07892ac840", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/6d6596b558ea5ac0a7f0923622370e07892ac840", "committedDate": "2020-05-13T08:36:55Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "39494bd67fbab7001d5214e717042db144b058d8", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/39494bd67fbab7001d5214e717042db144b058d8", "committedDate": "2020-05-13T08:57:28Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39494bd67fbab7001d5214e717042db144b058d8", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/39494bd67fbab7001d5214e717042db144b058d8", "committedDate": "2020-05-13T08:57:28Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "f1931077add39813fe3deb98bf5e1bf11325d194", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/f1931077add39813fe3deb98bf5e1bf11325d194", "committedDate": "2020-05-13T09:20:22Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1931077add39813fe3deb98bf5e1bf11325d194", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/f1931077add39813fe3deb98bf5e1bf11325d194", "committedDate": "2020-05-13T09:20:22Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "959e893f1bb40a6f3e7f56f9cefada415135c9f4", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/959e893f1bb40a6f3e7f56f9cefada415135c9f4", "committedDate": "2020-05-13T09:26:56Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "959e893f1bb40a6f3e7f56f9cefada415135c9f4", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/959e893f1bb40a6f3e7f56f9cefada415135c9f4", "committedDate": "2020-05-13T09:26:56Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "da7342e0dd54288c63073fec57ff57354199d979", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/da7342e0dd54288c63073fec57ff57354199d979", "committedDate": "2020-05-14T15:10:59Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd73c8ec7730004f97985eef288e71c74bf9e3ff", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/cd73c8ec7730004f97985eef288e71c74bf9e3ff", "committedDate": "2020-05-14T15:12:47Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da7342e0dd54288c63073fec57ff57354199d979", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/da7342e0dd54288c63073fec57ff57354199d979", "committedDate": "2020-05-14T15:10:59Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a455f292f864a07f7e93239027de1611254f891c", "committedDate": "2020-05-14T15:13:02Z", "message": "NXP-28798: Provide a Task GC script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzQ1MzEz", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-413345313", "createdAt": "2020-05-18T07:46:29Z", "commit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzo0NjoyOVrOGWrJ1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzo0NjoyOVrOGWrJ1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyODg4Nw==", "bodyText": "There's still an interrogation about committing this script or not.", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r426428887", "createdAt": "2020-05-18T07:46:29Z", "author": {"login": "kevinleturc"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjcwNzUw", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-415270750", "createdAt": "2020-05-20T12:15:29Z", "commit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoxNToyOVrOGYIoGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoyOTo1MVrOGYJNOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MDM0Ng==", "bodyText": "Checked with @tmartins ans he is OK committing the script there \ud83d\ude03", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427960346", "createdAt": "2020-05-20T12:15:29Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyODg4Nw=="}, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MTE2Nw==", "bodyText": "Could you rename the script to match the already existing one (consistency)? Such as deleteOrphanTasks.groovy.", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427961167", "createdAt": "2020-05-20T12:16:28Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MTY0Ng==", "bodyText": "Even if it's not mandatory, could you take the habit to declare your vars at least with def if you don't want to type them?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            log = LogManager.getLogger(\"taskGC.groovy\")\n          \n          \n            \n            def log = LogManager.getLogger(\"taskGC.groovy\")\n          \n      \n    \n    \n  \n\nSame for all vars in the script.", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427961646", "createdAt": "2020-05-20T12:17:23Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2MzM4NQ==", "bodyText": "I'm just wondering, is 500 not too much as batch size to avoid transaction timeout? Or could it be increased? Or 500 is just fine :)\n@kevinleturc @bdelbosc ?", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427963385", "createdAt": "2020-05-20T12:20:23Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")\n+nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+dryRun = true\n+session = Context.getCoreSession()\n+ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2NDk1Mg==", "bodyText": "Can't we use the same as in Java?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.info(\"removing orphan task \" + id)\n          \n          \n            \n                        log.info(\"removing orphan task: {}\", id)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427964952", "createdAt": "2020-05-20T12:22:27Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")\n+nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+dryRun = true\n+session = Context.getCoreSession()\n+ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+bucketCount = 0\n+documentCount = 0\n+\n+while (scrollResult.hasResults()) {\n+    documentCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for(id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())\n+        if(!cache.computeIfAbsent(workflowRef, session.&exists)) {\n+            log.info(\"removing orphan task \" + id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2ODAxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                for(id in scrollResult.getResults()) {\n          \n          \n            \n                for (id in scrollResult.getResults()) {", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427968016", "createdAt": "2020-05-20T12:27:10Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")\n+nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+dryRun = true\n+session = Context.getCoreSession()\n+ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+bucketCount = 0\n+documentCount = 0\n+\n+while (scrollResult.hasResults()) {\n+    documentCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for(id in scrollResult.getResults()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2ODA3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(!cache.computeIfAbsent(workflowRef, session.&exists)) {\n          \n          \n            \n                    if (!cache.computeIfAbsent(workflowRef, session.&exists)) {", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427968079", "createdAt": "2020-05-20T12:27:16Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")\n+nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+dryRun = true\n+session = Context.getCoreSession()\n+ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+bucketCount = 0\n+documentCount = 0\n+\n+while (scrollResult.hasResults()) {\n+    documentCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for(id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())\n+        if(!cache.computeIfAbsent(workflowRef, session.&exists)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2OTg0OQ==", "bodyText": "Either use it or just remove those variables.", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427969849", "createdAt": "2020-05-20T12:29:51Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")\n+nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+dryRun = true\n+session = Context.getCoreSession()\n+ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+bucketCount = 0\n+documentCount = 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjgzNzM2", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-415283736", "createdAt": "2020-05-20T12:31:59Z", "commit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjozMTo1OVrOGYJSBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjozMjozMVrOGYJTMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk3MTA3Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(!dryRun) {\n          \n          \n            \n                        if (!dryRun) {", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427971077", "createdAt": "2020-05-20T12:31:59Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")\n+nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+dryRun = true\n+session = Context.getCoreSession()\n+ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+bucketCount = 0\n+documentCount = 0\n+\n+while (scrollResult.hasResults()) {\n+    documentCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for(id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())\n+        if(!cache.computeIfAbsent(workflowRef, session.&exists)) {\n+            log.info(\"removing orphan task \" + id)\n+            if(!dryRun) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk3MTM3Ng==", "bodyText": "You are always logging this, dry run or not, it could be misleading while reading the logs :)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r427971376", "createdAt": "2020-05-20T12:32:31Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/taskGC.groovy", "diffHunk": "@@ -0,0 +1,33 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+log = LogManager.getLogger(\"taskGC.groovy\")\n+nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+dryRun = true\n+session = Context.getCoreSession()\n+ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+bucketCount = 0\n+documentCount = 0\n+\n+while (scrollResult.hasResults()) {\n+    documentCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for(id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())\n+        if(!cache.computeIfAbsent(workflowRef, session.&exists)) {\n+            log.info(\"removing orphan task \" + id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a455f292f864a07f7e93239027de1611254f891c", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a455f292f864a07f7e93239027de1611254f891c", "committedDate": "2020-05-14T15:13:02Z", "message": "NXP-28798: Provide a Task GC script"}, "afterCommit": {"oid": "479fce0e5c4917e0b22dfab4f93649494cabce4d", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/479fce0e5c4917e0b22dfab4f93649494cabce4d", "committedDate": "2020-05-20T14:19:03Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "479fce0e5c4917e0b22dfab4f93649494cabce4d", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/479fce0e5c4917e0b22dfab4f93649494cabce4d", "committedDate": "2020-05-20T14:19:03Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "547ad04d66709304d92307555f1794058aa83e94", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/547ad04d66709304d92307555f1794058aa83e94", "committedDate": "2020-05-20T14:20:39Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "547ad04d66709304d92307555f1794058aa83e94", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/547ad04d66709304d92307555f1794058aa83e94", "committedDate": "2020-05-20T14:20:39Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a", "committedDate": "2020-05-20T15:13:10Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NDIzNTIz", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-415423523", "createdAt": "2020-05-20T14:55:41Z", "commit": {"oid": "547ad04d66709304d92307555f1794058aa83e94"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNDo1NTo0MlrOGYP69Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNToxODo0OFrOGYRAgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA3OTg2MQ==", "bodyText": "This probably needs to be renamed, if it was to match the script name?", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r428079861", "createdAt": "2020-05-20T14:55:42Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,39 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+def log = LogManager.getLogger(\"taskGC.groovy\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "547ad04d66709304d92307555f1794058aa83e94"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NjgzMw==", "bodyText": "You probably could merge both logs...\nlog.info(\"End deleting orphan tasks, removed {} out of {} tasks\", ...)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r428096833", "createdAt": "2020-05-20T15:17:42Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,39 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+def log = LogManager.getLogger(\"taskGC.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for (id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())\n+        if (!cache.computeIfAbsent(workflowRef, session.&exists)) {\n+            if (dryRun) {\n+                log.info(\"would remove orphan task: {}\", id)\n+            } else {\n+                log.info(\"removing orphan task: {}\", id)\n+                session.removeDocument(new IdRef(id))\n+                removedCount += 1\n+            }\n+        }\n+    }\n+    scrollResult = session.scroll(scrollResult.getScrollId())\n+    TransactionHelper.commitOrRollbackTransaction()\n+    TransactionHelper.startTransaction()\n+}\n+\n+log.info(\"Finished deleting orphan tasks\")\n+log.info(\"removed {} out of {} tasks\", removedCount, taskCount)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NjkxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            log.info(\"would remove orphan task: {}\", id)\n          \n          \n            \n                            log.info(\"Would remove orphan task: {}\", id)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r428096910", "createdAt": "2020-05-20T15:17:48Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,39 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+def log = LogManager.getLogger(\"taskGC.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for (id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())\n+        if (!cache.computeIfAbsent(workflowRef, session.&exists)) {\n+            if (dryRun) {\n+                log.info(\"would remove orphan task: {}\", id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NzAwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            log.info(\"removing orphan task: {}\", id)\n          \n          \n            \n                            log.info(\"Removing orphan task: {}\", id)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r428097009", "createdAt": "2020-05-20T15:17:56Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,39 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+def log = LogManager.getLogger(\"taskGC.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for (id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())\n+        if (!cache.computeIfAbsent(workflowRef, session.&exists)) {\n+            if (dryRun) {\n+                log.info(\"would remove orphan task: {}\", id)\n+            } else {\n+                log.info(\"removing orphan task: {}\", id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NzI1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                cache = new HashMap<IdRef>()\n          \n          \n            \n                def cache = new HashMap<IdRef>()", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r428097253", "createdAt": "2020-05-20T15:18:16Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,39 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+def log = LogManager.getLogger(\"taskGC.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NzUzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n          \n          \n            \n                    def task = session.getDocument(new IdRef(id)).getAdapter(Task.class)", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r428097538", "createdAt": "2020-05-20T15:18:39Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,39 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+def log = LogManager.getLogger(\"taskGC.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for (id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NzY2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    workflowRef = new IdRef(task.getProcessId())\n          \n          \n            \n                    def workflowRef = new IdRef(task.getProcessId())", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r428097666", "createdAt": "2020-05-20T15:18:48Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,39 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+import java.util.HashMap\n+\n+def log = LogManager.getLogger(\"taskGC.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    cache = new HashMap<IdRef>()\n+    for (id in scrollResult.getResults()) {\n+        task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        workflowRef = new IdRef(task.getProcessId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1ebd18e046ef9671cf4a9b7aa39f84ef82c1ec8a", "committedDate": "2020-05-20T15:13:10Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "f54b65fe4cda0a66e4357dce4c373b92790fd34a", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/f54b65fe4cda0a66e4357dce4c373b92790fd34a", "committedDate": "2020-05-20T15:29:55Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5ODgxODcz", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-419881873", "createdAt": "2020-05-28T08:20:50Z", "commit": {"oid": "f54b65fe4cda0a66e4357dce4c373b92790fd34a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODoyMDo1MFrOGbqnxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODoyMDo1MFrOGbqnxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY2MzA0Nw==", "bodyText": "Shouldn't we re-start the transaction before doing a new scroll?", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r431663047", "createdAt": "2020-05-28T08:20:50Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,37 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+\n+def log = LogManager.getLogger(\"deleteOrphanTasks.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    def cache = [:]\n+    for (id in scrollResult.getResults()) {\n+        def task = session.getDocument(new IdRef(id)).getAdapter(Task.class)\n+        def workflowRef = new IdRef(task.getProcessId())\n+        if (!cache.computeIfAbsent(workflowRef, session.&exists)) {\n+            if (dryRun) {\n+                log.info(\"Would remove orphan task: {}\", id)\n+            } else {\n+                log.info(\"Removing orphan task: {}\", id)\n+                session.removeDocument(new IdRef(id))\n+                removedCount += 1\n+            }\n+        }\n+    }\n+    scrollResult = session.scroll(scrollResult.getScrollId())\n+    TransactionHelper.commitOrRollbackTransaction()\n+    TransactionHelper.startTransaction()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f54b65fe4cda0a66e4357dce4c373b92790fd34a"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f54b65fe4cda0a66e4357dce4c373b92790fd34a", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/f54b65fe4cda0a66e4357dce4c373b92790fd34a", "committedDate": "2020-05-20T15:29:55Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "bcbd4b29bf6ab24ea93412f006b83e668da3939b", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/bcbd4b29bf6ab24ea93412f006b83e668da3939b", "committedDate": "2020-06-04T09:55:44Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjI2NTI5", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-426226529", "createdAt": "2020-06-08T13:21:27Z", "commit": {"oid": "bcbd4b29bf6ab24ea93412f006b83e668da3939b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoyMToyN1rOGgdt-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoyMToyN1rOGgdt-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY5NDUyMg==", "bodyText": "Should be outside the while as we may want to reuse the cache when scrolling.", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r436694522", "createdAt": "2020-06-08T13:21:27Z", "author": {"login": "troger"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,37 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+\n+def log = LogManager.getLogger(\"deleteOrphanTasks.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    def cache = [:]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcbd4b29bf6ab24ea93412f006b83e668da3939b"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcbd4b29bf6ab24ea93412f006b83e668da3939b", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/bcbd4b29bf6ab24ea93412f006b83e668da3939b", "committedDate": "2020-06-04T09:55:44Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "60f843918ec32efa03c4992dc0fbf859c85ad9db", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/60f843918ec32efa03c4992dc0fbf859c85ad9db", "committedDate": "2020-06-08T14:49:45Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDY4Mzkx", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-426468391", "createdAt": "2020-06-08T17:38:17Z", "commit": {"oid": "60f843918ec32efa03c4992dc0fbf859c85ad9db"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTA4NjI2", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-426908626", "createdAt": "2020-06-09T08:33:53Z", "commit": {"oid": "60f843918ec32efa03c4992dc0fbf859c85ad9db"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODozMzo1NFrOGg-gjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODozNDoyNFrOGg-hwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzMTc1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            log.info(\"Starting deleting orphan tasks...\")\n          \n          \n            \n            log.info(\"Start deleting orphan tasks...\")", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r437231758", "createdAt": "2020-06-09T08:33:54Z", "author": {"login": "ataillefer"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,37 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+\n+def log = LogManager.getLogger(\"deleteOrphanTasks.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+def cache = [:]\n+\n+log.info(\"Starting deleting orphan tasks...\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60f843918ec32efa03c4992dc0fbf859c85ad9db"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzMjA2NQ==", "bodyText": "scrollResult.getResults() could be in a variable", "url": "https://github.com/nuxeo/nuxeo/pull/4008#discussion_r437232065", "createdAt": "2020-06-09T08:34:24Z", "author": {"login": "ataillefer"}, "path": "server/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,37 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+\n+def log = LogManager.getLogger(\"deleteOrphanTasks.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+def cache = [:]\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60f843918ec32efa03c4992dc0fbf859c85ad9db"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48fa1a0049f4ec36f9a3d002ff80bfbc081a39fe", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/48fa1a0049f4ec36f9a3d002ff80bfbc081a39fe", "committedDate": "2020-06-09T10:36:18Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60f843918ec32efa03c4992dc0fbf859c85ad9db", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/60f843918ec32efa03c4992dc0fbf859c85ad9db", "committedDate": "2020-06-08T14:49:45Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "48fa1a0049f4ec36f9a3d002ff80bfbc081a39fe", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/48fa1a0049f4ec36f9a3d002ff80bfbc081a39fe", "committedDate": "2020-06-09T10:36:18Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTQzMjcw", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-427143270", "createdAt": "2020-06-09T13:28:06Z", "commit": {"oid": "48fa1a0049f4ec36f9a3d002ff80bfbc081a39fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTYyNzAx", "url": "https://github.com/nuxeo/nuxeo/pull/4008#pullrequestreview-427162701", "createdAt": "2020-06-09T13:42:18Z", "commit": {"oid": "48fa1a0049f4ec36f9a3d002ff80bfbc081a39fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4796, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}