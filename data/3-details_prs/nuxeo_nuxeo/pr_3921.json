{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNDI2MjA3", "number": 3921, "title": "Backport NXP-28763 NXP-26704 NXP-28900 NXP-28919 to 10.10", "bodyText": "The code is 99% identical to the one in branch master, except for Java 11 details like Set.of() and String.repeat().\nThe goal of the review is mainly to identify backward-compatibility issues.", "createdAt": "2020-04-14T21:35:04Z", "url": "https://github.com/nuxeo/nuxeo/pull/3921", "merged": true, "mergeCommit": {"oid": "d42defbf98f1ea06d410daf7bdcbeb65b572cecf"}, "closed": true, "closedAt": "2020-04-16T13:13:55Z", "author": {"login": "efge"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXpOAmgH2gAyNDAzNDI2MjA3OmMxMTlhY2FmNTFlNmY4NjNkYmFiODNhMzNhYmFkYjI3ZTIxOTAwMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX4Fp4AFqTM5Mzc3MTMxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c119acaf51e6f863dbab83a33abadb27e2190012", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c119acaf51e6f863dbab83a33abadb27e2190012", "committedDate": "2020-04-14T20:07:45Z", "message": "NXP-28763: optimized MongoDB ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd8097dca3f9c4346a853c3dc2a6ce594a220cd6", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/cd8097dca3f9c4346a853c3dc2a6ce594a220cd6", "committedDate": "2020-04-14T20:14:19Z", "message": "NXP-26704: move fulltext-related test features to nuxeo-core-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18dd82d65f110d8fc307786b84bbe91b04329cee", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/18dd82d65f110d8fc307786b84bbe91b04329cee", "committedDate": "2020-04-14T20:17:04Z", "message": "NXP-26704: align internal property names in VCS and DBS, for simpler blob dispatcher config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46f05163340750f0985d405bfcb3c016cb082222", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/46f05163340750f0985d405bfcb3c016cb082222", "committedDate": "2020-04-14T20:56:46Z", "message": "NXP-26704: allow storing fulltext in blobs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f9afd8721141cd21b0901a018b7784ad2c56387", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8f9afd8721141cd21b0901a018b7784ad2c56387", "committedDate": "2020-04-14T21:04:02Z", "message": "NXP-26704: use constant for binarytext key in map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb68d7525a4c48358ca0a3607ffc3864d5404b4", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/feb68d7525a4c48358ca0a3607ffc3864d5404b4", "committedDate": "2020-04-14T21:14:04Z", "message": "NXP-28900: allow blob provider to access document when reading blob"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjMyNzQ5", "url": "https://github.com/nuxeo/nuxeo/pull/3921#pullrequestreview-393632749", "createdAt": "2020-04-15T10:04:25Z", "commit": {"oid": "f22f08ce03ad612b473ef193825868abb4b1ed6a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDowNDoyNVrOGFyvFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDoxMzo0MlrOGFzDgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNzMxNw==", "bodyText": "Don't we want to keep the existing constructor/methods for backward compatibility, to be safe? (I know it's mostly internal stuff)", "url": "https://github.com/nuxeo/nuxeo/pull/3921#discussion_r408727317", "createdAt": "2020-04-15T10:04:25Z", "author": {"login": "troger"}, "path": "nuxeo-core/nuxeo-core-storage-mongodb/src/main/java/org/nuxeo/ecm/core/storage/mongodb/MongoDBConverter.java", "diffHunk": "@@ -57,22 +64,35 @@\n     /** The key to use in memory to map the database native \"_id\". */\n     protected final String idKey;\n \n+    /** The keys for booleans whose value is true or null (instead of false). */\n+    protected final Set<String> trueOrNullBooleanKeys;\n+\n+    /** The keys whose values are ids and are stored as longs. */\n+    protected final Set<String> idValuesKeys;\n+\n     /**\n      * Constructor for a converter that does not map the MongoDB native \"_id\".\n      *\n      * @since 10.3\n      */\n     public MongoDBConverter() {\n-        this(null);\n+        this(null, Collections.emptySet(), Collections.emptySet());\n     }\n \n     /**\n      * Constructor for a converter that also knows to optionally translate the native MongoDB \"_id\" into a custom id.\n+     * <p>\n+     * When {@code idValuesKeys} are provided, the ids are stored as longs.\n      *\n      * @param idKey the key to use to map the native \"_id\" in memory, if not {@code null}\n+     * @param trueOrNullBooleanKeys the keys corresponding to boolean values that are only true or null (instead of\n+     *            false)\n+     * @param idValuesKeys the keys corresponding to values that are ids\n      */\n-    public MongoDBConverter(String idKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f22f08ce03ad612b473ef193825868abb4b1ed6a"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODczMjU0Nw==", "bodyText": "Maybe a default impl?", "url": "https://github.com/nuxeo/nuxeo/pull/3921#discussion_r408732547", "createdAt": "2020-04-15T10:13:42Z", "author": {"login": "troger"}, "path": "nuxeo-core/nuxeo-core/src/main/java/org/nuxeo/ecm/core/blob/DocumentBlobManager.java", "diffHunk": "@@ -35,14 +35,27 @@\n  */\n public interface DocumentBlobManager {\n \n+    /**\n+     * Reads a {@link Blob} from storage.\n+     *\n+     * @param blobInfo the blob information\n+     * @param doc the document to which this blob belongs\n+     * @param xpath the xpath of the blob in the document\n+     * @return a managed blob\n+     * @since 11.1\n+     */\n+    Blob readBlob(BlobInfo blobInfo, Document doc, String xpath) throws IOException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f22f08ce03ad612b473ef193825868abb4b1ed6a"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1348916f73c4911b043a05b442bb7733e6df2037", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1348916f73c4911b043a05b442bb7733e6df2037", "committedDate": "2020-04-15T11:53:10Z", "message": "NXP-28919: simplify ManagedBlob logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fedf43e3aa8606faeb335cc01887c8b11f23d23", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3fedf43e3aa8606faeb335cc01887c8b11f23d23", "committedDate": "2020-04-15T11:53:10Z", "message": "NXP-28919: move ByteRange to nuxeo-core-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f3c5755baef0e17d40ef39e531e47ece15d49f", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/99f3c5755baef0e17d40ef39e531e47ece15d49f", "committedDate": "2020-04-15T11:53:10Z", "message": "NXP-28919: allow blob provider to do optimized byte range requests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f22f08ce03ad612b473ef193825868abb4b1ed6a", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/f22f08ce03ad612b473ef193825868abb4b1ed6a", "committedDate": "2020-04-14T21:26:59Z", "message": "NXP-28919: allow blob provider to do optimized byte range requests"}, "afterCommit": {"oid": "99f3c5755baef0e17d40ef39e531e47ece15d49f", "author": {"user": {"login": "efge", "name": "Florent Guillaume"}}, "url": "https://github.com/nuxeo/nuxeo/commit/99f3c5755baef0e17d40ef39e531e47ece15d49f", "committedDate": "2020-04-15T11:53:10Z", "message": "NXP-28919: allow blob provider to do optimized byte range requests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzcxMzE3", "url": "https://github.com/nuxeo/nuxeo/pull/3921#pullrequestreview-393771317", "createdAt": "2020-04-15T13:27:12Z", "commit": {"oid": "99f3c5755baef0e17d40ef39e531e47ece15d49f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4765, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}