{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0Mzk3NzA1", "number": 4087, "title": "10.10 hf/fix nxp 28798 task endpoint fail gracefully when missing doc route", "bodyText": "", "createdAt": "2020-05-28T10:33:52Z", "url": "https://github.com/nuxeo/nuxeo/pull/4087", "merged": true, "mergeCommit": {"oid": "67543147809b71932662a219dc1bf49c8f95a09e"}, "closed": true, "closedAt": "2020-06-10T08:01:33Z", "author": {"login": "NourNuxeo"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclrXwogH2gAyNDI0Mzk3NzA1OmMyMjM0MTAxODI3YTBlMmQyZmM0MDliZTJiYWI3MWUzMDQxOTBkY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp0_ImAFqTQyNzgwNDc5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2234101827a0e2d2fc409be2bab71e304190dcf", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c2234101827a0e2d2fc409be2bab71e304190dcf", "committedDate": "2020-05-28T10:33:09Z", "message": "NXP-28798: Gracefully log missing DocumentRoutes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94669c1dac896eae57bb9a7be0b9c26e4ff65917", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/94669c1dac896eae57bb9a7be0b9c26e4ff65917", "committedDate": "2020-05-28T10:33:10Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "cbea24f3686ed02e6aa2a33253e364e20d5ddf3e", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/cbea24f3686ed02e6aa2a33253e364e20d5ddf3e", "committedDate": "2020-06-04T09:55:58Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzEwMzU2", "url": "https://github.com/nuxeo/nuxeo/pull/4087#pullrequestreview-426310356", "createdAt": "2020-06-08T14:40:04Z", "commit": {"oid": "cbea24f3686ed02e6aa2a33253e364e20d5ddf3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDo0MDowNFrOGghvjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDo0MDowNFrOGghvjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc2MDQ2Mw==", "bodyText": "Should be before the while.", "url": "https://github.com/nuxeo/nuxeo/pull/4087#discussion_r436760463", "createdAt": "2020-06-08T14:40:04Z", "author": {"login": "troger"}, "path": "nuxeo-distribution/nuxeo-nxr-server/src/main/resources/templates/common-base/client/scripts/deleteOrphanTasks.groovy", "diffHunk": "@@ -0,0 +1,37 @@\n+import org.apache.logging.log4j.LogManager\n+import org.nuxeo.ecm.platform.task.Task\n+import org.nuxeo.ecm.core.api.IdRef\n+import org.nuxeo.ecm.core.api.ScrollResult\n+import org.nuxeo.runtime.transaction.TransactionHelper\n+\n+def log = LogManager.getLogger(\"deleteOrphanTasks.groovy\")\n+def nxql = \"SELECT * FROM Document WHERE ecm:mixinType = 'Task'\"\n+def dryRun = true\n+def session = Context.getCoreSession()\n+def ScrollResult<String> scrollResult = session.scroll(nxql, 500, 60)\n+def removedCount = 0\n+def taskCount = 0\n+\n+log.info(\"Starting deleting orphan tasks...\")\n+while (scrollResult.hasResults()) {\n+    taskCount += scrollResult.getResults().size()\n+    def cache = [:]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbea24f3686ed02e6aa2a33253e364e20d5ddf3e"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cbea24f3686ed02e6aa2a33253e364e20d5ddf3e", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/cbea24f3686ed02e6aa2a33253e364e20d5ddf3e", "committedDate": "2020-06-04T09:55:58Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "a2977ea467632f7908bef54d98153aed11fab6d9", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a2977ea467632f7908bef54d98153aed11fab6d9", "committedDate": "2020-06-08T14:52:40Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7af3580e4d48927aa7db4117068e0395429bd74", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c7af3580e4d48927aa7db4117068e0395429bd74", "committedDate": "2020-06-09T10:38:28Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2977ea467632f7908bef54d98153aed11fab6d9", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a2977ea467632f7908bef54d98153aed11fab6d9", "committedDate": "2020-06-08T14:52:40Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}, "afterCommit": {"oid": "c7af3580e4d48927aa7db4117068e0395429bd74", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c7af3580e4d48927aa7db4117068e0395429bd74", "committedDate": "2020-06-09T10:38:28Z", "message": "NXP-28798: Provide a deleteOrphanTasks.groovy script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTYzMzYz", "url": "https://github.com/nuxeo/nuxeo/pull/4087#pullrequestreview-427163363", "createdAt": "2020-06-09T13:43:00Z", "commit": {"oid": "c7af3580e4d48927aa7db4117068e0395429bd74"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODA0Nzk0", "url": "https://github.com/nuxeo/nuxeo/pull/4087#pullrequestreview-427804794", "createdAt": "2020-06-10T08:01:00Z", "commit": {"oid": "c7af3580e4d48927aa7db4117068e0395429bd74"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4748, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}