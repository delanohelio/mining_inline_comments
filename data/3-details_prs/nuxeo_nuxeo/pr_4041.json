{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjExMzc5", "number": 4041, "title": "NXP-28146 - Load nuxeo.NUXEO_ENVIRONMENT file in addition to nuxeo.defaults", "bodyText": "T&P: https://qa.nuxeo.org/jenkins/job/TestAndPush/job/ondemand-testandpush-kleturc/715/", "createdAt": "2020-05-15T14:03:12Z", "url": "https://github.com/nuxeo/nuxeo/pull/4041", "merged": true, "mergeCommit": {"oid": "b5d71f54a468a14b3effa65507a3b080e3b94275"}, "closed": true, "closedAt": "2020-05-20T12:43:27Z", "author": {"login": "kevinleturc"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciOR24gFqTQxMzE4MDExMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjIbkVgFqTQxNTI5MTcxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTgwMTEx", "url": "https://github.com/nuxeo/nuxeo/pull/4041#pullrequestreview-413180111", "createdAt": "2020-05-17T16:57:40Z", "commit": {"oid": "99ac83f07c7d79018b7466f160e45badd28a101a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNjo1Nzo0MVrOGWiNQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNjo1Nzo0MVrOGWiNQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MjMwNw==", "bodyText": "This is really obsolete (I can't even remember when it was used). I don't think it's worth keeping.", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426282307", "createdAt": "2020-05-17T16:57:41Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -321,7 +365,10 @@ public void checkPaths() throws ConfigurationException {\n             log.warn(\"NXP-8014 Packages cache location changed. You can safely delete {} or move its content to {}\",\n                     () -> oldPackagesPath, this::getPackagesDir);\n         }\n-\n+        File oldPath = new File(getRuntimeHome(), \"data\" + File.separator + \"vcsh2repo\");\n+        String message = String.format(\"NXP-5370, NXP-5460. \" + \"Please rename 'vcsh2repo' directory from %s to %s\",\n+                oldPath, new File(generator.getDataDir(), \"h2\" + File.separator + \"nuxeo\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ac83f07c7d79018b7466f160e45badd28a101a"}, "originalPosition": 103}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTgwNDgy", "url": "https://github.com/nuxeo/nuxeo/pull/4041#pullrequestreview-413180482", "createdAt": "2020-05-17T17:02:32Z", "commit": {"oid": "ec56196f09ce9378816f6c498543d3cdb4ac53e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowMjozMlrOGWiPAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowMjozMlrOGWiPAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4Mjc1NA==", "bodyText": "I think you can just call mkdirs() on all the dirs wihtout the isDirectory check, it shouldn't fail if the directory already exists.", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426282754", "createdAt": "2020-05-17T17:02:32Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ConfigurationGenerator.java", "diffHunk": "@@ -1274,15 +1224,20 @@ public File getDataDir() {\n      */\n     public void verifyInstallation() throws ConfigurationException {\n         checkJavaVersion();\n-        ifNotExistsAndIsDirectoryThenCreate(getLogDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getPidDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getDataDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getTmpDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getPackagesDir());\n+        createDirectoryIfDoesntExist(getLogDir());\n+        createDirectoryIfDoesntExist(getPidDir());\n+        createDirectoryIfDoesntExist(getDataDir());\n+        createDirectoryIfDoesntExist(getTmpDir());\n+        createDirectoryIfDoesntExist(getPackagesDir());\n         checkAddressesAndPorts();\n         serverConfigurator.verifyInstallation();\n         backingServicesConfigurator.verifyInstallation();\n+    }\n \n+    private void createDirectoryIfDoesntExist(File directory) {\n+        if (!directory.isDirectory()) {\n+            directory.mkdirs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec56196f09ce9378816f6c498543d3cdb4ac53e1"}, "originalPosition": 406}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTgwOTM1", "url": "https://github.com/nuxeo/nuxeo/pull/4041#pullrequestreview-413180935", "createdAt": "2020-05-17T17:08:23Z", "commit": {"oid": "ec56196f09ce9378816f6c498543d3cdb4ac53e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowODoyM1rOGWiRNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzowODoyM1rOGWiRNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MzMxOA==", "bodyText": "Maybe Files.exists(generator.getNuxeoHome().toPath().resolve(Path.of(\"conf\", \"Catalina\", \"localhost\", getContextName() + \".xml\")))", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426283318", "createdAt": "2020-05-17T17:08:23Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -111,16 +111,14 @@ public ServerConfigurator(ConfigurationGenerator configurationGenerator) {\n      * @return true if server configuration files already exist\n      */\n     protected boolean isConfigured() {\n-        return new File(generator.getNuxeoHome(), getTomcatConfig()).exists();\n-    }\n-\n-    /**\n-     * @since 5.4.2\n-     * @return Path to Tomcat configuration of Nuxeo context\n-     */\n-    public String getTomcatConfig() {\n-        return \"conf\" + File.separator + \"Catalina\" + File.separator + \"localhost\" + File.separator + getContextName()\n-                + \".xml\";\n+        return generator.getNuxeoHome()\n+                        .toPath()\n+                        .resolve(\"conf\")\n+                        .resolve(\"Catalina\")\n+                        .resolve(\"localhost\")\n+                        .resolve(getContextName() + \".xml\")\n+                        .toFile()\n+                        .exists();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec56196f09ce9378816f6c498543d3cdb4ac53e1"}, "originalPosition": 82}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcda1ed1b203b49d72187f28c86f56d5b6f00040", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/dcda1ed1b203b49d72187f28c86f56d5b6f00040", "committedDate": "2020-05-18T07:56:04Z", "message": "NXP-28146: Remove unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eed83ec1e64e1f4093d91b799ea72577417e1b1", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/4eed83ec1e64e1f4093d91b799ea72577417e1b1", "committedDate": "2020-05-18T08:00:10Z", "message": "NXP-28146: Cleanup / Format"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3cf85d02eb5bf26aee04adca585d5731ca38660", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/f3cf85d02eb5bf26aee04adca585d5731ca38660", "committedDate": "2020-05-15T14:01:04Z", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults"}, "afterCommit": {"oid": "78e84cd4418486b4dae1a90e5a782bc40191edb5", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/78e84cd4418486b4dae1a90e5a782bc40191edb5", "committedDate": "2020-05-18T08:00:16Z", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNjY4MjE0", "url": "https://github.com/nuxeo/nuxeo/pull/4041#pullrequestreview-413668214", "createdAt": "2020-05-18T14:49:35Z", "commit": {"oid": "78e84cd4418486b4dae1a90e5a782bc40191edb5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjY4ODky", "url": "https://github.com/nuxeo/nuxeo/pull/4041#pullrequestreview-415268892", "createdAt": "2020-05-20T12:13:41Z", "commit": {"oid": "78e84cd4418486b4dae1a90e5a782bc40191edb5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7ad277054251f1c8565c7dea34d5eea70d06afc", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c7ad277054251f1c8565c7dea34d5eea70d06afc", "committedDate": "2020-05-20T12:30:10Z", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78e84cd4418486b4dae1a90e5a782bc40191edb5", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/78e84cd4418486b4dae1a90e5a782bc40191edb5", "committedDate": "2020-05-18T08:00:16Z", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults"}, "afterCommit": {"oid": "c7ad277054251f1c8565c7dea34d5eea70d06afc", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c7ad277054251f1c8565c7dea34d5eea70d06afc", "committedDate": "2020-05-20T12:30:10Z", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1Mjg1Mjcz", "url": "https://github.com/nuxeo/nuxeo/pull/4041#pullrequestreview-415285273", "createdAt": "2020-05-20T12:34:00Z", "commit": {"oid": "c7ad277054251f1c8565c7dea34d5eea70d06afc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjkxNzEz", "url": "https://github.com/nuxeo/nuxeo/pull/4041#pullrequestreview-415291713", "createdAt": "2020-05-20T12:42:47Z", "commit": {"oid": "c7ad277054251f1c8565c7dea34d5eea70d06afc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4735, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}