{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNzU2Mzky", "number": 4378, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOTowOTo0NlrOEsv26A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOTowOTo0NlrOEsv26A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MzU2OTA0OnYy", "diffSide": "RIGHT", "path": "docker/docker-entrypoint.sh", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOTowOTo0NlrOHgKKag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoxMjo1M1rOHgl9wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng==", "bodyText": ". does a \"source\" of the shell script in the same context as the current script. Meaning it can impact execution of the current script if it redefines environment variables for instance.\nAnother more common option outside of Docker is to just execute the script, but I don't know what's common in the Docker world.", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503482986", "createdAt": "2020-10-12T19:09:46Z", "author": {"login": "efge"}, "path": "docker/docker-entrypoint.sh", "diffHunk": "@@ -53,6 +56,15 @@ if [[ ! -f $NUXEO_HOME/configured && ! -f $NUXEO_CONF ]]; then\n   touch $NUXEO_HOME/configured\n fi\n \n+# Handle shell scripts\n+echo \"ENTRYPOINT: Looking for shell scripts in /docker-entrypoint-initnuxeo.d\"\n+for f in /docker-entrypoint-initnuxeo.d/*; do\n+  case \"$f\" in\n+    *.sh)  echo \"Running $f\"; . \"$f\" ;;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02054c88e0845d97ce085e01320234de6d99f648"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg0Mjc1Nw==", "bodyText": "Not aware of any best practices for running a script from the ENTRYPOINT of a Docker image.\nYou're right, executing the scripts would probably be safer for the environment, but, it's not easy to achieve since we don't control the permissions on the scripts to execute, like x, required for a script execution.\nTypically the /docker-entrypoint-initnuxeo.d directory can be mounted as a volume from a host directory containing the scripts to execute, in which case the resulting volume is owned by root, whereas the user running the entrypoint script is not root.", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503842757", "createdAt": "2020-10-13T10:30:43Z", "author": {"login": "ataillefer"}, "path": "docker/docker-entrypoint.sh", "diffHunk": "@@ -53,6 +56,15 @@ if [[ ! -f $NUXEO_HOME/configured && ! -f $NUXEO_CONF ]]; then\n   touch $NUXEO_HOME/configured\n fi\n \n+# Handle shell scripts\n+echo \"ENTRYPOINT: Looking for shell scripts in /docker-entrypoint-initnuxeo.d\"\n+for f in /docker-entrypoint-initnuxeo.d/*; do\n+  case \"$f\" in\n+    *.sh)  echo \"Running $f\"; . \"$f\" ;;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}, "originalCommit": {"oid": "02054c88e0845d97ce085e01320234de6d99f648"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg0OTY1NA==", "bodyText": "Ownership is not a problem for execution. One way to execute the script is just /bin/sh \"$f\".", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503849654", "createdAt": "2020-10-13T10:43:22Z", "author": {"login": "efge"}, "path": "docker/docker-entrypoint.sh", "diffHunk": "@@ -53,6 +56,15 @@ if [[ ! -f $NUXEO_HOME/configured && ! -f $NUXEO_CONF ]]; then\n   touch $NUXEO_HOME/configured\n fi\n \n+# Handle shell scripts\n+echo \"ENTRYPOINT: Looking for shell scripts in /docker-entrypoint-initnuxeo.d\"\n+for f in /docker-entrypoint-initnuxeo.d/*; do\n+  case \"$f\" in\n+    *.sh)  echo \"Running $f\"; . \"$f\" ;;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}, "originalCommit": {"oid": "02054c88e0845d97ce085e01320234de6d99f648"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg1MDA1MQ==", "bodyText": "Or /bin/bash if that's Docker usage.", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503850051", "createdAt": "2020-10-13T10:44:04Z", "author": {"login": "efge"}, "path": "docker/docker-entrypoint.sh", "diffHunk": "@@ -53,6 +56,15 @@ if [[ ! -f $NUXEO_HOME/configured && ! -f $NUXEO_CONF ]]; then\n   touch $NUXEO_HOME/configured\n fi\n \n+# Handle shell scripts\n+echo \"ENTRYPOINT: Looking for shell scripts in /docker-entrypoint-initnuxeo.d\"\n+for f in /docker-entrypoint-initnuxeo.d/*; do\n+  case \"$f\" in\n+    *.sh)  echo \"Running $f\"; . \"$f\" ;;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}, "originalCommit": {"oid": "02054c88e0845d97ce085e01320234de6d99f648"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkzODQ5Ng==", "bodyText": "Interesting, thanks. Let's go for /bin/bash.", "url": "https://github.com/nuxeo/nuxeo/pull/4378#discussion_r503938496", "createdAt": "2020-10-13T13:12:53Z", "author": {"login": "ataillefer"}, "path": "docker/docker-entrypoint.sh", "diffHunk": "@@ -53,6 +56,15 @@ if [[ ! -f $NUXEO_HOME/configured && ! -f $NUXEO_CONF ]]; then\n   touch $NUXEO_HOME/configured\n fi\n \n+# Handle shell scripts\n+echo \"ENTRYPOINT: Looking for shell scripts in /docker-entrypoint-initnuxeo.d\"\n+for f in /docker-entrypoint-initnuxeo.d/*; do\n+  case \"$f\" in\n+    *.sh)  echo \"Running $f\"; . \"$f\" ;;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Mjk4Ng=="}, "originalCommit": {"oid": "02054c88e0845d97ce085e01320234de6d99f648"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4348, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}