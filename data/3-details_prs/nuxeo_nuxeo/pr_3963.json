{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3ODE5MjA5", "number": 3963, "title": "NXP-28939: split the retention based event rule properties", "bodyText": "I open the PR manually, to be able to get the review asap (PO needed asap).\nT&P OK: https://qa2.nuxeo.org/jenkins/job/TestAndPush/job/ondemand-testandpush-saouana-10.10/119/\nnew T&P after review: https://qa2.nuxeo.org/jenkins/job/TestAndPush/job/ondemand-testandpush-saouana-10.10/120/\nWeb-UI PR: nuxeo/nuxeo-web-ui#878\nJIRA: https://jira.nuxeo.com/browse/NXP-28939", "createdAt": "2020-04-23T10:18:26Z", "url": "https://github.com/nuxeo/nuxeo/pull/3963", "merged": true, "mergeCommit": {"oid": "e6f4784bc30c4c58df7d5b21de37222838b6c709"}, "closed": true, "closedAt": "2020-04-24T15:18:10Z", "author": {"login": "RSalem07"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaaOm4ABqjMyNjQ0MDYxMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcayLL1gFqTM5OTk4NDIyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3819082a44851a1fdad08436e5901955ce5ecc3b", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3819082a44851a1fdad08436e5901955ce5ecc3b", "committedDate": "2020-04-23T10:14:51Z", "message": "NXP-28939: split the retention based event rule properties"}, "afterCommit": {"oid": "e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "committedDate": "2020-04-23T10:21:20Z", "message": "NXP-28939: split the retention based event rule properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDQ4NjMz", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399048633", "createdAt": "2020-04-23T12:28:36Z", "commit": {"oid": "e207e5ab86b28fb06d87600e4bd5f6dae2f05c89"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "committedDate": "2020-04-23T10:21:20Z", "message": "NXP-28939: split the retention based event rule properties"}, "afterCommit": {"oid": "8df0865d9f626a1cfab18464910933d323202ed7", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8df0865d9f626a1cfab18464910933d323202ed7", "committedDate": "2020-04-23T14:00:32Z", "message": "NXP-28939: split the retention based event rule properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Mjc4MTA1", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399278105", "createdAt": "2020-04-23T16:35:26Z", "commit": {"oid": "8df0865d9f626a1cfab18464910933d323202ed7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjozNToyN1rOGKxeRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjozNToyN1rOGKxeRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk0OTUwOQ==", "bodyText": "small typo: matadataXPath", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r413949509", "createdAt": "2020-04-23T16:35:27Z", "author": {"login": "nmpcunha"}, "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -108,7 +110,7 @@ protected void awaitRetentionExpiration(long millis) throws InterruptedException\n \n     protected RetentionRule createRuleWithActions(RetentionRule.ApplicationPolicy policy,\n             StartingPointPolicy startingPointPolicy, List<String> docTypes, String startingPointEventId,\n-            String startingPointExpression, String matadataXPath, long years, long months, long days,\n+            String startingPointExpressionLanguage, String startingPointEventInput, String matadataXPath, long years, long months, long days,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8df0865d9f626a1cfab18464910933d323202ed7"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MjgyNDkx", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399282491", "createdAt": "2020-04-23T16:40:46Z", "commit": {"oid": "8df0865d9f626a1cfab18464910933d323202ed7"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NTc5ODcz", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399579873", "createdAt": "2020-04-24T01:19:38Z", "commit": {"oid": "8df0865d9f626a1cfab18464910933d323202ed7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwMToxOTozOFrOGLCaZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwMToxOTozOFrOGLCaZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIyNzA0NQ==", "bodyText": "This seems unnecessarily verbose to me. I would suggest just startingPointExpression and startingPointValue instead (same with related various constants, parameters and variables).", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414227045", "createdAt": "2020-04-24T01:19:38Z", "author": {"login": "efge"}, "path": "addons/nuxeo-retention/nuxeo-retention-core/src/main/resources/schemas/retention_definition.xsd", "diffHunk": "@@ -31,7 +31,8 @@\n       <xs:restriction base=\"xs:string\" ref:resolver=\"directoryResolver\" ref:directory=\"RetentionEvent\" />\n     </xs:simpleType>\n   </xs:element>\n-  <xs:element name=\"startingPointExpression\" type=\"xs:string\" />\n+  <xs:element name=\"startingPointExpressionLanguage\" type=\"xs:string\" />\n+  <xs:element name=\"startingPointEventInput\" type=\"xs:string\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8df0865d9f626a1cfab18464910933d323202ed7"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8df0865d9f626a1cfab18464910933d323202ed7", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8df0865d9f626a1cfab18464910933d323202ed7", "committedDate": "2020-04-23T14:00:32Z", "message": "NXP-28939: split the retention based event rule properties"}, "afterCommit": {"oid": "a99dba500600464a79c7819deacf50d33b65af96", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a99dba500600464a79c7819deacf50d33b65af96", "committedDate": "2020-04-24T07:59:15Z", "message": "NXP-28939: split the retention based event rule properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a99dba500600464a79c7819deacf50d33b65af96", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a99dba500600464a79c7819deacf50d33b65af96", "committedDate": "2020-04-24T07:59:15Z", "message": "NXP-28939: split the retention based event rule properties"}, "afterCommit": {"oid": "d0046a782bc8e04c39497fb9749eebacc80290cd", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d0046a782bc8e04c39497fb9749eebacc80290cd", "committedDate": "2020-04-24T08:00:43Z", "message": "NXP-28939: split the retention based event rule properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0046a782bc8e04c39497fb9749eebacc80290cd", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d0046a782bc8e04c39497fb9749eebacc80290cd", "committedDate": "2020-04-24T08:00:43Z", "message": "NXP-28939: split the retention based event rule properties"}, "afterCommit": {"oid": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "committedDate": "2020-04-24T08:08:25Z", "message": "NXP-28939: split the retention based event rule properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODM1MzA4", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399835308", "createdAt": "2020-04-24T10:41:29Z", "commit": {"oid": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDo0MToyOVrOGLRq0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDo0MToyOVrOGLRq0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3NzAxMA==", "bodyText": "CoreBulkFeature is declared by CoreFeature, you should already have it in the test (no needs to depend on it).", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414477010", "createdAt": "2020-04-24T10:41:29Z", "author": {"login": "kevinleturc"}, "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -50,7 +51,7 @@\n  * @since 11.1\n  */\n @RunWith(FeaturesRunner.class)\n-@Features({ TransactionalFeature.class, AutomationFeature.class })\n+@Features({ TransactionalFeature.class, AutomationFeature.class, CoreBulkFeature.class })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3852c471f061cb82447b4496aa144b754bf44890", "committedDate": "2020-04-24T10:50:01Z", "message": "NXP-28939: split the retention based event rule properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "committedDate": "2020-04-24T08:08:25Z", "message": "NXP-28939: split the retention based event rule properties"}, "afterCommit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890", "author": {"user": {"login": "RSalem07", "name": "Salem Aouana"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3852c471f061cb82447b4496aa144b754bf44890", "committedDate": "2020-04-24T10:50:01Z", "message": "NXP-28939: split the retention based event rule properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODQxNDY0", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399841464", "createdAt": "2020-04-24T10:51:50Z", "commit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODQ1NDE2", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399845416", "createdAt": "2020-04-24T10:58:28Z", "commit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDo1ODoyOFrOGLSPJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDo1ODoyOFrOGLSPJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4NjMwOA==", "bodyText": "Does this pass linting? If yes, it is ok for me!", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414486308", "createdAt": "2020-04-24T10:58:28Z", "author": {"login": "nmpcunha"}, "path": "addons/nuxeo-retention/nuxeo-retention-web-ui/src/main/resources/web/nuxeo.war/ui/document/retentionrule/nuxeo-retentionrule-view-layout.html", "diffHunk": "@@ -69,7 +69,7 @@\n         <div role=\"widget\">\n           <label>[[i18n(\"retention.rule.label.startPolicy.eventBased.expression.placeholder\")]]</label>\n           <nuxeo-tag name=\"eventInput\">\n-            [[document.properties.retention_def:startingPointExpression]]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODQ1NzY2", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399845766", "createdAt": "2020-04-24T10:59:01Z", "commit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTg0MjI2", "url": "https://github.com/nuxeo/nuxeo/pull/3963#pullrequestreview-399984226", "createdAt": "2020-04-24T14:13:42Z", "commit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDoxMzo0M1rOGLZs8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDoxNToyN1rOGLZxtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwODYyNg==", "bodyText": "missing space after ,", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414608626", "createdAt": "2020-04-24T14:13:43Z", "author": {"login": "efge"}, "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -131,23 +134,30 @@ protected RetentionRule createRuleWithActions(RetentionRule.ApplicationPolicy po\n     protected RetentionRule createImmediateRuleMillis(RetentionRule.ApplicationPolicy policy, long durationMillis,\n             List<String> beginActions, List<String> endActions) {\n         return createRuleWithActions(policy, RetentionRule.StartingPointPolicy.IMMEDIATE, Arrays.asList(\"File\"), null,\n-                null, null, 0L, 0L, 0L, durationMillis, beginActions, endActions);\n+                null, null,null, 0L, 0L, 0L, durationMillis, beginActions, endActions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwODg1Mw==", "bodyText": "missing space after , (and 2 others below)", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414608853", "createdAt": "2020-04-24T14:13:57Z", "author": {"login": "efge"}, "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/TestRetentionManager.java", "diffHunk": "@@ -61,19 +68,19 @@ public void testRuleOnlyFile() {\n     @Test\n     public void test1DayManualImmediateRuleRunningRetention() throws InterruptedException {\n         assertStillUnderRetentionAfter(file, createRuleWithActions(RetentionRule.ApplicationPolicy.MANUAL,\n-                RetentionRule.StartingPointPolicy.IMMEDIATE, null, null, null, null, 0, 0, 1, 0, null, null), 1000);\n+                RetentionRule.StartingPointPolicy.IMMEDIATE, null, null, null, null,null, 0, 0, 1, 0, null, null), 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwOTg0Ng==", "bodyText": "Maybe change the i18n label too? Not sure.", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414609846", "createdAt": "2020-04-24T14:15:27Z", "author": {"login": "efge"}, "path": "addons/nuxeo-retention/nuxeo-retention-web-ui/src/main/resources/web/nuxeo.war/ui/document/retentionrule/nuxeo-retentionrule-create-layout.html", "diffHunk": "@@ -116,11 +116,11 @@\n              min-chars=\"0\">\n            </nuxeo-directory-suggestion>\n            <nuxeo-input role=\"widget\" name=\"eventInput\"\n-                        label=\"[[i18n('retention.rule.label.startPolicy.eventBased.expression.description')]]\"\n-                        placeholder=\"[[i18n('retention.rule.label.startPolicy.eventBased.expression.placeholder')]]\"\n-                        name=\"startingPointExpression\"\n+                        label=\"[[i18n('retention.rule.label.startPolicy.eventBased.input.description')]]\"\n+                        placeholder=\"[[i18n('retention.rule.label.startPolicy.eventBased.input.placeholder')]]\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3852c471f061cb82447b4496aa144b754bf44890"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4778, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}