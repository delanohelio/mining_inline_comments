{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzOTU1OTk3", "number": 3812, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTo1MToxOVrODlZMQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTo1MTo1OVrODlZNCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTM2NjQxOnYy", "diffSide": "RIGHT", "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/main/java/org/nuxeo/ecm/platform/comment/impl/CommentsMigrator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTo1MToxOVrOFyQogg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTo1MToxOVrOFyQogg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0NTYzNA==", "bodyText": "https://jira.nuxeo.com/browse/NXP-28130 was supposed to fix this but I guess we forgot some cases :(", "url": "https://github.com/nuxeo/nuxeo/pull/3812#discussion_r388245634", "createdAt": "2020-03-05T11:51:19Z", "author": {"login": "efge"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/main/java/org/nuxeo/ecm/platform/comment/impl/CommentsMigrator.java", "diffHunk": "@@ -272,8 +272,11 @@ protected void migrateCommentsFromPropertyToSecured(CoreSession session, TreeCom\n \n         // Strip ACLs\n         ACP acp = session.getACP(commentIdRef);\n-        acp.removeACL(LOCAL_ACL);\n-        session.setACP(commentIdRef, acp, true);\n+        // Case where a comment is on a placeless document which has no acp\n+        if (acp != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "513db85f0f574170ab08fb123f4ee12d97910695"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTM2ODQzOnYy", "diffSide": "RIGHT", "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTo1MTo1OVrOFyQpug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTo1MTo1OVrOFyQpug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0NTk0Ng==", "bodyText": "Empty line not needed", "url": "https://github.com/nuxeo/nuxeo/pull/3812#discussion_r388245946", "createdAt": "2020-03-05T11:51:59Z", "author": {"login": "efge"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -517,6 +556,17 @@ protected void migrateFromPropertyToSecured(Migrator migrator, boolean commentsW\n                     \"Migrating comments from Property to Secured: 201/250\", //\n                     \"Migrating comments from Property to Secured: 250/250\", //\n                     \"Done Migrating from Property to Secured: 200/250\"));\n+        } else if (commentsWithPlacelessParent) {\n+            expectedLines.addAll(Arrays.asList( //\n+                    \"Initializing: 0/-1\", //\n+                    \"Migrating comments from Property to Secured: 1/250\", //\n+                    \"Migrating comments from Property to Secured: 51/250\", //\n+                    \"Migrating comments from Property to Secured: 101/250\", //\n+                    \"Migrating comments from Property to Secured: 151/250\", //\n+                    \"Migrating comments from Property to Secured: 201/250\", //\n+                    \"Migrating comments from Property to Secured: 250/250\", //\n+                    \"Done Migrating from Property to Secured: 250/250\"));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "513db85f0f574170ab08fb123f4ee12d97910695"}, "originalPosition": 122}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4162, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}