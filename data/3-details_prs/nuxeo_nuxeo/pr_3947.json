{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MDUyMjUy", "number": 3947, "title": "NXP-28532: mention failing doc id and property when reindexing ES", "bodyText": "Helps with debugging when ES reindexing fails", "createdAt": "2020-04-20T13:07:09Z", "url": "https://github.com/nuxeo/nuxeo/pull/3947", "merged": true, "mergeCommit": {"oid": "13bded1820b77ed02a84d0e01e2bcb505614fe29"}, "closed": true, "closedAt": "2020-04-24T11:33:01Z", "author": {"login": "NourNuxeo"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZezy_gBqjMyNTE2NjI5MzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcav2F2AFqTM5OTg2NjAzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b5d57665ecd18309d59dcf2392b8a9c4194bd72", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1b5d57665ecd18309d59dcf2392b8a9c4194bd72", "committedDate": "2020-04-20T13:04:52Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}, "afterCommit": {"oid": "c77d0c64b54447ce05afec70ff239f53403654c3", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c77d0c64b54447ce05afec70ff239f53403654c3", "committedDate": "2020-04-20T13:07:48Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c77d0c64b54447ce05afec70ff239f53403654c3", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c77d0c64b54447ce05afec70ff239f53403654c3", "committedDate": "2020-04-20T13:07:48Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}, "afterCommit": {"oid": "eded036c968cc05ebdc49c8f740ef32990057964", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/eded036c968cc05ebdc49c8f740ef32990057964", "committedDate": "2020-04-20T14:13:41Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTM1NTk1", "url": "https://github.com/nuxeo/nuxeo/pull/3947#pullrequestreview-396535595", "createdAt": "2020-04-20T14:58:21Z", "commit": {"oid": "eded036c968cc05ebdc49c8f740ef32990057964"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDo1ODoyMlrOGIYyTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDo1ODoyMlrOGIYyTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ0Nzg4Nw==", "bodyText": "You can do directly throw new NuxeoException(message, e), no need for addInfo which is only useful if you rethrow the same NuxeoException that you caught.", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r411447887", "createdAt": "2020-04-20T14:58:22Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-elasticsearch/nuxeo-elasticsearch-core/src/main/java/org/nuxeo/elasticsearch/io/JsonESDocumentWriter.java", "diffHunk": "@@ -212,7 +217,14 @@ protected static void writeProperties(JsonGenerator jg, DocumentModel doc, Strin\n         }\n \n         for (Property p : properties) {\n-            writer.writeProperty(jg, p);\n+            try {\n+                writer.writeProperty(jg, p);\n+            } catch (ClassCastException e) {\n+                var nuxeoException = new NuxeoException(e);\n+                nuxeoException.addInfo(\n+                        String.format(\"writing JSON property failed on document: %s for property: %s\", doc, p));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eded036c968cc05ebdc49c8f740ef32990057964"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eded036c968cc05ebdc49c8f740ef32990057964", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/eded036c968cc05ebdc49c8f740ef32990057964", "committedDate": "2020-04-20T14:13:41Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}, "afterCommit": {"oid": "e7560624c2c72c2ee895dbca809c650d75839e1a", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e7560624c2c72c2ee895dbca809c650d75839e1a", "committedDate": "2020-04-20T15:17:28Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MzY0NTE2", "url": "https://github.com/nuxeo/nuxeo/pull/3947#pullrequestreview-397364516", "createdAt": "2020-04-21T14:05:44Z", "commit": {"oid": "e7560624c2c72c2ee895dbca809c650d75839e1a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNDowNTo0NFrOGJHmvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNDowNTo0NFrOGJHmvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxNDk3Mg==", "bodyText": "Please keep the original exception as last argument when throwing a new one.", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r412214972", "createdAt": "2020-04-21T14:05:44Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-elasticsearch/nuxeo-elasticsearch-core/src/main/java/org/nuxeo/elasticsearch/io/JsonESDocumentWriter.java", "diffHunk": "@@ -212,7 +217,12 @@ protected static void writeProperties(JsonGenerator jg, DocumentModel doc, Strin\n         }\n \n         for (Property p : properties) {\n-            writer.writeProperty(jg, p);\n+            try {\n+                writer.writeProperty(jg, p);\n+            } catch (ClassCastException e) {\n+                throw new NuxeoException(\n+                        String.format(\"writing JSON property failed on document: %s for property: %s\", doc, p));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7560624c2c72c2ee895dbca809c650d75839e1a"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7560624c2c72c2ee895dbca809c650d75839e1a", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e7560624c2c72c2ee895dbca809c650d75839e1a", "committedDate": "2020-04-20T15:17:28Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}, "afterCommit": {"oid": "e465cd1997ee3cd0c75a7562d5eb1a849a47f246", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e465cd1997ee3cd0c75a7562d5eb1a849a47f246", "committedDate": "2020-04-21T14:11:30Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MTQyNzkx", "url": "https://github.com/nuxeo/nuxeo/pull/3947#pullrequestreview-398142791", "createdAt": "2020-04-22T12:34:32Z", "commit": {"oid": "e465cd1997ee3cd0c75a7562d5eb1a849a47f246"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODMzODgw", "url": "https://github.com/nuxeo/nuxeo/pull/3947#pullrequestreview-398833880", "createdAt": "2020-04-23T07:36:41Z", "commit": {"oid": "e465cd1997ee3cd0c75a7562d5eb1a849a47f246"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzozNjo0MlrOGKbBtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzozNjo0MlrOGKbBtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTc0OA==", "bodyText": "Doesn't seem used.", "url": "https://github.com/nuxeo/nuxeo/pull/3947#discussion_r413581748", "createdAt": "2020-04-23T07:36:42Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-elasticsearch/nuxeo-elasticsearch-core/src/main/java/org/nuxeo/elasticsearch/io/JsonESDocumentWriter.java", "diffHunk": "@@ -59,6 +62,8 @@\n  */\n public class JsonESDocumentWriter {\n \n+    private static final Logger log = LogManager.getLogger(JsonESDocumentWriter.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e465cd1997ee3cd0c75a7562d5eb1a849a47f246"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d27f43df67798968d88b11b63d6df1e6a771a553", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d27f43df67798968d88b11b63d6df1e6a771a553", "committedDate": "2020-04-23T08:55:08Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e465cd1997ee3cd0c75a7562d5eb1a849a47f246", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/e465cd1997ee3cd0c75a7562d5eb1a849a47f246", "committedDate": "2020-04-21T14:11:30Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}, "afterCommit": {"oid": "d27f43df67798968d88b11b63d6df1e6a771a553", "author": {"user": {"login": "NourNuxeo", "name": "Nour AL KOTOB"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d27f43df67798968d88b11b63d6df1e6a771a553", "committedDate": "2020-04-23T08:55:08Z", "message": "NXP-28532: mention failing doc id and property when reindexing ES"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MTM2OTcy", "url": "https://github.com/nuxeo/nuxeo/pull/3947#pullrequestreview-399136972", "createdAt": "2020-04-23T14:11:02Z", "commit": {"oid": "d27f43df67798968d88b11b63d6df1e6a771a553"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODY2MDMw", "url": "https://github.com/nuxeo/nuxeo/pull/3947#pullrequestreview-399866030", "createdAt": "2020-04-24T11:32:44Z", "commit": {"oid": "d27f43df67798968d88b11b63d6df1e6a771a553"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4775, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}