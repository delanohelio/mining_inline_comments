{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNDE2NDIz", "number": 4417, "title": "Fix NXP-29699 by returning 400-class error on bad queries", "bodyText": "Fix for Jira Issue: https://jira.nuxeo.com/browse/NXP-29699", "createdAt": "2020-10-28T09:49:48Z", "url": "https://github.com/nuxeo/nuxeo/pull/4417", "merged": true, "mergeCommit": {"oid": "25d7f475242673dbd6c0f8c390a1d4d60c06ebb8"}, "closed": true, "closedAt": "2020-11-02T09:11:00Z", "author": {"login": "charlesboidot"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW63TSAFqTUxODUxMDAxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXpqCXgFqTUyMDg1MjEzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTEwMDEy", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-518510012", "createdAt": "2020-10-28T10:18:28Z", "commit": {"oid": "68b0c7ef4192d88cfb9081f6604e07ebefc4af80"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODI1MDMy", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-518825032", "createdAt": "2020-10-28T15:59:14Z", "commit": {"oid": "68b0c7ef4192d88cfb9081f6604e07ebefc4af80"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTo1OToxNVrOHpxcJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTo1OToxNVrOHpxcJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MzY4NA==", "bodyText": "Space after ,", "url": "https://github.com/nuxeo/nuxeo/pull/4417#discussion_r513563684", "createdAt": "2020-10-28T15:59:15Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-storage-sql/nuxeo-core-storage-sql/src/main/java/org/nuxeo/ecm/core/storage/sql/jdbc/NXQLQueryMaker.java", "diffHunk": "@@ -1101,7 +1101,7 @@ public void visitFromClause(FromClause node) {\n                 }\n                 Set<String> subTypes = model.getDocumentSubTypes(typeName);\n                 if (subTypes == null) {\n-                    throw new QueryParseException(\"Unknown type: \" + typeName);\n+                    throw new QueryParseException(\"Unknown type: \" + typeName,SC_BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68b0c7ef4192d88cfb9081f6604e07ebefc4af80"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68b0c7ef4192d88cfb9081f6604e07ebefc4af80", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/68b0c7ef4192d88cfb9081f6604e07ebefc4af80", "committedDate": "2020-10-26T11:38:43Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}, "afterCommit": {"oid": "b89ac93bf2974af0ab326521b94b23ef1cb4c392", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/b89ac93bf2974af0ab326521b94b23ef1cb4c392", "committedDate": "2020-10-28T16:13:16Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b89ac93bf2974af0ab326521b94b23ef1cb4c392", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/b89ac93bf2974af0ab326521b94b23ef1cb4c392", "committedDate": "2020-10-28T16:13:16Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}, "afterCommit": {"oid": "2feb3b345210ba2cea85072002e470bc8b8f2639", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/2feb3b345210ba2cea85072002e470bc8b8f2639", "committedDate": "2020-10-28T16:14:47Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODQ0ODcy", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-518844872", "createdAt": "2020-10-28T16:17:35Z", "commit": {"oid": "2feb3b345210ba2cea85072002e470bc8b8f2639"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjoxNzozNVrOHpyV4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjoxODowOVrOHpyXWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3ODQ2NA==", "bodyText": "Formatter should put static imports before regular ones.", "url": "https://github.com/nuxeo/nuxeo/pull/4417#discussion_r513578464", "createdAt": "2020-10-28T16:17:35Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-query/src/main/java/org/nuxeo/ecm/core/query/QueryParseException.java", "diffHunk": "@@ -22,6 +22,7 @@\n package org.nuxeo.ecm.core.query;\n \n import org.nuxeo.ecm.core.api.NuxeoException;\n+import static org.apache.http.HttpStatus.SC_BAD_REQUEST;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2feb3b345210ba2cea85072002e470bc8b8f2639"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3ODY1MQ==", "bodyText": "Ok but all other super calls in other constructors should do the same", "url": "https://github.com/nuxeo/nuxeo/pull/4417#discussion_r513578651", "createdAt": "2020-10-28T16:17:51Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-query/src/main/java/org/nuxeo/ecm/core/query/QueryParseException.java", "diffHunk": "@@ -34,7 +35,7 @@ public QueryParseException() {\n     }\n \n     public QueryParseException(String message) {\n-        super(message);\n+        super(message, SC_BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2feb3b345210ba2cea85072002e470bc8b8f2639"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3ODg0Mw==", "bodyText": "All changes in this class not needed after the constructor changes are done.", "url": "https://github.com/nuxeo/nuxeo/pull/4417#discussion_r513578843", "createdAt": "2020-10-28T16:18:09Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-storage-sql/nuxeo-core-storage-sql/src/main/java/org/nuxeo/ecm/core/storage/sql/jdbc/JDBCMapper.java", "diffHunk": "@@ -428,7 +430,7 @@ public IterableQueryResult queryAndFetch(String query, String queryType, QueryFi\n         try {\n             return new ResultSetQueryResult(queryMaker, query, queryFilter, pathResolver, this, params);\n         } catch (SQLException e) {\n-            throw new NuxeoException(\"Invalid query: \" + queryType + \": \" + query, e);\n+            throw new NuxeoException(\"Invalid query: \" + queryType + \": \" + query, e, SC_BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2feb3b345210ba2cea85072002e470bc8b8f2639"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2feb3b345210ba2cea85072002e470bc8b8f2639", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/2feb3b345210ba2cea85072002e470bc8b8f2639", "committedDate": "2020-10-28T16:14:47Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}, "afterCommit": {"oid": "98c7fcf9d51b4f48697cac12a68165b790308ecd", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/98c7fcf9d51b4f48697cac12a68165b790308ecd", "committedDate": "2020-10-28T16:21:40Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NjQ1MTgz", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-519645183", "createdAt": "2020-10-29T13:09:20Z", "commit": {"oid": "98c7fcf9d51b4f48697cac12a68165b790308ecd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzowOToyMFrOHqbAUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzowOToyMFrOHqbAUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI0NDY5MA==", "bodyText": "This one should call super(SC_BAD_REQUEST);", "url": "https://github.com/nuxeo/nuxeo/pull/4417#discussion_r514244690", "createdAt": "2020-10-29T13:09:20Z", "author": {"login": "kevinleturc"}, "path": "modules/core/nuxeo-core-query/src/main/java/org/nuxeo/ecm/core/query/QueryParseException.java", "diffHunk": "@@ -34,15 +35,15 @@ public QueryParseException() {\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98c7fcf9d51b4f48697cac12a68165b790308ecd"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98c7fcf9d51b4f48697cac12a68165b790308ecd", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/98c7fcf9d51b4f48697cac12a68165b790308ecd", "committedDate": "2020-10-28T16:21:40Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}, "afterCommit": {"oid": "8fa7a82e8a170780eb1170c825915c5d6e4f1551", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8fa7a82e8a170780eb1170c825915c5d6e4f1551", "committedDate": "2020-10-29T13:16:33Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzc2NjIy", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-519776622", "createdAt": "2020-10-29T15:16:18Z", "commit": {"oid": "8fa7a82e8a170780eb1170c825915c5d6e4f1551"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNToxNjoxOFrOHqg1uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNToxNjoxOFrOHqg1uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM0MDI4MQ==", "bodyText": "What about using javax.servlet.http.HttpServletResponse.SC_BAD_REQUEST like what we did in other Exception such as DocumentNotFoundException or ConcurrentUpdateException?\nSame for other status code.", "url": "https://github.com/nuxeo/nuxeo/pull/4417#discussion_r514340281", "createdAt": "2020-10-29T15:16:18Z", "author": {"login": "troger"}, "path": "modules/core/nuxeo-core-query/src/main/java/org/nuxeo/ecm/core/query/QueryParseException.java", "diffHunk": "@@ -21,6 +21,8 @@\n \n package org.nuxeo.ecm.core.query;\n \n+import static org.apache.http.HttpStatus.SC_BAD_REQUEST;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fa7a82e8a170780eb1170c825915c5d6e4f1551"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODEzNTk0", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-520813594", "createdAt": "2020-10-30T16:03:01Z", "commit": {"oid": "8fa7a82e8a170780eb1170c825915c5d6e4f1551"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eac0a77549ca429c10620c8e84b221cc620327e2", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/eac0a77549ca429c10620c8e84b221cc620327e2", "committedDate": "2020-10-30T16:23:54Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8fa7a82e8a170780eb1170c825915c5d6e4f1551", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8fa7a82e8a170780eb1170c825915c5d6e4f1551", "committedDate": "2020-10-29T13:16:33Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}, "afterCommit": {"oid": "eac0a77549ca429c10620c8e84b221cc620327e2", "author": {"user": {"login": "charlesboidot", "name": "Charles Boidot"}}, "url": "https://github.com/nuxeo/nuxeo/commit/eac0a77549ca429c10620c8e84b221cc620327e2", "committedDate": "2020-10-30T16:23:54Z", "message": "Fix NXP-29699 by returning 400-class error on bad queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODM1MzY4", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-520835368", "createdAt": "2020-10-30T16:29:12Z", "commit": {"oid": "eac0a77549ca429c10620c8e84b221cc620327e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODUyMTMz", "url": "https://github.com/nuxeo/nuxeo/pull/4417#pullrequestreview-520852133", "createdAt": "2020-10-30T16:49:31Z", "commit": {"oid": "eac0a77549ca429c10620c8e84b221cc620327e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4944, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}