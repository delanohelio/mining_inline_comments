{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyOTczOTE0", "number": 4272, "title": "NXP-29573 runtime errors/warnings tracking", "bodyText": "", "createdAt": "2020-08-25T06:27:05Z", "url": "https://github.com/nuxeo/nuxeo/pull/4272", "merged": true, "mergeCommit": {"oid": "05f47822ede4a8adf4f228357e75e794deeacfec"}, "closed": true, "closedAt": "2020-08-31T13:25:22Z", "author": {"login": "atchertchian"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCXVLdAFqTQ3NDQyNTUwMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdESotEgFqTQ3ODYwNTY0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDI1NTAz", "url": "https://github.com/nuxeo/nuxeo/pull/4272#pullrequestreview-474425503", "createdAt": "2020-08-25T12:22:27Z", "commit": {"oid": "0ce2f522bcf83d8fd4a9d6a6e8707456b8f3b1a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoyMjoyOFrOHGVg3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoyMjoyOFrOHGVg3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwNTk4Mw==", "bodyText": "To remove?", "url": "https://github.com/nuxeo/nuxeo/pull/4272#discussion_r476405983", "createdAt": "2020-08-25T12:22:28Z", "author": {"login": "kevinleturc"}, "path": "modules/core/nuxeo-core-schema/src/main/java/org/nuxeo/ecm/core/schema/TypeService.java", "diffHunk": "@@ -20,12 +20,16 @@\n package org.nuxeo.ecm.core.schema;\n \n import org.nuxeo.runtime.RuntimeMessage.Level;\n+import org.nuxeo.runtime.RuntimeMessage.Source;\n import org.nuxeo.runtime.RuntimeServiceException;\n import org.nuxeo.runtime.logging.DeprecationLogger;\n import org.nuxeo.runtime.model.ComponentContext;\n import org.nuxeo.runtime.model.ComponentInstance;\n+import org.nuxeo.runtime.model.ComponentName;\n import org.nuxeo.runtime.model.DefaultComponent;\n \n+import jnr.ffi.Struct.socklen_t;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ce2f522bcf83d8fd4a9d6a6e8707456b8f3b1a2"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ce2f522bcf83d8fd4a9d6a6e8707456b8f3b1a2", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/0ce2f522bcf83d8fd4a9d6a6e8707456b8f3b1a2", "committedDate": "2020-08-25T05:59:48Z", "message": "NXP-29573: reset only bundle/component/extension runtime messages on hot reload"}, "afterCommit": {"oid": "6daaf613396c1fbe5625119515b11935e0d3ad0a", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/6daaf613396c1fbe5625119515b11935e0d3ad0a", "committedDate": "2020-08-25T13:39:23Z", "message": "NXP-29573: reset only bundle/component/extension runtime messages on hot reload"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDM0Mjg5", "url": "https://github.com/nuxeo/nuxeo/pull/4272#pullrequestreview-474434289", "createdAt": "2020-08-25T12:34:29Z", "commit": {"oid": "7f481653b2d46cd6d85806ed0f3228f330328539"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjozNDoyOVrOHGV7FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjozNDoyOVrOHGV7FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQxMjY5Mw==", "bodyText": "Spurious import", "url": "https://github.com/nuxeo/nuxeo/pull/4272#discussion_r476412693", "createdAt": "2020-08-25T12:34:29Z", "author": {"login": "efge"}, "path": "modules/core/nuxeo-core-schema/src/main/java/org/nuxeo/ecm/core/schema/TypeService.java", "diffHunk": "@@ -20,12 +20,16 @@\n package org.nuxeo.ecm.core.schema;\n \n import org.nuxeo.runtime.RuntimeMessage.Level;\n+import org.nuxeo.runtime.RuntimeMessage.Source;\n import org.nuxeo.runtime.RuntimeServiceException;\n import org.nuxeo.runtime.logging.DeprecationLogger;\n import org.nuxeo.runtime.model.ComponentContext;\n import org.nuxeo.runtime.model.ComponentInstance;\n+import org.nuxeo.runtime.model.ComponentName;\n import org.nuxeo.runtime.model.DefaultComponent;\n \n+import jnr.ffi.Struct.socklen_t;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f481653b2d46cd6d85806ed0f3228f330328539"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NTg5MjU0", "url": "https://github.com/nuxeo/nuxeo/pull/4272#pullrequestreview-474589254", "createdAt": "2020-08-25T15:19:31Z", "commit": {"oid": "6daaf613396c1fbe5625119515b11935e0d3ad0a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6daaf613396c1fbe5625119515b11935e0d3ad0a", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/6daaf613396c1fbe5625119515b11935e0d3ad0a", "committedDate": "2020-08-25T13:39:23Z", "message": "NXP-29573: reset only bundle/component/extension runtime messages on hot reload"}, "afterCommit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c9e0770002ed355adc4c0599d8d01ec9ecb458b0", "committedDate": "2020-08-27T16:57:21Z", "message": "NXP-29573: remove now useless RuntimeMessageHandler#addMessage(level, message) newly added API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODE5MTU1", "url": "https://github.com/nuxeo/nuxeo/pull/4272#pullrequestreview-477819155", "createdAt": "2020-08-28T15:22:10Z", "commit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODk1NzE1", "url": "https://github.com/nuxeo/nuxeo/pull/4272#pullrequestreview-477895715", "createdAt": "2020-08-28T17:11:31Z", "commit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxMTozMVrOHJOR0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxNTozMlrOHJOZhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzMzE2OA==", "bodyText": "Could we deprecate this constructor?\nFurthermore, can we pass CODE as source and this class name as sourceId to avoid future check on these fields due to deprecation?", "url": "https://github.com/nuxeo/nuxeo/pull/4272#discussion_r479433168", "createdAt": "2020-08-28T17:11:31Z", "author": {"login": "kevinleturc"}, "path": "modules/runtime/nuxeo-runtime/src/main/java/org/nuxeo/runtime/RuntimeMessage.java", "diffHunk": "@@ -32,9 +32,19 @@\n \n     protected final String message;\n \n-    public RuntimeMessage(Level level, String message) {\n+    protected final Source source;\n+\n+    protected final String sourceId;\n+\n+    public RuntimeMessage(Level level, String message, Source source, String sourceId) {\n         this.level = level;\n         this.message = message;\n+        this.source = source;\n+        this.sourceId = sourceId;\n+    }\n+\n+    public RuntimeMessage(Level level, String message) {\n+        this(level, message, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzMzQxOA==", "bodyText": "Extra line.", "url": "https://github.com/nuxeo/nuxeo/pull/4272#discussion_r479433418", "createdAt": "2020-08-28T17:12:01Z", "author": {"login": "kevinleturc"}, "path": "modules/runtime/nuxeo-runtime/src/main/java/org/nuxeo/runtime/AbstractRuntimeService.java", "diffHunk": "@@ -131,6 +134,7 @@ public synchronized void start() {\n         try {\n             loadConfig();\n         } catch (IOException e) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNDM4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                      org.nuxeo.runtime.RuntimeMessage.Level.ERROR, err, Source.DEPLOYMENT, null)));\n          \n          \n            \n                                      RuntimeMessage.Level.ERROR, err, Source.DEPLOYMENT, \"org.nuxeo.runtime.deployment.preprocessor.DeploymentPreprocessor\")));\n          \n      \n    \n    \n  \n\n?", "url": "https://github.com/nuxeo/nuxeo/pull/4272#discussion_r479434388", "createdAt": "2020-08-28T17:14:01Z", "author": {"login": "kevinleturc"}, "path": "modules/runtime/nuxeo-runtime/src/main/java/org/nuxeo/runtime/AbstractRuntimeService.java", "diffHunk": "@@ -99,7 +100,9 @@ protected AbstractRuntimeService(DefaultRuntimeContext context, Map<String, Stri\n         // get errors set by NuxeoDeployer\n         String errs = System.getProperty(\"org.nuxeo.runtime.deployment.errors\");\n         if (errs != null) {\n-            Arrays.asList(errs.split(\"\\n\")).forEach(err -> messageHandler.addMessage(RuntimeMessage.Level.ERROR, err));\n+            Arrays.asList(errs.split(\"\\n\"))\n+                  .forEach(err -> messageHandler.addMessage(new RuntimeMessage(\n+                          org.nuxeo.runtime.RuntimeMessage.Level.ERROR, err, Source.DEPLOYMENT, null)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNTE0MQ==", "bodyText": "Why not giving just the Source?", "url": "https://github.com/nuxeo/nuxeo/pull/4272#discussion_r479435141", "createdAt": "2020-08-28T17:15:32Z", "author": {"login": "kevinleturc"}, "path": "modules/runtime/nuxeo-runtime-test/src/test/java/org/nuxeo/runtime/RuntimeInitializationTest.java", "diffHunk": "@@ -53,13 +56,26 @@ public void testContributions() {\n \n     protected void checkDupe(boolean detected) {\n         List<String> errors = Framework.getRuntime().getMessageHandler().getMessages(Level.ERROR);\n+        List<RuntimeMessage> errorMessages = Framework.getRuntime().getMessageHandler().getRuntimeMessages(Level.ERROR);\n         if (detected) {\n             assertEquals(List.of(\"Duplicate component name: service:my.comp2\"), errors);\n+            assertEquals(List.of(Source.COMPONENT),\n+                    errorMessages.stream().map(RuntimeMessage::getSource).collect(Collectors.toList()));\n+            assertEquals(List.of(\"my.comp2\"),\n+                    errorMessages.stream().map(RuntimeMessage::getSourceId).collect(Collectors.toList()));\n         } else {\n             assertTrue(errors.isEmpty());\n         }\n     }\n \n+    protected void checkErrorSource(boolean fromExtension) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79630f3c3d72906a3f88cdeac960cd9357b24f9c", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/79630f3c3d72906a3f88cdeac960cd9357b24f9c", "committedDate": "2020-08-31T07:33:47Z", "message": "NXP-29573: add a source and source id to runtime messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f8f10ba6663a7586de59378c248afffeb2c61e3", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/8f8f10ba6663a7586de59378c248afffeb2c61e3", "committedDate": "2020-08-31T07:35:48Z", "message": "NXP-29573: fill source and source id on runtime messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd2044515b4431e79412e249a0b96b53d1235711", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/fd2044515b4431e79412e249a0b96b53d1235711", "committedDate": "2020-08-31T07:35:50Z", "message": "NXP-29573: track originating extension for some contributions registration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "991bf7f53ceb27cb86c463e3d15d681453b2f13f", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/991bf7f53ceb27cb86c463e3d15d681453b2f13f", "committedDate": "2020-08-31T07:35:50Z", "message": "NXP-29573: reset only bundle/component/extension runtime messages on hot reload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d329ce45a68e088fc278aedc6cafc89f343e0110", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d329ce45a68e088fc278aedc6cafc89f343e0110", "committedDate": "2020-08-31T07:35:50Z", "message": "NXP-29573: remove now useless RuntimeMessageHandler#addMessage(level, message) newly added API\n\nIntroduces an unknown source and fallback values for source and source id, to avoid null values."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9e0770002ed355adc4c0599d8d01ec9ecb458b0", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c9e0770002ed355adc4c0599d8d01ec9ecb458b0", "committedDate": "2020-08-27T16:57:21Z", "message": "NXP-29573: remove now useless RuntimeMessageHandler#addMessage(level, message) newly added API"}, "afterCommit": {"oid": "d329ce45a68e088fc278aedc6cafc89f343e0110", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d329ce45a68e088fc278aedc6cafc89f343e0110", "committedDate": "2020-08-31T07:35:50Z", "message": "NXP-29573: remove now useless RuntimeMessageHandler#addMessage(level, message) newly added API\n\nIntroduces an unknown source and fallback values for source and source id, to avoid null values."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MzkxODU1", "url": "https://github.com/nuxeo/nuxeo/pull/4272#pullrequestreview-478391855", "createdAt": "2020-08-31T07:47:02Z", "commit": {"oid": "d329ce45a68e088fc278aedc6cafc89f343e0110"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjA1NjQ1", "url": "https://github.com/nuxeo/nuxeo/pull/4272#pullrequestreview-478605645", "createdAt": "2020-08-31T13:15:41Z", "commit": {"oid": "d329ce45a68e088fc278aedc6cafc89f343e0110"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4961, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}