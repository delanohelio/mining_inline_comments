{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NTk2NDE1", "number": 3784, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxNDo1OFrODqhPtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToyNjoyOVrODqhe6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1OTExNDc4OnYy", "diffSide": "RIGHT", "path": "nuxeo-core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSTransactionState.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxNDo1OFrOF6UWcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjowNDoyNVrOF63iGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5NTE1NQ==", "bodyText": "Can we make DBSTransactionState a Closeable?", "url": "https://github.com/nuxeo/nuxeo/pull/3784#discussion_r396695155", "createdAt": "2020-03-23T19:14:58Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSTransactionState.java", "diffHunk": "@@ -151,13 +161,24 @@\n \n     protected final Set<String> browsePermissions;\n \n-    public DBSTransactionState(DBSRepository repository, DBSSession session) {\n+    public DBSTransactionState(DBSRepository repository, DBSConnection connection, DBSSession session) {\n         this.repository = repository;\n+        this.connection = connection;\n         this.session = session;\n         SecurityService securityService = Framework.getService(SecurityService.class);\n         browsePermissions = new HashSet<>(Arrays.asList(securityService.getPermissionsToCheck(BROWSE)));\n     }\n \n+    /** @since 11.1 */\n+    public void close() {\n+        connection.close();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a57e1b8b7e8f5b4a1bd187977788b02cdb8ffd08"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NTQ0Mg==", "bodyText": "Yes I don't think it's a problem.", "url": "https://github.com/nuxeo/nuxeo/pull/3784#discussion_r397055442", "createdAt": "2020-03-24T10:41:17Z", "author": {"login": "efge"}, "path": "nuxeo-core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSTransactionState.java", "diffHunk": "@@ -151,13 +161,24 @@\n \n     protected final Set<String> browsePermissions;\n \n-    public DBSTransactionState(DBSRepository repository, DBSSession session) {\n+    public DBSTransactionState(DBSRepository repository, DBSConnection connection, DBSSession session) {\n         this.repository = repository;\n+        this.connection = connection;\n         this.session = session;\n         SecurityService securityService = Framework.getService(SecurityService.class);\n         browsePermissions = new HashSet<>(Arrays.asList(securityService.getPermissionsToCheck(BROWSE)));\n     }\n \n+    /** @since 11.1 */\n+    public void close() {\n+        connection.close();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5NTE1NQ=="}, "originalCommit": {"oid": "a57e1b8b7e8f5b4a1bd187977788b02cdb8ffd08"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3MTU3OA==", "bodyText": "Autocloseable actually has this really has nothing to do with java.io", "url": "https://github.com/nuxeo/nuxeo/pull/3784#discussion_r397271578", "createdAt": "2020-03-24T16:04:25Z", "author": {"login": "efge"}, "path": "nuxeo-core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSTransactionState.java", "diffHunk": "@@ -151,13 +161,24 @@\n \n     protected final Set<String> browsePermissions;\n \n-    public DBSTransactionState(DBSRepository repository, DBSSession session) {\n+    public DBSTransactionState(DBSRepository repository, DBSConnection connection, DBSSession session) {\n         this.repository = repository;\n+        this.connection = connection;\n         this.session = session;\n         SecurityService securityService = Framework.getService(SecurityService.class);\n         browsePermissions = new HashSet<>(Arrays.asList(securityService.getPermissionsToCheck(BROWSE)));\n     }\n \n+    /** @since 11.1 */\n+    public void close() {\n+        connection.close();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5NTE1NQ=="}, "originalCommit": {"oid": "a57e1b8b7e8f5b4a1bd187977788b02cdb8ffd08"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1OTE1MzY5OnYy", "diffSide": "RIGHT", "path": "nuxeo-core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSSession.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToyNjoyOVrOF6UvXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDozODo1NFrOF6qQYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwMTUzMg==", "bodyText": "I didn't find any other instantiation of DBSTransactionState which makes me think we don't need to change the DBSTransactionState constructor and just do the getConnection into it, wdy?", "url": "https://github.com/nuxeo/nuxeo/pull/3784#discussion_r396701532", "createdAt": "2020-03-23T19:26:29Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSSession.java", "diffHunk": "@@ -192,7 +192,9 @@\n \n     public DBSSession(DBSRepository repository) {\n         this.repository = repository;\n-        transaction = new DBSTransactionState(repository, this);\n+        @SuppressWarnings(\"resource\") // connection closed by DBSTransactionState.close\n+        DBSConnection connection = repository.getConnection();\n+        transaction = new DBSTransactionState(repository, connection, this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a57e1b8b7e8f5b4a1bd187977788b02cdb8ffd08"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NDA1MA==", "bodyText": "Yes I'll do that", "url": "https://github.com/nuxeo/nuxeo/pull/3784#discussion_r397054050", "createdAt": "2020-03-24T10:38:54Z", "author": {"login": "efge"}, "path": "nuxeo-core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSSession.java", "diffHunk": "@@ -192,7 +192,9 @@\n \n     public DBSSession(DBSRepository repository) {\n         this.repository = repository;\n-        transaction = new DBSTransactionState(repository, this);\n+        @SuppressWarnings(\"resource\") // connection closed by DBSTransactionState.close\n+        DBSConnection connection = repository.getConnection();\n+        transaction = new DBSTransactionState(repository, connection, this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwMTUzMg=="}, "originalCommit": {"oid": "a57e1b8b7e8f5b4a1bd187977788b02cdb8ffd08"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4283, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}