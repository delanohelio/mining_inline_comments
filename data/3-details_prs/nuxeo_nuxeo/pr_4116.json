{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTQ4NTc3", "number": 4116, "title": "Feature NXP-29190 add profile mechanism", "bodyText": "Open in draft to get the JX statuses + early review if any.", "createdAt": "2020-06-04T16:18:20Z", "url": "https://github.com/nuxeo/nuxeo/pull/4116", "merged": true, "mergeCommit": {"oid": "ea04c08b032c00c83af607f1e9e76eabcaa7ba98"}, "closed": true, "closedAt": "2020-06-10T16:22:50Z", "author": {"login": "kevinleturc"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoBVyEgFqTQyNDY2MzQ2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp7fWSgFqTQyODE4MTQ4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjYzNDYz", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-424663463", "createdAt": "2020-06-04T17:16:45Z", "commit": {"oid": "af61543a70856e24fb9765e10459298d88d418e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoxNjo0NVrOGfP6ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoxNjo0NVrOGfP6ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTc4Ng==", "bodyText": "I'd use \"\" instead of EMPTY, it's shorter and doesn't require a dependency \ud83d\ude04", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r435419786", "createdAt": "2020-06-04T17:16:45Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ConfigurationGenerator.java", "diffHunk": "@@ -112,7 +113,13 @@\n     /** @since 11.1 */\n     public static final String NUXEO_ENVIRONMENT = System.getenv(\"NUXEO_ENVIRONMENT\");\n \n-    /** @since 6.0 */\n+    /** @since 11.1 */\n+    public static final String NUXEO_PROFILES = System.getenv().getOrDefault(\"NUXEO_PROFILES\", EMPTY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af61543a70856e24fb9765e10459298d88d418e1"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af61543a70856e24fb9765e10459298d88d418e1", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/af61543a70856e24fb9765e10459298d88d418e1", "committedDate": "2020-06-04T16:17:19Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "a7ee14b09083f9dec46ea74c5c621bf95054ac1a", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a7ee14b09083f9dec46ea74c5c621bf95054ac1a", "committedDate": "2020-06-08T08:52:58Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a7ee14b09083f9dec46ea74c5c621bf95054ac1a", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a7ee14b09083f9dec46ea74c5c621bf95054ac1a", "committedDate": "2020-06-08T08:52:58Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "d5b51b156d553387c7580985bbbaeddcf0a24b25", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d5b51b156d553387c7580985bbbaeddcf0a24b25", "committedDate": "2020-06-08T10:57:31Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5b51b156d553387c7580985bbbaeddcf0a24b25", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d5b51b156d553387c7580985bbbaeddcf0a24b25", "committedDate": "2020-06-08T10:57:31Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "9774426be8907bf5328fa4faf4a1c89397e4a5aa", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/9774426be8907bf5328fa4faf4a1c89397e4a5aa", "committedDate": "2020-06-08T10:58:36Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9774426be8907bf5328fa4faf4a1c89397e4a5aa", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/9774426be8907bf5328fa4faf4a1c89397e4a5aa", "committedDate": "2020-06-08T10:58:36Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "ba53804d8c34ae49cbb13a2016aad3b9cc514674", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/ba53804d8c34ae49cbb13a2016aad3b9cc514674", "committedDate": "2020-06-08T11:03:15Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba53804d8c34ae49cbb13a2016aad3b9cc514674", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/ba53804d8c34ae49cbb13a2016aad3b9cc514674", "committedDate": "2020-06-08T11:03:15Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "83575fc90b344b78034db1d2dd8885d8c258bd11", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/83575fc90b344b78034db1d2dd8885d8c258bd11", "committedDate": "2020-06-08T11:04:52Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "83575fc90b344b78034db1d2dd8885d8c258bd11", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/83575fc90b344b78034db1d2dd8885d8c258bd11", "committedDate": "2020-06-08T11:04:52Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "bce57a4e7995f12dd5bd4a9145948d3bb4951d86", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/bce57a4e7995f12dd5bd4a9145948d3bb4951d86", "committedDate": "2020-06-08T11:09:41Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bce57a4e7995f12dd5bd4a9145948d3bb4951d86", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/bce57a4e7995f12dd5bd4a9145948d3bb4951d86", "committedDate": "2020-06-08T11:09:41Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "38cfdbf865e0a2e6d341d1ad56d17d052c1c4760", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/38cfdbf865e0a2e6d341d1ad56d17d052c1c4760", "committedDate": "2020-06-08T11:10:12Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTYyNDkw", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-426162490", "createdAt": "2020-06-08T12:08:29Z", "commit": {"oid": "38cfdbf865e0a2e6d341d1ad56d17d052c1c4760"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMjowODoyOVrOGgauMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMjowODoyOVrOGgauMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY0NTQyNg==", "bodyText": "Unused import?", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r436645426", "createdAt": "2020-06-08T12:08:29Z", "author": {"login": "troger"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/info/ConfigurationInfo.java", "diffHunk": "@@ -19,6 +19,8 @@\n \n package org.nuxeo.launcher.info;\n \n+import org.apache.commons.collections.CollectionUtils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38cfdbf865e0a2e6d341d1ad56d17d052c1c4760"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38cfdbf865e0a2e6d341d1ad56d17d052c1c4760", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/38cfdbf865e0a2e6d341d1ad56d17d052c1c4760", "committedDate": "2020-06-08T11:10:12Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/836a5caed9ef74be51ae2f036396ece6d4900811", "committedDate": "2020-06-08T12:17:13Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTY4NzYy", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-426168762", "createdAt": "2020-06-08T12:18:10Z", "commit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjQ3Mjg4", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-426247288", "createdAt": "2020-06-08T13:37:04Z", "commit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzozNzowNFrOGgec6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzozNzowNFrOGgec6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjcwNjUzNg==", "bodyText": "wouldn't you want to use the other signature of getEnvironment() with a default ?\nThe signature with a default is used in the public setProperties() method (line 1677) so it may be more consistent ?\nThe documentation says this signature (without a default) is only for tests. But it seems to be used in several internal methods. Maybe it's outdated ?\n\n\n@APinote exists to be overridden by tests", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r436706536", "createdAt": "2020-06-08T13:37:04Z", "author": {"login": "NourNuxeo"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ConfigurationGenerator.java", "diffHunk": "@@ -2032,10 +2049,28 @@ protected String getJavaOptsString() {\n     }\n \n     /**\n-     * @return the value of an environment variable. Overriden for testing.\n+     * @return the value of an environment variable\n      * @since 9.1\n+     * @apiNote exists to be overridden by tests\n      */\n-    protected String getEnvironmentVariableValue(String key) {\n+    protected String getEnvironment(String key) {\n         return System.getenv(key);\n     }\n+\n+    /**\n+     * @return the value of an environment variable\n+     * @since 11.1\n+     * @see #getEnvironment(String)\n+     */\n+    protected String getEnvironment(String key, String defaultValue) {\n+        return Objects.requireNonNullElse(getEnvironment(key), defaultValue);\n+    }\n+\n+    /**\n+     * @return the nuxeo.defaults file for current {@code NUXEO_ENVIRONMENT}\n+     * @since 11.1\n+     */\n+    protected String getNuxeoEnvironmentConfName() {\n+        return String.format(NUXEO_ENVIRONMENT_CONF_FORMAT, getEnvironment(NUXEO_ENVIRONMENT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2Mjg5MzM3", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-426289337", "createdAt": "2020-06-08T14:18:16Z", "commit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDoxODoxNlrOGggzew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDoxODoxNlrOGggzew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NTA4Mw==", "bodyText": "this is only used once line 148, is this for clarity ?", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r436745083", "createdAt": "2020-06-08T14:18:16Z", "author": {"login": "NourNuxeo"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -141,8 +143,9 @@ public String getContextName() {\n      */\n     protected void parseAndCopy(Properties config) throws IOException, TemplateException, ConfigurationException {\n         // FilenameFilter for excluding \"nuxeo.defaults\" files from copy\n+        String nuxeoEnvironmentConf = generator.getNuxeoEnvironmentConfName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjkxMTAz", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-426291103", "createdAt": "2020-06-08T14:20:13Z", "commit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDoyMDoxM1rOGgg4bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDoyMDoxM1rOGgg4bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc0NjM1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            Arrays.asList(generator.getEnvironment(NUXEO_PROFILES, \"\").split(TEMPLATE_SEPARATOR)));\n          \n          \n            \n                            List.of(generator.getEnvironment(NUXEO_PROFILES, \"\").split(TEMPLATE_SEPARATOR)));", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r436746351", "createdAt": "2020-06-08T14:20:13Z", "author": {"login": "NourNuxeo"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -614,8 +617,11 @@ public InstanceInfo getInfo(String clid, List<LocalPackage> pkgs) {\n             nxInstance.packages.add(info);\n             pkgTemplates.addAll(info.templates);\n         }\n-        // templates\n         nxInstance.config = new ConfigurationInfo();\n+        // profiles\n+        nxInstance.config.profiles.addAll(\n+                Arrays.asList(generator.getEnvironment(NUXEO_PROFILES, \"\").split(TEMPLATE_SEPARATOR)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzAzOTM5", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-426303939", "createdAt": "2020-06-08T14:33:19Z", "commit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDozMzoyMFrOGghcrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNDozNDowOVrOGgheuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1NTYzMA==", "bodyText": "no more Boolean.TRUE ?", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r436755630", "createdAt": "2020-06-08T14:33:20Z", "author": {"login": "NourNuxeo"}, "path": "modules/runtime/nuxeo-launcher-commons/src/test/java/org/nuxeo/launcher/config/ConfigurationGeneratorTest.java", "diffHunk": "@@ -531,4 +543,22 @@ public void testCheckEncoding() throws Exception {\n         }\n     }\n \n+    @Test\n+    public void testIncludeProfile() {\n+        String profileToTest = \"testprofile\";\n+        assertFalse(\"Profile should not be included\", isTemplateIncluded(profileToTest));\n+        assertNotEquals(\"true\", configGenerator.getUserConfig().getProperty(\"nuxeo.profile.added.by.test\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1NjE1Mg==", "bodyText": "same question about Boolean.TRUE", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r436756152", "createdAt": "2020-06-08T14:34:09Z", "author": {"login": "NourNuxeo"}, "path": "modules/runtime/nuxeo-launcher-commons/src/test/java/org/nuxeo/launcher/config/ConfigurationGeneratorTest.java", "diffHunk": "@@ -531,4 +543,22 @@ public void testCheckEncoding() throws Exception {\n         }\n     }\n \n+    @Test\n+    public void testIncludeProfile() {\n+        String profileToTest = \"testprofile\";\n+        assertFalse(\"Profile should not be included\", isTemplateIncluded(profileToTest));\n+        assertNotEquals(\"true\", configGenerator.getUserConfig().getProperty(\"nuxeo.profile.added.by.test\"));\n+\n+        env.put(NUXEO_PROFILES, profileToTest);\n+\n+        configGenerator.init(true);\n+\n+        assertTrue(\"Profile should be included\", isTemplateIncluded(profileToTest));\n+        assertEquals(\"true\", configGenerator.getUserConfig().getProperty(\"nuxeo.profile.added.by.test\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTI1MDE5", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-426925019", "createdAt": "2020-06-09T08:53:44Z", "commit": {"oid": "c5ad7719e5f3e1182d93eefe4ce8f528e9285089"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODo1Mzo0NFrOGg_SOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODo1Mzo0NFrOGg_SOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI0NDQ3Mw==", "bodyText": "@since 11.1 maybe, though the class existed inline before?", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r437244473", "createdAt": "2020-06-09T08:53:44Z", "author": {"login": "ataillefer"}, "path": "modules/runtime/nuxeo-launcher-commons/src/test/java/org/nuxeo/launcher/config/LogCaptureAppender.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *  \n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *  \n+ *  Contributors:\n+ *      Kevin Leturc <kleturc@nuxeo.com>\n+ */\n+\n+package org.nuxeo.launcher.config;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.core.LogEvent;\n+import org.apache.logging.log4j.core.appender.AbstractAppender;\n+import org.apache.logging.log4j.core.config.Property;\n+\n+public class LogCaptureAppender extends AbstractAppender {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5ad7719e5f3e1182d93eefe4ce8f528e9285089"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5783514af922feb8194ab9dbae9ed981d3510666", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/5783514af922feb8194ab9dbae9ed981d3510666", "committedDate": "2020-06-10T13:34:59Z", "message": "NXP-29190: Cleanup / Format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4256faf9f948312ee852a515f72959e5a7ebe56", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c4256faf9f948312ee852a515f72959e5a7ebe56", "committedDate": "2020-06-10T13:35:04Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "836a5caed9ef74be51ae2f036396ece6d4900811", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/836a5caed9ef74be51ae2f036396ece6d4900811", "committedDate": "2020-06-08T12:17:13Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}, "afterCommit": {"oid": "c4256faf9f948312ee852a515f72959e5a7ebe56", "author": {"user": {"login": "kevinleturc", "name": "Kevin Leturc"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c4256faf9f948312ee852a515f72959e5a7ebe56", "committedDate": "2020-06-10T13:35:04Z", "message": "NXP-29190: Add Nuxeo Profiles notion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDYxOTk3", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-428061997", "createdAt": "2020-06-10T13:39:13Z", "commit": {"oid": "c4256faf9f948312ee852a515f72959e5a7ebe56"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MTUxOTU1", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-428151955", "createdAt": "2020-06-10T15:06:38Z", "commit": {"oid": "c4256faf9f948312ee852a515f72959e5a7ebe56"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MTgxMjE2", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-428181216", "createdAt": "2020-06-10T15:35:22Z", "commit": {"oid": "c4256faf9f948312ee852a515f72959e5a7ebe56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTozNToyMlrOGh6uzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTozNToyMlrOGh6uzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxODQ0NQ==", "bodyText": "For strings I prefer StringUtils's defautString but I guess requireNonNullElse works too", "url": "https://github.com/nuxeo/nuxeo/pull/4116#discussion_r438218445", "createdAt": "2020-06-10T15:35:22Z", "author": {"login": "efge"}, "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ConfigurationGenerator.java", "diffHunk": "@@ -2032,10 +2049,28 @@ protected String getJavaOptsString() {\n     }\n \n     /**\n-     * @return the value of an environment variable. Overriden for testing.\n+     * @return the value of an environment variable\n      * @since 9.1\n+     * @apiNote exists to be overridden by tests\n      */\n-    protected String getEnvironmentVariableValue(String key) {\n+    protected String getEnvironment(String key) {\n         return System.getenv(key);\n     }\n+\n+    /**\n+     * @return the value of an environment variable\n+     * @since 11.1\n+     * @see #getEnvironment(String)\n+     */\n+    protected String getEnvironment(String key, String defaultValue) {\n+        return Objects.requireNonNullElse(getEnvironment(key), defaultValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4256faf9f948312ee852a515f72959e5a7ebe56"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MTgxNDg1", "url": "https://github.com/nuxeo/nuxeo/pull/4116#pullrequestreview-428181485", "createdAt": "2020-06-10T15:35:37Z", "commit": {"oid": "c4256faf9f948312ee852a515f72959e5a7ebe56"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4701, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}