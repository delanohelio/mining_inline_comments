{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MzQ3MTYy", "number": 4048, "title": "NXP-20646 Explorer ftests + misc bugfixes", "bodyText": "Ended up mixing several bugfixes/improvements while ftesting import and export of distributions (https://jira.nuxeo.com/browse/NXP-20646)\nIncludes:\n\nthumbnail conversion disablement (speeds up indexing after import) https://jira.nuxeo.com/browse/NXP-28928\nfix operations filtering on partial distributions export (https://jira.nuxeo.com/browse/NXP-29117)\nmisc javascript errors on some screens (https://jira.nuxeo.com/browse/NXP-29123 + https://jira.nuxeo.com/browse/NXP-29124)\nfix navigation to bundle group on persisted distributions (after a first fix was done while working on documentation removal..)\ntesting, testing and more testing in various cases, that helped revealing these bugs\n\nT&P in progress at https://qa.nuxeo.org/jenkins/job/TestAndPush/job/ondemand-testandpush-atchertchian-master/221", "createdAt": "2020-05-18T08:42:15Z", "url": "https://github.com/nuxeo/nuxeo/pull/4048", "merged": true, "mergeCommit": {"oid": "ab257acccd862b1014a7e3bed8228e9892f26c11"}, "closed": true, "closedAt": "2020-05-20T16:14:17Z", "author": {"login": "atchertchian"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcignNnAFqTQxMzYxNzUzMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjLYysAFqTQxNTQ5NDM2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNjE3NTMw", "url": "https://github.com/nuxeo/nuxeo/pull/4048#pullrequestreview-413617530", "createdAt": "2020-05-18T13:55:10Z", "commit": {"oid": "ef10d32f988fb2934e2f225b260268b8ef633ef1"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMzo1NToxMFrOGW4R3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMzo1NzoyNFrOGW4YVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY0MzkzMg==", "bodyText": "You should use doc.putContextData() directly.", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r426643932", "createdAt": "2020-05-18T13:55:10Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/adapters/BundleGroupDocAdapter.java", "diffHunk": "@@ -64,6 +65,8 @@ public static BundleGroupDocAdapter create(BundleGroup bundleGroup, CoreSession\n             files.add(item);\n         }\n         doc.setPropertyValue(PROP_READMES, files);\n+\n+        doc.getContextData().put(ThumbnailConstants.DISABLE_THUMBNAIL_COMPUTATION, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef10d32f988fb2934e2f225b260268b8ef633ef1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY0NTU4OQ==", "bodyText": "No need for ; I think", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r426645589", "createdAt": "2020-05-18T13:57:24Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/uploadEdit.ftl", "diffHunk": "@@ -1,43 +1,49 @@\n <@extends src=\"base.ftl\">\n \n-<@block name=\"stylesheets\">\n-</@block>\n-\n-\n-<@block name=\"header_scripts\">\n-</@block>\n-\n-<@block name=\"left\">\n-</@block>\n+<@block name=\"left\" />\n \n <@block name=\"right\">\n \n-  The distribution zip you have uploaded contains : ${snapObject.bundleIds?size} bundles. <br/><br/>\n-\n-  You can edit some of the properties of the Distribution before you validate the upload :<br/>\n+  <div>\n+    The distribution zip you have uploaded contains <b>${snapObject.bundleIds?size} bundles</b>.\n+  </div>\n+  <br />\n+  <div>\n+    You can edit some of the properties of the distribution before you validate the upload:<br/>\n+  </div>\n \n   <form method=\"POST\" action=\"${Root.path}/uploadDistribTmpValid\">\n-  <table>\n-   <tr>\n-     <td> Name : </td>\n-     <td> <input type=\"text\" name=\"name\" value=\"${tmpSnap.nxdistribution.name}\"/> </td>\n-   </tr>\n-   <tr>\n-     <td> Version : </td>\n-     <td> <input type=\"text\" name=\"version\" value=\"${tmpSnap.nxdistribution.version}\"/> </td>\n-   </tr>\n-   <tr>\n-     <td> Path Segment : </td>\n-     <td> <input type=\"text\" name=\"pathSegment\" value=\"${tmpSnap.name}\"/></td>\n-   </tr>\n-   <tr>\n-     <td> Title : </td>\n-     <td> <input type=\"text\" name=\"title\" value=\"${tmpSnap.title}\"/> </td>\n-   </tr>\n-   <tr><td colspan=\"2\">\n-    <input type=\"submit\" value=\"Import bundles\"/>\n-   </td></tr>\n-   </table>\n+    <table>\n+      <tr>\n+        <td>Name</td>\n+        <td>\n+          <input type=\"text\" name=\"name\" value=\"${tmpSnap.nxdistribution.name}\" width=\"100%\" />\n+        </td>\n+      </tr>\n+      <tr>\n+        <td>Version</td>\n+        <td>\n+          <input type=\"text\" name=\"version\" value=\"${tmpSnap.nxdistribution.version}\" width=\"100%\" />\n+        </td>\n+      </tr>\n+      <tr>\n+        <td>Path Segment</td>\n+        <td>\n+          <input type=\"text\" name=\"pathSegment\" value=\"${tmpSnap.name}\" width=\"100%\" />\n+        </td>\n+      </tr>\n+      <tr>\n+        <td>Title</td>\n+        <td>\n+          <input type=\"text\" name=\"title\" value=\"${tmpSnap.title}\" width=\"100%\" />\n+        </td>\n+      </tr>\n+      <tr>\n+        <td colspan=\"2\">\n+          <input type=\"submit\" value=\"Import bundles\" id=\"doImport\" onclick=\"this.classList.add('primary');\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d4d4956bba634cb21e993859a6733544fba7775"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d87cc4744a7c222f39eb0f5de0eee7ae429141ac", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d87cc4744a7c222f39eb0f5de0eee7ae429141ac", "committedDate": "2020-05-18T17:12:39Z", "message": "NXP-20646/NXP-28928: disable thumbnail conversion on explorer distribution persistence"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5161f25bac2537cb7ac3dc34833481fe82fc8808", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/5161f25bac2537cb7ac3dc34833481fe82fc8808", "committedDate": "2020-05-18T08:33:42Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}, "afterCommit": {"oid": "dfb145071b1823352ea04598f7b271aa55b7534f", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/dfb145071b1823352ea04598f7b271aa55b7534f", "committedDate": "2020-05-18T17:12:39Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfb145071b1823352ea04598f7b271aa55b7534f", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/dfb145071b1823352ea04598f7b271aa55b7534f", "committedDate": "2020-05-18T17:12:39Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}, "afterCommit": {"oid": "7e5ca51716acd9c58b3b2185f9a5239368cfd29b", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/7e5ca51716acd9c58b3b2185f9a5239368cfd29b", "committedDate": "2020-05-19T07:31:58Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e5ca51716acd9c58b3b2185f9a5239368cfd29b", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/7e5ca51716acd9c58b3b2185f9a5239368cfd29b", "committedDate": "2020-05-19T07:31:58Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}, "afterCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/305d9d139f52f0ef3e360e5c3506d397bf8b4e8d", "committedDate": "2020-05-19T08:24:56Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MjMzMzAw", "url": "https://github.com/nuxeo/nuxeo/pull/4048#pullrequestreview-414233300", "createdAt": "2020-05-19T08:48:46Z", "commit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwODo0ODo0N1rOGXWQ7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwODo1MjowOVrOGXWaqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzNTIxNQ==", "bodyText": "Indent issue", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427135215", "createdAt": "2020-05-19T08:48:47Z", "author": {"login": "akervern"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/forms.ftl", "diffHunk": "@@ -12,6 +12,7 @@\n     <#assign rtSnap=Root.runtimeDistribution/>\n     <#assign snapList=Root.listPersistedDistributions()/>\n \n+  <div>\n   <table class=\"tablesorter distributions\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzNTU3NA==", "bodyText": "Please avoid using <br> for spacing and rely on style.", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427135574", "createdAt": "2020-05-19T08:49:16Z", "author": {"login": "akervern"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/forms.ftl", "diffHunk": "@@ -103,26 +108,24 @@\n           </#if>\n         </td>\n         <td>\n-          <p><a class=\"button\" href=\"${Root.path}/download/${distrib.key}\">Export as zip</a></p>\n+          <p><a class=\"button\" href=\"${Root.path}/download/${distrib.key}\" onclick=\"this.classList.add('primary');\">Export as zip</a></p>\n         </td>\n       </tr>\n     </#list>\n \n   </table>\n+  </div>\n \n-  <h2>Upload Distribution</h2>\n+  <br />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzNTgzNQ==", "bodyText": "Indent", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427135835", "createdAt": "2020-05-19T08:49:36Z", "author": {"login": "akervern"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/forms.ftl", "diffHunk": "@@ -103,26 +108,24 @@\n           </#if>\n         </td>\n         <td>\n-          <p><a class=\"button\" href=\"${Root.path}/download/${distrib.key}\">Export as zip</a></p>\n+          <p><a class=\"button\" href=\"${Root.path}/download/${distrib.key}\" onclick=\"this.classList.add('primary');\">Export as zip</a></p>\n         </td>\n       </tr>\n     </#list>\n \n   </table>\n+  </div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzNjQ1NQ==", "bodyText": "Use a toggle function for adding a class dynamicaly", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427136455", "createdAt": "2020-05-19T08:50:27Z", "author": {"login": "akervern"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/forms.ftl", "diffHunk": "@@ -53,11 +54,11 @@\n               </tr>\n               <tr>\n                 <td class=\"nowrap\">Version</td>\n-                <td>${rtSnap.version}</td>\n+                <td><span name=\"version\">${rtSnap.version}</span></td>\n               </tr>\n             </table>\n             <i>Existing snapshot with the same name and version will be updated.</i><br/>\n-            <input type=\"submit\" value=\"Save\"/>\n+            <input type=\"submit\" value=\"Save\" id=\"doSave\" class=\"button\" onclick=\"this.classList.add('primary');\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzNjc4NA==", "bodyText": "Same function here", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427136784", "createdAt": "2020-05-19T08:50:52Z", "author": {"login": "akervern"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/forms.ftl", "diffHunk": "@@ -103,26 +108,24 @@\n           </#if>\n         </td>\n         <td>\n-          <p><a class=\"button\" href=\"${Root.path}/download/${distrib.key}\">Export as zip</a></p>\n+          <p><a class=\"button\" href=\"${Root.path}/download/${distrib.key}\" onclick=\"this.classList.add('primary');\">Export as zip</a></p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzNjg0OA==", "bodyText": "Same function", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427136848", "createdAt": "2020-05-19T08:50:58Z", "author": {"login": "akervern"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/forms.ftl", "diffHunk": "@@ -79,8 +80,12 @@\n                 <td class=\"nowrap\">Packages prefixes</td>\n                 <td><textarea rows=\"4\" cols=\"30\" name=\"packages\"></textarea></td>\n               </tr>\n+              <tr>\n+                <td class=\"nowrap\">Version</td>\n+                <td><span name=\"version\">${rtSnap.version}</span></td>\n+              </tr>\n             </table>\n-            <input type=\"submit\" value=\"Save\"/>\n+            <input type=\"submit\" value=\"Save\" id=\"doSaveExtended\" class=\"button\" onclick=\"this.classList.add('primary');\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzEzNzcwNw==", "bodyText": "Same here, avoir using br for spacing.", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427137707", "createdAt": "2020-05-19T08:52:09Z", "author": {"login": "akervern"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/uploadEdit.ftl", "diffHunk": "@@ -1,43 +1,49 @@\n <@extends src=\"base.ftl\">\n \n-<@block name=\"stylesheets\">\n-</@block>\n-\n-\n-<@block name=\"header_scripts\">\n-</@block>\n-\n-<@block name=\"left\">\n-</@block>\n+<@block name=\"left\" />\n \n <@block name=\"right\">\n \n-  The distribution zip you have uploaded contains : ${snapObject.bundleIds?size} bundles. <br/><br/>\n-\n-  You can edit some of the properties of the Distribution before you validate the upload :<br/>\n+  <div>\n+    The distribution zip you have uploaded contains <b>${snapObject.bundleIds?size} bundles</b>.\n+  </div>\n+  <br />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "305d9d139f52f0ef3e360e5c3506d397bf8b4e8d"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9b18d3a295fd6ccaf1f166d85bd5b88a69c973e", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c9b18d3a295fd6ccaf1f166d85bd5b88a69c973e", "committedDate": "2020-05-19T09:28:04Z", "message": "give up button highlights (to fixup)"}, "afterCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/b998dd6a5eedc9014f1e076a26fff79f2bf597a2", "committedDate": "2020-05-19T09:51:00Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Njg1NTg2", "url": "https://github.com/nuxeo/nuxeo/pull/4048#pullrequestreview-414685586", "createdAt": "2020-05-19T17:49:54Z", "commit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2"}, "state": "DISMISSED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNzo0OTo1NVrOGXr2Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODoxNDowOVrOGXsxsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ4ODg1MQ==", "bodyText": "Remove redundant = null", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427488851", "createdAt": "2020-05-19T17:49:55Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/ITExplorerAdminTest.java", "diffHunk": "@@ -32,6 +64,46 @@\n  */\n public class ITExplorerAdminTest extends AbstractExplorerTest {\n \n+    public static File downloadDir = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5Mzc4Mw==", "bodyText": "If you don't need the value of i itself but just to get the next element sometimes, you can work with an iterator:\nfor (Iterator<String> lineIter = lines.iterator(); lineIter.hasNext(); ) {\n    String path = lineIter.next();\n    ...\n    ... Integer.valueOf(lineIter.next()) ...\n}", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427493783", "createdAt": "2020-05-19T17:57:34Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/ITExplorerAdminTest.java", "diffHunk": "@@ -62,4 +136,171 @@ public void testDistribAdminPage() {\n         page.check();\n     }\n \n+    @Test\n+    public void testHomePageLiveDistrib() {\n+        ExplorerHomePage home = goHome();\n+        home.check();\n+        // check upload form is here for admin\n+        asPage(UploadFragment.class);\n+    }\n+\n+    protected String getDistribId(String name, String version) {\n+        return String.format(\"%s-%s\", name, version);\n+    }\n+\n+    protected String getDistribExportName(String distribId) {\n+        return String.format(\"nuxeo-distribution-%s.zip\", distribId);\n+    }\n+\n+    protected void checkLiveDistrib(String distribId) {\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_BUNDLEGROUPS);\n+        checkBundleGroups();\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_BUNDLES);\n+        checkBundles(false);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_COMPONENTS);\n+        checkComponents(false);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_EXTENSIONPOINTS);\n+        checkExtensionPoints(false);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_SERVICES);\n+        checkServices(false);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_CONTRIBUTIONS);\n+        checkContributions(false);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_OPERATIONS);\n+        checkOperations(false);\n+    }\n+\n+    @Test\n+    public void testLiveDistribExportAndImport() {\n+        String distribName = \"my-server\";\n+        open(DistribAdminPage.URL);\n+        String version = asPage(DistribAdminPage.class).saveCurrentLiveDistrib(distribName, false);\n+        String distribId = getDistribId(distribName, version);\n+        asPage(ExplorerHomePage.class).checkPersistedDistrib(distribId);\n+        checkLiveDistrib(distribId);\n+\n+        // check importing it back\n+        open(DistribAdminPage.URL);\n+        String filename = getDistribExportName(distribId);\n+        File file = asPage(DistribAdminPage.class).exportFirstPersistedDistrib(downloadDir, filename);\n+\n+        open(DistribAdminPage.URL);\n+        String newDistribName = \"imported-server\";\n+        String newVersion = \"1.0.0\";\n+        asPage(DistribAdminPage.class).importPersistedDistrib(file, newDistribName, newVersion, null);\n+        open(ExplorerHomePage.URL);\n+        String newDistribId = getDistribId(newDistribName, newVersion);\n+        asPage(ExplorerHomePage.class).checkPersistedDistrib(newDistribId);\n+        checkLiveDistrib(newDistribId);\n+    }\n+\n+    protected void checkPartialDistrib(String virtualBundleGroup, String distribId) {\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_BUNDLEGROUPS);\n+        checkPartialBundleGroup(virtualBundleGroup);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_BUNDLES);\n+        checkBundles(true);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_COMPONENTS);\n+        checkComponents(true);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_EXTENSIONPOINTS);\n+        checkExtensionPoints(true);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_SERVICES);\n+        checkServices(true);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_CONTRIBUTIONS);\n+        checkContributions(true);\n+        open(ExplorerHomePage.URL + distribId + \"/\" + ApiBrowserConstants.LIST_OPERATIONS);\n+        checkOperations(true);\n+    }\n+\n+    // will be easier to maintain as a reference when a specific bundle group is used for explorer...\n+    protected void checkPartialBundleGroup(String distribName) {\n+        Locator.findElementWaitUntilEnabledAndClick(By.linkText(distribName));\n+        BundleGroupArtifactPage apage = asPage(BundleGroupArtifactPage.class);\n+        apage.checkDocumentationText(null);\n+        apage.checkSubGroup(null);\n+        apage.checkBundle(\"org.nuxeo.apidoc.core\");\n+        apage.checkBundle(\"org.nuxeo.apidoc.repo\");\n+        apage.checkBundle(\"org.nuxeo.apidoc.webengine\");\n+    }\n+\n+    @Test\n+    public void testLivePartialDistribExportAndImport() {\n+        String distribName = \"my-partial-server\";\n+        open(DistribAdminPage.URL);\n+        String version = asPage(DistribAdminPage.class).saveCurrentLiveDistrib(distribName, true);\n+        String distribId = getDistribId(distribName, version);\n+        asPage(ExplorerHomePage.class).checkPersistedDistrib(distribId);\n+        checkPartialDistrib(distribName, distribId);\n+\n+        // check importing it back\n+        open(DistribAdminPage.URL);\n+        String filename = getDistribExportName(distribId);\n+        File file = asPage(DistribAdminPage.class).exportFirstPersistedDistrib(downloadDir, filename);\n+\n+        open(DistribAdminPage.URL);\n+        String newDistribName = \"partial-imported-server\";\n+        String newVersion = \"1.0.0\";\n+        asPage(DistribAdminPage.class).importPersistedDistrib(file, newDistribName, newVersion, null);\n+        open(ExplorerHomePage.URL);\n+        String newDistribId = getDistribId(newDistribName, newVersion);\n+        asPage(ExplorerHomePage.class).checkPersistedDistrib(newDistribId);\n+        checkPartialDistrib(distribName, newDistribId);\n+    }\n+\n+    protected void createSampleZip(String sourceDirPath, String zipFilePath, boolean addMarker) throws IOException {\n+        Path p = Files.createFile(Paths.get(zipFilePath));\n+        try (ZipOutputStream zs = new ZipOutputStream(Files.newOutputStream(p))) {\n+            if (addMarker) {\n+                ZipEntry zipEntry = new ZipEntry(\".nuxeo-archive\");\n+                zs.putNextEntry(zipEntry);\n+                zs.closeEntry();\n+            }\n+            // read paths from reference file as NuxeoArchiveReader requires a given order and extra info\n+            List<String> lines = Files.readAllLines(Paths.get(sourceDirPath, \"entries.txt\"));\n+            for (int i = 0; i < lines.size(); i++) {\n+                String path = lines.get(i);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2"}, "originalPosition": 225}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5NTAyOA==", "bodyText": "Asyn -> Async", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427495028", "createdAt": "2020-05-19T17:59:28Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/pages/AbstractExplorerPage.java", "diffHunk": "@@ -53,6 +71,17 @@ public void checkTitle(String expected) {\n         assertEquals(expected, driver.getTitle());\n     }\n \n+    /**\n+     * Waits for indexing to be done.\n+     */\n+    public void waitForAsynWork() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5NjI4MQ==", "bodyText": "Could put header.getText() (used 3 times) in a local variable", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427496281", "createdAt": "2020-05-19T18:01:24Z", "author": {"login": "efge"}, "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/pages/DistributionHomePage.java", "diffHunk": "@@ -69,7 +70,15 @@ public DistributionHomePage(WebDriver driver) {\n     @Override\n     public void check() {\n         checkTitle(\"Nuxeo Platform Explorer\");\n-        assertTrue(header.getText(), header.getText().startsWith(\"Browsing Distribution\"));\n+        checkHeader(null);\n+    }\n+\n+    public void checkHeader(String distribId) {\n+        if (distribId != null) {\n+            assertEquals(String.format(\"Browsing Distribution '%s'\", distribId), header.getText());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMjAwMA==", "bodyText": "If you want you could build the whole string directly as:\nString s = bids.stream().map(snapshot::getBundle).map(this::represent).collect(Collectors.joining());", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427502000", "createdAt": "2020-05-19T18:10:51Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-repo/src/test/java/org/nuxeo/apidoc/test/TestSnapshotPersist.java", "diffHunk": "@@ -125,61 +145,86 @@ protected String represent(NuxeoArtifact artifact) {\n         return res;\n     }\n \n-    protected void checkBundles(DistributionSnapshot snapshot) throws IOException {\n+    protected void checkBundles(DistributionSnapshot snapshot, boolean partial) throws IOException {\n         List<String> bids = snapshot.getBundleIds();\n \n         StringBuilder sb = new StringBuilder();\n         bids.forEach(bid -> sb.append(represent(snapshot.getBundle(bid))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwNDA0OQ==", "bodyText": "I'm not a fan of exclamation marks in messages", "url": "https://github.com/nuxeo/nuxeo/pull/4048#discussion_r427504049", "createdAt": "2020-05-19T18:14:09Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/resources/skin/views/distribution/saved.ftl", "diffHunk": "@@ -1,21 +1,14 @@\n <@extends src=\"base.ftl\">\n \n-<@block name=\"stylesheets\">\n-</@block>\n-\n-\n-<@block name=\"header_scripts\">\n-</@block>\n-\n-<@block name=\"left\">\n-</@block>\n+<@block name=\"left\" />\n \n <@block name=\"right\">\n \n-<h1> Distribution Snapshot saved OK </h1>\n-<script>\n-window.setTimeout(\"window.location.href='${Root.path}/'\",2000)\n-</script>\n+  <h1>Distribution Snapshot saved!</h1>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a05bd36d0a88a12454312cd96ba6c5c01ca8b9d7", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a05bd36d0a88a12454312cd96ba6c5c01ca8b9d7", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646: test export and import of live distribution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee7d6fa34d5770cf1329f0bde465edee273b39c0", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/ee7d6fa34d5770cf1329f0bde465edee273b39c0", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646: cleanup + visual improvements + ease up functional testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e2f55fb6c92bc98ca750992d566f637a8831d05", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/3e2f55fb6c92bc98ca750992d566f637a8831d05", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646/NXP-29117: test partial persistence (unit)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ddeae91764faa591abbc67eb78c99bb2f2f3f2a", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/2ddeae91764faa591abbc67eb78c99bb2f2f3f2a", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646/NXP-29117: fix & test partial persistence (functional)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b95540c6f5c0356cd7da453f5c9f70d57350baf1", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/b95540c6f5c0356cd7da453f5c9f70d57350baf1", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646: fix navigation to persisted bundle group (follow up of 27f3180adb4475759207c20a73ad4955ef32d554 done with NXP-28995).\nBe resilient to group id being prefixed or not + use constant + make retrieval efficient."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dee89e96c4e53e2fe11adf289eb7acec7485cc68", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/dee89e96c4e53e2fe11adf289eb7acec7485cc68", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646/NXP-29123: fix fulltext filter on persisted contributions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f0ceecda9441b8042c21a780c05a197de29bea9", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/1f0ceecda9441b8042c21a780c05a197de29bea9", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646/NXP-29124: fix js error on empty explorer listings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0d85acd9c09f6f1f120a35dcfd53ac25c5f9028", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/a0d85acd9c09f6f1f120a35dcfd53ac25c5f9028", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646: add pristine sample export for tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c362213a7533ba8668cddeab418c402c234aeace", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c362213a7533ba8668cddeab418c402c234aeace", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646: add sample import tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c967930dde321239477cd40adf1ece047cd3711e", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c967930dde321239477cd40adf1ece047cd3711e", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646: check live, partial and sample distributions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c430b3b7d161c93881747f1bf1063277de053929", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/c430b3b7d161c93881747f1bf1063277de053929", "committedDate": "2020-05-20T09:30:08Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5db56a5eff83b8a6e7bc704cdfd3251172092d5", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d5db56a5eff83b8a6e7bc704cdfd3251172092d5", "committedDate": "2020-05-20T09:50:53Z", "message": "NXP-20646: make new ftests less prone to randoms"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b998dd6a5eedc9014f1e076a26fff79f2bf597a2", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/b998dd6a5eedc9014f1e076a26fff79f2bf597a2", "committedDate": "2020-05-19T09:51:00Z", "message": "NXP-20646: autofocus on searches in explorer listings :gift:"}, "afterCommit": {"oid": "d5db56a5eff83b8a6e7bc704cdfd3251172092d5", "author": {"user": {"login": "atchertchian", "name": "Anahide Tchertchian"}}, "url": "https://github.com/nuxeo/nuxeo/commit/d5db56a5eff83b8a6e7bc704cdfd3251172092d5", "committedDate": "2020-05-20T09:50:53Z", "message": "NXP-20646: make new ftests less prone to randoms"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MzM2NzA0", "url": "https://github.com/nuxeo/nuxeo/pull/4048#pullrequestreview-415336704", "createdAt": "2020-05-20T13:31:47Z", "commit": {"oid": "d5db56a5eff83b8a6e7bc704cdfd3251172092d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NDk0MzY0", "url": "https://github.com/nuxeo/nuxeo/pull/4048#pullrequestreview-415494364", "createdAt": "2020-05-20T16:09:28Z", "commit": {"oid": "d5db56a5eff83b8a6e7bc704cdfd3251172092d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4736, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}