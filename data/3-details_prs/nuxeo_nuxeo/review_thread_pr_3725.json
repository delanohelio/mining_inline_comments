{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNDgyOTM3", "number": 3725, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTozMDo1MlrODd9ihQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo1NDowOFrODd99LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQzNTU3OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTozMDo1MlrOFm3HKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0MzowM1rOFm3clw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5MzE2MQ==", "bodyText": "I think we can remove --cascade=true --force=1 --grace-period=0 since a plain deletion is expected to work here.", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376293161", "createdAt": "2020-02-07T09:30:52Z", "author": {"login": "ataillefer"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,18 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              try {\n+                 // clean up the redis namespace\n+                // workaround for Cannot delete namespace still in Terminating #NXP-3228\n+                sh \"\"\"\n+                  kubectl get namespace ${NAMESPACE_REDIS} -o json | sed -e s/\\\\\"kubernetes\\\\\"//g  | kubectl replace --raw /api/v1/namespaces/${NAMESPACE_REDIS}/finalize -f -\n+                  kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true --cascade=true --force=1 --grace-period=0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d795afd61d253230be6e7e3d62771fc96568b21"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5ODY0Nw==", "bodyText": "thanks,\nwe can delete this options as you said", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376298647", "createdAt": "2020-02-07T09:43:03Z", "author": {"login": "doulba"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,18 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              try {\n+                 // clean up the redis namespace\n+                // workaround for Cannot delete namespace still in Terminating #NXP-3228\n+                sh \"\"\"\n+                  kubectl get namespace ${NAMESPACE_REDIS} -o json | sed -e s/\\\\\"kubernetes\\\\\"//g  | kubectl replace --raw /api/v1/namespaces/${NAMESPACE_REDIS}/finalize -f -\n+                  kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true --cascade=true --force=1 --grace-period=0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5MzE2MQ=="}, "originalCommit": {"oid": "7d795afd61d253230be6e7e3d62771fc96568b21"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQ1NjQwOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTozODowNVrOFm3TuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0ODo0NFrOFm3nJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5NjM3Nw==", "bodyText": "Can you please indent with 2 spaces instead of 3", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376296377", "createdAt": "2020-02-07T09:38:05Z", "author": {"login": "ataillefer"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,18 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              try {\n+                 // clean up the redis namespace", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d795afd61d253230be6e7e3d62771fc96568b21"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMTM1MQ==", "bodyText": "done", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376301351", "createdAt": "2020-02-07T09:48:44Z", "author": {"login": "doulba"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,18 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              try {\n+                 // clean up the redis namespace", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5NjM3Nw=="}, "originalCommit": {"oid": "7d795afd61d253230be6e7e3d62771fc96568b21"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQ2MTA3OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTozOTozOVrOFm3Wkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMTozODozOVrOFm6dcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5NzEwNw==", "bodyText": "I'm not in favor of catching any error here: if there is an error in the workaround or the deletion, it is not expected, so we want to be aware of it even if it makes the build fail.\nThis is how we detected the namespace deletion problem in the first place, because the jobs were red.", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376297107", "createdAt": "2020-02-07T09:39:39Z", "author": {"login": "ataillefer"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,18 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              try {\n+                 // clean up the redis namespace\n+                // workaround for Cannot delete namespace still in Terminating #NXP-3228\n+                sh \"\"\"\n+                  kubectl get namespace ${NAMESPACE_REDIS} -o json | sed -e s/\\\\\"kubernetes\\\\\"//g  | kubectl replace --raw /api/v1/namespaces/${NAMESPACE_REDIS}/finalize -f -\n+                  kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true --cascade=true --force=1 --grace-period=0\n+                \"\"\"\n+              } catch (err) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d795afd61d253230be6e7e3d62771fc96568b21"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMjk4OA==", "bodyText": "we can remove the try catch and monitor the namespace  deletion\nif many build failed due to this error perhaps we should reactivates the try catch.", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376302988", "createdAt": "2020-02-07T09:52:01Z", "author": {"login": "doulba"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,18 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              try {\n+                 // clean up the redis namespace\n+                // workaround for Cannot delete namespace still in Terminating #NXP-3228\n+                sh \"\"\"\n+                  kubectl get namespace ${NAMESPACE_REDIS} -o json | sed -e s/\\\\\"kubernetes\\\\\"//g  | kubectl replace --raw /api/v1/namespaces/${NAMESPACE_REDIS}/finalize -f -\n+                  kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true --cascade=true --force=1 --grace-period=0\n+                \"\"\"\n+              } catch (err) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5NzEwNw=="}, "originalCommit": {"oid": "7d795afd61d253230be6e7e3d62771fc96568b21"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM0ODAxNw==", "bodyText": "yep, I think the workaround will do its job fine", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376348017", "createdAt": "2020-02-07T11:38:39Z", "author": {"login": "ataillefer"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,18 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              try {\n+                 // clean up the redis namespace\n+                // workaround for Cannot delete namespace still in Terminating #NXP-3228\n+                sh \"\"\"\n+                  kubectl get namespace ${NAMESPACE_REDIS} -o json | sed -e s/\\\\\"kubernetes\\\\\"//g  | kubectl replace --raw /api/v1/namespaces/${NAMESPACE_REDIS}/finalize -f -\n+                  kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true --cascade=true --force=1 --grace-period=0\n+                \"\"\"\n+              } catch (err) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5NzEwNw=="}, "originalCommit": {"oid": "7d795afd61d253230be6e7e3d62771fc96568b21"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzUwMjgzOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo1Mzo0N1rOFm3w3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo1Mzo0N1rOFm3w3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMzgzOQ==", "bodyText": "Wrong NXP I think :)", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376303839", "createdAt": "2020-02-07T09:53:47Z", "author": {"login": "troger"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,14 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {\n+              // clean up the redis namespace\n+              // workaround for Cannot delete namespace still in Terminating #NXP-3228", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0d3794c5215c64b61701f31a41adaf1566e9853"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzUwMzgxOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo1NDowOFrOFm3xeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMDowMToxNFrOFm3-eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMzk5Mw==", "bodyText": "Not sure we need script here as we don't do script?", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376303993", "createdAt": "2020-02-07T09:54:08Z", "author": {"login": "kevinleturc"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,14 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0d3794c5215c64b61701f31a41adaf1566e9853"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwNzMyMg==", "bodyText": "yes,\ni have tested many solutions , that\u2019s way we still have scripts  section.\ni will  remove it", "url": "https://github.com/nuxeo/nuxeo/pull/3725#discussion_r376307322", "createdAt": "2020-02-07T10:01:14Z", "author": {"login": "doulba"}, "path": "Jenkinsfile", "diffHunk": "@@ -388,8 +388,14 @@ pipeline {\n         always {\n           junit testResults: '**/target/surefire-reports/*.xml'\n           container('maven') {\n-            // clean up the redis namespace\n-            sh \"kubectl delete namespace ${NAMESPACE_REDIS} --ignore-not-found=true\"\n+            script {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMzk5Mw=="}, "originalCommit": {"oid": "a0d3794c5215c64b61701f31a41adaf1566e9853"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4233, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}