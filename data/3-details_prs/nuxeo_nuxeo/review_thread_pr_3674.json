{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzODU0NjI0", "number": 3674, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMTozNjowNVrODYpkAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMTozNjowNVrODYpkAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MTczMzc5OnYy", "diffSide": "RIGHT", "path": "nuxeo-features/nuxeo-platform-tag-service/nuxeo-platform-tag-core/src/test/java/org/nuxeo/ecm/platform/tag/AbstractTestTagService.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMTozNjowNVrOFeoVxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMzowNzo1M1rOFe4cJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY2MjUzNA==", "bodyText": "I see it's just a copy/paste of similar code above, but note that you can do just file.refresh() instead.", "url": "https://github.com/nuxeo/nuxeo/pull/3674#discussion_r367662534", "createdAt": "2020-01-16T21:36:05Z", "author": {"login": "efge"}, "path": "nuxeo-features/nuxeo-platform-tag-service/nuxeo-platform-tag-core/src/test/java/org/nuxeo/ecm/platform/tag/AbstractTestTagService.java", "diffHunk": "@@ -194,12 +194,14 @@ public void testUntagOnTrash() {\n         // trash doc\n         Framework.getService(TrashService.class).trashDocument(file);\n \n-        // wait for async tag removal\n-        coreFeature.waitForAsyncCompletion();\n+        // wait for async tag listener\n+        txFeature.nextTransaction();\n \n-        // check no more tag\n+        // check tag is still present\n+        file = session.getDocument(file.getRef());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "522b294cfb14de53029f5c5f0b0baf6336db5411"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg0NTI4NQ==", "bodyText": "\ud83d\udc4d\nIs this the right way to do it now? (just asking)\nIf yes, I will change my code and cleanup the whole file.", "url": "https://github.com/nuxeo/nuxeo/pull/3674#discussion_r367845285", "createdAt": "2020-01-17T09:40:09Z", "author": {"login": "troger"}, "path": "nuxeo-features/nuxeo-platform-tag-service/nuxeo-platform-tag-core/src/test/java/org/nuxeo/ecm/platform/tag/AbstractTestTagService.java", "diffHunk": "@@ -194,12 +194,14 @@ public void testUntagOnTrash() {\n         // trash doc\n         Framework.getService(TrashService.class).trashDocument(file);\n \n-        // wait for async tag removal\n-        coreFeature.waitForAsyncCompletion();\n+        // wait for async tag listener\n+        txFeature.nextTransaction();\n \n-        // check no more tag\n+        // check tag is still present\n+        file = session.getDocument(file.getRef());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY2MjUzNA=="}, "originalCommit": {"oid": "522b294cfb14de53029f5c5f0b0baf6336db5411"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkwNTU0OA==", "bodyText": "They're equivalent but refresh is shorter and better shows intent so we might as well use it yes. Note that there's probably dozens of other test files with the old way too...", "url": "https://github.com/nuxeo/nuxeo/pull/3674#discussion_r367905548", "createdAt": "2020-01-17T12:08:54Z", "author": {"login": "efge"}, "path": "nuxeo-features/nuxeo-platform-tag-service/nuxeo-platform-tag-core/src/test/java/org/nuxeo/ecm/platform/tag/AbstractTestTagService.java", "diffHunk": "@@ -194,12 +194,14 @@ public void testUntagOnTrash() {\n         // trash doc\n         Framework.getService(TrashService.class).trashDocument(file);\n \n-        // wait for async tag removal\n-        coreFeature.waitForAsyncCompletion();\n+        // wait for async tag listener\n+        txFeature.nextTransaction();\n \n-        // check no more tag\n+        // check tag is still present\n+        file = session.getDocument(file.getRef());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY2MjUzNA=="}, "originalCommit": {"oid": "522b294cfb14de53029f5c5f0b0baf6336db5411"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkyNjMxMQ==", "bodyText": "\ud83d\udc4d\nProbably yes, but I will just handle this one \ud83d\ude2c", "url": "https://github.com/nuxeo/nuxeo/pull/3674#discussion_r367926311", "createdAt": "2020-01-17T13:07:53Z", "author": {"login": "troger"}, "path": "nuxeo-features/nuxeo-platform-tag-service/nuxeo-platform-tag-core/src/test/java/org/nuxeo/ecm/platform/tag/AbstractTestTagService.java", "diffHunk": "@@ -194,12 +194,14 @@ public void testUntagOnTrash() {\n         // trash doc\n         Framework.getService(TrashService.class).trashDocument(file);\n \n-        // wait for async tag removal\n-        coreFeature.waitForAsyncCompletion();\n+        // wait for async tag listener\n+        txFeature.nextTransaction();\n \n-        // check no more tag\n+        // check tag is still present\n+        file = session.getDocument(file.getRef());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY2MjUzNA=="}, "originalCommit": {"oid": "522b294cfb14de53029f5c5f0b0baf6336db5411"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4263, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}