{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNTYzNjY2", "number": 3726, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwODoyMjoxMVrODdmJKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwOTo1MDo1MVrODdnxgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzYwMjM0OnYy", "diffSide": "RIGHT", "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwODoyMjoxMVrOFmSeVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDowODoxNVrOFmVkzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng==", "bodyText": "We don't need to hide warning from console because the log capture feature already catch warn logs and this they are not logged.", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375692886", "createdAt": "2020-02-06T08:22:11Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -250,6 +253,52 @@ public void testMigrationFromPropertyToSecuredWithCommentsNotCorrectlyFilled() {\n         }\n     }\n \n+    /**\n+     * Test the migration in the case where the {@code comment:parentId} is not empty, but it doesn't exist.\n+     */\n+    @Test\n+    @LogCaptureFeature.FilterOn(logLevel = \"WARN\")\n+    @Deploy(\"org.nuxeo.ecm.platform.comment.tests:OSGI-INF/disable-removing-comment-children-listener.xml\")\n+    public void testMigrationFromPropertyToSecuredWithRemovedParentComment() {\n+        logFeature.hideWarningFromConsoleLog();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9975a0b5906baca8e98a48a23787dae22b7a438f"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcwMDA5MQ==", "bodyText": "i think the hide warning is required. otherwise (i test with removing the hide) and i get a lot warning logs on my console:\n2020-02-06 09:36:48,404 [main] WARN  [CommentsMigrator] The comment document model with IdRef: 73ffc123-2417-4917-a52a-2c5a0a6fe613 cannot be migrated, because his parent: 0dce638b-c3b4-4bad-8f3a-8d6a496f2c56 cannot be found \ni think we can keep it  for 10.10 and on master version i will remove it and replace by the annotation configuration", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375700091", "createdAt": "2020-02-06T08:39:53Z", "author": {"login": "RSalem07"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -250,6 +253,52 @@ public void testMigrationFromPropertyToSecuredWithCommentsNotCorrectlyFilled() {\n         }\n     }\n \n+    /**\n+     * Test the migration in the case where the {@code comment:parentId} is not empty, but it doesn't exist.\n+     */\n+    @Test\n+    @LogCaptureFeature.FilterOn(logLevel = \"WARN\")\n+    @Deploy(\"org.nuxeo.ecm.platform.comment.tests:OSGI-INF/disable-removing-comment-children-listener.xml\")\n+    public void testMigrationFromPropertyToSecuredWithRemovedParentComment() {\n+        logFeature.hideWarningFromConsoleLog();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, "originalCommit": {"oid": "9975a0b5906baca8e98a48a23787dae22b7a438f"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcwMzk2Mg==", "bodyText": "Ok for 10.10, didn't pay attention to it as it's in the PR title.\nMy point is for master, the presence of LogFeature on the test without the method nor the annotation is enough to hide log from console. We may have a regression.", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375703962", "createdAt": "2020-02-06T08:48:43Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -250,6 +253,52 @@ public void testMigrationFromPropertyToSecuredWithCommentsNotCorrectlyFilled() {\n         }\n     }\n \n+    /**\n+     * Test the migration in the case where the {@code comment:parentId} is not empty, but it doesn't exist.\n+     */\n+    @Test\n+    @LogCaptureFeature.FilterOn(logLevel = \"WARN\")\n+    @Deploy(\"org.nuxeo.ecm.platform.comment.tests:OSGI-INF/disable-removing-comment-children-listener.xml\")\n+    public void testMigrationFromPropertyToSecuredWithRemovedParentComment() {\n+        logFeature.hideWarningFromConsoleLog();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, "originalCommit": {"oid": "9975a0b5906baca8e98a48a23787dae22b7a438f"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcxODY5MA==", "bodyText": "once the PR validate i will cherry pick and remove the hide console and i will check it", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375718690", "createdAt": "2020-02-06T09:19:58Z", "author": {"login": "RSalem07"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -250,6 +253,52 @@ public void testMigrationFromPropertyToSecuredWithCommentsNotCorrectlyFilled() {\n         }\n     }\n \n+    /**\n+     * Test the migration in the case where the {@code comment:parentId} is not empty, but it doesn't exist.\n+     */\n+    @Test\n+    @LogCaptureFeature.FilterOn(logLevel = \"WARN\")\n+    @Deploy(\"org.nuxeo.ecm.platform.comment.tests:OSGI-INF/disable-removing-comment-children-listener.xml\")\n+    public void testMigrationFromPropertyToSecuredWithRemovedParentComment() {\n+        logFeature.hideWarningFromConsoleLog();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, "originalCommit": {"oid": "9975a0b5906baca8e98a48a23787dae22b7a438f"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyNjkxMw==", "bodyText": "but if i remember unfortunately we need the two log to hide and to capture. its why when we rework the log annotation we told ourself we need another JIRA ticket to simply the whole process.\nConsoleLogLevelThreshold was added to hide\nLogCapture was here before the ConsoleLogLevelThreshold and the idea is to create a new jira ticket which will responsible to configure ConsoleLogLevelThreshold based on the LogCapture without the need to add manually the ConsoleLogLevelThreshold", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375726913", "createdAt": "2020-02-06T09:35:52Z", "author": {"login": "RSalem07"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -250,6 +253,52 @@ public void testMigrationFromPropertyToSecuredWithCommentsNotCorrectlyFilled() {\n         }\n     }\n \n+    /**\n+     * Test the migration in the case where the {@code comment:parentId} is not empty, but it doesn't exist.\n+     */\n+    @Test\n+    @LogCaptureFeature.FilterOn(logLevel = \"WARN\")\n+    @Deploy(\"org.nuxeo.ecm.platform.comment.tests:OSGI-INF/disable-removing-comment-children-listener.xml\")\n+    public void testMigrationFromPropertyToSecuredWithRemovedParentComment() {\n+        logFeature.hideWarningFromConsoleLog();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, "originalCommit": {"oid": "9975a0b5906baca8e98a48a23787dae22b7a438f"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MzY5NA==", "bodyText": "Agree about the improvement around these two features. What I'm talking about is that without explicitly hiding, we still hide logs from console on master whereas we shouldn't as the improvement wasn't done.", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375743694", "createdAt": "2020-02-06T10:08:15Z", "author": {"login": "kevinleturc"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -250,6 +253,52 @@ public void testMigrationFromPropertyToSecuredWithCommentsNotCorrectlyFilled() {\n         }\n     }\n \n+    /**\n+     * Test the migration in the case where the {@code comment:parentId} is not empty, but it doesn't exist.\n+     */\n+    @Test\n+    @LogCaptureFeature.FilterOn(logLevel = \"WARN\")\n+    @Deploy(\"org.nuxeo.ecm.platform.comment.tests:OSGI-INF/disable-removing-comment-children-listener.xml\")\n+    public void testMigrationFromPropertyToSecuredWithRemovedParentComment() {\n+        logFeature.hideWarningFromConsoleLog();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, "originalCommit": {"oid": "9975a0b5906baca8e98a48a23787dae22b7a438f"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzg2OTQ0OnYy", "diffSide": "RIGHT", "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/resources/OSGI-INF/disable-removing-comment-children-listener.xml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwOTo1MDo1MVrOFmVBEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoxMToxMlrOFmVqwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczNDU0NA==", "bodyText": "Not sure why you need to disable this listener?", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375734544", "createdAt": "2020-02-06T09:50:51Z", "author": {"login": "troger"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/resources/OSGI-INF/disable-removing-comment-children-listener.xml", "diffHunk": "@@ -0,0 +1,11 @@\n+<?xml version=\"1.0\"?>\n+<component name=\"org.nuxeo.ecm.platform.comment.service.listener.test\"\n+           version=\"1.0\">\n+\n+  <extension target=\"org.nuxeo.ecm.core.event.EventServiceComponent\"\n+             point=\"listener\">\n+    <listener name=\"commentListener\" enabled=\"false\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bae0ba12f689267f5ef5ec80bd98b81e1a748987"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczNzA2Mw==", "bodyText": "disabling the removed listener is required otherwise, removing the parent will remove the comments and we will ends with testing nothing (i mean comment with removed parent)", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375737063", "createdAt": "2020-02-06T09:55:24Z", "author": {"login": "RSalem07"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/resources/OSGI-INF/disable-removing-comment-children-listener.xml", "diffHunk": "@@ -0,0 +1,11 @@\n+<?xml version=\"1.0\"?>\n+<component name=\"org.nuxeo.ecm.platform.comment.service.listener.test\"\n+           version=\"1.0\">\n+\n+  <extension target=\"org.nuxeo.ecm.core.event.EventServiceComponent\"\n+             point=\"listener\">\n+    <listener name=\"commentListener\" enabled=\"false\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczNDU0NA=="}, "originalCommit": {"oid": "bae0ba12f689267f5ef5ec80bd98b81e1a748987"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MTYzMg==", "bodyText": "That's docRemovedCommentListener right? commentListener is triggered when removing a comment AFAIK.", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375741632", "createdAt": "2020-02-06T10:03:57Z", "author": {"login": "troger"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/resources/OSGI-INF/disable-removing-comment-children-listener.xml", "diffHunk": "@@ -0,0 +1,11 @@\n+<?xml version=\"1.0\"?>\n+<component name=\"org.nuxeo.ecm.platform.comment.service.listener.test\"\n+           version=\"1.0\">\n+\n+  <extension target=\"org.nuxeo.ecm.core.event.EventServiceComponent\"\n+             point=\"listener\">\n+    <listener name=\"commentListener\" enabled=\"false\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczNDU0NA=="}, "originalCommit": {"oid": "bae0ba12f689267f5ef5ec80bd98b81e1a748987"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0NTIxNg==", "bodyText": "ah let me check about it, my idea was to disable the two to be consistent with existing listener (removed doc, removed comment)", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375745216", "createdAt": "2020-02-06T10:11:12Z", "author": {"login": "RSalem07"}, "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/resources/OSGI-INF/disable-removing-comment-children-listener.xml", "diffHunk": "@@ -0,0 +1,11 @@\n+<?xml version=\"1.0\"?>\n+<component name=\"org.nuxeo.ecm.platform.comment.service.listener.test\"\n+           version=\"1.0\">\n+\n+  <extension target=\"org.nuxeo.ecm.core.event.EventServiceComponent\"\n+             point=\"listener\">\n+    <listener name=\"commentListener\" enabled=\"false\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczNDU0NA=="}, "originalCommit": {"oid": "bae0ba12f689267f5ef5ec80bd98b81e1a748987"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4235, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}