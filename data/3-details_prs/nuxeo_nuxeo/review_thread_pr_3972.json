{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NTY4OTg3", "number": 3972, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNzoyMjoxMFrOD2hu_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMDowNzo0N1rOD2mVfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NTAyMzk3OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNzoyMjoxMFrOGMUeCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMDowNjoxOVrOGMbN3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3MTQ2NQ==", "bodyText": "why not simply\nkubectl create secret generic kubernetes-docker-cfg \\\n                  --namespace=${PREVIEW_NAMESPACE} \\\n                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\\n                  --type=kubernetes.io/dockerconfigjson", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415571465", "createdAt": "2020-04-27T07:22:10Z", "author": {"login": "ataillefer"}, "path": "Jenkinsfile", "diffHunk": "@@ -660,6 +660,10 @@ pipeline {\n                 // Previous preview deployment needs to be scaled to 0 to be replaced correctly\n                 sh \"kubectl -n ${PREVIEW_NAMESPACE} scale deployment nuxeo-preview --replicas=0\"\n               }\n+              sh \"\"\"kubectl create secret generic kubernetes-docker-cfg \\\n+                  --namespace=${PREVIEW_NAMESPACE} \\\n+                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\\n+                  --type=kubernetes.io/dockerconfigjson --dry-run -o yaml | kubectl apply -f -\"\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "104b9fd577d16727923e65131471f000d933d60d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYzMTk0Mg==", "bodyText": "Not sure it works if I paste some bash code directly in a script directive which takes groovy initially?\nI can also try and remove it but I wanted to stay consistent with the all the other kubectl calls accros the same file which are wrapped in an sh\"\"\" \"\"\"\" call.\nwdyt ?\nremoved --dry-run -o yaml | kubectl apply -f -", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415631942", "createdAt": "2020-04-27T08:53:11Z", "author": {"login": "NourNuxeo"}, "path": "Jenkinsfile", "diffHunk": "@@ -660,6 +660,10 @@ pipeline {\n                 // Previous preview deployment needs to be scaled to 0 to be replaced correctly\n                 sh \"kubectl -n ${PREVIEW_NAMESPACE} scale deployment nuxeo-preview --replicas=0\"\n               }\n+              sh \"\"\"kubectl create secret generic kubernetes-docker-cfg \\\n+                  --namespace=${PREVIEW_NAMESPACE} \\\n+                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\\n+                  --type=kubernetes.io/dockerconfigjson --dry-run -o yaml | kubectl apply -f -\"\"\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3MTQ2NQ=="}, "originalCommit": {"oid": "104b9fd577d16727923e65131471f000d933d60d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MjAxNQ==", "bodyText": "@ataillefer is just simplifying the content of the sh\"\"\", not saying you should remove the sh\"\"\" part :)", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415682015", "createdAt": "2020-04-27T10:06:19Z", "author": {"login": "troger"}, "path": "Jenkinsfile", "diffHunk": "@@ -660,6 +660,10 @@ pipeline {\n                 // Previous preview deployment needs to be scaled to 0 to be replaced correctly\n                 sh \"kubectl -n ${PREVIEW_NAMESPACE} scale deployment nuxeo-preview --replicas=0\"\n               }\n+              sh \"\"\"kubectl create secret generic kubernetes-docker-cfg \\\n+                  --namespace=${PREVIEW_NAMESPACE} \\\n+                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\\n+                  --type=kubernetes.io/dockerconfigjson --dry-run -o yaml | kubectl apply -f -\"\"\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3MTQ2NQ=="}, "originalCommit": {"oid": "104b9fd577d16727923e65131471f000d933d60d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NTAzMzczOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNzoyNDoyMVrOGMUjfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOToxODo1N1rOGMZQuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3Mjg2MQ==", "bodyText": "Could you pleas use a constant for 'platform' as we try to do for kubectl commands.\nI'd say, after this line:\nkubernetesNamespace = 'platform'", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415572861", "createdAt": "2020-04-27T07:24:21Z", "author": {"login": "ataillefer"}, "path": "Jenkinsfile", "diffHunk": "@@ -660,6 +660,10 @@ pipeline {\n                 // Previous preview deployment needs to be scaled to 0 to be replaced correctly\n                 sh \"kubectl -n ${PREVIEW_NAMESPACE} scale deployment nuxeo-preview --replicas=0\"\n               }\n+              sh \"\"\"kubectl create secret generic kubernetes-docker-cfg \\\n+                  --namespace=${PREVIEW_NAMESPACE} \\\n+                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "104b9fd577d16727923e65131471f000d933d60d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY0OTk3OQ==", "bodyText": "Changed the single quotes to double quotes on the whole lines where the var is used\ndone!", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415649979", "createdAt": "2020-04-27T09:18:57Z", "author": {"login": "NourNuxeo"}, "path": "Jenkinsfile", "diffHunk": "@@ -660,6 +660,10 @@ pipeline {\n                 // Previous preview deployment needs to be scaled to 0 to be replaced correctly\n                 sh \"kubectl -n ${PREVIEW_NAMESPACE} scale deployment nuxeo-preview --replicas=0\"\n               }\n+              sh \"\"\"kubectl create secret generic kubernetes-docker-cfg \\\n+                  --namespace=${PREVIEW_NAMESPACE} \\\n+                  --from-literal=.dockerconfigjson=\"\\$(kubectl --namespace platform get secret kubernetes-docker-cfg -ojsonpath='{.data.\\\\.dockerconfigjson}' | base64 --decode)\" \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTU3Mjg2MQ=="}, "originalCommit": {"oid": "104b9fd577d16727923e65131471f000d933d60d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NTc3NzkwOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMDowNzo0N1rOGMbRYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMDoxOToyOFrOGMbuWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MjkxMg==", "bodyText": "I would say this one is not linked to the Kubernetes namespace, it's just a GitHub status name.", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415682912", "createdAt": "2020-04-27T10:07:47Z", "author": {"login": "troger"}, "path": "Jenkinsfile", "diffHunk": "@@ -158,7 +159,7 @@ def buildUnitTestStage(env) {\n     stage(\"Run ${env} unit tests\") {\n       container(\"maven-${env}\") {\n         script {\n-          setGitHubBuildStatus(\"platform/utests/${env}\", \"Unit tests - ${env} environment\", 'PENDING')\n+          setGitHubBuildStatus(\"${kubernetesNamespace}/utests/${env}\", \"Unit tests - ${env} environment\", 'PENDING')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc7699aa915ee0a07f25208963efc28adef2c15b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY5MDMzMQ==", "bodyText": "yes I reverted all those gh status changes", "url": "https://github.com/nuxeo/nuxeo/pull/3972#discussion_r415690331", "createdAt": "2020-04-27T10:19:28Z", "author": {"login": "NourNuxeo"}, "path": "Jenkinsfile", "diffHunk": "@@ -158,7 +159,7 @@ def buildUnitTestStage(env) {\n     stage(\"Run ${env} unit tests\") {\n       container(\"maven-${env}\") {\n         script {\n-          setGitHubBuildStatus(\"platform/utests/${env}\", \"Unit tests - ${env} environment\", 'PENDING')\n+          setGitHubBuildStatus(\"${kubernetesNamespace}/utests/${env}\", \"Unit tests - ${env} environment\", 'PENDING')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY4MjkxMg=="}, "originalCommit": {"oid": "cc7699aa915ee0a07f25208963efc28adef2c15b"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4189, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}