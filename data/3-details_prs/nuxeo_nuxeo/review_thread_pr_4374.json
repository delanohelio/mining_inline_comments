{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNDQxOTY2", "number": 4374, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozNzowNVrOEsosCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNDo1NDozNVrOEtFJ5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjM5NDM0OnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/DefaultExporterPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozNzowNVrOHf_FcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozNzowNVrOHf_FcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwMTQ4OA==", "bodyText": "You could use the functional API there.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<String> collectedDocumentIds = collectionAdapter.getCollectedDocumentIds();\n          \n          \n            \n                    List<DocumentModel> collectedDocumentsList = new ArrayList<DocumentModel>();\n          \n          \n            \n                    for (int i = 0; i < collectedDocumentIds.size(); i++) {\n          \n          \n            \n                        collectedDocumentsList.add(session.getDocument(new IdRef(collectedDocumentIds.get(i))));\n          \n          \n            \n                    }\n          \n          \n            \n                    DocumentModelList collected = new DocumentModelListImpl(collectedDocumentsList);\n          \n          \n            \n                    return collected;\n          \n          \n            \n                    return collectionAdapter.getCollectedDocumentIds()\n          \n          \n            \n                                            .stream()\n          \n          \n            \n                                            .map(IdRef::new)\n          \n          \n            \n                                            .map(session::getDocument)\n          \n          \n            \n                                            .collect(Collectors.collectingAndThen(Collectors.toList(), DocumentModelListImpl::new));\n          \n      \n    \n    \n  \n\nNote: the two methods from Collectors could be imported statically.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503301488", "createdAt": "2020-10-12T13:37:05Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/DefaultExporterPlugin.java", "diffHunk": "@@ -138,4 +142,16 @@ protected String getFileName(Blob blob, DocumentModel docfrom, File folder, int\n \n         return prefix + blob.getFilename();\n     }\n+\n+    @Override\n+    public DocumentModelList getCollectedDocuments(CoreSession session, DocumentModel collection) {\n+        Collection collectionAdapter = collection.getAdapter(Collection.class);\n+        List<String> collectedDocumentIds = collectionAdapter.getCollectedDocumentIds();\n+        List<DocumentModel> collectedDocumentsList = new ArrayList<DocumentModel>();\n+        for (int i = 0; i < collectedDocumentIds.size(); i++) {\n+            collectedDocumentsList.add(session.getDocument(new IdRef(collectedDocumentIds.get(i))));\n+        }\n+        DocumentModelList collected = new DocumentModelListImpl(collectedDocumentsList);\n+        return collected;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjM5ODgzOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporterPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozODoxMVrOHf_ILw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozODoxMVrOHf_ILw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwMjE5MQ==", "bodyText": "Could you add a javadoc with a @since 11.4 line?", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503302191", "createdAt": "2020-10-12T13:38:11Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporterPlugin.java", "diffHunk": "@@ -32,4 +32,6 @@\n \n     File serialize(CoreSession session, DocumentModel docfrom, String fsPath) throws IOException;\n \n+    DocumentModelList getCollectedDocuments(CoreSession session, DocumentModel doc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjM5OTU0OnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozODoyMlrOHf_Ing==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozODoyMlrOHf_Ing==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwMjMwMg==", "bodyText": "This file is missing its Copyright header.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503302302", "createdAt": "2020-10-12T13:38:22Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQwMjI4OnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozOTowN1rOHf_KXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozOTowN1rOHf_KXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwMjc1MA==", "bodyText": "Could you make your fields protected?\nNote: we're used to only use protected and public visibilities.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503302750", "createdAt": "2020-10-12T13:39:07Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQwMzAxOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozOToxNlrOHf_K0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzozOToxNlrOHf_K0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwMjg2Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void ShouldExportCollection() throws Exception {\n          \n          \n            \n                public void shouldExportCollection() throws Exception {", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503302867", "createdAt": "2020-10-12T13:39:16Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQxMDQyOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0MTowNlrOHf_PZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0MTowNlrOHf_PZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwNDAzNw==", "bodyText": "According to the java convention naming, names such as these ones are for constants and not for inside method variable.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503304037", "createdAt": "2020-10-12T13:41:06Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {\n+\n+        String COLLECTION_NAME = \"CollectionNameTest\";\n+        String COLLECTION_DESCRIPTION = \"dummy\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQxMjcyOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0MTo0NlrOHf_Q3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0Mjo1N1rOHf_UGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwNDQxMg==", "bodyText": "Not needed and not accurate, the document path is /default-domain/workspaces/testWorkspace.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503304412", "createdAt": "2020-10-12T13:41:46Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {\n+\n+        String COLLECTION_NAME = \"CollectionNameTest\";\n+        String COLLECTION_DESCRIPTION = \"dummy\";\n+\n+        // path : testWorkspace", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwNTI0MA==", "bodyText": "Same for others.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503305240", "createdAt": "2020-10-12T13:42:57Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {\n+\n+        String COLLECTION_NAME = \"CollectionNameTest\";\n+        String COLLECTION_DESCRIPTION = \"dummy\";\n+\n+        // path : testWorkspace", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwNDQxMg=="}, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQyNzYzOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0NToyMlrOHf_aMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0NToyMlrOHf_aMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwNjgwMA==", "bodyText": "You could use the Blobs helper:\nBlobs.createBlob(\"some content\", \"text/plain\", \"UTF-8\", \"My_File_In_Section.txt\");", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503306800", "createdAt": "2020-10-12T13:45:22Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {\n+\n+        String COLLECTION_NAME = \"CollectionNameTest\";\n+        String COLLECTION_DESCRIPTION = \"dummy\";\n+\n+        // path : testWorkspace\n+        DocumentModel testWorkspace = session.createDocumentModel(\"/default-domain/workspaces\", \"testWorkspace\",\n+                \"Workspace\");\n+        testWorkspace = session.createDocument(testWorkspace);\n+\n+        // path : testFile\n+        DocumentModel testFile = session.createDocumentModel(\"\", \"testFileName\", \"File\");\n+        Blob blobTestFile = new StringBlob(\"some content\");\n+        blobTestFile.setFilename(\"My_File_In_Section.txt\");\n+        blobTestFile.setMimeType(\"text/plain\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQzNzc1OnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0Nzo1N1rOHf_gZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo0Nzo1N1rOHf_gZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMwODM4OQ==", "bodyText": "You should import assertTrue statically.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503308389", "createdAt": "2020-10-12T13:47:57Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {\n+\n+        String COLLECTION_NAME = \"CollectionNameTest\";\n+        String COLLECTION_DESCRIPTION = \"dummy\";\n+\n+        // path : testWorkspace\n+        DocumentModel testWorkspace = session.createDocumentModel(\"/default-domain/workspaces\", \"testWorkspace\",\n+                \"Workspace\");\n+        testWorkspace = session.createDocument(testWorkspace);\n+\n+        // path : testFile\n+        DocumentModel testFile = session.createDocumentModel(\"\", \"testFileName\", \"File\");\n+        Blob blobTestFile = new StringBlob(\"some content\");\n+        blobTestFile.setFilename(\"My_File_In_Section.txt\");\n+        blobTestFile.setMimeType(\"text/plain\");\n+        testFile.setPropertyValue(\"file:content\", (Serializable) blobTestFile);\n+        testFile = session.createDocument(testFile);\n+\n+        // path : testWorkspace/testFolder\n+        DocumentModel testFolder = session.createDocumentModel(testWorkspace.getPathAsString(), \"testFolderName\",\n+                \"Folder\");\n+        testFolder = session.createDocument(testFolder);\n+\n+        // path : testWorkspace/testFolder/testFolderFile\n+        DocumentModel testFolderFile = session.createDocumentModel(testFolder.getPathAsString(), \"testFolderFileName\",\n+                \"File\");\n+        Blob blobTestFolderFile = new StringBlob(\"some content\");\n+        blobTestFolderFile.setFilename(\"My_File_In_Section.txt\");\n+        blobTestFolderFile.setMimeType(\"text/plain\");\n+        testFolderFile.setPropertyValue(\"file:content\", (Serializable) blobTestFolderFile);\n+        testFolderFile = session.createDocument(testFolderFile);\n+\n+        collectionManager.addToNewCollection(COLLECTION_NAME, COLLECTION_DESCRIPTION, testWorkspace, session);\n+        String COLLECTION_FULL_PATH = collectionManager.getUserDefaultCollections(session).getPathAsString() + \"/\"\n+                + COLLECTION_NAME;\n+\n+        assertTrue(session.exists(new PathRef(COLLECTION_FULL_PATH)));\n+        DocumentModel collection = session.getDocument(new PathRef(COLLECTION_FULL_PATH));\n+\n+        collectionManager.addToCollection(collection, testFile, session);\n+\n+        String tmp = Environment.getDefault().getTemp().getPath();\n+        service.export(session, collection.getPathAsString(), tmp, \"\");\n+\n+        String pathPrefix = StringUtils.removeEnd(tmp, \"/\");\n+\n+        String pathCollection = pathPrefix + \"/\" + COLLECTION_NAME;\n+        String pathWorkspace = pathCollection + \"/\" + testWorkspace.getName();\n+        String pathTestFile = pathCollection + \"/\" + blobTestFile.getFilename();\n+        String pathTestFolder = pathWorkspace + \"/\" + testFolder.getName();\n+        String pathTestFolderFile = pathTestFolder + \"/\" + blobTestFolderFile.getFilename();\n+\n+        Assert.assertTrue(\"Collection must exist\", new File(pathCollection).exists());\n+        Assert.assertTrue(\"Workspace must exist\", new File(pathWorkspace).exists());\n+        Assert.assertTrue(\"TestFile must exist\", new File(pathTestFile).exists());\n+        Assert.assertTrue(\"TestFolder must exist\", new File(pathTestFolder).exists());\n+        Assert.assertTrue(\"TestFolderFile must exist\", new File(pathTestFolderFile).exists());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQ1MDUxOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1MDo1OFrOHf_oDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1MDo1OFrOHf_oDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxMDM0OA==", "bodyText": "Can you add a new line at the end of the file?", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503310348", "createdAt": "2020-10-12T13:50:58Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {\n+\n+        String COLLECTION_NAME = \"CollectionNameTest\";\n+        String COLLECTION_DESCRIPTION = \"dummy\";\n+\n+        // path : testWorkspace\n+        DocumentModel testWorkspace = session.createDocumentModel(\"/default-domain/workspaces\", \"testWorkspace\",\n+                \"Workspace\");\n+        testWorkspace = session.createDocument(testWorkspace);\n+\n+        // path : testFile\n+        DocumentModel testFile = session.createDocumentModel(\"\", \"testFileName\", \"File\");\n+        Blob blobTestFile = new StringBlob(\"some content\");\n+        blobTestFile.setFilename(\"My_File_In_Section.txt\");\n+        blobTestFile.setMimeType(\"text/plain\");\n+        testFile.setPropertyValue(\"file:content\", (Serializable) blobTestFile);\n+        testFile = session.createDocument(testFile);\n+\n+        // path : testWorkspace/testFolder\n+        DocumentModel testFolder = session.createDocumentModel(testWorkspace.getPathAsString(), \"testFolderName\",\n+                \"Folder\");\n+        testFolder = session.createDocument(testFolder);\n+\n+        // path : testWorkspace/testFolder/testFolderFile\n+        DocumentModel testFolderFile = session.createDocumentModel(testFolder.getPathAsString(), \"testFolderFileName\",\n+                \"File\");\n+        Blob blobTestFolderFile = new StringBlob(\"some content\");\n+        blobTestFolderFile.setFilename(\"My_File_In_Section.txt\");\n+        blobTestFolderFile.setMimeType(\"text/plain\");\n+        testFolderFile.setPropertyValue(\"file:content\", (Serializable) blobTestFolderFile);\n+        testFolderFile = session.createDocument(testFolderFile);\n+\n+        collectionManager.addToNewCollection(COLLECTION_NAME, COLLECTION_DESCRIPTION, testWorkspace, session);\n+        String COLLECTION_FULL_PATH = collectionManager.getUserDefaultCollections(session).getPathAsString() + \"/\"\n+                + COLLECTION_NAME;\n+\n+        assertTrue(session.exists(new PathRef(COLLECTION_FULL_PATH)));\n+        DocumentModel collection = session.getDocument(new PathRef(COLLECTION_FULL_PATH));\n+\n+        collectionManager.addToCollection(collection, testFile, session);\n+\n+        String tmp = Environment.getDefault().getTemp().getPath();\n+        service.export(session, collection.getPathAsString(), tmp, \"\");\n+\n+        String pathPrefix = StringUtils.removeEnd(tmp, \"/\");\n+\n+        String pathCollection = pathPrefix + \"/\" + COLLECTION_NAME;\n+        String pathWorkspace = pathCollection + \"/\" + testWorkspace.getName();\n+        String pathTestFile = pathCollection + \"/\" + blobTestFile.getFilename();\n+        String pathTestFolder = pathWorkspace + \"/\" + testFolder.getName();\n+        String pathTestFolderFile = pathTestFolder + \"/\" + blobTestFolderFile.getFilename();\n+\n+        Assert.assertTrue(\"Collection must exist\", new File(pathCollection).exists());\n+        Assert.assertTrue(\"Workspace must exist\", new File(pathWorkspace).exists());\n+        Assert.assertTrue(\"TestFile must exist\", new File(pathTestFile).exists());\n+        Assert.assertTrue(\"TestFolder must exist\", new File(pathTestFolder).exists());\n+        Assert.assertTrue(\"TestFolderFile must exist\", new File(pathTestFolderFile).exists());\n+\n+    }\n+\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQ2ODkyOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1NTowOFrOHf_y_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1NTowOFrOHf_y_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxMzE0OA==", "bodyText": "In order to work correctly in the CI you should use FeaturesRunner.getBuildDirectory() method and then gives this folder to a TemporaryFolder rule such as below:\n    @Rule\n    public TemporaryFolder folder = new TemporaryFolder(new File(FeaturesRunner.getBuildDirectory()));\n\nThen in your test code:\nfolder.newFolder(\"fs-exporter\").getAbsolutePath()\n\nNote: fs-exporter is there to add isolation between tests.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503313148", "createdAt": "2020-10-12T13:55:08Z", "author": {"login": "kevinleturc"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.nuxeo.io.fsexporter.test;\n+\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.File;\n+import java.io.Serializable;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.common.Environment;\n+import org.nuxeo.ecm.collections.api.CollectionManager;\n+import org.nuxeo.ecm.collections.core.test.CollectionFeature;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.api.PathRef;\n+import org.nuxeo.ecm.core.api.impl.blob.StringBlob;\n+import org.nuxeo.io.fsexporter.FSExporter;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+\n+@RunWith(FeaturesRunner.class)\n+@Features(CollectionFeature.class)\n+@Deploy(\"nuxeo-fsexporter\")\n+public class TestFSExporterCollection {\n+\n+    @Inject\n+    CoreSession session;\n+\n+    @Inject\n+    CollectionManager collectionManager;\n+\n+    @Inject\n+    FSExporter service;\n+\n+    @Test\n+    public void ShouldExportCollection() throws Exception {\n+\n+        String COLLECTION_NAME = \"CollectionNameTest\";\n+        String COLLECTION_DESCRIPTION = \"dummy\";\n+\n+        // path : testWorkspace\n+        DocumentModel testWorkspace = session.createDocumentModel(\"/default-domain/workspaces\", \"testWorkspace\",\n+                \"Workspace\");\n+        testWorkspace = session.createDocument(testWorkspace);\n+\n+        // path : testFile\n+        DocumentModel testFile = session.createDocumentModel(\"\", \"testFileName\", \"File\");\n+        Blob blobTestFile = new StringBlob(\"some content\");\n+        blobTestFile.setFilename(\"My_File_In_Section.txt\");\n+        blobTestFile.setMimeType(\"text/plain\");\n+        testFile.setPropertyValue(\"file:content\", (Serializable) blobTestFile);\n+        testFile = session.createDocument(testFile);\n+\n+        // path : testWorkspace/testFolder\n+        DocumentModel testFolder = session.createDocumentModel(testWorkspace.getPathAsString(), \"testFolderName\",\n+                \"Folder\");\n+        testFolder = session.createDocument(testFolder);\n+\n+        // path : testWorkspace/testFolder/testFolderFile\n+        DocumentModel testFolderFile = session.createDocumentModel(testFolder.getPathAsString(), \"testFolderFileName\",\n+                \"File\");\n+        Blob blobTestFolderFile = new StringBlob(\"some content\");\n+        blobTestFolderFile.setFilename(\"My_File_In_Section.txt\");\n+        blobTestFolderFile.setMimeType(\"text/plain\");\n+        testFolderFile.setPropertyValue(\"file:content\", (Serializable) blobTestFolderFile);\n+        testFolderFile = session.createDocument(testFolderFile);\n+\n+        collectionManager.addToNewCollection(COLLECTION_NAME, COLLECTION_DESCRIPTION, testWorkspace, session);\n+        String COLLECTION_FULL_PATH = collectionManager.getUserDefaultCollections(session).getPathAsString() + \"/\"\n+                + COLLECTION_NAME;\n+\n+        assertTrue(session.exists(new PathRef(COLLECTION_FULL_PATH)));\n+        DocumentModel collection = session.getDocument(new PathRef(COLLECTION_FULL_PATH));\n+\n+        collectionManager.addToCollection(collection, testFile, session);\n+\n+        String tmp = Environment.getDefault().getTemp().getPath();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b0688af19cb165ff95bd33b461e55dd2eb0d2"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NjU1MzI0OnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/DefaultExporterPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoxNDozM1rOHgmChQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoxNDozM1rOHgmChQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkzOTcxNw==", "bodyText": "I'm not a fan of collectingAndThen here @kevinleturc. I find it more readable to write\nList<DocumentModel> docs = collection.getAdapter(Collection.class)\n                                     .getCollectedDocumentIds()\n                                     .stream()\n                                     .map(IdRef::new)\n                                     .map(session::getDocument)\n                                     .collect(Collectors.toList());\nreturn new DocumentModelListImpl(docs);\n\nBut if we inline this in the caller we don't even need the DocumentModelListImpl or the Collectors.toList.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503939717", "createdAt": "2020-10-13T13:14:33Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/DefaultExporterPlugin.java", "diffHunk": "@@ -138,4 +142,14 @@ protected String getFileName(Blob blob, DocumentModel docfrom, File folder, int\n \n         return prefix + blob.getFilename();\n     }\n+\n+    @Override\n+    public DocumentModelList getCollectedDocuments(CoreSession session, DocumentModel collection) {\n+        Collection collectionAdapter = collection.getAdapter(Collection.class);\n+        return collectionAdapter.getCollectedDocumentIds()\n+                                .stream()\n+                                .map(IdRef::new)\n+                                .map(session::getDocument)\n+                                .collect(Collectors.collectingAndThen(Collectors.toList(), DocumentModelListImpl::new));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eeb60a4c0304c6be70d9382977e53bd4599ec45b"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NjU4OTEwOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoyMDozN1rOHgmXxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoyMDozN1rOHgmXxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk0NTE1OA==", "bodyText": "For new code we often write functionally:\nString path = serialized.getAbsolutePath();\nexporter.getCollectedDocuments(session, doc)\n        .forEach(collected -> serializeStructure(session, path, collected, PageProvider));\n\nAlthough with my other suggestion to get rid of the exporter.getCollectedDocuments method it'll look a bit different.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503945158", "createdAt": "2020-10-13T13:20:37Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporter.java", "diffHunk": "@@ -64,6 +65,11 @@ private void serializeStructure(CoreSession session, String fsPath, DocumentMode\n             for (DocumentModel child : children) {\n                 serializeStructure(session, serialized.getAbsolutePath(), child, PageProvider);\n             }\n+        } else if (doc.hasFacet(CollectionConstants.COLLECTION_FACET)) {\n+            DocumentModelList collectedDocuments = exporter.getCollectedDocuments(session, doc);\n+            for (DocumentModel collected : collectedDocuments) {\n+                serializeStructure(session, serialized.getAbsolutePath(), collected, PageProvider);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eeb60a4c0304c6be70d9382977e53bd4599ec45b"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NjU5MzYxOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoyMToxNVrOHgmalA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoyMToxNVrOHgmalA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk0NTg3Ng==", "bodyText": "2014-2018 -> 2020", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503945876", "createdAt": "2020-10-13T13:21:15Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-fsexporter/src/test/java/org/nuxeo/io/fsexporter/test/TestFSExporterCollection.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * (C) Copyright 2014-2018 Nuxeo (http://nuxeo.com/) and others.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eeb60a4c0304c6be70d9382977e53bd4599ec45b"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NjYzMTYwOnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporterPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoyOToyNFrOHgmyfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoyOToyNFrOHgmyfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk1MTk5OA==", "bodyText": "This doesn't need to be a method in the FSExporterPlugin interface. Just inline the actual implementation into its caller, in FSExporter.export in the if statement.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r503951998", "createdAt": "2020-10-13T13:29:24Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporterPlugin.java", "diffHunk": "@@ -32,4 +32,9 @@\n \n     File serialize(CoreSession session, DocumentModel docfrom, String fsPath) throws IOException;\n \n+    /**\n+     * @since 11.4\n+     */\n+    DocumentModelList getCollectedDocuments(CoreSession session, DocumentModel doc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eeb60a4c0304c6be70d9382977e53bd4599ec45b"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NzA1ODI5OnYy", "diffSide": "RIGHT", "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporter.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNDo1NDozNVrOHgq7iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNToxMTo0MVrOHgrwZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAxOTg0OQ==", "bodyText": "Let's be fully functional:\nString path = serialized.getAbsolutePath();\ndoc.getAdapter(Collection.class)\n   .getCollectedDocumentIds()\n   .stream()\n   .map(IdRef::new)\n   .map(session::getDocument)\n   .forEach(collected -> serializeStructure(session, path, collected, PageProvider));\n\nAnd remove unneeded imports.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r504019849", "createdAt": "2020-10-13T14:54:35Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporter.java", "diffHunk": "@@ -64,6 +69,16 @@ private void serializeStructure(CoreSession session, String fsPath, DocumentMode\n             for (DocumentModel child : children) {\n                 serializeStructure(session, serialized.getAbsolutePath(), child, PageProvider);\n             }\n+        } else if (doc.hasFacet(CollectionConstants.COLLECTION_FACET)) {\n+            List<DocumentModel> collectedDocs = doc.getAdapter(Collection.class)\n+                                                   .getCollectedDocumentIds()\n+                                                   .stream()\n+                                                   .map(IdRef::new)\n+                                                   .map(session::getDocument)\n+                                                   .collect(Collectors.toList());\n+            for (DocumentModel collected : collectedDocs) {\n+                serializeStructure(session, serialized.getAbsolutePath(), collected, PageProvider);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f094bef628d3c02328222d19d28b34c1a1b0aea8"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAyNzI1OQ==", "bodyText": "By using this I have to surround\n\nserializeStructure(session, path, collected, PageProvider));\n\nwith a try/catch block", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r504027259", "createdAt": "2020-10-13T15:03:50Z", "author": {"login": "charlesboidot"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporter.java", "diffHunk": "@@ -64,6 +69,16 @@ private void serializeStructure(CoreSession session, String fsPath, DocumentMode\n             for (DocumentModel child : children) {\n                 serializeStructure(session, serialized.getAbsolutePath(), child, PageProvider);\n             }\n+        } else if (doc.hasFacet(CollectionConstants.COLLECTION_FACET)) {\n+            List<DocumentModel> collectedDocs = doc.getAdapter(Collection.class)\n+                                                   .getCollectedDocumentIds()\n+                                                   .stream()\n+                                                   .map(IdRef::new)\n+                                                   .map(session::getDocument)\n+                                                   .collect(Collectors.toList());\n+            for (DocumentModel collected : collectedDocs) {\n+                serializeStructure(session, serialized.getAbsolutePath(), collected, PageProvider);\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAxOTg0OQ=="}, "originalCommit": {"oid": "f094bef628d3c02328222d19d28b34c1a1b0aea8"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAyNzY1Mw==", "bodyText": "Is it really better than a for loop?", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r504027653", "createdAt": "2020-10-13T15:04:23Z", "author": {"login": "charlesboidot"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporter.java", "diffHunk": "@@ -64,6 +69,16 @@ private void serializeStructure(CoreSession session, String fsPath, DocumentMode\n             for (DocumentModel child : children) {\n                 serializeStructure(session, serialized.getAbsolutePath(), child, PageProvider);\n             }\n+        } else if (doc.hasFacet(CollectionConstants.COLLECTION_FACET)) {\n+            List<DocumentModel> collectedDocs = doc.getAdapter(Collection.class)\n+                                                   .getCollectedDocumentIds()\n+                                                   .stream()\n+                                                   .map(IdRef::new)\n+                                                   .map(session::getDocument)\n+                                                   .collect(Collectors.toList());\n+            for (DocumentModel collected : collectedDocs) {\n+                serializeStructure(session, serialized.getAbsolutePath(), collected, PageProvider);\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAxOTg0OQ=="}, "originalCommit": {"oid": "f094bef628d3c02328222d19d28b34c1a1b0aea8"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAzMzM4Mw==", "bodyText": "Ah indeed if serializeStructure can throw IOException then we reach the limitations of lambdas...\nOk as it is then.", "url": "https://github.com/nuxeo/nuxeo/pull/4374#discussion_r504033383", "createdAt": "2020-10-13T15:11:41Z", "author": {"login": "efge"}, "path": "modules/platform/nuxeo-fsexporter/src/main/java/org/nuxeo/io/fsexporter/FSExporter.java", "diffHunk": "@@ -64,6 +69,16 @@ private void serializeStructure(CoreSession session, String fsPath, DocumentMode\n             for (DocumentModel child : children) {\n                 serializeStructure(session, serialized.getAbsolutePath(), child, PageProvider);\n             }\n+        } else if (doc.hasFacet(CollectionConstants.COLLECTION_FACET)) {\n+            List<DocumentModel> collectedDocs = doc.getAdapter(Collection.class)\n+                                                   .getCollectedDocumentIds()\n+                                                   .stream()\n+                                                   .map(IdRef::new)\n+                                                   .map(session::getDocument)\n+                                                   .collect(Collectors.toList());\n+            for (DocumentModel collected : collectedDocs) {\n+                serializeStructure(session, serialized.getAbsolutePath(), collected, PageProvider);\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAxOTg0OQ=="}, "originalCommit": {"oid": "f094bef628d3c02328222d19d28b34c1a1b0aea8"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4342, "cost": 1, "resetAt": "2021-11-03T18:41:40Z"}}}