{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MjAyMDc2", "number": 4232, "title": "Use glide to display images in selects", "bodyText": "Closes #4205\nThis pr fixes displaying images in selects I'll create a separate pr for displaying images in image widgets since:\n\nit will require more refactoring so I didn't want to mix everything in one pr\nit's less important since the behavior there is not that bad\n\nWhat has been done to verify that this works as intended?\nI tested the fix using the forms I attached.\nWhy is this the best possible solution? Were any other approaches considered?\nI decided to use Glide since it's the most popular library recommended by google and the performance is also good. I also investigated other libraries:\n\nPicasso I didn't use it because it works much worse in recyclerview\nCoil it's an interesting tool but it's relatively new and rather designed for Kotlin so using it in Java is not that convenient\n\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nThis change might affect displaying images in selects (buttons and no-buttons modes) so that's what we need to test. I atatched forms that should be helpful. Nothing else should be affected just selects.\nDo we need any specific form for testing your changes? If so, please attach one.\nThe form attached to the issue - to confirm that it works faster and maybe this form:\nselectTest.zip\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-11-19T20:10:09Z", "url": "https://github.com/getodk/collect/pull/4232", "merged": true, "mergeCommit": {"oid": "fd5ce176196b2b33260651c1faa6b3f01a698b4c"}, "closed": true, "closedAt": "2020-11-24T13:00:51Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeANQ1gH2gAyNTI0MjAyMDc2OjZmNDUxYjI5ZjkzYTBiZDFlMDkyZTY5OTg2MGU5MmM5NzdkM2E5NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfpOdFgH2gAyNTI0MjAyMDc2Ojk1MzEyYTc4MTI5Zjc4YTA4MjNiMDA3MjFmMGMxOWFlOWU1MzFhMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f451b29f93a0bd1e092e699860e92c977d3a950", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6f451b29f93a0bd1e092e699860e92c977d3a950", "committedDate": "2020-11-19T10:29:27Z", "message": "Added Glide dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a60daba66e1d7d975b0569cf05b5c51708ac83b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0a60daba66e1d7d975b0569cf05b5c51708ac83b", "committedDate": "2020-11-19T10:33:17Z", "message": "Removed redundant setupImage() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "812d890e85839b711b7145dee42bec396d7cb679", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/812d890e85839b711b7145dee42bec396d7cb679", "committedDate": "2020-11-19T10:44:42Z", "message": "Use glide to load images in AudioVideoImageTextLabel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dc03450602c1f0e414656afa929cc40b4af0efc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7dc03450602c1f0e414656afa929cc40b4af0efc", "committedDate": "2020-11-19T11:11:33Z", "message": "Got rid of recycling drawables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd355c44dc50e7cd22bd418bde243ca525e5a639", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bd355c44dc50e7cd22bd418bde243ca525e5a639", "committedDate": "2020-11-19T13:36:24Z", "message": "Factored out NoButtonsItem class to handle no buttons items in the same way we handle AudioVideoImageTextLabel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0b4dbe8a669d0652e23d740960923978c52810d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b0b4dbe8a669d0652e23d740960923978c52810d", "committedDate": "2020-11-19T14:08:30Z", "message": "Use glide to load images in no-buttons mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49c67fdb50b4515e44c2b0a6c51a94995de01c82", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/49c67fdb50b4515e44c2b0a6c51a94995de01c82", "committedDate": "2020-11-19T19:32:28Z", "message": "Images in no-buttons mode gridView should take the all available space"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dbd7475356defacf514968075e89587a43cad16", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9dbd7475356defacf514968075e89587a43cad16", "committedDate": "2020-11-19T19:33:28Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "committedDate": "2020-11-19T20:09:40Z", "message": "Fixed displaying images in different sizes while scrolling the list"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d41cecc0e99278e584a492fe35d9c5f1b78fa8a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9d41cecc0e99278e584a492fe35d9c5f1b78fa8a", "committedDate": "2020-11-19T19:59:08Z", "message": "Fixed displaying images in different sizes while scrolling the list"}, "afterCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1", "committedDate": "2020-11-19T20:09:40Z", "message": "Fixed displaying images in different sizes while scrolling the list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0ODEyMjQ2", "url": "https://github.com/getodk/collect/pull/4232#pullrequestreview-534812246", "createdAt": "2020-11-19T20:12:40Z", "commit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxMjo0MFrOH2v0Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxMjo0MFrOH2v0Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2ODU1MQ==", "bodyText": "@lognaturel maybe it's time to get rid of those error messages? Glide can display a special image that will be used if something is wrong so we could have such an error/missing file image?", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527168551", "createdAt": "2020-11-19T20:12:40Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/formentry/questions/AudioVideoImageTextLabel.java", "diffHunk": "@@ -143,7 +142,20 @@ public void setAudio(String audioURI, AudioHelper audioHelper) {\n     }\n \n     public void setImage(@NonNull File imageFile) {\n-        setupImage(imageFile);\n+        if (imageFile.exists()) {\n+            imageView.layout(0, 0, 0, 0);\n+\n+            Glide.with(this)\n+                    .load(imageFile)\n+                    .centerInside()\n+                    .into(imageView);\n+\n+            imageView.setVisibility(VISIBLE);\n+            imageView.setOnClickListener(this);\n+        } else {\n+            missingImage.setVisibility(VISIBLE);\n+            missingImage.setText(getContext().getString(R.string.file_missing, imageFile));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0ODEzNTc0", "url": "https://github.com/getodk/collect/pull/4232#pullrequestreview-534813574", "createdAt": "2020-11-19T20:14:31Z", "commit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxNDozMVrOH2v3_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxNDozMVrOH2v3_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2OTUzMw==", "bodyText": "All of these is removed because it caused crashes since Glide use caching. I could disable caching in Glide and then keep this code but it's not recommended and I believe it's a very old code that we no longer need because we have more powerful devices and also glide should deal with it better.", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527169533", "createdAt": "2020-11-19T20:14:31Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/QuestionWidget.java", "diffHunk": "@@ -291,40 +285,6 @@ public QuestionDetails getQuestionDetails() {\n         return questionDetails;\n     }\n \n-    // http://code.google.com/p/android/issues/detail?id=8488\n-    private void recycleDrawablesRecursive(ViewGroup viewGroup, List<ImageView> images) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f49f04f077a46625c949fb6dc9943ee80fcd590", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6f49f04f077a46625c949fb6dc9943ee80fcd590", "committedDate": "2020-11-19T20:38:49Z", "message": "Fixed tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MTExOTM5", "url": "https://github.com/getodk/collect/pull/4232#pullrequestreview-537111939", "createdAt": "2020-11-24T06:33:05Z", "commit": {"oid": "6f49f04f077a46625c949fb6dc9943ee80fcd590"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95312a78129f78a0823b00721f0c19ae9e531a12", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/95312a78129f78a0823b00721f0c19ae9e531a12", "committedDate": "2020-11-24T12:50:47Z", "message": "Merge branch 'master' into COLLECT-4205"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2475, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}