{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNjQxMTg2", "number": 4191, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMzo0NDo1NVrOEzhYmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMzo0NDo1NVrOEzhYmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNDU5ODAzOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/logic/PropertyManager.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMzo0NDo1NVrOHqyfzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMTowMzozNlrOHr_zAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyOTU4MQ==", "bodyText": "What effect does having SCHEME_IMEI here have? Seems it should be collect, maybe?", "url": "https://github.com/getodk/collect/pull/4191#discussion_r514629581", "createdAt": "2020-10-29T23:44:55Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/logic/PropertyManager.java", "diffHunk": "@@ -112,12 +92,8 @@ public PropertyManager(Application application, RxEventBus rxEventBus, Permissio\n \n     public PropertyManager reload() {\n         try {\n-            // Device-defined properties\n-            IdAndPrefix idp = findDeviceId(context, deviceDetailsProvider);\n-            putProperty(PROPMGR_DEVICE_ID,     idp.prefix,          idp.id);\n+            putProperty(PROPMGR_DEVICE_ID,     SCHEME_IMEI,         deviceDetailsProvider.getDeviceId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50ec197e27afa78cca6dd3eea331a5d6db74c9d0"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5Nzg3MA==", "bodyText": "That's a good question, I wanted to ask about it because I'm not sure... I kept SCHEME_IMEI for now but it's not IMEI anymore so it doesn't make much sense. I could do what you say and add collect: but our new device id is already like collect:5sf45sf5dsf5d4f (it starts with collect: always) so a result the value with scheme would be collect:collect:5sf45sf5dsf5d4f\nOf course depends where we use it because in settings and in a form it would be still just collect:5sf45sf5dsf5d4f (because there we get the value without scheme) but during sending a form we use:\ndeviceId = new PropertyManager(Collect.getInstance().getApplicationContext())\n                    .getSingularProperty(PropertyManager.withUri(PropertyManager.PROPMGR_DEVICE_ID));\n\nwhat will return doubled collect:\ncollect:collect:5sf45sf5dsf5d4f \nmaybe we should get rid of that prefix collect: which now is a part of device id and add it instead of SCHEME_IMEI so as a result in settings and in a form we would have 5sf45sf5dsf5d4f but sending forms it would be collect:5sf45sf5dsf5d4f?\n@lognaturel @seadowg", "url": "https://github.com/getodk/collect/pull/4191#discussion_r515097870", "createdAt": "2020-10-30T13:31:11Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/logic/PropertyManager.java", "diffHunk": "@@ -112,12 +92,8 @@ public PropertyManager(Application application, RxEventBus rxEventBus, Permissio\n \n     public PropertyManager reload() {\n         try {\n-            // Device-defined properties\n-            IdAndPrefix idp = findDeviceId(context, deviceDetailsProvider);\n-            putProperty(PROPMGR_DEVICE_ID,     idp.prefix,          idp.id);\n+            putProperty(PROPMGR_DEVICE_ID,     SCHEME_IMEI,         deviceDetailsProvider.getDeviceId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyOTU4MQ=="}, "originalCommit": {"oid": "50ec197e27afa78cca6dd3eea331a5d6db74c9d0"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE1OTY1Mg==", "bodyText": "Interesting, I didn't realize there was that difference between in-form and at submission time. I think they should be consistent and both include the scheme. How about just using the literal String \"\" as the scheme here?", "url": "https://github.com/getodk/collect/pull/4191#discussion_r515159652", "createdAt": "2020-10-30T14:56:16Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/logic/PropertyManager.java", "diffHunk": "@@ -112,12 +92,8 @@ public PropertyManager(Application application, RxEventBus rxEventBus, Permissio\n \n     public PropertyManager reload() {\n         try {\n-            // Device-defined properties\n-            IdAndPrefix idp = findDeviceId(context, deviceDetailsProvider);\n-            putProperty(PROPMGR_DEVICE_ID,     idp.prefix,          idp.id);\n+            putProperty(PROPMGR_DEVICE_ID,     SCHEME_IMEI,         deviceDetailsProvider.getDeviceId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyOTU4MQ=="}, "originalCommit": {"oid": "50ec197e27afa78cca6dd3eea331a5d6db74c9d0"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIxMDc3MQ==", "bodyText": "That would be a solution, what do you think @seadowg?", "url": "https://github.com/getodk/collect/pull/4191#discussion_r515210771", "createdAt": "2020-10-30T16:08:26Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/logic/PropertyManager.java", "diffHunk": "@@ -112,12 +92,8 @@ public PropertyManager(Application application, RxEventBus rxEventBus, Permissio\n \n     public PropertyManager reload() {\n         try {\n-            // Device-defined properties\n-            IdAndPrefix idp = findDeviceId(context, deviceDetailsProvider);\n-            putProperty(PROPMGR_DEVICE_ID,     idp.prefix,          idp.id);\n+            putProperty(PROPMGR_DEVICE_ID,     SCHEME_IMEI,         deviceDetailsProvider.getDeviceId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyOTU4MQ=="}, "originalCommit": {"oid": "50ec197e27afa78cca6dd3eea331a5d6db74c9d0"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0NDcwNQ==", "bodyText": "Ah yeah I hadn't realized PropertyManager expects a scheme here. I think passing \"\" as the scheme makes the most sense to me as because then (as @lognaturel points out) it'll be displayed consistently.\nWe could then just add a putProperty(String propName, String value) that doesn't append a scheme (or just calls the other putProperty with \"\").", "url": "https://github.com/getodk/collect/pull/4191#discussion_r515844705", "createdAt": "2020-11-02T09:36:51Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/logic/PropertyManager.java", "diffHunk": "@@ -112,12 +92,8 @@ public PropertyManager(Application application, RxEventBus rxEventBus, Permissio\n \n     public PropertyManager reload() {\n         try {\n-            // Device-defined properties\n-            IdAndPrefix idp = findDeviceId(context, deviceDetailsProvider);\n-            putProperty(PROPMGR_DEVICE_ID,     idp.prefix,          idp.id);\n+            putProperty(PROPMGR_DEVICE_ID,     SCHEME_IMEI,         deviceDetailsProvider.getDeviceId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyOTU4MQ=="}, "originalCommit": {"oid": "50ec197e27afa78cca6dd3eea331a5d6db74c9d0"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg5NjA2NA==", "bodyText": "Ok, I removed that scheme but I needed to add some extra changes in InstanceServerUploaderTask and InstanceSubmitter where we access that property to avoid using PropertyManager.withUri because then even if the scheme is empty we would have an extra semicolon left, like: :collect:5sf45sf5dsf5d4f .\nAll the changes are in my last commit:\n94e954c", "url": "https://github.com/getodk/collect/pull/4191#discussion_r515896064", "createdAt": "2020-11-02T11:03:36Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/logic/PropertyManager.java", "diffHunk": "@@ -112,12 +92,8 @@ public PropertyManager(Application application, RxEventBus rxEventBus, Permissio\n \n     public PropertyManager reload() {\n         try {\n-            // Device-defined properties\n-            IdAndPrefix idp = findDeviceId(context, deviceDetailsProvider);\n-            putProperty(PROPMGR_DEVICE_ID,     idp.prefix,          idp.id);\n+            putProperty(PROPMGR_DEVICE_ID,     SCHEME_IMEI,         deviceDetailsProvider.getDeviceId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyOTU4MQ=="}, "originalCommit": {"oid": "50ec197e27afa78cca6dd3eea331a5d6db74c9d0"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3149, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}