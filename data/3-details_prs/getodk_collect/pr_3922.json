{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzEzMjE5", "number": 3922, "title": "Reworking GeoShape and GeoTraceWidget", "bodyText": "Closes #3979\nThis PR is the work on GeoShape and GeoTrace Widget.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nI pulled the GeoWidgets out of BaseGeoWidget class and hence removed the BaseGeoWidget and BaseGeoWidgetTest.\nI added ActivityGeoDataRequester that implements GeoDataRequester which requests geo data whenever geo button is clicked.\nFor testing purposes, I added GeoWidgetHelpers that checks whether the data passed to the intent on button click is correct or not.\nIt adds an extra functionality of allowing the user to view any of the widgets (with maps/placement maps appearance) data in readOnly mode (when data is available). On master, buttons are hidden for the readOnly mode, whether or not data is available.\nDo we need any specific form for testing your changes? If so, please attach one.\nAll Widgets form, or any form with the geo widgets.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-06-12T14:27:59Z", "url": "https://github.com/getodk/collect/pull/3922", "merged": true, "mergeCommit": {"oid": "32ad63459faba6d98a42933a9858651f896c9266"}, "closed": true, "closedAt": "2020-10-16T16:56:00Z", "author": {"login": "SaumiaSinghal"}, "timelineItems": {"totalCount": 50, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3Gez2ABqjM1NzEzNDU5NTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSDcDrAH2gAyNDMzNzEzMjE5OjM1OTNjNjFlMTBmNWVhYjc4Mzc1ZmQ2Zjc3MGE1YmEyMWY0N2MwMjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c006180d24e90c9e297056f00ae4b50e6e387055", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/c006180d24e90c9e297056f00ae4b50e6e387055", "committedDate": "2020-06-12T14:20:12Z", "message": "update GeoShapeWidget"}, "afterCommit": {"oid": "2be76989c2c53a5603bb2f7360f16e8149bacf93", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/2be76989c2c53a5603bb2f7360f16e8149bacf93", "committedDate": "2020-07-21T13:44:30Z", "message": "code refactor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2be76989c2c53a5603bb2f7360f16e8149bacf93", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/2be76989c2c53a5603bb2f7360f16e8149bacf93", "committedDate": "2020-07-21T13:44:30Z", "message": "code refactor"}, "afterCommit": {"oid": "56bd15577b7c7c9bd1ece87acd6a30ad23db9b45", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/56bd15577b7c7c9bd1ece87acd6a30ad23db9b45", "committedDate": "2020-07-21T19:04:03Z", "message": "delete BaseGeoWidget and BaseGeoWidgetTest class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTE0OTAy", "url": "https://github.com/getodk/collect/pull/3922#pullrequestreview-454114902", "createdAt": "2020-07-23T13:11:09Z", "commit": {"oid": "8fbd7696aa59382b1a465ae6cf9916c25fde734d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMzoxMToxMFrOG2Jzbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMzoxMToxMFrOG2Jzbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQzNjkxMQ==", "bodyText": "For all the four GeoWidgets, I call static method onButtonClick, when geoButton is clicked. In the corresponding test, I was thinking just verifying the method call, and checking different cases later on in unit tests for GeoWidgetUtils.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r459436911", "createdAt": "2020-07-23T13:11:10Z", "author": {"login": "SaumiaSinghal"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/GeoPointWidget.java", "diffHunk": "@@ -17,153 +17,111 @@\n import android.annotation.SuppressLint;\n import android.app.Activity;\n import android.content.Context;\n-import android.content.Intent;\n+import android.os.Bundle;\n+import android.util.TypedValue;\n+import android.view.View;\n \n-import org.javarosa.core.model.data.GeoPointData;\n+import org.javarosa.core.model.QuestionDef;\n import org.javarosa.core.model.data.IAnswerData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.GeoPointActivity;\n-import org.odk.collect.android.activities.GeoPointMapActivity;\n+import org.odk.collect.android.databinding.GeoWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.geo.MapProvider;\n+import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n import org.odk.collect.android.widgets.utilities.GeoWidgetUtils;\n+import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n-import static org.odk.collect.android.utilities.WidgetAppearanceUtils.MAPS;\n-import static org.odk.collect.android.utilities.WidgetAppearanceUtils.PLACEMENT_MAP;\n-import static org.odk.collect.android.utilities.WidgetAppearanceUtils.hasAppearance;\n+import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes.LOCATION_CAPTURE;\n \n-/**\n- * GeoPointWidget is the widget that allows the user to get GPS readings.\n- *\n- * @author Carl Hartung (carlhartung@gmail.com)\n- * @author Yaw Anokwa (yanokwa@gmail.com)\n- * @author Jon Nordling (jonnordling@gmail.com)\n- */\n @SuppressLint(\"ViewConstructor\")\n-public class GeoPointWidget extends BaseGeoWidget {\n-    public static final String LOCATION = \"gp\";\n-    public static final String ACCURACY_THRESHOLD = \"accuracyThreshold\";\n-    public static final String READ_ONLY = \"readOnly\";\n-    public static final String DRAGGABLE_ONLY = \"draggable\";\n-\n-    public static final double DEFAULT_LOCATION_ACCURACY = 5.0;\n-    private boolean useMap;\n-    private double accuracyThreshold;\n-    private boolean draggable = true;\n+public class GeoPointWidget extends QuestionWidget implements BinaryDataReceiver {\n+    GeoWidgetAnswerBinding binding;\n+\n+    private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final double accuracyThreshold;\n+\n+    private boolean readOnly;\n     private String stringAnswer;\n \n-    public GeoPointWidget(Context context, QuestionDetails questionDetails) {\n+    public GeoPointWidget(Context context, QuestionDetails questionDetails, QuestionDef questionDef, WaitingForDataRegistry waitingForDataRegistry) {\n         super(context, questionDetails);\n-        determineMapProperties();\n-    }\n+        this.waitingForDataRegistry = waitingForDataRegistry;\n+        accuracyThreshold = GeoWidgetUtils.getAccuracyThreshold(questionDef);\n \n-    private void determineMapProperties() {\n-        // Determine the accuracy threshold to use.\n-        String acc = getFormEntryPrompt().getQuestion().getAdditionalAttribute(null, ACCURACY_THRESHOLD);\n-        accuracyThreshold = acc != null && !acc.isEmpty() ? Double.parseDouble(acc) : DEFAULT_LOCATION_ACCURACY;\n-\n-        // Determine whether to use the map and whether the point should be draggable.\n-        if (MapProvider.getConfigurator().isAvailable(getContext())) {\n-            if (hasAppearance(getFormEntryPrompt(), PLACEMENT_MAP)) {\n-                draggable = true;\n-                useMap = true;\n-            } else if (hasAppearance(getFormEntryPrompt(), MAPS)) {\n-                draggable = false;\n-                useMap = true;\n-            }\n+        stringAnswer = getFormEntryPrompt().getAnswerText();\n+        boolean dataAvailable = false;\n+        if (stringAnswer != null && !stringAnswer.isEmpty()) {\n+            dataAvailable = true;\n+            setBinaryData(stringAnswer);\n         }\n+        updateButtonLabelsAndVisibility(dataAvailable);\n     }\n \n-    public void updateButtonLabelsAndVisibility(boolean dataAvailable) {\n-        if (useMap) {\n-            if (readOnly) {\n-                startGeoButton.setText(R.string.geopoint_view_read_only);\n-            } else {\n-                startGeoButton.setText(\n-                    dataAvailable ? R.string.view_change_location : R.string.get_point);\n-            }\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = GeoWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n+        View answerView = binding.getRoot();\n+\n+        binding.geoAnswerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        readOnly = prompt.isReadOnly();\n+        if (readOnly) {\n+            binding.simpleButton.setVisibility(GONE);\n         } else {\n-            if (!readOnly) {\n-                startGeoButton.setText(\n-                    dataAvailable ? R.string.change_location : R.string.get_point);\n-            }\n+            binding.simpleButton.setText(getDefaultButtonLabel());\n+            binding.simpleButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+            binding.simpleButton.setOnClickListener(v -> {\n+                Bundle bundle = GeoWidgetUtils.getGeoPointBundle(stringAnswer, accuracyThreshold, null, null);\n+                GeoWidgetUtils.onButtonClick(context, prompt, getPermissionUtils(), null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fbd7696aa59382b1a465ae6cf9916c25fde734d"}, "originalPosition": 115}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8fbd7696aa59382b1a465ae6cf9916c25fde734d", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/8fbd7696aa59382b1a465ae6cf9916c25fde734d", "committedDate": "2020-07-22T21:17:20Z", "message": "code improvements"}, "afterCommit": {"oid": "cfb940e669e086f5da8bceb036645b8aa13ad180", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/cfb940e669e086f5da8bceb036645b8aa13ad180", "committedDate": "2020-07-23T20:14:38Z", "message": "code improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2ODc0OTU1", "url": "https://github.com/getodk/collect/pull/3922#pullrequestreview-466874955", "createdAt": "2020-08-13T15:29:30Z", "commit": {"oid": "34a331caca9aa9a1508b56dd21b7d6108dfd30ce"}, "state": "DISMISSED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNToyOTozMFrOHAQ3wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNTo0Njo0OVrOHARkkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAzODQ2NQ==", "bodyText": "Won't this already be taken care of by the call on updateUi? I think you might be able to remove it.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r470038465", "createdAt": "2020-08-13T15:29:30Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/GeoPolyActivity.java", "diffHunk": "@@ -230,10 +234,16 @@ public void initMap(MapFragment newMapFragment) {\n         }\n         featureId = map.addDraggablePoly(points, outputMode == OutputMode.GEOSHAPE);\n \n-        if (inputActive) {\n+        if (inputActive && !intentReadOnly) {\n             startInput();\n         }\n \n+        if (intentReadOnly) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a331caca9aa9a1508b56dd21b7d6108dfd30ce"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0NTQyOA==", "bodyText": "Why keep this static method? It's not called directly so can be removed (and the contents moved to onButtonClicked).", "url": "https://github.com/getodk/collect/pull/3922#discussion_r470045428", "createdAt": "2020-08-13T15:40:05Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/GeoWidgetUtils.java", "diffHunk": "@@ -1,17 +1,127 @@\n package org.odk.collect.android.widgets.utilities;\n \n+import android.app.Activity;\n import android.content.Context;\n+import android.content.Intent;\n import android.location.Location;\n+import android.os.Bundle;\n \n+import org.javarosa.core.model.FormIndex;\n+import org.javarosa.core.model.QuestionDef;\n import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.databinding.GeoWidgetAnswerBinding;\n+import org.odk.collect.android.geo.MapConfigurator;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.widgets.interfaces.GeoWidgetListener;\n \n import java.text.DecimalFormat;\n \n import timber.log.Timber;\n \n-public class GeoWidgetUtils {\n+import static android.view.View.GONE;\n \n-    private GeoWidgetUtils() {\n+public class GeoWidgetUtils implements GeoWidgetListener {\n+    public static final String LOCATION = \"gp\";\n+    public static final String ACCURACY_THRESHOLD = \"accuracyThreshold\";\n+    public static final String READ_ONLY = \"readOnly\";\n+    public static final String DRAGGABLE_ONLY = \"draggable\";\n+    public static final double DEFAULT_LOCATION_ACCURACY = 5.0;\n+\n+    @Override\n+    public void onButtonClicked(Context context, FormIndex index, PermissionUtils permissionUtils, MapConfigurator mapConfigurator,\n+                                WaitingForDataRegistry waitingForDataRegistry, Class activityClass, Bundle bundle, int requestCode) {\n+        onButtonClick(context, index, permissionUtils, mapConfigurator, waitingForDataRegistry, activityClass, bundle, requestCode);\n+    }\n+\n+    @Override\n+    public void setButtonLabelAndVisibility(GeoWidgetAnswerBinding binding, boolean readOnly, boolean dataAvailable,\n+                                            int buttonTextReadOnly, int buttonTextDataAvailable, int defaultButtonText) {\n+        updateButtonLabelAndVisibility(binding, readOnly, dataAvailable, buttonTextReadOnly, buttonTextDataAvailable, defaultButtonText);\n+    }\n+\n+    public static double getAccuracyThreshold(QuestionDef questionDef) {\n+        // Determine the accuracy threshold to use.\n+        String acc = questionDef.getAdditionalAttribute(null, ACCURACY_THRESHOLD);\n+        return acc != null && !acc.isEmpty() ? Double.parseDouble(acc) : DEFAULT_LOCATION_ACCURACY;\n+    }\n+\n+    public static String getAnswerToDisplay(Context context, String answer) {\n+        try {\n+            if (answer != null && !answer.isEmpty()) {\n+                String[] parts = answer.split(\" \");\n+                return context.getString(\n+                        R.string.gps_result,\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[0]), \"lat\"),\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[1]), \"lon\"),\n+                        GeoWidgetUtils.truncateDouble(parts[2]),\n+                        GeoWidgetUtils.truncateDouble(parts[3])\n+                );\n+            }\n+        } catch (NumberFormatException e) {\n+            return \"\";\n+        }\n+        return \"\";\n+    }\n+\n+    public static Bundle getGeoPointBundle(String stringAnswer, double accuracyThreshold, Boolean readOnly, Boolean draggable) {\n+        final Bundle bundle = new Bundle();\n+        if (stringAnswer != null && !stringAnswer.isEmpty()) {\n+            bundle.putDoubleArray(LOCATION, GeoWidgetUtils.getLocationParamsFromStringAnswer(stringAnswer));\n+        }\n+        bundle.putDouble(ACCURACY_THRESHOLD, accuracyThreshold);\n+        if (readOnly != null && draggable != null) {\n+            bundle.putBoolean(READ_ONLY, readOnly);\n+            bundle.putBoolean(DRAGGABLE_ONLY, draggable);\n+        }\n+        return bundle;\n+    }\n+\n+    public static Bundle getGeoPolyBundle(String stringAnswer, GeoPolyActivity.OutputMode outputMode, boolean readOnly) {\n+        final Bundle bundle = new Bundle();\n+        bundle.putString(GeoPolyActivity.ANSWER_KEY, stringAnswer);\n+        bundle.putSerializable(GeoPolyActivity.OUTPUT_MODE_KEY, outputMode);\n+        bundle.putBoolean(READ_ONLY, readOnly);\n+        return bundle;\n+    }\n+\n+    private static void onButtonClick(Context context, FormIndex index, PermissionUtils permissionUtils, MapConfigurator mapConfigurator,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a331caca9aa9a1508b56dd21b7d6108dfd30ce"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0NjM1OA==", "bodyText": "Move contents to caller.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r470046358", "createdAt": "2020-08-13T15:41:27Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/GeoWidgetUtils.java", "diffHunk": "@@ -1,17 +1,127 @@\n package org.odk.collect.android.widgets.utilities;\n \n+import android.app.Activity;\n import android.content.Context;\n+import android.content.Intent;\n import android.location.Location;\n+import android.os.Bundle;\n \n+import org.javarosa.core.model.FormIndex;\n+import org.javarosa.core.model.QuestionDef;\n import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.databinding.GeoWidgetAnswerBinding;\n+import org.odk.collect.android.geo.MapConfigurator;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.widgets.interfaces.GeoWidgetListener;\n \n import java.text.DecimalFormat;\n \n import timber.log.Timber;\n \n-public class GeoWidgetUtils {\n+import static android.view.View.GONE;\n \n-    private GeoWidgetUtils() {\n+public class GeoWidgetUtils implements GeoWidgetListener {\n+    public static final String LOCATION = \"gp\";\n+    public static final String ACCURACY_THRESHOLD = \"accuracyThreshold\";\n+    public static final String READ_ONLY = \"readOnly\";\n+    public static final String DRAGGABLE_ONLY = \"draggable\";\n+    public static final double DEFAULT_LOCATION_ACCURACY = 5.0;\n+\n+    @Override\n+    public void onButtonClicked(Context context, FormIndex index, PermissionUtils permissionUtils, MapConfigurator mapConfigurator,\n+                                WaitingForDataRegistry waitingForDataRegistry, Class activityClass, Bundle bundle, int requestCode) {\n+        onButtonClick(context, index, permissionUtils, mapConfigurator, waitingForDataRegistry, activityClass, bundle, requestCode);\n+    }\n+\n+    @Override\n+    public void setButtonLabelAndVisibility(GeoWidgetAnswerBinding binding, boolean readOnly, boolean dataAvailable,\n+                                            int buttonTextReadOnly, int buttonTextDataAvailable, int defaultButtonText) {\n+        updateButtonLabelAndVisibility(binding, readOnly, dataAvailable, buttonTextReadOnly, buttonTextDataAvailable, defaultButtonText);\n+    }\n+\n+    public static double getAccuracyThreshold(QuestionDef questionDef) {\n+        // Determine the accuracy threshold to use.\n+        String acc = questionDef.getAdditionalAttribute(null, ACCURACY_THRESHOLD);\n+        return acc != null && !acc.isEmpty() ? Double.parseDouble(acc) : DEFAULT_LOCATION_ACCURACY;\n+    }\n+\n+    public static String getAnswerToDisplay(Context context, String answer) {\n+        try {\n+            if (answer != null && !answer.isEmpty()) {\n+                String[] parts = answer.split(\" \");\n+                return context.getString(\n+                        R.string.gps_result,\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[0]), \"lat\"),\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[1]), \"lon\"),\n+                        GeoWidgetUtils.truncateDouble(parts[2]),\n+                        GeoWidgetUtils.truncateDouble(parts[3])\n+                );\n+            }\n+        } catch (NumberFormatException e) {\n+            return \"\";\n+        }\n+        return \"\";\n+    }\n+\n+    public static Bundle getGeoPointBundle(String stringAnswer, double accuracyThreshold, Boolean readOnly, Boolean draggable) {\n+        final Bundle bundle = new Bundle();\n+        if (stringAnswer != null && !stringAnswer.isEmpty()) {\n+            bundle.putDoubleArray(LOCATION, GeoWidgetUtils.getLocationParamsFromStringAnswer(stringAnswer));\n+        }\n+        bundle.putDouble(ACCURACY_THRESHOLD, accuracyThreshold);\n+        if (readOnly != null && draggable != null) {\n+            bundle.putBoolean(READ_ONLY, readOnly);\n+            bundle.putBoolean(DRAGGABLE_ONLY, draggable);\n+        }\n+        return bundle;\n+    }\n+\n+    public static Bundle getGeoPolyBundle(String stringAnswer, GeoPolyActivity.OutputMode outputMode, boolean readOnly) {\n+        final Bundle bundle = new Bundle();\n+        bundle.putString(GeoPolyActivity.ANSWER_KEY, stringAnswer);\n+        bundle.putSerializable(GeoPolyActivity.OUTPUT_MODE_KEY, outputMode);\n+        bundle.putBoolean(READ_ONLY, readOnly);\n+        return bundle;\n+    }\n+\n+    private static void onButtonClick(Context context, FormIndex index, PermissionUtils permissionUtils, MapConfigurator mapConfigurator,\n+                                      WaitingForDataRegistry waitingForDataRegistry, Class activityClass, Bundle bundle, int requestCode) {\n+        permissionUtils.requestLocationPermissions((Activity) context, new PermissionListener() {\n+            @Override\n+            public void granted() {\n+                waitingForDataRegistry.waitForData(index);\n+                if (mapConfigurator == null || mapConfigurator.isAvailable(context)) {\n+                    GeoWidgetUtils.startGeoActivity(context, activityClass, bundle, requestCode);\n+                } else {\n+                    mapConfigurator.showUnavailableMessage(context);\n+                }\n+            }\n+\n+            @Override\n+            public void denied() {\n+            }\n+        });\n+    }\n+\n+    private static void startGeoActivity(Context context, Class activityClass, Bundle bundle, int requestCode) {\n+        Intent intent = new Intent(context, activityClass);\n+        intent.putExtras(bundle);\n+        ((Activity) context).startActivityForResult(intent, requestCode);\n+    }\n+\n+    private static void updateButtonLabelAndVisibility(GeoWidgetAnswerBinding binding, boolean readOnly, boolean dataAvailable,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a331caca9aa9a1508b56dd21b7d6108dfd30ce"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0NzE2OA==", "bodyText": "What's the advantage of putting this here rather than directly in GeoPointWidget? I don't see how it's implementing shared behavior.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r470047168", "createdAt": "2020-08-13T15:42:36Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/GeoWidgetUtils.java", "diffHunk": "@@ -1,17 +1,127 @@\n package org.odk.collect.android.widgets.utilities;\n \n+import android.app.Activity;\n import android.content.Context;\n+import android.content.Intent;\n import android.location.Location;\n+import android.os.Bundle;\n \n+import org.javarosa.core.model.FormIndex;\n+import org.javarosa.core.model.QuestionDef;\n import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.databinding.GeoWidgetAnswerBinding;\n+import org.odk.collect.android.geo.MapConfigurator;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.widgets.interfaces.GeoWidgetListener;\n \n import java.text.DecimalFormat;\n \n import timber.log.Timber;\n \n-public class GeoWidgetUtils {\n+import static android.view.View.GONE;\n \n-    private GeoWidgetUtils() {\n+public class GeoWidgetUtils implements GeoWidgetListener {\n+    public static final String LOCATION = \"gp\";\n+    public static final String ACCURACY_THRESHOLD = \"accuracyThreshold\";\n+    public static final String READ_ONLY = \"readOnly\";\n+    public static final String DRAGGABLE_ONLY = \"draggable\";\n+    public static final double DEFAULT_LOCATION_ACCURACY = 5.0;\n+\n+    @Override\n+    public void onButtonClicked(Context context, FormIndex index, PermissionUtils permissionUtils, MapConfigurator mapConfigurator,\n+                                WaitingForDataRegistry waitingForDataRegistry, Class activityClass, Bundle bundle, int requestCode) {\n+        onButtonClick(context, index, permissionUtils, mapConfigurator, waitingForDataRegistry, activityClass, bundle, requestCode);\n+    }\n+\n+    @Override\n+    public void setButtonLabelAndVisibility(GeoWidgetAnswerBinding binding, boolean readOnly, boolean dataAvailable,\n+                                            int buttonTextReadOnly, int buttonTextDataAvailable, int defaultButtonText) {\n+        updateButtonLabelAndVisibility(binding, readOnly, dataAvailable, buttonTextReadOnly, buttonTextDataAvailable, defaultButtonText);\n+    }\n+\n+    public static double getAccuracyThreshold(QuestionDef questionDef) {\n+        // Determine the accuracy threshold to use.\n+        String acc = questionDef.getAdditionalAttribute(null, ACCURACY_THRESHOLD);\n+        return acc != null && !acc.isEmpty() ? Double.parseDouble(acc) : DEFAULT_LOCATION_ACCURACY;\n+    }\n+\n+    public static String getAnswerToDisplay(Context context, String answer) {\n+        try {\n+            if (answer != null && !answer.isEmpty()) {\n+                String[] parts = answer.split(\" \");\n+                return context.getString(\n+                        R.string.gps_result,\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[0]), \"lat\"),\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[1]), \"lon\"),\n+                        GeoWidgetUtils.truncateDouble(parts[2]),\n+                        GeoWidgetUtils.truncateDouble(parts[3])\n+                );\n+            }\n+        } catch (NumberFormatException e) {\n+            return \"\";\n+        }\n+        return \"\";\n+    }\n+\n+    public static Bundle getGeoPointBundle(String stringAnswer, double accuracyThreshold, Boolean readOnly, Boolean draggable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a331caca9aa9a1508b56dd21b7d6108dfd30ce"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0ODM2NA==", "bodyText": "This is short enough that I don't think there's huge advantage to it being shared. Each poly widget could build its own bundle.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r470048364", "createdAt": "2020-08-13T15:44:20Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/GeoWidgetUtils.java", "diffHunk": "@@ -1,17 +1,127 @@\n package org.odk.collect.android.widgets.utilities;\n \n+import android.app.Activity;\n import android.content.Context;\n+import android.content.Intent;\n import android.location.Location;\n+import android.os.Bundle;\n \n+import org.javarosa.core.model.FormIndex;\n+import org.javarosa.core.model.QuestionDef;\n import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.databinding.GeoWidgetAnswerBinding;\n+import org.odk.collect.android.geo.MapConfigurator;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.widgets.interfaces.GeoWidgetListener;\n \n import java.text.DecimalFormat;\n \n import timber.log.Timber;\n \n-public class GeoWidgetUtils {\n+import static android.view.View.GONE;\n \n-    private GeoWidgetUtils() {\n+public class GeoWidgetUtils implements GeoWidgetListener {\n+    public static final String LOCATION = \"gp\";\n+    public static final String ACCURACY_THRESHOLD = \"accuracyThreshold\";\n+    public static final String READ_ONLY = \"readOnly\";\n+    public static final String DRAGGABLE_ONLY = \"draggable\";\n+    public static final double DEFAULT_LOCATION_ACCURACY = 5.0;\n+\n+    @Override\n+    public void onButtonClicked(Context context, FormIndex index, PermissionUtils permissionUtils, MapConfigurator mapConfigurator,\n+                                WaitingForDataRegistry waitingForDataRegistry, Class activityClass, Bundle bundle, int requestCode) {\n+        onButtonClick(context, index, permissionUtils, mapConfigurator, waitingForDataRegistry, activityClass, bundle, requestCode);\n+    }\n+\n+    @Override\n+    public void setButtonLabelAndVisibility(GeoWidgetAnswerBinding binding, boolean readOnly, boolean dataAvailable,\n+                                            int buttonTextReadOnly, int buttonTextDataAvailable, int defaultButtonText) {\n+        updateButtonLabelAndVisibility(binding, readOnly, dataAvailable, buttonTextReadOnly, buttonTextDataAvailable, defaultButtonText);\n+    }\n+\n+    public static double getAccuracyThreshold(QuestionDef questionDef) {\n+        // Determine the accuracy threshold to use.\n+        String acc = questionDef.getAdditionalAttribute(null, ACCURACY_THRESHOLD);\n+        return acc != null && !acc.isEmpty() ? Double.parseDouble(acc) : DEFAULT_LOCATION_ACCURACY;\n+    }\n+\n+    public static String getAnswerToDisplay(Context context, String answer) {\n+        try {\n+            if (answer != null && !answer.isEmpty()) {\n+                String[] parts = answer.split(\" \");\n+                return context.getString(\n+                        R.string.gps_result,\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[0]), \"lat\"),\n+                        GeoWidgetUtils.convertCoordinatesIntoDegreeFormat(context, Double.parseDouble(parts[1]), \"lon\"),\n+                        GeoWidgetUtils.truncateDouble(parts[2]),\n+                        GeoWidgetUtils.truncateDouble(parts[3])\n+                );\n+            }\n+        } catch (NumberFormatException e) {\n+            return \"\";\n+        }\n+        return \"\";\n+    }\n+\n+    public static Bundle getGeoPointBundle(String stringAnswer, double accuracyThreshold, Boolean readOnly, Boolean draggable) {\n+        final Bundle bundle = new Bundle();\n+        if (stringAnswer != null && !stringAnswer.isEmpty()) {\n+            bundle.putDoubleArray(LOCATION, GeoWidgetUtils.getLocationParamsFromStringAnswer(stringAnswer));\n+        }\n+        bundle.putDouble(ACCURACY_THRESHOLD, accuracyThreshold);\n+        if (readOnly != null && draggable != null) {\n+            bundle.putBoolean(READ_ONLY, readOnly);\n+            bundle.putBoolean(DRAGGABLE_ONLY, draggable);\n+        }\n+        return bundle;\n+    }\n+\n+    public static Bundle getGeoPolyBundle(String stringAnswer, GeoPolyActivity.OutputMode outputMode, boolean readOnly) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a331caca9aa9a1508b56dd21b7d6108dfd30ce"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA0OTkzOQ==", "bodyText": "In general, the Utils suffix is a red flag because it implies \"I didn't really know where to put this stuff so I put it here.\" It would be good to aim for clean abstractions that have meaningful names and specific responsibilities (e.g. GeoDataRequester as @seadowg suggested at #3922 (comment)).", "url": "https://github.com/getodk/collect/pull/3922#discussion_r470049939", "createdAt": "2020-08-13T15:46:49Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/GeoWidgetUtils.java", "diffHunk": "@@ -1,17 +1,127 @@\n package org.odk.collect.android.widgets.utilities;\n \n+import android.app.Activity;\n import android.content.Context;\n+import android.content.Intent;\n import android.location.Location;\n+import android.os.Bundle;\n \n+import org.javarosa.core.model.FormIndex;\n+import org.javarosa.core.model.QuestionDef;\n import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.databinding.GeoWidgetAnswerBinding;\n+import org.odk.collect.android.geo.MapConfigurator;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.widgets.interfaces.GeoWidgetListener;\n \n import java.text.DecimalFormat;\n \n import timber.log.Timber;\n \n-public class GeoWidgetUtils {\n+import static android.view.View.GONE;\n \n-    private GeoWidgetUtils() {\n+public class GeoWidgetUtils implements GeoWidgetListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a331caca9aa9a1508b56dd21b7d6108dfd30ce"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e46bb4711020c642b6ebbf541ceb969815c8c1dd", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/e46bb4711020c642b6ebbf541ceb969815c8c1dd", "committedDate": "2020-08-18T11:37:52Z", "message": "create widget button and widget answer text view style"}, "afterCommit": {"oid": "40e065f077bab25076a7d53c2a30218e10a15ea9", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/40e065f077bab25076a7d53c2a30218e10a15ea9", "committedDate": "2020-08-19T10:28:48Z", "message": "create widget button and widget answer text view style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NzcyNzMy", "url": "https://github.com/getodk/collect/pull/3922#pullrequestreview-476772732", "createdAt": "2020-08-27T14:23:31Z", "commit": {"oid": "f9d281de465d8b6f661f6d224c31cc13411fbe02"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDoyMzozMVrOHISxvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDoyNDoxNlrOHISz4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ1ODMwMQ==", "bodyText": "I think this interface should really be called the GeoDataRequester as that's what the widgets use it for. They do that on a button click but that's a detail of the widget.  It should also hide anything to do with the geo activity classes from the widget. The widget doesn't care how the geo data is acquired right? It just wants to get it in setBinaryData somehow.\nThat being the case it probably makes sense to have different methods like requestGeoPoint, requestGeoShape etc and then have the implementation control what activity it launches in each case. The implementation should also take responsibility for building the Bundle and the requestCode.\nGiven all that I think the implementation should probably be called something like ActivityGeoDataRequester as it's an activity based implementation of the request geo data.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r478458301", "createdAt": "2020-08-27T14:23:31Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/interfaces/GeoButtonClickListener.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package org.odk.collect.android.widgets.interfaces;\n+\n+import android.content.Context;\n+import android.os.Bundle;\n+\n+import org.javarosa.core.model.FormIndex;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n+\n+public interface GeoButtonClickListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9d281de465d8b6f661f6d224c31cc13411fbe02"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ1ODg0OA==", "bodyText": "permissionUtils could probably be a field of this class and come in at the constructor rather than be passed in as a method argument.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r478458848", "createdAt": "2020-08-27T14:24:16Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/GeoDataRequester.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package org.odk.collect.android.widgets.utilities;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.location.Location;\n+import android.os.Bundle;\n+\n+import org.javarosa.core.model.FormIndex;\n+import org.javarosa.core.model.QuestionDef;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.widgets.interfaces.GeoButtonClickListener;\n+\n+import java.text.DecimalFormat;\n+\n+import timber.log.Timber;\n+\n+public class GeoDataRequester implements GeoButtonClickListener {\n+    public static final String LOCATION = \"gp\";\n+    public static final String ACCURACY_THRESHOLD = \"accuracyThreshold\";\n+    public static final String READ_ONLY = \"readOnly\";\n+    public static final String DRAGGABLE_ONLY = \"draggable\";\n+    public static final double DEFAULT_LOCATION_ACCURACY = 5.0;\n+\n+    @Override\n+    public void requestGeoIntent(Context context, FormIndex index, PermissionUtils permissionUtils,\n+                                 WaitingForDataRegistry waitingForDataRegistry, Class activityClass, Bundle bundle, int requestCode) {\n+        permissionUtils.requestLocationPermissions((Activity) context, new PermissionListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9d281de465d8b6f661f6d224c31cc13411fbe02"}, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0320f56824bb4de6abc33541e738c02f8ba2df82", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/0320f56824bb4de6abc33541e738c02f8ba2df82", "committedDate": "2020-08-27T17:21:00Z", "message": "code refactor"}, "afterCommit": {"oid": "a1f9392f5a3804fbe61955c03c4856e447912c60", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/a1f9392f5a3804fbe61955c03c4856e447912c60", "committedDate": "2020-08-27T17:28:32Z", "message": "code refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODY4MzA5", "url": "https://github.com/getodk/collect/pull/3922#pullrequestreview-477868309", "createdAt": "2020-08-28T16:29:27Z", "commit": {"oid": "a1f9392f5a3804fbe61955c03c4856e447912c60"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NzYyODMw", "url": "https://github.com/getodk/collect/pull/3922#pullrequestreview-479762830", "createdAt": "2020-09-01T13:52:16Z", "commit": {"oid": "75e38f28d333d5b2c2ae1c2035e3a246f8e2d2e6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMzo1MjoxNlrOHK3SkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMzo1MjoxNlrOHK3SkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1MzY4MA==", "bodyText": "I think the static helper methods should stay in the GeoWidgetUtils class. There's no reason as far as I can see for them to live in ActivityGeoDataRequester and having them there creates a dependency between the widgets and the implementation of GeoDataRequester which isn't ideal.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r481153680", "createdAt": "2020-09-01T13:52:16Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/ActivityGeoDataRequester.java", "diffHunk": "@@ -6,24 +6,23 @@\n import android.location.Location;\n import android.os.Bundle;\n \n-import org.javarosa.core.model.FormIndex;\n import org.javarosa.core.model.QuestionDef;\n import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.GeoPointActivity;\n+import org.odk.collect.android.activities.GeoPointMapActivity;\n import org.odk.collect.android.activities.GeoPolyActivity;\n import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.ApplicationConstants;\n import org.odk.collect.android.utilities.PermissionUtils;\n-import org.odk.collect.android.widgets.interfaces.ActivityGeoDataRequester;\n+import org.odk.collect.android.utilities.WidgetAppearanceUtils;\n+import org.odk.collect.android.widgets.interfaces.GeoDataRequester;\n \n import java.text.DecimalFormat;\n \n import timber.log.Timber;\n \n-import static org.odk.collect.android.utilities.WidgetAppearanceUtils.MAPS;\n-import static org.odk.collect.android.utilities.WidgetAppearanceUtils.PLACEMENT_MAP;\n-import static org.odk.collect.android.utilities.WidgetAppearanceUtils.hasAppearance;\n-\n-public class GeoWidgetUtils implements ActivityGeoDataRequester {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75e38f28d333d5b2c2ae1c2035e3a246f8e2d2e6"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dec18317517d3e81a66040314c9b06be5d3ba716", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/dec18317517d3e81a66040314c9b06be5d3ba716", "committedDate": "2020-09-01T13:45:00Z", "message": "Merge branch 'master' into rework_geoShapeWidget"}, "afterCommit": {"oid": "63506e07c9f41107ab2c4e31e403cc197fcef529", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/63506e07c9f41107ab2c4e31e403cc197fcef529", "committedDate": "2020-09-01T14:24:00Z", "message": "implement GeoWidgetUtils and ActivityDataRequester"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNjI2MTE0", "url": "https://github.com/getodk/collect/pull/3922#pullrequestreview-480626114", "createdAt": "2020-09-02T09:05:36Z", "commit": {"oid": "d249bbde5eb7aa72ba0a0e2af149449bd07dd6e8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwOTowNTozN1rOHLl4KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwOTozOTo0NVrOHLnPBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTkxNjk2OQ==", "bodyText": "This should still implement the interface so that the widget depends on an abstraction rather than an implementation.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r481916969", "createdAt": "2020-09-02T09:05:37Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/ActivityGeoDataRequester.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package org.odk.collect.android.widgets.utilities;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.os.Bundle;\n+\n+import org.javarosa.form.api.FormEntryPrompt;\n+import org.odk.collect.android.activities.GeoPointActivity;\n+import org.odk.collect.android.activities.GeoPointMapActivity;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.ApplicationConstants;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.utilities.WidgetAppearanceUtils;\n+\n+public class ActivityGeoDataRequester {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d249bbde5eb7aa72ba0a0e2af149449bd07dd6e8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTkxODIwOQ==", "bodyText": "I don't think we should have this constructor. The WidgetFactory can construct a PermissionUtils object to pass in.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r481918209", "createdAt": "2020-09-02T09:07:01Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/utilities/ActivityGeoDataRequester.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package org.odk.collect.android.widgets.utilities;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.os.Bundle;\n+\n+import org.javarosa.form.api.FormEntryPrompt;\n+import org.odk.collect.android.activities.GeoPointActivity;\n+import org.odk.collect.android.activities.GeoPointMapActivity;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.utilities.ApplicationConstants;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.utilities.WidgetAppearanceUtils;\n+\n+public class ActivityGeoDataRequester {\n+    public static final String LOCATION = \"gp\";\n+    public static final String ACCURACY_THRESHOLD = \"accuracyThreshold\";\n+    public static final String READ_ONLY = \"readOnly\";\n+    public static final String DRAGGABLE_ONLY = \"draggable\";\n+\n+    private final PermissionUtils permissionUtils;\n+\n+    public ActivityGeoDataRequester() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d249bbde5eb7aa72ba0a0e2af149449bd07dd6e8"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTkzNzA0NQ==", "bodyText": "I think all the widgets are missing tests to check that setBinaryData actually updates the widget answer (getAnswer). It looks like right now the wigets are broken and don't save answers (just display them).", "url": "https://github.com/getodk/collect/pull/3922#discussion_r481937045", "createdAt": "2020-09-02T09:36:04Z", "author": {"login": "seadowg"}, "path": "collect_app/src/test/java/org/odk/collect/android/widgets/GeoPointWidgetTest.java", "diffHunk": "@@ -1,212 +1,151 @@\n package org.odk.collect.android.widgets;\n \n-import android.content.ComponentName;\n-import android.content.Intent;\n-import android.os.Bundle;\n import android.view.View;\n \n-import org.javarosa.core.model.QuestionDef;\n import org.javarosa.core.model.data.GeoPointData;\n-import org.javarosa.core.model.data.StringData;\n import org.javarosa.form.api.FormEntryPrompt;\n import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.odk.collect.android.R;\n-import org.odk.collect.android.activities.GeoPointActivity;\n-import org.odk.collect.android.fakes.FakePermissionUtils;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n+import org.odk.collect.android.listeners.WidgetValueChangedListener;\n+import org.odk.collect.android.widgets.utilities.ActivityGeoDataRequester;\n import org.odk.collect.android.widgets.utilities.GeoWidgetUtils;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n import org.robolectric.RobolectricTestRunner;\n \n-import java.util.Random;\n-\n-import static org.hamcrest.MatcherAssert.assertThat;\n-import static org.hamcrest.Matchers.equalTo;\n-import static org.hamcrest.Matchers.nullValue;\n+import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNull;\n-import static org.mockito.ArgumentMatchers.anyString;\n import static org.mockito.Mockito.mock;\n import static org.mockito.Mockito.verify;\n-import static org.mockito.Mockito.when;\n-import static org.odk.collect.android.widgets.GeoPointMapWidget.ACCURACY_THRESHOLD;\n-import static org.odk.collect.android.widgets.GeoPointMapWidget.DEFAULT_LOCATION_ACCURACY;\n-import static org.odk.collect.android.widgets.GeoPointMapWidget.LOCATION;\n+import static org.odk.collect.android.widgets.support.GeoWidgetHelpers.getRandomDoubleArray;\n+import static org.odk.collect.android.widgets.support.QuestionWidgetHelpers.mockValueChangedListener;\n import static org.odk.collect.android.widgets.support.QuestionWidgetHelpers.promptWithAnswer;\n import static org.odk.collect.android.widgets.support.QuestionWidgetHelpers.promptWithReadOnly;\n import static org.odk.collect.android.widgets.support.QuestionWidgetHelpers.widgetTestActivity;\n-import static org.robolectric.Shadows.shadowOf;\n-\n-/**\n- * @author James Knight\n- */\n \n @RunWith(RobolectricTestRunner.class)\n public class GeoPointWidgetTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d249bbde5eb7aa72ba0a0e2af149449bd07dd6e8"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTkzOTIwNQ==", "bodyText": "These three tests should be broken into multiple tests for the different calls to the methods under tests (for readOnly mode and different appearances for example). Otherwise, it's hard to read the test and if one fails it'll be harder to see what exactly has failed.", "url": "https://github.com/getodk/collect/pull/3922#discussion_r481939205", "createdAt": "2020-09-02T09:39:45Z", "author": {"login": "seadowg"}, "path": "collect_app/src/test/java/org/odk/collect/android/widgets/utilities/ActivityGeoDataRequesterTest.java", "diffHunk": "@@ -0,0 +1,183 @@\n+package org.odk.collect.android.widgets.utilities;\n+\n+import android.content.ComponentName;\n+import android.content.Intent;\n+\n+import org.javarosa.core.model.FormIndex;\n+import org.javarosa.core.model.QuestionDef;\n+import org.javarosa.core.model.data.GeoPointData;\n+import org.javarosa.form.api.FormEntryPrompt;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.activities.GeoPointActivity;\n+import org.odk.collect.android.activities.GeoPointMapActivity;\n+import org.odk.collect.android.activities.GeoPolyActivity;\n+import org.odk.collect.android.fakes.FakePermissionUtils;\n+import org.odk.collect.android.support.TestScreenContextActivity;\n+import org.odk.collect.android.utilities.WidgetAppearanceUtils;\n+import org.odk.collect.android.widgets.support.FakeWaitingForDataRegistry;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.shadows.ShadowActivity;\n+\n+import static junit.framework.TestCase.assertEquals;\n+import static junit.framework.TestCase.assertTrue;\n+import static org.junit.Assert.assertNull;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes.GEOSHAPE_CAPTURE;\n+import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes.GEOTRACE_CAPTURE;\n+import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes.LOCATION_CAPTURE;\n+import static org.odk.collect.android.widgets.support.GeoWidgetHelpers.assertGeoPointBundleArgumentEquals;\n+import static org.odk.collect.android.widgets.support.GeoWidgetHelpers.assertGeoPolyBundleArgumentEquals;\n+import static org.odk.collect.android.widgets.support.GeoWidgetHelpers.getRandomDoubleArray;\n+import static org.odk.collect.android.widgets.support.QuestionWidgetHelpers.promptWithReadOnly;\n+import static org.odk.collect.android.widgets.support.QuestionWidgetHelpers.widgetTestActivity;\n+import static org.odk.collect.android.widgets.utilities.ActivityGeoDataRequester.ACCURACY_THRESHOLD;\n+import static org.robolectric.Shadows.shadowOf;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class ActivityGeoDataRequesterTest {\n+    private final FakePermissionUtils permissionUtils = new FakePermissionUtils();\n+    private final ActivityGeoDataRequester activityGeoDataRequester = new ActivityGeoDataRequester(permissionUtils);\n+    private final FakeWaitingForDataRegistry waitingForDataRegistry = new FakeWaitingForDataRegistry();\n+    private final GeoPointData answer = new GeoPointData(getRandomDoubleArray());\n+\n+    private TestScreenContextActivity testActivity;\n+    private ShadowActivity shadowActivity;\n+    private FormEntryPrompt prompt;\n+    private FormIndex formIndex;\n+    private QuestionDef questionDef;\n+\n+    @Before\n+    public void setUp() {\n+        testActivity = widgetTestActivity();\n+        shadowActivity = shadowOf(testActivity);\n+\n+        prompt = promptWithReadOnly();\n+        formIndex = mock(FormIndex.class);\n+        questionDef = mock(QuestionDef.class);\n+\n+        permissionUtils.setPermissionGranted(true);\n+        when(prompt.getQuestion()).thenReturn(questionDef);\n+        when(prompt.getIndex()).thenReturn(formIndex);\n+    }\n+\n+    @Test\n+    public void whenPermissionIsNotGranted_requestGeoPoint_doesNotLaunchAnyIntent() {\n+        permissionUtils.setPermissionGranted(false);\n+        activityGeoDataRequester.requestGeoPoint(testActivity, prompt, waitingForDataRegistry);\n+\n+        assertNull(shadowActivity.getNextStartedActivity());\n+        assertTrue(waitingForDataRegistry.waiting.isEmpty());\n+    }\n+\n+    @Test\n+    public void whenPermissionIsNotGranted_requestGeoShape_doesNotLaunchAnyIntent() {\n+        permissionUtils.setPermissionGranted(false);\n+        activityGeoDataRequester.requestGeoShape(testActivity, prompt, waitingForDataRegistry);\n+\n+        assertNull(shadowActivity.getNextStartedActivity());\n+        assertTrue(waitingForDataRegistry.waiting.isEmpty());\n+    }\n+\n+    @Test\n+    public void whenPermissionIsNotGranted_requestGeoTrace_doesNotLaunchAnyIntent() {\n+        permissionUtils.setPermissionGranted(false);\n+        activityGeoDataRequester.requestGeoTrace(testActivity, prompt, waitingForDataRegistry);\n+\n+        assertNull(shadowActivity.getNextStartedActivity());\n+        assertTrue(waitingForDataRegistry.waiting.isEmpty());\n+    }\n+\n+    @Test\n+    public void whenPermissionIGranted_requestGeoPoint_launchCorrectIntent_andSetsFormIndexWaitingForData() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d249bbde5eb7aa72ba0a0e2af149449bd07dd6e8"}, "originalPosition": 94}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNzUxNjY2", "url": "https://github.com/getodk/collect/pull/3922#pullrequestreview-480751666", "createdAt": "2020-09-02T12:05:44Z", "commit": {"oid": "3804e03c96721f38ae6c1c95764289ac2712f935"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3804e03c96721f38ae6c1c95764289ac2712f935", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/3804e03c96721f38ae6c1c95764289ac2712f935", "committedDate": "2020-09-02T11:00:07Z", "message": "fix getAnswer in widgets"}, "afterCommit": {"oid": "604a9d4e462f5a2134ba85dcf3c5cdaee9ee74a6", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/604a9d4e462f5a2134ba85dcf3c5cdaee9ee74a6", "committedDate": "2020-10-09T10:18:12Z", "message": "fix getAnswer in widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00dc337c20941a8ce9d0e85d3065b74a6d0b13f0", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/00dc337c20941a8ce9d0e85d3065b74a6d0b13f0", "committedDate": "2020-10-13T01:43:04Z", "message": "add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e32fa29e652dde4b6d9300ce6b67214dcdd272e", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/0e32fa29e652dde4b6d9300ce6b67214dcdd272e", "committedDate": "2020-10-13T01:43:13Z", "message": "revert accidental change in build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c453021591c47382e9119453f60ee8e57b7af897", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/c453021591c47382e9119453f60ee8e57b7af897", "committedDate": "2020-10-13T01:44:30Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49b0cc6a650a3db44910751520c272ab96dc1a9a", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/49b0cc6a650a3db44910751520c272ab96dc1a9a", "committedDate": "2020-10-13T01:44:35Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7f4039e339267c6f0c86989f7039014201c21a0", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/a7f4039e339267c6f0c86989f7039014201c21a0", "committedDate": "2020-10-13T01:44:35Z", "message": "add unit tests for geoshape widget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77ba4338636cd686833223de431671690a78c625", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/77ba4338636cd686833223de431671690a78c625", "committedDate": "2020-10-13T01:44:35Z", "message": "update GeoShapeWidget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a492ec858f9ce30ea993ec2fc97e917c6c910079", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/a492ec858f9ce30ea993ec2fc97e917c6c910079", "committedDate": "2020-10-13T01:44:35Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29e1b7aa29992f898287a96d9c2899967ab7b16c", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/29e1b7aa29992f898287a96d9c2899967ab7b16c", "committedDate": "2020-10-13T01:44:35Z", "message": "add unit tests for GeoTraceWidget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf543a5eb4ca92cd7e317adb06d6a7ec01ce61b6", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/cf543a5eb4ca92cd7e317adb06d6a7ec01ce61b6", "committedDate": "2020-10-13T01:44:35Z", "message": "update GeoTraceWidget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03eecc699bbec954f0d1c8ecaa330db04fd9da01", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/03eecc699bbec954f0d1c8ecaa330db04fd9da01", "committedDate": "2020-10-13T01:44:35Z", "message": "add unit tests for GeoTraceWidget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c9d33434cfc3677df8ab903bc295b2348881d19", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/1c9d33434cfc3677df8ab903bc295b2348881d19", "committedDate": "2020-10-13T01:44:35Z", "message": "resolve conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "293af151bf4d743c5674943e5d2cf07f080700b4", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/293af151bf4d743c5674943e5d2cf07f080700b4", "committedDate": "2020-10-13T01:44:35Z", "message": "code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b5489e9ba080b2b1446fa6cd86b648ad6df3b4e", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/5b5489e9ba080b2b1446fa6cd86b648ad6df3b4e", "committedDate": "2020-10-13T01:44:35Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0d2e4d11b58ac829a01d5eee0535bbd01e42aad", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/d0d2e4d11b58ac829a01d5eee0535bbd01e42aad", "committedDate": "2020-10-13T01:44:35Z", "message": "unit tests refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fc2338ba3b5521389f5e4820717dc558ac69fe4", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/2fc2338ba3b5521389f5e4820717dc558ac69fe4", "committedDate": "2020-10-13T01:44:35Z", "message": "code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84a2d3ef86f46ee8fa9cdc3e813a68204b1d4c14", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/84a2d3ef86f46ee8fa9cdc3e813a68204b1d4c14", "committedDate": "2020-10-13T01:44:35Z", "message": "revert accidentendal change in build.gradle file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05cae55f854e13f099b57fac8d2466680ca52d9e", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/05cae55f854e13f099b57fac8d2466680ca52d9e", "committedDate": "2020-10-13T01:44:35Z", "message": "refactor GeoButtonClickListener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88070633e48bbe760b66778efce31b0a756287e2", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/88070633e48bbe760b66778efce31b0a756287e2", "committedDate": "2020-10-13T01:44:35Z", "message": "show geoshape and geotrace button when prompt is readonly and data is available"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51c9549e9886d1c12769663e6d073d7eb34a4e9a", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/51c9549e9886d1c12769663e6d073d7eb34a4e9a", "committedDate": "2020-10-13T01:44:35Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c45742657e909a9847aa6b1666a438885e23b55b", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/c45742657e909a9847aa6b1666a438885e23b55b", "committedDate": "2020-10-13T01:44:35Z", "message": "update unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c5f4aa5e9f6ff9c3b9cfd3c0fec5d798a9e1fa9", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/8c5f4aa5e9f6ff9c3b9cfd3c0fec5d798a9e1fa9", "committedDate": "2020-10-13T01:44:35Z", "message": "add unit tests for GeoWidgetUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82206b1e60ad9da27c55f92b47f654c066b6e212", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/82206b1e60ad9da27c55f92b47f654c066b6e212", "committedDate": "2020-10-13T01:44:35Z", "message": " refactor GeoWidgetUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fa58d048f69530b3c30498f2cb5ede09c6541f6", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/5fa58d048f69530b3c30498f2cb5ede09c6541f6", "committedDate": "2020-10-13T01:44:35Z", "message": "refactor unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95c542c7d1fe3d71faf91bf9254f92f5dfea6dd3", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/95c542c7d1fe3d71faf91bf9254f92f5dfea6dd3", "committedDate": "2020-10-13T01:44:35Z", "message": "create widget button and widget answer text view style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19b53dda9d1c772971527208d7b2fc9c78314bf2", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/19b53dda9d1c772971527208d7b2fc9c78314bf2", "committedDate": "2020-10-13T01:44:35Z", "message": "fix #3979"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fc3b41abb951bd17c016c903f6cc4a4cd7a8fd3", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/1fc3b41abb951bd17c016c903f6cc4a4cd7a8fd3", "committedDate": "2020-10-13T01:44:35Z", "message": "create widget button and widget answer text view style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14e2f1d72d1d20965430b3f57ef92ebe5e203d48", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/14e2f1d72d1d20965430b3f57ef92ebe5e203d48", "committedDate": "2020-10-13T01:44:35Z", "message": "code refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e433ab5d6f1d453cb663e8f57f28effa9c2102e8", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/e433ab5d6f1d453cb663e8f57f28effa9c2102e8", "committedDate": "2020-10-13T01:44:35Z", "message": "implement GeoWidgetUtils and ActivityDataRequester"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb19b5073e05ab17df37db0dc82cf0269cdeaeca", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/fb19b5073e05ab17df37db0dc82cf0269cdeaeca", "committedDate": "2020-10-13T01:44:35Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6da6f5e74bf9ae1b98a9bc77c7865d16f0d65da0", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/6da6f5e74bf9ae1b98a9bc77c7865d16f0d65da0", "committedDate": "2020-10-13T01:45:20Z", "message": "implement abstarction using GeoDataRequester interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "797bb40a3a3d82bdf76e763abf5b05bbceba4526", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/797bb40a3a3d82bdf76e763abf5b05bbceba4526", "committedDate": "2020-10-13T01:45:26Z", "message": "fix getAnswer in widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70fd88bfa46df285050d6f23ae9d2e8d60d9bebf", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/70fd88bfa46df285050d6f23ae9d2e8d60d9bebf", "committedDate": "2020-10-13T01:50:34Z", "message": "fix unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "604a9d4e462f5a2134ba85dcf3c5cdaee9ee74a6", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/604a9d4e462f5a2134ba85dcf3c5cdaee9ee74a6", "committedDate": "2020-10-09T10:18:12Z", "message": "fix getAnswer in widgets"}, "afterCommit": {"oid": "70fd88bfa46df285050d6f23ae9d2e8d60d9bebf", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/70fd88bfa46df285050d6f23ae9d2e8d60d9bebf", "committedDate": "2020-10-13T01:50:34Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d60c0b1ac99a23f0b3f85a7bc689d9924fc18fd", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/7d60c0b1ac99a23f0b3f85a7bc689d9924fc18fd", "committedDate": "2020-10-13T02:41:44Z", "message": "fix sending data to intent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4497ee076600043fbd8c55cefe3b3dff1845edf", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/a4497ee076600043fbd8c55cefe3b3dff1845edf", "committedDate": "2020-10-13T07:04:39Z", "message": "add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3593c61e10f5eab78375fd6f770a5ba21f47c020", "author": {"user": {"login": "SaumiaSinghal", "name": "Saumia Singhal"}}, "url": "https://github.com/getodk/collect/commit/3593c61e10f5eab78375fd6f770a5ba21f47c020", "committedDate": "2020-10-13T07:28:14Z", "message": "fix unit test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2509, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}