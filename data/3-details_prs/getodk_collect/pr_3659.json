{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDkyMTg1", "number": 3659, "title": "Revise main menu layout/design", "bodyText": "Closes #3650. Dependent on/blocked by #3623.\n\nThis removes the title and subtitle from the main menu. The app name and version our now displayed in the app bar and the commit sha/beta tag appear at the bottom of the screen for dev and beta builds.\nThe app bar color has also changed. This component (along with the MaterialButtons that are now being used) on the main menu use our theme's colorPrimary which has now been changed to reflect the button colors. Down the line we should look at making this something a little less Windows '95.\nWhat has been done to verify that this works as intended?\nRan through a couple of forms and the UI just to check nothing had changed (in a bad way).\nWhy is this the best possible solution? Were any other approaches considered?\nWe could have continued to just use Button instead of MaterialButton but I think this was the moment to pull the tirgger on the change. Next step is to change the rest of the buttons in the app. This will then let us use the MaterialComponents theme rather than AppCompat. Otherwise the theme automatically changes all our buttons to MaterialButtons.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nThere is a risk that some views now look weird in light or dark mode given the primary color has changed. Good to have a general run through and check but as far as I can see we are ok.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-02-28T17:03:06Z", "url": "https://github.com/getodk/collect/pull/3659", "merged": true, "mergeCommit": {"oid": "7190d3daed7fc05fa117edaa24b1418ea303b52e"}, "closed": true, "closedAt": "2020-03-04T14:14:08Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJwgBMgBqjMwODg3NDAxNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKWwVlABqjMwOTY0NDMzNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26b8d3e7719bcb5801441703812524c593ef863f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/26b8d3e7719bcb5801441703812524c593ef863f", "committedDate": "2020-02-28T15:14:18Z", "message": "Use MaterialToolbar on Main Menu"}, "afterCommit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9", "committedDate": "2020-03-02T16:40:48Z", "message": "Use MaterialToolbar on Main Menu"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3Mzg3Mzg3", "url": "https://github.com/getodk/collect/pull/3659#pullrequestreview-367387387", "createdAt": "2020-03-02T17:31:08Z", "commit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzozMTowOFrOFwoeBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzozMjo1MlrOFwohzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTAxNQ==", "bodyText": "How did you decide to remove the v? We have the v prefix everywhere that we show a Collect version including GitHub releases, the forum, the Play Store release notes, etc. That's the case across all ODK tools. I like the consistency and would personally keep the v in.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386539015", "createdAt": "2020-03-02T17:31:08Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);\n+\n+        if (split.length > 1) {\n+            return split[1];\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    private String versionNameWithoutPrefix() {\n+        return BuildConfig.VERSION_NAME.split(\"v\")[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTk4MQ==", "bodyText": "This means that for beta versions the beta will be at the bottom of the screen. I think of the beta as being part of the version (e.g. we put v1.26.0-beta.0 in the release notes) and I think it's helpful to have up top.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386539981", "createdAt": "2020-03-02T17:32:52Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDMxMzQ3", "url": "https://github.com/getodk/collect/pull/3659#pullrequestreview-367431347", "createdAt": "2020-03-02T18:37:20Z", "commit": {"oid": "42e75e433fa2627207ce5bafec3330ca0a7ce340"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODozNzoyMVrOFwqmdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODozNzoyMVrOFwqmdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mzk0MA==", "bodyText": "Nice! These tests end up looking really nice.\nI probably would have pushed all the methods now in the view model into the version provider class and kept the view model super thin so that tests wouldn't need Robolectric and to limit the dependence on Android-specific components for paranoia reasons but I do like how all this ends up looking.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386573940", "createdAt": "2020-03-02T18:37:21Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/test/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModelTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class MainMenuViewModelTest {\n+\n+    @Test\n+    public void version_whenRelease_returnsSemanticVersionWithPrefix() {\n+        MainMenuViewModel viewModel = new MainMenuViewModel(() -> \"v1.1.7\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42e75e433fa2627207ce5bafec3330ca0a7ce340"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0cf661c5d683667fc4469b771cea2c9b89242957", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/0cf661c5d683667fc4469b771cea2c9b89242957", "committedDate": "2020-03-04T10:37:46Z", "message": "Use lighter primary color in dark theme"}, "afterCommit": {"oid": "618a2eceeb8e7b62bdf1279f0484353db825ca00", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/618a2eceeb8e7b62bdf1279f0484353db825ca00", "committedDate": "2020-03-04T11:16:23Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e0827cafb284e3116147155b0540280965d944d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5e0827cafb284e3116147155b0540280965d944d", "committedDate": "2020-03-04T11:55:19Z", "message": "Remove tag line and title from Main Menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29da843210d96262a665694b85886e5c94fffc89", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/29da843210d96262a665694b85886e5c94fffc89", "committedDate": "2020-03-04T11:55:19Z", "message": "Use MaterialButtons in MainMenu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d49e0a65441805f6404f54c0be1873e75e22216a", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d49e0a65441805f6404f54c0be1873e75e22216a", "committedDate": "2020-03-04T11:55:19Z", "message": "Use version name to get Main Menu title"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "332d2ad934090b459d025b1ea595dd3f2b0419d3", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/332d2ad934090b459d025b1ea595dd3f2b0419d3", "committedDate": "2020-03-04T11:55:19Z", "message": "Make button style more accessible by removing all caps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "410bd4079a73a8d4e77d5e68a633a4956bd05f8c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/410bd4079a73a8d4e77d5e68a633a4956bd05f8c", "committedDate": "2020-03-04T11:55:20Z", "message": "Use old styles for main menu buttons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de16b10a5caf8a06a9b033c4d805d1bad3b8613d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/de16b10a5caf8a06a9b033c4d805d1bad3b8613d", "committedDate": "2020-03-04T11:55:20Z", "message": "Reduce top button padding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f95bcb0a505deba59a1e560f319e29339595a075", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/f95bcb0a505deba59a1e560f319e29339595a075", "committedDate": "2020-03-04T11:55:20Z", "message": "Remove tests covered by Espresso"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "add6a3eb7f89c31f30a6a13f55893a353bb11553", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/add6a3eb7f89c31f30a6a13f55893a353bb11553", "committedDate": "2020-03-04T11:55:20Z", "message": "Remove unused string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9352530d10a14b105328e34685791ada52e7e9df", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/9352530d10a14b105328e34685791ada52e7e9df", "committedDate": "2020-03-04T11:55:20Z", "message": "Correct app name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd16047c595fbfbeaa9c3ae2d0fa2fc7e6c8a024", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/cd16047c595fbfbeaa9c3ae2d0fa2fc7e6c8a024", "committedDate": "2020-03-04T11:55:20Z", "message": "Move version logic to view model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6502742366ae14e69989b75013a8401f6b2f3f7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b6502742366ae14e69989b75013a8401f6b2f3f7", "committedDate": "2020-03-04T11:55:20Z", "message": "Add version sha to main menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29ff188956a53a4c57deac99c0891081042e232c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/29ff188956a53a4c57deac99c0891081042e232c", "committedDate": "2020-03-04T11:55:20Z", "message": "Use MaterialToolbar on Main Menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55c53a731d03c66c6015617e3d54437764aed8a6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/55c53a731d03c66c6015617e3d54437764aed8a6", "committedDate": "2020-03-04T11:55:20Z", "message": "Include beta in toolbar title"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2026d532f2a0b8f7f30062798cd5bd00099090eb", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/2026d532f2a0b8f7f30062798cd5bd00099090eb", "committedDate": "2020-03-04T11:55:20Z", "message": "Use lighter primary color in dark theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4e64341c3d9a80921c23313df21e465bd4550bf", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b4e64341c3d9a80921c23313df21e465bd4550bf", "committedDate": "2020-03-04T11:55:20Z", "message": "Remove unused imports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "618a2eceeb8e7b62bdf1279f0484353db825ca00", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/618a2eceeb8e7b62bdf1279f0484353db825ca00", "committedDate": "2020-03-04T11:16:23Z", "message": "Remove unused imports"}, "afterCommit": {"oid": "b4e64341c3d9a80921c23313df21e465bd4550bf", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b4e64341c3d9a80921c23313df21e465bd4550bf", "committedDate": "2020-03-04T11:55:20Z", "message": "Remove unused imports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2316, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}