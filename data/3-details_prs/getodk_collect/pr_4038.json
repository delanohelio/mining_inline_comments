{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNDc1NDgy", "number": 4038, "title": "Match exactly tweaks and polish", "bodyText": "Blocked by #4020\nChanges:\n\nUse Material \"Sync problem\" icon for refresh button when there has been an error\nCorrect size of other icons in app bar on form list pages\nUse \"Manual\" instead of \"Manually\" for form mode\nShow a toast when the match exactly sync is successful (and was kicked off manually)\nShow progress bar for a minimum amount of time so on form list pages so it's obvious to the user things are happening\n\nWhat has been done to verify that this works as intended?\nNew tests and verified manually.\nWhy is this the best possible solution? Were any other approaches considered?\nI flipped flopped on showing the toast in the Notifier implementation but eventually decided it was just simpler to have that be a concern of the menu delegate.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nGood to check manual updates for Match Exactly as that's where the most has changed.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-08-24T12:14:08Z", "url": "https://github.com/getodk/collect/pull/4038", "merged": true, "mergeCommit": {"oid": "1b43d20b6587f76bfbfc3251ebff5a4ba4cce4a3"}, "closed": true, "closedAt": "2020-09-04T11:16:54Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCB-GSgBqjM2ODUyNDYyMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdES6TDAFqTQ3ODYyMDgxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0ff5e33ccc11704c7e831789c89544fb8d3472d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e0ff5e33ccc11704c7e831789c89544fb8d3472d", "committedDate": "2020-08-24T11:28:28Z", "message": "Remove assertion with tests at lower level"}, "afterCommit": {"oid": "8cfbc2eab30c2be468368d72bf923b4ec99ef7b6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8cfbc2eab30c2be468368d72bf923b4ec99ef7b6", "committedDate": "2020-08-24T12:41:33Z", "message": "Remove assertion with tests at lower level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8cfbc2eab30c2be468368d72bf923b4ec99ef7b6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8cfbc2eab30c2be468368d72bf923b4ec99ef7b6", "committedDate": "2020-08-24T12:41:33Z", "message": "Remove assertion with tests at lower level"}, "afterCommit": {"oid": "d01d09badf878a11e8816927da326f8ca3432a60", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d01d09badf878a11e8816927da326f8ca3432a60", "committedDate": "2020-08-24T14:08:07Z", "message": "Remove assertion with tests at lower level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d01d09badf878a11e8816927da326f8ca3432a60", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d01d09badf878a11e8816927da326f8ca3432a60", "committedDate": "2020-08-24T14:08:07Z", "message": "Remove assertion with tests at lower level"}, "afterCommit": {"oid": "e76006558db04bb1d839f9f1a42d96fb3a5c323a", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e76006558db04bb1d839f9f1a42d96fb3a5c323a", "committedDate": "2020-08-24T16:12:06Z", "message": "Remove assertion with tests at lower level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e76006558db04bb1d839f9f1a42d96fb3a5c323a", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e76006558db04bb1d839f9f1a42d96fb3a5c323a", "committedDate": "2020-08-24T16:12:06Z", "message": "Remove assertion with tests at lower level"}, "afterCommit": {"oid": "752fa17ffd5712fd6ccb769e95acd144fa743892", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/752fa17ffd5712fd6ccb769e95acd144fa743892", "committedDate": "2020-08-27T16:16:27Z", "message": "Remove assertion with tests at lower level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTAzMzQz", "url": "https://github.com/getodk/collect/pull/4038#pullrequestreview-476903343", "createdAt": "2020-08-27T16:45:59Z", "commit": {"oid": "7a97864df5fc65eb1d3d8a3d8bfcb85dfe437357"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0NTo1OVrOHIYxyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0NTo1OVrOHIYxyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1NjYxOA==", "bodyText": "This ended up not being needed for anything but will be nice to have in the future I think.", "url": "https://github.com/getodk/collect/pull/4038#discussion_r478556618", "createdAt": "2020-08-27T16:45:59Z", "author": {"login": "seadowg"}, "path": "async/src/main/java/org/odk/collect/async/CoroutineAndWorkManagerScheduler.kt", "diffHunk": "@@ -7,13 +7,20 @@ import java.util.function.Consumer\n import java.util.function.Supplier\n import kotlin.coroutines.CoroutineContext\n \n-class CoroutineAndWorkManagerScheduler(private val foreground: CoroutineContext, private val background: CoroutineContext, private val workManager: WorkManager) : Scheduler {\n+class CoroutineAndWorkManagerScheduler(private val foregroundContext: CoroutineContext, private val backgroundContext: CoroutineContext, private val workManager: WorkManager) : Scheduler {\n \n     constructor(workManager: WorkManager) : this(Dispatchers.Main, Dispatchers.IO, workManager) // Needed for Java construction\n \n     override fun <T> immediate(background: Supplier<T>, foreground: Consumer<T>) {\n-        CoroutineScope(this.foreground).launch {\n-            foreground.accept(withContext(this@CoroutineAndWorkManagerScheduler.background) { background.get() })\n+        CoroutineScope(foregroundContext).launch {\n+            val result = withContext(backgroundContext) { background.get() }\n+            foreground.accept(result)\n+        }\n+    }\n+\n+    override fun immediate(foreground: java.lang.Runnable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a97864df5fc65eb1d3d8a3d8bfcb85dfe437357"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTUwMTUx", "url": "https://github.com/getodk/collect/pull/4038#pullrequestreview-476950151", "createdAt": "2020-08-27T17:49:09Z", "commit": {"oid": "6a0cd8785f8e8597c3c06a0d45b28ccd00b07be9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNzo0OToxMFrOHIbAJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODowMjowOVrOHIbcXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU5MzA2Mw==", "bodyText": "While here, can I ask you to change the resource name. \ud83d\ude48", "url": "https://github.com/getodk/collect/pull/4038#discussion_r478593063", "createdAt": "2020-08-27T17:49:10Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/res/values/strings.xml", "diffHunk": "@@ -695,7 +695,7 @@\n     <string name=\"legacy_custom_server_paths_summary\">Will be removed in a future version. Please use /formList and /submission on your server.</string>\n     <string name=\"experimental\">Experimental</string>\n     <string name=\"match_exactly\">Exactly match server</string>\n-    <string name=\"manually\">Manually</string>\n+    <string name=\"manually\">Manual</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a0cd8785f8e8597c3c06a0d45b28ccd00b07be9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYwMDI4Ng==", "bodyText": "How about \"Form update succeeded\" or \"Form update completed successfully\"?", "url": "https://github.com/getodk/collect/pull/4038#discussion_r478600286", "createdAt": "2020-08-27T18:02:09Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/res/values/strings.xml", "diffHunk": "@@ -695,11 +695,12 @@\n     <string name=\"legacy_custom_server_paths_summary\">Will be removed in a future version. Please use /formList and /submission on your server.</string>\n     <string name=\"experimental\">Experimental</string>\n     <string name=\"match_exactly\">Exactly match server</string>\n-    <string name=\"manually\">Manually</string>\n+    <string name=\"manually\">Manual</string>\n     <string name=\"form_update_mode_title\">Blank form update mode</string>\n     <string name=\"previously_downloaded_only\">Previously downloaded forms only</string>\n     <string name=\"form_update_frequency_title\">Automatic update frequency</string>\n     <string name=\"form_update_error\">Form update failed</string>\n     <string name=\"report_to_project_lead\">If you keep having this problem, report it to the person who asked you to collect data.</string>\n     <string name=\"unknown_host_error\">Collect can\\'t reach the server at %s. Did you enter the URL correctly?</string>\n+    <string name=\"form_update_complete\">Form update complete</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a97864df5fc65eb1d3d8a3d8bfcb85dfe437357"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MDI4OTMx", "url": "https://github.com/getodk/collect/pull/4038#pullrequestreview-478028931", "createdAt": "2020-08-28T21:13:04Z", "commit": {"oid": "0bad489c46a6740b3e87428a242037728efb74f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MDc5Nzk0", "url": "https://github.com/getodk/collect/pull/4038#pullrequestreview-478079794", "createdAt": "2020-08-29T00:21:28Z", "commit": {"oid": "0bad489c46a6740b3e87428a242037728efb74f2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c1de462debc37c8c6f6e5c1257eeecfe652ca8d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8c1de462debc37c8c6f6e5c1257eeecfe652ca8d", "committedDate": "2020-08-31T08:20:14Z", "message": "Use sync problem icon for match exactly errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5074f7873d71e3b081350b51ff3254e9ff4f950d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5074f7873d71e3b081350b51ff3254e9ff4f950d", "committedDate": "2020-08-31T08:20:14Z", "message": "Use correctly sized icons for form list menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "520cfafc0bcc3521aea309aa92a1843e5a4e26d6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/520cfafc0bcc3521aea309aa92a1843e5a4e26d6", "committedDate": "2020-08-31T08:20:14Z", "message": "Update form mode text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71e19a09b54eb4977d453ba8048884358adbb5ce", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/71e19a09b54eb4977d453ba8048884358adbb5ce", "committedDate": "2020-08-31T08:20:14Z", "message": "Show toast when manual sync is successful"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "285b0ecc4498a2ee4b919c00b286943107e575c6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/285b0ecc4498a2ee4b919c00b286943107e575c6", "committedDate": "2020-08-31T08:20:14Z", "message": "Make sure match exactly progress bar is visible to user"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92ab8e06f4d5ee19d8e9fd6c35c989863e8b70b6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/92ab8e06f4d5ee19d8e9fd6c35c989863e8b70b6", "committedDate": "2020-08-31T08:20:14Z", "message": "Simplify showing toast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cfde2a4cf1198c5316563d5f23117914b29db3c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/3cfde2a4cf1198c5316563d5f23117914b29db3c", "committedDate": "2020-08-31T08:20:14Z", "message": "Remove assertion with tests at lower level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9392ed093c6c4c3953e06f2fc2738ded5d698a2", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d9392ed093c6c4c3953e06f2fc2738ded5d698a2", "committedDate": "2020-08-31T08:20:14Z", "message": "Update search icon for minimal select dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc38a0967f652062a932a6e56e1f616e91c5189f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/cc38a0967f652062a932a6e56e1f616e91c5189f", "committedDate": "2020-08-31T08:20:15Z", "message": "Rename resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29ec8e98d2aaf508a3c79106343a381789e7fbf1", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/29ec8e98d2aaf508a3c79106343a381789e7fbf1", "committedDate": "2020-08-31T08:20:15Z", "message": "Revise success text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8081696a3e97bc86724c564f501f160b1c44518e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8081696a3e97bc86724c564f501f160b1c44518e", "committedDate": "2020-08-31T08:20:15Z", "message": "Make sure refresh is hidden when search expands"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0bad489c46a6740b3e87428a242037728efb74f2", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/0bad489c46a6740b3e87428a242037728efb74f2", "committedDate": "2020-08-28T17:43:07Z", "message": "Make sure refresh is hidden when search expands"}, "afterCommit": {"oid": "8081696a3e97bc86724c564f501f160b1c44518e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8081696a3e97bc86724c564f501f160b1c44518e", "committedDate": "2020-08-31T08:20:15Z", "message": "Make sure refresh is hidden when search expands"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aca74af4b4597b6fc09e2cf8ca207c635648ca03", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/aca74af4b4597b6fc09e2cf8ca207c635648ca03", "committedDate": "2020-08-31T08:40:27Z", "message": "Only show progress bar for min time when syncing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjIwODE1", "url": "https://github.com/getodk/collect/pull/4038#pullrequestreview-478620815", "createdAt": "2020-08-31T13:34:54Z", "commit": {"oid": "aca74af4b4597b6fc09e2cf8ca207c635648ca03"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2611, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}