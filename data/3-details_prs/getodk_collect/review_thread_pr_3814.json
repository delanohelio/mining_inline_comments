{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NDAxOTI0", "number": 3814, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMToxMjoyMVrOD7Mffw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwOTowOTowN1rOD7-mzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMzk3MjQ3OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadListActivity.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMToxMjoyMVrOGTXv9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDoxMjoxOFrOGUgzwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk2NTIzNw==", "bodyText": "How would you feel about moving all of the analytics logging code to the ViewModel here? Ideally startFormDownload would be a ViewModel method and the analytics would be encapsulated within there but right now we could move logDownloadAnalyticsEvent to the ViewModel and then all the analytics testing/concern could be hidden from the Activity (you might still want a test to check the method is called).", "url": "https://github.com/getodk/collect/pull/3814#discussion_r422965237", "createdAt": "2020-05-11T11:12:21Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadListActivity.java", "diffHunk": "@@ -191,11 +204,10 @@ private void init(Bundle savedInstanceState) {\n \n         downloadButton = findViewById(R.id.add_button);\n         downloadButton.setEnabled(listView.getCheckedItemCount() > 0);\n-        downloadButton.setOnClickListener(new OnClickListener() {\n-            @Override\n-            public void onClick(View v) {\n-                downloadSelectedFiles();\n-            }\n+        downloadButton.setOnClickListener(v -> {\n+            ArrayList<FormDetails> filesToDownload = getFilesToDownload();\n+            logDownloadAnalyticsEvent();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e433628a140df6d945523a80a233bb9223378e4"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MjI0Mg==", "bodyText": "Makes sense. \ud83d\udc4d", "url": "https://github.com/getodk/collect/pull/3814#discussion_r424162242", "createdAt": "2020-05-13T04:12:18Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadListActivity.java", "diffHunk": "@@ -191,11 +204,10 @@ private void init(Bundle savedInstanceState) {\n \n         downloadButton = findViewById(R.id.add_button);\n         downloadButton.setEnabled(listView.getCheckedItemCount() > 0);\n-        downloadButton.setOnClickListener(new OnClickListener() {\n-            @Override\n-            public void onClick(View v) {\n-                downloadSelectedFiles();\n-            }\n+        downloadButton.setOnClickListener(v -> {\n+            ArrayList<FormDetails> filesToDownload = getFilesToDownload();\n+            logDownloadAnalyticsEvent();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk2NTIzNw=="}, "originalCommit": {"oid": "4e433628a140df6d945523a80a233bb9223378e4"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MjE4MzE3OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/FormDownloadListViewModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwOTowOTowN1rOGUohJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwOTowOTowN1rOGUohJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4ODU0OA==", "bodyText": "These methods (getDownloadAnalyticsEvent and getDownloadAnalyticsDescription) feel like they should be private now as they're just used as helpers for logDownloadAnalyticsEvents and don't feel like they should be part of the external interface of the object. That would also mean reworking the tests a bit.", "url": "https://github.com/getodk/collect/pull/3814#discussion_r424288548", "createdAt": "2020-05-13T09:09:07Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/FormDownloadListViewModel.java", "diffHunk": "@@ -207,4 +226,37 @@ public boolean wasLoadingCanceled() {\n     public void setLoadingCanceled(boolean loadingCanceled) {\n         this.loadingCanceled = loadingCanceled;\n     }\n+\n+    public void logDownloadAnalyticsEvent(int downloadedFormCount, String serverUrl) {\n+        String analyticsEvent = getDownloadAnalyticsEvent(downloadedFormCount);\n+        String analyticsDesc = getDownloadAnalyticsDescription(serverUrl);\n+        analytics.logEvent(analyticsEvent, analyticsDesc);\n+    }\n+\n+    String getDownloadAnalyticsEvent(int downloadedFormCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eed1b1e2fd2912b8272183c5ef7d2b813eb8459c"}, "originalPosition": 108}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3339, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}