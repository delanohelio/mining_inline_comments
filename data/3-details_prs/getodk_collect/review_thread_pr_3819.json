{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MzE2Njg5", "number": 3819, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjoyNzo0NlrOD6sxTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjozNTozMVrOD6s7CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODc3NTE3OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjoyNzo0NlrOGSrfJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjoyODo0N1rOGSrhIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MDAzOA==", "bodyText": "I would catch Error here as well it might be needed in some cases like f6bc94e", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422240038", "createdAt": "2020-05-08T16:27:46Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);\n+            mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        } catch (Exception ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9aae77710ed73be9d864fe3ef74651d7e6a7117"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MDU0NQ==", "bodyText": "Good call! We want to account for everything.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422240545", "createdAt": "2020-05-08T16:28:47Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);\n+            mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        } catch (Exception ignored) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MDAzOA=="}, "originalCommit": {"oid": "d9aae77710ed73be9d864fe3ef74651d7e6a7117"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODgwMDA4OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjozNTozMVrOGSruPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQyMTozMjowMFrOGS0X5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw==", "bodyText": "Are you sure this still does the job? I mean the map is not displayed anywhere but it might be required.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422243903", "createdAt": "2020-05-08T16:35:31Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0NTAxOQ==", "bodyText": "Not had a chance to double check yet. I could see that being a problem.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422245019", "createdAt": "2020-05-08T16:37:50Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0NTY0MQ==", "bodyText": "@grzesiek2010 if you have basemaps already ready to go could you check? I don't have anything setup for any of this.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422245641", "createdAt": "2020-05-08T16:39:03Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0Njk0OA==", "bodyText": "Ok will do.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422246948", "createdAt": "2020-05-08T16:41:30Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0Nzg2Mg==", "bodyText": "Thanks!", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422247862", "createdAt": "2020-05-08T16:43:21Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI1MTU2OA==", "bodyText": "Yeah as I thought it doesn't work. It needs to be displayed.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422251568", "createdAt": "2020-05-08T16:50:27Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4NTY4OA==", "bodyText": "Ach really? That's weird. I wonder what part of the View's lifecycle needs to get hit. Definitely possible to inflate and then add this into the view hierarchy though. I'm not going to be able to look at this again tonight though. @lognaturel if this is getting in your way (i.e. you need to look at the app on an emulator) I'd suggest merging this or reverting #3804. Also feel free to push to this if you have a version that retains the fixes from #3804!", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422285688", "createdAt": "2020-05-08T17:58:33Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI5NzgzMA==", "bodyText": "I'll take a look.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422297830", "createdAt": "2020-05-08T18:23:08Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4NTYzNw==", "bodyText": "Ok it's done. I moved the code from the SplashScreen to the MainMenuActivity because once we merge #3813 the SplashScreen won't be displayed by default so the fix also won't work.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422385637", "createdAt": "2020-05-08T21:32:00Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw=="}, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3345, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}