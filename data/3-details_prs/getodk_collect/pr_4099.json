{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NzYzNjQ1", "number": 4099, "title": "Stop server list being cleared on import", "bodyText": "Closes #4093\nWhat has been done to verify that this works as intended?\nVerified manually and added some new tests (the actual import flow is still not tested).\nWhy is this the best possible solution? Were any other approaches considered?\nDefinitely want to follow-up by removing ChangingServerUrlUtils and I think we should redesign the UI for setting up servers so it's more accessible and testable (probably something to think about in Onboarding).\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nGood to check that both importing and adding URLs still works and that they are remembered for both flows.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-09-17T15:47:01Z", "url": "https://github.com/getodk/collect/pull/4099", "merged": true, "mergeCommit": {"oid": "6292e453bdc250514146c272c8d051805c886713"}, "closed": true, "closedAt": "2020-09-21T16:34:03Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJu4IlAH2gAyNDg4NzYzNjQ1OjE0NjlkZjM3MjZlZjgzYWMwNzU2NzU5NzcxYzQ0YzdiNjFiMzZiYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLGDtWgFqTQ5Mjc5MTAwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1469df3726ef83ac0756759771c44c7b61b36bb9", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/1469df3726ef83ac0756759771c44c7b61b36bb9", "committedDate": "2020-09-17T10:59:30Z", "message": "Move test to correct package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76bc5cccc71100e8c8ec8986c6b5ce9461871bb2", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/76bc5cccc71100e8c8ec8986c6b5ce9461871bb2", "committedDate": "2020-09-17T12:01:01Z", "message": "Remove test we no longer need"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b888b3b9d7eb9ef9d53d44f25627549da25799a8", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b888b3b9d7eb9ef9d53d44f25627549da25799a8", "committedDate": "2020-09-17T15:45:25Z", "message": "Save server list in meta preferences so they aren't cleared on import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/a67801d55d866094161029cc4ae47eeb43807639", "committedDate": "2020-09-17T15:53:59Z", "message": "Add migration for server list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNzQ2MTY1", "url": "https://github.com/getodk/collect/pull/4099#pullrequestreview-490746165", "createdAt": "2020-09-17T15:55:17Z", "commit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNTo1NToxN1rOHTpWqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNTo1NToxN1rOHTpWqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2MjUzOA==", "bodyText": "We can follow up with an actual tested implementation (replacing ChangingServerUrlUtils)", "url": "https://github.com/getodk/collect/pull/4099#discussion_r490362538", "createdAt": "2020-09-17T15:55:17Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "diffHunk": "@@ -355,8 +358,23 @@ public PropertyManager providesPropertyManager(Application application, RxEventB\n     }\n \n     @Provides\n-    public SettingsChangeHandler providesSettingsChangeHandler(PropertyManager propertyManager, FormUpdateManager formUpdateManager) {\n-        return new CollectSettingsChangeHandler(propertyManager, formUpdateManager);\n+    public ServerRepository providesServerRepository() {\n+        return new ServerRepository() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNzQ2NjI1", "url": "https://github.com/getodk/collect/pull/4099#pullrequestreview-490746625", "createdAt": "2020-09-17T15:55:46Z", "commit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNTo1NTo0N1rOHTpYEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNTo1NTo0N1rOHTpYEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2Mjg5Nw==", "bodyText": "This is now taken care of by our shared preference change listeners.", "url": "https://github.com/getodk/collect/pull/4099#discussion_r490362897", "createdAt": "2020-09-17T15:55:47Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/preferences/ServerPreferencesFragment.java", "diffHunk": "@@ -280,7 +283,6 @@ public boolean onTouch(View v, MotionEvent event) {\n                         sendAnalyticsEvent(url);\n \n                         preference.setSummary(newValue.toString());\n-                        ChangingServerUrlUtils.addUrlToList(url);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNzYwNzk0", "url": "https://github.com/getodk/collect/pull/4099#pullrequestreview-490760794", "createdAt": "2020-09-17T16:05:52Z", "commit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNjowNTo1MlrOHTp2Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNjowNTo1MlrOHTp2Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM3MDU5OQ==", "bodyText": "This is covered by the regression tests put in place when we found a bunch of broken edge cases. It's really hard to test here and get much value (other than we get from the normal import test).", "url": "https://github.com/getodk/collect/pull/4099#discussion_r490370599", "createdAt": "2020-09-17T16:05:52Z", "author": {"login": "seadowg"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/feature/settings/ConfigureWithQRCodeTest.java", "diffHunk": "@@ -113,23 +113,6 @@ public void clickConfigureQRCode_opensScanner_andThenScanning_importsSettings()\n                 .assertText(\"http://gallops.example\");\n     }\n \n-    @Test\n-    public void clickConfigureQRCode_opensScanner_andThenScanning_whenUsingOldQR_importsSettingsAndMigrates() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTcwNTI4", "url": "https://github.com/getodk/collect/pull/4099#pullrequestreview-491170528", "createdAt": "2020-09-18T05:57:33Z", "commit": {"oid": "a67801d55d866094161029cc4ae47eeb43807639"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2733e6072f1d4494221633df33a19a15bb33969", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e2733e6072f1d4494221633df33a19a15bb33969", "committedDate": "2020-09-21T09:46:15Z", "message": "Reset servers when resetting settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50b544e60a9dceed57c9f8d06403240bd894a0b7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/50b544e60a9dceed57c9f8d06403240bd894a0b7", "committedDate": "2020-09-21T10:00:18Z", "message": "Move tests for ChangingServerUrlUtils to cover ServerRepository implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6fdb24ba0f429cb3956cb0a3ea2f3cb53da9e3d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/f6fdb24ba0f429cb3956cb0a3ea2f3cb53da9e3d", "committedDate": "2020-09-21T10:05:06Z", "message": "Remove ChangingServerUrlUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddb5101cbac4d34b4e9db51513d079d724906f2b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ddb5101cbac4d34b4e9db51513d079d724906f2b", "committedDate": "2020-09-21T10:15:30Z", "message": "Pull dependencies out of SharedPreferencesServerRepository"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNzkxMDAw", "url": "https://github.com/getodk/collect/pull/4099#pullrequestreview-492791000", "createdAt": "2020-09-21T16:33:53Z", "commit": {"oid": "ddb5101cbac4d34b4e9db51513d079d724906f2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2399, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}