{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MTg0MjU3", "number": 3778, "title": "Provide submission summary when tapping a submission on the form map", "bodyText": "Closes #3737\nWhat has been done to verify that this works as intended?\nI tested implemented changes manually.\nWhy is this the best possible solution? Were any other approaches considered?\nThis is what we discussed on the forum https://forum.getodk.org/t/provide-submission-summary-when-tapping-a-submission-on-the-form-map/25957\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nIt just changes the way we deal with submissions visible on a map. Only this functionality might be affected. Now we should see a submission every time we click on a marked instead of opening a form immediately.\nDo we need any specific form for testing your changes? If so, please attach one.\nAny form with geopoints.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-04-16T08:01:39Z", "url": "https://github.com/getodk/collect/pull/3778", "merged": true, "mergeCommit": {"oid": "f7d3814ba8c3c2961369b9dc79a5c12773af6c1b"}, "closed": true, "closedAt": "2020-05-14T14:13:32Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 46, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce6oDPgBqjMzMTIyMjU1MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchNxBxAFqTQxMTgyMTU2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85aaae87b07699639243b8845e49d99e9baf3dcc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/85aaae87b07699639243b8845e49d99e9baf3dcc", "committedDate": "2020-04-16T08:00:30Z", "message": "Display date and status in one row like we do in lists of instances"}, "afterCommit": {"oid": "529df4835c73f47a6785cb32290e818e3233a957", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/529df4835c73f47a6785cb32290e818e3233a957", "committedDate": "2020-05-06T12:35:10Z", "message": "Fixed bug - open read_only form only for review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3eccb99980abe3f75d24d656798bcb4e43b09035", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3eccb99980abe3f75d24d656798bcb4e43b09035", "committedDate": "2020-05-11T16:36:22Z", "message": "Improved submission_summary_layout"}, "afterCommit": {"oid": "0659df5e20dbf0cb50040763e48f893e735cc4f7", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0659df5e20dbf0cb50040763e48f893e735cc4f7", "committedDate": "2020-05-11T18:49:07Z", "message": "Reverted redundant changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0659df5e20dbf0cb50040763e48f893e735cc4f7", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0659df5e20dbf0cb50040763e48f893e735cc4f7", "committedDate": "2020-05-11T18:49:07Z", "message": "Reverted redundant changes"}, "afterCommit": {"oid": "6a283df8be4f761a83fb48f1bedbfcea73210228", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6a283df8be4f761a83fb48f1bedbfcea73210228", "committedDate": "2020-05-11T18:50:22Z", "message": "Reverted redundant changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a283df8be4f761a83fb48f1bedbfcea73210228", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6a283df8be4f761a83fb48f1bedbfcea73210228", "committedDate": "2020-05-11T18:50:22Z", "message": "Reverted redundant changes"}, "afterCommit": {"oid": "fa046b9dc02956e0b2ff7550a733d67821f36bed", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/fa046b9dc02956e0b2ff7550a733d67821f36bed", "committedDate": "2020-05-11T18:52:59Z", "message": "Reverted redundant changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTczMjc4", "url": "https://github.com/getodk/collect/pull/3778#pullrequestreview-409973278", "createdAt": "2020-05-12T12:07:10Z", "commit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjowNzoxMFrOGUDaCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjoxNDoxN1rOGUDpRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MDUyMg==", "bodyText": "I think it's best avoid iconColor and go for Material Theme attributes like colorOnSurface or colorOnPrimary. These let us account for the fact that in some color schemes the icon color would differ depending on where it was rendered.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423680522", "createdAt": "2020-05-12T12:07:10Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/drawable/form_state_finalized.xml", "diffHunk": "@@ -1,20 +1,17 @@\n <vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        android:width=\"40dp\"\n-        android:height=\"40dp\"\n-        android:viewportWidth=\"120\"\n-        android:viewportHeight=\"120\">\n+    android:width=\"40dp\"\n+    android:height=\"40dp\"\n+    android:viewportWidth=\"120\"\n+    android:viewportHeight=\"120\">\n \n     <path\n-            android:pathData=\"M60,60m-60,0a60,60 0,1 1,120 0a60,60 0,1 1,-120 0\"\n-            android:fillColor=\"@color/deep_purple_500\"/>\n+        android:pathData=\"M67.195,26.83h-26.83c-3.688,0 -6.673,2.985 -6.673,6.633L33.66,86.537c0,3.648 2.984,6.634 6.673,6.634L80.61,93.171c3.689,0 6.707,-2.986 6.707,-6.634L87.317,46.732L67.195,26.829zM40.365,86.537L40.365,33.463h23.476L63.841,50.05L80.61,50.05v36.488L40.366,86.538z\"\n+        android:fillColor=\"?iconColor\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MzE1Nw==", "bodyText": "This should use of our Material Theme text appearances (TextAppearance.Collect.X). I'm guessing Headline6 is too big but have a play with it!", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423683157", "createdAt": "2020-05-12T12:11:59Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4Mzk1OA==", "bodyText": "This should be colorOnSurface. primaryTextColor is actually gone on master.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423683958", "createdAt": "2020-05-12T12:13:21Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4NDI1Mg==", "bodyText": "Could we use a text appearance for this as well?", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423684252", "createdAt": "2020-05-12T12:13:56Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />\n+\n+        <View\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"1dp\"\n+            android:layout_marginBottom=\"@dimen/margin_standard\"\n+            android:background=\"?colorPrimary\" />\n+    </LinearLayout>\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n+\n+        <ImageButton\n+            android:id=\"@+id/status_icon\"\n+            android:layout_width=\"30dp\"\n+            android:layout_height=\"30dp\" />\n+\n+        <TextView\n+            android:id=\"@+id/status_text\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4NDQyMg==", "bodyText": "Again using a standard text appearance would be nice!", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423684422", "createdAt": "2020-05-12T12:14:17Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />\n+\n+        <View\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"1dp\"\n+            android:layout_marginBottom=\"@dimen/margin_standard\"\n+            android:background=\"?colorPrimary\" />\n+    </LinearLayout>\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n+\n+        <ImageButton\n+            android:id=\"@+id/status_icon\"\n+            android:layout_width=\"30dp\"\n+            android:layout_height=\"30dp\" />\n+\n+        <TextView\n+            android:id=\"@+id/status_text\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\"\n+            android:layout_marginStart=\"@dimen/margin_standard\"\n+            android:layout_gravity=\"center_vertical\"/>\n+\n+    </LinearLayout>\n+\n+    <com.google.android.material.chip.Chip\n+        android:id=\"@+id/openFormChip\"\n+        android:visibility=\"gone\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginTop=\"@dimen/margin_small\"\n+        android:textColor=\"@android:color/white\"\n+        app:chipBackgroundColor=\"?colorSecondary\"\n+        app:iconStartPadding=\"@dimen/margin_small\"\n+        app:chipEndPadding=\"@dimen/margin_small\"/>\n+\n+    <TextView\n+        android:id=\"@+id/info\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f577f4ef7cfce2022415383eab4f27b89d0bcbd8", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f577f4ef7cfce2022415383eab4f27b89d0bcbd8", "committedDate": "2020-05-12T12:37:52Z", "message": "Added submission_summary_layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8462b91570cf3e806e2cd6564c0497058f3fb29", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a8462b91570cf3e806e2cd6564c0497058f3fb29", "committedDate": "2020-05-12T12:37:52Z", "message": "Improved instance_map_layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70030276c7bd4795e6cbf0ea9ec59c08af35f09a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/70030276c7bd4795e6cbf0ea9ec59c08af35f09a", "committedDate": "2020-05-12T12:37:52Z", "message": "Improved submission_summary_layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "839c6e9a74792d1f246a3baed7592aff45a2c4d2", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/839c6e9a74792d1f246a3baed7592aff45a2c4d2", "committedDate": "2020-05-12T12:42:31Z", "message": "Added required icons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46a4c7024bcea38622973b264b15b849f2212714", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/46a4c7024bcea38622973b264b15b849f2212714", "committedDate": "2020-05-12T12:42:31Z", "message": "Show bottom sheet after clicking on a marker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58df006cd7a6cd2237ad19a5cd7a3f82ee32445c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/58df006cd7a6cd2237ad19a5cd7a3f82ee32445c", "committedDate": "2020-05-12T12:42:31Z", "message": "Center the selected marker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79413390da05235b9707aa27ac82e7a83292379e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/79413390da05235b9707aa27ac82e7a83292379e", "committedDate": "2020-05-12T12:42:31Z", "message": "Removed unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24aae6d010c5333c465d0207a4d72aad8e0040fc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/24aae6d010c5333c465d0207a4d72aad8e0040fc", "committedDate": "2020-05-12T12:42:31Z", "message": "Display date and status in one row like we do in lists of instances"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68d2d48901305e0512717af1e05c001804053890", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/68d2d48901305e0512717af1e05c001804053890", "committedDate": "2020-05-12T12:42:31Z", "message": "Replaced FAB with a Chip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90838f629e010cc54793b2a8a4a9be3c44778be7", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/90838f629e010cc54793b2a8a4a9be3c44778be7", "committedDate": "2020-05-12T12:42:31Z", "message": "Fixed bug - open read_only form only for review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba7242f842212f6ece2ac332ca508a6973d02073", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ba7242f842212f6ece2ac332ca508a6973d02073", "committedDate": "2020-05-12T12:42:31Z", "message": "Added missing test props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b422ab5c986d8df9000ddd7097e70f0b8d88d82a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b422ab5c986d8df9000ddd7097e70f0b8d88d82a", "committedDate": "2020-05-12T12:42:31Z", "message": "Fixed naming bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31b9af53c74baecf1306fd7a5d5bcd36e3d95a11", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/31b9af53c74baecf1306fd7a5d5bcd36e3d95a11", "committedDate": "2020-05-12T12:42:31Z", "message": "Improved submission_summary_layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c275496e1ae723016e22fcc07f6a83451b941f31", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c275496e1ae723016e22fcc07f6a83451b941f31", "committedDate": "2020-05-12T12:42:31Z", "message": "Refactored BottomSheet to BottomSheetDialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9367b2c776b608b52eb491a169fceb35e535a89", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a9367b2c776b608b52eb491a169fceb35e535a89", "committedDate": "2020-05-12T12:42:31Z", "message": "Fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "772049cd53f17ef6fd4687bc58eea5978c8f604d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/772049cd53f17ef6fd4687bc58eea5978c8f604d", "committedDate": "2020-05-12T12:42:31Z", "message": "Fixed code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5526e5fa47369d0df393dfa0789c6359b57fb2c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d5526e5fa47369d0df393dfa0789c6359b57fb2c", "committedDate": "2020-05-12T12:42:31Z", "message": "Reverted redundant changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99ab7fe9121c11e5cb5df43abe922eee169a1b43", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/99ab7fe9121c11e5cb5df43abe922eee169a1b43", "committedDate": "2020-05-12T12:42:31Z", "message": "Added displeying the summary dialog for encrypted and deleted forms ans well to keep consistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e8b28ecf43ebb8e9fb7be8303a6a20a5793b221", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7e8b28ecf43ebb8e9fb7be8303a6a20a5793b221", "committedDate": "2020-05-12T12:42:31Z", "message": "Dismiss dialog after opening a form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bae9c24945565cd1fe16cfcfdc266a66fcf7afaa", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bae9c24945565cd1fe16cfcfdc266a66fcf7afaa", "committedDate": "2020-05-12T12:42:31Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c78309938b7ad2a2eb8a71ff9b55e2d1441ff23", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6c78309938b7ad2a2eb8a71ff9b55e2d1441ff23", "committedDate": "2020-05-12T12:42:31Z", "message": "Code improvements in order to use FormMapViewModel in InstanceSummaryDialogFragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d82268ee7acf208e0bf5554a34245656b0dcf7c0", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d82268ee7acf208e0bf5554a34245656b0dcf7c0", "committedDate": "2020-05-12T12:42:31Z", "message": "Fixed comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b7079d5c1049e7681ce284dc0e645da51542999", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0b7079d5c1049e7681ce284dc0e645da51542999", "committedDate": "2020-05-12T12:42:31Z", "message": "Factored out getSubmissionSummaryStatusIcon to IconUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f40e57d282fbf0842cafad2ed81f0e5b83e33e05", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f40e57d282fbf0842cafad2ed81f0e5b83e33e05", "committedDate": "2020-05-12T12:42:31Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c09cb2c1af0775e69b12171e9352c87225a4ace9", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c09cb2c1af0775e69b12171e9352c87225a4ace9", "committedDate": "2020-05-12T12:42:31Z", "message": "Use showIfNotShowing to display InstanceSummaryDialogFragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "395958e5eebc9ec6bf72fa98a7587e551931771d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/395958e5eebc9ec6bf72fa98a7587e551931771d", "committedDate": "2020-05-12T12:42:31Z", "message": "Fixed status icon size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "835ed3ed3bcd0de80efa8231999e03f16af90abd", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/835ed3ed3bcd0de80efa8231999e03f16af90abd", "committedDate": "2020-05-12T12:42:31Z", "message": "Code improvements - use just instanceId in InstanceSummaryDialogFragment to build it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16fb8755013e77f051ccf0c4f607465ee543a2cf", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/16fb8755013e77f051ccf0c4f607465ee543a2cf", "committedDate": "2020-05-12T12:54:41Z", "message": "Layout improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff35c349f9821c76d5ee9de0d8d3dd21adb8a769", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ff35c349f9821c76d5ee9de0d8d3dd21adb8a769", "committedDate": "2020-05-12T12:34:41Z", "message": "Code improvements - use just instanceId in InstanceSummaryDialogFragment to build it"}, "afterCommit": {"oid": "16fb8755013e77f051ccf0c4f607465ee543a2cf", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/16fb8755013e77f051ccf0c4f607465ee543a2cf", "committedDate": "2020-05-12T12:54:41Z", "message": "Layout improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/54702100a73b76ffcfca67d730e4f4b7b743881c", "committedDate": "2020-05-12T16:29:55Z", "message": "Fixed tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74e62508bb72aa6824b6ae18ed646235cfbcdd4c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/74e62508bb72aa6824b6ae18ed646235cfbcdd4c", "committedDate": "2020-05-12T16:17:10Z", "message": "Fixed tests"}, "afterCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/54702100a73b76ffcfca67d730e4f4b7b743881c", "committedDate": "2020-05-12T16:29:55Z", "message": "Fixed tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTYyMTAx", "url": "https://github.com/getodk/collect/pull/3778#pullrequestreview-410562101", "createdAt": "2020-05-13T03:24:50Z", "commit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMzoyNDo1MFrOGUgKKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMzozMzoxN1rOGUgRMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1MTU5Mw==", "bodyText": "It doesn't make sense to have both onFeatureClicked and showSummary since they have the same parameters and showSummary is only called from here. I'd keep onFeatureClicked and move the code here but you could also rename it to showSummary if you think that's clearer.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424151593", "createdAt": "2020-05-13T03:24:50Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormMapActivity.java", "diffHunk": "@@ -223,47 +216,10 @@ public void onLocationChanged(MapPoint point) {\n     }\n \n     /**\n-     * Reacts to a tap on a feature by showing a toast or switching activities to view or edit a form.\n+     * Reacts to a tap on a feature by showing a submission summary.\n      */\n     public void onFeatureClicked(int featureId) {\n-        MappableFormInstance instance = instancesByFeatureId.get(featureId);\n-        ClickAction clickAction = instance == null ? FormMapViewModel.ClickAction.NONE : instance.getClickAction();\n-\n-        boolean canEditSaved = (Boolean) AdminSharedPreferences.getInstance().get(AdminKeys.KEY_EDIT_SAVED);\n-\n-        switch (clickAction) {\n-            case DELETED_TOAST:\n-                String deletedTime = getString(R.string.deleted_on_date_at_time);\n-                String disabledMessage = new SimpleDateFormat(deletedTime,\n-                        Locale.getDefault()).format(viewModel.getDeletedDateOf(instance.getDatabaseId()));\n-\n-                ToastUtils.showLongToast(disabledMessage);\n-                break;\n-            case NOT_VIEWABLE_TOAST:\n-                ToastUtils.showLongToast(R.string.cannot_edit_completed_form);\n-                break;\n-            case OPEN_READ_ONLY:\n-                startActivity(getViewOnlyFormInstanceIntentFor(featureId));\n-                break;\n-            case OPEN_EDIT:\n-                if (canEditSaved) {\n-                    startActivity(getEditFormInstanceIntentFor(featureId));\n-                } else {\n-                    startActivity(getViewOnlyFormInstanceIntentFor(featureId));\n-                }\n-                break;\n-        }\n-    }\n-\n-    private Intent getEditFormInstanceIntentFor(int featureId) {\n-        Uri uri = ContentUris.withAppendedId(InstanceColumns.CONTENT_URI, instancesByFeatureId.get(featureId).getDatabaseId());\n-        return new Intent(Intent.ACTION_EDIT, uri);\n-    }\n-\n-    private Intent getViewOnlyFormInstanceIntentFor(int featureId) {\n-        Intent intent = getEditFormInstanceIntentFor(featureId);\n-        intent.putExtra(ApplicationConstants.BundleKeys.FORM_MODE, ApplicationConstants.FormModes.VIEW_SENT);\n-        return intent;\n+        showSummary(featureId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1Mjk5NA==", "bodyText": "This is much better and I guess that if truly only necessary data is being saved continuing to use onSaveInstanceState is not so bad.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424152994", "createdAt": "2020-05-13T03:31:25Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/fragments/dialogs/InstanceSummaryDialogFragment.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package org.odk.collect.android.fragments.dialogs;\n+\n+import android.content.ContentUris;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.net.Uri;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ImageView;\n+import android.widget.TextView;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.content.ContextCompat;\n+import androidx.lifecycle.ViewModelProviders;\n+\n+import com.google.android.material.bottomsheet.BottomSheetDialogFragment;\n+import com.google.android.material.chip.Chip;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.viewmodels.FormMapViewModel;\n+import org.odk.collect.android.preferences.AdminKeys;\n+import org.odk.collect.android.preferences.AdminSharedPreferences;\n+import org.odk.collect.android.provider.InstanceProvider;\n+import org.odk.collect.android.provider.InstanceProviderAPI;\n+import org.odk.collect.android.utilities.ApplicationConstants;\n+import org.odk.collect.android.utilities.IconUtils;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Locale;\n+\n+import butterknife.BindView;\n+import butterknife.ButterKnife;\n+\n+public class InstanceSummaryDialogFragment extends BottomSheetDialogFragment {\n+    public static final String INSTANCE_ID = \"instanceId\";\n+\n+    private long instanceId;\n+\n+    private FormMapViewModel viewModel;\n+\n+    @BindView(R.id.submission_name)\n+    public TextView submissionName;\n+\n+    @BindView(R.id.status_icon)\n+    public ImageView statusIcon;\n+\n+    @BindView(R.id.status_text)\n+    public TextView statusText;\n+\n+    @BindView(R.id.info)\n+    public TextView infoText;\n+\n+    @BindView(R.id.openFormChip)\n+    public Chip openFormChip;\n+\n+    @Override\n+    public void onAttach(@NonNull Context context) {\n+        super.onAttach(context);\n+        viewModel = ViewModelProviders.of(requireActivity()).get(FormMapViewModel.class);\n+    }\n+\n+    @Nullable\n+    @Override\n+    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n+        View view = inflater.inflate(R.layout.submission_summary_layout, container, false);\n+        ButterKnife.bind(this, view);\n+        return view;\n+    }\n+\n+    @Override\n+    public void onSaveInstanceState(Bundle outState) {\n+        outState.putLong(INSTANCE_ID, instanceId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1MzM5Mw==", "bodyText": "Doing a sequential search here could be slow if there are lots of instances. I might have considered saving the database id to make this lookup fast. It's probably not that important to do now but wanted to flag it for future consideration.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424153393", "createdAt": "2020-05-13T03:33:17Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/FormMapViewModel.java", "diffHunk": "@@ -99,6 +102,15 @@ private void initializeFormInstances() {\n         return mappableFormInstances;\n     }\n \n+    public MappableFormInstance getInstanceById(long instanceId) {\n+        for (MappableFormInstance mappableFormInstance : mappableFormInstances) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7421e589f4312131509518c941523f730608adbe", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7421e589f4312131509518c941523f730608adbe", "committedDate": "2020-05-13T08:15:17Z", "message": "Removed redundant method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "471a4d8351aba5eb99c3d860ce0efb55b12f65f6", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/471a4d8351aba5eb99c3d860ce0efb55b12f65f6", "committedDate": "2020-05-13T09:38:54Z", "message": "Converted BottomSheetDialogFragment to BottomSheetBehavior"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4708bf38b15ed3fe21d29a7cd436d1f8ef14305f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4708bf38b15ed3fe21d29a7cd436d1f8ef14305f", "committedDate": "2020-05-13T09:31:05Z", "message": "Converted BottomSheetDialogFragment to BottomSheetBehavior"}, "afterCommit": {"oid": "471a4d8351aba5eb99c3d860ce0efb55b12f65f6", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/471a4d8351aba5eb99c3d860ce0efb55b12f65f6", "committedDate": "2020-05-13T09:38:54Z", "message": "Converted BottomSheetDialogFragment to BottomSheetBehavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d055c812842a0c15d443eef5844982743bcb5577", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d055c812842a0c15d443eef5844982743bcb5577", "committedDate": "2020-05-13T10:23:23Z", "message": "Fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8871e9aaf5f14c38a3f974551e2b6d28e577c6ea", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/8871e9aaf5f14c38a3f974551e2b6d28e577c6ea", "committedDate": "2020-05-13T12:26:02Z", "message": "Added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abd9bd561384cdef7cd467999cdd3f561d2ab203", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/abd9bd561384cdef7cd467999cdd3f561d2ab203", "committedDate": "2020-05-13T12:29:20Z", "message": "Enable animation when centering map after tapping on a marker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42a972114fd8b1d8e47f52677384f289bc923526", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/42a972114fd8b1d8e47f52677384f289bc923526", "committedDate": "2020-05-13T14:19:59Z", "message": "Hide the bottomSheet after opening a form"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjk4OTA0", "url": "https://github.com/getodk/collect/pull/3778#pullrequestreview-411298904", "createdAt": "2020-05-13T21:05:30Z", "commit": {"oid": "42a972114fd8b1d8e47f52677384f289bc923526"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExODIxNTY4", "url": "https://github.com/getodk/collect/pull/3778#pullrequestreview-411821568", "createdAt": "2020-05-14T13:47:54Z", "commit": {"oid": "42a972114fd8b1d8e47f52677384f289bc923526"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2660, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}