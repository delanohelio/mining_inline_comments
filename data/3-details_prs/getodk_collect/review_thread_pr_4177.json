{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2NzE1NzY3", "number": 4177, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTowOTozMFrOEyP53Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMjoyNzoxNlrOEzRjPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTI0ODI5OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTowOTozMFrOHox4kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOToxOTo1NlrOHoyS1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyMjM4Ng==", "bodyText": "This might cause NPE. Please add a null check here.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512522386", "createdAt": "2020-10-27T09:09:30Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,26 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is store/restored.\n+     * @author Khuong Ninh (khuong.ninh@it-development.com)\n+     */\n     public static void execute(String imagePath, QuestionWidget questionWidget, Context context) {\n+        ExifInterface exif = null;\n+        try {\n+            exif = new ExifInterface(imagePath);\n+        } catch (IOException e) {\n+            Timber.w(e);\n+        }\n+\n         rotateImageIfNeeded(imagePath);\n         scaleDownImageIfNeeded(imagePath, questionWidget, context);\n+        \n+        try {\n+            exif.saveAttributes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7de0e3340344aeec4e9ba0bb06f66c2084e70828"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyOTExMA==", "bodyText": "Thank you, @grzesiek2010 ,\nI have updated the code to avoid NPE as you suggested.\nPlease kindly review", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512529110", "createdAt": "2020-10-27T09:19:56Z", "author": {"login": "ItloMd9"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,26 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is store/restored.\n+     * @author Khuong Ninh (khuong.ninh@it-development.com)\n+     */\n     public static void execute(String imagePath, QuestionWidget questionWidget, Context context) {\n+        ExifInterface exif = null;\n+        try {\n+            exif = new ExifInterface(imagePath);\n+        } catch (IOException e) {\n+            Timber.w(e);\n+        }\n+\n         rotateImageIfNeeded(imagePath);\n         scaleDownImageIfNeeded(imagePath, questionWidget, context);\n+        \n+        try {\n+            exif.saveAttributes();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyMjM4Ng=="}, "originalCommit": {"oid": "7de0e3340344aeec4e9ba0bb06f66c2084e70828"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTI1MjU5OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOToxMDozM1rOHox7Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOToyMDoxOVrOHoyTvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyMzA1OQ==", "bodyText": "Should be: stored/restored (d missing).", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512523059", "createdAt": "2020-10-27T09:10:33Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,26 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is store/restored.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7de0e3340344aeec4e9ba0bb06f66c2084e70828"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyOTM0Mw==", "bodyText": "Comment has been updated, please kindly review", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512529343", "createdAt": "2020-10-27T09:20:19Z", "author": {"login": "ItloMd9"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,26 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is store/restored.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyMzA1OQ=="}, "originalCommit": {"oid": "7de0e3340344aeec4e9ba0bb06f66c2084e70828"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTI2MTU4OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOToxMjo1NVrOHoyA9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzozNToxNlrOHqcEOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyNDUzNA==", "bodyText": "Could this maybe align with how you named it in the comment above (store/restore)? I mean this could be in a separate method called storeExifAttributes() and the code below also could be in a separate method called restoreExifAttributes() then the code would be cleaner.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512524534", "createdAt": "2020-10-27T09:12:55Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,26 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is store/restored.\n+     * @author Khuong Ninh (khuong.ninh@it-development.com)\n+     */\n     public static void execute(String imagePath, QuestionWidget questionWidget, Context context) {\n+        ExifInterface exif = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7de0e3340344aeec4e9ba0bb06f66c2084e70828"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzMjUwMw==", "bodyText": "For simplicity's sake, I would avoid extra unnecessary methods/functions' overhead which (in this case) only fetch exif from an image path via constructor and then save it back via built-in function (saveAttributes) to the same old path.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512532503", "createdAt": "2020-10-27T09:25:01Z", "author": {"login": "ItloMd9"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,26 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is store/restored.\n+     * @author Khuong Ninh (khuong.ninh@it-development.com)\n+     */\n     public static void execute(String imagePath, QuestionWidget questionWidget, Context context) {\n+        ExifInterface exif = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyNDUzNA=="}, "originalCommit": {"oid": "7de0e3340344aeec4e9ba0bb06f66c2084e70828"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI2MjA3NQ==", "bodyText": "generally i like more my approach but I'm not going to insist let's keep it as is.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r514262075", "createdAt": "2020-10-29T13:35:16Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,26 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is store/restored.\n+     * @author Khuong Ninh (khuong.ninh@it-development.com)\n+     */\n     public static void execute(String imagePath, QuestionWidget questionWidget, Context context) {\n+        ExifInterface exif = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUyNDUzNA=="}, "originalCommit": {"oid": "7de0e3340344aeec4e9ba0bb06f66c2084e70828"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMTM2MDMwOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTozNzoyMFrOHoy-uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMToxMTo1MFrOHo22Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0MDM0NQ==", "bodyText": "Would you like to add a test? It should be straightforward because we have this function in ImageConverterTest:\n    private void saveTestBitmap(int width, int height, Integer orientation) {\n        Bitmap bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.RGB_565);\n        FileUtils.saveBitmapToFile(bitmap, TEST_IMAGE_PATH);\n\n        if (orientation != null) {\n            try {\n                ExifInterface exifInterface = new ExifInterface(TEST_IMAGE_PATH);\n                exifInterface.setAttribute(ExifInterface.TAG_ORIENTATION, String.valueOf(orientation));\n                exifInterface.saveAttributes();\n            } catch (IOException e) {\n                Timber.w(e);\n            }\n        }\n    }\n\nwhich we use for testing ImageConverter.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512540345", "createdAt": "2020-10-27T09:37:20Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,28 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is stored/restored.\n+     * @author Khuong Ninh (khuong.ninh@it-development.com)\n+     */\n     public static void execute(String imagePath, QuestionWidget questionWidget, Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bd30f527f12705e869e0056ed33208b8692345f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwMzc1MA==", "bodyText": "I have added 1 test to check if exif data is removed after ImageConvert.execute() is invoked.\nPlease kindly review.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r512603750", "createdAt": "2020-10-27T11:11:50Z", "author": {"login": "ItloMd9"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/ImageConverter.java", "diffHunk": "@@ -39,9 +39,28 @@\n     private ImageConverter() {\n     }\n \n+    /**\n+     * Before proceed with scaling or rotating, make sure existing exif information is stored/restored.\n+     * @author Khuong Ninh (khuong.ninh@it-development.com)\n+     */\n     public static void execute(String imagePath, QuestionWidget questionWidget, Context context) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0MDM0NQ=="}, "originalCommit": {"oid": "4bd30f527f12705e869e0056ed33208b8692345f"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMjAwMzgyOnYy", "diffSide": "RIGHT", "path": "collect_app/src/androidTest/java/org/odk/collect/android/instrumented/utilities/ImageConverterTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMjoyNzoxNlrOHqZbew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzozMzoxMVrOHqb-TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIxODg3NQ==", "bodyText": "Does this test work for you locally? I tried on various android versions and the result is:\njunit.framework.ComparisonFailure: expected:<ApertureValue_value> but was:<null>\nat junit.framework.Assert.assertEquals(Assert.java:85)\nat junit.framework.Assert.assertEquals(Assert.java:91)\nat org.odk.collect.android.instrumented.utilities.ImageConverterTest.keepExifTest1AfterScaleAndRotation(ImageConverterTest.java:426)\nat java.lang.reflect.Method.invoke(Native Method)\nat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\nat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\nat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\nat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\nat androidx.test.internal.runner.junit4.statement.RunBefores.evaluate(RunBefores.java:80)\nat org.odk.collect.android.support.ResetStateRule$ResetStateStatement.evaluate(ResetStateRule.java:71)", "url": "https://github.com/getodk/collect/pull/4177#discussion_r514218875", "createdAt": "2020-10-29T12:27:16Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/instrumented/utilities/ImageConverterTest.java", "diffHunk": "@@ -382,6 +383,51 @@ public void scaleImageToNewWidthTest() {\n         assertEquals(1250, image.getHeight());\n     }\n \n+    @Test\n+    public void keepExifTest1AfterScaleAndRotation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a232cffca15e2e35815adc0c4f67b07672f67d6c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIyOTQyNQ==", "bodyText": "Not only locally I ran it on firebase test lab and the result is the same.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r514229425", "createdAt": "2020-10-29T12:45:04Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/instrumented/utilities/ImageConverterTest.java", "diffHunk": "@@ -382,6 +383,51 @@ public void scaleImageToNewWidthTest() {\n         assertEquals(1250, image.getHeight());\n     }\n \n+    @Test\n+    public void keepExifTest1AfterScaleAndRotation() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIxODg3NQ=="}, "originalCommit": {"oid": "a232cffca15e2e35815adc0c4f67b07672f67d6c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI0MzYwNA==", "bodyText": "I'll take a look at it unless you are already fixing the test.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r514243604", "createdAt": "2020-10-29T13:07:36Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/instrumented/utilities/ImageConverterTest.java", "diffHunk": "@@ -382,6 +383,51 @@ public void scaleImageToNewWidthTest() {\n         assertEquals(1250, image.getHeight());\n     }\n \n+    @Test\n+    public void keepExifTest1AfterScaleAndRotation() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIxODg3NQ=="}, "originalCommit": {"oid": "a232cffca15e2e35815adc0c4f67b07672f67d6c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI2MDU1Nw==", "bodyText": "Ok I pushed one commit to your branch with fixes.", "url": "https://github.com/getodk/collect/pull/4177#discussion_r514260557", "createdAt": "2020-10-29T13:33:11Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/instrumented/utilities/ImageConverterTest.java", "diffHunk": "@@ -382,6 +383,51 @@ public void scaleImageToNewWidthTest() {\n         assertEquals(1250, image.getHeight());\n     }\n \n+    @Test\n+    public void keepExifTest1AfterScaleAndRotation() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIxODg3NQ=="}, "originalCommit": {"oid": "a232cffca15e2e35815adc0c4f67b07672f67d6c"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3134, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}