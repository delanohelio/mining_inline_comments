{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMzQxODI3", "number": 4035, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToxNzoyNVrOEbefvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToyMTowM1rOEbelSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MjQ2NjU0OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToxNzoyNVrOHFbZUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMToyNzozMlrOHFgOHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ1Mzc3OQ==", "bodyText": "I think we could avoid the array initialization here with an if-else on the formMediaPath != null and just returning emptyList in the else case. The new File[0] going into the asList confused me.", "url": "https://github.com/getodk/collect/pull/4035#discussion_r475453779", "createdAt": "2020-08-24T09:17:25Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "diffHunk": "@@ -12,7 +12,10 @@\n     @Override\n     public List<File> getAll(String jrFormID, String formVersion) {\n         String formMediaPath = new FormsDao().getFormMediaPath(jrFormID, formVersion);\n-        File[] files = new File(formMediaPath).listFiles();\n+        File[] files = new File[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7ef4f8611c727f75c1ef969d8e128338784a5a5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMjgyOQ==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/4035#discussion_r475532829", "createdAt": "2020-08-24T11:27:32Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "diffHunk": "@@ -12,7 +12,10 @@\n     @Override\n     public List<File> getAll(String jrFormID, String formVersion) {\n         String formMediaPath = new FormsDao().getFormMediaPath(jrFormID, formVersion);\n-        File[] files = new File(formMediaPath).listFiles();\n+        File[] files = new File[0];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ1Mzc3OQ=="}, "originalCommit": {"oid": "b7ef4f8611c727f75c1ef969d8e128338784a5a5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MjQ4MDc1OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToyMTowM1rOHFbh3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMToyNzozOFrOHFgOSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ1NTk2NA==", "bodyText": "I think we need a test to drive this out so we avoid regressing at any point. As far as I can see the situation that gives us the NPE (for the previous code) was if getAll was queried for a jrFormID and formVersion not in the database. If that's right we could have a DatabaseMediaFileRepositoryTest similar to the DatabaseFormRepositoryTest and a test that just checks we get back an empty list when there is nothing in the database.", "url": "https://github.com/getodk/collect/pull/4035#discussion_r475455964", "createdAt": "2020-08-24T09:21:03Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "diffHunk": "@@ -12,7 +12,10 @@\n     @Override\n     public List<File> getAll(String jrFormID, String formVersion) {\n         String formMediaPath = new FormsDao().getFormMediaPath(jrFormID, formVersion);\n-        File[] files = new File(formMediaPath).listFiles();\n+        File[] files = new File[0];\n+        if (formMediaPath != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7ef4f8611c727f75c1ef969d8e128338784a5a5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUzMjg3Mg==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/4035#discussion_r475532872", "createdAt": "2020-08-24T11:27:38Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "diffHunk": "@@ -12,7 +12,10 @@\n     @Override\n     public List<File> getAll(String jrFormID, String formVersion) {\n         String formMediaPath = new FormsDao().getFormMediaPath(jrFormID, formVersion);\n-        File[] files = new File(formMediaPath).listFiles();\n+        File[] files = new File[0];\n+        if (formMediaPath != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ1NTk2NA=="}, "originalCommit": {"oid": "b7ef4f8611c727f75c1ef969d8e128338784a5a5"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3280, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}