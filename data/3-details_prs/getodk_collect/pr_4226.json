{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMTYzMjE5", "number": 4226, "title": "Trust root certificate that will root all certs issued by Let's Encrypt after Sept 2021", "bodyText": "Closes #4219\nWhat has been done to verify that this works as intended?\nThis PR affects Android 5.1-7.1. There are separate fixes for Android 5.1-6.0 and Android 7.0-7.1. I verified by configuring the server to https://valid-isrgrootx1.letsencrypt.org. Prior to the fix, when I did \"Get Blank Form\", I would get no results because there was a security error. After the fix, I get an error about not being able to reach the server (because it's not an ODK server).\nWhy is this the best possible solution? Were any other approaches considered?\nDiscussed with Let's Encrypt community and an OkHTTP maintainer at https://community.letsencrypt.org/t/mobile-client-workarounds-for-isrg-issue/137807. The OKHttp fix works for all Android versions but it is potentially inefficient if there are many system-level certs specified. It also doesn't work for webviews. That makes it still worthwhile to use the network-security-config for API 24/25.\nThe fix applied for API <= 23 is tested at https://github.com/square/okhttp/pull/6423/files. I don't see any reasonable test for us to write.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nIt should just allow users to seamlessly keep connecting to servers that use Let's Encrypt certs. This does touch how OkHTTP is initialized so there could be a risk to all network connections. However, it's mitigated by the fact that it only applies for API <= 23 and that issues should be really easy to spot (nothing would work).\nDo we need any specific form for testing your changes? If so, please attach one.\nNo.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-11-17T06:03:18Z", "url": "https://github.com/getodk/collect/pull/4226", "merged": true, "mergeCommit": {"oid": "75e9089a97b22fbda7256b779f846a0277f9f385"}, "closed": true, "closedAt": "2020-11-23T19:33:40Z", "author": {"login": "lognaturel"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddclLDgBqjQwMDY1Mjg4NzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeHJEKABqjQwMTczMzE3OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88a974847e788b999e793faf3368f7e2b0856448", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/88a974847e788b999e793faf3368f7e2b0856448", "committedDate": "2020-11-17T05:57:33Z", "message": "Trust Let's Encrypt root for Android <= 6.0"}, "afterCommit": {"oid": "ad959cd871409b85474eedfcc1b354bbe0467844", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/ad959cd871409b85474eedfcc1b354bbe0467844", "committedDate": "2020-11-17T16:58:49Z", "message": "Trust Let's Encrypt root for Android <= 6.0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjA4MzIz", "url": "https://github.com/getodk/collect/pull/4226#pullrequestreview-532608323", "createdAt": "2020-11-17T17:19:44Z", "commit": {"oid": "ad959cd871409b85474eedfcc1b354bbe0467844"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxOTo0NFrOH1AYnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxOTo0NFrOH1AYnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0Mjg3OQ==", "bodyText": "This and the network_security_config should be in collect_app right?", "url": "https://github.com/getodk/collect/pull/4226#discussion_r525342879", "createdAt": "2020-11-17T17:19:44Z", "author": {"login": "seadowg"}, "path": "audiorecorder/src/main/res/raw/isrgrootx1.pem", "diffHunk": "@@ -0,0 +1,31 @@\n+-----BEGIN CERTIFICATE-----", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad959cd871409b85474eedfcc1b354bbe0467844"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad959cd871409b85474eedfcc1b354bbe0467844", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/ad959cd871409b85474eedfcc1b354bbe0467844", "committedDate": "2020-11-17T16:58:49Z", "message": "Trust Let's Encrypt root for Android <= 6.0"}, "afterCommit": {"oid": "fefb44cac51814c043ecefeaa17063646904799b", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/fefb44cac51814c043ecefeaa17063646904799b", "committedDate": "2020-11-17T17:36:52Z", "message": "Trust Let's Encrypt root for Android <= 6.0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjM1NTQz", "url": "https://github.com/getodk/collect/pull/4226#pullrequestreview-532635543", "createdAt": "2020-11-17T17:48:23Z", "commit": {"oid": "fefb44cac51814c043ecefeaa17063646904799b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a44eefaa0634a7e3364976c3e67b7eeb623dca0", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/2a44eefaa0634a7e3364976c3e67b7eeb623dca0", "committedDate": "2020-11-19T18:34:01Z", "message": "Trust Let's Encrypt root for Android 7.0, 7.1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "960c39c1616f6ab23386fbbfc89ba3737add0aa7", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/960c39c1616f6ab23386fbbfc89ba3737add0aa7", "committedDate": "2020-11-19T18:34:01Z", "message": "Trust Let's Encrypt root for Android <= 6.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "143f050158c7cc8be5ee0dfa18565257617ce435", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/143f050158c7cc8be5ee0dfa18565257617ce435", "committedDate": "2020-11-19T18:34:01Z", "message": "Explicitly allow HTTP for API 24+"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fefb44cac51814c043ecefeaa17063646904799b", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/fefb44cac51814c043ecefeaa17063646904799b", "committedDate": "2020-11-17T17:36:52Z", "message": "Trust Let's Encrypt root for Android <= 6.0"}, "afterCommit": {"oid": "143f050158c7cc8be5ee0dfa18565257617ce435", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/143f050158c7cc8be5ee0dfa18565257617ce435", "committedDate": "2020-11-19T18:34:01Z", "message": "Explicitly allow HTTP for API 24+"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2472, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}