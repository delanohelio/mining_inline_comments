{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczODM1Mzcx", "number": 4045, "title": "Fixed handling translations", "bodyText": "Closes #3988 #3029\nWhat has been done to verify that this works as intended?\nI tested the scenario from #3988\nWhy is this the best possible solution? Were any other approaches considered?\nIt's the only solution. Sometimes we just can access application context only and we need to get translations using it however the application context is not updated when we change language so we need the helper class I created.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nThis pr touched many classes but I don't think we should test the whole app. I think we can confirm that it fixes #3988 and merge then test it on a daily basis.\nDo we need any specific form for testing your changes? If so, please attach one.\nNo.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-08-26T11:17:12Z", "url": "https://github.com/getodk/collect/pull/4045", "merged": true, "mergeCommit": {"oid": "ee2290bee14f7ef290541ab8aa51bb157b4d45c5"}, "closed": true, "closedAt": "2020-09-30T16:36:23Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDTOuIgFqTQ3NzY0NDQyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLpu8TgBqjM3OTczMTM3NDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NjQ0NDIx", "url": "https://github.com/getodk/collect/pull/4045#pullrequestreview-477644421", "createdAt": "2020-08-28T11:14:24Z", "commit": {"oid": "a87f182f8e65151705e67629be64a0e9cf7cf800"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMToxNDoyNFrOHI8tew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMToyMToyMFrOHI9K6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE0NTMzOQ==", "bodyText": "We can actually use the context param here instead of Collect.getInstance()", "url": "https://github.com/getodk/collect/pull/4045#discussion_r479145339", "createdAt": "2020-08-28T11:14:24Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/backgroundwork/AutoSendTaskSpec.java", "diffHunk": "@@ -102,10 +103,10 @@\n                     } catch (SubmitException e) {\n                         switch (e.getType()) {\n                             case GOOGLE_ACCOUNT_NOT_SET:\n-                                notifier.onSubmission(true, Collect.getInstance().getString(R.string.google_set_account));\n+                                notifier.onSubmission(true, TranslationHandler.getString(Collect.getInstance(), R.string.google_set_account));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87f182f8e65151705e67629be64a0e9cf7cf800"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE0Njg5Mw==", "bodyText": "This method could take a Context param in our just be inlined it looks like as it's only called from one place that has access to Application.", "url": "https://github.com/getodk/collect/pull/4045#discussion_r479146893", "createdAt": "2020-08-28T11:15:49Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/backgroundwork/BackgroundWorkUtils.java", "diffHunk": "@@ -15,13 +16,13 @@ private BackgroundWorkUtils() {\n     }\n \n     public static long getPeriodInMilliseconds(String period) {\n-        if (period.equals(Collect.getInstance().getString(R.string.every_one_hour_value))) {\n+        if (period.equals(TranslationHandler.getString(Collect.getInstance(), R.string.every_one_hour_value))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87f182f8e65151705e67629be64a0e9cf7cf800"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE1Mjg3NA==", "bodyText": "I think it'd still be nice for this object to take in Context as a constructor dependency so it doesn't have to rely on Collect.getInstance()", "url": "https://github.com/getodk/collect/pull/4045#discussion_r479152874", "createdAt": "2020-08-28T11:21:20Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/formmanagement/FormApiExceptionMapper.java", "diffHunk": "@@ -1,23 +1,17 @@\n package org.odk.collect.android.formmanagement;\n \n-import android.content.res.Resources;\n-\n import org.odk.collect.android.R;\n+import org.odk.collect.android.application.Collect;\n import org.odk.collect.android.openrosa.api.FormApiException;\n+import org.odk.collect.android.utilities.TranslationHandler;\n \n public class FormApiExceptionMapper {\n \n-    private final Resources resources;\n-\n-    public FormApiExceptionMapper(Resources resources) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc918d1491dcddcbf2d8bb182deb6438220c32e7"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10cc1d0630d524ef0978ab4108c4f5d413000f43", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/10cc1d0630d524ef0978ab4108c4f5d413000f43", "committedDate": "2020-08-26T10:55:03Z", "message": "Fixed pmd"}, "afterCommit": {"oid": "ab4602315e6e10746001b3ffa169036974232c60", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ab4602315e6e10746001b3ffa169036974232c60", "committedDate": "2020-09-09T13:33:08Z", "message": "Code improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTQwNzgy", "url": "https://github.com/getodk/collect/pull/4045#pullrequestreview-485140782", "createdAt": "2020-09-09T15:39:34Z", "commit": {"oid": "ab4602315e6e10746001b3ffa169036974232c60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ab380d74108b3b29bd2c03a3988977e037711b1", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9ab380d74108b3b29bd2c03a3988977e037711b1", "committedDate": "2020-09-23T10:04:31Z", "message": "Added TranslationHandler class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9ba944a55c73418b23129edfe65e9ce35d2ba06", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/e9ba944a55c73418b23129edfe65e9ce35d2ba06", "committedDate": "2020-09-23T10:04:32Z", "message": "Don't use application context to get strings if not necessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5f7ef5cba36c7503b9172212060bef0e3d421ad", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/e5f7ef5cba36c7503b9172212060bef0e3d421ad", "committedDate": "2020-09-23T10:04:32Z", "message": "Fixed pmd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a075aca103bc89f88026a4bbde6e381676e9035", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3a075aca103bc89f88026a4bbde6e381676e9035", "committedDate": "2020-09-23T10:06:21Z", "message": "Use TranslationHandler wherever it's needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d2c4c5b1ca7975b8aa7a4f78e886203918ad393", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7d2c4c5b1ca7975b8aa7a4f78e886203918ad393", "committedDate": "2020-09-23T10:06:21Z", "message": "Cleared NotificationManagerNotifier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae2c35b7e6ab1a932c65c32b5ac40823bdbada7c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ae2c35b7e6ab1a932c65c32b5ac40823bdbada7c", "committedDate": "2020-09-23T10:06:21Z", "message": "Code improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab4602315e6e10746001b3ffa169036974232c60", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ab4602315e6e10746001b3ffa169036974232c60", "committedDate": "2020-09-09T13:33:08Z", "message": "Code improvements"}, "afterCommit": {"oid": "ae2c35b7e6ab1a932c65c32b5ac40823bdbada7c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ae2c35b7e6ab1a932c65c32b5ac40823bdbada7c", "committedDate": "2020-09-23T10:06:21Z", "message": "Code improvements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2623, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}