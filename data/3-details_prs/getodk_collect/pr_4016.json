{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NTczMTkw", "number": 4016, "title": "Adjusted gesture navigation", "bodyText": "Closes #3966\nWhat has been done to verify that this works as intended?\nI tested navigating in a form.\nWhy is this the best possible solution? Were any other approaches considered?\nIt's the easiest solution. We also talked about viewpager but it would require more changes so despite the fact it's something we should do in the future, I think for now this quick adjustment is fine.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nIt just requires swiping right/left that's all. It doesn't even require testing navigation using buttons only gesture navigation.\nDo we need any specific form for testing your changes? If so, please attach one.\nAny form.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-08-07T12:18:36Z", "url": "https://github.com/getodk/collect/pull/4016", "merged": true, "mergeCommit": {"oid": "9a147910f219d8d79b0580ba29ee81b4595c7d12"}, "closed": true, "closedAt": "2020-09-08T14:45:54Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8qq0LgFqTQ2MzYwMDI4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAOQCAgBqjM2NjgyNjI5NTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjAwMjg1", "url": "https://github.com/getodk/collect/pull/4016#pullrequestreview-463600285", "createdAt": "2020-08-07T20:44:19Z", "commit": {"oid": "3d190bd096f557ad424775e875f7006f64164dc3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d190bd096f557ad424775e875f7006f64164dc3", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3d190bd096f557ad424775e875f7006f64164dc3", "committedDate": "2020-08-07T12:01:33Z", "message": "Adjusted gesture navigation"}, "afterCommit": {"oid": "3ab1692a0c47d869532001719f915dba3ed0c429", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3ab1692a0c47d869532001719f915dba3ed0c429", "committedDate": "2020-08-11T12:25:42Z", "message": "Adjusted gesture navigation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTEyNDUz", "url": "https://github.com/getodk/collect/pull/4016#pullrequestreview-468912453", "createdAt": "2020-08-18T00:19:37Z", "commit": {"oid": "b0d424411286f88f4ba3b6fabf9364c162f8b888"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwMDoxOTozN1rOHB_CPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwMDoxOTozN1rOHB_CPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg0MzM4OQ==", "bodyText": "I think this is clearer with xdpi and ydpi inline. The comment is very clear and dpi is common for \"dots per inch\".", "url": "https://github.com/getodk/collect/pull/4016#discussion_r471843389", "createdAt": "2020-08-18T00:19:37Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/listeners/SwipeHandler.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package org.odk.collect.android.listeners;\n+\n+import android.content.Context;\n+import android.view.GestureDetector;\n+import android.view.MotionEvent;\n+\n+import androidx.core.widget.NestedScrollView;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.formentry.ODKView;\n+import org.odk.collect.android.preferences.GeneralKeys;\n+import org.odk.collect.android.preferences.GeneralSharedPreferences;\n+import org.odk.collect.android.utilities.FlingRegister;\n+import org.odk.collect.android.utilities.ScreenUtils;\n+\n+import timber.log.Timber;\n+\n+public class SwipeHandler {\n+    private final GestureDetector gestureDetector;\n+    private final OnSwipeListener onSwipe;\n+    private ODKView odkView;\n+    private boolean allowSwiping = true;\n+    private boolean beenSwiped;\n+\n+    public interface OnSwipeListener {\n+        void showPreviousView();\n+        void showNextView();\n+    }\n+\n+    public SwipeHandler(Context context) {\n+        gestureDetector = new GestureDetector(context, new GestureListener());\n+        this.onSwipe = (OnSwipeListener) context;\n+    }\n+\n+    public void setOdkView(ODKView odkView) {\n+        this.odkView = odkView;\n+    }\n+\n+    public void setAllowSwiping(boolean allowSwiping) {\n+        this.allowSwiping = allowSwiping;\n+    }\n+\n+    public void setBeenSwiped(boolean beenSwiped) {\n+        this.beenSwiped = beenSwiped;\n+    }\n+\n+    public boolean beenSwiped() {\n+        return beenSwiped;\n+    }\n+\n+    public GestureDetector getGestureDetector() {\n+        return gestureDetector;\n+    }\n+\n+    public class GestureListener implements GestureDetector.OnGestureListener {\n+\n+        @Override\n+        public boolean onDown(MotionEvent event) {\n+            return false;\n+        }\n+\n+        @Override\n+        public void onShowPress(MotionEvent e) {\n+\n+        }\n+\n+        @Override\n+        public boolean onScroll(MotionEvent e1, MotionEvent e2, float distanceX, float distanceY) {\n+            // The onFling() captures the 'up' event so our view thinks it gets long pressed. We don't want that, so cancel it.\n+            if (odkView != null) {\n+                odkView.cancelLongPress();\n+            }\n+            return false;\n+        }\n+\n+        @Override\n+        public void onLongPress(MotionEvent e) {\n+\n+        }\n+\n+        @Override\n+        public boolean onSingleTapUp(MotionEvent e) {\n+            return false;\n+        }\n+\n+        @Override\n+        public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {\n+            FlingRegister.flingDetected();\n+\n+            // only check the swipe if it's enabled in preferences\n+            String navigation = (String) GeneralSharedPreferences.getInstance()\n+                    .get(GeneralKeys.KEY_NAVIGATION);\n+\n+            if (e1 != null && e2 != null\n+                    && navigation.contains(GeneralKeys.NAVIGATION_SWIPE) && allowSwiping) {\n+                // Looks for user swipes. If the user has swiped, move to the appropriate screen.\n+\n+                // For all screens a swipe is left/right of at least .25\" and up/down of less than .25\" OR left/right of > .5\"\n+                int xpixellimit = (int) (ScreenUtils.getXPixelsNumberPerInch() * .25);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d424411286f88f4ba3b6fabf9364c162f8b888"}, "originalPosition": 99}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTE0Nzk1", "url": "https://github.com/getodk/collect/pull/4016#pullrequestreview-468914795", "createdAt": "2020-08-18T00:27:39Z", "commit": {"oid": "b0d424411286f88f4ba3b6fabf9364c162f8b888"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDI4NjI3", "url": "https://github.com/getodk/collect/pull/4016#pullrequestreview-469428627", "createdAt": "2020-08-18T12:58:14Z", "commit": {"oid": "79a6d21f5cdc341dcd0afacd4f0e937c7c2729c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fff080e4331506551de734f58336b43176a8b965", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/fff080e4331506551de734f58336b43176a8b965", "committedDate": "2020-08-18T21:52:51Z", "message": "Adjusted gesture navigation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "793538b7adbc328ab5dbe16cb576c7a7cca69525", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/793538b7adbc328ab5dbe16cb576c7a7cca69525", "committedDate": "2020-08-18T21:52:51Z", "message": "Adjust gesture navigation only if vertical scrolling is enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44797958fab02d04af1433285217fd5bb4818f32", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/44797958fab02d04af1433285217fd5bb4818f32", "committedDate": "2020-08-18T21:52:51Z", "message": "Moved the code responsible for gesture navigation out of FormEntryActivity\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f691c9bc495a9ec6dba184022d6d7931d0107b20", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f691c9bc495a9ec6dba184022d6d7931d0107b20", "committedDate": "2020-08-18T21:52:51Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc81fd8f9fda449065b5b9f308052eba01334ab5", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/fc81fd8f9fda449065b5b9f308052eba01334ab5", "committedDate": "2020-08-18T21:52:51Z", "message": "Fixed calculating swipes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbb92204c86a318f197d6b0c4b9bf856283f79f9", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/dbb92204c86a318f197d6b0c4b9bf856283f79f9", "committedDate": "2020-08-18T21:52:51Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "committedDate": "2020-08-18T21:52:51Z", "message": "Naming improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79a6d21f5cdc341dcd0afacd4f0e937c7c2729c2", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/79a6d21f5cdc341dcd0afacd4f0e937c7c2729c2", "committedDate": "2020-08-18T00:27:31Z", "message": "Naming improvements"}, "afterCommit": {"oid": "e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/e63d528d9fce9163d325d195cca7a6ea2ebfdec6", "committedDate": "2020-08-18T21:52:51Z", "message": "Naming improvements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2597, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}