{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDQ2MTIx", "number": 3640, "title": "Add copy on long press to device details in Form Metdata", "bodyText": "Closes #3633\nCloses #3646\nThis makes it possible to copy any of the device defined metadata values on the \"Form Metadata\" screen by long pressinging and then hitting copy.\nThere are a couple of code changes that went in as well:\n\nAdded androidx.test runner and androidx.test.fragment testing utils dependencies. These let us use FragmentScenario to write tests for individual Fragment objects. Behind the scenes this uses Robolectric.\nMoved SharedPreferencesTest from androidTest to test\nDeprecate GeneralSharedPreferences.getInstance() and AdminSharedPreferences.getInstance(). Static singletons like this cause problems in tests as the same instance is retained between tests. The singleton is now managed in Dagger (which has a dependency module attached to the lifecycle of the Application, not the process).\n\nWhat has been done to verify that this works as intended?\nWhy is this the best possible solution? Were any other approaches considered?\nGetting this to work meant adding in the new androix.preference framework. This is replacing the deprecated android.preference framework which didn't include the copy feature. This definitely felt like the right solution vs hacking the feature in ourselves but it does mean we needed to create a new activity (FormMetadataPreferencesActivity) that works with this framework. I think we can slowly move to using this for every preference screen - probably just by updating them as we touch them.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nOnly thing I'd be worried about is regressions on the Form Metadata screen itself so good to have a play with that.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-02-14T15:35:18Z", "url": "https://github.com/getodk/collect/pull/3640", "merged": true, "mergeCommit": {"oid": "ca020ce1798d05a2314f3bba402258eb8d94c35d"}, "closed": true, "closedAt": "2020-02-25T15:53:12Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF8Y9OAFqTM2MTM2MjUyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHxUEKgH2gAyMzc1NDQ2MTIxOjdmNDM1ZDc4ZTU2NzBlYTNmM2Y3YzRmOWY4ZWMyY2Y3YWQxOTU4YTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzYyNTI1", "url": "https://github.com/getodk/collect/pull/3640#pullrequestreview-361362525", "createdAt": "2020-02-19T19:12:05Z", "commit": {"oid": "ef373e7bd5caef58feae7ff5d8231e567f6db99d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxOToxMjowNVrOFr0D9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDoxMzowM1rOFr2BhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ4NjA3MQ==", "bodyText": "This should be above the External API comment. I'd tend to group it with others in the preferences package.", "url": "https://github.com/getodk/collect/pull/3640#discussion_r381486071", "createdAt": "2020-02-19T19:12:05Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/AndroidManifest.xml", "diffHunk": "@@ -285,5 +285,6 @@ the specific language governing permissions and limitations under the License.\n                 <category android:name=\"android.intent.category.DEFAULT\" />\n             </intent-filter>\n         </activity>\n+        <activity android:name=\".preferences.FormMetadataPreferencesActivity\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef373e7bd5caef58feae7ff5d8231e567f6db99d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ5MTA5Mw==", "bodyText": "Does the hyphen seem wrong to you? These are compound words so the hyphen is required at least by APA guidelines. Maybe it's a regional thing?\nChanging these strings means they'll be pushed out to translators. If translators don't re-translate them before the release then they'll show up in English instead.", "url": "https://github.com/getodk/collect/pull/3640#discussion_r381491093", "createdAt": "2020-02-19T19:21:19Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/res/values/strings.xml", "diffHunk": "@@ -484,8 +484,8 @@\n     <string name=\"form_metadata_summary\">These values will be added to forms that have username, email and/or telephone preloaded fields to identify the person submitting data.</string>\n     <string name=\"phone_number\">Phone number</string>\n     <string name=\"email\">Email address</string>\n-    <string name=\"user_defined\">User-defined</string>\n-    <string name=\"device_defined\">Device-defined</string>\n+    <string name=\"user_defined\">User defined</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0e99b9ae21bbd4bcb03833bd0dacc9fec03e9b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUxODIxMw==", "bodyText": "I think that this is good but I'm concerned that it will get lost and forgotten. How about marking KEYS_WE_SHOULD_NOT_RESET as deprecated and describing this strategy? Maybe meta should be a constant somewhere?", "url": "https://github.com/getodk/collect/pull/3640#discussion_r381518213", "createdAt": "2020-02-19T20:13:03Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "diffHunk": "@@ -166,7 +165,7 @@ public ActivityAvailability providesActivityAvailability(Context context) {\n \n     @Provides\n     InstallIDProvider providesInstallIDProvider(Context context) {\n-        SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);\n+        SharedPreferences preferences = context.getSharedPreferences(\"meta\", Context.MODE_PRIVATE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "772ef68b1f14911e1e9e25504ec8223db5a0ce3c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNDA2NTgw", "url": "https://github.com/getodk/collect/pull/3640#pullrequestreview-361406580", "createdAt": "2020-02-19T20:18:01Z", "commit": {"oid": "bcbe6fc80a6aeb8c9ac28cc56f7b163bcaf44a80"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d682095e3a8e71b72ec07ef0df4d8def1273ba", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c3d682095e3a8e71b72ec07ef0df4d8def1273ba", "committedDate": "2020-02-24T10:48:27Z", "message": "Use androidx preferences for Form Metadata"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "470c83a68d6f0193bd220ee044bcba20ceee5a8d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/470c83a68d6f0193bd220ee044bcba20ceee5a8d", "committedDate": "2020-02-24T10:48:27Z", "message": "Enable copying on Form Metadata device details"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90703206a0f5175359e5bf0c0feb9b6e00b35458", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/90703206a0f5175359e5bf0c0feb9b6e00b35458", "committedDate": "2020-02-24T10:48:27Z", "message": "Make Form Metadata titles more human"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4ad57f32a2e734394a2a1e1b7a10241e500930c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b4ad57f32a2e734394a2a1e1b7a10241e500930c", "committedDate": "2020-02-24T10:48:27Z", "message": "Make install ID pref non persistable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61ed1d846cd4cbea10833812cd9c8b06111dd5d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e61ed1d846cd4cbea10833812cd9c8b06111dd5d", "committedDate": "2020-02-24T10:48:27Z", "message": "Rename new prefs activity layout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0f6837c033519170225c68c5dfb86898d722d81", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/a0f6837c033519170225c68c5dfb86898d722d81", "committedDate": "2020-02-24T10:48:27Z", "message": "Use summary provider to load preferences managed by PropertyManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44f5dd73d3a900d68f13cb27dec6ec1a5e1e6a95", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/44f5dd73d3a900d68f13cb27dec6ec1a5e1e6a95", "committedDate": "2020-02-24T10:48:27Z", "message": "Stop rotation creating problems for FormMetadataFragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75b3576f970d64a29da36b1216a1b3c2eeeb054f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/75b3576f970d64a29da36b1216a1b3c2eeeb054f", "committedDate": "2020-02-24T10:48:27Z", "message": "Stop using deprecated method for Dagger injection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fe252727afeeb2fd57cdcc43d8dd6d7571dc5b5", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4fe252727afeeb2fd57cdcc43d8dd6d7571dc5b5", "committedDate": "2020-02-24T10:48:27Z", "message": "Remove margin from preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1c0bc3fb7e2155e2cf4ce719fae313d97422135", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b1c0bc3fb7e2155e2cf4ce719fae313d97422135", "committedDate": "2020-02-24T10:48:27Z", "message": "Make sure installID lives outside of general prefs so it's not reset"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd60d5fa307b29cf2ed40b89c27b9bf5ecee4bf3", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/fd60d5fa307b29cf2ed40b89c27b9bf5ecee4bf3", "committedDate": "2020-02-24T10:48:27Z", "message": "Clear shared prefs before running tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57d07c5d4e6820ae87497f46e9b8dbc0a89701c8", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/57d07c5d4e6820ae87497f46e9b8dbc0a89701c8", "committedDate": "2020-02-24T10:48:27Z", "message": "Use Dagger to manage singleton of GeneralSharedPreferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13dc7d6eea063ba8f1f7a5befe095678052a121b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/13dc7d6eea063ba8f1f7a5befe095678052a121b", "committedDate": "2020-02-24T10:48:28Z", "message": "Use Dagger to manage singleton of AdminSharedPreferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a42e44491f3e14870cd962c727b7b0bda0a0c6c9", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/a42e44491f3e14870cd962c727b7b0bda0a0c6c9", "committedDate": "2020-02-24T10:48:28Z", "message": "Move FormMetadataPreferencesActivity declaration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8e14af7bb6aa8d50913f7cbb28fd6e4845b2adb", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d8e14af7bb6aa8d50913f7cbb28fd6e4845b2adb", "committedDate": "2020-02-24T10:48:28Z", "message": "Revert \"Make Form Metadata titles more human\"\n\nThis reverts commit 0b0e99b9ae21bbd4bcb03833bd0dacc9fec03e9b."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5f97e8f2cb99d1537ad7adbbc84871c1be33256", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e5f97e8f2cb99d1537ad7adbbc84871c1be33256", "committedDate": "2020-02-24T10:48:28Z", "message": "Add MetaSharedPreferencesProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddd2c079828702da8454055fad2684f2ec80baff", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ddd2c079828702da8454055fad2684f2ec80baff", "committedDate": "2020-02-24T11:11:39Z", "message": "Don't use broken appcompat version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ed331b77246f9bf1c5f10f6e470e6c253de1b61", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5ed331b77246f9bf1c5f10f6e470e6c253de1b61", "committedDate": "2020-02-20T10:23:05Z", "message": "Add MetaSharedPreferencesProvider"}, "afterCommit": {"oid": "ddd2c079828702da8454055fad2684f2ec80baff", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ddd2c079828702da8454055fad2684f2ec80baff", "committedDate": "2020-02-24T11:11:39Z", "message": "Don't use broken appcompat version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caae73090ce47adab4286b3565fb20964734178f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/caae73090ce47adab4286b3565fb20964734178f", "committedDate": "2020-02-24T18:50:08Z", "message": "Show not set message when device details aren't available"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f81851d5bea642a06e46e872f4ba978f5dce3c3f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/f81851d5bea642a06e46e872f4ba978f5dce3c3f", "committedDate": "2020-02-24T18:53:34Z", "message": "Make sure only installID is copyable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b43a45b38f6ba98526fe98b6447e299cd2c414d6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b43a45b38f6ba98526fe98b6447e299cd2c414d6", "committedDate": "2020-02-24T19:29:48Z", "message": "Improve preference not available string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNjQ0Mzky", "url": "https://github.com/getodk/collect/pull/3640#pullrequestreview-363644392", "createdAt": "2020-02-24T19:32:03Z", "commit": {"oid": "b43a45b38f6ba98526fe98b6447e299cd2c414d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f435d78e5670ea3f3f7c4f9f8ec2cf7ad1958a6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/7f435d78e5670ea3f3f7c4f9f8ec2cf7ad1958a6", "committedDate": "2020-02-25T12:30:49Z", "message": "Use numeric keyboard for phone preference"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2298, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}