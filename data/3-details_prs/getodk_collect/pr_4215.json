{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NTY1MTQ4", "number": 4215, "title": "Stop user leaving recording", "bodyText": "Closes #4154\nBlocked by #4190\nThe user will now be instructed to stop recording before they can leave form entry. I also reworked some of the logic that deals with switching between screens in FormEntryActivity to make it easier to deal with checks that happen when we swipe left or right.\nWhat has been done to verify that this works as intended?\nNew tests and manually verified.\nWhy is this the best possible solution? Were any other approaches considered?\nComment inline.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nDefinitely good to check if there are other ways to \"leave\" form entry that haven't been covered here! Also good to check that form entry generally (particularly swiping through forms) is all still ok.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-11-10T15:20:44Z", "url": "https://github.com/getodk/collect/pull/4215", "merged": true, "mergeCommit": {"oid": "af5cb964dc6144c42bffe0534566e31aafef4719"}, "closed": true, "closedAt": "2020-11-20T14:41:49Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbLSAkgBqjM5Nzk1ODIwMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeUU-5gH2gAyNTE4NTY1MTQ4OmU1ZDBmMWM2YWRlNDU3NzM2ZGJmYWVhN2RjMDY5YWE4M2NlOWE1MGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31fa6a208c342cd97b62fd0ea43c96aeafdc9ed3", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/31fa6a208c342cd97b62fd0ea43c96aeafdc9ed3", "committedDate": "2020-11-10T15:18:56Z", "message": "Make sure swipe handler is called correctly"}, "afterCommit": {"oid": "b8a54803ced6543a590f353fee340f186a8a714c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b8a54803ced6543a590f353fee340f186a8a714c", "committedDate": "2020-11-10T15:40:54Z", "message": "Make sure swipe handler is called correctly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8a54803ced6543a590f353fee340f186a8a714c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b8a54803ced6543a590f353fee340f186a8a714c", "committedDate": "2020-11-10T15:40:54Z", "message": "Make sure swipe handler is called correctly"}, "afterCommit": {"oid": "b045b99d7790ac67207e230b59ef6147b82f04db", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b045b99d7790ac67207e230b59ef6147b82f04db", "committedDate": "2020-11-11T13:49:47Z", "message": "Make sure swipe handler is called correctly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTk4MzU0", "url": "https://github.com/getodk/collect/pull/4215#pullrequestreview-528198354", "createdAt": "2020-11-11T14:03:26Z", "commit": {"oid": "5a97d4fe2e53baf8633701ec8cf23949b2f0b081"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNDowMzoyN1rOHxOczw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNDowMzoyN1rOHxOczw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTAyMw==", "bodyText": "Forgot this earlier", "url": "https://github.com/getodk/collect/pull/4215#discussion_r521379023", "createdAt": "2020-11-11T14:03:27Z", "author": {"login": "seadowg"}, "path": ".circleci/config.yml", "diffHunk": "@@ -63,6 +63,9 @@ jobs:\n       - run:\n           name: Run audioclips unit tests\n           command: ./gradlew -PdisablePreDex --no-daemon --max-workers=2 audioclips:testDebug\n+      - run:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a97d4fe2e53baf8633701ec8cf23949b2f0b081"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MjAwMDIw", "url": "https://github.com/getodk/collect/pull/4215#pullrequestreview-528200020", "createdAt": "2020-11-11T14:05:22Z", "commit": {"oid": "5a97d4fe2e53baf8633701ec8cf23949b2f0b081"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNDowNToyMlrOHxOhlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNDowNToyMlrOHxOhlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM4MDI0NA==", "bodyText": "Changing from a switch to an if is now suggested by Android Studio.", "url": "https://github.com/getodk/collect/pull/4215#discussion_r521380244", "createdAt": "2020-11-11T14:05:22Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/formentry/FormEntryMenuDelegate.java", "diffHunk": "@@ -82,40 +94,43 @@ public void onPrepareOptionsMenu(Menu menu) {\n             backgroundLocation.setChecked(GeneralSharedPreferences.getInstance().getBoolean(KEY_BACKGROUND_LOCATION, true));\n         }\n \n-        menu.findItem(R.id.menu_add_repeat).setVisible(getFormEntryViewModel().canAddRepeat());\n+        menu.findItem(R.id.menu_add_repeat).setVisible(formEntryViewModel.canAddRepeat());\n     }\n \n     @Override\n     public boolean onOptionsItemSelected(MenuItem item) {\n-        switch (item.getItemId()) {\n-            case R.id.menu_add_repeat:\n-                getFormSaveViewModel().saveAnswersForScreen(answersProvider.getAnswers());\n-                getFormEntryViewModel().promptForNewRepeat();\n-                formIndexAnimationHandler.handle(getFormEntryViewModel().getCurrentIndex());\n-                return true;\n-\n-            case R.id.menu_preferences:\n+        if (item.getItemId() == R.id.menu_add_repeat) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a97d4fe2e53baf8633701ec8cf23949b2f0b081"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTgwMzc2", "url": "https://github.com/getodk/collect/pull/4215#pullrequestreview-528580376", "createdAt": "2020-11-11T22:25:45Z", "commit": {"oid": "6e59cfddae93b4e70ba97b67da0bbea371e6f2fb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMjoyNTo0NlrOHxgihA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMjo0MDoxMVrOHzB3BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY3NTM5Ng==", "bodyText": "now -> know", "url": "https://github.com/getodk/collect/pull/4215#discussion_r521675396", "createdAt": "2020-11-11T22:25:46Z", "author": {"login": "lognaturel"}, "path": "strings/src/main/res/values/strings.xml", "diffHunk": "@@ -702,10 +702,22 @@\n     <string name=\"security_error\">Collect can\\'t connect securely to the server at %s. Did you enter the URL correctly?</string>\n     <string name=\"failure\">Failure</string>\n     <string name=\"form_update_succeeded\">Form update succeeded</string>\n+\n+    <!-- Title for setting to let the user switch between using Collect or another app (on the device) for recording audio -->\n     <string name=\"external_app_recording\">Use external app for audio recording</string>\n+\n+    <!-- Text for button that stops audio recording  -->\n     <string name=\"stop_recording\">Stop</string>\n+\n+    <!-- Text to let the user now a recording is in progress  -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e59cfddae93b4e70ba97b67da0bbea371e6f2fb"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY3NTY1NA==", "bodyText": "Isn't this sometimes chosen and sometimes recorded?", "url": "https://github.com/getodk/collect/pull/4215#discussion_r521675654", "createdAt": "2020-11-11T22:26:24Z", "author": {"login": "lognaturel"}, "path": "strings/src/main/res/values/strings.xml", "diffHunk": "@@ -702,10 +702,22 @@\n     <string name=\"security_error\">Collect can\\'t connect securely to the server at %s. Did you enter the URL correctly?</string>\n     <string name=\"failure\">Failure</string>\n     <string name=\"form_update_succeeded\">Form update succeeded</string>\n+\n+    <!-- Title for setting to let the user switch between using Collect or another app (on the device) for recording audio -->\n     <string name=\"external_app_recording\">Use external app for audio recording</string>\n+\n+    <!-- Text for button that stops audio recording  -->\n     <string name=\"stop_recording\">Stop</string>\n+\n+    <!-- Text to let the user now a recording is in progress  -->\n     <string name=\"recording\">Recording\u2026</string>\n+\n+    <!-- Title of Android Notification Channel for audio recording notifications  -->\n     <string name=\"recording_channel\">Audio recording</string>\n-    <string name=\"play_audio\">Play audio</string>\n+\n+    <!-- Text for button that plays audio clip  -->\n+    <string name=\"play_audio\">Play chosen audio</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e59cfddae93b4e70ba97b67da0bbea371e6f2fb"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY3NjE4OA==", "bodyText": "How about \"You must stop recording before leaving this screen.\"", "url": "https://github.com/getodk/collect/pull/4215#discussion_r521676188", "createdAt": "2020-11-11T22:27:37Z", "author": {"login": "lognaturel"}, "path": "strings/src/main/res/values/strings.xml", "diffHunk": "@@ -720,4 +720,7 @@\n \n     <!-- Text to let the user know a file is being saved  -->\n     <string name=\"saving_file\">Saving file</string>\n+\n+    <!-- Text in dialog that instructs the user to stop recording audio before leaving the form -->\n+    <string name=\"recording_warning\">Must stop recording before moving on!</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4838e6bb6d4f6765e716294bd2c1c446c1893643"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI2ODM3NQ==", "bodyText": "Looks like it's used to keep track of which questions' guidance hints are expanded and the search text for selects with the search appearance. Would be great to move all that to a view model, I think.", "url": "https://github.com/getodk/collect/pull/4215#discussion_r523268375", "createdAt": "2020-11-13T22:35:14Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -1476,99 +1467,77 @@ public boolean dispatchTouchEvent(MotionEvent mv) {\n         return handled; // this is always true\n     }\n \n-    /**\n-     * Determines what should be displayed on the screen. Possible options are:\n-     * a question, an ask repeat dialog, or the submit screen. Also saves\n-     * answers to the data model after checking constraints.\n-     */\n-    public void showNextView() {\n-        state = null;\n-        try {\n-            FormController formController = getFormController();\n-            if (saveBeforeNextView(formController)) {\n-                return;\n-            }\n-\n-            int originalEvent = formController.getEvent();\n-            int event = formController.stepToNextScreenEvent();\n-\n-            // Helps prevent transition animation at the end of the form (if user swipes left\n-            // she will stay on the same screen)\n-            if (originalEvent == event && originalEvent == FormEntryController.EVENT_END_OF_FORM) {\n-                swipeHandler.setBeenSwiped(false);\n-                return;\n-            }\n+    @Override\n+    public void onSwipeForward() {\n+        moveScreen(FORWARDS);\n+    }\n \n-            formIndexAnimationHandler.handle(getFormController().getFormIndex());\n-        } catch (JavaRosaException e) {\n-            Timber.d(e);\n-            createErrorDialog(e.getCause().getMessage(), DO_NOT_EXIT);\n-        }\n+    @Override\n+    public void onSwipeBackward() {\n+        moveScreen(BACKWARDS);\n     }\n \n-    /**\n-     * If moving backwards is allowed, displays the view for the previous question or field list.\n-     * Steps the global {@link FormController} to the previous question and saves answers to the\n-     * data model without checking constraints.\n-     */\n-    public void showPreviousView() {\n-        if (allowMovingBackwards) {\n-            state = null;\n-            FormController formController = getFormController();\n-            if (formController != null) {\n-                // The answer is saved on a back swipe, but question constraints are ignored.\n-                if (formController.currentPromptIsQuestion()) {\n-                    saveAnswersForCurrentScreen(DO_NOT_EVALUATE_CONSTRAINTS);\n-                }\n+    private void moveScreen(Direction direction) {\n+        FormController formController = getFormController();\n+        if (formController == null) {\n+            Timber.w(\"FormController has a null value\");\n+            swipeHandler.setBeenSwiped(false);\n+            return;\n+        }\n \n-                try {\n-                    if (formController.getEvent() != FormEntryController.EVENT_BEGINNING_OF_FORM) {\n-                        int event = formController.stepToPreviousScreenEvent();\n+        if (audioRecorderViewModel.isRecording().getValue()) {\n+            // We want the user to stop recording before changing screens\n+            DialogUtils.showIfNotShowing(RecordingWarningDialogFragment.class, getSupportFragmentManager());\n+            swipeHandler.setBeenSwiped(false);\n+            return;\n+        }\n \n-                        // If we are the beginning of the form, there is no previous view to show\n-                        if (event == FormEntryController.EVENT_BEGINNING_OF_FORM) {\n-                            event = formController.stepToNextScreenEvent();\n-                            swipeHandler.setBeenSwiped(false);\n+        if (direction == FORWARDS && formController.getEvent() == FormEntryController.EVENT_END_OF_FORM) {\n+            // We're tryin to move forwards at the end of the form so just cancel\n+            swipeHandler.setBeenSwiped(false);\n+            return;\n+        } else if (direction == BACKWARDS && !allowMovingBackwards) {\n+            // We're not allowed to move backwards but trying to so just cancel\n+            swipeHandler.setBeenSwiped(false);\n+            return;\n+        }\n \n-                            if (event != EVENT_PROMPT_NEW_REPEAT) {\n-                                // Returning here prevents the same view sliding when user is on the first screen\n-                                return;\n-                            }\n-                        }\n+        state = null; // This is needed for something but is definitely suspect", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4838e6bb6d4f6765e716294bd2c1c446c1893643"}, "originalPosition": 211}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI2OTg5Mw==", "bodyText": "Why pull this direction-specific stuff out? Seems it should either be in the switch below or in the direction specific methods. Or if it's pulled out and their bodies are the same maybe it should be a single conditional.\nIf pulling it out, why not also pull the analogous beginning of form test out here? (Not that I think it's actually possible to be at the beginning of form event)", "url": "https://github.com/getodk/collect/pull/4215#discussion_r523269893", "createdAt": "2020-11-13T22:40:11Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -1476,99 +1467,77 @@ public boolean dispatchTouchEvent(MotionEvent mv) {\n         return handled; // this is always true\n     }\n \n-    /**\n-     * Determines what should be displayed on the screen. Possible options are:\n-     * a question, an ask repeat dialog, or the submit screen. Also saves\n-     * answers to the data model after checking constraints.\n-     */\n-    public void showNextView() {\n-        state = null;\n-        try {\n-            FormController formController = getFormController();\n-            if (saveBeforeNextView(formController)) {\n-                return;\n-            }\n-\n-            int originalEvent = formController.getEvent();\n-            int event = formController.stepToNextScreenEvent();\n-\n-            // Helps prevent transition animation at the end of the form (if user swipes left\n-            // she will stay on the same screen)\n-            if (originalEvent == event && originalEvent == FormEntryController.EVENT_END_OF_FORM) {\n-                swipeHandler.setBeenSwiped(false);\n-                return;\n-            }\n+    @Override\n+    public void onSwipeForward() {\n+        moveScreen(FORWARDS);\n+    }\n \n-            formIndexAnimationHandler.handle(getFormController().getFormIndex());\n-        } catch (JavaRosaException e) {\n-            Timber.d(e);\n-            createErrorDialog(e.getCause().getMessage(), DO_NOT_EXIT);\n-        }\n+    @Override\n+    public void onSwipeBackward() {\n+        moveScreen(BACKWARDS);\n     }\n \n-    /**\n-     * If moving backwards is allowed, displays the view for the previous question or field list.\n-     * Steps the global {@link FormController} to the previous question and saves answers to the\n-     * data model without checking constraints.\n-     */\n-    public void showPreviousView() {\n-        if (allowMovingBackwards) {\n-            state = null;\n-            FormController formController = getFormController();\n-            if (formController != null) {\n-                // The answer is saved on a back swipe, but question constraints are ignored.\n-                if (formController.currentPromptIsQuestion()) {\n-                    saveAnswersForCurrentScreen(DO_NOT_EVALUATE_CONSTRAINTS);\n-                }\n+    private void moveScreen(Direction direction) {\n+        FormController formController = getFormController();\n+        if (formController == null) {\n+            Timber.w(\"FormController has a null value\");\n+            swipeHandler.setBeenSwiped(false);\n+            return;\n+        }\n \n-                try {\n-                    if (formController.getEvent() != FormEntryController.EVENT_BEGINNING_OF_FORM) {\n-                        int event = formController.stepToPreviousScreenEvent();\n+        if (audioRecorderViewModel.isRecording().getValue()) {\n+            // We want the user to stop recording before changing screens\n+            DialogUtils.showIfNotShowing(RecordingWarningDialogFragment.class, getSupportFragmentManager());\n+            swipeHandler.setBeenSwiped(false);\n+            return;\n+        }\n \n-                        // If we are the beginning of the form, there is no previous view to show\n-                        if (event == FormEntryController.EVENT_BEGINNING_OF_FORM) {\n-                            event = formController.stepToNextScreenEvent();\n-                            swipeHandler.setBeenSwiped(false);\n+        if (direction == FORWARDS && formController.getEvent() == FormEntryController.EVENT_END_OF_FORM) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4838e6bb6d4f6765e716294bd2c1c446c1893643"}, "originalPosition": 196}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab7e8a01dd10102601e5f74b239bb5951b10e85f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ab7e8a01dd10102601e5f74b239bb5951b10e85f", "committedDate": "2020-11-17T15:07:20Z", "message": "Attempt to simplify form moving forwards/backwards logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c968f63f08f47acde4024c55bda18c5d0db7b1e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4c968f63f08f47acde4024c55bda18c5d0db7b1e", "committedDate": "2020-11-17T15:09:30Z", "message": "Show warning when trying to swipe between screens while recording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01dd878155c4d0181b6308f4faacda5dc054e184", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/01dd878155c4d0181b6308f4faacda5dc054e184", "committedDate": "2020-11-17T15:10:31Z", "message": "Show warning when trying to open hierarchy while recording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57ac40229f9715299c32fb6cd7c84dbe2d6177cd", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/57ac40229f9715299c32fb6cd7c84dbe2d6177cd", "committedDate": "2020-11-17T15:10:33Z", "message": "Use DialogFragment for warning dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dbb6103ea2e236815fa66a64b04b5836a79d2c2", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/7dbb6103ea2e236815fa66a64b04b5836a79d2c2", "committedDate": "2020-11-17T15:12:36Z", "message": "Show warning when user tries to quite form while recording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54ac2d57e2d5b5b8da1bb9f229991bffa7c4709", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/f54ac2d57e2d5b5b8da1bb9f229991bffa7c4709", "committedDate": "2020-11-17T15:12:37Z", "message": "Rework audio test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6922f1b53ec2fbffda7f436be5d8bb20ba803d4b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/6922f1b53ec2fbffda7f436be5d8bb20ba803d4b", "committedDate": "2020-11-17T15:12:37Z", "message": "Show warning when trying to open settings while recording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aefbb6d8a6440cb349a6a57c92da16605850382", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/1aefbb6d8a6440cb349a6a57c92da16605850382", "committedDate": "2020-11-17T15:12:38Z", "message": "Pass ViewModels in at constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc9f8bef7248a9541e2d139f0fbaba80a7d4c85", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5dc9f8bef7248a9541e2d139f0fbaba80a7d4c85", "committedDate": "2020-11-17T15:12:38Z", "message": "Add openHiearchy action to viewmodel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68312a464dc8312a1b496e5e44af29e66f06ef7d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/68312a464dc8312a1b496e5e44af29e66f06ef7d", "committedDate": "2020-11-17T15:12:38Z", "message": "Introduce one method for grabbing answers in FormEntryActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "584c1f9b04d03e992181ecde40fcd79d325f98a8", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/584c1f9b04d03e992181ecde40fcd79d325f98a8", "committedDate": "2020-11-17T15:15:42Z", "message": "Move hierarchy logic to delegate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "684b4d25cca74f1210fd5de8c2449c4638318a64", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/684b4d25cca74f1210fd5de8c2449c4638318a64", "committedDate": "2020-11-17T15:15:45Z", "message": "Make sure swipe handler is called correctly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea3797472bf2dbc031de757f3af684c0c042e71", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/0ea3797472bf2dbc031de757f3af684c0c042e71", "committedDate": "2020-11-17T15:15:45Z", "message": "Add description comments to strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c42e1a23abf0d00d248c1c8a723eca4f40cd6ad", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5c42e1a23abf0d00d248c1c8a723eca4f40cd6ad", "committedDate": "2020-11-17T15:15:45Z", "message": "Make sure audiorecorder tests run on ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e443b05e20b2f0f22a9c79101c449b4d5151f9b7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e443b05e20b2f0f22a9c79101c449b4d5151f9b7", "committedDate": "2020-11-17T15:15:46Z", "message": "Get rid of unneeded cleanUp call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83f5daf691015b6df36a84ca261fdb244999cb6f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/83f5daf691015b6df36a84ca261fdb244999cb6f", "committedDate": "2020-11-17T15:15:46Z", "message": "Use explicit rather than implicit Robolectric application replacement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "415f4ba8f656d5b3e8eb7f730ff670838f7cd328", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/415f4ba8f656d5b3e8eb7f730ff670838f7cd328", "committedDate": "2020-11-17T15:15:46Z", "message": "Move string to correct place"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94f4a4a3cb934c707c4d36cb7b75d8ced8f7c2ca", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/94f4a4a3cb934c707c4d36cb7b75d8ced8f7c2ca", "committedDate": "2020-11-17T15:15:46Z", "message": "Tweak strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e74d586b58a8172a417a1b147d0123ca82b2fc4b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e74d586b58a8172a417a1b147d0123ca82b2fc4b", "committedDate": "2020-11-17T15:15:46Z", "message": "Remove using activity state to keep guidance hint expanded on rotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3edbc6ffb85f21fce9d66bd6ad9510bb71adb78c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/3edbc6ffb85f21fce9d66bd6ad9510bb71adb78c", "committedDate": "2020-11-17T15:15:47Z", "message": "Remove using activity state to save select search term"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5eb994cc4bb2b20a900e6bae7a150d8fd5c3276", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e5eb994cc4bb2b20a900e6bae7a150d8fd5c3276", "committedDate": "2020-11-17T15:15:47Z", "message": "Disable auto saving of search views on select to prevent weirdness when there are multiple on screen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a52b00584827c9ec0270f67f9b4448e488079c84", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/a52b00584827c9ec0270f67f9b4448e488079c84", "committedDate": "2020-11-17T15:15:47Z", "message": "Spike out using view model to cache search query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6096f02f03d6d11421a2e8a011141f906a89bcb6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/6096f02f03d6d11421a2e8a011141f906a89bcb6", "committedDate": "2020-11-17T15:15:47Z", "message": "Remove state saving from widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49e73790d089af08b4a7e613768b430d76e4fd1b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/49e73790d089af08b4a7e613768b430d76e4fd1b", "committedDate": "2020-11-17T15:15:48Z", "message": "Remove references to swipe handle from moveScreen"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a13496203417ceba50c1927cc44c8483f8ad1fee", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/a13496203417ceba50c1927cc44c8483f8ad1fee", "committedDate": "2020-11-17T15:15:48Z", "message": "Move checks into switch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59b0a0a167215b2bcda89047f8a6ccd8031b0417", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/59b0a0a167215b2bcda89047f8a6ccd8031b0417", "committedDate": "2020-11-17T14:56:34Z", "message": "Move checks into switch"}, "afterCommit": {"oid": "a13496203417ceba50c1927cc44c8483f8ad1fee", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/a13496203417ceba50c1927cc44c8483f8ad1fee", "committedDate": "2020-11-17T15:15:48Z", "message": "Move checks into switch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNzUzMTY5", "url": "https://github.com/getodk/collect/pull/4215#pullrequestreview-532753169", "createdAt": "2020-11-17T19:46:28Z", "commit": {"oid": "49e73790d089af08b4a7e613768b430d76e4fd1b"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxOTo0NjoyOFrOH1G1mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxOTo1MDoyM1rOH1HIEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ0ODYwMw==", "bodyText": "Maybe a reason to go with if/else?", "url": "https://github.com/getodk/collect/pull/4215#discussion_r525448603", "createdAt": "2020-11-17T19:46:28Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -1506,7 +1508,11 @@ private void moveScreen(Direction direction) {\n \n                 formEntryViewModel.moveBackward();\n                 formIndexAnimationHandler.handle(formController.getFormIndex());\n-                break;\n+                return true;\n+\n+            default:\n+                // Java switch statements aren't smart enough to know there are only two possibilities", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e73790d089af08b4a7e613768b430d76e4fd1b"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ1MTQ4Mg==", "bodyText": "Why doesn't this also move to moveScreen?", "url": "https://github.com/getodk/collect/pull/4215#discussion_r525451482", "createdAt": "2020-11-17T19:48:53Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/formentry/FormEntryViewModel.java", "diffHunk": "@@ -128,6 +134,44 @@ public boolean canAddRepeat() {\n         }\n     }\n \n+    public void moveForward() {\n+        try {\n+            formController.stepToNextScreenEvent();\n+        } catch (JavaRosaException e) {\n+            error.setValue(e.getCause().getMessage());\n+            return;\n+        }\n+\n+        formController.getAuditEventLogger().flush(); // Close events waiting for an end time\n+    }\n+\n+    public void moveBackward() {\n+        if (formController.getEvent() != FormEntryController.EVENT_BEGINNING_OF_FORM) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a13496203417ceba50c1927cc44c8483f8ad1fee"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ1MzMzMQ==", "bodyText": "This was an oversight when removing the SMS feature. Would be great to remove it entirely at some point.", "url": "https://github.com/getodk/collect/pull/4215#discussion_r525453331", "createdAt": "2020-11-17T19:50:23Z", "author": {"login": "lognaturel"}, "path": "strings/src/main/res/values/strings.xml", "diffHunk": "@@ -525,9 +525,9 @@\n     <string name=\"invalid_email_address\">Invalid email address!</string>\n     <string name=\"sort_by\">Sort by</string>\n     <string name=\"server\">Server</string>\n-<!--\n-    <string name=\"submission_transport_admin_setting\">Submission transport</string>\n--->\n+    <!--", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a13496203417ceba50c1927cc44c8483f8ad1fee"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbe6e4fda287758924d83eda43b3951f0f8422bd", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/dbe6e4fda287758924d83eda43b3951f0f8422bd", "committedDate": "2020-11-18T10:07:31Z", "message": "Convert switch to if"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56d4e394c1574c02bf31a6536d5defad3e743b2d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/56d4e394c1574c02bf31a6536d5defad3e743b2d", "committedDate": "2020-11-18T10:32:14Z", "message": "Remove check for BEGINNING_OF_FORM as we will never be on that event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa183f3fe2d1d491e31db2b7f8daff16cc2364f6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/fa183f3fe2d1d491e31db2b7f8daff16cc2364f6", "committedDate": "2020-11-18T10:43:59Z", "message": "Remove check for repeat that wasn't doing anything"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "350646d7a37a7638187272044c21b781bf995422", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/350646d7a37a7638187272044c21b781bf995422", "committedDate": "2020-11-18T10:48:25Z", "message": "Make d pad calls consistent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjI4MDA0", "url": "https://github.com/getodk/collect/pull/4215#pullrequestreview-533628004", "createdAt": "2020-11-18T16:28:25Z", "commit": {"oid": "350646d7a37a7638187272044c21b781bf995422"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbd048338a76f4488bc4e8fe7a943652a4d5b312", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/dbd048338a76f4488bc4e8fe7a943652a4d5b312", "committedDate": "2020-11-19T12:22:36Z", "message": "Don't let user add repeat when recoridng"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0e95ae81006f92cec2cfdde295e7e7664c8a3e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/fd0e95ae81006f92cec2cfdde295e7e7664c8a3e", "committedDate": "2020-11-20T09:44:26Z", "message": "Fix swipe handler not being called"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5d0f1c6ade457736dbfaea7dc069aa83ce9a50e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e5d0f1c6ade457736dbfaea7dc069aa83ce9a50e", "committedDate": "2020-11-20T09:55:59Z", "message": "Don't allow swiping back on first screen in form"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2464, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}