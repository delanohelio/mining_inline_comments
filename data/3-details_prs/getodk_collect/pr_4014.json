{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNTY5NzA2", "number": 4014, "title": "Fixed enabling/disabling preferences", "bodyText": "Closes #3974\n\nWhat has been done to verify that this works as intended?\nI tested implemented changes manually and added automated tests.\nWhy is this the best possible solution? Were any other approaches considered?\nIt was just a bug we introduced refactoring preferences so I just fixed it and added tests.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nIt just requires testing how settings work when they are enabled/disabled, nothing else should be affected.\nDo we need any specific form for testing your changes? If so, please attach one.\nNo.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-08-05T18:34:31Z", "url": "https://github.com/getodk/collect/pull/4014", "merged": true, "mergeCommit": {"oid": "340dd5833133eb547d6a07d141247a5bd08bb35d"}, "closed": true, "closedAt": "2020-08-24T14:42:36Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8MGGsABqjM2MjgxMjY3NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAlhbTAH2gAyNDYzNTY5NzA2OmNlNjJjNTAwN2EwNmZiMmQyZWZkYzJiMzIyM2U1YjNlMTNlNWQ4NTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10383baab1086b87cfe7a18b08b8b214d30c09a7", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/10383baab1086b87cfe7a18b08b8b214d30c09a7", "committedDate": "2020-08-05T19:14:21Z", "message": "Code improvements"}, "afterCommit": {"oid": "d43ce240f0f0d8798b4262ef72a9a65e242e4d69", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d43ce240f0f0d8798b4262ef72a9a65e242e4d69", "committedDate": "2020-08-06T09:06:33Z", "message": "Code improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMzYyMDkx", "url": "https://github.com/getodk/collect/pull/4014#pullrequestreview-462362091", "createdAt": "2020-08-06T09:35:21Z", "commit": {"oid": "64323d1dd8a3b0112b5fa162890208555a72e127"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwOTozNToyMVrOG8r3hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwOTo0Njo0MFrOG8sdXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI4NjQ3MA==", "bodyText": "Ah nice. These were left over from when they were androidx. and everything else was just android.", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466286470", "createdAt": "2020-08-06T09:35:21Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/preferences/ExperimentalPreferencesFragment.java", "diffHunk": "@@ -6,13 +6,12 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.fragment.app.FragmentActivity;\n-import androidx.preference.PreferenceFragmentCompat;\n \n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.CollectAbstractActivity;\n import org.odk.collect.android.injection.DaggerUtils;\n \n-public class ExperimentalPreferencesFragment extends PreferenceFragmentCompat {\n+public class ExperimentalPreferencesFragment extends BasePreferenceFragment {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64323d1dd8a3b0112b5fa162890208555a72e127"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NDQzMw==", "bodyText": "Are we not losing the adminMode argument here?", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466294433", "createdAt": "2020-08-06T09:43:34Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/preferences/GeneralPreferencesFragment.java", "diffHunk": "@@ -82,22 +82,21 @@ public void onCreate(final Bundle savedInstanceState) {\n     public boolean onPreferenceClick(Preference preference) {\n         if (MultiClickGuard.allowClick(getClass().getName())) {\n             PreferenceFragmentCompat basePreferenceFragment = null;\n-            boolean adminMode = getArguments().getBoolean(INTENT_KEY_ADMIN_MODE, false);\n             switch (preference.getKey()) {\n                 case \"protocol\":\n-                    basePreferenceFragment = ServerPreferencesFragment.newInstance(adminMode);\n+                    basePreferenceFragment = new ServerPreferencesFragment();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cfcdf83c3221ac7ede2fb434ef7e7ba28d8dbbe"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NTg2MQ==", "bodyText": "Can we do a conditional cast here like in BasePreferencesFragment?", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466295861", "createdAt": "2020-08-06T09:46:07Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesFragment.java", "diffHunk": "@@ -45,17 +47,15 @@\n import static org.odk.collect.android.preferences.GeneralKeys.CONSTRAINT_BEHAVIOR_ON_SWIPE;\n import static org.odk.collect.android.preferences.PreferencesActivity.INTENT_KEY_ADMIN_MODE;\n \n-public class AdminPreferencesFragment extends BasePreferenceFragment implements Preference.OnPreferenceClickListener {\n+public class AdminPreferencesFragment extends PreferenceFragmentCompat implements Preference.OnPreferenceClickListener {\n \n     public static final String ADMIN_PREFERENCES = \"admin_prefs\";\n \n     @Override\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n-        super.onCreatePreferences(savedInstanceState, rootKey);\n-\n         getPreferenceManager().setSharedPreferencesName(ADMIN_PREFERENCES);\n-\n         setPreferencesFromResource(R.xml.admin_preferences, rootKey);\n+        ((CollectAbstractActivity) getActivity()).initToolbar(getPreferenceScreen().getTitle());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d395d59aeae2abdcb740baae8b8ea7a4a5cf5289"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NjE1Ng==", "bodyText": "Conditional cast for the child Fragments as well.", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466296156", "createdAt": "2020-08-06T09:46:40Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesFragment.java", "diffHunk": "@@ -144,36 +144,31 @@ public boolean onPreferenceClick(Preference preference) {\n         return false;\n     }\n \n-    public static class MainMenuAccessPreferences extends BasePreferenceFragment {\n-\n+    public static class MainMenuAccessPreferences extends PreferenceFragmentCompat {\n         @Override\n-        public void onCreate(Bundle savedInstanceState) {\n-            super.onCreate(savedInstanceState);\n+        public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n             getPreferenceManager().setSharedPreferencesName(ADMIN_PREFERENCES);\n-\n-            addPreferencesFromResource(R.xml.main_menu_access_preferences);\n+            setPreferencesFromResource(R.xml.main_menu_access_preferences, rootKey);\n+            ((CollectAbstractActivity) getActivity()).initToolbar(getPreferenceScreen().getTitle());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d395d59aeae2abdcb740baae8b8ea7a4a5cf5289"}, "originalPosition": 46}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b61efc6b69fc4b3822542f077854278212e9d78", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3b61efc6b69fc4b3822542f077854278212e9d78", "committedDate": "2020-08-06T12:06:54Z", "message": "Removed duplicated tests"}, "afterCommit": {"oid": "289bb20e6bb4e8b8b95052f3310197f719107eec", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/289bb20e6bb4e8b8b95052f3310197f719107eec", "committedDate": "2020-08-11T23:01:46Z", "message": "Removed duplicated tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NzQ1NzA5", "url": "https://github.com/getodk/collect/pull/4014#pullrequestreview-465745709", "createdAt": "2020-08-12T09:29:30Z", "commit": {"oid": "289bb20e6bb4e8b8b95052f3310197f719107eec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba856215b2d3b57ef832aba7fa04ee40948b4d20", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ba856215b2d3b57ef832aba7fa04ee40948b4d20", "committedDate": "2020-08-18T21:58:08Z", "message": "All preference fragments should extend BasePreferenceFragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28b63a8fcafe68784d83efba237ee2ea537529cf", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/28b63a8fcafe68784d83efba237ee2ea537529cf", "committedDate": "2020-08-18T21:58:08Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88f6fd2f70f7c1d4793fcccd31e6568219d43f7b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/88f6fd2f70f7c1d4793fcccd31e6568219d43f7b", "committedDate": "2020-08-18T21:58:08Z", "message": "Factored out isInAdminMode() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceb275d6c26469aab9b49081024b6ba93dae81af", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ceb275d6c26469aab9b49081024b6ba93dae81af", "committedDate": "2020-08-18T21:58:08Z", "message": "Removed redundant code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4723274f0fb377461acffb407e54a81694f68d69", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4723274f0fb377461acffb407e54a81694f68d69", "committedDate": "2020-08-18T21:58:08Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52c42c9ce1807184b9fdd0fe48f4b2461ff4bfbe", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/52c42c9ce1807184b9fdd0fe48f4b2461ff4bfbe", "committedDate": "2020-08-18T21:58:08Z", "message": "Removed doubled adminMode check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9a309d3d247554a765a8e4236fc4502bfa2e14a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d9a309d3d247554a765a8e4236fc4502bfa2e14a", "committedDate": "2020-08-18T21:58:08Z", "message": "Removed redundant code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1702a667e7e45c7e65610deea25b4e5f21275a0", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a1702a667e7e45c7e65610deea25b4e5f21275a0", "committedDate": "2020-08-18T21:58:08Z", "message": "Factore out getPreferenceFragment() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5f58a6881e2e30b51e56138baa6fe5f7c944320", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b5f58a6881e2e30b51e56138baa6fe5f7c944320", "committedDate": "2020-08-18T21:58:08Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf1c25215c9d8034ba413589e5d5152df4870199", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bf1c25215c9d8034ba413589e5d5152df4870199", "committedDate": "2020-08-18T21:58:08Z", "message": "Removed redundant code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58cd015959d3feed88661376d35771b0ca26c01f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/58cd015959d3feed88661376d35771b0ca26c01f", "committedDate": "2020-08-18T21:58:08Z", "message": "Added UserInterfacePreferencesFragmentTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e39f7681a050996cc82c7f9f5af6abc3aee3ab09", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/e39f7681a050996cc82c7f9f5af6abc3aee3ab09", "committedDate": "2020-08-18T21:58:08Z", "message": "Added tests to FormManagementPreferencesTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "038d3d5e57bc5823aab583f508bbe49c83c26335", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/038d3d5e57bc5823aab583f508bbe49c83c26335", "committedDate": "2020-08-18T21:58:08Z", "message": "Added IdentityPreferencesFragmentTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93d2ba692fc3f145fa36dd0a1de896f585ae3192", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/93d2ba692fc3f145fa36dd0a1de896f585ae3192", "committedDate": "2020-08-18T21:58:08Z", "message": "Added GeneralPreferencesFragmentTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74f5cfa5f560c19ce24a908e8dc3af961f33135c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/74f5cfa5f560c19ce24a908e8dc3af961f33135c", "committedDate": "2020-08-18T21:58:08Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e8cc4a62ebbf2381c08cd04e78bd8ea4f3f2009", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7e8cc4a62ebbf2381c08cd04e78bd8ea4f3f2009", "committedDate": "2020-08-18T21:58:34Z", "message": "Removed redundant code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b5f41417c443812df207ed646ae8ec44f970cca", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9b5f41417c443812df207ed646ae8ec44f970cca", "committedDate": "2020-08-18T21:58:34Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2885133b0b5c7ad6490eaecebbf4c943dd31eda", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c2885133b0b5c7ad6490eaecebbf4c943dd31eda", "committedDate": "2020-08-18T21:58:34Z", "message": "Fixed identyfying AdminPrefernces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4943ce89a2382bcae96ade6d03ebaf248a28c61f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4943ce89a2382bcae96ade6d03ebaf248a28c61f", "committedDate": "2020-08-18T21:58:34Z", "message": "Removed duplicated tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "289bb20e6bb4e8b8b95052f3310197f719107eec", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/289bb20e6bb4e8b8b95052f3310197f719107eec", "committedDate": "2020-08-11T23:01:46Z", "message": "Removed duplicated tests"}, "afterCommit": {"oid": "4943ce89a2382bcae96ade6d03ebaf248a28c61f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4943ce89a2382bcae96ade6d03ebaf248a28c61f", "committedDate": "2020-08-18T21:58:34Z", "message": "Removed duplicated tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3efbf464cb2f1f876f31554809efdd9edf3a0dbe", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3efbf464cb2f1f876f31554809efdd9edf3a0dbe", "committedDate": "2020-08-19T21:42:54Z", "message": "Fixed bug with disappearing preferences in admin settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7bf13b130b2c41b3227ae36905a939774b03638", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b7bf13b130b2c41b3227ae36905a939774b03638", "committedDate": "2020-08-19T23:02:22Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3955ce964bdeaf083a82c0d9384a3cfbfbff0d90", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3955ce964bdeaf083a82c0d9384a3cfbfbff0d90", "committedDate": "2020-08-20T00:29:37Z", "message": "Added tests to AdminPreferencesActivityTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4be50867144f63470ad61cf30a1a41af17431752", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4be50867144f63470ad61cf30a1a41af17431752", "committedDate": "2020-08-20T00:55:07Z", "message": "Added PreferencesActivityTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce62c5007a06fb2d2efdc2b3223e5b3e13e5d859", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ce62c5007a06fb2d2efdc2b3223e5b3e13e5d859", "committedDate": "2020-08-20T01:00:14Z", "message": "Code improvements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2591, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}