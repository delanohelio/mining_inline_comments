{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MTkzNDUw", "number": 4289, "title": "Make sure screen reloads when preferences are changed", "bodyText": "Closes #4212\nWhat has been done to verify that this works as intended?\nNew test and verified manually. There is one piece of tested code - comments inline.\nWhy is this the best possible solution? Were any other approaches considered?\nI think it made sense to handle this generally rather than worrying about it for any new feature in form entry that can be configured.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nThe form \"screen\" will now reload whenever the user navigates to settings and back. It'd be good to check this doesn't create any problems (answers not retained for instance) and that there aren't any significant performance problems introduced.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-12-09T13:49:32Z", "url": "https://github.com/getodk/collect/pull/4289", "merged": true, "mergeCommit": {"oid": "e71db52614e7a25051d2cb42c19c9035d849e905"}, "closed": true, "closedAt": "2020-12-10T09:59:25Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdke4Q7gH2gAyNTM1MTkzNDUwOjE4N2E5MGU0Njc5MWI1NGM4MzE0YWVlODM5MTYxMzE0MWM5YTI4Zjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkgb29AFqTU0ODI5OTU2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "187a90e46791b54c8314aee8391613141c9a28f8", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/187a90e46791b54c8314aee8391613141c9a28f8", "committedDate": "2020-12-09T13:37:07Z", "message": "Make sure screen reloads when preferences are changed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MjAyMDU3", "url": "https://github.com/getodk/collect/pull/4289#pullrequestreview-548202057", "createdAt": "2020-12-09T13:52:29Z", "commit": {"oid": "187a90e46791b54c8314aee8391613141c9a28f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMzo1MjoyOVrOICVp_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMzo1MjoyOVrOICVp_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMyMjg3Nw==", "bodyText": "This isn't tested. I played around with various Espresso tests but couldn't get something that worked nicely and actually drove this out. We still consider FormEntryActivity a no-go for Robolectric testing, so I didn't even look at that.\nThe new Activity Result APIs are really the answer here I think, but they are still in beta. Once that's stable we should be able to move our activity result code into components (like FormEntryMenuDelegate) and test the request and \"response\" in one place.", "url": "https://github.com/getodk/collect/pull/4289#discussion_r539322877", "createdAt": "2020-12-09T13:52:29Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -762,7 +762,7 @@ protected void onActivityResult(int requestCode, int resultCode, final Intent in\n \n         // If we're coming back from the hierarchy view, the user has either tapped the back\n         // button or another question to jump to so we need to rebuild the view.\n-        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY) {\n+        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY || requestCode == RequestCodes.CHANGE_SETTINGS) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "187a90e46791b54c8314aee8391613141c9a28f8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MjEzODk4", "url": "https://github.com/getodk/collect/pull/4289#pullrequestreview-548213898", "createdAt": "2020-12-09T14:04:33Z", "commit": {"oid": "187a90e46791b54c8314aee8391613141c9a28f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDowNDozM1rOICWOXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDowNDozM1rOICWOXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzMjE4OA==", "bodyText": "Can we do the same for font size? Probably we don't even need adjustFontSize() now if we call onScreenRefresh(); either way. Do you want to confirm? If you are in a hurry with this pr we can file a separate issue to make sure changes in settings are handled in the same way.", "url": "https://github.com/getodk/collect/pull/4289#discussion_r539332188", "createdAt": "2020-12-09T14:04:33Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -762,7 +762,7 @@ protected void onActivityResult(int requestCode, int resultCode, final Intent in\n \n         // If we're coming back from the hierarchy view, the user has either tapped the back\n         // button or another question to jump to so we need to rebuild the view.\n-        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY) {\n+        if (requestCode == RequestCodes.HIERARCHY_ACTIVITY || requestCode == RequestCodes.CHANGE_SETTINGS) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "187a90e46791b54c8314aee8391613141c9a28f8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f8367d225ccace400316eca035d2473ad48b39d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5f8367d225ccace400316eca035d2473ad48b39d", "committedDate": "2020-12-09T15:09:43Z", "message": "Remove unneeded font size code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4Mjk5NTY3", "url": "https://github.com/getodk/collect/pull/4289#pullrequestreview-548299567", "createdAt": "2020-12-09T15:25:54Z", "commit": {"oid": "5f8367d225ccace400316eca035d2473ad48b39d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2357, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}