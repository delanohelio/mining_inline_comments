{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NTU4OTYw", "number": 3827, "title": "Fix QR code tests", "bodyText": "This hopefully fixes the QR code tests that were failing in CI.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-05-13T19:14:47Z", "url": "https://github.com/getodk/collect/pull/3827", "merged": true, "mergeCommit": {"oid": "28f33f96f2c59e11039f10a5bbbb3403fd8cbce9"}, "closed": true, "closedAt": "2020-05-13T20:52:33Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg9v6WAH2gAyNDE3NTU4OTYwOmIwZWVmOTg0NmFlYWVmZDg4NmZlMWNjN2I0NzExNTk0ZTdjNGEzNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg_PUygFqTQxMTI5MDM2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b0eef9846aeaefd886fe1cc7b4711594e7c4a354", "committedDate": "2020-05-13T19:08:12Z", "message": "Fix Qr code tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjI1Njgy", "url": "https://github.com/getodk/collect/pull/3827#pullrequestreview-411225682", "createdAt": "2020-05-13T19:16:53Z", "commit": {"oid": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNjo1M1rOGVAAsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNjo1M1rOGVAAsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY3MzQ1OA==", "bodyText": "I only ran into problems with this on my emulator and then couldn't reproduce but I thought it made more sense to use a file path that had nothing to do with how the real object would work. This means it's less likely to clash with anything else and highlights that this is fake/stub.", "url": "https://github.com/getodk/collect/pull/3827#discussion_r424673458", "createdAt": "2020-05-13T19:16:53Z", "author": {"login": "seadowg"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/preferences/qr/ConfigureWithQRCodeTest.java", "diffHunk": "@@ -168,19 +167,19 @@ public Bitmap generateQRBitMap(String data, int sideLength) throws IOException,\n             return Observable.create(emitter -> {\n                 Bitmap bitmap =\n                         BitmapFactory.decodeResource(\n-                                ApplicationProvider.getApplicationContext().getResources(),\n+                                getApplicationContext().getResources(),\n                                 CHECKER_BACKGROUND_DRAWABLE_ID);\n                 emitter.onNext(bitmap);\n+                FileUtils.saveBitmapToFile(bitmap, getQrCodeFilepath());\n \n                 // save bitmap to test that shareQRCode generates bitmap if file not there\n-                FileUtils.saveBitmapToFile(bitmap, getQrCodeFilepath());\n                 emitter.onComplete();\n             });\n         }\n \n         @Override\n         public String getQrCodeFilepath() {\n-            return new StoragePathProvider().getDirPath(StorageSubdirectory.SETTINGS) + File.separator + \"test-collect-settings.png\";\n+            return getApplicationContext().getExternalFilesDir(null) + File.separator + \"test-collect-settings.png\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354"}, "originalPosition": 143}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjI1ODc5", "url": "https://github.com/getodk/collect/pull/3827#pullrequestreview-411225879", "createdAt": "2020-05-13T19:17:11Z", "commit": {"oid": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNzoxMVrOGVABNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNzoxMVrOGVABNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY3MzU4OA==", "bodyText": "Moved this up as it made more sense to me to asser this up front", "url": "https://github.com/getodk/collect/pull/3827#discussion_r424673588", "createdAt": "2020-05-13T19:17:11Z", "author": {"login": "seadowg"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/preferences/qr/ConfigureWithQRCodeTest.java", "diffHunk": "@@ -132,14 +130,18 @@ public void onMainMenu_clickConfigureQRCode_andClickingOnShareQRCode_startsExter\n                 .clickConfigureQR()\n                 .clickOnId(R.id.menu_item_share);\n \n+        // Check that we've actually generated a QR code to share\n+        File qrcodeFile = new File(path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjkwMzYw", "url": "https://github.com/getodk/collect/pull/3827#pullrequestreview-411290360", "createdAt": "2020-05-13T20:52:25Z", "commit": {"oid": "b0eef9846aeaefd886fe1cc7b4711594e7c4a354"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2684, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}