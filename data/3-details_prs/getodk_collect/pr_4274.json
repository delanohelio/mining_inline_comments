{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNjgxMjc5", "number": 4274, "title": "Fixed creating multiple files for recording selfie videos", "bodyText": "Closes #4268\nWhat has been done to verify that this works as intended?\nI tested the fix manually.\nWhy is this the best possible solution? Were any other approaches considered?\nThe problem was that we created a new tmp file for every recording https://github.com/getodk/collect/compare/master...grzesiek2010:COLLECT-4268?expand=1#diff-f63fc4d1f7f735577c9fb1d0cb030deff5c0c4693005671cd7352cdf8a359a85L129 which we didn't remove. I decided to use the same solution we have for image files where we create a reusable tmp file in cache directory https://github.com/getodk/collect/compare/master...grzesiek2010:COLLECT-4268?expand=1#diff-305ec7a913eed2277d0af06a536383d929631be636da49be48e21df4bfb625d4R87\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nWith the fix the app should use a reusable tmp file for recording selfie videos instead of creating a new file in the app directory.\nIt's a safe and isolate change so we can test just the behavior described in the issue.\nI also implemented code improvements touching the DrawWidget so please make sure answers are saved witout regression (no need to test changing colors or something just saving output images)\nDo we need any specific form for testing your changes? If so, please attach one.\nAny form with selfie video widget like the demo All widgets form.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-12-07T13:47:11Z", "url": "https://github.com/getodk/collect/pull/4274", "merged": true, "mergeCommit": {"oid": "fbf4202cf12b1136a85787e8dc0d8fdd1c5ce590"}, "closed": true, "closedAt": "2020-12-08T10:54:50Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj1GOQgH2gAyNTMzNjgxMjc5OmE4ODI2NmNjMjBlM2NmMjk2ZWZhOGU2YWU0YWRjOTZkM2E1NjcxMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj9kMyAFqTU0NjYwMzYwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a88266cc20e3cf296efa8e6ae4adc96d3a567116", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a88266cc20e3cf296efa8e6ae4adc96d3a567116", "committedDate": "2020-12-07T12:56:21Z", "message": "Use one reusable temp video file for recording selfie videos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82989ceb2b62d38ce4aac646a35927f4766d427d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/82989ceb2b62d38ce4aac646a35927f4766d427d", "committedDate": "2020-12-07T13:01:12Z", "message": "Removed unused code from CameraUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea54db15e793d4ae35d8304d18ce32b6aa63941c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ea54db15e793d4ae35d8304d18ce32b6aa63941c", "committedDate": "2020-12-07T13:04:12Z", "message": "Removed duplicated tmp file path for drawings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "277e217f110903c7f6269659c87424bca96939aa", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/277e217f110903c7f6269659c87424bca96939aa", "committedDate": "2020-12-07T13:05:03Z", "message": "Naming improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MzM5MTU2", "url": "https://github.com/getodk/collect/pull/4274#pullrequestreview-546339156", "createdAt": "2020-12-07T16:51:25Z", "commit": {"oid": "a88266cc20e3cf296efa8e6ae4adc96d3a567116"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjo1MToyNVrOIAwRhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjo1MjozOVrOIAwVPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2MTgyOQ==", "bodyText": "If you're going to be creating a new StoragePathProvider here anyway I think you can do away with the indirection and just use new StoragePathProvider().getTmpVideoPath() inline.", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537661829", "createdAt": "2020-12-07T16:51:25Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/CameraUtils.java", "diffHunk": "@@ -123,10 +124,8 @@ public static void savePhoto(String path, byte[] data) {\n             Timber.e(e);\n         }\n     }\n-  \n-    public static String getVideoFilePath(Context context) {\n-        final File dir = context.getExternalFilesDir(null);\n-        return (dir == null ? \"\" : (dir.getAbsolutePath() + \"/\"))\n-                + System.currentTimeMillis() + \".mp4\";\n+\n+    public static String getVideoFilePath() {\n+        return new StoragePathProvider().getTmpVideoPath();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a88266cc20e3cf296efa8e6ae4adc96d3a567116"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2Mjc4MQ==", "bodyText": "This is an existing issue but still want to highlight it. I don't think we know the image is a jpg. It could be a png, bmp, ... We should fix this at some point. Maybe a separate issue?", "url": "https://github.com/getodk/collect/pull/4274#discussion_r537662781", "createdAt": "2020-12-07T16:52:39Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StoragePathProvider.java", "diffHunk": "@@ -79,11 +79,11 @@ public String getStorageRootDirPath() {\n                 : getUnscopedStorageRootDirPath();\n     }\n \n-    public String getTmpFilePath() {\n+    public String getTmpImageFilePath() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "277e217f110903c7f6269659c87424bca96939aa"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dce1b364eecaeb64a4b778c5674c8eb19e1c2bc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9dce1b364eecaeb64a4b778c5674c8eb19e1c2bc", "committedDate": "2020-12-07T22:36:53Z", "message": "Code improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjAzNjAy", "url": "https://github.com/getodk/collect/pull/4274#pullrequestreview-546603602", "createdAt": "2020-12-07T22:48:21Z", "commit": {"oid": "9dce1b364eecaeb64a4b778c5674c8eb19e1c2bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2504, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}