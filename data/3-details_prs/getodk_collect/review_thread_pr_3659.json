{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDkyMTg1", "number": 3659, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzozMTowOFrODkWzzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODozNzoyMVrODkYJqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDQ5MDM5OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzozMTowOFrOFwoeBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzozNDo0MVrOFwolhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTAxNQ==", "bodyText": "How did you decide to remove the v? We have the v prefix everywhere that we show a Collect version including GitHub releases, the forum, the Play Store release notes, etc. That's the case across all ODK tools. I like the consistency and would personally keep the v in.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386539015", "createdAt": "2020-03-02T17:31:08Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);\n+\n+        if (split.length > 1) {\n+            return split[1];\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    private String versionNameWithoutPrefix() {\n+        return BuildConfig.VERSION_NAME.split(\"v\")[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU0MDkzNQ==", "bodyText": "Yeah no strong feeling really. Will change this.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386540935", "createdAt": "2020-03-02T17:34:41Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);\n+\n+        if (split.length > 1) {\n+            return split[1];\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    private String versionNameWithoutPrefix() {\n+        return BuildConfig.VERSION_NAME.split(\"v\")[1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTAxNQ=="}, "originalCommit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDQ5NjQ1OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzozMjo1MlrOFwohzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNzozNjoxNVrOFwoosQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTk4MQ==", "bodyText": "This means that for beta versions the beta will be at the bottom of the screen. I think of the beta as being part of the version (e.g. we put v1.26.0-beta.0 in the release notes) and I think it's helpful to have up top.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386539981", "createdAt": "2020-03-02T17:32:52Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU0MTc0NQ==", "bodyText": "Make sense. I'll change it!", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386541745", "createdAt": "2020-03-02T17:36:15Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModel.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.ViewModel;\n+\n+import org.odk.collect.android.BuildConfig;\n+\n+public class MainMenuViewModel extends ViewModel {\n+\n+    public String getVersion() {\n+        return versionNameWithoutPrefix().split(\"-\")[0];\n+    }\n+\n+    @Nullable\n+    public String getVersionSHA() {\n+        String[] split = versionNameWithoutPrefix().split(\"-\", 2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUzOTk4MQ=="}, "originalCommit": {"oid": "e51d004d4a8cd5a5f8d936e7ef0831f79722bdb9"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDcxMDE5OnYy", "diffSide": "RIGHT", "path": "collect_app/src/test/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModelTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODozNzoyMVrOFwqmdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODo0MDo0OVrOFwqtxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mzk0MA==", "bodyText": "Nice! These tests end up looking really nice.\nI probably would have pushed all the methods now in the view model into the version provider class and kept the view model super thin so that tests wouldn't need Robolectric and to limit the dependence on Android-specific components for paranoia reasons but I do like how all this ends up looking.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386573940", "createdAt": "2020-03-02T18:37:21Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/test/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModelTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class MainMenuViewModelTest {\n+\n+    @Test\n+    public void version_whenRelease_returnsSemanticVersionWithPrefix() {\n+        MainMenuViewModel viewModel = new MainMenuViewModel(() -> \"v1.1.7\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42e75e433fa2627207ce5bafec3330ca0a7ce340"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3NTU0Mg==", "bodyText": "Yeah another step would be to extract a VersionDescriptionParser to deal with all this (and move the tests there) but I don't think that's worth it until the ViewModel is doing other things.", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386575542", "createdAt": "2020-03-02T18:40:24Z", "author": {"login": "seadowg"}, "path": "collect_app/src/test/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModelTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class MainMenuViewModelTest {\n+\n+    @Test\n+    public void version_whenRelease_returnsSemanticVersionWithPrefix() {\n+        MainMenuViewModel viewModel = new MainMenuViewModel(() -> \"v1.1.7\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mzk0MA=="}, "originalCommit": {"oid": "42e75e433fa2627207ce5bafec3330ca0a7ce340"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3NTgxMw==", "bodyText": "Makes sense!", "url": "https://github.com/getodk/collect/pull/3659#discussion_r386575813", "createdAt": "2020-03-02T18:40:49Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/test/java/org/odk/collect/android/activities/viewmodels/MainMenuViewModelTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package org.odk.collect.android.activities.viewmodels;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class MainMenuViewModelTest {\n+\n+    @Test\n+    public void version_whenRelease_returnsSemanticVersionWithPrefix() {\n+        MainMenuViewModel viewModel = new MainMenuViewModel(() -> \"v1.1.7\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mzk0MA=="}, "originalCommit": {"oid": "42e75e433fa2627207ce5bafec3330ca0a7ce340"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3496, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}