{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NTg1NDcy", "number": 3749, "title": "Keep logging analytics in one class", "bodyText": "What has been done to verify that this works as intended?\nI reviewed implemented changes and also tested some random places where we log events using adb (according to the documentation: https://firebase.google.com/docs/analytics/get-started?platform=android)\nWhy is this the best possible solution? Were any other approaches considered?\nSome time ago we have added FirebaseAnalytics class and moved methods responsible for logging events there but we have never cleaned the whole project so we ended up with duplicated code in the Collect class.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nI'm not sure if testing is required here. Maybe just reviewing from another contributor would be enough? I don't find this pr very risky.\nDo we need any specific form for testing your changes? If so, please attach one.\nNo.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-03-30T11:22:46Z", "url": "https://github.com/getodk/collect/pull/3749", "merged": true, "mergeCommit": {"oid": "1da8f97ba3f015e6015805e41adab2df8957b0ed"}, "closed": true, "closedAt": "2020-03-31T11:33:12Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSrhsDAH2gAyMzk1NTg1NDcyOjE0ZDViNGMxM2RhMzBiZWY4YzcxN2IyMWEyOTY2ODRlMzIzYTEzNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTBcjQAFqTM4NDY0MjM0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "14d5b4c13da30bef8c717b21a296684e323a1351", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/14d5b4c13da30bef8c717b21a296684e323a1351", "committedDate": "2020-03-30T09:59:26Z", "message": "Inject analytics to AutoSendWorker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "968dc3363d67c74ec078b47623e5a9ba95a0e86a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/968dc3363d67c74ec078b47623e5a9ba95a0e86a", "committedDate": "2020-03-30T09:59:26Z", "message": "Use injected analytics in FormEntryActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bdcfe3d48ca0c1b207c64ef71cc406ffb28c82d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6bdcfe3d48ca0c1b207c64ef71cc406ffb28c82d", "committedDate": "2020-03-30T09:59:26Z", "message": "Inject analytics to SplashScreenActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3e7fa60503349665ba9a846d007830136772959", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f3e7fa60503349665ba9a846d007830136772959", "committedDate": "2020-03-30T09:59:26Z", "message": "Use injected analytics in InstanceServerUploaderTask"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8134e17548bfcfd33ae39dd22b564a62e755e879", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/8134e17548bfcfd33ae39dd22b564a62e755e879", "committedDate": "2020-03-30T09:59:26Z", "message": "Inject analytics to FormHierarchyActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55cbaf6f8675c34b9c0895b3e3cf57228973e36d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/55cbaf6f8675c34b9c0895b3e3cf57228973e36d", "committedDate": "2020-03-30T09:59:26Z", "message": "Inject analytics to FormManagementPreferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3a575262d16f8e34593e9f951551d0a965ecf72", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a3a575262d16f8e34593e9f951551d0a965ecf72", "committedDate": "2020-03-30T10:16:08Z", "message": "Commented out analytics in SmsService since it's unused"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a9f3b0f23e6200c5b56a2d8cf9c485e0c2ff8a4", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4a9f3b0f23e6200c5b56a2d8cf9c485e0c2ff8a4", "committedDate": "2020-03-30T10:16:17Z", "message": "Inject analytics to GoogleSheetsUploaderActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f538260c43ca261382027a334a4d40924b31c007", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f538260c43ca261382027a334a4d40924b31c007", "committedDate": "2020-03-30T10:16:17Z", "message": "Pass analytics to SaveFormToDisk class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43c6ad4fcd0eab5e2875de04b907d53c004c5939", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/43c6ad4fcd0eab5e2875de04b907d53c004c5939", "committedDate": "2020-03-30T10:32:00Z", "message": "Moved rest of the code related to analytics from Collect to FirebaseAnalytics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a38bd6f6fd5f73c8e36e6fa3fd5ebca3812db236", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a38bd6f6fd5f73c8e36e6fa3fd5ebca3812db236", "committedDate": "2020-03-30T10:46:59Z", "message": "Fixed FormSaveViewModelTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzOTA5ODMy", "url": "https://github.com/getodk/collect/pull/3749#pullrequestreview-383909832", "createdAt": "2020-03-30T14:26:41Z", "commit": {"oid": "a38bd6f6fd5f73c8e36e6fa3fd5ebca3812db236"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoyNjo0MVrOF9sZBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoyNjo0MVrOF9sZBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzNDc1OA==", "bodyText": "This could be constructor dependency right? Then there doesn't need to be any nullability risk in the object.", "url": "https://github.com/getodk/collect/pull/3749#discussion_r400234758", "createdAt": "2020-03-30T14:26:41Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -430,6 +430,7 @@ private void setupViewModels() {\n                 .of(this, changesReasonViewModelFactory)\n                 .get(FormSaveViewModel.class);\n \n+        formSaveViewModel.setAnalytics(analytics);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a38bd6f6fd5f73c8e36e6fa3fd5ebca3812db236"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f90d9a72a6b6b50d3c671aac62b81b93812a562f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f90d9a72a6b6b50d3c671aac62b81b93812a562f", "committedDate": "2020-03-31T09:25:19Z", "message": "Fixed bug in FormEntryActivity - inject should be called first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22052df9873e0a0067652c91dda2554fb02efdcf", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/22052df9873e0a0067652c91dda2554fb02efdcf", "committedDate": "2020-03-31T09:39:22Z", "message": "Pass analytics to FormSaveViewModel via constructor"}, "afterCommit": {"oid": "359799ccb5401182e53c869dbf5dad721d9428fc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/359799ccb5401182e53c869dbf5dad721d9428fc", "committedDate": "2020-03-31T09:46:41Z", "message": "Pass analytics to FormSaveViewModel via constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7798fddbb19ca54c51ffc1471a56d39972a807a2", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7798fddbb19ca54c51ffc1471a56d39972a807a2", "committedDate": "2020-03-31T09:56:05Z", "message": "Pass analytics to FormSaveViewModel via constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "359799ccb5401182e53c869dbf5dad721d9428fc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/359799ccb5401182e53c869dbf5dad721d9428fc", "committedDate": "2020-03-31T09:46:41Z", "message": "Pass analytics to FormSaveViewModel via constructor"}, "afterCommit": {"oid": "7798fddbb19ca54c51ffc1471a56d39972a807a2", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7798fddbb19ca54c51ffc1471a56d39972a807a2", "committedDate": "2020-03-31T09:56:05Z", "message": "Pass analytics to FormSaveViewModel via constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NjQyMzQy", "url": "https://github.com/getodk/collect/pull/3749#pullrequestreview-384642342", "createdAt": "2020-03-31T11:31:44Z", "commit": {"oid": "7798fddbb19ca54c51ffc1471a56d39972a807a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2756, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}