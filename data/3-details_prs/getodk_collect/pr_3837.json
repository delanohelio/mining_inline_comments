{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NDc2OTUx", "number": 3837, "title": "Fix app crashing during form load", "bodyText": "Closes #3836. This stops the app crashing when loading any form.\nThe core problem ended up being that DialogFragment#getLayoutInflater contains a call to DialogFragment#onCreateDialog which is where we were calling it from.\nWhy weren't we seeing this on master? Basically the Fragment dependency (androix.app.fragment) was diffferent in our debug and release builds. This was because we we using the Fragment Testing dependency which uses debugImplementation rather than testImplementation (I'd imagine for scary reasons). Our fragment-testing dependency was set to version 1.2.3 which meant that in debug versions of the app we'd be using fragment:1.2.3 where as in release versions of the app we were (implicitly through Jetifier) getting fragment:1.2.0. fragment:1.2.3 does not have the problem (looks like the getLayoutInflater code is wrapped in a catch all try which is urrrghhh) but fragment:1.2.0 does.\nWhat has been done to verify that this works as intended?\nI first made it so the crash occured on debug as well by adding an explicit fragment dependency and setting both it and the fragment-testing dep to version 1.2.0. Tests then failed due to the crash.\nI've also made it so the fragment version is set using a variable in gradle which means our debug/release versions should stay the same. This doesn't fix any bugs with Fragments but it makes sure if we run into any they happen in debug and release.\nWhy is this the best possible solution? Were any other approaches considered?\nWe could just have upgraded to 1.2.3 but I also wanted to protect from this happening again if the problem reappears in the Android lib. Using the Activity's LayoutInflater seemed to be a nice change and is also what the docs do in https://developer.android.com/guide/topics/ui/dialogs#CustomLayout.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nShould just fix the crash!\nDo we need any specific form for testing your changes? If so, please attach one.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-05-15T09:22:38Z", "url": "https://github.com/getodk/collect/pull/3837", "merged": true, "mergeCommit": {"oid": "300ee3a284774e09512f054b1dca4884f000ad55"}, "closed": true, "closedAt": "2020-05-15T14:05:21Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchehFGAH2gAyNDE4NDc2OTUxOjcwZTI4Y2VmNmQzYjBhMzhkNjMxNTE0ZTRlNDAxZWQ3N2E2MDljZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchiQ5ugFqTQxMjY1ODk4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "70e28cef6d3b0a38d631514e4e401ed77a609cd9", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/70e28cef6d3b0a38d631514e4e401ed77a609cd9", "committedDate": "2020-05-15T09:18:52Z", "message": "Make sure debug app crashes due to #3836"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76c7be86d60a6b28c713e329ae71f963e12794eb", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/76c7be86d60a6b28c713e329ae71f963e12794eb", "committedDate": "2020-05-15T09:20:54Z", "message": "Fix crash on loading form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "109220ac49b89e94f7bf6e38f337c084737bbefb", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/109220ac49b89e94f7bf6e38f337c084737bbefb", "committedDate": "2020-05-15T10:09:38Z", "message": "Update fragment version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjA0MDkx", "url": "https://github.com/getodk/collect/pull/3837#pullrequestreview-412604091", "createdAt": "2020-05-15T12:30:40Z", "commit": {"oid": "109220ac49b89e94f7bf6e38f337c084737bbefb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjozMDo0MFrOGWC1kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjozMDo0MFrOGWC1kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc2ODMzOQ==", "bodyText": "Can we fallow the same approach like in case of daggerVersion and okhttp3Version and keep the version in https://github.com/getodk/collect/blob/master/build.gradle#L64?", "url": "https://github.com/getodk/collect/pull/3837#discussion_r425768339", "createdAt": "2020-05-15T12:30:40Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/build.gradle", "diffHunk": "@@ -199,6 +199,8 @@ configurations.all {\n }\n \n dependencies {\n+    def fragment_version = \"1.2.4\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "109220ac49b89e94f7bf6e38f337c084737bbefb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71e03466d26cb357d119a38445e3aab17285fdc5", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/71e03466d26cb357d119a38445e3aab17285fdc5", "committedDate": "2020-05-15T13:37:54Z", "message": "Moved fragment version to build.gradle.ext"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjU4OTgx", "url": "https://github.com/getodk/collect/pull/3837#pullrequestreview-412658981", "createdAt": "2020-05-15T13:40:49Z", "commit": {"oid": "71e03466d26cb357d119a38445e3aab17285fdc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2694, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}