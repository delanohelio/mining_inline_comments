{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczODYzNzI4", "number": 3637, "title": "Scan Qr code main menu button", "bodyText": "Based on https://forum.opendatakit.org/t/add-button-to-import-collect-settings-on-collect-main-menu/23876/7 feature request.\nThis feature adds a Scan QR code button in the overflow menu that can be hidden in the main menu settings. This feature was modified based on the feedback received the forum post comments.\nWhat has been done to verify that this works as intended?\nWhy is this the best possible solution? Were any other approaches considered?\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nDo we need any specific form for testing your changes? If so, please attach one.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-02-11T20:25:38Z", "url": "https://github.com/getodk/collect/pull/3637", "merged": true, "mergeCommit": {"oid": "784234fc344c0081c11f08ad88e9c1dd3018c5b2"}, "closed": true, "closedAt": "2020-03-03T16:54:00Z", "author": {"login": "andrewsiew2"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcERPOsAFqTM1OTAxOTkwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJ65FpgFqTM2NzcwMDU2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MDE5OTA0", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-359019904", "createdAt": "2020-02-14T15:26:48Z", "commit": {"oid": "5586fa57f819fd884e8c5d8a42bb0c9e2c942763"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5ODExMDg0", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-359811084", "createdAt": "2020-02-17T15:21:11Z", "commit": {"oid": "57b7fb49a4559056604d6dc04c2a0479be5424b4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5ODkxODY2", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-359891866", "createdAt": "2020-02-17T17:37:08Z", "commit": {"oid": "57b7fb49a4559056604d6dc04c2a0479be5424b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNzozNzowOFrOFqsCAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNzozNzowOFrOFqsCAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMwNTkyMw==", "bodyText": "You can remove this resource and use import_settings instead. In fact, I recommend renaming that resource to configure_via_qr_code.", "url": "https://github.com/getodk/collect/pull/3637#discussion_r380305923", "createdAt": "2020-02-17T17:37:08Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/res/values/strings.xml", "diffHunk": "@@ -506,7 +507,7 @@\n     <string name=\"qrcode_without_passwords\">This QR code does not contain your admin or server passwords. \\n(Tap to add the passwords)</string>\n     <string name=\"qrcode_with_admin_password\">This QR code includes your admin password. Please treat it carefully. \\n(Tap to remove the password)</string>\n     <string name=\"qrcode_with_server_password\">This QR code includes your server password. \\n(Tap to remove the passwords)</string>\n-    <string name=\"import_export_settings\">Configure via QR Code</string>\n+    <string name=\"import_export_settings\">Configure via QR code</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57b7fb49a4559056604d6dc04c2a0479be5424b4"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac3322d1b99b71bc3bf08bf6cbe92ac84790f37e", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/ac3322d1b99b71bc3bf08bf6cbe92ac84790f37e", "committedDate": "2020-02-18T19:56:28Z", "message": "qr code menu item and visibility"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57b7fb49a4559056604d6dc04c2a0479be5424b4", "author": {"user": null}, "url": "https://github.com/getodk/collect/commit/57b7fb49a4559056604d6dc04c2a0479be5424b4", "committedDate": "2020-02-14T18:25:43Z", "message": "fix some merge error"}, "afterCommit": {"oid": "ac3322d1b99b71bc3bf08bf6cbe92ac84790f37e", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/ac3322d1b99b71bc3bf08bf6cbe92ac84790f37e", "committedDate": "2020-02-18T19:56:28Z", "message": "qr code menu item and visibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49800b42d860298b6ca85a7b405c31a16e98fc17", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/49800b42d860298b6ca85a7b405c31a16e98fc17", "committedDate": "2020-02-19T04:20:37Z", "message": "ScanQRCodeActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5dabbca11dbdbdfa5cbf3745c8220fc811a8bb9", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/f5dabbca11dbdbdfa5cbf3745c8220fc811a8bb9", "committedDate": "2020-02-19T04:49:57Z", "message": "successful qrscan to Server Preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca0cf79471737900ca3240306f3392a00f03d661", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/ca0cf79471737900ca3240306f3392a00f03d661", "committedDate": "2020-02-19T05:11:29Z", "message": "remove unused imports/fix style issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b59395678f41bb91a73aa9857dfbaf14f96c7826", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/b59395678f41bb91a73aa9857dfbaf14f96c7826", "committedDate": "2020-02-19T08:44:44Z", "message": "Revert \"successful qrscan to Server Preferences\"\n\nThis reverts commit f5dabbca11dbdbdfa5cbf3745c8220fc811a8bb9."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "784375de3c781867c1c99c315fd21152295115ae", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/784375de3c781867c1c99c315fd21152295115ae", "committedDate": "2020-02-19T08:47:33Z", "message": "remove import_export_settings string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4107bab55ecd05aebe0458d046411960b93fb44b", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/4107bab55ecd05aebe0458d046411960b93fb44b", "committedDate": "2020-02-19T21:41:03Z", "message": "add test for press qr code menu item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15b3bd956c4d42728296db027c11ad1f411f1e39", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/15b3bd956c4d42728296db027c11ad1f411f1e39", "committedDate": "2020-02-20T00:05:31Z", "message": "fix ScanQRCodeActivity and add MainMenuSettingsTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODY5Njg4", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-362869688", "createdAt": "2020-02-21T19:38:21Z", "commit": {"oid": "15b3bd956c4d42728296db027c11ad1f411f1e39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTozODoyMVrOFtCXNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTozODoyMVrOFtCXNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc2ODk0OA==", "bodyText": "We have some nice abstractions that you can use in MainMenuPage that will make this test even cleaner.", "url": "https://github.com/getodk/collect/pull/3637#discussion_r382768948", "createdAt": "2020-02-21T19:38:21Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/settings/MainMenuSettingsTest.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package org.odk.collect.android.settings;\n+\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.MainMenuActivity;\n+\n+import androidx.test.espresso.Espresso;\n+import androidx.test.filters.LargeTest;\n+import androidx.test.rule.ActivityTestRule;\n+import androidx.test.runner.AndroidJUnit4;\n+\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.Espresso.openActionBarOverflowOrOptionsMenu;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.doesNotExist;\n+import static androidx.test.espresso.matcher.ViewMatchers.withText;\n+import static androidx.test.platform.app.InstrumentationRegistry.getInstrumentation;\n+\n+@RunWith(AndroidJUnit4.class)\n+@LargeTest\n+public class MainMenuSettingsTest {\n+    @Rule\n+    public ActivityTestRule<MainMenuActivity> activityRule =\n+            new ActivityTestRule<>(MainMenuActivity.class);\n+\n+    @Test\n+    public void configureWithQRCanBeDisabled() {\n+        openActionBarOverflowOrOptionsMenu(getInstrumentation().getTargetContext());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15b3bd956c4d42728296db027c11ad1f411f1e39"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODg0ODYy", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-362884862", "createdAt": "2020-02-21T20:04:45Z", "commit": {"oid": "15b3bd956c4d42728296db027c11ad1f411f1e39"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a856959b9cf4e44e6ef7264c133c74e05a89b06", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/9a856959b9cf4e44e6ef7264c133c74e05a89b06", "committedDate": "2020-02-21T22:38:56Z", "message": "prompt admin password prompt for qrcode menu item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3a290e59ff821e94b96d3ae7bdfecfcbe11b6e5", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/b3a290e59ff821e94b96d3ae7bdfecfcbe11b6e5", "committedDate": "2020-02-21T22:57:53Z", "message": "testing for disabling qrcode menu iitem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6b1bc87d9992f4e8aa73fb2df8d7ab3f6311fa1", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/a6b1bc87d9992f4e8aa73fb2df8d7ab3f6311fa1", "committedDate": "2020-02-22T22:08:59Z", "message": "fix null adminPreferences in robolectric tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/2c07e06668e9a698f8b92788be7295b31c0b746a", "committedDate": "2020-02-22T22:45:38Z", "message": "fix style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTUxNjAy", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-363951602", "createdAt": "2020-02-25T08:37:33Z", "commit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODozNzozM1rOFt801A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwOTowOToyOFrOFt91Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyNjgwNA==", "bodyText": "You can delete this annotation. Google always uses in it examples but we don't split our tests by size so it's not somthing we need!", "url": "https://github.com/getodk/collect/pull/3637#discussion_r383726804", "createdAt": "2020-02-25T08:37:33Z", "author": {"login": "seadowg"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/settings/MainMenuSettingsTest.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.odk.collect.android.settings;\n+\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.MainMenuActivity;\n+import org.odk.collect.android.support.pages.AdminSettingsPage;\n+import org.odk.collect.android.support.pages.MainMenuPage;\n+\n+import androidx.test.filters.LargeTest;\n+import androidx.test.rule.ActivityTestRule;\n+import androidx.test.runner.AndroidJUnit4;\n+\n+@RunWith(AndroidJUnit4.class)\n+@LargeTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyODc1MQ==", "bodyText": "Pretty much all our tests need permissions granted to run on fresh devices and so the test doesn't get polluted by others (another test bmight disable the QR code configuration for instance) you need to clear state before running the test. To do so you can add this rule chain:\n@Rule\npublic RuleChain copyFormChain = RuleChain\n    .outerRule(GrantPermissionRule.grant(\n        Manifest.permission.READ_EXTERNAL_STORAGE,\n        Manifest.permission.WRITE_EXTERNAL_STORAGE,\n        Manifest.permission.READ_PHONE_STATE\n    ))\n    .around(new ResetStateRule());", "url": "https://github.com/getodk/collect/pull/3637#discussion_r383728751", "createdAt": "2020-02-25T08:41:22Z", "author": {"login": "seadowg"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/settings/MainMenuSettingsTest.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.odk.collect.android.settings;\n+\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.MainMenuActivity;\n+import org.odk.collect.android.support.pages.AdminSettingsPage;\n+import org.odk.collect.android.support.pages.MainMenuPage;\n+\n+import androidx.test.filters.LargeTest;\n+import androidx.test.rule.ActivityTestRule;\n+import androidx.test.runner.AndroidJUnit4;\n+\n+@RunWith(AndroidJUnit4.class)\n+@LargeTest\n+public class MainMenuSettingsTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyOTM0Mw==", "bodyText": "Also I think we should call this test MainMenuTest for now", "url": "https://github.com/getodk/collect/pull/3637#discussion_r383729343", "createdAt": "2020-02-25T08:42:30Z", "author": {"login": "seadowg"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/settings/MainMenuSettingsTest.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.odk.collect.android.settings;\n+\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.MainMenuActivity;\n+import org.odk.collect.android.support.pages.AdminSettingsPage;\n+import org.odk.collect.android.support.pages.MainMenuPage;\n+\n+import androidx.test.filters.LargeTest;\n+import androidx.test.rule.ActivityTestRule;\n+import androidx.test.runner.AndroidJUnit4;\n+\n+@RunWith(AndroidJUnit4.class)\n+@LargeTest\n+public class MainMenuSettingsTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyODc1MQ=="}, "originalCommit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczMzEzMA==", "bodyText": "This should really be initialized in onCreate as onOptionsItemSelected won't be called until someone clicks on a menu item. This means adminPreferences will have a high likelyhood of being null if someone tries to call it somewhere else.\nI'm guessing this was causing problems in your test? I've got some ideas around fixing that but I'll leave them on the test \ud83d\ude01", "url": "https://github.com/getodk/collect/pull/3637#discussion_r383733130", "createdAt": "2020-02-25T08:50:02Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/MainMenuActivity.java", "diffHunk": "@@ -357,21 +356,38 @@ protected void onPause() {\n     @Override\n     public boolean onCreateOptionsMenu(Menu menu) {\n         getMenuInflater().inflate(R.menu.main_menu, menu);\n+        qrcodeScannerMenuItem = menu.findItem(R.id.menu_configure_qr_code);\n         return super.onCreateOptionsMenu(menu);\n     }\n \n+    @Override\n+    public boolean onPrepareOptionsMenu(Menu menu) {\n+        qrcodeScannerMenuItem.setVisible(this.getSharedPreferences(AdminPreferencesActivity.ADMIN_PREFERENCES, 0).getBoolean(AdminKeys.KEY_QR_CODE_SCANNER, true));\n+        return super.onPrepareOptionsMenu(menu);\n+    }\n+\n     @Override\n     public boolean onOptionsItemSelected(MenuItem item) {\n+        SharedPreferences adminPreferences = this.getSharedPreferences(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc0MTQ1OQ==", "bodyText": "I had never seen this test file! Well done on finding it. I think it's good that you've followed the style set by the file but it's a little unusual compared to the tests we'd usually write. Generally we try and be as descriptive as possible in our test names rather than using JavaDoc. For example I would have named your test pressingConfigureQRCode_launchesScanQRCodeActivity. I like the test itself.\nIt also looks like test doesn't set up the application for the MainMenuActivity correctly - this is why you were getting a null adminSharedPreferences. The activity's onCreate has this code:\ntry {\n    new StorageInitializer().createODKDirs();\n} catch (RuntimeException e) {\n    createErrorDialog(e.getMessage(), EXIT);\n    return;\n}\nFor this to work the app's \"storage state\" has to be setup correctly. It wasn't so the catch branch was firing before adminSharedPreferences was initialized. I think it would nice to rework this whole test (which is something I can take a look) so for the moment could you create a new MainMenuActivityTest with your test (iwith a new name and without the javadoc comment). The @Before you need to make sure storage state is setup is:\n@Before\npublic void setup() {\n    ShadowEnvironment.setExternalStorageState(MEDIA_MOUNTED);\n    mainMenuActivity = Robolectric.setupActivity(MainMenuActivity.class);\n}", "url": "https://github.com/getodk/collect/pull/3637#discussion_r383741459", "createdAt": "2020-02-25T09:06:06Z", "author": {"login": "seadowg"}, "path": "collect_app/src/test/java/org/odk/collect/android/activities/MainActivityTest.java", "diffHunk": "@@ -197,4 +200,18 @@ public void manageFilesButtonTest() throws Exception {\n         assertEquals(FileManagerTabs.class.getName(),\n                 shadowIntent.getIntentClass().getName());\n     }\n+\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc0MzIzOA==", "bodyText": "I like the comment but the \"decorator\" part confused me. Generally I'd think of a decorator adding functionality to an interface. I could totally just be missing something!", "url": "https://github.com/getodk/collect/pull/3637#discussion_r383743238", "createdAt": "2020-02-25T09:09:28Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/ScanQRCodeActivity.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.odk.collect.android.activities;\n+\n+import android.app.Activity;\n+import android.content.Intent;\n+import android.os.Bundle;\n+import com.google.zxing.integration.android.IntentIntegrator;\n+import com.google.zxing.integration.android.IntentResult;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.application.Collect;\n+import org.odk.collect.android.listeners.ActionListener;\n+import org.odk.collect.android.listeners.PermissionListener;\n+import org.odk.collect.android.preferences.AdminSharedPreferences;\n+import org.odk.collect.android.preferences.GeneralSharedPreferences;\n+import org.odk.collect.android.preferences.PreferenceSaver;\n+import org.odk.collect.android.utilities.CompressionUtils;\n+import org.odk.collect.android.utilities.LocaleHelper;\n+import org.odk.collect.android.utilities.PermissionUtils;\n+import org.odk.collect.android.utilities.ToastUtils;\n+\n+import java.io.IOException;\n+import java.util.zip.DataFormatException;\n+\n+import androidx.annotation.Nullable;\n+import timber.log.Timber;\n+\n+// ScanQRCodeActivity uses the decorator pattern to process the results from ScannerWithFlashlightActivity", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c07e06668e9a698f8b92788be7295b31c0b746a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80ed066a9b2bb86d0f6073a817eefb389269466d", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/80ed066a9b2bb86d0f6073a817eefb389269466d", "committedDate": "2020-02-26T00:40:39Z", "message": "fix review changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03faeec016787b601d7141e70bff5f5eb951cfde", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/03faeec016787b601d7141e70bff5f5eb951cfde", "committedDate": "2020-02-26T00:40:45Z", "message": "Revert \"fix null adminPreferences in robolectric tests\"\n\nThis reverts commit a6b1bc87d9992f4e8aa73fb2df8d7ab3f6311fa1."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aa82fcebc592be71f6c150562c3f1621aa342c6", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/7aa82fcebc592be71f6c150562c3f1621aa342c6", "committedDate": "2020-02-26T18:33:10Z", "message": "fix comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1adb1ed4861f9c8a57c07903ff52126228ebfb72", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/1adb1ed4861f9c8a57c07903ff52126228ebfb72", "committedDate": "2020-02-26T18:46:27Z", "message": "remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54633c30b414f45ae2208102367db195a29ac31c", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/54633c30b414f45ae2208102367db195a29ac31c", "committedDate": "2020-02-26T19:00:18Z", "message": "fix null pointer in test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjQ0OTM0", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-365244934", "createdAt": "2020-02-26T21:11:32Z", "commit": {"oid": "54633c30b414f45ae2208102367db195a29ac31c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NTAwMzk3", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-365500397", "createdAt": "2020-02-27T08:48:56Z", "commit": {"oid": "54633c30b414f45ae2208102367db195a29ac31c"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwODo0ODo1NlrOFvJjsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwODo0ODo1NlrOFvJjsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk4Mzk4NA==", "bodyText": "We probably don't need this comment. We'll most likely add tests to it so it'll get out of date fast!", "url": "https://github.com/getodk/collect/pull/3637#discussion_r384983984", "createdAt": "2020-02-27T08:48:56Z", "author": {"login": "seadowg"}, "path": "collect_app/src/test/java/org/odk/collect/android/activities/MainMenuActivityTest.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.odk.collect.android.activities;\n+\n+import android.content.Intent;\n+import android.view.MenuItem;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.robolectric.Robolectric;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.RuntimeEnvironment;\n+import org.robolectric.fakes.RoboMenuItem;\n+import org.robolectric.shadows.ShadowEnvironment;\n+\n+import static android.os.Environment.MEDIA_MOUNTED;\n+import static junit.framework.Assert.assertEquals;\n+import static org.robolectric.Shadows.shadowOf;\n+\n+/**\n+ * Unit test for checking {@link ScanQRCodeActivity} launched correctly from {@link MainMenuActivity}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54633c30b414f45ae2208102367db195a29ac31c"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODg1ODYw", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-365885860", "createdAt": "2020-02-27T18:12:40Z", "commit": {"oid": "54633c30b414f45ae2208102367db195a29ac31c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b8e323370b612120e9e5772d3c2fc6daf574f69", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/5b8e323370b612120e9e5772d3c2fc6daf574f69", "committedDate": "2020-02-27T18:12:55Z", "message": "remove comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MTYxMTkw", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-366161190", "createdAt": "2020-02-28T04:58:00Z", "commit": {"oid": "5b8e323370b612120e9e5772d3c2fc6daf574f69"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNDo1ODowMVrOFvphxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNDo1ODowMVrOFvphxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUwNzc4Mw==", "bodyText": "#3623 adds some nice abstractions for this admin dialog (https://github.com/opendatakit/collect/pull/3623/files#diff-587fa336330bb907832356ee77ed08d1R405). I wasn't sure when each of these two PRs would land and how the conflict would best be dealt with. As luck would have it, they're ready at the same time. Since it's going through quality assurance right now, let's plan on merging it first and then you'll unfortunately have conflicts to fix throughout this class.", "url": "https://github.com/getodk/collect/pull/3637#discussion_r385507783", "createdAt": "2020-02-28T04:58:01Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/MainMenuActivity.java", "diffHunk": "@@ -445,61 +463,71 @@ public void onClick(DialogInterface dialog, int i) {\n         alertDialog.show();\n     }\n \n-    @Override\n-    protected Dialog onCreateDialog(int id) {\n-        switch (id) {\n-            case PASSWORD_DIALOG:\n+    private Dialog createPasswordDialog(Intent intent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b8e323370b612120e9e5772d3c2fc6daf574f69"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea64994e3745652a91f1b3e5bde277fc8c8901e", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/2ea64994e3745652a91f1b3e5bde277fc8c8901e", "committedDate": "2020-02-29T18:09:11Z", "message": "add scan qr code analytics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12feabfe2f6cb46dfb130f7a6ea6faafa6c1572e", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/12feabfe2f6cb46dfb130f7a6ea6faafa6c1572e", "committedDate": "2020-03-02T17:24:27Z", "message": "merging"}, "afterCommit": {"oid": "2ea64994e3745652a91f1b3e5bde277fc8c8901e", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/2ea64994e3745652a91f1b3e5bde277fc8c8901e", "committedDate": "2020-02-29T18:09:11Z", "message": "add scan qr code analytics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee959469f04d417bf1393c36af41dab126a497c7", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/ee959469f04d417bf1393c36af41dab126a497c7", "committedDate": "2020-03-02T22:11:37Z", "message": "fix conflicts"}, "afterCommit": {"oid": "2ea64994e3745652a91f1b3e5bde277fc8c8901e", "author": {"user": {"login": "hypercubestart", "name": "Andrew Liu"}}, "url": "https://github.com/getodk/collect/commit/2ea64994e3745652a91f1b3e5bde277fc8c8901e", "committedDate": "2020-02-29T18:09:11Z", "message": "add scan qr code analytics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178fa3fb8e13858060757bbf91284633b8045194", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/178fa3fb8e13858060757bbf91284633b8045194", "committedDate": "2020-03-03T01:55:56Z", "message": "Merge remote-tracking branch 'upstream/master' into qrcode-hm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e7c02fdd2f97dff271d3beb4e55355129916d1a", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/1e7c02fdd2f97dff271d3beb4e55355129916d1a", "committedDate": "2020-03-03T02:19:54Z", "message": "Use descriptive string for menu title"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d112fd7250437dc9b37af849c2235c87ff6a2600", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/d112fd7250437dc9b37af849c2235c87ff6a2600", "committedDate": "2020-03-03T02:18:52Z", "message": "Use descriptive string for menu title"}, "afterCommit": {"oid": "1e7c02fdd2f97dff271d3beb4e55355129916d1a", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/1e7c02fdd2f97dff271d3beb4e55355129916d1a", "committedDate": "2020-03-03T02:19:54Z", "message": "Use descriptive string for menu title"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "483ecb638bb84b28f7ce4e2b3b6e86237b7f0ecc", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/483ecb638bb84b28f7ce4e2b3b6e86237b7f0ecc", "committedDate": "2020-03-03T04:44:56Z", "message": "Use onAttach variant called on all API levels\n\nSee https://developer.android.com/reference/android/app/Fragment#onAttach(android.content.Context): onAttach(Context) was added in API 23."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NzAwNTY3", "url": "https://github.com/getodk/collect/pull/3637#pullrequestreview-367700567", "createdAt": "2020-03-03T04:48:15Z", "commit": {"oid": "483ecb638bb84b28f7ce4e2b3b6e86237b7f0ecc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2295, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}