{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MjAyMDc2", "number": 4232, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxMjo0MFrOE7OUWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxNDozMVrOE7OWww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTM2MDI3OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/questions/AudioVideoImageTextLabel.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxMjo0MFrOH2v0Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMDowODoxOFrOH3JQGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2ODU1MQ==", "bodyText": "@lognaturel maybe it's time to get rid of those error messages? Glide can display a special image that will be used if something is wrong so we could have such an error/missing file image?", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527168551", "createdAt": "2020-11-19T20:12:40Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/formentry/questions/AudioVideoImageTextLabel.java", "diffHunk": "@@ -143,7 +142,20 @@ public void setAudio(String audioURI, AudioHelper audioHelper) {\n     }\n \n     public void setImage(@NonNull File imageFile) {\n-        setupImage(imageFile);\n+        if (imageFile.exists()) {\n+            imageView.layout(0, 0, 0, 0);\n+\n+            Glide.with(this)\n+                    .load(imageFile)\n+                    .centerInside()\n+                    .into(imageView);\n+\n+            imageView.setVisibility(VISIBLE);\n+            imageView.setOnClickListener(this);\n+        } else {\n+            missingImage.setVisibility(VISIBLE);\n+            missingImage.setText(getContext().getString(R.string.file_missing, imageFile));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNzI4OQ==", "bodyText": "I think using a missing image file is a good idea and will make it more obvious that something is wrong.\nThe advantage of the message is that it lets the user know where the image is expected to be and what its file name is. How about leaving this message and adding the missing image? Or is there a strong reason to get rid of it?", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527227289", "createdAt": "2020-11-19T21:53:47Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/formentry/questions/AudioVideoImageTextLabel.java", "diffHunk": "@@ -143,7 +142,20 @@ public void setAudio(String audioURI, AudioHelper audioHelper) {\n     }\n \n     public void setImage(@NonNull File imageFile) {\n-        setupImage(imageFile);\n+        if (imageFile.exists()) {\n+            imageView.layout(0, 0, 0, 0);\n+\n+            Glide.with(this)\n+                    .load(imageFile)\n+                    .centerInside()\n+                    .into(imageView);\n+\n+            imageView.setVisibility(VISIBLE);\n+            imageView.setOnClickListener(this);\n+        } else {\n+            missingImage.setVisibility(VISIBLE);\n+            missingImage.setText(getContext().getString(R.string.file_missing, imageFile));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2ODU1MQ=="}, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU4NTMwNw==", "bodyText": "Ok I'll file a separate issue for that.", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527585307", "createdAt": "2020-11-20T10:08:18Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/formentry/questions/AudioVideoImageTextLabel.java", "diffHunk": "@@ -143,7 +142,20 @@ public void setAudio(String audioURI, AudioHelper audioHelper) {\n     }\n \n     public void setImage(@NonNull File imageFile) {\n-        setupImage(imageFile);\n+        if (imageFile.exists()) {\n+            imageView.layout(0, 0, 0, 0);\n+\n+            Glide.with(this)\n+                    .load(imageFile)\n+                    .centerInside()\n+                    .into(imageView);\n+\n+            imageView.setVisibility(VISIBLE);\n+            imageView.setOnClickListener(this);\n+        } else {\n+            missingImage.setVisibility(VISIBLE);\n+            missingImage.setText(getContext().getString(R.string.file_missing, imageFile));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2ODU1MQ=="}, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTM2NjQzOnYy", "diffSide": "LEFT", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/QuestionWidget.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDoxNDozMVrOH2v3_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOTo1NDoyOFrOH3Iu4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2OTUzMw==", "bodyText": "All of these is removed because it caused crashes since Glide use caching. I could disable caching in Glide and then keep this code but it's not recommended and I believe it's a very old code that we no longer need because we have more powerful devices and also glide should deal with it better.", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527169533", "createdAt": "2020-11-19T20:14:31Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/QuestionWidget.java", "diffHunk": "@@ -291,40 +285,6 @@ public QuestionDetails getQuestionDetails() {\n         return questionDetails;\n     }\n \n-    // http://code.google.com/p/android/issues/detail?id=8488\n-    private void recycleDrawablesRecursive(ViewGroup viewGroup, List<ImageView> images) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIzMDk2Mw==", "bodyText": "This seems reasonable to me. Am I understanding correctly that the Glide cache will be some kind of singleton so on activity rotation all images should be able to come from some cache layer?", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527230963", "createdAt": "2020-11-19T22:00:50Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/QuestionWidget.java", "diffHunk": "@@ -291,40 +285,6 @@ public QuestionDetails getQuestionDetails() {\n         return questionDetails;\n     }\n \n-    // http://code.google.com/p/android/issues/detail?id=8488\n-    private void recycleDrawablesRecursive(ViewGroup viewGroup, List<ImageView> images) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2OTUzMw=="}, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU3NjgwMA==", "bodyText": "Yes I'm not sure about rotating and would need to double check but it uses caching for example when we navigate between questions so probably during rotating as well.", "url": "https://github.com/getodk/collect/pull/4232#discussion_r527576800", "createdAt": "2020-11-20T09:54:28Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/widgets/QuestionWidget.java", "diffHunk": "@@ -291,40 +285,6 @@ public QuestionDetails getQuestionDetails() {\n         return questionDetails;\n     }\n \n-    // http://code.google.com/p/android/issues/detail?id=8488\n-    private void recycleDrawablesRecursive(ViewGroup viewGroup, List<ImageView> images) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2OTUzMw=="}, "originalCommit": {"oid": "4d22f413a5a2b97cb48d9aa59fb27bb45856fcd1"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3175, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}