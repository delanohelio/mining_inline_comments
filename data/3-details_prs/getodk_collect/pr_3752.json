{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MDQyODU4", "number": 3752, "title": "Allow null select one values", "bodyText": "Closes #3142\nThis makes it possible to have null select choice values in select one. This not working was causing a crash. While it's not common it is possible for JavaRosa's SelectChoice#getValue() to return null.\nThe behaviour we now expect is as follows:\n\nEnumerator selects choice that has no underlying value\nChoice looks selected\nEnumerator swipes to another question and swipes back\nThere is no choice selected\n\nThis is a bit confusing but really a result of strange/bad form design so we're going to go with it for the moment.\nWhat has been done to verify that this works as intended?\nWrote tests for null case for SelectChoice values.\nWhy is this the best possible solution? Were any other approaches considered?\nWe initially considered hiding the value but it felt like the simplest thing to do was to let this kind of form exist as-is but make sure it wouldn't crash.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nShould just fix the crash. Good to have a play around with selects.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-04-01T14:46:12Z", "url": "https://github.com/getodk/collect/pull/3752", "merged": true, "mergeCommit": {"oid": "fa4aa418932afe5cbb0c850faee9106b28811be9"}, "closed": true, "closedAt": "2020-04-28T10:29:57Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTX-SvAH2gAyMzk3MDQyODU4OjZkZTQwMDNmZGNhYWNjYzVjOTIxMjQ5OTc4OWUzODJkMjcyOTkwZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTu-GDAFqTM4NjU5OTM3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6de4003fdcaaccc5c9212499789e382d272990df", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/6de4003fdcaaccc5c9212499789e382d272990df", "committedDate": "2020-04-01T13:46:30Z", "message": "Add test for blank select one choices"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc65b259fa8436ab39bc20b9c0933f7f7e9bb6a7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/dc65b259fa8436ab39bc20b9c0933f7f7e9bb6a7", "committedDate": "2020-04-01T13:52:59Z", "message": "Add check for null values in select one"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDA5MDk5", "url": "https://github.com/getodk/collect/pull/3752#pullrequestreview-386009099", "createdAt": "2020-04-01T23:06:10Z", "commit": {"oid": "6de4003fdcaaccc5c9212499789e382d272990df"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzowNjoxMFrOF_VwKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzowOTozOFrOF_V0qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2MTAwMg==", "bodyText": "I don't understand this test! The test that is introduced should fail or crash at this point and this one passes. I don't understand \"shown\" in its name. This issue is only about the underlying value, not about what is displayed, right? If you were going to test what is displayed, innerText on getChildAt(0) wouldn't make sense because that gives you the linear layout that contains the audio-video-image-text-label view.\nI think you probably want to do something like select the first choice and verify that its value is blank. Again, it should fail or crash in this commit.", "url": "https://github.com/getodk/collect/pull/3752#discussion_r401961002", "createdAt": "2020-04-01T23:06:10Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/test/java/org/odk/collect/android/widgets/SelectOneWidgetTest.java", "diffHunk": "@@ -104,29 +106,21 @@ public void whenChoicesHaveAudio_logsAudioChoiceEvent() throws Exception {\n                 ))\n                 .build();\n \n-        populateRecyclerView(getActualWidget());\n+        populateRecyclerView(getWidget());\n         verify(analytics).logEvent(\"Prompt\", \"AudioChoice\", \"formAnalyticsID\");\n     }\n \n-    private void overrideDependencyModule() throws Exception {\n-        ReferenceManager referenceManager = setupFakeReferenceManager(REFERENCES);\n-        RobolectricHelpers.overrideAppDependencyModule(new AppDependencyModule() {\n-\n-            @Override\n-            public ReferenceManager providesReferenceManager() {\n-                return referenceManager;\n-            }\n-\n-            @Override\n-            public AudioHelperFactory providesAudioHelperFactory() {\n-                return context -> audioHelper;\n-            }\n+    @Test\n+    public void whenAChoiceIsBlank_itIsShownAsBlank() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6de4003fdcaaccc5c9212499789e382d272990df"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2MjE1Mw==", "bodyText": "This test would crash without the code change so that's good. But I still don't think it's asserting something that makes sense.", "url": "https://github.com/getodk/collect/pull/3752#discussion_r401962153", "createdAt": "2020-04-01T23:09:38Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/test/java/org/odk/collect/android/widgets/SelectOneWidgetTest.java", "diffHunk": "@@ -123,6 +123,22 @@ public void whenAChoiceIsBlank_itIsShownAsBlank() {\n         assertThat(innerText(widget.getChoicesList().getChildAt(0)), equalTo(\"\"));\n     }\n \n+    @Test\n+    public void whenAChoiceValueIsNull_itIsShownAsBlank() {\n+        SelectChoice selectChoice = new SelectChoice(); // The two arg constructor protects against null values\n+        selectChoice.setTextID(\"1\");\n+\n+        formEntryPrompt = new MockFormEntryPromptBuilder()\n+                .withSelectChoices(asList(\n+                        selectChoice\n+                ))\n+                .build();\n+\n+        SelectOneWidget widget = getWidget();\n+        populateRecyclerView(widget);\n+        assertThat(innerText(widget.getChoicesList().getChildAt(0)), equalTo(\"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc65b259fa8436ab39bc20b9c0933f7f7e9bb6a7"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "196ebc82fcd766fed92e04e2041c328e6e2696e6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/196ebc82fcd766fed92e04e2041c328e6e2696e6", "committedDate": "2020-04-02T16:12:00Z", "message": "Add test to check null select values can't be selected"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTk5Mzc0", "url": "https://github.com/getodk/collect/pull/3752#pullrequestreview-386599374", "createdAt": "2020-04-02T16:34:06Z", "commit": {"oid": "196ebc82fcd766fed92e04e2041c328e6e2696e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2761, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}