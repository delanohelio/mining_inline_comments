{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNDUxOTA2", "number": 4013, "title": "Make sure Automatic Download downloads updates that have already been notifiied", "bodyText": "Closes #4012\nWhat has been done to verify that this works as intended?\nAdded tests to capture the edge case\nWhy is this the best possible solution? Were any other approaches considered?\nComments inline\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nGood to test Previously Downloaded Only with and without Automatic Download enabled to double-check everything is the way it should be.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-08-05T15:17:50Z", "url": "https://github.com/getodk/collect/pull/4013", "merged": true, "mergeCommit": {"oid": "3a17a0fa3437e70093e8e45f08190445863d1ab9"}, "closed": true, "closedAt": "2020-08-24T11:38:12Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc79CsfAFqTQ2MTc4MzIyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-IdJmABqjM2NDY5NDExNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzgzMjI2", "url": "https://github.com/getodk/collect/pull/4013#pullrequestreview-461783226", "createdAt": "2020-08-05T15:34:46Z", "commit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTozNDo0NlrOG8PLVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTozNDo0NlrOG8PLVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgxNjQwNA==", "bodyText": "I wanted to pull this out so we could have an object that was easier to setup and work with than the SQLiteOpenHelper implementations that need DatabaseContext.", "url": "https://github.com/getodk/collect/pull/4013#discussion_r465816404", "createdAt": "2020-08-05T15:34:46Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/database/FormDatabaseMigrator.java", "diffHunk": "@@ -45,97 +24,51 @@\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_FORM_ID;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_VERSION;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.LANGUAGE;\n-import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.LAST_DETECTED_FORM_VERSION_HASH;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.MD5_HASH;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.SUBMISSION_URI;\n \n-/**\n- * This class helps open, create, and upgrade the database file.\n- */\n-public class FormsDatabaseHelper extends SQLiteOpenHelper {\n-    private static final String DATABASE_NAME = \"forms.db\";\n-    public static final String FORMS_TABLE_NAME = \"forms\";\n-\n-    public static final int DATABASE_VERSION = 9;\n+public class FormDatabaseMigrator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzg1MTc4", "url": "https://github.com/getodk/collect/pull/4013#pullrequestreview-461785178", "createdAt": "2020-08-05T15:36:54Z", "commit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTozNjo1NFrOG8PRBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTozNjo1NFrOG8PRBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgxNzg2MA==", "bodyText": "This is the key change here: switch away from using the database to record the versions the user is notified about and also making it more of a UI's (the Notifier) concern.", "url": "https://github.com/getodk/collect/pull/4013#discussion_r465817860", "createdAt": "2020-08-05T15:36:54Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/notifications/NotificationManagerNotifier.java", "diffHunk": "@@ -35,18 +42,26 @@\n \n     private final Application application;\n     private final NotificationManager notificationManager;\n+    private final PreferencesProvider preferencesProvider;\n \n     private static final int FORM_UPDATE_NOTIFICATION_ID = 0;\n     private static final int FORM_SYNC_NOTIFICATION_ID = 1;\n     private static final int AUTO_SEND_RESULT_NOTIFICATION_ID = 1328974928;\n \n-    public NotificationManagerNotifier(Application application) {\n+    public NotificationManagerNotifier(Application application, PreferencesProvider preferencesProvider) {\n         this.application = application;\n         notificationManager = (NotificationManager) application.getSystemService(NOTIFICATION_SERVICE);\n+        this.preferencesProvider = preferencesProvider;\n     }\n \n     @Override\n-    public void onUpdatesAvailable() {\n+    public void onUpdatesAvailable(List<ServerFormDetails> updates) {\n+        SharedPreferences metaPrefs = preferencesProvider.getMetaSharedPreferences();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzg2MjM5", "url": "https://github.com/getodk/collect/pull/4013#pullrequestreview-461786239", "createdAt": "2020-08-05T15:38:03Z", "commit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTozODowM1rOG8PUOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNTozODowM1rOG8PUOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgxODY4Mg==", "bodyText": "There were tests for the database helper checking migrations, but they were out of date and Ignored. Interested to know if people think we need more coverage here.", "url": "https://github.com/getodk/collect/pull/4013#discussion_r465818682", "createdAt": "2020-08-05T15:38:03Z", "author": {"login": "seadowg"}, "path": "collect_app/src/test/java/org/odk/collect/android/database/FormDatabaseMigratorTest.java", "diffHunk": "@@ -0,0 +1,114 @@\n+package org.odk.collect.android.database;\n+\n+import android.content.ContentValues;\n+import android.database.Cursor;\n+import android.database.sqlite.SQLiteDatabase;\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import org.jetbrains.annotations.NotNull;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.odk.collect.android.database.DatabaseConstants.FORMS_TABLE_NAME;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.AUTO_DELETE;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.AUTO_SEND;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.BASE64_RSA_PUBLIC_KEY;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.DATE;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.DESCRIPTION;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.DISPLAY_NAME;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.FORM_FILE_PATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.FORM_MEDIA_PATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.GEOMETRY_XPATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JRCACHE_FILE_PATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_FORM_ID;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_VERSION;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.LANGUAGE;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.MD5_HASH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.SUBMISSION_URI;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns._ID;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class FormDatabaseMigratorTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTEyOTk3", "url": "https://github.com/getodk/collect/pull/4013#pullrequestreview-462112997", "createdAt": "2020-08-06T00:40:27Z", "commit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDo0MDoyN1rOG8fQdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDo1MTo1OVrOG8fcEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3OTg2Mw==", "bodyText": "Move break down to allow upgrades from versions other than 8.", "url": "https://github.com/getodk/collect/pull/4013#discussion_r466079863", "createdAt": "2020-08-06T00:40:27Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/database/FormDatabaseMigrator.java", "diffHunk": "@@ -45,97 +24,51 @@\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_FORM_ID;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_VERSION;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.LANGUAGE;\n-import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.LAST_DETECTED_FORM_VERSION_HASH;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.MD5_HASH;\n import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.SUBMISSION_URI;\n \n-/**\n- * This class helps open, create, and upgrade the database file.\n- */\n-public class FormsDatabaseHelper extends SQLiteOpenHelper {\n-    private static final String DATABASE_NAME = \"forms.db\";\n-    public static final String FORMS_TABLE_NAME = \"forms\";\n-\n-    public static final int DATABASE_VERSION = 9;\n+public class FormDatabaseMigrator {\n \n     private static final String[] COLUMN_NAMES_V7 = {_ID, DISPLAY_NAME, DESCRIPTION,\n             JR_FORM_ID, JR_VERSION, MD5_HASH, DATE, FORM_MEDIA_PATH, FORM_FILE_PATH, LANGUAGE,\n             SUBMISSION_URI, BASE64_RSA_PUBLIC_KEY, JRCACHE_FILE_PATH, AUTO_SEND, AUTO_DELETE,\n-            LAST_DETECTED_FORM_VERSION_HASH};\n-\n-    private static final String[] COLUMN_NAMES_V9 = {_ID, DISPLAY_NAME, DESCRIPTION,\n-            JR_FORM_ID, JR_VERSION, MD5_HASH, DATE, FORM_MEDIA_PATH, FORM_FILE_PATH, LANGUAGE,\n-            SUBMISSION_URI, BASE64_RSA_PUBLIC_KEY, JRCACHE_FILE_PATH, AUTO_SEND, AUTO_DELETE,\n-            LAST_DETECTED_FORM_VERSION_HASH, DELETED};\n-\n-    public static final String[] CURRENT_VERSION_COLUMN_NAMES = COLUMN_NAMES_V9;\n+            \"lastDetectedFormVersionHash\"};\n \n     // These exist in database versions 2 and 3, but not in 4...\n     private static final String TEMP_FORMS_TABLE_NAME = \"forms_v4\";\n     private static final String MODEL_VERSION = \"modelVersion\";\n \n-    private static boolean isDatabaseBeingMigrated;\n-\n-    public FormsDatabaseHelper() {\n-        super(new DatabaseContext(new StoragePathProvider().getDirPath(StorageSubdirectory.METADATA)), DATABASE_NAME, null, DATABASE_VERSION);\n-    }\n-\n-    public static String getDatabasePath() {\n-        return new StoragePathProvider().getDirPath(StorageSubdirectory.METADATA) + File.separator + DATABASE_NAME;\n-    }\n-\n-    @Override\n     public void onCreate(SQLiteDatabase db) {\n         createFormsTableV9(db);\n     }\n \n     @SuppressWarnings({\"checkstyle:FallThrough\"})\n-    @Override\n-    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n-        try {\n-            Timber.i(\"Upgrading database from version %d to %d\", oldVersion, newVersion);\n-\n-            switch (oldVersion) {\n-                case 1:\n-                    upgradeToVersion2(db);\n-                case 2:\n-                case 3:\n-                    upgradeToVersion4(db, oldVersion);\n-                case 4:\n-                    upgradeToVersion5(db);\n-                case 5:\n-                    upgradeToVersion6(db);\n-                case 6:\n-                    upgradeToVersion7(db);\n-                case 7:\n-                    upgradeToVersion8(db);\n-                    break;\n-                case 8:\n-                    upgradeToVersion9(db);\n-                default:\n-                    Timber.i(\"Unknown version %s\", oldVersion);\n-            }\n-\n-            Timber.i(\"Upgrading database from version %d to %d completed with success.\", oldVersion, newVersion);\n-            isDatabaseBeingMigrated = false;\n-        } catch (SQLException e) {\n-            isDatabaseBeingMigrated = false;\n-            throw e;\n+    public void onUpgrade(SQLiteDatabase db, int oldVersion) throws SQLException {\n+        switch (oldVersion) {\n+            case 1:\n+                upgradeToVersion2(db);\n+            case 2:\n+            case 3:\n+                upgradeToVersion4(db, oldVersion);\n+            case 4:\n+                upgradeToVersion5(db);\n+            case 5:\n+                upgradeToVersion6(db);\n+            case 6:\n+                upgradeToVersion7(db);\n+            case 7:\n+                upgradeToVersion8(db);\n+                break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4MjgzMg==", "bodyText": "I know you've been trying to kill those tests for a long time. \ud83d\ude02 They were added after we had several significant bugs related to onDowngrade. I think the structure and test are good but that it would be good to also downgrade from a fictitious high version with an extra and missing column to avoid regressions there. We can assume we wouldn't touch onDowngrade anymore but it's hard to reason about and tempting to try to improve.", "url": "https://github.com/getodk/collect/pull/4013#discussion_r466082832", "createdAt": "2020-08-06T00:51:59Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/test/java/org/odk/collect/android/database/FormDatabaseMigratorTest.java", "diffHunk": "@@ -0,0 +1,114 @@\n+package org.odk.collect.android.database;\n+\n+import android.content.ContentValues;\n+import android.database.Cursor;\n+import android.database.sqlite.SQLiteDatabase;\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import org.jetbrains.annotations.NotNull;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.odk.collect.android.database.DatabaseConstants.FORMS_TABLE_NAME;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.AUTO_DELETE;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.AUTO_SEND;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.BASE64_RSA_PUBLIC_KEY;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.DATE;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.DESCRIPTION;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.DISPLAY_NAME;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.FORM_FILE_PATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.FORM_MEDIA_PATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.GEOMETRY_XPATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JRCACHE_FILE_PATH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_FORM_ID;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.JR_VERSION;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.LANGUAGE;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.MD5_HASH;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns.SUBMISSION_URI;\n+import static org.odk.collect.android.provider.FormsProviderAPI.FormsColumns._ID;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class FormDatabaseMigratorTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTgxODY4Mg=="}, "originalCommit": {"oid": "c04b011c62fecf8405bae770af12001153eb967d"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0858c12bced22490ae251c3221b23c9ac3ec3aa0", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/0858c12bced22490ae251c3221b23c9ac3ec3aa0", "committedDate": "2020-08-06T16:43:12Z", "message": "Move database repo implementations to database package"}, "afterCommit": {"oid": "13fbd81e51df760f9cac516c38f247cad8159288", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/13fbd81e51df760f9cac516c38f247cad8159288", "committedDate": "2020-08-06T16:51:27Z", "message": "Move database repo implementations to database package"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTgyMTU2", "url": "https://github.com/getodk/collect/pull/4013#pullrequestreview-463582156", "createdAt": "2020-08-07T20:08:25Z", "commit": {"oid": "6e7715c5fdbeee228b1dea504628d193864e654e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68d9137b61f921edcb176fc25afc36c8dececbdf", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/68d9137b61f921edcb176fc25afc36c8dececbdf", "committedDate": "2020-08-12T09:50:27Z", "message": "Make sure form updates are downloaded during auto updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca1c827ef93629d23eedb6089c8d09112e108011", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ca1c827ef93629d23eedb6089c8d09112e108011", "committedDate": "2020-08-12T09:53:32Z", "message": "Make sure notifications for updates aren't sent twice"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "888802a9e31e4e350227f914d3b8ef8713ae899e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/888802a9e31e4e350227f914d3b8ef8713ae899e", "committedDate": "2020-08-12T09:53:34Z", "message": "Remove last detected version hash from form domain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "933b2fb797e7629cd76a0ff8193405e2da462e41", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/933b2fb797e7629cd76a0ff8193405e2da462e41", "committedDate": "2020-08-12T09:53:34Z", "message": "Move AutoSendTest to correct package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc80434a817c0074cde3e0e9770e613e3055f927", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/cc80434a817c0074cde3e0e9770e613e3055f927", "committedDate": "2020-08-12T09:53:35Z", "message": "Move form database migration code to its own class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a2c33f959f0a596441e1a017b335c7a0ee943ee", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/7a2c33f959f0a596441e1a017b335c7a0ee943ee", "committedDate": "2020-08-12T09:53:35Z", "message": "Add test for current version migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dff35413c515c8061975e0c76867d9c93b0ba8a7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/dff35413c515c8061975e0c76867d9c93b0ba8a7", "committedDate": "2020-08-12T09:53:35Z", "message": "Remove last detected form version column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2615240af958d068d17ed0f933b8a203348c0796", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/2615240af958d068d17ed0f933b8a203348c0796", "committedDate": "2020-08-12T09:53:35Z", "message": "Move database helpers to top level of package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d126af47c356a2bd540ce798a873c913a3f4fd39", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d126af47c356a2bd540ce798a873c913a3f4fd39", "committedDate": "2020-08-12T09:53:35Z", "message": "Add tests for onDowngrade in migrator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c000cabf5e4a1eef7f2166f2d1069e95b34aeb8d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c000cabf5e4a1eef7f2166f2d1069e95b34aeb8d", "committedDate": "2020-08-12T09:53:35Z", "message": "Make sure upgrade from 7 to 9 database works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea429054369f7e5ea57825b60111d6359f728561", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ea429054369f7e5ea57825b60111d6359f728561", "committedDate": "2020-08-12T09:53:35Z", "message": "Remove Timber logging\n\nGiven this was just an `i` it didn't feel like it had much value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be32f342d067ed12779230d9135c9cab2ca5f817", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/be32f342d067ed12779230d9135c9cab2ca5f817", "committedDate": "2020-08-12T09:53:36Z", "message": "Optimize imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12faec2ef8618930fadcf5e03b29aa7ddae92318", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/12faec2ef8618930fadcf5e03b29aa7ddae92318", "committedDate": "2020-08-12T09:53:36Z", "message": "Move database repo implementations to database package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66f33e1ad4e46057c37df23677851fbb1594e848", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/66f33e1ad4e46057c37df23677851fbb1594e848", "committedDate": "2020-08-12T09:55:25Z", "message": "Fix test compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddc2f013e513756ca91efe6b0285079425e6f69c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ddc2f013e513756ca91efe6b0285079425e6f69c", "committedDate": "2020-08-12T09:55:27Z", "message": "Make sure dbs are closed after test runs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e7715c5fdbeee228b1dea504628d193864e654e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/6e7715c5fdbeee228b1dea504628d193864e654e", "committedDate": "2020-08-07T13:40:04Z", "message": "Make sure dbs are closed after test runs"}, "afterCommit": {"oid": "ddc2f013e513756ca91efe6b0285079425e6f69c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ddc2f013e513756ca91efe6b0285079425e6f69c", "committedDate": "2020-08-12T09:55:27Z", "message": "Make sure dbs are closed after test runs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2588, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}