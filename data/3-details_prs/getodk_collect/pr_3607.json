{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2OTMwNDI1", "number": 3607, "title": "Move `CollectServerClient` and `DownloadFormListTask` tests to Robolectric", "bodyText": "These tests were previously instrumentation tests. And, of course, moving them into Robolectric left some irresistible refactors in front of me:\n\nMoved focus of task test to DownloadFormListUtils which was actually where the work was happening\nRename DownloadFormListUtils to FormListDownloader in the spirit of it being a \"usecase\" or \"noun-verber\".\nRename CollectServerClient to OpenRosaAPIClient as it seems like it's trying to represent the OpenRosa API as opposed to our OpenRosaHttpInterface (in the way an SDK would) which is concerned with the lower level HTTP requests. It's not quite there but I've added a note to STATE.md about where it should go.\nReorganize the http package as it now feels like (as above) we have a top level package that abstracts our communication with OpenRosa\n\nThere is definitely a lot more that I could have done (starting to properly flesh out the OpenRosaAPIClient would have been my next step) but I wanted to timebox this so I didn't end up down a rabbit hole.\nWhat has been done to verify that this works as intended?\nRan tests and played with the app against Aggregate.\nWhy is this the best possible solution? Were any other approaches considered?\nWe'd previously discussed moving non UI tests like this to Robolectric and decided it did make sense as the start up time is far smaller for running individual tests classes.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nHopefully there aren't any changes in behaviour. As with any changes to the HTTP stack we should play around with the app against a variety of servers as it still feels like a blindspot in our automated test suite.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-01-24T17:02:16Z", "url": "https://github.com/getodk/collect/pull/3607", "merged": true, "mergeCommit": {"oid": "e43aa783c637a0fdc55ecdfd3963b25520c4c57c"}, "closed": true, "closedAt": "2020-02-03T14:00:14Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb84dKFgH2gAyMzY2OTMwNDI1OjQxMjU1MjhkZGEwNzI4MWJlMzMzZmUzMDEyM2YyMjI4YjM4MTU3Zjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_J731AFqTM1MDI5ODk4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4125528dda07281be333fe30123f2228b38157f9", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4125528dda07281be333fe30123f2228b38157f9", "committedDate": "2020-01-22T16:36:55Z", "message": "Move DownloadFormListTaskTest to Robolectric from instrumentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f01af225000adaf51191ae49d72e98baa05caa3d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/f01af225000adaf51191ae49d72e98baa05caa3d", "committedDate": "2020-01-23T15:00:59Z", "message": "Use MockWebServerRule in DownloadFormListTaskTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae9a62de850e06fa75d8b1afd61cfa68d5a3ca12", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ae9a62de850e06fa75d8b1afd61cfa68d5a3ca12", "committedDate": "2020-01-23T15:27:43Z", "message": "Test FormListDownloader instead of task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83f35e0e4a27ea7ad00b2a73495fcc03747ea874", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/83f35e0e4a27ea7ad00b2a73495fcc03747ea874", "committedDate": "2020-01-24T14:53:15Z", "message": "Remove CollectServerClientTest in instrumentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6894ccc6e52d4ba51ddff99e27a722f2e905fb49", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/6894ccc6e52d4ba51ddff99e27a722f2e905fb49", "committedDate": "2020-01-24T15:17:47Z", "message": "Rework CollectServerClientTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88c4ce8ee164438918088696655b22d2ff830a05", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/88c4ce8ee164438918088696655b22d2ff830a05", "committedDate": "2020-01-24T15:42:02Z", "message": "Rename CollectServerClient to point to it abstractign the OpenRosa API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "525ce1d8066426bdfeddfce2293753fe97f96351", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/525ce1d8066426bdfeddfce2293753fe97f96351", "committedDate": "2020-01-24T15:48:33Z", "message": "Reorganize http/openrosa package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4da31a4845ae3daf60ecc2c42b45bf7a1bb5fea", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c4da31a4845ae3daf60ecc2c42b45bf7a1bb5fea", "committedDate": "2020-01-24T15:57:13Z", "message": "Remove SNI test\n\nThis looks like it had been designed to drive out a fix in the old\nODK Apache HTTP client. We could add a test to our OpenRosaHttpInterface\nbut it feels like overkill as SNI is supported by Java's own HttpURLConnection.\nI'd be very surprised if any http clients we use in the future have do not\ninclude SNI support given that's the case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52d102c6e62d57f2bd3ace113f09a38c8fd72b7e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/52d102c6e62d57f2bd3ace113f09a38c8fd72b7e", "committedDate": "2020-01-24T17:08:32Z", "message": "Add note to state of the union about OpenRosaAPIClient"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9f3f7863f347c68aad855ca513ef6fc571b2996", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c9f3f7863f347c68aad855ca513ef6fc571b2996", "committedDate": "2020-01-24T16:49:32Z", "message": "Add note to state of the union about OpenRosaAPIClient"}, "afterCommit": {"oid": "52d102c6e62d57f2bd3ace113f09a38c8fd72b7e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/52d102c6e62d57f2bd3ace113f09a38c8fd72b7e", "committedDate": "2020-01-24T17:08:32Z", "message": "Add note to state of the union about OpenRosaAPIClient"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjk4OTg0", "url": "https://github.com/getodk/collect/pull/3607#pullrequestreview-350298984", "createdAt": "2020-01-29T17:41:49Z", "commit": {"oid": "c4da31a4845ae3daf60ecc2c42b45bf7a1bb5fea"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzo0MTo0OVrOFjRg1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzo0MTo0OVrOFjRg1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUzMTQxNA==", "bodyText": "Good cleanup. This test wouldn't work anyway because this domain no longer exists. As you say, it's not something that really needs to be tested anymore so I don't think any such services are around.", "url": "https://github.com/getodk/collect/pull/3607#discussion_r372531414", "createdAt": "2020-01-29T17:41:49Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/ServerNameIndicationTest.java", "diffHunk": "@@ -1,74 +0,0 @@\n-package org.odk.collect.android;\n-\n-import androidx.test.filters.Suppress;\n-import androidx.test.runner.AndroidJUnit4;\n-\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-import org.odk.collect.android.openrosa.OpenRosaAPIClient;\n-import org.odk.collect.android.openrosa.HttpGetResult;\n-import org.odk.collect.android.openrosa.OpenRosaHttpInterface;\n-import org.odk.collect.android.utilities.WebCredentialsUtils;\n-\n-import java.io.BufferedReader;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.InputStreamReader;\n-import java.net.URL;\n-\n-import javax.net.ssl.HttpsURLConnection;\n-\n-import static junit.framework.Assert.assertEquals;\n-import static junit.framework.Assert.fail;\n-import static org.odk.collect.android.support.CollectHelpers.getAppDependencyComponent;\n-\n-/**\n- * An on-device test for TLS server name indication support.\n- *\n- * @see <a href=\"https://github.com/opendatakit/collect/issues/199\">COLLECT-199</a>\n- */\n-@Suppress\n-@RunWith(AndroidJUnit4.class)\n-public class ServerNameIndicationTest {\n-\n-    private static final String SNI_URI = \"https://sni.velox.ch/\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4da31a4845ae3daf60ecc2c42b45bf7a1bb5fea"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2261, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}