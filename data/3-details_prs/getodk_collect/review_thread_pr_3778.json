{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MTg0MjU3", "number": 3778, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjowNzoxMFrOD7np1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMzozMzoxN1rOD75a_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzODQyMjYyOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/res/drawable/form_state_finalized.xml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjowNzoxMFrOGUDaCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMzowMzowOVrOGUFfZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MDUyMg==", "bodyText": "I think it's best avoid iconColor and go for Material Theme attributes like colorOnSurface or colorOnPrimary. These let us account for the fact that in some color schemes the icon color would differ depending on where it was rendered.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423680522", "createdAt": "2020-05-12T12:07:10Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/drawable/form_state_finalized.xml", "diffHunk": "@@ -1,20 +1,17 @@\n <vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        android:width=\"40dp\"\n-        android:height=\"40dp\"\n-        android:viewportWidth=\"120\"\n-        android:viewportHeight=\"120\">\n+    android:width=\"40dp\"\n+    android:height=\"40dp\"\n+    android:viewportWidth=\"120\"\n+    android:viewportHeight=\"120\">\n \n     <path\n-            android:pathData=\"M60,60m-60,0a60,60 0,1 1,120 0a60,60 0,1 1,-120 0\"\n-            android:fillColor=\"@color/deep_purple_500\"/>\n+        android:pathData=\"M67.195,26.83h-26.83c-3.688,0 -6.673,2.985 -6.673,6.633L33.66,86.537c0,3.648 2.984,6.634 6.673,6.634L80.61,93.171c3.689,0 6.707,-2.986 6.707,-6.634L87.317,46.732L67.195,26.829zM40.365,86.537L40.365,33.463h23.476L63.841,50.05L80.61,50.05v36.488L40.366,86.538z\"\n+        android:fillColor=\"?iconColor\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcxMjgzMg==", "bodyText": "That's right but ?iconColor is used in many places like that so would be better to clear that in a separate pr.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423712832", "createdAt": "2020-05-12T13:00:35Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/res/drawable/form_state_finalized.xml", "diffHunk": "@@ -1,20 +1,17 @@\n <vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        android:width=\"40dp\"\n-        android:height=\"40dp\"\n-        android:viewportWidth=\"120\"\n-        android:viewportHeight=\"120\">\n+    android:width=\"40dp\"\n+    android:height=\"40dp\"\n+    android:viewportWidth=\"120\"\n+    android:viewportHeight=\"120\">\n \n     <path\n-            android:pathData=\"M60,60m-60,0a60,60 0,1 1,120 0a60,60 0,1 1,-120 0\"\n-            android:fillColor=\"@color/deep_purple_500\"/>\n+        android:pathData=\"M67.195,26.83h-26.83c-3.688,0 -6.673,2.985 -6.673,6.633L33.66,86.537c0,3.648 2.984,6.634 6.673,6.634L80.61,93.171c3.689,0 6.707,-2.986 6.707,-6.634L87.317,46.732L67.195,26.829zM40.365,86.537L40.365,33.463h23.476L63.841,50.05L80.61,50.05v36.488L40.366,86.538z\"\n+        android:fillColor=\"?iconColor\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MDUyMg=="}, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcxNDY2MQ==", "bodyText": "Absolutely. It's one of the follow ups to #3777 I'll schedule. It would be nice to not have another one to change in that though!", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423714661", "createdAt": "2020-05-12T13:03:09Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/drawable/form_state_finalized.xml", "diffHunk": "@@ -1,20 +1,17 @@\n <vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        android:width=\"40dp\"\n-        android:height=\"40dp\"\n-        android:viewportWidth=\"120\"\n-        android:viewportHeight=\"120\">\n+    android:width=\"40dp\"\n+    android:height=\"40dp\"\n+    android:viewportWidth=\"120\"\n+    android:viewportHeight=\"120\">\n \n     <path\n-            android:pathData=\"M60,60m-60,0a60,60 0,1 1,120 0a60,60 0,1 1,-120 0\"\n-            android:fillColor=\"@color/deep_purple_500\"/>\n+        android:pathData=\"M67.195,26.83h-26.83c-3.688,0 -6.673,2.985 -6.673,6.633L33.66,86.537c0,3.648 2.984,6.634 6.673,6.634L80.61,93.171c3.689,0 6.707,-2.986 6.707,-6.634L87.317,46.732L67.195,26.829zM40.365,86.537L40.365,33.463h23.476L63.841,50.05L80.61,50.05v36.488L40.366,86.538z\"\n+        android:fillColor=\"?iconColor\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MDUyMg=="}, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzODQzODY2OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjoxMTo1OVrOGUDkVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjo1Njo0NFrOGUFN9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MzE1Nw==", "bodyText": "This should use of our Material Theme text appearances (TextAppearance.Collect.X). I'm guessing Headline6 is too big but have a play with it!", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423683157", "createdAt": "2020-05-12T12:11:59Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcxMDE5OQ==", "bodyText": "Headline6 looks pretty good. Done.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423710199", "createdAt": "2020-05-12T12:56:44Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4MzE1Nw=="}, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzODQ0MzYwOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjoxMzoyMVrOGUDndg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjo1NjowOFrOGUFMdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4Mzk1OA==", "bodyText": "This should be colorOnSurface. primaryTextColor is actually gone on master.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423683958", "createdAt": "2020-05-12T12:13:21Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwOTgxNA==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423709814", "createdAt": "2020-05-12T12:56:08Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4Mzk1OA=="}, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzODQ0NTQ3OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjoxMzo1NlrOGUDonA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjo1NjowMVrOGUFMJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4NDI1Mg==", "bodyText": "Could we use a text appearance for this as well?", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423684252", "createdAt": "2020-05-12T12:13:56Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />\n+\n+        <View\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"1dp\"\n+            android:layout_marginBottom=\"@dimen/margin_standard\"\n+            android:background=\"?colorPrimary\" />\n+    </LinearLayout>\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n+\n+        <ImageButton\n+            android:id=\"@+id/status_icon\"\n+            android:layout_width=\"30dp\"\n+            android:layout_height=\"30dp\" />\n+\n+        <TextView\n+            android:id=\"@+id/status_text\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwOTczMw==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423709733", "createdAt": "2020-05-12T12:56:01Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />\n+\n+        <View\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"1dp\"\n+            android:layout_marginBottom=\"@dimen/margin_standard\"\n+            android:background=\"?colorPrimary\" />\n+    </LinearLayout>\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n+\n+        <ImageButton\n+            android:id=\"@+id/status_icon\"\n+            android:layout_width=\"30dp\"\n+            android:layout_height=\"30dp\" />\n+\n+        <TextView\n+            android:id=\"@+id/status_text\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4NDI1Mg=="}, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzODQ0NjU1OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjoxNDoxN1rOGUDpRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjo1NTo1NFrOGUFL2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4NDQyMg==", "bodyText": "Again using a standard text appearance would be nice!", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423684422", "createdAt": "2020-05-12T12:14:17Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />\n+\n+        <View\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"1dp\"\n+            android:layout_marginBottom=\"@dimen/margin_standard\"\n+            android:background=\"?colorPrimary\" />\n+    </LinearLayout>\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n+\n+        <ImageButton\n+            android:id=\"@+id/status_icon\"\n+            android:layout_width=\"30dp\"\n+            android:layout_height=\"30dp\" />\n+\n+        <TextView\n+            android:id=\"@+id/status_text\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\"\n+            android:layout_marginStart=\"@dimen/margin_standard\"\n+            android:layout_gravity=\"center_vertical\"/>\n+\n+    </LinearLayout>\n+\n+    <com.google.android.material.chip.Chip\n+        android:id=\"@+id/openFormChip\"\n+        android:visibility=\"gone\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginTop=\"@dimen/margin_small\"\n+        android:textColor=\"@android:color/white\"\n+        app:chipBackgroundColor=\"?colorSecondary\"\n+        app:iconStartPadding=\"@dimen/margin_small\"\n+        app:chipEndPadding=\"@dimen/margin_small\"/>\n+\n+    <TextView\n+        android:id=\"@+id/info\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwOTY1OA==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r423709658", "createdAt": "2020-05-12T12:55:54Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/res/layout/submission_summary_layout.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<LinearLayout xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_marginTop=\"@dimen/margin_large\"\n+    android:background=\"?colorSurface\"\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"@dimen/margin_standard\"\n+    android:paddingVertical=\"@dimen/margin_small\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <TextView\n+            android:id=\"@+id/submission_name\"\n+            style=\"@style/TextAppearance.AppCompat.Headline\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\" />\n+\n+        <View\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"1dp\"\n+            android:layout_marginBottom=\"@dimen/margin_standard\"\n+            android:background=\"?colorPrimary\" />\n+    </LinearLayout>\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n+\n+        <ImageButton\n+            android:id=\"@+id/status_icon\"\n+            android:layout_width=\"30dp\"\n+            android:layout_height=\"30dp\" />\n+\n+        <TextView\n+            android:id=\"@+id/status_text\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:textColor=\"?primaryTextColor\"\n+            android:layout_marginStart=\"@dimen/margin_standard\"\n+            android:layout_gravity=\"center_vertical\"/>\n+\n+    </LinearLayout>\n+\n+    <com.google.android.material.chip.Chip\n+        android:id=\"@+id/openFormChip\"\n+        android:visibility=\"gone\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginTop=\"@dimen/margin_small\"\n+        android:textColor=\"@android:color/white\"\n+        app:chipBackgroundColor=\"?colorSecondary\"\n+        app:iconStartPadding=\"@dimen/margin_small\"\n+        app:chipEndPadding=\"@dimen/margin_small\"/>\n+\n+    <TextView\n+        android:id=\"@+id/info\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4NDQyMg=="}, "originalCommit": {"oid": "bdf6e5b859abd945f6d3b529ad7f2dc478898115"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTMyMjQ5OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormMapActivity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMzoyNDo1MFrOGUgKKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNDoxNjoxN1rOGUzxgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1MTU5Mw==", "bodyText": "It doesn't make sense to have both onFeatureClicked and showSummary since they have the same parameters and showSummary is only called from here. I'd keep onFeatureClicked and move the code here but you could also rename it to showSummary if you think that's clearer.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424151593", "createdAt": "2020-05-13T03:24:50Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormMapActivity.java", "diffHunk": "@@ -223,47 +216,10 @@ public void onLocationChanged(MapPoint point) {\n     }\n \n     /**\n-     * Reacts to a tap on a feature by showing a toast or switching activities to view or edit a form.\n+     * Reacts to a tap on a feature by showing a submission summary.\n      */\n     public void onFeatureClicked(int featureId) {\n-        MappableFormInstance instance = instancesByFeatureId.get(featureId);\n-        ClickAction clickAction = instance == null ? FormMapViewModel.ClickAction.NONE : instance.getClickAction();\n-\n-        boolean canEditSaved = (Boolean) AdminSharedPreferences.getInstance().get(AdminKeys.KEY_EDIT_SAVED);\n-\n-        switch (clickAction) {\n-            case DELETED_TOAST:\n-                String deletedTime = getString(R.string.deleted_on_date_at_time);\n-                String disabledMessage = new SimpleDateFormat(deletedTime,\n-                        Locale.getDefault()).format(viewModel.getDeletedDateOf(instance.getDatabaseId()));\n-\n-                ToastUtils.showLongToast(disabledMessage);\n-                break;\n-            case NOT_VIEWABLE_TOAST:\n-                ToastUtils.showLongToast(R.string.cannot_edit_completed_form);\n-                break;\n-            case OPEN_READ_ONLY:\n-                startActivity(getViewOnlyFormInstanceIntentFor(featureId));\n-                break;\n-            case OPEN_EDIT:\n-                if (canEditSaved) {\n-                    startActivity(getEditFormInstanceIntentFor(featureId));\n-                } else {\n-                    startActivity(getViewOnlyFormInstanceIntentFor(featureId));\n-                }\n-                break;\n-        }\n-    }\n-\n-    private Intent getEditFormInstanceIntentFor(int featureId) {\n-        Uri uri = ContentUris.withAppendedId(InstanceColumns.CONTENT_URI, instancesByFeatureId.get(featureId).getDatabaseId());\n-        return new Intent(Intent.ACTION_EDIT, uri);\n-    }\n-\n-    private Intent getViewOnlyFormInstanceIntentFor(int featureId) {\n-        Intent intent = getEditFormInstanceIntentFor(featureId);\n-        intent.putExtra(ApplicationConstants.BundleKeys.FORM_MODE, ApplicationConstants.FormModes.VIEW_SENT);\n-        return intent;\n+        showSummary(featureId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ3Mjk2MA==", "bodyText": "Fixed.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424472960", "createdAt": "2020-05-13T14:16:17Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormMapActivity.java", "diffHunk": "@@ -223,47 +216,10 @@ public void onLocationChanged(MapPoint point) {\n     }\n \n     /**\n-     * Reacts to a tap on a feature by showing a toast or switching activities to view or edit a form.\n+     * Reacts to a tap on a feature by showing a submission summary.\n      */\n     public void onFeatureClicked(int featureId) {\n-        MappableFormInstance instance = instancesByFeatureId.get(featureId);\n-        ClickAction clickAction = instance == null ? FormMapViewModel.ClickAction.NONE : instance.getClickAction();\n-\n-        boolean canEditSaved = (Boolean) AdminSharedPreferences.getInstance().get(AdminKeys.KEY_EDIT_SAVED);\n-\n-        switch (clickAction) {\n-            case DELETED_TOAST:\n-                String deletedTime = getString(R.string.deleted_on_date_at_time);\n-                String disabledMessage = new SimpleDateFormat(deletedTime,\n-                        Locale.getDefault()).format(viewModel.getDeletedDateOf(instance.getDatabaseId()));\n-\n-                ToastUtils.showLongToast(disabledMessage);\n-                break;\n-            case NOT_VIEWABLE_TOAST:\n-                ToastUtils.showLongToast(R.string.cannot_edit_completed_form);\n-                break;\n-            case OPEN_READ_ONLY:\n-                startActivity(getViewOnlyFormInstanceIntentFor(featureId));\n-                break;\n-            case OPEN_EDIT:\n-                if (canEditSaved) {\n-                    startActivity(getEditFormInstanceIntentFor(featureId));\n-                } else {\n-                    startActivity(getViewOnlyFormInstanceIntentFor(featureId));\n-                }\n-                break;\n-        }\n-    }\n-\n-    private Intent getEditFormInstanceIntentFor(int featureId) {\n-        Uri uri = ContentUris.withAppendedId(InstanceColumns.CONTENT_URI, instancesByFeatureId.get(featureId).getDatabaseId());\n-        return new Intent(Intent.ACTION_EDIT, uri);\n-    }\n-\n-    private Intent getViewOnlyFormInstanceIntentFor(int featureId) {\n-        Intent intent = getEditFormInstanceIntentFor(featureId);\n-        intent.putExtra(ApplicationConstants.BundleKeys.FORM_MODE, ApplicationConstants.FormModes.VIEW_SENT);\n-        return intent;\n+        showSummary(featureId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1MTU5Mw=="}, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTMzMTExOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/fragments/dialogs/InstanceSummaryDialogFragment.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMzozMToyNVrOGUgPog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNDoxNTozM1rOGUzvWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1Mjk5NA==", "bodyText": "This is much better and I guess that if truly only necessary data is being saved continuing to use onSaveInstanceState is not so bad.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424152994", "createdAt": "2020-05-13T03:31:25Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/fragments/dialogs/InstanceSummaryDialogFragment.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package org.odk.collect.android.fragments.dialogs;\n+\n+import android.content.ContentUris;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.net.Uri;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ImageView;\n+import android.widget.TextView;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.content.ContextCompat;\n+import androidx.lifecycle.ViewModelProviders;\n+\n+import com.google.android.material.bottomsheet.BottomSheetDialogFragment;\n+import com.google.android.material.chip.Chip;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.viewmodels.FormMapViewModel;\n+import org.odk.collect.android.preferences.AdminKeys;\n+import org.odk.collect.android.preferences.AdminSharedPreferences;\n+import org.odk.collect.android.provider.InstanceProvider;\n+import org.odk.collect.android.provider.InstanceProviderAPI;\n+import org.odk.collect.android.utilities.ApplicationConstants;\n+import org.odk.collect.android.utilities.IconUtils;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Locale;\n+\n+import butterknife.BindView;\n+import butterknife.ButterKnife;\n+\n+public class InstanceSummaryDialogFragment extends BottomSheetDialogFragment {\n+    public static final String INSTANCE_ID = \"instanceId\";\n+\n+    private long instanceId;\n+\n+    private FormMapViewModel viewModel;\n+\n+    @BindView(R.id.submission_name)\n+    public TextView submissionName;\n+\n+    @BindView(R.id.status_icon)\n+    public ImageView statusIcon;\n+\n+    @BindView(R.id.status_text)\n+    public TextView statusText;\n+\n+    @BindView(R.id.info)\n+    public TextView infoText;\n+\n+    @BindView(R.id.openFormChip)\n+    public Chip openFormChip;\n+\n+    @Override\n+    public void onAttach(@NonNull Context context) {\n+        super.onAttach(context);\n+        viewModel = ViewModelProviders.of(requireActivity()).get(FormMapViewModel.class);\n+    }\n+\n+    @Nullable\n+    @Override\n+    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n+        View view = inflater.inflate(R.layout.submission_summary_layout, container, false);\n+        ButterKnife.bind(this, view);\n+        return view;\n+    }\n+\n+    @Override\n+    public void onSaveInstanceState(Bundle outState) {\n+        outState.putLong(INSTANCE_ID, instanceId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ3MjQwOQ==", "bodyText": "This class no longer exists.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424472409", "createdAt": "2020-05-13T14:15:33Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/fragments/dialogs/InstanceSummaryDialogFragment.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package org.odk.collect.android.fragments.dialogs;\n+\n+import android.content.ContentUris;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.net.Uri;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ImageView;\n+import android.widget.TextView;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.content.ContextCompat;\n+import androidx.lifecycle.ViewModelProviders;\n+\n+import com.google.android.material.bottomsheet.BottomSheetDialogFragment;\n+import com.google.android.material.chip.Chip;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.activities.viewmodels.FormMapViewModel;\n+import org.odk.collect.android.preferences.AdminKeys;\n+import org.odk.collect.android.preferences.AdminSharedPreferences;\n+import org.odk.collect.android.provider.InstanceProvider;\n+import org.odk.collect.android.provider.InstanceProviderAPI;\n+import org.odk.collect.android.utilities.ApplicationConstants;\n+import org.odk.collect.android.utilities.IconUtils;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Locale;\n+\n+import butterknife.BindView;\n+import butterknife.ButterKnife;\n+\n+public class InstanceSummaryDialogFragment extends BottomSheetDialogFragment {\n+    public static final String INSTANCE_ID = \"instanceId\";\n+\n+    private long instanceId;\n+\n+    private FormMapViewModel viewModel;\n+\n+    @BindView(R.id.submission_name)\n+    public TextView submissionName;\n+\n+    @BindView(R.id.status_icon)\n+    public ImageView statusIcon;\n+\n+    @BindView(R.id.status_text)\n+    public TextView statusText;\n+\n+    @BindView(R.id.info)\n+    public TextView infoText;\n+\n+    @BindView(R.id.openFormChip)\n+    public Chip openFormChip;\n+\n+    @Override\n+    public void onAttach(@NonNull Context context) {\n+        super.onAttach(context);\n+        viewModel = ViewModelProviders.of(requireActivity()).get(FormMapViewModel.class);\n+    }\n+\n+    @Nullable\n+    @Override\n+    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n+        View view = inflater.inflate(R.layout.submission_summary_layout, container, false);\n+        ButterKnife.bind(this, view);\n+        return view;\n+    }\n+\n+    @Override\n+    public void onSaveInstanceState(Bundle outState) {\n+        outState.putLong(INSTANCE_ID, instanceId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1Mjk5NA=="}, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTMzMzcyOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/FormMapViewModel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMzozMzoxN1rOGUgRMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNDoxNToxMVrOGUzuQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1MzM5Mw==", "bodyText": "Doing a sequential search here could be slow if there are lots of instances. I might have considered saving the database id to make this lookup fast. It's probably not that important to do now but wanted to flag it for future consideration.", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424153393", "createdAt": "2020-05-13T03:33:17Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/FormMapViewModel.java", "diffHunk": "@@ -99,6 +102,15 @@ private void initializeFormInstances() {\n         return mappableFormInstances;\n     }\n \n+    public MappableFormInstance getInstanceById(long instanceId) {\n+        for (MappableFormInstance mappableFormInstance : mappableFormInstances) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ3MjEyOQ==", "bodyText": "It is removed after removing BottomSheetDialogFragment", "url": "https://github.com/getodk/collect/pull/3778#discussion_r424472129", "createdAt": "2020-05-13T14:15:11Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/viewmodels/FormMapViewModel.java", "diffHunk": "@@ -99,6 +102,15 @@ private void initializeFormInstances() {\n         return mappableFormInstances;\n     }\n \n+    public MappableFormInstance getInstanceById(long instanceId) {\n+        for (MappableFormInstance mappableFormInstance : mappableFormInstances) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE1MzM5Mw=="}, "originalCommit": {"oid": "54702100a73b76ffcfca67d730e4f4b7b743881c"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3319, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}