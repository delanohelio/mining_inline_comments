{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMzQxODI3", "number": 4035, "title": "Handle NPE in DatabaseMediaFileRepository#getAll()", "bodyText": "Closes #4034\nWhat has been done to verify that this works as intended?\nI reviewed implemented changes.\nWhy is this the best possible solution? Were any other approaches considered?\nThe issue was caused by null formMediaPath. if that value is null and we call newFile(formMediaPath) NPE is thrown. Another solution would be to catch that exception but since we now what is the cause its' a better approach to just avoid it.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nI think this doesn't require testing. A review from another contributor should be enough.\nDo we need any specific form for testing your changes? If so, please attach one.\nNo.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-08-24T08:03:54Z", "url": "https://github.com/getodk/collect/pull/4035", "merged": true, "mergeCommit": {"oid": "622fbc05118eebc821e72759ab16f6053237eb1a"}, "closed": true, "closedAt": "2020-08-26T11:16:00Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdB_Fb7gFqTQ3MzI3MzI0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCpTzGgBqjM2OTQxNDcyMjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMjczMjQx", "url": "https://github.com/getodk/collect/pull/4035#pullrequestreview-473273241", "createdAt": "2020-08-24T09:17:24Z", "commit": {"oid": "b7ef4f8611c727f75c1ef969d8e128338784a5a5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToxNzoyNVrOHFbZUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToyMTowM1rOHFbh3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ1Mzc3OQ==", "bodyText": "I think we could avoid the array initialization here with an if-else on the formMediaPath != null and just returning emptyList in the else case. The new File[0] going into the asList confused me.", "url": "https://github.com/getodk/collect/pull/4035#discussion_r475453779", "createdAt": "2020-08-24T09:17:25Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "diffHunk": "@@ -12,7 +12,10 @@\n     @Override\n     public List<File> getAll(String jrFormID, String formVersion) {\n         String formMediaPath = new FormsDao().getFormMediaPath(jrFormID, formVersion);\n-        File[] files = new File(formMediaPath).listFiles();\n+        File[] files = new File[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7ef4f8611c727f75c1ef969d8e128338784a5a5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ1NTk2NA==", "bodyText": "I think we need a test to drive this out so we avoid regressing at any point. As far as I can see the situation that gives us the NPE (for the previous code) was if getAll was queried for a jrFormID and formVersion not in the database. If that's right we could have a DatabaseMediaFileRepositoryTest similar to the DatabaseFormRepositoryTest and a test that just checks we get back an empty list when there is nothing in the database.", "url": "https://github.com/getodk/collect/pull/4035#discussion_r475455964", "createdAt": "2020-08-24T09:21:03Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/forms/DatabaseMediaFileRepository.java", "diffHunk": "@@ -12,7 +12,10 @@\n     @Override\n     public List<File> getAll(String jrFormID, String formVersion) {\n         String formMediaPath = new FormsDao().getFormMediaPath(jrFormID, formVersion);\n-        File[] files = new File(formMediaPath).listFiles();\n+        File[] files = new File[0];\n+        if (formMediaPath != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7ef4f8611c727f75c1ef969d8e128338784a5a5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNDQ1NTMx", "url": "https://github.com/getodk/collect/pull/4035#pullrequestreview-473445531", "createdAt": "2020-08-24T13:06:29Z", "commit": {"oid": "87d0397d2dd39dd459556da9429aa35589bd25fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c169bb048471983acaf54935446e8b9fdb197620", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c169bb048471983acaf54935446e8b9fdb197620", "committedDate": "2020-08-26T09:16:45Z", "message": "Handle NPE in DatabaseMediaFileRepository#getAll()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bc4d0f102c608bbc5bd1dcce95d4a69ebcffdb6", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/5bc4d0f102c608bbc5bd1dcce95d4a69ebcffdb6", "committedDate": "2020-08-26T09:16:45Z", "message": "Code improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87d0397d2dd39dd459556da9429aa35589bd25fc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/87d0397d2dd39dd459556da9429aa35589bd25fc", "committedDate": "2020-08-24T11:15:57Z", "message": "Added tests"}, "afterCommit": {"oid": "99a2d842770bb6fc672a7c415277a04ed51f7063", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/99a2d842770bb6fc672a7c415277a04ed51f7063", "committedDate": "2020-08-26T09:16:45Z", "message": "Added tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99a2d842770bb6fc672a7c415277a04ed51f7063", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/99a2d842770bb6fc672a7c415277a04ed51f7063", "committedDate": "2020-08-26T09:16:45Z", "message": "Added tests"}, "afterCommit": {"oid": "33f02c39263c32a4cd6673a125346bd257a9991a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/33f02c39263c32a4cd6673a125346bd257a9991a", "committedDate": "2020-08-26T10:28:22Z", "message": "Added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb35bd17a89d8a0e5d1774e48bef7e50d20377da", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/eb35bd17a89d8a0e5d1774e48bef7e50d20377da", "committedDate": "2020-08-26T10:32:31Z", "message": "Added tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33f02c39263c32a4cd6673a125346bd257a9991a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/33f02c39263c32a4cd6673a125346bd257a9991a", "committedDate": "2020-08-26T10:28:22Z", "message": "Added tests"}, "afterCommit": {"oid": "eb35bd17a89d8a0e5d1774e48bef7e50d20377da", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/eb35bd17a89d8a0e5d1774e48bef7e50d20377da", "committedDate": "2020-08-26T10:32:31Z", "message": "Added tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2609, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}