{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMzcyNjQw", "number": 3773, "title": "Check if selected map layer file exists before using it", "bodyText": "Closes #3771\nWhat has been done to verify that this works as intended?\nI was able to reproduce the issue following the steps described below and confirmed this pr fixes the issue.\nWhy is this the best possible solution? Were any other approaches considered?\nI was able to reproduce the issue reported in #3771. Steps are:\n\nDownload any offline map layer and paste it to layers/ dir.\nSelect the downloaded layer in the map settings.\nGo to any geo widget which uses maps.\nRemove the offline map layer from layers dir\nOpen the map view from the geo widget.\n\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nThis change is safe, we just need to confirm the crash mentioned in the issue doesn't exist anymore using the steps I described above.\nDo we need any specific form for testing your changes? If so, please attach one.\nAny form with geo widgets.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-04-09T11:35:30Z", "url": "https://github.com/getodk/collect/pull/3773", "merged": true, "mergeCommit": {"oid": "94ee160810e06d3f100f8c596f92d1a76559c446"}, "closed": true, "closedAt": "2020-04-30T16:02:10Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV4yBogH2gAyNDAxMzcyNjQwOmE3ZmU5NjIwNjIxMWVjYmFlZmQ4Nzk4MjRkN2M5Njk0ZThiNTM1YTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaD-TmgFqTM5Nzk1NzU4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7fe96206211ecbaefd879824d7c9694e8b535a5", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a7fe96206211ecbaefd879824d7c9694e8b535a5", "committedDate": "2020-04-09T09:07:49Z", "message": "Check if selected map layer file exists before using it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dca6503e3e83124dabc452162af1a23bf9da560f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/dca6503e3e83124dabc452162af1a23bf9da560f", "committedDate": "2020-04-09T09:21:58Z", "message": "Factored out getReferenceLayerFile() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86c798472929feb4d860fadac714b9958f96769b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/86c798472929feb4d860fadac714b9958f96769b", "committedDate": "2020-04-09T10:07:45Z", "message": "Select none if another option selected but its file does not exist"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjE2ODE3", "url": "https://github.com/getodk/collect/pull/3773#pullrequestreview-396616817", "createdAt": "2020-04-20T16:27:57Z", "commit": {"oid": "86c798472929feb4d860fadac714b9958f96769b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyNzo1OFrOGIdFWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjoyNzo1OFrOGIdFWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxODI5Nw==", "bodyText": "It feels to me like this could be static util helper method (that probably takes a StoragePathProvider and Bundle as args). I'd generally think about a default implementation adding something to the external interface where as this seems more like a helper for the MapFragment implementations. What do you think?\nEither way I think this piece of logic should have a test to drive out that it checks for file existance as well as grabbing the layer path.", "url": "https://github.com/getodk/collect/pull/3773#discussion_r411518297", "createdAt": "2020-04-20T16:27:58Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/geo/MapFragment.java", "diffHunk": "@@ -206,4 +209,11 @@ void addTo(\n     interface FeatureListener {\n         void onFeature(int featureId);\n     }\n+\n+    default File getReferenceLayerFile(Bundle config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c798472929feb4d860fadac714b9958f96769b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c013f09b36432f89a2d6979ed04e583c09deb63", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/5c013f09b36432f89a2d6979ed04e583c09deb63", "committedDate": "2020-04-21T09:03:57Z", "message": "Moved getReferenceLayerFile() to GeoUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b59842d437f699e02519e09f2f3c80a0dc157e90", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b59842d437f699e02519e09f2f3c80a0dc157e90", "committedDate": "2020-04-21T13:55:47Z", "message": "Added tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTU3NTgy", "url": "https://github.com/getodk/collect/pull/3773#pullrequestreview-397957582", "createdAt": "2020-04-22T08:25:53Z", "commit": {"oid": "b59842d437f699e02519e09f2f3c80a0dc157e90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2655, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}