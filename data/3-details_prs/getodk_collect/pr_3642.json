{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NjA0MzAz", "number": 3642, "title": "Replace Espresso tests for default image with Widget tests", "bodyText": "Follow up to #3579\nThis adds tests for widgets that do and don't support default images. These tests are at the individual widget level and allow us to remove the Espresso test that was covering this feature previously. We'd initially discussed also adding tests for ther non default image flow but I think this is enough to merge for now (I've create an issue for the extra work at #3643).\nWhat has been done to verify that this works as intended?\nTo do something like this generally the process I follow is:\n\nRun the Espresso test I think we can get rid of - verify it's green\nComment out code for feature until the Espresso test is red\nWrite tests that drive out the feature at a different level - verify they're red\nMake the new tests go green\nVerify the Espresso test is also now green - delete it\n\nWhy is this the best possible solution? Were any other approaches considered?\nWe could of course keep the tests at an Espresso level instead but I feel like a widget/Robolectric test is better as it allows more granularity around the assertions (the image loaded for instance) and also provides faster and more \"connected\" feedback - it's easier to know what tests to run when working on a specific widget.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nNo changes to non-test code so probably good to merge this on acceptance.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-02-18T13:00:07Z", "url": "https://github.com/getodk/collect/pull/3642", "merged": true, "mergeCommit": {"oid": "dcdb011c5cc98167245c483038a63184e54f7770"}, "closed": true, "closedAt": "2020-02-21T10:57:33Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFd9vJgH2gAyMzc2NjA0MzAzOjI3ZTQ4OTE3MjE4MTc5NzU0MGVmMzA5ZDNkZGJiMDkxYTE1ZDU1MGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGQmZfgFqTM2MjE4Njk4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27e489172181797540ef309d3ddbb091a15d550a", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/27e489172181797540ef309d3ddbb091a15d550a", "committedDate": "2020-02-18T08:50:23Z", "message": "Replace default image Espresso test with Widget tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d3121edffb5a8546036b9cf6264859b860c8b01", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/1d3121edffb5a8546036b9cf6264859b860c8b01", "committedDate": "2020-02-18T10:48:17Z", "message": "Improve fake reference manager setup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e5994c0534e57de548b863fae5b1a40fe108f6f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8e5994c0534e57de548b863fae5b1a40fe108f6f", "committedDate": "2020-02-18T11:18:55Z", "message": "Use new fake reference manager setup in PromptAutoplayerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba01043760c1262ef24d8619f73a3eb56bdbcce9", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ba01043760c1262ef24d8619f73a3eb56bdbcce9", "committedDate": "2020-02-18T12:38:33Z", "message": "Use new reference manager setup in all tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzI0NjA1", "url": "https://github.com/getodk/collect/pull/3642#pullrequestreview-360324605", "createdAt": "2020-02-18T13:12:33Z", "commit": {"oid": "ba01043760c1262ef24d8619f73a3eb56bdbcce9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoxMjozM1rOFrBwxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoxMjozM1rOFrBwxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2MTk1Ng==", "bodyText": "This is potentially contraversial so happy to reenable the check and fix the problems if people disagree with me here.\nThe reason for disabling the check is that I think it can make writing tests with setup data hard. For instance:\nString testData1 = // setup test data\nString testData2 = // setup test data\nString testData3 = // setup tests data\n\ntestObject.doAThing(testData1);\ntestObject.doAThing(testData2);\ntestObject.doSomethingElse();\n\nassertThat(testObject.getSomething(), notNullValue());\nassertThat(testObject.getSomething().anotherThing(), equalTo(testData3));\nThis is a pretty common pattern for a test - we're setting up our inputs and outputs, carrying out the steps we're testing and then making an assertion on something we set up at the beginning of the test. This can make tests more readable and also helps if you need to mutate input/output values. This would fail our checkstyle build however as the testData3 declaration would be too far away from it's use.", "url": "https://github.com/getodk/collect/pull/3642#discussion_r380661956", "createdAt": "2020-02-18T13:12:33Z", "author": {"login": "seadowg"}, "path": "config/checkstyle.xml", "diffHunk": "@@ -186,7 +186,7 @@\n             <property name=\"allowedAbbreviationLength\" value=\"1\"/>\n         </module> -->\n         <module name=\"OverloadMethodsDeclarationOrder\" />\n-        <module name=\"VariableDeclarationUsageDistance\" />\n+        <!-- <module name=\"VariableDeclarationUsageDistance\" /> -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba01043760c1262ef24d8619f73a3eb56bdbcce9"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzE4NTMx", "url": "https://github.com/getodk/collect/pull/3642#pullrequestreview-361318531", "createdAt": "2020-02-19T18:09:42Z", "commit": {"oid": "ba01043760c1262ef24d8619f73a3eb56bdbcce9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "644314922f7295fb1a9646968e6c668e6b6fa984", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/644314922f7295fb1a9646968e6c668e6b6fa984", "committedDate": "2020-02-19T18:30:35Z", "message": "Make methods private"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTg2OTgz", "url": "https://github.com/getodk/collect/pull/3642#pullrequestreview-362186983", "createdAt": "2020-02-20T19:50:03Z", "commit": {"oid": "644314922f7295fb1a9646968e6c668e6b6fa984"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2301, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}