{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODE0MzEy", "number": 3721, "title": "Factored out NetworkStateProvider class", "bodyText": "What has been done to verify that this works as intended?\nI reviewed implemented changes.\nWhy is this the best possible solution? Were any other approaches considered?\nwe had the same code responsible for checking if a device is online in a few different classes so I factored it out.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nIt would be good to test these cases without internet connection:\n\nDownloading forms form Aggregate and Google Drive\nUploading forms to Aggregate and Google Sheets\nChoosing files from Google Drive\n\nDo we need any specific form for testing your changes? If so, please attach one.\nNo.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-03-17T12:45:23Z", "url": "https://github.com/getodk/collect/pull/3721", "merged": true, "mergeCommit": {"oid": "9594e13753cdd209d57d1fcf35dc152deea6790b"}, "closed": true, "closedAt": "2020-03-20T15:45:22Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOKrMTgH2gAyMzg5ODE0MzEyOjU0MGFlZTE3ZWQ0MzUzYTczNmQzMGZkYTY1ZGJjZjBiYzIxMTRjYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPJOSjAFqTM3NzU4NjgwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "540aee17ed4353a736d30fda65dbcf0bc2114cc6", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/540aee17ed4353a736d30fda65dbcf0bc2114cc6", "committedDate": "2020-03-16T09:27:15Z", "message": "Created NetworkStateProvider class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b09bbbbed23778da6b3c761c264e0ec3d5e2ee5e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b09bbbbed23778da6b3c761c264e0ec3d5e2ee5e", "committedDate": "2020-03-16T09:27:51Z", "message": "Use NetworkStateProvider in FormDownloadList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71483f5893f97f3ca2934f2ba7b2d1cdc9436241", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/71483f5893f97f3ca2934f2ba7b2d1cdc9436241", "committedDate": "2020-03-16T09:29:29Z", "message": "Use NetworkStateProvider in ServerPollingJob"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53a9815d1a51535e8e388b3ac3eb833e539e1c53", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/53a9815d1a51535e8e388b3ac3eb833e539e1c53", "committedDate": "2020-03-16T09:30:48Z", "message": "Use NetworkStateProvider in InstanceUploaderListActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "921b621eb29dae827a6c32b2e2af3f7758c39408", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/921b621eb29dae827a6c32b2e2af3f7758c39408", "committedDate": "2020-03-16T09:32:04Z", "message": "Use NetworkStateProvider in GoogleSheetsUploaderActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cac94c88ee3bf324f9c865742f9a85231db54e5a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/cac94c88ee3bf324f9c865742f9a85231db54e5a", "committedDate": "2020-03-16T09:33:52Z", "message": "Use NetworkStateProvider in GoogleDriveActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d697581ad155c4f66ca88fcd65f0669cbe23fcec", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d697581ad155c4f66ca88fcd65f0669cbe23fcec", "committedDate": "2020-03-16T09:34:43Z", "message": "Allow injecting NetworkStateProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e5ada22437c7e788d1534515ccbfa5db683ef87", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6e5ada22437c7e788d1534515ccbfa5db683ef87", "committedDate": "2020-03-16T10:16:58Z", "message": "Removed isNetworkAvailable method from Collect class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61df6b0f3aa599e614ec6c80e9cbec1ae1eb178b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/61df6b0f3aa599e614ec6c80e9cbec1ae1eb178b", "committedDate": "2020-03-16T10:20:47Z", "message": "Code improvements in NetworkStateProvider class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bf614cd7cbc87aa85afd474bd448231b5295751a", "committedDate": "2020-03-16T10:23:54Z", "message": "Use NetworkStateProvider in AutoSendWorker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDkwNzY1", "url": "https://github.com/getodk/collect/pull/3721#pullrequestreview-376090765", "createdAt": "2020-03-17T14:32:18Z", "commit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozMjoxOFrOF3e9JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0MjozMVrOF3facQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzE3Mw==", "bodyText": "While we're here could you rename the class to FormDownloadListActivity? Confuses me every time!", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393723173", "createdAt": "2020-03-17T14:32:18Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadList.java", "diffHunk": "@@ -126,6 +124,9 @@\n     @Inject\n     FormListDownloader formListDownloader;\n \n+    @Inject\n+    NetworkStateProvider networkStateProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzYxNQ==", "bodyText": "Probably don't need this anymore right?", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393723615", "createdAt": "2020-03-17T14:32:54Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -2900,5 +2904,9 @@ private void updateFieldListQuestions(FormIndex lastChangedIndex) {\n             return null;\n         }\n     }\n+\n+    public NetworkStateProvider getNetworkStateProvider() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNjA4Nw==", "bodyText": "Yes! Another method killed \ud83e\udd73", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393726087", "createdAt": "2020-03-17T14:36:09Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/application/Collect.java", "diffHunk": "@@ -161,20 +159,6 @@ public void setExternalDataManager(ExternalDataManager externalDataManager) {\n         this.externalDataManager = externalDataManager;\n     }\n \n-    /**\n-     * Get a User-Agent string that provides the platform details followed by the application ID\n-     * and application version name: {@code Dalvik/<version> (platform info) org.odk.collect.android/v<version>}.\n-     *\n-     * This deviates from the recommended format as described in https://github.com/opendatakit/collect/issues/3253.\n-     */\n-\n-    public boolean isNetworkAvailable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNzg0Ng==", "bodyText": "I think we could pass the NetworkStateProvider in here as a constructor arg rather than needing to have the getter (which I know understand) on FormEntryActivity.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393727846", "createdAt": "2020-03-17T14:38:37Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/tasks/MediaLoadingTask.java", "diffHunk": "@@ -56,7 +56,7 @@ protected File doInBackground(Uri... uris) {\n                 String destMediaPath = instanceFolder + File.separator + System.currentTimeMillis() + extension;\n \n                 try {\n-                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA);\n+                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA, formEntryActivity.get().getNetworkStateProvider());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMDY3Mw==", "bodyText": "This would be a nice opportunity for pulling out an interface I think. We could have an interface NetworkStateProvider and a class ConnectivityProvider. Means in tests we can fake without extending from a real implementation.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393730673", "createdAt": "2020-03-17T14:42:31Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/NetworkStateProvider.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.odk.collect.android.utilities;\n+\n+import android.content.Context;\n+import android.net.ConnectivityManager;\n+import android.net.NetworkInfo;\n+\n+import org.odk.collect.android.application.Collect;\n+\n+public class NetworkStateProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "023e7a5486f6e877baa6a9f1e3aa991478d83837", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/023e7a5486f6e877baa6a9f1e3aa991478d83837", "committedDate": "2020-03-18T08:58:12Z", "message": "Renamed FormDownloadList to FormDownloadListActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9483682f863a2f0617c17b27bb38e5b071c4ef91", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9483682f863a2f0617c17b27bb38e5b071c4ef91", "committedDate": "2020-03-18T09:22:01Z", "message": "Pass NetworkStateProvider to MediaLoadingTask via constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22eab322a386f5e8edbabb7cb56f78345aba6fc4", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/22eab322a386f5e8edbabb7cb56f78345aba6fc4", "committedDate": "2020-03-18T09:14:44Z", "message": "Pass NetworkStateProvider to MediaLoadingTask via constructor"}, "afterCommit": {"oid": "9483682f863a2f0617c17b27bb38e5b071c4ef91", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9483682f863a2f0617c17b27bb38e5b071c4ef91", "committedDate": "2020-03-18T09:22:01Z", "message": "Pass NetworkStateProvider to MediaLoadingTask via constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c0f02f762bb59931a44fa819f781abb48dc3a898", "committedDate": "2020-03-18T09:34:27Z", "message": "Pulled out NetworkStateProvider interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f79552e836399cc1c47cc41e6ed98b3f4bd4453", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/8f79552e836399cc1c47cc41e6ed98b3f4bd4453", "committedDate": "2020-03-18T09:31:48Z", "message": "Pulled out NetworkStateProvider interface"}, "afterCommit": {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c0f02f762bb59931a44fa819f781abb48dc3a898", "committedDate": "2020-03-18T09:34:27Z", "message": "Pulled out NetworkStateProvider interface"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODM1NjU3", "url": "https://github.com/getodk/collect/pull/3721#pullrequestreview-376835657", "createdAt": "2020-03-18T12:56:50Z", "commit": {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjo1Njo1MFrOF4DsCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjo1Njo1MFrOF4DsCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyNTAwMA==", "bodyText": "Here I'd expect Dagger to provide the interface (NetworkStateProvider) rather that the implementation. For me the goal of that is that the objects that use it don't need to care about the implementation object at all - just the interface.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394325000", "createdAt": "2020-03-18T12:56:50Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "diffHunk": "@@ -258,4 +259,9 @@ public CollectJobCreator providesCollectJobCreator() {\n     public BackgroundWorkManager providesBackgroundWorkManager() {\n         return new CollectBackgroundWorkManager();\n     }\n+\n+    @Provides\n+    public ConnectivityProvider providesConnectivityProvider() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "244a9853a4d04c544308b6c31f781225de619d3d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/244a9853a4d04c544308b6c31f781225de619d3d", "committedDate": "2020-03-19T09:32:17Z", "message": "Provide interface NetworkStateProvider in AppDependencyModule"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7b3c7e38105644e5d05034ec6241abf205d59a3", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d7b3c7e38105644e5d05034ec6241abf205d59a3", "committedDate": "2020-03-19T09:20:26Z", "message": "Provide interface NetworkStateProvider in AppDependencyModule"}, "afterCommit": {"oid": "244a9853a4d04c544308b6c31f781225de619d3d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/244a9853a4d04c544308b6c31f781225de619d3d", "committedDate": "2020-03-19T09:32:17Z", "message": "Provide interface NetworkStateProvider in AppDependencyModule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTg2ODAy", "url": "https://github.com/getodk/collect/pull/3721#pullrequestreview-377586802", "createdAt": "2020-03-19T10:19:42Z", "commit": {"oid": "244a9853a4d04c544308b6c31f781225de619d3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2351, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}