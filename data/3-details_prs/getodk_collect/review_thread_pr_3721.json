{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODE0MzEy", "number": 3721, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozMjoxOFrODovxTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjo1Njo1MFrODpGRaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDUyMzAyOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadList.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozMjoxOFrOF3e9JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwOToyMjo1OVrOF38XZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzE3Mw==", "bodyText": "While we're here could you rename the class to FormDownloadListActivity? Confuses me every time!", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393723173", "createdAt": "2020-03-17T14:32:18Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadList.java", "diffHunk": "@@ -126,6 +124,9 @@\n     @Inject\n     FormListDownloader formListDownloader;\n \n+    @Inject\n+    NetworkStateProvider networkStateProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNTAzMQ==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394205031", "createdAt": "2020-03-18T09:22:59Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadList.java", "diffHunk": "@@ -126,6 +124,9 @@\n     @Inject\n     FormListDownloader formListDownloader;\n \n+    @Inject\n+    NetworkStateProvider networkStateProvider;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzE3Mw=="}, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDUyNTU2OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozMjo1NFrOF3e-3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozMjo1NFrOF3e-3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzYxNQ==", "bodyText": "Probably don't need this anymore right?", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393723615", "createdAt": "2020-03-17T14:32:54Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -2900,5 +2904,9 @@ private void updateFieldListQuestions(FormIndex lastChangedIndex) {\n             return null;\n         }\n     }\n+\n+    public NetworkStateProvider getNetworkStateProvider() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDU0MDgxOnYy", "diffSide": "LEFT", "path": "collect_app/src/main/java/org/odk/collect/android/application/Collect.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozNjowOVrOF3fIhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozNjowOVrOF3fIhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNjA4Nw==", "bodyText": "Yes! Another method killed \ud83e\udd73", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393726087", "createdAt": "2020-03-17T14:36:09Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/application/Collect.java", "diffHunk": "@@ -161,20 +159,6 @@ public void setExternalDataManager(ExternalDataManager externalDataManager) {\n         this.externalDataManager = externalDataManager;\n     }\n \n-    /**\n-     * Get a User-Agent string that provides the platform details followed by the application ID\n-     * and application version name: {@code Dalvik/<version> (platform info) org.odk.collect.android/v<version>}.\n-     *\n-     * This deviates from the recommended format as described in https://github.com/opendatakit/collect/issues/3253.\n-     */\n-\n-    public boolean isNetworkAvailable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDU1MDk0OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/tasks/MediaLoadingTask.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozODozN1rOF3fPZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwOToyMzoxM1rOF38X8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNzg0Ng==", "bodyText": "I think we could pass the NetworkStateProvider in here as a constructor arg rather than needing to have the getter (which I know understand) on FormEntryActivity.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393727846", "createdAt": "2020-03-17T14:38:37Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/tasks/MediaLoadingTask.java", "diffHunk": "@@ -56,7 +56,7 @@ protected File doInBackground(Uri... uris) {\n                 String destMediaPath = instanceFolder + File.separator + System.currentTimeMillis() + extension;\n \n                 try {\n-                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA);\n+                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA, formEntryActivity.get().getNetworkStateProvider());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNTE3MQ==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394205171", "createdAt": "2020-03-18T09:23:13Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/tasks/MediaLoadingTask.java", "diffHunk": "@@ -56,7 +56,7 @@ protected File doInBackground(Uri... uris) {\n                 String destMediaPath = instanceFolder + File.separator + System.currentTimeMillis() + extension;\n \n                 try {\n-                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA);\n+                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA, formEntryActivity.get().getNetworkStateProvider());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNzg0Ng=="}, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDU2NzYwOnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/NetworkStateProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0MjozMVrOF3facQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwOTozNTo1NVrOF382cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMDY3Mw==", "bodyText": "This would be a nice opportunity for pulling out an interface I think. We could have an interface NetworkStateProvider and a class ConnectivityProvider. Means in tests we can fake without extending from a real implementation.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393730673", "createdAt": "2020-03-17T14:42:31Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/NetworkStateProvider.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.odk.collect.android.utilities;\n+\n+import android.content.Context;\n+import android.net.ConnectivityManager;\n+import android.net.NetworkInfo;\n+\n+import org.odk.collect.android.application.Collect;\n+\n+public class NetworkStateProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIxMjk3Nw==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394212977", "createdAt": "2020-03-18T09:35:55Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/NetworkStateProvider.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.odk.collect.android.utilities;\n+\n+import android.content.Context;\n+import android.net.ConnectivityManager;\n+import android.net.NetworkInfo;\n+\n+import org.odk.collect.android.application.Collect;\n+\n+public class NetworkStateProvider {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMDY3Mw=="}, "originalCommit": {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NDIwOTY4OnYy", "diffSide": "RIGHT", "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjo1Njo1MFrOF4DsCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOToyMToxMlrOF4mBBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyNTAwMA==", "bodyText": "Here I'd expect Dagger to provide the interface (NetworkStateProvider) rather that the implementation. For me the goal of that is that the objects that use it don't need to care about the implementation object at all - just the interface.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394325000", "createdAt": "2020-03-18T12:56:50Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "diffHunk": "@@ -258,4 +259,9 @@ public CollectJobCreator providesCollectJobCreator() {\n     public BackgroundWorkManager providesBackgroundWorkManager() {\n         return new CollectBackgroundWorkManager();\n     }\n+\n+    @Provides\n+    public ConnectivityProvider providesConnectivityProvider() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NzQyOQ==", "bodyText": "Done.", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394887429", "createdAt": "2020-03-19T09:21:12Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "diffHunk": "@@ -258,4 +259,9 @@ public CollectJobCreator providesCollectJobCreator() {\n     public BackgroundWorkManager providesBackgroundWorkManager() {\n         return new CollectBackgroundWorkManager();\n     }\n+\n+    @Provides\n+    public ConnectivityProvider providesConnectivityProvider() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyNTAwMA=="}, "originalCommit": {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3522, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}