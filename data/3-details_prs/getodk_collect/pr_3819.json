{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MzE2Njg5", "number": 3819, "title": "Make sure MapBox init fails silently", "bodyText": "This stops the app crashing on launch in the emulator (and on other devices where Mapbox native code isn't included).\nWhat has been done to verify that this works as intended?\nRan tests and launched app.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nWe should double check that this hasn't caused any regressions on the fixes #3804 introduced. I think if the reviewer could double check that we won't need QA for this.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-05-08T16:24:03Z", "url": "https://github.com/getodk/collect/pull/3819", "merged": true, "mergeCommit": {"oid": "75ef558c15cdfd35ac0ea347e5c513a6aa8f745a"}, "closed": true, "closedAt": "2020-05-11T10:09:46Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfUUrGgH2gAyNDE1MzE2Njg5OmQ5YWFlNzc3MTBlZDczYmU5ZDg2NGZlM2VmNzQ2NTFkN2U2YTcxMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgM0YYAFqTQwOTAzNjAxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d9aae77710ed73be9d864fe3ef74651d7e6a7117", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d9aae77710ed73be9d864fe3ef74651d7e6a7117", "committedDate": "2020-05-08T16:18:25Z", "message": "Make sure MapBox init fails silently"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MzU5NDcy", "url": "https://github.com/getodk/collect/pull/3819#pullrequestreview-408359472", "createdAt": "2020-05-08T16:27:46Z", "commit": {"oid": "d9aae77710ed73be9d864fe3ef74651d7e6a7117"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjoyNzo0NlrOGSrfJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjoyNzo0NlrOGSrfJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MDAzOA==", "bodyText": "I would catch Error here as well it might be needed in some cases like f6bc94e", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422240038", "createdAt": "2020-05-08T16:27:46Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);\n+            mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        } catch (Exception ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9aae77710ed73be9d864fe3ef74651d7e6a7117"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/97c219508cbcfc1c44d342932900c3a14ff28fed", "committedDate": "2020-05-08T16:29:44Z", "message": "Catch Error from Mapbox init fails as well"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MzY0MzE3", "url": "https://github.com/getodk/collect/pull/3819#pullrequestreview-408364317", "createdAt": "2020-05-08T16:35:31Z", "commit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjozNTozMVrOGSruPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjozNTozMVrOGSruPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MzkwMw==", "bodyText": "Are you sure this still does the job? I mean the map is not displayed anywhere but it might be required.", "url": "https://github.com/getodk/collect/pull/3819#discussion_r422243903", "createdAt": "2020-05-08T16:35:31Z", "author": {"login": "grzesiek2010"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/SplashScreenActivity.java", "diffHunk": "@@ -231,7 +231,13 @@ public void run() {\n     }\n \n     private void initMapBox() {\n-        MapView mapView = findViewById(R.id.mapView);\n-        mapView.getMapAsync(mapBoxMap -> mapBoxMap.setStyle(Style.MAPBOX_STREETS, style -> { }));\n+        // This \"one weird trick\" lets us initialize MapBox at app start when the internet is\n+        // most likely to be available. This is annoyingly needed for offline tiles to work.\n+        try {\n+            MapView mapView = getLayoutInflater().inflate(R.layout.mapbox_init, null).findViewById(R.id.mapView);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97c219508cbcfc1c44d342932900c3a14ff28fed"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cede13f5ad9e5f060cdd2941a1a8720903b287b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/9cede13f5ad9e5f060cdd2941a1a8720903b287b", "committedDate": "2020-05-08T21:26:09Z", "message": "Display mapbox map to perform initialization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDM2MDEz", "url": "https://github.com/getodk/collect/pull/3819#pullrequestreview-409036013", "createdAt": "2020-05-11T10:07:44Z", "commit": {"oid": "9cede13f5ad9e5f060cdd2941a1a8720903b287b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2678, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}