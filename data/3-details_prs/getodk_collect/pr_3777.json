{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNzA0NTY4", "number": 3777, "title": "Add experimental Material Theme", "bodyText": "Closes #3693\nWe've been talking for a while about switching to the newer MaterialComponents which has better support for the Material Components library that we are using. There are two core complications to doing this:\n\nThe MaterialComponents theme tries to provide some magic that actually makes our lives harder - an example would be that it automatically converts all the Button instances in XML to MaterialButton\nAndroid moved a lot of it's non material specific UI framework (dialogs, preferences etc) to a new androidx package and deprecated the old ones. The MaterialComponents theme doesn't behave that well with the older components which we still have a lot of.\n\nTo remove problem 1) this PR changes all the Button instances in the app to MaterialButton and styles them to look (as much as possible) like the buttons did before.\nSolving 2) will take a little longer but so we're not spending the rest of the year changing frameworks without much to say for it so I'm proposing we add a third \"experimental\" theme to the app (that extends MaterialComponents). This will let us offer it to users (maybe just in beta) while we track down and fix problems. It also lets us start a new theme (virtually) from scratch which will be nice for helping to eliminate styles and attributes we don't really need. An extra more fun advantage is that it will let us play with different colors for the app!\nHere's a screenshot of the new theme in all it's glory:\n\nYes that's the Central color scheme.\nThe things we still definitely need to fix to get to a point where this new theme could be our default are. We could either create a few issues or one \"super\" issues for these:\n\nProgressDialog buttons are showing as contained buttons. ProgressDialog has actually been deprecated and so it used the old android.app.AlertDialog which creates styling problems. I've made our ProgressDialogFragment use the new AlertDialog as part of this PR so we can replace the old ones (or change the design of loading) over time.\nThe date picker in DateWidget also uses contained buttons. I'm not very familiar with this part of the code but my thinking is we might just need to switch to using the new MaterialDatePicker here.\nWe use the old preferences framework in a bunch of places and this means any dialogs used there will probably not look right.\nRemove iconColor theme attribute by using more appropriate colors/multiple icons.\n\nWhat has been done to verify that this works as intended?\nRan all tests locally and on test lab. Played around with a few different forms.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nShouldn't be any real changes other than the new theme and that across all themes the buttons in widgets are very slightly bigger (as they use one of our standard margins for padding rather than a pixel value in code). There has been some changes to progress dialogs so testing them would be good.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-04-15T11:32:52Z", "url": "https://github.com/getodk/collect/pull/3777", "merged": true, "mergeCommit": {"oid": "cfc67acd8a88ee85308cb4431e052099c3f72333"}, "closed": true, "closedAt": "2020-05-08T14:23:27Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 41, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbtd9EgBqjMyNzUyNzY1MTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfPCyGgH2gAyNDAzNzA0NTY4OjA4ZmZmMTgxOTE2MjU1Yzc0Y2JiMDYxMWIwOTg4MzEyMzA5ODgyMTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6458b270f1777b2ea19dd0eb2f737cf87b72cbec", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/6458b270f1777b2ea19dd0eb2f737cf87b72cbec", "committedDate": "2020-04-17T15:50:09Z", "message": "When I grow up I want to be good at boolean logic"}, "afterCommit": {"oid": "e6e0cf75fdf51e2c742f69e2cfa1a22d199c084f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e6e0cf75fdf51e2c742f69e2cfa1a22d199c084f", "committedDate": "2020-04-27T10:22:16Z", "message": "When I grow up I want to be good at boolean logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNjc2OTA3", "url": "https://github.com/getodk/collect/pull/3777#pullrequestreview-403676907", "createdAt": "2020-04-30T16:19:22Z", "commit": {"oid": "1bc0d6c65fb1d80e6526f804adbd0149de47c020"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNjoxOToyMlrOGOwsVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzo0MjowM1rOGOztZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEzMTAzMQ==", "bodyText": "How about a comment here or putting it in a method called hideMaterialThemeForRelease or something?", "url": "https://github.com/getodk/collect/pull/3777#discussion_r418131031", "createdAt": "2020-04-30T16:19:22Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/preferences/UserInterfacePreferencesFragment.java", "diffHunk": "@@ -72,11 +87,19 @@ private void initThemePrefs() {\n         final ListPreference pref = (ListPreference) findPreference(KEY_APP_THEME);\n \n         if (pref != null) {\n+            if (versionInformation.isRelease()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bc0d6c65fb1d80e6526f804adbd0149de47c020"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE4MDQ1NQ==", "bodyText": "This is much better. It very nearly could close #3693 if you could add the couple of test cases suggested. I still think the regex approach could cut some of this down but it's now much easier to reason about so I'm fine with it as-is.", "url": "https://github.com/getodk/collect/pull/3777#discussion_r418180455", "createdAt": "2020-04-30T17:42:03Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/version/VersionInformation.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package org.odk.collect.android.version;\n+\n+import androidx.annotation.Nullable;\n+\n+public class VersionInformation {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bc0d6c65fb1d80e6526f804adbd0149de47c020"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce8cbb8c6005dc2286d2154ca3c1e594881694f7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/ce8cbb8c6005dc2286d2154ca3c1e594881694f7", "committedDate": "2020-05-04T13:14:03Z", "message": "Move button styles to their own file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d81a28f04155bb4452d9ddf672eb9ecdb99b74cf", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d81a28f04155bb4452d9ddf672eb9ecdb99b74cf", "committedDate": "2020-05-04T13:14:03Z", "message": "Switch Get Blank Form buttons to MaterialButtons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8894ab8351e707fd76b888693454230f8c20c82d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8894ab8351e707fd76b888693454230f8c20c82d", "committedDate": "2020-05-04T13:14:03Z", "message": "Switch Send Finalized Form buttons to MaterialButtons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cc5a06711799b63fc6b6e17f4b9a2858d5c7a8f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5cc5a06711799b63fc6b6e17f4b9a2858d5c7a8f", "committedDate": "2020-05-04T13:14:03Z", "message": "Switch Delete Saved Form buttons to MaterialButtons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1232f23da84db53f11289d6ef3c567c079e2aca", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/f1232f23da84db53f11289d6ef3c567c079e2aca", "committedDate": "2020-05-04T13:14:03Z", "message": "Make Save and Exit Form button a MAterialButton"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5480109a4d7d35e291c2e560038207bff8c88f75", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5480109a4d7d35e291c2e560038207bff8c88f75", "committedDate": "2020-05-04T13:14:03Z", "message": "Switch hierarchy screen to using MaterialButtons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d92d47638ffda1caef0ff5f7b6d2b688974c837a", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d92d47638ffda1caef0ff5f7b6d2b688974c837a", "committedDate": "2020-05-04T13:14:04Z", "message": "Drop letter spacing on button text style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223e6c9cb7870b2e1443642ed9d4e74f28fbafdc", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/223e6c9cb7870b2e1443642ed9d4e74f28fbafdc", "committedDate": "2020-05-04T13:14:04Z", "message": "MaterialButtons in Google Drive List"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "783ff50cb5da447d8289999c756ebed08850d2a7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/783ff50cb5da447d8289999c756ebed08850d2a7", "committedDate": "2020-05-04T13:14:04Z", "message": "Switch light theme to MaterialComponents theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "700bdc5d605e40ca09148384d79269b56cfb8e7c", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/700bdc5d605e40ca09148384d79269b56cfb8e7c", "committedDate": "2020-05-04T13:14:04Z", "message": "Fix alert dialog button style for light theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2803744758e1dce1970b4e0885959d9232d87e93", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/2803744758e1dce1970b4e0885959d9232d87e93", "committedDate": "2020-05-04T13:14:04Z", "message": "Fix option menu color"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5caf14cf57a5ae0cd35840eae808c00c87ca7d0", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d5caf14cf57a5ae0cd35840eae808c00c87ca7d0", "committedDate": "2020-05-04T13:14:04Z", "message": "Use MaterialButton for widget button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a769d00cad3758ec0bc7351253ec3a1ae08d0e36", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/a769d00cad3758ec0bc7351253ec3a1ae08d0e36", "committedDate": "2020-05-04T13:14:04Z", "message": "Move alert dialog theme to its own file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0622bff7fbc4362b24e759bd5d9e1958fb27e10a", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/0622bff7fbc4362b24e759bd5d9e1958fb27e10a", "committedDate": "2020-05-04T13:14:04Z", "message": "Switch dialogs to new alert dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51f6fc1ef321c67508cb67b3578f676ce62e6cdb", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/51f6fc1ef321c67508cb67b3578f676ce62e6cdb", "committedDate": "2020-05-04T13:14:04Z", "message": "Remove deprecated ProgressDialog from ProgressDialogFragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f17b90fc3217a7a0657474d81522034ee62882", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b8f17b90fc3217a7a0657474d81522034ee62882", "committedDate": "2020-05-04T13:14:04Z", "message": "Make dialog fragment tests more consistent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2206612412cb01dda859c116507fe861e9e50ec7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/2206612412cb01dda859c116507fe861e9e50ec7", "committedDate": "2020-05-04T13:14:04Z", "message": "Fix incorrect AlertDialog cast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5df37b14b57e138a26130334c87005c94788cf1", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/d5df37b14b57e138a26130334c87005c94788cf1", "committedDate": "2020-05-04T13:14:04Z", "message": "Remove retainInstance from ProgressDialogFragment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f8a0fd186f801741b13f0ab41ca83ae362dd0f2", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/1f8a0fd186f801741b13f0ab41ca83ae362dd0f2", "committedDate": "2020-05-04T13:14:05Z", "message": "Introduce 'Magenta' Material Components theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91aed322e4fc1840301eb4e76729b004b9892c2a", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/91aed322e4fc1840301eb4e76729b004b9892c2a", "committedDate": "2020-05-04T13:14:05Z", "message": "Correct icon color references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c8e99a11874f95126c2607c58de4a333a2d38db", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4c8e99a11874f95126c2607c58de4a333a2d38db", "committedDate": "2020-05-04T13:14:05Z", "message": "Mark new theme as experimental"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4981049faa382a3e759c61b816dbf850c52874b6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4981049faa382a3e759c61b816dbf850c52874b6", "committedDate": "2020-05-04T13:14:05Z", "message": "Move version information logic to use its own class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8326fb34ffeb29f58785e969090b9de742d98d77", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8326fb34ffeb29f58785e969090b9de742d98d77", "committedDate": "2020-05-04T13:14:05Z", "message": "Only show Magenta theme option in non release versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c961c414e65bdb9e23af705fc54c3f5499ef3d0f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c961c414e65bdb9e23af705fc54c3f5499ef3d0f", "committedDate": "2020-05-04T13:14:05Z", "message": "When I grow up I want to be good at boolean logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c13509f3f6a87d6861c21f5c742fe2871d768d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/27c13509f3f6a87d6861c21f5c742fe2871d768d", "committedDate": "2020-05-04T13:14:05Z", "message": "Prevent crash when changing theme in release versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99dd0bd35e4d709f6293baeeac14ea1d844b5e6e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/99dd0bd35e4d709f6293baeeac14ea1d844b5e6e", "committedDate": "2020-05-04T13:14:05Z", "message": "Use hard coded colors for form state icons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e4d80cbf3bbd0866de139aae9b73e397aac726f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4e4d80cbf3bbd0866de139aae9b73e397aac726f", "committedDate": "2020-05-04T13:14:05Z", "message": "Use AndroidX preferences for User Interface to prevent Dagger bugs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "122a3fa1307deca24ff83b1108780a5bfa55a674", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/122a3fa1307deca24ff83b1108780a5bfa55a674", "committedDate": "2020-05-04T09:32:45Z", "message": "Use AndroidX preferences for User Interface to prevent Dagger bugs"}, "afterCommit": {"oid": "4e4d80cbf3bbd0866de139aae9b73e397aac726f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4e4d80cbf3bbd0866de139aae9b73e397aac726f", "committedDate": "2020-05-04T13:14:05Z", "message": "Use AndroidX preferences for User Interface to prevent Dagger bugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3356c29ab68f171417a1975526b3dd9e1c985710", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/3356c29ab68f171417a1975526b3dd9e1c985710", "committedDate": "2020-05-04T13:28:16Z", "message": "Add method for hiding themes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "686a8cb2746dee8127532b878b74c8489289b6ae", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/686a8cb2746dee8127532b878b74c8489289b6ae", "committedDate": "2020-05-04T13:46:23Z", "message": "Move getSemanticVersion testing to VersionInformation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDI5ODkx", "url": "https://github.com/getodk/collect/pull/3777#pullrequestreview-405429891", "createdAt": "2020-05-05T00:15:03Z", "commit": {"oid": "686a8cb2746dee8127532b878b74c8489289b6ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00dcee9e228aefdeedc7c9b76199afb0513cd89d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/00dcee9e228aefdeedc7c9b76199afb0513cd89d", "committedDate": "2020-05-05T10:05:15Z", "message": "Add comment to describe AndroidXPreferenceActivity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e90c595d0902f529515a772427e007cdb645af7d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e90c595d0902f529515a772427e007cdb645af7d", "committedDate": "2020-05-06T12:12:58Z", "message": "Make bottom option buttons fixed height"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bc87c1dd9f7d59ce14d027086b364565edb460e", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/5bc87c1dd9f7d59ce14d027086b364565edb460e", "committedDate": "2020-05-06T13:10:17Z", "message": "Stop crash when opening offline layer dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fdaf5304da30f609be2724b2380580b07ac489b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/8fdaf5304da30f609be2724b2380580b07ac489b", "committedDate": "2020-05-06T14:44:33Z", "message": "Use colorPrimary for rank items rather than custom attribute"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb55938c4a75cfd3cb15836797e721fa9d021c5d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/eb55938c4a75cfd3cb15836797e721fa9d021c5d", "committedDate": "2020-05-06T14:54:46Z", "message": "Remove primaryTextColor attribute"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5b09ea8eecd7466b9e18bbfc03770c964cb736d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e5b09ea8eecd7466b9e18bbfc03770c964cb736d", "committedDate": "2020-05-06T14:59:07Z", "message": "Remove secondaryTextColor custom attribute"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4965179dc7806973facccc7fca4cf7860d9c57dd", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4965179dc7806973facccc7fca4cf7860d9c57dd", "committedDate": "2020-05-06T15:07:17Z", "message": "Remove custom spinner item background attribute"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08fff181916255c74cbb0611b098831230988219", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/08fff181916255c74cbb0611b098831230988219", "committedDate": "2020-05-08T10:09:21Z", "message": "Make sure bottom option buttons grow (together)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2658, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}