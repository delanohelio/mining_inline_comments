{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NzU0MDg0", "number": 3719, "title": "Avoid multiclicking in Admin and General settings", "bodyText": "Closes #3713\nI built this pr on top of #3699 to test the newly factored MultiClickGuard class.\nWhat has been done to verify that this works as intended?\nI tested the implemented changes manually.\nWhy is this the best possible solution? Were any other approaches considered?\nWe just need to use our MultiClickGuard class to avoid such bugs since android doesn't do that for us.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nI didn't only fix the case described in the issue with the Admin Password dialog. I decided to add the check for all options in Admin Settings and even in General Settings. I was able for example to reproduce the same issue with General Settings option that is in Admin Settings so I guess the same is possible with other options as well so I decided to handle all of them just in case. Please pay attention to that option (General Settings from Admin Settings) since in order to handle it as well I needed to add some more refactoring.\nDo we need any specific form for testing your changes? If so, please attach one.\nNo.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-03-17T10:35:38Z", "url": "https://github.com/getodk/collect/pull/3719", "merged": true, "mergeCommit": {"oid": "bd7ae411d69f8ce6ba343428c86fc6d33235ebc0"}, "closed": true, "closedAt": "2020-03-23T15:00:04Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKsgKugH2gAyMzg5NzU0MDg0OjVmZmNlZDgwM2I0NzNlYzlkZDllZGU3OTc4Y2QyNTdjZDg4NTQyODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPiRqwgH2gAyMzg5NzU0MDg0OmQ5MDcyNzA3MjcyODgxMGNjNzYxYWJjZDQ0YzQ0MzMwMmFjNzI1ZmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ffced803b473ec9dd9ede7978cd257cd8854282", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/5ffced803b473ec9dd9ede7978cd257cd8854282", "committedDate": "2020-03-05T14:36:17Z", "message": "Factored out MultiClickGuard class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c6cfce9c54b813c04d0d7a6b392e8cde3d823bc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/2c6cfce9c54b813c04d0d7a6b392e8cde3d823bc", "committedDate": "2020-03-17T09:59:27Z", "message": "Avoid multiclicking in Admin preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fec4e45fa6cc6dd8eaf38604f2f1bad85a63ef95", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/fec4e45fa6cc6dd8eaf38604f2f1bad85a63ef95", "committedDate": "2020-03-17T10:04:24Z", "message": "Avoid multiclicking in General preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4429e47844bf962248434dacdf433415dc11bf8d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/4429e47844bf962248434dacdf433415dc11bf8d", "committedDate": "2020-03-17T10:28:47Z", "message": "Handle starting general prefs from admin prefs in AdminPreferencesFragment to avoid multiclicking"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTIyMzIy", "url": "https://github.com/getodk/collect/pull/3719#pullrequestreview-376122322", "createdAt": "2020-03-17T15:05:08Z", "commit": {"oid": "4429e47844bf962248434dacdf433415dc11bf8d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTMyMTM3", "url": "https://github.com/getodk/collect/pull/3719#pullrequestreview-376132137", "createdAt": "2020-03-17T15:15:43Z", "commit": {"oid": "4429e47844bf962248434dacdf433415dc11bf8d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODMyNjM0", "url": "https://github.com/getodk/collect/pull/3719#pullrequestreview-376832634", "createdAt": "2020-03-18T12:52:48Z", "commit": {"oid": "4429e47844bf962248434dacdf433415dc11bf8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjo1Mjo0OFrOF4Dinw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjo1Mjo0OFrOF4Dinw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyMjU5MQ==", "bodyText": "I'm not sure I understand this. Does this assume no time passes between clicks in tests? As far as I can see this is true if not time has passed since the last click. In both espresso and normal junit it's very possible for a millisecond to pass between clicks. Maybe I just need some more caffeine \u2615\ufe0f.", "url": "https://github.com/getodk/collect/pull/3719#discussion_r394322591", "createdAt": "2020-03-18T12:52:48Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/MultiClickGuard.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.odk.collect.android.utilities;\n+\n+import android.os.SystemClock;\n+\n+public class MultiClickGuard {\n+    private static final int CLICK_DEBOUNCE_MS = 1000;\n+\n+    private static long lastClickTime;\n+    private static String lastClickName;\n+\n+    private MultiClickGuard() {\n+    }\n+\n+    // Debounce multiple clicks within the same screen\n+    public static boolean allowClick(String className) {\n+        long elapsedRealtime = SystemClock.elapsedRealtime();\n+        boolean isSameClass = className.equals(lastClickName);\n+        boolean isBeyondThreshold = elapsedRealtime - lastClickTime > CLICK_DEBOUNCE_MS;\n+        boolean isBeyondTestThreshold = lastClickTime == 0 || lastClickTime == elapsedRealtime; // just for tests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4429e47844bf962248434dacdf433415dc11bf8d"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTYyNTgy", "url": "https://github.com/getodk/collect/pull/3719#pullrequestreview-377562582", "createdAt": "2020-03-19T09:46:51Z", "commit": {"oid": "4429e47844bf962248434dacdf433415dc11bf8d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOTo0Njo1MlrOF4m7Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOTo0Njo1MlrOF4m7Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkwMjM3NA==", "bodyText": "Is doesn't need to be the same element though right? It just needs to be in the same class (generally we're passing the Activity). Personlly the solution confuses me and I'm sure there are simpler ways to work out if we're in tests or not. I can look at later seeing as I have a personal vendetta against the line \ud83d\ude01. Let's just make sure to run connectedAndroidTest to check Espresso doesn't run into any problems with all the new guards.", "url": "https://github.com/getodk/collect/pull/3719#discussion_r394902374", "createdAt": "2020-03-19T09:46:52Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/MultiClickGuard.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.odk.collect.android.utilities;\n+\n+import android.os.SystemClock;\n+\n+public class MultiClickGuard {\n+    private static final int CLICK_DEBOUNCE_MS = 1000;\n+\n+    private static long lastClickTime;\n+    private static String lastClickName;\n+\n+    private MultiClickGuard() {\n+    }\n+\n+    // Debounce multiple clicks within the same screen\n+    public static boolean allowClick(String className) {\n+        long elapsedRealtime = SystemClock.elapsedRealtime();\n+        boolean isSameClass = className.equals(lastClickName);\n+        boolean isBeyondThreshold = elapsedRealtime - lastClickTime > CLICK_DEBOUNCE_MS;\n+        boolean isBeyondTestThreshold = lastClickTime == 0 || lastClickTime == elapsedRealtime; // just for tests", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyMjU5MQ=="}, "originalCommit": {"oid": "4429e47844bf962248434dacdf433415dc11bf8d"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d90727072728810cc761abcd44c443302ac725fc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d90727072728810cc761abcd44c443302ac725fc", "committedDate": "2020-03-20T15:31:01Z", "message": "Avoid multiclicking on Form Metadata"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2349, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}