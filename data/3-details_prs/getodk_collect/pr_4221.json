{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODkxMjcy", "number": 4221, "title": "Don't always save media captured through Collect to the Media Store", "bodyText": "Closes #4070\nWhat has been done to verify that this works as intended?\nI tested the app manually and ran tests.\nWhy is this the best possible solution? Were any other approaches considered?\nWe agreed that we don't need to add media files to media store. That required a bit more code to remove than I expected and probably I could introduce more refactoring but I had to draw the line somewhere.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nMedia files should not be added to media store what means they should not be visible in galleries. When it comes to testing it would be good to confirm that taking media files in media widgets (ImageWidget/VideoWidget/AudioWidget/ArbitraryFileWidget) work as before:\n\nwe can add media files\nold media files are removed\nwe can open media files clicking for example on images/videos/arbitrary files\nmedia files recorded using ODK Collect are not visible in gallery apps\n\nDo we need any specific form for testing your changes? If so, please attach one.\nAny form with media widgets.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-11-13T22:58:03Z", "url": "https://github.com/getodk/collect/pull/4221", "merged": true, "mergeCommit": {"oid": "03ba40e2ab608317f69592ebde271cdd943837fe"}, "closed": true, "closedAt": "2020-11-20T18:37:41Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddJvqtgFqTUzMTYwNTA2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeUEs6ABqjQwMjAwMTA0NDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjA1MDY4", "url": "https://github.com/getodk/collect/pull/4221#pullrequestreview-531605068", "createdAt": "2020-11-16T18:44:18Z", "commit": {"oid": "7d8f65f6f3e1c35a2901675d6eade4d2beb41802"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxODo0NToxMFrOH0MjDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxODo0NToxMFrOH0MjDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5MzU4MA==", "bodyText": "Funny, I've looked at this code and all the related methods in MediaUtils a few times wondering why we were going through a content resolver instead of just accessing the files directly and it never clicked that it was part of all this business with the Media Store. I really wonder why it was done that way.", "url": "https://github.com/getodk/collect/pull/4221#discussion_r524493580", "createdAt": "2020-11-16T18:45:10Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/utilities/MediaUtils.java", "diffHunk": "@@ -91,49 +93,8 @@ public static final Uri getImageUriFromMediaProvider(String imageFile) {\n         }\n     }\n \n-    public int deleteImageFileFromMediaProvider(String imageFile) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d8f65f6f3e1c35a2901675d6eade4d2beb41802"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5b0d358a101d7128c112a0a7cb8268dd55dc58c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/e5b0d358a101d7128c112a0a7cb8268dd55dc58c", "committedDate": "2020-11-20T09:36:44Z", "message": "Do not add images to mediastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bbda8cd8e16b5b0150c2b6a9bb305772e32f937", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/5bbda8cd8e16b5b0150c2b6a9bb305772e32f937", "committedDate": "2020-11-20T09:36:44Z", "message": "Do not add videos to mediastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1c4cb694692011f187043f6867af26f22224eff", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f1c4cb694692011f187043f6867af26f22224eff", "committedDate": "2020-11-20T09:36:44Z", "message": "Do not add audios to mediastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0f7f46def6e6d89993c865a624bebc0e8e7a9f2", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c0f7f46def6e6d89993c865a624bebc0e8e7a9f2", "committedDate": "2020-11-20T09:36:44Z", "message": "Got rid of removing images using mediastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60cdde394276ee308d2d5a18e9149e62483fe4c4", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/60cdde394276ee308d2d5a18e9149e62483fe4c4", "committedDate": "2020-11-20T09:36:44Z", "message": "Do not remove media files separately using mediastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebef97aeca6006a1b3673aa9911410ee317c48f8", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ebef97aeca6006a1b3673aa9911410ee317c48f8", "committedDate": "2020-11-20T09:36:44Z", "message": "Removed unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dc5c163432f91c02e4067a443bd10f6df35e449", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0dc5c163432f91c02e4067a443bd10f6df35e449", "committedDate": "2020-11-20T09:36:44Z", "message": "Naming improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41104d55ca92510b0e2a055f443e0e65c79a858c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/41104d55ca92510b0e2a055f443e0e65c79a858c", "committedDate": "2020-11-20T09:36:44Z", "message": "Removed redundant MediaUtil class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6094f2303ec9adeb5ad21127b2485f7e6b797247", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6094f2303ec9adeb5ad21127b2485f7e6b797247", "committedDate": "2020-11-20T09:36:44Z", "message": "Factored out openFile() method from ArbitraryFileWidget to MediaUtils class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ac48f6f7a0221dbbcb2033133dcbe0babad1639", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/5ac48f6f7a0221dbbcb2033133dcbe0babad1639", "committedDate": "2020-11-20T09:36:44Z", "message": "Open images using the same code we use in case of arbitrary files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e6f405a98155fa5352be93267ec68f569390dd4", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6e6f405a98155fa5352be93267ec68f569390dd4", "committedDate": "2020-11-20T09:36:44Z", "message": "Removed unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aabb203b8e2135a9dc88d0ee5db0b13016aee39", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7aabb203b8e2135a9dc88d0ee5db0b13016aee39", "committedDate": "2020-11-20T09:36:44Z", "message": "Moved getDestinationPathFromSourcePath() to MediaUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "645a1b84dea39ca98580f58c4b07609f20c440b5", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/645a1b84dea39ca98580f58c4b07609f20c440b5", "committedDate": "2020-11-20T09:36:44Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35e9473587f3f24b91a52c4553a9f4c1279bc188", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/35e9473587f3f24b91a52c4553a9f4c1279bc188", "committedDate": "2020-11-20T09:36:44Z", "message": "Fixed tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0dc3eaf453e4f55e3835e32cdbb30f64c6442c83", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0dc3eaf453e4f55e3835e32cdbb30f64c6442c83", "committedDate": "2020-11-13T22:40:38Z", "message": "Fixed tests"}, "afterCommit": {"oid": "35e9473587f3f24b91a52c4553a9f4c1279bc188", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/35e9473587f3f24b91a52c4553a9f4c1279bc188", "committedDate": "2020-11-20T09:36:44Z", "message": "Fixed tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2470, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}