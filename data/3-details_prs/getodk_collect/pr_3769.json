{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNjgzOTk4", "number": 3769, "title": "Separate out test types", "bodyText": "This seperates out different test types into their own packages (mainly in androidTest) and adds documentation around them. I've also added gradle tasks for running different kinds of connected tests.\nI think there is definitely more documentation we could write on what tests to write for different kinds of feature/change but I think that's going to be VERY subjective and hard to write so I wanted to start with laying out people's options and seeing how contributors/we respond.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-04-08T07:44:53Z", "url": "https://github.com/getodk/collect/pull/3769", "merged": true, "mergeCommit": {"oid": "4c52f1b28b1e137a2411d82402436fcb0ca36def"}, "closed": true, "closedAt": "2020-04-23T14:11:38Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVjAiCgFqTM4OTcyNzYwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcacrBngFqTM5OTA4NDQyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NzI3NjA2", "url": "https://github.com/getodk/collect/pull/3769#pullrequestreview-389727606", "createdAt": "2020-04-08T07:45:45Z", "commit": {"oid": "359ea7418e1cae2de4b8dd732499013422757070"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0NTo0NVrOGCi7Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0NTo0NVrOGCi7Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMjU3NA==", "bodyText": "Bumped the patch version here. I think it may have fixed an issue with the Gradle Daemon getting orphaned but holding a lock on some config files.", "url": "https://github.com/getodk/collect/pull/3769#discussion_r405322574", "createdAt": "2020-04-08T07:45:45Z", "author": {"login": "seadowg"}, "path": "build.gradle", "diffHunk": "@@ -6,7 +6,7 @@ buildscript {\n         maven { url 'https://maven.fabric.io/public' }\n     }\n     dependencies {\n-        classpath 'com.android.tools.build:gradle:3.6.1'\n+        classpath 'com.android.tools.build:gradle:3.6.2'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359ea7418e1cae2de4b8dd732499013422757070"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NzI4MTQy", "url": "https://github.com/getodk/collect/pull/3769#pullrequestreview-389728142", "createdAt": "2020-04-08T07:46:34Z", "commit": {"oid": "359ea7418e1cae2de4b8dd732499013422757070"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0NjozNFrOGCi89Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0NjozNFrOGCi89Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMjk5Nw==", "bodyText": "Why are these tests all @Suppressed?", "url": "https://github.com/getodk/collect/pull/3769#discussion_r405322997", "createdAt": "2020-04-08T07:46:34Z", "author": {"login": "seadowg"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/feature/externalintents/InstanceChooserListTest.java", "diffHunk": "@@ -11,7 +11,7 @@\n \n import java.io.IOException;\n \n-import static org.odk.collect.android.externalintents.ExportedActivitiesUtils.testDirectories;\n+import static org.odk.collect.android.feature.externalintents.ExportedActivitiesUtils.testDirectories;\n \n @Suppress", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359ea7418e1cae2de4b8dd732499013422757070"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NzI5Nzky", "url": "https://github.com/getodk/collect/pull/3769#pullrequestreview-389729792", "createdAt": "2020-04-08T07:48:58Z", "commit": {"oid": "359ea7418e1cae2de4b8dd732499013422757070"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0ODo1OVrOGCjChQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0ODo1OVrOGCjChQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyNDQyMQ==", "bodyText": "There are a few places where I had to make constants/methods public that were previously package protected. If they weren't meant to be public then they really shouldn't have been used in the test but I didn't want to get into rewriting everything here.", "url": "https://github.com/getodk/collect/pull/3769#discussion_r405324421", "createdAt": "2020-04-08T07:48:59Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/database/helpers/FormsDatabaseHelper.java", "diffHunk": "@@ -55,7 +55,7 @@\n     private static final String DATABASE_NAME = \"forms.db\";\n     public static final String FORMS_TABLE_NAME = \"forms\";\n \n-    static final int DATABASE_VERSION = 8;\n+    public static final int DATABASE_VERSION = 8;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359ea7418e1cae2de4b8dd732499013422757070"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "359ea7418e1cae2de4b8dd732499013422757070", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/359ea7418e1cae2de4b8dd732499013422757070", "committedDate": "2020-04-07T12:56:58Z", "message": "Add test guideline link to contributing"}, "afterCommit": {"oid": "541ec683c1accbfeea3868261004036a4c5042f2", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/541ec683c1accbfeea3868261004036a4c5042f2", "committedDate": "2020-04-16T13:02:10Z", "message": "Add test guideline link to contributing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NzY0MDEw", "url": "https://github.com/getodk/collect/pull/3769#pullrequestreview-394764010", "createdAt": "2020-04-16T15:43:45Z", "commit": {"oid": "c507b77db7845102e24ed963326b641b07d7a282"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTo0Mzo0NVrOGGroBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNTo0NToyMFrOGGrsJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1OTM5OQ==", "bodyText": "effecting -> affecting", "url": "https://github.com/getodk/collect/pull/3769#discussion_r409659399", "createdAt": "2020-04-16T15:43:45Z", "author": {"login": "lognaturel"}, "path": "docs/TEST-GUIDELINES.md", "diffHunk": "@@ -0,0 +1,29 @@\n+# Test guidelines\n+\n+Automated tests are very important for building software. They let us add, modify and understand the code in our app with confidence and can prevent us from making mistakes that could end up effecting people collecting data in the field.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c507b77db7845102e24ed963326b641b07d7a282"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1OTkzMg==", "bodyText": "\"By far easiest way to make sure you have tests for the changes you're making is to follow\" -> \"We recommend following\"", "url": "https://github.com/getodk/collect/pull/3769#discussion_r409659932", "createdAt": "2020-04-16T15:44:33Z", "author": {"login": "lognaturel"}, "path": "docs/TEST-GUIDELINES.md", "diffHunk": "@@ -0,0 +1,29 @@\n+# Test guidelines\n+\n+Automated tests are very important for building software. They let us add, modify and understand the code in our app with confidence and can prevent us from making mistakes that could end up effecting people collecting data in the field.\n+\n+Almost any Pull Request for Collect will require a set of tests along with its code changes. Otherwise there will be nothing to ensure that that code continues to work or exist in the future. By far easiest way to make sure you have tests for the changes you're making is to follow a [TDD](https://en.wikipedia.org/wiki/Test-driven_development) style of development and write a test before each change/addition to the code.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c507b77db7845102e24ed963326b641b07d7a282"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY2MDQ1Mg==", "bodyText": "in the JVM -> on the JVM?", "url": "https://github.com/getodk/collect/pull/3769#discussion_r409660452", "createdAt": "2020-04-16T15:45:20Z", "author": {"login": "lognaturel"}, "path": "docs/TEST-GUIDELINES.md", "diffHunk": "@@ -0,0 +1,29 @@\n+# Test guidelines\n+\n+Automated tests are very important for building software. They let us add, modify and understand the code in our app with confidence and can prevent us from making mistakes that could end up effecting people collecting data in the field.\n+\n+Almost any Pull Request for Collect will require a set of tests along with its code changes. Otherwise there will be nothing to ensure that that code continues to work or exist in the future. By far easiest way to make sure you have tests for the changes you're making is to follow a [TDD](https://en.wikipedia.org/wiki/Test-driven_development) style of development and write a test before each change/addition to the code.\n+\n+## Different kinds of tests\n+\n+Although testing different components/features will often require different kinds and styles of testing the tests in Collect can broadly be divided into five kinds:\n+\n+### JUnit tests\n+\n+Plain old standard JUnit tests. All the tests in Collect use JUnit in someway but these tests don't use Android specific frameworks (like Espresso/Robolectric) These live in `collect_app/src/test/java`. Often they'll be focused on testing one object and will mock/fake/stub its dependencies (referred to as \"unit testing\") but some will test internal \"APIs\" (such as our Open Rosa server abstraction). The key to writing these kinds of tests is that they should not involve or depend on the Android framework. JUnit tests are run in the JVM.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c507b77db7845102e24ed963326b641b07d7a282"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODU4NTg4", "url": "https://github.com/getodk/collect/pull/3769#pullrequestreview-395858588", "createdAt": "2020-04-18T01:06:32Z", "commit": {"oid": "933722db08aafdd9f9d5ca7dafe59d1d488d1d56"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "933722db08aafdd9f9d5ca7dafe59d1d488d1d56", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/933722db08aafdd9f9d5ca7dafe59d1d488d1d56", "committedDate": "2020-04-17T16:11:40Z", "message": "Improve description of instrumented tests"}, "afterCommit": {"oid": "892a6d6163d0889a5b57dfadc0115e2be82b1b1f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/892a6d6163d0889a5b57dfadc0115e2be82b1b1f", "committedDate": "2020-04-22T14:21:07Z", "message": "Improve description of instrumented tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6496fff528c16adc0ecf18bb6fd5208492fc0f05", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/6496fff528c16adc0ecf18bb6fd5208492fc0f05", "committedDate": "2020-04-23T11:53:17Z", "message": "Add regression and feature tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ea0de5f11587eea1496b4e35c13b0a4100eccb", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c8ea0de5f11587eea1496b4e35c13b0a4100eccb", "committedDate": "2020-04-23T11:53:18Z", "message": "Move DAO tests to instrumented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3027827b5a72feceac4e60569d6288a0cf03ade7", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/3027827b5a72feceac4e60569d6288a0cf03ade7", "committedDate": "2020-04-23T11:53:18Z", "message": "Move database tests to instrumented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "923b7d8f22b547acff2d07cc48ae1b56870ef691", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/923b7d8f22b547acff2d07cc48ae1b56870ef691", "committedDate": "2020-04-23T11:53:18Z", "message": "Add FormUtilsTest to instrumented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58369bda73b07248937cbd92b2bea9f8230fb3d4", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/58369bda73b07248937cbd92b2bea9f8230fb3d4", "committedDate": "2020-04-23T11:53:18Z", "message": "Add task tests to instrumented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c15749ec39eb2d5934dbbab29139886a391ceb5", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/1c15749ec39eb2d5934dbbab29139886a391ceb5", "committedDate": "2020-04-23T11:53:18Z", "message": "Add util tests to instrumented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7ac8d23eb32e2240c4008a7218dfb69bda3004f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/b7ac8d23eb32e2240c4008a7218dfb69bda3004f", "committedDate": "2020-04-23T11:53:18Z", "message": "Add feature test package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e134fac9004b17af095345ba6c96222b7a441133", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/e134fac9004b17af095345ba6c96222b7a441133", "committedDate": "2020-04-23T11:53:18Z", "message": "Move tests at root to the right places"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68464769518a79677222a885e5398b524cdf3eb2", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/68464769518a79677222a885e5398b524cdf3eb2", "committedDate": "2020-04-23T11:53:18Z", "message": "Move External Intent tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50d4a8610085d19e8e5b6158e21bbe1582c12f90", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/50d4a8610085d19e8e5b6158e21bbe1582c12f90", "committedDate": "2020-04-23T11:53:19Z", "message": "Add gradle tasks for new structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c672edce208e039588de38bfe6fb5e7bb892ce12", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c672edce208e039588de38bfe6fb5e7bb892ce12", "committedDate": "2020-04-23T11:53:19Z", "message": "Add notes on different kinds of tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3026aef0740835fcb29c2af3aac2a17bd9812d86", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/3026aef0740835fcb29c2af3aac2a17bd9812d86", "committedDate": "2020-04-23T11:53:19Z", "message": "Add test links"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1975752bf12ebb9812bd789a50bef244a5f3780b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/1975752bf12ebb9812bd789a50bef244a5f3780b", "committedDate": "2020-04-23T11:53:19Z", "message": "Add test guideline link to contributing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59c4ad5823b8abde6445c27a4d3920a39bbc456d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/59c4ad5823b8abde6445c27a4d3920a39bbc456d", "committedDate": "2020-04-23T11:53:19Z", "message": "Correct typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2ad5f7e74131fb721c3e1141bb22ed9ef3cf554", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/c2ad5f7e74131fb721c3e1141bb22ed9ef3cf554", "committedDate": "2020-04-23T11:53:19Z", "message": "Add note about discussing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4986c86b21f1e549cff95f96445d599b45792347", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4986c86b21f1e549cff95f96445d599b45792347", "committedDate": "2020-04-23T11:53:19Z", "message": "Improve description of instrumented tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "892a6d6163d0889a5b57dfadc0115e2be82b1b1f", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/892a6d6163d0889a5b57dfadc0115e2be82b1b1f", "committedDate": "2020-04-22T14:21:07Z", "message": "Improve description of instrumented tests"}, "afterCommit": {"oid": "4986c86b21f1e549cff95f96445d599b45792347", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4986c86b21f1e549cff95f96445d599b45792347", "committedDate": "2020-04-23T11:53:19Z", "message": "Improve description of instrumented tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDg0NDI2", "url": "https://github.com/getodk/collect/pull/3769#pullrequestreview-399084426", "createdAt": "2020-04-23T13:12:27Z", "commit": {"oid": "4986c86b21f1e549cff95f96445d599b45792347"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2648, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}