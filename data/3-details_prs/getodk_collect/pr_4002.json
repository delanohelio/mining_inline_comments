{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMzA5MDU2", "number": 4002, "title": "Match exactly analytics", "bodyText": "Closes #3958\nWhat has been done to verify that this works as intended?\nNew tests.\nWhy is this the best possible solution? Were any other approaches considered?\nComments inline\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nJust adds analytics so should be good to merge as long as we try it out properly with the Play Store creds in the app.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-07-31T16:44:00Z", "url": "https://github.com/getodk/collect/pull/4002", "merged": true, "mergeCommit": {"oid": "c4d6632b158599b3618b101425df6ad6566359bc"}, "closed": true, "closedAt": "2020-08-10T20:36:10Z", "author": {"login": "seadowg"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6XD6ngFqTQ1OTMxNDk3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7rSpdAFqTQ2MTA4MTI3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzE0OTc0", "url": "https://github.com/getodk/collect/pull/4002#pullrequestreview-459314974", "createdAt": "2020-07-31T16:45:47Z", "commit": {"oid": "1235ae7002de37e87704c49db7371f41a4586fda"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjo0NTo0N1rOG6PGEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjo0NTo0N1rOG6PGEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxNzkwNg==", "bodyText": "I wanted to do this here rather than when the settings are changed/imported as it avoids handling all the different possible cases and also makes sure we always have a value for this property set. It means the values we have are probably going to be slightly behind (as we'll be waiting for the next time the app boots for the property to be set) but I think that'll be ok.", "url": "https://github.com/getodk/collect/pull/4002#discussion_r463717906", "createdAt": "2020-07-31T16:45:47Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/application/initialization/ApplicationInitializer.java", "diffHunk": "@@ -55,21 +60,30 @@ public void initialize() {\n         initializeLocale();\n     }\n \n-    public void initializePreferences() {\n+    private void initializePreferences() {\n         performMigrations();\n         reloadSharedPreferences();\n     }\n \n-    public void initializeFrameworks() {\n+    private void initializeFrameworks() {\n         NotificationUtils.createNotificationChannel(context);\n         JodaTimeAndroid.init(context);\n         initializeLogging();\n         AppCompatDelegate.setCompatVectorFromResourcesEnabled(true);\n         initializeMapFrameworks();\n         initializeJavaRosa();\n+        initializeAnalytics();\n     }\n \n-    public void initializeLocale() {\n+    private void initializeAnalytics() {\n+        String formUpdateMode = generalSharedPreferences\n+                .getSharedPreferences()\n+                .getString(GeneralKeys.KEY_FORM_UPDATE_MODE, FormUpdateMode.MANUAL.getValue(context));\n+\n+        analytics.setUserProperty(\"FormUpdateMode\", formUpdateMode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1235ae7002de37e87704c49db7371f41a4586fda"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5Njc3NDE1", "url": "https://github.com/getodk/collect/pull/4002#pullrequestreview-459677415", "createdAt": "2020-08-02T20:45:54Z", "commit": {"oid": "1235ae7002de37e87704c49db7371f41a4586fda"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQyMDo0NTo1NFrOG6nvYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQyMDo0NTo1NFrOG6nvYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEyMTY5Ng==", "bodyText": "What do you think of using the hostname instead of the raw setting value? The raw server setting value would mean we differentiate between different Central App Users. Hostname would give us a sense of organizations that use match exactly and specifically the manual sync button.", "url": "https://github.com/getodk/collect/pull/4002#discussion_r464121696", "createdAt": "2020-08-02T20:45:54Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/formmanagement/BlankFormsListViewModel.java", "diffHunk": "@@ -87,6 +99,12 @@ public void syncWithServer() {\n         });\n     }\n \n+    private void logManualSync() {\n+        String url = preferencesProvider.getGeneralSharedPreferences().getString(GeneralKeys.KEY_SERVER_URL, \"\");\n+        String urlHash = FileUtils.getMd5Hash(new ByteArrayInputStream(url.getBytes()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1235ae7002de37e87704c49db7371f41a4586fda"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bed0bd48577fba28cf1a226084ebcee024c7f18d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/bed0bd48577fba28cf1a226084ebcee024c7f18d", "committedDate": "2020-08-03T12:04:02Z", "message": "Log event when manual match exactly refresh started"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cd567e3258aad8c0bc3832d9f2b8b060214d406", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/0cd567e3258aad8c0bc3832d9f2b8b060214d406", "committedDate": "2020-08-03T12:04:02Z", "message": "Add analytics event when manual match exactly sync completes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "627c6c6feb4c90fd21f0ad2fa5ac27c3d4ca2421", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/627c6c6feb4c90fd21f0ad2fa5ac27c3d4ca2421", "committedDate": "2020-08-03T12:04:02Z", "message": "Log analytics when background match exactly sync completes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ea20223478b9565256dcc1e4becaf65d4dd1bf6", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/4ea20223478b9565256dcc1e4becaf65d4dd1bf6", "committedDate": "2020-08-03T12:08:49Z", "message": "Add url hash to manual refresh analytics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62e6761f16a420e9c9d1f54fa34348a2143b7e34", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/62e6761f16a420e9c9d1f54fa34348a2143b7e34", "committedDate": "2020-08-03T12:08:51Z", "message": "Set form update mode user property when booting app"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1235ae7002de37e87704c49db7371f41a4586fda", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/1235ae7002de37e87704c49db7371f41a4586fda", "committedDate": "2020-07-31T16:22:31Z", "message": "Set form update mode user property when booting app"}, "afterCommit": {"oid": "62e6761f16a420e9c9d1f54fa34348a2143b7e34", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/62e6761f16a420e9c9d1f54fa34348a2143b7e34", "committedDate": "2020-08-03T12:08:51Z", "message": "Set form update mode user property when booting app"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "590188beae77396add3ac4dd2276a06343adc5a1", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/590188beae77396add3ac4dd2276a06343adc5a1", "committedDate": "2020-08-03T12:14:12Z", "message": "Use host for manual sync analytics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2655327da6f0f7e595286a18b60c9935f1f2508b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/2655327da6f0f7e595286a18b60c9935f1f2508b", "committedDate": "2020-08-03T12:19:59Z", "message": "Optimize imports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7311c48233c79919b9c1739637bcce02c9de93d", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/f7311c48233c79919b9c1739637bcce02c9de93d", "committedDate": "2020-08-03T13:00:29Z", "message": "Use event to track form update mode rather than user property"}, "afterCommit": {"oid": "2655327da6f0f7e595286a18b60c9935f1f2508b", "author": {"user": {"login": "seadowg", "name": "Callum Stott"}}, "url": "https://github.com/getodk/collect/commit/2655327da6f0f7e595286a18b60c9935f1f2508b", "committedDate": "2020-08-03T12:19:59Z", "message": "Optimize imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDgxMjc2", "url": "https://github.com/getodk/collect/pull/4002#pullrequestreview-461081276", "createdAt": "2020-08-04T18:53:54Z", "commit": {"oid": "2655327da6f0f7e595286a18b60c9935f1f2508b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2578, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}