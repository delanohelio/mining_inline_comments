{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMTE3OTc0", "number": 3912, "title": "Fixed back button behavior in FormHierarchyActivity", "bodyText": "Closes #3799\nWhat has been done to verify that this works as intended?\nI tested the implemented changes manually and added automated tests.\nWhy is this the best possible solution? Were any other approaches considered?\nWe didn't handle a case when the index we started from (opening the FormHierarchyActivity) is deleted and then clicking device back button we try to get back to that index. My fix checks the index and tries to navigate back to the first relevant question if the starting index has been deleted. It's the best solution. We could also try to navigate to the beginning/end of the form but I find my solution better.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nThis should just fix the issue and have no side effects. The change in behavior (intended or not) might be only visible if we click device back button being in FormHierarchyActivity so just that functionality should be tested.\nDo we need any specific form for testing your changes? If so, please attach one.\nAny form with repeats.\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-06-08T12:59:21Z", "url": "https://github.com/getodk/collect/pull/3912", "merged": true, "mergeCommit": {"oid": "07556041fb595a206d0658520384109095c85367"}, "closed": true, "closedAt": "2020-06-24T12:46:54Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpOkynAH2gAyNDMxMTE3OTc0OmVjY2E1OWQwNDlhNmY1ODk4ZmNmZWZlZWNlNTI4NTdmOWE5ZWMyZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrlEkNAH2gAyNDMxMTE3OTc0OmE2NTU2ZjQ3ZWJiOTZhMGYxNWQ5MTY0MTQ3NTdjYjY5NzM1MDcwZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ecca59d049a6f5898fcfefeece52857f9a9ec2ff", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ecca59d049a6f5898fcfefeece52857f9a9ec2ff", "committedDate": "2020-06-08T11:15:50Z", "message": "Fixed back button behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6957f577f798fae6fb0bb0877affe3d9666c3cd3", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/6957f577f798fae6fb0bb0877affe3d9666c3cd3", "committedDate": "2020-06-08T12:48:54Z", "message": "Added tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzYxMjA3", "url": "https://github.com/getodk/collect/pull/3912#pullrequestreview-426361207", "createdAt": "2020-06-08T15:32:24Z", "commit": {"oid": "6957f577f798fae6fb0bb0877affe3d9666c3cd3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjU2MTY4", "url": "https://github.com/getodk/collect/pull/3912#pullrequestreview-426656168", "createdAt": "2020-06-08T22:08:44Z", "commit": {"oid": "6957f577f798fae6fb0bb0877affe3d9666c3cd3"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMjowODo0NVrOGgyHQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMjoxNToxM1rOGgyQ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAyODY3Mw==", "bodyText": "I don't love while(true), but the other option here would be a do-while and I like that even less so I agree with your choice.", "url": "https://github.com/getodk/collect/pull/3912#discussion_r437028673", "createdAt": "2020-06-08T22:08:45Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormHierarchyActivity.java", "diffHunk": "@@ -746,6 +747,29 @@ protected void onBackPressedWithoutLogger() {\n         super.onBackPressed();\n     }\n \n+    private void navigateToTheLastRelevantIndex(FormController formController) {\n+        FormEntryController fec = new FormEntryController(new FormEntryModel(formController.getFormDef()));\n+        formController.jumpToIndex(startIndex);\n+\n+        // startIndex might no longer exist if it was a part of repeat group that has been removed\n+        while (true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6957f577f798fae6fb0bb0877affe3d9666c3cd3"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAzMTEzOA==", "bodyText": "I think this is a candidate for moving to JavaRosa's FormEntryController. It could become something like jumpToIndexOrFirstPriorAvailable. If you agree, please file an issue there. The two advantages are that it reduces complexity in Collect and that we would be able to use really fast unit tests for testing it.", "url": "https://github.com/getodk/collect/pull/3912#discussion_r437031138", "createdAt": "2020-06-08T22:15:13Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormHierarchyActivity.java", "diffHunk": "@@ -746,6 +747,29 @@ protected void onBackPressedWithoutLogger() {\n         super.onBackPressed();\n     }\n \n+    private void navigateToTheLastRelevantIndex(FormController formController) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6957f577f798fae6fb0bb0877affe3d9666c3cd3"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6556f47ebb96a0f15d916414757cb69735070d2", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/a6556f47ebb96a0f15d916414757cb69735070d2", "committedDate": "2020-06-15T18:36:18Z", "message": "Fixed doubled dialog"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2730, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}