{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NTQxMTEw", "number": 3606, "title": "Implemented classes to handle database operations for both sdcard and scoped storage", "bodyText": "This pr is supposed to be the first step towards Scoped Storage.\n\nI created StorageManger class where I moved operations on the storage. I know the class name itself is not good and generally we should avoid names like manger, handler etc. but I'm not good at it so if you can come up with something better please help. Of course I could move to this class much more code from other classes but I wanted to avoid making this pr gigantic so I refactored only the most important code.\nFor reviewers probably @lognaturel @seadowg most of the changes I made using refactoring tools from Android Studio so I find them pretty safe, I mean commits from the first one to\nd4180db\nThe most dangerous commits are: cec6ac6, 5256e8d, 88ab3a6, 34feac0, 89f5d23\nit's because they read/write database paths, for now absolute paths are used but the code is ready to use relative paths and absolute paths depending on whether migration to scoped storage took place or not. That makes the code a bit complicated (we will be able to make it better once we switch to scoped storage forever).\n\nWhat has been done to verify that this works as intended?\n\ntried to be super careful especially implementing changes for five mentioned above commits.\nadded automated tests for StorageManager class\nran instrumented tests on firebase test lab\nand finally I tested the changes manually especially checked if paths saved in databases are correct\n\nWhy is this the best possible solution? Were any other approaches considered?\nFirst of all we didn't have any class responsible for operations on storage. A lot of the code was placed in Collect class (my impressions is that contains a mix of different code and it has been getting bigger and bigger because we treated it kind of like FormEntryActivity)\nSecond of all we need to handle somehow scoped storage and start using relative paths once we switch to it, StorageManager is responsible for that.\nHow does this change affect users? Describe intentional changes to behavior and behavior that could have accidentally been affected by code changes. In other words, what are the regression risks?\nAt this moment it shouldn't course any changes, everything should work like before. However it's a risky pr especially in terms of regression in managing file paths. There is no one functionality we would need to test, everything might be affected. Please make sure that database paths in forms, instances, itemsets databases are saved properly.\nDo we need any specific form for testing your changes? If so, please attach one.\nSince we need to test paths saved in databases any form and instance would allow us to do that, at least to test forms and instances databases but there is also itemsets.db and to test it we need a form with external itemsets like:\nselect_one_external.zip\nDoes this change require updates to documentation? If so, please file an issue here and include the link below.\nNo.\nBefore submitting this PR, please make sure you have:\n\n run ./gradlew checkAll and confirmed all checks still pass OR confirm CircleCI build passes and run ./gradlew connectedDebugAndroidTest locally.\n verified that any code or assets from external sources are properly credited in comments and/or in the about file.\n verified that any new UI elements use theme colors. UI Components Style guidelines", "createdAt": "2020-01-23T20:00:52Z", "url": "https://github.com/getodk/collect/pull/3606", "merged": true, "mergeCommit": {"oid": "c963eb0bb15c9a8a8e68e51d8f75dd3d7ec71d49"}, "closed": true, "closedAt": "2020-02-04T15:19:14Z", "author": {"login": "grzesiek2010"}, "timelineItems": {"totalCount": 58, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-P1G2gFqTM0ODIxMTkyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAy3U5AH2gAyMzY2NTQxMTEwOjAyYjcxYzllZGQ4ZDBjYjc0NWMwZDZkNzY1MGMzYTU3ZDcyMWVlNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjExOTIy", "url": "https://github.com/getodk/collect/pull/3606#pullrequestreview-348211922", "createdAt": "2020-01-24T20:40:44Z", "commit": {"oid": "6160ed1c0fb1682b029afa183e6c3fcadb4f8f9b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDo0MjozMFrOFhp3iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMzoxNzowOVrOFhs5ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMzI5MQ==", "bodyText": "Should be getOfflineLayersPath to match the others.", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370833291", "createdAt": "2020-01-24T20:42:30Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageManager.java", "diffHunk": "@@ -68,4 +67,8 @@ public static String getMetadataPath() {\n     public static String getCachePath() {\n         return getOdkRoot() + File.separator + \".cache\";\n     }\n+\n+    public static String getOfflineLayers() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c32fa40cadbfef936b6e5ce2460083859652fe0c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzMzc0Mw==", "bodyText": "Do these really belong here?", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370833743", "createdAt": "2020-01-24T20:43:45Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageManager.java", "diffHunk": "@@ -77,4 +75,8 @@ public static String getSETTINGS() {\n     public static String getTmpfilePath() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edfb2d2235e2dd35bedef90376fbf6b47911b23b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzNDg0MQ==", "bodyText": "By naming conventions, it should be Odk. How about getStorageRootPath?", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370834841", "createdAt": "2020-01-24T20:46:46Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageManager.java", "diffHunk": "@@ -40,50 +40,50 @@ public static void createODKDirs() throws RuntimeException {\n         }\n     }\n \n-    public static String[] getODKDirs() {\n+    public static String[] getODKDirPaths() {\n         return new String[]{\n-                getOdkRoot(),\n-                getFormsPath(),\n-                getInstancesPath(),\n-                getCachePath(),\n-                getMetadataPath(),\n-                getOfflineLayers()\n+                getMainODKDirPath(),\n+                getFormsDirPath(),\n+                getInstancesDirPath(),\n+                getCacheDirPath(),\n+                getMetadataDirPath(),\n+                getOfflineLayersDirPath()\n             };\n     }\n \n-    public static String getOdkRoot() {\n+    public static String getMainODKDirPath() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f548d71bf541c40e22bebd01f7c72d18031a6a4c"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzNjc0Mg==", "bodyText": "I don't think primary/secondary is easy to understand. How about:\n\ngetScopedExternalFilesDir or getAppExternalFilesDir\ngetUnscopedExternalFilesDir or getRootExternalFilesDir", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370836742", "createdAt": "2020-01-24T20:52:05Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageManager.java", "diffHunk": "@@ -54,8 +54,26 @@ public static void createODKDirs() throws RuntimeException {\n             };\n     }\n \n+    private static String getStoragePath() {\n+        return isScopedStorageUsed()\n+                ? getPrimaryExternalStorageFilePath()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "153da3fe08282ddcd004ae23f4de7954103907d7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzNzU1Mw==", "bodyText": "Inlining this in isStorageAvailable would be clearer, I think.", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370837553", "createdAt": "2020-01-24T20:54:16Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageManager.java", "diffHunk": "@@ -43,6 +42,14 @@ public static void createODKDirs() throws RuntimeException {\n         }\n     }\n \n+    private static boolean isStorageAvailable() {\n+        return getStorageState().equals(Environment.MEDIA_MOUNTED);\n+    }\n+\n+    private static String getStorageState() {\n+        return Environment.getExternalStorageState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cac66bd4d1f5daf2087befd434a9f9164bcef61"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1MTU2MQ==", "bodyText": "This looks like it would have different behavior from what was there before. If this is based on the path, I'd expect needing to go through getFormFilePath (the method that builds database paths based on whether or not scoped storage is used).", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370851561", "createdAt": "2020-01-24T21:31:33Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/tasks/FormLoaderTask.java", "diffHunk": "@@ -258,7 +259,7 @@ private void processItemSets(File formMediaDir) {\n             ida.open();\n             // get the database entry (if exists) for this itemsets.csv, based\n             // on the path\n-            final Cursor c = ida.getItemsets(csv.getAbsolutePath());\n+            final Cursor c = ida.getItemsets(relativeCsvFilePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b6e6466f426233cbdfbc708bd6da30453a0c1f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1MTkxNg==", "bodyText": "relativeCsvFilePath and csv are redundant. Can you do a substring? Generally not understanding 59b6e64.", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370851916", "createdAt": "2020-01-24T21:32:33Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/tasks/FormLoaderTask.java", "diffHunk": "@@ -508,7 +508,7 @@ public void setActivityResult(int requestCode, int resultCode, Intent intent) {\n         this.intent = intent;\n     }\n \n-    private void readCSV(File csv, String formHash, String pathHash) {\n+    private void readCSV(File csv, String formHash, String pathHash, String relativeCsvFilePath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b6e6466f426233cbdfbc708bd6da30453a0c1f"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1MjQ0OQ==", "bodyText": "Why does it have to be relativized first? Can't getFormFilePath deal with it?", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370852449", "createdAt": "2020-01-24T21:34:06Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -2027,7 +2027,7 @@ public void onClick(DialogInterface dialog,\n                                         languages[whichButton]);\n                                 String selection = FormsColumns.FORM_FILE_PATH\n                                         + \"=?\";\n-                                String[] selectArgs = {formPath};\n+                                String[] selectArgs = {StorageManager.getFormFilePath(StorageManager.getRelativeFormFilePath(formPath))};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c30d3cc5eac177901cdec4355b633a0ffacb33c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1NDYwOA==", "bodyText": "Quick stylistic note you don't need to do anything about but I wanted to share for your consideration:\nassertThat(storageManager.getMainODKDirPath(), is(\"/storage/emulated/0/odk\")) reads more like English. Here we have to go to the end of the assertions to find out what code is under test and then look at what the expected value is.", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370854608", "createdAt": "2020-01-24T21:40:14Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/test/java/org/odk/collect/android/storage/StorageManagerTest.java", "diffHunk": "@@ -0,0 +1,139 @@\n+package org.odk.collect.android.storage;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.spy;\n+\n+public class StorageManagerTest {\n+\n+    private StorageManager storageManager = spy(StorageManager.class);\n+\n+    @Before\n+    public void setup() {\n+        doReturn(\"/storage/emulated/0/Android/data/org.odk.collect.android/files\").when(storageManager).getPrimaryExternalStorageFilePath();\n+        doReturn(\"/storage/emulated/0\").when(storageManager).getSecondaryExternalStorageFilePath();\n+    }\n+\n+    private void mockUsingScopedStorage() {\n+        doReturn(true).when(storageManager).isScopedStorageUsed();\n+    }\n+\n+    private void mockUsingSdCard() {\n+        doReturn(false).when(storageManager).isScopedStorageUsed();\n+    }\n+\n+    @Test\n+    public void when_scopedStorageNotUsed_should_sdCardPathsBeUsed() {\n+        mockUsingSdCard();\n+\n+        assertEquals(\"/storage/emulated/0/odk\", storageManager.getMainODKDirPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb732dfffcbc3cdd4eba67497e55a52a9250877"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1ODEwMw==", "bodyText": "The naming here is really tricky. It's something I had flagged when the methods were first introduced so I'm glad to see you looking for something more specific. I must say that even for me who loves words, these are a bit long. \ud83d\ude0a Here are some other ideas:\n\ngetCacheFilePathForDatabase\ngetDatabasePathFromRelativePath(Enum fileType (e.g. CACHE, FORM, INSTANCE), String relativePath)\nrelativePathToDatabasePath(String relativePath, Enum fileType)", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370858103", "createdAt": "2020-01-24T21:50:25Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageManager.java", "diffHunk": "@@ -124,7 +124,7 @@ public void recordMigrationToScopedStorage() {\n     }\n \n     // TODO the method should be removed once using Scoped storage became required\n-    public String getCacheFilePath(String relativePath) {\n+    public String getCacheFilePathToStoreInDatabaseBasingOnRelativePath(String relativePath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74d4c277e320975ac9724ec894ed3659bda72f88"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg4Mjk1NA==", "bodyText": "This seems like it would be catastrophic. It means no media is available, right? Would having an empty string here just cause things to crash downstream?", "url": "https://github.com/getodk/collect/pull/3606#discussion_r370882954", "createdAt": "2020-01-24T23:17:09Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageManager.java", "diffHunk": "@@ -0,0 +1,186 @@\n+package org.odk.collect.android.storage;\n+\n+import android.os.Environment;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.application.Collect;\n+import org.odk.collect.android.preferences.GeneralSharedPreferences;\n+\n+import java.io.File;\n+\n+import timber.log.Timber;\n+\n+import static org.odk.collect.android.preferences.GeneralKeys.KEY_SCOPED_STORAGE_USED;\n+\n+public class StorageManager {\n+    /**\n+     * Creates required directories on the SDCard (or other external storage)\n+     *\n+     * @throws RuntimeException if there is no SDCard or the directory exists as a non directory\n+     */\n+    public void createODKDirs() throws RuntimeException {\n+        if (!isStorageAvailable()) {\n+            throw new RuntimeException(\n+                    Collect.getInstance().getString(R.string.sdcard_unmounted, getStorageState()));\n+        }\n+\n+        for (String dirPath : getODKDirPaths()) {\n+            File dir = new File(dirPath);\n+            if (!dir.exists()) {\n+                if (!dir.mkdirs()) {\n+                    String message = Collect.getInstance().getString(R.string.cannot_create_directory, dirPath);\n+                    Timber.w(message);\n+                    throw new RuntimeException(message);\n+                }\n+            } else {\n+                if (!dir.isDirectory()) {\n+                    String message = Collect.getInstance().getString(R.string.not_a_directory, dirPath);\n+                    Timber.w(message);\n+                    throw new RuntimeException(message);\n+                }\n+            }\n+        }\n+    }\n+\n+    private boolean isStorageAvailable() {\n+        return getStorageState().equals(Environment.MEDIA_MOUNTED);\n+    }\n+\n+    private String getStorageState() {\n+        return Environment.getExternalStorageState();\n+    }\n+\n+    public String[] getODKDirPaths() {\n+        return new String[]{\n+                getMainODKDirPath(),\n+                getFormsDirPath(),\n+                getInstancesDirPath(),\n+                getCacheDirPath(),\n+                getMetadataDirPath(),\n+                getOfflineLayersDirPath()\n+            };\n+    }\n+\n+    private String getStoragePath() {\n+        return isScopedStorageUsed()\n+                ? getPrimaryExternalStorageFilePath()\n+                : getSecondaryExternalStorageFilePath();\n+    }\n+\n+    String getPrimaryExternalStorageFilePath() {\n+        File primaryStorageFile = Collect.getInstance().getExternalFilesDir(null);\n+        if (primaryStorageFile != null) {\n+            return primaryStorageFile.getAbsolutePath();\n+        }\n+        return \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf709c55d17f9318ba41fa33e80f005dd36d05ab"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NDA5MDQ5", "url": "https://github.com/getodk/collect/pull/3606#pullrequestreview-348409049", "createdAt": "2020-01-26T22:37:58Z", "commit": {"oid": "bf709c55d17f9318ba41fa33e80f005dd36d05ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNlQyMjozNzo1OFrOFh2Jjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNlQyMjozNzo1OFrOFh2Jjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAzNDUxMQ==", "bodyText": "This is going to do a database query, right? So it seems like it should match whatever is in the database? I'd expect no transformation needed here.", "url": "https://github.com/getodk/collect/pull/3606#discussion_r371034511", "createdAt": "2020-01-26T22:37:58Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/provider/FormsProvider.java", "diffHunk": "@@ -325,21 +324,20 @@ public int delete(@NonNull Uri uri, String where, String[] whereArgs) {\n                         if (c != null && c.getCount() > 0) {\n                             c.moveToFirst();\n                             do {\n-                                deleteFileOrDir(c.getString(c\n-                                        .getColumnIndex(FormsColumns.JRCACHE_FILE_PATH)));\n-                                String formFilePath = c.getString(c\n-                                        .getColumnIndex(FormsColumns.FORM_FILE_PATH));\n-                                deleteFileOrDir(formFilePath);\n-                                deleteFileOrDir(c.getString(c\n-                                        .getColumnIndex(FormsColumns.FORM_MEDIA_PATH)));\n+                                deleteFileOrDir(storageManager.getAbsoluteCacheFilePath(c.getString(c\n+                                        .getColumnIndex(FormsColumns.JRCACHE_FILE_PATH))));\n+                                deleteFileOrDir(storageManager.getAbsoluteFormFilePath(c.getString(c\n+                                        .getColumnIndex(FormsColumns.FORM_FILE_PATH))));\n+                                deleteFileOrDir(storageManager.getAbsoluteFormFilePath(c.getString(c\n+                                        .getColumnIndex(FormsColumns.FORM_MEDIA_PATH))));\n \n                                 try {\n                                     // get rid of the old tables\n                                     ItemsetDbAdapter ida = new ItemsetDbAdapter();\n                                     ida.open();\n-                                    ida.delete(c.getString(c\n+                                    ida.delete(storageManager.getRelativeFormFilePath(c.getString(c", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf709c55d17f9318ba41fa33e80f005dd36d05ab"}, "originalPosition": 115}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf709c55d17f9318ba41fa33e80f005dd36d05ab", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bf709c55d17f9318ba41fa33e80f005dd36d05ab", "committedDate": "2020-01-23T14:28:22Z", "message": "Fixed test"}, "afterCommit": {"oid": "59cf8172ece10847638b5e20db7074c7523b095c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/59cf8172ece10847638b5e20db7074c7523b095c", "committedDate": "2020-01-28T11:18:06Z", "message": "Fixed test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ddc0e62fd348e39c055902a0542786df71a48ecc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ddc0e62fd348e39c055902a0542786df71a48ecc", "committedDate": "2020-01-28T14:48:16Z", "message": "Naming improvements"}, "afterCommit": {"oid": "108ca8f8b2e8d90d47d2233566cd52cb428f9cd8", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/108ca8f8b2e8d90d47d2233566cd52cb428f9cd8", "committedDate": "2020-01-28T15:04:34Z", "message": "Naming improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "108ca8f8b2e8d90d47d2233566cd52cb428f9cd8", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/108ca8f8b2e8d90d47d2233566cd52cb428f9cd8", "committedDate": "2020-01-28T15:04:34Z", "message": "Naming improvements"}, "afterCommit": {"oid": "e69a95fee25b7927de7ace66b116b058ccde2504", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/e69a95fee25b7927de7ace66b116b058ccde2504", "committedDate": "2020-01-29T14:44:02Z", "message": "Implemented changes to handle paths in Form and Instance classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b7f4d9f8e17a042d8ca26adc80e256b5aa7b7b5", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/1b7f4d9f8e17a042d8ca26adc80e256b5aa7b7b5", "committedDate": "2020-01-29T15:28:40Z", "message": "Removed redundant storagePathProvider.getAbsoluteFormFilePath() call"}, "afterCommit": {"oid": "1b6cb777e7a249ae2aaa9e667bde7ca046fd4dbb", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/1b6cb777e7a249ae2aaa9e667bde7ca046fd4dbb", "committedDate": "2020-01-29T17:22:48Z", "message": "Removed redundant storagePathProvider.getAbsoluteFormFilePath() call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzIxMDYw", "url": "https://github.com/getodk/collect/pull/3606#pullrequestreview-350321060", "createdAt": "2020-01-29T18:16:20Z", "commit": {"oid": "1b6cb777e7a249ae2aaa9e667bde7ca046fd4dbb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxODoxNjoyMFrOFjSkHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxODoyNDowMVrOFjSz4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU0ODYzNw==", "bodyText": "This is going to do a db request. Shouldn't it use the getDbPath method? As written, this code will always build an absolute path but when we flip the switch to scoped storage, there won't be absolute paths in the db to query against.", "url": "https://github.com/getodk/collect/pull/3606#discussion_r372548637", "createdAt": "2020-01-29T18:16:20Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/androidTest/java/org/odk/collect/android/dao/FormsDaoTest.java", "diffHunk": "@@ -126,7 +128,7 @@ public void getFormsCursorTest() {\n \n     @Test\n     public void getFormsCursorForFormFilePathTest() {\n-        Cursor cursor = formsDao.getFormsCursorForFormFilePath(Collect.FORMS_PATH + \"/Miramare.xml\");\n+        Cursor cursor = formsDao.getFormsCursorForFormFilePath(storagePathProvider.getDirPath(StorageSubdirectory.FORMS) + \"/Miramare.xml\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b6cb777e7a249ae2aaa9e667bde7ca046fd4dbb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU1MjY3Mw==", "bodyText": "This should be a db path, right?", "url": "https://github.com/getodk/collect/pull/3606#discussion_r372552673", "createdAt": "2020-01-29T18:24:01Z", "author": {"login": "lognaturel"}, "path": "collect_app/src/main/java/org/odk/collect/android/provider/FormsProvider.java", "diffHunk": "@@ -200,19 +203,19 @@ public synchronized Uri insert(@NonNull Uri uri, ContentValues initialValues) {\n             values.put(FormsColumns.MD5_HASH, md5);\n \n             if (!values.containsKey(FormsColumns.JRCACHE_FILE_PATH)) {\n-                String cachePath = Collect.CACHE_PATH + File.separator + md5\n+                String cachePath = storagePathProvider.getDirPath(StorageSubdirectory.CACHE) + File.separator + md5", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b6cb777e7a249ae2aaa9e667bde7ca046fd4dbb"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b6cb777e7a249ae2aaa9e667bde7ca046fd4dbb", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/1b6cb777e7a249ae2aaa9e667bde7ca046fd4dbb", "committedDate": "2020-01-29T17:22:48Z", "message": "Removed redundant storagePathProvider.getAbsoluteFormFilePath() call"}, "afterCommit": {"oid": "7e81acc0ef9961cef4a0d3d7d2e077cfa727513e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7e81acc0ef9961cef4a0d3d7d2e077cfa727513e", "committedDate": "2020-01-30T08:03:59Z", "message": "Cleaned the code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e81acc0ef9961cef4a0d3d7d2e077cfa727513e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7e81acc0ef9961cef4a0d3d7d2e077cfa727513e", "committedDate": "2020-01-30T08:03:59Z", "message": "Cleaned the code"}, "afterCommit": {"oid": "af48ee7cee531b8a1f7fbec1850ce844febc2183", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/af48ee7cee531b8a1f7fbec1850ce844febc2183", "committedDate": "2020-01-30T08:04:37Z", "message": "Cleaned the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afffe60f1f0e321199f0bb41d13f0750cb97167f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/afffe60f1f0e321199f0bb41d13f0750cb97167f", "committedDate": "2020-01-30T08:46:20Z", "message": "Created StorageManager class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97cdd9dcbc4f76ff568bd4fcc7dbaca7d2460a8f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/97cdd9dcbc4f76ff568bd4fcc7dbaca7d2460a8f", "committedDate": "2020-01-30T08:46:20Z", "message": "Moved ODK_ROOT field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3862705ca874c98d8b793af6d6f40a57ffefe735", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3862705ca874c98d8b793af6d6f40a57ffefe735", "committedDate": "2020-01-30T08:46:20Z", "message": "Moved FORMS_PATH field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7894d8a50b8a256e27b5c0ecbf89f2a9e35e1b94", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7894d8a50b8a256e27b5c0ecbf89f2a9e35e1b94", "committedDate": "2020-01-30T08:46:20Z", "message": "Moved INSTANCES_PATH field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "033d0ab8b618ec27c986a3b6c1cb4f7c97b6d609", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/033d0ab8b618ec27c986a3b6c1cb4f7c97b6d609", "committedDate": "2020-01-30T08:46:20Z", "message": "Moved CACHE_PATH field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fff4091784b767727b8d53e6bb06b493f330e430", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/fff4091784b767727b8d53e6bb06b493f330e430", "committedDate": "2020-01-30T08:46:20Z", "message": "Moved METADATA_PATH field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c75515880c929735533f9c390f18f450dea673f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0c75515880c929735533f9c390f18f450dea673f", "committedDate": "2020-01-30T08:46:20Z", "message": "Moved OFFLINE_LAYERS field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d11dcd61ae05d0406a93e7f93a23a71f460fdf2c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/d11dcd61ae05d0406a93e7f93a23a71f460fdf2c", "committedDate": "2020-01-30T08:46:20Z", "message": "Moved SETTINGS field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c98477342988216b77412210dc3aa3df8499846", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/1c98477342988216b77412210dc3aa3df8499846", "committedDate": "2020-01-30T08:52:06Z", "message": "Moved TMPFILE_PATH field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7259f0511291c2d64ccc922920184f030ff8ff4a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/7259f0511291c2d64ccc922920184f030ff8ff4a", "committedDate": "2020-01-30T08:52:46Z", "message": "Moved TMPDRAWFILE_PATH field from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6ec17f9ea0f82df9dff1cef6da32e0d85ac21ce", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f6ec17f9ea0f82df9dff1cef6da32e0d85ac21ce", "committedDate": "2020-01-30T08:52:46Z", "message": "Moved createODKDirs() method from Collect to StorageManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2ea868ef7fe66c5099f541dddf6bc7ad57cddd0", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c2ea868ef7fe66c5099f541dddf6bc7ad57cddd0", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned ODK_ROOT field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48f063f2bfa706b7a876fffc1ed65c3afc4f5a28", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/48f063f2bfa706b7a876fffc1ed65c3afc4f5a28", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned FORMS_PATH field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b182e319f957260591ed4aa6b8e953afa301c2ad", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b182e319f957260591ed4aa6b8e953afa301c2ad", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned INSTANCES_PATH field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec7b8183c595f5423667ca635ebdecb460da34fc", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/ec7b8183c595f5423667ca635ebdecb460da34fc", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned METADATA_PATH field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bba29ef22d8352ff3a592073651e140fdf2e5a8e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bba29ef22d8352ff3a592073651e140fdf2e5a8e", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned CACHE_PATH field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02ed497aacedc5a12fe7ba34a87271ff465d51ad", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/02ed497aacedc5a12fe7ba34a87271ff465d51ad", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned OFFLINE_LAYERS field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "774e0de7491dde1e4fe972c44ebc4cc6494c5025", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/774e0de7491dde1e4fe972c44ebc4cc6494c5025", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned SETTINGS field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20d3053eca6ef248892fdbfd3c24ab3867c2cd4c", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/20d3053eca6ef248892fdbfd3c24ab3867c2cd4c", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned TMPFILE_PATH field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe94cddf3d541ed8bac517c3e210089f1d87ae3", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bbe94cddf3d541ed8bac517c3e210089f1d87ae3", "committedDate": "2020-01-30T08:52:46Z", "message": "Turned TMPDRAWFILE_PATH field to a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c5b7335d3e3dc90c12486cf259e0624bd4a7e5a", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/2c5b7335d3e3dc90c12486cf259e0624bd4a7e5a", "committedDate": "2020-01-30T08:52:46Z", "message": "Removed unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59f150ca76c7fab71fc4c3a75547c6f32ad8d1e8", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/59f150ca76c7fab71fc4c3a75547c6f32ad8d1e8", "committedDate": "2020-01-30T08:52:46Z", "message": "Factored out getODKDirs() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0968411648fd5cc9e15dbb66544ad027d8667d6d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/0968411648fd5cc9e15dbb66544ad027d8667d6d", "committedDate": "2020-01-30T08:52:46Z", "message": "Naming improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683a25a27a2fb7eb2ae74b455c958711788f94f8", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/683a25a27a2fb7eb2ae74b455c958711788f94f8", "committedDate": "2020-01-30T08:52:46Z", "message": "Added a new preference to manage the scoped storage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5388908edaf684936919d163a21882e8b727a528", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/5388908edaf684936919d163a21882e8b727a528", "committedDate": "2020-01-30T08:52:46Z", "message": "Use a path to storage that is currently used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "111d10e67c4b920c2397a2ceb1fc629e72f3e77e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/111d10e67c4b920c2397a2ceb1fc629e72f3e77e", "committedDate": "2020-01-30T08:52:46Z", "message": "Factored out isStorageAvailable() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f38c6ebea1dcdc68ba1f768a506b0f3afbfd42", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/62f38c6ebea1dcdc68ba1f768a506b0f3afbfd42", "committedDate": "2020-01-30T08:52:46Z", "message": "Naming improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74f5069ada8b2d64cd8d58c3422097e3f6ecc227", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/74f5069ada8b2d64cd8d58c3422097e3f6ecc227", "committedDate": "2020-01-30T08:52:46Z", "message": "Added methods to deal with paths in INSTANCE_FILE_PATH"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b2fbc446ba0bb4ba2bb33a559ae84560d7215d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/c6b2fbc446ba0bb4ba2bb33a559ae84560d7215d", "committedDate": "2020-01-30T08:52:46Z", "message": "Added methods to deal with paths in FORM_FILE_PATH"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f71ecd3ed37717b44e087020763219822f0b36cb", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f71ecd3ed37717b44e087020763219822f0b36cb", "committedDate": "2020-01-30T08:52:46Z", "message": "Added methods to deal with paths in FORM_MEDIA_PATH"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17a168028953c5574d3f0f232b03dfe49119b31b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/17a168028953c5574d3f0f232b03dfe49119b31b", "committedDate": "2020-01-30T08:52:46Z", "message": "Added methods to deal with paths in JRCACHE_FILE_PATH"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "631695f3b2d829e694e5199f560a588ff097f42b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/631695f3b2d829e694e5199f560a588ff097f42b", "committedDate": "2020-01-30T08:52:46Z", "message": "Added methods to deal with paths in KEY_PATH"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3455784d879e53d435f6577c38eb80a44bbc16e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b3455784d879e53d435f6577c38eb80a44bbc16e", "committedDate": "2020-01-30T08:52:46Z", "message": "Make methods in Storage manager non-static"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "638b6ed15609f734bad9df736be7cd1e303a8df9", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/638b6ed15609f734bad9df736be7cd1e303a8df9", "committedDate": "2020-01-30T08:53:08Z", "message": "Renamed StorageManager to StoragePathProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf48739ba204af651284d0e5e5669f00ac25cb5d", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bf48739ba204af651284d0e5e5669f00ac25cb5d", "committedDate": "2020-01-30T08:53:08Z", "message": "Implemented StorageInitializer class and moved some code from StoragePathProvider there"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bfb46d6aefa1877bc930117a0d90090960b0d4f", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/3bfb46d6aefa1877bc930117a0d90090960b0d4f", "committedDate": "2020-01-30T08:53:08Z", "message": "Implemented StorageStateProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4406dec1833e84953e7bb4a64b60f0a01c75326b", "author": {"user": {"login": "lognaturel", "name": "H\u00e9l\u00e8ne Martin"}}, "url": "https://github.com/getodk/collect/commit/4406dec1833e84953e7bb4a64b60f0a01c75326b", "committedDate": "2020-01-30T08:53:08Z", "message": "Use single method for all subdirectory paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b102381dcc73ba3b5f1867f2668d09c65fe1641b", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/b102381dcc73ba3b5f1867f2668d09c65fe1641b", "committedDate": "2020-01-30T08:53:08Z", "message": "Fixed imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4d20093027be8a7ac1ef8111102d302a93bf407", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f4d20093027be8a7ac1ef8111102d302a93bf407", "committedDate": "2020-01-30T08:53:08Z", "message": "Fixed bugs in getXDbPath() methods and added automated tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1899cc76e181c7508375c63245a70bce36f13004", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/1899cc76e181c7508375c63245a70bce36f13004", "committedDate": "2020-01-30T08:53:08Z", "message": "Removed redundant getMainODKDirPath() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48db97b6dedf4f54fcd3f3233a6ec4bef7a8b84e", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/48db97b6dedf4f54fcd3f3233a6ec4bef7a8b84e", "committedDate": "2020-01-30T08:53:08Z", "message": "Code improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf65dac7a635664c27d490ae27ec18314a7f89d1", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/bf65dac7a635664c27d490ae27ec18314a7f89d1", "committedDate": "2020-01-30T08:53:08Z", "message": "Implemented changes to handle paths in Form and Instance classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af48ee7cee531b8a1f7fbec1850ce844febc2183", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/af48ee7cee531b8a1f7fbec1850ce844febc2183", "committedDate": "2020-01-30T08:04:37Z", "message": "Cleaned the code"}, "afterCommit": {"oid": "387ff4160b94f1dcf8a8411abb995d757571b556", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/387ff4160b94f1dcf8a8411abb995d757571b556", "committedDate": "2020-01-30T08:53:08Z", "message": "Cleaned the code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNjYyOTI4", "url": "https://github.com/getodk/collect/pull/3606#pullrequestreview-350662928", "createdAt": "2020-01-30T08:58:03Z", "commit": {"oid": "387ff4160b94f1dcf8a8411abb995d757571b556"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwODo1ODowNFrOFjjdXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwODo1ODowNFrOFjjdXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgyNTQzOQ==", "bodyText": "I think it'd be nice to pull this out as a constructor argument. For me that helps to signal that this is a dependency for the object and I think we'll want to move to having these objects constructed in Dagger to allow us to mock/fake them in tests. For the moment you could also just have a no arg constructor as well like you have in StoragePathProvider.", "url": "https://github.com/getodk/collect/pull/3606#discussion_r372825439", "createdAt": "2020-01-30T08:58:04Z", "author": {"login": "seadowg"}, "path": "collect_app/src/main/java/org/odk/collect/android/storage/StorageInitializer.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.odk.collect.android.storage;\n+\n+import android.os.Environment;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.application.Collect;\n+\n+import java.io.File;\n+\n+import timber.log.Timber;\n+\n+public class StorageInitializer {\n+    /**\n+     * Creates required directories on the SDCard (or other external storage)\n+     *\n+     * @throws RuntimeException if there is no SDCard or the directory exists as a non directory\n+     */\n+    public void createODKDirs() throws RuntimeException {\n+        if (!new StorageStateProvider().isStorageMounted()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "387ff4160b94f1dcf8a8411abb995d757571b556"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "947f14b9e98980d7b5e7620e0cc8a183eda1f592", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/947f14b9e98980d7b5e7620e0cc8a183eda1f592", "committedDate": "2020-01-30T09:25:32Z", "message": "Cleaned the code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "387ff4160b94f1dcf8a8411abb995d757571b556", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/387ff4160b94f1dcf8a8411abb995d757571b556", "committedDate": "2020-01-30T08:53:08Z", "message": "Cleaned the code"}, "afterCommit": {"oid": "947f14b9e98980d7b5e7620e0cc8a183eda1f592", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/947f14b9e98980d7b5e7620e0cc8a183eda1f592", "committedDate": "2020-01-30T09:25:32Z", "message": "Cleaned the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6130b0d095d014484b6dc287ac69ef6a1763510", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/f6130b0d095d014484b6dc287ac69ef6a1763510", "committedDate": "2020-01-30T09:42:06Z", "message": "Pulled out dependencies in StorageInitializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjg3MDEz", "url": "https://github.com/getodk/collect/pull/3606#pullrequestreview-351287013", "createdAt": "2020-01-31T04:24:26Z", "commit": {"oid": "f6130b0d095d014484b6dc287ac69ef6a1763510"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02b71c9edd8d0cb745c0d6d7650c3a57d721ee45", "author": {"user": {"login": "grzesiek2010", "name": "Grzegorz Orczykowski"}}, "url": "https://github.com/getodk/collect/commit/02b71c9edd8d0cb745c0d6d7650c3a57d721ee45", "committedDate": "2020-02-03T20:21:46Z", "message": "Merge branch 'master' into storageManager"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2258, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}