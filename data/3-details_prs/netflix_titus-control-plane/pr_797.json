{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNjg0MDYz", "number": 797, "title": "Upgrade to kube-java-client 7.x", "bodyText": "", "createdAt": "2020-03-03T00:38:57Z", "url": "https://github.com/Netflix/titus-control-plane/pull/797", "merged": true, "mergeCommit": {"oid": "502b0d8150cc56388d4ac4a35fc5ca544232967c"}, "closed": true, "closedAt": "2020-03-06T04:18:11Z", "author": {"login": "tbak"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKIvB2AFqTM2ODMxNzM1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK0ULtAH2gAyMzgyNjg0MDYzOjJlODUzOTVmZThiNzhlNDY2YmM0YzM5NTg5ZWE3MTdmMjJjYTQ4MWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzE3MzU0", "url": "https://github.com/Netflix/titus-control-plane/pull/797#pullrequestreview-368317354", "createdAt": "2020-03-03T20:55:56Z", "commit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzQzNzcx", "url": "https://github.com/Netflix/titus-control-plane/pull/797#pullrequestreview-368343771", "createdAt": "2020-03-03T21:38:33Z", "commit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozODozM1rOFxXdYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTo0MDo1M1rOFxXiDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwODg5OA==", "bodyText": "can you see if this is still needed?", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387308898", "createdAt": "2020-03-03T21:38:33Z", "author": {"login": "corindwyer"}, "path": "titus-common-ext/kube/src/main/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeClusterMembershipConnectorComponent.java", "diffHunk": "@@ -70,7 +69,7 @@ public ApiClient getApiClient(KubeConnectorConfiguration configuration) {\n             client = Config.fromUrl(kubeApiServerUri);\n         }\n \n-        client.getHttpClient().setReadTimeout(0, TimeUnit.SECONDS); // infinite timeout\n+        client.setReadTimeout(0); // infinite timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwODk5MQ==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387308991", "createdAt": "2020-03-03T21:38:44Z", "author": {"login": "corindwyer"}, "path": "titus-common-ext/kube/src/test/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeExternalResource.java", "diffHunk": "@@ -40,7 +39,7 @@ protected void before() throws Throwable {\n                 .standard()\n                 .setBasePath(String.format(\"http://%s:7001\", kubeServer))\n                 .build();\n-        client.getHttpClient().setReadTimeout(0, TimeUnit.SECONDS); // infinite timeout\n+        client.setReadTimeout(0); // infinite timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTIwMw==", "bodyText": "can you move taskId to new line to make it easier to read?", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309203", "createdAt": "2020-03-03T21:39:10Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -248,7 +248,15 @@ public void killTask(String taskId) {\n         killTaskCounter.increment();\n         try {\n             logger.info(\"deleting pod: {}\", taskId);\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId, KUBERNETES_NAMESPACE, null, null, null, DELETE_GRACE_PERIOD_SECONDS, null, null);\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTMwMw==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309303", "createdAt": "2020-03-03T21:39:21Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -675,7 +683,14 @@ private void reconcileNodesAndPods() {\n     private void gcNode(V1Node node) {\n         String nodeName = node.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNode(nodeName, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNode(nodeName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTM5MQ==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309391", "createdAt": "2020-03-03T21:39:30Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -712,7 +727,15 @@ private boolean isNodeReadyForGc(V1Node node) {\n     private void gcPod(V1Pod pod) {\n         String podName = pod.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName, KUBERNETES_NAMESPACE, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTUzMQ==", "bodyText": "should verify if extra catch is still needed", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309531", "createdAt": "2020-03-03T21:39:46Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -248,7 +248,15 @@ public void killTask(String taskId) {\n         killTaskCounter.increment();\n         try {\n             logger.info(\"deleting pod: {}\", taskId);\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId, KUBERNETES_NAMESPACE, null, null, null, DELETE_GRACE_PERIOD_SECONDS, null, null);\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId,\n+                    KUBERNETES_NAMESPACE,\n+                    null,\n+                    null,\n+                    DELETE_GRACE_PERIOD_SECONDS,\n+                    null,\n+                    null,\n+                    null\n+            );\n         } catch (JsonSyntaxException e) {\n             // this is probably successful. the generated client has the wrong response type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTU4MA==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309580", "createdAt": "2020-03-03T21:39:53Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -675,7 +683,14 @@ private void reconcileNodesAndPods() {\n     private void gcNode(V1Node node) {\n         String nodeName = node.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNode(nodeName, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNode(nodeName,\n+                    null,\n+                    null,\n+                    0,\n+                    null,\n+                    \"Background\",\n+                    null\n+            );\n         } catch (JsonSyntaxException e) {\n             // this is probably successful. the generated client has the wrong response type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTYzNg==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309636", "createdAt": "2020-03-03T21:39:59Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -712,7 +727,15 @@ private boolean isNodeReadyForGc(V1Node node) {\n     private void gcPod(V1Pod pod) {\n         String podName = pod.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName, KUBERNETES_NAMESPACE, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName,\n+                    KUBERNETES_NAMESPACE,\n+                    null,\n+                    null,\n+                    0,\n+                    null,\n+                    \"Background\",\n+                    null\n+            );\n         } catch (JsonSyntaxException e) {\n             // this is probably successful. the generated client has the wrong response type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMxMDA5Mg==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387310092", "createdAt": "2020-03-03T21:40:53Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/direct/DefaultDirectKubeApiServerIntegrator.java", "diffHunk": "@@ -143,7 +143,15 @@ public void shutdown() {\n             Stopwatch timer = Stopwatch.createStarted();\n             try {\n                 logger.info(\"Deleting pod: {}\", taskId);\n-                kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId, KUBERNETES_NAMESPACE, null, null, null, DELETE_GRACE_PERIOD_SECONDS, null, null);\n+                kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzgwOTU0", "url": "https://github.com/Netflix/titus-control-plane/pull/797#pullrequestreview-368380954", "createdAt": "2020-03-03T22:43:11Z", "commit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/d044f17dbd38059de21601dd6f2c48fa43131596", "committedDate": "2020-03-03T00:36:10Z", "message": "Upgrade to kube-java-client 7.x"}, "afterCommit": {"oid": "28e54c70d6dcfb4ee6fa99e2b2cee47b01e9ac5f", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/28e54c70d6dcfb4ee6fa99e2b2cee47b01e9ac5f", "committedDate": "2020-03-05T18:59:51Z", "message": "Code review updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "828218a2036e4e8f4cbd59fdaf0bfc14063e1d0b", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/828218a2036e4e8f4cbd59fdaf0bfc14063e1d0b", "committedDate": "2020-03-05T23:08:41Z", "message": "Upgrade to kube-java-client 7.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aed473597171ccd36630d744826b3b5f84b8bc21", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/aed473597171ccd36630d744826b3b5f84b8bc21", "committedDate": "2020-03-05T23:08:41Z", "message": "Code review updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c44a9ca6f73651ec34e96359198643ec838c0ebf", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/c44a9ca6f73651ec34e96359198643ec838c0ebf", "committedDate": "2020-03-05T23:08:41Z", "message": "Leader election tunning"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "381df991e1d99f3ef92e4cbb432f98421f3440e3", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/381df991e1d99f3ef92e4cbb432f98421f3440e3", "committedDate": "2020-03-05T23:02:29Z", "message": "Leader election tunning"}, "afterCommit": {"oid": "c44a9ca6f73651ec34e96359198643ec838c0ebf", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/c44a9ca6f73651ec34e96359198643ec838c0ebf", "committedDate": "2020-03-05T23:08:41Z", "message": "Leader election tunning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e85395fe8b78e466bc4c39589ea717f22ca481c", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/2e85395fe8b78e466bc4c39589ea717f22ca481c", "committedDate": "2020-03-05T23:42:26Z", "message": "Dependency lock update"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 651, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}