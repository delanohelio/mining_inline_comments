{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjMwOTM4", "number": 894, "title": "Configurable prediction quantiles", "bodyText": "", "createdAt": "2020-08-06T19:50:13Z", "url": "https://github.com/Netflix/titus-control-plane/pull/894", "merged": true, "mergeCommit": {"oid": "d619d6ade62316cdba3eaa55d39cccd37e1f5e57"}, "closed": true, "closedAt": "2020-08-07T19:44:49Z", "author": {"login": "tbak"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8VRqNAH2gAyNDY0MjMwOTM4OjJkMDQ3MTQ0YWFjMjIxYjhjYzNiMmJkZTc4YWMxMGVlMWNlMTAwYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8qLBBgFqTQ2MzU4MjYwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d047144aac221b8cc3b2bde78ac10ee1ce100a4", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/2d047144aac221b8cc3b2bde78ac10ee1ce100a4", "committedDate": "2020-08-06T19:48:50Z", "message": "Configurable prediction quantiles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODQyMTA3", "url": "https://github.com/Netflix/titus-control-plane/pull/894#pullrequestreview-462842107", "createdAt": "2020-08-06T20:11:49Z", "commit": {"oid": "2d047144aac221b8cc3b2bde78ac10ee1ce100a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTgyNjA4", "url": "https://github.com/Netflix/titus-control-plane/pull/894#pullrequestreview-463582608", "createdAt": "2020-08-07T20:09:19Z", "commit": {"oid": "2d047144aac221b8cc3b2bde78ac10ee1ce100a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDowOToxOVrOG9mdjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDowOToxOVrOG9mdjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0NjQ3Nw==", "bodyText": "minor: I'm always a bit worried about comparing floating point numbers with ==. Might be good to compare against a tiny epsilon range here to make it less brittle to floating point math in the future", "url": "https://github.com/Netflix/titus-control-plane/pull/894#discussion_r467246477", "createdAt": "2020-08-07T20:09:19Z", "author": {"login": "fabiokung"}, "path": "titus-server-runtime/src/main/java/com/netflix/titus/runtime/endpoint/admission/JobRuntimePredictionUtil.java", "diffHunk": "@@ -16,21 +16,31 @@\n \n package com.netflix.titus.runtime.endpoint.admission;\n \n+import java.util.Optional;\n+import java.util.SortedSet;\n+\n import com.netflix.titus.runtime.connector.prediction.JobRuntimePrediction;\n import org.apache.commons.math3.distribution.NormalDistribution;\n \n-final class JobRuntimePredictionUtil {\n+public final class JobRuntimePredictionUtil {\n \n     private static final double LOW_QUANTILE = 0.05;\n-    private static final double HIGH_QUANTILE = 0.95;\n+    public static final double HIGH_QUANTILE = 0.95;\n \n     static final double NORM_SIGMA = computeNormSigma();\n \n     private JobRuntimePredictionUtil() {\n     }\n \n-    static boolean expectedQuantiles(JobRuntimePrediction low, JobRuntimePrediction high) {\n-        return low.getConfidence() == LOW_QUANTILE && high.getConfidence() == HIGH_QUANTILE;\n+    static boolean expectedLowest(JobRuntimePrediction low) {\n+        return low.getConfidence() == LOW_QUANTILE;\n+    }\n+\n+    static Optional<JobRuntimePrediction> findRequested(SortedSet<JobRuntimePrediction> predictions, double quantile) {\n+        if (predictions.isEmpty()) {\n+            return Optional.empty();\n+        }\n+        return predictions.stream().filter(p -> p.getConfidence() == quantile).findFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d047144aac221b8cc3b2bde78ac10ee1ce100a4"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 562, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}