{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MjEwOTk4", "number": 903, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODo1NDowNVrOEdWNgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMDozMzozOFrOEd4Yig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjA4MDY3OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODo1NDowNVrOHIdJCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzowMzoxMFrOHJOBbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyODEwNw==", "bodyText": "You can use equivalent method from Evaluators class in titus-common.", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r478628107", "createdAt": "2020-08-27T18:54:05Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "diffHunk": "@@ -148,6 +149,15 @@ public static Task attachPlacementData(Task task, Optional<TitusExecutorDetails>\n         }).orElse(task);\n     }\n \n+    public static Task attachKubeletData(Task task, PodWrapper podWrapper) {\n+        String ipv4 = podWrapper.getV1Pod().getStatus().getPodIP();\n+        Map<String, String> newContext = new HashMap<>(task.getTaskContext());\n+        BiConsumer<String, String> contextSetter = (key, value) -> StringExt.applyIfNonEmpty(value, v -> newContext.put(key, v));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyODk3NQ==", "bodyText": "I see applyNotNull in Evaulators, but that won't help me against Empty strings though.", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479428975", "createdAt": "2020-08-28T17:03:10Z", "author": {"login": "solarkennedy"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "diffHunk": "@@ -148,6 +149,15 @@ public static Task attachPlacementData(Task task, Optional<TitusExecutorDetails>\n         }).orElse(task);\n     }\n \n+    public static Task attachKubeletData(Task task, PodWrapper podWrapper) {\n+        String ipv4 = podWrapper.getV1Pod().getStatus().getPodIP();\n+        Map<String, String> newContext = new HashMap<>(task.getTaskContext());\n+        BiConsumer<String, String> contextSetter = (key, value) -> StringExt.applyIfNonEmpty(value, v -> newContext.put(key, v));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyODEwNw=="}, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjA4MzQ1OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODo1NDo1NFrOHIdKvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxOTo0MVrOHJOhTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyODU0Mw==", "bodyText": "You should check defensively that status is not null as well.", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r478628543", "createdAt": "2020-08-27T18:54:54Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "diffHunk": "@@ -148,6 +149,15 @@ public static Task attachPlacementData(Task task, Optional<TitusExecutorDetails>\n         }).orElse(task);\n     }\n \n+    public static Task attachKubeletData(Task task, PodWrapper podWrapper) {\n+        String ipv4 = podWrapper.getV1Pod().getStatus().getPodIP();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyOTA2Ng==", "bodyText": "Good idea", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479429066", "createdAt": "2020-08-28T17:03:21Z", "author": {"login": "solarkennedy"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "diffHunk": "@@ -148,6 +149,15 @@ public static Task attachPlacementData(Task task, Optional<TitusExecutorDetails>\n         }).orElse(task);\n     }\n \n+    public static Task attachKubeletData(Task task, PodWrapper podWrapper) {\n+        String ipv4 = podWrapper.getV1Pod().getStatus().getPodIP();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyODU0Mw=="}, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNzEzNA==", "bodyText": "We should also add if(podWrapper.getV1Pod().getStatus() == null) { return task; }", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479437134", "createdAt": "2020-08-28T17:19:41Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "diffHunk": "@@ -148,6 +149,15 @@ public static Task attachPlacementData(Task task, Optional<TitusExecutorDetails>\n         }).orElse(task);\n     }\n \n+    public static Task attachKubeletData(Task task, PodWrapper podWrapper) {\n+        String ipv4 = podWrapper.getV1Pod().getStatus().getPodIP();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyODU0Mw=="}, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjA4NzYxOnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODo1NjowNFrOHIdNSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzowNTozOFrOHJOGbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyOTE5NA==", "bodyText": "executorDetailsOpt == null || executorDetailsOpt.isEmpty()", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r478629194", "createdAt": "2020-08-27T18:56:04Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "diffHunk": "@@ -290,8 +290,13 @@ static Task updateTaskStatus(PodWrapper podWrapper,\n                 .build();\n \n         Task fixedTask = fillInMissingStates(podWrapper, updatedTask);\n-        Task taskWithPlacementData = JobManagerUtil.attachPlacementData(fixedTask, executorDetailsOpt);\n-        Task taskWithNodeMetadata = node.map(n -> attachNodeMetadata(taskWithPlacementData, n)).orElse(taskWithPlacementData);\n+        Task taskWithExecutorData;\n+        if (executorDetailsOpt == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzMDI1NA==", "bodyText": "There is no method like that on this object (because it is optional?)\nThere is a isPresent, but it just checks for nullness too.", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479430254", "createdAt": "2020-08-28T17:05:38Z", "author": {"login": "solarkennedy"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "diffHunk": "@@ -290,8 +290,13 @@ static Task updateTaskStatus(PodWrapper podWrapper,\n                 .build();\n \n         Task fixedTask = fillInMissingStates(podWrapper, updatedTask);\n-        Task taskWithPlacementData = JobManagerUtil.attachPlacementData(fixedTask, executorDetailsOpt);\n-        Task taskWithNodeMetadata = node.map(n -> attachNodeMetadata(taskWithPlacementData, n)).orElse(taskWithPlacementData);\n+        Task taskWithExecutorData;\n+        if (executorDetailsOpt == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyOTE5NA=="}, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjA5MTE5OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODo1NzowNFrOHIdPdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxODo1NzowNFrOHIdPdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyOTc1MQ==", "bodyText": "That is not need needed?", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r478629751", "createdAt": "2020-08-27T18:57:04Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeUtil.java", "diffHunk": "@@ -127,7 +127,21 @@ public static boolean isPodPhaseTerminal(String phase) {\n                     )\n             );\n             return Optional.of(titusExecutorDetails);\n+        } else if (!Strings.isNullOrEmpty(pod.getStatus().getPodIP())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "253b77b7946c0f02818e5fc713b24256a72b31a9"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzU0MjYzOnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTo0MjozNVrOHJSbhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTo0MjozNVrOHJSbhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwMTE5MQ==", "bodyText": "minor: formatting is odd here. There's code style config file for IntelliJ you can use in the codequality/ folder", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479501191", "createdAt": "2020-08-28T19:42:35Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "diffHunk": "@@ -148,6 +149,20 @@ public static Task attachPlacementData(Task task, Optional<TitusExecutorDetails>\n         }).orElse(task);\n     }\n \n+    public static Task attachKubeletData(Task task, PodWrapper podWrapper) {\n+        if(podWrapper.getV1Pod().getStatus() == null) { return task; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3eb607a9a6dedf2edf30a39cb67329ed22fef603"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzU0NTA4OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTo0MzoyMlrOHJSc3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTo0MzoyMlrOHJSc3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwMTUzNQ==", "bodyText": "minor: remove the else (previous if clause already has an early return) and reduce indentation level", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479501535", "createdAt": "2020-08-28T19:43:22Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/JobManagerUtil.java", "diffHunk": "@@ -148,6 +149,20 @@ public static Task attachPlacementData(Task task, Optional<TitusExecutorDetails>\n         }).orElse(task);\n     }\n \n+    public static Task attachKubeletData(Task task, PodWrapper podWrapper) {\n+        if(podWrapper.getV1Pod().getStatus() == null) { return task; }\n+        String ipv4 = podWrapper.getV1Pod().getStatus().getPodIP();\n+        if (ipv4 == null || ipv4.isEmpty()) {\n+            return task;\n+        } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3eb607a9a6dedf2edf30a39cb67329ed22fef603"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzU1NzY0OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/test/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTo0NzoyOVrOHJSkCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMDowNzo1M1rOHJTFLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwMzM3MA==", "bodyText": "odd formatting, please use the code-style rules in codequality/", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479503370", "createdAt": "2020-08-28T19:47:29Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/test/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessorTest.java", "diffHunk": "@@ -45,16 +45,7 @@\n import com.netflix.titus.master.mesos.kubeapiserver.direct.model.PodPhase;\n import com.netflix.titus.master.mesos.kubeapiserver.direct.model.PodWrapper;\n import com.netflix.titus.testkit.model.job.JobGenerator;\n-import io.kubernetes.client.openapi.models.V1ContainerState;\n-import io.kubernetes.client.openapi.models.V1ContainerStateRunning;\n-import io.kubernetes.client.openapi.models.V1ContainerStateWaiting;\n-import io.kubernetes.client.openapi.models.V1ContainerStatus;\n-import io.kubernetes.client.openapi.models.V1Node;\n-import io.kubernetes.client.openapi.models.V1NodeAddress;\n-import io.kubernetes.client.openapi.models.V1NodeStatus;\n-import io.kubernetes.client.openapi.models.V1ObjectMeta;\n-import io.kubernetes.client.openapi.models.V1Pod;\n-import io.kubernetes.client.openapi.models.V1PodStatus;\n+import io.kubernetes.client.openapi.models.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3eb607a9a6dedf2edf30a39cb67329ed22fef603"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMTg1NQ==", "bodyText": "Ah! I should have read CONTRIBUTING!", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479511855", "createdAt": "2020-08-28T20:07:53Z", "author": {"login": "solarkennedy"}, "path": "titus-server-master/src/test/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessorTest.java", "diffHunk": "@@ -45,16 +45,7 @@\n import com.netflix.titus.master.mesos.kubeapiserver.direct.model.PodPhase;\n import com.netflix.titus.master.mesos.kubeapiserver.direct.model.PodWrapper;\n import com.netflix.titus.testkit.model.job.JobGenerator;\n-import io.kubernetes.client.openapi.models.V1ContainerState;\n-import io.kubernetes.client.openapi.models.V1ContainerStateRunning;\n-import io.kubernetes.client.openapi.models.V1ContainerStateWaiting;\n-import io.kubernetes.client.openapi.models.V1ContainerStatus;\n-import io.kubernetes.client.openapi.models.V1Node;\n-import io.kubernetes.client.openapi.models.V1NodeAddress;\n-import io.kubernetes.client.openapi.models.V1NodeStatus;\n-import io.kubernetes.client.openapi.models.V1ObjectMeta;\n-import io.kubernetes.client.openapi.models.V1Pod;\n-import io.kubernetes.client.openapi.models.V1PodStatus;\n+import io.kubernetes.client.openapi.models.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwMzM3MA=="}, "originalCommit": {"oid": "3eb607a9a6dedf2edf30a39cb67329ed22fef603"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzU2MTQ0OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTo0ODo0NFrOHJSmMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMDoyMzozMVrOHJTdaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwMzkyMg==", "bodyText": "instead of doing this here, did you consider changing the logic in KubeUtil.getTitusExecutorDetails(pod), and checking whether pod.getStatus().getPodIP() should be used instead of annotations there? Centralizing this logic in that method looks cleaner to me. As more metadata is added to the kubelet path, I think it will be easier to keep both code paths more consistent in there.", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479503922", "createdAt": "2020-08-28T19:48:44Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "diffHunk": "@@ -290,8 +290,13 @@ static Task updateTaskStatus(PodWrapper podWrapper,\n                 .build();\n \n         Task fixedTask = fillInMissingStates(podWrapper, updatedTask);\n-        Task taskWithPlacementData = JobManagerUtil.attachPlacementData(fixedTask, executorDetailsOpt);\n-        Task taskWithNodeMetadata = node.map(n -> attachNodeMetadata(taskWithPlacementData, n)).orElse(taskWithPlacementData);\n+        Task taskWithExecutorData;\n+        if (executorDetailsOpt.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3eb607a9a6dedf2edf30a39cb67329ed22fef603"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMzk3NQ==", "bodyText": "I feel like I'm getting conflicting review here. I originally had this logic in getTitusExecutorDetails, but @tbak asked me to check if executorDetailsOpt was present first and do it this way (pretty sure if I'm interpreting his intent).", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479513975", "createdAt": "2020-08-28T20:13:04Z", "author": {"login": "solarkennedy"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "diffHunk": "@@ -290,8 +290,13 @@ static Task updateTaskStatus(PodWrapper podWrapper,\n                 .build();\n \n         Task fixedTask = fillInMissingStates(podWrapper, updatedTask);\n-        Task taskWithPlacementData = JobManagerUtil.attachPlacementData(fixedTask, executorDetailsOpt);\n-        Task taskWithNodeMetadata = node.map(n -> attachNodeMetadata(taskWithPlacementData, n)).orElse(taskWithPlacementData);\n+        Task taskWithExecutorData;\n+        if (executorDetailsOpt.isPresent()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwMzkyMg=="}, "originalCommit": {"oid": "3eb607a9a6dedf2edf30a39cb67329ed22fef603"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxODA1OQ==", "bodyText": "My point was that TitusExecutorDetails is a legacy data structure that we want to get rid off.\nI think it would be better to move the new function into KubeUtil, but keep it separate as it is now.", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479518059", "createdAt": "2020-08-28T20:23:31Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "diffHunk": "@@ -290,8 +290,13 @@ static Task updateTaskStatus(PodWrapper podWrapper,\n                 .build();\n \n         Task fixedTask = fillInMissingStates(podWrapper, updatedTask);\n-        Task taskWithPlacementData = JobManagerUtil.attachPlacementData(fixedTask, executorDetailsOpt);\n-        Task taskWithNodeMetadata = node.map(n -> attachNodeMetadata(taskWithPlacementData, n)).orElse(taskWithPlacementData);\n+        Task taskWithExecutorData;\n+        if (executorDetailsOpt.isPresent()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwMzkyMg=="}, "originalCommit": {"oid": "3eb607a9a6dedf2edf30a39cb67329ed22fef603"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzY3OTQ2OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMDozMzozOFrOHJTtMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMDozMzozOFrOHJTtMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUyMjA5OA==", "bodyText": "minor: missed formatting here", "url": "https://github.com/Netflix/titus-control-plane/pull/903#discussion_r479522098", "createdAt": "2020-08-28T20:33:38Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeUtil.java", "diffHunk": "@@ -132,6 +132,7 @@ public static boolean isPodPhaseTerminal(String phase) {\n     }\n \n     public static Optional<V1ContainerState> findContainerState(V1Pod pod) {\n+        if(pod.getStatus() == null) { return Optional.empty(); }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9da78c2266510e1e1dcdeb9170af79fc292dee1"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4016, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}