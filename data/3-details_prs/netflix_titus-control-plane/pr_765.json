{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNjQyMDgx", "number": 765, "title": "use job runtime limits as the runtime prediction when sensible", "bodyText": "ignore prediction attributes passed in when creating jobs (these are to be generated)\ncap runtime predictions to the runtime limit for batch jobs that have a limit\nuse the job runtime limit as a fallback when no predictions are selected for a job\nlower the minimum job runtime limit to 5s (from 60s) to allow short running batch jobs to specify a runtime limit", "createdAt": "2020-02-07T23:21:40Z", "url": "https://github.com/Netflix/titus-control-plane/pull/765", "merged": true, "mergeCommit": {"oid": "a267384b53e1c8e0adc21208cd84514b9fc06139"}, "closed": true, "closedAt": "2020-02-15T00:59:32Z", "author": {"login": "fabiokung"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCH7kiAFqTM1NTQ5NTAxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEZE1OgH2gAyMzcyNjQyMDgxOmNkYzM3MGQwNTk5ZTM0ZTRlNjNkZjAwMTNkNDhjZGJkMGI1ZGJjMWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDk1MDE2", "url": "https://github.com/Netflix/titus-control-plane/pull/765#pullrequestreview-355495016", "createdAt": "2020-02-07T23:28:20Z", "commit": {"oid": "5f7eca2eff3b273fecc9d082cf83fa42d1e90fd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTAwOTQw", "url": "https://github.com/Netflix/titus-control-plane/pull/765#pullrequestreview-355500940", "createdAt": "2020-02-07T23:50:34Z", "commit": {"oid": "5f7eca2eff3b273fecc9d082cf83fa42d1e90fd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f7eca2eff3b273fecc9d082cf83fa42d1e90fd4", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/5f7eca2eff3b273fecc9d082cf83fa42d1e90fd4", "committedDate": "2020-02-07T23:20:44Z", "message": "ignore input attributes that are to be generated"}, "afterCommit": {"oid": "fd76190fec6441404268d1ac45e39f6eb8d0f024", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/fd76190fec6441404268d1ac45e39f6eb8d0f024", "committedDate": "2020-02-14T01:12:44Z", "message": "reduce the minimum job runtime limit to 5s\n\n... from 60s. This will allow jobs with shorter runtime limits to get\nscheduled opportunistically even without predictions."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd76190fec6441404268d1ac45e39f6eb8d0f024", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/fd76190fec6441404268d1ac45e39f6eb8d0f024", "committedDate": "2020-02-14T01:12:44Z", "message": "reduce the minimum job runtime limit to 5s\n\n... from 60s. This will allow jobs with shorter runtime limits to get\nscheduled opportunistically even without predictions."}, "afterCommit": {"oid": "a017af18c687f490d989ab5cf7059a98602dfe8d", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/a017af18c687f490d989ab5cf7059a98602dfe8d", "committedDate": "2020-02-14T01:29:47Z", "message": "reduce the minimum job runtime limit to 5s\n\n... from 60s. This will allow jobs with shorter runtime limits to get\nscheduled opportunistically even without predictions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MDM1Njk3", "url": "https://github.com/Netflix/titus-control-plane/pull/765#pullrequestreview-359035697", "createdAt": "2020-02-14T15:48:35Z", "commit": {"oid": "a017af18c687f490d989ab5cf7059a98602dfe8d"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNTo0ODozNVrOFp7DGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNTo1MzozOFrOFp7OpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUwMzM4Nw==", "bodyText": "The description is probably incorrect: the more specific type is required? We do not change type here. It looks like a function composition. In that case this method could be generalized to accept an array of operators.", "url": "https://github.com/Netflix/titus-control-plane/pull/765#discussion_r379503387", "createdAt": "2020-02-14T15:48:35Z", "author": {"login": "tbak"}, "path": "titus-common/src/main/java/com/netflix/titus/common/util/FunctionExt.java", "diffHunk": "@@ -37,4 +40,14 @@\n         }\n         return opt;\n     }\n+\n+    /**\n+     * {@link UnaryOperator} does not have an equivalent of {@link Function#andThen(Function)}, so this can be used when\n+     * the more specific type is required.\n+     */\n+    public static <T> UnaryOperator<T> andThen(UnaryOperator<T> op, UnaryOperator<T> after) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a017af18c687f490d989ab5cf7059a98602dfe8d"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUwNjM0MA==", "bodyText": "In DifferenceResolverUtils we have:\nlong runtimeLimitMs = Math.max(60_000, batchJob.getJobDescriptor().getExtensions().getRuntimeLimitMs());\nWe did this to prevent to unnecessary terminations, due to slowness in state propagation. The runtime limit for a job should be an actual limit + delta. Delta ~60sec is an amount we set here, assuming actual execution time is 0.", "url": "https://github.com/Netflix/titus-control-plane/pull/765#discussion_r379506340", "createdAt": "2020-02-14T15:53:38Z", "author": {"login": "tbak"}, "path": "titus-api/src/main/java/com/netflix/titus/api/jobmanager/model/job/ext/BatchJobExt.java", "diffHunk": "@@ -34,7 +34,7 @@\n     @FieldInvariant(value = \"value <= @constraints.getMaxBatchJobSize()\", message = \"Batch job too big #{value} > #{@constraints.getMaxBatchJobSize()}\")\n     private final int size;\n \n-    @Min(value = 60_000, message = \"Runtime limit too low (must be at least 60sec, but is #{#root}[ms])\")\n+    @Min(value = 5_000, message = \"Runtime limit too low (must be at least 5sec, but is #{#root}[ms])\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a017af18c687f490d989ab5cf7059a98602dfe8d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MDYzODU0", "url": "https://github.com/Netflix/titus-control-plane/pull/765#pullrequestreview-359063854", "createdAt": "2020-02-14T16:28:20Z", "commit": {"oid": "a017af18c687f490d989ab5cf7059a98602dfe8d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "405d4cff099abbba6707ad4d65cc5258f31be057", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/405d4cff099abbba6707ad4d65cc5258f31be057", "committedDate": "2020-02-14T22:09:04Z", "message": "ignore input attributes that are to be generated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "588f0d64973c63b7b9d4d32f896c6ea51a81a22c", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/588f0d64973c63b7b9d4d32f896c6ea51a81a22c", "committedDate": "2020-02-14T22:09:04Z", "message": "cap runtime predictions to the job runtime limit\n\nNo point in predicting a runtime higher than the configured job runtime\nlimit. The runtime limit also act as a fallback when there are no\npredictions available for a job."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e04f7efaf44cbfbbb43ce3a710452d5656741d27", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/e04f7efaf44cbfbbb43ce3a710452d5656741d27", "committedDate": "2020-02-14T22:09:04Z", "message": "reduce the minimum job runtime limit to 5s\n\n... from 60s. This will allow jobs with shorter runtime limits to get\nscheduled opportunistically even without predictions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5b2112494ba64ff5a84c3024f8879ccdd21a682", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/b5b2112494ba64ff5a84c3024f8879ccdd21a682", "committedDate": "2020-02-14T22:09:04Z", "message": "integration tests: support for scaling down agents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6931a7e2827b338c8f98fe6cdfd694545795a43", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/b6931a7e2827b338c8f98fe6cdfd694545795a43", "committedDate": "2020-02-15T00:27:12Z", "message": "improve OpportunisticCpuSchedulingTest flakiness\n\n... by avoiding \"Stuck in Launched\" situations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a017af18c687f490d989ab5cf7059a98602dfe8d", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/a017af18c687f490d989ab5cf7059a98602dfe8d", "committedDate": "2020-02-14T01:29:47Z", "message": "reduce the minimum job runtime limit to 5s\n\n... from 60s. This will allow jobs with shorter runtime limits to get\nscheduled opportunistically even without predictions."}, "afterCommit": {"oid": "b6931a7e2827b338c8f98fe6cdfd694545795a43", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/b6931a7e2827b338c8f98fe6cdfd694545795a43", "committedDate": "2020-02-15T00:27:12Z", "message": "improve OpportunisticCpuSchedulingTest flakiness\n\n... by avoiding \"Stuck in Launched\" situations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdc370d0599e34e4e63df0013d48cdbd0b5dbc1b", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/cdc370d0599e34e4e63df0013d48cdbd0b5dbc1b", "committedDate": "2020-02-15T00:34:41Z", "message": "improve javadoc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 614, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}