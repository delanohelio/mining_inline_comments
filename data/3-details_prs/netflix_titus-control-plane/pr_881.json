{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NTU0MDEw", "number": 881, "title": "Fix scheduling classifier handling of ExclusiveHost hard constraint failures", "bodyText": "A failure for a task with the ExclusiveHost hard constraint is different from other tasks failing on a machine because it is already running another task with ExclusiveHost.\nBoth failure modes are classified with different priority to avoid prematurely triggering the ClusterAgentAutoscaler, when tasks that don't have the hard constraint are failing due to other transient scheduling failures.\nAutomated testing of this part of the codebase is unfortunately pretty difficult due to some Fenzo classes not being public and/or mockable, so I'm punting on junit tests.", "createdAt": "2020-07-13T23:20:12Z", "url": "https://github.com/Netflix/titus-control-plane/pull/881", "merged": true, "mergeCommit": {"oid": "aa4cce1a54b90a88a1eac0d4114be34b83381b9d"}, "closed": true, "closedAt": "2020-07-14T20:03:33Z", "author": {"login": "fabiokung"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0pwkTAH2gAyNDQ4NTU0MDEwOjQ3NzJhM2MzYzc0ZDM0MjJlMGQ1YTgzNmJiNWVmOWRhZTM4MzViZjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc06-ewgFqTQ0ODM5MDQ4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4772a3c3c74d3422e0d5a836bb5ef9dae3835bf9", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/4772a3c3c74d3422e0d5a836bb5ef9dae3835bf9", "committedDate": "2020-07-13T23:09:18Z", "message": "KubeApiNotAvailable is a transient scheduling error\n\nIt will not trigger autoscaling, or modify opportunistic scheduling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed724d283b11ebd9951267f26f16e54300ac4892", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/ed724d283b11ebd9951267f26f16e54300ac4892", "committedDate": "2020-07-13T23:15:05Z", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures."}, "afterCommit": {"oid": "e41b5f67c565e0ccb1916da0a01ac029f6b7e4c9", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/e41b5f67c565e0ccb1916da0a01ac029f6b7e4c9", "committedDate": "2020-07-13T23:20:43Z", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "committedDate": "2020-07-13T23:22:17Z", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e41b5f67c565e0ccb1916da0a01ac029f6b7e4c9", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/e41b5f67c565e0ccb1916da0a01ac029f6b7e4c9", "committedDate": "2020-07-13T23:20:43Z", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures."}, "afterCommit": {"oid": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/c9ad0f582320a28d58cdeaa7618781a4fc7ab050", "committedDate": "2020-07-13T23:22:17Z", "message": "ExclusiveHost has two different failure modes\n\nA failure for a task that has the hard constraint is different from\nother tasks failing because a machine is already running a task with\nExclusiveHost. Both failures are classified with different priority to\navoid prematurely triggering the ClusterAgentAutoscaler when tasks\nthat don't have the hard constraint are failing due to other transient\nscheduling failures."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzAwNzMz", "url": "https://github.com/Netflix/titus-control-plane/pull/881#pullrequestreview-448300733", "createdAt": "2020-07-14T17:08:00Z", "commit": {"oid": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzowODowMFrOGxdErQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzowODowMFrOGxdErQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUwOTc0MQ==", "bodyText": "Is the priority defined by the declaration order in the enum type?", "url": "https://github.com/Netflix/titus-control-plane/pull/881#discussion_r454509741", "createdAt": "2020-07-14T17:08:00Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailure.java", "diffHunk": "@@ -79,31 +79,46 @@\n          */\n         OpportunisticResource,\n \n+        /**\n+         * Task not launched due to other tasks with the exclusiveHost hard constraint on the same agent. It has the lowest priority.\n+         */\n+        ExclusiveHost,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzEyODA3", "url": "https://github.com/Netflix/titus-control-plane/pull/881#pullrequestreview-448312807", "createdAt": "2020-07-14T17:24:38Z", "commit": {"oid": "c9ad0f582320a28d58cdeaa7618781a4fc7ab050"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b670f85db3b7fa28a1bb6167adf8786f3488ab4", "author": {"user": {"login": "fabiokung", "name": "Fabio Kung"}}, "url": "https://github.com/Netflix/titus-control-plane/commit/5b670f85db3b7fa28a1bb6167adf8786f3488ab4", "committedDate": "2020-07-14T19:04:18Z", "message": "address PR review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzkwNDg3", "url": "https://github.com/Netflix/titus-control-plane/pull/881#pullrequestreview-448390487", "createdAt": "2020-07-14T19:12:53Z", "commit": {"oid": "5b670f85db3b7fa28a1bb6167adf8786f3488ab4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 548, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}