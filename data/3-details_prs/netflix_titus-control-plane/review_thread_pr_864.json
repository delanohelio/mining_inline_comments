{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMzg5MDA5", "number": 864, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowNjoxNVrOEDoI7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowOToyOFrOEDoMnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMjM4ODI4OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/batch/BatchDifferenceResolver.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowNjoxNlrOGgwaww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMToyODowMFrOGgxEbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMDg5OQ==", "bodyText": "minor: combine the if below into a single boolean logic operation (&&)", "url": "https://github.com/Netflix/titus-control-plane/pull/864#discussion_r437000899", "createdAt": "2020-06-08T21:06:16Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/batch/BatchDifferenceResolver.java", "diffHunk": "@@ -269,17 +269,19 @@ public BatchDifferenceResolver(\n         for (BatchJobTask refTask : tasks) {\n             BatchJobTask runningTask = runningJobView.getTaskById(refTask.getId());\n             if (JobFunctions.isOwnedByKubeScheduler(refTask)) {\n-                // TODO This complexity exists due to the way Fenzo is initialized on bootstrap. This code can be simplified one we move off Fenzo.\n-                if (runningTask == null || (refTask.getStatus().getState() == TaskState.Accepted && !TaskStatus.hasPod(refTask))) {\n-                    missingTasks.add(BasicTaskActions.launchTaskInKube(\n-                            kubeApiServerIntegrator,\n-                            configuration,\n-                            engine,\n-                            runningJobView.getJob(),\n-                            refTask,\n-                            RECONCILER_CALLMETADATA.toBuilder().withCallReason(\"Launching task in Kube\").build(),\n-                            titusRuntime\n-                    ));\n+                if (kubeApiServerIntegrator.isReadyForScheduling()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3510fff0abd387c11a6c4437cf50ba1fb7afc3c8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMTE3Nw==", "bodyText": "even better, maybe consider extracting the boolean logic chain into a separate method/function", "url": "https://github.com/Netflix/titus-control-plane/pull/864#discussion_r437001177", "createdAt": "2020-06-08T21:06:53Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/batch/BatchDifferenceResolver.java", "diffHunk": "@@ -269,17 +269,19 @@ public BatchDifferenceResolver(\n         for (BatchJobTask refTask : tasks) {\n             BatchJobTask runningTask = runningJobView.getTaskById(refTask.getId());\n             if (JobFunctions.isOwnedByKubeScheduler(refTask)) {\n-                // TODO This complexity exists due to the way Fenzo is initialized on bootstrap. This code can be simplified one we move off Fenzo.\n-                if (runningTask == null || (refTask.getStatus().getState() == TaskState.Accepted && !TaskStatus.hasPod(refTask))) {\n-                    missingTasks.add(BasicTaskActions.launchTaskInKube(\n-                            kubeApiServerIntegrator,\n-                            configuration,\n-                            engine,\n-                            runningJobView.getJob(),\n-                            refTask,\n-                            RECONCILER_CALLMETADATA.toBuilder().withCallReason(\"Launching task in Kube\").build(),\n-                            titusRuntime\n-                    ));\n+                if (kubeApiServerIntegrator.isReadyForScheduling()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMDg5OQ=="}, "originalCommit": {"oid": "3510fff0abd387c11a6c4437cf50ba1fb7afc3c8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAxMTU2NA==", "bodyText": "I was thinking about extracting this into a util function, but there would be too many arguments, which would not improved the code readability.", "url": "https://github.com/Netflix/titus-control-plane/pull/864#discussion_r437011564", "createdAt": "2020-06-08T21:28:00Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/batch/BatchDifferenceResolver.java", "diffHunk": "@@ -269,17 +269,19 @@ public BatchDifferenceResolver(\n         for (BatchJobTask refTask : tasks) {\n             BatchJobTask runningTask = runningJobView.getTaskById(refTask.getId());\n             if (JobFunctions.isOwnedByKubeScheduler(refTask)) {\n-                // TODO This complexity exists due to the way Fenzo is initialized on bootstrap. This code can be simplified one we move off Fenzo.\n-                if (runningTask == null || (refTask.getStatus().getState() == TaskState.Accepted && !TaskStatus.hasPod(refTask))) {\n-                    missingTasks.add(BasicTaskActions.launchTaskInKube(\n-                            kubeApiServerIntegrator,\n-                            configuration,\n-                            engine,\n-                            runningJobView.getJob(),\n-                            refTask,\n-                            RECONCILER_CALLMETADATA.toBuilder().withCallReason(\"Launching task in Kube\").build(),\n-                            titusRuntime\n-                    ));\n+                if (kubeApiServerIntegrator.isReadyForScheduling()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMDg5OQ=="}, "originalCommit": {"oid": "3510fff0abd387c11a6c4437cf50ba1fb7afc3c8"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMjM5NzcyOnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailureClassifier.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowOToyOFrOGgwgwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMTowOToyOFrOGgwgwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMjQzMg==", "bodyText": "typo s/Abi/Api/", "url": "https://github.com/Netflix/titus-control-plane/pull/864#discussion_r437002432", "createdAt": "2020-06-08T21:09:28Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/scheduler/TaskPlacementFailureClassifier.java", "diffHunk": "@@ -153,6 +155,23 @@ private boolean processNoActiveAgent(T taskRequest, List<TaskAssignmentResult> a\n         return true;\n     }\n \n+    private boolean processKubeAbiNotReady(T taskRequest, List<TaskAssignmentResult> assignmentResults,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3510fff0abd387c11a6c4437cf50ba1fb7afc3c8"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3971, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}