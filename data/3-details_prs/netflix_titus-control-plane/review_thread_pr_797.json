{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNjg0MDYz", "number": 797, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozODozM1rODk0zWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTo0MDo1M1rODk02Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwNDQwOnYy", "diffSide": "RIGHT", "path": "titus-common-ext/kube/src/main/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeClusterMembershipConnectorComponent.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozODozM1rOFxXdYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTo0MjoyMlrOFxXk-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwODg5OA==", "bodyText": "can you see if this is still needed?", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387308898", "createdAt": "2020-03-03T21:38:33Z", "author": {"login": "corindwyer"}, "path": "titus-common-ext/kube/src/main/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeClusterMembershipConnectorComponent.java", "diffHunk": "@@ -70,7 +69,7 @@ public ApiClient getApiClient(KubeConnectorConfiguration configuration) {\n             client = Config.fromUrl(kubeApiServerUri);\n         }\n \n-        client.getHttpClient().setReadTimeout(0, TimeUnit.SECONDS); // infinite timeout\n+        client.setReadTimeout(0); // infinite timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMxMDg0Mg==", "bodyText": "I do not know why it was set like that. I am just keeping the original behavior.\nEven if not needed, I do not want to remove it now.", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387310842", "createdAt": "2020-03-03T21:42:22Z", "author": {"login": "tbak"}, "path": "titus-common-ext/kube/src/main/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeClusterMembershipConnectorComponent.java", "diffHunk": "@@ -70,7 +69,7 @@ public ApiClient getApiClient(KubeConnectorConfiguration configuration) {\n             client = Config.fromUrl(kubeApiServerUri);\n         }\n \n-        client.getHttpClient().setReadTimeout(0, TimeUnit.SECONDS); // infinite timeout\n+        client.setReadTimeout(0); // infinite timeout", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwODg5OA=="}, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwNTAwOnYy", "diffSide": "RIGHT", "path": "titus-common-ext/kube/src/test/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeExternalResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozODo0NFrOFxXdvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTo0MjoyN1rOFxXlJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwODk5MQ==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387308991", "createdAt": "2020-03-03T21:38:44Z", "author": {"login": "corindwyer"}, "path": "titus-common-ext/kube/src/test/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeExternalResource.java", "diffHunk": "@@ -40,7 +39,7 @@ protected void before() throws Throwable {\n                 .standard()\n                 .setBasePath(String.format(\"http://%s:7001\", kubeServer))\n                 .build();\n-        client.getHttpClient().setReadTimeout(0, TimeUnit.SECONDS); // infinite timeout\n+        client.setReadTimeout(0); // infinite timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMxMDg4Nw==", "bodyText": "I do not know why it was set like that. I am just keeping the original behavior.\nEven if not needed, I do not want to remove it now.", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387310887", "createdAt": "2020-03-03T21:42:27Z", "author": {"login": "tbak"}, "path": "titus-common-ext/kube/src/test/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeExternalResource.java", "diffHunk": "@@ -40,7 +39,7 @@ protected void before() throws Throwable {\n                 .standard()\n                 .setBasePath(String.format(\"http://%s:7001\", kubeServer))\n                 .build();\n-        client.getHttpClient().setReadTimeout(0, TimeUnit.SECONDS); // infinite timeout\n+        client.setReadTimeout(0); // infinite timeout", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwODk5MQ=="}, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwNjI3OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOToxMFrOFxXekw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOToxMFrOFxXekw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTIwMw==", "bodyText": "can you move taskId to new line to make it easier to read?", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309203", "createdAt": "2020-03-03T21:39:10Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -248,7 +248,15 @@ public void killTask(String taskId) {\n         killTaskCounter.increment();\n         try {\n             logger.info(\"deleting pod: {}\", taskId);\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId, KUBERNETES_NAMESPACE, null, null, null, DELETE_GRACE_PERIOD_SECONDS, null, null);\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwNjc1OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOToyMVrOFxXe9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOToyMVrOFxXe9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTMwMw==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309303", "createdAt": "2020-03-03T21:39:21Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -675,7 +683,14 @@ private void reconcileNodesAndPods() {\n     private void gcNode(V1Node node) {\n         String nodeName = node.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNode(nodeName, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNode(nodeName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwNzI5OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOTozMFrOFxXfTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOTozMFrOFxXfTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTM5MQ==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309391", "createdAt": "2020-03-03T21:39:30Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -712,7 +727,15 @@ private boolean isNodeReadyForGc(V1Node node) {\n     private void gcPod(V1Pod pod) {\n         String podName = pod.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName, KUBERNETES_NAMESPACE, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwODIwOnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOTo0NlrOFxXf2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMjo0MjoxM1rOFxZTUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTUzMQ==", "bodyText": "should verify if extra catch is still needed", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309531", "createdAt": "2020-03-03T21:39:46Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -248,7 +248,15 @@ public void killTask(String taskId) {\n         killTaskCounter.increment();\n         try {\n             logger.info(\"deleting pod: {}\", taskId);\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId, KUBERNETES_NAMESPACE, null, null, null, DELETE_GRACE_PERIOD_SECONDS, null, null);\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId,\n+                    KUBERNETES_NAMESPACE,\n+                    null,\n+                    null,\n+                    DELETE_GRACE_PERIOD_SECONDS,\n+                    null,\n+                    null,\n+                    null\n+            );\n         } catch (JsonSyntaxException e) {\n             // this is probably successful. the generated client has the wrong response type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMzOTA4OA==", "bodyText": "Still fails with the same exception:\ncom.google.gson.JsonSyntaxException: java.lang.IllegalStateException:\n Expected a string but was BEGIN_OBJECT at line 1 column 2451 path $.status", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387339088", "createdAt": "2020-03-03T22:42:13Z", "author": {"login": "tbak"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -248,7 +248,15 @@ public void killTask(String taskId) {\n         killTaskCounter.increment();\n         try {\n             logger.info(\"deleting pod: {}\", taskId);\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId, KUBERNETES_NAMESPACE, null, null, null, DELETE_GRACE_PERIOD_SECONDS, null, null);\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId,\n+                    KUBERNETES_NAMESPACE,\n+                    null,\n+                    null,\n+                    DELETE_GRACE_PERIOD_SECONDS,\n+                    null,\n+                    null,\n+                    null\n+            );\n         } catch (JsonSyntaxException e) {\n             // this is probably successful. the generated client has the wrong response type", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTUzMQ=="}, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwODQ4OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOTo1M1rOFxXgDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOTo1M1rOFxXgDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTU4MA==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309580", "createdAt": "2020-03-03T21:39:53Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -675,7 +683,14 @@ private void reconcileNodesAndPods() {\n     private void gcNode(V1Node node) {\n         String nodeName = node.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNode(nodeName, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNode(nodeName,\n+                    null,\n+                    null,\n+                    0,\n+                    null,\n+                    \"Background\",\n+                    null\n+            );\n         } catch (JsonSyntaxException e) {\n             // this is probably successful. the generated client has the wrong response type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQwODg3OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOTo1OVrOFxXgRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTozOTo1OVrOFxXgRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTYzNg==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387309636", "createdAt": "2020-03-03T21:39:59Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeApiServerIntegrator.java", "diffHunk": "@@ -712,7 +727,15 @@ private boolean isNodeReadyForGc(V1Node node) {\n     private void gcPod(V1Pod pod) {\n         String podName = pod.getMetadata().getName();\n         try {\n-            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName, KUBERNETES_NAMESPACE, null, null, null, 0, null, \"Background\");\n+            kubeApiFacade.getCoreV1Api().deleteNamespacedPod(podName,\n+                    KUBERNETES_NAMESPACE,\n+                    null,\n+                    null,\n+                    0,\n+                    null,\n+                    \"Background\",\n+                    null\n+            );\n         } catch (JsonSyntaxException e) {\n             // this is probably successful. the generated client has the wrong response type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTQxMTU5OnYy", "diffSide": "RIGHT", "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/direct/DefaultDirectKubeApiServerIntegrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTo0MDo1M1rOFxXiDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMTo0MDo1M1rOFxXiDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMxMDA5Mg==", "bodyText": "same as above", "url": "https://github.com/Netflix/titus-control-plane/pull/797#discussion_r387310092", "createdAt": "2020-03-03T21:40:53Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/direct/DefaultDirectKubeApiServerIntegrator.java", "diffHunk": "@@ -143,7 +143,15 @@ public void shutdown() {\n             Stopwatch timer = Stopwatch.createStarted();\n             try {\n                 logger.info(\"Deleting pod: {}\", taskId);\n-                kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId, KUBERNETES_NAMESPACE, null, null, null, DELETE_GRACE_PERIOD_SECONDS, null, null);\n+                kubeApiFacade.getCoreV1Api().deleteNamespacedPod(taskId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d044f17dbd38059de21601dd6f2c48fa43131596"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4084, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}