{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0ODA5MjI2", "number": 844, "title": "Add a Kube backend constraint", "bodyText": "to restrict placement to nodes running a specific Kube backend version", "createdAt": "2020-05-07T17:00:24Z", "url": "https://github.com/Netflix/titus-control-plane/pull/844", "merged": true, "mergeCommit": {"oid": "67cacd3c6958d4a5192624dcf023a23b49afee88"}, "closed": true, "closedAt": "2020-05-11T16:05:21Z", "author": {"login": "tbak"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfARIngH2gAyNDE0ODA5MjI2OjQ4NTFjYTQ0ZDJiMGYwZGVjMTU2MTYwMmU2YWFiZWNlNmExYWZjNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfEpRVAH2gAyNDE0ODA5MjI2OjQwNmU0M2EyNDc3ZDU0MWZmYzFhMzQ0YjM3Y2E2ZGY5YTViOTAyNmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4851ca44d2b0f0dec1561602e6aabece6a1afc46", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/4851ca44d2b0f0dec1561602e6aabece6a1afc46", "committedDate": "2020-05-07T16:56:27Z", "message": "Add a Kube backend constraint to restrict placement to nodes running a specific Kube backend version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3Njc0MTQ2", "url": "https://github.com/Netflix/titus-control-plane/pull/844#pullrequestreview-407674146", "createdAt": "2020-05-07T17:13:32Z", "commit": {"oid": "4851ca44d2b0f0dec1561602e6aabece6a1afc46"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNzoxMzozMlrOGSIRiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNzoxMzozMlrOGSIRiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY2MzExMg==", "bodyText": "javadoc is wrong", "url": "https://github.com/Netflix/titus-control-plane/pull/844#discussion_r421663112", "createdAt": "2020-05-07T17:13:32Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeConstants.java", "diffHunk": "@@ -83,18 +90,23 @@ private KubeConstants() {\n     /**\n      * Machine in a farzone have the farzone taint set with its name as a value.\n      */\n-    public static final String TAINT_FARZONE = TITUS_TAINT_DOMAIN + \"farzone\";\n+    public static final String TAINT_FARZONE = TITUS_NODE_DOMAIN + \"farzone\";\n \n     /**\n      * Machines with the taint value 'flex' belong to the flex tier. Machines with the taint 'critical' belong to\n      * the critical tiers.\n      */\n-    public static final String TAINT_TIER = TITUS_TAINT_DOMAIN + \"tier\";\n+    public static final String TAINT_TIER = TITUS_NODE_DOMAIN + \"tier\";\n+\n+    /**\n+     * Taint added to each GPU instance.\n+     */\n+    public static final String TAINT_GPU_INSTANCE = TITUS_NODE_DOMAIN + \"gpu\";\n \n     /**\n      * Taint added to each GPU instance.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4851ca44d2b0f0dec1561602e6aabece6a1afc46"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NzMxNjUx", "url": "https://github.com/Netflix/titus-control-plane/pull/844#pullrequestreview-407731651", "createdAt": "2020-05-07T18:31:30Z", "commit": {"oid": "4851ca44d2b0f0dec1561602e6aabece6a1afc46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NzI4Nzc5", "url": "https://github.com/Netflix/titus-control-plane/pull/844#pullrequestreview-407728779", "createdAt": "2020-05-07T18:27:30Z", "commit": {"oid": "4851ca44d2b0f0dec1561602e6aabece6a1afc46"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxODoyNzozMFrOGSK9tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxODozNjoyOFrOGSLSSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTcwNzE4OQ==", "bodyText": "nice catch! Can you please add test cases to KubeNotificationProcessorTest so we ensure no regressions going forward?", "url": "https://github.com/Netflix/titus-control-plane/pull/844#discussion_r421707189", "createdAt": "2020-05-07T18:27:30Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "diffHunk": "@@ -235,7 +235,7 @@ public void shutdown() {\n                     Task fixedTask = fillInMissingStates(pod, updatedTask);\n                     Task taskWithPlacementData = JobManagerUtil.attachPlacementData(fixedTask, executorDetailsOpt);\n                     Task taskWithNodeMetadata = node.map(n -> attachNodeMetadata(taskWithPlacementData, n)).orElse(taskWithPlacementData);\n-                    Task taskWithAnnotations = addMissingAttributes(pod, updatedTask);\n+                    Task taskWithAnnotations = addMissingAttributes(pod, taskWithNodeMetadata);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4851ca44d2b0f0dec1561602e6aabece6a1afc46"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTcxMjQ1Nw==", "bodyText": "I think we should stick with DNS naming conventions for annotations and labels, so all lowercase characters:\nhttps://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names\nhttps://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set\nI suggest .../job-id and .../task-id. See how machine-id and machine-group were chosen below, rather than machineId. Alternatively, it could also be .../jobid and .../taskid.", "url": "https://github.com/Netflix/titus-control-plane/pull/844#discussion_r421712457", "createdAt": "2020-05-07T18:36:28Z", "author": {"login": "fabiokung"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/mesos/kubeapiserver/KubeConstants.java", "diffHunk": "@@ -41,21 +41,33 @@ private KubeConstants() {\n \n     public static final String NODE_LABEL_INSTANCE_TYPE = \"beta.kubernetes.io/instance-type\";\n \n+    /**\n+     * Common prefix for Titus node annotations/labels and taints.\n+     */\n+    public static final String TITUS_NODE_DOMAIN = \"node.titus.netflix.com/\";\n+\n+    /**\n+     * Common prefix for Titus V3 job API specific annotations/labels.\n+     */\n+    public static final String TITUS_V3_JOB_DOMAIN = \"v3.job.titus.netflix.com/\";\n+\n     /*\n-     * Titus node labels.\n+     * Titus pod labels.\n      */\n \n-    public static final String NODE_LABEL_MACHINE_ID = \"titus/machine-id\";\n+    public static final String POD_LABEL_JOB_ID = TITUS_V3_JOB_DOMAIN + \"jobId\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4851ca44d2b0f0dec1561602e6aabece6a1afc46"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "406e43a2477d541ffc1a344b37ca6df9a5b9026e", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/406e43a2477d541ffc1a344b37ca6df9a5b9026e", "committedDate": "2020-05-07T22:02:26Z", "message": "Code review updates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 510, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}