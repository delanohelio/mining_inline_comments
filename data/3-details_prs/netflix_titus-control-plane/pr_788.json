{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5ODg5MzA3", "number": 788, "title": "Miscellaneous updates", "bodyText": "", "createdAt": "2020-02-25T23:53:29Z", "url": "https://github.com/Netflix/titus-control-plane/pull/788", "merged": true, "mergeCommit": {"oid": "df6fb541de929626cd2dec1e45f3deaa8cb36f50"}, "closed": true, "closedAt": "2020-02-26T17:36:12Z", "author": {"login": "tbak"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH7CWVgH2gAyMzc5ODg5MzA3OjkyODM4OGMxMTFhN2M1MGNjMDZlNzU4NjRiYzFkY2FhNDA5ZTFhZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIJ7CBAFqTM2NTA4NDQ5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "928388c111a7c50cc06e75864bc1dcaa409e1afd", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/928388c111a7c50cc06e75864bc1dcaa409e1afd", "committedDate": "2020-02-25T23:50:31Z", "message": "Miscellaneous updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTQxMzIw", "url": "https://github.com/Netflix/titus-control-plane/pull/788#pullrequestreview-364541320", "createdAt": "2020-02-26T00:10:17Z", "commit": {"oid": "928388c111a7c50cc06e75864bc1dcaa409e1afd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwMDoxMDoxN1rOFuZ81Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwMDoxMDoxN1rOFuZ81Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIwMzk4OQ==", "bodyText": "Failed phase can also have a deletion timestamp.", "url": "https://github.com/Netflix/titus-control-plane/pull/788#discussion_r384203989", "createdAt": "2020-02-26T00:10:17Z", "author": {"login": "corindwyer"}, "path": "titus-server-master/src/main/java/com/netflix/titus/master/jobmanager/service/KubeNotificationProcessor.java", "diffHunk": "@@ -193,11 +196,31 @@ public void shutdown() {\n         return ReactorExt.toMono(v3JobOperations.updateTask(\n                 task.getId(),\n                 currentTask -> {\n-                    TaskStatus newStatus = TaskStatus.newBuilder()\n-                            .withState(newTaskState)\n-                            .withReasonCode(TaskStatus.REASON_NORMAL)\n-                            .withReasonMessage(\"Kube pod notification\")\n-                            .build();\n+                    TaskStatus newStatus;\n+\n+                    if (newTaskState != TaskState.Finished) {\n+                        newStatus = TaskStatus.newBuilder()\n+                                .withState(newTaskState)\n+                                .withReasonCode(TaskStatus.REASON_NORMAL)\n+                                .withReasonMessage(\"Kube pod notification\")\n+                                .build();\n+                    } else {\n+                        TaskStatus.Builder newStatusBuilder = TaskStatus.newBuilder().withState(TaskState.Finished);\n+\n+                        if(\"failed\".equalsIgnoreCase(pod.getStatus().getPhase())) {\n+                            newStatusBuilder", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "928388c111a7c50cc06e75864bc1dcaa409e1afd"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTQzODUy", "url": "https://github.com/Netflix/titus-control-plane/pull/788#pullrequestreview-364543852", "createdAt": "2020-02-26T00:17:16Z", "commit": {"oid": "928388c111a7c50cc06e75864bc1dcaa409e1afd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwMDoxNzoxNlrOFuaH2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwMDoxNzoxNlrOFuaH2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIwNjgxMQ==", "bodyText": "minor: s/notSet/unknown", "url": "https://github.com/Netflix/titus-control-plane/pull/788#discussion_r384206811", "createdAt": "2020-02-26T00:17:16Z", "author": {"login": "fabiokung"}, "path": "titus-common/src/main/java/com/netflix/titus/common/util/loadshedding/SpectatorAdmissionController.java", "diffHunk": "@@ -42,18 +44,18 @@ public AdmissionControllerResponse apply(AdmissionControllerRequest request) {\n             AdmissionControllerResponse result = delegate.apply(request);\n \n             registry.counter(METRIC_NAME,\n-                    \"callerId\", request.getCallerId(),\n-                    \"endpointName\", request.getEndpointName(),\n+                    \"callerId\", getNonEmptyOrDefault(request.getCallerId(), \"notSet\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "928388c111a7c50cc06e75864bc1dcaa409e1afd"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "effc530416886a61d213c9969232bc238d735635", "author": {"user": {"login": "tbak", "name": null}}, "url": "https://github.com/Netflix/titus-control-plane/commit/effc530416886a61d213c9969232bc238d735635", "committedDate": "2020-02-26T17:01:27Z", "message": "Code review updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MDg0NDkx", "url": "https://github.com/Netflix/titus-control-plane/pull/788#pullrequestreview-365084491", "createdAt": "2020-02-26T17:11:06Z", "commit": {"oid": "effc530416886a61d213c9969232bc238d735635"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 639, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}