{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNzA5NTY4", "number": 766, "title": "[PARQUET-1808]: Replacing multiple String Object creations with StringBuilder", "bodyText": "Make sure you have checked all steps below.\nJira\n\n My PR addresses the following PARQUET-1808\n\nhttps://issues.apache.org/jira/browse/PARQUET-1808\n\n\n\nTests\n\n Test Covered with existing tests\n\nCommits\n\n My commits all reference Jira issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nDocumentation\n\n In case of new functionality, my PR adds documentation that describes how to use it.\n\nAll the public functions and the classes in the PR contain Javadoc that explain what it does", "createdAt": "2020-03-04T17:07:18Z", "url": "https://github.com/apache/parquet-mr/pull/766", "merged": true, "mergeCommit": {"oid": "ab65823ae0fd6c3afae94c7fa0670cf9b46b5b85"}, "closed": true, "closedAt": "2020-03-09T11:52:40Z", "author": {"login": "koiralo"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKaCWAgH2gAyMzgzNzA5NTY4OjBiM2E5NWMxY2VhMTBkMzU1MGMzNDk2NTYwM2ZjNzVlYzViYzk5ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL8iuegFqTM3MTEwMDc5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0b3a95c1cea10d3550c34965603fc75ec5bc9989", "author": {"user": {"login": "snkrkoirala", "name": "Shankar Koirala"}}, "url": "https://github.com/apache/parquet-mr/commit/0b3a95c1cea10d3550c34965603fc75ec5bc9989", "committedDate": "2020-03-04T17:05:25Z", "message": "[PARQUET-1808]: Replacing multiple String Object creations with StringBuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDAzNTg1", "url": "https://github.com/apache/parquet-mr/pull/766#pullrequestreview-369403585", "createdAt": "2020-03-05T09:18:12Z", "commit": {"oid": "0b3a95c1cea10d3550c34965603fc75ec5bc9989"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxODoxM1rOFyLthA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToyNjo1M1rOFyMAgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2NDk5Ng==", "bodyText": "nit: Appending a char instead of a string with one char would perform a little bit better\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          result.append(\"\\n\");\n          \n          \n            \n                          result.append('\\n');", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r388164996", "createdAt": "2020-03-05T09:18:13Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java", "diffHunk": "@@ -48,28 +48,30 @@ public String toString() {\n   }\n \n   public String toString(String indent) {\n-    String result = \"\";\n+    StringBuilder result = new StringBuilder();\n     int i = 0;\n     for (Type field : schema.getFields()) {\n       String name = field.getName();\n       List<Object> values = data[i];\n       ++i;\n-      if (values != null) {\n-        if (values.size() > 0) {\n+      if (values != null && !values.isEmpty()) {\n           for (Object value : values) {\n-            result += indent + name;\n+            result.append(indent);\n+            result.append(name);\n             if (value == null) {\n-              result += \": NULL\\n\";\n+              result.append(\": NULL\\n\");\n             } else if (value instanceof Group) {\n-              result += \"\\n\" + ((SimpleGroup)value).toString(indent+\"  \");\n+              result.append(\"\\n\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b3a95c1cea10d3550c34965603fc75ec5bc9989"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2NjI0Ng==", "bodyText": "As we are doing this change because of performance reasons I would create a private method in SimpleGroup that gets the StringBuilder object is it can append all the stuff into the same builder.", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r388166246", "createdAt": "2020-03-05T09:20:34Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java", "diffHunk": "@@ -48,28 +48,30 @@ public String toString() {\n   }\n \n   public String toString(String indent) {\n-    String result = \"\";\n+    StringBuilder result = new StringBuilder();\n     int i = 0;\n     for (Type field : schema.getFields()) {\n       String name = field.getName();\n       List<Object> values = data[i];\n       ++i;\n-      if (values != null) {\n-        if (values.size() > 0) {\n+      if (values != null && !values.isEmpty()) {\n           for (Object value : values) {\n-            result += indent + name;\n+            result.append(indent);\n+            result.append(name);\n             if (value == null) {\n-              result += \": NULL\\n\";\n+              result.append(\": NULL\\n\");\n             } else if (value instanceof Group) {\n-              result += \"\\n\" + ((SimpleGroup)value).toString(indent+\"  \");\n+              result.append(\"\\n\");\n+              result.append(((SimpleGroup)value).toString(indent+\"  \"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b3a95c1cea10d3550c34965603fc75ec5bc9989"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2ODY5OA==", "bodyText": "You may create the builder with an exact capacity so it does not need to grow during appending values.\nAlso, you may count in the message itself and appending it instead of concatenating the indent to the message separately.", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r388168698", "createdAt": "2020-03-05T09:24:56Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/main/java/org/apache/parquet/io/MessageColumnIO.java", "diffHunk": "@@ -276,11 +276,11 @@ private void printState() {\n \n     private void log(Object message, Object...parameters) {\n       if (DEBUG) {\n-        String indent = \"\";\n+        StringBuilder indent = new StringBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b3a95c1cea10d3550c34965603fc75ec5bc9989"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2OTg1Ng==", "bodyText": "nit: you may keep the chain pattern as append returns the builder object.\nDo not have a strong opinion on the current or the chained version.", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r388169856", "createdAt": "2020-03-05T09:26:53Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/test/java/org/apache/parquet/io/ExpectationValidatingConverter.java", "diffHunk": "@@ -151,14 +151,16 @@ public Void getCurrentRecord() {\n   }\n \n   private String path(List<GroupType> path, Type type) {\n-    String pathString = \"\";\n+    StringBuilder pathString = new StringBuilder();\n     if (path.size() > 0) {\n       for (int i = 1; i < path.size(); i++) {\n-        pathString += path.get(i).getName() + \".\";\n+        pathString.append(path.get(i).getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b3a95c1cea10d3550c34965603fc75ec5bc9989"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "593e82321b9522d344ebbe42201d1d9fe7007990", "author": {"user": {"login": "snkrkoirala", "name": "Shankar Koirala"}}, "url": "https://github.com/apache/parquet-mr/commit/593e82321b9522d344ebbe42201d1d9fe7007990", "committedDate": "2020-03-06T08:53:28Z", "message": "[PARQUET-1808]: changes for the review."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3dce3e8e60d73067d2e9bf66bd45111229e185a", "author": {"user": {"login": "snkrkoirala", "name": "Shankar Koirala"}}, "url": "https://github.com/apache/parquet-mr/commit/e3dce3e8e60d73067d2e9bf66bd45111229e185a", "committedDate": "2020-03-06T10:17:00Z", "message": "[PARQUET-1808]: Updating toString method signature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjUzMjEw", "url": "https://github.com/apache/parquet-mr/pull/766#pullrequestreview-370253210", "createdAt": "2020-03-06T11:22:00Z", "commit": {"oid": "e3dce3e8e60d73067d2e9bf66bd45111229e185a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToyMjowMFrOFy1gog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxMToyMjowMFrOFy1gog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODg0OTgyNg==", "bodyText": "We shall not modify existing public methods as they are breaking changes. That's why I've mentioned creating a new private method that would be invoked by the existing ones.\nLet me put an example about the idea I wanted to describe:\npublic String toString(String indent) {\n  StringBuilder builder = new StringBuilder();\n  appendToString(builder, indent);\n  return builder.toString();\n}\n\nprivate void appendToString(StringBuilder builder, String indent) {\n  // ...\n        builder.append(indent).append(name);\n        if (value == null) {\n          builder.append(\": NULL\\N\");\n        } else if (value instanceof Group) {\n          builder.append('\\n');\n          ((SimpleGroup) value).appendToString(builder, indent + \"  \");\n        } else {\n          builder.append(\": \").append(value).append('\\n');\n  // ...\n}", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r388849826", "createdAt": "2020-03-06T11:22:00Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java", "diffHunk": "@@ -44,10 +44,10 @@ public SimpleGroup(GroupType schema) {\n \n   @Override\n   public String toString() {\n-    return toString(\"\");\n+    return toString(new StringBuilder()).toString();\n   }\n \n-  public String toString(String indent) {\n+  public StringBuilder toString(StringBuilder indent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3dce3e8e60d73067d2e9bf66bd45111229e185a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a47b46c0cd5cc7e4dd37ee1bbe6f93d3e9f40d", "author": {"user": {"login": "snkrkoirala", "name": "Shankar Koirala"}}, "url": "https://github.com/apache/parquet-mr/commit/64a47b46c0cd5cc7e4dd37ee1bbe6f93d3e9f40d", "committedDate": "2020-03-06T13:57:13Z", "message": "[PARQUET-1808]: Updating toString method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMDI0NDgw", "url": "https://github.com/apache/parquet-mr/pull/766#pullrequestreview-371024480", "createdAt": "2020-03-09T09:42:09Z", "commit": {"oid": "64a47b46c0cd5cc7e4dd37ee1bbe6f93d3e9f40d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwOTo0MjoxMFrOFzgSqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwOTo0Njo1MlrOFzgcFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU1MDc2Mg==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private StringBuilder appendToString(StringBuilder builder, String indent){\n          \n          \n            \n            \n          \n          \n            \n              private StringBuilder appendToString(StringBuilder builder, String indent) {", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r389550762", "createdAt": "2020-03-09T09:42:10Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java", "diffHunk": "@@ -44,30 +44,34 @@ public SimpleGroup(GroupType schema) {\n \n   @Override\n   public String toString() {\n-    return toString(new StringBuilder()).toString();\n+    return toString(\"\");\n   }\n-\n-  public StringBuilder toString(StringBuilder indent) {\n-    StringBuilder result = new StringBuilder();\n+  private StringBuilder appendToString(StringBuilder builder, String indent){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64a47b46c0cd5cc7e4dd37ee1bbe6f93d3e9f40d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU1Mjg5MA==", "bodyText": "This is not correct this way. You are appending the builder to itself which would result mixed up output.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        builder.append(\"\\n\").append(((SimpleGroup)value).appendToString(builder,indent+\"  \"));\n          \n          \n            \n                        builder.append('\\n');\n          \n          \n            \n                        ((SimpleGroup) value).appendToString(builder, indent + \"  \");", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r389552890", "createdAt": "2020-03-09T09:46:22Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java", "diffHunk": "@@ -44,30 +44,34 @@ public SimpleGroup(GroupType schema) {\n \n   @Override\n   public String toString() {\n-    return toString(new StringBuilder()).toString();\n+    return toString(\"\");\n   }\n-\n-  public StringBuilder toString(StringBuilder indent) {\n-    StringBuilder result = new StringBuilder();\n+  private StringBuilder appendToString(StringBuilder builder, String indent){\n     int i = 0;\n     for (Type field : schema.getFields()) {\n       String name = field.getName();\n       List<Object> values = data[i];\n       ++i;\n       if (values != null && !values.isEmpty()) {\n-          for (Object value : values) {\n-            result.append(indent).append(name);\n-            if (value == null) {\n-              result.append(\": NULL\\n\");\n-            } else if (value instanceof Group) {\n-              result.append(\"\\n\").append(((SimpleGroup)value).toString(indent.append(\"  \")));\n-            } else {\n-              result.append(\": \" ).append(value.toString()).append(\"\\n\");\n-            }\n+        for (Object value : values) {\n+          builder.append(indent).append(name);\n+          if (value == null) {\n+            builder.append(\": NULL\\n\");\n+          } else if (value instanceof Group) {\n+            builder.append(\"\\n\").append(((SimpleGroup)value).appendToString(builder,indent+\"  \"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64a47b46c0cd5cc7e4dd37ee1bbe6f93d3e9f40d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU1MzE3NA==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        builder.append(\": \" ).append(value.toString()).append(\"\\n\");\n          \n          \n            \n                        builder.append(\": \").append(value.toString()).append('\\n');", "url": "https://github.com/apache/parquet-mr/pull/766#discussion_r389553174", "createdAt": "2020-03-09T09:46:52Z", "author": {"login": "gszadovszky"}, "path": "parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java", "diffHunk": "@@ -44,30 +44,34 @@ public SimpleGroup(GroupType schema) {\n \n   @Override\n   public String toString() {\n-    return toString(new StringBuilder()).toString();\n+    return toString(\"\");\n   }\n-\n-  public StringBuilder toString(StringBuilder indent) {\n-    StringBuilder result = new StringBuilder();\n+  private StringBuilder appendToString(StringBuilder builder, String indent){\n     int i = 0;\n     for (Type field : schema.getFields()) {\n       String name = field.getName();\n       List<Object> values = data[i];\n       ++i;\n       if (values != null && !values.isEmpty()) {\n-          for (Object value : values) {\n-            result.append(indent).append(name);\n-            if (value == null) {\n-              result.append(\": NULL\\n\");\n-            } else if (value instanceof Group) {\n-              result.append(\"\\n\").append(((SimpleGroup)value).toString(indent.append(\"  \")));\n-            } else {\n-              result.append(\": \" ).append(value.toString()).append(\"\\n\");\n-            }\n+        for (Object value : values) {\n+          builder.append(indent).append(name);\n+          if (value == null) {\n+            builder.append(\": NULL\\n\");\n+          } else if (value instanceof Group) {\n+            builder.append(\"\\n\").append(((SimpleGroup)value).appendToString(builder,indent+\"  \"));\n+          } else {\n+            builder.append(\": \" ).append(value.toString()).append(\"\\n\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64a47b46c0cd5cc7e4dd37ee1bbe6f93d3e9f40d"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73324c79333a0a1454d75c18c628eeeec84e542a", "author": {"user": {"login": "koiralo", "name": "Shankar Koirala"}}, "url": "https://github.com/apache/parquet-mr/commit/73324c79333a0a1454d75c18c628eeeec84e542a", "committedDate": "2020-03-09T10:17:56Z", "message": "Update parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java\r\n\r\nFixed space.\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b93a1de4085e285e854b8724f921786707b407e", "author": {"user": {"login": "koiralo", "name": "Shankar Koirala"}}, "url": "https://github.com/apache/parquet-mr/commit/5b93a1de4085e285e854b8724f921786707b407e", "committedDate": "2020-03-09T10:19:28Z", "message": "Update parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java\r\n\r\nFixed space.\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf1db626b9f9377f649854cfae043a3b254c87fd", "author": {"user": {"login": "koiralo", "name": "Shankar Koirala"}}, "url": "https://github.com/apache/parquet-mr/commit/bf1db626b9f9377f649854cfae043a3b254c87fd", "committedDate": "2020-03-09T10:20:09Z", "message": "Update parquet-column/src/main/java/org/apache/parquet/example/data/simple/SimpleGroup.java\r\n\r\nFixed bulider.\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTAwNzk1", "url": "https://github.com/apache/parquet-mr/pull/766#pullrequestreview-371100795", "createdAt": "2020-03-09T11:51:29Z", "commit": {"oid": "bf1db626b9f9377f649854cfae043a3b254c87fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2174, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}