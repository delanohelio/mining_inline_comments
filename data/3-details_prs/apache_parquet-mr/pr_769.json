{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MzEzNzU1", "number": 769, "title": "PARQUET-1817: Crypto Properties Factory", "bodyText": "Make sure you have checked all steps below.\nJira\n\n My PR addresses the following Parquet Jira issues and references them in the PR title. For example, \"PARQUET-1234: My Parquet PR\"\n\nhttps://issues.apache.org/jira/browse/PARQUET-XXX\nIn case you are adding a dependency, check if the license complies with the ASF 3rd Party License Policy.\n\n\n\nTests\n\n My PR adds the following unit tests OR does not need testing for this extremely good reason:\n\nCommits\n\n My commits all reference Jira issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nDocumentation\n\n In case of new functionality, my PR adds documentation that describes how to use it.\n\nAll the public functions and the classes in the PR contain Javadoc that explain what it does", "createdAt": "2020-03-16T15:26:56Z", "url": "https://github.com/apache/parquet-mr/pull/769", "merged": true, "mergeCommit": {"oid": "bd876bd0bac7490c630c10d3afc3338cfe0c2921"}, "closed": true, "closedAt": "2020-03-30T08:57:49Z", "author": {"login": "shangxinli"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOQSjVAH2gAyMzg5MzEzNzU1OjcxODVhYmEyNDA3YmQ2ODdmMTdjNTVjOGQ1NDRhNTlhOThiMmVjNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSqoZDgFqTM4MzY1MzkxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7185aba2407bd687f17c55c8d544a59a98b2ec6a", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/7185aba2407bd687f17c55c8d544a59a98b2ec6a", "committedDate": "2020-03-16T15:59:46Z", "message": "PARQUET-1817: Crypto Properties Factory"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0760281f02bb6f2e85033ded7160d012a4226660", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/0760281f02bb6f2e85033ded7160d012a4226660", "committedDate": "2020-03-16T15:59:23Z", "message": "Address feedback"}, "afterCommit": {"oid": "7185aba2407bd687f17c55c8d544a59a98b2ec6a", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/7185aba2407bd687f17c55c8d544a59a98b2ec6a", "committedDate": "2020-03-16T15:59:46Z", "message": "PARQUET-1817: Crypto Properties Factory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85ae2031a016d918a0b6742837e7929d7fdd87c1", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/85ae2031a016d918a0b6742837e7929d7fdd87c1", "committedDate": "2020-03-18T13:12:56Z", "message": "Fix build error: 'unapproved licenses'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NDk0NzA3", "url": "https://github.com/apache/parquet-mr/pull/769#pullrequestreview-379494707", "createdAt": "2020-03-23T14:41:38Z", "commit": {"oid": "85ae2031a016d918a0b6742837e7929d7fdd87c1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo0MTozOFrOF6Ii4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo1NDoyMlrOF6JJpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwMTczMA==", "bodyText": "As this class does not have any implemented methods I would suggest having an interface instead of an abstract class.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r396501730", "createdAt": "2020-03-23T14:41:38Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.api.WriteSupport.WriteContext;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+import static org.apache.parquet.Preconditions.checkNotNull;\n+\n+public abstract class CryptoPropertiesFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ae2031a016d918a0b6742837e7929d7fdd87c1"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwMzU4OQ==", "bodyText": "Why do we need to handle the null case this way? Is it a normal scenario that conf is null?", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r396503589", "createdAt": "2020-03-23T14:44:05Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.api.WriteSupport.WriteContext;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+import static org.apache.parquet.Preconditions.checkNotNull;\n+\n+public abstract class CryptoPropertiesFactory {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(CryptoPropertiesFactory.class);\n+  public static final String CRYPTO_FACTORY_CLASS_PROPERTY_NAME = \"parquet.encryption.factory.class\";\n+\n+  public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOException {\n+    if (null == conf) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ae2031a016d918a0b6742837e7929d7fdd87c1"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxMTY1NQ==", "bodyText": "Why do we need another Hadoop conf after we've had one at initialize?\nWhat is tempFilePath?\nCould you please document the arguments and their purpose?", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r396511655", "createdAt": "2020-03-23T14:54:22Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.api.WriteSupport.WriteContext;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+import static org.apache.parquet.Preconditions.checkNotNull;\n+\n+public abstract class CryptoPropertiesFactory {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(CryptoPropertiesFactory.class);\n+  public static final String CRYPTO_FACTORY_CLASS_PROPERTY_NAME = \"parquet.encryption.factory.class\";\n+\n+  public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOException {\n+    if (null == conf) {\n+      LOG.debug(\"CryptoPropertiesFactory is not configured - null hadoop config\");\n+      return null;\n+    }\n+\n+    final Class<?> cryptoPropertiesFactoryClass = ConfigurationUtil.getClassFromConfig(conf,\n+      CRYPTO_FACTORY_CLASS_PROPERTY_NAME, CryptoPropertiesFactory.class);\n+\n+    if (null == cryptoPropertiesFactoryClass) {\n+      LOG.debug(\"CryptoPropertiesFactory is not configured - name not found in hadoop config\");\n+      return null;\n+    }\n+\n+    try {\n+      CryptoPropertiesFactory cryptoFactory = (CryptoPropertiesFactory)cryptoPropertiesFactoryClass.newInstance();\n+      cryptoFactory.initialize(conf);\n+      return cryptoFactory;\n+    } catch (InstantiationException | IllegalAccessException e) {\n+      throw new BadConfigurationException(\"could not instantiate CryptoPropertiesFactory class: \"\n+        + cryptoPropertiesFactoryClass, e);\n+    }\n+  }\n+\n+  public abstract void initialize(Configuration hadoopConfig);\n+\n+  public abstract FileEncryptionProperties getFileEncryptionProperties(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ae2031a016d918a0b6742837e7929d7fdd87c1"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86ac333338813b49d61d86ae125bdcc20bbccc18", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/86ac333338813b49d61d86ae125bdcc20bbccc18", "committedDate": "2020-03-23T23:52:22Z", "message": "Address feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5OTEyMTM5", "url": "https://github.com/apache/parquet-mr/pull/769#pullrequestreview-379912139", "createdAt": "2020-03-23T23:54:53Z", "commit": {"oid": "86ac333338813b49d61d86ae125bdcc20bbccc18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMzo1NDo1M1rOF6cd7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMzo1NDo1M1rOF6cd7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgyODE0MA==", "bodyText": "@ggershinsky, can you make comments about what to be used by this field? Our implementation doesn't need it so far.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r396828140", "createdAt": "2020-03-23T23:54:53Z", "author": {"login": "shangxinli"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -51,20 +54,32 @@ public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOE\n \n     try {\n       CryptoPropertiesFactory cryptoFactory = (CryptoPropertiesFactory)cryptoPropertiesFactoryClass.newInstance();\n-      cryptoFactory.initialize(conf);\n       return cryptoFactory;\n     } catch (InstantiationException | IllegalAccessException e) {\n       throw new BadConfigurationException(\"could not instantiate CryptoPropertiesFactory class: \"\n         + cryptoPropertiesFactoryClass, e);\n     }\n   }\n \n-  public abstract void initialize(Configuration hadoopConfig);\n-\n-  public abstract FileEncryptionProperties getFileEncryptionProperties(\n-    Configuration fileHadoopConfig, Path tempFilePath,\n-    WriteContext fileWriteContext)  throws IOException;\n+  /**\n+   * Get FileEncryptionProperties object which is created by the implementation of this interface. Please see\n+   * the unit test (TBD) for example\n+   *\n+   * @param fileHadoopConfig Configuration that is used to pass the needed information, e.g. KMS uri\n+   * @param tempFilePath File path of the parquet file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86ac333338813b49d61d86ae125bdcc20bbccc18"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMzQ2Mzkx", "url": "https://github.com/apache/parquet-mr/pull/769#pullrequestreview-380346391", "createdAt": "2020-03-24T14:10:57Z", "commit": {"oid": "86ac333338813b49d61d86ae125bdcc20bbccc18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDoxMDo1OFrOF6yC4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDoxMDo1OFrOF6yC4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE4MTY2NQ==", "bodyText": "this import is not needed", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397181665", "createdAt": "2020-03-24T14:10:58Z", "author": {"login": "ggershinsky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.api.WriteSupport.WriteContext;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+import static org.apache.parquet.Preconditions.checkNotNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86ac333338813b49d61d86ae125bdcc20bbccc18"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/69b192015c818f2f967fa37fc3ddf459903f09a0", "committedDate": "2020-03-24T14:40:48Z", "message": "Address feedback from Gidon"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTY4ODQ2", "url": "https://github.com/apache/parquet-mr/pull/769#pullrequestreview-380968846", "createdAt": "2020-03-25T09:15:17Z", "commit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOToxNToxOFrOF7R8_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOTo0NzowMFrOF7TK0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcwNDQ0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * 2. Set configuration of \"parquet.encryption.factory.class\" with the full namespace of this class.\n          \n          \n            \n             * 2. Set configuration of \"parquet.encryption.factory.class\" with the fully qualified name of this class.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397704447", "createdAt": "2020-03-25T09:15:18Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -28,19 +28,39 @@\n \n import java.io.IOException;\n \n-import static org.apache.parquet.Preconditions.checkNotNull;\n-\n-public abstract class CryptoPropertiesFactory {\n-\n-  private static final Logger LOG = LoggerFactory.getLogger(CryptoPropertiesFactory.class);\n-  public static final String CRYPTO_FACTORY_CLASS_PROPERTY_NAME = \"parquet.encryption.factory.class\";\n+/**\n+ * CryptoPropertiesFactory interface enables transparent activation of Parquet encryption.\n+ *\n+ * It's customized implementations produce encryption and decryption properties for each Parquet file, using the information\n+ * available in Parquet file writers and readers: file path, file extended schema (in writers only) - and also Hadoop\n+ * configuration properties that can pass custom parameters required by a crypto factory. A factory implementation can\n+ * use or ignore any of these parameters.\n+ *\n+ * The example could be as below.\n+ *\n+ * 1. Write a class to implement CryptoPropertiesFactory.\n+ * 2. Set configuration of \"parquet.encryption.factory.class\" with the full namespace of this class.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcwNjkwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             *    This class will be invoked when the static method loadFactory() is called.\n          \n          \n            \n             *    The implementation of this interface will be instantiated by {@link #loadFactory(Configuration)}.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397706906", "createdAt": "2020-03-25T09:19:17Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -28,19 +28,39 @@\n \n import java.io.IOException;\n \n-import static org.apache.parquet.Preconditions.checkNotNull;\n-\n-public abstract class CryptoPropertiesFactory {\n-\n-  private static final Logger LOG = LoggerFactory.getLogger(CryptoPropertiesFactory.class);\n-  public static final String CRYPTO_FACTORY_CLASS_PROPERTY_NAME = \"parquet.encryption.factory.class\";\n+/**\n+ * CryptoPropertiesFactory interface enables transparent activation of Parquet encryption.\n+ *\n+ * It's customized implementations produce encryption and decryption properties for each Parquet file, using the information\n+ * available in Parquet file writers and readers: file path, file extended schema (in writers only) - and also Hadoop\n+ * configuration properties that can pass custom parameters required by a crypto factory. A factory implementation can\n+ * use or ignore any of these parameters.\n+ *\n+ * The example could be as below.\n+ *\n+ * 1. Write a class to implement CryptoPropertiesFactory.\n+ * 2. Set configuration of \"parquet.encryption.factory.class\" with the full namespace of this class.\n+ *    For example, we can set the configuration in SparkSession as below.\n+ *       SparkSession spark = SparkSession\n+ *                   .config(\"parquet.encryption.factory.class\",\n+ *                    \"xxx.xxx.CryptoPropertiesImpl\")\n+ *\n+ *    This class will be invoked when the static method loadFactory() is called.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxODkyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @return return object with class CryptoPropertiesFactory if user specified the class path and invoking of\n          \n          \n            \n               * the class succeeds, null if user doesn't specify the class path. RunTimeException with type BadConfigurationException\n          \n          \n            \n               * will be thrown if invoking the configured class fails\n          \n          \n            \n               * @return object with class CryptoPropertiesFactory if user specified the class path and invoking of\n          \n          \n            \n               * the class succeeds, null if user doesn't specify the class path\n          \n          \n            \n               * @throws BadConfigurationException if the instantiation of the configured class fails", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397718921", "createdAt": "2020-03-25T09:38:39Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -28,19 +28,39 @@\n \n import java.io.IOException;\n \n-import static org.apache.parquet.Preconditions.checkNotNull;\n-\n-public abstract class CryptoPropertiesFactory {\n-\n-  private static final Logger LOG = LoggerFactory.getLogger(CryptoPropertiesFactory.class);\n-  public static final String CRYPTO_FACTORY_CLASS_PROPERTY_NAME = \"parquet.encryption.factory.class\";\n+/**\n+ * CryptoPropertiesFactory interface enables transparent activation of Parquet encryption.\n+ *\n+ * It's customized implementations produce encryption and decryption properties for each Parquet file, using the information\n+ * available in Parquet file writers and readers: file path, file extended schema (in writers only) - and also Hadoop\n+ * configuration properties that can pass custom parameters required by a crypto factory. A factory implementation can\n+ * use or ignore any of these parameters.\n+ *\n+ * The example could be as below.\n+ *\n+ * 1. Write a class to implement CryptoPropertiesFactory.\n+ * 2. Set configuration of \"parquet.encryption.factory.class\" with the full namespace of this class.\n+ *    For example, we can set the configuration in SparkSession as below.\n+ *       SparkSession spark = SparkSession\n+ *                   .config(\"parquet.encryption.factory.class\",\n+ *                    \"xxx.xxx.CryptoPropertiesImpl\")\n+ *\n+ *    This class will be invoked when the static method loadFactory() is called.\n+ */\n+public interface CryptoPropertiesFactory {\n \n-  public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOException {\n-    if (null == conf) {\n-      LOG.debug(\"CryptoPropertiesFactory is not configured - null hadoop config\");\n-      return null;\n-    }\n+  Logger LOG = LoggerFactory.getLogger(CryptoPropertiesFactory.class);\n+  String CRYPTO_FACTORY_CLASS_PROPERTY_NAME = \"parquet.encryption.factory.class\";\n \n+  /**\n+   * Load CryptoPropertiesFactory class specified by CRYPTO_FACTORY_CLASS_PROPERTY_NAME as the path in the configuration\n+   *\n+   * @param conf Configuration where user specifies the class path\n+   * @return return object with class CryptoPropertiesFactory if user specified the class path and invoking of\n+   * the class succeeds, null if user doesn't specify the class path. RunTimeException with type BadConfigurationException\n+   * will be thrown if invoking the configured class fails", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcyMjE4NA==", "bodyText": "javadoc generation does not like having these tags empty. Please write something to them as well.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397722184", "createdAt": "2020-03-25T09:43:38Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -51,20 +71,36 @@ public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOE\n \n     try {\n       CryptoPropertiesFactory cryptoFactory = (CryptoPropertiesFactory)cryptoPropertiesFactoryClass.newInstance();\n-      cryptoFactory.initialize(conf);\n       return cryptoFactory;\n     } catch (InstantiationException | IllegalAccessException e) {\n       throw new BadConfigurationException(\"could not instantiate CryptoPropertiesFactory class: \"\n         + cryptoPropertiesFactoryClass, e);\n     }\n   }\n \n-  public abstract void initialize(Configuration hadoopConfig);\n-\n-  public abstract FileEncryptionProperties getFileEncryptionProperties(\n-    Configuration fileHadoopConfig, Path tempFilePath,\n-    WriteContext fileWriteContext)  throws IOException;\n+  /**\n+   * Get FileEncryptionProperties object which is created by the implementation of this interface. Please see\n+   * the unit test (TBD) for example\n+   *\n+   * @param fileHadoopConfig Configuration that is used to pass the needed information, e.g. KMS uri\n+   * @param tempFilePath File path of the parquet file being written.\n+   *                     Can be used for AAD prefix creation, key material management, etc.\n+   *                     Implementations must not presume the path is permanent,\n+   *                     as the file can be moved or renamed later\n+   * @param fileWriteContext WriteContext to provide information like schema to build the FileEncryptionProperties\n+   * @return\n+   * @throws IOException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcyMzM4Mg==", "bodyText": "Why do we think that an IOException might occur? Would a file read/write suppose to happen in an implementation?", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397723382", "createdAt": "2020-03-25T09:45:28Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -51,20 +71,36 @@ public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOE\n \n     try {\n       CryptoPropertiesFactory cryptoFactory = (CryptoPropertiesFactory)cryptoPropertiesFactoryClass.newInstance();\n-      cryptoFactory.initialize(conf);\n       return cryptoFactory;\n     } catch (InstantiationException | IllegalAccessException e) {\n       throw new BadConfigurationException(\"could not instantiate CryptoPropertiesFactory class: \"\n         + cryptoPropertiesFactoryClass, e);\n     }\n   }\n \n-  public abstract void initialize(Configuration hadoopConfig);\n-\n-  public abstract FileEncryptionProperties getFileEncryptionProperties(\n-    Configuration fileHadoopConfig, Path tempFilePath,\n-    WriteContext fileWriteContext)  throws IOException;\n+  /**\n+   * Get FileEncryptionProperties object which is created by the implementation of this interface. Please see\n+   * the unit test (TBD) for example\n+   *\n+   * @param fileHadoopConfig Configuration that is used to pass the needed information, e.g. KMS uri\n+   * @param tempFilePath File path of the parquet file being written.\n+   *                     Can be used for AAD prefix creation, key material management, etc.\n+   *                     Implementations must not presume the path is permanent,\n+   *                     as the file can be moved or renamed later\n+   * @param fileWriteContext WriteContext to provide information like schema to build the FileEncryptionProperties\n+   * @return\n+   * @throws IOException\n+   */\n+  FileEncryptionProperties getFileEncryptionProperties(Configuration fileHadoopConfig, Path tempFilePath,\n+                                                       WriteContext fileWriteContext)  throws IOException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcyMzg5OA==", "bodyText": "Missing main description, empty return and throws tags.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397723898", "createdAt": "2020-03-25T09:46:20Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -51,20 +71,36 @@ public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOE\n \n     try {\n       CryptoPropertiesFactory cryptoFactory = (CryptoPropertiesFactory)cryptoPropertiesFactoryClass.newInstance();\n-      cryptoFactory.initialize(conf);\n       return cryptoFactory;\n     } catch (InstantiationException | IllegalAccessException e) {\n       throw new BadConfigurationException(\"could not instantiate CryptoPropertiesFactory class: \"\n         + cryptoPropertiesFactoryClass, e);\n     }\n   }\n \n-  public abstract void initialize(Configuration hadoopConfig);\n-\n-  public abstract FileEncryptionProperties getFileEncryptionProperties(\n-    Configuration fileHadoopConfig, Path tempFilePath,\n-    WriteContext fileWriteContext)  throws IOException;\n+  /**\n+   * Get FileEncryptionProperties object which is created by the implementation of this interface. Please see\n+   * the unit test (TBD) for example\n+   *\n+   * @param fileHadoopConfig Configuration that is used to pass the needed information, e.g. KMS uri\n+   * @param tempFilePath File path of the parquet file being written.\n+   *                     Can be used for AAD prefix creation, key material management, etc.\n+   *                     Implementations must not presume the path is permanent,\n+   *                     as the file can be moved or renamed later\n+   * @param fileWriteContext WriteContext to provide information like schema to build the FileEncryptionProperties\n+   * @return\n+   * @throws IOException\n+   */\n+  FileEncryptionProperties getFileEncryptionProperties(Configuration fileHadoopConfig, Path tempFilePath,\n+                                                       WriteContext fileWriteContext)  throws IOException;\n \n-  public abstract FileDecryptionProperties getFileDecryptionProperties(\n-    Configuration hadoopConfig, Path filePath)  throws IOException;\n+  /**\n+   *\n+   * @param hadoopConfig Configuration that is used to pass the needed information, e.g. KMS uri\n+   * @param filePath File path of the parquet file\n+   *                 Can be used for AAD prefix verification, part of key metadata etc\n+   * @return\n+   * @throws IOException\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcyNDM3MQ==", "bodyText": "See my concerns about IOException above.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397724371", "createdAt": "2020-03-25T09:47:00Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -51,20 +71,36 @@ public static CryptoPropertiesFactory loadFactory(Configuration conf) throws IOE\n \n     try {\n       CryptoPropertiesFactory cryptoFactory = (CryptoPropertiesFactory)cryptoPropertiesFactoryClass.newInstance();\n-      cryptoFactory.initialize(conf);\n       return cryptoFactory;\n     } catch (InstantiationException | IllegalAccessException e) {\n       throw new BadConfigurationException(\"could not instantiate CryptoPropertiesFactory class: \"\n         + cryptoPropertiesFactoryClass, e);\n     }\n   }\n \n-  public abstract void initialize(Configuration hadoopConfig);\n-\n-  public abstract FileEncryptionProperties getFileEncryptionProperties(\n-    Configuration fileHadoopConfig, Path tempFilePath,\n-    WriteContext fileWriteContext)  throws IOException;\n+  /**\n+   * Get FileEncryptionProperties object which is created by the implementation of this interface. Please see\n+   * the unit test (TBD) for example\n+   *\n+   * @param fileHadoopConfig Configuration that is used to pass the needed information, e.g. KMS uri\n+   * @param tempFilePath File path of the parquet file being written.\n+   *                     Can be used for AAD prefix creation, key material management, etc.\n+   *                     Implementations must not presume the path is permanent,\n+   *                     as the file can be moved or renamed later\n+   * @param fileWriteContext WriteContext to provide information like schema to build the FileEncryptionProperties\n+   * @return\n+   * @throws IOException\n+   */\n+  FileEncryptionProperties getFileEncryptionProperties(Configuration fileHadoopConfig, Path tempFilePath,\n+                                                       WriteContext fileWriteContext)  throws IOException;\n \n-  public abstract FileDecryptionProperties getFileDecryptionProperties(\n-    Configuration hadoopConfig, Path filePath)  throws IOException;\n+  /**\n+   *\n+   * @param hadoopConfig Configuration that is used to pass the needed information, e.g. KMS uri\n+   * @param filePath File path of the parquet file\n+   *                 Can be used for AAD prefix verification, part of key metadata etc\n+   * @return\n+   * @throws IOException\n+   */\n+  FileDecryptionProperties getFileDecryptionProperties(Configuration hadoopConfig, Path filePath)  throws IOException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 94}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTQ3NDMx", "url": "https://github.com/apache/parquet-mr/pull/769#pullrequestreview-381147431", "createdAt": "2020-03-25T13:31:13Z", "commit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzozMToxM1rOF7bF9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzozMTo1MFrOF7bHqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg1NDE5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * It's customized implementations produce encryption and decryption properties for each Parquet file, using the information\n          \n          \n            \n             * It's customized implementations produce encryption and decryption properties for each Parquet file, using the input information", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397854198", "createdAt": "2020-03-25T13:31:13Z", "author": {"login": "ggershinsky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.api.WriteSupport.WriteContext;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+/**\n+ * CryptoPropertiesFactory interface enables transparent activation of Parquet encryption.\n+ *\n+ * It's customized implementations produce encryption and decryption properties for each Parquet file, using the information", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg1NDYzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * use or ignore any of these parameters.\n          \n          \n            \n             * use or ignore any of these inputs.\n          \n      \n    \n    \n  \n\nwas a bit misleading, my fault.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r397854633", "createdAt": "2020-03-25T13:31:50Z", "author": {"login": "ggershinsky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.api.WriteSupport.WriteContext;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+/**\n+ * CryptoPropertiesFactory interface enables transparent activation of Parquet encryption.\n+ *\n+ * It's customized implementations produce encryption and decryption properties for each Parquet file, using the information\n+ * available in Parquet file writers and readers: file path, file extended schema (in writers only) - and also Hadoop\n+ * configuration properties that can pass custom parameters required by a crypto factory. A factory implementation can\n+ * use or ignore any of these parameters.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b192015c818f2f967fa37fc3ddf459903f09a0"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85d0326c71145fd464bd96d16a2962111fd4ff41", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/85d0326c71145fd464bd96d16a2962111fd4ff41", "committedDate": "2020-03-25T14:23:21Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57a995c2417110645140f30dc708a8b72b656307", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/57a995c2417110645140f30dc708a8b72b656307", "committedDate": "2020-03-25T14:24:08Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e21d35de5e85f003c8ff72b230bbf31b1c97dafd", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/e21d35de5e85f003c8ff72b230bbf31b1c97dafd", "committedDate": "2020-03-25T14:38:40Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fadcf54abae38c14175a8c8f9f7229ac49301520", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/fadcf54abae38c14175a8c8f9f7229ac49301520", "committedDate": "2020-03-25T14:57:30Z", "message": "Address feedback round #3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bf021e11877cdd79a812ec093c5e63038b58bba", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/9bf021e11877cdd79a812ec093c5e63038b58bba", "committedDate": "2020-03-25T14:58:28Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java\n\nCo-Authored-By: ggershinsky <ggershinsky@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd1b10d491aef746b372b091572c90a8784230df", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/fd1b10d491aef746b372b091572c90a8784230df", "committedDate": "2020-03-25T14:58:36Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/CryptoPropertiesFactory.java\n\nCo-Authored-By: ggershinsky <ggershinsky@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f72c676c08f52b864e4a81c97767d4400d00c195", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/f72c676c08f52b864e4a81c97767d4400d00c195", "committedDate": "2020-03-25T15:12:06Z", "message": "Address feedback round #4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14", "committedDate": "2020-03-26T15:34:35Z", "message": "Split encryption and decryption interface to follow parquet-mr practice and add unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a7f02a252acce0370f04d9d8fe718541002f26f9", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/a7f02a252acce0370f04d9d8fe718541002f26f9", "committedDate": "2020-03-26T15:33:26Z", "message": "Add license info"}, "afterCommit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14", "committedDate": "2020-03-26T15:34:35Z", "message": "Split encryption and decryption interface to follow parquet-mr practice and add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNjgxNDIw", "url": "https://github.com/apache/parquet-mr/pull/769#pullrequestreview-382681420", "createdAt": "2020-03-27T09:06:08Z", "commit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowNjowOFrOF8oeUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOToyMzoxMlrOF8pD2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMjAwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             *                     .config(\"parquet.encryption.factory.class\",\n          \n          \n            \n             *                     .config(\"parquet.crypto.factory.class\",", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r399122003", "createdAt": "2020-03-27T09:06:08Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/DecryptionPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * DecryptionPropertiesFactory interface enables transparent activation of Parquet decryption.\n+ *\n+ * It's customized implementations produce decryption properties for each Parquet file, using the input information\n+ * available in Parquet file readers: file path and Hadoop configuration properties that can pass custom parameters\n+ * required by a crypto factory. A factory implementation can use or ignore any of these inputs.\n+ *\n+ * The example usage could be as below.\n+ *   1. Write a class to implement DecryptionPropertiesFactory.\n+ *   2. Set configuration of \"parquet.crypto.factory.class\" with the fully qualified name of this class.\n+ *      For example, we can set the configuration in SparkSession as below.\n+ *         SparkSession spark = SparkSession\n+ *                     .config(\"parquet.encryption.factory.class\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMjE4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             *                     .config(\"parquet.encryption.factory.class\",\n          \n          \n            \n             *                     .config(\"parquet.crypto.factory.class\",", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r399122189", "createdAt": "2020-03-27T09:06:31Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/EncryptionPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.BadConfigurationException;\n+import org.apache.parquet.hadoop.api.WriteSupport.WriteContext;\n+import org.apache.parquet.hadoop.util.ConfigurationUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * EncryptionPropertiesFactory interface enables transparent activation of Parquet encryption.\n+ *\n+ * It's customized implementations produce encryption properties for each Parquet file, using the input information\n+ * available in Parquet file writers: file path, file extended schema - and also Hadoop configuration properties that\n+ * can pass custom parameters required by a crypto factory. A factory implementation can use or ignore any of these\n+ * inputs.\n+ *\n+ * The example usage could be as below.\n+ *   1. Write a class to implement EncryptionPropertiesFactory.\n+ *   2. Set configuration of \"parquet.crypto.factory.class\" with the fully qualified name of this class.\n+ *      For example, we can set the configuration in SparkSession as below.\n+ *         SparkSession spark = SparkSession\n+ *                     .config(\"parquet.encryption.factory.class\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMzUzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * thrown when a encryption or decryption operation problem occured\n          \n          \n            \n             * Thrown when an encryption or decryption operation problem is occurred", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r399123533", "createdAt": "2020-03-27T09:08:58Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/ParquetCryptoRuntimeException.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.parquet.crypto;\n+\n+import org.apache.parquet.ParquetRuntimeException;\n+\n+/**\n+ * thrown when a encryption or decryption operation problem occured", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEzMTM5Nw==", "bodyText": "As per java code style the expected order should be public static final and the names should be upper case.", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r399131397", "createdAt": "2020-03-27T09:22:49Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/test/java/org/apache/parquet/crypto/SampleDecryptionPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.metadata.ColumnPath;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class SampleDecryptionPropertiesFactory implements DecryptionPropertiesFactory {\n+\n+  public final static byte[] footerKey = {0x01, 0x02, 0x03, 0x4, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a,\n+    0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10};\n+  public final static ColumnPath col1 = ColumnPath.fromDotString(\"col_1\");\n+  public final static byte[] col1Key = {0x02, 0x03, 0x4, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,\n+    0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11};\n+  public final static ColumnDecryptionProperties col1DecrProperties = ColumnDecryptionProperties.builder(col1.toDotString())\n+    .withKey(col1Key).build();\n+  public final static ColumnPath col2 = ColumnPath.fromDotString(\"col_2\");\n+  public final static byte[] col2Key = {0x03, 0x4, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c,\n+     0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12};\n+  public final static ColumnDecryptionProperties col2DecrProperties = ColumnDecryptionProperties.builder(col2.toDotString())\n+    .withKey(col2Key).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEzMTYwOA==", "bodyText": "see above", "url": "https://github.com/apache/parquet-mr/pull/769#discussion_r399131608", "createdAt": "2020-03-27T09:23:12Z", "author": {"login": "gszadovszky"}, "path": "parquet-hadoop/src/test/java/org/apache/parquet/crypto/SampleEncryptionPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.parquet.crypto;\n+\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.parquet.hadoop.api.WriteSupport;\n+import org.apache.parquet.hadoop.metadata.ColumnPath;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class SampleEncryptionPropertiesFactory implements EncryptionPropertiesFactory {\n+\n+  public final static byte[] footerKey = {0x01, 0x02, 0x03, 0x4, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a,\n+    0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10};\n+  public final static ColumnPath col1 = ColumnPath.fromDotString(\"col_1\");\n+  public final static byte[] col1Key = {0x02, 0x03, 0x4, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,\n+    0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11};\n+  public final static ColumnEncryptionProperties col1EncrProperties = ColumnEncryptionProperties.builder(\n+    col1.toDotString()).withKey(col1Key).build();\n+  public final static ColumnPath col2 = ColumnPath.fromDotString(\"col_2\");\n+  public final static byte[] col2Key = {0x03, 0x4, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c,\n+     0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12};\n+  public final static ColumnEncryptionProperties col2EncrProperties = ColumnEncryptionProperties.builder(\n+    col2.toDotString()).withKey(col2Key).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d72b2a1f0e9d4ca78348c09b28bed2b7fa4ddd14"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2edf3ddddf51c9b918e7b155560b1d37f39dd4f", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/c2edf3ddddf51c9b918e7b155560b1d37f39dd4f", "committedDate": "2020-03-27T15:18:58Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/DecryptionPropertiesFactory.java\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b22352573b3534be71361226b8014b41a72d0991", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/b22352573b3534be71361226b8014b41a72d0991", "committedDate": "2020-03-27T15:19:28Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/ParquetCryptoRuntimeException.java\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60167c04026c6ddb115300d2301f507a08068f19", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/60167c04026c6ddb115300d2301f507a08068f19", "committedDate": "2020-03-27T15:20:12Z", "message": "Update parquet-hadoop/src/main/java/org/apache/parquet/crypto/EncryptionPropertiesFactory.java\n\nCo-Authored-By: Gabor Szadovszky <gabor@apache.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bb18eb4995352c3d7b7dc7597cab23204d72ddf", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/8bb18eb4995352c3d7b7dc7597cab23204d72ddf", "committedDate": "2020-03-28T19:42:41Z", "message": "Change varaible names in test to follow Java coding practice"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb307db8d162c786f5fe6e6119cf0d4a40b566fb", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/bb307db8d162c786f5fe6e6119cf0d4a40b566fb", "committedDate": "2020-03-28T19:42:11Z", "message": "Fix varaibles"}, "afterCommit": {"oid": "8bb18eb4995352c3d7b7dc7597cab23204d72ddf", "author": {"user": {"login": "shangxinli", "name": "Xinli Shang"}}, "url": "https://github.com/apache/parquet-mr/commit/8bb18eb4995352c3d7b7dc7597cab23204d72ddf", "committedDate": "2020-03-28T19:42:41Z", "message": "Change varaible names in test to follow Java coding practice"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjUzOTEw", "url": "https://github.com/apache/parquet-mr/pull/769#pullrequestreview-383653910", "createdAt": "2020-03-30T08:56:51Z", "commit": {"oid": "8bb18eb4995352c3d7b7dc7597cab23204d72ddf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2180, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}