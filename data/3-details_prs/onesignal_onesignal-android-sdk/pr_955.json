{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2Mzg0OTUy", "number": 955, "title": "Add unattributed outcome and unique outcome for IAM click", "bodyText": "Add send outcome and unique outcome for button and image click\nAdd test for new case\n\n\n\nThis change is\u2002", "createdAt": "2020-02-18T02:24:14Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955", "merged": true, "mergeCommit": {"oid": "93aeeb1df7cc1043459e2a10543977558796ce7f"}, "closed": true, "closedAt": "2020-03-04T19:56:41Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF8KVrAFqTM2MTM5NjM5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKcPNogBqjMwOTgxOTAwMzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzk2Mzkz", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#pullrequestreview-361396393", "createdAt": "2020-02-19T20:01:18Z", "commit": {"oid": "1073a8d7d0c85c44d827847ed4c2f9554752a3e0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1073a8d7d0c85c44d827847ed4c2f9554752a3e0", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1073a8d7d0c85c44d827847ed4c2f9554752a3e0", "committedDate": "2020-02-18T00:12:43Z", "message": "Add unattributed outcome for IAM click\n\n  * Add send outcome for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "ca78e1c7fa847da30e9d06739f910a3fa9d113eb", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ca78e1c7fa847da30e9d06739f910a3fa9d113eb", "committedDate": "2020-02-20T22:04:38Z", "message": "Add unattributed outcome for IAM click\n\n  * Add send outcome and unique outcome for button and image click\n  * Add test for new case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca78e1c7fa847da30e9d06739f910a3fa9d113eb", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ca78e1c7fa847da30e9d06739f910a3fa9d113eb", "committedDate": "2020-02-20T22:04:38Z", "message": "Add unattributed outcome for IAM click\n\n  * Add send outcome and unique outcome for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "f7191f308a6b6e922692e3dc59c88e2b77463d26", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f7191f308a6b6e922692e3dc59c88e2b77463d26", "committedDate": "2020-02-21T18:58:21Z", "message": "Add unattributed outcome for IAM click\n\n  * Add send outcome and unique outcome for button and image click\n  * Add test for new case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTU2OTQ3", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#pullrequestreview-367556947", "createdAt": "2020-03-02T21:54:41Z", "commit": {"oid": "f7191f308a6b6e922692e3dc59c88e2b77463d26"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTo1NDo0MVrOFwwtNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTo1Nzo1OVrOFwwzcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3Mzk3Mw==", "bodyText": "Commented on iOS about this, remove sendUniqueClickActionOutcomeEvent and sendClickActionOutcomeWithValue and use this if statement that reuses our outcome public methods\nif (action.outcome == null && action.outcome.getName().isEmpty())\n    return;\n\nOSInAppMessageOutcome outcome = action.outcome;\nif (outcome.isUnique()) {\n    OneSignal.sendUniqueOutcome(outcome.getName());\n} else if (outcome.getWeight() > 0) {\n    OneSignal.sendOutcomeWithValue(outcome.getName(), outcome.getWeight());\n} else {\n    OneSignal.sendOutcome(outcome.getName());\n}", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#discussion_r386673973", "createdAt": "2020-03-02T21:54:41Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -229,23 +229,36 @@ void onFailure(int statusCode, String response, Throwable throwable) {\n         }\n     }\n \n-    void onMessageActionOccurredOnMessage(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) {\n+    void onMessageActionOccurredOnMessage(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) throws JSONException {\n         final OSInAppMessageAction action = new OSInAppMessageAction(actionJson);\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n         fireClickAction(action);\n         fireRESTCallForClick(message, action);\n+        fireOutcomeForClick(action);\n     }\n \n-    void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) {\n+    void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) throws JSONException {\n         final OSInAppMessageAction action = new OSInAppMessageAction(actionJson);\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n         fireClickAction(action);\n     }\n \n+    private void fireOutcomeForClick(@NonNull final OSInAppMessageAction action) {\n+        if (action.outcome != null && !action.outcome.getName().isEmpty()) {\n+            OSInAppMessageOutcome outcome = action.outcome;\n+\n+            if (outcome.isUnique()) {\n+                OneSignal.sendUniqueClickActionOutcomeEvent(outcome.getName());\n+            } else {\n+                OneSignal.sendClickActionOutcomeWithValue(outcome.getName(), outcome.getWeight() > 0 ? (float) outcome.getWeight() : 0);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7191f308a6b6e922692e3dc59c88e2b77463d26"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NTU2Ng==", "bodyText": "remove this", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#discussion_r386675566", "createdAt": "2020-03-02T21:57:58Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -3110,6 +3119,15 @@ public static void sendOutcome(@NonNull String name, OutcomeCallback callback) {\n       outcomeEventsController.sendOutcomeEvent(name, callback);\n    }\n \n+   static void sendUniqueClickActionOutcomeEvent(@NonNull String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7191f308a6b6e922692e3dc59c88e2b77463d26"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NTU3MA==", "bodyText": "remove this", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#discussion_r386675570", "createdAt": "2020-03-02T21:57:59Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -3094,6 +3094,15 @@ static OSSessionManager getSessionManager() {\n       return sessionManager;\n    }\n \n+   static void sendClickActionOutcomeWithValue(@NonNull String name, float value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7191f308a6b6e922692e3dc59c88e2b77463d26"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7191f308a6b6e922692e3dc59c88e2b77463d26", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f7191f308a6b6e922692e3dc59c88e2b77463d26", "committedDate": "2020-02-21T18:58:21Z", "message": "Add unattributed outcome for IAM click\n\n  * Add send outcome and unique outcome for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "d73334ea3090bd563e0e8db85c91d399a21aa247", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d73334ea3090bd563e0e8db85c91d399a21aa247", "committedDate": "2020-03-04T00:14:49Z", "message": "Add unattributed outcome for IAM click\n\n  * Add send outcome and unique outcome for button and image click\n  * Add test for new case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d73334ea3090bd563e0e8db85c91d399a21aa247", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d73334ea3090bd563e0e8db85c91d399a21aa247", "committedDate": "2020-03-04T00:14:49Z", "message": "Add unattributed outcome for IAM click\n\n  * Add send outcome and unique outcome for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "c99abc950e3f76513d443aef1a01d6e1406079d4", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c99abc950e3f76513d443aef1a01d6e1406079d4", "committedDate": "2020-03-04T00:32:46Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c99abc950e3f76513d443aef1a01d6e1406079d4", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c99abc950e3f76513d443aef1a01d6e1406079d4", "committedDate": "2020-03-04T00:32:46Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "566814d4efa6572ea4a9f2a1b194d3d1b42c088a", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/566814d4efa6572ea4a9f2a1b194d3d1b42c088a", "committedDate": "2020-03-04T00:40:40Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "566814d4efa6572ea4a9f2a1b194d3d1b42c088a", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/566814d4efa6572ea4a9f2a1b194d3d1b42c088a", "committedDate": "2020-03-04T00:40:40Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "cc017af930067e09934953c10a2c55a87a128790", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/cc017af930067e09934953c10a2c55a87a128790", "committedDate": "2020-03-04T00:42:21Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc017af930067e09934953c10a2c55a87a128790", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/cc017af930067e09934953c10a2c55a87a128790", "committedDate": "2020-03-04T00:42:21Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "ae23673a520feece25cfedee477dce842a577307", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ae23673a520feece25cfedee477dce842a577307", "committedDate": "2020-03-04T00:50:05Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NDU0MDAz", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#pullrequestreview-368454003", "createdAt": "2020-03-04T01:50:31Z", "commit": {"oid": "ae23673a520feece25cfedee477dce842a577307"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwMTo1MDozMVrOFxdZmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwMTo1NDo0MFrOFxdeCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQwNjIzNA==", "bodyText": "Lets keep all of the name as consistent as possible:\nsendClickActionUniqueOutcome\nsendClickActionOutcomeWithValue\nsendClickActionOutcome", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#discussion_r387406234", "createdAt": "2020-03-04T01:50:31Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -267,23 +267,40 @@ void onFailure(int statusCode, String response, Throwable throwable) {\n         }\n     }\n \n-    void onMessageActionOccurredOnMessage(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) {\n+    void onMessageActionOccurredOnMessage(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) throws JSONException {\n         final OSInAppMessageAction action = new OSInAppMessageAction(actionJson);\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n         fireClickAction(action);\n         fireRESTCallForClick(message, action);\n+        fireOutcomeForClick(action);\n     }\n \n-    void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) {\n+    void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @NonNull final JSONObject actionJson) throws JSONException {\n         final OSInAppMessageAction action = new OSInAppMessageAction(actionJson);\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n         fireClickAction(action);\n     }\n \n+    //TODO This is a temporal solution for IAMs outcomes\n+    //     and will potentially change when we track IAMs\n+    private void fireOutcomeForClick(@NonNull final OSInAppMessageAction action) {\n+        for (OSInAppMessageOutcome outcome : action.outcomes) {\n+            String name = outcome.getName();\n+\n+            if (outcome.isUnique()) {\n+                OneSignal.sendUniqueClickActionOutcomeEvent(name);\n+            } else if (outcome.getWeight() > 0) {\n+                OneSignal.sendClickActionOutcomeWithValue(name, outcome.getWeight());\n+            } else {\n+                OneSignal.sendClickActionOutcome(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae23673a520feece25cfedee477dce842a577307"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQwNzM3MA==", "bodyText": "Lets have 4 separate tests:\n\nNormal outcomes\nWeight outcomes\nUnique outcomes\nMulti outcomes", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/955#discussion_r387407370", "createdAt": "2020-03-04T01:54:40Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/InAppMessageIntegrationTests.java", "diffHunk": "@@ -474,6 +477,137 @@ public void testInAppMessageOnlyReceivesClickIdOnce() throws Exception {\n         assertEquals(1, testClickedMessages.size());\n     }\n \n+    @Test\n+    public void testInAppMessageClickActionOutcome() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae23673a520feece25cfedee477dce842a577307"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae23673a520feece25cfedee477dce842a577307", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ae23673a520feece25cfedee477dce842a577307", "committedDate": "2020-03-04T00:50:05Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "fbce453ea86a3a267cea26a26b667a552abe7e3c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/fbce453ea86a3a267cea26a26b667a552abe7e3c", "committedDate": "2020-03-04T02:04:01Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbce453ea86a3a267cea26a26b667a552abe7e3c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/fbce453ea86a3a267cea26a26b667a552abe7e3c", "committedDate": "2020-03-04T02:04:01Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "1a3f56b1cb38f6cabf126060a18b0767de6b6478", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1a3f56b1cb38f6cabf126060a18b0767de6b6478", "committedDate": "2020-03-04T19:05:16Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3f9aac4d4f366aeebaeb31ca9f06e7a4491246c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f3f9aac4d4f366aeebaeb31ca9f06e7a4491246c", "committedDate": "2020-03-04T19:38:59Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a3f56b1cb38f6cabf126060a18b0767de6b6478", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1a3f56b1cb38f6cabf126060a18b0767de6b6478", "committedDate": "2020-03-04T19:05:16Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}, "afterCommit": {"oid": "f3f9aac4d4f366aeebaeb31ca9f06e7a4491246c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f3f9aac4d4f366aeebaeb31ca9f06e7a4491246c", "committedDate": "2020-03-04T19:38:59Z", "message": "Add unattributed outcomes for IAM click\n\n  * Add send outcomes and unique outcomes for button and image click\n  * Add test for new case"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3511, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}