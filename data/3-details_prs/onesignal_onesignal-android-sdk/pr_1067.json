{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MjczNTE4", "number": 1067, "title": "Create GMS and HMS Location controller", "bodyText": "Separate location controller by platform\n\n\n\nThis change is\u2002", "createdAt": "2020-06-15T04:09:42Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067", "merged": true, "mergeCommit": {"oid": "7b3f50402d794d0c138a592dd27239a7b4276aba"}, "closed": true, "closedAt": "2020-06-16T00:40:24Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrYsc5ABqjM0NDI1MjMxMjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrqPWIAFqTQzMTA4MjM2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb27442553f632bf120b3598d5713871b8843659", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/cb27442553f632bf120b3598d5713871b8843659", "committedDate": "2020-06-15T04:08:45Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}, "afterCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1a8c5abd690fae0fb1894f7042bc0e12b2d4f449", "committedDate": "2020-06-15T04:10:48Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODY4MTg0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#pullrequestreview-430868184", "createdAt": "2020-06-15T17:54:38Z", "commit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNzo1NDozOFrOGj8sFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxOTo1ODozOVrOGkArpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM0NzY3MA==", "bodyText": "Lets rename this now that its an extended class controller\nMaybe\nOSLocationController?\nOneSignalLocationController?\nWe can also leave it as is if you think its fine", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#discussion_r440347670", "createdAt": "2020-06-15T17:54:38Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationController.java", "diffHunk": "@@ -56,6 +47,27 @@\n \n class LocationController {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQxMzA1OQ==", "bodyText": "Why wrap OSUtils.isHuaweiDeviceType(); when we can just use it directly?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#discussion_r440413059", "createdAt": "2020-06-15T19:58:33Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationController.java", "diffHunk": "@@ -289,106 +269,38 @@ static void startGetLocation() {\n       }\n    }\n \n-   private static void initGoogleLocation() {\n-      // Prevents overlapping requests\n-      if (fallbackFailThread != null)\n-         return;\n-\n-      synchronized (syncLock) {\n-         startFallBackThread();\n-\n-         if (googleApiClient == null || lastLocation == null) {\n-            GoogleApiClientListener googleApiClientListener = new GoogleApiClientListener();\n-            GoogleApiClient googleApiClient = new GoogleApiClient.Builder(classContext)\n-                    .addApi(LocationServices.API)\n-                    .addConnectionCallbacks(googleApiClientListener)\n-                    .addOnConnectionFailedListener(googleApiClientListener)\n-                    .setHandler(locationHandlerThread.mHandler)\n-                    .build();\n-\n-            LocationController.googleApiClient = new GoogleApiClientCompatProxy(googleApiClient);\n-            LocationController.googleApiClient.connect();\n-         } else if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-      }\n-   }\n-\n-   private static void initHuaweiLocation() {\n+   static void onFocusChange() {\n       synchronized (syncLock) {\n-         if (huaweiFusedLocationClient == null) {\n-            try {\n-               huaweiFusedLocationClient = com.huawei.hms.location.LocationServices.getFusedLocationProviderClient(classContext);\n-            } catch (Exception e) {\n-               OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getFusedLocationProviderClient failed! \" + e);\n-               fireFailedComplete();\n-               return;\n-            }\n+         // Google location not initialized or connected yet\n+         if (isGooglePlayServicesAvailable()) {\n+            GMSLocationController.onFocusChange();\n+            return;\n          }\n-         if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-         else\n-            huaweiFusedLocationClient.getLastLocation()\n-                    .addOnSuccessListener(new com.huawei.hmf.tasks.OnSuccessListener<Location>() {\n-                       @Override\n-                       public void onSuccess(Location location) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.WARN, \"Huawei LocationServices getLastLocation returned location: \" + location);\n-                          if (location == null) {\n-                             fireFailedComplete();\n-                             return;\n-                          }\n-                          lastLocation = location;\n-                          fireCompleteForLocation(lastLocation);\n-                          locationUpdateListener = new LocationUpdateListener(huaweiFusedLocationClient);\n-                       }\n-                    })\n-                    .addOnFailureListener(new com.huawei.hmf.tasks.OnFailureListener() {\n-                       @Override\n-                       public void onFailure(Exception e) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getLastLocation failed!\", e);\n-                          fireFailedComplete();\n-                       }\n-                    });\n+\n+         // Huawei location not initialized yet and not google play available\n+         if (isHMSAvailable())\n+            HMSLocationController.onFocusChange();\n       }\n    }\n \n    // If we are using device type Android for push we can safely assume we are using Google Play services\n-   private static boolean isGooglePlayServicesAvailable() {\n+   static boolean isGooglePlayServicesAvailable() {\n       return OSUtils.isAndroidDeviceType();\n    }\n \n    // If we are using device type Huawei for push we can safely assume we are using HMS Core\n-   private static boolean isHMSAvailable() {\n+   static boolean isHMSAvailable() {\n       return OSUtils.isHuaweiDeviceType();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "originalPosition": 199}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQxMzA5NQ==", "bodyText": "Why wrap OSUtils.isAndroidDeviceType(); when we can just use it directly?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#discussion_r440413095", "createdAt": "2020-06-15T19:58:39Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationController.java", "diffHunk": "@@ -289,106 +269,38 @@ static void startGetLocation() {\n       }\n    }\n \n-   private static void initGoogleLocation() {\n-      // Prevents overlapping requests\n-      if (fallbackFailThread != null)\n-         return;\n-\n-      synchronized (syncLock) {\n-         startFallBackThread();\n-\n-         if (googleApiClient == null || lastLocation == null) {\n-            GoogleApiClientListener googleApiClientListener = new GoogleApiClientListener();\n-            GoogleApiClient googleApiClient = new GoogleApiClient.Builder(classContext)\n-                    .addApi(LocationServices.API)\n-                    .addConnectionCallbacks(googleApiClientListener)\n-                    .addOnConnectionFailedListener(googleApiClientListener)\n-                    .setHandler(locationHandlerThread.mHandler)\n-                    .build();\n-\n-            LocationController.googleApiClient = new GoogleApiClientCompatProxy(googleApiClient);\n-            LocationController.googleApiClient.connect();\n-         } else if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-      }\n-   }\n-\n-   private static void initHuaweiLocation() {\n+   static void onFocusChange() {\n       synchronized (syncLock) {\n-         if (huaweiFusedLocationClient == null) {\n-            try {\n-               huaweiFusedLocationClient = com.huawei.hms.location.LocationServices.getFusedLocationProviderClient(classContext);\n-            } catch (Exception e) {\n-               OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getFusedLocationProviderClient failed! \" + e);\n-               fireFailedComplete();\n-               return;\n-            }\n+         // Google location not initialized or connected yet\n+         if (isGooglePlayServicesAvailable()) {\n+            GMSLocationController.onFocusChange();\n+            return;\n          }\n-         if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-         else\n-            huaweiFusedLocationClient.getLastLocation()\n-                    .addOnSuccessListener(new com.huawei.hmf.tasks.OnSuccessListener<Location>() {\n-                       @Override\n-                       public void onSuccess(Location location) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.WARN, \"Huawei LocationServices getLastLocation returned location: \" + location);\n-                          if (location == null) {\n-                             fireFailedComplete();\n-                             return;\n-                          }\n-                          lastLocation = location;\n-                          fireCompleteForLocation(lastLocation);\n-                          locationUpdateListener = new LocationUpdateListener(huaweiFusedLocationClient);\n-                       }\n-                    })\n-                    .addOnFailureListener(new com.huawei.hmf.tasks.OnFailureListener() {\n-                       @Override\n-                       public void onFailure(Exception e) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getLastLocation failed!\", e);\n-                          fireFailedComplete();\n-                       }\n-                    });\n+\n+         // Huawei location not initialized yet and not google play available\n+         if (isHMSAvailable())\n+            HMSLocationController.onFocusChange();\n       }\n    }\n \n    // If we are using device type Android for push we can safely assume we are using Google Play services\n-   private static boolean isGooglePlayServicesAvailable() {\n+   static boolean isGooglePlayServicesAvailable() {\n       return OSUtils.isAndroidDeviceType();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "originalPosition": 193}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDE2NzI0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#pullrequestreview-431016724", "createdAt": "2020-06-15T21:47:18Z", "commit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMTo0NzoxOVrOGkD4tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMTo1MToyOVrOGkD_nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NTU5MQ==", "bodyText": "I think it is fine to leave for now.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#discussion_r440465591", "createdAt": "2020-06-15T21:47:19Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationController.java", "diffHunk": "@@ -56,6 +47,27 @@\n \n class LocationController {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM0NzY3MA=="}, "originalCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NzI5OQ==", "bodyText": "This wrapping makes the code where isGooglePlayServicesAvailable() is called more readable so I think this is preferred.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#discussion_r440467299", "createdAt": "2020-06-15T21:51:22Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationController.java", "diffHunk": "@@ -289,106 +269,38 @@ static void startGetLocation() {\n       }\n    }\n \n-   private static void initGoogleLocation() {\n-      // Prevents overlapping requests\n-      if (fallbackFailThread != null)\n-         return;\n-\n-      synchronized (syncLock) {\n-         startFallBackThread();\n-\n-         if (googleApiClient == null || lastLocation == null) {\n-            GoogleApiClientListener googleApiClientListener = new GoogleApiClientListener();\n-            GoogleApiClient googleApiClient = new GoogleApiClient.Builder(classContext)\n-                    .addApi(LocationServices.API)\n-                    .addConnectionCallbacks(googleApiClientListener)\n-                    .addOnConnectionFailedListener(googleApiClientListener)\n-                    .setHandler(locationHandlerThread.mHandler)\n-                    .build();\n-\n-            LocationController.googleApiClient = new GoogleApiClientCompatProxy(googleApiClient);\n-            LocationController.googleApiClient.connect();\n-         } else if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-      }\n-   }\n-\n-   private static void initHuaweiLocation() {\n+   static void onFocusChange() {\n       synchronized (syncLock) {\n-         if (huaweiFusedLocationClient == null) {\n-            try {\n-               huaweiFusedLocationClient = com.huawei.hms.location.LocationServices.getFusedLocationProviderClient(classContext);\n-            } catch (Exception e) {\n-               OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getFusedLocationProviderClient failed! \" + e);\n-               fireFailedComplete();\n-               return;\n-            }\n+         // Google location not initialized or connected yet\n+         if (isGooglePlayServicesAvailable()) {\n+            GMSLocationController.onFocusChange();\n+            return;\n          }\n-         if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-         else\n-            huaweiFusedLocationClient.getLastLocation()\n-                    .addOnSuccessListener(new com.huawei.hmf.tasks.OnSuccessListener<Location>() {\n-                       @Override\n-                       public void onSuccess(Location location) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.WARN, \"Huawei LocationServices getLastLocation returned location: \" + location);\n-                          if (location == null) {\n-                             fireFailedComplete();\n-                             return;\n-                          }\n-                          lastLocation = location;\n-                          fireCompleteForLocation(lastLocation);\n-                          locationUpdateListener = new LocationUpdateListener(huaweiFusedLocationClient);\n-                       }\n-                    })\n-                    .addOnFailureListener(new com.huawei.hmf.tasks.OnFailureListener() {\n-                       @Override\n-                       public void onFailure(Exception e) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getLastLocation failed!\", e);\n-                          fireFailedComplete();\n-                       }\n-                    });\n+\n+         // Huawei location not initialized yet and not google play available\n+         if (isHMSAvailable())\n+            HMSLocationController.onFocusChange();\n       }\n    }\n \n    // If we are using device type Android for push we can safely assume we are using Google Play services\n-   private static boolean isGooglePlayServicesAvailable() {\n+   static boolean isGooglePlayServicesAvailable() {\n       return OSUtils.isAndroidDeviceType();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQxMzA5NQ=="}, "originalCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "originalPosition": 193}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ2NzM1Nw==", "bodyText": "This wrapping makes the code where isHMSAvailable() is called more readable so I think this is preferred.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#discussion_r440467357", "createdAt": "2020-06-15T21:51:29Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationController.java", "diffHunk": "@@ -289,106 +269,38 @@ static void startGetLocation() {\n       }\n    }\n \n-   private static void initGoogleLocation() {\n-      // Prevents overlapping requests\n-      if (fallbackFailThread != null)\n-         return;\n-\n-      synchronized (syncLock) {\n-         startFallBackThread();\n-\n-         if (googleApiClient == null || lastLocation == null) {\n-            GoogleApiClientListener googleApiClientListener = new GoogleApiClientListener();\n-            GoogleApiClient googleApiClient = new GoogleApiClient.Builder(classContext)\n-                    .addApi(LocationServices.API)\n-                    .addConnectionCallbacks(googleApiClientListener)\n-                    .addOnConnectionFailedListener(googleApiClientListener)\n-                    .setHandler(locationHandlerThread.mHandler)\n-                    .build();\n-\n-            LocationController.googleApiClient = new GoogleApiClientCompatProxy(googleApiClient);\n-            LocationController.googleApiClient.connect();\n-         } else if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-      }\n-   }\n-\n-   private static void initHuaweiLocation() {\n+   static void onFocusChange() {\n       synchronized (syncLock) {\n-         if (huaweiFusedLocationClient == null) {\n-            try {\n-               huaweiFusedLocationClient = com.huawei.hms.location.LocationServices.getFusedLocationProviderClient(classContext);\n-            } catch (Exception e) {\n-               OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getFusedLocationProviderClient failed! \" + e);\n-               fireFailedComplete();\n-               return;\n-            }\n+         // Google location not initialized or connected yet\n+         if (isGooglePlayServicesAvailable()) {\n+            GMSLocationController.onFocusChange();\n+            return;\n          }\n-         if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-         else\n-            huaweiFusedLocationClient.getLastLocation()\n-                    .addOnSuccessListener(new com.huawei.hmf.tasks.OnSuccessListener<Location>() {\n-                       @Override\n-                       public void onSuccess(Location location) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.WARN, \"Huawei LocationServices getLastLocation returned location: \" + location);\n-                          if (location == null) {\n-                             fireFailedComplete();\n-                             return;\n-                          }\n-                          lastLocation = location;\n-                          fireCompleteForLocation(lastLocation);\n-                          locationUpdateListener = new LocationUpdateListener(huaweiFusedLocationClient);\n-                       }\n-                    })\n-                    .addOnFailureListener(new com.huawei.hmf.tasks.OnFailureListener() {\n-                       @Override\n-                       public void onFailure(Exception e) {\n-                          OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getLastLocation failed!\", e);\n-                          fireFailedComplete();\n-                       }\n-                    });\n+\n+         // Huawei location not initialized yet and not google play available\n+         if (isHMSAvailable())\n+            HMSLocationController.onFocusChange();\n       }\n    }\n \n    // If we are using device type Android for push we can safely assume we are using Google Play services\n-   private static boolean isGooglePlayServicesAvailable() {\n+   static boolean isGooglePlayServicesAvailable() {\n       return OSUtils.isAndroidDeviceType();\n    }\n \n    // If we are using device type Huawei for push we can safely assume we are using HMS Core\n-   private static boolean isHMSAvailable() {\n+   static boolean isHMSAvailable() {\n       return OSUtils.isHuaweiDeviceType();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQxMzA1OQ=="}, "originalCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "originalPosition": 199}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDQwMDY2", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#pullrequestreview-431040066", "createdAt": "2020-06-15T22:37:38Z", "commit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjozNzozOFrOGkFEpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjozNzozOFrOGkFEpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4NTAzMQ==", "bodyText": "We should check for location permission here before attempting to access GMSLocationController or HMSLocationController.\nOtherwise NoClassDefFoundError will print in the logcat if they are don't have the location library in their app.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#discussion_r440485031", "createdAt": "2020-06-15T22:37:38Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationController.java", "diffHunk": "@@ -289,106 +269,38 @@ static void startGetLocation() {\n       }\n    }\n \n-   private static void initGoogleLocation() {\n-      // Prevents overlapping requests\n-      if (fallbackFailThread != null)\n-         return;\n-\n-      synchronized (syncLock) {\n-         startFallBackThread();\n-\n-         if (googleApiClient == null || lastLocation == null) {\n-            GoogleApiClientListener googleApiClientListener = new GoogleApiClientListener();\n-            GoogleApiClient googleApiClient = new GoogleApiClient.Builder(classContext)\n-                    .addApi(LocationServices.API)\n-                    .addConnectionCallbacks(googleApiClientListener)\n-                    .addOnConnectionFailedListener(googleApiClientListener)\n-                    .setHandler(locationHandlerThread.mHandler)\n-                    .build();\n-\n-            LocationController.googleApiClient = new GoogleApiClientCompatProxy(googleApiClient);\n-            LocationController.googleApiClient.connect();\n-         } else if (lastLocation != null)\n-            fireCompleteForLocation(lastLocation);\n-      }\n-   }\n-\n-   private static void initHuaweiLocation() {\n+   static void onFocusChange() {\n       synchronized (syncLock) {\n-         if (huaweiFusedLocationClient == null) {\n-            try {\n-               huaweiFusedLocationClient = com.huawei.hms.location.LocationServices.getFusedLocationProviderClient(classContext);\n-            } catch (Exception e) {\n-               OneSignal.Log(OneSignal.LOG_LEVEL.ERROR, \"Huawei LocationServices getFusedLocationProviderClient failed! \" + e);\n-               fireFailedComplete();\n-               return;\n-            }\n+         // Google location not initialized or connected yet", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449"}, "originalPosition": 154}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a8c5abd690fae0fb1894f7042bc0e12b2d4f449", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1a8c5abd690fae0fb1894f7042bc0e12b2d4f449", "committedDate": "2020-06-15T04:10:48Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}, "afterCommit": {"oid": "49e58348385f2f2a6b9f39e2f01547d7d137b784", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/49e58348385f2f2a6b9f39e2f01547d7d137b784", "committedDate": "2020-06-15T23:54:15Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49e58348385f2f2a6b9f39e2f01547d7d137b784", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/49e58348385f2f2a6b9f39e2f01547d7d137b784", "committedDate": "2020-06-15T23:54:15Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}, "afterCommit": {"oid": "b7b37e0dd9724676599a8750ad804c43100de48a", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/b7b37e0dd9724676599a8750ad804c43100de48a", "committedDate": "2020-06-16T00:05:46Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdb549de926861df011028f12505ef98617eb76e", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/fdb549de926861df011028f12505ef98617eb76e", "committedDate": "2020-06-16T00:07:37Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7b37e0dd9724676599a8750ad804c43100de48a", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/b7b37e0dd9724676599a8750ad804c43100de48a", "committedDate": "2020-06-16T00:05:46Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}, "afterCommit": {"oid": "fdb549de926861df011028f12505ef98617eb76e", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/fdb549de926861df011028f12505ef98617eb76e", "committedDate": "2020-06-16T00:07:37Z", "message": "Create GMS and HMS Loction controller\n\n   * Separate location controller by platform"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDgxNjMy", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#pullrequestreview-431081632", "createdAt": "2020-06-16T00:35:10Z", "commit": {"oid": "fdb549de926861df011028f12505ef98617eb76e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDgyMzY2", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1067#pullrequestreview-431082366", "createdAt": "2020-06-16T00:37:36Z", "commit": {"oid": "fdb549de926861df011028f12505ef98617eb76e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3616, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}