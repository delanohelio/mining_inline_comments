{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2OTAxNTI3", "number": 1192, "title": "Notification Open now uses an Activity instead of Broadcast", "bodyText": "Switch to using NotificationOpenedActivity.class in GenerateNotification.java\nRemove Intent flags from startOrResumeApp and use Activity Context instead of the normal context\nUpdate tests to account for the new behavior\n\nHandle delete intent with broadcast receiver \u2026\n\nUsing activities for handling delete can end on some weird behavior on the UI\n\nTested on API 21, 25, 29\n\nThis change is\u2002", "createdAt": "2020-10-20T15:25:58Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192", "merged": true, "mergeCommit": {"oid": "91928f8555958f5123f98c2ac58c9ea23c7f05f4"}, "closed": true, "closedAt": "2020-11-12T19:48:03Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUcAhdAH2gAyNTA2OTAxNTI3OmVkY2I0ZTM0Y2FkZjAwMTU5MWViZWM3N2UwNmNjNDgyN2NmOWJiMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbN_5egFqTUyNzUxMTEyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "edcb4e34cadf001591ebec77e06cc4827cf9bb10", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/edcb4e34cadf001591ebec77e06cc4827cf9bb10", "committedDate": "2020-10-20T17:13:38Z", "message": "Notification Open should use Activity instead of Broadcast\n\n* Switch to using NotificationOpenedActivity.class in GenerateNotification.java\n* Remove Intent flags from startOrResumeApp and use Activity Context instead of the normal context\n* Update tests to account for the new behavior"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f921cb83be505a91a90c4b842abec6e8c4852bce", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f921cb83be505a91a90c4b842abec6e8c4852bce", "committedDate": "2020-10-20T15:12:49Z", "message": "Notification Open should use Activity instead of Broadcast\n\n* Switch to using NotificationOpenedActivity.class in GenerateNotification.java\n* Remove Intent flags from startOrResumeApp and use Activity Context instead of the normal context\n* Update tests to account for the new behavior"}, "afterCommit": {"oid": "edcb4e34cadf001591ebec77e06cc4827cf9bb10", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/edcb4e34cadf001591ebec77e06cc4827cf9bb10", "committedDate": "2020-10-20T17:13:38Z", "message": "Notification Open should use Activity instead of Broadcast\n\n* Switch to using NotificationOpenedActivity.class in GenerateNotification.java\n* Remove Intent flags from startOrResumeApp and use Activity Context instead of the normal context\n* Update tests to account for the new behavior"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDA3MTQ0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#pullrequestreview-516007144", "createdAt": "2020-10-23T20:59:26Z", "commit": {"oid": "edcb4e34cadf001591ebec77e06cc4827cf9bb10"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDo1OToyNlrOHneSqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMzoxMDowOFrOHols_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MjgwOA==", "bodyText": "Do we also need to add android:theme=\"@android:style/Theme.Translucent.NoTitleBar\" to prevent any sort of flicker when the activity is opened then closed quickly? I remember this was needed to fix some brief visual issues but don't remember the exact details, may only be an issue on older Android devices.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#discussion_r511152808", "createdAt": "2020-10-23T20:59:26Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/AndroidManifest.xml", "diffHunk": "@@ -104,7 +104,9 @@\n             </intent-filter>\n         </receiver>\n \n-        <activity android:name=\"com.onesignal.NotificationOpenedActivity\"/>\n+        <activity\n+          android:name=\"com.onesignal.NotificationOpenedActivity\"\n+          android:noHistory=\"true\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edcb4e34cadf001591ebec77e06cc4827cf9bb10"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMyMjgxNQ==", "bodyText": "Mike tried to switch this notification dismiss action to an Activity before in the past and it resulted in a visual flicker. Do these flags completely prevent that?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#discussion_r512322815", "createdAt": "2020-10-26T23:10:08Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java", "diffHunk": "@@ -133,28 +122,20 @@ private static CharSequence getTitle(JSONObject fcmJson) {\n    }\n \n    private static PendingIntent getNewActionPendingIntent(int requestCode, Intent intent) {\n-      if (openerIsBroadcast)\n-         return PendingIntent.getBroadcast(currentContext, requestCode, intent, PendingIntent.FLAG_UPDATE_CURRENT);\n       return PendingIntent.getActivity(currentContext, requestCode, intent, PendingIntent.FLAG_UPDATE_CURRENT);\n    }\n \n    private static Intent getNewBaseIntent(int notificationId) {\n-      Intent intent = new Intent(currentContext, notificationOpenedClass)\n-                        .putExtra(BUNDLE_KEY_ANDROID_NOTIFICATION_ID, notificationId);\n-\n-      if (openerIsBroadcast)\n-         return intent;\n-      return intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP | Intent.FLAG_ACTIVITY_CLEAR_TOP);\n+     return new Intent(currentContext, notificationOpenedClass)\n+             .putExtra(BUNDLE_KEY_ANDROID_NOTIFICATION_ID, notificationId)\n+             .addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP | Intent.FLAG_ACTIVITY_CLEAR_TOP);\n    }\n \n    private static Intent getNewBaseDeleteIntent(int notificationId) {\n-      Intent intent = new Intent(currentContext, notificationOpenedClass)\n-          .putExtra(BUNDLE_KEY_ANDROID_NOTIFICATION_ID, notificationId)\n-          .putExtra(\"dismissed\", true);\n-\n-      if (openerIsBroadcast)\n-         return intent;\n-      return intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_MULTIPLE_TASK | Intent.FLAG_ACTIVITY_NO_ANIMATION);\n+      return new Intent(currentContext, notificationOpenedClass)\n+              .putExtra(BUNDLE_KEY_ANDROID_NOTIFICATION_ID, notificationId)\n+              .putExtra(\"dismissed\", true)\n+              .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_MULTIPLE_TASK | Intent.FLAG_ACTIVITY_NO_ANIMATION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edcb4e34cadf001591ebec77e06cc4827cf9bb10"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/211e23d61d7501a4a269dade0a7f523d383d2a17", "committedDate": "2020-11-04T03:14:23Z", "message": "Handle delete intent with broadcast receiver\n\n* Using activities for handling delete can end on some weird behavior on the UI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49d42e0ff58f64fdc713231941669c08a47a576d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/49d42e0ff58f64fdc713231941669c08a47a576d", "committedDate": "2020-11-04T03:12:40Z", "message": "Handle delete intent with broadcast receiver\n\n* Using activities for handling delete can end on some weird behaviour on the UI"}, "afterCommit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/211e23d61d7501a4a269dade0a7f523d383d2a17", "committedDate": "2020-11-04T03:14:23Z", "message": "Handle delete intent with broadcast receiver\n\n* Using activities for handling delete can end on some weird behavior on the UI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1OTIxNDUz", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#pullrequestreview-525921453", "createdAt": "2020-11-09T04:47:26Z", "commit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNDo0NzoyNlrOHve2sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNToxODoyMVrOHvfSyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU1MDY0Mw==", "bodyText": "Now that this receiver only handles closes this would be a good time to rename it NotificationDismissReceiver", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#discussion_r519550643", "createdAt": "2020-11-09T04:47:26Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/AndroidManifest.xml", "diffHunk": "@@ -92,6 +92,8 @@\n         <activity android:name=\"com.onesignal.PermissionsActivity\"\n                   android:theme=\"@android:style/Theme.Translucent.NoTitleBar\" />\n \n+        <receiver android:name=\"com.onesignal.NotificationOpenedReceiver\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU1MDk3OQ==", "bodyText": "Instead of NotificationOpenedActivity shouldn't this be NotificationOpenedReceiver or NotificationDismissReceiver?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#discussion_r519550979", "createdAt": "2020-11-09T04:49:11Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java", "diffHunk": "@@ -79,6 +79,7 @@\n    public static final String BUNDLE_KEY_ONESIGNAL_DATA = \"onesignalData\";\n \n    private static Class<?> notificationOpenedClass = NotificationOpenedActivity.class;\n+   private static Class<?> notificationCloseClass = NotificationOpenedActivity.class;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU1MTcwOA==", "bodyText": "The more correct terminology would be \"dismissed\" instead of \"closed\" for a notification.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#discussion_r519551708", "createdAt": "2020-11-09T04:52:01Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java", "diffHunk": "@@ -79,6 +79,7 @@\n    public static final String BUNDLE_KEY_ONESIGNAL_DATA = \"onesignalData\";\n \n    private static Class<?> notificationOpenedClass = NotificationOpenedActivity.class;\n+   private static Class<?> notificationCloseClass = NotificationOpenedActivity.class;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU1MDk3OQ=="}, "originalCommit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU1MzUwMg==", "bodyText": "This runtime check was in place since there was a change in a non-major release and we had to support both as someone may not have updated their AndroidManifest.xml.\nWe can now just safely assume NotificationDismissReceiver will always be there now in 4.0.0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#discussion_r519553502", "createdAt": "2020-11-09T04:59:46Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java", "diffHunk": "@@ -92,6 +93,13 @@ private static void setStatics(Context inContext) {\n       currentContext = inContext;\n       packageName = currentContext.getPackageName();\n       contextResources = currentContext.getResources();\n+\n+      PackageManager packageManager = currentContext.getPackageManager();\n+      Intent intent = new Intent(currentContext, NotificationOpenedReceiver.class);\n+      intent.setPackage(currentContext.getPackageName());\n+      if (packageManager.queryBroadcastReceivers(intent, 0).size() > 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU1NzgzMw==", "bodyText": "We can safely remove the openerIsBroadcast check as the open action will always be an Activity", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#discussion_r519557833", "createdAt": "2020-11-09T05:18:21Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java", "diffHunk": "@@ -122,6 +130,16 @@ private static CharSequence getTitle(JSONObject fcmJson) {\n    }\n \n    private static PendingIntent getNewActionPendingIntent(int requestCode, Intent intent) {\n+     return  getNewActionPendingIntent(false, requestCode, intent);\n+   }\n+\n+   /**\n+    * Notification delete is processed by Broadcast Receiver to avoid creation of activities that can end\n+    * on weird UI interaction\n+    */\n+   private static PendingIntent getNewActionPendingIntent(boolean openerIsBroadcast, int requestCode, Intent intent) {\n+      if (openerIsBroadcast)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211e23d61d7501a4a269dade0a7f523d383d2a17"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57a43103f8dbb8649631e4789354263b3692a276", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/57a43103f8dbb8649631e4789354263b3692a276", "committedDate": "2020-11-10T18:44:19Z", "message": "Codereview comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTExMTI0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1192#pullrequestreview-527511124", "createdAt": "2020-11-10T18:51:45Z", "commit": {"oid": "57a43103f8dbb8649631e4789354263b3692a276"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3469, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}