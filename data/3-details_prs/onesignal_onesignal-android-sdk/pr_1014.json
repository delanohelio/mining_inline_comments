{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NTc2Mzc5", "number": 1014, "title": "Implementing new NotificationWillShowInForegroundHandlers", "bodyText": "1 can be implemented through the notification extension service and be known as the ExtNotificationWillShowInForegroundHandler\n\nThis involves a new metadata tag in apps using OneSignal,\nOn init of OneSignal, searches for an extension service file and save the implementations as global handlers to be used throughout OneSignal codebase\n\n\n\nSecond one will be implemented through a public OneSignal setter called setNotificationWillShowInForegroundHandler and is known as the AppNotificationWillShowInForegroundHandler\n\nFrom these handlers a set of new functionality exists now:\n\nThis includes bubbling from ext to app handler to mimic iOS handler before showing notification\nAlso without bubbling a 30 second timeout will begin counting down before showing notification by default\n\n\n\n\n\nRenamed NotificationGenerationJob to OSNotificationGenerationJob\n\n\nTo help keep things private within the handlers, a NotificationGenerationJob class was made to be extended by a ExtNotificationGenerationJob and AppNotificationGenerationJob\n\n\nRemoved what is believed to be final Alert based flow for showing a notification\n\n\nUnit Tests need to be fixed and new ones added still after validating functionality here\n\n\nNext the Work manager should be implemented to process these one at a time as they come in\n\n\n\n\nThis change is\u2002", "createdAt": "2020-05-13T19:50:03Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014", "merged": true, "mergeCommit": {"oid": "0fc61757d7b5b77d0e5412775cadfec6fc8b9a0b"}, "closed": true, "closedAt": "2020-05-21T14:52:51Z", "author": {"login": "mikechoch"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg_xz0gFqTQxMTMwNDUxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcijl4vAH2gAyNDE3NTc2Mzc5OmFjNmRmYmU4ZDRlM2UxYWQwZGM5YWQ0YWQwYWY4NjUyNGZlN2NmZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMzA0NTE1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#pullrequestreview-411304515", "createdAt": "2020-05-13T21:14:33Z", "commit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMToxNDozNFrOGVDxKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMToyOTo1M1rOGVEN5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczNTAxOA==", "bodyText": "reformat code in here, space between if and (", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424735018", "createdAt": "2020-05-13T21:14:34Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -2001,18 +2084,53 @@ public void run() {\n       });\n    }\n \n-   // Called when receiving FCM/ADM message after it has been displayed.\n-   // Or right when it is received if it is a silent one\n-   //   If a NotificationExtenderService is present in the developers app this will not fire for silent notifications.\n-   static void handleNotificationReceived(JSONArray data, boolean displayed) {\n-      OSNotificationOpenResult openResult = generateOsNotificationOpenResult(data, displayed);\n-      if(trackFirebaseAnalytics != null && getFirebaseAnalyticsEnabled())\n-         trackFirebaseAnalytics.trackReceivedEvent(openResult);\n+   /**\n+    * Called when receiving FCM/ADM message after it has been displayed.\n+    * Or right when it is received if it is a silent one\n+    *   If a NotificationExtenderService is present in the developers app this will not fire for silent notifications.\n+    */\n+   static void handleNotificationReceived(OSNotificationGenerationJob notifJob, boolean displayed) {\n+      int androidNotificationId = notifJob.getAndroidId();\n+\n+      try {\n+         JSONObject jsonObject = new JSONObject(notifJob.jsonPayload.toString());\n+         jsonObject.put(\"notificationId\", androidNotificationId);\n+\n+         OSNotificationOpenResult openResult = generateOsNotificationOpenResult(newJsonArray(jsonObject), displayed);\n+         if(trackFirebaseAnalytics != null && getFirebaseAnalyticsEnabled())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 252}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczNzQ5OA==", "bodyText": "something I already should know, but whyt is the generating job need a context?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424737498", "createdAt": "2020-05-13T21:19:33Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -0,0 +1,258 @@\n+/**\n+ * Modified MIT License\n+ *\n+ * Copyright 2017 OneSignal\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * 1. The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * 2. All copies of substantial portions of the Software may only be used in connection\n+ * with services provided by OneSignal.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package com.onesignal;\n+\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.os.Handler;\n+\n+import com.onesignal.OneSignal.OSNotificationDisplay;\n+\n+import org.json.JSONObject;\n+\n+import java.security.SecureRandom;\n+\n+public class OSNotificationGenerationJob {\n+\n+   Context context;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczODEwOA==", "bodyText": "maybe we can start having this strings as constants?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424738108", "createdAt": "2020-05-13T21:20:48Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -0,0 +1,258 @@\n+/**\n+ * Modified MIT License\n+ *\n+ * Copyright 2017 OneSignal\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * 1. The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * 2. All copies of substantial portions of the Software may only be used in connection\n+ * with services provided by OneSignal.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package com.onesignal;\n+\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.os.Handler;\n+\n+import com.onesignal.OneSignal.OSNotificationDisplay;\n+\n+import org.json.JSONObject;\n+\n+import java.security.SecureRandom;\n+\n+public class OSNotificationGenerationJob {\n+\n+   Context context;\n+   JSONObject jsonPayload;\n+   boolean isRestoring;\n+   boolean isIamPreview;\n+   OSNotificationDisplay displayOption = OSNotificationDisplay.NOTIFICATION;\n+\n+   Long shownTimeStamp;\n+\n+   CharSequence overriddenBodyFromExtender;\n+   CharSequence overriddenTitleFromExtender;\n+   Uri overriddenSound;\n+   Integer overriddenFlags;\n+   Integer orgFlags;\n+   Uri orgSound;\n+\n+   NotificationExtenderService.OverrideSettings overrideSettings;\n+\n+   OSNotificationGenerationJob(Context context) {\n+      this.context = context;\n+   }\n+\n+   CharSequence getTitle() {\n+      if (overriddenTitleFromExtender != null)\n+         return overriddenTitleFromExtender;\n+      return jsonPayload.optString(\"title\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczODg1Ng==", "bodyText": "make sense to change it to 2020?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424738856", "createdAt": "2020-05-13T21:22:24Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -0,0 +1,258 @@\n+/**\n+ * Modified MIT License\n+ *\n+ * Copyright 2017 OneSignal", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczOTUxNA==", "bodyText": "Without no camelcase", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424739514", "createdAt": "2020-05-13T21:23:48Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -0,0 +1,258 @@\n+/**\n+ * Modified MIT License\n+ *\n+ * Copyright 2017 OneSignal\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * 1. The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * 2. All copies of substantial portions of the Software may only be used in connection\n+ * with services provided by OneSignal.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package com.onesignal;\n+\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.os.Handler;\n+\n+import com.onesignal.OneSignal.OSNotificationDisplay;\n+\n+import org.json.JSONObject;\n+\n+import java.security.SecureRandom;\n+\n+public class OSNotificationGenerationJob {\n+\n+   Context context;\n+   JSONObject jsonPayload;\n+   boolean isRestoring;\n+   boolean isIamPreview;\n+   OSNotificationDisplay displayOption = OSNotificationDisplay.NOTIFICATION;\n+\n+   Long shownTimeStamp;\n+\n+   CharSequence overriddenBodyFromExtender;\n+   CharSequence overriddenTitleFromExtender;\n+   Uri overriddenSound;\n+   Integer overriddenFlags;\n+   Integer orgFlags;\n+   Uri orgSound;\n+\n+   NotificationExtenderService.OverrideSettings overrideSettings;\n+\n+   OSNotificationGenerationJob(Context context) {\n+      this.context = context;\n+   }\n+\n+   CharSequence getTitle() {\n+      if (overriddenTitleFromExtender != null)\n+         return overriddenTitleFromExtender;\n+      return jsonPayload.optString(\"title\", null);\n+   }\n+   \n+   CharSequence getBody() {\n+      if (overriddenBodyFromExtender != null)\n+         return overriddenBodyFromExtender;\n+      return jsonPayload.optString(\"alert\", null);\n+   }\n+   \n+   Integer getAndroidId() {\n+      if (overrideSettings == null)\n+         overrideSettings = new NotificationExtenderService.OverrideSettings();\n+      if (overrideSettings.androidNotificationId == null)\n+         overrideSettings.androidNotificationId = new SecureRandom().nextInt();\n+      \n+      return overrideSettings.androidNotificationId;\n+   }\n+\n+   int getAndroidIdWithoutCreate() {\n+      if (overrideSettings == null || overrideSettings.androidNotificationId == null)\n+         return -1;\n+\n+      return overrideSettings.androidNotificationId;\n+   }\n+\n+   /**\n+    * If notificationId is -1 then the notification is a silent one\n+    */\n+   boolean isNotificationToDisplay() {\n+      return getAndroidIdWithoutCreate() != -1;\n+   }\n+\n+   String getApiNotificationId() {\n+      return OneSignal.getNotificationIdFromFCMJson(jsonPayload);\n+   }\n+\n+   void setAndroidIdWithOutOverriding(Integer id) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0MDQ1Mg==", "bodyText": "maybe setAndroidIdOnOverrideSettings?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424740452", "createdAt": "2020-05-13T21:25:38Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -0,0 +1,258 @@\n+/**\n+ * Modified MIT License\n+ *\n+ * Copyright 2017 OneSignal\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * 1. The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * 2. All copies of substantial portions of the Software may only be used in connection\n+ * with services provided by OneSignal.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package com.onesignal;\n+\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.os.Handler;\n+\n+import com.onesignal.OneSignal.OSNotificationDisplay;\n+\n+import org.json.JSONObject;\n+\n+import java.security.SecureRandom;\n+\n+public class OSNotificationGenerationJob {\n+\n+   Context context;\n+   JSONObject jsonPayload;\n+   boolean isRestoring;\n+   boolean isIamPreview;\n+   OSNotificationDisplay displayOption = OSNotificationDisplay.NOTIFICATION;\n+\n+   Long shownTimeStamp;\n+\n+   CharSequence overriddenBodyFromExtender;\n+   CharSequence overriddenTitleFromExtender;\n+   Uri overriddenSound;\n+   Integer overriddenFlags;\n+   Integer orgFlags;\n+   Uri orgSound;\n+\n+   NotificationExtenderService.OverrideSettings overrideSettings;\n+\n+   OSNotificationGenerationJob(Context context) {\n+      this.context = context;\n+   }\n+\n+   CharSequence getTitle() {\n+      if (overriddenTitleFromExtender != null)\n+         return overriddenTitleFromExtender;\n+      return jsonPayload.optString(\"title\", null);\n+   }\n+   \n+   CharSequence getBody() {\n+      if (overriddenBodyFromExtender != null)\n+         return overriddenBodyFromExtender;\n+      return jsonPayload.optString(\"alert\", null);\n+   }\n+   \n+   Integer getAndroidId() {\n+      if (overrideSettings == null)\n+         overrideSettings = new NotificationExtenderService.OverrideSettings();\n+      if (overrideSettings.androidNotificationId == null)\n+         overrideSettings.androidNotificationId = new SecureRandom().nextInt();\n+      \n+      return overrideSettings.androidNotificationId;\n+   }\n+\n+   int getAndroidIdWithoutCreate() {\n+      if (overrideSettings == null || overrideSettings.androidNotificationId == null)\n+         return -1;\n+\n+      return overrideSettings.androidNotificationId;\n+   }\n+\n+   /**\n+    * If notificationId is -1 then the notification is a silent one\n+    */\n+   boolean isNotificationToDisplay() {\n+      return getAndroidIdWithoutCreate() != -1;\n+   }\n+\n+   String getApiNotificationId() {\n+      return OneSignal.getNotificationIdFromFCMJson(jsonPayload);\n+   }\n+\n+   void setAndroidIdWithOutOverriding(Integer id) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczOTUxNA=="}, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0MTE1OA==", "bodyText": "can this method be called more than once? and have overridden the handler?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424741158", "createdAt": "2020-05-13T21:27:09Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -0,0 +1,258 @@\n+/**\n+ * Modified MIT License\n+ *\n+ * Copyright 2017 OneSignal\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * 1. The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * 2. All copies of substantial portions of the Software may only be used in connection\n+ * with services provided by OneSignal.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package com.onesignal;\n+\n+\n+import android.content.Context;\n+import android.net.Uri;\n+import android.os.Handler;\n+\n+import com.onesignal.OneSignal.OSNotificationDisplay;\n+\n+import org.json.JSONObject;\n+\n+import java.security.SecureRandom;\n+\n+public class OSNotificationGenerationJob {\n+\n+   Context context;\n+   JSONObject jsonPayload;\n+   boolean isRestoring;\n+   boolean isIamPreview;\n+   OSNotificationDisplay displayOption = OSNotificationDisplay.NOTIFICATION;\n+\n+   Long shownTimeStamp;\n+\n+   CharSequence overriddenBodyFromExtender;\n+   CharSequence overriddenTitleFromExtender;\n+   Uri overriddenSound;\n+   Integer overriddenFlags;\n+   Integer orgFlags;\n+   Uri orgSound;\n+\n+   NotificationExtenderService.OverrideSettings overrideSettings;\n+\n+   OSNotificationGenerationJob(Context context) {\n+      this.context = context;\n+   }\n+\n+   CharSequence getTitle() {\n+      if (overriddenTitleFromExtender != null)\n+         return overriddenTitleFromExtender;\n+      return jsonPayload.optString(\"title\", null);\n+   }\n+   \n+   CharSequence getBody() {\n+      if (overriddenBodyFromExtender != null)\n+         return overriddenBodyFromExtender;\n+      return jsonPayload.optString(\"alert\", null);\n+   }\n+   \n+   Integer getAndroidId() {\n+      if (overrideSettings == null)\n+         overrideSettings = new NotificationExtenderService.OverrideSettings();\n+      if (overrideSettings.androidNotificationId == null)\n+         overrideSettings.androidNotificationId = new SecureRandom().nextInt();\n+      \n+      return overrideSettings.androidNotificationId;\n+   }\n+\n+   int getAndroidIdWithoutCreate() {\n+      if (overrideSettings == null || overrideSettings.androidNotificationId == null)\n+         return -1;\n+\n+      return overrideSettings.androidNotificationId;\n+   }\n+\n+   /**\n+    * If notificationId is -1 then the notification is a silent one\n+    */\n+   boolean isNotificationToDisplay() {\n+      return getAndroidIdWithoutCreate() != -1;\n+   }\n+\n+   String getApiNotificationId() {\n+      return OneSignal.getNotificationIdFromFCMJson(jsonPayload);\n+   }\n+\n+   void setAndroidIdWithOutOverriding(Integer id) {\n+      if (id == null)\n+         return;\n+\n+      if (overrideSettings != null && overrideSettings.androidNotificationId != null)\n+         return;\n+\n+      if (overrideSettings == null)\n+         overrideSettings = new NotificationExtenderService.OverrideSettings();\n+      overrideSettings.androidNotificationId = id;\n+   }\n+\n+   boolean hasExtender() {\n+      return overrideSettings != null && overrideSettings.extender != null;\n+   }\n+\n+   private void setNotificationDisplayOption(OSNotificationDisplay displayOption) {\n+      this.displayOption = displayOption;\n+   }\n+\n+   ExtNotificationGenerationJob toExtNotificationGenerationJob() {\n+      return new ExtNotificationGenerationJob(this);\n+   }\n+\n+   AppNotificationGenerationJob toAppNotificationGenerationJob() {\n+      return new AppNotificationGenerationJob(this);\n+   }\n+\n+   /**\n+    * A wrapper for the {@link OSNotificationGenerationJob}\n+    * Contains two other classes which implement this one {@link NotificationGenerationJob}:\n+    *    1. {@link ExtNotificationGenerationJob}\n+    *    2. {@link AppNotificationGenerationJob}\n+    */\n+   private static class NotificationGenerationJob {\n+\n+      // Timeout in seconds before applying defaults\n+      private static final long SHOW_NOTIFICATION_TIMEOUT = 30 * 1_000L;\n+\n+      // The actual notifJob with notification payload data\n+      private OSNotificationGenerationJob notifJob;\n+\n+      // Handler used to timeout the handler if bubble or complete is not called\n+      private Handler timeoutHandler;\n+\n+      NotificationGenerationJob(OSNotificationGenerationJob notifJob) {\n+         this.notifJob = notifJob;\n+      }\n+\n+      void startShowNotificationTimeout(final Runnable timeoutRunnable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 152}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0MjM3Mg==", "bodyText": "does it make sense to start having this string as constant?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1014#discussion_r424742372", "createdAt": "2020-05-13T21:29:53Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -2001,18 +2084,53 @@ public void run() {\n       });\n    }\n \n-   // Called when receiving FCM/ADM message after it has been displayed.\n-   // Or right when it is received if it is a silent one\n-   //   If a NotificationExtenderService is present in the developers app this will not fire for silent notifications.\n-   static void handleNotificationReceived(JSONArray data, boolean displayed) {\n-      OSNotificationOpenResult openResult = generateOsNotificationOpenResult(data, displayed);\n-      if(trackFirebaseAnalytics != null && getFirebaseAnalyticsEnabled())\n-         trackFirebaseAnalytics.trackReceivedEvent(openResult);\n+   /**\n+    * Called when receiving FCM/ADM message after it has been displayed.\n+    * Or right when it is received if it is a silent one\n+    *   If a NotificationExtenderService is present in the developers app this will not fire for silent notifications.\n+    */\n+   static void handleNotificationReceived(OSNotificationGenerationJob notifJob, boolean displayed) {\n+      int androidNotificationId = notifJob.getAndroidId();\n+\n+      try {\n+         JSONObject jsonObject = new JSONObject(notifJob.jsonPayload.toString());\n+         jsonObject.put(\"notificationId\", androidNotificationId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96b76cabea3f4854b03c5cf19e459ef19adafef"}, "originalPosition": 249}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93c0f392864022716ef5284eeb74baf79842d383", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/93c0f392864022716ef5284eeb74baf79842d383", "committedDate": "2020-05-15T00:02:25Z", "message": "Refactor prep for `InFocusDisplayOption` in `NotifForegroundHandler`\n* `NotificationWillShowInForegroundHandler` will be responsible for setting the notifications display type if a dev decides so\n  * Alternative is a global setter that also controls the default for `OSNotificationDisplay` if no `NotificationWillShowInForegroundHandler` is set\n  * Renamed `None` to `SILENT` and `Notification` to `NOTIFICATION` to follow a caps snake-case enum convention\n* Removed `InAppAlert` from `InFocusDisplayOption`\n  * Refactored `InFocusDisplayOption` to `OSNotificationDisplay`\n  * Cleaned out `InAppAlert` related `UnitTests`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd08bbc2870db30c410205161c45a2c1969a3af5", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/dd08bbc2870db30c410205161c45a2c1969a3af5", "committedDate": "2020-05-15T00:11:35Z", "message": "Implementing new NotificationWillShowInForegroundHandlers\n  * 1 can be implemented through the notification extension service and be known as the `ExtNotificationWillShowInForegroundHandler`\n    * This involves a new metadata tag in apps using OneSignal,\n    * On init of OneSignal, searches for an extension service file and save the implementations as global handlers to be used throughout OneSignal codebase\n  * Second one will be implemented through a public OneSignal setter called `setNotificationWillShowInForegroundHandler` and is known as the `AppNotificationWillShowInForegroundHandler`\n    * From these handlers a set of new functionality exists now:\n      * This includes bubbling from ext to app handler to mimic iOS handler before showing notification\n      * Also without bubbling a 30 second timeout will begin counting down before showing notification by default\n  * Renamed `NotificationGenerationJob` to `OSNotificationGenerationJob`\n  * To help keep things private within the handlers, a `NotificationGenerationJob` class was made to be extended by a `ExtNotificationGenerationJob` and `AppNotificationGenerationJob`\n* Removed what is believed to be final Alert based flow for showing a notification\n\n* Unit Tests need to be fixed and new ones added still after validating functionality here\n* Next the Work manager should be implemented to process these one at a time as they come in"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecaa78d7b8228838cd61d9743aca62dd6c94d09e", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ecaa78d7b8228838cd61d9743aca62dd6c94d09e", "committedDate": "2020-05-15T00:11:35Z", "message": "Fixing review comments\n* Refactored `bubble(boolean bubble)` method to `complete(boolean bubble)`\n* Added additional data getter for `OSNotificationGenerationJob`\n* Added constant keys for params in notification payload\n* Removed `OneSignal.setNotificationDisplayOption` and other related fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e29c87b415ec015ea30b1eeeb3c9357e5d30fd3", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/9e29c87b415ec015ea30b1eeeb3c9357e5d30fd3", "committedDate": "2020-05-18T17:31:51Z", "message": "Cleaned up previous commit(s) for this PR\n* UnitTests failing, needed to rework notification display flow a little\n* Removed more Alert based notification code `showNotificationAsAlert`\n* Refactored `ProcessJobForDisplay` to perfection in terms of mimic'ing current master implementation but removing Alert based handling and including new `NotificationWillShowInForegroundHandler`\n* Replaced method `NotificationExtenderService.showNotification` with `GenerateNotification.fromJsonPayload`\n* Removed `OSNotificationGenerationJob` from PackagePrivate helper file because it is public already\n\nDone with fixing unit tests and getting functionality matching previous NotificationReceivedHandler SDK functionality\n* WIP - Need to write new unit tests to test new functionality, this will go in a new PR branched off this PR branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a65324a5a45e0b607a885706f63b17c41469155f", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a65324a5a45e0b607a885706f63b17c41469155f", "committedDate": "2020-05-14T04:09:08Z", "message": "Fixing review comments\n* Refactored `bubble(boolean bubble)` method to `complete(boolean bubble)`\n* Added additional data getter for `OSNotificationGenerationJob`\n* Added constant keys for params in notification payload\n* Removed `OneSignal.setNotificationDisplayOption` and other related fields"}, "afterCommit": {"oid": "9e29c87b415ec015ea30b1eeeb3c9357e5d30fd3", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/9e29c87b415ec015ea30b1eeeb3c9357e5d30fd3", "committedDate": "2020-05-18T17:31:51Z", "message": "Cleaned up previous commit(s) for this PR\n* UnitTests failing, needed to rework notification display flow a little\n* Removed more Alert based notification code `showNotificationAsAlert`\n* Refactored `ProcessJobForDisplay` to perfection in terms of mimic'ing current master implementation but removing Alert based handling and including new `NotificationWillShowInForegroundHandler`\n* Replaced method `NotificationExtenderService.showNotification` with `GenerateNotification.fromJsonPayload`\n* Removed `OSNotificationGenerationJob` from PackagePrivate helper file because it is public already\n\nDone with fixing unit tests and getting functionality matching previous NotificationReceivedHandler SDK functionality\n* WIP - Need to write new unit tests to test new functionality, this will go in a new PR branched off this PR branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac6dfbe8d4e3e1ad0dc9ad4ad0af86524fe7cffd", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ac6dfbe8d4e3e1ad0dc9ad4ad0af86524fe7cffd", "committedDate": "2020-05-18T17:47:34Z", "message": "Removed Thread for `ProcessJobForDisplay` to fix UnitTests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3564, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}