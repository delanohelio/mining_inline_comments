{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Nzk4NTA4", "number": 1042, "title": "Refactor Outcome module to Kotlin", "bodyText": "Change outcome module classes from java to kotlin\n\n\n\nThis change is\u2002", "createdAt": "2020-06-02T19:57:07Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1042", "merged": true, "mergeCommit": {"oid": "955f8f9696d938dd68b063a70a1bd0a7dbd0f527"}, "closed": true, "closedAt": "2020-08-10T18:01:30Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcna5aNABqjMzOTkzNjM0Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8TEFqAFqTQ2MjcxNzgwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5cbda981db25e2eebb79b07bb1dc1e1b6000187d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5cbda981db25e2eebb79b07bb1dc1e1b6000187d", "committedDate": "2020-06-02T19:54:45Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}, "afterCommit": {"oid": "a95e27bb47d93f996fdd300cfb5989997bbb5497", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a95e27bb47d93f996fdd300cfb5989997bbb5497", "committedDate": "2020-06-02T20:29:07Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a95e27bb47d93f996fdd300cfb5989997bbb5497", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a95e27bb47d93f996fdd300cfb5989997bbb5497", "committedDate": "2020-06-02T20:29:07Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}, "afterCommit": {"oid": "5c923b8f665dc00b6d9a47ce2786bdf8f3aa5985", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5c923b8f665dc00b6d9a47ce2786bdf8f3aa5985", "committedDate": "2020-06-03T18:29:34Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODQzMzA4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1042#pullrequestreview-453843308", "createdAt": "2020-07-23T05:27:36Z", "commit": {"oid": "5c923b8f665dc00b6d9a47ce2786bdf8f3aa5985"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNToyNzozNlrOG18pBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNToyNzozNlrOG18pBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIyMTI1NA==", "bodyText": "Might be better to use just object so there isn't a companion object under the hood.\nhttps://stackoverflow.com/a/50520935\n@Jeasmine Thoughts on this?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1042#discussion_r459221254", "createdAt": "2020-07-23T05:27:36Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/outcomes/OSOutcomeEventsV1Repository.kt", "diffHunk": "@@ -0,0 +1,69 @@\n+package com.onesignal.outcomes\n+\n+import com.onesignal.OSLogger\n+import com.onesignal.OneSignalApiResponseHandler\n+import com.onesignal.OutcomeEvent\n+import com.onesignal.influence.model.OSInfluenceType\n+import com.onesignal.outcomes.domain.OutcomeEventsService\n+import com.onesignal.outcomes.model.OSOutcomeEventParams\n+import org.json.JSONException\n+\n+internal class OSOutcomeEventsV1Repository(logger: OSLogger,\n+                                           outcomeEventsCache: OSOutcomeEventsCache,\n+                                           outcomeEventsService: OutcomeEventsService) : OSOutcomeEventsRepository(logger, outcomeEventsCache, outcomeEventsService) {\n+    override fun requestMeasureOutcomeEvent(appId: String, deviceType: Int, eventParams: OSOutcomeEventParams, responseHandler: OneSignalApiResponseHandler) {\n+        val event = OutcomeEvent.fromOutcomeEventParamsV2toOutcomeEventV1(eventParams)\n+        when (event.session) {\n+            OSInfluenceType.DIRECT -> requestMeasureDirectOutcomeEvent(appId, deviceType, event, responseHandler)\n+            OSInfluenceType.INDIRECT -> requestMeasureIndirectOutcomeEvent(appId, deviceType, event, responseHandler)\n+            OSInfluenceType.UNATTRIBUTED -> requestMeasureUnattributedOutcomeEvent(appId, deviceType, event, responseHandler)\n+            else -> {\n+            }\n+        }\n+    }\n+\n+    private fun requestMeasureDirectOutcomeEvent(appId: String, deviceType: Int, event: OutcomeEvent, responseHandler: OneSignalApiResponseHandler) {\n+        try {\n+            event.toJSONObjectForMeasure()\n+                    .put(APP_ID, appId)\n+                    .put(DEVICE_TYPE, deviceType)\n+                    .put(DIRECT, true)\n+                    .also { jsonObject ->\n+                        outcomeEventsService.sendOutcomeEvent(jsonObject, responseHandler)\n+                    }\n+        } catch (e: JSONException) {\n+            logger.error(\"Generating direct outcome:JSON Failed.\", e)\n+        }\n+    }\n+\n+    private fun requestMeasureIndirectOutcomeEvent(appId: String, deviceType: Int, event: OutcomeEvent, responseHandler: OneSignalApiResponseHandler) {\n+        try {\n+            event.toJSONObjectForMeasure()\n+                    .put(APP_ID, appId)\n+                    .put(DEVICE_TYPE, deviceType)\n+                    .put(DIRECT, false)\n+                    .also { jsonObject ->\n+                        outcomeEventsService.sendOutcomeEvent(jsonObject, responseHandler)\n+                    }\n+        } catch (e: JSONException) {\n+            logger.error(\"Generating indirect outcome:JSON Failed.\", e)\n+        }\n+    }\n+\n+    private fun requestMeasureUnattributedOutcomeEvent(appId: String, deviceType: Int, event: OutcomeEvent, responseHandler: OneSignalApiResponseHandler) {\n+        try {\n+            event.toJSONObjectForMeasure()\n+                    .put(APP_ID, appId)\n+                    .put(DEVICE_TYPE, deviceType)\n+                    .also { jsonObject ->\n+                        outcomeEventsService.sendOutcomeEvent(jsonObject, responseHandler)\n+                    }\n+        } catch (e: JSONException) {\n+            logger.error(\"Generating unattributed outcome:JSON Failed.\", e)\n+        }\n+    }\n+\n+    companion object {\n+        private const val DIRECT = \"direct\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c923b8f665dc00b6d9a47ce2786bdf8f3aa5985"}, "originalPosition": 67}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c923b8f665dc00b6d9a47ce2786bdf8f3aa5985", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5c923b8f665dc00b6d9a47ce2786bdf8f3aa5985", "committedDate": "2020-06-03T18:29:34Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}, "afterCommit": {"oid": "6a6962070f5b07f7bf324ba1ad78fa1f961683f4", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/6a6962070f5b07f7bf324ba1ad78fa1f961683f4", "committedDate": "2020-07-27T21:16:03Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a6962070f5b07f7bf324ba1ad78fa1f961683f4", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/6a6962070f5b07f7bf324ba1ad78fa1f961683f4", "committedDate": "2020-07-27T21:16:03Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}, "afterCommit": {"oid": "ced5c337e2f5b6b5c946c652e4fb8ca43aba889a", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ced5c337e2f5b6b5c946c652e4fb8ca43aba889a", "committedDate": "2020-07-29T00:15:10Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ced5c337e2f5b6b5c946c652e4fb8ca43aba889a", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ced5c337e2f5b6b5c946c652e4fb8ca43aba889a", "committedDate": "2020-07-29T00:15:10Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}, "afterCommit": {"oid": "5793adb452c4be22a2625a8604ceabb6f853109b", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5793adb452c4be22a2625a8604ceabb6f853109b", "committedDate": "2020-07-29T00:27:41Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcac3551abc103dd77ae4d9fef572d50272df855", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/fcac3551abc103dd77ae4d9fef572d50272df855", "committedDate": "2020-07-29T00:35:06Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5793adb452c4be22a2625a8604ceabb6f853109b", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5793adb452c4be22a2625a8604ceabb6f853109b", "committedDate": "2020-07-29T00:27:41Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}, "afterCommit": {"oid": "fcac3551abc103dd77ae4d9fef572d50272df855", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/fcac3551abc103dd77ae4d9fef572d50272df855", "committedDate": "2020-07-29T00:35:06Z", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzkxMDc1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1042#pullrequestreview-460391075", "createdAt": "2020-08-03T22:57:48Z", "commit": {"oid": "fcac3551abc103dd77ae4d9fef572d50272df855"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNzE3ODA0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1042#pullrequestreview-462717804", "createdAt": "2020-08-06T17:14:12Z", "commit": {"oid": "fcac3551abc103dd77ae4d9fef572d50272df855"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3586, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}