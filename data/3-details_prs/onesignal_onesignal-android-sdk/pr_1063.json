{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMDE3MTMz", "number": 1063, "title": "Hms device type fallback logic", "bodyText": "Fallback detection for Huawei device if no HMS SDK\nWe should still detect a real Huawei with HMS only as device_type 13 even if there is no HMS library in the app.\nAdded missing HMS PushKit library detection\nNow correctly reports missing HMS PushKit library if app is running on an HMS only device.\n\nThis change is\u2002", "createdAt": "2020-06-11T11:34:03Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063", "merged": true, "mergeCommit": {"oid": "2e37f5b708ccdc37c48bc0997b57f2a6dd1ca26e"}, "closed": true, "closedAt": "2020-06-12T11:30:36Z", "author": {"login": "jkasten2"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqMMsxAH2gAyNDMzMDE3MTMzOmNkZjZiNzliOTMyZWY2OTMyYWM2ZmU2NWQ0YTZlOGQ3MTgwODEzMGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqhGUMAFqTQyOTY2NTMyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cdf6b79b932ef6932ac6fe65d4a6e8d71808130a", "author": {"user": {"login": "jkasten2", "name": "Josh Kasten"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/cdf6b79b932ef6932ac6fe65d4a6e8d71808130a", "committedDate": "2020-06-11T11:03:38Z", "message": "Fallback detection for Huawei device if no HMS SDK\n\n* We should still detect a real Huawei with HMS only as\ndevice_type 13 even if there is no HMS library in the app."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092", "author": {"user": {"login": "jkasten2", "name": "Josh Kasten"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/efebaef3a94885aac3795b0e94fc47c66d45a092", "committedDate": "2020-06-11T11:33:19Z", "message": "Added missing HMS PushKit library detection\n\n* Now correctly handles reporting missing HMS PushKit library if app\nis running on an HMS only device."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTMwOTUy", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#pullrequestreview-428930952", "createdAt": "2020-06-11T13:47:33Z", "commit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo0NzozM1rOGieD5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1Mjo1OFrOGieYDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5NzI4NQ==", "bodyText": "Should we keep this as Throwable or find the specific Exception(s)?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438797285", "createdAt": "2020-06-11T13:47:33Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSUtils.java", "diffHunk": "@@ -170,6 +170,21 @@ private boolean hasHMSPushKitLibrary() {\n       }\n    }\n \n+   private static boolean hasHMSAGConnectLibrary() {\n+      try {\n+         // noinspection ConstantConditions\n+         return com.huawei.agconnect.config.AGConnectServicesConfig.class != null;\n+      } catch (Throwable e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5ODU0OA==", "bodyText": "Remove empty line", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438798548", "createdAt": "2020-06-11T13:48:57Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSUtils.java", "diffHunk": "@@ -310,13 +336,22 @@ int getDeviceType() {\n \n       if (supportsGooglePush())\n          return UserState.DEVICE_TYPE_ANDROID;\n-      else {\n-         // If the Huawei device has both FCM & HMS support we prefer FCM (Google push)\n-         // HMS will only be used if it is the only option.\n-         if (supportsHMS())\n-            return UserState.DEVICE_TYPE_HUAWEI;\n-      }\n \n+      // Some Huawei devices have both FCM & HMS support, but prefer FCM (Google push) over HMS\n+      if (supportsHMS())\n+         return UserState.DEVICE_TYPE_HUAWEI;\n+\n+      // Start - Fallback logic\n+      //    Libraries in the app (Google:FCM, HMS:PushKit) + Device may not have a valid combo\n+      // Example: App with only the FCM library in it and a Huawei device with only HMS Core\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5OTUxOQ==", "bodyText": "What do you mean \"If here is required\"?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438799519", "createdAt": "2020-06-11T13:49:58Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/PushRegistratorHMS.java", "diffHunk": "@@ -53,8 +53,12 @@ public void run() {\n     }\r\n \r\n     private synchronized void getHMSTokenTask(@NonNull Context context, @NonNull RegisteredHandler callback) throws ApiException {\r\n-        // TODO: See if we can handle an exact message like this\r\n-        // 2020-04-14 23:06:36.164 1565-1743/com.onesignal.example E/HMSSDK_Util: In getMetaDataAppId, Failed to read meta data for the AppID.\r\n+        // If here is required to prevent AGConnectServicesConfig or HmsInstanceId used below\r\n+        //   from throwing a ClassNotFoundException\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwMTU0OQ==", "bodyText": "Add past tense hasAllRecommendHMSLibraries to hasAllRecommendedHMSLibraries?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438801549", "createdAt": "2020-06-11T13:52:06Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/unittest/src/test/java/com/onesignal/ShadowOSUtils.java", "diffHunk": "@@ -32,21 +32,36 @@ public static boolean isGMSInstalledAndEnabled() {\n \n    // Huawei: HMS\n    public static boolean hasHMSAvailability;\n-   public boolean hasHMSAvailability() {\n+   public static boolean hasHMSAvailability() {\n       return hasHMSAvailability;\n    }\n    public static boolean hasHMSPushKitLibrary;\n-   public boolean hasHMSPushKitLibrary() {\n+   public static boolean hasHMSPushKitLibrary() {\n       return hasHMSPushKitLibrary;\n    }\n+   public static boolean hasHMSAGConnectLibrary;\n+   public static boolean hasHMSAGConnectLibrary() {\n+      return hasHMSAGConnectLibrary;\n+   }\n+\n    public static boolean isHMSCoreInstalledAndEnabled;\n    public static boolean isHMSCoreInstalledAndEnabled() {\n       return isHMSCoreInstalledAndEnabled;\n    }\n+   public static boolean isHMSCoreInstalledAndEnabledFallback() {\n+      return isHMSCoreInstalledAndEnabled;\n+   }\n+\n+   public static void hasAllRecommendHMSLibraries(boolean value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwMTkwNQ==", "bodyText": "recommend should be recommended?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438801905", "createdAt": "2020-06-11T13:52:27Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/unittest/src/test/java/com/onesignal/ShadowOSUtils.java", "diffHunk": "@@ -32,21 +32,36 @@ public static boolean isGMSInstalledAndEnabled() {\n \n    // Huawei: HMS\n    public static boolean hasHMSAvailability;\n-   public boolean hasHMSAvailability() {\n+   public static boolean hasHMSAvailability() {\n       return hasHMSAvailability;\n    }\n    public static boolean hasHMSPushKitLibrary;\n-   public boolean hasHMSPushKitLibrary() {\n+   public static boolean hasHMSPushKitLibrary() {\n       return hasHMSPushKitLibrary;\n    }\n+   public static boolean hasHMSAGConnectLibrary;\n+   public static boolean hasHMSAGConnectLibrary() {\n+      return hasHMSAGConnectLibrary;\n+   }\n+\n    public static boolean isHMSCoreInstalledAndEnabled;\n    public static boolean isHMSCoreInstalledAndEnabled() {\n       return isHMSCoreInstalledAndEnabled;\n    }\n+   public static boolean isHMSCoreInstalledAndEnabledFallback() {\n+      return isHMSCoreInstalledAndEnabled;\n+   }\n+\n+   public static void hasAllRecommendHMSLibraries(boolean value) {\n+      // required\n+      hasHMSPushKitLibrary = value;\n+      hasHMSAGConnectLibrary = value;\n+      // recommend", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwMjM1Mg==", "bodyText": "Add a new line above to space out the methods?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438802352", "createdAt": "2020-06-11T13:52:52Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/unittest/src/test/java/com/onesignal/ShadowOSUtils.java", "diffHunk": "@@ -32,21 +32,36 @@ public static boolean isGMSInstalledAndEnabled() {\n \n    // Huawei: HMS\n    public static boolean hasHMSAvailability;\n-   public boolean hasHMSAvailability() {\n+   public static boolean hasHMSAvailability() {\n       return hasHMSAvailability;\n    }\n    public static boolean hasHMSPushKitLibrary;\n-   public boolean hasHMSPushKitLibrary() {\n+   public static boolean hasHMSPushKitLibrary() {\n       return hasHMSPushKitLibrary;\n    }\n+   public static boolean hasHMSAGConnectLibrary;\n+   public static boolean hasHMSAGConnectLibrary() {\n+      return hasHMSAGConnectLibrary;\n+   }\n+\n    public static boolean isHMSCoreInstalledAndEnabled;\n    public static boolean isHMSCoreInstalledAndEnabled() {\n       return isHMSCoreInstalledAndEnabled;\n    }\n+   public static boolean isHMSCoreInstalledAndEnabledFallback() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwMjM5Mg==", "bodyText": "Add a new line above to space out the methods?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438802392", "createdAt": "2020-06-11T13:52:55Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/unittest/src/test/java/com/onesignal/ShadowOSUtils.java", "diffHunk": "@@ -32,21 +32,36 @@ public static boolean isGMSInstalledAndEnabled() {\n \n    // Huawei: HMS\n    public static boolean hasHMSAvailability;\n-   public boolean hasHMSAvailability() {\n+   public static boolean hasHMSAvailability() {\n       return hasHMSAvailability;\n    }\n    public static boolean hasHMSPushKitLibrary;\n-   public boolean hasHMSPushKitLibrary() {\n+   public static boolean hasHMSPushKitLibrary() {\n       return hasHMSPushKitLibrary;\n    }\n+   public static boolean hasHMSAGConnectLibrary;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwMjQ0NA==", "bodyText": "Add a new line above to space out the methods?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#discussion_r438802444", "createdAt": "2020-06-11T13:52:58Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/unittest/src/test/java/com/onesignal/ShadowOSUtils.java", "diffHunk": "@@ -32,21 +32,36 @@ public static boolean isGMSInstalledAndEnabled() {\n \n    // Huawei: HMS\n    public static boolean hasHMSAvailability;\n-   public boolean hasHMSAvailability() {\n+   public static boolean hasHMSAvailability() {\n       return hasHMSAvailability;\n    }\n    public static boolean hasHMSPushKitLibrary;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MDQ1NDk4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#pullrequestreview-429045498", "createdAt": "2020-06-11T15:43:00Z", "commit": {"oid": "efebaef3a94885aac3795b0e94fc47c66d45a092"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8b2150c688e8cb041f12548078ed6097357a468", "author": {"user": {"login": "jkasten2", "name": "Josh Kasten"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/e8b2150c688e8cb041f12548078ed6097357a468", "committedDate": "2020-06-12T11:00:02Z", "message": "Comment, naming, and spacing clean up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NjY1MzI1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1063#pullrequestreview-429665325", "createdAt": "2020-06-12T11:24:40Z", "commit": {"oid": "e8b2150c688e8cb041f12548078ed6097357a468"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3610, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}