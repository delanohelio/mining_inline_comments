{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NTk2MTA1", "number": 967, "title": "Add push prompt handling for IAM clicks", "bodyText": "Add prompt to IAM action\nShow iOS prompt for location permission\nAdd test for prompt\n\n\n\nThis change is\u2002", "createdAt": "2020-03-06T02:02:05Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967", "merged": true, "mergeCommit": {"oid": "20c3efae97cb899a641cd2075767914ebb0f948c"}, "closed": true, "closedAt": "2020-03-23T21:47:49Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLIaf7AFqTM3MDY3OTM3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQlLoqABqjMxNTcxOTUzNTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjc5Mzc1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#pullrequestreview-370679375", "createdAt": "2020-03-06T23:07:07Z", "commit": {"oid": "af0bf22f474fd3fadd1dde505101ca7c04f07c88"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMzowNzowN1rOFzKEog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMzowNzowN1rOFzKEog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE4NjcyMg==", "bodyText": "Create a class that handles this and use the constructor for it here and replace this with a one liner", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r389186722", "createdAt": "2020-03-06T23:07:07Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageAction.java", "diffHunk": "@@ -89,6 +99,15 @@\n \n         if (json.has(TAGS))\n             tags = new OSInAppMessageTag(json.getJSONObject(TAGS));\n+\n+        if (json.has(PROMPTS)) {\n+            JSONArray promptsJsonArray = json.getJSONArray(PROMPTS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af0bf22f474fd3fadd1dde505101ca7c04f07c88"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af0bf22f474fd3fadd1dde505101ca7c04f07c88", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/af0bf22f474fd3fadd1dde505101ca7c04f07c88", "committedDate": "2020-03-06T02:01:42Z", "message": "Add push prompt handling for IAM clicks\n\n  * Add prompt to IAM action\n  * Show iOS prompt for location permission\n  * Add test for prompt"}, "afterCommit": {"oid": "d82ec95da9487e5ff9b3d40716ab66590b2e5c90", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d82ec95da9487e5ff9b3d40716ab66590b2e5c90", "committedDate": "2020-03-10T17:09:28Z", "message": "Add push prompt handling for IAM clicks\n\n  * Add prompt to IAM action\n  * Show iOS prompt for location permission\n  * Add test for prompt"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTU5Mzc1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#pullrequestreview-377159375", "createdAt": "2020-03-18T19:09:58Z", "commit": {"oid": "d82ec95da9487e5ff9b3d40716ab66590b2e5c90"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowOTo1OVrOF4TNjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOToxNjo0NFrOF4TbCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3OTM0MQ==", "bodyText": "rename to showPrompts?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r394579341", "createdAt": "2020-03-18T19:09:59Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -286,6 +287,19 @@ void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @No\n         fireClickAction(action);\n     }\n \n+    private void firePrompt(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d82ec95da9487e5ff9b3d40716ab66590b2e5c90"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3OTUwOQ==", "bodyText": "Don't we need to reevaluate IAMs here if no more prompts are left?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r394579509", "createdAt": "2020-03-18T19:10:19Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -286,6 +287,19 @@ void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @No\n         fireClickAction(action);\n     }\n \n+    private void firePrompt(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {\n+        for (OSInAppMessagePrompt prompt : prompts) {\n+            // TODO until we don't fix the activity going forward or back dismissing the IAM, we need to auto dismiss\n+            messageWasDismissed(message);\n+            prompt.handlePrompt(new OneSignal.OperationCompletedCallback() {\n+                @Override\n+                public void completed(boolean result) {\n+                    // TODO take care of multiple prompts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d82ec95da9487e5ff9b3d40716ab66590b2e5c90"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4MDM4OQ==", "bodyText": "Rename to one of these:\nOSPromptCompletionCallback or\nOSPromptActionCompletionCallback or\nOSInAppMessagePromptCompletionCallback or\nOSInAppMessagePromptActionCallback", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r394580389", "createdAt": "2020-03-18T19:11:57Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -3206,4 +3212,7 @@ private static boolean isValidOutcomeEntry(String name) {\n     * End OneSignalOutcome module\n     */\n \n+   interface OperationCompletedCallback {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d82ec95da9487e5ff9b3d40716ab66590b2e5c90"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4MTc3Ng==", "bodyText": "Is the boolean result necessary?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r394581776", "createdAt": "2020-03-18T19:14:47Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -3206,4 +3212,7 @@ private static boolean isValidOutcomeEntry(String name) {\n     * End OneSignalOutcome module\n     */\n \n+   interface OperationCompletedCallback {\n+      void completed(boolean result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d82ec95da9487e5ff9b3d40716ab66590b2e5c90"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4Mjc5NQ==", "bodyText": "If so change name to accepted", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r394582795", "createdAt": "2020-03-18T19:16:44Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -3206,4 +3212,7 @@ private static boolean isValidOutcomeEntry(String name) {\n     * End OneSignalOutcome module\n     */\n \n+   interface OperationCompletedCallback {\n+      void completed(boolean result);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4MTc3Ng=="}, "originalCommit": {"oid": "d82ec95da9487e5ff9b3d40716ab66590b2e5c90"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e864d7e3a6f5a8a06e743597d1365dfb933e57fa", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/e864d7e3a6f5a8a06e743597d1365dfb933e57fa", "committedDate": "2020-03-20T16:13:34Z", "message": "Add multiple prompt handling"}, "afterCommit": {"oid": "1b86e1ab4094c76f9e139f4064624bac00442b63", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1b86e1ab4094c76f9e139f4064624bac00442b63", "committedDate": "2020-03-20T16:24:27Z", "message": "Add multiple prompt handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b86e1ab4094c76f9e139f4064624bac00442b63", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1b86e1ab4094c76f9e139f4064624bac00442b63", "committedDate": "2020-03-20T16:24:27Z", "message": "Add multiple prompt handling"}, "afterCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c05a0b7562431aa76a9d952e093db63e07a3e466", "committedDate": "2020-03-20T18:23:08Z", "message": "Add multiple prompt handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODU5MDI1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#pullrequestreview-378859025", "createdAt": "2020-03-20T23:18:14Z", "commit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMzoxODoxNFrOF5llTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMzozMToyNFrOF5lvdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkyODkwOA==", "bodyText": "Rename to\ndismissCurrentIam or\ndismissCurrentInAppMessage\n?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395928908", "createdAt": "2020-03-20T23:18:14Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/WebViewManager.java", "diffHunk": "@@ -115,6 +115,13 @@ public void run() {\n         }, IN_APP_MESSAGE_INIT_DELAY);\n     }\n \n+    static void dismissCurrentIAM() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkyOTEwMA==", "bodyText": "Lets create a PermissionUtils eventually and put everything global or constant based in there, just so we keep PermissionsActivity clean", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395929100", "createdAt": "2020-03-20T23:19:07Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/PermissionsActivity.java", "diffHunk": "@@ -32,13 +32,15 @@\n import android.content.pm.PackageManager;\n import android.os.Build;\n import android.os.Bundle;\n+import android.os.Handler;\n import android.support.annotation.NonNull;\n \n import com.onesignal.AndroidSupportV4Compat.ActivityCompat;\n \n public class PermissionsActivity extends Activity {\n \n    private static final String TAG = PermissionsActivity.class.getCanonicalName();\n+   private static final int DELAY_TIME_CALLBACK_CALL = 500;\n    private static final int REQUEST_LOCATION = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMDA4MA==", "bodyText": "Perfect, addresses my concerns haha we will improve in future", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395930080", "createdAt": "2020-03-20T23:24:34Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/PermissionsActivity.java", "diffHunk": "@@ -84,17 +86,29 @@ private void requestPermission() {\n    }\n \n    @Override\n-   public void onRequestPermissionsResult(int requestCode, @NonNull String permissions[], @NonNull int[] grantResults) {\n+   public void onRequestPermissionsResult(final int requestCode, @NonNull String permissions[], @NonNull final int[] grantResults) {\n       answered = true;\n       waiting = false;\n \n+      // TODO improve this method\n+      // TODO after we remove IAM from being an activity window we may be able to remove this handler\n+      // This is not a good solution!\n+      // Current problem: IAM depends on an activity, because of prompt permission the evaluation of IAM\n+      // is being called before the prompt activity dismisses, so it's attaching the IAM to PermissionActivity\n+      // We need to wait for other activity to show", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMDEyMg==", "bodyText": "units please in name or as comment", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395930122", "createdAt": "2020-03-20T23:24:49Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/PermissionsActivity.java", "diffHunk": "@@ -32,13 +32,15 @@\n import android.content.pm.PackageManager;\n import android.os.Build;\n import android.os.Bundle;\n+import android.os.Handler;\n import android.support.annotation.NonNull;\n \n import com.onesignal.AndroidSupportV4Compat.ActivityCompat;\n \n public class PermissionsActivity extends Activity {\n \n    private static final String TAG = PermissionsActivity.class.getCanonicalName();\n+   private static final int DELAY_TIME_CALLBACK_CALL = 500;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMDg2NQ==", "bodyText": "Can you comment the cases being handled here, lots of if and else that might not be intuitive to someone who hasn't seen the codebase", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395930865", "createdAt": "2020-03-20T23:28:20Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationGMS.java", "diffHunk": "@@ -158,18 +191,24 @@ else if (permissionList.contains(\"android.permission.ACCESS_COARSE_LOCATION\")) {\n                      requestPermission = \"android.permission.ACCESS_COARSE_LOCATION\";\n                }\n \n-               if (requestPermission != null && promptLocation)\n+               if (requestPermission != null && promptLocation) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMTAyNQ==", "bodyText": "good synchronized on the promptHandlers", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395931025", "createdAt": "2020-03-20T23:29:10Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationGMS.java", "diffHunk": "@@ -85,51 +86,82 @@\n       void complete(LocationPoint point);\n    }\n \n+   abstract static class LocationAndPromptHandler implements LocationHandler {\n+      void onPromptHandle(boolean accepted) {}\n+   }\n+\n    private static ConcurrentHashMap<CALLBACK_TYPE, LocationHandler> locationHandlers = new ConcurrentHashMap<>();\n+   private static final List<LocationAndPromptHandler> promptHandlers = new ArrayList<>();\n \n    private static Thread fallbackFailThread;\n \n    private static boolean locationCoarse;\n-   \n+\n    static boolean scheduleUpdate(Context context) {\n       if (!hasLocationPermission(context) || !OneSignal.shareLocation)\n          return false;\n-      \n+\n       long lastTime = System.currentTimeMillis() - getLastLocationTime();\n       long minTime = 1_000 * (OneSignal.isForeground() ? TIME_FOREGROUND_SEC : TIME_BACKGROUND_SEC);\n       long scheduleTime = minTime - lastTime;\n-      \n+\n       OneSignalSyncServiceUtils.scheduleLocationUpdateTask(context, scheduleTime);\n       return true;\n    }\n-   \n+\n    private static void setLastLocationTime(long time) {\n       OneSignalPrefs.saveLong(OneSignalPrefs.PREFS_ONESIGNAL,\n               OneSignalPrefs.PREFS_OS_LAST_LOCATION_TIME,time);\n    }\n-   \n+\n    private static long getLastLocationTime() {\n       return OneSignalPrefs.getLong(\n                OneSignalPrefs.PREFS_ONESIGNAL,\n                OneSignalPrefs.PREFS_OS_LAST_LOCATION_TIME,\n                TIME_BACKGROUND_SEC * -1_000\n       );\n    }\n-   \n+\n    private static boolean hasLocationPermission(Context context) {\n       return ContextCompat.checkSelfPermission(context, \"android.permission.ACCESS_FINE_LOCATION\") == PackageManager.PERMISSION_GRANTED\n           || ContextCompat.checkSelfPermission(context, \"android.permission.ACCESS_COARSE_LOCATION\") == PackageManager.PERMISSION_GRANTED;\n    }\n \n+   static void addPromptHandlerIfAvailable(LocationHandler handler) {\n+      if (handler instanceof LocationAndPromptHandler) {\n+         synchronized (promptHandlers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMTIzMA==", "bodyText": "Can you explain what you mean by Location And PromptHandler? Can we call this LocationPromptCompletionHandler?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395931230", "createdAt": "2020-03-20T23:30:10Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationGMS.java", "diffHunk": "@@ -85,51 +86,82 @@\n       void complete(LocationPoint point);\n    }\n \n+   abstract static class LocationAndPromptHandler implements LocationHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMTUxMQ==", "bodyText": "Rename to onAnswered  to make more sense when calling locationPromptHandler.onAnswered(boolean)", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395931511", "createdAt": "2020-03-20T23:31:24Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationGMS.java", "diffHunk": "@@ -85,51 +86,82 @@\n       void complete(LocationPoint point);\n    }\n \n+   abstract static class LocationAndPromptHandler implements LocationHandler {\n+      void onPromptHandle(boolean accepted) {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODYzMDY1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#pullrequestreview-378863065", "createdAt": "2020-03-20T23:35:30Z", "commit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMzozNTozMFrOF5lywA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMzozNTozMFrOF5lywA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMjM1Mg==", "bodyText": "Can we pleaseeeee change the name CALLBACK_TYPE to PermissionType or something. more relevant and not all capitol... Should be camel case, I know you didnt make this but it hurt my soul finding it...", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r395932352", "createdAt": "2020-03-20T23:35:30Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationGMS.java", "diffHunk": "@@ -85,51 +86,82 @@\n       void complete(LocationPoint point);\n    }\n \n+   abstract static class LocationAndPromptHandler implements LocationHandler {\n+      void onPromptHandle(boolean accepted) {}\n+   }\n+\n    private static ConcurrentHashMap<CALLBACK_TYPE, LocationHandler> locationHandlers = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c05a0b7562431aa76a9d952e093db63e07a3e466", "committedDate": "2020-03-20T18:23:08Z", "message": "Add multiple prompt handling"}, "afterCommit": {"oid": "2e43690494ef157d820ccbb7e7520757c40022f5", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/2e43690494ef157d820ccbb7e7520757c40022f5", "committedDate": "2020-03-21T00:34:59Z", "message": "Add multiple prompt handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52eebae688b15c1af747f8e060a0530fafd93bf2", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/52eebae688b15c1af747f8e060a0530fafd93bf2", "committedDate": "2020-03-23T18:48:08Z", "message": "Add push prompt handling for IAM clicks\n\n  * Add prompt to IAM action\n  * Show iOS prompt for location permission\n  * Add test for prompt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30422f36d48fe759e2edf2019494abc4c78f2bf2", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/30422f36d48fe759e2edf2019494abc4c78f2bf2", "committedDate": "2020-03-23T18:51:10Z", "message": "Add multiple prompt handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e43690494ef157d820ccbb7e7520757c40022f5", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/2e43690494ef157d820ccbb7e7520757c40022f5", "committedDate": "2020-03-21T00:34:59Z", "message": "Add multiple prompt handling"}, "afterCommit": {"oid": "30422f36d48fe759e2edf2019494abc4c78f2bf2", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/30422f36d48fe759e2edf2019494abc4c78f2bf2", "committedDate": "2020-03-23T18:51:10Z", "message": "Add multiple prompt handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODIwOTQz", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#pullrequestreview-379820943", "createdAt": "2020-03-23T21:04:12Z", "commit": {"oid": "c26a2643a9b96449aef12edeada31ceeddac4769"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowNDoxMlrOF6YCcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowNDoxMlrOF6YCcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1NTU3MA==", "bodyText": "Still needs comments I think", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#discussion_r396755570", "createdAt": "2020-03-23T21:04:12Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/LocationGMS.java", "diffHunk": "@@ -158,18 +191,24 @@ else if (permissionList.contains(\"android.permission.ACCESS_COARSE_LOCATION\")) {\n                      requestPermission = \"android.permission.ACCESS_COARSE_LOCATION\";\n                }\n \n-               if (requestPermission != null && promptLocation)\n+               if (requestPermission != null && promptLocation) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzMDg2NQ=="}, "originalCommit": {"oid": "c05a0b7562431aa76a9d952e093db63e07a3e466"}, "originalPosition": 146}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c26a2643a9b96449aef12edeada31ceeddac4769", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c26a2643a9b96449aef12edeada31ceeddac4769", "committedDate": "2020-03-23T20:20:43Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}, "afterCommit": {"oid": "dd4978f57b2955e4104fe01eee7f187d5290214e", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/dd4978f57b2955e4104fe01eee7f187d5290214e", "committedDate": "2020-03-23T21:23:26Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODMzODYw", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/967#pullrequestreview-379833860", "createdAt": "2020-03-23T21:24:32Z", "commit": {"oid": "dd4978f57b2955e4104fe01eee7f187d5290214e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd4978f57b2955e4104fe01eee7f187d5290214e", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/dd4978f57b2955e4104fe01eee7f187d5290214e", "committedDate": "2020-03-23T21:23:26Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}, "afterCommit": {"oid": "a45df4a6ce1b5a1f869d3fed9264dd424109e900", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a45df4a6ce1b5a1f869d3fed9264dd424109e900", "committedDate": "2020-03-23T21:24:59Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a45df4a6ce1b5a1f869d3fed9264dd424109e900", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a45df4a6ce1b5a1f869d3fed9264dd424109e900", "committedDate": "2020-03-23T21:24:59Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}, "afterCommit": {"oid": "5bbe668cae94a5e33c0f468d628166aa180c30c7", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5bbe668cae94a5e33c0f468d628166aa180c30c7", "committedDate": "2020-03-23T21:25:40Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27432031626a25396954f1e31eb37ccfdd947980", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/27432031626a25396954f1e31eb37ccfdd947980", "committedDate": "2020-03-23T21:27:56Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5bbe668cae94a5e33c0f468d628166aa180c30c7", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5bbe668cae94a5e33c0f468d628166aa180c30c7", "committedDate": "2020-03-23T21:25:40Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}, "afterCommit": {"oid": "27432031626a25396954f1e31eb37ccfdd947980", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/27432031626a25396954f1e31eb37ccfdd947980", "committedDate": "2020-03-23T21:27:56Z", "message": "Add new features to IAM preview\n\n   * Add prompt to IAM preview\n   * Add logs for tags and outcomes\n   * Redisplay, tags, outcomes, impression should not be included on IAM preview"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3525, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}