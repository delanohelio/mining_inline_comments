{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3MTU4MDYz", "number": 1193, "title": "Add notification duplicate check under Workers", "bodyText": "If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\nKeep notificationIds in memory for short time duplicates, then we rely on databse duplicate check\n\n\nThis change is\u2002", "createdAt": "2020-10-20T23:45:30Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1193", "merged": true, "mergeCommit": {"oid": "d15a56217439fb7b3ef473838f48084d05c167f9"}, "closed": true, "closedAt": "2020-11-04T14:40:41Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUh1dngBqjM5MDEyNjUwNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZBG8hAFqTUyMjkyNzU1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20b4a8b27200c6cd7f2039ad57d40c5f5d3e65d2", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/20b4a8b27200c6cd7f2039ad57d40c5f5d3e65d2", "committedDate": "2020-10-20T23:41:32Z", "message": "Add notification duplicate check under Workers\n\n* If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\n* Keep notificationIds in memory for short time duplicates, then we rely on databse duplicate check"}, "afterCommit": {"oid": "6fd7674b7f0b1e577a79a0d2072095d09f1afd07", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/6fd7674b7f0b1e577a79a0d2072095d09f1afd07", "committedDate": "2020-10-21T00:00:46Z", "message": "Add notification duplicate check under Workers\n\n* If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\n* Keep notificationIds in memory for short time duplicates, then we rely on databse duplicate check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fd7674b7f0b1e577a79a0d2072095d09f1afd07", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/6fd7674b7f0b1e577a79a0d2072095d09f1afd07", "committedDate": "2020-10-21T00:00:46Z", "message": "Add notification duplicate check under Workers\n\n* If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\n* Keep notificationIds in memory for short time duplicates, then we rely on databse duplicate check"}, "afterCommit": {"oid": "aef3962d11ad2072b722645ca1d699ac6d058bae", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/aef3962d11ad2072b722645ca1d699ac6d058bae", "committedDate": "2020-10-21T00:06:00Z", "message": "Add notification duplicate check under Workers\n\n* If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\n* Keep notificationIds in memory for short time duplicates, then we rely on databse duplicate check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18964fa490e9096f653eb69fb4b7c2a1de6a9cc8", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/18964fa490e9096f653eb69fb4b7c2a1de6a9cc8", "committedDate": "2020-10-21T00:10:42Z", "message": "Add notification duplicate check under Workers\n\n* If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\n* Keep notificationIds in memory for short time duplicates, then we rely on databse duplicate check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aef3962d11ad2072b722645ca1d699ac6d058bae", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/aef3962d11ad2072b722645ca1d699ac6d058bae", "committedDate": "2020-10-21T00:06:00Z", "message": "Add notification duplicate check under Workers\n\n* If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\n* Keep notificationIds in memory for short time duplicates, then we rely on databse duplicate check"}, "afterCommit": {"oid": "18964fa490e9096f653eb69fb4b7c2a1de6a9cc8", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/18964fa490e9096f653eb69fb4b7c2a1de6a9cc8", "committedDate": "2020-10-21T00:10:42Z", "message": "Add notification duplicate check under Workers\n\n* If the same notification arrives twice, if the first notification did not end processing, the notification will be processed twice\n* Keep notificationIds in memory for short time duplicates, then we rely on databse duplicate check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTg1MTU5", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1193#pullrequestreview-518185159", "createdAt": "2020-10-27T22:02:41Z", "commit": {"oid": "18964fa490e9096f653eb69fb4b7c2a1de6a9cc8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjowMjo0MVrOHpSsDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjoxMjo0OFrOHpS80Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA1OTg1Mg==", "bodyText": "This won't be present if someone decides to omit Google Play Services from their app for FireOS or Huawei build of their app. I recommend using import android.text.TextUtils instead as this is in AndroidX. Then we can use TextUtils.isEmpty instead of Strings.isEmptyOrWhitespace.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1193#discussion_r513059852", "createdAt": "2020-10-27T22:02:41Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationWorkManager.java", "diffHunk": "@@ -10,16 +10,28 @@\n import androidx.work.Worker;\n import androidx.work.WorkerParameters;\n \n+import com.google.android.gms.common.util.Strings;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18964fa490e9096f653eb69fb4b7c2a1de6a9cc8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2NDE0NQ==", "bodyText": "Can we combine this logic with OneSignal.isDuplicateNotification somehow? It isn't obvious that we have two ways of checking for duplicates.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1193#discussion_r513064145", "createdAt": "2020-10-27T22:12:48Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationWorkManager.java", "diffHunk": "@@ -33,6 +45,19 @@ static void beginEnqueueingWork(Context context, String osNotificationId, int an\n                 .setInputData(inputData)\n                 .build();\n \n+        // Duplicate control\n+        // Keep in memory in going processed notifications, to avoid fast duplicates that already finished work process but are not completed yet\n+        // enqueueUniqueWork might not be enough, if the work already finished then the duplicate notification work might be queued again\n+        if (!Strings.isEmptyOrWhitespace(osNotificationId)) {\n+            if (notificationIds.contains(osNotificationId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18964fa490e9096f653eb69fb4b7c2a1de6a9cc8"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "920bf7b07d9fbd4e82f234bab4f3231c35272e10", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/920bf7b07d9fbd4e82f234bab4f3231c35272e10", "committedDate": "2020-11-02T19:01:18Z", "message": "Check duplicate under isDuplicateNotification\n\n* Share memory and cache duplicate check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTgwOTA5", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1193#pullrequestreview-521980909", "createdAt": "2020-11-02T20:47:58Z", "commit": {"oid": "920bf7b07d9fbd4e82f234bab4f3231c35272e10"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b51f862d4c65e5d0451cb30dfd83f3a592b7de0c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/b51f862d4c65e5d0451cb30dfd83f3a592b7de0c", "committedDate": "2020-11-03T15:17:45Z", "message": "Remove non null annotation conflicting with kotlin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyOTI3NTUz", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1193#pullrequestreview-522927553", "createdAt": "2020-11-03T22:42:50Z", "commit": {"oid": "b51f862d4c65e5d0451cb30dfd83f3a592b7de0c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3472, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}