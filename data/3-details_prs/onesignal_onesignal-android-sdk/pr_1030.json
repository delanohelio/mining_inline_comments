{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMDI1MjE3", "number": 1030, "title": "UnitTests for NotificationWillShowInForegroundHandler", "bodyText": "Removed unnecessary nested Threads wrapping Runnables\n\nUnitTests in this PR:\n\nNo extension service class tests\n\nTesting the scenario where no foreground handlers have been setup\ntestNullExtAndAppNotificationWillShowInForegroundHandlers\n\n\nNotificationExtensionService_notifJobPayload class tests\n\nTesting that the data in the accessible getters is correct for the notifJobs\ntestNullExtAndAppNotificationWillShowInForegroundHandlers\n\n\nNotificationExtensionService_bubblesAfter30SecondTimeout_toAppNotificationWillShowInForegroundHandler class tests\n\nTesting 30 second notification timeout bubbling\ntestNotificationWillShowInForegroundHandler_bubbles30SecondTimeout_forExtAndAppHandlers\ntestExtNotificationWillShowInForegroundHandler_bubblesAfter30SecondTimeout_withNullAppNotificationWillShowInForegroundHandler\ntestExtNotificationWillShowInForegroundHandler_bubblesAfter30SecondTimeout_toAppNotificationWillShowInForegroundHandler\n\n\nNotificationExtensionService_completeDoesNotBubble_toAppNotificationWillShowInForegroundHandler class tests\n\nTesting scenarios where no bubbling should occur\ntestExtNotificationWillShowInForegroundHandler_completeDoesNotBubble_toAppNotificationWillShowInForegroundHandler\ntestExtNotificationWillShowInForegroundHandler_completeDoesNotBubble_toNullAppNotificationWillShowInForegroundHandler\n\n\nNotificationExtensionService_completeBubbles_toAppNotificationWillShowInForegroundHandler class tests\n\nTesting scenarios where bubbling is controlled with complete method\ntestExtNotificationWillShowInForegroundHandler_completeBubbles_toAppNotificationWillShowInForegroundHandler\ntestExtNotificationWillShowInForegroundHandler_completeBubbles_withNullAppNotificationWillShowInForegroundHandler\n\n\nNotificationExtensionService_setNotificationDisplayOptionToSilent class tests\n\nTesting scenarios where setNotificationDisplayOption is set to SILENT\ntestExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToSilent\ntestExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToSilent_andThenToNotification\n\n\nNotificationExtensionService_setNotificationDisplayOptionToNotification class tests\n\nTesting scenarios where setNotificationDisplayOption is set to NOTIFICATION\ntestExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToNotification\ntestExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToNotification_andThenToSilent\n\n\nNotificationExtensionService_workTimeLongerThanTimeout\n\ntestNotificationWillShowInForegroundHandler_workTimeLongerThanTimeout\n\n\n\nOther scenarios:\nhttps://onesignal.atlassian.net/browse/OS-4175\n\n\nThis change is\u2002", "createdAt": "2020-05-22T16:34:00Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1030", "merged": true, "mergeCommit": {"oid": "e52edb9e6dc193404fdca368d35d485ad80ca6e9"}, "closed": true, "closedAt": "2020-07-01T20:01:10Z", "author": {"login": "mikechoch"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnKAblgFqTQyMjI3MDc5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwv1AegH2gAyNDIyMDI1MjE3OmU0NWQyMGQyNDBiMDdkODI2MTU1NzlmYWNhMzIzMzdhOGZjZjIwMjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjcwNzkz", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1030#pullrequestreview-422270793", "createdAt": "2020-06-02T00:44:55Z", "commit": {"oid": "1b0dbdbb241a12ab087edd0ca4dbf26d09bd0105"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMDo0NDo1NVrOGdegEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMDo0NTozN1rOGdegyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2MTYxNg==", "bodyText": "usually, if the @return is on the java docs you can add a comment in there to add information about the returned object", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1030#discussion_r433561616", "createdAt": "2020-06-02T00:44:55Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -107,10 +108,18 @@ CharSequence getBody() {\n \n    /**\n     * Get the notification additional data json from the payload\n+    * @return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b0dbdbb241a12ab087edd0ca4dbf26d09bd0105"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2MTgwMw==", "bodyText": "do you need the this. ?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1030#discussion_r433561803", "createdAt": "2020-06-02T00:45:37Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationGenerationJob.java", "diffHunk": "@@ -170,18 +183,21 @@ AppNotificationGenerationJob toAppNotificationGenerationJob() {\n       // The actual notifJob with notification payload data\n       private OSNotificationGenerationJob notifJob;\n \n-      // Handler used to timeout the handler if bubble or complete is not called\n+      // Single Handler used to timeout the handler if bubble or complete is not called\n       private Handler timeoutHandler;\n+      // Single Runnable used to execute code after the handler timeout completes\n+      private Runnable timeoutRunnable;\n \n       NotificationGenerationJob(OSNotificationGenerationJob notifJob) {\n          this.notifJob = notifJob;\n       }\n \n-      void startShowNotificationTimeout(final Runnable timeoutRunnable) {\n-         // If the handler isn't null we do not want to start another\n-         if (timeoutHandler != null)\n+      void startShowNotificationTimeout(final Runnable runnable) {\n+         // If the handler or runnable isn't null we do not want to start another\n+         if (this.timeoutHandler != null || this.timeoutRunnable != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b0dbdbb241a12ab087edd0ca4dbf26d09bd0105"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjcxOTg2", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1030#pullrequestreview-422271986", "createdAt": "2020-06-02T00:48:49Z", "commit": {"oid": "1b0dbdbb241a12ab087edd0ca4dbf26d09bd0105"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54b5f7b5659077c016973b4b8320cbd78fa926b0", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/54b5f7b5659077c016973b4b8320cbd78fa926b0", "committedDate": "2020-07-01T16:42:50Z", "message": "Refactor prep for `InFocusDisplayOption` in `NotifForegroundHandler`\n* `NotificationWillShowInForegroundHandler` will be responsible for setting the notifications display type if a dev decides so\n  * Alternative is a global setter that also controls the default for `OSNotificationDisplay` if no `NotificationWillShowInForegroundHandler` is set\n  * Renamed `None` to `SILENT` and `Notification` to `NOTIFICATION` to follow a caps snake-case enum convention\n* Removed `InAppAlert` from `InFocusDisplayOption`\n  * Refactored `InFocusDisplayOption` to `OSNotificationDisplay`\n  * Cleaned out `InAppAlert` related `UnitTests`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c08a5dbecf7dce583c01c7525ac438f03429f14c", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c08a5dbecf7dce583c01c7525ac438f03429f14c", "committedDate": "2020-07-01T16:44:28Z", "message": "Alert was removed, so isActive check no longer needed here"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c495925ef8d091f7f3a052c45b6c4ca7b3c086c", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/5c495925ef8d091f7f3a052c45b6c4ca7b3c086c", "committedDate": "2020-07-01T17:03:18Z", "message": "Refactor prep for `InFocusDisplayOption` in `NotifForegroundHandler`\n* `NotificationWillShowInForegroundHandler` will be responsible for setting the notifications display type if a dev decides so\n  * Alternative is a global setter that also controls the default for `OSNotificationDisplay` if no `NotificationWillShowInForegroundHandler` is set\n  * Renamed `None` to `SILENT` and `Notification` to `NOTIFICATION` to follow a caps snake-case enum convention\n* Removed `InAppAlert` from `InFocusDisplayOption`\n  * Refactored `InFocusDisplayOption` to `OSNotificationDisplay`\n  * Cleaned out `InAppAlert` related `UnitTests`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a355e9e1b006ed1c15a10375684d652aee1a59c9", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a355e9e1b006ed1c15a10375684d652aee1a59c9", "committedDate": "2020-07-01T17:20:16Z", "message": "Implementing new NotificationWillShowInForegroundHandlers\n  * 1 can be implemented through the notification extension service and be known as the `ExtNotificationWillShowInForegroundHandler`\n    * This involves a new metadata tag in apps using OneSignal,\n    * On init of OneSignal, searches for an extension service file and save the implementations as global handlers to be used throughout OneSignal codebase\n  * Second one will be implemented through a public OneSignal setter called `setNotificationWillShowInForegroundHandler` and is known as the `AppNotificationWillShowInForegroundHandler`\n    * From these handlers a set of new functionality exists now:\n      * This includes bubbling from ext to app handler to mimic iOS handler before showing notification\n      * Also without bubbling a 30 second timeout will begin counting down before showing notification by default\n  * Renamed `NotificationGenerationJob` to `OSNotificationGenerationJob`\n  * To help keep things private within the handlers, a `NotificationGenerationJob` class was made to be extended by a `ExtNotificationGenerationJob` and `AppNotificationGenerationJob`\n* Removed what is believed to be final Alert based flow for showing a notification\n\n* Unit Tests need to be fixed and new ones added still after validating functionality here\n* Next the Work manager should be implemented to process these one at a time as they come in"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b9a6c4365efbe3a1275eb76061c9e4f8d8e3b9d", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/0b9a6c4365efbe3a1275eb76061c9e4f8d8e3b9d", "committedDate": "2020-07-01T17:30:57Z", "message": "Cleaned up previous commit(s) for this PR\n* UnitTests failing, needed to rework notification display flow a little\n* Removed more Alert based notification code `showNotificationAsAlert`\n* Refactored `ProcessJobForDisplay` to perfection in terms of mimic'ing current master implementation but removing Alert based handling and including new `NotificationWillShowInForegroundHandler`\n* Replaced method `NotificationExtenderService.showNotification` with `GenerateNotification.fromJsonPayload`\n* Removed `OSNotificationGenerationJob` from PackagePrivate helper file because it is public already\n\nDone with fixing unit tests and getting functionality matching previous NotificationReceivedHandler SDK functionality\n* WIP - Need to write new unit tests to test new functionality, this will go in a new PR branched off this PR branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d1a6573b1fd54721c1a5ac2c3f6c71f94f1a25", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/97d1a6573b1fd54721c1a5ac2c3f6c71f94f1a25", "committedDate": "2020-07-01T17:49:48Z", "message": "Slight tweaks to the flow of the NotificationWillShowInForegroundHandler\n* Removed unnecessary nested Threads wrapping Runnables\n* 3 NotificationWillShowInForegroundHandler UnitTests built now and all passing correctly\n  * Will use these as a template for other scenarios\n\nUniTests in this commit:\n* `testExtNotificationWillShowInForegroundHandler_completeBubbles_toAppNotificationWillShowInForegroundHandler`\n* `testExtNotificationWillShowInForegroundHandler_completeDoesNotBubble_toAppNotificationWillShowInForegroundHandler`\n* `testExtNotificationWillShowInForegroundHandler_bubblesAfter30SecondTimeout_toAppNotificationWillShowInForegroundHandler`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13ea5075836dac3148cf17b7d89c6134210ba78c", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/13ea5075836dac3148cf17b7d89c6134210ba78c", "committedDate": "2020-07-01T17:49:48Z", "message": "Finished Jira unit tests for NotificationWillShowInForegroundHandler\n* No extension service class tests\n  * Testing the scenario where no foreground handlers have been setup\n  * `testNullExtAndAppNotificationWillShowInForegroundHandlers`\n* `NotificationExtensionService_notifJobPayload` class tests\n  * Testing that the data in the accessible getters is correct for the notifJobs\n  * `testNullExtAndAppNotificationWillShowInForegroundHandlers`\n* `NotificationExtensionService_bubblesAfter30SecondTimeout_toAppNotificationWillShowInForegroundHandler` class tests\n  * Testing 30 second notification timeout bubbling\n  * testNotificationWillShowInForegroundHandler_bubbles30SecondTimeout_forExtAndAppHandlers\n  * testExtNotificationWillShowInForegroundHandler_bubblesAfter30SecondTimeout_withNullAppNotificationWillShowInForegroundHandler\n  * testExtNotificationWillShowInForegroundHandler_bubblesAfter30SecondTimeout_toAppNotificationWillShowInForegroundHandler\n* `NotificationExtensionService_completeDoesNotBubble_toAppNotificationWillShowInForegroundHandler` class tests\n  * Testing scenarios where no bubbling should occur\n  * testExtNotificationWillShowInForegroundHandler_completeDoesNotBubble_toAppNotificationWillShowInForegroundHandler\n  * testExtNotificationWillShowInForegroundHandler_completeDoesNotBubble_toNullAppNotificationWillShowInForegroundHandler\n* `NotificationExtensionService_completeBubbles_toAppNotificationWillShowInForegroundHandler` class tests\n  * Testing scenarios where bubbling is controlled with complete method\n  * testExtNotificationWillShowInForegroundHandler_completeBubbles_toAppNotificationWillShowInForegroundHandler\n  * testExtNotificationWillShowInForegroundHandler_completeBubbles_withNullAppNotificationWillShowInForegroundHandler\n* `NotificationExtensionService_setNotificationDisplayOptionToSilent` class tests\n  * Testing scenarios where `setNotificationDisplayOption` is set to `SILENT`\n  * testExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToSilent\n  * testExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToSilent_andThenToNotification\n* `NotificationExtensionService_setNotificationDisplayOptionToNotification` class tests\n  * Testing scenarios where `setNotificationDisplayOption` is set to `NOTIFICATION`\n  * testExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToNotification\n  * testExtNotificationWillShowInForegroundHandler_setNotificationDisplayOptionToNotification_andThenToSilent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdf3bf156e87d8fa7bc845ffb680d3db0b7407e5", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/bdf3bf156e87d8fa7bc845ffb680d3db0b7407e5", "committedDate": "2020-07-01T17:49:48Z", "message": "Fixing UnitTest steps comment numbering"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b0dbdbb241a12ab087edd0ca4dbf26d09bd0105", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1b0dbdbb241a12ab087edd0ca4dbf26d09bd0105", "committedDate": "2020-05-26T20:32:12Z", "message": "Fixing UnitTest steps comment numbering"}, "afterCommit": {"oid": "bdf3bf156e87d8fa7bc845ffb680d3db0b7407e5", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/bdf3bf156e87d8fa7bc845ffb680d3db0b7407e5", "committedDate": "2020-07-01T17:49:48Z", "message": "Fixing UnitTest steps comment numbering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a75fe8bf9e937144205cdc82c704ad604a93cdaf", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a75fe8bf9e937144205cdc82c704ad604a93cdaf", "committedDate": "2020-07-01T19:03:22Z", "message": "Minor fixes from PR comments as well as `OSTimeoutHandler` class\n* `OSTimeoutHandler` class extended by a class to create Timeout for that instance of the class\n  * Start timeout with `startTimeout` and stop with `destroyTimeout`\n  * Extended by `NotificationGenerationJob`, which is extended by `AppNotificationGenerationJob` and `ExtNotificationGenerationJob`\n* Added a `isComplete` `boolean` to the `NotificationGenerationJob` class to make sure complete methods can not be called twice\n  * Use case would be that work inside of a handler takes longer than timeout, but also calls complete at the end\n  * `isComplete` would be set `true` already so no way to complete more than once\n* `AppNotificationGenerationJob` and `ExtNotificationGenerationJob` now have `synchronized` on complete methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e45d20d240b07d82615579faca32337a8fcf2026", "author": {"user": {"login": "mikechoch", "name": "Michael DiCioccio"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/e45d20d240b07d82615579faca32337a8fcf2026", "committedDate": "2020-07-01T19:57:53Z", "message": "Added 1 unit test for App/Ext `NotificationWillShowInForegroundHandler`\n* Test is in regards to work taking longer than 30 second timeout\n  * Simulate work taking 30+ seconds and make sure complete is not called successfully twice\n  * This is guarded by `synchronized` and `isComplete` `boolean` internal to `NotificationGenerationJob`\n* Using a newly created `callbackCounter` which is used to increment the number of times and event occurred\n  * In this case we only want the App/Ext `NotificationWillShowInForegroundHandler` to fire once"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3578, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}