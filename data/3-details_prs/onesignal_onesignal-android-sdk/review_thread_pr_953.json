{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczODMzNzcy", "number": 953, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMToyMzoxM1rODfs_kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMToxOTowOFrODi2wMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NTY5NjE5OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMToyMzoxM1rOFpkA8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMToyMzoxM1rOFpkA8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEyNjAwMA==", "bodyText": "displayed seems to generic and is confusing. Thinking it should be called displayedInSession, and updating all other usages in this PR to match.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379126000", "createdAt": "2020-02-13T21:23:13Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private OSInAppMessageDisplayStats displayStats = new OSInAppMessageDisplayStats();\n \n     private double displayDuration;\n+    private boolean displayed = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjEwNzI5OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMDoxODoxOFrOFpoArQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMDoxODoxOFrOFpoArQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MTQ2OQ==", "bodyText": "Add a space after //", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379191469", "createdAt": "2020-02-14T00:18:18Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -161,6 +162,10 @@ void receivedInAppMessageJson(@NonNull JSONArray json) throws JSONException {\n         if (redisplayInAppMessages.size() != updatedRedisplayMessages.size()) {\n             redisplayInAppMessages = updatedRedisplayMessages;\n         }\n+        //Reset feature flag for redisplay", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjExMDIzOnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMDoyMDowN1rOFpoCeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzowNjo0NVrOFrZvzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MTkyOA==", "bodyText": "2 Questions:\n\nWill adding this new attribute to the IAM table require a migration?\nWhy must it be a 1 or a 0, can't we use a true or false instead?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379191928", "createdAt": "2020-02-14T00:20:07Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "diffHunk": "@@ -75,6 +75,7 @@ synchronized void saveInAppMessage(OSInAppMessage inAppMessage) {\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_DISPLAY_QUANTITY, inAppMessage.getDisplayStats().getDisplayQuantity());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_LAST_DISPLAY, inAppMessage.getDisplayStats().getLastDisplayTime());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_CLICK_IDS, inAppMessage.getClickedClickIds().toString());\n+        values.put(OneSignalDbContract.InAppMessageTable.COLUMN_DISPLAYED, inAppMessage.isDisplayed() ? 1 : 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NzMxNA==", "bodyText": "No, this will be merged all together so it shouldn't\nhttps://www.sqlite.org/datatype3.html  \"SQLite does not have a separate Boolean storage class. Instead, Boolean values are stored as integers 0 (false) and 1 (true).\"\nI will refactor to save as boolean but the parsing will stay the same", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r380957314", "createdAt": "2020-02-18T21:52:30Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "diffHunk": "@@ -75,6 +75,7 @@ synchronized void saveInAppMessage(OSInAppMessage inAppMessage) {\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_DISPLAY_QUANTITY, inAppMessage.getDisplayStats().getDisplayQuantity());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_LAST_DISPLAY, inAppMessage.getDisplayStats().getLastDisplayTime());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_CLICK_IDS, inAppMessage.getClickedClickIds().toString());\n+        values.put(OneSignalDbContract.InAppMessageTable.COLUMN_DISPLAYED, inAppMessage.isDisplayed() ? 1 : 0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MTkyOA=="}, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NDkyNg==", "bodyText": "Already covered by the upgradeToV7 function since it is a totally new table\nYup, integer is as close as you get to a boolean.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r381054926", "createdAt": "2020-02-19T03:06:45Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "diffHunk": "@@ -75,6 +75,7 @@ synchronized void saveInAppMessage(OSInAppMessage inAppMessage) {\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_DISPLAY_QUANTITY, inAppMessage.getDisplayStats().getDisplayQuantity());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_LAST_DISPLAY, inAppMessage.getDisplayStats().getLastDisplayTime());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_CLICK_IDS, inAppMessage.getClickedClickIds().toString());\n+        values.put(OneSignalDbContract.InAppMessageTable.COLUMN_DISPLAYED, inAppMessage.isDisplayed() ? 1 : 0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MTkyOA=="}, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjExNDM1OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMDoyMjo1OFrOFpoFMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjozNzowOFrOFsapkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MjYyNg==", "bodyText": "Talked about this in the iOS PR, I don't think triggerChanged should be stored in the IAM but it should be created on the fly and decided by some local variable inside of the method processing the IAM.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379192626", "createdAt": "2020-02-14T00:22:58Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private OSInAppMessageDisplayStats displayStats = new OSInAppMessageDisplayStats();\n \n     private double displayDuration;\n+    private boolean displayed = false;\n     private boolean triggerChanged = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1Nzg2MA==", "bodyText": "i will continue this discussion on iOS PR, this will need changes on #927", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r380957860", "createdAt": "2020-02-18T21:53:38Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private OSInAppMessageDisplayStats displayStats = new OSInAppMessageDisplayStats();\n \n     private double displayDuration;\n+    private boolean displayed = false;\n     private boolean triggerChanged = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MjYyNg=="}, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjExODI4OA==", "bodyText": "the alternative is to have a set of messageIds with all the redisplayMessage that have one trigger changed, in that way we can track if some trigger changed. I didn't want to overflow with more data structures and I tried to re use the data that was already being saved", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r382118288", "createdAt": "2020-02-20T16:37:08Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private OSInAppMessageDisplayStats displayStats = new OSInAppMessageDisplayStats();\n \n     private double displayDuration;\n+    private boolean displayed = false;\n     private boolean triggerChanged = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MjYyNg=="}, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjExNzAyOnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMDoyNDoyOVrOFpoGuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTo1MzowM1rOFrTzkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MzAxNw==", "bodyText": "What does displayed represent?\nCurrently displayed?\nWas displayed?\nDisplayed in current session?\nOr something else?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379193017", "createdAt": "2020-02-14T00:24:29Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -62,10 +63,10 @@\n         this.isPreview = isPreview;\n     }\n \n-    OSInAppMessage(@NonNull String messageId, @NonNull Set<String> clickIds, OSInAppMessageDisplayStats displayStats) {\n+    OSInAppMessage(@NonNull String messageId, @NonNull Set<String> clickIds, boolean displayed, OSInAppMessageDisplayStats displayStats) {\n         this.messageId = messageId;\n         this.clickedClickIds = clickIds;\n-\n+        this.displayed = displayed;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NzU4NA==", "bodyText": "yeah, i will rename to displayedInSession", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r380957584", "createdAt": "2020-02-18T21:53:03Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -62,10 +63,10 @@\n         this.isPreview = isPreview;\n     }\n \n-    OSInAppMessage(@NonNull String messageId, @NonNull Set<String> clickIds, OSInAppMessageDisplayStats displayStats) {\n+    OSInAppMessage(@NonNull String messageId, @NonNull Set<String> clickIds, boolean displayed, OSInAppMessageDisplayStats displayStats) {\n         this.messageId = messageId;\n         this.clickedClickIds = clickIds;\n-\n+        this.displayed = displayed;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MzAxNw=="}, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1ODUyMDY3OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzowODo1MFrOFrZxaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzowODo1MFrOFrZxaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NTMzNw==", "bodyText": "COLUMN_DISPLAYED should be COLUMN_DISPLAYED_IN_SESSION", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r381055337", "createdAt": "2020-02-19T03:08:50Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "diffHunk": "@@ -81,6 +80,7 @@ synchronized void saveInAppMessage(OSInAppMessage inAppMessage) {\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_DISPLAY_QUANTITY, inAppMessage.getDisplayStats().getDisplayQuantity());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_LAST_DISPLAY, inAppMessage.getDisplayStats().getLastDisplayTime());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_CLICK_IDS, inAppMessage.getClickedClickIds().toString());\n+        values.put(OneSignalDbContract.InAppMessageTable.COLUMN_DISPLAYED, inAppMessage.isDisplayedInSession());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fbec7ea7a435d25c67132f1c52dcc4428b8aedc"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1ODUyMjE0OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalDbContract.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzowOTo1NVrOFrZyRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzowOTo1NVrOFrZyRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NTU1OA==", "bodyText": "COLUMN_DISPLAYED should be COLUMN_DISPLAYED_IN_SESSION\ndisplayed should be displayed_in_session", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r381055558", "createdAt": "2020-02-19T03:09:55Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalDbContract.java", "diffHunk": "@@ -81,5 +81,6 @@\n       public static final String COLUMN_NAME_DISPLAY_QUANTITY = \"display_quantity\";\n       public static final String COLUMN_NAME_LAST_DISPLAY = \"last_display\";\n       public static final String COLUMN_CLICK_IDS = \"click_ids\";\n+      public static final String COLUMN_DISPLAYED = \"displayed\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fbec7ea7a435d25c67132f1c52dcc4428b8aedc"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODc1MjUxOnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMToxOTowOFrOFuVj_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMToxOTowOFrOFuVj_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzMjA5Mg==", "bodyText": "I marked this in #951 already.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r384132092", "createdAt": "2020-02-25T21:19:08Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -168,6 +168,16 @@ private void processInAppMessageJson(@NonNull JSONArray json) throws JSONExcepti\n         evaluateInAppMessages();\n     }\n \n+    private void deleteOldRedisplayedInAppMessages() {\n+        new Thread(new Runnable() {\n+            @Override\n+            public void run() {\n+                Thread.currentThread().setPriority(Process.THREAD_PRIORITY_BACKGROUND);\n+                inAppMessageRepository.deleteOldRedisplayedInAppMessages();\n+            }\n+        }, OS_SAVE_IN_APP_MESSAGE).start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91c3f5f60d05bed78e62294a39a8e27fe13ed8ae"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2190, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}