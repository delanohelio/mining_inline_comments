{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MzUwNDA4", "number": 1168, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOToyMjoyOFrOEoOeTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMTozMToxN1rOEpovZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNjE1NjMxOnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOToyMjoyOFrOHZMYZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOToyNjoxN1rOHasH8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw==", "bodyText": "remote params shouldn't be null at this point, because of the shouldQueueTaskForInit check. Why is it needed?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r496179303", "createdAt": "2020-09-28T19:22:28Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4MTQ1Mw==", "bodyText": "When there is a connection issue and the remote configuration is not previously setup, then getRemoteParams() is Null and this is the breaking point for the issue found.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r496181453", "createdAt": "2020-09-28T19:26:25Z", "author": {"login": "andrespelaezp"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw=="}, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIwMTA5NQ==", "bodyText": "Sry I might be missing some part, but shouldQueueTaskForInit check for remote == null, if remote is still null because the network failed, then the task should be queue again, or why is it not being queue again?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r496201095", "createdAt": "2020-09-28T20:04:33Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw=="}, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIwMjYxMw==", "bodyText": "It does get queued, but it also continues evaluating the statements below. Another approach could be a return statement within the task schedule block, what do you think?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r496202613", "createdAt": "2020-09-28T20:07:36Z", "author": {"login": "andrespelaezp"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw=="}, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIwMzk0Mw==", "bodyText": "oooh I see, that method is missing the return! good catch, so that is why is failing", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r496203943", "createdAt": "2020-09-28T20:10:11Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw=="}, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIwNDEzOA==", "bodyText": "No other changes should be needed but the return stmt", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r496204138", "createdAt": "2020-09-28T20:10:36Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw=="}, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIwNDI5MA==", "bodyText": "compare with the other methods using shouldQueueTaskForInit", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r496204290", "createdAt": "2020-09-28T20:10:53Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw=="}, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0Nzk1Mg==", "bodyText": "This is redundant code, the shouldQueueTaskForInit check and the return added above would cover this so I think we should remove the null check that was added in this PR.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r497747952", "createdAt": "2020-09-30T19:26:17Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1319,7 +1322,7 @@ public void run() {\n          return;\n       }\n \n-      if (getRemoteParams().useEmailAuth && emailAuthHash == null) {\n+      if (getRemoteParams() != null && getRemoteParams().useEmailAuth && emailAuthHash == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE3OTMwMw=="}, "originalCommit": {"oid": "14e88b17c8cab15dc53d0a905ef0cf7cf2d06233"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjA2NjgwOnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOToyMzoxMFrOHasBLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzozNzozM1rOHbKyjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0NjIyMg==", "bodyText": "I don't think we should change / add new APIs to address this bug fix PR. However I am open to a proposal on a new API to best handle this scenario for all our methods for consistency.\nJust some feedback on the API itself though, I would expect a return value from setEmail instead of a callback that it has been queued.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r497746222", "createdAt": "2020-09-30T19:23:10Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1299,13 +1300,16 @@ public static void setEmail(@NonNull final String email, @Nullable final String\n       if (taskController.shouldQueueTaskForInit(OSTaskController.SET_EMAIL)) {\n          logger.error(\"Waiting for remote params. \" +\n                  \"Moving \" + OSTaskController.SET_EMAIL + \" operation to a pending task queue.\");\n+         if (callback != null)\n+            callback.onTaskQueued();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60830c060ab4acacc398ae459185f12a6954588e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MDM4MQ==", "bodyText": "Noted, I will keep this in mind for a future integration", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r498250381", "createdAt": "2020-10-01T13:37:33Z", "author": {"login": "andrespelaezp"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1299,13 +1300,16 @@ public static void setEmail(@NonNull final String email, @Nullable final String\n       if (taskController.shouldQueueTaskForInit(OSTaskController.SET_EMAIL)) {\n          logger.error(\"Waiting for remote params. \" +\n                  \"Moving \" + OSTaskController.SET_EMAIL + \" operation to a pending task queue.\");\n+         if (callback != null)\n+            callback.onTaskQueued();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0NjIyMg=="}, "originalCommit": {"oid": "60830c060ab4acacc398ae459185f12a6954588e"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDk0NDI0OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/MainOneSignalClassRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMTozMDo0MFrOHbbcAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMTozMDo0MFrOHbbcAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUyMzEzOQ==", "bodyText": "This also needs to be removed", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r498523139", "createdAt": "2020-10-01T21:30:40Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/MainOneSignalClassRunner.java", "diffHunk": "@@ -1637,6 +1637,11 @@ public void onSuccess() {\n       public void onFailure(OneSignal.EmailUpdateError error) {\n          emailFiredFailure = error;\n       }\n+\n+      @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c9f8409c4c4429b7782b37cb7a3f2172135dd1d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDk0NTY3OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/MainOneSignalClassRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMTozMToxN1rOHbbc7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMTozMToxN1rOHbbc7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUyMzM3Mg==", "bodyText": "TravisCI is failing due to a Java compile error due to this interface method no longer existing.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1168#discussion_r498523372", "createdAt": "2020-10-01T21:31:17Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/MainOneSignalClassRunner.java", "diffHunk": "@@ -1637,6 +1637,11 @@ public void onSuccess() {\n       public void onFailure(OneSignal.EmailUpdateError error) {\n          emailFiredFailure = error;\n       }\n+\n+      @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c9f8409c4c4429b7782b37cb7a3f2172135dd1d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2144, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}