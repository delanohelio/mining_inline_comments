{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzOTUwMTMw", "number": 980, "title": "Add DialogFragment detection and improvement on system detection", "bodyText": "Not show IAM if an DialogFragment is visible\nQueue IAM even if systems conditions aren't correct\nReevaluate condition and display IAM after systems condition changed, no need for triggers evaluation\n\n\n\nThis change is\u2002", "createdAt": "2020-03-26T04:30:43Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980", "merged": true, "mergeCommit": {"oid": "53c6761fed37f1efd76e9b05bbd7f1cee2908161"}, "closed": true, "closedAt": "2020-03-27T19:02:03Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRj1UxgFqTM4MjQ2MzM5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcR1bFmgFqTM4MzEyNDQ3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDYzMzkx", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#pullrequestreview-382463391", "createdAt": "2020-03-26T22:24:38Z", "commit": {"oid": "2bb56569c59c0a73d42e5a00ba62dd05d3b972f6"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoyNDozOFrOF8csUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoyNjoyOFrOF8cu6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyODk3Ng==", "bodyText": "Rename to attemptToQueueAndShowInAppMessages()\nWhat if an IAM is already showing and this fires?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#discussion_r398928976", "createdAt": "2020-03-26T22:24:38Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -691,6 +699,17 @@ public void messageTriggerConditionChanged() {\n         evaluateInAppMessages();\n     }\n \n+    /**\n+     * If this method is called a system condition has changed to success\n+     *   - Keyboard is down\n+     *   - No DialogFragment visible\n+     *   - Activity is on focus, this mean no prompt permissions visible\n+     */\n+    @Override\n+    public void systemConditionChanged() {\n+        checkConditionsAndDisplayFirstIAMQueued();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb56569c59c0a73d42e5a00ba62dd05d3b972f6"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyOTQ1Mw==", "bodyText": "Change to WARNING and explain that IAMs will not be shown", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#discussion_r398929453", "createdAt": "2020-03-26T22:25:56Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSSystemConditionController.java", "diffHunk": "@@ -18,13 +26,51 @@\n \n     boolean systemConditionsAvailable() {\n         if (ActivityLifecycleHandler.curActivity == null) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver curActivity null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb56569c59c0a73d42e5a00ba62dd05d3b972f6"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyOTQ3MQ==", "bodyText": "Change to WARNING and explain that IAMs will not be shown", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#discussion_r398929471", "createdAt": "2020-03-26T22:26:00Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSSystemConditionController.java", "diffHunk": "@@ -18,13 +26,51 @@\n \n     boolean systemConditionsAvailable() {\n         if (ActivityLifecycleHandler.curActivity == null) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver curActivity null\");\n             return false;\n         }\n+\n+        if (isDialogFragmentVisible(ActivityLifecycleHandler.curActivity)) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver dialog fragment detected\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb56569c59c0a73d42e5a00ba62dd05d3b972f6"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyOTQ5Nw==", "bodyText": "Change to WARNING and explain that IAMs will not be shown", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#discussion_r398929497", "createdAt": "2020-03-26T22:26:03Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSSystemConditionController.java", "diffHunk": "@@ -18,13 +26,51 @@\n \n     boolean systemConditionsAvailable() {\n         if (ActivityLifecycleHandler.curActivity == null) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver curActivity null\");\n             return false;\n         }\n+\n+        if (isDialogFragmentVisible(ActivityLifecycleHandler.curActivity)) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver dialog fragment detected\");\n+            return false;\n+        }\n+\n         boolean keyboardUp = OSViewUtils.isKeyboardUp(new WeakReference<>(ActivityLifecycleHandler.curActivity));\n         if (keyboardUp) {\n             ActivityLifecycleHandler.setSystemConditionObserver(TAG, systemConditionObserver);\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver keyboard up detected\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb56569c59c0a73d42e5a00ba62dd05d3b972f6"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyOTY0Mg==", "bodyText": "Rename to isDialogFragmentShowing?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#discussion_r398929642", "createdAt": "2020-03-26T22:26:28Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSSystemConditionController.java", "diffHunk": "@@ -18,13 +26,51 @@\n \n     boolean systemConditionsAvailable() {\n         if (ActivityLifecycleHandler.curActivity == null) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver curActivity null\");\n             return false;\n         }\n+\n+        if (isDialogFragmentVisible(ActivityLifecycleHandler.curActivity)) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver dialog fragment detected\");\n+            return false;\n+        }\n+\n         boolean keyboardUp = OSViewUtils.isKeyboardUp(new WeakReference<>(ActivityLifecycleHandler.curActivity));\n         if (keyboardUp) {\n             ActivityLifecycleHandler.setSystemConditionObserver(TAG, systemConditionObserver);\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"OSSystemConditionObserver keyboard up detected\");\n         }\n         return !keyboardUp;\n     }\n \n+    boolean isDialogFragmentVisible(Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bb56569c59c0a73d42e5a00ba62dd05d3b972f6"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2bb56569c59c0a73d42e5a00ba62dd05d3b972f6", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/2bb56569c59c0a73d42e5a00ba62dd05d3b972f6", "committedDate": "2020-03-26T04:27:26Z", "message": "Add DialogFragment detection and improvement on system detection\n\n  * Not show IAM if an DialogFragment is visible\n  * Queue IAM even if systems conditions aren't correct\n  * Reevaluate condition and display IAM after systems condition changed, no need for triggers evaluation"}, "afterCommit": {"oid": "2d1c2192aa858c0c7862be50a2507fd04c3f196b", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/2d1c2192aa858c0c7862be50a2507fd04c3f196b", "committedDate": "2020-03-27T15:42:35Z", "message": "Add DialogFragment detection and improvement on system detection\n\n  * Not show IAM if an DialogFragment is visible\n  * Queue IAM even if systems conditions aren't correct\n  * Reevaluate condition and display IAM after systems condition changed, no need for triggers evaluation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6062dfdc13fadafa88f0668d37256e3179fea91", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/b6062dfdc13fadafa88f0668d37256e3179fea91", "committedDate": "2020-03-27T15:42:56Z", "message": "Add DialogFragment detection and improvement on system detection\n\n  * Not show IAM if an DialogFragment is visible\n  * Queue IAM even if systems conditions aren't correct\n  * Reevaluate condition and display IAM after systems condition changed, no need for triggers evaluation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d1c2192aa858c0c7862be50a2507fd04c3f196b", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/2d1c2192aa858c0c7862be50a2507fd04c3f196b", "committedDate": "2020-03-27T15:42:35Z", "message": "Add DialogFragment detection and improvement on system detection\n\n  * Not show IAM if an DialogFragment is visible\n  * Queue IAM even if systems conditions aren't correct\n  * Reevaluate condition and display IAM after systems condition changed, no need for triggers evaluation"}, "afterCommit": {"oid": "b6062dfdc13fadafa88f0668d37256e3179fea91", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/b6062dfdc13fadafa88f0668d37256e3179fea91", "committedDate": "2020-03-27T15:42:56Z", "message": "Add DialogFragment detection and improvement on system detection\n\n  * Not show IAM if an DialogFragment is visible\n  * Queue IAM even if systems conditions aren't correct\n  * Reevaluate condition and display IAM after systems condition changed, no need for triggers evaluation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMDU2NzAw", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#pullrequestreview-383056700", "createdAt": "2020-03-27T17:20:25Z", "commit": {"oid": "b6062dfdc13fadafa88f0668d37256e3179fea91"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTI0NDcy", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/980#pullrequestreview-383124472", "createdAt": "2020-03-27T18:57:22Z", "commit": {"oid": "b6062dfdc13fadafa88f0668d37256e3179fea91"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3537, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}