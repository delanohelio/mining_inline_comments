{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczODMzNzcy", "number": 953, "title": "Display once per session IAM with redisplay", "bodyText": "Add no trigger check, display once per session\nAdd displayed param to IAM\nAdd test for cold start and init OneSignal\n\n\n\nThis change is\u2002", "createdAt": "2020-02-11T19:17:42Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953", "merged": true, "mergeCommit": {"oid": "af5e301d3c9bc142dd15e8bb8e38789f8248a01c"}, "closed": true, "closedAt": "2020-02-27T23:21:57Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEByDEgFqTM1ODU2MDYzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH578egBqjMwNzEyODIyMDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTYwNjM4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#pullrequestreview-358560638", "createdAt": "2020-02-13T21:23:13Z", "commit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMToyMzoxM1rOFpkA8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMToyMzoxM1rOFpkA8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEyNjAwMA==", "bodyText": "displayed seems to generic and is confusing. Thinking it should be called displayedInSession, and updating all other usages in this PR to match.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379126000", "createdAt": "2020-02-13T21:23:13Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private OSInAppMessageDisplayStats displayStats = new OSInAppMessageDisplayStats();\n \n     private double displayDuration;\n+    private boolean displayed = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NjQyMTk3", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#pullrequestreview-358642197", "createdAt": "2020-02-14T00:18:18Z", "commit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMDoxODoxOFrOFpoArQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMDoyNDoyOVrOFpoGuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MTQ2OQ==", "bodyText": "Add a space after //", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379191469", "createdAt": "2020-02-14T00:18:18Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -161,6 +162,10 @@ void receivedInAppMessageJson(@NonNull JSONArray json) throws JSONException {\n         if (redisplayInAppMessages.size() != updatedRedisplayMessages.size()) {\n             redisplayInAppMessages = updatedRedisplayMessages;\n         }\n+        //Reset feature flag for redisplay", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MTkyOA==", "bodyText": "2 Questions:\n\nWill adding this new attribute to the IAM table require a migration?\nWhy must it be a 1 or a 0, can't we use a true or false instead?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379191928", "createdAt": "2020-02-14T00:20:07Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "diffHunk": "@@ -75,6 +75,7 @@ synchronized void saveInAppMessage(OSInAppMessage inAppMessage) {\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_DISPLAY_QUANTITY, inAppMessage.getDisplayStats().getDisplayQuantity());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_LAST_DISPLAY, inAppMessage.getDisplayStats().getLastDisplayTime());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_CLICK_IDS, inAppMessage.getClickedClickIds().toString());\n+        values.put(OneSignalDbContract.InAppMessageTable.COLUMN_DISPLAYED, inAppMessage.isDisplayed() ? 1 : 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MjYyNg==", "bodyText": "Talked about this in the iOS PR, I don't think triggerChanged should be stored in the IAM but it should be created on the fly and decided by some local variable inside of the method processing the IAM.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379192626", "createdAt": "2020-02-14T00:22:58Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private OSInAppMessageDisplayStats displayStats = new OSInAppMessageDisplayStats();\n \n     private double displayDuration;\n+    private boolean displayed = false;\n     private boolean triggerChanged = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE5MzAxNw==", "bodyText": "What does displayed represent?\nCurrently displayed?\nWas displayed?\nDisplayed in current session?\nOr something else?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r379193017", "createdAt": "2020-02-14T00:24:29Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -62,10 +63,10 @@\n         this.isPreview = isPreview;\n     }\n \n-    OSInAppMessage(@NonNull String messageId, @NonNull Set<String> clickIds, OSInAppMessageDisplayStats displayStats) {\n+    OSInAppMessage(@NonNull String messageId, @NonNull Set<String> clickIds, boolean displayed, OSInAppMessageDisplayStats displayStats) {\n         this.messageId = messageId;\n         this.clickedClickIds = clickIds;\n-\n+        this.displayed = displayed;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88cbc30bfd5739566316b01f3ee5a766a4572fda", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/88cbc30bfd5739566316b01f3ee5a766a4572fda", "committedDate": "2020-02-11T19:44:14Z", "message": "Merge branch 'feature/iam-redisplay-remove-from-cache' into feature/iam-redisplay-per-session"}, "afterCommit": {"oid": "c34bd2fd1e9875d816eeabc2c550359fc904ae9c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c34bd2fd1e9875d816eeabc2c550359fc904ae9c", "committedDate": "2020-02-18T22:15:04Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c34bd2fd1e9875d816eeabc2c550359fc904ae9c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/c34bd2fd1e9875d816eeabc2c550359fc904ae9c", "committedDate": "2020-02-18T22:15:04Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}, "afterCommit": {"oid": "9fbec7ea7a435d25c67132f1c52dcc4428b8aedc", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/9fbec7ea7a435d25c67132f1c52dcc4428b8aedc", "committedDate": "2020-02-18T22:24:42Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODE2Njk0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#pullrequestreview-360816694", "createdAt": "2020-02-19T03:08:50Z", "commit": {"oid": "9fbec7ea7a435d25c67132f1c52dcc4428b8aedc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzowODo1MFrOFrZxaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzowOTo1NVrOFrZyRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NTMzNw==", "bodyText": "COLUMN_DISPLAYED should be COLUMN_DISPLAYED_IN_SESSION", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r381055337", "createdAt": "2020-02-19T03:08:50Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageRepository.java", "diffHunk": "@@ -81,6 +80,7 @@ synchronized void saveInAppMessage(OSInAppMessage inAppMessage) {\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_DISPLAY_QUANTITY, inAppMessage.getDisplayStats().getDisplayQuantity());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_NAME_LAST_DISPLAY, inAppMessage.getDisplayStats().getLastDisplayTime());\n         values.put(OneSignalDbContract.InAppMessageTable.COLUMN_CLICK_IDS, inAppMessage.getClickedClickIds().toString());\n+        values.put(OneSignalDbContract.InAppMessageTable.COLUMN_DISPLAYED, inAppMessage.isDisplayedInSession());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fbec7ea7a435d25c67132f1c52dcc4428b8aedc"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NTU1OA==", "bodyText": "COLUMN_DISPLAYED should be COLUMN_DISPLAYED_IN_SESSION\ndisplayed should be displayed_in_session", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r381055558", "createdAt": "2020-02-19T03:09:55Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalDbContract.java", "diffHunk": "@@ -81,5 +81,6 @@\n       public static final String COLUMN_NAME_DISPLAY_QUANTITY = \"display_quantity\";\n       public static final String COLUMN_NAME_LAST_DISPLAY = \"last_display\";\n       public static final String COLUMN_CLICK_IDS = \"click_ids\";\n+      public static final String COLUMN_DISPLAYED = \"displayed\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fbec7ea7a435d25c67132f1c52dcc4428b8aedc"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cfb19ea29d6e7360c833694ce3ac7d5bd0d77253", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/cfb19ea29d6e7360c833694ce3ac7d5bd0d77253", "committedDate": "2020-02-19T16:53:23Z", "message": "Rename display db column"}, "afterCommit": {"oid": "4c213bbccd96ab8bf144773f1d39a87808617b39", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/4c213bbccd96ab8bf144773f1d39a87808617b39", "committedDate": "2020-02-20T05:03:03Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c213bbccd96ab8bf144773f1d39a87808617b39", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/4c213bbccd96ab8bf144773f1d39a87808617b39", "committedDate": "2020-02-20T05:03:03Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}, "afterCommit": {"oid": "a4e06d0f37cbefd42ab95c9751fba711bd22f9b5", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a4e06d0f37cbefd42ab95c9751fba711bd22f9b5", "committedDate": "2020-02-20T16:50:18Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4e06d0f37cbefd42ab95c9751fba711bd22f9b5", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a4e06d0f37cbefd42ab95c9751fba711bd22f9b5", "committedDate": "2020-02-20T16:50:18Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}, "afterCommit": {"oid": "40981030647c650b83718760c31d0e4f81cbbf3d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/40981030647c650b83718760c31d0e4f81cbbf3d", "committedDate": "2020-02-20T17:27:10Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40981030647c650b83718760c31d0e4f81cbbf3d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/40981030647c650b83718760c31d0e4f81cbbf3d", "committedDate": "2020-02-20T17:27:10Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}, "afterCommit": {"oid": "91c3f5f60d05bed78e62294a39a8e27fe13ed8ae", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/91c3f5f60d05bed78e62294a39a8e27fe13ed8ae", "committedDate": "2020-02-20T18:21:05Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzODIzNzQ2", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#pullrequestreview-363823746", "createdAt": "2020-02-25T01:53:14Z", "commit": {"oid": "91c3f5f60d05bed78e62294a39a8e27fe13ed8ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NDU1NDE5", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#pullrequestreview-364455419", "createdAt": "2020-02-25T21:19:08Z", "commit": {"oid": "91c3f5f60d05bed78e62294a39a8e27fe13ed8ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMToxOTowOFrOFuVj_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMToxOTowOFrOFuVj_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzMjA5Mg==", "bodyText": "I marked this in #951 already.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/953#discussion_r384132092", "createdAt": "2020-02-25T21:19:08Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -168,6 +168,16 @@ private void processInAppMessageJson(@NonNull JSONArray json) throws JSONExcepti\n         evaluateInAppMessages();\n     }\n \n+    private void deleteOldRedisplayedInAppMessages() {\n+        new Thread(new Runnable() {\n+            @Override\n+            public void run() {\n+                Thread.currentThread().setPriority(Process.THREAD_PRIORITY_BACKGROUND);\n+                inAppMessageRepository.deleteOldRedisplayedInAppMessages();\n+            }\n+        }, OS_SAVE_IN_APP_MESSAGE).start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91c3f5f60d05bed78e62294a39a8e27fe13ed8ae"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec1c78dc0bd168f0fb6e08003c7f147426f55b5d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ec1c78dc0bd168f0fb6e08003c7f147426f55b5d", "committedDate": "2020-02-25T22:33:23Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91c3f5f60d05bed78e62294a39a8e27fe13ed8ae", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/91c3f5f60d05bed78e62294a39a8e27fe13ed8ae", "committedDate": "2020-02-20T18:21:05Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}, "afterCommit": {"oid": "ec1c78dc0bd168f0fb6e08003c7f147426f55b5d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ec1c78dc0bd168f0fb6e08003c7f147426f55b5d", "committedDate": "2020-02-25T22:33:23Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3505, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}