{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNzY5MDEz", "number": 974, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODozMTowMVrODqLdtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODo0NDo0MlrODqLhVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTU0NjE1OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODozMTowMVrOF5xnMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODozMTowMVrOF5xnMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyNjAwMQ==", "bodyText": "Don't make it specific to tags and outcomes we might have more things added here eventually\nChange name from fireTagsAndOutcomeLogs to\nlogInAppMessagePreviewActions or\nlogIamPreviewActions?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/974#discussion_r396126001", "createdAt": "2020-03-22T18:31:01Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -284,19 +285,57 @@ void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @No\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n+        showPrompts(message, action.prompts);\n         fireClickAction(action);\n+        fireTagsAndOutcomeLogs(action);\n     }\n \n-    private void firePrompt(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {\n-        for (OSInAppMessagePrompt prompt : prompts) {\n+    private void fireTagsAndOutcomeLogs(final OSInAppMessageAction action) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b556e07c6555391402b110033a70f7b7b69459"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTU1MTI3OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODozODoyNlrOF5xp2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODozODoyNlrOF5xp2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyNjY4MA==", "bodyText": "way too much extra code here, tags and outcomes are JSONObjects so just call tags.toString() and print that\nwith a single log about the tags\nSame exact thing for outcomes, outcomes.toString() with a log\nex.\nprivate void fireTagsAndOutcomeLogs(final OSInAppMessageAction action) {\n@mikechoch\nmikechoch Member Pending\nDon't make it specific to tags and outcomes we might have more things added here eventually\nChange name from fireTagsAndOutcomeLogs to\nlogInAppMessagePreviewActions or\nlogIamPreviewActions?\nprivate void logInAppMessagePreviewActions(final OSInAppMessageAction action) {\n    JSONObject tags = action.tags;\n    if (tags != null)\n        OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Tags detected inside of the action click payload, ignoring because action came from IAM preview: \" + tags.toString());\n   \n    JSONObject outcomes = action.outcomes;\n    if (outcomes != null)\n        OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Outcomes detected inside of the action click payload, ignoring because action came from IAM preview: \" + outcomes.toString());\n\n    // TODO: Add more action payload preview logs here in future\n}", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/974#discussion_r396126680", "createdAt": "2020-03-22T18:38:26Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -284,19 +285,57 @@ void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @No\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n+        showPrompts(message, action.prompts);\n         fireClickAction(action);\n+        fireTagsAndOutcomeLogs(action);\n     }\n \n-    private void firePrompt(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {\n-        for (OSInAppMessagePrompt prompt : prompts) {\n+    private void fireTagsAndOutcomeLogs(final OSInAppMessageAction action) {\n+        if (action.tags != null) {\n+            OSInAppMessageTag tags = action.tags;\n+            if (tags.getTagsToAdd() != null)\n+                OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Tags to add detected inside of the action click payload, ignoring because action came from IAM preview:: \" + tags.getTagsToAdd());\n+            if (tags.getTagsToRemove() != null)\n+                OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Tags to remove detected inside of the action click payload, ignoring because action came from IAM preview: \" + tags.getTagsToRemove());\n+        }\n+\n+        for (OSInAppMessageOutcome outcome : action.outcomes) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Outcome detected inside of the action click payload, ignoring because action came from IAM preview: \" + outcome.toString());\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b556e07c6555391402b110033a70f7b7b69459"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTU1NTM5OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODo0NDo0MVrOF5xsAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODo0NDo0MVrOF5xsAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyNzIzMw==", "bodyText": "rename to beginProcessingPrompts that way the next calls make more sense.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/974#discussion_r396127233", "createdAt": "2020-03-22T18:44:41Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -284,19 +285,57 @@ void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @No\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n+        showPrompts(message, action.prompts);\n         fireClickAction(action);\n+        fireTagsAndOutcomeLogs(action);\n     }\n \n-    private void firePrompt(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {\n-        for (OSInAppMessagePrompt prompt : prompts) {\n+    private void fireTagsAndOutcomeLogs(final OSInAppMessageAction action) {\n+        if (action.tags != null) {\n+            OSInAppMessageTag tags = action.tags;\n+            if (tags.getTagsToAdd() != null)\n+                OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Tags to add detected inside of the action click payload, ignoring because action came from IAM preview:: \" + tags.getTagsToAdd());\n+            if (tags.getTagsToRemove() != null)\n+                OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Tags to remove detected inside of the action click payload, ignoring because action came from IAM preview: \" + tags.getTagsToRemove());\n+        }\n+\n+        for (OSInAppMessageOutcome outcome : action.outcomes) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Outcome detected inside of the action click payload, ignoring because action came from IAM preview: \" + outcome.toString());\n+        }\n+    }\n+\n+    private void showPrompts(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b556e07c6555391402b110033a70f7b7b69459"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTU1NTQxOnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODo0NDo0MlrOF5xsAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxODo0NDo0MlrOF5xsAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyNzIzNQ==", "bodyText": "Rename to showMultiplePrompts", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/974#discussion_r396127235", "createdAt": "2020-03-22T18:44:42Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -284,19 +285,57 @@ void onMessageActionOccurredOnPreview(@NonNull final OSInAppMessage message, @No\n         action.firstClick = message.takeActionAsUnique();\n \n         firePublicClickHandler(action);\n+        showPrompts(message, action.prompts);\n         fireClickAction(action);\n+        fireTagsAndOutcomeLogs(action);\n     }\n \n-    private void firePrompt(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {\n-        for (OSInAppMessagePrompt prompt : prompts) {\n+    private void fireTagsAndOutcomeLogs(final OSInAppMessageAction action) {\n+        if (action.tags != null) {\n+            OSInAppMessageTag tags = action.tags;\n+            if (tags.getTagsToAdd() != null)\n+                OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Tags to add detected inside of the action click payload, ignoring because action came from IAM preview:: \" + tags.getTagsToAdd());\n+            if (tags.getTagsToRemove() != null)\n+                OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Tags to remove detected inside of the action click payload, ignoring because action came from IAM preview: \" + tags.getTagsToRemove());\n+        }\n+\n+        for (OSInAppMessageOutcome outcome : action.outcomes) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"Outcome detected inside of the action click payload, ignoring because action came from IAM preview: \" + outcome.toString());\n+        }\n+    }\n+\n+    private void showPrompts(OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {\n+        if (prompts.size() > 0) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"IAM showing prompts from IAM: \" + message.toString());\n             // TODO until we don't fix the activity going forward or back dismissing the IAM, we need to auto dismiss\n-            messageWasDismissed(message);\n-            prompt.handlePrompt(new OneSignal.OperationCompletedCallback() {\n+            WebViewManager.dismissCurrentIAM();\n+            handleMultiplePrompts(message, prompts);\n+        }\n+    }\n+\n+    private void handleMultiplePrompts(final OSInAppMessage message, final List<OSInAppMessagePrompt> prompts) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b556e07c6555391402b110033a70f7b7b69459"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2220, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}