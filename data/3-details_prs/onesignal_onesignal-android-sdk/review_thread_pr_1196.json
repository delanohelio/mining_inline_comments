{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NjY2MTY0", "number": 1196, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoyNjowOFrOEyd4Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoyNzo0N1rOEyd8GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzUzODI2OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoyNjowOFrOHpIBRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzo1MjoxN1rOHpJT2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NTA2Mg==", "bodyText": "The return here was removed was that intentional?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512885062", "createdAt": "2020-10-27T17:26:08Z", "author": {"login": "emawby"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -815,25 +816,27 @@ private static void handleAmazonPurchase() {\n    private static void doSessionInit() {\n       // Check session time to determine whether to start a new session or not\n       if (isPastOnSessionTime()) {\n-         OneSignal.onesignalLog(LOG_LEVEL.DEBUG, \"Starting new session\");\n-         OneSignalStateSynchronizer.setNewSession();\n          if (inForeground) {\n+            logger.debug(\"Starting new session\");\n+\n+            OneSignalStateSynchronizer.setNewSession();\n             outcomeEventsController.cleanOutcomes();\n             sessionManager.restartSessionIfNeeded(getAppEntryState());\n             getInAppMessageController().resetSessionLaunchTime();\n+            setLastSessionTime(time.getCurrentTimeMillis());\n          }\n-      } else if (inForeground) {\n-         OneSignal.onesignalLog(LOG_LEVEL.DEBUG, \"Continue on same session\");\n+      } else {\n+         logger.debug(\"Continue on same session\");\n+\n          sessionManager.attemptSessionUpgrade(getAppEntryState());\n       }\n       getInAppMessageController().initWithCachedInAppMessages();\n \n       // We still want register the user to OneSignal if the SDK was initialized\n       //   in the background for the first time.\n       if (!inForeground && hasUserId())\n-         return;\n+         logger.debug(\"doSessionInit on background with already registered user\");\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "040a155100dfa289143eca79e3adf1fae963b986"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkwNjIwMg==", "bodyText": "yeah, this was preventing the background update", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512906202", "createdAt": "2020-10-27T17:52:17Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -815,25 +816,27 @@ private static void handleAmazonPurchase() {\n    private static void doSessionInit() {\n       // Check session time to determine whether to start a new session or not\n       if (isPastOnSessionTime()) {\n-         OneSignal.onesignalLog(LOG_LEVEL.DEBUG, \"Starting new session\");\n-         OneSignalStateSynchronizer.setNewSession();\n          if (inForeground) {\n+            logger.debug(\"Starting new session\");\n+\n+            OneSignalStateSynchronizer.setNewSession();\n             outcomeEventsController.cleanOutcomes();\n             sessionManager.restartSessionIfNeeded(getAppEntryState());\n             getInAppMessageController().resetSessionLaunchTime();\n+            setLastSessionTime(time.getCurrentTimeMillis());\n          }\n-      } else if (inForeground) {\n-         OneSignal.onesignalLog(LOG_LEVEL.DEBUG, \"Continue on same session\");\n+      } else {\n+         logger.debug(\"Continue on same session\");\n+\n          sessionManager.attemptSessionUpgrade(getAppEntryState());\n       }\n       getInAppMessageController().initWithCachedInAppMessages();\n \n       // We still want register the user to OneSignal if the SDK was initialized\n       //   in the background for the first time.\n       if (!inForeground && hasUserId())\n-         return;\n+         logger.debug(\"doSessionInit on background with already registered user\");\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NTA2Mg=="}, "originalCommit": {"oid": "040a155100dfa289143eca79e3adf1fae963b986"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzU0Nzc3OnYy", "diffSide": "RIGHT", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoyNzo0N1rOHpIHIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzo1MzoxN1rOHpJW9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NjU2Mg==", "bodyText": "I think it would be useful to print the values here so we know why registerUser isn't possible since there are 4 possibilities", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512886562", "createdAt": "2020-10-27T17:27:47Z", "author": {"login": "emawby"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1224,16 +1234,18 @@ private static int getTimeZoneOffset() {\n    }\n \n    private static void registerUser() {\n-      Log(LOG_LEVEL.DEBUG,\n+      logger.debug(\n          \"registerUser:\" +\n          \"registerForPushFired:\" + registerForPushFired +\n          \", locationFired: \" + locationFired +\n          \", remoteParams: \" + getRemoteParams() +\n          \", appId: \" + appId\n       );\n \n-      if (!registerForPushFired || !locationFired || getRemoteParams() == null || appId == null)\n+      if (!registerForPushFired || !locationFired || getRemoteParams() == null || appId == null) {\n+         logger.debug(\"registerUser not possible\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "040a155100dfa289143eca79e3adf1fae963b986"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkwNjk5Ng==", "bodyText": "we already had the\n\nlogger.debug(\n         \"registerUser:\" +\n         \"registerForPushFired:\" + registerForPushFired +\n         \", locationFired: \" + locationFired +\n         \", remoteParams: \" + getRemoteParams() +\n         \", appId: \" + appId\n      );\n\ndidn't want to repeat the same data", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512906996", "createdAt": "2020-10-27T17:53:17Z", "author": {"login": "Jeasmine"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1224,16 +1234,18 @@ private static int getTimeZoneOffset() {\n    }\n \n    private static void registerUser() {\n-      Log(LOG_LEVEL.DEBUG,\n+      logger.debug(\n          \"registerUser:\" +\n          \"registerForPushFired:\" + registerForPushFired +\n          \", locationFired: \" + locationFired +\n          \", remoteParams: \" + getRemoteParams() +\n          \", appId: \" + appId\n       );\n \n-      if (!registerForPushFired || !locationFired || getRemoteParams() == null || appId == null)\n+      if (!registerForPushFired || !locationFired || getRemoteParams() == null || appId == null) {\n+         logger.debug(\"registerUser not possible\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NjU2Mg=="}, "originalCommit": {"oid": "040a155100dfa289143eca79e3adf1fae963b986"}, "originalPosition": 154}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2168, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}