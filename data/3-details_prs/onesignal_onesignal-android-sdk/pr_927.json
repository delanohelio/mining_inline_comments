{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDYyMTc3", "number": 927, "title": "Make IAM able to re display multiple times", "bodyText": "Changes on OSInAppMessage class, add two new params delay and limit\nMake OSInAppMessageController handle the multiple re displays\nSave on local database quantity of displays and last display time per IAM\nAdd unit test for new functionality\n\n\n\nThis change is\u2002", "createdAt": "2020-01-21T19:06:27Z", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927", "merged": true, "mergeCommit": {"oid": "ffe6b394c95494807ff00b761a549b8547a1dc6d"}, "closed": true, "closedAt": "2020-02-28T20:39:46Z", "author": {"login": "Jeasmine"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8qbYFAFqTM0NjI3MTc0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcI2ATigFqTM2NjY2ODExNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MjcxNzQ4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-346271748", "createdAt": "2020-01-21T23:56:32Z", "commit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMzo1NjozMlrOFgMupQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwMDoxMTo1NlrOFgM_OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMwNzMwMQ==", "bodyText": "displaysQuantity should be displayQuantity", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369307301", "createdAt": "2020-01-21T23:56:32Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -34,24 +43,42 @@\n     @NonNull\n     public ArrayList<ArrayList<OSTrigger>> triggers;\n \n+    //Last IAM display time in seconds\n+    private long lastDisplayTime = -1;\n+    //Current quantity of displays\n+    private int displaysQuantity = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMwNzM5NQ==", "bodyText": "displaysLimit should be displayLimit", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369307395", "createdAt": "2020-01-21T23:56:53Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -34,24 +43,42 @@\n     @NonNull\n     public ArrayList<ArrayList<OSTrigger>> triggers;\n \n+    //Last IAM display time in seconds\n+    private long lastDisplayTime = -1;\n+    //Current quantity of displays\n+    private int displaysQuantity = 0;\n+    //Quantity of displays limit\n+    private int displaysLimit = Integer.MAX_VALUE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMwODI5NQ==", "bodyText": "Lets rename delay to displayDelay, so it is a little more specific", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369308295", "createdAt": "2020-01-21T23:59:56Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -34,24 +43,42 @@\n     @NonNull\n     public ArrayList<ArrayList<OSTrigger>> triggers;\n \n+    //Last IAM display time in seconds\n+    private long lastDisplayTime = -1;\n+    //Current quantity of displays\n+    private int displaysQuantity = 0;\n+    //Quantity of displays limit\n+    private int displaysLimit = Integer.MAX_VALUE;\n+    //Delay between displays in seconds\n+    private long delay = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMwODU2MQ==", "bodyText": "reDisplayEnabled should be redisplayEnabled\nRedisplay is one word, so no capitol D", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369308561", "createdAt": "2020-01-22T00:00:57Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -34,24 +43,42 @@\n     @NonNull\n     public ArrayList<ArrayList<OSTrigger>> triggers;\n \n+    //Last IAM display time in seconds\n+    private long lastDisplayTime = -1;\n+    //Current quantity of displays\n+    private int displaysQuantity = 0;\n+    //Quantity of displays limit\n+    private int displaysLimit = Integer.MAX_VALUE;\n+    //Delay between displays in seconds\n+    private long delay = 0;\n     private double displayDuration;\n \n+    private boolean reDisplayEnabled = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMwOTQwMw==", "bodyText": "increaseDisplayQuantity should be incrementDisplayQuantity\nincrease could be any quantity, increment means to add 1 to a current value", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369309403", "createdAt": "2020-01-22T00:04:05Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -137,22 +189,86 @@ boolean takeActionAsUnique() {\n         return actionTaken = true;\n     }\n \n-    public double getDisplayDuration() {\n+    double getDisplayDuration() {\n         return displayDuration;\n     }\n \n-    public void setDisplayDuration(double displayDuration) {\n+    void setDisplayDuration(double displayDuration) {\n         this.displayDuration = displayDuration;\n     }\n \n+    int getDisplaysQuantity() {\n+        return displaysQuantity;\n+    }\n+\n+    void setDisplaysQuantity(int displaysQuantity) {\n+        this.displaysQuantity = displaysQuantity;\n+    }\n+\n+    void increaseDisplayQuantity() {\n+        this.displaysQuantity++;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMwOTY2Ng==", "bodyText": "isRemainingDisplays should be shouldDisplayAgain", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369309666", "createdAt": "2020-01-22T00:05:02Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -137,22 +189,86 @@ boolean takeActionAsUnique() {\n         return actionTaken = true;\n     }\n \n-    public double getDisplayDuration() {\n+    double getDisplayDuration() {\n         return displayDuration;\n     }\n \n-    public void setDisplayDuration(double displayDuration) {\n+    void setDisplayDuration(double displayDuration) {\n         this.displayDuration = displayDuration;\n     }\n \n+    int getDisplaysQuantity() {\n+        return displaysQuantity;\n+    }\n+\n+    void setDisplaysQuantity(int displaysQuantity) {\n+        this.displaysQuantity = displaysQuantity;\n+    }\n+\n+    void increaseDisplayQuantity() {\n+        this.displaysQuantity++;\n+    }\n+\n+    int getDisplaysLimit() {\n+        return displaysLimit;\n+    }\n+\n+    long getDelay() {\n+        return delay;\n+    }\n+\n+    long getLastDisplayTime() {\n+        return lastDisplayTime;\n+    }\n+\n+    void setLastDisplayTime(long lastDisplayTime) {\n+        this.lastDisplayTime = lastDisplayTime;\n+    }\n+\n+    boolean isReDisplayEnabled() {\n+        return reDisplayEnabled;\n+    }\n+\n+    boolean isRemainingDisplays() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 208}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMxMDUzMg==", "bodyText": "Why aren't we using the previous messages instead?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369310532", "createdAt": "2020-01-22T00:08:11Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -27,16 +29,20 @@\n     }};\n \n     public static final String IN_APP_MESSAGES_JSON_KEY = \"in_app_messages\";\n+    private static final String OS_SAVE_IN_APP_MESSAGE = \"OS_SAVE_IN_APP_MESSAGE\";\n \n     OSTriggerController triggerController;\n     private OSSystemConditionController systemConditionController;\n+    private OSInAppMessageRepository inAppMessageRepository;\n \n     // IAMs loaded remotely from on_session\n     //   If on_session won't be called this will be loaded from cache\n     @NonNull private ArrayList<OSInAppMessage> messages;\n     // IAMs that have had their trigger(s) evaluated to true;\n     //   This mean they have been added to the queue to display, or have already displayed\n-    @NonNull final private Set<String> triggeredMessages;\n+    @NonNull final private Set<String> dismissedAndToDismissMessages;\n+    // IAMs displayed with last displayed time and quantity of displays data\n+    @NonNull final private List<OSInAppMessage> displayedMessagesData;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMxMDcxNA==", "bodyText": "dismissedAndToDismissMessages should be dismissedMessages, no need to over complicate the name", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369310714", "createdAt": "2020-01-22T00:08:50Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -27,16 +29,20 @@\n     }};\n \n     public static final String IN_APP_MESSAGES_JSON_KEY = \"in_app_messages\";\n+    private static final String OS_SAVE_IN_APP_MESSAGE = \"OS_SAVE_IN_APP_MESSAGE\";\n \n     OSTriggerController triggerController;\n     private OSSystemConditionController systemConditionController;\n+    private OSInAppMessageRepository inAppMessageRepository;\n \n     // IAMs loaded remotely from on_session\n     //   If on_session won't be called this will be loaded from cache\n     @NonNull private ArrayList<OSInAppMessage> messages;\n     // IAMs that have had their trigger(s) evaluated to true;\n     //   This mean they have been added to the queue to display, or have already displayed\n-    @NonNull final private Set<String> triggeredMessages;\n+    @NonNull final private Set<String> dismissedAndToDismissMessages;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMxMTExNA==", "bodyText": "Why is this <p> here?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369311114", "createdAt": "2020-01-22T00:10:22Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -21,7 +30,7 @@\n     /**\n      * Allows in-app messages to use multiple language variants, or to have variations between\n      * different device types (ie. a different image for phones vs. tablets, etc.).\n-     *\n+     * <p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMxMTU0NA==", "bodyText": "Pass null into here instead, if possible", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r369311544", "createdAt": "2020-01-22T00:11:56Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -51,41 +57,44 @@\n \n     @Nullable private static OSInAppMessageController sharedInstance;\n     public static OSInAppMessageController getController() {\n+        OneSignalDbHelper dbHelper = OneSignal.getDBHelperInstance();\n+\n         // Make sure only Android 4.4 devices and higher can use IAMs\n         if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n-            sharedInstance = new OSInAppMessageDummyController();\n+            sharedInstance = new OSInAppMessageDummyController(dbHelper);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe", "committedDate": "2020-01-21T19:05:57Z", "message": "Make IAM able to re display multiple times\n\n  * Changes on OSInAppMessage class, add two new params delay and limit\n  * Make OSInAppMessageController handle the multiple re displays\n  * Save on local databse quantity of displays and last display time per IAM\n  * Add unit test for new functionality"}, "afterCommit": {"oid": "78e25829f7f929eb61a3404c80679457d0aaf05d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/78e25829f7f929eb61a3404c80679457d0aaf05d", "committedDate": "2020-01-27T05:51:35Z", "message": "Add click functionality for redisplay\n\n  * Make IAM track click UUI to enable multiple clicks on same IAM"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78e25829f7f929eb61a3404c80679457d0aaf05d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/78e25829f7f929eb61a3404c80679457d0aaf05d", "committedDate": "2020-01-27T05:51:35Z", "message": "Add click functionality for redisplay\n\n  * Make IAM track click UUI to enable multiple clicks on same IAM"}, "afterCommit": {"oid": "0e299a3c91fbf35febf972fce65d34abb794a98f", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/0e299a3c91fbf35febf972fce65d34abb794a98f", "committedDate": "2020-01-27T05:58:25Z", "message": "Add click functionality for redisplay\n\n  * Make IAM track click UUI to enable multiple clicks on same IAM"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e299a3c91fbf35febf972fce65d34abb794a98f", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/0e299a3c91fbf35febf972fce65d34abb794a98f", "committedDate": "2020-01-27T05:58:25Z", "message": "Add click functionality for redisplay\n\n  * Make IAM track click UUI to enable multiple clicks on same IAM"}, "afterCommit": {"oid": "2eab6f5daa346f25aefcb082de36bea951d61f3a", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/2eab6f5daa346f25aefcb082de36bea951d61f3a", "committedDate": "2020-01-27T16:05:34Z", "message": "Add click functionality for redisplay\n\n  * Make IAM track click UUI to enable multiple clicks on same IAM"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODk3MDI4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-348897028", "createdAt": "2020-01-27T18:56:13Z", "commit": {"oid": "2eab6f5daa346f25aefcb082de36bea951d61f3a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODo1NjoxM1rOFiNtGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODo1NjoxM1rOFiNtGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyMDQ0MQ==", "bodyText": "I think we should have a single @NonNull private ArrayList<OSInAppMessage> messages; that contains on IAMs pulled down for the current session\nI cant tell if you are agreeing or not haha?", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r371420441", "createdAt": "2020-01-27T18:56:13Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -27,16 +29,20 @@\n     }};\n \n     public static final String IN_APP_MESSAGES_JSON_KEY = \"in_app_messages\";\n+    private static final String OS_SAVE_IN_APP_MESSAGE = \"OS_SAVE_IN_APP_MESSAGE\";\n \n     OSTriggerController triggerController;\n     private OSSystemConditionController systemConditionController;\n+    private OSInAppMessageRepository inAppMessageRepository;\n \n     // IAMs loaded remotely from on_session\n     //   If on_session won't be called this will be loaded from cache\n     @NonNull private ArrayList<OSInAppMessage> messages;\n     // IAMs that have had their trigger(s) evaluated to true;\n     //   This mean they have been added to the queue to display, or have already displayed\n-    @NonNull final private Set<String> triggeredMessages;\n+    @NonNull final private Set<String> dismissedAndToDismissMessages;\n+    // IAMs displayed with last displayed time and quantity of displays data\n+    @NonNull final private List<OSInAppMessage> displayedMessagesData;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMxMDUzMg=="}, "originalCommit": {"oid": "e4e1d4c461a38d4cc875e30bf7e7b9b358c74efe"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODk1Njgw", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-348895680", "createdAt": "2020-01-27T18:54:05Z", "commit": {"oid": "2eab6f5daa346f25aefcb082de36bea951d61f3a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODo1NDowNlrOFiNpHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxOToyNzo0MVrOFiOqrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQxOTQyMw==", "bodyText": "Prefer adding curly braces if more than one line is under an if statement.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r371419423", "createdAt": "2020-01-27T18:54:06Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -105,8 +159,16 @@ JSONObject toJSONObject() {\n                 variants.put(key, converted);\n             }\n \n-            json.put(\"variants\", variants);\n-            json.put(\"display_duration\", this.displayDuration);\n+            json.put(IAM_VARIANTS, variants);\n+            json.put(DISPLAY_DURATION, this.displayDuration);\n+            json.put(DISPLAY_LIMIT, this.displayLimit);\n+            json.put(DISPLAY_DELAY, this.displayDelay);\n+\n+            if (redisplayEnabled)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eab6f5daa346f25aefcb082de36bea951d61f3a"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyOTE4Mw==", "bodyText": "This if would never be true as we new up a OSInAppMessageDummyController instead for per 4.4 devices.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r371429183", "createdAt": "2020-01-27T19:13:50Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -94,6 +102,14 @@ protected OSInAppMessageController() {\n         );\n         if (tempClickedMessageIdsSet != null)\n             clickedClickIds.addAll(tempClickedMessageIdsSet);\n+\n+        if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.JELLY_BEAN_MR2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eab6f5daa346f25aefcb082de36bea951d61f3a"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQzMDE5OA==", "bodyText": "nit, remove space after (", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r371430198", "createdAt": "2020-01-27T19:15:52Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/InAppMessagingUnitTests.java", "diffHunk": "@@ -153,6 +157,97 @@ public void testBuiltMessageVariants() {\n         assertEquals(message.variants.get(\"android\").get(\"en\"), InAppMessagingHelpers.TEST_ENGLISH_ANDROID_VARIANT_ID);\n     }\n \n+    @Test\n+    public void testBuiltMessageReDisplay() throws JSONException {\n+        OSTestInAppMessage message = InAppMessagingHelpers.buildTestMessageWitRedisplay(\n+                LIMIT,\n+                DELAY\n+        );\n+        assertTrue(message.isRedisplayEnabled());\n+        assertEquals(LIMIT, message.getDisplayLimit());\n+        assertEquals(DELAY, message.getDisplayDelay());\n+        assertEquals(-1.0, message.getLastDisplayTime());\n+        assertEquals(0, message.getDisplayQuantity());\n+\n+        OSTestInAppMessage messageWithoutDisplay = InAppMessagingHelpers.buildTestMessageWithSingleTrigger(\n+                OSTriggerKind.SESSION_TIME,\n+                null,\n+                OSTriggerOperator.GREATER_THAN_OR_EQUAL_TO.toString(),\n+                3\n+        );\n+        assertFalse(messageWithoutDisplay.isRedisplayEnabled());\n+        assertEquals(Integer.MAX_VALUE, messageWithoutDisplay.getDisplayLimit());\n+        assertEquals(0.0, messageWithoutDisplay.getDisplayDelay());\n+        assertEquals(-1.0, messageWithoutDisplay.getLastDisplayTime());\n+        assertEquals(0, messageWithoutDisplay.getDisplayQuantity());\n+    }\n+\n+    @Test\n+    public void testBuiltMessageRedisplayLimit() throws JSONException {\n+        OSTestInAppMessage message = InAppMessagingHelpers.buildTestMessageWitRedisplay(\n+                LIMIT,\n+                DELAY\n+        );\n+\n+        for (int i = 0; i < LIMIT; i++) {\n+            assertTrue( message.shouldDisplayAgain());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eab6f5daa346f25aefcb082de36bea951d61f3a"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQzNjIwNg==", "bodyText": "Here we need to add a check to only re-display if a trigger was updated that is in this IAM's trigger set.\nThis prevents the IAM from reshowing over and over until it hits it's display limit since evaluateInAppMessages is called each time an IAM is dismissed.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r371436206", "createdAt": "2020-01-27T19:27:41Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -303,17 +323,48 @@ void onFailure(int statusCode, String response, Throwable throwable) {\n         }\n     }\n \n+    /**\n+     * In order to an IAM to be re display, two condition need to be satisfied\n+     *  - Gap between displays\n+     *  - Quantity of displays\n+     *\n+     * For re display, the message need to be removed from the arrays that track the display\n+     * */\n+    private void setDataForReDisplay(OSInAppMessage message) {\n+        if (!message.isRedisplayEnabled())\n+            return;\n+\n+        int index = displayedMessagesData.indexOf(message);\n+        if (index != -1) {\n+            OneSignal.onesignalLog(OneSignal.LOG_LEVEL.DEBUG, \"setDataForReDisplay: \" + message.messageId);\n+\n+            OSInAppMessage savedIAM = displayedMessagesData.get(index);\n+            message.setLastDisplayTime(savedIAM.getLastDisplayTime());\n+            message.setDisplayQuantity(savedIAM.getDisplayQuantity());\n+\n+            if (message.isDelayTimeSatisfied() && message.shouldDisplayAgain()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eab6f5daa346f25aefcb082de36bea951d61f3a"}, "originalPosition": 171}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59025d947321961db001d72470314896d3eb5a31", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/59025d947321961db001d72470314896d3eb5a31", "committedDate": "2020-01-29T21:05:13Z", "message": "Add OSInAppMessageDisplayStats stats and trigger validation\n\n  * Only IAM that have their triggers changed and can redisplay may redisplay"}, "afterCommit": {"oid": "76d40edb26f587169ae829ad8167c30584a36679", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/76d40edb26f587169ae829ad8167c30584a36679", "committedDate": "2020-01-29T21:22:11Z", "message": "Add OSInAppMessageDisplayStats stats and trigger validation\n\n  * Only IAM that have their triggers changed and can redisplay may redisplay"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMTkwNTgx", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-351190581", "createdAt": "2020-01-30T22:36:26Z", "commit": {"oid": "76d40edb26f587169ae829ad8167c30584a36679"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMjozNjoyNlrOFj8O9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMjozNjoyNlrOFj8O9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIzMTM1MQ==", "bodyText": "ReDisplay should be Redisplay", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r373231351", "createdAt": "2020-01-30T22:36:26Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -303,17 +325,47 @@ void onFailure(int statusCode, String response, Throwable throwable) {\n         }\n     }\n \n+    /**\n+     * In order to an IAM to be re display, two condition need to be satisfied\n+     *  - Gap between displays\n+     *  - Quantity of displays\n+     *\n+     * For re display, the message need to be removed from the arrays that track the display\n+     * */\n+    private void setDataForReDisplay(OSInAppMessage message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76d40edb26f587169ae829ad8167c30584a36679"}, "originalPosition": 169}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76d40edb26f587169ae829ad8167c30584a36679", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/76d40edb26f587169ae829ad8167c30584a36679", "committedDate": "2020-01-29T21:22:11Z", "message": "Add OSInAppMessageDisplayStats stats and trigger validation\n\n  * Only IAM that have their triggers changed and can redisplay may redisplay"}, "afterCommit": {"oid": "b066d9fd76845dfe82be5048aea6abc774e1254b", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/b066d9fd76845dfe82be5048aea6abc774e1254b", "committedDate": "2020-02-03T18:09:26Z", "message": "Rename to redisplay"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTA3MTUy", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-350507152", "createdAt": "2020-01-29T23:59:35Z", "commit": {"oid": "76d40edb26f587169ae829ad8167c30584a36679"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMzo1OTozNlrOFjbmNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMzo1OTozNlrOFjbmNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY5NjYyOA==", "bodyText": "We need to also call checkTriggerChanges() in removeTriggersForKeys as well, as they could have a condition to display on trigger does not exists.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r372696628", "createdAt": "2020-01-29T23:59:36Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -553,6 +587,7 @@ public void messageTriggerConditionChanged() {\n      */\n     void addTriggers(Map<String, Object> newTriggers) {\n         triggerController.addTriggers(newTriggers);\n+        checkTriggerChanges(newTriggers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76d40edb26f587169ae829ad8167c30584a36679"}, "originalPosition": 143}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "502ed3f28341024c7621c628998079495ab9965e", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/502ed3f28341024c7621c628998079495ab9965e", "committedDate": "2020-02-04T17:16:42Z", "message": "Improve code"}, "afterCommit": {"oid": "f022bf8858aabf177ae7dd7c46aa4e6f62dd363d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f022bf8858aabf177ae7dd7c46aa4e6f62dd363d", "committedDate": "2020-02-04T17:23:53Z", "message": "Improve code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f022bf8858aabf177ae7dd7c46aa4e6f62dd363d", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f022bf8858aabf177ae7dd7c46aa4e6f62dd363d", "committedDate": "2020-02-04T17:23:53Z", "message": "Improve code"}, "afterCommit": {"oid": "69d6475284b5a1adb63571e7f99f04166e75d364", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/69d6475284b5a1adb63571e7f99f04166e75d364", "committedDate": "2020-02-04T17:24:47Z", "message": "Improve code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4dc971e01ef85f12e65bb1874ec22e36243e422", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d4dc971e01ef85f12e65bb1874ec22e36243e422", "committedDate": "2020-02-10T06:51:37Z", "message": "Add TimeTraveling to testing\n\n  * Remove thread sleep\n  * Add remove trigger test"}, "afterCommit": {"oid": "33954ef0cd1a80b625526574ed3de498ce95058b", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/33954ef0cd1a80b625526574ed3de498ce95058b", "committedDate": "2020-02-10T06:54:39Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33954ef0cd1a80b625526574ed3de498ce95058b", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/33954ef0cd1a80b625526574ed3de498ce95058b", "committedDate": "2020-02-10T06:54:39Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}, "afterCommit": {"oid": "d29f7eb76a212cf016163fd9970a1f08de5af6d0", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d29f7eb76a212cf016163fd9970a1f08de5af6d0", "committedDate": "2020-02-10T06:57:45Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d29f7eb76a212cf016163fd9970a1f08de5af6d0", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d29f7eb76a212cf016163fd9970a1f08de5af6d0", "committedDate": "2020-02-10T06:57:45Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}, "afterCommit": {"oid": "3ebe8352de384a3a02970dc2b519a9f692d97cd4", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/3ebe8352de384a3a02970dc2b519a9f692d97cd4", "committedDate": "2020-02-11T19:11:47Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODIyMDY2", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-360822066", "createdAt": "2020-02-19T03:31:07Z", "commit": {"oid": "3ebe8352de384a3a02970dc2b519a9f692d97cd4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzozMTowN1rOFraDrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzozMTowN1rOFraDrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA2MDAxNA==", "bodyText": "We can clean up this DateGenerator by using  System.currentTimeMillis()  instead.  This way we can use advanceSystemTimeBy in our tests for mocking time.", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r381060014", "createdAt": "2020-02-19T03:31:07Z", "author": {"login": "jkasten2"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -94,6 +106,22 @@ protected OSInAppMessageController() {\n         );\n         if (tempClickedMessageIdsSet != null)\n             clickedClickIds.addAll(tempClickedMessageIdsSet);\n+\n+        initRedisplayData(dbInstance);\n+    }\n+\n+    /*\n+    * For testing purposes\n+    * */\n+    public DateGenerator getDateGenerator() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ebe8352de384a3a02970dc2b519a9f692d97cd4"}, "originalPosition": 119}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ebe8352de384a3a02970dc2b519a9f692d97cd4", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/3ebe8352de384a3a02970dc2b519a9f692d97cd4", "committedDate": "2020-02-11T19:11:47Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}, "afterCommit": {"oid": "353f5635f7df1dd7394f953c27e5ac0b964ee4e6", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/353f5635f7df1dd7394f953c27e5ac0b964ee4e6", "committedDate": "2020-02-20T02:41:57Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "353f5635f7df1dd7394f953c27e5ac0b964ee4e6", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/353f5635f7df1dd7394f953c27e5ac0b964ee4e6", "committedDate": "2020-02-20T02:41:57Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}, "afterCommit": {"oid": "478c14eeb0d8208a8308a0b479f674fca25851b5", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/478c14eeb0d8208a8308a0b479f674fca25851b5", "committedDate": "2020-02-20T03:16:59Z", "message": "Add TimeTravel to testing\n\n  * Remove thread sleep\n  * Add Date generator to mock new date times for delays\n  * Add remove trigger test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTc1Mjg4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-362175288", "createdAt": "2020-02-20T19:32:12Z", "commit": {"oid": "478c14eeb0d8208a8308a0b479f674fca25851b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bbfce94003984279205441bba8f3ed6ef0fdd0c", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/3bbfce94003984279205441bba8f3ed6ef0fdd0c", "committedDate": "2020-02-27T23:22:40Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}, "afterCommit": {"oid": "a67cf61aff0f6f39acf1263ae8d90eec2b1ed831", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a67cf61aff0f6f39acf1263ae8d90eec2b1ed831", "committedDate": "2020-02-27T23:28:10Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b32a9fc3edea311f55d422ce1732e36c7fde56f6", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/b32a9fc3edea311f55d422ce1732e36c7fde56f6", "committedDate": "2020-02-28T00:35:32Z", "message": "Make IAM able to re display multiple times\n\n  * Changes on OSInAppMessage class, add two new params delay and limit\n  * Make OSInAppMessageController handle the multiple re displays\n  * Save on local database quantity of displays and last display time per IAM\n  * Add unit test for new functionality"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "725ead7ca221c2e196871cdb1fb398b10292ec41", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/725ead7ca221c2e196871cdb1fb398b10292ec41", "committedDate": "2020-02-28T00:40:55Z", "message": "Remove IAM from db\n\n  * Remove IAMs with redisplay from DB when lastDisplay is\n    older than six month"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc48c25dcb454e5e9c7cedeb8c41f1b599717969", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/fc48c25dcb454e5e9c7cedeb8c41f1b599717969", "committedDate": "2020-02-28T00:44:28Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a67cf61aff0f6f39acf1263ae8d90eec2b1ed831", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a67cf61aff0f6f39acf1263ae8d90eec2b1ed831", "committedDate": "2020-02-27T23:28:10Z", "message": "Display once per session IAM with redisplay\n\n   * Add no trigger check, display once per session\n   * Add displayed param to IAM\n   * Add test for cold start and init OneSignal"}, "afterCommit": {"oid": "4a35ed0f8d4c9dfeb7b41220ae0f7fc94d4d9a8e", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/4a35ed0f8d4c9dfeb7b41220ae0f7fc94d4d9a8e", "committedDate": "2020-02-28T18:50:18Z", "message": "Improve code after rebasing\n\n  * Remove IAMController Shadow from testing\n  * Changes parts of IAMSController"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a35ed0f8d4c9dfeb7b41220ae0f7fc94d4d9a8e", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/4a35ed0f8d4c9dfeb7b41220ae0f7fc94d4d9a8e", "committedDate": "2020-02-28T18:50:18Z", "message": "Improve code after rebasing\n\n  * Remove IAMController Shadow from testing\n  * Changes parts of IAMSController"}, "afterCommit": {"oid": "3413fd7edc3e50fe8f5dfbca0f5f18841f116105", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/3413fd7edc3e50fe8f5dfbca0f5f18841f116105", "committedDate": "2020-02-28T18:54:15Z", "message": "Improve code after rebasing\n\n  * Remove IAMController Shadow from testing\n  * Changes parts of IAMSController"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjU5Mjgz", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-366659283", "createdAt": "2020-02-28T20:15:22Z", "commit": {"oid": "3413fd7edc3e50fe8f5dfbca0f5f18841f116105"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDoxNToyM1rOFwBmkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDoxOTowMlrOFwBslQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkwMjIyNg==", "bodyText": "Change dbInstance to dbHelper, most of our codebase is dbHelper", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r385902226", "createdAt": "2020-02-28T20:15:23Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -110,7 +110,7 @@ protected OSInAppMessageController(OneSignalDbHelper dbInstance) {\n         initRedisplayData(dbInstance);\n     }\n \n-    void initRedisplayData(OneSignalDbHelper dbInstance) {\n+    protected void initRedisplayData(OneSignalDbHelper dbInstance) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3413fd7edc3e50fe8f5dfbca0f5f18841f116105"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkwMzU2Ng==", "bodyText": "Using contains with an oObject is dangerous. This could be true or false and not represent the String messageId, this should be changed back", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r385903566", "createdAt": "2020-02-28T20:18:34Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -402,7 +402,7 @@ private void setDataForRedisplay(OSInAppMessage message) {\n     private void queueMessageForDisplay(@NonNull OSInAppMessage message) {\n         synchronized (messageDisplayQueue) {\n             // Make sure no message is ever added to the queue more than once\n-            if (!isInAppMessageQueued(message)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3413fd7edc3e50fe8f5dfbca0f5f18841f116105"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkwMzc2NQ==", "bodyText": "Nice clean up!", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#discussion_r385903765", "createdAt": "2020-02-28T20:19:02Z", "author": {"login": "mikechoch"}, "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessageController.java", "diffHunk": "@@ -467,8 +456,7 @@ void messageWasDismissed(@NonNull OSInAppMessage message) {\n     private void dismissCurrentMessage() {\n         synchronized (messageDisplayQueue) {\n             if (messageDisplayQueue.size() > 0) {\n-                String removedMessageId = messageDisplayQueue.get(0).messageId;\n-                messageDisplayQueue.remove(0);\n+                String removedMessageId = messageDisplayQueue.remove(0).messageId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3413fd7edc3e50fe8f5dfbca0f5f18841f116105"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa466764f9636ad993652100d5b3518a91c859af", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/aa466764f9636ad993652100d5b3518a91c859af", "committedDate": "2020-02-28T20:27:09Z", "message": "Improve code after rebasing\n\n  * Remove IAMController Shadow from testing\n  * Changes parts of IAMSController"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3413fd7edc3e50fe8f5dfbca0f5f18841f116105", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/3413fd7edc3e50fe8f5dfbca0f5f18841f116105", "committedDate": "2020-02-28T18:54:15Z", "message": "Improve code after rebasing\n\n  * Remove IAMController Shadow from testing\n  * Changes parts of IAMSController"}, "afterCommit": {"oid": "aa466764f9636ad993652100d5b3518a91c859af", "author": {"user": {"login": "Jeasmine", "name": "JNahui"}}, "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/aa466764f9636ad993652100d5b3518a91c859af", "committedDate": "2020-02-28T20:27:09Z", "message": "Improve code after rebasing\n\n  * Remove IAMController Shadow from testing\n  * Changes parts of IAMSController"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjY4MTE0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/927#pullrequestreview-366668114", "createdAt": "2020-02-28T20:32:41Z", "commit": {"oid": "aa466764f9636ad993652100d5b3518a91c859af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3643, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}