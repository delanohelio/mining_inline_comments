{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMTY1NDk1", "number": 4341, "title": "[WFCORE-5095] Add the ability to make use of an automatically generated self-signed certificate with Elytron", "bodyText": "https://issues.redhat.com/browse/WFCORE-5095\nhttps://issues.redhat.com/browse/EAP7-1545\nThis is for WildFly Core 14. This PR also contains the Elytron subsystem bump from #4342.\nAnalysis document: wildfly/wildfly-proposals#332\nWildFly PR with documentation and tests: wildfly/wildfly#13596", "createdAt": "2020-09-22T20:03:56Z", "url": "https://github.com/wildfly/wildfly-core/pull/4341", "merged": true, "mergeCommit": {"oid": "92c819c2757bb1f90be335650c44137804e91400"}, "closed": true, "closedAt": "2020-12-02T14:31:22Z", "author": {"login": "fjuma"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLu25kABqjM3OTg5MTI1MzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh6KPegFqTU0MTkwNDAwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3322b03b28a5daacbf63203db8e0bd9b1e4ef8bb", "author": {"user": {"login": "fjuma", "name": "Farah Juma"}}, "url": "https://github.com/wildfly/wildfly-core/commit/3322b03b28a5daacbf63203db8e0bd9b1e4ef8bb", "committedDate": "2020-09-22T19:37:50Z", "message": "[WFCORE-5095] Add server-ssl-context configuration to the default config"}, "afterCommit": {"oid": "284d538ca5867efc9fe6927a2d24651d8eaeb3dd", "author": {"user": {"login": "fjuma", "name": "Farah Juma"}}, "url": "https://github.com/wildfly/wildfly-core/commit/284d538ca5867efc9fe6927a2d24651d8eaeb3dd", "committedDate": "2020-09-23T16:05:39Z", "message": "[WFCORE-5095] Add server-ssl-context configuration to the default config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDIzNTg4", "url": "https://github.com/wildfly/wildfly-core/pull/4341#pullrequestreview-527023588", "createdAt": "2020-11-10T09:44:22Z", "commit": {"oid": "061ec72025ed591821f82ee3c371c13ba590c365"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0NDoyMlrOHwUKug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0NDoyMlrOHwUKug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQyNDEyMg==", "bodyText": "Not a reason to delay the feature as this is private so exposure is limited but should a class such as this be a utility in the Elytron project?", "url": "https://github.com/wildfly/wildfly-core/pull/4341#discussion_r520424122", "createdAt": "2020-11-10T09:44:22Z", "author": {"login": "darranl"}, "path": "elytron/src/main/java/org/wildfly/extension/elytron/SSLDefinitions.java", "diffHunk": "@@ -1017,6 +1027,110 @@ public String chooseEngineServerAlias(String keyType, Principal[] issuers, SSLEn\n         }\n     }\n \n+    private static class LazyDelegatingKeyManager extends DelegatingKeyManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "061ec72025ed591821f82ee3c371c13ba590c365"}, "originalPosition": 115}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDI0MTU5", "url": "https://github.com/wildfly/wildfly-core/pull/4341#pullrequestreview-527024159", "createdAt": "2020-11-10T09:45:01Z", "commit": {"oid": "061ec72025ed591821f82ee3c371c13ba590c365"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0NTowMVrOHwUMfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0NTowMVrOHwUMfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQyNDU3NA==", "bodyText": "Ah I see it is MSC aware.", "url": "https://github.com/wildfly/wildfly-core/pull/4341#discussion_r520424574", "createdAt": "2020-11-10T09:45:01Z", "author": {"login": "darranl"}, "path": "elytron/src/main/java/org/wildfly/extension/elytron/SSLDefinitions.java", "diffHunk": "@@ -1017,6 +1027,110 @@ public String chooseEngineServerAlias(String keyType, Principal[] issuers, SSLEn\n         }\n     }\n \n+    private static class LazyDelegatingKeyManager extends DelegatingKeyManager {\n+        private ModifiableKeyStoreService keyStoreService;\n+        private char[] password;\n+        private KeyManagerFactory keyManagerFactory;\n+        private String generateSelfSignedCertificateHostName;\n+        private String aliasFilter;\n+        private volatile boolean init = false;\n+\n+        private LazyDelegatingKeyManager(ModifiableKeyStoreService keyStoreService, char[] password, KeyManagerFactory keyManagerFactory,\n+                                         String generateSelfSignedCertificateHostName, String aliasFilter) {\n+            this.keyStoreService = keyStoreService;\n+            this.password = password;\n+            this.keyManagerFactory = keyManagerFactory;\n+            this.generateSelfSignedCertificateHostName = generateSelfSignedCertificateHostName;\n+            this.aliasFilter = aliasFilter;\n+        }\n+\n+        private void doInit() {\n+            if(! init) {\n+                synchronized (this) {\n+                    if(! init) {\n+                        try {\n+                            ((KeyStoreService) keyStoreService).generateAndSaveSelfSignedCertificate(generateSelfSignedCertificateHostName, password);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "061ec72025ed591821f82ee3c371c13ba590c365"}, "originalPosition": 137}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDI1NDUw", "url": "https://github.com/wildfly/wildfly-core/pull/4341#pullrequestreview-527025450", "createdAt": "2020-11-10T09:46:27Z", "commit": {"oid": "061ec72025ed591821f82ee3c371c13ba590c365"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0NjoyN1rOHwUQZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0NjoyN1rOHwUQZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQyNTU3NA==", "bodyText": "How about if the file exists but is empty?", "url": "https://github.com/wildfly/wildfly-core/pull/4341#discussion_r520425574", "createdAt": "2020-11-10T09:46:27Z", "author": {"login": "darranl"}, "path": "elytron/src/main/resources/org/wildfly/extension/elytron/LocalDescriptions.properties", "diffHunk": "@@ -1260,6 +1260,7 @@ elytron.key-manager.credential-reference.type=The type of credential this refere\n elytron.key-manager.credential-reference.clear-text=The secret specified using clear text. Check credential store way of supplying credential/secrets to services.\n elytron.key-manager.key-store=Reference to the KeyStore to use to initialise the underlying KeyManagerFactory.\n elytron.key-manager.alias-filter=A filter to apply to the aliases returned from the KeyStore, can either be a comma separated list of aliases to return or one of the following formats ALL:-alias1:-alias2, NONE:+alias1:+alias2\n+elytron.key-manager.generate-self-signed-certificate-host=If the file that backs the KeyStore does not exist and this attribute is set, then a self-signed certificate will be generated for the specified host name. This is not intended for production use.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "061ec72025ed591821f82ee3c371c13ba590c365"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDI2NzYx", "url": "https://github.com/wildfly/wildfly-core/pull/4341#pullrequestreview-527026761", "createdAt": "2020-11-10T09:47:59Z", "commit": {"oid": "284d538ca5867efc9fe6927a2d24651d8eaeb3dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0Nzo1OVrOHwUUTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo0Nzo1OVrOHwUUTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQyNjU3Mw==", "bodyText": "Would now be the time to review the default KeyStore type we choose?", "url": "https://github.com/wildfly/wildfly-core/pull/4341#discussion_r520426573", "createdAt": "2020-11-10T09:47:59Z", "author": {"login": "darranl"}, "path": "core-feature-pack/galleon-common/src/main/resources/feature_groups/core-domain-profile.xml", "diffHunk": "@@ -14,6 +14,13 @@\n                     <param name=\"relative-to\" value=\"jboss.domain.config.dir\"/>\n                 </feature>\n             </include>\n+            <include feature-id=\"subsystem.elytron.key-store:key-store=applicationKS\">\n+                <param name=\"key-store\" value=\"applicationKS\" />\n+                <param name=\"path\" value=\"application.keystore\" />\n+                <param name=\"relative-to\" value=\"jboss.domain.config.dir\" />\n+                <param name=\"type\" value=\"JKS\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "284d538ca5867efc9fe6927a2d24651d8eaeb3dd"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f103c4310ffbf2e737338a046f122207e1f810e", "author": {"user": {"login": "fjuma", "name": "Farah Juma"}}, "url": "https://github.com/wildfly/wildfly-core/commit/0f103c4310ffbf2e737338a046f122207e1f810e", "committedDate": "2020-11-10T20:53:03Z", "message": "[WFCORE-5095] Add the ability to make use of an automatically generated self-signed certificate with Elytron"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20123ab2fe7d0c676f63cb4b8bf1c855817a1a55", "author": {"user": {"login": "fjuma", "name": "Farah Juma"}}, "url": "https://github.com/wildfly/wildfly-core/commit/20123ab2fe7d0c676f63cb4b8bf1c855817a1a55", "committedDate": "2020-11-10T20:53:08Z", "message": "[WFCORE-5095] Add server-ssl-context configuration to the default config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "284d538ca5867efc9fe6927a2d24651d8eaeb3dd", "author": {"user": {"login": "fjuma", "name": "Farah Juma"}}, "url": "https://github.com/wildfly/wildfly-core/commit/284d538ca5867efc9fe6927a2d24651d8eaeb3dd", "committedDate": "2020-09-23T16:05:39Z", "message": "[WFCORE-5095] Add server-ssl-context configuration to the default config"}, "afterCommit": {"oid": "20123ab2fe7d0c676f63cb4b8bf1c855817a1a55", "author": {"user": {"login": "fjuma", "name": "Farah Juma"}}, "url": "https://github.com/wildfly/wildfly-core/commit/20123ab2fe7d0c676f63cb4b8bf1c855817a1a55", "committedDate": "2020-11-10T20:53:08Z", "message": "[WFCORE-5095] Add server-ssl-context configuration to the default config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxOTA0MDA4", "url": "https://github.com/wildfly/wildfly-core/pull/4341#pullrequestreview-541904008", "createdAt": "2020-12-01T13:42:25Z", "commit": {"oid": "20123ab2fe7d0c676f63cb4b8bf1c855817a1a55"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3379, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}