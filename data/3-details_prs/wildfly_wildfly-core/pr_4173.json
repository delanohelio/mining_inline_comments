{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NTgxOTEy", "number": 4173, "title": "[WFCORE-4932] Reading of identity from security domain causes NPE", "bodyText": "https://issues.redhat.com/browse/WFCORE-4932", "createdAt": "2020-04-21T10:24:00Z", "url": "https://github.com/wildfly/wildfly-core/pull/4173", "merged": true, "mergeCommit": {"oid": "1ed2e6a5e4d20c825c06458c10fc0be9a6080830"}, "closed": true, "closedAt": "2020-04-23T14:36:55Z", "author": {"login": "Skyllarr"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZxHnFgFqTM5NzE5ODA1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaZA1VgBqjMyNjQwODMwMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MTk4MDUz", "url": "https://github.com/wildfly/wildfly-core/pull/4173#pullrequestreview-397198053", "createdAt": "2020-04-21T10:27:50Z", "commit": {"oid": "4f9ebdbde78e5c745d555fcfc5086384eb9a46d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMDoyNzo1MFrOGI-enQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMDoyNzo1MFrOGI-enQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA2NTQzNw==", "bodyText": "@darranl @fjuma After fix for WFCORE-4407 security domain service was not started before attempting to read the identity which resulted in NPE.\nThis fix removes NPE but it is still not possible to read the identity and resulting message is \"Identity with name [myIdentity] not authorized.\" This is also invalid response as I should be able to read the identity I just added, right?", "url": "https://github.com/wildfly/wildfly-core/pull/4173#discussion_r412065437", "createdAt": "2020-04-21T10:27:50Z", "author": {"login": "Skyllarr"}, "path": "testsuite/elytron/src/test/java/org/wildfly/test/security/common/elytron/SecurityDomainTest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package org.wildfly.test.security.common.elytron;\n+\n+import org.jboss.as.test.integration.management.util.CLIWrapper;\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.wildfly.core.testrunner.WildflyTestRunner;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+\n+@RunWith(WildflyTestRunner.class)\n+public class SecurityDomainTest {\n+    CLIWrapper cli;\n+\n+    @Before\n+    public void setup() throws Exception {\n+        cli = new CLIWrapper(true);\n+        // add security-domain\n+        cli.sendLine(\"/subsystem=elytron/filesystem-realm=myFsRealm:add(path=my-fs-realm-users,relative-to=jboss.server.config.dir)\");\n+        cli.sendLine(\"/subsystem=elytron/filesystem-realm=myFsRealm:add-identity(identity=myIdentity)\");\n+        cli.sendLine(\"/subsystem=elytron/security-domain=mySD:add(realms=[{realm=myFsRealm}],default-realm=myFsRealm)\");\n+        cli.sendLine(\"reload\");\n+    }\n+\n+    @After\n+    public void cleanup() throws Exception {\n+        removeTestResources();\n+        cli.close();\n+    }\n+\n+    private void removeTestResources() {\n+        cli.sendLine(\"/subsystem=elytron/security-domain=mySD:remove\");\n+        cli.sendLine(\"/subsystem=elytron/filesystem-realm=myFsRealm:remove\");\n+        cli.sendLine(\"reload\");\n+    }\n+\n+    @Test\n+    public void testValidHostContextMapValue() {\n+        boolean success = cli.sendLine(\"/subsystem=elytron/security-domain=mySD:read-identity(name=myIdentity)\", true);\n+        Assert.assertFalse(success);\n+        Assert.assertThat(\"Wrong error message\", cli.readOutput(), containsString(\"Identity with name [myIdentity] not authorized.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f9ebdbde78e5c745d555fcfc5086384eb9a46d7"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f9ebdbde78e5c745d555fcfc5086384eb9a46d7", "author": {"user": {"login": "Skyllarr", "name": "Diana K\u0159epinsk\u00e1 Vilkol\u00e1k"}}, "url": "https://github.com/wildfly/wildfly-core/commit/4f9ebdbde78e5c745d555fcfc5086384eb9a46d7", "committedDate": "2020-04-21T10:22:12Z", "message": "[WFCORE-4932] Reading of identity from security domain causes NPE"}, "afterCommit": {"oid": "1c45a96594678b7c9c3b989c82f74bc7e2c9a1de", "author": {"user": {"login": "Skyllarr", "name": "Diana K\u0159epinsk\u00e1 Vilkol\u00e1k"}}, "url": "https://github.com/wildfly/wildfly-core/commit/1c45a96594678b7c9c3b989c82f74bc7e2c9a1de", "committedDate": "2020-04-21T10:34:02Z", "message": "[WFCORE-4932] Reading of identity from security domain causes NPE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c45a96594678b7c9c3b989c82f74bc7e2c9a1de", "author": {"user": {"login": "Skyllarr", "name": "Diana K\u0159epinsk\u00e1 Vilkol\u00e1k"}}, "url": "https://github.com/wildfly/wildfly-core/commit/1c45a96594678b7c9c3b989c82f74bc7e2c9a1de", "committedDate": "2020-04-21T10:34:02Z", "message": "[WFCORE-4932] Reading of identity from security domain causes NPE"}, "afterCommit": {"oid": "68cade19e26d01ac923b1e9f4d47fe3ed253c238", "author": {"user": {"login": "Skyllarr", "name": "Diana K\u0159epinsk\u00e1 Vilkol\u00e1k"}}, "url": "https://github.com/wildfly/wildfly-core/commit/68cade19e26d01ac923b1e9f4d47fe3ed253c238", "committedDate": "2020-04-22T10:25:15Z", "message": "[WFCORE-4932] Reading of identity from security domain causes NPE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODUzMzAz", "url": "https://github.com/wildfly/wildfly-core/pull/4173#pullrequestreview-398853303", "createdAt": "2020-04-23T08:02:33Z", "commit": {"oid": "68cade19e26d01ac923b1e9f4d47fe3ed253c238"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwODowMjozM1rOGKcHNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwODowMjozM1rOGKcHNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU5OTU0MQ==", "bodyText": "Just missing a copyright header on this one.", "url": "https://github.com/wildfly/wildfly-core/pull/4173#discussion_r413599541", "createdAt": "2020-04-23T08:02:33Z", "author": {"login": "darranl"}, "path": "testsuite/elytron/src/test/java/org/wildfly/test/security/common/elytron/SecurityDomainTest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package org.wildfly.test.security.common.elytron;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68cade19e26d01ac923b1e9f4d47fe3ed253c238"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66a81de033107d5f11d678b9e0e3de4d631b1c8c", "author": {"user": {"login": "Skyllarr", "name": "Diana K\u0159epinsk\u00e1 Vilkol\u00e1k"}}, "url": "https://github.com/wildfly/wildfly-core/commit/66a81de033107d5f11d678b9e0e3de4d631b1c8c", "committedDate": "2020-04-23T08:56:16Z", "message": "[WFCORE-4932] Reading of identity from security domain causes NPE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68cade19e26d01ac923b1e9f4d47fe3ed253c238", "author": {"user": {"login": "Skyllarr", "name": "Diana K\u0159epinsk\u00e1 Vilkol\u00e1k"}}, "url": "https://github.com/wildfly/wildfly-core/commit/68cade19e26d01ac923b1e9f4d47fe3ed253c238", "committedDate": "2020-04-22T10:25:15Z", "message": "[WFCORE-4932] Reading of identity from security domain causes NPE"}, "afterCommit": {"oid": "66a81de033107d5f11d678b9e0e3de4d631b1c8c", "author": {"user": {"login": "Skyllarr", "name": "Diana K\u0159epinsk\u00e1 Vilkol\u00e1k"}}, "url": "https://github.com/wildfly/wildfly-core/commit/66a81de033107d5f11d678b9e0e3de4d631b1c8c", "committedDate": "2020-04-23T08:56:16Z", "message": "[WFCORE-4932] Reading of identity from security domain causes NPE"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3484, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}