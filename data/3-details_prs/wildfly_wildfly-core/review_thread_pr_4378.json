{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5OTUyNDcy", "number": 4378, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozMzoxM1rOFFSOKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozNDo1NFrOFFSR0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDg1NzM3OnYy", "diffSide": "RIGHT", "path": "core-feature-pack/common/src/main/resources/content/bin/common.ps1", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozMzoxM1rOIFusIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozMzoxM1rOIFusIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg3ODc1Mw==", "bodyText": "It looks like we might want to test for IBM too.\n# Check for IBM JVM w/server support\nif [ \"x$HAS_IBM\" = \"x\" ]; then\n    HAS_IBM=`\"$JAVA\" $JVM_OPTVERSION 2>&1 | $GREP -i \"IBM J9\"`\nfi", "url": "https://github.com/wildfly/wildfly-core/pull/4378#discussion_r542878753", "createdAt": "2020-12-14T22:33:13Z", "author": {"login": "jamezp"}, "path": "core-feature-pack/common/src/main/resources/content/bin/common.ps1", "diffHunk": "@@ -308,6 +308,41 @@ Function Start-WildFly-Process {\n \tEnv-Clean-Up\n }\n \n+# Returns java -version output for JDK defined by java opts\n+Function Get-Java-Version ($javaOpts) {\n+    if ($javaOpts -match '-d64') {\n+        $opt_version = '-d64'\n+    } elseif ($javaOpts -match '-d32') {\n+        $opt_version = '-d32'\n+    }\n+\n+    $result = & $JAVA $opt_version -version 2>&1\n+    if ($LASTEXITCODE -eq 1) {\n+        $result = & $JAVA -version 2>&1\n+    }\n+\n+    return $result\n+}\n+\n+# Check if can set option to use HotSpot VM\n+Function Set-Java-Server-Option ($javaOpts) {\n+    if ( -Not ($javaOpts -match '-server') ) {\n+        # Check user requested JDK 'data model'\n+        $version = Get-Java-Version ($javaOpts)\n+\n+        # Check if data model is supported by JDK\n+        # Check for SUN(tm) JVM w/ HotSpot support\n+        # Check for OpenJDK JVM w/server support\n+        if ($LASTEXITCODE -eq 1) {\n+            Write-Host $version\n+        } elseif ($version -match 'HotSpot' -or $version -match 'OpenJDK') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d6b804f4729f6c4d4384799493c713706af6342"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDg2Njc0OnYy", "diffSide": "RIGHT", "path": "core-feature-pack/common/src/main/resources/content/bin/domain.bat", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozNDo1NFrOIFuyQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozNDo1NFrOIFuyQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg4MDMyMw==", "bodyText": "This may also need to check for IBM J9.", "url": "https://github.com/wildfly/wildfly-core/pull/4378#discussion_r542880323", "createdAt": "2020-12-14T22:34:54Z", "author": {"login": "jamezp"}, "path": "core-feature-pack/common/src/main/resources/content/bin/domain.bat", "diffHunk": "@@ -103,14 +103,38 @@ call \"!DIRNAME!common.bat\" :setDefaultModularJvmOptions \"!PROCESS_CONTROLLER_JAV\n set \"PROCESS_CONTROLLER_JAVA_OPTS=!PROCESS_CONTROLLER_JAVA_OPTS! !DEFAULT_MODULAR_JVM_OPTIONS!\"\n call \"!DIRNAME!common.bat\" :setDefaultModularJvmOptions \"!HOST_CONTROLLER_JAVA_OPTS!\"\n set \"HOST_CONTROLLER_JAVA_OPTS=!HOST_CONTROLLER_JAVA_OPTS! !DEFAULT_MODULAR_JVM_OPTIONS!\"\n-setlocal DisableDelayedExpansion\n \n-rem Add -server to the JVM options, if supported\n-\"%JAVA%\" -server -version 2>&1 | findstr /I hotspot > nul\n-if not errorlevel == 1 (\n-  set \"PROCESS_CONTROLLER_JAVA_OPTS=%PROCESS_CONTROLLER_JAVA_OPTS% -server\"\n-  set \"HOST_CONTROLLER_JAVA_OPTS=%HOST_CONTROLLER_JAVA_OPTS% -server\"\n+rem Add -server to the JVM options, if supported by JDK\n+echo \"%JAVA_OPTS%\" | findstr /I \\-server > nul\n+if errorlevel == 1 (\n+    set JVM_OPTVERSION=-version\n+    echo \"%JAVA_OPTS%\" | findstr /I \\-d64 > nul\n+    if not errorlevel == 1 (\n+        set \"JVM_OPTVERSION=-d64 !JVM_OPTVERSION!\"\n+        goto :CHECK_VERSION\n+    )\n+    echo \"%JAVA_OPTS%\" | findstr /I \\-d32 > nul\n+    if not errorlevel == 1 (\n+        set \"JVM_OPTVERSION=-d32 !JVM_OPTVERSION!\"\n+        goto :CHECK_VERSION\n+    )\n+    goto :CHECK_SUPPORTED\n+\n+    :CHECK_VERSION\n+    \"%JAVA%\" !JVM_OPTVERSION! 2>&1 | findstr /I /C:\"Unrecognized option\" > nul\n+    if not errorlevel == 1 (\n+        set JVM_OPTVERSION=-version\n+    )\n+\n+    rem Add -server to the JVM options, if supported\n+    :CHECK_SUPPORTED\n+    \"%JAVA%\" !JVM_OPTVERSION! 2>&1 | findstr /I \"hotspot openJDK\" > nul", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d6b804f4729f6c4d4384799493c713706af6342"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3799, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}