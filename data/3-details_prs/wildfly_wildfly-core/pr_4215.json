{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMjU4MTY1", "number": 4215, "title": "[WFCORE-4982] Convert DeploymentUnitPhaseService to use a for loop instead of a stream to capture known subsystem names.", "bodyText": "https://issues.redhat.com/browse/WFCORE-4982", "createdAt": "2020-05-23T11:04:54Z", "url": "https://github.com/wildfly/wildfly-core/pull/4215", "merged": true, "mergeCommit": {"oid": "646691c185f1a9114adbee58122b25e46022fc77"}, "closed": true, "closedAt": "2020-05-26T16:01:08Z", "author": {"login": "darranl"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckEzH6gH2gAyNDIyMjU4MTY1OjJmOTgyYjRlYmEzNjhlNWViNTY3YmZmZGZlZjkxYWM3MWM2NzkxNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclDmEzgFqTQxODIzNTY4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f982b4eba368e5eb567bffdfef91ac71c679140", "author": {"user": {"login": "darranl", "name": "Darran Lofthouse"}}, "url": "https://github.com/wildfly/wildfly-core/commit/2f982b4eba368e5eb567bffdfef91ac71c679140", "committedDate": "2020-05-23T11:02:49Z", "message": "[WFCORE-4982] Convert DeploymentUnitPhaseService to use a for loop instead of a stream to capture known subsystem names."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MjM1Njg2", "url": "https://github.com/wildfly/wildfly-core/pull/4215#pullrequestreview-418235686", "createdAt": "2020-05-26T12:12:28Z", "commit": {"oid": "2f982b4eba368e5eb567bffdfef91ac71c679140"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjoxMjoyOFrOGabZyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjoxMjoyOFrOGabZyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM2NTEyOQ==", "bodyText": "The code is correct but I find the new sequence hard to read: we instantiate the registeredSubSystems and put it as an attachment. And then, later we fill registeredSubSystems with the names of the subsystems...\nSet<String> registeredSubSystems = (phase == Phase.STRUCTURE) ? new HashSet<>() : deploymentUnit.getAttachment(Attachments.REGISTERED_SUBSYSTEMS);\nfor (...) {\n}\ndeploymentUnit.putAttachment(Attachments.REGISTERED_SUBSYSTEMS, registeredSubSystems);", "url": "https://github.com/wildfly/wildfly-core/pull/4215#discussion_r430365129", "createdAt": "2020-05-26T12:12:28Z", "author": {"login": "jmesnil"}, "path": "server/src/main/java/org/jboss/as/server/deployment/DeploymentUnitPhaseService.java", "diffHunk": "@@ -141,10 +140,17 @@ public void handleEvent(final ServiceController<?> controller, final LifecycleEv\n             }\n         }\n \n-        Set<String> subSystemNames = list.stream().map(e -> e.getSubsystemName()).collect(Collectors.toSet());\n-        Set<String> registeredSubSystems = (phase == Phase.STRUCTURE) ? new HashSet<>() : deploymentUnit.getAttachment(Attachments.REGISTERED_SUBSYSTEMS);\n-        registeredSubSystems.addAll(subSystemNames);\n-        deploymentUnit.putAttachment(Attachments.REGISTERED_SUBSYSTEMS, registeredSubSystems);\n+        final Set<String> registeredSubSystems;\n+        if (phase == Phase.STRUCTURE) {\n+            registeredSubSystems = new HashSet<>();\n+            deploymentUnit.putAttachment(Attachments.REGISTERED_SUBSYSTEMS, registeredSubSystems);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f982b4eba368e5eb567bffdfef91ac71c679140"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3412, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}