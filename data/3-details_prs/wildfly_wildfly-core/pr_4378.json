{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5OTUyNDcy", "number": 4378, "title": "[WFCORE-3825] Unify -server option in windows scripts (ps1, bat) for domain mode (and its servers) on all JDKs", "bodyText": "https://issues.redhat.com/browse/WFCORE-3825", "createdAt": "2020-10-26T11:08:11Z", "url": "https://github.com/wildfly/wildfly-core/pull/4378", "merged": true, "mergeCommit": {"oid": "7617b8ac463b3f0463adbcee528c0cdf207c6ec3"}, "closed": true, "closedAt": "2021-01-28T12:15:30Z", "author": {"login": "lvydra"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXQ1x7gBqjM5MzU5MzE3MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmw-5XAFqTU1MzgyNDQyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b34c4fcf108d256af98b186ae21ae95984c9188", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/4b34c4fcf108d256af98b186ae21ae95984c9188", "committedDate": "2020-10-29T11:26:10Z", "message": "[WFCORE-3825] Refactor"}, "afterCommit": {"oid": "5f43769127187bd909891a2dae0d80e196ba7044", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/5f43769127187bd909891a2dae0d80e196ba7044", "committedDate": "2020-10-29T11:54:10Z", "message": "[WFCORE-3825] Unify -server option in windows scripts (ps1, bat) for domain mode (and its servers) on all JDKs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50435fd9ad92c95e7fe228b358718f0ef1d2fb67", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/50435fd9ad92c95e7fe228b358718f0ef1d2fb67", "committedDate": "2020-10-30T11:10:33Z", "message": "[WFCORE-3825] common.ps1 refactor"}, "afterCommit": {"oid": "94eddb3d041583f88b22f76191ce761df97bae0d", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/94eddb3d041583f88b22f76191ce761df97bae0d", "committedDate": "2020-10-30T11:22:49Z", "message": "parent d4e0210796d3d3daaf1e649fc0fb6f4fde12ea54\nauthor lvydra <lvydra@redhat.com> 1603700707 +0100\ncommitter Lukas Vydra <lvydra@redhat.com> 1604056423 +0100\n\n[WFCORE-3825] Unify -server option in windows scripts (ps1, bat) for domain mode (and its servers) on all JDKs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94eddb3d041583f88b22f76191ce761df97bae0d", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/94eddb3d041583f88b22f76191ce761df97bae0d", "committedDate": "2020-10-30T11:22:49Z", "message": "parent d4e0210796d3d3daaf1e649fc0fb6f4fde12ea54\nauthor lvydra <lvydra@redhat.com> 1603700707 +0100\ncommitter Lukas Vydra <lvydra@redhat.com> 1604056423 +0100\n\n[WFCORE-3825] Unify -server option in windows scripts (ps1, bat) for domain mode (and its servers) on all JDKs"}, "afterCommit": {"oid": "3d6b804f4729f6c4d4384799493c713706af6342", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/3d6b804f4729f6c4d4384799493c713706af6342", "committedDate": "2020-10-30T11:28:00Z", "message": "[WFCORE-3825] Unify -server option in windows scripts (ps1, bat) for domain mode (and its servers) on all JDKs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTUwMTc2", "url": "https://github.com/wildfly/wildfly-core/pull/4378#pullrequestreview-551950176", "createdAt": "2020-12-14T22:33:13Z", "commit": {"oid": "3d6b804f4729f6c4d4384799493c713706af6342"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozMzoxM1rOIFusIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMjozNDo1NFrOIFuyQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg3ODc1Mw==", "bodyText": "It looks like we might want to test for IBM too.\n# Check for IBM JVM w/server support\nif [ \"x$HAS_IBM\" = \"x\" ]; then\n    HAS_IBM=`\"$JAVA\" $JVM_OPTVERSION 2>&1 | $GREP -i \"IBM J9\"`\nfi", "url": "https://github.com/wildfly/wildfly-core/pull/4378#discussion_r542878753", "createdAt": "2020-12-14T22:33:13Z", "author": {"login": "jamezp"}, "path": "core-feature-pack/common/src/main/resources/content/bin/common.ps1", "diffHunk": "@@ -308,6 +308,41 @@ Function Start-WildFly-Process {\n \tEnv-Clean-Up\n }\n \n+# Returns java -version output for JDK defined by java opts\n+Function Get-Java-Version ($javaOpts) {\n+    if ($javaOpts -match '-d64') {\n+        $opt_version = '-d64'\n+    } elseif ($javaOpts -match '-d32') {\n+        $opt_version = '-d32'\n+    }\n+\n+    $result = & $JAVA $opt_version -version 2>&1\n+    if ($LASTEXITCODE -eq 1) {\n+        $result = & $JAVA -version 2>&1\n+    }\n+\n+    return $result\n+}\n+\n+# Check if can set option to use HotSpot VM\n+Function Set-Java-Server-Option ($javaOpts) {\n+    if ( -Not ($javaOpts -match '-server') ) {\n+        # Check user requested JDK 'data model'\n+        $version = Get-Java-Version ($javaOpts)\n+\n+        # Check if data model is supported by JDK\n+        # Check for SUN(tm) JVM w/ HotSpot support\n+        # Check for OpenJDK JVM w/server support\n+        if ($LASTEXITCODE -eq 1) {\n+            Write-Host $version\n+        } elseif ($version -match 'HotSpot' -or $version -match 'OpenJDK') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d6b804f4729f6c4d4384799493c713706af6342"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg4MDMyMw==", "bodyText": "This may also need to check for IBM J9.", "url": "https://github.com/wildfly/wildfly-core/pull/4378#discussion_r542880323", "createdAt": "2020-12-14T22:34:54Z", "author": {"login": "jamezp"}, "path": "core-feature-pack/common/src/main/resources/content/bin/domain.bat", "diffHunk": "@@ -103,14 +103,38 @@ call \"!DIRNAME!common.bat\" :setDefaultModularJvmOptions \"!PROCESS_CONTROLLER_JAV\n set \"PROCESS_CONTROLLER_JAVA_OPTS=!PROCESS_CONTROLLER_JAVA_OPTS! !DEFAULT_MODULAR_JVM_OPTIONS!\"\n call \"!DIRNAME!common.bat\" :setDefaultModularJvmOptions \"!HOST_CONTROLLER_JAVA_OPTS!\"\n set \"HOST_CONTROLLER_JAVA_OPTS=!HOST_CONTROLLER_JAVA_OPTS! !DEFAULT_MODULAR_JVM_OPTIONS!\"\n-setlocal DisableDelayedExpansion\n \n-rem Add -server to the JVM options, if supported\n-\"%JAVA%\" -server -version 2>&1 | findstr /I hotspot > nul\n-if not errorlevel == 1 (\n-  set \"PROCESS_CONTROLLER_JAVA_OPTS=%PROCESS_CONTROLLER_JAVA_OPTS% -server\"\n-  set \"HOST_CONTROLLER_JAVA_OPTS=%HOST_CONTROLLER_JAVA_OPTS% -server\"\n+rem Add -server to the JVM options, if supported by JDK\n+echo \"%JAVA_OPTS%\" | findstr /I \\-server > nul\n+if errorlevel == 1 (\n+    set JVM_OPTVERSION=-version\n+    echo \"%JAVA_OPTS%\" | findstr /I \\-d64 > nul\n+    if not errorlevel == 1 (\n+        set \"JVM_OPTVERSION=-d64 !JVM_OPTVERSION!\"\n+        goto :CHECK_VERSION\n+    )\n+    echo \"%JAVA_OPTS%\" | findstr /I \\-d32 > nul\n+    if not errorlevel == 1 (\n+        set \"JVM_OPTVERSION=-d32 !JVM_OPTVERSION!\"\n+        goto :CHECK_VERSION\n+    )\n+    goto :CHECK_SUPPORTED\n+\n+    :CHECK_VERSION\n+    \"%JAVA%\" !JVM_OPTVERSION! 2>&1 | findstr /I /C:\"Unrecognized option\" > nul\n+    if not errorlevel == 1 (\n+        set JVM_OPTVERSION=-version\n+    )\n+\n+    rem Add -server to the JVM options, if supported\n+    :CHECK_SUPPORTED\n+    \"%JAVA%\" !JVM_OPTVERSION! 2>&1 | findstr /I \"hotspot openJDK\" > nul", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d6b804f4729f6c4d4384799493c713706af6342"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9344d60dda3d4c52a030b1758f12edc642086fe6", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/9344d60dda3d4c52a030b1758f12edc642086fe6", "committedDate": "2020-12-16T08:41:28Z", "message": "[WFCORE-3825] Unify -server option in windows scripts (ps1, bat) for domain mode (and its servers) on all JDKs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f608d95b4404a83a65cf4adf0f0fd87ba680bc5", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/6f608d95b4404a83a65cf4adf0f0fd87ba680bc5", "committedDate": "2020-12-16T08:27:52Z", "message": "[WFCORE-3825] IBM J9 option added"}, "afterCommit": {"oid": "9344d60dda3d4c52a030b1758f12edc642086fe6", "author": {"user": {"login": "lvydra", "name": null}}, "url": "https://github.com/wildfly/wildfly-core/commit/9344d60dda3d4c52a030b1758f12edc642086fe6", "committedDate": "2020-12-16T08:41:28Z", "message": "[WFCORE-3825] Unify -server option in windows scripts (ps1, bat) for domain mode (and its servers) on all JDKs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzODI0NDI4", "url": "https://github.com/wildfly/wildfly-core/pull/4378#pullrequestreview-553824428", "createdAt": "2020-12-16T15:50:30Z", "commit": {"oid": "9344d60dda3d4c52a030b1758f12edc642086fe6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3391, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}