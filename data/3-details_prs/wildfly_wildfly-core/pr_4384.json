{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NjkyMTgz", "number": 4384, "title": "[WFCORE-482] Add log4j2 support. Added the log4j-api and an implement\u2026", "bodyText": "\u2026ation that uses the jboss-logmanager as it's delegating log manager.\nhttps://issues.redhat.com/browse/WFCORE-482", "createdAt": "2020-11-04T23:16:22Z", "url": "https://github.com/wildfly/wildfly-core/pull/4384", "merged": true, "mergeCommit": {"oid": "b691ec270385fc611d4cad4ea2467bbab0a1f4d3"}, "closed": true, "closedAt": "2020-12-04T04:48:20Z", "author": {"login": "jamezp"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZpxtqgBqjM5NjQ1OTgyNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABditvscgFqTU0NDU5OTYwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f245056033aa24ca3fa4df41385df1e8d22dfd6a", "author": {"user": {"login": "jamezp", "name": "James R. Perkins"}}, "url": "https://github.com/wildfly/wildfly-core/commit/f245056033aa24ca3fa4df41385df1e8d22dfd6a", "committedDate": "2020-11-04T23:14:58Z", "message": "[WFCORE-482] Add log4j2 support. Added the log4j-api and an implementation that uses the jboss-logmanager as it's delegating log manager.\n\nhttps://issues.redhat.com/browse/WFCORE-482"}, "afterCommit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14", "author": {"user": {"login": "jamezp", "name": "James R. Perkins"}}, "url": "https://github.com/wildfly/wildfly-core/commit/a05728f1dc9807bf468c7eaa630ce0dd993cdd14", "committedDate": "2020-11-05T22:05:25Z", "message": "[WFCORE-482] Add log4j2 support. Added the log4j-api and an implementation that uses the jboss-logmanager as it's delegating log manager.\n\nhttps://issues.redhat.com/browse/WFCORE-482"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NDc5NDMy", "url": "https://github.com/wildfly/wildfly-core/pull/4384#pullrequestreview-528479432", "createdAt": "2020-11-11T19:40:14Z", "commit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxOTo0MDoxNFrOHxbnjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxOTo0MDoxNFrOHxbnjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU5NDc2Ng==", "bodyText": "@jamezp I was wondering why you put in the LOG4J2_IMPL org.jboss.logmanager.lo4j2 as dependency. In JCL it is \"This allows the org.jboss.logging.commons.logging module to be private while keeping this module public\"\nI think the Apache Commons Logging way, to provide the API but not the Impl is quite good. It prevents app developers to depend on that classes.", "url": "https://github.com/wildfly/wildfly-core/pull/4384#discussion_r521594766", "createdAt": "2020-11-11T19:40:14Z", "author": {"login": "boris-unckel"}, "path": "logging/src/main/java/org/jboss/as/logging/LoggingModuleDependency.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ *\n+ * Copyright 2020 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.logging;\n+\n+import org.jboss.as.controller.registry.RuntimePackageDependency;\n+\n+/**\n+ * Describes a module dependency.\n+ *\n+ * @author <a href=\"mailto:jperkins@redhat.com\">James R. Perkins</a>\n+ */\n+public enum LoggingModuleDependency {\n+    APACHE_COMMONS_LOGGING(\"org.apache.commons.logging\"),\n+    LOG4J(\"org.apache.log4j\"),\n+    LOG4J2(\"org.apache.logging.log4j.api\"),\n+    LOG4J2_IMPL(\"org.jboss.logmanager.log4j2\", true),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NDgwMDg3", "url": "https://github.com/wildfly/wildfly-core/pull/4384#pullrequestreview-528480087", "createdAt": "2020-11-11T19:41:15Z", "commit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxOTo0MToxNlrOHxbpsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxOTo0MToxNlrOHxbpsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU5NTMxNA==", "bodyText": "@jamezp Same for SLF4_IMPL - I would prefer to keep it private/unreachable.", "url": "https://github.com/wildfly/wildfly-core/pull/4384#discussion_r521595314", "createdAt": "2020-11-11T19:41:16Z", "author": {"login": "boris-unckel"}, "path": "logging/src/main/java/org/jboss/as/logging/LoggingModuleDependency.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ *\n+ * Copyright 2020 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.logging;\n+\n+import org.jboss.as.controller.registry.RuntimePackageDependency;\n+\n+/**\n+ * Describes a module dependency.\n+ *\n+ * @author <a href=\"mailto:jperkins@redhat.com\">James R. Perkins</a>\n+ */\n+public enum LoggingModuleDependency {\n+    APACHE_COMMONS_LOGGING(\"org.apache.commons.logging\"),\n+    LOG4J(\"org.apache.log4j\"),\n+    LOG4J2(\"org.apache.logging.log4j.api\"),\n+    LOG4J2_IMPL(\"org.jboss.logmanager.log4j2\", true),\n+    JBOSS_LOGGING(\"org.jboss.logging\"),\n+    JUL_TO_SLF4J(\"org.jboss.logging.jul-to-slf4j-stub\"),\n+    JBOSS_LOG_MANAGER(\"org.jboss.logmanager\"),\n+    SLF4J(\"org.slf4j\"),\n+    SLF4J_IMPL(\"org.slf4j.impl\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNzA4NTE0", "url": "https://github.com/wildfly/wildfly-core/pull/4384#pullrequestreview-542708514", "createdAt": "2020-12-02T10:43:20Z", "commit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDo0MzoyMFrOH9U8CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDo0MzoyMFrOH9U8CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA2ODIzMw==", "bodyText": "@jamezp, @boris-unckel  is it ok to use a \"Beta\" version for log4j2-jboss-logmanager?", "url": "https://github.com/wildfly/wildfly-core/pull/4384#discussion_r534068233", "createdAt": "2020-12-02T10:43:20Z", "author": {"login": "tommaso-borgato"}, "path": "pom.xml", "diffHunk": "@@ -190,6 +191,7 @@\n         <version.org.jboss.logging.jul-to-slf4j-stub>1.0.1.Final</version.org.jboss.logging.jul-to-slf4j-stub>\n         <version.org.jboss.logmanager.jboss-logmanager>2.1.17.Final</version.org.jboss.logmanager.jboss-logmanager>\n         <version.org.jboss.logmanager.log4j-jboss-logmanager>1.2.0.Final</version.org.jboss.logmanager.log4j-jboss-logmanager>\n+        <version.org.jboss.logmanager.log4j2-jboss-logmanager>1.0.0.Beta3</version.org.jboss.logmanager.log4j2-jboss-logmanager>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNzIyMjE3", "url": "https://github.com/wildfly/wildfly-core/pull/4384#pullrequestreview-542722217", "createdAt": "2020-12-02T11:00:09Z", "commit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMTowMDowOVrOH9VlIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMTowMDowOVrOH9VlIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA3ODc1Mg==", "bodyText": "@jamezp , @boris-unckel why are these permissions needed here? I don't see them in akin tests like Log4jLoggingProfilesTestCase .... is the customer required to grant these permissions to the deployment?", "url": "https://github.com/wildfly/wildfly-core/pull/4384#discussion_r534078752", "createdAt": "2020-12-02T11:00:09Z", "author": {"login": "tommaso-borgato"}, "path": "testsuite/standalone/src/test/java/org/jboss/as/test/integration/logging/profiles/Log4j2LoggingProfilesTestCase.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ *\n+ * Copyright 2020 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.test.integration.logging.profiles;\n+\n+import java.io.FilePermission;\n+import java.security.Permission;\n+import java.util.PropertyPermission;\n+\n+import org.jboss.as.test.integration.logging.Log4j2ServiceActivator;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.runner.RunWith;\n+import org.wildfly.core.testrunner.ServerSetup;\n+import org.wildfly.core.testrunner.WildflyTestRunner;\n+\n+/**\n+ * @author <a href=\"mailto:jperkins@redhat.com\">James R. Perkins</a>\n+ */\n+@RunWith(WildflyTestRunner.class)\n+@ServerSetup(AbstractLoggingProfilesTestCase.LoggingProfilesTestCaseSetup.class)\n+public class Log4j2LoggingProfilesTestCase extends AbstractLoggingProfilesTestCase {\n+\n+    public Log4j2LoggingProfilesTestCase() {\n+        super(Log4j2ServiceActivator.class, 2);\n+    }\n+\n+    @Override\n+    protected void processDeployment(final JavaArchive deployment) {\n+        final Permission[] permissions = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc4cbe6d0580252b4fd0ab000ba645d9bc61616d", "author": {"user": {"login": "jamezp", "name": "James R. Perkins"}}, "url": "https://github.com/wildfly/wildfly-core/commit/fc4cbe6d0580252b4fd0ab000ba645d9bc61616d", "committedDate": "2020-12-03T00:19:17Z", "message": "[WFCORE-482] Add log4j2 support. Added the log4j-api and an implementation that uses the jboss-logmanager as it's delegating log manager.\n\nhttps://issues.redhat.com/browse/WFCORE-482"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a05728f1dc9807bf468c7eaa630ce0dd993cdd14", "author": {"user": {"login": "jamezp", "name": "James R. Perkins"}}, "url": "https://github.com/wildfly/wildfly-core/commit/a05728f1dc9807bf468c7eaa630ce0dd993cdd14", "committedDate": "2020-11-05T22:05:25Z", "message": "[WFCORE-482] Add log4j2 support. Added the log4j-api and an implementation that uses the jboss-logmanager as it's delegating log manager.\n\nhttps://issues.redhat.com/browse/WFCORE-482"}, "afterCommit": {"oid": "fc4cbe6d0580252b4fd0ab000ba645d9bc61616d", "author": {"user": {"login": "jamezp", "name": "James R. Perkins"}}, "url": "https://github.com/wildfly/wildfly-core/commit/fc4cbe6d0580252b4fd0ab000ba645d9bc61616d", "committedDate": "2020-12-03T00:19:17Z", "message": "[WFCORE-482] Add log4j2 support. Added the log4j-api and an implementation that uses the jboss-logmanager as it's delegating log manager.\n\nhttps://issues.redhat.com/browse/WFCORE-482"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Mzc4OTg3", "url": "https://github.com/wildfly/wildfly-core/pull/4384#pullrequestreview-544378987", "createdAt": "2020-12-03T20:13:25Z", "commit": {"oid": "fc4cbe6d0580252b4fd0ab000ba645d9bc61616d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDoxMzoyNlrOH-vtIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDoxMzoyNlrOH-vtIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU1NTM2MQ==", "bodyText": "@jamezp As we discussed in chat please follow up later with a more detailed comment as it's not obvious why this is needed and why it's safe.\nPartly I may be confused because I'm not sure what in the first sentence the \"This is required\" in the second sentence refers to: \"Create the StdioContext\" or \"using a privileged action\".", "url": "https://github.com/wildfly/wildfly-core/pull/4384#discussion_r535555361", "createdAt": "2020-12-03T20:13:26Z", "author": {"login": "bstansberry"}, "path": "logging/src/main/java/org/jboss/as/logging/stdio/LogContextStdioContextSelector.java", "diffHunk": "@@ -50,16 +53,37 @@ public StdioContext getStdioContext() {\n         final Logger root = logContext.getLogger(CommonAttributes.ROOT_LOGGER_NAME);\n         StdioContext stdioContext = root.getAttachment(STDIO_CONTEXT_ATTACHMENT_KEY);\n         if (stdioContext == null) {\n-            stdioContext = StdioContext.create(\n-                    new NullInputStream(),\n-                    new LoggingOutputStream(logContext.getLogger(\"stdout\"), Level.INFO),\n-                    new LoggingOutputStream(logContext.getLogger(\"stderr\"), Level.ERROR)\n-            );\n-            final StdioContext appearing = root.attachIfAbsent(STDIO_CONTEXT_ATTACHMENT_KEY, stdioContext);\n+            // Create the StdioContext possibly using a privileged action. This is required for scenarios where a\n+            // deployment or library may attempt to write to System.out or System.err.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc4cbe6d0580252b4fd0ab000ba645d9bc61616d"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MzkyMzg3", "url": "https://github.com/wildfly/wildfly-core/pull/4384#pullrequestreview-544392387", "createdAt": "2020-12-03T20:26:40Z", "commit": {"oid": "fc4cbe6d0580252b4fd0ab000ba645d9bc61616d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDoyNjo0MFrOH-wmDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDoyNjo0MFrOH-wmDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU2OTkzMg==", "bodyText": "@jamezp When you work on WFLY-14160 you might want to experiment with something like\nnew FilePermission(\"${jboss.home.dir}/modules/*\", \"read\"),\n\nExpression resolution in a permissions.xml should work, and if it does that's a much better thing to document than suggesting giving ALL FILES.", "url": "https://github.com/wildfly/wildfly-core/pull/4384#discussion_r535569932", "createdAt": "2020-12-03T20:26:40Z", "author": {"login": "bstansberry"}, "path": "testsuite/standalone/src/test/java/org/jboss/as/test/integration/logging/profiles/Log4j2LoggingProfilesTestCase.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ *\n+ * Copyright 2020 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.test.integration.logging.profiles;\n+\n+import java.io.FilePermission;\n+import java.security.Permission;\n+import java.util.PropertyPermission;\n+\n+import org.jboss.as.test.integration.logging.Log4j2ServiceActivator;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.runner.RunWith;\n+import org.wildfly.core.testrunner.ServerSetup;\n+import org.wildfly.core.testrunner.WildflyTestRunner;\n+\n+/**\n+ * @author <a href=\"mailto:jperkins@redhat.com\">James R. Perkins</a>\n+ */\n+@RunWith(WildflyTestRunner.class)\n+@ServerSetup(AbstractLoggingProfilesTestCase.LoggingProfilesTestCaseSetup.class)\n+public class Log4j2LoggingProfilesTestCase extends AbstractLoggingProfilesTestCase {\n+\n+    public Log4j2LoggingProfilesTestCase() {\n+        super(Log4j2ServiceActivator.class, 2);\n+    }\n+\n+    @Override\n+    protected void processDeployment(final JavaArchive deployment) {\n+        final Permission[] permissions = {\n+                // The getClassLoader permissions is required for the org.apache.logging.log4j.util.ProviderUtil.\n+                new RuntimePermission(\"getClassLoader\"),\n+                // The FilePermissions is also for the org.apache.logging.log4j.util.ProviderUtil as it needs to read the JAR\n+                // for the service loader.\n+                new FilePermission(\"<<ALL FILES>>\", \"read\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc4cbe6d0580252b4fd0ab000ba645d9bc61616d"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTk5NjAw", "url": "https://github.com/wildfly/wildfly-core/pull/4384#pullrequestreview-544599600", "createdAt": "2020-12-04T01:48:29Z", "commit": {"oid": "fc4cbe6d0580252b4fd0ab000ba645d9bc61616d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3311, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}