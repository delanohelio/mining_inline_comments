{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NDg3MDQz", "number": 484, "title": "Telemetry v1 compatible aggregation type", "bodyText": "Issue #, if available:\nAs of now, cloud side validation on Telemetry accepts only Sum aggregation of metrics. SystemMetrics in v1 also have Sum type aggregation. So, changing it to be compatible with v1 metrics for now. But, this is not applicable to some of the metrics in Telemetry v2(TODO)\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-29T01:31:32Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484", "merged": true, "mergeCommit": {"oid": "a28404128662ca6709339ecd06a9ec2a7c28b710"}, "closed": true, "closedAt": "2020-09-30T07:07:33Z", "author": {"login": "saranyailla"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNd224gH2gAyNDk0NDg3MDQzOjkyYTM5MTMzNWZkMzAzODkwM2UwMzgxNjg5YjhjMzEwZWNmZjIyYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN1547gFqTQ5OTA5Mjg2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "92a391335fd3038903e0381689b8c310ecff22c9", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/92a391335fd3038903e0381689b8c310ecff22c9", "committedDate": "2020-09-29T01:25:25Z", "message": "Telemetry v1 compatible aggregation type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1561df616320c40f22a215cbab57bda613cc0c4a", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1561df616320c40f22a215cbab57bda613cc0c4a", "committedDate": "2020-09-29T01:39:09Z", "message": "Telemetry v1 compatible aggregation type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82d3a85dc226b7a1bc873b41bb8525f147fb03fe", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/82d3a85dc226b7a1bc873b41bb8525f147fb03fe", "committedDate": "2020-09-29T01:39:54Z", "message": "Merge branch 'telemetry-fix' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDA2NDE4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#pullrequestreview-498006418", "createdAt": "2020-09-29T01:45:31Z", "commit": {"oid": "82d3a85dc226b7a1bc873b41bb8525f147fb03fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMTo0NTozMlrOHZVaHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMTo0NTozMlrOHZVaHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNzE5Nw==", "bodyText": "If these aggregations don't actually make sense, then we should just disable this", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#discussion_r496327197", "createdAt": "2020-09-29T01:45:32Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelMetricsEmitter.java", "diffHunk": "@@ -48,71 +48,71 @@ public void emitMetrics() {\n                 .namespace(NAMESPACE)\n                 .name(\"NumberOfComponentsStarting\")\n                 .unit(TelemetryUnit.Count)\n-                .aggregation(TelemetryAggregation.Average)\n+                .aggregation(TelemetryAggregation.Sum)\n                 .build();\n         mf.putMetricData(metric, stateCount.getOrDefault(State.STARTING, 0));\n \n         metric = Metric.builder()\n                 .namespace(NAMESPACE)\n                 .name(\"NumberOfComponentsInstalled\")\n                 .unit(TelemetryUnit.Count)\n-                .aggregation(TelemetryAggregation.Average)\n+                .aggregation(TelemetryAggregation.Sum)\n                 .build();\n         mf.putMetricData(metric, stateCount.getOrDefault(State.INSTALLED, 0));\n \n         metric = Metric.builder()\n                 .namespace(NAMESPACE)\n                 .name(\"NumberOfComponentsStateless\")\n                 .unit(TelemetryUnit.Count)\n-                .aggregation(TelemetryAggregation.Average)\n+                .aggregation(TelemetryAggregation.Sum)\n                 .build();\n         mf.putMetricData(metric, stateCount.getOrDefault(State.STATELESS, 0));\n \n         metric = Metric.builder()\n                 .namespace(NAMESPACE)\n                 .name(\"NumberOfComponentsStopping\")\n                 .unit(TelemetryUnit.Count)\n-                .aggregation(TelemetryAggregation.Average)\n+                .aggregation(TelemetryAggregation.Sum)\n                 .build();\n         mf.putMetricData(metric, stateCount.getOrDefault(State.STOPPING, 0));\n \n         metric = Metric.builder()\n                 .namespace(NAMESPACE)\n                 .name(\"NumberOfComponentsBroken\")\n                 .unit(TelemetryUnit.Count)\n-                .aggregation(TelemetryAggregation.Average)\n+                .aggregation(TelemetryAggregation.Sum)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82d3a85dc226b7a1bc873b41bb8525f147fb03fe"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDA2NTUz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#pullrequestreview-498006553", "createdAt": "2020-09-29T01:45:57Z", "commit": {"oid": "82d3a85dc226b7a1bc873b41bb8525f147fb03fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMTo0NTo1OFrOHZValg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMTo0NTo1OFrOHZValg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNzMxOA==", "bodyText": "sums definitely don't make sense here.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#discussion_r496327318", "createdAt": "2020-09-29T01:45:58Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/telemetry/SystemMetricsEmitter.java", "diffHunk": "@@ -40,15 +40,15 @@ public void emitMetrics() {\n                 .namespace(NAMESPACE)\n                 .name(\"TotalNumberOfFDs\")\n                 .unit(TelemetryUnit.Count)\n-                .aggregation(TelemetryAggregation.Average)\n+                .aggregation(TelemetryAggregation.Sum)\n                 .build();\n         mf.putMetricData(metric, systemInfo.getOperatingSystem().getFileSystem().getOpenFileDescriptors());\n \n         metric = Metric.builder()\n                 .namespace(NAMESPACE)\n                 .name(\"SystemMemUsage\")\n                 .unit(TelemetryUnit.Megabytes)\n-                .aggregation(TelemetryAggregation.Average)\n+                .aggregation(TelemetryAggregation.Sum)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82d3a85dc226b7a1bc873b41bb8525f147fb03fe"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13c9e1ae445d62a4a617a5ed2d43f52fab183e6f", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/13c9e1ae445d62a4a617a5ed2d43f52fab183e6f", "committedDate": "2020-09-29T17:51:15Z", "message": "change aggregation type to sum in final result + update tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9fd3dd2eebbe624c64459b537de4b0c39fe0fb6", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d9fd3dd2eebbe624c64459b537de4b0c39fe0fb6", "committedDate": "2020-09-29T17:55:29Z", "message": "Merge branch 'telemetry-fix' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a065d324d78b1fe7e5f5e736992a2749b10fa244", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a065d324d78b1fe7e5f5e736992a2749b10fa244", "committedDate": "2020-09-29T17:51:50Z", "message": "Merge branch 'telemetry-fix' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}, "afterCommit": {"oid": "d9fd3dd2eebbe624c64459b537de4b0c39fe0fb6", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d9fd3dd2eebbe624c64459b537de4b0c39fe0fb6", "committedDate": "2020-09-29T17:55:29Z", "message": "Merge branch 'telemetry-fix' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06cf12a8139fc862b7a3b8c5154218f8d1019e1e", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/06cf12a8139fc862b7a3b8c5154218f8d1019e1e", "committedDate": "2020-09-29T17:59:31Z", "message": "Change aggregation type to sum only in the final result + update tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "273b30e4b3ba1aa5e5ab950f581f1578067261ad", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/273b30e4b3ba1aa5e5ab950f581f1578067261ad", "committedDate": "2020-09-29T18:09:28Z", "message": "Merge branch 'telemetry-fix' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NzY0MzA0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#pullrequestreview-498764304", "createdAt": "2020-09-29T18:26:28Z", "commit": {"oid": "273b30e4b3ba1aa5e5ab950f581f1578067261ad"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NzY5MTIy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#pullrequestreview-498769122", "createdAt": "2020-09-29T18:33:07Z", "commit": {"oid": "273b30e4b3ba1aa5e5ab950f581f1578067261ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODozMzowN1rOHZ7pQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODozMzowN1rOHZ7pQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk1MzY2NQ==", "bodyText": "We still need this check right?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#discussion_r496953665", "createdAt": "2020-09-29T18:33:07Z", "author": {"login": "nikkhilmuthye"}, "path": "src/main/java/com/aws/greengrass/telemetry/TelemetryAgent.java", "diffHunk": "@@ -188,10 +188,7 @@ void publishPeriodicMetrics() {\n         Map<Long, List<AggregatedNamespaceData>> metricsToPublishMap =\n                 metricsAggregator.getMetricsToPublish(lastPublish, timestamp);\n         getPeriodicPublishTimeTopic().withValue(timestamp);\n-        // Publish only if the collected metrics are not empty.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273b30e4b3ba1aa5e5ab950f581f1578067261ad"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19bd72b91ef220389031299c1328f248914d7dd8", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/19bd72b91ef220389031299c1328f248914d7dd8", "committedDate": "2020-09-30T04:28:21Z", "message": "Merge branch 'telemetry-fix' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d4d5d25c6fd097d2c39096772f8b2c311caacea", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1d4d5d25c6fd097d2c39096772f8b2c311caacea", "committedDate": "2020-09-30T04:28:36Z", "message": "Merge branch 'master' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7c9433bd5d02a2c7765f40d33ca521b26fb71c4", "author": {"user": {"login": "saranyailla", "name": "Saranya"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a7c9433bd5d02a2c7765f40d33ca521b26fb71c4", "committedDate": "2020-09-30T04:28:52Z", "message": "Merge branch 'telemetry-fix' of github.com:/aws/aws-greengrass-kernel into telemetry-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDkyMDg5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#pullrequestreview-499092089", "createdAt": "2020-09-30T05:24:03Z", "commit": {"oid": "a7c9433bd5d02a2c7765f40d33ca521b26fb71c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDkyODYx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/484#pullrequestreview-499092861", "createdAt": "2020-09-30T05:26:27Z", "commit": {"oid": "a7c9433bd5d02a2c7765f40d33ca521b26fb71c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3045, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}