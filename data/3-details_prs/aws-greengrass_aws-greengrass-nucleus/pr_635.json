{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MDExMTQx", "number": 635, "title": "add configurable time out", "bodyText": "Issue #, if available:\nUse configurable timeout from deployment document, details https://sim.amazon.com/issues/P41179329\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-06T22:34:08Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635", "merged": true, "mergeCommit": {"oid": "ab11e122aa1954a911c4c287c1aee85c5c2e65ac"}, "closed": true, "closedAt": "2020-11-11T06:16:38Z", "author": {"login": "awszztt"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ-wfKgH2gAyNTE3MDExMTQxOmFhYTJiYmQ4YzZlNjZkYjM1ZWFiMWQwYzMyZTY3OTdlNDk3N2IzZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbXk9zgH2gAyNTE3MDExMTQxOmE3MWVjYzFjYzg2Mzk5NDY0N2YxMGMwZTI1MzkyZDlmNzIwODIwZmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aaa2bbd8c6e66db35eab1d0c32e6797e4977b3e6", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aaa2bbd8c6e66db35eab1d0c32e6797e4977b3e6", "committedDate": "2020-11-06T22:32:25Z", "message": "add configurable time out"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTQyMDY3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-525542067", "createdAt": "2020-11-06T22:50:05Z", "commit": {"oid": "aaa2bbd8c6e66db35eab1d0c32e6797e4977b3e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo1MDowNlrOHu_6tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMjo1MDowNlrOHu_6tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA0Mzc2NA==", "bodyText": "This is not the right timeout, it's set as configurationValidationPolicy  in deployment document - https://code.amazon.com/packages/EvergreenComponentCommon/blobs/86f6c302e2c5bc4b06fe1cf5e44298876ace8e5f/--/src/test/resources/configurations/configuration-1-component-replace.json#L36 . Needs to be extracted into a new field similar to the componentUpdatePolicy here https://github.com/aws/aws-greengrass-nucleus/blob/master/src/main/java/com/aws/greengrass/deployment/model/DeploymentDocument.java#L57 but it's not the same as componentUpdatePolicy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#discussion_r519043764", "createdAt": "2020-11-06T22:50:06Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/greengrass/deployment/DynamicComponentConfigurationValidator.java", "diffHunk": "@@ -160,8 +159,11 @@ private boolean willNodeChange(Object proposedConfig, Node currentConfig, long p\n                         .deepEquals(proposedConfig, currentConfig.toPOJO());\n     }\n \n-    private boolean validateOverIpc(String deploymentId, Set<ComponentToValidate> componentsToValidate,\n+    private boolean validateOverIpc(Deployment deployment, Set<ComponentToValidate> componentsToValidate,\n                                     CompletableFuture<DeploymentResult> deploymentResultFuture) {\n+        String deploymentId = deployment.getId();\n+        Integer timeOutSec = deployment.getDeploymentDocumentObj().getComponentUpdatePolicy().getTimeout();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaa2bbd8c6e66db35eab1d0c32e6797e4977b3e6"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "434b0b6b507dd42cc2a9ae04881d719b3f5001ec", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/434b0b6b507dd42cc2a9ae04881d719b3f5001ec", "committedDate": "2020-11-07T01:02:55Z", "message": "add configurationValidationPolicy to the DeploymentDocumentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NTc1OTk2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-525575996", "createdAt": "2020-11-07T01:11:27Z", "commit": {"oid": "434b0b6b507dd42cc2a9ae04881d719b3f5001ec"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baac7f2bb2e080b0ccb5f354c8b8eaa79a0865a4", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/baac7f2bb2e080b0ccb5f354c8b8eaa79a0865a4", "committedDate": "2020-11-07T01:11:37Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f49134b98f856810db107825ee49f8caea13269", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7f49134b98f856810db107825ee49f8caea13269", "committedDate": "2020-11-09T18:36:55Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "973102e335da37dc03224957585cc170fc0572be", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/973102e335da37dc03224957585cc170fc0572be", "committedDate": "2020-11-09T21:13:46Z", "message": "fix the failure in the integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e2154d7d898130b8271df27d35d79c24eca674b", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8e2154d7d898130b8271df27d35d79c24eca674b", "committedDate": "2020-11-09T21:13:57Z", "message": "Merge branch 'configurable-depoloyment-document' of ssh://github.com/aws/aws-greengrass-kernel into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87115bc756bb94860c0abdfaeeb6c537a58b975d", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/87115bc756bb94860c0abdfaeeb6c537a58b975d", "committedDate": "2020-11-09T21:15:03Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2017b6e1ed190e3afedb3bdf134351f11a7dc2e7", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2017b6e1ed190e3afedb3bdf134351f11a7dc2e7", "committedDate": "2020-11-09T21:47:03Z", "message": "fix the benchMark"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c279e585004b7cea25ce9d6babc81aff3c924e10", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c279e585004b7cea25ce9d6babc81aff3c924e10", "committedDate": "2020-11-09T21:47:25Z", "message": "Merge branch 'configurable-depoloyment-document' of ssh://github.com/aws/aws-greengrass-kernel into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f0513d0de73d0b529aea90071e0fb248adbc781", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9f0513d0de73d0b529aea90071e0fb248adbc781", "committedDate": "2020-11-09T22:20:40Z", "message": "add import for com.amazonaws.services.evergreen.model.ConfigurationValidationPolicy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "593421ed3e4353a9ecd0d8867b116f2bfed763f3", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/593421ed3e4353a9ecd0d8867b116f2bfed763f3", "committedDate": "2020-11-09T23:48:55Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NzUxMzE2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-526751316", "createdAt": "2020-11-10T00:02:49Z", "commit": {"oid": "593421ed3e4353a9ecd0d8867b116f2bfed763f3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f251c4035736a82ebaa1272ab3172d6932b7cd71", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f251c4035736a82ebaa1272ab3172d6932b7cd71", "committedDate": "2020-11-10T00:09:31Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2427cece998d09d5e4be3e49792b3979f3af94c0", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2427cece998d09d5e4be3e49792b3979f3af94c0", "committedDate": "2020-11-10T00:18:32Z", "message": "resolve the conflict with master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2ODEzMDYy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-526813062", "createdAt": "2020-11-10T02:48:45Z", "commit": {"oid": "2427cece998d09d5e4be3e49792b3979f3af94c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjo0ODo0NVrOHwJp-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjo0ODo0NVrOHwJp-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI1MTg5Nw==", "bodyText": "protect against nulls here", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#discussion_r520251897", "createdAt": "2020-11-10T02:48:45Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DynamicComponentConfigurationValidator.java", "diffHunk": "@@ -156,8 +155,11 @@ private boolean willNodeChange(Object proposedConfig, Node currentConfig, long p\n                         .deepEquals(proposedConfig, currentConfig.toPOJO());\n     }\n \n-    private boolean validateOverIpc(String deploymentId, Set<ComponentToValidate> componentsToValidate,\n+    private boolean validateOverIpc(Deployment deployment, Set<ComponentToValidate> componentsToValidate,\n                                     CompletableFuture<DeploymentResult> deploymentResultFuture) {\n+        String deploymentId = deployment.getId();\n+        Integer timeoutSec = deployment.getDeploymentDocumentObj().getConfigurationValidationPolicy().getTimeout();\n+        Long timeoutMs = Duration.ofSeconds(timeoutSec).toMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2427cece998d09d5e4be3e49792b3979f3af94c0"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daaa9ab994f8d05d6444c049cd773e9ae51d54d2", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/daaa9ab994f8d05d6444c049cd773e9ae51d54d2", "committedDate": "2020-11-10T02:49:12Z", "message": "check whether getConfigurationValidationPolicy.getTimeout is null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68fe3c4762b1f592070798dc1e6a859bd639cab0", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/68fe3c4762b1f592070798dc1e6a859bd639cab0", "committedDate": "2020-11-10T03:13:25Z", "message": "rollback the change on the deploymentDocument json file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21347f0157e5312077c5f344fbc59d3ea02525b3", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/21347f0157e5312077c5f344fbc59d3ea02525b3", "committedDate": "2020-11-10T03:29:04Z", "message": "resolve the conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "675cfe8998c8246844e40519ec9903a65d6780c8", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/675cfe8998c8246844e40519ec9903a65d6780c8", "committedDate": "2020-11-10T05:30:31Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca4cd993a94e49d40eed7cdec0142a94f072a90f", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ca4cd993a94e49d40eed7cdec0142a94f072a90f", "committedDate": "2020-11-10T20:12:40Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cc943892c2dad61c5d1afc3cd5c5d2ac0bf8635", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9cc943892c2dad61c5d1afc3cd5c5d2ac0bf8635", "committedDate": "2020-11-10T20:20:51Z", "message": "resovle conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f489a54c81ae0db348d0cfb0109f752359d363a5", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f489a54c81ae0db348d0cfb0109f752359d363a5", "committedDate": "2020-11-11T01:04:48Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NzkyNzQ3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-527792747", "createdAt": "2020-11-11T02:07:57Z", "commit": {"oid": "f489a54c81ae0db348d0cfb0109f752359d363a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMjowNzo1N1rOHw4qkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMjowNzo1N1rOHw4qkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTAyMjA5Ng==", "bodyText": "Nit - could reuse the constant from DynamicComponentConfigurationValidator.java", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#discussion_r521022096", "createdAt": "2020-11-11T02:07:57Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/greengrass/deployment/converter/DeploymentDocumentConverter.java", "diffHunk": "@@ -44,6 +45,7 @@\n \n     public static final String LOCAL_DEPLOYMENT_GROUP_NAME = \"LOCAL_DEPLOYMENT\";\n     public static final Integer NO_OP_TIMEOUT = 0;\n+    private static final  Integer DEFAULT_TIMEOUT_SECOND = 20;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f489a54c81ae0db348d0cfb0109f752359d363a5"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NzkzMTQ0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-527793144", "createdAt": "2020-11-11T02:09:01Z", "commit": {"oid": "f489a54c81ae0db348d0cfb0109f752359d363a5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3897acc54b1276abdda0d3b2eaaf3e3665ea3362", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3897acc54b1276abdda0d3b2eaaf3e3665ea3362", "committedDate": "2020-11-11T02:33:28Z", "message": "reuse parameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3ODAzOTcy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-527803972", "createdAt": "2020-11-11T02:35:04Z", "commit": {"oid": "3897acc54b1276abdda0d3b2eaaf3e3665ea3362"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c91b68d2dbbc31769d5a1603f42d527df810e312", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c91b68d2dbbc31769d5a1603f42d527df810e312", "committedDate": "2020-11-11T02:36:15Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3ODMzOTc4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/635#pullrequestreview-527833978", "createdAt": "2020-11-11T03:20:33Z", "commit": {"oid": "c91b68d2dbbc31769d5a1603f42d527df810e312"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a71ecc1cc863994647f10c0e25392d9f720820fc", "author": {"user": {"login": "awszztt", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a71ecc1cc863994647f10c0e25392d9f720820fc", "committedDate": "2020-11-11T06:01:23Z", "message": "Merge branch 'master' into configurable-depoloyment-document"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2958, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}