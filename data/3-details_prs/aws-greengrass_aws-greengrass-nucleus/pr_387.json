{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczNDk4NDI1", "number": 387, "title": "Fixing S3 for cross-region calls", "bodyText": "Issue #, if available:\nDescription of changes:\nFixes S3 to work across regions.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-08-25T21:35:00Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387", "merged": true, "mergeCommit": {"oid": "ab91aec76d56c139b1510304c328c3b161d3fc41"}, "closed": true, "closedAt": "2020-08-26T17:03:27Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCeOO_gFqTQ3NDkzMTM2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCu4C6AFqTQ3NTY4NjQxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0OTMxMzY2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#pullrequestreview-474931366", "createdAt": "2020-08-25T21:37:46Z", "commit": {"oid": "8760dfb82c08ee7b03617954f80273d5c921d818"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMTozNzo0NlrOHGrJEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMTozNzo0NlrOHGrJEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2MDMzNg==", "bodyText": "Why remove the tes credential hook?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#discussion_r476760336", "createdAt": "2020-08-25T21:37:46Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/plugins/S3Downloader.java", "diffHunk": "@@ -103,10 +101,7 @@ public File downloadToPath(PackageIdentifier packageIdentifier, ComponentArtifac\n     private byte[] getObject(String bucket, String key, ComponentArtifact artifact, PackageIdentifier packageIdentifier)\n             throws PackageDownloadException {\n         try {\n-            TokenExchangeService tokenExchangeService = kernel.getContext().get(TokenExchangeService.class);\n-            GetObjectRequest getObjectRequest = GetObjectRequest.builder().overrideConfiguration(\n-                    AwsRequestOverrideConfiguration.builder().credentialsProvider(tokenExchangeService).build())\n-                    .bucket(bucket).key(key).build();\n+            GetObjectRequest getObjectRequest = GetObjectRequest.builder().bucket(bucket).key(key).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8760dfb82c08ee7b03617954f80273d5c921d818"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0OTMyNTc2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#pullrequestreview-474932576", "createdAt": "2020-08-25T21:39:57Z", "commit": {"oid": "8760dfb82c08ee7b03617954f80273d5c921d818"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMTozOTo1N1rOHGrQYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMTozOTo1N1rOHGrQYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2MjIwOA==", "bodyText": "This is supposed to be temporary, GG will eventually be available in other regions, add a TODO for that? Or leave it the way it was and not test in other regions until GG becomes available so that we don't have to come back and change this again later", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#discussion_r476762208", "createdAt": "2020-08-25T21:39:57Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/GreengrassPackageServiceClientFactory.java", "diffHunk": "@@ -40,7 +39,8 @@ public GreengrassPackageServiceClientFactory(\n             LazyCredentialProvider credentialsProvider) {\n         AWSEvergreenClientBuilder clientBuilder =\n                 AWSEvergreenClientBuilder.standard();\n-        String region = Coerce.toString(deviceConfiguration.getAWSRegion());\n+        // GG only exists in east\n+        String region = \"us-east-1\"; // Coerce.toString(deviceConfiguration.getAWSRegion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8760dfb82c08ee7b03617954f80273d5c921d818"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8760dfb82c08ee7b03617954f80273d5c921d818", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8760dfb82c08ee7b03617954f80273d5c921d818", "committedDate": "2020-08-25T21:34:46Z", "message": "Hardcode GG region to us-east-1 since it only exists there"}, "afterCommit": {"oid": "baebd485543a43036d4e9b29646141639fb25a2c", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/baebd485543a43036d4e9b29646141639fb25a2c", "committedDate": "2020-08-25T23:25:50Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "baebd485543a43036d4e9b29646141639fb25a2c", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/baebd485543a43036d4e9b29646141639fb25a2c", "committedDate": "2020-08-25T23:25:50Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}, "afterCommit": {"oid": "301387bf33fd57b00edb0e299303cd7192c61e46", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/301387bf33fd57b00edb0e299303cd7192c61e46", "committedDate": "2020-08-25T23:27:02Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "301387bf33fd57b00edb0e299303cd7192c61e46", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/301387bf33fd57b00edb0e299303cd7192c61e46", "committedDate": "2020-08-25T23:27:02Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}, "afterCommit": {"oid": "62aff50b8407d0c1d3353e035fc233a30ba7036d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/62aff50b8407d0c1d3353e035fc233a30ba7036d", "committedDate": "2020-08-25T23:27:46Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MDU0Njkz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#pullrequestreview-475054693", "createdAt": "2020-08-25T23:35:27Z", "commit": {"oid": "62aff50b8407d0c1d3353e035fc233a30ba7036d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62aff50b8407d0c1d3353e035fc233a30ba7036d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/62aff50b8407d0c1d3353e035fc233a30ba7036d", "committedDate": "2020-08-25T23:27:46Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}, "afterCommit": {"oid": "9be6a656146607c341f8e9591afede169fe1240b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9be6a656146607c341f8e9591afede169fe1240b", "committedDate": "2020-08-25T23:37:06Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9be6a656146607c341f8e9591afede169fe1240b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9be6a656146607c341f8e9591afede169fe1240b", "committedDate": "2020-08-25T23:37:06Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}, "afterCommit": {"oid": "533e649d3509d1c252ce0afd92d1f07a57739cd5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/533e649d3509d1c252ce0afd92d1f07a57739cd5", "committedDate": "2020-08-26T00:06:25Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "533e649d3509d1c252ce0afd92d1f07a57739cd5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/533e649d3509d1c252ce0afd92d1f07a57739cd5", "committedDate": "2020-08-26T00:06:25Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}, "afterCommit": {"oid": "8c63f63525af9d8fe778673e1c289c0b3d10c410", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8c63f63525af9d8fe778673e1c289c0b3d10c410", "committedDate": "2020-08-26T00:13:43Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c63f63525af9d8fe778673e1c289c0b3d10c410", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8c63f63525af9d8fe778673e1c289c0b3d10c410", "committedDate": "2020-08-26T00:13:43Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}, "afterCommit": {"oid": "3a46ec2cf954ecbad553450677c2fd0e726f3f91", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3a46ec2cf954ecbad553450677c2fd0e726f3f91", "committedDate": "2020-08-26T00:18:30Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d206412f12a28acc3a8206307023af0d58aa5be", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5d206412f12a28acc3a8206307023af0d58aa5be", "committedDate": "2020-08-26T00:32:01Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a46ec2cf954ecbad553450677c2fd0e726f3f91", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3a46ec2cf954ecbad553450677c2fd0e726f3f91", "committedDate": "2020-08-26T00:18:30Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}, "afterCommit": {"oid": "5d206412f12a28acc3a8206307023af0d58aa5be", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5d206412f12a28acc3a8206307023af0d58aa5be", "committedDate": "2020-08-26T00:32:01Z", "message": "Fix S3 for cross-region calls by looking up the bucket first"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MTA0NzQ2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#pullrequestreview-475104746", "createdAt": "2020-08-26T02:18:50Z", "commit": {"oid": "5d206412f12a28acc3a8206307023af0d58aa5be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDk2MjE3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#pullrequestreview-475496217", "createdAt": "2020-08-26T13:37:39Z", "commit": {"oid": "5d206412f12a28acc3a8206307023af0d58aa5be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzozNzozOVrOHHMeLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMzozNzozOVrOHHMeLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMwNjQxMw==", "bodyText": "Which resource is it complaining as not being closed? The getObjectsAsBytes? Can we try-resources that block?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#discussion_r477306413", "createdAt": "2020-08-26T13:37:39Z", "author": {"login": "philcali"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/plugins/S3Downloader.java", "diffHunk": "@@ -100,14 +98,18 @@ public File downloadToPath(PackageIdentifier packageIdentifier, ComponentArtifac\n         }\n     }\n \n+    @SuppressWarnings(\"PMD.CloseResource\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d206412f12a28acc3a8206307023af0d58aa5be"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Njg2NDE0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/387#pullrequestreview-475686414", "createdAt": "2020-08-26T17:01:56Z", "commit": {"oid": "5d206412f12a28acc3a8206307023af0d58aa5be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3200, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}