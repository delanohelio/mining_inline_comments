{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MjI3MzA1", "number": 625, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjo1NTowN1rOE3cgEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjo1NTowN1rOE3cgEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NTc0MDk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/ConfigurationWriter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjo1NTowN1rOHwy1AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzoxNToyOVrOHwzUyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkyNjQ2NA==", "bodyText": "use compareAndSet(false, true) I'm pretty sure that's the right order. It should be the expected value, and then the value to set if it is the expected value.\nOtherwise it still isn't threadsafe the way you've written it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625#discussion_r520926464", "createdAt": "2020-11-10T22:55:07Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/ConfigurationWriter.java", "diffHunk": "@@ -170,9 +171,11 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n             flush(out);\n         }\n         long currCount = count.incrementAndGet();\n-        if (autoTruncate && currCount > maxCount && currCount > retryCount) {\n+        if (autoTruncate && currCount > maxCount && currCount > retryCount && !truncateQueued.get()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83030e0e84f8c6c42533090149fcb8277a1720dd"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDYwMA==", "bodyText": "Thanks! Yeah it's compareAndSet(expect, update)", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625#discussion_r520934600", "createdAt": "2020-11-10T23:15:29Z", "author": {"login": "tilo-chen"}, "path": "src/main/java/com/aws/greengrass/config/ConfigurationWriter.java", "diffHunk": "@@ -170,9 +171,11 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n             flush(out);\n         }\n         long currCount = count.incrementAndGet();\n-        if (autoTruncate && currCount > maxCount && currCount > retryCount) {\n+        if (autoTruncate && currCount > maxCount && currCount > retryCount && !truncateQueued.get()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkyNjQ2NA=="}, "originalCommit": {"oid": "83030e0e84f8c6c42533090149fcb8277a1720dd"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 482, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}