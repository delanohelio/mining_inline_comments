{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMTI4MDM3", "number": 131, "title": "Switch lifecycle thread to ThreadPool", "bodyText": "Issue #, if available:\nDescription of changes:\nSwitches lifecycle thread to use the threadpool. Also changes Exec to pass the InterruptedException all the way up to the caller so that it can be properly cancelled. This should fix the issue of reporting \"RUNNING\" after the thread was interrupted.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-03-24T17:04:58Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131", "merged": true, "mergeCommit": {"oid": "ad5a6cffc5da694377ec9dade3a8ca82117ce8d9"}, "closed": true, "closedAt": "2020-03-25T14:55:19Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ65yYgFqTM4MDc0OTQ4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRA9IbAFqTM4MDg3MjE2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzQ5NDgz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380749483", "createdAt": "2020-03-24T22:45:09Z", "commit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjo0NTowOVrOF7F4hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjo0NTowOVrOF7F4hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUwNjY5NQ==", "bodyText": "NIT: if not too much change, can you update the function name to outputString() ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397506695", "createdAt": "2020-03-24T22:45:09Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -344,15 +348,16 @@ private void exec() {\n      * Get the stdout and stderr output as a string.\n      *\n      * @return String of output.\n+     * @throws InterruptedException if thread is interrupted while executing\n      */\n-    public String asString() {\n+    public String asString() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzUwMjU4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380750258", "createdAt": "2020-03-24T22:47:00Z", "commit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjo0NzowMFrOF7F7Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjo0NzowMFrOF7F7Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUwNzM5MQ==", "bodyText": "Why InterruptedException can be throw here?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397507391", "createdAt": "2020-03-24T22:47:00Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/config/PlatformResolver.java", "diffHunk": "@@ -46,27 +46,31 @@\n         if (Files.exists(Paths.get(\"/usr/bin/yum\"))) {\n             ranks.put(\"fedora\", 11);\n         }\n-        String sysver = Exec.sh(\"uname -a\").toLowerCase();\n-        if (sysver.contains(\"ubuntu\")) {\n-            ranks.put(\"ubuntu\", 20);\n-        }\n-        if (sysver.contains(\"darwin\")) {\n-            ranks.put(\"macos\", 20);\n-        }\n-        if (sysver.contains(\"raspbian\")) {\n-            ranks.put(\"raspbian\", 22);\n-        }\n-        if (sysver.contains(\"qnx\")) {\n-            ranks.put(\"qnx\", 22);\n-        }\n-        if (sysver.contains(\"cygwin\")) {\n-            ranks.put(\"cygwin\", 22);\n-        }\n-        if (sysver.contains(\"freebsd\")) {\n-            ranks.put(\"freebsd\", 22);\n-        }\n-        if (sysver.contains(\"solaris\") || sysver.contains(\"sunos\")) {\n-            ranks.put(\"solaris\", 22);\n+        try {\n+            String sysver = Exec.sh(\"uname -a\").toLowerCase();\n+            if (sysver.contains(\"ubuntu\")) {\n+                ranks.put(\"ubuntu\", 20);\n+            }\n+            if (sysver.contains(\"darwin\")) {\n+                ranks.put(\"macos\", 20);\n+            }\n+            if (sysver.contains(\"raspbian\")) {\n+                ranks.put(\"raspbian\", 22);\n+            }\n+            if (sysver.contains(\"qnx\")) {\n+                ranks.put(\"qnx\", 22);\n+            }\n+            if (sysver.contains(\"cygwin\")) {\n+                ranks.put(\"cygwin\", 22);\n+            }\n+            if (sysver.contains(\"freebsd\")) {\n+                ranks.put(\"freebsd\", 22);\n+            }\n+            if (sysver.contains(\"solaris\") || sysver.contains(\"sunos\")) {\n+                ranks.put(\"solaris\", 22);\n+            }\n+        } catch (InterruptedException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzUwNjE3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380750617", "createdAt": "2020-03-24T22:47:51Z", "commit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjo0Nzo1MlrOF7F8sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjo0Nzo1MlrOF7F8sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUwNzc2Mw==", "bodyText": "Can we wrap the try catch around only this line?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397507763", "createdAt": "2020-03-24T22:47:52Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/config/PlatformResolver.java", "diffHunk": "@@ -46,27 +46,31 @@\n         if (Files.exists(Paths.get(\"/usr/bin/yum\"))) {\n             ranks.put(\"fedora\", 11);\n         }\n-        String sysver = Exec.sh(\"uname -a\").toLowerCase();\n-        if (sysver.contains(\"ubuntu\")) {\n-            ranks.put(\"ubuntu\", 20);\n-        }\n-        if (sysver.contains(\"darwin\")) {\n-            ranks.put(\"macos\", 20);\n-        }\n-        if (sysver.contains(\"raspbian\")) {\n-            ranks.put(\"raspbian\", 22);\n-        }\n-        if (sysver.contains(\"qnx\")) {\n-            ranks.put(\"qnx\", 22);\n-        }\n-        if (sysver.contains(\"cygwin\")) {\n-            ranks.put(\"cygwin\", 22);\n-        }\n-        if (sysver.contains(\"freebsd\")) {\n-            ranks.put(\"freebsd\", 22);\n-        }\n-        if (sysver.contains(\"solaris\") || sysver.contains(\"sunos\")) {\n-            ranks.put(\"solaris\", 22);\n+        try {\n+            String sysver = Exec.sh(\"uname -a\").toLowerCase();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzU5MDYx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380759061", "createdAt": "2020-03-24T23:08:14Z", "commit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzowODoxNVrOF7GalQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzowODoxNVrOF7GalQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUxNTQxMw==", "bodyText": "why not log this? whats the advantage of sending this to sys.err than logging at error.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397515413", "createdAt": "2020-03-24T23:08:15Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/config/PlatformResolver.java", "diffHunk": "@@ -46,27 +46,31 @@\n         if (Files.exists(Paths.get(\"/usr/bin/yum\"))) {\n             ranks.put(\"fedora\", 11);\n         }\n-        String sysver = Exec.sh(\"uname -a\").toLowerCase();\n-        if (sysver.contains(\"ubuntu\")) {\n-            ranks.put(\"ubuntu\", 20);\n-        }\n-        if (sysver.contains(\"darwin\")) {\n-            ranks.put(\"macos\", 20);\n-        }\n-        if (sysver.contains(\"raspbian\")) {\n-            ranks.put(\"raspbian\", 22);\n-        }\n-        if (sysver.contains(\"qnx\")) {\n-            ranks.put(\"qnx\", 22);\n-        }\n-        if (sysver.contains(\"cygwin\")) {\n-            ranks.put(\"cygwin\", 22);\n-        }\n-        if (sysver.contains(\"freebsd\")) {\n-            ranks.put(\"freebsd\", 22);\n-        }\n-        if (sysver.contains(\"solaris\") || sysver.contains(\"sunos\")) {\n-            ranks.put(\"solaris\", 22);\n+        try {\n+            String sysver = Exec.sh(\"uname -a\").toLowerCase();\n+            if (sysver.contains(\"ubuntu\")) {\n+                ranks.put(\"ubuntu\", 20);\n+            }\n+            if (sysver.contains(\"darwin\")) {\n+                ranks.put(\"macos\", 20);\n+            }\n+            if (sysver.contains(\"raspbian\")) {\n+                ranks.put(\"raspbian\", 22);\n+            }\n+            if (sysver.contains(\"qnx\")) {\n+                ranks.put(\"qnx\", 22);\n+            }\n+            if (sysver.contains(\"cygwin\")) {\n+                ranks.put(\"cygwin\", 22);\n+            }\n+            if (sysver.contains(\"freebsd\")) {\n+                ranks.put(\"freebsd\", 22);\n+            }\n+            if (sysver.contains(\"solaris\") || sysver.contains(\"sunos\")) {\n+                ranks.put(\"solaris\", 22);\n+            }\n+        } catch (InterruptedException e) {\n+            e.printStackTrace(System.err);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzgwNjk2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380780696", "createdAt": "2020-03-25T00:08:32Z", "commit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDowODozMlrOF7HqqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDoxNDoxMVrOF7HxzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNTkxMw==", "bodyText": "What's the advantage of using thread pool instead of Thread here? These are long running threads that have the same lifetime as the services themselves. It doesn't seem like we can save any thread.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397535913", "createdAt": "2020-03-25T00:08:32Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -807,8 +798,7 @@ public String getName() {\n     @Override\n     public void postInject() {\n         initDependenciesTopic();\n-        //TODO: Use better threadPool mechanism\n-        lifeCycleThread = new Thread(() -> {\n+        lifecycleFuture = context.get(ExecutorService.class).submit(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNjI4Mg==", "bodyText": "update java doc?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397536282", "createdAt": "2020-03-25T00:09:43Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -618,27 +616,22 @@ public boolean isErrored() {\n      * Called when this service is known to be needed to make sure that required\n      * additional software is installed.\n      */\n-    protected void install() {\n+    protected void install() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNjM0Mg==", "bodyText": "update doc, this is worth documenting", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397536342", "createdAt": "2020-03-25T00:09:53Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -618,27 +616,22 @@ public boolean isErrored() {\n      * Called when this service is known to be needed to make sure that required\n      * additional software is installed.\n      */\n-    protected void install() {\n+    protected void install() throws InterruptedException {\n     }\n \n     /**\n      * Called when all dependencies are RUNNING. If there are no dependencies,\n      * it is called right after postInject.  The service doesn't transition to RUNNING\n      * until *after* this state is complete.\n      */\n-    protected void startup() {\n+    protected void startup() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNjU3Mg==", "bodyText": "update doc to document the behavior", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397536572", "createdAt": "2020-03-25T00:10:27Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -618,27 +616,22 @@ public boolean isErrored() {\n      * Called when this service is known to be needed to make sure that required\n      * additional software is installed.\n      */\n-    protected void install() {\n+    protected void install() throws InterruptedException {\n     }\n \n     /**\n      * Called when all dependencies are RUNNING. If there are no dependencies,\n      * it is called right after postInject.  The service doesn't transition to RUNNING\n      * until *after* this state is complete.\n      */\n-    protected void startup() {\n+    protected void startup() throws InterruptedException {\n         reportState(State.RUNNING);\n     }\n \n-    @Deprecated\n-    public void run() {\n-        reportState(State.FINISHED);\n-    }\n-\n     /**\n      * Called when the object's state leaves RUNNING.\n      */\n-    protected void shutdown() {\n+    protected void shutdown() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNzIyNA==", "bodyText": "Add comment explaining why we populate up the InteruptedException.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397537224", "createdAt": "2020-03-25T00:12:42Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -329,11 +329,15 @@ private void exec() {\n                         (stderr != null ? stderr : stdout).accept(\"\\n[TIMEOUT after InterruptedException]\\n\");\n                         process.destroyForcibly();\n                     }\n+                    throw ie;\n                 }\n                 stderrc.join(5000);\n                 stdoutc.join(5000);\n             }\n         } catch (Throwable ex) {\n+            if (ex instanceof InterruptedException) {\n+                throw (InterruptedException) ex;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNzc0MQ==", "bodyText": "log here?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397537741", "createdAt": "2020-03-25T00:14:11Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/GenericExternalService.java", "diffHunk": "@@ -121,7 +120,12 @@ public void startup() {\n     @Override\n     public void shutdown() {\n         inShutdown = true;\n-        run(\"shutdown\", null);\n+        try {\n+            run(\"shutdown\", null);\n+        } catch (InterruptedException ex) {\n+            inShutdown = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4fb83d2a454e7eae4b0b9a4f97cd0b81194b6f8e", "committedDate": "2020-03-24T16:53:35Z", "message": "Switch lifecycle thread to threadpool. Pass InterruptedException all the way up"}, "afterCommit": {"oid": "da30ed45e7d233280643db22f4ca8ea72eadff3d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/da30ed45e7d233280643db22f4ca8ea72eadff3d", "committedDate": "2020-03-25T01:38:15Z", "message": "Switch lifecycle thread to threadpool. Pass InterruptedException all the way up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "961bd14402c6d63ffeaf318578f60bcbdbb1a7c2", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/961bd14402c6d63ffeaf318578f60bcbdbb1a7c2", "committedDate": "2020-03-25T01:38:24Z", "message": "Switch lifecycle thread to threadpool. Pass InterruptedException all the way up"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da30ed45e7d233280643db22f4ca8ea72eadff3d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/da30ed45e7d233280643db22f4ca8ea72eadff3d", "committedDate": "2020-03-25T01:38:15Z", "message": "Switch lifecycle thread to threadpool. Pass InterruptedException all the way up"}, "afterCommit": {"oid": "961bd14402c6d63ffeaf318578f60bcbdbb1a7c2", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/961bd14402c6d63ffeaf318578f60bcbdbb1a7c2", "committedDate": "2020-03-25T01:38:24Z", "message": "Switch lifecycle thread to threadpool. Pass InterruptedException all the way up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODI3OTg2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380827986", "createdAt": "2020-03-25T02:52:21Z", "commit": {"oid": "9b4e04947b1ae29291710566b8856f079268e8a1"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b4e04947b1ae29291710566b8856f079268e8a1", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9b4e04947b1ae29291710566b8856f079268e8a1", "committedDate": "2020-03-25T02:04:01Z", "message": "Handle interruption from service commands appropriately"}, "afterCommit": {"oid": "50d3074288a8f8323d008f3d3277305a3b722467", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/50d3074288a8f8323d008f3d3277305a3b722467", "committedDate": "2020-03-25T03:23:24Z", "message": "Handle interruption from service commands appropriately"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODM3NDk4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380837498", "createdAt": "2020-03-25T03:27:20Z", "commit": {"oid": "50d3074288a8f8323d008f3d3277305a3b722467"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzoyNzoyMFrOF7K8_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzoyOToyOVrOF7K_Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4OTc1Nw==", "bodyText": "NIT:\ntry {\n} catch(InterruptedException e) {\n  logger.Warn()\n} catch(Throwable t) {\n  reportError\n} finally {\n}", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397589757", "createdAt": "2020-03-25T03:27:20Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -413,8 +411,13 @@ private void startStateTransition() throws InterruptedException {\n                         try {\n                             install();\n                         } catch (Throwable t) {\n-                            reportState(State.ERRORED);\n-                            logger.atError().setEventType(\"service-install-error\").setCause(t).log();\n+                            if (t instanceof InterruptedException) {\n+                                logger.atWarn(\"service-install-interrupted\")\n+                                        .log(\"Service interrupted while running install\");\n+                            } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50d3074288a8f8323d008f3d3277305a3b722467"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU5MDMzMA==", "bodyText": "ditto", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#discussion_r397590330", "createdAt": "2020-03-25T03:29:29Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -807,33 +827,35 @@ public String getName() {\n     @Override\n     public void postInject() {\n         initDependenciesTopic();\n-        //TODO: Use better threadPool mechanism\n-        lifeCycleThread = new Thread(() -> {\n+        lifecycleFuture = context.get(ExecutorService.class).submit(() -> {\n             while (!isClosed.get()) {\n                 try {\n                     startStateTransition();\n                     return;\n                 } catch (Throwable e) {\n+                    if (e instanceof InterruptedException) {\n+                        logger.atWarn().setEventType(\"service-state-transition-interrupted\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50d3074288a8f8323d008f3d3277305a3b722467"}, "originalPosition": 221}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "068beaa915249c7554fb55b3950f3e6ba0c21bc3", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/068beaa915249c7554fb55b3950f3e6ba0c21bc3", "committedDate": "2020-03-25T03:34:27Z", "message": "Handle interruption from service commands appropriately"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50d3074288a8f8323d008f3d3277305a3b722467", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/50d3074288a8f8323d008f3d3277305a3b722467", "committedDate": "2020-03-25T03:23:24Z", "message": "Handle interruption from service commands appropriately"}, "afterCommit": {"oid": "068beaa915249c7554fb55b3950f3e6ba0c21bc3", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/068beaa915249c7554fb55b3950f3e6ba0c21bc3", "committedDate": "2020-03-25T03:34:27Z", "message": "Handle interruption from service commands appropriately"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODQxMDgz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380841083", "createdAt": "2020-03-25T03:41:42Z", "commit": {"oid": "068beaa915249c7554fb55b3950f3e6ba0c21bc3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODUyMTUz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380852153", "createdAt": "2020-03-25T04:28:50Z", "commit": {"oid": "068beaa915249c7554fb55b3950f3e6ba0c21bc3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODcyMTY0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/131#pullrequestreview-380872164", "createdAt": "2020-03-25T05:49:34Z", "commit": {"oid": "068beaa915249c7554fb55b3950f3e6ba0c21bc3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2368, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}