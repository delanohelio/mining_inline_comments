{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MjM4NDA2", "number": 393, "title": "Clear auth module when component removed", "bodyText": "Issue #, if available:\nDescription of changes:\nClear auth module when a service is removed, delete all permission entries including that component\nWhy is this change necessary:\nAuth module should not have entries with component that has been removed\nHow was this change tested:\nmvn verify\nut & integ test\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-08-26T22:34:14Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393", "merged": true, "mergeCommit": {"oid": "4c9e7ca6d8892e2ecf9a19cef635877ca35ea617"}, "closed": true, "closedAt": "2020-09-10T17:01:10Z", "author": {"login": "youtuyy"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCzjg7AH2gAyNDc0MjM4NDA2OjEwZTcyYThiYTYzZjNhYzM5NDQ2ODdkMWE3NWFiMjE2ODE3OTU2Y2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHjwxJgFqTQ4NjEzMTE4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "10e72a8ba63f3ac3944687d1a75ab216817956ce", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/10e72a8ba63f3ac3944687d1a75ab216817956ce", "committedDate": "2020-08-26T22:29:02Z", "message": "Clear auth module when component removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "624d71aaf31d6104a898edb9c5b2ebc97351b783", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/624d71aaf31d6104a898edb9c5b2ebc97351b783", "committedDate": "2020-08-26T23:18:51Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MjUyNTk3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-476252597", "createdAt": "2020-08-27T00:52:08Z", "commit": {"oid": "624d71aaf31d6104a898edb9c5b2ebc97351b783"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDo1MjowOFrOHHrmVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMDo1MjowOFrOHHrmVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzgxNjQwNA==", "bodyText": "this is wrong. The name of this node could be anything. Use kernel.findServiceForNode to get the service name", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r477816404", "createdAt": "2020-08-27T00:52:08Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/auth/AuthorizationHandler.java", "diffHunk": "@@ -78,6 +80,9 @@ public AuthorizationHandler(Kernel kernel,  AuthorizationModule authModule,\n                         return;\n                     }\n                     if (!newv.childOf(ACCESS_CONTROL_NAMESPACE_TOPIC)) {\n+                        if (newv.childOf(SERVICES_NAMESPACE_TOPIC) && WhatHappened.childRemoved.equals(why)) {\n+                            authModule.clearPermissions(newv.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "624d71aaf31d6104a898edb9c5b2ebc97351b783"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Mjk3OTAy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-476297902", "createdAt": "2020-08-27T01:19:13Z", "commit": {"oid": "624d71aaf31d6104a898edb9c5b2ebc97351b783"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMToxOToxM1rOHHua7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMToxOToxM1rOHHua7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzg2MjYzNg==", "bodyText": "This  makes it interesting, as we can have the same component added again, and now the policies should be added again. Looks like we need to reload the table again on addition of components as well.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r477862636", "createdAt": "2020-08-27T01:19:13Z", "author": {"login": "prateek-y"}, "path": "src/main/java/com/aws/iot/evergreen/auth/AuthorizationHandler.java", "diffHunk": "@@ -78,6 +80,9 @@ public AuthorizationHandler(Kernel kernel,  AuthorizationModule authModule,\n                         return;\n                     }\n                     if (!newv.childOf(ACCESS_CONTROL_NAMESPACE_TOPIC)) {\n+                        if (newv.childOf(SERVICES_NAMESPACE_TOPIC) && WhatHappened.childRemoved.equals(why)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "624d71aaf31d6104a898edb9c5b2ebc97351b783"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3Mzc5MjQx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-477379241", "createdAt": "2020-08-28T07:22:54Z", "commit": {"oid": "624d71aaf31d6104a898edb9c5b2ebc97351b783"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwNzoyMjo1NFrOHIsfRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwNzoyMjo1NFrOHIsfRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg3OTU1OA==", "bodyText": "This may no longer be the case...take a look at #399\nAlthough I can probably just modify my PR to accommodate this. Let's sync up to discuss how we want to implement this.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r478879558", "createdAt": "2020-08-28T07:22:54Z", "author": {"login": "avipinku"}, "path": "src/main/java/com/aws/iot/evergreen/auth/AuthorizationHandler.java", "diffHunk": "@@ -78,6 +80,9 @@ public AuthorizationHandler(Kernel kernel,  AuthorizationModule authModule,\n                         return;\n                     }\n                     if (!newv.childOf(ACCESS_CONTROL_NAMESPACE_TOPIC)) {\n+                        if (newv.childOf(SERVICES_NAMESPACE_TOPIC) && WhatHappened.childRemoved.equals(why)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "624d71aaf31d6104a898edb9c5b2ebc97351b783"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b0a16d27bf5045bc37b890924e28d47c90f5fbd", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4b0a16d27bf5045bc37b890924e28d47c90f5fbd", "committedDate": "2020-08-28T22:06:36Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a9345802e0f4c871401ac37e796c5ab971df9c2", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6a9345802e0f4c871401ac37e796c5ab971df9c2", "committedDate": "2020-09-02T07:15:15Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a4292510dbc32fc3e0d3b9d74cb14c3c9f38287", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0a4292510dbc32fc3e0d3b9d74cb14c3c9f38287", "committedDate": "2020-09-02T23:55:45Z", "message": "Merge remote-tracking branch 'origin/master'\n\n# Conflicts:\n#\tsrc/integrationtests/java/com/aws/iot/evergreen/integrationtests/ipc/IPCPubSubTest.java\n#\tsrc/main/java/com/aws/iot/evergreen/auth/AuthorizationHandler.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceede654d29e82dd1917551c190e9427093eb9ab", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ceede654d29e82dd1917551c190e9427093eb9ab", "committedDate": "2020-09-03T15:55:59Z", "message": "rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDYxNTY0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-482061564", "createdAt": "2020-09-03T17:37:36Z", "commit": {"oid": "ceede654d29e82dd1917551c190e9427093eb9ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzozNzozNlrOHMw8nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzozNzozNlrOHMw8nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE0NjkwOA==", "bodyText": "Do we need this with ashay's change to reload all of the config?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r483146908", "createdAt": "2020-09-03T17:37:36Z", "author": {"login": "prateek-y"}, "path": "src/main/java/com/aws/iot/evergreen/auth/AuthorizationHandler.java", "diffHunk": "@@ -94,9 +96,15 @@ public AuthorizationHandler(Kernel kernel,  AuthorizationModule authModule,\n                                     .log(\"Incorrect formatting while updating the authorization ACL.\");\n                             return;\n                         }\n-                    } else if (why.equals(WhatHappened.childRemoved) && !newv.getName().equals(PARAMETERS_CONFIG_KEY)\n-                             && !newv.getName().equals(ACCESS_CONTROL_NAMESPACE_TOPIC)) {\n-                        return;\n+                    } else if (WhatHappened.childRemoved.equals(why)) {\n+                        if (newv.parent.getName().equals(SERVICES_NAMESPACE_TOPIC)) {\n+                            authModule.clearPermissions(findServiceForNode(newv));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ceede654d29e82dd1917551c190e9427093eb9ab"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDU5NDgy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-482059482", "createdAt": "2020-09-03T17:34:33Z", "commit": {"oid": "ceede654d29e82dd1917551c190e9427093eb9ab"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzozNDozM1rOHMw2Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzo0Mjo1NFrOHMxHoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE0NTI4Ng==", "bodyText": "Could you also change this to WhatHappened.childChanged.equals(why) like you did below?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r483145286", "createdAt": "2020-09-03T17:34:33Z", "author": {"login": "avipinku"}, "path": "src/main/java/com/aws/iot/evergreen/auth/AuthorizationHandler.java", "diffHunk": "@@ -79,13 +81,13 @@ public AuthorizationHandler(Kernel kernel,  AuthorizationModule authModule,\n                         return;\n                     }\n \n-                     //If there is a childChanged event, it has to be the 'accessControl' Topic that has bubbled up\n-                     //If there is a childRemoved event, it could be either the 'accessControl' Topic or the\n-                     //'parameters' Topics that has bubbled up, so we need to handle and filter out all other\n-                     // WhatHappeneds\n-                     if (why.equals(WhatHappened.childChanged)) {\n-                        if (!newv.childOf(PARAMETERS_CONFIG_KEY)\n-                                || !newv.getName().equals(ACCESS_CONTROL_NAMESPACE_TOPIC)) {\n+                    //If there is a childChanged event, it has to be the 'accessControl' Topic that has bubbled up\n+                    //If there is a childRemoved event, it could be the component is removed, or either the\n+                    //'accessControl' Topic or/the 'parameters' Topics that has bubbled up, so we need to handle and\n+                    //filter out all other WhatHappeneds\n+                    if (why.equals(WhatHappened.childChanged)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ceede654d29e82dd1917551c190e9427093eb9ab"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE0OTcyOQ==", "bodyText": "Before removing the serviceTopic, could you validate that pub/sub works up above here, and then test that the policies have been removed after the serviceTopic removal?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r483149729", "createdAt": "2020-09-03T17:42:54Z", "author": {"login": "avipinku"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/ipc/IPCPubSubTest.java", "diffHunk": "@@ -169,6 +169,35 @@ void GIVEN_pubsubclient_WHEN_authorized_THEN_parameters_child_removed_THEN_updat\n         assertThrows(PubSubException.class, () -> c.publishToTopic(\"a\", \"some message\".getBytes(StandardCharsets.UTF_8)));\n     }\n \n+    @Test\n+    void GIVEN_pubsubclient_WHEN_service_removed_and_added_THEN_fail_and_succeed() throws Exception {\n+        kernel = prepareKernelFromConfigFile(\"pubsub_authorized.yaml\",\n+                TEST_SERVICE_NAME, this.getClass());\n+        KernelIPCClientConfig config = getIPCConfigForService(TEST_SERVICE_NAME, kernel);\n+        client = new IPCClientImpl(config);\n+        PubSub c = new PubSubImpl(client);\n+        Pair<CompletableFuture<Void>, Consumer<byte[]>> cb = asyncAssertOnConsumer((m) -> {\n+            assertEquals(\"some message\", new String(m, StandardCharsets.UTF_8));\n+        });\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ceede654d29e82dd1917551c190e9427093eb9ab"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aaaddef6bbba71e54c0d5e85d9cee4e6f5022d1", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1aaaddef6bbba71e54c0d5e85d9cee4e6f5022d1", "committedDate": "2020-09-03T18:07:01Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a52ad3850cd9b3259038213500ec37fb6c481502", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a52ad3850cd9b3259038213500ec37fb6c481502", "committedDate": "2020-09-03T18:15:30Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTI4OTg5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-482128989", "createdAt": "2020-09-03T19:11:35Z", "commit": {"oid": "a52ad3850cd9b3259038213500ec37fb6c481502"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1423425dbdbe273c62ea7e4f67ff275a46551b11", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1423425dbdbe273c62ea7e4f67ff275a46551b11", "committedDate": "2020-09-04T00:18:52Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3defeab49176c9210ee38a7dec7085c9aec89bc5", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3defeab49176c9210ee38a7dec7085c9aec89bc5", "committedDate": "2020-09-04T00:23:13Z", "message": "fix policy reload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c8dd8b3074ec815abe42f7b3f3ae54d32ea6af9", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1c8dd8b3074ec815abe42f7b3f3ae54d32ea6af9", "committedDate": "2020-09-04T00:42:26Z", "message": "fix ut"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzA3Mjc0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-482307274", "createdAt": "2020-09-04T01:54:17Z", "commit": {"oid": "1c8dd8b3074ec815abe42f7b3f3ae54d32ea6af9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo1NDoxN1rOHM84Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo1NDoxN1rOHM84Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0MjQxMQ==", "bodyText": "Not needed?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r483342411", "createdAt": "2020-09-04T01:54:17Z", "author": {"login": "prateek-y"}, "path": "src/main/java/com/aws/iot/evergreen/auth/AuthorizationModule.java", "diffHunk": "@@ -43,12 +44,34 @@ public void addPermission(final String destination, Permission permission) throw\n      * Clear the permission list for a given destination. This is used when updating policies for a component.\n      * @param destination destination value\n      */\n-    public void clearComponentPermissions(String destination) {\n+    public void deletePermissionsWithDestination(String destination) {\n         if (permissions.containsKey(destination) && !Utils.isEmpty(permissions.get(destination))) {\n             permissions.get(destination).clear();\n         }\n     }\n \n+    /**\n+     * Clear the permission list with a given principal.\n+     *\n+     * @param component component name\n+     */\n+    public void deletePermissionsWithPrincipal(String component) {\n+        for (Map.Entry<String, List<Permission>> permissionSet : permissions.entrySet()) {\n+            permissionSet.getValue().removeIf(entry -> entry.hasPrincipal(component));\n+        }\n+    }\n+\n+    /**\n+     * Clear permissions for a given component. This is used when a component is removed.\n+     *\n+     * @param component component name\n+     */\n+    public void clearPermissions(String component) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c8dd8b3074ec815abe42f7b3f3ae54d32ea6af9"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzA3NDIw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-482307420", "createdAt": "2020-09-04T01:54:47Z", "commit": {"oid": "1c8dd8b3074ec815abe42f7b3f3ae54d32ea6af9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo1NDo0N1rOHM84wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo1NDo0N1rOHM84wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0MjUyOA==", "bodyText": "Only  needed to test deletePermissionsWithDestination ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#discussion_r483342528", "createdAt": "2020-09-04T01:54:47Z", "author": {"login": "prateek-y"}, "path": "src/test/java/com/aws/iot/evergreen/auth/AuthorizationModuleTest.java", "diffHunk": "@@ -79,6 +81,28 @@ void Given_authZmodule_WHEN_added_entries_THEN_retrieve_works(String destination\n         assertTrue(module.isPresent(destination, permission));\n     }\n \n+    @Test\n+    void Given_authZmodule_WHEN_given_component_and_clear_permissions_THEN_delete_permissions() {\n+        AuthorizationModule module = new AuthorizationModule();\n+        permissionEntries().forEach(entry -> {\n+            String destination = (String)entry.get()[0];\n+            String principal = (String)entry.get()[1];\n+            String op = (String)entry.get()[2];\n+            String resource = (String)entry.get()[3];\n+            try {\n+                Permission permission = Permission.builder().principal(principal).operation(op).resource(resource).build();\n+                module.addPermission(destination, permission);\n+                assertTrue(module.isPresent(destination, permission));\n+            } catch (AuthorizationException e) {\n+                fail(\"Encountered exception \", e);\n+            }\n+        });\n+        String componentToRemove = \"ComponentB\";\n+        module.clearPermissions(componentToRemove);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c8dd8b3074ec815abe42f7b3f3ae54d32ea6af9"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b5f031e059629976275068d29c5de7b71f3f79", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c9b5f031e059629976275068d29c5de7b71f3f79", "committedDate": "2020-09-04T02:05:20Z", "message": "remove unused methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MzM5NTU0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-484339554", "createdAt": "2020-09-08T17:11:51Z", "commit": {"oid": "c9b5f031e059629976275068d29c5de7b71f3f79"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b62e2581c2b1c8d3a97c6c828b4ec43e318b8878", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b62e2581c2b1c8d3a97c6c828b4ec43e318b8878", "committedDate": "2020-09-08T17:20:34Z", "message": "Merge branch 'master' into auth-remove-component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b688c71a7ed0acb90cb7df760c0853ee79eef53", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0b688c71a7ed0acb90cb7df760c0853ee79eef53", "committedDate": "2020-09-10T16:15:33Z", "message": "Merge branch 'master' into auth-remove-component"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MTMxMTg5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/393#pullrequestreview-486131189", "createdAt": "2020-09-10T16:54:39Z", "commit": {"oid": "0b688c71a7ed0acb90cb7df760c0853ee79eef53"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3214, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}