{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NzEyODg4", "number": 734, "title": "Fixed race condition when merging tlog into config", "bodyText": "Issue #, if available:\nRace condition when merging a tlog file into config.\nhttps://sim.amazon.com/issues/c26c36cc-499e-4364-935f-002b04209203\nDescription of changes:\nWhen a tlog entry with action interiorAdded is encountered, a new child topics needs to be created. This was done in two steps\n\nCreate a Topics with modtime with current System time\nUpdate the modtime of the topics to the time stamp from tlog entry\n\nWhen a new child topics is created a child changed event is received by all its the parent topics. If the event is received before step 2 all the parent nodes has there modtime updated to current system time. This causes the parent nodes to reject further from the tlog file as the  timestamp in tlog entry will be lower than the system current time.\nFix:\nUpdated the new child topic creation to be a single step. (Topics is created with the current modtime)\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n[X ] Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-30T17:54:24Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/734", "merged": true, "mergeCommit": {"oid": "84fce61216df2e7e3a4d17e02e8eed173cb7d4de"}, "closed": true, "closedAt": "2020-11-30T19:36:37Z", "author": {"login": "fahadmohammed01"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdho54xAH2gAyNTI5NzEyODg4OjQzNmFjZmUwNjIyOTE4MzllYzFhNmExNTg3NGEyYThkMTRmMzI2OGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhqXFnAFqTU0MTIxNjYxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "436acfe062291839ec1a6a15874a2a8d14f3268f", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/436acfe062291839ec1a6a15874a2a8d14f3268f", "committedDate": "2020-11-30T17:36:10Z", "message": "Fixed race condition when merging tlog into config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMTU3MDEx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/734#pullrequestreview-541157011", "createdAt": "2020-11-30T17:57:48Z", "commit": {"oid": "436acfe062291839ec1a6a15874a2a8d14f3268f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzo1Nzo0OFrOH8G-DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzo1OToyM1rOH8HB5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc5MDc5Nw==", "bodyText": "nit\ncall the newer constructor from this one, with timestamp 0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/734#discussion_r532790797", "createdAt": "2020-11-30T17:57:48Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Node.java", "diffHunk": "@@ -32,6 +32,14 @@ protected Node(Context c, String n, Topics p) {\n         fnc = calcFnc();\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "436acfe062291839ec1a6a15874a2a8d14f3268f"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc5MTc4Mw==", "bodyText": "can the older implementation call this one? I don't want to have duplicated logic.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/734#discussion_r532791783", "createdAt": "2020-11-30T17:59:23Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topics.java", "diffHunk": "@@ -175,6 +220,23 @@ public Topics lookupTopics(String... path) {\n         return n;\n     }\n \n+    /**\n+     * Find, and create if missing, a list of topics (name/value pairs) in the\n+     * config file. Never returns null.\n+     *\n+     * @param timestamp modtime of newly created nodes\n+     * @param path String[] of node names to traverse to find or create the Topics\n+     * @return\n+     */\n+    public Topics lookupTopics(long timestamp, String... path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "436acfe062291839ec1a6a15874a2a8d14f3268f"}, "originalPosition": 105}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ef268dd7ec4fbf2edc1716e23fc6aad0f38c582", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0ef268dd7ec4fbf2edc1716e23fc6aad0f38c582", "committedDate": "2020-11-30T18:10:35Z", "message": "Merge branch 'master' into fix-read-from-tlog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15c6fcefd4ec2fd20a69c189c427a8ca66876cdf", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/15c6fcefd4ec2fd20a69c189c427a8ca66876cdf", "committedDate": "2020-11-30T18:56:22Z", "message": "minor refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee485807a92cfe88803b929efd49617d1ff27691", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ee485807a92cfe88803b929efd49617d1ff27691", "committedDate": "2020-11-30T19:10:04Z", "message": "addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjE0OTk4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/734#pullrequestreview-541214998", "createdAt": "2020-11-30T19:15:48Z", "commit": {"oid": "ee485807a92cfe88803b929efd49617d1ff27691"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjE2NjE1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/734#pullrequestreview-541216615", "createdAt": "2020-11-30T19:17:58Z", "commit": {"oid": "ee485807a92cfe88803b929efd49617d1ff27691"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2769, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}