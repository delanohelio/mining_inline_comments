{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNjAzOTkw", "number": 585, "title": "Wildcard support for MQTT Proxy AuthZ", "bodyText": "Issue #, if available:\nDescription of changes:\nSupport wildcards in MQTT Proxy authorization policy\nRefer this doc https://quip-amazon.com/dy0LA8MKe8AP/MQTT-Proxy-AuthZ-policy-format\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-29T22:23:49Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585", "merged": true, "mergeCommit": {"oid": "e98ba5adcf9da2f7e56cccace1f50ddc5cca449f"}, "closed": true, "closedAt": "2020-10-30T23:42:13Z", "author": {"login": "popanmol"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXZyiLgH2gAyNTEyNjAzOTkwOjc4NjExMzU3MTgxYTBkZTc4NDFkM2U0NDNkOTlhNzE1NmUzN2E2MmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXvLgcAH2gAyNTEyNjAzOTkwOjc3NzlhYTZlMjI4MzRiNTJlMmQzZDQzZTQ0MjE4MWMyNjdlZjJlODg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/78611357181a0de7841d3e443d99a7156e37a62d", "committedDate": "2020-10-29T22:20:19Z", "message": "Wildcard support for MQTT Proxy AuthZ"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTMzMDA4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520133008", "createdAt": "2020-10-29T22:27:07Z", "commit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyNzowN1rOHqw49Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyNzowN1rOHqw49Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzI1Mw==", "bodyText": "this test doesn't seem to actually validate the behavior for wildcards in topics.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603253", "createdAt": "2020-10-29T22:27:07Z", "author": {"login": "MikeDombo"}, "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -6,7 +6,6 @@\n package com.aws.greengrass.builtin.services.mqttproxy;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTMzNzk0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520133794", "createdAt": "2020-10-29T22:28:55Z", "commit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyODo1NVrOHqw7bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyODo1NVrOHqw7bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzg4Nw==", "bodyText": "let's have a unit test for this behavior", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603887", "createdAt": "2020-10-29T22:28:55Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgent.java", "diffHunk": "@@ -199,12 +201,32 @@ private QualityOfService getQualityOfServiceFromQOS(QOS qos) {\n     }\n \n     private void doAuthorization(String opName, String serviceName, String topic) throws AuthorizationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTk4MzIw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520198320", "createdAt": "2020-10-30T00:16:29Z", "commit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8116f9a6314aa7dbb4667a65ef4e360f769827c", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c8116f9a6314aa7dbb4667a65ef4e360f769827c", "committedDate": "2020-10-30T01:17:57Z", "message": "unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb80eedddc5c868c1aaf4df52039233d3cb2f904", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cb80eedddc5c868c1aaf4df52039233d3cb2f904", "committedDate": "2020-10-30T01:19:14Z", "message": "Merge branch 'master' into mqtt-authz"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzMzMjI4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520333228", "createdAt": "2020-10-30T02:11:42Z", "commit": {"oid": "cb80eedddc5c868c1aaf4df52039233d3cb2f904"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMjoxMTo0MlrOHq3Mlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMjoxMTo0MlrOHq3Mlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDcwNjU4Mg==", "bodyText": "make these more different, as it is, either one would match", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514706582", "createdAt": "2020-10-30T02:11:42Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/resources/com/aws/greengrass/integrationtests/ipc/mqttproxy.yaml", "diffHunk": "@@ -16,7 +16,8 @@ services:\n                 \"aws.greengrass#SubscribeToIoTCore\"\n               ],\n               \"resources\":[\n-                \"A/B/C\"\n+                \"A/+/C\",\n+                \"A/B/#\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb80eedddc5c868c1aaf4df52039233d3cb2f904"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzM1Njky", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520335692", "createdAt": "2020-10-30T02:20:49Z", "commit": {"oid": "cb80eedddc5c868c1aaf4df52039233d3cb2f904"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1ffe9c2a46128ca465c5888742914ae538ec6b2", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e1ffe9c2a46128ca465c5888742914ae538ec6b2", "committedDate": "2020-10-30T02:23:51Z", "message": "Merge branch 'master' into mqtt-authz"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b82bc873d14c6087b219ff19b4317839433d94a", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0b82bc873d14c6087b219ff19b4317839433d94a", "committedDate": "2020-10-30T02:26:17Z", "message": "wildcards in config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzM3OTM4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520337938", "createdAt": "2020-10-30T02:28:23Z", "commit": {"oid": "0b82bc873d14c6087b219ff19b4317839433d94a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzY1NzEy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520365712", "createdAt": "2020-10-30T04:11:56Z", "commit": {"oid": "0b82bc873d14c6087b219ff19b4317839433d94a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNDoxMTo1NlrOHq-NKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNDoxMTo1NlrOHq-NKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDgyMTQxNg==", "bodyText": "Policy is missing a couple cases. We need to ensure getAuthorizedResources() can handle wildcards (both principal and operation) and that it filters out resources that aren't matches.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514821416", "createdAt": "2020-10-30T04:11:56Z", "author": {"login": "jbutler"}, "path": "src/test/java/com/aws/greengrass/authorization/AuthorizationModuleTest.java", "diffHunk": "@@ -121,4 +123,25 @@ void Given_authZmodule_WHEN_added_entries_successively_THEN_retrieve_works() {\n             }\n         });\n     }\n+\n+    @Test\n+    void Given_authZmodule_WHEN_added_entries_THEN_getResources_works() throws AuthorizationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b82bc873d14c6087b219ff19b4317839433d94a"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71b000d46c58b44d86f31140809715c857544051", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/71b000d46c58b44d86f31140809715c857544051", "committedDate": "2020-10-30T17:31:41Z", "message": "more coverage for getAuthorizedResources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODk2MDk1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520896095", "createdAt": "2020-10-30T17:39:32Z", "commit": {"oid": "71b000d46c58b44d86f31140809715c857544051"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75fe11d9cbf95983ca334446a02dab5a7202a9ed", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/75fe11d9cbf95983ca334446a02dab5a7202a9ed", "committedDate": "2020-10-30T17:57:13Z", "message": "Merge branch 'master' into mqtt-authz"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwOTE2MjUx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-520916251", "createdAt": "2020-10-30T18:03:09Z", "commit": {"oid": "71b000d46c58b44d86f31140809715c857544051"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46dc6174b6a2ef56fe510944ae91d73963f55002", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/46dc6174b6a2ef56fe510944ae91d73963f55002", "committedDate": "2020-10-30T20:36:57Z", "message": "getResources returns resources with * principal/op"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4c135a5f3e74f3fc7c11a4a595fa7c30501f0964", "committedDate": "2020-10-30T20:41:03Z", "message": "Merge branch 'master' into mqtt-authz"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDM1ODk3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-521035897", "createdAt": "2020-10-30T21:05:59Z", "commit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDM5NTgz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-521039583", "createdAt": "2020-10-30T21:13:39Z", "commit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToxMzozOVrOHrgpaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToxMzozOVrOHrgpaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NTcwNA==", "bodyText": "Update the comment", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515385704", "createdAt": "2020-10-30T21:13:39Z", "author": {"login": "prateek-y"}, "path": "src/main/java/com/aws/greengrass/authorization/AuthorizationHandler.java", "diffHunk": "@@ -192,6 +193,28 @@ public boolean isAuthorized(String destination, Permission permission) throws Au\n                         resource));\n     }\n \n+    /**\n+     * Get allowed resources for the combination of destination, principal and operation.\n+     * Also returns resources covered by permissions with * operation/principal.\n+     *\n+     * @param destination destination\n+     * @param principal   principal (cannot be *)\n+     * @param operation   operation (cannot be *)\n+     * @return list of allowed resources\n+     * @throws AuthorizationException when flow is not authorized", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDYwNTM4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-521060538", "createdAt": "2020-10-30T22:03:19Z", "commit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjowMzoxOVrOHrhqVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjowMzoxOVrOHrhqVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwMjMyNQ==", "bodyText": "do you need tests for multiple + or a combination of + and #", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515402325", "createdAt": "2020-10-30T22:03:19Z", "author": {"login": "prateek-y"}, "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -54,6 +59,18 @@\n     private static final String TEST_TOPIC = \"TestTopic\";\n     private static final byte[] TEST_PAYLOAD = \"TestPayload\".getBytes(StandardCharsets.UTF_8);\n \n+    private static final String TEST_SINGLE_LEVEL_WILDCARD = \"topic/with/single/level/+/wildcard\";\n+    private static final String TEST_MULTI_LEVEL_WILDCARD = \"topic/with/multi/level/wildcard/#\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDY2MTM1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-521066135", "createdAt": "2020-10-30T22:19:28Z", "commit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e054700f2b11d717ea075bd49cfeec77b57a2b40", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e054700f2b11d717ea075bd49cfeec77b57a2b40", "committedDate": "2020-10-30T22:24:08Z", "message": "update docstring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDY4NTg2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-521068586", "createdAt": "2020-10-30T22:27:15Z", "commit": {"oid": "e054700f2b11d717ea075bd49cfeec77b57a2b40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDY4Nzk0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#pullrequestreview-521068794", "createdAt": "2020-10-30T22:27:48Z", "commit": {"oid": "e054700f2b11d717ea075bd49cfeec77b57a2b40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7779aa6e22834b52e2d3d43e442181c267ef2e88", "author": {"user": {"login": "popanmol", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7779aa6e22834b52e2d3d43e442181c267ef2e88", "committedDate": "2020-10-30T23:15:36Z", "message": "Merge branch 'master' into mqtt-authz"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2861, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}