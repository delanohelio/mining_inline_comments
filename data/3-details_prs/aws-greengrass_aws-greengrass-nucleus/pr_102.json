{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NzE2NTA3", "number": 102, "title": "Fix test directory", "bodyText": "Issue #, if available:\nDescription of changes:\n\nUse JUnit5's @TempDir to generate a temp folder as Evergreen Root Folder for all integration tests.\nNote that IpcAwareServiceTest requires mvn command and Pom.xml file, so we are using a env var  Exec.setDefaultEnv(\"POM_DIR\", System.getProperty(\"user.dir\"));\nMove SampleIpcAwareServiceMovesToRunning.java to integration test folder.\nClean up some 'public' access modifier on classes and methods\n\nWhy is this change necessary:\n\nTwo tests currently using user.dir or working directory will emit test files to project root folder. They are fixed with as well.\n\nHow was this change tested:\n\nmvn verify.\nNote that the untouched ServiceConfigMergingTest still may fail from time to time due to potential race condition... We need to fix it right after this.\n\nAny additional information or context required to review the change:\n\nLet's merge this in first so that people's project folder won't be polluted after running integration tests.\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-03-09T17:22:07Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/102", "merged": true, "mergeCommit": {"oid": "54e8d11092a0ff8e974f839be411d78e2aad189a"}, "closed": true, "closedAt": "2020-03-09T19:17:20Z", "author": {"login": "leaf94"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLJYNJAH2gAyMzg1NzE2NTA3OjVlZGE2Y2ZiNWIwYTRlZjI0MzM2OTU5NTU1NTE0YjBjZWU4Y2Y5M2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMCr3nAH2gAyMzg1NzE2NTA3OjliNWQ5Zjk5MzI1ZTU1ZTBmMzM5YTQ5YmU5NTI0MTVhMGMzMWIyOTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5eda6cfb5b0a4ef24336959555514b0cee8cf93f", "author": {"user": {"login": "leaf94", "name": "Ethan Huang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5eda6cfb5b0a4ef24336959555514b0cee8cf93f", "committedDate": "2020-03-07T00:14:50Z", "message": "Update IPCAwareService to use temp directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dec104e1528484acfd04f2d47ec6b1be4b2e4e68", "author": {"user": {"login": "leaf94", "name": "Ethan Huang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/dec104e1528484acfd04f2d47ec6b1be4b2e4e68", "committedDate": "2020-03-07T00:23:06Z", "message": "Update IPCAwareService to use temp directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b54af0ea4141d6a3b4b824947bce534b21c069a", "author": {"user": {"login": "leaf94", "name": "Ethan Huang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7b54af0ea4141d6a3b4b824947bce534b21c069a", "committedDate": "2020-03-07T02:21:23Z", "message": "Done"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9f9a18667673036da267086d74357fea36c5b8e", "author": {"user": {"login": "leaf94", "name": "Ethan Huang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a9f9a18667673036da267086d74357fea36c5b8e", "committedDate": "2020-03-07T04:01:58Z", "message": "Done"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cf41cb40598c339c68cb94d04b872f6b8b83e7e", "author": {"user": {"login": "leaf94", "name": "Ethan Huang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4cf41cb40598c339c68cb94d04b872f6b8b83e7e", "committedDate": "2020-03-09T17:24:22Z", "message": "Done"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzgxNzg0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/102#pullrequestreview-371381784", "createdAt": "2020-03-09T17:25:52Z", "commit": {"oid": "a9f9a18667673036da267086d74357fea36c5b8e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzgzMTM5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/102#pullrequestreview-371383139", "createdAt": "2020-03-09T17:27:31Z", "commit": {"oid": "4cf41cb40598c339c68cb94d04b872f6b8b83e7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyNzozMVrOFzyPBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyNzozMVrOFzyPBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0NDc0Mw==", "bodyText": "Can you remove the \"-log\", \"stdout\" stuff from all of these since they don't apply anymore?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/102#discussion_r389844743", "createdAt": "2020-03-09T17:27:31Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/ipc/IPCAwareServicesTest.java", "diffHunk": "@@ -7,46 +7,58 @@\n import com.aws.iot.evergreen.kernel.EvergreenService;\n import com.aws.iot.evergreen.kernel.Kernel;\n import com.aws.iot.evergreen.testcommons.extensions.PerformanceReporting;\n+import com.aws.iot.evergreen.util.Exec;\n import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.ExtendWith;\n+import org.junit.jupiter.api.io.TempDir;\n \n+import java.nio.file.Path;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n \n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n @ExtendWith(PerformanceReporting.class)\n-public class IPCAwareServicesTest {\n+class IPCAwareServicesTest {\n \n-    public static Kernel kernel;\n+    private static final String SAMPLE_IPC_AWARE_SERVICE_NAME = \"main\";\n+\n+    @TempDir\n+    static Path tempRootDir;\n+\n+    private Kernel kernel;\n \n     @BeforeEach\n-    public void setup() {\n+    void setup() {\n+        // set a POM_DIR env var for Exec so that ipc_aware_main.yaml can use it to locate pom.xml\n+        Exec.setDefaultEnv(\"POM_DIR\", System.getProperty(\"user.dir\"));\n+\n+        // start kernel\n         kernel = new Kernel();\n-        String tdir = System.getProperty(\"user.dir\");\n-        kernel.parseArgs(\"-r\", tdir, \"-log\", \"stdout\", \"-i\",\n-                IPCAwareServicesTest.class.getResource(\"ipc_aware_main.yaml\").toString());\n+        kernel.parseArgs(\"-r\", tempRootDir.toString(), \"-log\", \"stdout\", \"-i\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf41cb40598c339c68cb94d04b872f6b8b83e7e"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzg0OTA4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/102#pullrequestreview-371384908", "createdAt": "2020-03-09T17:29:38Z", "commit": {"oid": "4cf41cb40598c339c68cb94d04b872f6b8b83e7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b5d9f99325e55e0f339a49be952415a0c31b298", "author": {"user": {"login": "leaf94", "name": "Ethan Huang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9b5d9f99325e55e0f339a49be952415a0c31b298", "committedDate": "2020-03-09T19:00:54Z", "message": "cw script empty value check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2315, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}