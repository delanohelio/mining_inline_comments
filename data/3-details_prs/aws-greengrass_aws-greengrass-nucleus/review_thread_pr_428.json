{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NTI4Mzg0", "number": 428, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMToyMzo0NlrOEjYhOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyNjo0MVrOEkJ1xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1NTM3MzM3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/util/Coerce.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMToyMzo0NlrOHRtEsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMToyMzo0NlrOHRtEsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyNjMyMQ==", "bodyText": "reuse objectmapper from utils?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r488326321", "createdAt": "2020-09-15T01:23:46Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/util/Coerce.java", "diffHunk": "@@ -4,32 +4,23 @@\n package com.aws.iot.evergreen.util;\n \n import com.aws.iot.evergreen.config.Topic;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n \n import java.io.IOException;\n import java.lang.reflect.Array;\n import java.util.Arrays;\n import java.util.List;\n-import java.util.Map;\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n import static com.aws.iot.evergreen.util.Utils.isEmpty;\n \n public final class Coerce {\n-    public static final Object removed = new Object() {\n-        @Override\n-        public String toString() {\n-            return \"removed\";\n-        }\n-    };\n-    private static final Map<String, Object> specials =\n-            Utils.immutableMap(\"true\", true, \"false\", false, \"removed\", removed, \"Inf\", Double.POSITIVE_INFINITY,\n-                    \"+Inf\", Double.POSITIVE_INFINITY, \"-Inf\", Double.NEGATIVE_INFINITY, \"Nan\", Double.NaN, \"NaN\",\n-                    Double.NaN, \"inf\", Double.POSITIVE_INFINITY, \"+inf\", Double.POSITIVE_INFINITY, \"-inf\",\n-                    Double.NEGATIVE_INFINITY, \"nan\", Double.NaN);\n-    private static final char[] hex = \"0123456789ABCDEF\".toCharArray();\n-    private static final Pattern seperators = Pattern.compile(\" *, *\");\n+    private static final Pattern SEPARATORS = Pattern.compile(\" *, *\");\n     private static final Pattern unwrap = Pattern.compile(\" *\\\\[ *(.*) *\\\\] *\");\n+    private static final ObjectMapper MAPPER = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1NTM3NDY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/config/Tlogline.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMToyNDoyMVrOHRtFZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMToyNjo0OFrOHRtIwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyNjUwMw==", "bodyText": "Why do we still use comma separated line?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r488326503", "createdAt": "2020-09-15T01:24:21Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/config/Tlogline.java", "diffHunk": "@@ -49,16 +55,25 @@ static Tlogline fromStringInput(String l) throws InvalidLogException {\n         if (!m.matches()) {\n             throw new InvalidLogException(\"unrecognized log format: \" + l);\n         }\n-        long timestamp = parseLong(m.group(1));\n-        String topicString = m.group(2);\n         WhatHappened action = WhatHappened.valueOf(m.group(3).toLowerCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyNzM2MA==", "bodyText": "Because the whole line isn't json encoded, so we still need a field separator. We should probably switch to jackson for the whole thing.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r488327360", "createdAt": "2020-09-15T01:26:48Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/Tlogline.java", "diffHunk": "@@ -49,16 +55,25 @@ static Tlogline fromStringInput(String l) throws InvalidLogException {\n         if (!m.matches()) {\n             throw new InvalidLogException(\"unrecognized log format: \" + l);\n         }\n-        long timestamp = parseLong(m.group(1));\n-        String topicString = m.group(2);\n         WhatHappened action = WhatHappened.valueOf(m.group(3).toLowerCase());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyNjUwMw=="}, "originalCommit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MzQ1NDE1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/config/ConfigurationWriter.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyNjo0MVrOHS6_gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOToxNDowMlrOHTAX9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMjk0Nw==", "bodyText": "Is this platform-safe?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r489602947", "createdAt": "2020-09-16T17:26:41Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/config/ConfigurationWriter.java", "diffHunk": "@@ -119,7 +120,8 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n         }\n \n         try {\n-            tlogline.outputTo(out);\n+            Coerce.appendParseableString(tlogline, out);\n+            out.write('\\n');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwNDgzNg==", "bodyText": "Doesn't need to be, we just need to be consistent.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r489604836", "createdAt": "2020-09-16T17:30:03Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/ConfigurationWriter.java", "diffHunk": "@@ -119,7 +120,8 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n         }\n \n         try {\n-            tlogline.outputTo(out);\n+            Coerce.appendParseableString(tlogline, out);\n+            out.write('\\n');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMjk0Nw=="}, "originalCommit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwNDkzNQ==", "bodyText": "And it passes on Windows, so yes.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r489604935", "createdAt": "2020-09-16T17:30:14Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/ConfigurationWriter.java", "diffHunk": "@@ -119,7 +120,8 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n         }\n \n         try {\n-            tlogline.outputTo(out);\n+            Coerce.appendParseableString(tlogline, out);\n+            out.write('\\n');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMjk0Nw=="}, "originalCommit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MTEyNg==", "bodyText": "Will this corrupt the tlog if out.write('\\n') takes an exception?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r489691126", "createdAt": "2020-09-16T19:14:02Z", "author": {"login": "jbutler"}, "path": "src/main/java/com/aws/iot/evergreen/config/ConfigurationWriter.java", "diffHunk": "@@ -119,7 +120,8 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n         }\n \n         try {\n-            tlogline.outputTo(out);\n+            Coerce.appendParseableString(tlogline, out);\n+            out.write('\\n');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMjk0Nw=="}, "originalCommit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 784, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}