{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MzIyMDg0", "number": 140, "title": "Support lifecycle platform", "bodyText": "Issue #, if available:\nDescription of changes:\nresolve platform config if any in lifecycle and dependencies section\nWhy is this change necessary:\nplatform specific config is not resolved before sending to kernel. This change is to add the support.\nHow was this change tested:\nrevise and add applicable unit tests\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-03-26T17:45:54Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140", "merged": true, "mergeCommit": {"oid": "1f1808f9175d3b22169286e4c309d6a628d7490f"}, "closed": true, "closedAt": "2020-03-30T19:07:57Z", "author": {"login": "wikimonkey"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRgIyGgFqTM4MjI3NjMyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSzNeqAFqTM4NDE0MTI0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjc2MzIw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-382276320", "createdAt": "2020-03-26T18:05:47Z", "commit": {"oid": "dec23e7d1348de3166ce8060ee526cc4d0fdb6c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODowNTo0N1rOF8Ty1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODowNTo0N1rOF8Ty1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4MzE4OQ==", "bodyText": "It will be good to demonstrate platform specific artifacts as well as part of the tests", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#discussion_r398783189", "createdAt": "2020-03-26T18:05:47Z", "author": {"login": "shaguptashaikh"}, "path": "src/test/resources/com/aws/iot/evergreen/packagemanager/test_packages/MonitoringService-1.0.0/recipe.yaml", "diffHunk": "@@ -9,20 +9,26 @@ Parameters:\n     value: TestVal\n     type: String\n Lifecycle:\n-  install:\n-    all:\n+  all:\n+    install:\n       skipif: onpath git\n       script: sudo apt-get install git\n-    debian:\n+  debian:\n+    install:\n       skipif: onpath git\n       script: sudo apt-get install git\n-    macos:\n+  macos:\n+    install:\n       skipif: onpath git\n       script: brew install git\n+    run: git status\n Artifacts:\n   - %s/MonitoringService-1.0.0/monitor_artifact_100.txt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec23e7d1348de3166ce8060ee526cc4d0fdb6c8"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjgyNjk3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-382282697", "createdAt": "2020-03-26T18:12:42Z", "commit": {"oid": "dec23e7d1348de3166ce8060ee526cc4d0fdb6c8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoxMjo0MlrOF8UIcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxODoxNjozNFrOF8UR8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4ODcyMQ==", "bodyText": "Nit -Serializer feels like too broad a name, when the scope of this is limited to YAML/Json. Also currently this class seems to be functioning more as a factory than a serializer/deserializer.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#discussion_r398788721", "createdAt": "2020-03-26T18:12:42Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/util/Serializer.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.aws.iot.evergreen.util;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.databind.MapperFeature;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+\n+public final class Serializer {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec23e7d1348de3166ce8060ee526cc4d0fdb6c8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5MTE1NQ==", "bodyText": "Since we've put this class as a common, is the intention so that any EG code can use it? In that case anyone trying to use this will be blocked until acquiring a lock, is that acceptable?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#discussion_r398791155", "createdAt": "2020-03-26T18:16:34Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/util/Serializer.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.aws.iot.evergreen.util;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.databind.MapperFeature;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+\n+public final class Serializer {\n+    private static final ObjectMapper OBJECT_MAPPER = new ObjectMapper(new YAMLFactory());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec23e7d1348de3166ce8060ee526cc4d0fdb6c8"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDcyMDIz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-382472023", "createdAt": "2020-03-26T22:45:06Z", "commit": {"oid": "1ac5eeaf3b0a96f37e54a4018bae944479bd8999"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTMyNTA1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-382532505", "createdAt": "2020-03-27T01:49:17Z", "commit": {"oid": "1ac5eeaf3b0a96f37e54a4018bae944479bd8999"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTo0OToxN1rOF8gejQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMTo0OToxN1rOF8gejQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk5MDk4OQ==", "bodyText": "It's very neat but I'm concerned that we are hiding the PlatformResolver.resolve logic in a Deserializer.\nI would prefer separating the deserialization vs resolve platform.\n\nString -> RecipeDoc via deserialization.\nRecipeDoc -> Recipe via resolving platform.\n\nBut this would create one more layer of conversion and seems an overkill for now. We can see what others think.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#discussion_r398990989", "createdAt": "2020-03-27T01:49:17Z", "author": {"login": "leaf94"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/Package.java", "diffHunk": "@@ -98,4 +106,16 @@ public Package(@JsonProperty(\"RecipeTemplateVersion\") RecipeTemplateVersion reci\n     public Semver getVersion() {\n         return version;\n     }\n+\n+    private static class MapFieldDeserializer extends JsonDeserializer<Map<String, Object>> {\n+        @Override\n+        @SuppressWarnings(\"unchecked\")\n+        public Map<String, Object> deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n+                throws IOException {\n+            Map<Object, Object> map =\n+                    SerializerFactory.getRecipeSerializer().convertValue(jsonParser.readValueAsTree(), Map.class);\n+\n+            return (Map<String, Object>) PlatformResolver.resolvePlatform(map);\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac5eeaf3b0a96f37e54a4018bae944479bd8999"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTMzMjM5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-382533239", "createdAt": "2020-03-27T01:51:50Z", "commit": {"oid": "1ac5eeaf3b0a96f37e54a4018bae944479bd8999"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMDgxMTE5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-383081119", "createdAt": "2020-03-27T17:53:46Z", "commit": {"oid": "1ac5eeaf3b0a96f37e54a4018bae944479bd8999"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNzo1Mzo0NlrOF88CYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxNzo1Mzo0NlrOF88CYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ0MjUyOQ==", "bodyText": "this doesn't need to be a static block, you can set features when you create the mapper. I think it is \".with\" or \".configure\" or something like that.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#discussion_r399442529", "createdAt": "2020-03-27T17:53:46Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/util/SerializerFactory.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.aws.iot.evergreen.util;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.databind.MapperFeature;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+\n+public final class SerializerFactory {\n+    private static final ObjectMapper RECIPE_SERIALIZER = new ObjectMapper(new YAMLFactory());\n+\n+    static {\n+        RECIPE_SERIALIZER.configure(MapperFeature.ACCEPT_CASE_INSENSITIVE_PROPERTIES, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ac5eeaf3b0a96f37e54a4018bae944479bd8999"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTczNTY3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-383173567", "createdAt": "2020-03-27T20:18:59Z", "commit": {"oid": "d6b5f2ff7b6baf156e0c836d8a0e096e77c8fd4e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTk4OTMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-383198932", "createdAt": "2020-03-27T21:04:53Z", "commit": {"oid": "d6b5f2ff7b6baf156e0c836d8a0e096e77c8fd4e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6b5f2ff7b6baf156e0c836d8a0e096e77c8fd4e", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d6b5f2ff7b6baf156e0c836d8a0e096e77c8fd4e", "committedDate": "2020-03-27T19:47:09Z", "message": "change per comments"}, "afterCommit": {"oid": "69fd5762867ae4c152f9bac594a18150c6310ca0", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/69fd5762867ae4c152f9bac594a18150c6310ca0", "committedDate": "2020-03-27T22:43:09Z", "message": "change per comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69fd5762867ae4c152f9bac594a18150c6310ca0", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/69fd5762867ae4c152f9bac594a18150c6310ca0", "committedDate": "2020-03-27T22:43:09Z", "message": "change per comments"}, "afterCommit": {"oid": "5fd6bba809a1eaec66c7948f99e5938c04238938", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5fd6bba809a1eaec66c7948f99e5938c04238938", "committedDate": "2020-03-29T05:42:45Z", "message": "change per comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a83f0fd14792b15c8f6d1fa12320dde0350ea5f", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3a83f0fd14792b15c8f6d1fa12320dde0350ea5f", "committedDate": "2020-03-30T18:12:50Z", "message": "support platform in lifecycle of recipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac43197adebbe081e09e89fe420b3fde32475eae", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ac43197adebbe081e09e89fe420b3fde32475eae", "committedDate": "2020-03-30T18:12:50Z", "message": "rename serializer factory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a88f0f618109ec83e8cb0cab19575f61ce029ef", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2a88f0f618109ec83e8cb0cab19575f61ce029ef", "committedDate": "2020-03-30T18:12:50Z", "message": "change per comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eb83dd3605fd5b4e3a6b306524cf9fda0cc6e93", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5eb83dd3605fd5b4e3a6b306524cf9fda0cc6e93", "committedDate": "2020-03-30T18:12:50Z", "message": "fix a few PMD violations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a87c5965e10a11a900be119e5817f0666783cdb", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4a87c5965e10a11a900be119e5817f0666783cdb", "committedDate": "2020-03-30T17:05:35Z", "message": "fix a few PMD violations"}, "afterCommit": {"oid": "5eb83dd3605fd5b4e3a6b306524cf9fda0cc6e93", "author": {"user": {"login": "wikimonkey", "name": "Jason Wang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5eb83dd3605fd5b4e3a6b306524cf9fda0cc6e93", "committedDate": "2020-03-30T18:12:50Z", "message": "fix a few PMD violations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTMxODMw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-384131830", "createdAt": "2020-03-30T18:43:52Z", "commit": {"oid": "5eb83dd3605fd5b4e3a6b306524cf9fda0cc6e93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTQxMjQw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/140#pullrequestreview-384141240", "createdAt": "2020-03-30T18:56:36Z", "commit": {"oid": "5eb83dd3605fd5b4e3a6b306524cf9fda0cc6e93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2387, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}