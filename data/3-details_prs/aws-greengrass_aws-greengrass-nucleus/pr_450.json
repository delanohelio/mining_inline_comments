{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MTA3MTAy", "number": 450, "title": "Improve integ tests", "bodyText": "Issue #, if available:\nReduce the integ test run time by couple of minutes.\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-18T06:29:26Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450", "merged": true, "mergeCommit": {"oid": "6436aa399cfb85e1cb5395e8756321abace050d1"}, "closed": true, "closedAt": "2020-09-18T19:43:23Z", "author": {"login": "fahadmohammed01"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ2Sg7gH2gAyNDg5MTA3MTAyOmEyZDMzYzE3NmYzNDQ2NjY2ZmI0ZTQ4MTJjNWI1NmI3NDg3ZWNkOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKK9gzgFqTQ5MTczNjM1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2d33c176f3446666fb4e4812c5b56b7487ecd95", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a2d33c176f3446666fb4e4812c5b56b7487ecd95", "committedDate": "2020-09-17T19:37:39Z", "message": "updated unit and integ tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5062b1ec0693dc281d0de624c5ad5a07647f90b", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e5062b1ec0693dc281d0de624c5ad5a07647f90b", "committedDate": "2020-09-17T21:50:43Z", "message": "addressed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14331561d6f0c3400e3d10639e15f3905cdea652", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/14331561d6f0c3400e3d10639e15f3905cdea652", "committedDate": "2020-09-18T06:28:48Z", "message": "reduce integ test run time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dd65be2138e94666f4f72b9f17af86c3218d318", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7dd65be2138e94666f4f72b9f17af86c3218d318", "committedDate": "2020-09-18T06:31:13Z", "message": "Merge branch 'master' into improve-integ-tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTkzMTU0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#pullrequestreview-491193154", "createdAt": "2020-09-18T06:50:00Z", "commit": {"oid": "7dd65be2138e94666f4f72b9f17af86c3218d318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNjo1MDowMFrOHUAQKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNjo1MDowMFrOHUAQKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczNzcwNw==", "bodyText": "ordering is highly suspect to me.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#discussion_r490737707", "createdAt": "2020-09-18T06:50:00Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/ipc/IPCCliTest.java", "diffHunk": "@@ -84,6 +92,7 @@\n import static org.junit.jupiter.api.Assertions.fail;\n \n @ExtendWith(EGExtension.class)\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dd65be2138e94666f4f72b9f17af86c3218d318"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTkzNzU2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#pullrequestreview-491193756", "createdAt": "2020-09-18T06:51:16Z", "commit": {"oid": "7dd65be2138e94666f4f72b9f17af86c3218d318"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNjo1MToxNlrOHUASDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNjo1MToxNlrOHUASDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczODE4OQ==", "bodyText": "set the root dir in the beforeall now. Otherwise it will use ~/.evergreen.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#discussion_r490738189", "createdAt": "2020-09-18T06:51:16Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/ipc/IPCServicesTest.java", "diffHunk": "@@ -60,23 +62,31 @@\n     @TempDir\n     static Path tempRootDir;\n \n-    private Kernel kernel;\n+    private static Kernel kernel;\n     private IPCClient client;\n \n+    @BeforeAll\n+    static void beforeAll() throws InterruptedException {\n+        kernel = prepareKernelFromConfigFile(\"ipc.yaml\", IPCServicesTest.class, TEST_SERVICE_NAME);\n+    }\n+\n+    @AfterAll\n+    static void afterAll() {\n+        kernel.shutdown();\n+    }\n+\n     @BeforeEach\n-    void beforeEach(ExtensionContext context) throws InterruptedException, IOException {\n+    void beforeEach(ExtensionContext context) throws InterruptedException {\n         System.setProperty(\"root\", tempRootDir.toAbsolutePath().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dd65be2138e94666f4f72b9f17af86c3218d318"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67465fe9d9043fffcce9858168915cbc2e3c011a", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/67465fe9d9043fffcce9858168915cbc2e3c011a", "committedDate": "2020-09-18T07:16:06Z", "message": "addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjU1NDI5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#pullrequestreview-491655429", "createdAt": "2020-09-18T17:30:34Z", "commit": {"oid": "67465fe9d9043fffcce9858168915cbc2e3c011a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNzozMDozNVrOHUV6xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNzozNDoxMFrOHUWBqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA5MjY3Nw==", "bodyText": "nit: why not change LOCAL_DEPLOYMENT_TIMEOUT_MINUTES and SERVICE_STATE_CHECK_TIMEOUT_MINUTES to 15?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#discussion_r491092677", "createdAt": "2020-09-18T17:30:35Z", "author": {"login": "hui-yang"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/ipc/IPCCliTest.java", "diffHunk": "@@ -336,8 +337,8 @@ public void GIVEN_kernel_running_WHEN_change_configuration_and_deployment_THEN_k\n         String deploymentId1 = deploymentResponse.getDeploymentId();\n         CountDownLatch deploymentLatch = waitForDeploymentToBeSuccessful(deploymentId1);\n \n-        assertTrue(deploymentLatch.await(LOCAL_DEPLOYMENT_TIMEOUT_MINUTES, TimeUnit.MINUTES));\n-        assertTrue(serviceLatch.await(SERVICE_STATE_CHECK_TIMEOUT_MINUTES, TimeUnit.MINUTES));\n+        assertTrue(deploymentLatch.await(15, TimeUnit.SECONDS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67465fe9d9043fffcce9858168915cbc2e3c011a"}, "originalPosition": 227}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA5NDQ0MQ==", "bodyText": "Does this test need to verify A restarts, based on the test name?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#discussion_r491094441", "createdAt": "2020-09-18T17:34:10Z", "author": {"login": "hui-yang"}, "path": "src/test/java/com/aws/iot/evergreen/kernel/EvergreenServiceTest.java", "diffHunk": "@@ -118,11 +116,5 @@ void GIVEN_service_WHEN_dependencies_change_THEN_service_restarts() {\n         assertEquals(aService.dependencies.size(), 3);\n         assertNull(aService.dependencies.get(dService));\n         assertNotNull(aService.dependencies.get(eService));\n-\n-        aService.getState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67465fe9d9043fffcce9858168915cbc2e3c011a"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeb76b873a16f2ecc181d56f0f1f1b5f1cee083b", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/eeb76b873a16f2ecc181d56f0f1f1b5f1cee083b", "committedDate": "2020-09-18T18:49:14Z", "message": "minor refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzA4NDgy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#pullrequestreview-491708482", "createdAt": "2020-09-18T18:54:29Z", "commit": {"oid": "eeb76b873a16f2ecc181d56f0f1f1b5f1cee083b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzI4NTM5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#pullrequestreview-491728539", "createdAt": "2020-09-18T19:28:18Z", "commit": {"oid": "eeb76b873a16f2ecc181d56f0f1f1b5f1cee083b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToyODoxOFrOHUZYPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToyODoxOFrOHUZYPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0OTM3NA==", "bodyText": "Should the name be ...THEN_service_updates()?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#discussion_r491149374", "createdAt": "2020-09-18T19:28:18Z", "author": {"login": "shaguptashaikh"}, "path": "src/test/java/com/aws/iot/evergreen/kernel/EvergreenServiceTest.java", "diffHunk": "@@ -104,10 +102,10 @@ void GIVEN_a_config_WHEN_constructor_is_called_THEN_service_is_initialized() {\n     }\n \n     @Test\n-    void GIVEN_service_WHEN_dependencies_change_THEN_service_restarts() {\n+    void GIVEN_service_WHEN_dependencies_change_THEN_service_dependencies_updates() {\n         //GIVEN service A with dependencies B,C,D", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eeb76b873a16f2ecc181d56f0f1f1b5f1cee083b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzM2MzU4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/450#pullrequestreview-491736358", "createdAt": "2020-09-18T19:42:43Z", "commit": {"oid": "eeb76b873a16f2ecc181d56f0f1f1b5f1cee083b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2977, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}