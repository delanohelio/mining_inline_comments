{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NjE2OTgz", "number": 668, "title": "Make sure not to remove the configuration from builtin services", "bodyText": "Issue #, if available:\nDescription of changes:\nWithout this change the configuration of builtin services is being removed during a deployment since they aren't present in the \"new config\". This change simply sets the mode to be merge for all the builtins, so that they won't get removed.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-12T04:47:27Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/668", "merged": true, "mergeCommit": {"oid": "20eb7984c246c223ae4a8221532efc8543ad5eb1"}, "closed": true, "closedAt": "2020-11-12T06:33:31Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbrRU5ABqjM5ODY4MDI2ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbsSxXgFqTUyODc3Mzc0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de44066610061424d155ef9598102f9c59c453e4", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/de44066610061424d155ef9598102f9c59c453e4", "committedDate": "2020-11-12T04:40:32Z", "message": "Make sure not to remove the configuration from builtin services"}, "afterCommit": {"oid": "a324a4c4aea3505a3980ec98f303155b56c9d2b4", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a324a4c4aea3505a3980ec98f303155b56c9d2b4", "committedDate": "2020-11-12T04:57:54Z", "message": "Make sure not to remove the configuration from builtin services"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a324a4c4aea3505a3980ec98f303155b56c9d2b4", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a324a4c4aea3505a3980ec98f303155b56c9d2b4", "committedDate": "2020-11-12T04:57:54Z", "message": "Make sure not to remove the configuration from builtin services"}, "afterCommit": {"oid": "f1fc0f1182e342644e3bb5bb6dc0a8e177d66e9c", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f1fc0f1182e342644e3bb5bb6dc0a8e177d66e9c", "committedDate": "2020-11-12T05:06:56Z", "message": "Make sure not to remove the configuration from builtin services"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1fc0f1182e342644e3bb5bb6dc0a8e177d66e9c", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f1fc0f1182e342644e3bb5bb6dc0a8e177d66e9c", "committedDate": "2020-11-12T05:06:56Z", "message": "Make sure not to remove the configuration from builtin services"}, "afterCommit": {"oid": "37aff97c9bd60321aa13321f15b6612a4c36c6f9", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/37aff97c9bd60321aa13321f15b6612a4c36c6f9", "committedDate": "2020-11-12T05:19:31Z", "message": "Make sure not to remove the configuration from builtin services"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzU5NDcw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/668#pullrequestreview-528759470", "createdAt": "2020-11-12T05:27:58Z", "commit": {"oid": "37aff97c9bd60321aa13321f15b6612a4c36c6f9"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzY1NTU0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/668#pullrequestreview-528765554", "createdAt": "2020-11-12T05:46:17Z", "commit": {"oid": "37aff97c9bd60321aa13321f15b6612a4c36c6f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTo0NjoxN1rOHxra0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTo0NjoxN1rOHxra0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg1MzY0OQ==", "bodyText": "Is this always correct? What if the customers want to reset a configuration of a built-in service?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/668#discussion_r521853649", "createdAt": "2020-11-12T05:46:17Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/greengrass/deployment/activator/DefaultActivator.java", "diffHunk": "@@ -199,6 +199,13 @@ private UpdateBehaviorTree createDeploymentMergeBehavior(long deploymentTimestam\n         servicesMergeBehavior.getChildOverride().put(UpdateBehaviorTree.WILDCARD, insideServiceMergeBehavior);\n         servicesMergeBehavior.getChildOverride().put(AUTHENTICATION_TOKEN_LOOKUP_KEY,\n                 new UpdateBehaviorTree(UpdateBehaviorTree.UpdateBehavior.MERGE, now));\n+\n+        // Set merge mode for all builtin services\n+        kernel.orderedDependencies().stream()\n+                .filter(GreengrassService::isBuiltin)\n+                .forEach(s -> servicesMergeBehavior.getChildOverride()\n+                        .put(s.getServiceName(), new UpdateBehaviorTree(UpdateBehaviorTree.UpdateBehavior.MERGE, now)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37aff97c9bd60321aa13321f15b6612a4c36c6f9"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34bedd630c6a17650371dc94cd5b7fdd002bf610", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/34bedd630c6a17650371dc94cd5b7fdd002bf610", "committedDate": "2020-11-12T06:04:02Z", "message": "Make sure not to remove the configuration from builtin services"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37aff97c9bd60321aa13321f15b6612a4c36c6f9", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/37aff97c9bd60321aa13321f15b6612a4c36c6f9", "committedDate": "2020-11-12T05:19:31Z", "message": "Make sure not to remove the configuration from builtin services"}, "afterCommit": {"oid": "34bedd630c6a17650371dc94cd5b7fdd002bf610", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/34bedd630c6a17650371dc94cd5b7fdd002bf610", "committedDate": "2020-11-12T06:04:02Z", "message": "Make sure not to remove the configuration from builtin services"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzczNTQ4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/668#pullrequestreview-528773548", "createdAt": "2020-11-12T06:08:59Z", "commit": {"oid": "34bedd630c6a17650371dc94cd5b7fdd002bf610"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzczNzQ5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/668#pullrequestreview-528773749", "createdAt": "2020-11-12T06:09:31Z", "commit": {"oid": "34bedd630c6a17650371dc94cd5b7fdd002bf610"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2655, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}