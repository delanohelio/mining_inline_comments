{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4ODk5NjI0", "number": 274, "title": "Update all E2E tests to integrate with CMS", "bodyText": "Issue #, if available:\nDescription of changes:\n\nUpdate E2E tests to publish required components first\nUpdate E2E test recipes and consolidate to one directory\nExpose some APIs in GreengrassPackageServiceHelper and PackageStore\n\nWhy is this change necessary:\nHow was this change tested:\nE2E tests.\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-06-06T01:19:10Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274", "merged": true, "mergeCommit": {"oid": "9c3b645428a0698efbc65522692c47afd8dc6118"}, "closed": true, "closedAt": "2020-06-10T21:17:48Z", "author": {"login": "hui-yang"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoeIR_gFqTQyNTcwNjczMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqAXb7AFqTQyODQzNDM0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzA2NzMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-425706732", "createdAt": "2020-06-06T02:41:09Z", "commit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwMjo0MToxMFrOGgBYmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwMjo0ODoyN1rOGgBadw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDI5Ng==", "bodyText": "should this be beforeall instead of beforeeach? Doesn't really seem necessary to upload for every test (even though it won't actually upload because it will already exist)", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230296", "createdAt": "2020-06-06T02:41:10Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/deployment/DeploymentE2ETest.java", "diffHunk": "@@ -56,17 +52,21 @@ void afterEach() {\n         cleanup();\n     }\n \n-    private void launchKernel(String configFile) throws IOException, InterruptedException {\n-        kernel = new Kernel()\n-                .parseArgs(\"-i\", DeploymentE2ETest.class.getResource(configFile).toString(), \"-r\", tempRootDir\n-                        .toAbsolutePath().toString());\n-\n-        deviceProvisioningHelper.updateKernelConfigWithIotConfiguration(kernel, thingInfo, BETA_REGION.toString());\n+    @BeforeEach\n+    void launchKernel() throws Exception {\n+        initKernel();\n         kernel.launch();\n \n-        Path localStoreContentPath = Paths.get(DeploymentE2ETest.class.getResource(\"local_store_content\").getPath());\n-        // pre-load contents to package store\n-        FileUtils.copyFolderRecursively(localStoreContentPath, kernel.getPackageStorePath());\n+        uploadTestComponentsToCms(true, new PackageIdentifier(\"CustomerApp\", new Semver(\"1.0.0\")),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDMzMQ==", "bodyText": "same here.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230331", "createdAt": "2020-06-06T02:41:59Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/deployment/MultipleDeploymentsTest.java", "diffHunk": "@@ -44,19 +42,18 @@\n @ExtendWith(EGExtension.class)\n @Tag(\"E2E\")\n class MultipleDeploymentsTest extends BaseE2ETestCase {\n-    private Kernel kernel;\n \n     @BeforeEach\n-    void beforeEach() throws IOException {\n-        kernel = new Kernel().parseArgs(\"-i\", MultipleDeploymentsTest.class.getResource(\"blank_config.yaml\")\n-                .toString(), \"-r\", tempRootDir.toAbsolutePath().toString());\n-\n-        deviceProvisioningHelper.updateKernelConfigWithIotConfiguration(kernel, thingInfo, BETA_REGION.toString());\n-\n-        Path localStoreContentPath = Paths\n-                .get(MultipleDeploymentsTest.class.getResource(\"local_store_content\").getPath());\n-        // pre-load contents to package store\n-        FileUtils.copyFolderRecursively(localStoreContentPath, kernel.getPackageStorePath());\n+    void beforeEach() throws Exception {\n+        initKernel();\n+\n+        uploadTestComponentsToCms(true, new PackageIdentifier(\"CustomerApp\", new Semver(\"1.0.0\")),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDM2Mg==", "bodyText": "Also, should we be deleting the packages when the test completes?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230362", "createdAt": "2020-06-06T02:42:25Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/deployment/MultipleDeploymentsTest.java", "diffHunk": "@@ -44,19 +42,18 @@\n @ExtendWith(EGExtension.class)\n @Tag(\"E2E\")\n class MultipleDeploymentsTest extends BaseE2ETestCase {\n-    private Kernel kernel;\n \n     @BeforeEach\n-    void beforeEach() throws IOException {\n-        kernel = new Kernel().parseArgs(\"-i\", MultipleDeploymentsTest.class.getResource(\"blank_config.yaml\")\n-                .toString(), \"-r\", tempRootDir.toAbsolutePath().toString());\n-\n-        deviceProvisioningHelper.updateKernelConfigWithIotConfiguration(kernel, thingInfo, BETA_REGION.toString());\n-\n-        Path localStoreContentPath = Paths\n-                .get(MultipleDeploymentsTest.class.getResource(\"local_store_content\").getPath());\n-        // pre-load contents to package store\n-        FileUtils.copyFolderRecursively(localStoreContentPath, kernel.getPackageStorePath());\n+    void beforeEach() throws Exception {\n+        initKernel();\n+\n+        uploadTestComponentsToCms(true, new PackageIdentifier(\"CustomerApp\", new Semver(\"1.0.0\")),\n+                new PackageIdentifier(\"CustomerApp\", new Semver(\"0.9.0\")),\n+                new PackageIdentifier(\"CustomerApp\", new Semver(\"0.9.1\")),\n+                new PackageIdentifier(\"SomeService\", new Semver(\"1.0.0\")),\n+                new PackageIdentifier(\"GreenSignal\", new Semver(\"1.0.0\")),\n+                new PackageIdentifier(\"Mosquitto\", new Semver(\"1.0.0\")),\n+                new PackageIdentifier(\"Mosquitto\", new Semver(\"0.9.0\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDM4Mw==", "bodyText": "remove the todo", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230383", "createdAt": "2020-06-06T02:42:48Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/packagemanager/PackageManagerE2ETest.java", "diffHunk": "@@ -47,77 +44,32 @@\n @Tag(\"E2E\")\n class PackageManagerE2ETest extends BaseE2ETestCase {\n \n-    // Based on PackageManager.java\n-    private static final String RECIPE_DIRECTORY = \"recipes\";\n-    private static final String ARTIFACT_DIRECTORY = \"artifacts\";\n-\n     private static PackageManager packageManager;\n     private static DependencyResolver dependencyResolver;\n     private static Path packageStorePath;\n     private static AWSGreengrassComponentManagement cmsClient;\n \n-    private static Kernel kernel;\n-\n-    @TempDir\n-    static Path rootDir;\n-\n     @BeforeEach\n-    void setupKernel() throws IOException {\n-        System.setProperty(\"root\", rootDir.toAbsolutePath().toString());\n-        kernel = new Kernel();\n-        kernel.parseArgs(\"-i\", PackageManagerE2ETest.class.getResource(\"onlyMain.yaml\").toString());\n-        deviceProvisioningHelper.updateKernelConfigWithIotConfiguration(kernel, thingInfo, BETA_REGION.toString());\n-\n+    void setupKernel() throws Exception {\n         // The integration test will pick up credentials from the default provider chain\n         // In automated testing, the device environment should ideally have credentials for all tests\n         // For dev work, this requires you to have a working set of AWS Credentials on your dev box and/or your IDE\n         // environment\n-\n+        initKernel();\n         kernel.launch();\n \n-        Path localStoreContentPath = Paths.get(PackageManagerE2ETest.class.getResource(\"local_store_content\").getPath());\n-        // pre-load contents to package store\n-        FileUtils.copyFolderRecursively(localStoreContentPath, kernel.getPackageStorePath());\n-\n         // get required instances from context\n         packageManager = kernel.getContext().get(PackageManager.class);\n         dependencyResolver = kernel.getContext().get(DependencyResolver.class);\n         packageStorePath = kernel.getPackageStorePath();\n-\n         cmsClient = kernel.getContext().get(GreengrassPackageServiceClientFactory.class).getCmsClient();\n \n         // TODO: Ideally integ test should clean up after itself. Unfortunately the delete API is not implemented", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDUyNA==", "bodyText": "Can you change the string to be \"implementers\" since that is the proper spelling anyway?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230524", "createdAt": "2020-06-06T02:44:55Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -55,6 +55,8 @@\n  */\n public class Kernel {\n     private static final Logger logger = LogManager.getLogger(Kernel.class);\n+\n+    protected static final String CONTEXT_SERVICE_IMPLEMENTERS = \"service-implementors\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDY3MA==", "bodyText": "doesn't this request need to include the platforms too? Or is is just the recipe only?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230670", "createdAt": "2020-06-06T02:46:48Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/GreengrassPackageServiceHelper.java", "diffHunk": "@@ -97,4 +109,78 @@ PackageRecipe downloadPackageRecipe(PackageIdentifier packageIdentifier)\n             throw new PackageLoadingException(errorMsg, e);\n         }\n     }\n+\n+    /**\n+     * Create a component with the given recipe file.\n+     *\n+     * @param recipeFilePath the path to the component recipe file\n+     * @return {@Link CreateComponentResult}\n+     * @throws IOException if file reading fails\n+     */\n+    public CreateComponentResult createComponent(Path recipeFilePath) throws IOException {\n+        ByteBuffer recipeBuf = ByteBuffer.wrap(Files.readAllBytes(recipeFilePath));\n+\n+        CreateComponentRequest createComponentRequest = new CreateComponentRequest().withRecipe(recipeBuf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDcyMQ==", "bodyText": "move this inside the try, then you don't need to pre-declare length.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230721", "createdAt": "2020-06-06T02:47:38Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/GreengrassPackageServiceHelper.java", "diffHunk": "@@ -97,4 +109,78 @@ PackageRecipe downloadPackageRecipe(PackageIdentifier packageIdentifier)\n             throw new PackageLoadingException(errorMsg, e);\n         }\n     }\n+\n+    /**\n+     * Create a component with the given recipe file.\n+     *\n+     * @param recipeFilePath the path to the component recipe file\n+     * @return {@Link CreateComponentResult}\n+     * @throws IOException if file reading fails\n+     */\n+    public CreateComponentResult createComponent(Path recipeFilePath) throws IOException {\n+        ByteBuffer recipeBuf = ByteBuffer.wrap(Files.readAllBytes(recipeFilePath));\n+\n+        CreateComponentRequest createComponentRequest = new CreateComponentRequest().withRecipe(recipeBuf);\n+        logger.atDebug(\"create-component\").kv(\"request\", createComponentRequest).log();\n+        CreateComponentResult createComponentResult = evgCmsClient.createComponent(createComponentRequest);\n+        logger.atDebug(\"create-component\").kv(\"result\", createComponentResult).log();\n+        return createComponentResult;\n+    }\n+\n+    /**\n+     * Upload component artifacts for the specified component.\n+     *\n+     * @param artifact artifact file\n+     * @param componentName name of the component that requires the artifact\n+     * @param componentVersion version of the component that requires the artifact\n+     * @throws IOException if file upload fails\n+     */\n+    public void uploadComponentArtifact(File artifact, String componentName, String componentVersion)\n+            throws IOException {\n+        if (skipComponentArtifactUpload(artifact)) {\n+            logger.atDebug(\"upload-component-artifact\").kv(\"filePath\",  artifact.getAbsolutePath())\n+                    .log(\"Skip artifact upload. Not a regular file\");\n+            return;\n+        }\n+        logger.atDebug(\"upload-component-artifact\").kv(\"artifactName\", artifact.getName())\n+                .kv(\"filePath\", artifact.getAbsolutePath()).log();\n+        CreateComponentArtifactUploadUrlRequest artifactUploadUrlRequest = new CreateComponentArtifactUploadUrlRequest()\n+                .withComponentName(componentName).withComponentVersion(componentVersion)\n+                .withArtifactName(artifact.getName());\n+        CreateComponentArtifactUploadUrlResult artifactUploadUrlResult = evgCmsClient\n+                .createComponentArtifactUploadUrl(artifactUploadUrlRequest);\n+\n+        URL s3PreSignedURL = new URL(artifactUploadUrlResult.getUrl());\n+        HttpURLConnection connection = (HttpURLConnection) s3PreSignedURL.openConnection();\n+        connection.setDoOutput(true);\n+        connection.setRequestMethod(\"PUT\");\n+        connection.connect();\n+\n+        long length;\n+        try (BufferedOutputStream bos = new BufferedOutputStream(connection.getOutputStream())) {\n+            length = Files.copy(artifact.toPath(), bos);\n+        }\n+        logger.atDebug(\"upload-component-artifact\").kv(\"artifactName\", artifact.getName())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIzMDc3NQ==", "bodyText": "why are you wrapping this with a list? It already is a list.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r436230775", "createdAt": "2020-06-06T02:48:27Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/PackageManager.java", "diffHunk": "@@ -90,8 +91,8 @@ public PackageManager(GreengrassRepositoryDownloader greengrassArtifactDownloade\n                 findActiveAndSatisfiedPackageMetadata(packageName, versionRequirement);\n \n         // 2. list available packages locally\n-        List<PackageMetadata> packageMetadataList =\n-                packageStore.listAvailablePackageMetadata(packageName, versionRequirement);\n+        List<PackageMetadata> packageMetadataList = new ArrayList<>(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74a9e6962d43dac6d1952172304f462d4661092d", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/74a9e6962d43dac6d1952172304f462d4661092d", "committedDate": "2020-06-08T19:11:53Z", "message": "Update all E2E tests to integrate with CMS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "558a6db28166bbf5af5a277de0870d7b6b317eb4", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/558a6db28166bbf5af5a277de0870d7b6b317eb4", "committedDate": "2020-06-08T19:11:53Z", "message": "Upload test commponents in beforeAll"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "794ba8cf63909560f5704e29571c0f8e0d58c6e0", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/794ba8cf63909560f5704e29571c0f8e0d58c6e0", "committedDate": "2020-06-06T01:12:33Z", "message": "Update all E2E tests to integrate with CMS"}, "afterCommit": {"oid": "558a6db28166bbf5af5a277de0870d7b6b317eb4", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/558a6db28166bbf5af5a277de0870d7b6b317eb4", "committedDate": "2020-06-08T19:11:53Z", "message": "Upload test commponents in beforeAll"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjAxOTE1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-426601915", "createdAt": "2020-06-08T20:37:14Z", "commit": {"oid": "558a6db28166bbf5af5a277de0870d7b6b317eb4"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca50bf42c5b998c3cbea36127888e0f938972d5f", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ca50bf42c5b998c3cbea36127888e0f938972d5f", "committedDate": "2020-06-09T18:20:34Z", "message": "Merge branch 'master' into cms-e2e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dee086328b686074b8c9961fb043bc8bdc5b0ef", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5dee086328b686074b8c9961fb043bc8bdc5b0ef", "committedDate": "2020-06-09T21:39:36Z", "message": "Merge branch 'master' into cms-e2e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjEyNDQw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-427612440", "createdAt": "2020-06-09T23:26:53Z", "commit": {"oid": "5dee086328b686074b8c9961fb043bc8bdc5b0ef"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMzoyNjo1M1rOGhfxmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMzoyNjo1M1rOGhfxmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3Njc5NQ==", "bodyText": "Nit - While this helps us consolidate all interactions with component management service behind a facade, I would prefer if code that is only used by tests stays in test utils, it will prevent any misunderstandings, and we will be able to only package what we really want to ship as part of the executables. When we eventually move E2E tests out of the current repository, we will need to remember to clean this up", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r437776795", "createdAt": "2020-06-09T23:26:53Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/GreengrassPackageServiceHelper.java", "diffHunk": "@@ -97,4 +111,100 @@ PackageRecipe downloadPackageRecipe(PackageIdentifier packageIdentifier)\n             throw new PackageLoadingException(errorMsg, e);\n         }\n     }\n+\n+    /**\n+     * Create a component with the given recipe file.\n+     *\n+     * @param cmsClient client of Component Management Service\n+     * @param recipeFilePath the path to the component recipe file\n+     * @return {@Link CreateComponentResult}\n+     * @throws IOException if file reading fails\n+     */\n+    public static CreateComponentResult createComponent(AWSGreengrassComponentManagement cmsClient,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dee086328b686074b8c9961fb043bc8bdc5b0ef"}, "originalPosition": 79}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4541a0ca064c41bc3348cd063276aafadc8ee254", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4541a0ca064c41bc3348cd063276aafadc8ee254", "committedDate": "2020-06-10T01:55:21Z", "message": "Increase unit test coverage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjYyNzMw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-427662730", "createdAt": "2020-06-10T02:08:20Z", "commit": {"oid": "4541a0ca064c41bc3348cd063276aafadc8ee254"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjkzNTM3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-427693537", "createdAt": "2020-06-10T03:56:46Z", "commit": {"oid": "4541a0ca064c41bc3348cd063276aafadc8ee254"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMzo1Njo0NlrOGhj_Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMzo1Njo0NlrOGhj_Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg0NTc4Nw==", "bodyText": "Let's add a SIM for this. We really need a lot more tests here. And, by \"this\" I mean the package manager.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r437845787", "createdAt": "2020-06-10T03:56:46Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/packagemanager/PackageManagerE2ETest.java", "diffHunk": "@@ -27,110 +21,46 @@\n import org.junit.jupiter.api.Tag;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.ExtendWith;\n-import org.junit.jupiter.api.io.TempDir;\n \n-import java.io.IOException;\n import java.nio.file.Path;\n-import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n import java.util.concurrent.Future;\n import java.util.concurrent.TimeUnit;\n \n+import static com.aws.iot.evergreen.packagemanager.PackageStore.ARTIFACT_DIRECTORY;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4541a0ca064c41bc3348cd063276aafadc8ee254"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Mjk5NjAx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-428299601", "createdAt": "2020-06-10T17:57:18Z", "commit": {"oid": "4541a0ca064c41bc3348cd063276aafadc8ee254"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69b11a7ad9a2060ea511190173bdd0223512d19d", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/69b11a7ad9a2060ea511190173bdd0223512d19d", "committedDate": "2020-06-10T19:10:05Z", "message": "Add more unit tests for CMS service calls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Mzg0NzEy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-428384712", "createdAt": "2020-06-10T20:00:19Z", "commit": {"oid": "69b11a7ad9a2060ea511190173bdd0223512d19d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDowMDoyMFrOGiET0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMDowMDoyMFrOGiET0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM3NTM3OA==", "bodyText": "can you remove the duplicate from L43 now?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r438375378", "createdAt": "2020-06-10T20:00:20Z", "author": {"login": "MikeDombo"}, "path": ".github/workflows/maven.yml", "diffHunk": "@@ -32,6 +32,12 @@ jobs:\n         with:\n           name: Failed Test Report\n           path: target/surefire-reports\n+      - name: Upload Test Coverage Report\n+        uses: actions/upload-artifact@v1.0.0\n+        if: failure()\n+        with:\n+          name: Test Coverage Report\n+          path: target/jacoco-report", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b11a7ad9a2060ea511190173bdd0223512d19d"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDAwODQ5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-428400849", "createdAt": "2020-06-10T20:24:54Z", "commit": {"oid": "69b11a7ad9a2060ea511190173bdd0223512d19d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43d529b72a565bfc93f6007904701a714489c566", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/43d529b72a565bfc93f6007904701a714489c566", "committedDate": "2020-06-10T20:29:00Z", "message": "Update github step to upload Coverage Report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDI0OTkz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-428424993", "createdAt": "2020-06-10T21:01:11Z", "commit": {"oid": "43d529b72a565bfc93f6007904701a714489c566"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTowMToxMlrOGiGLKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQyMTowMToxMlrOGiGLKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQwNTkyOA==", "bodyText": "are you sure the continue on error is wanted?\nif: always() makes sense, but I'm not sure about this one because it will continue to run the subsequent tasks.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#discussion_r438405928", "createdAt": "2020-06-10T21:01:12Z", "author": {"login": "MikeDombo"}, "path": ".github/workflows/maven.yml", "diffHunk": "@@ -36,6 +36,8 @@ jobs:\n         run: python3 .github/scripts/cover2cover.py target/jacoco-report/jacoco.xml src/main/java > target/jacoco-report/cobertura.xml\n       - name: Upload Coverage\n         uses: actions/upload-artifact@v1.0.0\n+        if: always()\n+        continue-on-error: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43d529b72a565bfc93f6007904701a714489c566"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDMyMDIx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-428432021", "createdAt": "2020-06-10T21:12:42Z", "commit": {"oid": "43d529b72a565bfc93f6007904701a714489c566"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDM0MzQ0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/274#pullrequestreview-428434344", "createdAt": "2020-06-10T21:16:30Z", "commit": {"oid": "43d529b72a565bfc93f6007904701a714489c566"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2251, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}