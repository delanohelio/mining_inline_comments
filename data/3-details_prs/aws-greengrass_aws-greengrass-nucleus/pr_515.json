{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwODk2MTM2", "number": 515, "title": "Add log manager helper to get logger for a component", "bodyText": "Issue #, if available:\nDescription of changes:\nThe helper functions will create a logger based on certain logger configuration.\nIn the future, the class will also subscribe to any changes in the logger configuration (which will be retrieved from kernel config) and reconfigure all the loggers with the new configuration.\nWhy is this change necessary:\nWe need a way to split logs for some components from the main greengrass.log file.\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-10T02:49:05Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515", "merged": true, "mergeCommit": {"oid": "80fb266ebe8b1304c0e7a4c83b2b60b89fa950a4"}, "closed": true, "closedAt": "2020-10-16T17:24:53Z", "author": {"login": "nikkhilmuthye"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRBl3qgH2gAyNTAwODk2MTM2OjFmNjE5M2JmZDE2YjdhZjM2ZGE5ZGM3NDlhODVhMzFkMGRkYzRhODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTJwfBAFqTUxMDY2NDM2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f6193bfd16b7af36da9dc749a85a31d0ddc4a80", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1f6193bfd16b7af36da9dc749a85a31d0ddc4a80", "committedDate": "2020-10-10T02:45:13Z", "message": "Split out logs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99c37229161288e0f71db4394b394dad70c8a955", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/99c37229161288e0f71db4394b394dad70c8a955", "committedDate": "2020-10-10T02:50:22Z", "message": "Merge branch 'master' into splitOutLogs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzA0MDE2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-506704016", "createdAt": "2020-10-12T15:08:44Z", "commit": {"oid": "99c37229161288e0f71db4394b394dad70c8a955"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNTowODo0NFrOHgCsJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNTowOTo1OVrOHgCvJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MDU1MQ==", "bodyText": "should this be ~root/logs? or will the log config go into /logs by default?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503360551", "createdAt": "2020-10-12T15:08:44Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelCommandLine.java", "diffHunk": "@@ -123,6 +124,7 @@ private void initPaths(String rootAbsolutePath) {\n             nucleusPaths.setRootPath(Paths.get(rootAbsolutePath).toAbsolutePath());\n             //set root path for the telemetry logger\n             TelemetryConfig.getInstance().setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));\n+            LogConfig.getInstance().setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99c37229161288e0f71db4394b394dad70c8a955"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MTMxOA==", "bodyText": "when we use the logger we are normally passing the class, so have an override for the class when naming the logger", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503361318", "createdAt": "2020-10-12T15:09:59Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        // TODO: Subscribe to logging configuration in the kernel config and reconfigure all the loggers.\n+    }\n+\n+    /**\n+     * Get the logger for a particular component. The logs will be added to the a log file with the same name as the\n+     * component if the logs are configured to be written to the disk.\n+     * @param name  The name of the component\n+     * @return  a logger with configuration to log to a los file with the same name.\n+     */\n+    public com.aws.greengrass.logging.api.Logger getComponentLogger(String name) {\n+        return getComponentLogger(name, name + LOG_FILE_EXTENSION);\n+    }\n+    /**\n+     * Get the logger for a particular component. The logs will be added to the log file name provided in the method\n+     * signature if the logs are configured to be written to the disk.\n+     * @param name      The name of the component\n+     * @param fileName  The name of the log file.\n+     * @return a logger with configuration to log to a los file with the same name.\n+     */\n+    public com.aws.greengrass.logging.api.Logger getComponentLogger(String name, String fileName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99c37229161288e0f71db4394b394dad70c8a955"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "734443b86f40ef314e91a20ccddd802c1517e9dc", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/734443b86f40ef314e91a20ccddd802c1517e9dc", "committedDate": "2020-10-12T16:00:01Z", "message": "Address PR comments."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c55055fd90d1b50c5b94c0e292ab27afa199111e", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c55055fd90d1b50c5b94c0e292ab27afa199111e", "committedDate": "2020-10-12T15:52:46Z", "message": "Address PR comments."}, "afterCommit": {"oid": "734443b86f40ef314e91a20ccddd802c1517e9dc", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/734443b86f40ef314e91a20ccddd802c1517e9dc", "committedDate": "2020-10-12T16:00:01Z", "message": "Address PR comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzQzNjU4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-506743658", "createdAt": "2020-10-12T16:00:21Z", "commit": {"oid": "c55055fd90d1b50c5b94c0e292ab27afa199111e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjowMDo0NVrOHgEljQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjowMTo1N1rOHgEoYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MTYyOQ==", "bodyText": "what's this about? The root doesn't have \"parameters\"", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503391629", "createdAt": "2020-10-12T16:00:45Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.componentmanager.KernelConfigResolver.PARAMETERS_CONFIG_KEY;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"rootLoggerConfig\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLoggerConfig\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        this.kernel.getConfig().lookup(PARAMETERS_CONFIG_KEY, KERNEL_CONFIG_PARAMETER_TOPIC)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734443b86f40ef314e91a20ccddd802c1517e9dc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MjM1Mg==", "bodyText": "let's remove the interfaces that we won't be using. I suggest that we use only\ngetComponentLogger(Class<?> clazz, GreengrassService service)\nwhich will do make a logger with name clazz.getName() and filename service.getServiceName()", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503392352", "createdAt": "2020-10-12T16:01:57Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.componentmanager.KernelConfigResolver.PARAMETERS_CONFIG_KEY;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"rootLoggerConfig\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLoggerConfig\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        this.kernel.getConfig().lookup(PARAMETERS_CONFIG_KEY, KERNEL_CONFIG_PARAMETER_TOPIC)\n+                .subscribe((why, newv) -> {\n+                    // TODO: Subscribe to logging configuration in the kernel config and reconfigure all the loggers.\n+                });\n+    }\n+\n+    /**\n+     * Get the logger for a particular component. The logs will be added to the a log file with the same name as the\n+     * component if the logs are configured to be written to the disk.\n+     * @param name  The name of the component\n+     * @return  a logger with configuration to log to a los file with the same name.\n+     */\n+    public com.aws.greengrass.logging.api.Logger getComponentLogger(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734443b86f40ef314e91a20ccddd802c1517e9dc"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae9209ff88ad768f0fa640cbd56c6b32db1594db", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ae9209ff88ad768f0fa640cbd56c6b32db1594db", "committedDate": "2020-10-12T16:07:39Z", "message": "Keep only one function which will be used."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzUxNjU0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-506751654", "createdAt": "2020-10-12T16:11:32Z", "commit": {"oid": "ae9209ff88ad768f0fa640cbd56c6b32db1594db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjoxMTozMlrOHgE8yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjoxMTozMlrOHgE8yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng==", "bodyText": "this is very wordy when it doesn't really need to be. I'd just call the Topics as Logging. Make sure to change it to Topics it shouldn't be a singular Topic", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503397576", "createdAt": "2020-10-12T16:11:32Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.componentmanager.KernelConfigResolver.PARAMETERS_CONFIG_KEY;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"rootLoggerConfig\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLoggerConfig\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae9209ff88ad768f0fa640cbd56c6b32db1594db"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3f6ad83417f877cc13ff7caf054aa15b8f738980", "committedDate": "2020-10-12T16:45:35Z", "message": "Correct the config look up and rename the topic name."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d8fc4a46ad6069cc8e1c51f4d0167d4a539ee55", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3d8fc4a46ad6069cc8e1c51f4d0167d4a539ee55", "committedDate": "2020-10-12T16:38:49Z", "message": "Correct the config look up for service and rename the topic name."}, "afterCommit": {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3f6ad83417f877cc13ff7caf054aa15b8f738980", "committedDate": "2020-10-12T16:45:35Z", "message": "Correct the config look up and rename the topic name."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2Nzc1MDI3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-506775027", "createdAt": "2020-10-12T16:47:44Z", "commit": {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjo0Nzo0NFrOHgGGew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjo0Nzo0NFrOHgGGew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxNjQ0Mw==", "bodyText": "why isn't this services.<nucleus name>.logging?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503416443", "createdAt": "2020-10-12T16:47:44Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"logging\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLogging\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        this.kernel.getConfig().lookup(KERNEL_CONFIG_PARAMETER_TOPIC)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2Nzc5NDA1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-506779405", "createdAt": "2020-10-12T16:54:44Z", "commit": {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjo1NDo0NFrOHgGVLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjo1NDo0NFrOHgGVLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMDIwNQ==", "bodyText": "rename this", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503420205", "createdAt": "2020-10-12T16:54:44Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"logging\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLogging\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b16056f22523259539503298e4963b8cdedceaec", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b16056f22523259539503298e4963b8cdedceaec", "committedDate": "2020-10-12T19:03:04Z", "message": "Address PR comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODYxOTYw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-506861960", "createdAt": "2020-10-12T19:23:32Z", "commit": {"oid": "b16056f22523259539503298e4963b8cdedceaec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOToyMzozMlrOHgKgVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxOToyMzozMlrOHgKgVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4ODU5Nw==", "bodyText": "do we actually need to pass the extension into the logger? Doesn't the logger actually strip it out and then add it back later?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503488597", "createdAt": "2020-10-12T19:23:32Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.lifecyclemanager.GreengrassService.SERVICES_NAMESPACE_TOPIC;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b16056f22523259539503298e4963b8cdedceaec"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODYyMjQ3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-506862247", "createdAt": "2020-10-12T19:24:04Z", "commit": {"oid": "b16056f22523259539503298e4963b8cdedceaec"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03661ecf97d3c5ea94e73af8a145357389ab5c2f", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/03661ecf97d3c5ea94e73af8a145357389ab5c2f", "committedDate": "2020-10-14T23:57:33Z", "message": "Merge branch 'master' into splitOutLogs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "146fa97153d6c985eed563c96ff639a1f4c7b4b7", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/146fa97153d6c985eed563c96ff639a1f4c7b4b7", "committedDate": "2020-10-15T16:14:50Z", "message": "Fix Build."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e98405157c8c8cecb447196000617893dee471c5", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e98405157c8c8cecb447196000617893dee471c5", "committedDate": "2020-10-15T16:15:17Z", "message": "Merge branch 'master' into splitOutLogs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0503ab0280dceaa61cf8004743ac60d70b075d12", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0503ab0280dceaa61cf8004743ac60d70b075d12", "committedDate": "2020-10-15T17:02:42Z", "message": "Fix build. Add unit test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NjI1MjYz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-509625263", "createdAt": "2020-10-15T17:47:42Z", "commit": {"oid": "0503ab0280dceaa61cf8004743ac60d70b075d12"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a292b04fa217a8d4f65ba05c6a4627895a3e7646", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a292b04fa217a8d4f65ba05c6a4627895a3e7646", "committedDate": "2020-10-15T18:22:05Z", "message": "Merge branch 'master' into splitOutLogs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6280f2849baa1c957abf73d5c501c1c8242274bf", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6280f2849baa1c957abf73d5c501c1c8242274bf", "committedDate": "2020-10-15T18:39:25Z", "message": "Fix build."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0271d096f3315773773a49211baea5ac59b6685", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e0271d096f3315773773a49211baea5ac59b6685", "committedDate": "2020-10-15T18:39:55Z", "message": "Merge branch 'master' into splitOutLogs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccecea4a14d29da2ba89fe8b74c0f980d3210d70", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ccecea4a14d29da2ba89fe8b74c0f980d3210d70", "committedDate": "2020-10-15T21:51:35Z", "message": "Don't make tempDir static."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6576b1d3428e78b4699596f2cd7cd7d43f85d330", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6576b1d3428e78b4699596f2cd7cd7d43f85d330", "committedDate": "2020-10-15T22:17:40Z", "message": "Close all loggers context."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f86cc640f61cc0115eaefc9af1aa97300deecb7", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0f86cc640f61cc0115eaefc9af1aa97300deecb7", "committedDate": "2020-10-15T22:20:39Z", "message": "Merge branch 'master' into splitOutLogs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54957b4d02a22e2bbd49bd9d83e9d2936ee43a4d", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/54957b4d02a22e2bbd49bd9d83e9d2936ee43a4d", "committedDate": "2020-10-16T02:05:10Z", "message": "Close context in test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eaf88d5312183cef5fe92df2bc1d5358b2109e0", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3eaf88d5312183cef5fe92df2bc1d5358b2109e0", "committedDate": "2020-10-16T02:28:13Z", "message": "Merge branch 'master' into splitOutLogs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTcwODMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-509970832", "createdAt": "2020-10-16T02:30:38Z", "commit": {"oid": "3eaf88d5312183cef5fe92df2bc1d5358b2109e0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMjozMDozOVrOHijkDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwMjozMTowNlrOHijkhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk5NjMwMw==", "bodyText": "follow the example of telemetry and do nucleusPaths.setLoggerPath(). Make sure to set the log dir permissions to drwxr-xr-x", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r505996303", "createdAt": "2020-10-16T02:30:39Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelCommandLine.java", "diffHunk": "@@ -123,6 +123,7 @@ private void initPaths(String rootAbsolutePath) {\n             nucleusPaths.setRootPath(Paths.get(rootAbsolutePath).toAbsolutePath());\n             //set root path for the telemetry logger\n             TelemetryConfig.getInstance().setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));\n+            LogManager.setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3eaf88d5312183cef5fe92df2bc1d5358b2109e0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk5NjQyMQ==", "bodyText": "shut this down at the very very end (L299), otherwise the log messages at the end won't be logged.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r505996421", "createdAt": "2020-10-16T02:31:06Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelLifecycle.java", "diffHunk": "@@ -284,6 +285,11 @@ public void shutdown(int timeoutSeconds) {\n             //Stop the telemetry logger context after each test so we can delete the telemetry log files that are\n             // created during the test.\n             TelemetryConfig.getInstance().closeContext();\n+            // Stop all the contexts for the loggers.\n+            LogConfig.getInstance().closeContext();\n+            for (LogConfig logConfig : LogManager.getLogConfigurations().values()) {\n+                logConfig.closeContext();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3eaf88d5312183cef5fe92df2bc1d5358b2109e0"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d7b04fdbdc2108d40280c706b6b0d829ffcd448", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4d7b04fdbdc2108d40280c706b6b0d829ffcd448", "committedDate": "2020-10-16T03:16:04Z", "message": "Address PR comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55bc89bdf0f5edbfe7431dceca15707941268424", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/55bc89bdf0f5edbfe7431dceca15707941268424", "committedDate": "2020-10-16T03:16:45Z", "message": "Merge branch 'splitOutLogs' of github.com:aws/aws-greengrass-kernel into splitOutLogs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTkyOTQy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-509992942", "createdAt": "2020-10-16T03:52:36Z", "commit": {"oid": "55bc89bdf0f5edbfe7431dceca15707941268424"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjYzMjQ5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-510663249", "createdAt": "2020-10-16T17:22:09Z", "commit": {"oid": "55bc89bdf0f5edbfe7431dceca15707941268424"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjY0MzY0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#pullrequestreview-510664364", "createdAt": "2020-10-16T17:23:53Z", "commit": {"oid": "4d7b04fdbdc2108d40280c706b6b0d829ffcd448"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNzoyMzo1NFrOHjJd9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNzoyMzo1NFrOHjJd9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxNzMzNA==", "bodyText": "Where is this called?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r506617334", "createdAt": "2020-10-16T17:23:54Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/greengrass/util/NucleusPaths.java", "diffHunk": "@@ -155,4 +155,9 @@ public void setTelemetryPath(Path p) throws IOException {\n         Utils.createPaths(p);\n         Permissions.setTelemetryPermission(p);\n     }\n+\n+    public void setLoggerPath(Path p) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d7b04fdbdc2108d40280c706b6b0d829ffcd448"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3124, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}