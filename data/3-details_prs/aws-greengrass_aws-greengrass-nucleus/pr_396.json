{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MzgxOTA5", "number": 396, "title": "Evergreen setup support kernel dry run", "bodyText": "Description of changes:\n\n\nWhen launching kernel with easy setup, support dry run where the kernel is not launched. Easy setup will still create an instance of kernel, provision certs etc. This change is required when writing UAT's for kernel self update where the kernel needs to be launched by the loader script. Loader script expects certain folders to be setup which is done when kernel initializes.\n\n\nRefactored the code to make it easy for writing unit tests\n\n\nHow was this change tested:\nUnit tests\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-08-27T00:58:53Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396", "merged": true, "mergeCommit": {"oid": "5172a0a8dc3e34503e46c7dbe59306a4c558be06"}, "closed": true, "closedAt": "2020-08-27T22:08:55Z", "author": {"login": "fahadmohammed01"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC1jeYAH2gAyNDc0MzgxOTA5OjU2MzBiZjM3MWZmZTYxN2Q1YjE4M2E0ZTBjN2Q1MjBiZTc3OTNmZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDH0IUgFqTQ3NzExNjUxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5630bf371ffe617d5b183a4e0c7d520be7793fe4", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5630bf371ffe617d5b183a4e0c7d520be7793fe4", "committedDate": "2020-08-27T00:48:48Z", "message": "support dry run with easy setup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8014aaf69f087aa7702c8c4a823d36fa700053f5", "committedDate": "2020-08-27T00:59:05Z", "message": "Merge branch 'master' into easy-setup-dry-run"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MjY3Mjk5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#pullrequestreview-476267299", "createdAt": "2020-08-27T01:00:55Z", "commit": {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMTowMDo1NVrOHHskxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMTowMDo1NVrOHHskxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzgzMjM5MA==", "bodyText": "no system. Use setup.errStream or just outstream if we don't have an err stream", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r477832390", "createdAt": "2020-08-27T01:00:55Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/easysetup/EvergreenSetup.java", "diffHunk": "@@ -141,46 +146,55 @@ public EvergreenSetup(PrintStream ps, String... setupArgs) {\n             {\"PMD.NullAssignment\", \"PMD.AvoidCatchingThrowable\", \"PMD.DoNotCallSystemExit\", \"PMD.SystemPrintln\"})\n     public static void main(String[] args) {\n         try {\n-            EvergreenSetup setup = new EvergreenSetup(System.out, args);\n+            EvergreenSetup evergreenSetup = new EvergreenSetup(System.out, args);\n+            evergreenSetup.performSetUp();\n+        } catch (Throwable t) {\n+            logger.atError().setCause(t).log(\"Error while trying to setup Evergreen kernel\");\n+            System.err.println(\"Error while trying to setup Evergreen kernel\");\n+            t.printStackTrace(System.err);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Mzc0NzE2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#pullrequestreview-476374716", "createdAt": "2020-08-27T04:20:56Z", "commit": {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoyMDo1N1rOHH8WvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoyMDo1N1rOHH8WvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA5MDk0MQ==", "bodyText": "Nit - setUp or setup?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r478090941", "createdAt": "2020-08-27T04:20:57Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/easysetup/EvergreenSetup.java", "diffHunk": "@@ -141,46 +146,55 @@ public EvergreenSetup(PrintStream ps, String... setupArgs) {\n             {\"PMD.NullAssignment\", \"PMD.AvoidCatchingThrowable\", \"PMD.DoNotCallSystemExit\", \"PMD.SystemPrintln\"})\n     public static void main(String[] args) {\n         try {\n-            EvergreenSetup setup = new EvergreenSetup(System.out, args);\n+            EvergreenSetup evergreenSetup = new EvergreenSetup(System.out, args);\n+            evergreenSetup.performSetUp();\n+        } catch (Throwable t) {\n+            logger.atError().setCause(t).log(\"Error while trying to setup Evergreen kernel\");\n+            System.err.println(\"Error while trying to setup Evergreen kernel\");\n+            t.printStackTrace(System.err);\n+            System.exit(1);\n+        }\n+    }\n \n-            // Describe usage of the command\n-            if (setup.showHelp) {\n-                setup.outStream.println(SHOW_HELP_RESPONSE);\n-                System.exit(0);\n-            }\n+    void performSetUp() throws IOException, DeviceConfigurationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTQ0NjU5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#pullrequestreview-476944659", "createdAt": "2020-08-27T17:41:46Z", "commit": {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNzo0MTo0NlrOHIavZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNzo0MTo0NlrOHIavZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU4ODc3NA==", "bodyText": "dryrun may not be the right name for this option. Can we simply have --start?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#discussion_r478588774", "createdAt": "2020-08-27T17:41:46Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/easysetup/EvergreenSetup.java", "diffHunk": "@@ -84,6 +84,10 @@\n     private static final String SETUP_SYSTEM_SERVICE_ARG_SHORT = \"-ss\";\n     private static final boolean SETUP_SYSTEM_SERVICE_ARG_DEFAULT = false;\n \n+    private static final String KERNEL_DRY_RUN_ARG = \"--dry-run\";\n+    private static final String KERNEL_DRY_RUN_ARG_SHORT = \"-dr\";\n+    private static final boolean KERNEL_DRY_RUN_ARG_DEFAULT = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8014aaf69f087aa7702c8c4a823d36fa700053f5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afc39d6b5d35df5509446002f886786c31d521b3", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/afc39d6b5d35df5509446002f886786c31d521b3", "committedDate": "2020-08-27T19:45:46Z", "message": "addressed pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca0011ab8772a28dd9cddf6c9b935a3d9a3856c0", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ca0011ab8772a28dd9cddf6c9b935a3d9a3856c0", "committedDate": "2020-08-27T19:45:46Z", "message": "minor typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e623dce0ce2f4645199ee627a5dfbfcddc6ec37", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2e623dce0ce2f4645199ee627a5dfbfcddc6ec37", "committedDate": "2020-08-27T19:45:46Z", "message": "renamed variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94d7493188ee8c4faf080a63ec543db2552e7ea7", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/94d7493188ee8c4faf080a63ec543db2552e7ea7", "committedDate": "2020-08-27T19:46:42Z", "message": "Merge branch 'master' into easy-setup-dry-run"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDQwOTQ4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#pullrequestreview-477040948", "createdAt": "2020-08-27T20:03:57Z", "commit": {"oid": "94d7493188ee8c4faf080a63ec543db2552e7ea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTE2NTEy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/396#pullrequestreview-477116512", "createdAt": "2020-08-27T22:05:17Z", "commit": {"oid": "94d7493188ee8c4faf080a63ec543db2552e7ea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3219, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}