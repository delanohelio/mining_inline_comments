{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MDk0NDQ5", "number": 642, "title": "Handle runWith component and default changes", "bodyText": "Reinstall GenericExternalService on component runWith updating\nRestart nucleus on default runWith info changing\nAdd tests for bootstrapping and fix some bugs in how the nucleus config changes were being discovered\nIssue #, if available:\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nran unit, integration, e2e\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-07T06:15:46Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642", "merged": true, "mergeCommit": {"oid": "875eec99b93bf4f7e810de84f00d3c1f5543f541"}, "closed": true, "closedAt": "2020-11-09T22:09:08Z", "author": {"login": "rbattle"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdaFghjgFqTUyNTYzMTM1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABda73XEAH2gAyNTE3MDk0NDQ5OmU4NDJjMzgzMjI1YTk3NjY5NmY4MGFkNTY3OTA3MTA1OTU1MWY3YjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMxMzU4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#pullrequestreview-525631358", "createdAt": "2020-11-07T06:21:15Z", "commit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMToxNVrOHvE_Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMjowMVrOHvFAkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNjgzOQ==", "bodyText": "can the topic be null? toPojo might throw NPE.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#discussion_r519126839", "createdAt": "2020-11-07T06:21:15Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "diffHunk": "@@ -180,9 +195,64 @@ private boolean networkProxyHasChanged(Map<String, Object> newNucleusParameters,\n         return false;\n     }\n \n+    private boolean defaultRunWithChanged(Map<String, Object> newNucleusParameters,\n+            DeviceConfiguration currentDeviceConfiguration) throws ComponentConfigurationValidationException {\n+        Map<String, Object> runWithDefault = (Map<String, Object>)newNucleusParameters.getOrDefault(RUN_WITH_TOPIC,\n+                Collections.emptyMap());\n+\n+        Map<String, Object> currentValues = currentDeviceConfiguration.getRunWithTopic().toPOJO();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNzE4NA==", "bodyText": "why not? Can you mention it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#discussion_r519127184", "createdAt": "2020-11-07T06:22:01Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "diffHunk": "@@ -196,16 +266,21 @@ private boolean nucleusConfigValidAndNeedsRestart(Map<String, Object> deployment\n         for (GreengrassService s : kernel.orderedDependencies()) {\n             // For now, only let builtin Greengrass services decide\n             if (s.isBuiltin()) {\n-                needsRestart = needsRestart || s.restartNucleusOnNucleusConfigChange(proposedNucleusConfig);\n+                // don't short-circuit validation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f"}, "originalPosition": 167}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4639cac4b0e29307c276161dc3c49eb1b29ce0b0", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4639cac4b0e29307c276161dc3c49eb1b29ce0b0", "committedDate": "2020-11-07T06:34:38Z", "message": "Handle runWith component and default changes\n\nReinstall on component runWith updating\n\nRestart nucleus on default changing\n\nAdd tests for bootstrapping and fix some bugs in how the nucleus config changes were being discovered"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ef1c1f82253fad2e65b99f107d1e80fa8104522f", "committedDate": "2020-11-07T06:11:47Z", "message": "Handle runWith component and default changes\n\nReinstall on component runWith updating\n\nRestart nucleus on default changing\n\nAdd tests for bootstrapping and fix some bugs in how the nucleus config changes were being discovered"}, "afterCommit": {"oid": "4639cac4b0e29307c276161dc3c49eb1b29ce0b0", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4639cac4b0e29307c276161dc3c49eb1b29ce0b0", "committedDate": "2020-11-07T06:34:38Z", "message": "Handle runWith component and default changes\n\nReinstall on component runWith updating\n\nRestart nucleus on default changing\n\nAdd tests for bootstrapping and fix some bugs in how the nucleus config changes were being discovered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "211771453aeafc409385dbe82391ad3587c4e5f8", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/211771453aeafc409385dbe82391ad3587c4e5f8", "committedDate": "2020-11-07T07:08:08Z", "message": "Merge branch 'master' into runwith-restart"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3642f523fe1ebc1101a3e76f81caf47942b0b5f8", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3642f523fe1ebc1101a3e76f81caf47942b0b5f8", "committedDate": "2020-11-09T18:06:27Z", "message": "Merge branch 'master' into runwith-restart"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTQzNDc1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#pullrequestreview-526543475", "createdAt": "2020-11-09T18:39:26Z", "commit": {"oid": "3642f523fe1ebc1101a3e76f81caf47942b0b5f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6088b8fc600c62ac3da41bab11ca0c988cb3db08", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6088b8fc600c62ac3da41bab11ca0c988cb3db08", "committedDate": "2020-11-09T19:23:46Z", "message": "Merge branch 'master' into runwith-restart"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTk3NTUw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#pullrequestreview-526597550", "createdAt": "2020-11-09T19:45:37Z", "commit": {"oid": "6088b8fc600c62ac3da41bab11ca0c988cb3db08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e842c383225a976696f80ad5679071059551f7b2", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e842c383225a976696f80ad5679071059551f7b2", "committedDate": "2020-11-09T21:44:08Z", "message": "Merge branch 'master' into runwith-restart"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2607, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}