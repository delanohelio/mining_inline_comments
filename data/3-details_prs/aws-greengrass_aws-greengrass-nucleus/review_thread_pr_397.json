{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0ODM5MjU0", "number": 397, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0OToyM1rOEd0fHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODo1MDoxNlrOEd2rfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA0MDk0OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/README.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0OToyM1rOHJNlwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxNDo0OFrOHJOYAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMTg4OQ==", "bodyText": "We can't omit platform entirely if it runs on anything?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479421889", "createdAt": "2020-08-28T16:49:23Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/README.md", "diffHunk": "@@ -0,0 +1,29 @@\n+## Platform for E2E\n+As cloud only matches exact OS name, in the recipe, we need to provide the OS name that will be detected when running ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNDc1Mg==", "bodyText": "By design you should be able to omit if it runs on anything, but it needs to be verified with cloud if it's implemented.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479434752", "createdAt": "2020-08-28T17:14:48Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/README.md", "diffHunk": "@@ -0,0 +1,29 @@\n+## Platform for E2E\n+As cloud only matches exact OS name, in the recipe, we need to provide the OS name that will be detected when running ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMTg4OQ=="}, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA1OTc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/common/ComponentParameter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1NTowNlrOHJNxAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxNjo0MVrOHJObcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDc3MQ==", "bodyText": "What's this for?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479424771", "createdAt": "2020-08-28T16:55:06Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/common/ComponentParameter.java", "diffHunk": "@@ -20,6 +21,10 @@\n \n     ParameterType type;\n \n+    @JsonPOJOBuilder(withPrefix = \"\")\n+    public static class ComponentParameterBuilder {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNTYzNA==", "bodyText": "Builder class for deserializing recipe, the model is defined in common package, and I believe Ethan is using that model definition already. These model definitions are waiting for cleaning up.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479435634", "createdAt": "2020-08-28T17:16:41Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/common/ComponentParameter.java", "diffHunk": "@@ -20,6 +21,10 @@\n \n     ParameterType type;\n \n+    @JsonPOJOBuilder(withPrefix = \"\")\n+    public static class ComponentParameterBuilder {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDc3MQ=="}, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA2MzU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/ComponentArtifact.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1NjowOVrOHJNzPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxODowNVrOHJOeJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNTM0Mw==", "bodyText": "won't this be looking for artifactUri in JSON? Isn't it just uri?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479425343", "createdAt": "2020-08-28T16:56:09Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/ComponentArtifact.java", "diffHunk": "@@ -3,34 +3,23 @@\n \n package com.aws.iot.evergreen.packagemanager.models;\n \n-import com.fasterxml.jackson.annotation.JsonProperty;\n import lombok.AllArgsConstructor;\n import lombok.Builder;\n-import lombok.Getter;\n-import lombok.NoArgsConstructor;\n+import lombok.NonNull;\n+import lombok.Value;\n \n import java.net.URI;\n \n-@Getter\n-@AllArgsConstructor\n-@NoArgsConstructor\n+@Value\n @Builder\n+@AllArgsConstructor\n public class ComponentArtifact {\n \n-    @JsonProperty(\"Uri\")\n-    private URI artifactUri;\n-\n-    @JsonProperty(\"Checksum\")\n-    private String checksum;\n+    @NonNull URI artifactUri;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNjMyNw==", "bodyText": "This is kernel its own component model, it's not directly mapping to recipe file, so field name shouldn't matter.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479436327", "createdAt": "2020-08-28T17:18:05Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/ComponentArtifact.java", "diffHunk": "@@ -3,34 +3,23 @@\n \n package com.aws.iot.evergreen.packagemanager.models;\n \n-import com.fasterxml.jackson.annotation.JsonProperty;\n import lombok.AllArgsConstructor;\n import lombok.Builder;\n-import lombok.Getter;\n-import lombok.NoArgsConstructor;\n+import lombok.NonNull;\n+import lombok.Value;\n \n import java.net.URI;\n \n-@Getter\n-@AllArgsConstructor\n-@NoArgsConstructor\n+@Value\n @Builder\n+@AllArgsConstructor\n public class ComponentArtifact {\n \n-    @JsonProperty(\"Uri\")\n-    private URI artifactUri;\n-\n-    @JsonProperty(\"Checksum\")\n-    private String checksum;\n+    @NonNull URI artifactUri;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNTM0Mw=="}, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA2NzExOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/RecipeDependencyProperties.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1NzoxNFrOHJN1kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzozNDoxOVrOHJO9fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNTkzOQ==", "bodyText": "Set it to HARD by default", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479425939", "createdAt": "2020-08-28T16:57:14Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/RecipeDependencyProperties.java", "diffHunk": "@@ -5,28 +5,24 @@\n \n package com.aws.iot.evergreen.packagemanager.models;\n \n-import com.fasterxml.jackson.annotation.JsonProperty;\n-import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n import lombok.AllArgsConstructor;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n+import lombok.Value;\n \n-@Getter\n+@Value\n @AllArgsConstructor\n-@EqualsAndHashCode\n-@JsonSerialize\n public class RecipeDependencyProperties {\n-    @JsonProperty(\"VersionRequirements\")\n-    String versionRequirements;\n-    @JsonProperty(\"DependencyType\")\n-    String dependencyType;\n+    String versionRequirements; // TODO Make it strongly typed with Semver.Requirement\n+    String dependencyType;  //TODO Make it enum\n \n     /**\n      * RecipeDependencyProperties constructor.\n      *\n      * @param versionRequirements dependency version constraints\n      */\n+    @SuppressWarnings(\"PMD.NullAssignment\")\n+    // dependencyType could be null now. TODO not allow null after changing to enum\n     public RecipeDependencyProperties(String versionRequirements) {\n         this.versionRequirements = versionRequirements;\n+        this.dependencyType = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NDM1MQ==", "bodyText": "temporarily hard coded", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479444351", "createdAt": "2020-08-28T17:34:19Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/RecipeDependencyProperties.java", "diffHunk": "@@ -5,28 +5,24 @@\n \n package com.aws.iot.evergreen.packagemanager.models;\n \n-import com.fasterxml.jackson.annotation.JsonProperty;\n-import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n import lombok.AllArgsConstructor;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n+import lombok.Value;\n \n-@Getter\n+@Value\n @AllArgsConstructor\n-@EqualsAndHashCode\n-@JsonSerialize\n public class RecipeDependencyProperties {\n-    @JsonProperty(\"VersionRequirements\")\n-    String versionRequirements;\n-    @JsonProperty(\"DependencyType\")\n-    String dependencyType;\n+    String versionRequirements; // TODO Make it strongly typed with Semver.Requirement\n+    String dependencyType;  //TODO Make it enum\n \n     /**\n      * RecipeDependencyProperties constructor.\n      *\n      * @param versionRequirements dependency version constraints\n      */\n+    @SuppressWarnings(\"PMD.NullAssignment\")\n+    // dependencyType could be null now. TODO not allow null after changing to enum\n     public RecipeDependencyProperties(String versionRequirements) {\n         this.versionRequirements = versionRequirements;\n+        this.dependencyType = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNTkzOQ=="}, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA3MDI2OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/aws/iot/evergreen/config/PlatformResolverTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1ODoxN1rOHJN3oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzozNDoyNFrOHJO9rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNjQ2NQ==", "bodyText": "no *", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479426465", "createdAt": "2020-08-28T16:58:17Z", "author": {"login": "MikeDombo"}, "path": "src/test/java/com/aws/iot/evergreen/config/PlatformResolverTest.java", "diffHunk": "@@ -14,11 +14,9 @@\n import java.io.InputStream;\n import java.lang.reflect.InvocationTargetException;\n import java.lang.reflect.Method;\n-import java.util.HashMap;\n-import java.util.Map;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NDM5Ng==", "bodyText": "fixed", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479444396", "createdAt": "2020-08-28T17:34:24Z", "author": {"login": "wikimonkey"}, "path": "src/test/java/com/aws/iot/evergreen/config/PlatformResolverTest.java", "diffHunk": "@@ -14,11 +14,9 @@\n import java.io.InputStream;\n import java.lang.reflect.InvocationTargetException;\n import java.lang.reflect.Method;\n-import java.util.HashMap;\n-import java.util.Map;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNjQ2NQ=="}, "originalCommit": {"oid": "ce79e8ea7ec275f958b176f565a8744bac670316"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzI4Mzk4OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/NonDisruptableService-1.0.0.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxMDowNVrOHJP-Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODo1Mzo0OVrOHJRKqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MDkyMw==", "bodyText": "NIT: you can do Platform: windows (for windows specific) and all(for the rest)", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479460923", "createdAt": "2020-08-28T18:10:05Z", "author": {"login": "ShirleyZheng92"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/NonDisruptableService-1.0.0.yaml", "diffHunk": "@@ -1,16 +1,22 @@\n ---\n-RecipeTemplateVersion: '2020-01-25'\n+TemplateVersion: '2020-01-25'\n ComponentName: {{NonDisruptableService}}\n Description: A service that can be performing important task so should not be restarted if not safe\n Publisher: Me\n Version: '1.0.0'\n-Platforms:\n-  - ubuntu\n-  - debian\n-  - macos\n-  - windows\n-Lifecycle:\n-  run: |-\n-    while true; do\n-    echo \"running non disruptable service version 1.0.0\"; sleep 5\n-    done\n\\ No newline at end of file\n+Manifests:\n+  - Platform:\n+      os: macos", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ4MDQ5MA==", "bodyText": "All right, let's do it later consistently.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479480490", "createdAt": "2020-08-28T18:53:49Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/NonDisruptableService-1.0.0.yaml", "diffHunk": "@@ -1,16 +1,22 @@\n ---\n-RecipeTemplateVersion: '2020-01-25'\n+TemplateVersion: '2020-01-25'\n ComponentName: {{NonDisruptableService}}\n Description: A service that can be performing important task so should not be restarted if not safe\n Publisher: Me\n Version: '1.0.0'\n-Platforms:\n-  - ubuntu\n-  - debian\n-  - macos\n-  - windows\n-Lifecycle:\n-  run: |-\n-    while true; do\n-    echo \"running non disruptable service version 1.0.0\"; sleep 5\n-    done\n\\ No newline at end of file\n+Manifests:\n+  - Platform:\n+      os: macos", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MDkyMw=="}, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzI4NTQ4OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/NonDisruptableService-1.0.1.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxMDozOFrOHJP_Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODo1MjozNVrOHJRItQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MTE2Nw==", "bodyText": "Use Linux here. if we do exact text match, then we have to use an os.flavor field", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479461167", "createdAt": "2020-08-28T18:10:38Z", "author": {"login": "ShirleyZheng92"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/NonDisruptableService-1.0.1.yaml", "diffHunk": "@@ -1,16 +1,21 @@\n ---\n-RecipeTemplateVersion: '2020-01-25'\n+TemplateVersion: '2020-01-25'\n ComponentName: {{NonDisruptableService}}\n Description: A service that can be performing important task so should not be restarted if not safe\n Publisher: Me\n Version: '1.0.1'\n-Platforms:\n-  - ubuntu\n-  - debian\n-  - macos\n-  - windows\n-Lifecycle:\n-  run: |-\n-    while true; do\n-    echo \"running non disruptable service version 1.0.1\"; sleep 5\n-    done\n\\ No newline at end of file\n+Manifests:\n+  - Platform:\n+      os: macos\n+    Lifecycle:\n+      run: |-\n+        while true; do\n+        echo \"running non disruptable service version 1.0.1\"; sleep 5\n+        done\n+  - Platform:\n+      os: ubuntu", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3OTk4OQ==", "bodyText": "Let me update these", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479479989", "createdAt": "2020-08-28T18:52:35Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/NonDisruptableService-1.0.1.yaml", "diffHunk": "@@ -1,16 +1,21 @@\n ---\n-RecipeTemplateVersion: '2020-01-25'\n+TemplateVersion: '2020-01-25'\n ComponentName: {{NonDisruptableService}}\n Description: A service that can be performing important task so should not be restarted if not safe\n Publisher: Me\n Version: '1.0.1'\n-Platforms:\n-  - ubuntu\n-  - debian\n-  - macos\n-  - windows\n-Lifecycle:\n-  run: |-\n-    while true; do\n-    echo \"running non disruptable service version 1.0.1\"; sleep 5\n-    done\n\\ No newline at end of file\n+Manifests:\n+  - Platform:\n+      os: macos\n+    Lifecycle:\n+      run: |-\n+        while true; do\n+        echo \"running non disruptable service version 1.0.1\"; sleep 5\n+        done\n+  - Platform:\n+      os: ubuntu", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MTE2Nw=="}, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzI4NzMxOnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/README.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxMToxOFrOHJQAXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxMToxOFrOHJQAXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MTQ2OA==", "bodyText": "use linux here", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479461468", "createdAt": "2020-08-28T18:11:18Z", "author": {"login": "ShirleyZheng92"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/README.md", "diffHunk": "@@ -0,0 +1,29 @@\n+## Platform for E2E\n+As cloud only matches exact OS name, in the recipe, we need to provide the OS name that will be detected when running \n+the E2E tests.\n+\n+As a result, both `macos` and `ubuntu` are provided to make E2E can work on our local laptop and Github Action \n+(which uses ubuntu).\n+\n+When making any change, don't forget to change the two manifests together, since they should also be consistent to \n+ensure local and Github results are the same for local debugging purpose. \n+\n+See the following for an example:\n+\n+```yaml\n+TemplateVersion: '2020-01-25'\n+ComponentName: {{SlowToDeployApp}}\n+Description: An app that takes some time to install so as to slow down deployments\n+Publisher: Me\n+Version: '1.0.0'\n+Manifests:\n+  - Platform:\n+      os: macos\n+    Lifecycle:\n+      install: sleep 5\n+\n+  - Platform:\n+      os: ubuntu", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzI4Nzk1OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/README.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxMTozNFrOHJQAyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxMTozNFrOHJQAyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MTU3Nw==", "bodyText": "use linux here", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479461577", "createdAt": "2020-08-28T18:11:34Z", "author": {"login": "ShirleyZheng92"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/README.md", "diffHunk": "@@ -0,0 +1,29 @@\n+## Platform for E2E\n+As cloud only matches exact OS name, in the recipe, we need to provide the OS name that will be detected when running \n+the E2E tests.\n+\n+As a result, both `macos` and `ubuntu` are provided to make E2E can work on our local laptop and Github Action ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzI5ODMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/common/SerializerFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxNTowNVrOHJQHQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxNTowNVrOHJQHQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MzIzMg==", "bodyText": "Nice!", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479463232", "createdAt": "2020-08-28T18:15:05Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/common/SerializerFactory.java", "diffHunk": "@@ -16,7 +16,8 @@\n public final class SerializerFactory {\n     private static final ObjectMapper RECIPE_SERIALIZER =\n             new ObjectMapper(new YAMLFactory()).enable(MapperFeature.ACCEPT_CASE_INSENSITIVE_PROPERTIES)\n-                    .setSerializationInclusion(JsonInclude.Include.NON_NULL);\n+                                               .enable(MapperFeature.ACCEPT_CASE_INSENSITIVE_ENUMS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzI5OTYwOnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoxNTozNFrOHJQIEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODozNDoyMVrOHJQpAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MzQ0Mg==", "bodyText": "why remove GAMMA ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479463442", "createdAt": "2020-08-28T18:15:34Z", "author": {"login": "fahadmohammed01"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -99,7 +98,7 @@\n  */\n @ExtendWith(EGExtension.class)\n public class BaseE2ETestCase implements AutoCloseable {\n-    protected static final String FCS_GAMMA_ENDPOINT = \"https://bp5p2uvbx6.execute-api.us-east-1.amazonaws.com/Gamma\";\n+    private static final String FCS_ENDPOINT = \"https://bp5p2uvbx6.execute-api.us-east-1.amazonaws.com/Gamma\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NDMwNQ==", "bodyText": "because this change is tested against cloud beta. Once it's pushed in, and cloud pushed changes to Gamma, we will switch back.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479464305", "createdAt": "2020-08-28T18:17:23Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -99,7 +98,7 @@\n  */\n @ExtendWith(EGExtension.class)\n public class BaseE2ETestCase implements AutoCloseable {\n-    protected static final String FCS_GAMMA_ENDPOINT = \"https://bp5p2uvbx6.execute-api.us-east-1.amazonaws.com/Gamma\";\n+    private static final String FCS_ENDPOINT = \"https://bp5p2uvbx6.execute-api.us-east-1.amazonaws.com/Gamma\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MzQ0Mg=="}, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3MTg3NQ==", "bodyText": "the url still has gamma in it, so is it not talking to gamma?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479471875", "createdAt": "2020-08-28T18:34:21Z", "author": {"login": "fahadmohammed01"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -99,7 +98,7 @@\n  */\n @ExtendWith(EGExtension.class)\n public class BaseE2ETestCase implements AutoCloseable {\n-    protected static final String FCS_GAMMA_ENDPOINT = \"https://bp5p2uvbx6.execute-api.us-east-1.amazonaws.com/Gamma\";\n+    private static final String FCS_ENDPOINT = \"https://bp5p2uvbx6.execute-api.us-east-1.amazonaws.com/Gamma\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MzQ0Mg=="}, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzMxNTQ5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageRecipe.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoyMDo0N1rOHJQReA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODo1MzowNlrOHJRJiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NTg0OA==", "bodyText": "Will this become an Enum? If so can you add a todo?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479465848", "createdAt": "2020-08-28T18:20:47Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageRecipe.java", "diffHunk": "@@ -3,202 +3,43 @@\n \n package com.aws.iot.evergreen.packagemanager.models;\n \n-import com.aws.iot.evergreen.config.PlatformResolver;\n-import com.aws.iot.evergreen.util.SerializerFactory;\n-import com.fasterxml.jackson.annotation.JsonCreator;\n-import com.fasterxml.jackson.annotation.JsonProperty;\n-import com.fasterxml.jackson.core.JsonParser;\n-import com.fasterxml.jackson.core.type.TypeReference;\n-import com.fasterxml.jackson.databind.DeserializationContext;\n-import com.fasterxml.jackson.databind.JsonDeserializer;\n-import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n-import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n import com.vdurmont.semver4j.Semver;\n-import com.vdurmont.semver4j.SemverException;\n-import lombok.AccessLevel;\n import lombok.AllArgsConstructor;\n import lombok.Builder;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n-import lombok.NoArgsConstructor;\n+import lombok.Value;\n \n-import java.io.IOException;\n import java.util.Collections;\n-import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n \n-@Getter\n-@NoArgsConstructor(force = true, access = AccessLevel.PRIVATE)\n-@EqualsAndHashCode(onlyExplicitlyIncluded = true)\n+@Value\n @Builder\n @AllArgsConstructor\n public class PackageRecipe {\n-    private static final String DEPENDENCY_VERSION_REQUIREMENTS_KEY = \"versionrequirements\";\n-    private static final String DEPENDENCY_TYPE_KEY = \"dependencytype\";\n \n-    // TODO: Will be used for schema versioning in the future\n-    private final RecipeTemplateVersion recipeTemplateVersion;\n+    RecipeTemplateVersion recipeTemplateVersion;\n \n-    @EqualsAndHashCode.Include\n-    private final String componentName;\n+    String componentName;\n \n-    private final String componentType;\n+    Semver version;\n \n-    @EqualsAndHashCode.Include\n-    private Semver version;\n+    String description;\n \n-    private final String description;\n+    String publisher;\n \n-    private final String publisher;\n+    // The following fields are the platform specific and has already been resolved when loading from the recipe file\n+    @Builder.Default\n+    Set<PackageParameter> packageParameters = Collections.emptySet();\n \n-    private final Set<PackageParameter> packageParameters;\n+    @Builder.Default\n+    Map<String, Object> lifecycle = Collections.emptyMap();\n \n-    private final List<String> platforms;\n+    @Builder.Default\n+    List<ComponentArtifact> artifacts = Collections.emptyList();\n \n-    private final Map<String, Object> lifecycle;\n+    @Builder.Default\n+    Map<String, RecipeDependencyProperties> dependencies = Collections.emptyMap();\n \n-    private final List<ComponentArtifact> artifacts;\n-\n-    private final Map<String, RecipeDependencyProperties> dependencies;\n-\n-    /**\n-     * Constructor for Jackson to deserialize.\n-     *\n-     * @param recipeTemplateVersion Template version found in the Recipe file\n-     * @param componentName         Name of the component\n-     * @param version               Version of the package\n-     * @param description           Description metadata\n-     * @param publisher             Name of the publisher\n-     * @param packageParameters     Parameters included in the recipe\n-     * @param platforms             Platforms supported by the recipe\n-     * @param lifecycle             Lifecycle definitions\n-     * @param artifacts             Artifact definitions\n-     * @param dependencies          List of dependencies\n-     * @param componentType         Type of component to be created\n-     * @throws SemverException if the semver fails to be created\n-     */\n-    @Deprecated\n-    @JsonCreator\n-    @SuppressWarnings(\"PMD.ExcessiveParameterList\")\n-    public PackageRecipe(@JsonProperty(\"RecipeTemplateVersion\") RecipeTemplateVersion recipeTemplateVersion,\n-                         @JsonProperty(\"ComponentName\") String componentName, @JsonProperty(\"Version\") Semver version,\n-                         @JsonProperty(\"Description\") String description, @JsonProperty(\"Publisher\") String publisher,\n-                         @JsonProperty(\"Parameters\") Set<PackageParameter> packageParameters,\n-                         @JsonProperty(\"Platforms\") List<String> platforms, @JsonProperty(\"Lifecycle\") @JsonDeserialize(\n-            using = MapFieldDeserializer.class) Map<String, Object> lifecycle,\n-                         @JsonProperty(\"Artifacts\") @JsonDeserialize(\n-                                 using = ArtifactDeserializer.class) List<ComponentArtifact> artifacts,\n-                         @JsonProperty(\"Dependencies\") @JsonDeserialize(\n-                                 using = DependencyMapDeserializer.class)\n-                                     Map<String, RecipeDependencyProperties> dependencies,\n-                         @JsonProperty(\"ComponentType\") String componentType) {\n-\n-        this.recipeTemplateVersion = recipeTemplateVersion;\n-        this.componentName = componentName;\n-        //TODO: Figure out how to do this in deserialize (only option so far seems to be custom deserializer)\n-        //TODO: Validate SemverType.STRICT before creating this\n-        this.version = new Semver(version.toString(), Semver.SemverType.NPM);\n-        this.description = description;\n-        this.publisher = publisher;\n-        this.platforms = platforms;\n-        this.packageParameters = packageParameters == null ? Collections.emptySet() : packageParameters;\n-        this.lifecycle = lifecycle == null ? Collections.emptyMap() : lifecycle;\n-        this.artifacts = artifacts == null ? Collections.emptyList() : artifacts;\n-        this.dependencies = dependencies == null ? Collections.emptyMap() : dependencies;\n-        this.componentType = componentType;\n-    }\n-\n-    @JsonSerialize(using = SemverSerializer.class)\n-    public Semver getVersion() {\n-        return version;\n-    }\n-\n-    @Deprecated\n-    private static class ArtifactDeserializer extends JsonDeserializer<List<ComponentArtifact>> {\n-        @Override\n-        @SuppressWarnings(\"unchecked\")\n-        public List<ComponentArtifact> deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n-                throws IOException {\n-\n-\n-            Map<String, List<ComponentArtifact>> artifacts = SerializerFactory\n-                                                .getRecipeSerializer()\n-                                                .convertValue(\n-                                                        jsonParser.readValueAsTree(),\n-                                                        new TypeReference<Map<String, List<ComponentArtifact>>>() {});\n-\n-            Map<Object, Object> map = new HashMap<>(artifacts);\n-\n-            return (List<ComponentArtifact>) PlatformResolver.resolvePlatform(map);\n-        }\n-    }\n-\n-    @Deprecated\n-    private static class MapFieldDeserializer extends JsonDeserializer<Map<String, Object>> {\n-        @Override\n-        @SuppressWarnings(\"unchecked\")\n-        public Map<String, Object> deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n-                throws IOException {\n-            Map<Object, Object> map =\n-                    SerializerFactory.getRecipeSerializer().convertValue(jsonParser.readValueAsTree(), Map.class);\n-\n-            return (Map<String, Object>) PlatformResolver.resolvePlatform(map);\n-        }\n-    }\n-\n-    @Deprecated\n-    private static class DependencyMapDeserializer extends JsonDeserializer<Map<String, RecipeDependencyProperties>> {\n-        @Override\n-        public Map<String, RecipeDependencyProperties> deserialize(JsonParser p, DeserializationContext ctxt)\n-                throws IOException {\n-            Object resolved = PlatformResolver.resolvePlatform(\n-                    SerializerFactory.getRecipeSerializer().convertValue(p.readValueAsTree(), Map.class));\n-            if (resolved == null) {\n-                return Collections.emptyMap();\n-            }\n-            if (!(resolved instanceof Map)) {\n-                throw new IOException(String.format(\"Illegal dependency syntax in package recipe. Dependencies \"\n-                        + \"after platform resolution should be a map, but actually: %s\", resolved));\n-            }\n-\n-            Map<String, RecipeDependencyProperties> dependencyPropertiesMap = new HashMap<>();\n-            for (Map.Entry<String, Object> entry : ((Map<String, Object>) resolved).entrySet()) {\n-                String name = entry.getKey();\n-                Object value = entry.getValue();\n-                if (!(value instanceof Map)) {\n-                    throw new IOException(String.format(\"Illegal dependency syntax in package recipe. Dependency %s \"\n-                            + \"should have a property map, but actually: %s\", name, entry.getValue()));\n-                }\n-                Map<String, String> propMap = (Map<String, String>) value;\n-                String versionRequirements = \"*\";\n-                String dependencyType = \"\";\n-                for (Map.Entry<String, String> e : propMap.entrySet()) {\n-                    if (e.getValue() == null) {\n-                        continue;\n-                    }\n-                    String k = e.getKey();\n-                    switch (k.toLowerCase()) {\n-                        case DEPENDENCY_VERSION_REQUIREMENTS_KEY:\n-                            versionRequirements = e.getValue();\n-                            break;\n-                        case DEPENDENCY_TYPE_KEY:\n-                            dependencyType = e.getValue();\n-                            break;\n-                        default:\n-                            throw new IOException(String.format(\"Illegal dependency syntax in package recipe. \"\n-                                    + \"Dependency %s has unknown keyword: %s\", name, k));\n-                    }\n-                }\n-\n-                if (dependencyType.isEmpty()) {\n-                    dependencyPropertiesMap.put(name, new RecipeDependencyProperties(versionRequirements));\n-                    continue;\n-                }\n-                dependencyPropertiesMap.put(name, new RecipeDependencyProperties(versionRequirements, dependencyType));\n-            }\n-            return dependencyPropertiesMap;\n-        }\n-    }\n+    String componentType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 218}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ4MDIwMQ==", "bodyText": "It should, even using SPI.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479480201", "createdAt": "2020-08-28T18:53:06Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageRecipe.java", "diffHunk": "@@ -3,202 +3,43 @@\n \n package com.aws.iot.evergreen.packagemanager.models;\n \n-import com.aws.iot.evergreen.config.PlatformResolver;\n-import com.aws.iot.evergreen.util.SerializerFactory;\n-import com.fasterxml.jackson.annotation.JsonCreator;\n-import com.fasterxml.jackson.annotation.JsonProperty;\n-import com.fasterxml.jackson.core.JsonParser;\n-import com.fasterxml.jackson.core.type.TypeReference;\n-import com.fasterxml.jackson.databind.DeserializationContext;\n-import com.fasterxml.jackson.databind.JsonDeserializer;\n-import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n-import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n import com.vdurmont.semver4j.Semver;\n-import com.vdurmont.semver4j.SemverException;\n-import lombok.AccessLevel;\n import lombok.AllArgsConstructor;\n import lombok.Builder;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n-import lombok.NoArgsConstructor;\n+import lombok.Value;\n \n-import java.io.IOException;\n import java.util.Collections;\n-import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n \n-@Getter\n-@NoArgsConstructor(force = true, access = AccessLevel.PRIVATE)\n-@EqualsAndHashCode(onlyExplicitlyIncluded = true)\n+@Value\n @Builder\n @AllArgsConstructor\n public class PackageRecipe {\n-    private static final String DEPENDENCY_VERSION_REQUIREMENTS_KEY = \"versionrequirements\";\n-    private static final String DEPENDENCY_TYPE_KEY = \"dependencytype\";\n \n-    // TODO: Will be used for schema versioning in the future\n-    private final RecipeTemplateVersion recipeTemplateVersion;\n+    RecipeTemplateVersion recipeTemplateVersion;\n \n-    @EqualsAndHashCode.Include\n-    private final String componentName;\n+    String componentName;\n \n-    private final String componentType;\n+    Semver version;\n \n-    @EqualsAndHashCode.Include\n-    private Semver version;\n+    String description;\n \n-    private final String description;\n+    String publisher;\n \n-    private final String publisher;\n+    // The following fields are the platform specific and has already been resolved when loading from the recipe file\n+    @Builder.Default\n+    Set<PackageParameter> packageParameters = Collections.emptySet();\n \n-    private final Set<PackageParameter> packageParameters;\n+    @Builder.Default\n+    Map<String, Object> lifecycle = Collections.emptyMap();\n \n-    private final List<String> platforms;\n+    @Builder.Default\n+    List<ComponentArtifact> artifacts = Collections.emptyList();\n \n-    private final Map<String, Object> lifecycle;\n+    @Builder.Default\n+    Map<String, RecipeDependencyProperties> dependencies = Collections.emptyMap();\n \n-    private final List<ComponentArtifact> artifacts;\n-\n-    private final Map<String, RecipeDependencyProperties> dependencies;\n-\n-    /**\n-     * Constructor for Jackson to deserialize.\n-     *\n-     * @param recipeTemplateVersion Template version found in the Recipe file\n-     * @param componentName         Name of the component\n-     * @param version               Version of the package\n-     * @param description           Description metadata\n-     * @param publisher             Name of the publisher\n-     * @param packageParameters     Parameters included in the recipe\n-     * @param platforms             Platforms supported by the recipe\n-     * @param lifecycle             Lifecycle definitions\n-     * @param artifacts             Artifact definitions\n-     * @param dependencies          List of dependencies\n-     * @param componentType         Type of component to be created\n-     * @throws SemverException if the semver fails to be created\n-     */\n-    @Deprecated\n-    @JsonCreator\n-    @SuppressWarnings(\"PMD.ExcessiveParameterList\")\n-    public PackageRecipe(@JsonProperty(\"RecipeTemplateVersion\") RecipeTemplateVersion recipeTemplateVersion,\n-                         @JsonProperty(\"ComponentName\") String componentName, @JsonProperty(\"Version\") Semver version,\n-                         @JsonProperty(\"Description\") String description, @JsonProperty(\"Publisher\") String publisher,\n-                         @JsonProperty(\"Parameters\") Set<PackageParameter> packageParameters,\n-                         @JsonProperty(\"Platforms\") List<String> platforms, @JsonProperty(\"Lifecycle\") @JsonDeserialize(\n-            using = MapFieldDeserializer.class) Map<String, Object> lifecycle,\n-                         @JsonProperty(\"Artifacts\") @JsonDeserialize(\n-                                 using = ArtifactDeserializer.class) List<ComponentArtifact> artifacts,\n-                         @JsonProperty(\"Dependencies\") @JsonDeserialize(\n-                                 using = DependencyMapDeserializer.class)\n-                                     Map<String, RecipeDependencyProperties> dependencies,\n-                         @JsonProperty(\"ComponentType\") String componentType) {\n-\n-        this.recipeTemplateVersion = recipeTemplateVersion;\n-        this.componentName = componentName;\n-        //TODO: Figure out how to do this in deserialize (only option so far seems to be custom deserializer)\n-        //TODO: Validate SemverType.STRICT before creating this\n-        this.version = new Semver(version.toString(), Semver.SemverType.NPM);\n-        this.description = description;\n-        this.publisher = publisher;\n-        this.platforms = platforms;\n-        this.packageParameters = packageParameters == null ? Collections.emptySet() : packageParameters;\n-        this.lifecycle = lifecycle == null ? Collections.emptyMap() : lifecycle;\n-        this.artifacts = artifacts == null ? Collections.emptyList() : artifacts;\n-        this.dependencies = dependencies == null ? Collections.emptyMap() : dependencies;\n-        this.componentType = componentType;\n-    }\n-\n-    @JsonSerialize(using = SemverSerializer.class)\n-    public Semver getVersion() {\n-        return version;\n-    }\n-\n-    @Deprecated\n-    private static class ArtifactDeserializer extends JsonDeserializer<List<ComponentArtifact>> {\n-        @Override\n-        @SuppressWarnings(\"unchecked\")\n-        public List<ComponentArtifact> deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n-                throws IOException {\n-\n-\n-            Map<String, List<ComponentArtifact>> artifacts = SerializerFactory\n-                                                .getRecipeSerializer()\n-                                                .convertValue(\n-                                                        jsonParser.readValueAsTree(),\n-                                                        new TypeReference<Map<String, List<ComponentArtifact>>>() {});\n-\n-            Map<Object, Object> map = new HashMap<>(artifacts);\n-\n-            return (List<ComponentArtifact>) PlatformResolver.resolvePlatform(map);\n-        }\n-    }\n-\n-    @Deprecated\n-    private static class MapFieldDeserializer extends JsonDeserializer<Map<String, Object>> {\n-        @Override\n-        @SuppressWarnings(\"unchecked\")\n-        public Map<String, Object> deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n-                throws IOException {\n-            Map<Object, Object> map =\n-                    SerializerFactory.getRecipeSerializer().convertValue(jsonParser.readValueAsTree(), Map.class);\n-\n-            return (Map<String, Object>) PlatformResolver.resolvePlatform(map);\n-        }\n-    }\n-\n-    @Deprecated\n-    private static class DependencyMapDeserializer extends JsonDeserializer<Map<String, RecipeDependencyProperties>> {\n-        @Override\n-        public Map<String, RecipeDependencyProperties> deserialize(JsonParser p, DeserializationContext ctxt)\n-                throws IOException {\n-            Object resolved = PlatformResolver.resolvePlatform(\n-                    SerializerFactory.getRecipeSerializer().convertValue(p.readValueAsTree(), Map.class));\n-            if (resolved == null) {\n-                return Collections.emptyMap();\n-            }\n-            if (!(resolved instanceof Map)) {\n-                throw new IOException(String.format(\"Illegal dependency syntax in package recipe. Dependencies \"\n-                        + \"after platform resolution should be a map, but actually: %s\", resolved));\n-            }\n-\n-            Map<String, RecipeDependencyProperties> dependencyPropertiesMap = new HashMap<>();\n-            for (Map.Entry<String, Object> entry : ((Map<String, Object>) resolved).entrySet()) {\n-                String name = entry.getKey();\n-                Object value = entry.getValue();\n-                if (!(value instanceof Map)) {\n-                    throw new IOException(String.format(\"Illegal dependency syntax in package recipe. Dependency %s \"\n-                            + \"should have a property map, but actually: %s\", name, entry.getValue()));\n-                }\n-                Map<String, String> propMap = (Map<String, String>) value;\n-                String versionRequirements = \"*\";\n-                String dependencyType = \"\";\n-                for (Map.Entry<String, String> e : propMap.entrySet()) {\n-                    if (e.getValue() == null) {\n-                        continue;\n-                    }\n-                    String k = e.getKey();\n-                    switch (k.toLowerCase()) {\n-                        case DEPENDENCY_VERSION_REQUIREMENTS_KEY:\n-                            versionRequirements = e.getValue();\n-                            break;\n-                        case DEPENDENCY_TYPE_KEY:\n-                            dependencyType = e.getValue();\n-                            break;\n-                        default:\n-                            throw new IOException(String.format(\"Illegal dependency syntax in package recipe. \"\n-                                    + \"Dependency %s has unknown keyword: %s\", name, k));\n-                    }\n-                }\n-\n-                if (dependencyType.isEmpty()) {\n-                    dependencyPropertiesMap.put(name, new RecipeDependencyProperties(versionRequirements));\n-                    continue;\n-                }\n-                dependencyPropertiesMap.put(name, new RecipeDependencyProperties(versionRequirements, dependencyType));\n-            }\n-            return dependencyPropertiesMap;\n-        }\n-    }\n+    String componentType;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NTg0OA=="}, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 218}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzMxNzIyOnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/RedSignal-1.0.0.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoyMToxOVrOHJQSeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODo0MToyNVrOHJQ1Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NjEwNg==", "bodyText": "\"os: all\" not required ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479466106", "createdAt": "2020-08-28T18:21:19Z", "author": {"login": "fahadmohammed01"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/RedSignal-1.0.0.yaml", "diffHunk": "@@ -1,9 +1,11 @@\n ---\n-RecipeTemplateVersion: '2020-01-25'\n+TemplateVersion: '2020-01-25'\n ComponentName: RedSignal\n Description: A service revoking approval to proceed\n Publisher: Me\n Version: '1.0.0'\n-Lifecycle:\n-  run:\n-    \"echo Stop what you are doing\"\n+Manifests:\n+  - Platform:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3NTA0Nw==", "bodyText": "yeah, none of attribute is required.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479475047", "createdAt": "2020-08-28T18:41:25Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/RedSignal-1.0.0.yaml", "diffHunk": "@@ -1,9 +1,11 @@\n ---\n-RecipeTemplateVersion: '2020-01-25'\n+TemplateVersion: '2020-01-25'\n ComponentName: RedSignal\n Description: A service revoking approval to proceed\n Publisher: Me\n Version: '1.0.0'\n-Lifecycle:\n-  run:\n-    \"echo Stop what you are doing\"\n+Manifests:\n+  - Platform:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NjEwNg=="}, "originalCommit": {"oid": "aec9b35137f6de58d43be280c3d7b89ac34bf77b"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzQwMDI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/config/PlatformResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODo1MDoxNlrOHJRE4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODo1MzoyN1rOHJRKGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3OTAxMA==", "bodyText": "Will this break unit test?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479479010", "createdAt": "2020-08-28T18:50:16Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/config/PlatformResolver.java", "diffHunk": "@@ -176,7 +176,7 @@ private static Architecture getArchInfo() {\n      * @param recipeList a list of recipe input\n      * @return closest recipe\n      */\n-    public Optional<PlatformSpecificManifest> findBestMatch(List<PlatformSpecificManifest> recipeList) {\n+    public static Optional<PlatformSpecificManifest> findBestMatch(List<PlatformSpecificManifest> recipeList) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ab1aa5a4345dddd223dd7cbe9febbe8d82ed2d6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ4MDM0NQ==", "bodyText": "no, unit tests are all passed now.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/397#discussion_r479480345", "createdAt": "2020-08-28T18:53:27Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/iot/evergreen/config/PlatformResolver.java", "diffHunk": "@@ -176,7 +176,7 @@ private static Architecture getArchInfo() {\n      * @param recipeList a list of recipe input\n      * @return closest recipe\n      */\n-    public Optional<PlatformSpecificManifest> findBestMatch(List<PlatformSpecificManifest> recipeList) {\n+    public static Optional<PlatformSpecificManifest> findBestMatch(List<PlatformSpecificManifest> recipeList) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3OTAxMA=="}, "originalCommit": {"oid": "8ab1aa5a4345dddd223dd7cbe9febbe8d82ed2d6"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 736, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}