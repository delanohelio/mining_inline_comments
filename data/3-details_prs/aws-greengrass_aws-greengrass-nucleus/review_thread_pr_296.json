{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzODAxNDkz", "number": 296, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1ODoxM1rOEMLzVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNzoyMjoyMVrOEO_xWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjExNzMyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1ODoxM1rOGuJofg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1ODoxM1rOGuJofg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0NTUwMg==", "bodyText": "nit: without", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/296#discussion_r451045502", "createdAt": "2020-07-07T17:58:13Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "diffHunk": "@@ -47,4 +48,24 @@ the instruction from CLI to create a deployment. Upon getting such instruction *\n 3. *DeploymentService* waits for the deployment to get completed and then invokes [***DeploymentStatusKeeper***](/src/main/java/com/aws/iot/evergreen/deployment/DeploymentStatusKeeper.java) \n to update the status of the job. Currently *DeploymentStatusKeeper* does not do anything for LOCAL deployment types\n     \n-  \n+## Multiple Group Deployments\n+An Iot device can belong to mutiple Iot ThingGroups. When a configuration is set and published for any such group, \n+that results in a deployment on every device in that group. As device can belong to multiple groups, the device needs\n+ to maintain a status of what components are being deployed as part of which groups. This is needed so that a \n+ deployment for one group does not remove the components deployed previously as part of another group. Any \n+ deployments done outside of ThingGroup are treated as belonging to DEFAULT group. This would include individual \n+ device deployment (done via Iot Device shadows), local deployment (wthout mentioning any group).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "526f4d29455e4232edd5932619682b85ed66c584"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjExODM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1ODozM1rOGuJpNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNzo1ODozM1rOGuJpNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0NTY4NA==", "bodyText": "nit: multiple", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/296#discussion_r451045684", "createdAt": "2020-07-07T17:58:33Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "diffHunk": "@@ -47,4 +48,24 @@ the instruction from CLI to create a deployment. Upon getting such instruction *\n 3. *DeploymentService* waits for the deployment to get completed and then invokes [***DeploymentStatusKeeper***](/src/main/java/com/aws/iot/evergreen/deployment/DeploymentStatusKeeper.java) \n to update the status of the job. Currently *DeploymentStatusKeeper* does not do anything for LOCAL deployment types\n     \n-  \n+## Multiple Group Deployments\n+An Iot device can belong to mutiple Iot ThingGroups. When a configuration is set and published for any such group, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "526f4d29455e4232edd5932619682b85ed66c584"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjEyNjcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODowMDo0NFrOGuJueQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODowMDo0NFrOGuJueQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0NzAzMw==", "bodyText": "nit: \", \"", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/296#discussion_r451047033", "createdAt": "2020-07-07T18:00:44Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "diffHunk": "@@ -47,4 +48,24 @@ the instruction from CLI to create a deployment. Upon getting such instruction *\n 3. *DeploymentService* waits for the deployment to get completed and then invokes [***DeploymentStatusKeeper***](/src/main/java/com/aws/iot/evergreen/deployment/DeploymentStatusKeeper.java) \n to update the status of the job. Currently *DeploymentStatusKeeper* does not do anything for LOCAL deployment types\n     \n-  \n+## Multiple Group Deployments\n+An Iot device can belong to mutiple Iot ThingGroups. When a configuration is set and published for any such group, \n+that results in a deployment on every device in that group. As device can belong to multiple groups, the device needs\n+ to maintain a status of what components are being deployed as part of which groups. This is needed so that a \n+ deployment for one group does not remove the components deployed previously as part of another group. Any \n+ deployments done outside of ThingGroup are treated as belonging to DEFAULT group. This would include individual \n+ device deployment (done via Iot Device shadows), local deployment (wthout mentioning any group).\n+ 1. [***DeploymentService***](/src/main/java/com/aws/iot/evergreen/deployment/DeploymentService.java) maintains a \n+ mapping of groupName to the root components and their version constraints ,deployed as ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "526f4d29455e4232edd5932619682b85ed66c584"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MTYwMzQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNzoyMjoyMVrOGydYHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNzoyMjoyMVrOGydYHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTU2MzI5Mg==", "bodyText": "bad link, I think, this is just going to the directory instead of the file", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/296#discussion_r455563292", "createdAt": "2020-07-16T07:22:21Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/README.md", "diffHunk": "@@ -47,4 +48,24 @@ the instruction from CLI to create a deployment. Upon getting such instruction *\n 3. *DeploymentService* waits for the deployment to get completed and then invokes [***DeploymentStatusKeeper***](/src/main/java/com/aws/iot/evergreen/deployment/DeploymentStatusKeeper.java) \n to update the status of the job. Currently *DeploymentStatusKeeper* does not do anything for LOCAL deployment types\n     \n-  \n+## Multiple Group Deployments\n+An Iot device can belong to mutiple Iot ThingGroups. When a configuration is set and published for any such group, \n+that results in a deployment on every device in that group. As device can belong to multiple groups, the device needs\n+ to maintain a status of what components are being deployed as part of which groups. This is needed so that a \n+ deployment for one group does not remove the components deployed previously as part of another group. Any \n+ deployments done outside of ThingGroup are treated as belonging to DEFAULT group. This would include individual \n+ device deployment (done via Iot Device shadows), local deployment (wthout mentioning any group).\n+ 1. [***DeploymentService***](/src/main/java/com/aws/iot/evergreen/deployment/DeploymentService.java) maintains a \n+ mapping of groupName to the root components and their version constraints ,deployed as \n+ part of that group.This \n+ mapping is stored in the DeploymentService's [***Configuration***](/src/main/java/com/aws/iot/evergreen/config/Configuration.java).\n+ 2. Upon receiving a new deployment from the *DeploymentsQueue*, when constructing the new configuration for the \n+ kernel, the [***DeploymentTask***](/src/main/java/com/aws/iot/evergreen/deployment/DeploymentTask.java) uses the \n+ saved mapping to calculate the set of root components. For the group that is being deployed, it takes the root \n+ components from the deployment document. For all other groups it takes the root components from the saved mapping.\n+ 3. [***DependencyResolver***](/src/main/java/com/aws/iot/evergreen/deployment/) uses the saved mapping to calculate ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "526f4d29455e4232edd5932619682b85ed66c584"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4372, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}