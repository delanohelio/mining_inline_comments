{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNjk5NTEw", "number": 706, "title": "Use new cloud api model", "bodyText": "Issue #, if available:\nDescription of changes:\nNew model was built from this java client version  https://code.amazon.com/packages/AWSGreengrassV2JavaClient/commits/d483108916f4cae1370a7e9fc62c9115e47d0819#\nUltimately, this should come from the AWS SDK maven repo, but it won't be released to the SDK public maven repo yet. Until then it comes from S3 like the old SDK.\nThere was a different open PR https://github.com/aws/aws-greengrass-nucleus/pull/675/files  for data plane changes which was using a different build of the SDK. But with new latest cloud API changes, the SDK changed again which is used in this PR. I had to consolidate that PR with this one to make everything work with the new SDK build. So I have merged that PR into this branch.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-19T06:04:11Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706", "merged": true, "mergeCommit": {"oid": "1041c19a961b62dddda016af6608b1e8bccbd405"}, "closed": true, "closedAt": "2020-11-23T20:13:55Z", "author": {"login": "shaguptashaikh"}, "timelineItems": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeFdw-AFqTUzNDYzMzkzMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfa9BIAFqTUzNjgxMDgzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjMzOTMz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#pullrequestreview-534633933", "createdAt": "2020-11-19T16:36:59Z", "commit": {"oid": "feea9a100db3684ed0b338a1244777291a4164ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjozNjo1OVrOH2nWuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjozNjo1OVrOH2nWuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyOTk0Nw==", "bodyText": "This is what I'm looking for. I will let you know Shagupta", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#discussion_r527029947", "createdAt": "2020-11-19T16:36:59Z", "author": {"login": "leaf94"}, "path": "src/main/java/com/aws/greengrass/componentmanager/plugins/GreengrassRepositoryDownloader.java", "diffHunk": "@@ -168,15 +168,15 @@ private void retrieveArtifactInfo() throws PackageDownloadException, Interrupted\n \n     private URL getArtifactDownloadURL(ComponentIdentifier componentIdentifier, String artifactName)\n             throws PackageDownloadException {\n-        GetComponentVersionArtifactDeprecatedRequest getComponentArtifactRequest =\n-                new GetComponentVersionArtifactDeprecatedRequest().withArtifactName(artifactName)\n-                        .withComponentName(componentIdentifier.getName())\n-                        .withComponentVersion(componentIdentifier.getVersion().toString());\n+        // TODO : UPDATE_MODEL : use ARN when the PR to handle ARN is checked in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feea9a100db3684ed0b338a1244777291a4164ac"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "feea9a100db3684ed0b338a1244777291a4164ac", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/feea9a100db3684ed0b338a1244777291a4164ac", "committedDate": "2020-11-19T05:58:23Z", "message": "Use new cloud api model"}, "afterCommit": {"oid": "d52dd9919af7d7a5930a28a0a0fe599b6832ec67", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d52dd9919af7d7a5930a28a0a0fe599b6832ec67", "committedDate": "2020-11-19T18:51:09Z", "message": "Fix benchmark"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d52dd9919af7d7a5930a28a0a0fe599b6832ec67", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d52dd9919af7d7a5930a28a0a0fe599b6832ec67", "committedDate": "2020-11-19T18:51:09Z", "message": "Fix benchmark"}, "afterCommit": {"oid": "0fb8852ced2b7d2057fa8fb8716f3261862df93d", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0fb8852ced2b7d2057fa8fb8716f3261862df93d", "committedDate": "2020-11-19T21:26:21Z", "message": "Merge use_component_arn branch to get data plane cloud API changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0fb8852ced2b7d2057fa8fb8716f3261862df93d", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0fb8852ced2b7d2057fa8fb8716f3261862df93d", "committedDate": "2020-11-19T21:26:21Z", "message": "Merge use_component_arn branch to get data plane cloud API changes"}, "afterCommit": {"oid": "b6c7a477f485349b06c2c2516c4b1eace9a0a2f4", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b6c7a477f485349b06c2c2516c4b1eace9a0a2f4", "committedDate": "2020-11-19T22:01:21Z", "message": "Merge use_component_arn branch to get data plane cloud API changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0ODk3NTgz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#pullrequestreview-534897583", "createdAt": "2020-11-19T22:10:11Z", "commit": {"oid": "b6c7a477f485349b06c2c2516c4b1eace9a0a2f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMjoxMDoxMVrOH2z7DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMjoxMDoxMVrOH2z7DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIzNTg1Mg==", "bodyText": "What's FINALCP ? Final is always a dangerous word to have in a version, it never is.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#discussion_r527235852", "createdAt": "2020-11-19T22:10:11Z", "author": {"login": "JamieHunter"}, "path": "pom.xml", "diffHunk": "@@ -101,7 +101,7 @@\n         <dependency>\n             <groupId>com.amazonaws.services</groupId>\n             <artifactId>evergreen</artifactId>\n-            <version>1.1.100</version>\n+            <version>1.0.0-FINALCP-SNAPSHOT</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6c7a477f485349b06c2c2516c4b1eace9a0a2f4"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04a6250e43eaadb68505c571700f245580318f3e", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/04a6250e43eaadb68505c571700f245580318f3e", "committedDate": "2020-11-19T23:40:08Z", "message": "Fix unit tests"}, "afterCommit": {"oid": "fe6fc4f7c867090fa367f08b3002637a13138522", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fe6fc4f7c867090fa367f08b3002637a13138522", "committedDate": "2020-11-19T23:56:44Z", "message": "Fix unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcd722bfbcd9b9505b0bc31d7126546ad65de2bf", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bcd722bfbcd9b9505b0bc31d7126546ad65de2bf", "committedDate": "2020-11-20T00:55:56Z", "message": "Fix integ tests"}, "afterCommit": {"oid": "29aaa1491482ed53ce3e6be61bebfd68c93dddc3", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/29aaa1491482ed53ce3e6be61bebfd68c93dddc3", "committedDate": "2020-11-20T01:07:07Z", "message": "Fix integ tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e21eb92b0c7485492a78a97c28749bd256c0b677", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e21eb92b0c7485492a78a97c28749bd256c0b677", "committedDate": "2020-11-20T02:23:35Z", "message": "Temporarily diable artifact cleanup for debugging"}, "afterCommit": {"oid": "144ffe1fa3e21f9a69dfb790b557e73409e7e4fe", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/144ffe1fa3e21f9a69dfb790b557e73409e7e4fe", "committedDate": "2020-11-20T02:35:42Z", "message": "Temporarily diable artifact cleanup for debugging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "144ffe1fa3e21f9a69dfb790b557e73409e7e4fe", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/144ffe1fa3e21f9a69dfb790b557e73409e7e4fe", "committedDate": "2020-11-20T02:35:42Z", "message": "Temporarily diable artifact cleanup for debugging"}, "afterCommit": {"oid": "c4d2a5670e7f2859539a41d4ddf59a3c872404ec", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c4d2a5670e7f2859539a41d4ddf59a3c872404ec", "committedDate": "2020-11-20T02:45:32Z", "message": "Temporarily disable artifact upload for e2e to test other E2E while blocked on cloud team"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18b04737666500880c2e857853ed0c6c5dedaa67", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/18b04737666500880c2e857853ed0c6c5dedaa67", "committedDate": "2020-11-20T18:22:45Z", "message": "Merge branch 'master' into cloud-api-changes"}, "afterCommit": {"oid": "b2b1abee24551503a27e6a9e43b4d8c90285710f", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b2b1abee24551503a27e6a9e43b4d8c90285710f", "committedDate": "2020-11-20T18:49:09Z", "message": "Temporarily disable artifact upload for e2e to test other E2E while blocked on cloud team"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2b1abee24551503a27e6a9e43b4d8c90285710f", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b2b1abee24551503a27e6a9e43b4d8c90285710f", "committedDate": "2020-11-20T18:49:09Z", "message": "Temporarily disable artifact upload for e2e to test other E2E while blocked on cloud team"}, "afterCommit": {"oid": "d75336def1c3d9ffefd131d54db34e990ef49a9b", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d75336def1c3d9ffefd131d54db34e990ef49a9b", "committedDate": "2020-11-20T21:30:55Z", "message": "Fix data plane endpoints"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cae2a47153c5bc4838b45f81a52be45f9759de32", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cae2a47153c5bc4838b45f81a52be45f9759de32", "committedDate": "2020-11-20T23:32:27Z", "message": "Update SDK and try tests again"}, "afterCommit": {"oid": "26560a70dc02dcfa0ef8c07ea42248283908c920", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/26560a70dc02dcfa0ef8c07ea42248283908c920", "committedDate": "2020-11-20T23:32:47Z", "message": "Update SDK and try tests again"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd19cbf5659874f6d436be74b1a3b5fab4fc9ffe", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fd19cbf5659874f6d436be74b1a3b5fab4fc9ffe", "committedDate": "2020-11-20T23:53:59Z", "message": "Try with Greg`s personal stack"}, "afterCommit": {"oid": "2b619e8926bd5dba4de3c2fbc96acce8d9409a85", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2b619e8926bd5dba4de3c2fbc96acce8d9409a85", "committedDate": "2020-11-21T00:55:42Z", "message": "Revert \"Try with Greg`s personal stack\"\n\nThis reverts commit fd19cbf5659874f6d436be74b1a3b5fab4fc9ffe."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd31e8389eec75a80b8dfec7662af7103e58f292", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cd31e8389eec75a80b8dfec7662af7103e58f292", "committedDate": "2020-11-21T01:07:25Z", "message": "Getting logs"}, "afterCommit": {"oid": "fc7e4070fe7675112c778ee3d11b7df5628fc4ac", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fc7e4070fe7675112c778ee3d11b7df5628fc4ac", "committedDate": "2020-11-21T09:32:01Z", "message": "Update job namespace id"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f627872fd1552c77a9a5f2dd0ad3169bcf84667b", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f627872fd1552c77a9a5f2dd0ad3169bcf84667b", "committedDate": "2020-11-21T09:32:42Z", "message": "Merge branch 'master' into cloud-api-changes"}, "afterCommit": {"oid": "61a46372ca5931219b306e0dea57d1ccee6ddc31", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/61a46372ca5931219b306e0dea57d1ccee6ddc31", "committedDate": "2020-11-21T09:41:42Z", "message": "Update job namespace id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "439219c93aaa111d20f0860ded90f24c65e8ad57", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/439219c93aaa111d20f0860ded90f24c65e8ad57", "committedDate": "2020-11-23T18:25:24Z", "message": "Use new cloud api model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a228a5c78ba6865d034882915e204469f0610388", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a228a5c78ba6865d034882915e204469f0610388", "committedDate": "2020-11-23T18:25:24Z", "message": "Fix benchmark"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc548103a9d277199a59204f5a81126129565aa2", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cc548103a9d277199a59204f5a81126129565aa2", "committedDate": "2020-11-23T18:25:24Z", "message": "Merge use_component_arn branch to get data plane cloud API changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "548ef82d9ee37db1e937fe3a96ec16d46cb72553", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/548ef82d9ee37db1e937fe3a96ec16d46cb72553", "committedDate": "2020-11-23T18:25:24Z", "message": "E2E cleanup fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64e987fb601a554a14c7c95c84c4409467282a15", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/64e987fb601a554a14c7c95c84c4409467282a15", "committedDate": "2020-11-23T18:25:24Z", "message": "Fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04f04da5227762078923c517791163a8f6d02ef", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f04f04da5227762078923c517791163a8f6d02ef", "committedDate": "2020-11-23T18:25:24Z", "message": "Move back E2E tests to Gamma"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ee0d176b9274bc67014b0919cf2c99ce717046", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f1ee0d176b9274bc67014b0919cf2c99ce717046", "committedDate": "2020-11-23T18:25:24Z", "message": "Fix integ tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "814bf1422824b77a4398d92308b50b8420d9abe4", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/814bf1422824b77a4398d92308b50b8420d9abe4", "committedDate": "2020-11-23T18:25:24Z", "message": "Temporarily disable artifact upload for e2e to test other E2E while blocked on cloud team"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce0aa5aab5f5b15c2cf2f6180b5ccd05487e357a", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ce0aa5aab5f5b15c2cf2f6180b5ccd05487e357a", "committedDate": "2020-11-23T18:25:24Z", "message": "Fix data plane endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f71d97b09693d7c42a8206b04553257336af4b56", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f71d97b09693d7c42a8206b04553257336af4b56", "committedDate": "2020-11-23T18:25:24Z", "message": "Reenable S3 artifacts test components for e2e to reproduce create failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f5b9c4efbe94848a95d8dfacbc46e5882adced5", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6f5b9c4efbe94848a95d8dfacbc46e5882adced5", "committedDate": "2020-11-23T18:25:24Z", "message": "Try Beta to see if create component works there"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3877437c73c07ef3d3bcef6d6fcbdad87e3e5f9d", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3877437c73c07ef3d3bcef6d6fcbdad87e3e5f9d", "committedDate": "2020-11-23T18:25:24Z", "message": "Update SDK and try tests again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7938d3265fcd5aa00f4dfb39d6a70b74edf4b78", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c7938d3265fcd5aa00f4dfb39d6a70b74edf4b78", "committedDate": "2020-11-23T18:25:24Z", "message": "Try with Greg`s personal stack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af30729b9fbf03361848ac2fdf7256f3d3ed3fd2", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/af30729b9fbf03361848ac2fdf7256f3d3ed3fd2", "committedDate": "2020-11-23T18:25:24Z", "message": "Revert \"Try with Greg`s personal stack\"\n\nThis reverts commit fd19cbf5659874f6d436be74b1a3b5fab4fc9ffe."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4933d6c14b2048da4374469d497455cfd06e560c", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4933d6c14b2048da4374469d497455cfd06e560c", "committedDate": "2020-11-23T18:25:24Z", "message": "Update job namespace id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb493ebfd8a2311b85fd4d922454972c5573e7e6", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/eb493ebfd8a2311b85fd4d922454972c5573e7e6", "committedDate": "2020-11-23T18:33:48Z", "message": "Switch back to gamma endpoint, fix exception type to ingore, remove log added for debugging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2eedfbf7b952b5c470bdb9a90e078b58b54fbbef", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2eedfbf7b952b5c470bdb9a90e078b58b54fbbef", "committedDate": "2020-11-21T09:42:21Z", "message": "Merge branch 'master' into cloud-api-changes"}, "afterCommit": {"oid": "eb493ebfd8a2311b85fd4d922454972c5573e7e6", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/eb493ebfd8a2311b85fd4d922454972c5573e7e6", "committedDate": "2020-11-23T18:33:48Z", "message": "Switch back to gamma endpoint, fix exception type to ingore, remove log added for debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6098b776a096d1790d94c25428c1a1692c08d15", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b6098b776a096d1790d94c25428c1a1692c08d15", "committedDate": "2020-11-23T18:44:33Z", "message": "Fall back to beta again, gamma still doesn`t work"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dedb3c709f209cbdc17600fcda52795a9499c17", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7dedb3c709f209cbdc17600fcda52795a9499c17", "committedDate": "2020-11-23T19:26:01Z", "message": "Fix expected exception type to ingore in e2e"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9a5afe775e7e25e94dbab76919bfcd3b8b8d9a8", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f9a5afe775e7e25e94dbab76919bfcd3b8b8d9a8", "committedDate": "2020-11-23T19:13:01Z", "message": "Fix expected exception type to ingore in e2e"}, "afterCommit": {"oid": "7dedb3c709f209cbdc17600fcda52795a9499c17", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7dedb3c709f209cbdc17600fcda52795a9499c17", "committedDate": "2020-11-23T19:26:01Z", "message": "Fix expected exception type to ingore in e2e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2Nzk0NDUy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#pullrequestreview-536794452", "createdAt": "2020-11-23T19:48:18Z", "commit": {"oid": "7dedb3c709f209cbdc17600fcda52795a9499c17"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTo0ODoxOFrOH4c42g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxOTo0ODoxOFrOH4c42g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk1NTYxMA==", "bodyText": "nit - do we need to assert like this? If it doesn't throw I guess we should be good?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#discussion_r528955610", "createdAt": "2020-11-23T19:48:18Z", "author": {"login": "leaf94"}, "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -204,9 +206,16 @@ static void afterAll() {\n         try {\n             List<ComponentIdentifier> allComponents = new ArrayList<>(Arrays.asList(componentsWithArtifactsInS3));\n             for (ComponentIdentifier component : allComponents) {\n-                DeleteComponentVersionDeprecatedResult result = ComponentServiceHelper\n-                        .deleteComponent(greengrassClient, component.getName(), component.getVersion().toString());\n-                assertEquals(200, result.getSdkHttpMetadata().getHttpStatusCode());\n+                String componentArn = componentArns.get(component);\n+                if (Utils.isEmpty(componentArn)) {\n+                    logger.atWarn().kv(\"component-name\", component.getName())\n+                            .kv(\"compoenent-version\", component.getVersion())\n+                            .log(\"No component arn found to make delete request for cleanup\");\n+                } else {\n+                    DeleteComponentResult result =\n+                            ComponentServiceTestHelper.deleteComponent(greengrassClient, componentArn);\n+                    assertEquals(200, result.getSdkHttpMetadata().getHttpStatusCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dedb3c709f209cbdc17600fcda52795a9499c17"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b44ecac127664450400975c174652863a5b9f5d", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7b44ecac127664450400975c174652863a5b9f5d", "committedDate": "2020-11-23T19:56:39Z", "message": "Gamma endpoint is fixed, switch e2e back to gamma"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2ODAzNjM2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#pullrequestreview-536803636", "createdAt": "2020-11-23T20:01:53Z", "commit": {"oid": "7b44ecac127664450400975c174652863a5b9f5d"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMDowMTo1NFrOH4dV7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMDowODozNFrOH4di7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2MzA1Mg==", "bodyText": "Can be removed", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#discussion_r528963052", "createdAt": "2020-11-23T20:01:54Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/greengrass/componentmanager/ComponentServiceHelper.java", "diffHunk": "@@ -80,19 +61,19 @@ ComponentContent resolveComponentVersion(String componentName, Semver localCandi\n                         .withArchitecture(platformResolver.getCurrentPlatform().get(PlatformResolver.ARCHITECTURE_KEY));\n         Map<String, String> versionRequirementsInString = versionRequirements.entrySet().stream()\n                 .collect(Collectors.toMap(Map.Entry::getKey, e -> e.getValue().toString()));\n-        ComponentCandidate candidate = new ComponentCandidate().withName(componentName)\n-                .withVersion(localCandidateVersion == null ? null : localCandidateVersion.getValue())\n+        ComponentCandidate candidate = new ComponentCandidate().withComponentName(componentName)\n+                .withComponentVersion(localCandidateVersion == null ? null : localCandidateVersion.getValue())\n                 .withVersionRequirements(versionRequirementsInString);\n-        ResolveComponentVersionsRequest request = new ResolveComponentVersionsRequest().withPlatform(platform)\n-                .withComponentCandidates(Collections.singletonList(candidate))\n-                // TODO: [P41215565]: Switch back deploymentConfigurationId once it's removed from URL path\n-                // use UUID to avoid ARN complication in URL, deploymentConfigurationId is used for logging purpose\n-                // in server, so could have this hack now\n-                .withDeploymentConfigurationId(UUID.randomUUID().toString());\n-\n-        ResolveComponentVersionsResult result;\n+        ResolveComponentCandidatesRequest request = new ResolveComponentCandidatesRequest().withPlatform(platform)\n+                .withComponentCandidates(Collections.singletonList(candidate));\n+        // TODO: [P41215565]: Switch back deploymentConfigurationId once it's removed from URL path\n+        // use UUID to avoid ARN complication in URL, deploymentConfigurationId is used for logging purpose\n+        // in server, so could have this hack now\n+        //.withDeploymentConfigurationId(UUID.randomUUID().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b44ecac127664450400975c174652863a5b9f5d"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2MzI5Mw==", "bodyText": "nit: should we call it gcs?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#discussion_r528963293", "createdAt": "2020-11-23T20:02:20Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/greengrass/componentmanager/ComponentServiceHelper.java", "diffHunk": "@@ -80,19 +61,19 @@ ComponentContent resolveComponentVersion(String componentName, Semver localCandi\n                         .withArchitecture(platformResolver.getCurrentPlatform().get(PlatformResolver.ARCHITECTURE_KEY));\n         Map<String, String> versionRequirementsInString = versionRequirements.entrySet().stream()\n                 .collect(Collectors.toMap(Map.Entry::getKey, e -> e.getValue().toString()));\n-        ComponentCandidate candidate = new ComponentCandidate().withName(componentName)\n-                .withVersion(localCandidateVersion == null ? null : localCandidateVersion.getValue())\n+        ComponentCandidate candidate = new ComponentCandidate().withComponentName(componentName)\n+                .withComponentVersion(localCandidateVersion == null ? null : localCandidateVersion.getValue())\n                 .withVersionRequirements(versionRequirementsInString);\n-        ResolveComponentVersionsRequest request = new ResolveComponentVersionsRequest().withPlatform(platform)\n-                .withComponentCandidates(Collections.singletonList(candidate))\n-                // TODO: [P41215565]: Switch back deploymentConfigurationId once it's removed from URL path\n-                // use UUID to avoid ARN complication in URL, deploymentConfigurationId is used for logging purpose\n-                // in server, so could have this hack now\n-                .withDeploymentConfigurationId(UUID.randomUUID().toString());\n-\n-        ResolveComponentVersionsResult result;\n+        ResolveComponentCandidatesRequest request = new ResolveComponentCandidatesRequest().withPlatform(platform)\n+                .withComponentCandidates(Collections.singletonList(candidate));\n+        // TODO: [P41215565]: Switch back deploymentConfigurationId once it's removed from URL path\n+        // use UUID to avoid ARN complication in URL, deploymentConfigurationId is used for logging purpose\n+        // in server, so could have this hack now\n+        //.withDeploymentConfigurationId(UUID.randomUUID().toString());\n+\n+        ResolveComponentCandidatesResult result;\n         try {\n-            result = clientFactory.getCmsClient().resolveComponentVersions(request);\n+            result = clientFactory.getCmsClient().resolveComponentCandidates(request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b44ecac127664450400975c174652863a5b9f5d"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NTEzOA==", "bodyText": "Should be able to delete the function.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#discussion_r528965138", "createdAt": "2020-11-23T20:06:00Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/greengrass/componentmanager/ComponentStore.java", "diffHunk": "@@ -235,7 +249,7 @@ ComponentMetadata getPackageMetadata(@NonNull ComponentIdentifier pkgId) throws\n      */\n     List<ComponentMetadata> listAvailablePackageMetadata(@NonNull String packageName, @NonNull Requirement requirement)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b44ecac127664450400975c174652863a5b9f5d"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2NjM4Mw==", "bodyText": "The exception should be renamed, and probably examine exception hierarchy.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#discussion_r528966383", "createdAt": "2020-11-23T20:08:34Z", "author": {"login": "wikimonkey"}, "path": "src/main/java/com/aws/greengrass/componentmanager/ComponentStore.java", "diffHunk": "@@ -409,4 +429,102 @@ private static Semver parseVersionFromFileName(String filename) throws PackageLo\n         }\n     }\n \n+    /**\n+     * Saves recipe metadata to file. Overrides if the target file exists.\n+     *\n+     * @param componentIdentifier component id\n+     * @param recipeMetadata      metadata for the recipe\n+     * @throws PackageLoadingException when failed write recipe metadata to file system.\n+     */\n+    public void saveRecipeMetadata(ComponentIdentifier componentIdentifier, RecipeMetadata recipeMetadata)\n+            throws PackageLoadingException {\n+        File metadataFile = resolveRecipeMetadataFile(componentIdentifier);\n+\n+        try {\n+            SerializerFactory.getFailSafeJsonObjectMapper().writeValue(metadataFile, recipeMetadata);\n+        } catch (IOException e) {\n+            logger.atError().cause(e).kv(RECIPE_METADATA_FILE_PATH_LOG_KEY, metadataFile.getAbsolutePath())\n+                    .log(\"Failed to write recipe metadata file\");\n+\n+            throw new PackageLoadingException(\n+                    String.format(\"Failed to write recipe metadata to file: '%s'.\", metadataFile.getAbsolutePath()), e);\n+        }\n+    }\n+\n+    /**\n+     * Reads component recipe metadata file.\n+     *\n+     * @param componentIdentifier component id\n+     * @throws PackageLoadingException if failed to read recipe metadata from file system or failed to parse the file.\n+     */\n+    public RecipeMetadata getRecipeMetadata(ComponentIdentifier componentIdentifier) throws PackageLoadingException {\n+        File metadataFile = resolveRecipeMetadataFile(componentIdentifier);\n+\n+        if (!metadataFile.exists() || !metadataFile.isFile()) {\n+            // log error because this is not expected to happen in any normal case\n+            logger.atError().kv(RECIPE_METADATA_FILE_PATH_LOG_KEY, metadataFile.getAbsolutePath())\n+                    .log(\"Failed to get recipe metadata because the file doesn't not exit or it is a folder\");\n+\n+            throw new PackageLoadingException(String.format(\n+                    \"Failed to get recipe metadata because the file doesn't not exit or it is a folder. \"\n+                            + RECIPE_METADATA_FILE_PATH_LOG_KEY + \": '%s'.\", metadataFile.getAbsolutePath()));\n+        }\n+\n+        try {\n+            return SerializerFactory.getFailSafeJsonObjectMapper().readValue(metadataFile, RecipeMetadata.class);\n+\n+            // exception handling is intentionally heavy so that to deal with file corruption\n+            // TODO review note: I struggled btw having the below or removing it. Tried to remove it and feel a single\n+            // catch on IOException and saying file is corrupted is a little thin.\n+            // Furthermore, we should do the similar to recipe file! That's a lot more important.\n+        } catch (JsonParseException e) {\n+            // log error because this is not expected to happen in any normal case\n+            logger.atError().cause(e).kv(RECIPE_METADATA_FILE_PATH_LOG_KEY, metadataFile.getAbsolutePath())\n+                    .log(\"Failed to get recipe metadata because the recipe metadata file should be a json \"\n+                                 + \"but is corrupted\");\n+\n+            throw new PackageLoadingException(String.format(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b44ecac127664450400975c174652863a5b9f5d"}, "originalPosition": 225}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2ODEwODMw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/706#pullrequestreview-536810830", "createdAt": "2020-11-23T20:13:04Z", "commit": {"oid": "7b44ecac127664450400975c174652863a5b9f5d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2723, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}