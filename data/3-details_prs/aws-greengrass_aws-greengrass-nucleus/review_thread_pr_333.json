{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NDI4MDI5", "number": 333, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMjo1MTo1M1rOESlfqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToyMjoyMlrOETDu5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3OTI0MTM2OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMjo1MTo1M1rOG32VtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMjo1ODo0MlrOG32fWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNTE1Ng==", "bodyText": "Does author have to specify the class? Is there a default value?\nIs it a good idea to use absolute namespace? what about the class path got changed later?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461215156", "createdAt": "2020-07-27T22:51:53Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+Class: com.aws.iot.evergreen.kernel.EvergreenService", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNTY1Mg==", "bodyText": "Author needs to specify if they want something other than the default. Default is empty, which will use GenericExternalService.\nWe internally use Class.forName() which I believe can work without the whole classpath specified as long as the class name is unique.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461215652", "createdAt": "2020-07-27T22:53:18Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+Class: com.aws.iot.evergreen.kernel.EvergreenService", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNTE1Ng=="}, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNjg5MQ==", "bodyText": "Can we make the attribute optional if it's a necessary change?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461216891", "createdAt": "2020-07-27T22:56:36Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+Class: com.aws.iot.evergreen.kernel.EvergreenService", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNTE1Ng=="}, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNzYyNQ==", "bodyText": "It is optional", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461217625", "createdAt": "2020-07-27T22:58:42Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+Class: com.aws.iot.evergreen.kernel.EvergreenService", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNTE1Ng=="}, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzM5NTcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageRecipe.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDozNDo1MlrOG4dziA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDozNzoxOVrOG4d4kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2MTc2OA==", "bodyText": "Curious, can you use @AllArgsConstructor @JsonSetter(nulls = Nulls.AS_EMPTY) and @JsonNaming(PropertyNamingStrategy.UpperCamelCaseStrategy.class) ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461861768", "createdAt": "2020-07-28T20:34:52Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageRecipe.java", "diffHunk": "@@ -79,13 +82,13 @@ public PackageRecipe(@JsonProperty(\"RecipeTemplateVersion\") RecipeTemplateVersio\n                          @JsonProperty(\"ComponentName\") String componentName, @JsonProperty(\"Version\") Semver version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2MzA1OQ==", "bodyText": "Don't think so because there's custom logic in the constructor as well as custom deserializers", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461863059", "createdAt": "2020-07-28T20:37:19Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageRecipe.java", "diffHunk": "@@ -79,13 +82,13 @@ public PackageRecipe(@JsonProperty(\"RecipeTemplateVersion\") RecipeTemplateVersio\n                          @JsonProperty(\"ComponentName\") String componentName, @JsonProperty(\"Version\") Semver version,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2MTc2OA=="}, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzkxMjgzOnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzowMDoyMVrOG4ipxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzowNDowMlrOG4iufg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk0MTE5MQ==", "bodyText": "What is Raw type?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461941191", "createdAt": "2020-07-28T23:00:21Z", "author": {"login": "fengwang666"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+ComponentType: Raw", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk0MjM5OA==", "bodyText": "A made up type for testing. It will use EvergreenService directly, otherwise there's no way to tell that locate actually used the component type for anything, since it would just give me a GenericExternalService", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461942398", "createdAt": "2020-07-28T23:04:02Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+ComponentType: Raw", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk0MTE5MQ=="}, "originalCommit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzkxNzYzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzowMjozNFrOG4isqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzowMjozNFrOG4isqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk0MTkzMQ==", "bodyText": "Add unit tests for these two types?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461941931", "createdAt": "2020-07-28T23:02:34Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -119,6 +125,10 @@ public Kernel() {\n         context.put(DeploymentActivatorFactory.class, new DeploymentActivatorFactory(this));\n         context.put(BootstrapManager.class, new BootstrapManager(this));\n         context.put(Clock.class, Clock.systemUTC());\n+        Map<String, String> typeToClassMap = new ConcurrentHashMap<>();\n+        typeToClassMap.put(\"generic\", GenericExternalService.class.getName());\n+        typeToClassMap.put(\"lambda\", \"com.aws.iot.evergreen.lambdamanager.UserLambdaService\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDE5NTU3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToyMjoyMlrOG4lNNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToyNTozNFrOG4lQsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MzAyOQ==", "bodyText": "Are we okay with needing a new kernel version in rare cases where a new lambda manager version changes this class ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461983029", "createdAt": "2020-07-29T01:22:22Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -119,6 +125,10 @@ public Kernel() {\n         context.put(DeploymentActivatorFactory.class, new DeploymentActivatorFactory(this));\n         context.put(BootstrapManager.class, new BootstrapManager(this));\n         context.put(Clock.class, Clock.systemUTC());\n+        Map<String, String> typeToClassMap = new ConcurrentHashMap<>();\n+        typeToClassMap.put(\"generic\", GenericExternalService.class.getName());\n+        typeToClassMap.put(\"lambda\", \"com.aws.iot.evergreen.lambdamanager.UserLambdaService\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4d6687bb77f259d4d07760ffca3b44addffd80f"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MzkyMg==", "bodyText": "It should be treated as a breaking change if we ever rename or move it. After talking with Jamie and Feng, we decided that having this map was a bit of a better solution than exposing the class name to customers. As I mention in the updated PR description, we can't have this be dynamic because there's a race which it will always lose between updating this map and lambda services being created in the kernel.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461983922", "createdAt": "2020-07-29T01:25:34Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -119,6 +125,10 @@ public Kernel() {\n         context.put(DeploymentActivatorFactory.class, new DeploymentActivatorFactory(this));\n         context.put(BootstrapManager.class, new BootstrapManager(this));\n         context.put(Clock.class, Clock.systemUTC());\n+        Map<String, String> typeToClassMap = new ConcurrentHashMap<>();\n+        typeToClassMap.put(\"generic\", GenericExternalService.class.getName());\n+        typeToClassMap.put(\"lambda\", \"com.aws.iot.evergreen.lambdamanager.UserLambdaService\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MzAyOQ=="}, "originalCommit": {"oid": "d4d6687bb77f259d4d07760ffca3b44addffd80f"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4451, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}