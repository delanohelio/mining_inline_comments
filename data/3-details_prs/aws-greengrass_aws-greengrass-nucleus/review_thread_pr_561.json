{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NjcyOTM4", "number": 561, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMTo0NDo1M1rOEyGZAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoxNDozOVrOEydjNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTY4OTYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/Topic.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMTo0NDo1M1rOHojlLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMDoxMjo1MFrOHom47w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODA0Nw==", "bodyText": "do you need the proposed == null && value == null? Objects.equals(null, null) is true so the first predicate should match", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512288047", "createdAt": "2020-10-26T21:44:53Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncrease allow the timestamp to go forward in time without changing the value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncrease) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease = allowTimestampToIncrease && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)\n+                || !allowTimestampToDecrease && (proposedModtime < currentModTime))\n+                && !timestampWouldIncrease || proposed == null && value == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI5MDMyMQ==", "bodyText": "Yes, but !timestampWouldIncrease won't necessarily match", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512290321", "createdAt": "2020-10-26T21:50:01Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncrease allow the timestamp to go forward in time without changing the value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncrease) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease = allowTimestampToIncrease && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)\n+                || !allowTimestampToDecrease && (proposedModtime < currentModTime))\n+                && !timestampWouldIncrease || proposed == null && value == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODA0Nw=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI5MDQxOA==", "bodyText": "This matters for setting the dflt case", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512290418", "createdAt": "2020-10-26T21:50:11Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncrease allow the timestamp to go forward in time without changing the value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncrease) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease = allowTimestampToIncrease && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)\n+                || !allowTimestampToDecrease && (proposedModtime < currentModTime))\n+                && !timestampWouldIncrease || proposed == null && value == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODA0Nw=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI5NTY1NQ==", "bodyText": "gotcha - I misread the parens. The null/null case is a fall through", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512295655", "createdAt": "2020-10-26T22:01:45Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncrease allow the timestamp to go forward in time without changing the value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncrease) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease = allowTimestampToIncrease && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)\n+                || !allowTimestampToDecrease && (proposedModtime < currentModTime))\n+                && !timestampWouldIncrease || proposed == null && value == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODA0Nw=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMzOTczOQ==", "bodyText": "when do we allow timestamp to decrease?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512339739", "createdAt": "2020-10-27T00:03:54Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncrease allow the timestamp to go forward in time without changing the value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncrease) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease = allowTimestampToIncrease && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)\n+                || !allowTimestampToDecrease && (proposedModtime < currentModTime))\n+                && !timestampWouldIncrease || proposed == null && value == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODA0Nw=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM0MjI1NQ==", "bodyText": "That's the replacement for the old behavior of \"forceTimestamp\"", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512342255", "createdAt": "2020-10-27T00:12:50Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncrease allow the timestamp to go forward in time without changing the value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncrease) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease = allowTimestampToIncrease && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)\n+                || !allowTimestampToDecrease && (proposedModtime < currentModTime))\n+                && !timestampWouldIncrease || proposed == null && value == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODA0Nw=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTY5MjI3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/Topic.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMTo0NTo0MlrOHojmxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjoxMzo0MFrOHokWhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODQ1NA==", "bodyText": "why do you not want to allowTimestampToIncrease here? It seems contradictory in a method called withNewerValue?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512288454", "createdAt": "2020-10-26T21:45:42Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI5MDY1Mg==", "bodyText": "The name of allowTimestampToIncrease isn't quite right is is more accurately allowTimestampToIncreaseWhenValueHasntChanged", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512290652", "createdAt": "2020-10-26T21:50:40Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODQ1NA=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI5OTc2OQ==", "bodyText": "can you update the javadoc for allowTimeStampToIncrease. What you wrote here: when the value hasn't changed is easier for me to grok than without changing the value\nMaybe something like allow the timestamp to go forward in time even if the proposed value is the same as the current value?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512299769", "createdAt": "2020-10-26T22:11:25Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODQ1NA=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMDY3Ng==", "bodyText": "Sure, do you have a better name for that argument as well?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512300676", "createdAt": "2020-10-26T22:13:40Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,47 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODQ1NA=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTY5NTExOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/Topics.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMTo0Njo0NVrOHojodw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjoxNzoxN1rOHokcXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODg4Nw==", "bodyText": "should you use a clock here instead of System.currentTimeMillis() ? It could make it easier to mock/test", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512288887", "createdAt": "2020-10-26T21:46:45Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topics.java", "diffHunk": "@@ -373,8 +366,8 @@ public void remove(Node n) {\n      */\n     public void replaceAndWait(Map<String, Object> newValue) {\n         context.runOnPublishQueueAndWait(() ->\n-                updateFromMap(System.currentTimeMillis(), newValue,\n-                        new UpdateBehaviorTree(UpdateBehaviorTree.UpdateBehavior.REPLACE))\n+                updateFromMap(newValue,\n+                        new UpdateBehaviorTree(UpdateBehaviorTree.UpdateBehavior.REPLACE, System.currentTimeMillis()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMjE3Mw==", "bodyText": "It has been this way since day 1 and making that change is a bit non-trivial due to the long legacy now. We haven't seen a need to mock this bit so far", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512302173", "createdAt": "2020-10-26T22:17:17Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topics.java", "diffHunk": "@@ -373,8 +366,8 @@ public void remove(Node n) {\n      */\n     public void replaceAndWait(Map<String, Object> newValue) {\n         context.runOnPublishQueueAndWait(() ->\n-                updateFromMap(System.currentTimeMillis(), newValue,\n-                        new UpdateBehaviorTree(UpdateBehaviorTree.UpdateBehavior.REPLACE))\n+                updateFromMap(newValue,\n+                        new UpdateBehaviorTree(UpdateBehaviorTree.UpdateBehavior.REPLACE, System.currentTimeMillis()))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4ODg4Nw=="}, "originalCommit": {"oid": "4860dffa387a66e9b1c35ebf66486d3a93e249ce"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMDE5NDQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/Topic.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMTozMDoyN1rOHooKLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMjoxOToyMlrOHoo-fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2MzA1NA==", "bodyText": "are there any unit tests on this class or is it all \"covered\" by other tests?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512363054", "createdAt": "2020-10-27T01:30:27Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6166d44c72d9eb006aa38ac164839b806987a1e4"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2MzcxOQ==", "bodyText": "it has ConfigurationTest class as well as being covered quite a lot by all the other tests too since configuration is so core to what we do.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512363719", "createdAt": "2020-10-27T01:32:49Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2MzA1NA=="}, "originalCommit": {"oid": "6166d44c72d9eb006aa38ac164839b806987a1e4"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3NjAxMg==", "bodyText": "Right - it does seem a bit odd that we don't have simple unit tests for this class though given it is so important", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512376012", "createdAt": "2020-10-27T02:17:34Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2MzA1NA=="}, "originalCommit": {"oid": "6166d44c72d9eb006aa38ac164839b806987a1e4"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3NjQ0Nw==", "bodyText": "That's what I'm saying, it is part of ConfigurationTest you can't have a Topic or Topics without a Configuration", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512376447", "createdAt": "2020-10-27T02:19:22Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -147,24 +147,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2MzA1NA=="}, "originalCommit": {"oid": "6166d44c72d9eb006aa38ac164839b806987a1e4"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMDg4NzIwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/Topic.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzozMTo0NVrOHouevg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNjoxMDo0NlrOHpEjkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NjYyMg==", "bodyText": "why do we need allowTimestampToDecrease? when does timestamp value decrease", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512466622", "createdAt": "2020-10-27T07:31:45Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -149,24 +149,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca8fa934f7cae5b38cea994f75fa2dc66f4b29e"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgyODMwNQ==", "bodyText": "This is the exact same behavior as forceTimestamp used to have, it only allowed the timestamp to decrease since by default a newer timestamp would be preferred anyway.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512828305", "createdAt": "2020-10-27T16:10:46Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -149,24 +149,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NjYyMg=="}, "originalCommit": {"oid": "5ca8fa934f7cae5b38cea994f75fa2dc66f4b29e"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMDg5NzY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/Topic.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzozNToyMlrOHoulDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNjozNTozNFrOHpFxsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2ODIzNw==", "bodyText": "Can you explain the different conditions handled here or break this if condition?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512468237", "createdAt": "2020-10-27T07:35:22Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -149,24 +149,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncreaseWhenValueHasntChanged) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease =\n+                allowTimestampToIncreaseWhenValueHasntChanged && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca8fa934f7cae5b38cea994f75fa2dc66f4b29e"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg0ODMwNQ==", "bodyText": "It has the same conditions as before + the idea that it will not break if the timestamp should be increased and the value isn't null. We use null for defaults and our defaults should not have their timestamps advanced otherwise our call to dflt fails because it uses a timestamp of 1 which would be in the past, so it would never apply.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512848305", "createdAt": "2020-10-27T16:35:34Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -149,24 +149,49 @@ public Topic withNewerValue(long proposedModtime, Number proposed) {\n         return withNewerValue(proposedModtime, proposed, false);\n     }\n \n+    /**\n+     * Set the value of this topic to a new value.\n+     *\n+     * @param proposedModtime          the last modified time of the value. If this is in the past, we do not update the\n+     *                                 value unless this is forced\n+     * @param proposed                 new value.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @return this\n+     */\n+    Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease) {\n+        return withNewerValue(proposedModtime, proposed, allowTimestampToDecrease, false);\n+    }\n+\n     /**\n      * Set the value of this topic to a new value.\n      *\n      * @param proposedModtime the last modified time of the value. If this is in the past, we do not update the value\n      *                       unless this is forced\n      * @param proposed        new value.\n-     * @param forceTimestamp indicate if the proposed time should be forced.\n+     * @param allowTimestampToDecrease allow the timestamp to go back in time\n+     * @param allowTimestampToIncreaseWhenValueHasntChanged allow the timestamp to go forward in time even if the\n+     *                                                      proposed value is the same as the current value\n      * @return this.\n      */\n-    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean forceTimestamp) {\n+    synchronized Topic withNewerValue(long proposedModtime, final Object proposed, boolean allowTimestampToDecrease,\n+                                      boolean allowTimestampToIncreaseWhenValueHasntChanged) {\n         final Object currentValue = value;\n-        final long currentModtime = modtime;\n-        if (Objects.equals(proposed, currentValue) || !forceTimestamp && (proposedModtime < currentModtime)) {\n+        final long currentModTime = modtime;\n+        boolean timestampWouldIncrease =\n+                allowTimestampToIncreaseWhenValueHasntChanged && proposedModtime > currentModTime;\n+\n+        if ((Objects.equals(proposed, currentValue)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2ODIzNw=="}, "originalCommit": {"oid": "5ca8fa934f7cae5b38cea994f75fa2dc66f4b29e"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzQ4NDA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/config/Topic.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoxNDozOVrOHpHf-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoxNTozOFrOHpHilQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3NjUzNw==", "bodyText": "can you give some more context on when you would want to be notified that the timestamp is updated?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512876537", "createdAt": "2020-10-27T17:14:39Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -179,7 +210,11 @@ synchronized Topic withNewerValue(long proposedModtime, final Object proposed, b\n \n         value = validated;\n         modtime = proposedModtime;\n-        context.runOnPublishQueue(() -> this.fire(WhatHappened.changed));\n+        if (changed) {\n+            context.runOnPublishQueue(() -> this.fire(WhatHappened.changed));\n+        } else {\n+            context.runOnPublishQueue(() -> this.fire(WhatHappened.timestampUpdated));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6884d9b7dc0ab62367045602399ccf884710089d"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3NzIwNQ==", "bodyText": "We generally don't, but this is required for the tlog to pick it up. The tlog only attaches as a listener", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/561#discussion_r512877205", "createdAt": "2020-10-27T17:15:38Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/Topic.java", "diffHunk": "@@ -179,7 +210,11 @@ synchronized Topic withNewerValue(long proposedModtime, final Object proposed, b\n \n         value = validated;\n         modtime = proposedModtime;\n-        context.runOnPublishQueue(() -> this.fire(WhatHappened.changed));\n+        if (changed) {\n+            context.runOnPublishQueue(() -> this.fire(WhatHappened.changed));\n+        } else {\n+            context.runOnPublishQueue(() -> this.fire(WhatHappened.timestampUpdated));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3NjUzNw=="}, "originalCommit": {"oid": "6884d9b7dc0ab62367045602399ccf884710089d"}, "originalPosition": 69}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 387, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}