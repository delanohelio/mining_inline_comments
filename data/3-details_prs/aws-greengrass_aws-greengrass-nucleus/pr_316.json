{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODI0Mzc3", "number": 316, "title": "Fixing E2E test as newly added cloud behavior to cancel old job if a \u2026", "bodyText": "\u2026new configuration for same group is set\nIssue #, if available:\nDescription of changes:\nCloud added the feature to cancel the old job for a thing group when a new configuration for the group is set.\nModifying our tests to have correct expectations as per this behavior.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-07-16T01:00:08Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/316", "merged": true, "mergeCommit": {"oid": "3ee5ae636ea6e79d931f5ad68d0d9e5ebe702ae7"}, "closed": true, "closedAt": "2020-07-16T06:17:47Z", "author": {"login": "abanthiy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1Uhw9gH2gAyNDQ5ODI0Mzc3Ojg1MzNjMjE0NjIwMmI0ZWNjZDdiYzAzNTM1ZmY3N2RmNWVmYzc3NTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1Yp8MAH2gAyNDQ5ODI0Mzc3OmI4N2I2NzY4MTM4ODE1N2NmODNiNmUzMzExYzAxOWQxYTc2Y2MwZDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8533c2146202b4eccd7bc03535ff77df5efc7758", "author": {"user": {"login": "abanthiy", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8533c2146202b4eccd7bc03535ff77df5efc7758", "committedDate": "2020-07-16T00:59:03Z", "message": "Fixing E2E test as newly added cloud behavior to cancel old job if a new configuration for same group is set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDM5MTM3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/316#pullrequestreview-449439137", "createdAt": "2020-07-16T01:01:53Z", "commit": {"oid": "8533c2146202b4eccd7bc03535ff77df5efc7758"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMTowMTo1M1rOGyWbIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMTowMTo1M1rOGyWbIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0OTM3OA==", "bodyText": "do we need 5 minutes on the cancelled, seems a bit long", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/316#discussion_r455449378", "createdAt": "2020-07-16T01:01:53Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/deployment/MultipleDeploymentsTest.java", "diffHunk": "@@ -115,20 +117,25 @@ void GIVEN_offline_device_WHEN_create_multiple_deployments_THEN_deployments_exec\n \n             IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n                     Duration.ofMinutes(1), s -> s.ordinal() >= JobExecutionStatus.QUEUED.ordinal());\n-            logger.atWarn().kv(\"jobId\", helper.jobId).log(\"Created IoT Job\");\n+            logger.atWarn().kv(\"jobId\", helper.jobId).kv(\"index\", helper.index).log(\"Created IoT Job\");\n         }\n-\n-        subscribeToLocalDeploymentStatus(kernel, helpers);\n+        // Only the last job should execute\n+        subscribeToLocalDeploymentStatus(kernel, Arrays.asList(mostRecentJobHelper));\n \n         // Start kernel and connect IoT cloud\n         kernel.launch();\n \n         // Wait for all jobs to finish\n         for (DeploymentJobHelper helper : helpers) {\n-            assertTrue(helper.jobCompleted.await(2, TimeUnit.MINUTES), \"Deployment job timed out: \" + helper.jobId);\n-\n-            IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n-                    Duration.ofMinutes(5), s -> s.equals(JobExecutionStatus.SUCCEEDED));\n+            if (helper.index == 3) {\n+                assertTrue(helper.jobCompleted.await(2, TimeUnit.MINUTES), \"Deployment job timed out: \" + helper.jobId);\n+\n+                IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n+                        Duration.ofMinutes(5), s -> s.equals(JobExecutionStatus.SUCCEEDED));\n+            } else {\n+                IotJobsUtils.waitForJobExecutionStatusToSatisfy(iotClient, helper.jobId, thingInfo.getThingName(),\n+                        Duration.ofMinutes(5), s -> s.equals(JobExecutionStatus.CANCELED));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8533c2146202b4eccd7bc03535ff77df5efc7758"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDM5MTY0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/316#pullrequestreview-449439164", "createdAt": "2020-07-16T01:01:59Z", "commit": {"oid": "8533c2146202b4eccd7bc03535ff77df5efc7758"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDQyMDQx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/316#pullrequestreview-449442041", "createdAt": "2020-07-16T01:11:54Z", "commit": {"oid": "8533c2146202b4eccd7bc03535ff77df5efc7758"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b87b67681388157cf83b6e3311c019d1a76cc0d3", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b87b67681388157cf83b6e3311c019d1a76cc0d3", "committedDate": "2020-07-16T05:47:36Z", "message": "Merge branch 'master' into E2ETestFix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2898, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}