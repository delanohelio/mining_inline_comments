{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2ODQxNDkw", "number": 107, "title": "Refactor kernel config to change requires to dependencies and use a list instead of csv", "bodyText": "Description of changes:\n\nAdd bin, config, work, metrics to .gitignore\nChanges requires config key to dependencies\nChange dependencies config values type from csv to list of strings\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-03-11T18:04:47Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107", "merged": true, "mergeCommit": {"oid": "dc4464fcf2ef9c41477a3356b7faea44c1dbe0ec"}, "closed": true, "closedAt": "2020-03-12T20:19:14Z", "author": {"login": "chaurah"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMtqFSABqjMxMjA1MjgzODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNBhhWgFqTM3Mzg2OTYzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "441f5414ce74b1ae19f1fedf7d43d64ad77fd630", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/441f5414ce74b1ae19f1fedf7d43d64ad77fd630", "committedDate": "2020-03-11T17:46:06Z", "message": "Change dependencies config values type from csv to list of strings"}, "afterCommit": {"oid": "01b10ff835a04d207513868bb52d49f0928894a9", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/01b10ff835a04d207513868bb52d49f0928894a9", "committedDate": "2020-03-11T20:40:57Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01b10ff835a04d207513868bb52d49f0928894a9", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/01b10ff835a04d207513868bb52d49f0928894a9", "committedDate": "2020-03-11T20:40:57Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}, "afterCommit": {"oid": "b5f0bb9f5158c96c243aa30b64a43fe06af17ef9", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b5f0bb9f5158c96c243aa30b64a43fe06af17ef9", "committedDate": "2020-03-12T04:55:56Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1776577fd96a0d2a8f44081e52046d267927ff10", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1776577fd96a0d2a8f44081e52046d267927ff10", "committedDate": "2020-03-12T05:09:57Z", "message": "Add bin, config, work, metrics to .gitignore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5f0bb9f5158c96c243aa30b64a43fe06af17ef9", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b5f0bb9f5158c96c243aa30b64a43fe06af17ef9", "committedDate": "2020-03-12T04:55:56Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}, "afterCommit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a", "committedDate": "2020-03-12T05:10:03Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNzk1Njc3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#pullrequestreview-373795677", "createdAt": "2020-03-12T18:18:38Z", "commit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxODoxODozOFrOF1qC1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxODoxODozOFrOF1qC1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgwNzcwMA==", "bodyText": "Nit - Dep doesn't convey very well that it's dependency, maybe we could just name is newServiceDependencies", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#discussion_r391807700", "createdAt": "2020-03-12T18:18:38Z", "author": {"login": "shaguptashaikh"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/kernel/ServiceConfigMergingTest.java", "diffHunk": "@@ -183,18 +188,22 @@ void GIVEN_kernel_running_single_service_WHEN_merge_change_adding_nested_depende\n             }\n         });\n \n-        List<String> originalRunningServices =\n+        List<String> serviceList =\n                 kernel.getMain().getDependencies().keySet().stream().map(EvergreenService::getName)\n                         .collect(Collectors.toList());\n+        serviceList.add(\"new_service\");\n+\n+        List<String> newServiceDepList = new ArrayList<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNzk4NDk0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#pullrequestreview-373798494", "createdAt": "2020-03-12T18:22:40Z", "commit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODM4MjYz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#pullrequestreview-373838263", "createdAt": "2020-03-12T19:23:34Z", "commit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOToyMzozNFrOF1sGfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOToyNzo1NlrOF1sO6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg0MTQwNw==", "bodyText": "I prefer use Arrays.asList(\"new_service2\") instead of constructing the object outside.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#discussion_r391841407", "createdAt": "2020-03-12T19:23:34Z", "author": {"login": "ShirleyZheng92"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/kernel/ServiceConfigMergingTest.java", "diffHunk": "@@ -183,18 +188,22 @@ void GIVEN_kernel_running_single_service_WHEN_merge_change_adding_nested_depende\n             }\n         });\n \n-        List<String> originalRunningServices =\n+        List<String> serviceList =\n                 kernel.getMain().getDependencies().keySet().stream().map(EvergreenService::getName)\n                         .collect(Collectors.toList());\n+        serviceList.add(\"new_service\");\n+\n+        List<String> newServiceDepList = new ArrayList<String>();\n+        newServiceDepList.add(\"new_service2\");\n         kernel.mergeInNewConfig(\"id\", System.currentTimeMillis(), new HashMap<Object, Object>() {{\n             put(\"services\", new HashMap<Object, Object>() {{\n                 put(\"main\",new HashMap<Object, Object>() {{\n-                    put(\"requires\", String.join(\",\", originalRunningServices) + \",new_service\");\n+                    put(\"dependencies\", serviceList);\n                 }});\n \n                 put(\"new_service\",new HashMap<Object, Object>() {{\n                     put(\"run\", \"sleep 60\");\n-                    put(\"requires\", \"new_service2\");\n+                    put(\"dependencies\", newServiceDepList);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg0MzU2MA==", "bodyText": "NIT: since you remove the comma-separated string, using regex parse may be too  much here. Just use String.split(\":\")", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#discussion_r391843560", "createdAt": "2020-03-12T19:27:56Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -783,15 +788,17 @@ public void postInject() {\n         }).start();\n     }\n \n-    private Map<EvergreenService, State> parseDependencyList(String dependencyList) throws Exception {\n-        Matcher m = DEP_PARSE.matcher(dependencyList);\n+    private Map<EvergreenService, State> parseDependencyList(List<String> dependencyList) throws Exception {\n         HashMap<EvergreenService, State> ret = new HashMap<>();\n-        while (m.find()) {\n-            Pair<EvergreenService, State> dep = parseSingleDependency(m.group(1), m.group(3));\n-            ret.put(dep.getLeft(), dep.getRight());\n-        }\n-        if (!m.hitEnd()) {\n-            throw new Exception(\"Bad dependency syntax\");\n+        for (String depName : dependencyList) {\n+            Matcher m = DEP_PARSE.matcher(depName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODQ4Mzky", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#pullrequestreview-373848392", "createdAt": "2020-03-12T19:40:22Z", "commit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOTo0MDoyM1rOF1sltA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOTo0MTowMVrOF1snDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg0OTM5Ng==", "bodyText": "Pattern needs to change now? We don't expect \",;\" at the end of these strings now?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#discussion_r391849396", "createdAt": "2020-03-12T19:40:23Z", "author": {"login": "abanthiy"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -783,15 +788,17 @@ public void postInject() {\n         }).start();\n     }\n \n-    private Map<EvergreenService, State> parseDependencyList(String dependencyList) throws Exception {\n-        Matcher m = DEP_PARSE.matcher(dependencyList);\n+    private Map<EvergreenService, State> parseDependencyList(List<String> dependencyList) throws Exception {\n         HashMap<EvergreenService, State> ret = new HashMap<>();\n-        while (m.find()) {\n-            Pair<EvergreenService, State> dep = parseSingleDependency(m.group(1), m.group(3));\n-            ret.put(dep.getLeft(), dep.getRight());\n-        }\n-        if (!m.hitEnd()) {\n-            throw new Exception(\"Bad dependency syntax\");\n+        for (String depName : dependencyList) {\n+            Matcher m = DEP_PARSE.matcher(depName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg0OTc0Mw==", "bodyText": "Would prefer a better naming here. Just indicate what the map is", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#discussion_r391849743", "createdAt": "2020-03-12T19:41:01Z", "author": {"login": "abanthiy"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -783,15 +788,17 @@ public void postInject() {\n         }).start();\n     }\n \n-    private Map<EvergreenService, State> parseDependencyList(String dependencyList) throws Exception {\n-        Matcher m = DEP_PARSE.matcher(dependencyList);\n+    private Map<EvergreenService, State> parseDependencyList(List<String> dependencyList) throws Exception {\n         HashMap<EvergreenService, State> ret = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODUxNzU2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#pullrequestreview-373851756", "createdAt": "2020-03-12T19:45:52Z", "commit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e47201ce1b0d6b3d3e1f171fb7580cbdd3fbb11", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0e47201ce1b0d6b3d3e1f171fb7580cbdd3fbb11", "committedDate": "2020-03-12T20:08:30Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/45de19c4026fcc8a9d7ba31d4e85b8ceaa1a2b8a", "committedDate": "2020-03-12T05:10:03Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}, "afterCommit": {"oid": "0e47201ce1b0d6b3d3e1f171fb7580cbdd3fbb11", "author": {"user": {"login": "chaurah", "name": "Rahul Singh Chauhan"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0e47201ce1b0d6b3d3e1f171fb7580cbdd3fbb11", "committedDate": "2020-03-12T20:08:30Z", "message": "Change requires config key to dependencies, Change dependencies config values type from csv to list of strings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODY5NjMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/107#pullrequestreview-373869632", "createdAt": "2020-03-12T20:13:37Z", "commit": {"oid": "0e47201ce1b0d6b3d3e1f171fb7580cbdd3fbb11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2325, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}