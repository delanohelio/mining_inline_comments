{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMzk2MjE1", "number": 34, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNjo0OToxMlrODYZ0RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNjo0OToxMlrODYZ0RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2OTE1Mzk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/ipc/modules/ServiceDiscoveryService.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwNjo0OToxMlrOFePe3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNjo1Nzo0OFrOFegrKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1NTI2MQ==", "bodyText": "ABC? other wise looks good", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/34#discussion_r367255261", "createdAt": "2020-01-16T06:49:12Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/ipc/modules/ServiceDiscoveryService.java", "diffHunk": "@@ -0,0 +1,113 @@\n+package com.aws.iot.evergreen.ipc.modules;\n+\n+\n+import com.aws.iot.evergreen.config.Topics;\n+import com.aws.iot.evergreen.dependency.ImplementsService;\n+import com.aws.iot.evergreen.ipc.common.FrameReader.Message;\n+import com.aws.iot.evergreen.ipc.exceptions.IPCException;\n+import com.aws.iot.evergreen.ipc.handler.MessageDispatcher;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.LookupResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RegisterResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RemoveResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.Resource;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryResponseStatus;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryRequestTypes;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.UpdateResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralResponse;\n+import com.aws.iot.evergreen.ipc.services.common.SendAndReceiveIPCUtil;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.util.Log;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.cbor.databind.CBORMapper;\n+\n+import javax.inject.Inject;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+\n+import static com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscovery.SERVICE_DISCOVERY_NAME;\n+import static com.aws.iot.evergreen.util.Log.Level;\n+\n+\n+//TODO: see if this needs to be a GGService\n+@ImplementsService(name = \"servicediscovery\", autostart = true)\n+public class ServiceDiscoveryService extends EvergreenService {\n+    private ObjectMapper mapper = new CBORMapper();\n+\n+    //TODO: figure out how to inject the interface than the impl\n+    @Inject\n+    private MessageDispatcher messageDispatcher;\n+\n+    @Inject\n+    Log log;\n+\n+    public ServiceDiscoveryService(Topics c) {\n+        super(c);\n+    }\n+\n+    @Override\n+    public void postInject() {\n+        try {\n+            messageDispatcher.registerServiceCallback(SERVICE_DISCOVERY_NAME, this::handleMessage);\n+        } catch (IPCException e) {\n+            log.log(Level.Error,\"Error registering callback for service \"+ SERVICE_DISCOVERY_NAME);\n+        }\n+    }\n+\n+    public Message handleMessage(Message request) {\n+        // TODO: Input validation\n+\n+        try {\n+            GeneralRequest<Object, ServiceDiscoveryRequestTypes> obj = SendAndReceiveIPCUtil.decode(request, new TypeReference<GeneralRequest<Object, ServiceDiscoveryRequestTypes>>() {});\n+\n+            GeneralResponse<Object, ServiceDiscoveryResponseStatus> genResp = new GeneralResponse<>();\n+            switch (obj.type) {\n+                case lookup:\n+                    LookupResourceRequest lookup = mapper.convertValue(obj.request, LookupResourceRequest.class);\n+                    // Do lookup\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    genResp.response = new ArrayList<Resource>();\n+                    break;\n+                case remove:\n+                    RemoveResourceRequest remove = mapper.convertValue(obj.request, RemoveResourceRequest.class);\n+                    // Do remove\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case update:\n+                    UpdateResourceRequest update = mapper.convertValue(obj.request, UpdateResourceRequest.class);\n+                    // Do update\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case register:\n+                    RegisterResourceRequest register = mapper.convertValue(obj.request, RegisterResourceRequest.class);\n+                    // Do register\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    Resource resource = new Resource();\n+                    resource.name = \"ABC\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2d900f095a3cfb5505530cc4a6b216bf0e492f1"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI2NjA5MQ==", "bodyText": "Yeah, obviously this needs the real code in it. Your backend implementation goes there, or rather a call to the backend.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/34#discussion_r367266091", "createdAt": "2020-01-16T07:30:00Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/ipc/modules/ServiceDiscoveryService.java", "diffHunk": "@@ -0,0 +1,113 @@\n+package com.aws.iot.evergreen.ipc.modules;\n+\n+\n+import com.aws.iot.evergreen.config.Topics;\n+import com.aws.iot.evergreen.dependency.ImplementsService;\n+import com.aws.iot.evergreen.ipc.common.FrameReader.Message;\n+import com.aws.iot.evergreen.ipc.exceptions.IPCException;\n+import com.aws.iot.evergreen.ipc.handler.MessageDispatcher;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.LookupResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RegisterResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RemoveResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.Resource;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryResponseStatus;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryRequestTypes;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.UpdateResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralResponse;\n+import com.aws.iot.evergreen.ipc.services.common.SendAndReceiveIPCUtil;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.util.Log;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.cbor.databind.CBORMapper;\n+\n+import javax.inject.Inject;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+\n+import static com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscovery.SERVICE_DISCOVERY_NAME;\n+import static com.aws.iot.evergreen.util.Log.Level;\n+\n+\n+//TODO: see if this needs to be a GGService\n+@ImplementsService(name = \"servicediscovery\", autostart = true)\n+public class ServiceDiscoveryService extends EvergreenService {\n+    private ObjectMapper mapper = new CBORMapper();\n+\n+    //TODO: figure out how to inject the interface than the impl\n+    @Inject\n+    private MessageDispatcher messageDispatcher;\n+\n+    @Inject\n+    Log log;\n+\n+    public ServiceDiscoveryService(Topics c) {\n+        super(c);\n+    }\n+\n+    @Override\n+    public void postInject() {\n+        try {\n+            messageDispatcher.registerServiceCallback(SERVICE_DISCOVERY_NAME, this::handleMessage);\n+        } catch (IPCException e) {\n+            log.log(Level.Error,\"Error registering callback for service \"+ SERVICE_DISCOVERY_NAME);\n+        }\n+    }\n+\n+    public Message handleMessage(Message request) {\n+        // TODO: Input validation\n+\n+        try {\n+            GeneralRequest<Object, ServiceDiscoveryRequestTypes> obj = SendAndReceiveIPCUtil.decode(request, new TypeReference<GeneralRequest<Object, ServiceDiscoveryRequestTypes>>() {});\n+\n+            GeneralResponse<Object, ServiceDiscoveryResponseStatus> genResp = new GeneralResponse<>();\n+            switch (obj.type) {\n+                case lookup:\n+                    LookupResourceRequest lookup = mapper.convertValue(obj.request, LookupResourceRequest.class);\n+                    // Do lookup\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    genResp.response = new ArrayList<Resource>();\n+                    break;\n+                case remove:\n+                    RemoveResourceRequest remove = mapper.convertValue(obj.request, RemoveResourceRequest.class);\n+                    // Do remove\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case update:\n+                    UpdateResourceRequest update = mapper.convertValue(obj.request, UpdateResourceRequest.class);\n+                    // Do update\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case register:\n+                    RegisterResourceRequest register = mapper.convertValue(obj.request, RegisterResourceRequest.class);\n+                    // Do register\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    Resource resource = new Resource();\n+                    resource.name = \"ABC\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1NTI2MQ=="}, "originalCommit": {"oid": "a2d900f095a3cfb5505530cc4a6b216bf0e492f1"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI3MTk2Nw==", "bodyText": "The review is in draft so there is not approve button. I don't see that you changed any tests but the build is failing.  Is it because of the corresponding changes in SDK", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/34#discussion_r367271967", "createdAt": "2020-01-16T07:49:37Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/ipc/modules/ServiceDiscoveryService.java", "diffHunk": "@@ -0,0 +1,113 @@\n+package com.aws.iot.evergreen.ipc.modules;\n+\n+\n+import com.aws.iot.evergreen.config.Topics;\n+import com.aws.iot.evergreen.dependency.ImplementsService;\n+import com.aws.iot.evergreen.ipc.common.FrameReader.Message;\n+import com.aws.iot.evergreen.ipc.exceptions.IPCException;\n+import com.aws.iot.evergreen.ipc.handler.MessageDispatcher;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.LookupResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RegisterResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RemoveResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.Resource;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryResponseStatus;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryRequestTypes;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.UpdateResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralResponse;\n+import com.aws.iot.evergreen.ipc.services.common.SendAndReceiveIPCUtil;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.util.Log;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.cbor.databind.CBORMapper;\n+\n+import javax.inject.Inject;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+\n+import static com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscovery.SERVICE_DISCOVERY_NAME;\n+import static com.aws.iot.evergreen.util.Log.Level;\n+\n+\n+//TODO: see if this needs to be a GGService\n+@ImplementsService(name = \"servicediscovery\", autostart = true)\n+public class ServiceDiscoveryService extends EvergreenService {\n+    private ObjectMapper mapper = new CBORMapper();\n+\n+    //TODO: figure out how to inject the interface than the impl\n+    @Inject\n+    private MessageDispatcher messageDispatcher;\n+\n+    @Inject\n+    Log log;\n+\n+    public ServiceDiscoveryService(Topics c) {\n+        super(c);\n+    }\n+\n+    @Override\n+    public void postInject() {\n+        try {\n+            messageDispatcher.registerServiceCallback(SERVICE_DISCOVERY_NAME, this::handleMessage);\n+        } catch (IPCException e) {\n+            log.log(Level.Error,\"Error registering callback for service \"+ SERVICE_DISCOVERY_NAME);\n+        }\n+    }\n+\n+    public Message handleMessage(Message request) {\n+        // TODO: Input validation\n+\n+        try {\n+            GeneralRequest<Object, ServiceDiscoveryRequestTypes> obj = SendAndReceiveIPCUtil.decode(request, new TypeReference<GeneralRequest<Object, ServiceDiscoveryRequestTypes>>() {});\n+\n+            GeneralResponse<Object, ServiceDiscoveryResponseStatus> genResp = new GeneralResponse<>();\n+            switch (obj.type) {\n+                case lookup:\n+                    LookupResourceRequest lookup = mapper.convertValue(obj.request, LookupResourceRequest.class);\n+                    // Do lookup\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    genResp.response = new ArrayList<Resource>();\n+                    break;\n+                case remove:\n+                    RemoveResourceRequest remove = mapper.convertValue(obj.request, RemoveResourceRequest.class);\n+                    // Do remove\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case update:\n+                    UpdateResourceRequest update = mapper.convertValue(obj.request, UpdateResourceRequest.class);\n+                    // Do update\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case register:\n+                    RegisterResourceRequest register = mapper.convertValue(obj.request, RegisterResourceRequest.class);\n+                    // Do register\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    Resource resource = new Resource();\n+                    resource.name = \"ABC\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1NTI2MQ=="}, "originalCommit": {"oid": "a2d900f095a3cfb5505530cc4a6b216bf0e492f1"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTcwMg==", "bodyText": "I'll check once I get in. I need to log into the AWS account.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/34#discussion_r367509702", "createdAt": "2020-01-16T16:12:06Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/ipc/modules/ServiceDiscoveryService.java", "diffHunk": "@@ -0,0 +1,113 @@\n+package com.aws.iot.evergreen.ipc.modules;\n+\n+\n+import com.aws.iot.evergreen.config.Topics;\n+import com.aws.iot.evergreen.dependency.ImplementsService;\n+import com.aws.iot.evergreen.ipc.common.FrameReader.Message;\n+import com.aws.iot.evergreen.ipc.exceptions.IPCException;\n+import com.aws.iot.evergreen.ipc.handler.MessageDispatcher;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.LookupResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RegisterResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RemoveResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.Resource;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryResponseStatus;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryRequestTypes;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.UpdateResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralResponse;\n+import com.aws.iot.evergreen.ipc.services.common.SendAndReceiveIPCUtil;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.util.Log;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.cbor.databind.CBORMapper;\n+\n+import javax.inject.Inject;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+\n+import static com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscovery.SERVICE_DISCOVERY_NAME;\n+import static com.aws.iot.evergreen.util.Log.Level;\n+\n+\n+//TODO: see if this needs to be a GGService\n+@ImplementsService(name = \"servicediscovery\", autostart = true)\n+public class ServiceDiscoveryService extends EvergreenService {\n+    private ObjectMapper mapper = new CBORMapper();\n+\n+    //TODO: figure out how to inject the interface than the impl\n+    @Inject\n+    private MessageDispatcher messageDispatcher;\n+\n+    @Inject\n+    Log log;\n+\n+    public ServiceDiscoveryService(Topics c) {\n+        super(c);\n+    }\n+\n+    @Override\n+    public void postInject() {\n+        try {\n+            messageDispatcher.registerServiceCallback(SERVICE_DISCOVERY_NAME, this::handleMessage);\n+        } catch (IPCException e) {\n+            log.log(Level.Error,\"Error registering callback for service \"+ SERVICE_DISCOVERY_NAME);\n+        }\n+    }\n+\n+    public Message handleMessage(Message request) {\n+        // TODO: Input validation\n+\n+        try {\n+            GeneralRequest<Object, ServiceDiscoveryRequestTypes> obj = SendAndReceiveIPCUtil.decode(request, new TypeReference<GeneralRequest<Object, ServiceDiscoveryRequestTypes>>() {});\n+\n+            GeneralResponse<Object, ServiceDiscoveryResponseStatus> genResp = new GeneralResponse<>();\n+            switch (obj.type) {\n+                case lookup:\n+                    LookupResourceRequest lookup = mapper.convertValue(obj.request, LookupResourceRequest.class);\n+                    // Do lookup\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    genResp.response = new ArrayList<Resource>();\n+                    break;\n+                case remove:\n+                    RemoveResourceRequest remove = mapper.convertValue(obj.request, RemoveResourceRequest.class);\n+                    // Do remove\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case update:\n+                    UpdateResourceRequest update = mapper.convertValue(obj.request, UpdateResourceRequest.class);\n+                    // Do update\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case register:\n+                    RegisterResourceRequest register = mapper.convertValue(obj.request, RegisterResourceRequest.class);\n+                    // Do register\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    Resource resource = new Resource();\n+                    resource.name = \"ABC\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1NTI2MQ=="}, "originalCommit": {"oid": "a2d900f095a3cfb5505530cc4a6b216bf0e492f1"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUzNjkzNg==", "bodyText": "Yes, it is because the IPC SDK hasn't merged yet.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/34#discussion_r367536936", "createdAt": "2020-01-16T16:57:48Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/ipc/modules/ServiceDiscoveryService.java", "diffHunk": "@@ -0,0 +1,113 @@\n+package com.aws.iot.evergreen.ipc.modules;\n+\n+\n+import com.aws.iot.evergreen.config.Topics;\n+import com.aws.iot.evergreen.dependency.ImplementsService;\n+import com.aws.iot.evergreen.ipc.common.FrameReader.Message;\n+import com.aws.iot.evergreen.ipc.exceptions.IPCException;\n+import com.aws.iot.evergreen.ipc.handler.MessageDispatcher;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.LookupResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RegisterResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.RemoveResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.Resource;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryResponseStatus;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscoveryRequestTypes;\n+import com.aws.iot.evergreen.ipc.services.ServiceDiscovery.UpdateResourceRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralRequest;\n+import com.aws.iot.evergreen.ipc.services.common.GeneralResponse;\n+import com.aws.iot.evergreen.ipc.services.common.SendAndReceiveIPCUtil;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.util.Log;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.cbor.databind.CBORMapper;\n+\n+import javax.inject.Inject;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+\n+import static com.aws.iot.evergreen.ipc.services.ServiceDiscovery.ServiceDiscovery.SERVICE_DISCOVERY_NAME;\n+import static com.aws.iot.evergreen.util.Log.Level;\n+\n+\n+//TODO: see if this needs to be a GGService\n+@ImplementsService(name = \"servicediscovery\", autostart = true)\n+public class ServiceDiscoveryService extends EvergreenService {\n+    private ObjectMapper mapper = new CBORMapper();\n+\n+    //TODO: figure out how to inject the interface than the impl\n+    @Inject\n+    private MessageDispatcher messageDispatcher;\n+\n+    @Inject\n+    Log log;\n+\n+    public ServiceDiscoveryService(Topics c) {\n+        super(c);\n+    }\n+\n+    @Override\n+    public void postInject() {\n+        try {\n+            messageDispatcher.registerServiceCallback(SERVICE_DISCOVERY_NAME, this::handleMessage);\n+        } catch (IPCException e) {\n+            log.log(Level.Error,\"Error registering callback for service \"+ SERVICE_DISCOVERY_NAME);\n+        }\n+    }\n+\n+    public Message handleMessage(Message request) {\n+        // TODO: Input validation\n+\n+        try {\n+            GeneralRequest<Object, ServiceDiscoveryRequestTypes> obj = SendAndReceiveIPCUtil.decode(request, new TypeReference<GeneralRequest<Object, ServiceDiscoveryRequestTypes>>() {});\n+\n+            GeneralResponse<Object, ServiceDiscoveryResponseStatus> genResp = new GeneralResponse<>();\n+            switch (obj.type) {\n+                case lookup:\n+                    LookupResourceRequest lookup = mapper.convertValue(obj.request, LookupResourceRequest.class);\n+                    // Do lookup\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    genResp.response = new ArrayList<Resource>();\n+                    break;\n+                case remove:\n+                    RemoveResourceRequest remove = mapper.convertValue(obj.request, RemoveResourceRequest.class);\n+                    // Do remove\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case update:\n+                    UpdateResourceRequest update = mapper.convertValue(obj.request, UpdateResourceRequest.class);\n+                    // Do update\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    break;\n+                case register:\n+                    RegisterResourceRequest register = mapper.convertValue(obj.request, RegisterResourceRequest.class);\n+                    // Do register\n+                    genResp.error = ServiceDiscoveryResponseStatus.Success;\n+                    Resource resource = new Resource();\n+                    resource.name = \"ABC\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI1NTI2MQ=="}, "originalCommit": {"oid": "a2d900f095a3cfb5505530cc4a6b216bf0e492f1"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 35, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}