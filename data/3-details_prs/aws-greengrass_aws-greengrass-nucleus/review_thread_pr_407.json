{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MzAxNzM0", "number": 407, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDowODowN1rOEfD7hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDowODowN1rOEfD7hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMDA1NzAxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDowODowN1rOHLGZxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxOTo0NVrOHLGw4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ==", "bodyText": "Why only start the autostart service?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481401285", "createdAt": "2020-09-01T20:08:07Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "diffHunk": "@@ -160,7 +160,8 @@ void initConfigAndTlog() {\n      * Make all services startup in order.\n      */\n     public void startupAllServices() {\n-        kernel.orderedDependencies().forEach(EvergreenService::requestStart);\n+        kernel.orderedDependencies().stream().filter(EvergreenService::shouldAutoStart)\n+                .forEach(EvergreenService::requestStart);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b599fc461b6cf1da755d25ec60007018c3c523d2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMjIyOQ==", "bodyText": "This prevents on-demand lambdas from starting. All services return true for this, except for on-demand lambdas. We use the same logic during deployment to prevent us from starting the on-demand lambda during deployment.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481402229", "createdAt": "2020-09-01T20:09:56Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "diffHunk": "@@ -160,7 +160,8 @@ void initConfigAndTlog() {\n      * Make all services startup in order.\n      */\n     public void startupAllServices() {\n-        kernel.orderedDependencies().forEach(EvergreenService::requestStart);\n+        kernel.orderedDependencies().stream().filter(EvergreenService::shouldAutoStart)\n+                .forEach(EvergreenService::requestStart);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, "originalCommit": {"oid": "b599fc461b6cf1da755d25ec60007018c3c523d2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMzg3NQ==", "bodyText": "Okay. How is it distinguished from the autostart in the @ImplmentsService annotation?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481403875", "createdAt": "2020-09-01T20:13:25Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "diffHunk": "@@ -160,7 +160,8 @@ void initConfigAndTlog() {\n      * Make all services startup in order.\n      */\n     public void startupAllServices() {\n-        kernel.orderedDependencies().forEach(EvergreenService::requestStart);\n+        kernel.orderedDependencies().stream().filter(EvergreenService::shouldAutoStart)\n+                .forEach(EvergreenService::requestStart);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, "originalCommit": {"oid": "b599fc461b6cf1da755d25ec60007018c3c523d2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNDg5NQ==", "bodyText": "That should basically be deprecated. That's only used by builtin services (services that are authored in the kernel repo). It is entirely separate.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481404895", "createdAt": "2020-09-01T20:15:15Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "diffHunk": "@@ -160,7 +160,8 @@ void initConfigAndTlog() {\n      * Make all services startup in order.\n      */\n     public void startupAllServices() {\n-        kernel.orderedDependencies().forEach(EvergreenService::requestStart);\n+        kernel.orderedDependencies().stream().filter(EvergreenService::shouldAutoStart)\n+                .forEach(EvergreenService::requestStart);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, "originalCommit": {"oid": "b599fc461b6cf1da755d25ec60007018c3c523d2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNTUzNQ==", "bodyText": "They are also started by this method, and their shouldAutoStart returns true (unless they override it, which none have)", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481405535", "createdAt": "2020-09-01T20:16:22Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "diffHunk": "@@ -160,7 +160,8 @@ void initConfigAndTlog() {\n      * Make all services startup in order.\n      */\n     public void startupAllServices() {\n-        kernel.orderedDependencies().forEach(EvergreenService::requestStart);\n+        kernel.orderedDependencies().stream().filter(EvergreenService::shouldAutoStart)\n+                .forEach(EvergreenService::requestStart);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, "originalCommit": {"oid": "b599fc461b6cf1da755d25ec60007018c3c523d2"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNzIwMQ==", "bodyText": "That should basically be deprecated. That's only used by builtin services (services that are authored in the kernel repo). It is entirely separate.\n\nOkay. Let's create a task to deprecate it. Right now it's confusing.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481407201", "createdAt": "2020-09-01T20:19:45Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "diffHunk": "@@ -160,7 +160,8 @@ void initConfigAndTlog() {\n      * Make all services startup in order.\n      */\n     public void startupAllServices() {\n-        kernel.orderedDependencies().forEach(EvergreenService::requestStart);\n+        kernel.orderedDependencies().stream().filter(EvergreenService::shouldAutoStart)\n+                .forEach(EvergreenService::requestStart);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, "originalCommit": {"oid": "b599fc461b6cf1da755d25ec60007018c3c523d2"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 746, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}