{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5OTU0MTc0", "number": 160, "title": "Address PMD violations", "bodyText": "Issue #, if available:\nDescription of changes:\nAddress the exising PMD violations except for the following, which will be done in separate PRs.\n\n Deployment Service which is being refactored.\n AvoidGettingFutureWithoutTimeout in removing/closing a service\n ExcessiveClassLength in EvergreenService class\n Empty catch blocks\n\nWhy is this change necessary:\nHow was this change tested:\nPass the existing tests.\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-04-06T23:20:26Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160", "merged": true, "mergeCommit": {"oid": "48ed396efa4a839d2279ed34639c7d2b4faf319d"}, "closed": true, "closedAt": "2020-04-08T21:31:20Z", "author": {"login": "hui-yang"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVH4LFgFqTM4ODY4NTA5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVuzvDAFqTM5MDM0NjU5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Njg1MDky", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-388685092", "createdAt": "2020-04-06T23:22:48Z", "commit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzoyMjo0OFrOGBtdnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDowODo0MFrOGBuW8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0NjYyMQ==", "bodyText": "This should be kept small, especially since everything is local. Did you find anytime that this actually helped? Or is the test/implementation just flaky?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404446621", "createdAt": "2020-04-06T23:22:48Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/deployment/DeploymentServiceIntegrationTest.java", "diffHunk": "@@ -158,7 +156,7 @@ void GIVEN_services_running_WHEN_updated_params_THEN_services_start_with_updated\n         Future<?> result = submitSampleJobDocument(\n                 DeploymentServiceIntegrationTest.class.getResource(\"SampleJobDocument_updated.json\").toURI(),\n                 System.currentTimeMillis());\n-        result.get(30, TimeUnit.SECONDS);\n+        result.get(60, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0NjgxMA==", "bodyText": "Likewise with all of these, they should not be taking this long at all.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404446810", "createdAt": "2020-04-06T23:23:24Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/kernel/ServiceConfigMergingTest.java", "diffHunk": "@@ -142,7 +142,7 @@ void GIVEN_kernel_running_single_service_WHEN_merge_change_adding_dependency_THE\n \n         // THEN\n         assertTrue(newServiceStarted.await(60, TimeUnit.SECONDS));\n-        assertTrue(mainRestarted.await(60, TimeUnit.SECONDS));\n+        assertTrue(mainRestarted.await(90, TimeUnit.SECONDS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0NzY2NA==", "bodyText": "Remove this since you fixed this issue as well.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404447664", "createdAt": "2020-04-06T23:25:53Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/ConfigurationWriter.java", "diffHunk": "@@ -72,12 +72,9 @@ public static ConfigurationWriter logTransactionsTo(Configuration c, Path p) thr\n     @SuppressWarnings({\"checkstyle:emptycatchblock\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0Nzg1OQ==", "bodyText": "Why? We want to keep a nice fluent interface that can chain things together. I know PMD doesn't like it, but either ignore it, or change the name to something that makes PMD happy.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404447859", "createdAt": "2020-04-06T23:26:29Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/Node.java", "diffHunk": "@@ -67,9 +67,8 @@ public String getName() {\n \n     public abstract void copyFrom(Node n);\n \n-    public <T extends Node> T setParentNeedsToKnow(boolean np) {\n+    public void setParentNeedsToKnow(boolean np) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0ODYzNg==", "bodyText": "Likewise here, let's either ignore PMD or do a rename instead of changing the interface.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404448636", "createdAt": "2020-04-06T23:28:50Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/Topic.java", "diffHunk": "@@ -88,36 +82,34 @@ public void appendTo(Appendable a) throws IOException {\n         appendValueTo(a);\n     }\n \n-    public Topic setValue(Object nv) {\n-        return setValue(System.currentTimeMillis(), nv);\n+    public void setValue(Object nv) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0OTA0OA==", "bodyText": "Let's use Objects.requireNonNull instead of asserts.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404449048", "createdAt": "2020-04-06T23:30:06Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/Topics.java", "diffHunk": "@@ -56,10 +56,10 @@ public int size() {\n \n     @Override\n     public void copyFrom(Node from) {\n-        assert (from != null);\n+        assert from != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0OTM4Nw==", "bodyText": "We definitely need to be logging any exceptions from here since so much runs in the publish queue. Otherwise the exceptions will be totally lost.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404449387", "createdAt": "2020-04-06T23:31:17Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/Context.java", "diffHunk": "@@ -62,22 +63,15 @@ public void run() {\n             while (true) {\n                 try {\n                     Runnable task = serialized.takeFirst();\n-                    try {\n-                        task.run();\n-                    } catch (Throwable t) {\n-                        logger.atError().setEventType(\"run-on-publish-queue-error\").setCause(t).log();\n-                    }\n+                    task.run();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0OTQ4Mw==", "bodyText": "I think we need handling here now, we can't just ignore it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404449483", "createdAt": "2020-04-06T23:31:36Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/Context.java", "diffHunk": "@@ -62,22 +63,15 @@ public void run() {\n             while (true) {\n                 try {\n                     Runnable task = serialized.takeFirst();\n-                    try {\n-                        task.run();\n-                    } catch (Throwable t) {\n-                        logger.atError().setEventType(\"run-on-publish-queue-error\").setCause(t).log();\n-                    }\n+                    task.run();\n                 } catch (InterruptedException ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MDI2OQ==", "bodyText": "Use Objects.equals(v, targetValue) instead of this stuff.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404450269", "createdAt": "2020-04-06T23:33:57Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/Context.java", "diffHunk": "@@ -397,12 +389,12 @@ private synchronized T get0() {\n          * @return new value\n          */\n         public final synchronized T put(T v) {\n-            if (v == value) {\n+            if (v == null && targetValue == null || v != null && targetValue != null && targetValue.equals(v)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MDQ4Mg==", "bodyText": "Same here, rename instead of changing the interface.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404450482", "createdAt": "2020-04-06T23:34:38Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/EZPlugins.java", "diffHunk": "@@ -51,10 +52,9 @@ private static void walk(Path p, Consumer<Path> action) throws IOException {\n      * Set the plugin root directory.\n      *\n      * @param d plugin root directory\n-     * @return this\n      */\n     @SuppressWarnings({\"checkstyle:emptycatchblock\"})\n-    public final EZPlugins setCacheDirectory(Path d) {\n+    public final void setCacheDirectory(Path d) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MDc2OA==", "bodyText": "perhaps not now, but all this needs to be cleaned up to remove the ignored exceptions like L64 and the print stack trace here.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404450768", "createdAt": "2020-04-06T23:35:32Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/EZPlugins.java", "diffHunk": "@@ -111,10 +110,10 @@ public EZPlugins loadCache() throws IOException {\n             });\n         }\n         walk(untrustedCacheDirectory, p -> {\n-            if (p.toString().endsWith(\".jar\")) {\n+            if (p.toString().endsWith(JAR_FILE_EXTENSION)) {\n                 try {\n                     loadPlugins(false, p);\n-                } catch (Throwable ex) {\n+                } catch (IOException ex) {\n                     e1.compareAndSet(null, new IOException(\"Error loading untrusted plugin \" + p, ex));\n                     ex.printStackTrace(System.out);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MDkwMg==", "bodyText": "This handling is no good. Let's see if we can fix it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404450902", "createdAt": "2020-04-06T23:36:00Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/EZPlugins.java", "diffHunk": "@@ -156,10 +155,10 @@ public EZPlugins loadCache() throws IOException {\n      */\n     public EZPlugins clearCache() throws IOException {\n         walk(cacheDirectory, p -> {\n-            if (p.toString().endsWith(\".jar\")) {\n+            if (p.toString().endsWith(JAR_FILE_EXTENSION)) {\n                 try {\n                     Files.delete(p);\n-                } catch (Throwable ex) {\n+                } catch (IOException ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MTUwMA==", "bodyText": "Not sure about this, probably @fengwa-aws has a better opinion. But for these things, we don't want to crash. IMO we definitely want to report back to the customer (over IPC) when possible what the error was, no matter what. So we need a catch all so that the IPC server doesn't die.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404451500", "createdAt": "2020-04-06T23:37:55Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/ipc/AuthHandler.java", "diffHunk": "@@ -103,7 +105,7 @@ void handleAuth(ChannelHandlerContext ctx, FrameReader.MessageFrame message) thr\n                                 .build();\n                 sendResponse(new FrameReader.Message(applicationMessage.toByteArray()), message.requestId,\n                         message.destination, ctx, false);\n-            } catch (Throwable t) {\n+            } catch (IPCException t) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MTk4Ng==", "bodyText": "Let's try not to ignore these on the class level. Methods, perhaps, but ideally we'd just fix it when possible.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404451986", "createdAt": "2020-04-06T23:39:12Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -49,6 +50,7 @@\n \n import static com.aws.iot.evergreen.util.Utils.getUltimateCause;\n \n+@SuppressWarnings({\"PMD.AvoidCatchingThrowable\", \"PMD.AvoidCatchingGenericException\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MjM5NQ==", "bodyText": "Please change this so that it can print out db. See Fahad's PR for how he did it. Just printing the backingTask which is a future really isn't helpful to anyone.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404452395", "createdAt": "2020-04-06T23:40:32Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -636,16 +646,13 @@ public void handleError() throws InterruptedException {\n     }\n \n     private synchronized void setBackingTask(Runnable r, String db) {\n-        Future bt = backingTask;\n-        if (bt != null) {\n-            backingTask = null;\n-            if (!bt.isDone()) {\n-                logger.info(\"Stopping backingTask {}\", bt);\n-                bt.cancel(true);\n-            }\n+        if (backingTask != null && (!backingTask.isDone() || !backingTask.isCancelled())) {\n+            logger.info(\"Stopping backingTask: {}\", backingTask);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MjQxMA==", "bodyText": "please drop this down to debug since this is going to be very common.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404452410", "createdAt": "2020-04-06T23:40:35Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -636,16 +646,13 @@ public void handleError() throws InterruptedException {\n     }\n \n     private synchronized void setBackingTask(Runnable r, String db) {\n-        Future bt = backingTask;\n-        if (bt != null) {\n-            backingTask = null;\n-            if (!bt.isDone()) {\n-                logger.info(\"Stopping backingTask {}\", bt);\n-                bt.cancel(true);\n-            }\n+        if (backingTask != null && (!backingTask.isDone() || !backingTask.isCancelled())) {\n+            logger.info(\"Stopping backingTask: {}\", backingTask);\n+            backingTask.cancel(true);\n         }\n         if (r != null) {\n             backingTask = context.get(ExecutorService.class).submit(r);\n+            logger.info(\"Submit backingTask: {}\", db);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ1MjY3Mg==", "bodyText": "Though unnecessary, can you add clarifying parenthesis. Also change == to use .equals like State.INSTALLED.equals(getState())", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404452672", "createdAt": "2020-04-06T23:41:28Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -769,11 +776,10 @@ public synchronized void addOrUpdateDependency(\n \n     private Subscriber createDependencySubscriber(EvergreenService dependentEvergreenService, State startWhenState) {\n         return (WhatHappened what, Topic t) -> {\n-            if (this.getState() == State.INSTALLED || this.getState() == State.RUNNING) {\n-                if (!dependencyReady(dependentEvergreenService, startWhenState)) {\n-                    this.requestRestart();\n-                    logger.atInfo().setEventType(\"service-restart\").log(\"Restart service because of dependencies\");\n-                }\n+            if (this.getState() == State.INSTALLED || this.getState() == State.RUNNING", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 195}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2MDI5MA==", "bodyText": "Does this work properly with Collections.EMPTY_LIST? I though that had a special implementation. Shouldn't we just use an ArrayList initialized on L89?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404460290", "createdAt": "2020-04-07T00:05:14Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -347,9 +347,8 @@ public void installCliTool(URL resource) {\n         }\n     }\n \n-    @SuppressWarnings(\"PMD.NullAssignment\")\n     public synchronized void clearODcache() {\n-        cachedOD = null;\n+        cachedOD.clear();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2MTI5OQ==", "bodyText": "Why change this?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r404461299", "createdAt": "2020-04-07T00:08:40Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -42,16 +42,15 @@\n  * .background(exc -> System.out.println(\"exit \"+exc));\n  * </pre>\n  */\n-@SuppressWarnings({\"checkstyle:emptycatchblock\", \"PMD.AvoidCatchingThrowable\", \"PMD.AssignmentInOperand\"})\n+@SuppressWarnings({\"checkstyle:emptycatchblock\", \"PMD.AvoidCatchingThrowable\"})\n public final class Exec implements Closeable {\n     public static final boolean isWindows = System.getProperty(\"os.name\").toLowerCase().contains(\"wind\");\n     public static final String EvergreenUid = Utils.generateRandomString(16).toUpperCase();\n     private static final Consumer<CharSequence> NOP = s -> {\n     };\n     private static final File userdir = new File(System.getProperty(\"user.dir\"));\n     private static final File homedir = new File(System.getProperty(\"user.home\"));\n-    @SuppressWarnings(\"PMD.LooseCoupling\")\n-    private static final LinkedList<Path> paths = new LinkedList<>();\n+    private static final ConcurrentLinkedDeque<Path> paths = new ConcurrentLinkedDeque<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88089c564579b8fe5c44217fbce195eee4a4eb17", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/88089c564579b8fe5c44217fbce195eee4a4eb17", "committedDate": "2020-04-06T23:18:01Z", "message": "Address PMD violations"}, "afterCommit": {"oid": "15f070a119f1e8a705c99743403425312b828a7c", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/15f070a119f1e8a705c99743403425312b828a7c", "committedDate": "2020-04-07T00:15:52Z", "message": "Address PMD violations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15f070a119f1e8a705c99743403425312b828a7c", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/15f070a119f1e8a705c99743403425312b828a7c", "committedDate": "2020-04-07T00:15:52Z", "message": "Address PMD violations"}, "afterCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a352c1644b094120835387417af9adf8e91ff2f8", "committedDate": "2020-04-07T22:33:56Z", "message": "Address PMD violations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTQxNzI5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-389541729", "createdAt": "2020-04-07T22:45:23Z", "commit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo0NToyM1rOGCY0qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo1MzoxNVrOGCZAQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1NzAzMg==", "bodyText": "Not necessarily an issue, but why switch the order?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405157032", "createdAt": "2020-04-07T22:45:23Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/config/Configuration.java", "diffHunk": "@@ -42,8 +41,8 @@ public String toString() {\n     @Inject\n     @SuppressWarnings(\"LeakingThisInConstructor\")\n     public Configuration(Context c) {  // This is one of the few classes that can't use injection\n-        c.put(Configuration.class, this);\n         root = new Topics(context = c, null, null);\n+        c.put(Configuration.class, this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1NzgyMg==", "bodyText": "typo: exit.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405157822", "createdAt": "2020-04-07T22:47:37Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/Context.java", "diffHunk": "@@ -44,40 +45,38 @@\n public class Context implements Closeable {\n     private final ConcurrentHashMap<Object, Value> parts = new ConcurrentHashMap<>();\n     private static final Logger logger = LogManager.getLogger(Context.class);\n+    private static final String classKeyword = \"class\";\n     // magical\n     private boolean shuttingDown = false;\n     // global state change notification\n     private CopyOnWriteArrayList<EvergreenService.GlobalStateChangeListener> listeners;\n-    private BlockingDeque<Runnable> serialized = new LinkedBlockingDeque<>();\n+    private final BlockingDeque<Runnable> serialized = new LinkedBlockingDeque<>();\n     private final Thread publishThread = new Thread() {\n         {\n             setName(\"Serialized listener processor\");\n             setPriority(Thread.MAX_PRIORITY - 1);\n             //                setDaemon(true);\n         }\n \n-        @SuppressWarnings({\"checkstyle:emptycatchblock\"})\n+        @SuppressWarnings({\"checkstyle:emptycatchblock\", \"PMD.AvoidCatchingThrowable\"})\n         @Override\n         public void run() {\n             while (true) {\n                 try {\n                     Runnable task = serialized.takeFirst();\n-                    try {\n-                        task.run();\n-                    } catch (Throwable t) {\n-                        logger.atError().setEventType(\"run-on-publish-queue-error\").setCause(t).log();\n-                    }\n-                } catch (InterruptedException ignored) {\n+                    task.run();\n+                } catch (InterruptedException ie) {\n+                    logger.atWarn().log(\"Interrupted while running tasks. Publish thread will exist now.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1ODAyNg==", "bodyText": "Since we return the throwable, I'm not sure we need this log.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405158026", "createdAt": "2020-04-07T22:48:10Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/dependency/Context.java", "diffHunk": "@@ -287,7 +283,7 @@ public Throwable runOnPublishQueueAndWait(Crashable r) {\n                 r.run();\n             } catch (Throwable t) {\n                 ret.set(t);\n-                logger.atError().setEventType(\"run-publish-queue-and-wait-error\").setCause(t).log();\n+                logger.atError(\"run-publish-queue-and-wait-error\", t).log();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1OTAyMg==", "bodyText": "remove this q.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405159022", "createdAt": "2020-04-07T22:50:33Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -654,7 +661,7 @@ private void stopBackingTask() {\n     }\n \n     /**\n-     * Report that the service has hit an error.\n+     * Report that the service has hit an error.q", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8"}, "originalPosition": 237}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1OTE3NQ==", "bodyText": "Don't suppress the future, we need to fix it, or at least have a good reasoning for waiting forever.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405159175", "createdAt": "2020-04-07T22:51:00Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -709,6 +716,7 @@ protected void shutdown() throws InterruptedException {\n      *\n      * @return future completes when the lifecycle thread shuts down.\n      */\n+    @SuppressWarnings({\"PMD.AvoidGettingFutureWithoutTimeout\", \"PMD.AvoidCatchingGenericException\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8"}, "originalPosition": 245}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MDAwMw==", "bodyText": "same here, we need to be very careful with this suppression.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405160003", "createdAt": "2020-04-07T22:53:15Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -634,6 +641,7 @@ public Topics findServiceTopic(String name) {\n         return totallyCompleteFuture;\n     }\n \n+    @SuppressWarnings(\"PMD.AvoidGettingFutureWithoutTimeout\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8"}, "originalPosition": 139}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a352c1644b094120835387417af9adf8e91ff2f8", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a352c1644b094120835387417af9adf8e91ff2f8", "committedDate": "2020-04-07T22:33:56Z", "message": "Address PMD violations"}, "afterCommit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6482b610add31d091dfb2743acf888dd3a239632", "committedDate": "2020-04-07T23:20:19Z", "message": "Address PMD violations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTU5MzA4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-389559308", "createdAt": "2020-04-07T23:31:11Z", "commit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTY3NzEw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-389567710", "createdAt": "2020-04-07T23:55:16Z", "commit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMzo1NToxN1rOGCaRCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMzo1NToxN1rOGCaRCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE4MDY4Mw==", "bodyText": "curious whats the violation behind the rename", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405180683", "createdAt": "2020-04-07T23:55:17Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/config/Topic.java", "diffHunk": "@@ -88,8 +82,8 @@ public void appendTo(Appendable a) throws IOException {\n         appendValueTo(a);\n     }\n \n-    public Topic setValue(Object nv) {\n-        return setValue(System.currentTimeMillis(), nv);\n+    public Topic withValue(Object nv) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTczMzI5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-389573329", "createdAt": "2020-04-08T00:12:23Z", "commit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDoxMjoyNFrOGCak6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDoxMjoyNFrOGCak6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE4NTc3MQ==", "bodyText": "remove Objects.requireNonNull(from) ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405185771", "createdAt": "2020-04-08T00:12:24Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/config/Topics.java", "diffHunk": "@@ -55,7 +55,7 @@ public int size() {\n     }\n \n     @Override\n-    public void copyFrom(Node from) {\n+    public void copyFrom(@Nonnull Node from) {\n         Objects.requireNonNull(from);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTc2Mjc5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-389576279", "createdAt": "2020-04-08T00:21:20Z", "commit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDoyMToyMFrOGCavFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDoyMToyMFrOGCavFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE4ODM3NA==", "bodyText": "what the violation for making this more verbose?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#discussion_r405188374", "createdAt": "2020-04-08T00:21:20Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EZTemplates.java", "diffHunk": "@@ -46,9 +46,10 @@ public static CharSequence toCS(InputStream in) throws IOException {\n     @SuppressWarnings(\"ThrowableResultIgnored\")\n     public static CharSequence toCS(Reader in) throws IOException {\n         StringBuilder sb = new StringBuilder();\n-        int c;\n-        while ((c = in.read()) >= 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "909429dc08e6beeed23430e299fce3b3a6d9d83f", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/909429dc08e6beeed23430e299fce3b3a6d9d83f", "committedDate": "2020-04-08T04:25:26Z", "message": "Address PMD violations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6482b610add31d091dfb2743acf888dd3a239632", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6482b610add31d091dfb2743acf888dd3a239632", "committedDate": "2020-04-07T23:20:19Z", "message": "Address PMD violations"}, "afterCommit": {"oid": "909429dc08e6beeed23430e299fce3b3a6d9d83f", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/909429dc08e6beeed23430e299fce3b3a6d9d83f", "committedDate": "2020-04-08T04:25:26Z", "message": "Address PMD violations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTY4ODQw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-390168840", "createdAt": "2020-04-08T17:08:57Z", "commit": {"oid": "909429dc08e6beeed23430e299fce3b3a6d9d83f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzQ2NTk0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/160#pullrequestreview-390346594", "createdAt": "2020-04-08T21:30:38Z", "commit": {"oid": "909429dc08e6beeed23430e299fce3b3a6d9d83f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2418, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}