{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3ODQwNTUy", "number": 554, "title": "Use separate logger file for GenericExternalService stdout/stderr", "bodyText": "Issue #, if available:\nDescription of changes:\nAdds a separateLogger to GenericExternalService which is a logger which writes to a separate file instead of the main greengrass.log file. It is automatically used by ShellRunner for logging from shells. It will also be used by Lambda for lambda logging.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-21T20:20:49Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554", "merged": true, "mergeCommit": {"oid": "1bd55b9439e26453f7ec8fdc3d941a2dbd752be4"}, "closed": true, "closedAt": "2020-10-22T15:07:27Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUzU0SgBqjM5MDU4MTAwNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVDY7HgFqTUxNDgzMjI5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f12f69eecbb4a0727cf20bdac7081548370865e9", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f12f69eecbb4a0727cf20bdac7081548370865e9", "committedDate": "2020-10-21T20:19:53Z", "message": "Use separate logger file for GenericExternalService stdout/stderr"}, "afterCommit": {"oid": "9e5def8e92a53da0a8fea7afa399769b65b106cb", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9e5def8e92a53da0a8fea7afa399769b65b106cb", "committedDate": "2020-10-21T20:23:24Z", "message": "Use separate logger file for GenericExternalService stdout/stderr"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e5def8e92a53da0a8fea7afa399769b65b106cb", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9e5def8e92a53da0a8fea7afa399769b65b106cb", "committedDate": "2020-10-21T20:23:24Z", "message": "Use separate logger file for GenericExternalService stdout/stderr"}, "afterCommit": {"oid": "3127318a44ab91e141f3818b8860dd8bc22d65b2", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3127318a44ab91e141f3818b8860dd8bc22d65b2", "committedDate": "2020-10-21T20:33:56Z", "message": "Use separate logger file for GenericExternalService stdout/stderr"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3127318a44ab91e141f3818b8860dd8bc22d65b2", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3127318a44ab91e141f3818b8860dd8bc22d65b2", "committedDate": "2020-10-21T20:33:56Z", "message": "Use separate logger file for GenericExternalService stdout/stderr"}, "afterCommit": {"oid": "21c2cb236d4936f2431ac75274c0e6218e20ec38", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/21c2cb236d4936f2431ac75274c0e6218e20ec38", "committedDate": "2020-10-21T20:40:28Z", "message": "Use separate logger file for GenericExternalService stdout/stderr"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21c2cb236d4936f2431ac75274c0e6218e20ec38", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/21c2cb236d4936f2431ac75274c0e6218e20ec38", "committedDate": "2020-10-21T20:40:28Z", "message": "Use separate logger file for GenericExternalService stdout/stderr"}, "afterCommit": {"oid": "3246971b588d479e6cafcd3949fea827e45a6d0a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3246971b588d479e6cafcd3949fea827e45a6d0a", "committedDate": "2020-10-21T20:55:30Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3246971b588d479e6cafcd3949fea827e45a6d0a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3246971b588d479e6cafcd3949fea827e45a6d0a", "committedDate": "2020-10-21T20:55:30Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}, "afterCommit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d675c1e13c99cbf3f0d5374caab5a4b3660bbc17", "committedDate": "2020-10-21T20:57:08Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTk1NDU4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#pullrequestreview-514195458", "createdAt": "2020-10-21T21:21:29Z", "commit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMToyMToyOVrOHmGKTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMToyOTo0OVrOHmGlCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTcwODg3OA==", "bodyText": "I thought we decide the generic external service log will go to greengrass.log. Did you change your mind?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#discussion_r509708878", "createdAt": "2020-10-21T21:21:29Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java", "diffHunk": "@@ -261,7 +268,7 @@ private synchronized void handleRunScript() throws InterruptedException {\n             // Synchronize within the callback so that these reportStates don't interfere with\n             // the reportStates outside of the callback\n             synchronized (this) {\n-                logger.atInfo().kv(\"exitCode\", exit).log(\"Run script exited\");\n+                separateLogger.atInfo().kv(\"exitCode\", exit).log(\"Run script exited\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTcxMTAxMg==", "bodyText": "Why createChild? Why not just use the component logger?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#discussion_r509711012", "createdAt": "2020-10-21T21:24:16Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java", "diffHunk": "@@ -71,6 +74,10 @@ public GenericExternalService(Topics c) {\n     protected GenericExternalService(Topics c, Topics privateSpace) {\n         super(c, privateSpace);\n \n+        this.separateLogger = LogManagerHelper.getComponentLogger(this).createChild();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTcxNTcyMw==", "bodyText": "What would the name of the log file? Is it COMPONENT_NAME.log? What would happen if the name collides with the log file created by the customer's component code (e.g. if they use log4j in their code)? Would it be better name it COMPONENT_NAME.stdout?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#discussion_r509715723", "createdAt": "2020-10-21T21:29:49Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java", "diffHunk": "@@ -71,6 +74,10 @@ public GenericExternalService(Topics c) {\n     protected GenericExternalService(Topics c, Topics privateSpace) {\n         super(c, privateSpace);\n \n+        this.separateLogger = LogManagerHelper.getComponentLogger(this).createChild();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTcxMTAxMg=="}, "originalCommit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjEyODMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#pullrequestreview-514212832", "createdAt": "2020-10-21T21:51:13Z", "commit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d675c1e13c99cbf3f0d5374caab5a4b3660bbc17", "committedDate": "2020-10-21T20:57:08Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}, "afterCommit": {"oid": "7c7115c0cfe6242895a1798ff5e70c53ceab452b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7c7115c0cfe6242895a1798ff5e70c53ceab452b", "committedDate": "2020-10-21T21:54:32Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjE0Njkz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#pullrequestreview-514214693", "createdAt": "2020-10-21T21:54:37Z", "commit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMTo1NDozOFrOHmHqwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMTo1NDozOFrOHmHqwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTczMzU2OQ==", "bodyText": "Any reason to make this a final class? I was thinking of having the kernel logging topics subscribed here so that this class and only this class will be responsible for any logging config changes.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#discussion_r509733569", "createdAt": "2020-10-21T21:54:38Z", "author": {"login": "nikkhilmuthye"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -5,30 +5,19 @@\n \n package com.aws.greengrass.lifecyclemanager;\n \n+import com.aws.greengrass.logging.api.Logger;\n import com.aws.greengrass.logging.impl.LogManager;\n import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n \n /**\n  * Helper function to get a logger with configurations separate from the root logger.\n  */\n-public class LogManagerHelper {\n+public final class LogManagerHelper {\n     static final String KERNEL_CONFIG_LOGGING_TOPICS = \"logging\";\n     static final String SERVICE_CONFIG_LOGGING_TOPICS = \"ComponentLogging\";\n     private static final String LOG_FILE_EXTENSION = \".log\";\n-    //private final Kernel kernel;\n \n-    /**\n-     * Constructor for LogManagerHelper.\n-     * @param kernel {@link Kernel}\n-     */\n-    @SuppressWarnings(\"PMD.UnusedFormalParameter\")\n-    public LogManagerHelper(Kernel kernel) {\n-        //this.kernel = kernel;\n-        // TODO: uncomment this after KERNEL_COMPONENT_NAME is available to use.\n-        //this.kernel.getConfig().lookup(SERVICES_NAMESPACE_TOPIC, KERNEL_COMPONENT_NAME, KERNEL_CONFIG_LOGGING_TOPICS)\n-        //        .subscribe((why, newv) -> {\n-        //            // TODO: Reconfigure all loggers using logging configuration in the kernel config.\n-        //        });\n+    private LogManagerHelper() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d675c1e13c99cbf3f0d5374caab5a4b3660bbc17"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjE1MDkz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#pullrequestreview-514215093", "createdAt": "2020-10-21T21:55:24Z", "commit": {"oid": "7c7115c0cfe6242895a1798ff5e70c53ceab452b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjE3OTM4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#pullrequestreview-514217938", "createdAt": "2020-10-21T22:00:45Z", "commit": {"oid": "7c7115c0cfe6242895a1798ff5e70c53ceab452b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c7115c0cfe6242895a1798ff5e70c53ceab452b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7c7115c0cfe6242895a1798ff5e70c53ceab452b", "committedDate": "2020-10-21T21:54:32Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}, "afterCommit": {"oid": "2da84ebc0ebad06908ffe303f824edd71af9cf90", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2da84ebc0ebad06908ffe303f824edd71af9cf90", "committedDate": "2020-10-22T03:54:19Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "086d7b19d2fef032c45ae50896d4eed63aabe537", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/086d7b19d2fef032c45ae50896d4eed63aabe537", "committedDate": "2020-10-22T05:10:55Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2da84ebc0ebad06908ffe303f824edd71af9cf90", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2da84ebc0ebad06908ffe303f824edd71af9cf90", "committedDate": "2020-10-22T03:54:19Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}, "afterCommit": {"oid": "086d7b19d2fef032c45ae50896d4eed63aabe537", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/086d7b19d2fef032c45ae50896d4eed63aabe537", "committedDate": "2020-10-22T05:10:55Z", "message": "Use separate logger file for GenericExternalService's stdout/stderr"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0Mzc1Mjc5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#pullrequestreview-514375279", "createdAt": "2020-10-22T05:43:59Z", "commit": {"oid": "086d7b19d2fef032c45ae50896d4eed63aabe537"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9325726fffd590d00a4bca3d32592cad0cd8508a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9325726fffd590d00a4bca3d32592cad0cd8508a", "committedDate": "2020-10-22T05:48:45Z", "message": "Merge branch 'master' into sep-log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODMyMjk0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/554#pullrequestreview-514832294", "createdAt": "2020-10-22T15:06:35Z", "commit": {"oid": "9325726fffd590d00a4bca3d32592cad0cd8508a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2809, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}