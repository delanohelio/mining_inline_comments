{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NTI4Mzg0", "number": 428, "title": "Use Jackson instead of custom serializer in tlog", "bodyText": "Issue #, if available:\nDescription of changes:\nUsing Jackson instead of Coerce to serialize in the tlog so that everything is properly accounted for.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-11T01:47:30Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428", "merged": true, "mergeCommit": {"oid": "0a95863c7e9d8280d16c3d161f4f9fd2303dfffa"}, "closed": true, "closedAt": "2020-09-16T21:42:14Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHrjB0gBqjM3NTM5MjkyNzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJjd2TAFqTQ5MDA0MDgzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b9cee4791918500fe266464fd91e5503e40a877", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2b9cee4791918500fe266464fd91e5503e40a877", "committedDate": "2020-09-11T01:46:25Z", "message": "Use Jackson instead of custom serializer"}, "afterCommit": {"oid": "bf467e14fbdb21949b7b1dee6d692ba7fc947170", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bf467e14fbdb21949b7b1dee6d692ba7fc947170", "committedDate": "2020-09-11T01:58:39Z", "message": "Use Jackson instead of custom serializer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88a9dd1911aba0a48d54f45f4b0866c1c3cd71fd", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/88a9dd1911aba0a48d54f45f4b0866c1c3cd71fd", "committedDate": "2020-09-13T20:53:37Z", "message": "Merge branch 'master' into tlog"}, "afterCommit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161", "committedDate": "2020-09-14T22:13:02Z", "message": "Use Jackson instead of custom serializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MjU4OTA4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#pullrequestreview-488258908", "createdAt": "2020-09-15T01:23:46Z", "commit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMToyMzo0NlrOHRtEsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMToyNDoyMVrOHRtFZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyNjMyMQ==", "bodyText": "reuse objectmapper from utils?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r488326321", "createdAt": "2020-09-15T01:23:46Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/util/Coerce.java", "diffHunk": "@@ -4,32 +4,23 @@\n package com.aws.iot.evergreen.util;\n \n import com.aws.iot.evergreen.config.Topic;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n \n import java.io.IOException;\n import java.lang.reflect.Array;\n import java.util.Arrays;\n import java.util.List;\n-import java.util.Map;\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n import static com.aws.iot.evergreen.util.Utils.isEmpty;\n \n public final class Coerce {\n-    public static final Object removed = new Object() {\n-        @Override\n-        public String toString() {\n-            return \"removed\";\n-        }\n-    };\n-    private static final Map<String, Object> specials =\n-            Utils.immutableMap(\"true\", true, \"false\", false, \"removed\", removed, \"Inf\", Double.POSITIVE_INFINITY,\n-                    \"+Inf\", Double.POSITIVE_INFINITY, \"-Inf\", Double.NEGATIVE_INFINITY, \"Nan\", Double.NaN, \"NaN\",\n-                    Double.NaN, \"inf\", Double.POSITIVE_INFINITY, \"+inf\", Double.POSITIVE_INFINITY, \"-inf\",\n-                    Double.NEGATIVE_INFINITY, \"nan\", Double.NaN);\n-    private static final char[] hex = \"0123456789ABCDEF\".toCharArray();\n-    private static final Pattern seperators = Pattern.compile(\" *, *\");\n+    private static final Pattern SEPARATORS = Pattern.compile(\" *, *\");\n     private static final Pattern unwrap = Pattern.compile(\" *\\\\[ *(.*) *\\\\] *\");\n+    private static final ObjectMapper MAPPER = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyNjUwMw==", "bodyText": "Why do we still use comma separated line?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r488326503", "createdAt": "2020-09-15T01:24:21Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/config/Tlogline.java", "diffHunk": "@@ -49,16 +55,25 @@ static Tlogline fromStringInput(String l) throws InvalidLogException {\n         if (!m.matches()) {\n             throw new InvalidLogException(\"unrecognized log format: \" + l);\n         }\n-        long timestamp = parseLong(m.group(1));\n-        String topicString = m.group(2);\n         WhatHappened action = WhatHappened.valueOf(m.group(3).toLowerCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a1faa509a8abb6e7d4b9bf73f6f3fad4b6016161", "committedDate": "2020-09-14T22:13:02Z", "message": "Use Jackson instead of custom serializer"}, "afterCommit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e68d0af088e8a523180bfb2511c294c8bd9f9869", "committedDate": "2020-09-16T04:13:44Z", "message": "Use Jackson instead of custom serializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODQyNzI3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#pullrequestreview-489842727", "createdAt": "2020-09-16T17:26:41Z", "commit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyNjo0MVrOHS6_gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNzoyNjo0MVrOHS6_gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYwMjk0Nw==", "bodyText": "Is this platform-safe?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#discussion_r489602947", "createdAt": "2020-09-16T17:26:41Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/config/ConfigurationWriter.java", "diffHunk": "@@ -119,7 +120,8 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n         }\n \n         try {\n-            tlogline.outputTo(out);\n+            Coerce.appendParseableString(tlogline, out);\n+            out.write('\\n');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODQ2MTgw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#pullrequestreview-489846180", "createdAt": "2020-09-16T17:31:27Z", "commit": {"oid": "e68d0af088e8a523180bfb2511c294c8bd9f9869"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32e9d01389004a745d1f8b39f605dcacc21ee499", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/32e9d01389004a745d1f8b39f605dcacc21ee499", "committedDate": "2020-09-16T19:43:05Z", "message": "Use Jackson instead of custom serializer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2427f2bc43f39bea7b4ea167d9c9591ecd15113", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e2427f2bc43f39bea7b4ea167d9c9591ecd15113", "committedDate": "2020-09-16T19:08:58Z", "message": "Merge branch 'master' into tlog"}, "afterCommit": {"oid": "32e9d01389004a745d1f8b39f605dcacc21ee499", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/32e9d01389004a745d1f8b39f605dcacc21ee499", "committedDate": "2020-09-16T19:43:05Z", "message": "Use Jackson instead of custom serializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5OTcxNDQx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#pullrequestreview-489971441", "createdAt": "2020-09-16T19:51:18Z", "commit": {"oid": "32e9d01389004a745d1f8b39f605dcacc21ee499"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38cb5b278cd4f575b4f807a2a838f6bea27e4d6b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/38cb5b278cd4f575b4f807a2a838f6bea27e4d6b", "committedDate": "2020-09-16T20:20:02Z", "message": "Move E2E tests to separate workflow, add IamException as retryable for e2e failures"}, "afterCommit": {"oid": "27f2d3f70c7a00f7406fbe8406688d7b63212acf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/27f2d3f70c7a00f7406fbe8406688d7b63212acf", "committedDate": "2020-09-16T20:21:39Z", "message": "Move E2E tests to separate workflow, add IamException as retryable for e2e failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18a004644dd3708289548f0b50c1a5e9d9a01c35", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/18a004644dd3708289548f0b50c1a5e9d9a01c35", "committedDate": "2020-09-16T20:34:32Z", "message": "Move E2E tests to separate workflow, add IamException as retryable for e2e failures"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "27f2d3f70c7a00f7406fbe8406688d7b63212acf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/27f2d3f70c7a00f7406fbe8406688d7b63212acf", "committedDate": "2020-09-16T20:21:39Z", "message": "Move E2E tests to separate workflow, add IamException as retryable for e2e failures"}, "afterCommit": {"oid": "18a004644dd3708289548f0b50c1a5e9d9a01c35", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/18a004644dd3708289548f0b50c1a5e9d9a01c35", "committedDate": "2020-09-16T20:34:32Z", "message": "Move E2E tests to separate workflow, add IamException as retryable for e2e failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDA0NzAy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#pullrequestreview-490004702", "createdAt": "2020-09-16T20:41:56Z", "commit": {"oid": "18a004644dd3708289548f0b50c1a5e9d9a01c35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDQwODM1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/428#pullrequestreview-490040835", "createdAt": "2020-09-16T21:41:50Z", "commit": {"oid": "18a004644dd3708289548f0b50c1a5e9d9a01c35"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3290, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}