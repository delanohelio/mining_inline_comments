{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNjAzOTkw", "number": 585, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyNzowN1rOEzgSvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjowMzoxOVrOEz-ZTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNDQxOTE2OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyNzowN1rOHqw49Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyODozM1rOHqw6-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzI1Mw==", "bodyText": "this test doesn't seem to actually validate the behavior for wildcards in topics.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603253", "createdAt": "2020-10-29T22:27:07Z", "author": {"login": "MikeDombo"}, "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -6,7 +6,6 @@\n package com.aws.greengrass.builtin.services.mqttproxy;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzc2OA==", "bodyText": "yes, I'm working on adding tests for that. just wanted to get some quick feedback on the code change", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603768", "createdAt": "2020-10-29T22:28:33Z", "author": {"login": "popanmol"}, "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -6,7 +6,6 @@\n package com.aws.greengrass.builtin.services.mqttproxy;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzI1Mw=="}, "originalCommit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNDQyMzI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgent.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyODo1NVrOHqw7bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyODo1NVrOHqw7bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzg4Nw==", "bodyText": "let's have a unit test for this behavior", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603887", "createdAt": "2020-10-29T22:28:55Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgent.java", "diffHunk": "@@ -199,12 +201,32 @@ private QualityOfService getQualityOfServiceFromQOS(QOS qos) {\n     }\n \n     private void doAuthorization(String opName, String serviceName, String topic) throws AuthorizationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78611357181a0de7841d3e443d99a7156e37a62d"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNTA1NDE3OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/resources/com/aws/greengrass/integrationtests/ipc/mqttproxy.yaml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMjoxMTo0MlrOHq3Mlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMjoxMTo0MlrOHq3Mlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDcwNjU4Mg==", "bodyText": "make these more different, as it is, either one would match", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514706582", "createdAt": "2020-10-30T02:11:42Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/resources/com/aws/greengrass/integrationtests/ipc/mqttproxy.yaml", "diffHunk": "@@ -16,7 +16,8 @@ services:\n                 \"aws.greengrass#SubscribeToIoTCore\"\n               ],\n               \"resources\":[\n-                \"A/B/C\"\n+                \"A/+/C\",\n+                \"A/B/#\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb80eedddc5c868c1aaf4df52039233d3cb2f904"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNTY4MzI0OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/aws/greengrass/authorization/AuthorizationModuleTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNDoxMTo1NlrOHq-NKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNDoxMTo1NlrOHq-NKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDgyMTQxNg==", "bodyText": "Policy is missing a couple cases. We need to ensure getAuthorizedResources() can handle wildcards (both principal and operation) and that it filters out resources that aren't matches.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514821416", "createdAt": "2020-10-30T04:11:56Z", "author": {"login": "jbutler"}, "path": "src/test/java/com/aws/greengrass/authorization/AuthorizationModuleTest.java", "diffHunk": "@@ -121,4 +123,25 @@ void Given_authZmodule_WHEN_added_entries_successively_THEN_retrieve_works() {\n             }\n         });\n     }\n+\n+    @Test\n+    void Given_authZmodule_WHEN_added_entries_THEN_getResources_works() throws AuthorizationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b82bc873d14c6087b219ff19b4317839433d94a"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTI0MjQxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/authorization/AuthorizationHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToxMzozOVrOHrgpaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToxMzozOVrOHrgpaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NTcwNA==", "bodyText": "Update the comment", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515385704", "createdAt": "2020-10-30T21:13:39Z", "author": {"login": "prateek-y"}, "path": "src/main/java/com/aws/greengrass/authorization/AuthorizationHandler.java", "diffHunk": "@@ -192,6 +193,28 @@ public boolean isAuthorized(String destination, Permission permission) throws Au\n                         resource));\n     }\n \n+    /**\n+     * Get allowed resources for the combination of destination, principal and operation.\n+     * Also returns resources covered by permissions with * operation/principal.\n+     *\n+     * @param destination destination\n+     * @param principal   principal (cannot be *)\n+     * @param operation   operation (cannot be *)\n+     * @return list of allowed resources\n+     * @throws AuthorizationException when flow is not authorized", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTM1MTE5OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjowMzoxOVrOHrhqVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMjoyMjozM1rOHrh_Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwMjMyNQ==", "bodyText": "do you need tests for multiple + or a combination of + and #", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515402325", "createdAt": "2020-10-30T22:03:19Z", "author": {"login": "prateek-y"}, "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -54,6 +59,18 @@\n     private static final String TEST_TOPIC = \"TestTopic\";\n     private static final byte[] TEST_PAYLOAD = \"TestPayload\".getBytes(StandardCharsets.UTF_8);\n \n+    private static final String TEST_SINGLE_LEVEL_WILDCARD = \"topic/with/single/level/+/wildcard\";\n+    private static final String TEST_MULTI_LEVEL_WILDCARD = \"topic/with/multi/level/wildcard/#\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwNzY3OA==", "bodyText": "various cases covered in https://github.com/aws/aws-greengrass-nucleus/blob/master/src/test/java/com/aws/greengrass/mqttclient/MqttTopicTest.java", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515407678", "createdAt": "2020-10-30T22:22:33Z", "author": {"login": "popanmol"}, "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -54,6 +59,18 @@\n     private static final String TEST_TOPIC = \"TestTopic\";\n     private static final byte[] TEST_PAYLOAD = \"TestPayload\".getBytes(StandardCharsets.UTF_8);\n \n+    private static final String TEST_SINGLE_LEVEL_WILDCARD = \"topic/with/single/level/+/wildcard\";\n+    private static final String TEST_MULTI_LEVEL_WILDCARD = \"topic/with/multi/level/wildcard/#\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwMjMyNQ=="}, "originalCommit": {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 419, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}