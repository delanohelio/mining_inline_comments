{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNDIyODI1", "number": 249, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDoxODoxM1rOD-BCRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1Mjo0NFrOD-U-eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzU1MjcxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/kernel/GenericExternalService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDoxODoxM1rOGX3Ckw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMjowMDo0N1rOGX4tPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY3MjIxMQ==", "bodyText": "I feel this should be right before L350", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/249#discussion_r427672211", "createdAt": "2020-05-20T00:18:13Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/GenericExternalService.java", "diffHunk": "@@ -327,6 +328,11 @@ public void handleError() throws InterruptedException {\n     @SuppressWarnings(\"PMD.CloseResource\")\n     protected Pair<RunStatus, Exec> run(Topic t, String cmd, IntConsumer background, List<Exec> trackingList)\n             throws InterruptedException {\n+        // Don't run anything if the current thread is currently interrupted\n+        if (Thread.currentThread().isInterrupted()) {\n+            throw new InterruptedException();\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef514274a2402f9373c96b5a96f7a765be1f13d4"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY5OTUxOA==", "bodyText": "Moved it all the way into Exec so that we check immediately before running.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/249#discussion_r427699518", "createdAt": "2020-05-20T02:00:47Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/GenericExternalService.java", "diffHunk": "@@ -327,6 +328,11 @@ public void handleError() throws InterruptedException {\n     @SuppressWarnings(\"PMD.CloseResource\")\n     protected Pair<RunStatus, Exec> run(Topic t, String cmd, IntConsumer background, List<Exec> trackingList)\n             throws InterruptedException {\n+        // Don't run anything if the current thread is currently interrupted\n+        if (Thread.currentThread().isInterrupted()) {\n+            throw new InterruptedException();\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY3MjIxMQ=="}, "originalCommit": {"oid": "ef514274a2402f9373c96b5a96f7a765be1f13d4"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NjY1NDY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzowNjo1MlrOGYVlNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzoyMTo1NlrOGYWHww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE3MjU5OQ==", "bodyText": "why separating logger and static logger?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/249#discussion_r428172599", "createdAt": "2020-05-20T17:06:52Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -101,6 +101,7 @@\n     private Copier stdoutc;\n     private final AtomicBoolean isClosed = new AtomicBoolean(false);\n     AtomicInteger numberOfCopiers;\n+    private Logger logger = staticLogger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56f26fb007dbaa1312ec4bc0a2d7d5ad11f49858"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE4MTQ0Mw==", "bodyText": "Because there's a portion of code at the top of this class that needs a logger and that portion of code is static; so it isn't running on behalf of any other service.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/249#discussion_r428181443", "createdAt": "2020-05-20T17:21:56Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -101,6 +101,7 @@\n     private Copier stdoutc;\n     private final AtomicBoolean isClosed = new AtomicBoolean(false);\n     AtomicInteger numberOfCopiers;\n+    private Logger logger = staticLogger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE3MjU5OQ=="}, "originalCommit": {"oid": "56f26fb007dbaa1312ec4bc0a2d7d5ad11f49858"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NjgxNTUwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1MTozN1rOGYXMvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1NDo0OVrOGYXUhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE5OTEwMw==", "bodyText": "Exec is closed() when the timeout for the task is reached. Is cancelling the backing task the problem? Wouldn't InterruptedException be thrown for this scenario?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/249#discussion_r428199103", "createdAt": "2020-05-20T17:51:37Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -308,6 +314,12 @@ public Exec withErr(Consumer<CharSequence> o) {\n \n     @SuppressWarnings(\"PMD.AvoidRethrowingException\")\n     private void exec() throws InterruptedException, IOException {\n+        // Don't run anything if the current thread is currently interrupted", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56f26fb007dbaa1312ec4bc0a2d7d5ad11f49858"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMTA5Mw==", "bodyText": "Yes, it will be interrupted, but it will run the command before it gets interrupted. So, I\u2019m just adding another check so that we don\u2019t even run the command if it is interrupted", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/249#discussion_r428201093", "createdAt": "2020-05-20T17:54:49Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/util/Exec.java", "diffHunk": "@@ -308,6 +314,12 @@ public Exec withErr(Consumer<CharSequence> o) {\n \n     @SuppressWarnings(\"PMD.AvoidRethrowingException\")\n     private void exec() throws InterruptedException, IOException {\n+        // Don't run anything if the current thread is currently interrupted", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE5OTEwMw=="}, "originalCommit": {"oid": "56f26fb007dbaa1312ec4bc0a2d7d5ad11f49858"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NjgxOTc2OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/kernel/GenericExternalServiceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1Mjo0NFrOGYXPiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1Mjo0NFrOGYXPiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE5OTgxNg==", "bodyText": "Nice", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/249#discussion_r428199816", "createdAt": "2020-05-20T17:52:44Z", "author": {"login": "fahadmohammed01"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/kernel/GenericExternalServiceTest.java", "diffHunk": "@@ -79,6 +82,25 @@ void GIVEN_service_with_timeout_WHEN_timeout_expires_THEN_move_service_to_errore\n         assertTrue(ServicesBErroredLatch.await(5, TimeUnit.SECONDS));\n     }\n \n+    @Test\n+    void GIVEN_service_shutdown_with_timeout_WHEN_timeout_expires_THEN_service_still_closes()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56f26fb007dbaa1312ec4bc0a2d7d5ad11f49858"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4727, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}