{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0OTEyNDAx", "number": 297, "title": "Add runtime namespace for service local datastore", "bodyText": "Place service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date.\nIssue #, if available:\nkeys in the config store need to have separate namespaces for full-replacing on deployment and merge on deployment.\nService local datastore should not be affected by deployment.\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-07-06T17:33:32Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297", "merged": true, "mergeCommit": {"oid": "9b3915bdf5c037d401708eccbc0ed0f7c3e822d1"}, "closed": true, "closedAt": "2020-07-10T17:23:57Z", "author": {"login": "ShirleyZheng92"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyXlvUAFqTQ0MzM5MDc0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABczm71XAFqTQ0NjU2ODE2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMzkwNzQ1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-443390745", "createdAt": "2020-07-06T20:37:23Z", "commit": {"oid": "1af750645b3502a42950661761c0a6c63b8b1a92"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMDozNzoyM1rOGtmSeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMDo0Njo1M1rOGtmkQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2NjQyNg==", "bodyText": "I know this is not part of this PR and that it has existed for some time now, but could we change this namespace to something better? Ideally we should name it based on the purpose it's serving and not how we internally handle updates to it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#discussion_r450466426", "createdAt": "2020-07-06T20:37:23Z", "author": {"login": "shaguptashaikh"}, "path": "README_CONFIG_SCHEMA.md", "diffHunk": "@@ -25,16 +25,29 @@ services:\n         \n     lifecycle: # lifecycle commands.\n     \n+    resources: # service reserved resources path.\n+\n     logging: # logging config.\n       \n     custom: # custom config. \n     \n+    notRolledBack: # config that's not being rolled back during deployment", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1af750645b3502a42950661761c0a6c63b8b1a92"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2ODA5NA==", "bodyText": "I'm a little confused as to how this is meant to be 1) used and 2) updated. Will this come from the recipe? And can it be modified through deployments directly or can service modify it only over IPC? Could you maybe describe your thought process in the PR description?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#discussion_r450468094", "createdAt": "2020-07-06T20:40:53Z", "author": {"login": "shaguptashaikh"}, "path": "README_CONFIG_SCHEMA.md", "diffHunk": "@@ -25,16 +25,29 @@ services:\n         \n     lifecycle: # lifecycle commands.\n     \n+    resources: # service reserved resources path.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1af750645b3502a42950661761c0a6c63b8b1a92"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2ODI2NA==", "bodyText": "Same as above, how will this be used and modified, and why is this needed if there's is also per service configuration for resources?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#discussion_r450468264", "createdAt": "2020-07-06T20:41:14Z", "author": {"login": "shaguptashaikh"}, "path": "README_CONFIG_SCHEMA.md", "diffHunk": "@@ -25,16 +25,29 @@ services:\n         \n     lifecycle: # lifecycle commands.\n     \n+    resources: # service reserved resources path.\n+\n     logging: # logging config.\n       \n     custom: # custom config. \n     \n+    notRolledBack: # config that's not being rolled back during deployment\n+\n   <service2>:\n     lifecycle:\n     logging:\n     \n+  _AUTH_TOKENS: # auth token read by AuthHandler\n+    <authToken>: <serviceName>\n+\n system:\n   <kernel system config> \n+\n+registered-resource: # resources registered by service", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1af750645b3502a42950661761c0a6c63b8b1a92"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MDk3OA==", "bodyText": "Why is there both 'runtime' and 'notRolledBack' namespace? if you're adding this namespace then we should change the notRolledBack namespace in DeploymentConfigMerger to runtime because it was essentially supposed to serve the same purpose. Please also change it in the config schema .md file.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#discussion_r450470978", "createdAt": "2020-07-06T20:46:53Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/EvergreenService.java", "diffHunk": "@@ -39,6 +39,7 @@\n \n public class EvergreenService implements InjectionActions, DisruptableCheck {\n     public static final String SERVICES_NAMESPACE_TOPIC = \"services\";\n+    public static final String RUNTIME_STORE_NAMESPACE_TOPIC = \"runtime\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1af750645b3502a42950661761c0a6c63b8b1a92"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1af750645b3502a42950661761c0a6c63b8b1a92", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1af750645b3502a42950661761c0a6c63b8b1a92", "committedDate": "2020-07-06T17:17:28Z", "message": "Add runtime namespace for service local datastore\n\nPlace service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date."}, "afterCommit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fa9ad25f464dbf130b188d555e75402a6057741b", "committedDate": "2020-07-06T21:37:50Z", "message": "Add runtime namespace for service local datastore\n\nPlace service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDgxNTY5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-443481569", "createdAt": "2020-07-07T00:13:32Z", "commit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoxMzozMlrOGtq80w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoxMzozMlrOGtq80w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0MjgwMw==", "bodyText": "Nice! Let's start updating the README! Yay!", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#discussion_r450542803", "createdAt": "2020-07-07T00:13:32Z", "author": {"login": "leaf94"}, "path": "README_CONFIG_SCHEMA.md", "diffHunk": "@@ -25,16 +25,30 @@ services:\n         \n     lifecycle: # lifecycle commands.\n     \n+    resources: # service reserved resources path.\n+\n     logging: # logging config.\n       \n     custom: # custom config. \n     \n+    runtime: # namespace for service local datastore\n+        # not rolled back during deployment\n+\n   <service2>:\n     lifecycle:\n     logging:\n     \n+  _AUTH_TOKENS: # auth token read by AuthHandler\n+    <authToken>: <serviceName>\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDg1Nzk3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-443485797", "createdAt": "2020-07-07T00:28:25Z", "commit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoyODoyNVrOGtrMWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoyODoyNVrOGtrMWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0Njc3Ng==", "bodyText": "custom is gone, right?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#discussion_r450546776", "createdAt": "2020-07-07T00:28:25Z", "author": {"login": "MikeDombo"}, "path": "README_CONFIG_SCHEMA.md", "diffHunk": "@@ -25,16 +25,30 @@ services:\n         \n     lifecycle: # lifecycle commands.\n     \n+    resources: # service reserved resources path.\n+\n     logging: # logging config.\n       \n     custom: # custom config. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDg2Mjg3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-443486287", "createdAt": "2020-07-07T00:30:23Z", "commit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDozMDoyM1rOGtrOOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDozMDoyM1rOGtrOOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0NzI1OQ==", "bodyText": "we should use the DeviceConfiguration class to store this stuff.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#discussion_r450547259", "createdAt": "2020-07-07T00:30:23Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java", "diffHunk": "@@ -297,7 +298,7 @@ public void setupIoTRoleForTes(String roleName, String roleAliasName, String cer\n      */\n     public void updateKernelConfigWithTesRoleInfo(Kernel kernel, String roleAliasName) {\n         Topics tesTopics = kernel.getConfig().lookupTopics(SERVICES_NAMESPACE_TOPIC, TOKEN_EXCHANGE_SERVICE_TOPICS);\n-        tesTopics.createLeafChild(IOT_ROLE_ALIAS_TOPIC).withValue(roleAliasName);\n+        tesTopics.lookupTopics(PARAMETERS_CONFIG_KEY).createLeafChild(IOT_ROLE_ALIAS_TOPIC).withValue(roleAliasName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa9ad25f464dbf130b188d555e75402a6057741b", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fa9ad25f464dbf130b188d555e75402a6057741b", "committedDate": "2020-07-06T21:37:50Z", "message": "Add runtime namespace for service local datastore\n\nPlace service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date."}, "afterCommit": {"oid": "62a251ce7875e659f593e2b639ff3eb4860e95f4", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/62a251ce7875e659f593e2b639ff3eb4860e95f4", "committedDate": "2020-07-07T07:04:10Z", "message": "Add runtime namespace for service local datastore\n\nPlace service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69c6185cea87fc7da7ce40fe1222f61b7ab9ca40", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/69c6185cea87fc7da7ce40fe1222f61b7ab9ca40", "committedDate": "2020-07-08T19:02:07Z", "message": "Add runtime namespace for service local datastore\n\nPlace service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62a251ce7875e659f593e2b639ff3eb4860e95f4", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/62a251ce7875e659f593e2b639ff3eb4860e95f4", "committedDate": "2020-07-07T07:04:10Z", "message": "Add runtime namespace for service local datastore\n\nPlace service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date."}, "afterCommit": {"oid": "69c6185cea87fc7da7ce40fe1222f61b7ab9ca40", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/69c6185cea87fc7da7ce40fe1222f61b7ab9ca40", "committedDate": "2020-07-08T19:02:07Z", "message": "Add runtime namespace for service local datastore\n\nPlace service local datastore under \"runtime\" keyword.\nMove TES roleAlias config under 'parameters' keyword.\nUpdate README_CONFIG_SCHEMA.md to date."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d37a940e4c826bf96a4a9e98fea8a36170936b93", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d37a940e4c826bf96a4a9e98fea8a36170936b93", "committedDate": "2020-07-08T23:42:00Z", "message": "Merge branch 'master' into localDatastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2c79b7fa609968f55ff14921c799f72b1878914", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b2c79b7fa609968f55ff14921c799f72b1878914", "committedDate": "2020-07-09T18:32:00Z", "message": "Merge branch 'master' into localDatastore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTU0NDcx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-445954471", "createdAt": "2020-07-09T20:43:03Z", "commit": {"oid": "b2c79b7fa609968f55ff14921c799f72b1878914"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTU3NzUx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-445957751", "createdAt": "2020-07-09T20:48:19Z", "commit": {"oid": "b2c79b7fa609968f55ff14921c799f72b1878914"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16afbc4182c7f199bb1b2e915a556d516f972c72", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/16afbc4182c7f199bb1b2e915a556d516f972c72", "committedDate": "2020-07-10T06:17:40Z", "message": "Fix e2e test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff519be9eee0e9ca0004bbed3931f7da36b965e8", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ff519be9eee0e9ca0004bbed3931f7da36b965e8", "committedDate": "2020-07-09T22:32:34Z", "message": "Fix e2e test"}, "afterCommit": {"oid": "16afbc4182c7f199bb1b2e915a556d516f972c72", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/16afbc4182c7f199bb1b2e915a556d516f972c72", "committedDate": "2020-07-10T06:17:40Z", "message": "Fix e2e test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTY0NDQ3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-446564447", "createdAt": "2020-07-10T17:12:03Z", "commit": {"oid": "16afbc4182c7f199bb1b2e915a556d516f972c72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTY4MTYy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/297#pullrequestreview-446568162", "createdAt": "2020-07-10T17:17:58Z", "commit": {"oid": "16afbc4182c7f199bb1b2e915a556d516f972c72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2852, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}