{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMzMxNjEw", "number": 248, "title": "Deflake LifecycleTest, KernelTest, close ExecutorServices in the Context on shutdown", "bodyText": "Issue #, if available:\nDescription of changes:\nDeflaking LifecycleTest which was flaky due to the use of the Eventually matchers. It largely worked, but the new implementation is much more solid by spying on the lifecycle. I ran it over 200 times without failure.\nAlso deflakes the KernelTest which I ran 50+ times in a row without failure.\nAlso Context now shuts down any executor service which is left in it. This prevents us from having stray threads/thread pools.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-05-19T19:53:29Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/248", "merged": true, "mergeCommit": {"oid": "47f2894463ba6ce1694f0a98b332e8b422da91d5"}, "closed": true, "closedAt": "2020-05-19T22:44:29Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci6OZ0AFqTQxNDc4NTMwMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABci8b7bgFqTQxNDg3NDU1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Nzg1MzAz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/248#pullrequestreview-414785303", "createdAt": "2020-05-19T20:09:44Z", "commit": {"oid": "de547a4d1dbc12bd702a3ced48486e65a3314b40"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de547a4d1dbc12bd702a3ced48486e65a3314b40", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/de547a4d1dbc12bd702a3ced48486e65a3314b40", "committedDate": "2020-05-19T19:51:46Z", "message": "Deflake LifecycleTest, close ExecutorServices in the Context on shutdown"}, "afterCommit": {"oid": "b77b000b61a664dffa78c73b7995478e7b92b96d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b77b000b61a664dffa78c73b7995478e7b92b96d", "committedDate": "2020-05-19T20:10:34Z", "message": "Deflake LifecycleTest, close ExecutorServices in the Context on shutdown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0ODAxMTgw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/248#pullrequestreview-414801180", "createdAt": "2020-05-19T20:33:09Z", "commit": {"oid": "b77b000b61a664dffa78c73b7995478e7b92b96d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDozMzowOVrOGXxjEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDozMzowOVrOGXxjEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4MjIyNw==", "bodyText": "We should prevent EvergreenService from accessing this method.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/248#discussion_r427582227", "createdAt": "2020-05-19T20:33:09Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -358,6 +352,16 @@ private void startStateTransition() throws InterruptedException {\n         }\n     }\n \n+    protected void setState(State current, State newState) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b77b000b61a664dffa78c73b7995478e7b92b96d"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b77b000b61a664dffa78c73b7995478e7b92b96d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b77b000b61a664dffa78c73b7995478e7b92b96d", "committedDate": "2020-05-19T20:10:34Z", "message": "Deflake LifecycleTest, close ExecutorServices in the Context on shutdown"}, "afterCommit": {"oid": "ce37311fe61fea31be80d1b3f6a6ed9d64861ab5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ce37311fe61fea31be80d1b3f6a6ed9d64861ab5", "committedDate": "2020-05-19T20:37:53Z", "message": "Deflake LifecycleTest, close ExecutorServices in the Context on shutdown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ff64d9f51382bc04e64f3eb40b404cf02b90c66", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4ff64d9f51382bc04e64f3eb40b404cf02b90c66", "committedDate": "2020-05-19T21:43:04Z", "message": "Deflake LifecycleTest, close ExecutorServices in the Context on shutdown"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce37311fe61fea31be80d1b3f6a6ed9d64861ab5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ce37311fe61fea31be80d1b3f6a6ed9d64861ab5", "committedDate": "2020-05-19T20:37:53Z", "message": "Deflake LifecycleTest, close ExecutorServices in the Context on shutdown"}, "afterCommit": {"oid": "4ff64d9f51382bc04e64f3eb40b404cf02b90c66", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4ff64d9f51382bc04e64f3eb40b404cf02b90c66", "committedDate": "2020-05-19T21:43:04Z", "message": "Deflake LifecycleTest, close ExecutorServices in the Context on shutdown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0ODcxOTYy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/248#pullrequestreview-414871962", "createdAt": "2020-05-19T22:38:00Z", "commit": {"oid": "4ff64d9f51382bc04e64f3eb40b404cf02b90c66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0ODc0NTU2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/248#pullrequestreview-414874556", "createdAt": "2020-05-19T22:44:19Z", "commit": {"oid": "4ff64d9f51382bc04e64f3eb40b404cf02b90c66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2212, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}