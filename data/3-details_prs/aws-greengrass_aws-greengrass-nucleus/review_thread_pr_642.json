{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MDk0NDQ5", "number": 642, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMToxNVrOE2UVow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMjowMVrOE2UWbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MzkxNzc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMToxNVrOHvE_Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyNjo0M1rOHvFIuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNjgzOQ==", "bodyText": "can the topic be null? toPojo might throw NPE.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#discussion_r519126839", "createdAt": "2020-11-07T06:21:15Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "diffHunk": "@@ -180,9 +195,64 @@ private boolean networkProxyHasChanged(Map<String, Object> newNucleusParameters,\n         return false;\n     }\n \n+    private boolean defaultRunWithChanged(Map<String, Object> newNucleusParameters,\n+            DeviceConfiguration currentDeviceConfiguration) throws ComponentConfigurationValidationException {\n+        Map<String, Object> runWithDefault = (Map<String, Object>)newNucleusParameters.getOrDefault(RUN_WITH_TOPIC,\n+                Collections.emptyMap());\n+\n+        Map<String, Object> currentValues = currentDeviceConfiguration.getRunWithTopic().toPOJO();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyOTI3Mg==", "bodyText": "Unless the comment on lookupTopics is false - it says it never returns null.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#discussion_r519129272", "createdAt": "2020-11-07T06:26:43Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "diffHunk": "@@ -180,9 +195,64 @@ private boolean networkProxyHasChanged(Map<String, Object> newNucleusParameters,\n         return false;\n     }\n \n+    private boolean defaultRunWithChanged(Map<String, Object> newNucleusParameters,\n+            DeviceConfiguration currentDeviceConfiguration) throws ComponentConfigurationValidationException {\n+        Map<String, Object> runWithDefault = (Map<String, Object>)newNucleusParameters.getOrDefault(RUN_WITH_TOPIC,\n+                Collections.emptyMap());\n+\n+        Map<String, Object> currentValues = currentDeviceConfiguration.getRunWithTopic().toPOJO();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNjgzOQ=="}, "originalCommit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MzkxOTgyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMjowMVrOHvFAkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjozMDoxMFrOHvFO0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNzE4NA==", "bodyText": "why not? Can you mention it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#discussion_r519127184", "createdAt": "2020-11-07T06:22:01Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "diffHunk": "@@ -196,16 +266,21 @@ private boolean nucleusConfigValidAndNeedsRestart(Map<String, Object> deployment\n         for (GreengrassService s : kernel.orderedDependencies()) {\n             // For now, only let builtin Greengrass services decide\n             if (s.isBuiltin()) {\n-                needsRestart = needsRestart || s.restartNucleusOnNucleusConfigChange(proposedNucleusConfig);\n+                // don't short-circuit validation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f"}, "originalPosition": 167}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEzMDgzNA==", "bodyText": "sure - I'll update the comment. restartNucleusOnNucleusConfig throws a validation exception. The components are expected to throw an exception if it is invalid which then stops the configuration from being applied.\nIf the first component's config is ok, and it needs to restart, then it would stop other components from even looking at it", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/642#discussion_r519130834", "createdAt": "2020-11-07T06:30:10Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "diffHunk": "@@ -196,16 +266,21 @@ private boolean nucleusConfigValidAndNeedsRestart(Map<String, Object> deployment\n         for (GreengrassService s : kernel.orderedDependencies()) {\n             // For now, only let builtin Greengrass services decide\n             if (s.isBuiltin()) {\n-                needsRestart = needsRestart || s.restartNucleusOnNucleusConfigChange(proposedNucleusConfig);\n+                // don't short-circuit validation", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNzE4NA=="}, "originalCommit": {"oid": "ef1c1f82253fad2e65b99f107d1e80fa8104522f"}, "originalPosition": 167}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 185, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}