{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODA5MTE5", "number": 315, "title": "Fix tes test", "bodyText": "Issue #, if available:\nDescription of changes:\nUse random role and roleAlias names in tes test\nUse createThingForE2ETests() instead of regular createThing\nAdd deletion of all attached policies in cleanThing() and remove policy deletion in cleanUpIotRoleForTest()\nWhy is this change necessary:\nHard-coded names could cause collision between test runs\nHow was this change tested:\nRun and pass with evergreen-dev credentials, verified all resources deleted\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-07-16T00:10:02Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315", "merged": true, "mergeCommit": {"oid": "0a3e6c5e5c84ee5e82661dc5dd5045f919502bb9"}, "closed": true, "closedAt": "2020-07-16T17:53:20Z", "author": {"login": "youtuyy"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1TvmBgH2gAyNDQ5ODA5MTE5OjcwNTIyMjgxY2FiODQyMDgzYmY2YWU5YzI0NDczYmMxNDExNzYwOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1jCL6AFqTQ1MDA4MTQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "70522281cab842083bf6ae9c24473bc14117608e", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/70522281cab842083bf6ae9c24473bc14117608e", "committedDate": "2020-07-16T00:04:15Z", "message": "Fix tes test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDI0ODAy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#pullrequestreview-449424802", "createdAt": "2020-07-16T00:12:29Z", "commit": {"oid": "70522281cab842083bf6ae9c24473bc14117608e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMjoyOVrOGyVmxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMzowMFrOGyVnUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNTk3NA==", "bodyText": "save these in fields so you don't have to keep concatenating them together.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#discussion_r455435974", "createdAt": "2020-07-16T00:12:29Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java", "diffHunk": "@@ -59,7 +60,7 @@ void tearDown() {\n         } finally {\n             deviceProvisioningHelper.cleanThing(IotSdkClientFactory.getIotClient(AWS_REGION), thingInfo);\n             IotJobsUtils.cleanUpIotRoleForTest(IotSdkClientFactory.getIotClient(AWS_REGION), IamSdkClientFactory.getIamClient(),\n-                    TES_ROLE_NAME, TES_ROLE_ALIAS_NAME, thingInfo.getCertificateArn());\n+                    TES_ROLE_NAME + roleId, TES_ROLE_ALIAS_NAME + roleId, thingInfo.getCertificateArn());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70522281cab842083bf6ae9c24473bc14117608e"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNjExMg==", "bodyText": "Prefix these with e2etest so that we know what they are used for and can more easily find and delete them if needed.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#discussion_r455436112", "createdAt": "2020-07-16T00:13:00Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/tes/TESTest.java", "diffHunk": "@@ -38,8 +39,7 @@\n     private Kernel kernel;\n     private ThingInfo thingInfo;\n     private DeviceProvisioningHelper deviceProvisioningHelper;\n-    private static final String POLICY_NAME = \"TES_INTEG_TEST_POLICY\";\n-    private static final String THING_NAME = \"TES_INTEG_THING\";\n+    private String roleId;\n     private static final String AWS_REGION = \"us-east-1\";\n     private static final String TES_ROLE_NAME = \"TES_INTEG_ROLE\";\n     private static final String TES_ROLE_ALIAS_NAME = \"TES_INTEG_ROLE_ALIAS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70522281cab842083bf6ae9c24473bc14117608e"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9aed2a9d3bd0fa8589afda31e49858ad880471e", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b9aed2a9d3bd0fa8589afda31e49858ad880471e", "committedDate": "2020-07-16T01:16:48Z", "message": "Add e2e prefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a7444509924b8dc51df0f175411147f4f030bf4", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1a7444509924b8dc51df0f175411147f4f030bf4", "committedDate": "2020-07-16T02:35:10Z", "message": "Delete all policies in cleanThing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4872701a54c35c05fb1048ac993f70bc4f3bb8e", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d4872701a54c35c05fb1048ac993f70bc4f3bb8e", "committedDate": "2020-07-16T02:42:36Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf47f33754712e931ed32eb108b7940da211aecb", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bf47f33754712e931ed32eb108b7940da211aecb", "committedDate": "2020-07-16T03:26:58Z", "message": "Modify unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be0cf2db6209c3ba863e8cef2f59813385ae1446", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/be0cf2db6209c3ba863e8cef2f59813385ae1446", "committedDate": "2020-07-16T06:18:14Z", "message": "Merge branch 'master' into fix-tes-test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTU2Mzc5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#pullrequestreview-449556379", "createdAt": "2020-07-16T07:00:05Z", "commit": {"oid": "be0cf2db6209c3ba863e8cef2f59813385ae1446"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNzowMDowNVrOGyctmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNzowMDowNVrOGyctmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTU1MjQwOQ==", "bodyText": "formatting looks a bit off here, please reformat with intellij", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#discussion_r455552409", "createdAt": "2020-07-16T07:00:05Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/easysetup/DeviceProvisioningHelper.java", "diffHunk": "@@ -180,6 +184,12 @@ public void cleanThing(IotClient client, ThingInfo thing) {\n         client.deleteThing(DeleteThingRequest.builder().thingName(thing.thingName).build());\n         client.updateCertificate(UpdateCertificateRequest.builder().certificateId(thing.certificateId)\n                 .newStatus(CertificateStatus.INACTIVE).build());\n+        for (Policy p: client.listAttachedPolicies(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be0cf2db6209c3ba863e8cef2f59813385ae1446"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTU2NDk5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#pullrequestreview-449556499", "createdAt": "2020-07-16T07:00:18Z", "commit": {"oid": "be0cf2db6209c3ba863e8cef2f59813385ae1446"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e7aff5130217aae5becd9b3ba9f79f3c7fa32b7", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9e7aff5130217aae5becd9b3ba9f79f3c7fa32b7", "committedDate": "2020-07-16T15:28:46Z", "message": "reformat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92d9766061a4a20a416fe14d251ddfe254590a17", "author": {"user": {"login": "youtuyy", "name": "Zhaoyan Lin"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/92d9766061a4a20a416fe14d251ddfe254590a17", "committedDate": "2020-07-16T17:03:23Z", "message": "Merge branch 'master' into fix-tes-test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMDczNzEy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#pullrequestreview-450073712", "createdAt": "2020-07-16T17:42:50Z", "commit": {"oid": "92d9766061a4a20a416fe14d251ddfe254590a17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMDgxNDg4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/315#pullrequestreview-450081488", "createdAt": "2020-07-16T17:53:08Z", "commit": {"oid": "92d9766061a4a20a416fe14d251ddfe254590a17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2895, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}