{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MjI3MzA1", "number": 625, "title": "Prevent repeated truncate tlog", "bodyText": "Issue #, if available:\nDescription of changes:\nAdd a boolean flag to ensure only one truncateTlog can be queued.\nWhy is this change necessary:\nWhen near truncate limit, if we had a series of childChanged, multiple truncateTlog can be queued and cause repeated truncate workflow.\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-05T17:35:18Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625", "merged": true, "mergeCommit": {"oid": "5b878eeb051cc8a1f615ed709d4e684597ccd15c"}, "closed": true, "closedAt": "2020-11-11T21:55:21Z", "author": {"login": "tilo-chen"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZl2ghAH2gAyNTE2MjI3MzA1OjczY2M5MTZkNzFhODBkM2MxZmMxNDNkZTNhZjFiM2MzOGNmYTRiMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdblNZvgFqTUyODU2Mjg4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "73cc916d71a80d3c1fc143de3af1b3c38cfa4b34", "author": {"user": {"login": "tilo-chen", "name": "Tiangang (Tilo) Chen"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/73cc916d71a80d3c1fc143de3af1b3c38cfa4b34", "committedDate": "2020-11-05T17:31:22Z", "message": "prevent repeated truncate tlog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "476d4e59b8be99f6b19f7ff520d87cfdcabca085", "author": {"user": {"login": "tilo-chen", "name": "Tiangang (Tilo) Chen"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/476d4e59b8be99f6b19f7ff520d87cfdcabca085", "committedDate": "2020-11-05T17:35:25Z", "message": "Merge branch 'master' into truncate-improvement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83030e0e84f8c6c42533090149fcb8277a1720dd", "author": {"user": {"login": "tilo-chen", "name": "Tiangang (Tilo) Chen"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/83030e0e84f8c6c42533090149fcb8277a1720dd", "committedDate": "2020-11-06T17:34:46Z", "message": "Merge branch 'master' into truncate-improvement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NzgxNTE0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625#pullrequestreview-526781514", "createdAt": "2020-11-10T01:18:47Z", "commit": {"oid": "83030e0e84f8c6c42533090149fcb8277a1720dd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjczOTQx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625#pullrequestreview-527673941", "createdAt": "2020-11-10T22:55:07Z", "commit": {"oid": "83030e0e84f8c6c42533090149fcb8277a1720dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjo1NTowN1rOHwy1AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjo1NTowN1rOHwy1AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkyNjQ2NA==", "bodyText": "use compareAndSet(false, true) I'm pretty sure that's the right order. It should be the expected value, and then the value to set if it is the expected value.\nOtherwise it still isn't threadsafe the way you've written it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625#discussion_r520926464", "createdAt": "2020-11-10T22:55:07Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/config/ConfigurationWriter.java", "diffHunk": "@@ -170,9 +171,11 @@ public synchronized void childChanged(WhatHappened what, Node n) {\n             flush(out);\n         }\n         long currCount = count.incrementAndGet();\n-        if (autoTruncate && currCount > maxCount && currCount > retryCount) {\n+        if (autoTruncate && currCount > maxCount && currCount > retryCount && !truncateQueued.get()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83030e0e84f8c6c42533090149fcb8277a1720dd"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa8d3ce2e6edc29325c9a6bfffcde330af5d21f7", "author": {"user": {"login": "tilo-chen", "name": "Tiangang (Tilo) Chen"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fa8d3ce2e6edc29325c9a6bfffcde330af5d21f7", "committedDate": "2020-11-10T23:33:30Z", "message": "use atomic var properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a7e2cf31477efc6cc22bf209148df224b5d753c", "author": {"user": {"login": "tilo-chen", "name": "Tiangang (Tilo) Chen"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8a7e2cf31477efc6cc22bf209148df224b5d753c", "committedDate": "2020-11-10T23:33:40Z", "message": "Merge branch 'master' into truncate-improvement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NDI0MTUx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625#pullrequestreview-528424151", "createdAt": "2020-11-11T18:18:59Z", "commit": {"oid": "8a7e2cf31477efc6cc22bf209148df224b5d753c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5436f95e5f4b70be4310e35bd8d9cba0ad376ddd", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5436f95e5f4b70be4310e35bd8d9cba0ad376ddd", "committedDate": "2020-11-11T19:36:50Z", "message": "Merge branch 'master' into truncate-improvement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eee54013c3dd0e69d78bef9b70d793ce8b9ab7c5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/eee54013c3dd0e69d78bef9b70d793ce8b9ab7c5", "committedDate": "2020-11-11T20:24:04Z", "message": "Merge branch 'master' into truncate-improvement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTYyODg5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/625#pullrequestreview-528562889", "createdAt": "2020-11-11T21:54:19Z", "commit": {"oid": "eee54013c3dd0e69d78bef9b70d793ce8b9ab7c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2931, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}