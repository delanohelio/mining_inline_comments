{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNjg3NjM0", "number": 746, "title": "[DNM] Initial dev tools deployment issue fixes", "bodyText": "Issue #, if available:\nDescription of changes:\nDEPPRECATED NOTES\nfinthomp@ reported this bug. Earlier we didn't plan to have a dedicated option --deploy-dev-tools so we had conditional logic for when to create the initial deployment for cli, but when we added the option, that conditional logic should have been removed since the decision is for customers to make.\nAlthough I just realized this will end up removing components from any existing deployment to the existing thing group so not sure if that will be desirable, pausing this for a bit until that discussion has an outcome\nLATEST NOTES\n1] Fix message when we skip creating cli deployment for existing thing group even if --deploy-dev-tools option is set to true\nAlways creating a deployment is bad - it will wipe out existing components deployed to the existing thing group\nReading active deployment and modifying it with cli component is bad at the moment without thinking through - we need to be able to retain all deployment configuration for an existing active deployment, and even after getting that right, it will be pushed to all existing devices in the group which will add to cost to customers\nNot creating deployment to existing thing group and logging - can safely do for GA\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-12-02T01:59:19Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746", "merged": true, "mergeCommit": {"oid": "4442cabafb720efb6714b58ad4002ac6e4786c9f"}, "closed": true, "closedAt": "2020-12-04T17:51:14Z", "author": {"login": "shaguptashaikh"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiEt4sAFqTU0MjQ0MTE0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi7fi_gFqTU0NTE3MjA1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNDQxMTQ2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#pullrequestreview-542441146", "createdAt": "2020-12-02T02:00:24Z", "commit": {"oid": "9e2fd2c2d4c3e105281fbf5ff0b4eb749b510485"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e2fd2c2d4c3e105281fbf5ff0b4eb749b510485", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9e2fd2c2d4c3e105281fbf5ff0b4eb749b510485", "committedDate": "2020-12-02T01:54:12Z", "message": "Always create a deployment if --deploy-dev-tools option is set to true"}, "afterCommit": {"oid": "da7b24fb205501575100dc10a2c5315b70017af4", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/da7b24fb205501575100dc10a2c5315b70017af4", "committedDate": "2020-12-03T06:07:30Z", "message": "Improve message for deployment creation getting skipped for existing thing group"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTc2MTk1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#pullrequestreview-544576195", "createdAt": "2020-12-04T00:43:14Z", "commit": {"oid": "53318876be72805d46071f05b63b4e235c378e64"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTg1MjQ5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#pullrequestreview-544585249", "createdAt": "2020-12-04T01:07:54Z", "commit": {"oid": "53318876be72805d46071f05b63b4e235c378e64"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9cfdb382ef689cd9e632c8bb43dcb9643cce346", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e9cfdb382ef689cd9e632c8bb43dcb9643cce346", "committedDate": "2020-12-04T05:24:37Z", "message": "Improve message for deployment creation getting skipped for existing thing group"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53318876be72805d46071f05b63b4e235c378e64", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/53318876be72805d46071f05b63b4e235c378e64", "committedDate": "2020-12-03T23:47:04Z", "message": "Merge branch 'master' into setup-deploy-dev-tools-bug"}, "afterCommit": {"oid": "c3dd287950a0a5eb275a43404e6f03612d82d0f0", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c3dd287950a0a5eb275a43404e6f03612d82d0f0", "committedDate": "2020-12-04T06:00:20Z", "message": "Add current nucleus version as top level component to initial deployment in setup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Njc3OTcx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#pullrequestreview-544677971", "createdAt": "2020-12-04T06:03:26Z", "commit": {"oid": "c3dd287950a0a5eb275a43404e6f03612d82d0f0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjowMzoyNlrOH_CI8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjowMzoyNlrOH_CI8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NzM5Mw==", "bodyText": "can you get the version from the config instead? That will help us in testing.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#discussion_r535857393", "createdAt": "2020-12-04T06:03:26Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/easysetup/DeviceProvisioningHelper.java", "diffHunk": "@@ -472,7 +477,9 @@ public void createInitialDeploymentIfNeeded(ThingInfo thingInfo, String thingGro\n         }\n \n         deploymentRequest.components(Utils.immutableMap(GREENGRASS_CLI_COMPONENT_NAME,\n-                ComponentDeploymentSpecification.builder().componentVersion(GREENGRASS_CLI_COMPONENT_VERSION).build()));\n+                ComponentDeploymentSpecification.builder().componentVersion(GREENGRASS_CLI_COMPONENT_VERSION).build(),\n+                DeviceConfiguration.DEFAULT_NUCLEUS_COMPONENT_NAME,\n+                ComponentDeploymentSpecification.builder().componentVersion(KernelVersion.KERNEL_VERSION).build()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3dd287950a0a5eb275a43404e6f03612d82d0f0"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Njc4MTA1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#pullrequestreview-544678105", "createdAt": "2020-12-04T06:03:49Z", "commit": {"oid": "c3dd287950a0a5eb275a43404e6f03612d82d0f0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjowMzo0OVrOH_CJcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwNjowMzo0OVrOH_CJcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg1NzUyMQ==", "bodyText": "take nucleus name from config", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#discussion_r535857521", "createdAt": "2020-12-04T06:03:49Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/easysetup/DeviceProvisioningHelper.java", "diffHunk": "@@ -472,7 +477,9 @@ public void createInitialDeploymentIfNeeded(ThingInfo thingInfo, String thingGro\n         }\n \n         deploymentRequest.components(Utils.immutableMap(GREENGRASS_CLI_COMPONENT_NAME,\n-                ComponentDeploymentSpecification.builder().componentVersion(GREENGRASS_CLI_COMPONENT_VERSION).build()));\n+                ComponentDeploymentSpecification.builder().componentVersion(GREENGRASS_CLI_COMPONENT_VERSION).build(),\n+                DeviceConfiguration.DEFAULT_NUCLEUS_COMPONENT_NAME,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3dd287950a0a5eb275a43404e6f03612d82d0f0"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3dd287950a0a5eb275a43404e6f03612d82d0f0", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c3dd287950a0a5eb275a43404e6f03612d82d0f0", "committedDate": "2020-12-04T06:00:20Z", "message": "Add current nucleus version as top level component to initial deployment in setup"}, "afterCommit": {"oid": "98f6a066ac4b86ccf5a8a01a282731313561cf11", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/98f6a066ac4b86ccf5a8a01a282731313561cf11", "committedDate": "2020-12-04T06:16:13Z", "message": "Add current nucleus version as top level component to initial deployment in setup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98f6a066ac4b86ccf5a8a01a282731313561cf11", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/98f6a066ac4b86ccf5a8a01a282731313561cf11", "committedDate": "2020-12-04T06:16:13Z", "message": "Add current nucleus version as top level component to initial deployment in setup"}, "afterCommit": {"oid": "e9cfdb382ef689cd9e632c8bb43dcb9643cce346", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e9cfdb382ef689cd9e632c8bb43dcb9643cce346", "committedDate": "2020-12-04T05:24:37Z", "message": "Improve message for deployment creation getting skipped for existing thing group"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MTY3OTMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#pullrequestreview-545167932", "createdAt": "2020-12-04T17:44:00Z", "commit": {"oid": "e9cfdb382ef689cd9e632c8bb43dcb9643cce346"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MTcyMDU1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/746#pullrequestreview-545172055", "createdAt": "2020-12-04T17:49:31Z", "commit": {"oid": "e9cfdb382ef689cd9e632c8bb43dcb9643cce346"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2516, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}