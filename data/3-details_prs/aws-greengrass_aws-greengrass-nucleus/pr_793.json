{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MDUwMzg3", "number": 793, "title": "Wait for publish queue to clear before shutting down", "bodyText": "Issue #, if available:\nDescription of changes:\nWait for the publish queue to empty out before closing the tlog so that we shutdown in a consistent state.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-12-14T00:14:41Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/793", "merged": true, "mergeCommit": {"oid": "2fb813d462c5ae6fe68cf0bda1760d5ff3f4ecb1"}, "closed": true, "closedAt": "2020-12-14T00:38:21Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdl6YPKAH2gAyNTM5MDUwMzg3OjdiNGY2NDQ0MmY2MTdhZjI1MTI1MmMyODIxMmE5NjZhNDMxMTE5NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdl6mmGgFqTU1MDk4MTY3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b4f64442f617af251252c28212a966a43111975", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7b4f64442f617af251252c28212a966a43111975", "committedDate": "2020-12-14T00:13:24Z", "message": "Wait for publish queue to clear before shutting down"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTgwMDc2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/793#pullrequestreview-550980076", "createdAt": "2020-12-14T00:17:34Z", "commit": {"oid": "7b4f64442f617af251252c28212a966a43111975"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTgwODI5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/793#pullrequestreview-550980829", "createdAt": "2020-12-14T00:23:11Z", "commit": {"oid": "7b4f64442f617af251252c28212a966a43111975"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTgxNjcz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/793#pullrequestreview-550981673", "createdAt": "2020-12-14T00:29:05Z", "commit": {"oid": "7b4f64442f617af251252c28212a966a43111975"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwMDoyOTowNVrOIE7n4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwMDoyOTowNVrOIE7n4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjA0MjA4Mg==", "bodyText": "wonder if we can use the timeout on this call.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/793#discussion_r542042082", "createdAt": "2020-12-14T00:29:05Z", "author": {"login": "abanthiy"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelLifecycle.java", "diffHunk": "@@ -271,6 +271,7 @@ public void stopAllServices(int timeoutSeconds) {\n      */\n     public void softShutdown(int timeoutSeconds) {\n         logger.atDebug(\"system-shutdown\").log(\"Start soft shutdown\");\n+        kernel.getContext().waitForPublishQueueToClear();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b4f64442f617af251252c28212a966a43111975"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2586, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}