{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MTM5NDA0", "number": 721, "title": "Remove taking configuration snapshot after deployment is finished", "bodyText": "Issue #, if available:\nDescription of changes:\nRemoving snapshot after every deployment status update. In case of rollback this preserves the correct snapshot for rolling back.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-24T03:04:00Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/721", "merged": true, "mergeCommit": {"oid": "42f14824c35f1e920be3b5ebd9f0963a17c64d60"}, "closed": true, "closedAt": "2020-11-26T00:51:02Z", "author": {"login": "abanthiy"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfg5zPgH2gAyNTI2MTM5NDA0Ojc1MWEyNmI2Mjg4YjMxOTU4NjZjOTJkYjgzNzA0ZmNjYjA5YzhjMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgIDsMgFqTUzODkyNDM5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "751a26b6288b3195866c92db83704fccb09c8c05", "author": {"user": {"login": "abanthiy", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/751a26b6288b3195866c92db83704fccb09c8c05", "committedDate": "2020-11-24T03:08:59Z", "message": "Taking configuration snapshot after deployment is finished"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0a3be3166be7cb9a37842960dbac557715435bb", "author": {"user": {"login": "abanthiy", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f0a3be3166be7cb9a37842960dbac557715435bb", "committedDate": "2020-11-24T03:01:44Z", "message": "Taking configuration snapshot after deployment is finished"}, "afterCommit": {"oid": "751a26b6288b3195866c92db83704fccb09c8c05", "author": {"user": {"login": "abanthiy", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/751a26b6288b3195866c92db83704fccb09c8c05", "committedDate": "2020-11-24T03:08:59Z", "message": "Taking configuration snapshot after deployment is finished"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MDY5Mzg3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/721#pullrequestreview-537069387", "createdAt": "2020-11-24T04:29:28Z", "commit": {"oid": "751a26b6288b3195866c92db83704fccb09c8c05"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3Nzk5Mzcx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/721#pullrequestreview-537799371", "createdAt": "2020-11-24T18:34:42Z", "commit": {"oid": "751a26b6288b3195866c92db83704fccb09c8c05"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODA1MTQw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/721#pullrequestreview-537805140", "createdAt": "2020-11-24T18:42:52Z", "commit": {"oid": "751a26b6288b3195866c92db83704fccb09c8c05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo0Mjo1MlrOH5QZrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo0Mjo1MlrOH5QZrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5OTU5OQ==", "bodyText": "I'm not sure how this file is supposed to be used. Is it read somewhere?\nAnd it will be hard to debug issues since the state of rollback snapshot is overwritten anyway.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/721#discussion_r529799599", "createdAt": "2020-11-24T18:42:52Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -289,6 +290,12 @@ private void finishCurrentDeployment() throws InterruptedException {\n                             .persistAndPublishDeploymentStatus(currentDeploymentTaskMetadata.getDeploymentId(),\n                                                                currentDeploymentTaskMetadata.getDeploymentType(),\n                                                                JobStatus.SUCCEEDED.toString(), statusDetails);\n+                    try {\n+                        deploymentDirectoryManager.takeConfigSnapshot(deploymentDirectoryManager.getSnapshotFilePath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751a26b6288b3195866c92db83704fccb09c8c05"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7becb54961f6b74ca8dbc769536c485869de27e", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f7becb54961f6b74ca8dbc769536c485869de27e", "committedDate": "2020-11-25T17:21:26Z", "message": "Merge branch 'master' into fixingSnapshot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "545e3542572fa509f2fc3c77711f60cb3c91f268", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/545e3542572fa509f2fc3c77711f60cb3c91f268", "committedDate": "2020-11-25T17:22:20Z", "message": "Revert changing snapshot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a769e73717fa0b738d54f62edf328c2410e8cfeb", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a769e73717fa0b738d54f62edf328c2410e8cfeb", "committedDate": "2020-11-25T22:43:06Z", "message": "Merge branch 'master' into fixingSnapshot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTEzMzYx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/721#pullrequestreview-538913361", "createdAt": "2020-11-26T00:04:52Z", "commit": {"oid": "a769e73717fa0b738d54f62edf328c2410e8cfeb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b260878ebf41314e7ff04b09ce1507a1dd1d3080", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b260878ebf41314e7ff04b09ce1507a1dd1d3080", "committedDate": "2020-11-26T00:32:56Z", "message": "Merge branch 'master' into fixingSnapshot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTI0Mzkz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/721#pullrequestreview-538924393", "createdAt": "2020-11-26T00:46:05Z", "commit": {"oid": "b260878ebf41314e7ff04b09ce1507a1dd1d3080"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2741, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}