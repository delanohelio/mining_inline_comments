{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxODI4MDAw", "number": 688, "title": "Re-created pull request for platform search Nucleus changes", "bodyText": "Issue #, if available:\nDescription of changes:\nCombined changes from Shirley (Platform override) and Jamie (Platform search/specification as key/attributes).\nWhy is this change necessary:\nAllow richer platform specification and searching.\nHow was this change tested:\nRan unit tests\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-16T17:49:18Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688", "merged": true, "mergeCommit": {"oid": "3ed5006eba20cf4072e595a64474e000d9ffa3a7"}, "closed": true, "closedAt": "2020-11-17T20:18:47Z", "author": {"login": "JamieHunter"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddJd0IgFqTUzMTYwMzkyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddfYYyAFqTUzMjc3Mzg4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjAzOTIx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#pullrequestreview-531603921", "createdAt": "2020-11-16T18:42:45Z", "commit": {"oid": "f7804bb9a8225d841f6e760f5825c3832bbe2e7c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7804bb9a8225d841f6e760f5825c3832bbe2e7c", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f7804bb9a8225d841f6e760f5825c3832bbe2e7c", "committedDate": "2020-11-16T17:46:50Z", "message": "Rollup of platform search changes"}, "afterCommit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/233a97ebf83b6c294073dbbc09a8c6aa6e3f304e", "committedDate": "2020-11-16T20:59:59Z", "message": "Rollup of platform search changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjUwMjEy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#pullrequestreview-531650212", "createdAt": "2020-11-16T19:45:39Z", "commit": {"oid": "f7804bb9a8225d841f6e760f5825c3832bbe2e7c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOTo0NTo0MFrOH0OsNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMDowMDo1OFrOH0PN8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUyODY5NQ==", "bodyText": "NIT: space. (This is probably from my commit... )", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524528695", "createdAt": "2020-11-16T19:45:40Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/componentmanager/ComponentStore.java", "diffHunk": "@@ -50,15 +50,20 @@\n     public static final String ARTIFACTS_DECOMPRESSED_DIRECTORY = \"artifacts-unarchived\";\n     public static final String RECIPE_FILE_NAME_FORMAT = \"%s-%s.yaml\";\n     private final NucleusPaths nucleusPaths;\n+    private final PlatformResolver platformResolver;\n+    private final RecipeLoader recipeLoader;\n \n     /**\n      * Constructor. It will initialize recipe, artifact and artifact decompressed directory.\n-     *\n-     * @param nucleusPaths path library\n+     *  @param nucleusPaths path library", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7804bb9a8225d841f6e760f5825c3832bbe2e7c"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUzMTMyMg==", "bodyText": "NIT: rename to platformOverrideConfig", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524531322", "createdAt": "2020-11-16T19:50:26Z", "author": {"login": "ShirleyZheng92"}, "path": "src/test/java/com/aws/greengrass/config/PlatformResolverTest.java", "diffHunk": "@@ -5,18 +5,57 @@\n \n package com.aws.greengrass.config;\n \n+import com.aws.greengrass.dependency.Context;\n+import com.aws.greengrass.deployment.DeviceConfiguration;\n import com.aws.greengrass.testcommons.testutilities.GGExtension;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLMapper;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.junit.jupiter.MockitoExtension;\n \n+import java.util.Map;\n \n-@ExtendWith(GGExtension.class)\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@ExtendWith({GGExtension.class, MockitoExtension.class})\n class PlatformResolverTest {\n \n+    private static final ObjectMapper MAPPER = new YAMLMapper();\n+\n     @Test\n     void testCurrentPlatform() throws Exception {\n         // GG_NEEDS_REVIEW: TODO: move to UAT\n-        System.out.println(PlatformResolver.CURRENT_PLATFORM);\n+        PlatformResolver platformResolver = new PlatformResolver(null);\n+        System.out.println(platformResolver.getCurrentPlatform());\n     }\n \n+    @Test\n+    void WHEN_platform_override_THEN_override_should_take_place() throws Exception {\n+        String systemConfig = \"---\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7804bb9a8225d841f6e760f5825c3832bbe2e7c"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUzMjA5NA==", "bodyText": "Not needed :)", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524532094", "createdAt": "2020-11-16T19:51:47Z", "author": {"login": "ShirleyZheng92"}, "path": "pom.xml", "diffHunk": "@@ -107,7 +107,7 @@\n             <groupId>com.aws.iot</groupId>\n             <artifactId>component-common</artifactId>\n             <!-- change back to 0.0.0-SNAPSHOT after common model is updated in repo -->\n-            <version>0.0.0-ba9d57ca61b8396c92ab4df91a77fbaad9f8d9ef</version>\n+            <version>0.0.0-SNAPSHOT</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7804bb9a8225d841f6e760f5825c3832bbe2e7c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUzNzMyOQ==", "bodyText": "should we use getCurrentPlatform() instead of DETECTED_PLATFORM ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524537329", "createdAt": "2020-11-16T20:00:58Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/config/PlatformResolver.java", "diffHunk": "@@ -184,8 +224,8 @@ private static Architecture getArchInfo() {\n      * @param recipeList a list of recipe input\n      * @return closest recipe\n      */\n-    public static Optional<PlatformSpecificManifest> findBestMatch(List<PlatformSpecificManifest> recipeList) {\n-        return PlatformHelper.findBestMatch(CURRENT_PLATFORM, recipeList);\n+    public Optional<PlatformSpecificManifest> findBestMatch(List<PlatformSpecificManifest> recipeList) {\n+        return PlatformHelper.findBestMatch(DETECTED_PLATFORM.get(), recipeList);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7804bb9a8225d841f6e760f5825c3832bbe2e7c"}, "originalPosition": 214}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNzg4ODAz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#pullrequestreview-531788803", "createdAt": "2020-11-16T21:20:34Z", "commit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMToyMDozNFrOH0Sxgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMTozNTo1MFrOH0T1sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU5NTU4Nw==", "bodyText": "Will this break existing integ tests? eg. src/integrationtests/resources/com/aws/greengrass/integrationtests/lifecyclemanager/config.yaml", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524595587", "createdAt": "2020-11-16T21:20:34Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/config/Configuration.java", "diffHunk": "@@ -135,19 +135,15 @@ public void mergeMap(long timestamp, Map<String, Object> map) {\n     }\n \n     /**\n-     * Merges a Map into this configuration. The merge will resolve platform.\n+     * Merges a Map into this configuration.\n      *\n      * @param map           map to merge\n      * @param updateBehavior the updateBehavior of each node to be merged in\n      */\n     public void updateMap(Map<String, Object> map, UpdateBehaviorTree updateBehavior) {\n-        Object resolvedPlatformMap = PlatformResolver.resolvePlatform(map);\n-        if (!(resolvedPlatformMap instanceof Map)) {\n-            throw new IllegalArgumentException(\"Invalid config after resolving platform: \" + resolvedPlatformMap);\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU5ODcwOA==", "bodyText": "NIT: maybe just append ALL to selectors before doing filter?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524598708", "createdAt": "2020-11-16T21:23:24Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/config/PlatformResolver.java", "diffHunk": "@@ -251,4 +292,66 @@ private static Object resolvePlatform(Map<String, Integer> ranks, Map<String, Ob\n         */\n     }\n \n+    /**\n+     * Filters lifecycle (or any other section). Input set of allowed platform keywords, and selectors\n+     * that are being applied in priority order. Configuration is not assumed to be deep.\n+     *\n+     * @param source     Source configuration (e.g. lifecycle section)\n+     * @param keywords   Set of platform keywords that are filtered. Assumed to contain ALL keyword\n+     * @param selectors  Set of selectors in priority order. ALL keyword is optional.\n+     * @return filtered config\n+     */\n+    public static Object filterPlatform(Map<String, Object> source, Set<String> keywords,\n+                                         List<String> selectors) {\n+\n+        Stream<Map.Entry<String,Object>> filtered;\n+        if (source.keySet().stream().anyMatch(k -> keywords.contains(k))) {\n+            // Selectors are provided in priority order with highest priority selector first.\n+            // Find the first selector (if any) that has a match at this level of the multi-level map.\n+            Optional<Object> selected =\n+                    selectors.stream().map(s -> source.get(s))\n+                            .filter(s -> s != null)\n+                            .findFirst();\n+            if (!selected.isPresent()) {\n+                // consider ALL keyword (this may not be in list of selectors).\n+                // Note, do not confuse this with set of keywords which does include \"ALL\".\n+                selected = Optional.ofNullable(source.get(ALL_KEYWORD));\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e"}, "originalPosition": 254}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwMDQ5Mg==", "bodyText": "Wow this is doing more than I expected. It means user can mix selector keywords and normal keys in one level.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524600492", "createdAt": "2020-11-16T21:24:57Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/config/PlatformResolver.java", "diffHunk": "@@ -251,4 +292,66 @@ private static Object resolvePlatform(Map<String, Integer> ranks, Map<String, Ob\n         */\n     }\n \n+    /**\n+     * Filters lifecycle (or any other section). Input set of allowed platform keywords, and selectors\n+     * that are being applied in priority order. Configuration is not assumed to be deep.\n+     *\n+     * @param source     Source configuration (e.g. lifecycle section)\n+     * @param keywords   Set of platform keywords that are filtered. Assumed to contain ALL keyword\n+     * @param selectors  Set of selectors in priority order. ALL keyword is optional.\n+     * @return filtered config\n+     */\n+    public static Object filterPlatform(Map<String, Object> source, Set<String> keywords,\n+                                         List<String> selectors) {\n+\n+        Stream<Map.Entry<String,Object>> filtered;\n+        if (source.keySet().stream().anyMatch(k -> keywords.contains(k))) {\n+            // Selectors are provided in priority order with highest priority selector first.\n+            // Find the first selector (if any) that has a match at this level of the multi-level map.\n+            Optional<Object> selected =\n+                    selectors.stream().map(s -> source.get(s))\n+                            .filter(s -> s != null)\n+                            .findFirst();\n+            if (!selected.isPresent()) {\n+                // consider ALL keyword (this may not be in list of selectors).\n+                // Note, do not confuse this with set of keywords which does include \"ALL\".\n+                selected = Optional.ofNullable(source.get(ALL_KEYWORD));\n+            }\n+            if (selected.isPresent()) {\n+                // recursively apply, allowing more specific or overlapping keywords\n+                // All other keys (lower priority or default) are effectively erased.\n+                return filterPlatformIfMap(selected.get(), keywords, selectors);\n+            }\n+            // desired selector not found. Assumed keys at this level may consist of selectors or\n+            // default keys. Remove selectors (using the inclusive keyword list) leaving just the\n+            // default keys.\n+            // This is done by filtering the working set for next stage.\n+            filtered = source.entrySet().stream().filter(e -> !keywords.contains(e.getKey()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e"}, "originalPosition": 264}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwNDg4Ng==", "bodyText": "If selected.isPresent() and there are also regular keys, this means the regular keys will be ignored.\nI think we need to tell user clearly about this behavior, otherwise user might misunderstand that the behavior is merging selected part with the regular keys.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524604886", "createdAt": "2020-11-16T21:28:50Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/config/PlatformResolver.java", "diffHunk": "@@ -251,4 +292,66 @@ private static Object resolvePlatform(Map<String, Integer> ranks, Map<String, Ob\n         */\n     }\n \n+    /**\n+     * Filters lifecycle (or any other section). Input set of allowed platform keywords, and selectors\n+     * that are being applied in priority order. Configuration is not assumed to be deep.\n+     *\n+     * @param source     Source configuration (e.g. lifecycle section)\n+     * @param keywords   Set of platform keywords that are filtered. Assumed to contain ALL keyword\n+     * @param selectors  Set of selectors in priority order. ALL keyword is optional.\n+     * @return filtered config\n+     */\n+    public static Object filterPlatform(Map<String, Object> source, Set<String> keywords,\n+                                         List<String> selectors) {\n+\n+        Stream<Map.Entry<String,Object>> filtered;\n+        if (source.keySet().stream().anyMatch(k -> keywords.contains(k))) {\n+            // Selectors are provided in priority order with highest priority selector first.\n+            // Find the first selector (if any) that has a match at this level of the multi-level map.\n+            Optional<Object> selected =\n+                    selectors.stream().map(s -> source.get(s))\n+                            .filter(s -> s != null)\n+                            .findFirst();\n+            if (!selected.isPresent()) {\n+                // consider ALL keyword (this may not be in list of selectors).\n+                // Note, do not confuse this with set of keywords which does include \"ALL\".\n+                selected = Optional.ofNullable(source.get(ALL_KEYWORD));\n+            }\n+            if (selected.isPresent()) {\n+                // recursively apply, allowing more specific or overlapping keywords\n+                // All other keys (lower priority or default) are effectively erased.\n+                return filterPlatformIfMap(selected.get(), keywords, selectors);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e"}, "originalPosition": 258}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYxMzA0Mw==", "bodyText": "Much cleaner !", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r524613043", "createdAt": "2020-11-16T21:35:50Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/config/Topics.java", "diffHunk": "@@ -259,30 +259,18 @@ public void updateFromMap(Map<String, Object> map, @NonNull UpdateBehaviorTree m\n         });\n \n         childrenToRemove.forEach(childName -> {\n-            UpdateBehaviorTree childMergeBehavior = mergeBehavior.getBehavior(childName.toString());\n-\n-            // remove the existing child if its merge behavior is not present and root merge behavior is REPLACE\n-            if (childMergeBehavior == null\n-                    && mergeBehavior.getDefaultBehavior() == UpdateBehaviorTree.UpdateBehavior.REPLACE) {\n-                remove(children.get(childName));\n-                return;\n-            }\n+            UpdateBehaviorTree childMergeBehavior = mergeBehavior.getChildBehavior(childName.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "233a97ebf83b6c294073dbbc09a8c6aa6e3f304e", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/233a97ebf83b6c294073dbbc09a8c6aa6e3f304e", "committedDate": "2020-11-16T20:59:59Z", "message": "Rollup of platform search changes"}, "afterCommit": {"oid": "c738112ee601244ab2b510d3ca0262a5ce74cb77", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c738112ee601244ab2b510d3ca0262a5ce74cb77", "committedDate": "2020-11-17T02:42:37Z", "message": "Platform search changes\nCo-authored by Xueli Zheng"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c738112ee601244ab2b510d3ca0262a5ce74cb77", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c738112ee601244ab2b510d3ca0262a5ce74cb77", "committedDate": "2020-11-17T02:42:37Z", "message": "Platform search changes\nCo-authored by Xueli Zheng"}, "afterCommit": {"oid": "9fa93daac5bdc50ef6426ee7083a19097691c242", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9fa93daac5bdc50ef6426ee7083a19097691c242", "committedDate": "2020-11-17T02:58:36Z", "message": "Platform search changes\nCo-authored by Xueli Zheng"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53e1c10b1c284677c6ed268b9c3334495bedad8f", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/53e1c10b1c284677c6ed268b9c3334495bedad8f", "committedDate": "2020-11-17T04:24:45Z", "message": "Platform search changes\nCo-authored by Xueli Zheng"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fa93daac5bdc50ef6426ee7083a19097691c242", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9fa93daac5bdc50ef6426ee7083a19097691c242", "committedDate": "2020-11-17T02:58:36Z", "message": "Platform search changes\nCo-authored by Xueli Zheng"}, "afterCommit": {"oid": "53e1c10b1c284677c6ed268b9c3334495bedad8f", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/53e1c10b1c284677c6ed268b9c3334495bedad8f", "committedDate": "2020-11-17T04:24:45Z", "message": "Platform search changes\nCo-authored by Xueli Zheng"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca3f67fe8066ecda7d9cbf5c92192e9dc624ca7a", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ca3f67fe8066ecda7d9cbf5c92192e9dc624ca7a", "committedDate": "2020-11-17T06:49:50Z", "message": "Use old-style OS/Architecture parameters"}, "afterCommit": {"oid": "f865cdb3c31bff1db1d24698b09cdab940331952", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f865cdb3c31bff1db1d24698b09cdab940331952", "committedDate": "2020-11-17T07:05:28Z", "message": "Use old-style OS/Architecture parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aca41e02fdcd80ac031442043de8ee7032870230", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aca41e02fdcd80ac031442043de8ee7032870230", "committedDate": "2020-11-17T07:19:50Z", "message": "Use old-style OS/Architecture parameters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f865cdb3c31bff1db1d24698b09cdab940331952", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f865cdb3c31bff1db1d24698b09cdab940331952", "committedDate": "2020-11-17T07:05:28Z", "message": "Use old-style OS/Architecture parameters"}, "afterCommit": {"oid": "aca41e02fdcd80ac031442043de8ee7032870230", "author": {"user": {"login": "JamieHunter", "name": "Jamie Hunter"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aca41e02fdcd80ac031442043de8ee7032870230", "committedDate": "2020-11-17T07:19:50Z", "message": "Use old-style OS/Architecture parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjU0NDQw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#pullrequestreview-532654440", "createdAt": "2020-11-17T18:10:35Z", "commit": {"oid": "aca41e02fdcd80ac031442043de8ee7032870230"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODoxMDozNVrOH1Cl8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODoxMTowNVrOH1CnLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM3OTA1OA==", "bodyText": "uncomment", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r525379058", "createdAt": "2020-11-17T18:10:35Z", "author": {"login": "ShirleyZheng92"}, "path": "src/test/java/com/aws/greengrass/componentmanager/ComponentServiceHelperTest.java", "diffHunk": "@@ -142,6 +144,12 @@ void GIVEN_component_version_requirements_WHEN_resolve_component_version_THEN_se\n         //assertThat(request.getDeploymentConfigurationId(), is(DEPLOYMENT_CONFIGURATION_ID));\n         assertThat(request.getDeploymentConfigurationId(), notNullValue());\n         assertThat(request.getPlatform(), notNullValue());\n+        // assertThat(request.getPlatform().getAttributes(), notNullValue());\n+        // Map<String, String> attributes = request.getPlatform().getAttributes();\n+        // assertThat(attributes, hasKey(PlatformResolver.OS_KEY));\n+        // assertThat(attributes, hasKey(PlatformResolver.ARCHITECTURE_KEY));\n+        // assertThat(request.getPlatform().getOs(), nullValue());\n+        // assertThat(request.getPlatform().getArchitecture(), nullValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aca41e02fdcd80ac031442043de8ee7032870230"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM3OTM3Mw==", "bodyText": "remove", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#discussion_r525379373", "createdAt": "2020-11-17T18:11:05Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/componentmanager/ComponentServiceHelper.java", "diffHunk": "@@ -71,9 +74,10 @@ ComponentContent resolveComponentVersion(String componentName, Semver localCandi\n             Map<String, Requirement> versionRequirements, String deploymentConfigurationId)\n             throws NoAvailableComponentVersionException, ComponentVersionNegotiationException {\n \n-        // TODO: [P41215526]: Use osVersion and osFlavor for resolving component version once they are supported\n-        ComponentPlatform platform = new ComponentPlatform().withOs(PlatformResolver.CURRENT_PLATFORM.getOs().getName())\n-                .withArchitecture(PlatformResolver.CURRENT_PLATFORM.getArchitecture().getName());\n+        //ComponentPlatform platform = new ComponentPlatform().withAttributes(platformResolver.getCurrentPlatform());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aca41e02fdcd80ac031442043de8ee7032870230"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNzczODg0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/688#pullrequestreview-532773884", "createdAt": "2020-11-17T20:14:44Z", "commit": {"oid": "aca41e02fdcd80ac031442043de8ee7032870230"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2693, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}