{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMTY5ODE3", "number": 692, "title": "Platform test migration", "bodyText": "Issue #, if available:\nMigration off the legacy platform resolving logic. This is a follow up of #688\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-17T06:19:13Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692", "merged": true, "mergeCommit": {"oid": "d237c23e1f82a1702eb86c6b2cdc347c7760174f"}, "closed": true, "closedAt": "2020-11-18T23:22:12Z", "author": {"login": "ShirleyZheng92"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddUb10gFqTUzMjA4MDc1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd2ix1AFqTUzMzk1NzY3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMDgwNzU0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#pullrequestreview-532080754", "createdAt": "2020-11-17T07:29:33Z", "commit": {"oid": "c4865e8627a5ac05e95f2540d0da2aa25a6df148"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4865e8627a5ac05e95f2540d0da2aa25a6df148", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c4865e8627a5ac05e95f2540d0da2aa25a6df148", "committedDate": "2020-11-17T06:17:56Z", "message": "Move the legacy platform resolving logic to test utility"}, "afterCommit": {"oid": "aad9180a11437c0dbb9b696abc4a8903530cc498", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aad9180a11437c0dbb9b696abc4a8903530cc498", "committedDate": "2020-11-17T20:11:49Z", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aad9180a11437c0dbb9b696abc4a8903530cc498", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aad9180a11437c0dbb9b696abc4a8903530cc498", "committedDate": "2020-11-17T20:11:49Z", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility."}, "afterCommit": {"oid": "ba5a85fa5b3d311722c96cc5e6ad25c90193b773", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ba5a85fa5b3d311722c96cc5e6ad25c90193b773", "committedDate": "2020-11-17T20:19:01Z", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba5a85fa5b3d311722c96cc5e6ad25c90193b773", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ba5a85fa5b3d311722c96cc5e6ad25c90193b773", "committedDate": "2020-11-17T20:19:01Z", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility."}, "afterCommit": {"oid": "a9b62817b86017f52a5cf97cbff7b24bce1fa513", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a9b62817b86017f52a5cf97cbff7b24bce1fa513", "committedDate": "2020-11-17T20:41:25Z", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyODAyNDIy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#pullrequestreview-532802422", "createdAt": "2020-11-17T20:52:36Z", "commit": {"oid": "a9b62817b86017f52a5cf97cbff7b24bce1fa513"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "550d0a78f988db8e7c0c1b51ce70d8d2b6a23dfc", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/550d0a78f988db8e7c0c1b51ce70d8d2b6a23dfc", "committedDate": "2020-11-17T21:10:33Z", "message": "remove legacy platform resolving in unit test recipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2905aacf98a572ed1831fe86421106d9a0e3ea4", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a2905aacf98a572ed1831fe86421106d9a0e3ea4", "committedDate": "2020-11-17T21:10:33Z", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9b62817b86017f52a5cf97cbff7b24bce1fa513", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a9b62817b86017f52a5cf97cbff7b24bce1fa513", "committedDate": "2020-11-17T20:41:25Z", "message": "Migrate integ test off legacy platform resolving logic.\n\nMove the legacy platform resolving logic to integ test utility."}, "afterCommit": {"oid": "7d60bebe728bac26c886a4011448fef41284af02", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7d60bebe728bac26c886a4011448fef41284af02", "committedDate": "2020-11-17T21:10:33Z", "message": "remove legacy platformr resolving logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "committedDate": "2020-11-17T22:09:59Z", "message": "remove legacy platformr resolving logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d60bebe728bac26c886a4011448fef41284af02", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7d60bebe728bac26c886a4011448fef41284af02", "committedDate": "2020-11-17T21:10:33Z", "message": "remove legacy platformr resolving logic"}, "afterCommit": {"oid": "7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7aa241cf496a6d22e2581b7640e7ff6ab82ad95b", "committedDate": "2020-11-17T22:09:59Z", "message": "remove legacy platformr resolving logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43898a1d3587cb4d2de2a48e96416441e4d0efdd", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/43898a1d3587cb4d2de2a48e96416441e4d0efdd", "committedDate": "2020-11-18T06:57:14Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36497e45cb193b95158975acb9736c0af59c4767", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/36497e45cb193b95158975acb9736c0af59c4767", "committedDate": "2020-11-18T06:57:44Z", "message": "Merge branch 'master' into platform-test-migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b84f4bd48076fe4a13d72194f3a6417f81a53cb0", "committedDate": "2020-11-18T08:34:55Z", "message": "Merge branch 'master' into platform-test-migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODM0Nzc3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#pullrequestreview-533834777", "createdAt": "2020-11-18T20:10:48Z", "commit": {"oid": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDoxMDo0OFrOH2AKtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDoyMDowMFrOH2AmEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4Nzg5NQ==", "bodyText": "yay!, Can we totally remove jackson-jr?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526387895", "createdAt": "2020-11-18T20:10:48Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/deployment/DeploymentConfigMergingTest.java", "diffHunk": "@@ -34,8 +35,6 @@\n import com.aws.greengrass.testcommons.testutilities.NoOpPathOwnershipHandler;\n import com.aws.greengrass.testcommons.testutilities.TestUtils;\n import com.aws.greengrass.util.Coerce;\n-import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5MDU1MQ==", "bodyText": "fairly sure that your change will fail on windows because of the way that echo works with quotes in cmd compared to powershell.\nBut I guess we can fix it when we build for windows again", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526390551", "createdAt": "2020-11-18T20:15:34Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/resources/com/aws/greengrass/integrationtests/lifecyclemanager/kernel_restart_new_config.yaml", "diffHunk": "@@ -11,14 +11,10 @@ services:\n \n   service_3:\n     lifecycle:\n-      run:\n-        posix: echo \"service_3\"\n-        windows: powershell -command echo \"service_3\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5NDU0OQ==", "bodyText": "just use getName not canonical", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526394549", "createdAt": "2020-11-18T20:19:30Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/util/platforms/Platform.java", "diffHunk": "@@ -35,17 +49,19 @@ public static synchronized Platform getInstance() {\n         if (INSTANCE != null) {\n             return INSTANCE;\n         }\n-        if (Exec.isWindows) {\n+\n+        if (PlatformResolver.isWindows) {\n             INSTANCE = new WindowsPlatform();\n-        } else if (PlatformResolver.RANKS.get().containsKey(\"qnx\")) {\n+        } else if (UNIX_SYS_VER.contains(\"qnx\")) {\n             INSTANCE = new QNXPlatform();\n-        } else if (PlatformResolver.RANKS.get().containsKey(\"macos\") || PlatformResolver.RANKS.get()\n-                .containsKey(\"darwin\")) {\n+        } else if (UNIX_SYS_VER.contains(\"darwin\") || UNIX_SYS_VER.contains(\"macos\")) {\n             INSTANCE = new DarwinPlatform();\n         } else {\n             INSTANCE = new UnixPlatform();\n         }\n \n+        logger.atInfo().log(\"Getting platform instance {}.\", INSTANCE.getClass().getCanonicalName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5NDg5Nw==", "bodyText": "use hamcrest assertthat contains", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#discussion_r526394897", "createdAt": "2020-11-18T20:20:00Z", "author": {"login": "MikeDombo"}, "path": "src/test/java/com/aws/greengrass/componentmanager/ComponentStoreTest.java", "diffHunk": "@@ -214,8 +214,11 @@ void GIVEN_an_invalid_recipe_exists_WHEN_findPackageRecipe_THEN_loading_exceptio\n \n         // WHEN\n         // THEN\n-        assertThrows(PackageLoadingException.class,\n-                () -> componentStore.findPackageRecipe(new ComponentIdentifier(\"InvalidRecipe\", new Semver(\"1.0.0\"))));\n+        PackageLoadingException pe = assertThrows(PackageLoadingException.class,\n+                () -> componentStore.findPackageRecipe(\n+                        new ComponentIdentifier(\"InvalidRecipe\", new Semver(\"1.0.0\"))));\n+        assertTrue(pe.getMessage().contains(\"Failed to parse recipe file content to contract model\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b84f4bd48076fe4a13d72194f3a6417f81a53cb0"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0dd47a3de834ecac71523d5dbeb49dc33cd61fc", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d0dd47a3de834ecac71523d5dbeb49dc33cd61fc", "committedDate": "2020-11-18T21:00:58Z", "message": "Merge branch 'master' into platform-test-migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd4861f3ebd240974dd1419dddf4cb36f7904fdb", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bd4861f3ebd240974dd1419dddf4cb36f7904fdb", "committedDate": "2020-11-18T22:05:41Z", "message": "Merge branch 'master' into platform-test-migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTU3Njcy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/692#pullrequestreview-533957672", "createdAt": "2020-11-18T23:13:54Z", "commit": {"oid": "bd4861f3ebd240974dd1419dddf4cb36f7904fdb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2697, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}