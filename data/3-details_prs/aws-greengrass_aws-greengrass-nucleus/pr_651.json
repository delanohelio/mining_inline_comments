{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NzQwMTc1", "number": 651, "title": "Do not restart on changes between null and empty string", "bodyText": "Issue #, if available:\nDescription of changes:\nNucleus shouldn't restart if a monitored config value changes between null and an empty string.\nWhy is this change necessary:\nNucleus is currently unnecessarily restarting in tests because of a change in a config value from null to \"\".\nHow was this change tested:\nRan unit and integ tests locally.\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-10T20:17:38Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651", "merged": true, "mergeCommit": {"oid": "f5d8f1a41573a0c7104cbac58e359e0874682ea5"}, "closed": true, "closedAt": "2020-11-10T21:11:52Z", "author": {"login": "tomnagy-aws"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbPIzfgH2gAyNTE4NzQwMTc1OmE0OTU4MmJiZWIzNTI5Y2RlM2FmYzY0M2E2YTExMDIwYmNlZDYwNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbP_pQgFqTUyNzYxMDQ0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a49582bbeb3529cde3afc643a6a11020bced6050", "author": {"user": {"login": "tomnagy-aws", "name": "Thomas Nagy"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a49582bbeb3529cde3afc643a6a11020bced6050", "committedDate": "2020-11-10T20:11:23Z", "message": "Do not restart on changes between null and empty string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a007ed4a06ab5544de8d19032283f79b9cee6e", "author": {"user": {"login": "tomnagy-aws", "name": "Thomas Nagy"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/88a007ed4a06ab5544de8d19032283f79b9cee6e", "committedDate": "2020-11-10T20:22:39Z", "message": "Merge branch 'master' into restart-null-empty-string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTc4ODEy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527578812", "createdAt": "2020-11-10T20:24:42Z", "commit": {"oid": "88a007ed4a06ab5544de8d19032283f79b9cee6e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDoyNDo0MlrOHwuR_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDoyNDo0MlrOHwuR_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg1MTk2NA==", "bodyText": "use coerce to string instead of casting", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#discussion_r520851964", "createdAt": "2020-11-10T20:24:42Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/bootstrap/BootstrapManager.java", "diffHunk": "@@ -203,23 +203,24 @@ private boolean defaultRunWithChanged(Map<String, Object> newNucleusParameters,\n         Map<String, Object> currentValues = currentDeviceConfiguration.getRunWithTopic().toPOJO();\n \n         boolean changed = false;\n-        if (!Objects.equals(currentValues.get(RUN_WITH_DEFAULT_POSIX_USER),\n-                runWithDefault.get(RUN_WITH_DEFAULT_POSIX_USER))) {\n+        if (Utils.stringHasChanged(Coerce.toString(currentValues.get(RUN_WITH_DEFAULT_POSIX_USER)),\n+                (String) runWithDefault.get(RUN_WITH_DEFAULT_POSIX_USER))) {\n             logger.atInfo().kv(RUN_WITH_TOPIC + \".\" + RUN_WITH_DEFAULT_POSIX_USER,\n                     runWithDefault.get(RUN_WITH_DEFAULT_POSIX_USER))\n                     .log(RESTART_REQUIRED_MESSAGE);\n             changed = true;\n         }\n-        if (!Objects.equals(currentValues.get(RUN_WITH_DEFAULT_POSIX_GROUP),\n-                runWithDefault.get(RUN_WITH_DEFAULT_POSIX_GROUP))) {\n+        if (Utils.stringHasChanged(Coerce.toString(currentValues.get(RUN_WITH_DEFAULT_POSIX_GROUP)),\n+                (String) runWithDefault.get(RUN_WITH_DEFAULT_POSIX_GROUP))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a007ed4a06ab5544de8d19032283f79b9cee6e"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTc5MTY0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527579164", "createdAt": "2020-11-10T20:25:14Z", "commit": {"oid": "88a007ed4a06ab5544de8d19032283f79b9cee6e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDoyNToxNVrOHwuTCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDoyNToxNVrOHwuTCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg1MjIzNQ==", "bodyText": "you could check that both are empty using Utils.isEmpty", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#discussion_r520852235", "createdAt": "2020-11-10T20:25:15Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/util/Utils.java", "diffHunk": "@@ -90,16 +90,24 @@ public static Throwable flush(Object flushable) {\n     }\n \n     /**\n-     * Returns true if the two strings are different, including null.\n+     * Returns true if the two strings are different, including <code>null</code>.\n+     *\n+     * <p>A change from <code>null</code> to <code>\"\"</code>, or vice versa, is not considered a change.</p>\n      *\n      * @param oldValue first string\n      * @param newValue second string\n-     * @return true if the two strings are not equal\n+     * @return true if the two strings are different\n      */\n     public static boolean stringHasChanged(String oldValue, String newValue) {\n         if (oldValue == null && newValue == null) {\n             return false;\n         }\n+        if (oldValue == null && \"\".equals(newValue)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a007ed4a06ab5544de8d19032283f79b9cee6e"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTgxNDg1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527581485", "createdAt": "2020-11-10T20:28:42Z", "commit": {"oid": "88a007ed4a06ab5544de8d19032283f79b9cee6e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89d992e1b4fd257cf1b3a988408c3845c8405298", "author": {"user": {"login": "tomnagy-aws", "name": "Thomas Nagy"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/89d992e1b4fd257cf1b3a988408c3845c8405298", "committedDate": "2020-11-10T20:38:51Z", "message": "Using Coerce instead of a cast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e143b7b220744a7428bd5f64ced2f1df9bc8cadf", "author": {"user": {"login": "tomnagy-aws", "name": "Thomas Nagy"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e143b7b220744a7428bd5f64ced2f1df9bc8cadf", "committedDate": "2020-11-10T20:39:04Z", "message": "Using Utils.isEmpty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTkxMjQ1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527591245", "createdAt": "2020-11-10T20:43:06Z", "commit": {"oid": "e143b7b220744a7428bd5f64ced2f1df9bc8cadf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDo0MzowN1rOHwu3ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDo0MzowN1rOHwu3ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg2MTYwMw==", "bodyText": "can't this all be simplified? Utils.isEmpty(oldValue) && Utils.isEmpty(newValue)", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#discussion_r520861603", "createdAt": "2020-11-10T20:43:07Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/util/Utils.java", "diffHunk": "@@ -90,16 +90,24 @@ public static Throwable flush(Object flushable) {\n     }\n \n     /**\n-     * Returns true if the two strings are different, including null.\n+     * Returns true if the two strings are different, including <code>null</code>.\n+     *\n+     * <p>A change from <code>null</code> to <code>\"\"</code>, or vice versa, is not considered a change.</p>\n      *\n      * @param oldValue first string\n      * @param newValue second string\n-     * @return true if the two strings are not equal\n+     * @return true if the two strings are different\n      */\n     public static boolean stringHasChanged(String oldValue, String newValue) {\n         if (oldValue == null && newValue == null) {\n             return false;\n         }\n+        if (oldValue == null && Utils.isEmpty(newValue)) {\n+            return false;\n+        }\n+        if (oldValue != null && Utils.isEmpty(oldValue) && newValue == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e143b7b220744a7428bd5f64ced2f1df9bc8cadf"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79901fed7dd33a71c1389842f50d3982a564a783", "author": {"user": {"login": "tomnagy-aws", "name": "Thomas Nagy"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/79901fed7dd33a71c1389842f50d3982a564a783", "committedDate": "2020-11-10T20:49:18Z", "message": "Simplify stringHasChanged"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTk3MDUz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527597053", "createdAt": "2020-11-10T20:51:49Z", "commit": {"oid": "79901fed7dd33a71c1389842f50d3982a564a783"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDo1MTo0OVrOHwvJlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDo1MTo0OVrOHwvJlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg2NjE5OQ==", "bodyText": "this is also covered by L105", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#discussion_r520866199", "createdAt": "2020-11-10T20:51:49Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/util/Utils.java", "diffHunk": "@@ -90,16 +90,21 @@ public static Throwable flush(Object flushable) {\n     }\n \n     /**\n-     * Returns true if the two strings are different, including null.\n+     * Returns true if the two strings are different, including <code>null</code>.\n+     *\n+     * <p>A change from <code>null</code> to <code>\"\"</code>, or vice versa, is not considered a change.</p>\n      *\n      * @param oldValue first string\n      * @param newValue second string\n-     * @return true if the two strings are not equal\n+     * @return true if the two strings are different\n      */\n     public static boolean stringHasChanged(String oldValue, String newValue) {\n         if (oldValue == null && newValue == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79901fed7dd33a71c1389842f50d3982a564a783"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTk3NTU3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527597557", "createdAt": "2020-11-10T20:52:34Z", "commit": {"oid": "79901fed7dd33a71c1389842f50d3982a564a783"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDo1MjozNFrOHwvLNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMDo1MjozNFrOHwvLNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg2NjYxMw==", "bodyText": "this can go too", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#discussion_r520866613", "createdAt": "2020-11-10T20:52:34Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/util/Utils.java", "diffHunk": "@@ -102,10 +102,7 @@ public static boolean stringHasChanged(String oldValue, String newValue) {\n         if (oldValue == null && newValue == null) {\n             return false;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79901fed7dd33a71c1389842f50d3982a564a783"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b14b2c4dc7322478795d7126b715ad1d2d0bd76", "author": {"user": {"login": "tomnagy-aws", "name": "Thomas Nagy"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7b14b2c4dc7322478795d7126b715ad1d2d0bd76", "committedDate": "2020-11-10T20:56:21Z", "message": "oops"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjAyNjc2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527602676", "createdAt": "2020-11-10T20:59:45Z", "commit": {"oid": "7b14b2c4dc7322478795d7126b715ad1d2d0bd76"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjEwNDQy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/651#pullrequestreview-527610442", "createdAt": "2020-11-10T21:11:17Z", "commit": {"oid": "7b14b2c4dc7322478795d7126b715ad1d2d0bd76"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2627, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}