{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3Mjg4MDgy", "number": 330, "title": "Add random suffix in e2e test component name", "bodyText": "Add random suffix in e2e test component name so that the test runs don't\ninterfere with each other\nIssue #, if available:\nE2E tests use the hardcoded name for test component, multiple test runs can interfere with each other\nDescription of changes:\nAdd random suffix to test component\nWhy is this change necessary:\nHow was this change tested:\nrun e2e tests locally\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-07-27T17:02:10Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330", "merged": true, "mergeCommit": {"oid": "d5c24bade8da05a813ea34282109121b042f5d01"}, "closed": true, "closedAt": "2020-07-28T21:22:40Z", "author": {"login": "ShirleyZheng92"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5E8LbgFqTQ1NTk3MjA1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5dK0pAFqTQ1NzAyMDY0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTcyMDUx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-455972051", "createdAt": "2020-07-27T17:05:06Z", "commit": {"oid": "bfd196d5c9bfede10768e8cb5597ecc4d513d687"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzowNTowNlrOG3rjSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzowNTowNlrOG3rjSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAzODQxMQ==", "bodyText": "Recommendation generated by Amazon CodeGuru Reviewer. Leave feedback on this recommendation by replying to the comment or by reacting to the comment using emoji.\nThe result of deleting a file on this line should be checked and failure should be logged. java.io.File.delete() will simply return false if it fails to delete the file, for example, when the file does not exist. It will not throw unless there is a security exception.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#discussion_r461038411", "createdAt": "2020-07-27T17:05:06Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -228,6 +274,11 @@ protected void cleanup() {\n         createdThingGroups.clear();\n         createdIotJobIds.forEach(jobId -> IotJobsUtils.cleanJob(iotClient, jobId));\n         createdIotJobIds.clear();\n+        if (kernel != null && kernel.getConfigPath() != null) {\n+            for (File subFile : kernel.getConfigPath().toFile().listFiles()) {\n+                subFile.delete();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd196d5c9bfede10768e8cb5597ecc4d513d687"}, "originalPosition": 190}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfd196d5c9bfede10768e8cb5597ecc4d513d687", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bfd196d5c9bfede10768e8cb5597ecc4d513d687", "committedDate": "2020-07-27T17:00:19Z", "message": "Add random suffix in e2e test component name\n\nAdd random suffix in e2e test component name so that the test runs don't\ninterfere with each other"}, "afterCommit": {"oid": "451182e06f55f0b1f5a24bbc0d5b960fa5b7866c", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/451182e06f55f0b1f5a24bbc0d5b960fa5b7866c", "committedDate": "2020-07-27T17:10:33Z", "message": "Add random suffix in e2e test component name\n\nAdd random suffix in e2e test component name so that the test runs don't\ninterfere with each other"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "451182e06f55f0b1f5a24bbc0d5b960fa5b7866c", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/451182e06f55f0b1f5a24bbc0d5b960fa5b7866c", "committedDate": "2020-07-27T17:10:33Z", "message": "Add random suffix in e2e test component name\n\nAdd random suffix in e2e test component name so that the test runs don't\ninterfere with each other"}, "afterCommit": {"oid": "103cc27bc6bfc27cf6d2a6e860a4f5703e19c940", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/103cc27bc6bfc27cf6d2a6e860a4f5703e19c940", "committedDate": "2020-07-27T17:23:48Z", "message": "Add random suffix in e2e test component name\n\nAdd random suffix in e2e test component name so that the test runs don't\ninterfere with each other"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTAxNjk2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-456101696", "createdAt": "2020-07-27T20:14:56Z", "commit": {"oid": "103cc27bc6bfc27cf6d2a6e860a4f5703e19c940"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMDoxNDo1NlrOG3x66w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMDoxNDo1NlrOG3x66w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0Mjc2Mw==", "bodyText": "Why do we copy the content in a private method, every invoker will repeat copying?\nAlso is it a good idea to instantiate an instance variable in private method? Do we have better choice?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#discussion_r461142763", "createdAt": "2020-07-27T20:14:56Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -146,6 +164,13 @@ protected void initKernel() throws IOException {\n      */\n     private static void uploadTestComponentsToCms(boolean commit, PackageIdentifier... pkgIds)\n             throws IOException, PackagingException {\n+        Path localStoreContentPath = Paths.get(BaseE2ETestCase.class.getResource(\"local_store_content\").getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103cc27bc6bfc27cf6d2a6e860a4f5703e19c940"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTA0NjQ3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-456104647", "createdAt": "2020-07-27T20:19:21Z", "commit": {"oid": "103cc27bc6bfc27cf6d2a6e860a4f5703e19c940"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMDoxOToyMVrOG3yD2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMDoxOToyMVrOG3yD2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0NTA0OQ==", "bodyText": "Understand what you are trying to do here, but doing a text replacement in recipe seems hacky to me.\nI'd like to probe if randomizing is the best option. Can independent cloud service stage help? such as device development using their gamma stage. Can the test cases manage the deletion of uploaded components? Can the test cases increment component version for every test run?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#discussion_r461145049", "createdAt": "2020-07-27T20:19:21Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -170,26 +195,41 @@ private static void uploadTestComponentsToCms(boolean commit, PackageIdentifier.\n         }\n     }\n \n-    private static void draftComponent(PackageIdentifier pkgId) throws PackagingException, IOException {\n-        Path localStoreContentPath = Paths.get(BaseE2ETestCase.class.getResource(\"local_store_content\").getPath());\n-        PackageStore e2eTestPackageStore = new PackageStore(localStoreContentPath);\n+    private static void draftComponent(PackageIdentifier pkgIdCloud) throws IOException {\n+\n+        PackageIdentifier pkgIdLocal = new PackageIdentifier(removeTestComponentNameCloudSuffix(pkgIdCloud.getName()),\n+                pkgIdCloud.getVersion(), pkgIdCloud.getScope());\n+\n+        Path testRecipePath = e2eTestPackageStore.resolveRecipePath(pkgIdLocal);\n+\n+        // update recipe\n+        String content = new String(Files.readAllBytes(testRecipePath), StandardCharsets.UTF_8);\n+        Set<String> componentNameSet = Arrays.stream(testComponents)\n+                .map(component -> component.getName()).collect(Collectors.toSet());\n+\n+        for (String cloudPkgName: componentNameSet) {\n+            String localPkgName = removeTestComponentNameCloudSuffix(cloudPkgName);\n+            content = content.replaceAll(localPkgName + \"\\n\", cloudPkgName + \"\\n\");\n+            content = content.replaceAll(localPkgName + \":\", cloudPkgName + \":\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103cc27bc6bfc27cf6d2a6e860a4f5703e19c940"}, "originalPosition": 142}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9fbe415fd1e54941279ed7a57cc92415be5ae28", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e9fbe415fd1e54941279ed7a57cc92415be5ae28", "committedDate": "2020-07-27T22:37:29Z", "message": "Add random suffix in e2e test component name\n\nAdd random suffix in e2e test component name so that the test runs don't\ninterfere with each other"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89d5a2fe3c2587741a6039b12bdfc68ecc41033e", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/89d5a2fe3c2587741a6039b12bdfc68ecc41033e", "committedDate": "2020-07-27T23:16:17Z", "message": "Address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "103cc27bc6bfc27cf6d2a6e860a4f5703e19c940", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/103cc27bc6bfc27cf6d2a6e860a4f5703e19c940", "committedDate": "2020-07-27T17:23:48Z", "message": "Add random suffix in e2e test component name\n\nAdd random suffix in e2e test component name so that the test runs don't\ninterfere with each other"}, "afterCommit": {"oid": "89d5a2fe3c2587741a6039b12bdfc68ecc41033e", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/89d5a2fe3c2587741a6039b12bdfc68ecc41033e", "committedDate": "2020-07-27T23:16:17Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjEwMjMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-456210232", "createdAt": "2020-07-27T23:49:58Z", "commit": {"oid": "89d5a2fe3c2587741a6039b12bdfc68ecc41033e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjIzMTIx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-456223121", "createdAt": "2020-07-28T00:28:36Z", "commit": {"oid": "89d5a2fe3c2587741a6039b12bdfc68ecc41033e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjI0MjQx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-456224241", "createdAt": "2020-07-28T00:32:09Z", "commit": {"oid": "89d5a2fe3c2587741a6039b12bdfc68ecc41033e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMDozMjowOVrOG34U_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMDozMjowOVrOG34U_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI0Nzc0MA==", "bodyText": "Nit- It would be nice to have 1 set of braces to keep consistent with general templating patterns, similar to the feedback we got on component parameter placeholders that we should be fixing soon", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#discussion_r461247740", "createdAt": "2020-07-28T00:32:09Z", "author": {"login": "shaguptashaikh"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/e2e/local_store_content/recipes/Log-2.0.0.yaml", "diffHunk": "@@ -1,6 +1,6 @@\n ---\n RecipeTemplateVersion: '2020-01-25'\n-ComponentName: Log\n+ComponentName: {{Log}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89d5a2fe3c2587741a6039b12bdfc68ecc41033e"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51effe502499bc2145494031f273ff2450d532df", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/51effe502499bc2145494031f273ff2450d532df", "committedDate": "2020-07-28T07:00:14Z", "message": "e2e test fix"}, "afterCommit": {"oid": "9507cb396c9b76bb9739958707115d7e7c86514d", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9507cb396c9b76bb9739958707115d7e7c86514d", "committedDate": "2020-07-28T07:02:45Z", "message": "e2e test fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9507cb396c9b76bb9739958707115d7e7c86514d", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9507cb396c9b76bb9739958707115d7e7c86514d", "committedDate": "2020-07-28T07:02:45Z", "message": "e2e test fix"}, "afterCommit": {"oid": "686072d5f5cf73d6f59e43ba08599771488a9fcc", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/686072d5f5cf73d6f59e43ba08599771488a9fcc", "committedDate": "2020-07-28T19:47:54Z", "message": "e2e test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6c9e3a1aa5a9be2ffb3b7c0d0248058afd67a09", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f6c9e3a1aa5a9be2ffb3b7c0d0248058afd67a09", "committedDate": "2020-07-28T20:15:37Z", "message": "e2e test fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "686072d5f5cf73d6f59e43ba08599771488a9fcc", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/686072d5f5cf73d6f59e43ba08599771488a9fcc", "committedDate": "2020-07-28T19:47:54Z", "message": "e2e test fix"}, "afterCommit": {"oid": "f6c9e3a1aa5a9be2ffb3b7c0d0248058afd67a09", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f6c9e3a1aa5a9be2ffb3b7c0d0248058afd67a09", "committedDate": "2020-07-28T20:15:37Z", "message": "e2e test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MDEyMjk1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-457012295", "createdAt": "2020-07-28T21:05:27Z", "commit": {"oid": "f6c9e3a1aa5a9be2ffb3b7c0d0248058afd67a09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MDIwNjQ5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/330#pullrequestreview-457020649", "createdAt": "2020-07-28T21:18:50Z", "commit": {"oid": "f6c9e3a1aa5a9be2ffb3b7c0d0248058afd67a09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2937, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}