{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NjA2MDIy", "number": 208, "title": "Fixing more race conditions", "bodyText": "Issue #, if available:\nDescription of changes:\nFixed a race condition in between close() and requestRestart() in the dependency state subscriber. Also fixes a rare exception in IPC test which is ignorable.\nWhy is this change necessary:\nFixes more test flakiness.\nHow was this change tested:\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-04-22T23:55:56Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208", "merged": true, "mergeCommit": {"oid": "04e7efbe07cb53dfa1465464c43b9090939b60ca"}, "closed": true, "closedAt": "2020-04-23T18:47:08Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcafmX2gFqTM5OTI3OTQxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcahdTLgFqTM5OTM4MDQxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Mjc5NDEz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208#pullrequestreview-399279413", "createdAt": "2020-04-23T16:37:04Z", "commit": {"oid": "4c7dfb4c78f4589b93b12541a9b0b05fd3e70203"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjozNzowNVrOGKxi8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjozNzowNVrOGKxi8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MDcwNw==", "bodyText": "Why only add the check in requestRestart()? Shouldn't this be also added to the rest request* methods?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208#discussion_r413950707", "createdAt": "2020-04-23T16:37:05Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -634,6 +634,10 @@ final void requestReinstall() {\n      */\n     final void requestRestart() {\n         synchronized (desiredStateList) {\n+            // Ignore restart requests if the service is closed\n+            if (isClosed.get()) {\n+                return;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c7dfb4c78f4589b93b12541a9b0b05fd3e70203"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac79134764de28c710f4cf42a10b76de78f9632d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ac79134764de28c710f4cf42a10b76de78f9632d", "committedDate": "2020-04-23T18:01:08Z", "message": "Fix flaky test unable to shutdown due to race in close() with requestRestart()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae88c74744242134229c33edbfda1e083f6dc705", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ae88c74744242134229c33edbfda1e083f6dc705", "committedDate": "2020-04-23T18:01:08Z", "message": "Add EGExtension to E2E test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "committedDate": "2020-04-23T18:01:08Z", "message": "Add closed check to all except requestStop. Ignore rare IPC exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c7dfb4c78f4589b93b12541a9b0b05fd3e70203", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4c7dfb4c78f4589b93b12541a9b0b05fd3e70203", "committedDate": "2020-04-22T23:55:25Z", "message": "Add EGExtension to E2E test"}, "afterCommit": {"oid": "2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82", "committedDate": "2020-04-23T18:01:08Z", "message": "Add closed check to all except requestStop. Ignore rare IPC exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Mzc4NzU2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208#pullrequestreview-399378756", "createdAt": "2020-04-23T18:44:46Z", "commit": {"oid": "2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MzgwNDE0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/208#pullrequestreview-399380414", "createdAt": "2020-04-23T18:46:59Z", "commit": {"oid": "2e13b4e0b687fd24f13b3b7fdd58e5111cc85f82"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2155, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}