{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNDc5MDQ0", "number": 251, "title": "Support Fleet Configuration in deployments", "bodyText": "Issue #, if available:\nDescription of changes:\nUpon new IoT-job-based deployments, parse deployment document based on fleet configuration. FleetConfiguration is the contract between device and cloud. DeploymentDocument will be the internal interface for device to process a deployment.\nWhy is this change necessary:\nTo match the fleet configuration syntax.\nHow was this change tested:\n\nUnit test in parsing deployment document based on fleet configuration\nAll E2E tests use FleetConfiguration to match what actually happens in cloud integration\n\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-05-21T17:24:56Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251", "merged": true, "mergeCommit": {"oid": "66a9dbe670a2295946484e16127196b1ad29381b"}, "closed": true, "closedAt": "2020-05-22T02:17:24Z", "author": {"login": "hui-yang"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjhKcDAFqTQxNjM0NjY4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjoig8AFqTQxNjYwMzgyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MzQ2Njgw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416346680", "createdAt": "2020-05-21T17:28:21Z", "commit": {"oid": "df4de171c8b88ef8934f982ad540c89d2c58847d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzoyODoyMVrOGY7-vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzoyODoyMVrOGY7-vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwMTcyNw==", "bodyText": "why is the group gone? We do need to know the group for when we handle multi-group deployments", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#discussion_r428801727", "createdAt": "2020-05-21T17:28:21Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/model/DeploymentDocument.java", "diffHunk": "@@ -38,14 +40,33 @@\n     @JsonProperty(\"Packages\")\n     private List<DeploymentPackageConfiguration> deploymentPackageConfigurationList;\n \n-    @JsonProperty(\"GroupName\")\n-    private String groupName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df4de171c8b88ef8934f982ad540c89d2c58847d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd91c99d65dd4c8222013026fd1064c304c0ba9b", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bd91c99d65dd4c8222013026fd1064c304c0ba9b", "committedDate": "2020-05-21T21:51:57Z", "message": "Support Fleet Configuration in deployments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df4de171c8b88ef8934f982ad540c89d2c58847d", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/df4de171c8b88ef8934f982ad540c89d2c58847d", "committedDate": "2020-05-21T17:23:32Z", "message": "Support Fleet Configuration in deployments"}, "afterCommit": {"oid": "bd91c99d65dd4c8222013026fd1064c304c0ba9b", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bd91c99d65dd4c8222013026fd1064c304c0ba9b", "committedDate": "2020-05-21T21:51:57Z", "message": "Support Fleet Configuration in deployments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTIzNTA3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416523507", "createdAt": "2020-05-21T22:01:10Z", "commit": {"oid": "bd91c99d65dd4c8222013026fd1064c304c0ba9b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjowMToxMFrOGZEbAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjowMToxMFrOGZEbAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk0MDAzMw==", "bodyText": "will this todo be done for this PR?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#discussion_r428940033", "createdAt": "2020-05-21T22:01:10Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/deployment/DeploymentCloudServiceIntegTest.java", "diffHunk": "@@ -112,6 +112,7 @@ void cleanUp() {\n         createdIotJobIdList.clear();\n     }\n \n+    // TODO: Integrate with Fleet Configuration Service", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd91c99d65dd4c8222013026fd1064c304c0ba9b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTI0MDM1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416524035", "createdAt": "2020-05-21T22:02:19Z", "commit": {"oid": "bd91c99d65dd4c8222013026fd1064c304c0ba9b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjowMjoxOVrOGZEcpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjowMjoxOVrOGZEcpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk0MDQ1NA==", "bodyText": "I'd probably put \"mock\" somewhere in the name since, even though it is in the E2E folder (which uses real accounts), this arn isn't real.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#discussion_r428940454", "createdAt": "2020-05-21T22:02:19Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/util/Utils.java", "diffHunk": "@@ -324,6 +325,11 @@ public static void updateKernelConfigWithIotConfiguration(Kernel kernel, Utils.T\n         deploymentServiceTopics.createLeafChild(DEVICE_PARAM_IOT_CRED_ENDPOINT).withValue(thing.credEndpoint);\n     }\n \n+    public static String generateTestConfigurationArn() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd91c99d65dd4c8222013026fd1064c304c0ba9b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ba14d814c18883ae64cee88dea26533c5b6fc083", "committedDate": "2020-05-21T23:12:34Z", "message": "Address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b728b72b4f20bd0af98cbf26882d666d38e7f94", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0b728b72b4f20bd0af98cbf26882d666d38e7f94", "committedDate": "2020-05-21T23:09:04Z", "message": "Address comments"}, "afterCommit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ba14d814c18883ae64cee88dea26533c5b6fc083", "committedDate": "2020-05-21T23:12:34Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTY0MjQ2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416564246", "createdAt": "2020-05-21T23:48:41Z", "commit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTY5NDg4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416569488", "createdAt": "2020-05-22T00:04:57Z", "commit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDowNDo1N1rOGZGsaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDowNDo1N1rOGZGsaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk3NzI1Nw==", "bodyText": "Will this be the time when config was drafted or when the job was triggered? Is this in alignment with the experience we needed around timestamps?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#discussion_r428977257", "createdAt": "2020-05-22T00:04:57Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/model/DeploymentDocument.java", "diffHunk": "@@ -48,4 +51,36 @@\n     @JsonProperty(\"FailureHandlingPolicy\")\n     private FailureHandlingPolicy failureHandlingPolicy;\n \n+    /**\n+     * Constructor to wrap around deployment configurations from Fleet Configuration Service.\n+     *\n+     * @param config Fleet Configuration\n+     */\n+    public DeploymentDocument(FleetConfiguration config) {\n+        deploymentId = config.getConfigurationArn();\n+        timestamp = config.getCreationTimestamp();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTcwMDUw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416570050", "createdAt": "2020-05-22T00:06:42Z", "commit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDowNjo0MlrOGZGuLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDowNjo0MlrOGZGuLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk3NzcxMQ==", "bodyText": "I used deploymentId to create snapshot files for rollbacks, it might be a bit odd to have an arn in the file name, but technically it doesn't sound like an issue so I'm okay with this for this PR", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#discussion_r428977711", "createdAt": "2020-05-22T00:06:42Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/model/DeploymentDocument.java", "diffHunk": "@@ -48,4 +51,36 @@\n     @JsonProperty(\"FailureHandlingPolicy\")\n     private FailureHandlingPolicy failureHandlingPolicy;\n \n+    /**\n+     * Constructor to wrap around deployment configurations from Fleet Configuration Service.\n+     *\n+     * @param config Fleet Configuration\n+     */\n+    public DeploymentDocument(FleetConfiguration config) {\n+        deploymentId = config.getConfigurationArn();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTcwNjQx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416570641", "createdAt": "2020-05-22T00:08:35Z", "commit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDowODozNlrOGZGwPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDowODozNlrOGZGwPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk3ODIzNw==", "bodyText": "Do we plan to keep this wrapper or is it temporary to avoid refactoring? Why not replace the contents of DeploymentDocument with that of FleetConfiguration?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#discussion_r428978237", "createdAt": "2020-05-22T00:08:36Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/model/DeploymentDocument.java", "diffHunk": "@@ -48,4 +51,36 @@\n     @JsonProperty(\"FailureHandlingPolicy\")\n     private FailureHandlingPolicy failureHandlingPolicy;\n \n+    /**\n+     * Constructor to wrap around deployment configurations from Fleet Configuration Service.\n+     *\n+     * @param config Fleet Configuration\n+     */\n+    public DeploymentDocument(FleetConfiguration config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTcwNjU1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416570655", "createdAt": "2020-05-22T00:08:40Z", "commit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTcxMjg0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416571284", "createdAt": "2020-05-22T00:10:37Z", "commit": {"oid": "ba14d814c18883ae64cee88dea26533c5b6fc083"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10dfa78778d055d6df81d65dd681665ebe4cdfb6", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/10dfa78778d055d6df81d65dd681665ebe4cdfb6", "committedDate": "2020-05-22T01:40:32Z", "message": "Fix config snapshot file path"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTk3Njcz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416597673", "createdAt": "2020-05-22T01:44:58Z", "commit": {"oid": "10dfa78778d055d6df81d65dd681665ebe4cdfb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NjAzODI4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/251#pullrequestreview-416603828", "createdAt": "2020-05-22T02:07:20Z", "commit": {"oid": "10dfa78778d055d6df81d65dd681665ebe4cdfb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2219, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}