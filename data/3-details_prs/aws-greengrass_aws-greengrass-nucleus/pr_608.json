{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NDIwMjkz", "number": 608, "title": "Fix tests, Refactor truncate tlog", "bodyText": "Issue #, if available:\nDescription of changes:\n\nFix ConfigurationWriterTest failure because of previous assumption that config.lookup does not create tlog entry.\nRefactor truncate tlog code because ConfigurationWriter.childChanged is already called from the publish thread. We can only queue a task without waiting\nIncrease ComponentStore safe limit to 20 MB so that it's practically meaningful and maybe UAT can pass more consistently.\n\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n[] Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-03T01:03:05Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/608", "merged": true, "mergeCommit": {"oid": "66735bd4aadbafcbe88a605fea55898c9c75c81c"}, "closed": true, "closedAt": "2020-11-03T01:25:05Z", "author": {"login": "tilo-chen"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYua8kgH2gAyNTE0NDIwMjkzOjAwODMwYTg3NWE3ZGI4ZmFmNmQ0NmYzZDhlYmUxZDJhZjkxZmMzZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYuvWPAFqTUyMjEzOTYzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "00830a875a7db8faf6d46f3d8ebe1d2af91fc3db", "author": {"user": {"login": "tilo-chen", "name": "Tiangang (Tilo) Chen"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/00830a875a7db8faf6d46f3d8ebe1d2af91fc3db", "committedDate": "2020-11-03T00:56:29Z", "message": "refactor truncate tlog, fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTM1ODc5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/608#pullrequestreview-522135879", "createdAt": "2020-11-03T01:05:25Z", "commit": {"oid": "00830a875a7db8faf6d46f3d8ebe1d2af91fc3db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTowNToyNVrOHsdK9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMTowNToyNVrOHsdK9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3NzMzNQ==", "bodyText": "This wouldn't wait because we're already on the publish thread", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/608#discussion_r516377335", "createdAt": "2020-11-03T01:05:25Z", "author": {"login": "tilo-chen"}, "path": "src/main/java/com/aws/greengrass/config/ConfigurationWriter.java", "diffHunk": "@@ -199,54 +198,63 @@ private static Writer newTlogWriter(Path outputPath) throws IOException {\n      */\n     private synchronized void truncateTlog() {\n         Path oldTlogPath = tlogOutputPath.resolveSibling(tlogOutputPath.getFileName() + \".old\");\n-        Throwable error = context.runOnPublishQueueAndWait(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00830a875a7db8faf6d46f3d8ebe1d2af91fc3db"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTM2ODAx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/608#pullrequestreview-522136801", "createdAt": "2020-11-03T01:08:41Z", "commit": {"oid": "00830a875a7db8faf6d46f3d8ebe1d2af91fc3db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTM5NjM0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/608#pullrequestreview-522139634", "createdAt": "2020-11-03T01:18:46Z", "commit": {"oid": "00830a875a7db8faf6d46f3d8ebe1d2af91fc3db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2903, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}