{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MTE2Nzcz", "number": 489, "title": "stop service after it turns into BROKEN state", "bodyText": "Issue #, if available:\nService is not stopped after running into BROKEN state.\nDescription of changes:\nStop the service after it runs into BROKEN state.\nWhy is this change necessary:\nHow was this change tested:\nAdd unit test\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-29T21:34:05Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/489", "merged": true, "mergeCommit": {"oid": "583143a93e9ab8a7f2c28c87b4d2528d1f5e8b6d"}, "closed": true, "closedAt": "2020-09-30T20:54:51Z", "author": {"login": "ShirleyZheng92"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNvK0EAFqTQ5ODkxMDkzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOCYB_AH2gAyNDk1MTE2NzczOmE4NGFmMDY1YzM0YTJhYTNiZmFhYmYzMTNiZTlkNTJlMzRiMDU2NmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTEwOTMx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/489#pullrequestreview-498910931", "createdAt": "2020-09-29T21:35:35Z", "commit": {"oid": "d44bd9649b797367be654c3a669abe4f62552c7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMTozNTozNVrOHaDAeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMTozNTozNVrOHaDAeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3NDI5Ng==", "bodyText": "what if it fails during install?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/489#discussion_r497074296", "createdAt": "2020-09-29T21:35:35Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/Lifecycle.java", "diffHunk": "@@ -368,7 +368,17 @@ void setState(State current, State newState) {\n         }\n     }\n \n-    private void handleCurrentStateBroken(Optional<State> desiredState) {\n+    private void handleCurrentStateBroken(Optional<State> desiredState, State previousState)\n+            throws InterruptedException {\n+        switch (previousState) {\n+            case STARTING:\n+            case RUNNING:\n+            case ERRORED: // shouldn't happen. Try to stop the service anyways.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d44bd9649b797367be654c3a669abe4f62552c7e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTE0OTgw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/489#pullrequestreview-498914980", "createdAt": "2020-09-29T21:42:47Z", "commit": {"oid": "d44bd9649b797367be654c3a669abe4f62552c7e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d44bd9649b797367be654c3a669abe4f62552c7e", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d44bd9649b797367be654c3a669abe4f62552c7e", "committedDate": "2020-09-29T21:32:51Z", "message": "stop service after it turns into BROKEN state"}, "afterCommit": {"oid": "a6c8d51ddae09f934d230d9d098ef5e25f38b6e9", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a6c8d51ddae09f934d230d9d098ef5e25f38b6e9", "committedDate": "2020-09-30T01:51:34Z", "message": "stop service after it turns into BROKEN state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDM1NDQ3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/489#pullrequestreview-499035447", "createdAt": "2020-09-30T01:55:10Z", "commit": {"oid": "a6c8d51ddae09f934d230d9d098ef5e25f38b6e9"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c47dcb0e47662b36e3561b69bbe6a4980d38b5d8", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c47dcb0e47662b36e3561b69bbe6a4980d38b5d8", "committedDate": "2020-09-30T02:20:43Z", "message": "stop service after it turns into BROKEN state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6c8d51ddae09f934d230d9d098ef5e25f38b6e9", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a6c8d51ddae09f934d230d9d098ef5e25f38b6e9", "committedDate": "2020-09-30T01:51:34Z", "message": "stop service after it turns into BROKEN state"}, "afterCommit": {"oid": "c47dcb0e47662b36e3561b69bbe6a4980d38b5d8", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c47dcb0e47662b36e3561b69bbe6a4980d38b5d8", "committedDate": "2020-09-30T02:20:43Z", "message": "stop service after it turns into BROKEN state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDQ3MDQy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/489#pullrequestreview-499047042", "createdAt": "2020-09-30T02:38:36Z", "commit": {"oid": "c47dcb0e47662b36e3561b69bbe6a4980d38b5d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzY0NjQ0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/489#pullrequestreview-499764644", "createdAt": "2020-09-30T19:56:51Z", "commit": {"oid": "c47dcb0e47662b36e3561b69bbe6a4980d38b5d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a84af065c34a2aa3bfaabf313be9d52e34b0566a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a84af065c34a2aa3bfaabf313be9d52e34b0566a", "committedDate": "2020-09-30T19:58:14Z", "message": "Merge branch 'master' into fix_lifecycle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3059, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}