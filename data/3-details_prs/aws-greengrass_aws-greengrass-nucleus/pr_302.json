{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3NTUyMDA3", "number": 302, "title": "Add unit test for DeploymentConfigMerger", "bodyText": "Issue #, if available:\nIncreate unit test coverage for DeploymentConfigMerger\nDescription of changes:\nDeploymentConfigMerger line coverage increased to 34%\nAggregateServicesChangeManager line coverage increased to 90%\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-07-10T17:15:07Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302", "merged": true, "mergeCommit": {"oid": "c278c58d8def158c4ab950782609ef04058774bd"}, "closed": true, "closedAt": "2020-07-15T18:24:27Z", "author": {"login": "ShirleyZheng92"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczm8z3ABqjM1MzQ3NTM1Mzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1OLLegH2gAyNDQ3NTUyMDA3Ojk3MDI1YjBlZWZlYzBlNTJjNTJkY2QzY2JiNTA1ODkxZTYyYWE4YWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81343d455f5c23fc28f318401ec26dbaf4cd9efd", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/81343d455f5c23fc28f318401ec26dbaf4cd9efd", "committedDate": "2020-07-10T17:11:58Z", "message": "Add unit test for DeploymentConfigMerger"}, "afterCommit": {"oid": "33008a46878e4e20f0c2ec22a9dd2d8d0dbfc088", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/33008a46878e4e20f0c2ec22a9dd2d8d0dbfc088", "committedDate": "2020-07-10T17:18:50Z", "message": "Add unit test for DeploymentConfigMerger"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33008a46878e4e20f0c2ec22a9dd2d8d0dbfc088", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/33008a46878e4e20f0c2ec22a9dd2d8d0dbfc088", "committedDate": "2020-07-10T17:18:50Z", "message": "Add unit test for DeploymentConfigMerger"}, "afterCommit": {"oid": "cf2188fff0669302f04d8df49e9d4408dd92e426", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cf2188fff0669302f04d8df49e9d4408dd92e426", "committedDate": "2020-07-10T17:22:39Z", "message": "Add unit test for DeploymentConfigMerger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTc1OTY5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#pullrequestreview-446575969", "createdAt": "2020-07-10T17:30:42Z", "commit": {"oid": "33008a46878e4e20f0c2ec22a9dd2d8d0dbfc088"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNzozMjowM1rOGv_oXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxODo0MTowNFrOGwBqBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk3ODc4Mg==", "bodyText": "Is this toRollback() method needed? Can't the caller manage this on their own?\nBut still if we have to keep this method then toRollback is confusing name for the method. Maybe change this to getNewInstanceWithCurrentConfig(). We may be using this for rollback but as far as this class is concerned it is just getting an instance with current configuration values.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#discussion_r452978782", "createdAt": "2020-07-10T17:32:03Z", "author": {"login": "abanthiy"}, "path": "src/test/java/com/aws/iot/evergreen/deployment/DeploymentConfigMergerTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.aws.iot.evergreen.deployment;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import com.aws.iot.evergreen.dependency.State;\n+import com.aws.iot.evergreen.deployment.exceptions.ServiceUpdateException;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.kernel.Kernel;\n+import com.aws.iot.evergreen.logging.api.Logger;\n+import com.aws.iot.evergreen.logging.impl.LogManager;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeploymentConfigMergerTest {\n+\n+    private final Logger logger = LogManager.getLogger(this.getClass());\n+\n+    @Test\n+    public void GIVEN_AggregateServicesChangeManager_WHEN_initialized_THEN_compute_service_to_add_or_remove() {\n+        Kernel kernel = mock(Kernel.class);\n+        Collection<EvergreenService> orderedDependencies = Arrays.asList(\n+                createMockEvergreenService(\"oldService\"),\n+                createMockEvergreenService(\"existingService\")\n+        );\n+        when(kernel.orderedDependencies()).thenReturn(orderedDependencies);\n+\n+        Map<String, Object> newConfig = new HashMap<>();\n+        newConfig.put(\"newService\", new Object());\n+        newConfig.put(\"existingService\", new Object());\n+\n+        DeploymentConfigMerger.AggregateServicesChangeManager manager =\n+                new DeploymentConfigMerger.AggregateServicesChangeManager(kernel, newConfig);\n+\n+        assertEquals(newHashSet(\"newService\"), manager.getServicesToAdd());\n+        assertEquals(newHashSet(\"oldService\"), manager.getServicesToRemove());\n+        assertEquals(newHashSet(\"existingService\"), manager.getServicesToUpdate());\n+\n+        DeploymentConfigMerger.AggregateServicesChangeManager toRollback = manager.toRollback();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf2188fff0669302f04d8df49e9d4408dd92e426"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwOTQ1Nw==", "bodyText": "You will be adding more tests for other methods in this class?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#discussion_r453009457", "createdAt": "2020-07-10T18:37:15Z", "author": {"login": "abanthiy"}, "path": "src/test/java/com/aws/iot/evergreen/deployment/DeploymentConfigMergerTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.aws.iot.evergreen.deployment;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import com.aws.iot.evergreen.dependency.State;\n+import com.aws.iot.evergreen.deployment.exceptions.ServiceUpdateException;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.kernel.Kernel;\n+import com.aws.iot.evergreen.logging.api.Logger;\n+import com.aws.iot.evergreen.logging.impl.LogManager;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeploymentConfigMergerTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf2188fff0669302f04d8df49e9d4408dd92e426"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAxMTk3NA==", "bodyText": "Might be better to make wait time as a constant if we plan to use it in other tests as well.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#discussion_r453011974", "createdAt": "2020-07-10T18:41:04Z", "author": {"login": "abanthiy"}, "path": "src/test/java/com/aws/iot/evergreen/deployment/DeploymentConfigMergerTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.aws.iot.evergreen.deployment;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import com.aws.iot.evergreen.dependency.State;\n+import com.aws.iot.evergreen.deployment.exceptions.ServiceUpdateException;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.kernel.Kernel;\n+import com.aws.iot.evergreen.logging.api.Logger;\n+import com.aws.iot.evergreen.logging.impl.LogManager;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeploymentConfigMergerTest {\n+\n+    private final Logger logger = LogManager.getLogger(this.getClass());\n+\n+    @Test\n+    public void GIVEN_AggregateServicesChangeManager_WHEN_initialized_THEN_compute_service_to_add_or_remove() {\n+        Kernel kernel = mock(Kernel.class);\n+        Collection<EvergreenService> orderedDependencies = Arrays.asList(\n+                createMockEvergreenService(\"oldService\"),\n+                createMockEvergreenService(\"existingService\")\n+        );\n+        when(kernel.orderedDependencies()).thenReturn(orderedDependencies);\n+\n+        Map<String, Object> newConfig = new HashMap<>();\n+        newConfig.put(\"newService\", new Object());\n+        newConfig.put(\"existingService\", new Object());\n+\n+        DeploymentConfigMerger.AggregateServicesChangeManager manager =\n+                new DeploymentConfigMerger.AggregateServicesChangeManager(kernel, newConfig);\n+\n+        assertEquals(newHashSet(\"newService\"), manager.getServicesToAdd());\n+        assertEquals(newHashSet(\"oldService\"), manager.getServicesToRemove());\n+        assertEquals(newHashSet(\"existingService\"), manager.getServicesToUpdate());\n+\n+        DeploymentConfigMerger.AggregateServicesChangeManager toRollback = manager.toRollback();\n+\n+        assertEquals(newHashSet(\"newService\"), toRollback.getServicesToRemove());\n+        assertEquals(newHashSet(\"oldService\"), toRollback.getServicesToAdd());\n+        assertEquals(newHashSet(\"existingService\"), toRollback.getServicesToUpdate());\n+    }\n+\n+    @Test\n+    public void GIVEN_waitForServicesToStart_WHEN_service_reached_desired_state_THEN_return_successfully() throws Exception {\n+        // GIVEN\n+        EvergreenService mockService = mock(EvergreenService.class);\n+        // service is in BROKEN state before merge\n+        when(mockService.getState()).thenReturn(State.BROKEN);\n+        when(mockService.getStateModTime()).thenReturn((long) 1);\n+        when(mockService.reachedDesiredState()).thenReturn(false);\n+        CountDownLatch serviceStarted = new CountDownLatch(1);\n+        new Thread(() -> {\n+            try {\n+                DeploymentConfigMerger.waitForServicesToStart(newHashSet(mockService), System.currentTimeMillis());\n+                serviceStarted.countDown();\n+            } catch (ServiceUpdateException | InterruptedException e) {\n+                logger.error(\"Fail in waitForServicesToStart\", e);\n+            }\n+        }).start();\n+\n+        Thread.sleep(2000);\n+        // assert waitForServicesToStart didn't finish\n+        assertEquals(1, serviceStarted.getCount());\n+\n+        // WHEN\n+        when(mockService.getState()).thenReturn(State.RUNNING);\n+        when(mockService.reachedDesiredState()).thenReturn(true);\n+\n+        // THEN\n+        assertTrue(serviceStarted.await(2, TimeUnit.SECONDS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf2188fff0669302f04d8df49e9d4408dd92e426"}, "originalPosition": 89}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f6e94e8c55b8723c0662bf72179796cc4c4cf03c", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f6e94e8c55b8723c0662bf72179796cc4c4cf03c", "committedDate": "2020-07-10T19:02:24Z", "message": "Merge branch 'master' into unitTest"}, "afterCommit": {"oid": "cceac0acaa0a25646cb96e4ed03f9705a651382f", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cceac0acaa0a25646cb96e4ed03f9705a651382f", "committedDate": "2020-07-10T21:01:24Z", "message": "Add unit test for DeploymentConfigMerger"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cceac0acaa0a25646cb96e4ed03f9705a651382f", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cceac0acaa0a25646cb96e4ed03f9705a651382f", "committedDate": "2020-07-10T21:01:24Z", "message": "Add unit test for DeploymentConfigMerger"}, "afterCommit": {"oid": "7137112cf910682d54e9588414b3ca38bdd257ff", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7137112cf910682d54e9588414b3ca38bdd257ff", "committedDate": "2020-07-10T21:48:42Z", "message": "Add unit test for DeploymentConfigMerger"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7137112cf910682d54e9588414b3ca38bdd257ff", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7137112cf910682d54e9588414b3ca38bdd257ff", "committedDate": "2020-07-10T21:48:42Z", "message": "Add unit test for DeploymentConfigMerger"}, "afterCommit": {"oid": "28c3c9f015f60cca4c0f96c728b87cd925036785", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/28c3c9f015f60cca4c0f96c728b87cd925036785", "committedDate": "2020-07-10T23:48:45Z", "message": "Add unit test for DeploymentConfigMerger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a42ff15c65c1ebe1ef778f4082385823c550acf", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7a42ff15c65c1ebe1ef778f4082385823c550acf", "committedDate": "2020-07-13T17:57:33Z", "message": "Add unit test for DeploymentConfigMerger"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28c3c9f015f60cca4c0f96c728b87cd925036785", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/28c3c9f015f60cca4c0f96c728b87cd925036785", "committedDate": "2020-07-10T23:48:45Z", "message": "Add unit test for DeploymentConfigMerger"}, "afterCommit": {"oid": "f2f40a28acac07766d4f7fd6cfb0f5c527dc21a5", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f2f40a28acac07766d4f7fd6cfb0f5c527dc21a5", "committedDate": "2020-07-13T17:57:33Z", "message": "Update logic in DeploymentConfigMerger"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2f40a28acac07766d4f7fd6cfb0f5c527dc21a5", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f2f40a28acac07766d4f7fd6cfb0f5c527dc21a5", "committedDate": "2020-07-13T17:57:33Z", "message": "Update logic in DeploymentConfigMerger"}, "afterCommit": {"oid": "db02bd7a07bf4d1185a55bf0bad1b82dd565006f", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/db02bd7a07bf4d1185a55bf0bad1b82dd565006f", "committedDate": "2020-07-14T17:08:05Z", "message": "Update logic in DeploymentConfigMerger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzE5MjIw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#pullrequestreview-448319220", "createdAt": "2020-07-14T17:33:02Z", "commit": {"oid": "db02bd7a07bf4d1185a55bf0bad1b82dd565006f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "889f52fb35ab3a2e95c49f1e69226c4c68c42b11", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/889f52fb35ab3a2e95c49f1e69226c4c68c42b11", "committedDate": "2020-07-14T20:05:59Z", "message": "Update logic in DeploymentConfigMerger"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db02bd7a07bf4d1185a55bf0bad1b82dd565006f", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/db02bd7a07bf4d1185a55bf0bad1b82dd565006f", "committedDate": "2020-07-14T17:08:05Z", "message": "Update logic in DeploymentConfigMerger"}, "afterCommit": {"oid": "889f52fb35ab3a2e95c49f1e69226c4c68c42b11", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/889f52fb35ab3a2e95c49f1e69226c4c68c42b11", "committedDate": "2020-07-14T20:05:59Z", "message": "Update logic in DeploymentConfigMerger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDQ0ODA1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#pullrequestreview-448444805", "createdAt": "2020-07-14T20:34:23Z", "commit": {"oid": "889f52fb35ab3a2e95c49f1e69226c4c68c42b11"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d6046a6eec38674f8b28469095893949478a276", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0d6046a6eec38674f8b28469095893949478a276", "committedDate": "2020-07-14T22:23:14Z", "message": "Merge branch 'master' into unitTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12b87c76be6c412a2a71f753590aed4ed4e1f5af", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/12b87c76be6c412a2a71f753590aed4ed4e1f5af", "committedDate": "2020-07-14T23:51:52Z", "message": "Increase timeout in e2e MqttReconnectTest"}, "afterCommit": {"oid": "b6e000b1f28e0e857b733032148b6ae3c60c003d", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b6e000b1f28e0e857b733032148b6ae3c60c003d", "committedDate": "2020-07-15T00:47:12Z", "message": "Increase timeout in e2e MqttReconnectTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3ed80aae970020f3e6ca9e9fbbfcc594cd83192", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d3ed80aae970020f3e6ca9e9fbbfcc594cd83192", "committedDate": "2020-07-15T02:59:16Z", "message": "Work-around timeout in e2e MqttReconnectTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6e000b1f28e0e857b733032148b6ae3c60c003d", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b6e000b1f28e0e857b733032148b6ae3c60c003d", "committedDate": "2020-07-15T00:47:12Z", "message": "Increase timeout in e2e MqttReconnectTest"}, "afterCommit": {"oid": "d3ed80aae970020f3e6ca9e9fbbfcc594cd83192", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d3ed80aae970020f3e6ca9e9fbbfcc594cd83192", "committedDate": "2020-07-15T02:59:16Z", "message": "Work-around timeout in e2e MqttReconnectTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjIxMzMx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#pullrequestreview-448621331", "createdAt": "2020-07-15T04:32:12Z", "commit": {"oid": "d3ed80aae970020f3e6ca9e9fbbfcc594cd83192"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTUzMTgy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#pullrequestreview-449153182", "createdAt": "2020-07-15T17:09:35Z", "commit": {"oid": "d3ed80aae970020f3e6ca9e9fbbfcc594cd83192"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzowOTozNVrOGyHX2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzowOTozNVrOGyHX2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIwMjc3OQ==", "bodyText": "Integ tests and unit tests serve different purposes so ideally we should add unit tests for as much code as possible, but for this PR this is okay", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/302#discussion_r455202779", "createdAt": "2020-07-15T17:09:35Z", "author": {"login": "shaguptashaikh"}, "path": "src/test/java/com/aws/iot/evergreen/deployment/DeploymentConfigMergerTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.aws.iot.evergreen.deployment;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import com.aws.iot.evergreen.dependency.State;\n+import com.aws.iot.evergreen.deployment.exceptions.ServiceUpdateException;\n+import com.aws.iot.evergreen.kernel.EvergreenService;\n+import com.aws.iot.evergreen.kernel.Kernel;\n+import com.aws.iot.evergreen.logging.api.Logger;\n+import com.aws.iot.evergreen.logging.impl.LogManager;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DeploymentConfigMergerTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwOTQ1Nw=="}, "originalCommit": {"oid": "cf2188fff0669302f04d8df49e9d4408dd92e426"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97025b0eefec0e52c52dcd3cbb505891e62aa8af", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/97025b0eefec0e52c52dcd3cbb505891e62aa8af", "committedDate": "2020-07-15T17:34:57Z", "message": "Merge branch 'master' into unitTest"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2865, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}