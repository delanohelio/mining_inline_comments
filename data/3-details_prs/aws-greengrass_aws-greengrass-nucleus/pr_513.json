{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNzE1MzY1", "number": 513, "title": "System settings as Nucleus component configuration", "bodyText": "Issue #, if available:\nDescription of changes:\nSystem setting will now be configuration of the Nucleus component so they can be deployed like any other component configuration. Since we always require system settings, the Nucleus has to be made sticky, i.e. at the time of bootstrap it should be added to the kernel config and on deployments if the deployment doesn't contain a nucleus version(either custom nucleus component or our first party component version) then deployments need to ensure the nucleus component already running in kernel is not removed\nNOTES\nThere will need to be follow up changes for 1) Moving builtin component (FSS, Telemetry) parameters to the Nucleus component 2) Adding more settings/ making some config as configurable if needed 3) Some settings like thingname etc are specific to a device and doesn't make sense to change them via deployment especially for thing groups, but this needs follow up discussion with Jamie to figure out if they should be left out and where they can go instead\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-09T17:01:21Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513", "merged": true, "mergeCommit": {"oid": "061578138f78513f0dd7722a85c16c8c1abe8c5a"}, "closed": true, "closedAt": "2020-10-23T22:23:57Z", "author": {"login": "shaguptashaikh"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR69o1AFqTUwNjkyNTU2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVcsL7gH2gAyNTAwNzE1MzY1OjdmNGQxMWMxMmI2NGUwOTRlMGE2YzZkM2NmNGM4ZDBiMWQ5NjI0YTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTI1NTY2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-506925566", "createdAt": "2020-10-12T21:25:24Z", "commit": {"oid": "6ee9c12f987c9bfec38b4ce8f78c361e16039482"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMToyNToyNFrOHgNnqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMToyOToyOFrOHgNtxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUzOTYyNA==", "bodyText": "Coerce.toLong here?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r503539624", "createdAt": "2020-10-12T21:25:24Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -213,10 +213,14 @@ protected void startup() throws InterruptedException {\n                     createNewDeployment(deployment);\n                 }\n             }\n-            Thread.sleep(pollingFrequency);\n+            Thread.sleep(getPollingFrequency());\n         }\n     }\n \n+    private long getPollingFrequency() {\n+        return Duration.ofSeconds((Long) deviceConfiguration.getDeploymentPollingFrequency().getOnce()).toMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ee9c12f987c9bfec38b4ce8f78c361e16039482"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU0MDQzNw==", "bodyText": "remove the comment if we don't need to set a default value here", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r503540437", "createdAt": "2020-10-12T21:27:35Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -206,11 +248,14 @@ public boolean isDeviceConfiguredToTalkToCloud() {\n     }\n \n     private Topic getTopic(String parameterName) {\n-        return kernel.getConfig().lookup(SYSTEM_NAMESPACE_KEY, parameterName).dflt(\"\");\n+        return kernel.getConfig()\n+                .lookup(SERVICES_NAMESPACE_TOPIC, KERNEL_COMPONENT_NAME, PARAMETERS_CONFIG_KEY, parameterName);\n+        //return topic.dflt(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ee9c12f987c9bfec38b4ce8f78c361e16039482"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU0MTEyNw==", "bodyText": "is this bytes?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r503541127", "createdAt": "2020-10-12T21:29:19Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -32,17 +35,22 @@\n @SuppressFBWarnings(\"IS2_INCONSISTENT_SYNC\")\n public class DeviceConfiguration {\n \n+    public static final String KERNEL_COMPONENT_NAME = \"aws.greengrass.Nucleus\";\n     public static final String DEVICE_PARAM_THING_NAME = \"thingName\";\n     public static final String DEVICE_PARAM_IOT_DATA_ENDPOINT = \"iotDataEndpoint\";\n     public static final String DEVICE_PARAM_IOT_CRED_ENDPOINT = \"iotCredEndpoint\";\n     public static final String DEVICE_PARAM_PRIVATE_KEY_PATH = \"privateKeyPath\";\n     public static final String DEVICE_PARAM_CERTIFICATE_FILE_PATH = \"certificateFilePath\";\n     public static final String DEVICE_PARAM_ROOT_CA_PATH = \"rootCaPath\";\n-    public static final String SYSTEM_NAMESPACE_KEY = \"system\";\n     public static final String DEVICE_PARAM_AWS_REGION = \"awsRegion\";\n     public static final String DEVICE_MQTT_NAMESPACE = \"mqtt\";\n+    public static final String IOT_ROLE_ALIAS_TOPIC = \"iotRoleAlias\";\n+    public static final String COMPONENT_STORE_MAX_SIZE = \"componentStoreMaxSize\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ee9c12f987c9bfec38b4ce8f78c361e16039482"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU0MTE5MA==", "bodyText": "is this seconds?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r503541190", "createdAt": "2020-10-12T21:29:28Z", "author": {"login": "rbattle"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -32,17 +35,22 @@\n @SuppressFBWarnings(\"IS2_INCONSISTENT_SYNC\")\n public class DeviceConfiguration {\n \n+    public static final String KERNEL_COMPONENT_NAME = \"aws.greengrass.Nucleus\";\n     public static final String DEVICE_PARAM_THING_NAME = \"thingName\";\n     public static final String DEVICE_PARAM_IOT_DATA_ENDPOINT = \"iotDataEndpoint\";\n     public static final String DEVICE_PARAM_IOT_CRED_ENDPOINT = \"iotCredEndpoint\";\n     public static final String DEVICE_PARAM_PRIVATE_KEY_PATH = \"privateKeyPath\";\n     public static final String DEVICE_PARAM_CERTIFICATE_FILE_PATH = \"certificateFilePath\";\n     public static final String DEVICE_PARAM_ROOT_CA_PATH = \"rootCaPath\";\n-    public static final String SYSTEM_NAMESPACE_KEY = \"system\";\n     public static final String DEVICE_PARAM_AWS_REGION = \"awsRegion\";\n     public static final String DEVICE_MQTT_NAMESPACE = \"mqtt\";\n+    public static final String IOT_ROLE_ALIAS_TOPIC = \"iotRoleAlias\";\n+    public static final String COMPONENT_STORE_MAX_SIZE = \"componentStoreMaxSize\";\n+    public static final String DEPLOYMENT_POLLING_FREQUENCY = \"deploymentPollingFrequency\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ee9c12f987c9bfec38b4ce8f78c361e16039482"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ee9c12f987c9bfec38b4ce8f78c361e16039482", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6ee9c12f987c9bfec38b4ce8f78c361e16039482", "committedDate": "2020-10-09T16:59:05Z", "message": "System settings as Nuclues component configuration"}, "afterCommit": {"oid": "612f506bfc16c05d67905f669c7bdb283bca4150", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/612f506bfc16c05d67905f669c7bdb283bca4150", "committedDate": "2020-10-13T14:09:53Z", "message": "System settings as Nuclues component configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODk3NDYw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-507897460", "createdAt": "2020-10-13T23:29:07Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMzoyOTowOFrOHg8-TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMzoyOTowOFrOHg8-TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxNTQ2OA==", "bodyText": "new syntax. https://github.com/aws/aws-greengrass-kernel/pull/518/files I will try to get this PR merged once build passes\nDo we need allow changing iot thing settings? It might get complicated, e.g. do we migrate local component store if rootpath changes? will we be able to report deployment status after thing info changes?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r504315468", "createdAt": "2020-10-13T23:29:08Z", "author": {"login": "hui-yang"}, "path": "aws.greengrass.Nucleus.yaml", "diffHunk": "@@ -4,14 +4,25 @@ ComponentName: aws.greengrass.Nucleus\n ComponentDescription: Core functionality for device side orchestration of deployments and lifecycle management for execution of Greengrass components and applications.\n ComponentPublisher: AWS\n ComponentVersion: '0.0.0'\n+ComponentType: aws.greengrass.nucleus\n Manifests:\n   - Platform:\n       os: macos\n-    Parameters:\n-      - name: jvmOptions\n-        # TODO: consider change to nested structure\n-        value: -Xms512m -Xmx512m\n-        type: STRING\n+    ComponentConfiguration:\n+      DefaultConfiguration:\n+        jvmOptions: -Xms512m -Xmx512m\n+        thingName: \"MyIotThing\"\n+        iotDataEndpoint: \"\"\n+        iotCredEndpoint: \"\"\n+        privateKeyPath: \"privKey.key\"\n+        certificateFilePath: \"thingCert.crt\"\n+        rootCaPath: \"rootCA.pem\"\n+        awsRegion: \"us-east-1\"\n+        rootpath: \"\"\n+        iotRoleAlias: \"MyIoTRoleAlias\"\n+        mqtt: \"\"\n+        deploymentPollingFrequencySeconds: 15L\n+        componentStoreMaxSizeBytes: 10_000_000_000L", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODk4NjM5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508898639", "createdAt": "2020-10-15T02:43:53Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0Mzo1M1rOHhuw4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0Mzo1M1rOHhuw4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMTIzNA==", "bodyText": "this goes at the top level, not under manifest", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505131234", "createdAt": "2020-10-15T02:43:53Z", "author": {"login": "MikeDombo"}, "path": "aws.greengrass.Nucleus.yaml", "diffHunk": "@@ -4,14 +4,25 @@ ComponentName: aws.greengrass.Nucleus\n ComponentDescription: Core functionality for device side orchestration of deployments and lifecycle management for execution of Greengrass components and applications.\n ComponentPublisher: AWS\n ComponentVersion: '0.0.0'\n+ComponentType: aws.greengrass.nucleus\n Manifests:\n   - Platform:\n       os: macos\n-    Parameters:\n-      - name: jvmOptions\n-        # TODO: consider change to nested structure\n-        value: -Xms512m -Xmx512m\n-        type: STRING\n+    ComponentConfiguration:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODk4NzI4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508898728", "createdAt": "2020-10-15T02:44:09Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0NDowOVrOHhuxMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0NDowOVrOHhuxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMTMxMg==", "bodyText": "not a string, should be {}", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505131312", "createdAt": "2020-10-15T02:44:09Z", "author": {"login": "MikeDombo"}, "path": "aws.greengrass.Nucleus.yaml", "diffHunk": "@@ -4,14 +4,25 @@ ComponentName: aws.greengrass.Nucleus\n ComponentDescription: Core functionality for device side orchestration of deployments and lifecycle management for execution of Greengrass components and applications.\n ComponentPublisher: AWS\n ComponentVersion: '0.0.0'\n+ComponentType: aws.greengrass.nucleus\n Manifests:\n   - Platform:\n       os: macos\n-    Parameters:\n-      - name: jvmOptions\n-        # TODO: consider change to nested structure\n-        value: -Xms512m -Xmx512m\n-        type: STRING\n+    ComponentConfiguration:\n+      DefaultConfiguration:\n+        jvmOptions: -Xms512m -Xmx512m\n+        thingName: \"MyIotThing\"\n+        iotDataEndpoint: \"\"\n+        iotCredEndpoint: \"\"\n+        privateKeyPath: \"privKey.key\"\n+        certificateFilePath: \"thingCert.crt\"\n+        rootCaPath: \"rootCA.pem\"\n+        awsRegion: \"us-east-1\"\n+        rootpath: \"\"\n+        iotRoleAlias: \"MyIoTRoleAlias\"\n+        mqtt: \"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODk4ODU2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508898856", "createdAt": "2020-10-15T02:44:36Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0NDozNlrOHhux4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0NDozNlrOHhux4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMTQ4OQ==", "bodyText": "some of these are bad defaults, so they just shouldn't have default values.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505131489", "createdAt": "2020-10-15T02:44:36Z", "author": {"login": "MikeDombo"}, "path": "aws.greengrass.Nucleus.yaml", "diffHunk": "@@ -4,14 +4,25 @@ ComponentName: aws.greengrass.Nucleus\n ComponentDescription: Core functionality for device side orchestration of deployments and lifecycle management for execution of Greengrass components and applications.\n ComponentPublisher: AWS\n ComponentVersion: '0.0.0'\n+ComponentType: aws.greengrass.nucleus\n Manifests:\n   - Platform:\n       os: macos\n-    Parameters:\n-      - name: jvmOptions\n-        # TODO: consider change to nested structure\n-        value: -Xms512m -Xmx512m\n-        type: STRING\n+    ComponentConfiguration:\n+      DefaultConfiguration:\n+        jvmOptions: -Xms512m -Xmx512m\n+        thingName: \"MyIotThing\"\n+        iotDataEndpoint: \"\"\n+        iotCredEndpoint: \"\"\n+        privateKeyPath: \"privKey.key\"\n+        certificateFilePath: \"thingCert.crt\"\n+        rootCaPath: \"rootCA.pem\"\n+        awsRegion: \"us-east-1\"\n+        rootpath: \"\"\n+        iotRoleAlias: \"MyIoTRoleAlias\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODk5OTcw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508899970", "createdAt": "2020-10-15T02:48:06Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0ODowN1rOHhu2IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0ODowN1rOHhu2IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMjU3Ng==", "bodyText": "use Coerce.toLong", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505132576", "createdAt": "2020-10-15T02:48:07Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/componentmanager/ComponentManager.java", "diffHunk": "@@ -388,6 +387,10 @@ void prepareArtifacts(ComponentIdentifier componentIdentifier, List<ComponentArt\n         }\n     }\n \n+    private long getConfiguredMaxSize() {\n+        return (long) deviceConfiguration.getComponentStoreMaxSizeBytes().getOnce();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTAwMjA3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508900207", "createdAt": "2020-10-15T02:48:55Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0ODo1NVrOHhu24Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo0ODo1NVrOHhu24Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMjc2OQ==", "bodyText": "how about all our other builtin components? It seems their configs are still deleted during deployment.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505132769", "createdAt": "2020-10-15T02:48:55Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/componentmanager/KernelConfigResolver.java", "diffHunk": "@@ -170,7 +173,9 @@ public KernelConfigResolver(ComponentStore componentStore, Kernel kernel, Nucleu\n                     .put(SERVICE_LIFECYCLE_NAMESPACE_TOPIC, interpolatedLifecycle);\n         }\n \n-        servicesConfig.put(kernel.getMain().getName(), getMainConfig(rootPackages));\n+        String nucleusComponentName = getNucleusComponentName(servicesConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTAwODgx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508900881", "createdAt": "2020-10-15T02:50:57Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1MDo1N1rOHhu5XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1MDo1N1rOHhu5XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMzQwNA==", "bodyText": "The type which is written into the config store is typically the short name plugin, lambda, and so on. Not the full name.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505133404", "createdAt": "2020-10-15T02:50:57Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -76,25 +97,55 @@ public DeviceConfiguration(Kernel kernel) {\n      * @param certificateFilePath certificate location on device\n      * @param rootCaFilePath      downloaded RootCA location on device\n      * @param awsRegion           aws region for the device\n+     * @param tesRoleAliasName    aws region for the device\n      * @throws DeviceConfigurationException when the configuration parameters are not valid\n      */\n     public DeviceConfiguration(Kernel kernel, String thingName, String iotDataEndpoint, String iotCredEndpoint,\n                                String privateKeyPath, String certificateFilePath, String rootCaFilePath,\n-                               String awsRegion) throws DeviceConfigurationException {\n-        this.kernel = kernel;\n-        deTildeValidator = getDeTildeValidator();\n-        regionValidator = getRegionValidator();\n+                               String awsRegion, String tesRoleAliasName) throws DeviceConfigurationException {\n+        this(kernel);\n         getThingName().withValue(thingName);\n         getIotDataEndpoint().withValue(iotDataEndpoint);\n         getIotCredentialEndpoint().withValue(iotCredEndpoint);\n         getPrivateKeyFilePath().withValue(privateKeyPath);\n         getCertificateFilePath().withValue(certificateFilePath);\n         getRootCAFilePath().withValue(rootCaFilePath);\n         getAWSRegion().withValue(awsRegion);\n+        getIotRoleAlias().withValue(tesRoleAliasName);\n \n         validate();\n     }\n \n+    /**\n+     * Get the Nucleus component name to lookup the configuration in the right place. If no component of type Nucleus\n+     * exists, create service config for the default Nucleus component.\n+     */\n+    private String getNucleusComponentName() {\n+        Optional<CaseInsensitiveString> nucleusComponent =\n+                kernel.getConfig().lookupTopics(SERVICES_NAMESPACE_TOPIC).children.keySet().stream()\n+                        .filter(s -> NUCLEUS_COMPONENT_TYPE.equals(getComponentType(s.toString()))).findAny();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTAxMjMx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508901231", "createdAt": "2020-10-15T02:52:09Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1MjowOVrOHhu6iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1MjowOVrOHhu6iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMzcwNQ==", "bodyText": "why add a dependency? doesn't seem helpful and may break stuff", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505133705", "createdAt": "2020-10-15T02:52:09Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -76,25 +97,55 @@ public DeviceConfiguration(Kernel kernel) {\n      * @param certificateFilePath certificate location on device\n      * @param rootCaFilePath      downloaded RootCA location on device\n      * @param awsRegion           aws region for the device\n+     * @param tesRoleAliasName    aws region for the device\n      * @throws DeviceConfigurationException when the configuration parameters are not valid\n      */\n     public DeviceConfiguration(Kernel kernel, String thingName, String iotDataEndpoint, String iotCredEndpoint,\n                                String privateKeyPath, String certificateFilePath, String rootCaFilePath,\n-                               String awsRegion) throws DeviceConfigurationException {\n-        this.kernel = kernel;\n-        deTildeValidator = getDeTildeValidator();\n-        regionValidator = getRegionValidator();\n+                               String awsRegion, String tesRoleAliasName) throws DeviceConfigurationException {\n+        this(kernel);\n         getThingName().withValue(thingName);\n         getIotDataEndpoint().withValue(iotDataEndpoint);\n         getIotCredentialEndpoint().withValue(iotCredEndpoint);\n         getPrivateKeyFilePath().withValue(privateKeyPath);\n         getCertificateFilePath().withValue(certificateFilePath);\n         getRootCAFilePath().withValue(rootCaFilePath);\n         getAWSRegion().withValue(awsRegion);\n+        getIotRoleAlias().withValue(tesRoleAliasName);\n \n         validate();\n     }\n \n+    /**\n+     * Get the Nucleus component name to lookup the configuration in the right place. If no component of type Nucleus\n+     * exists, create service config for the default Nucleus component.\n+     */\n+    private String getNucleusComponentName() {\n+        Optional<CaseInsensitiveString> nucleusComponent =\n+                kernel.getConfig().lookupTopics(SERVICES_NAMESPACE_TOPIC).children.keySet().stream()\n+                        .filter(s -> NUCLEUS_COMPONENT_TYPE.equals(getComponentType(s.toString()))).findAny();\n+        if (nucleusComponent.isPresent()) {\n+            return nucleusComponent.get().toString();\n+        } else {\n+            initializeNucleusComponentConfig();\n+            return DEFAULT_NUCLEUS_COMPONENT_NAME;\n+        }\n+    }\n+\n+    private void initializeNucleusComponentConfig() {\n+        this.kernel.getConfig().lookup(SERVICES_NAMESPACE_TOPIC, DEFAULT_NUCLEUS_COMPONENT_NAME, SERVICE_TYPE_TOPIC_KEY,\n+                NUCLEUS_COMPONENT_TYPE);\n+        ArrayList<String> mainDependencies = new ArrayList<>();\n+        mainDependencies.add(DEFAULT_NUCLEUS_COMPONENT_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 119}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTAxNTQw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508901540", "createdAt": "2020-10-15T02:53:12Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1MzoxMlrOHhu7qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1ODoxN1rOHhvA8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMzk5NA==", "bodyText": "no default", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505133994", "createdAt": "2020-10-15T02:53:12Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -171,12 +222,44 @@ public Topics getMQTTNamespace() {\n         return getTopics(DEVICE_MQTT_NAMESPACE);\n     }\n \n+    public Topic getIotRoleAlias() {\n+        return getTopicWithDefault(IOT_ROLE_ALIAS_TOPIC);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNDAyMQ==", "bodyText": "no default", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505134021", "createdAt": "2020-10-15T02:53:22Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -149,11 +200,11 @@ public Topic getIotDataEndpoint() {\n     }\n \n     public Topic getIotCredentialEndpoint() {\n-        return getTopic(DEVICE_PARAM_IOT_CRED_ENDPOINT);\n+        return getTopicWithDefault(DEVICE_PARAM_IOT_CRED_ENDPOINT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNDA1Ng==", "bodyText": "no default", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505134056", "createdAt": "2020-10-15T02:53:30Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -149,11 +200,11 @@ public Topic getIotDataEndpoint() {\n     }\n \n     public Topic getIotCredentialEndpoint() {\n-        return getTopic(DEVICE_PARAM_IOT_CRED_ENDPOINT);\n+        return getTopicWithDefault(DEVICE_PARAM_IOT_CRED_ENDPOINT);\n     }\n \n     public Topic getAWSRegion() {\n-        return getTopic(DEVICE_PARAM_AWS_REGION).addValidator(regionValidator);\n+        return getTopicWithDefault(DEVICE_PARAM_AWS_REGION).addValidator(regionValidator);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNDM4OQ==", "bodyText": "use NucleusPaths instead of using config store.\nWait why are we getting the modtime of the root path? The root shouldn't be changing ever.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505134389", "createdAt": "2020-10-15T02:54:45Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/KernelUpdateDeploymentTask.java", "diffHunk": "@@ -50,8 +54,9 @@ public DeploymentResult call() {\n         Deployment.DeploymentStage stage = deployment.getDeploymentStage();\n         KernelAlternatives kernelAlts = kernel.getContext().get(KernelAlternatives.class);\n         try {\n-            DeploymentConfigMerger.waitForServicesToStart(kernel.orderedDependencies(),\n-                    kernel.getConfig().lookup(\"system\", \"rootpath\").getModtime());\n+            DeploymentConfigMerger.waitForServicesToStart(kernel.orderedDependencies(), kernel.getConfig()\n+                    .lookup(SERVICES_NAMESPACE_TOPIC, DEFAULT_NUCLEUS_COMPONENT_NAME, CONFIGURATION_CONFIG_KEY,\n+                            NUCLEUS_ROOT_PATH).getModtime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNTExNg==", "bodyText": "we should remove kernel root path. It shouldn't ever be used by components. They won't have permissions to read/write anyway", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505135116", "createdAt": "2020-10-15T02:57:21Z", "author": {"login": "MikeDombo"}, "path": "src/test/java/com/aws/greengrass/componentmanager/KernelConfigResolverTest.java", "diffHunk": "@@ -66,10 +67,10 @@\n     private static final String LIFECYCLE_SCRIPT_KEY = \"script\";\n     private static final String LIFECYCLE_MOCK_INSTALL_COMMAND_FORMAT =\n             \"echo installing service in Package %s with param {{\" + KernelConfigResolver.PARAM_NAMESPACE + \":%s_Param_1\" + KernelConfigResolver.PARAM_VALUE_SUFFIX\n-                    + \"}}, kernel rootPath as {{\" + KernelConfigResolver.KERNEL_NAMESPACE + \":\" + KernelConfigResolver.KERNEL_ROOT_PATH + \"}} and \"\n+                    + \"}}, kernel rootPath as {{\" + KernelConfigResolver.KERNEL_NAMESPACE + \":\" + DeviceConfiguration.NUCLEUS_ROOT_PATH + \"}} and \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNTM0NQ==", "bodyText": "use const for name", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505135345", "createdAt": "2020-10-15T02:58:17Z", "author": {"login": "MikeDombo"}, "path": "src/test/java/com/aws/greengrass/lifecyclemanager/KernelTest.java", "diffHunk": "@@ -115,42 +115,50 @@ void GIVEN_kernel_and_services_WHEN_orderedDependencies_THEN_dependencies_are_re\n         GreengrassService service2 = new GreengrassService(\n                 kernel.getConfig().lookupTopics(GreengrassService.SERVICES_NAMESPACE_TOPIC, \"service2\"));\n         service2.postInject();\n+        GreengrassService nucleus = kernel.locate(\"aws.greengrass.Nucleus\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTAzMzI4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-508903328", "createdAt": "2020-10-15T02:59:12Z", "commit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1OToxMlrOHhvB2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMjo1OToxMlrOHhvB2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNTU3Nw==", "bodyText": "no getOnce when using coerce", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r505135577", "createdAt": "2020-10-15T02:59:12Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -213,10 +219,20 @@ protected void startup() throws InterruptedException {\n                     createNewDeployment(deployment);\n                 }\n             }\n-            Thread.sleep(pollingFrequency);\n+            Thread.sleep(pollingFrequency.get());\n         }\n     }\n \n+    private void subscribeToPollingFrequencyAndGet() {\n+        deviceConfiguration.onTopicChange(DEPLOYMENT_POLLING_FREQUENCY_SECONDS, (whatHappened, frequency) -> {\n+            pollingFrequency.set(getPollingFrequency(frequency));\n+        });\n+    }\n+\n+    private Long getPollingFrequency(Topic pollingFrequencyTopic) {\n+        return Duration.ofSeconds(Coerce.toLong(pollingFrequencyTopic.getOnce())).toMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4704665b27370b81549a578922264806499ece1b"}, "originalPosition": 88}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4704665b27370b81549a578922264806499ece1b", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4704665b27370b81549a578922264806499ece1b", "committedDate": "2020-10-13T18:27:36Z", "message": "Unit tests fixes"}, "afterCommit": {"oid": "2966f6ba0bd463de6b6aebc8f2bffa073387d612", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2966f6ba0bd463de6b6aebc8f2bffa073387d612", "committedDate": "2020-10-16T17:04:10Z", "message": "System settings as Nuclues component configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2966f6ba0bd463de6b6aebc8f2bffa073387d612", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2966f6ba0bd463de6b6aebc8f2bffa073387d612", "committedDate": "2020-10-16T17:04:10Z", "message": "System settings as Nuclues component configuration"}, "afterCommit": {"oid": "a94df31475efb94813bf6906507d4cc52502199c", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a94df31475efb94813bf6906507d4cc52502199c", "committedDate": "2020-10-19T15:26:08Z", "message": "System settings as Nuclues component configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a94df31475efb94813bf6906507d4cc52502199c", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a94df31475efb94813bf6906507d4cc52502199c", "committedDate": "2020-10-19T15:26:08Z", "message": "System settings as Nuclues component configuration"}, "afterCommit": {"oid": "c01bc1de0aa4f321d0f826947ddb7e4103766e2d", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c01bc1de0aa4f321d0f826947ddb7e4103766e2d", "committedDate": "2020-10-19T15:36:17Z", "message": "System settings as Nuclues component configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c01bc1de0aa4f321d0f826947ddb7e4103766e2d", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c01bc1de0aa4f321d0f826947ddb7e4103766e2d", "committedDate": "2020-10-19T15:36:17Z", "message": "System settings as Nuclues component configuration"}, "afterCommit": {"oid": "ef92ab1a74fb418de10b3dd05c7f31375629e7a2", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ef92ab1a74fb418de10b3dd05c7f31375629e7a2", "committedDate": "2020-10-19T15:57:58Z", "message": "System settings as Nuclues component configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef92ab1a74fb418de10b3dd05c7f31375629e7a2", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ef92ab1a74fb418de10b3dd05c7f31375629e7a2", "committedDate": "2020-10-19T15:57:58Z", "message": "System settings as Nuclues component configuration"}, "afterCommit": {"oid": "bf6310ed0bd9e58ab447ce53e88854a2db9ec718", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bf6310ed0bd9e58ab447ce53e88854a2db9ec718", "committedDate": "2020-10-19T16:59:37Z", "message": "System settings as Nuclues component configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf6310ed0bd9e58ab447ce53e88854a2db9ec718", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bf6310ed0bd9e58ab447ce53e88854a2db9ec718", "committedDate": "2020-10-19T16:59:37Z", "message": "System settings as Nuclues component configuration"}, "afterCommit": {"oid": "2a3b44fe6410f1c4946fb1d1c08c0b62868fdcf3", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2a3b44fe6410f1c4946fb1d1c08c0b62868fdcf3", "committedDate": "2020-10-19T17:07:01Z", "message": "System settings as Nucleus component configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a3b44fe6410f1c4946fb1d1c08c0b62868fdcf3", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2a3b44fe6410f1c4946fb1d1c08c0b62868fdcf3", "committedDate": "2020-10-19T17:07:01Z", "message": "System settings as Nucleus component configuration"}, "afterCommit": {"oid": "bc8283d980d5bffe5c869ddabb61aa268fdb48d4", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bc8283d980d5bffe5c869ddabb61aa268fdb48d4", "committedDate": "2020-10-19T17:44:45Z", "message": "System settings as Nucleus component configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMDMyNTY0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-512032564", "createdAt": "2020-10-19T18:10:49Z", "commit": {"oid": "bc8283d980d5bffe5c869ddabb61aa268fdb48d4"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxODoxMDo1MFrOHkbmVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxODoxMjo0M1rOHkbqhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2Mjk2NQ==", "bodyText": "We don't need defaults for these two settings?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r507962965", "createdAt": "2020-10-19T18:10:50Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -202,12 +255,40 @@ public String getProxyPassword() {\n         return Coerce.toString(getProxyNamespace().findOrDefault(\"\", DEVICE_PARAM_PROXY_PASSWORD));\n     }\n \n+    public Topic getIotRoleAlias() {\n+        return getTopic(IOT_ROLE_ALIAS_TOPIC).dflt(\"\");\n+    }\n+\n+    public Topic getComponentStoreMaxSizeBytes() {\n+        return getTopic(COMPONENT_STORE_MAX_SIZE_BYTES);\n+    }\n+\n+    public Topic getDeploymentPollingFrequencySeconds() {\n+        return getTopic(DEPLOYMENT_POLLING_FREQUENCY_SECONDS);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc8283d980d5bffe5c869ddabb61aa268fdb48d4"}, "originalPosition": 189}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2NDAzNw==", "bodyText": "Is port still a param of TES?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r507964037", "createdAt": "2020-10-19T18:12:43Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/greengrass/tes/README.md", "diffHunk": "@@ -13,23 +13,23 @@ Service lifecycle is managed by kernel and as part of kernel shutdown it stops t\n \n # Sample Configuration\n ```\n-system:\n-  awsRegion: \"us-east-1\"\n-  certificateFilePath: \"root/thingCert.crt\"\n-  iotCredEndpoint: \"c13im2gfya04ip.credentials.iot.us-east-1.amazonaws.com\"\n-  iotDataEndpoint: \"aun2g37imm74n-ats.iot.us-east-1.amazonaws.com\"\n-  privateKeyPath: \"root/privKey.key\"\n-  rootCaPath: \"root/rootCA.pem\"\n-  rootpath: \"root\"\n-  thingName: \"tes_thing\"\n services:\n   main:\n     lifecycle:\n     dependencies:\n       - TokenExchangeService\n+  aws.greengrass.Nucleus:\n+    parameters:\n+      awsRegion: \"us-east-1\"\n+      certificateFilePath: \"root/thingCert.crt\"\n+      iotCredEndpoint: \"c13im2gfya04ip.credentials.iot.us-east-1.amazonaws.com\"\n+      iotDataEndpoint: \"aun2g37imm74n-ats.iot.us-east-1.amazonaws.com\"\n+      privateKeyPath: \"root/privKey.key\"\n+      rootCaPath: \"root/rootCA.pem\"\n+      thingName: \"tes_thing\"\n+      iotRoleAlias: \"tes_alias\"\n   TokenExchangeService:\n     parameters:\n       port: 2020", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc8283d980d5bffe5c869ddabb61aa268fdb48d4"}, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eccd080ab5ea704c6c8fb267a5b511e6bc2adbb8", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/eccd080ab5ea704c6c8fb267a5b511e6bc2adbb8", "committedDate": "2020-10-20T15:44:18Z", "message": "Merge branch 'master' into system-settings"}, "afterCommit": {"oid": "8dfb815a8d8f535e10e37a45bcaa4f4f26b8e310", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8dfb815a8d8f535e10e37a45bcaa4f4f26b8e310", "committedDate": "2020-10-20T16:20:22Z", "message": "Added new config key for runwithDefault to nucleus recipe"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8dfb815a8d8f535e10e37a45bcaa4f4f26b8e310", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8dfb815a8d8f535e10e37a45bcaa4f4f26b8e310", "committedDate": "2020-10-20T16:20:22Z", "message": "Added new config key for runwithDefault to nucleus recipe"}, "afterCommit": {"oid": "655e1f26d61825d33b07d64c30514415e0705e67", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/655e1f26d61825d33b07d64c30514415e0705e67", "committedDate": "2020-10-20T16:50:51Z", "message": "Added new config key for runwithDefault to nucleus recipe, fixed an integ test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a25af9c7e924acc02074e658dd5c8310b3d30865", "author": {"user": {"login": "fahadmohammed01", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a25af9c7e924acc02074e658dd5c8310b3d30865", "committedDate": "2020-10-20T21:11:18Z", "message": "Merge branch 'master' into system-settings"}, "afterCommit": {"oid": "e1aa58432f596e295fb5666df24400d8aebbe98a", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e1aa58432f596e295fb5666df24400d8aebbe98a", "committedDate": "2020-10-21T00:13:29Z", "message": "Fix integ tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "024eff945adf3a8470f5f95dda40acf04b72e995", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/024eff945adf3a8470f5f95dda40acf04b72e995", "committedDate": "2020-10-21T16:13:53Z", "message": "Merge branch 'master' into system-settings"}, "afterCommit": {"oid": "75e78b58a908797fca25ee8408e1946873b6b644", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/75e78b58a908797fca25ee8408e1946873b6b644", "committedDate": "2020-10-21T17:15:02Z", "message": "Fix flaky unit test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75e78b58a908797fca25ee8408e1946873b6b644", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/75e78b58a908797fca25ee8408e1946873b6b644", "committedDate": "2020-10-21T17:15:02Z", "message": "Fix flaky unit test"}, "afterCommit": {"oid": "41f2fa036bd02acbc25b5358cd3f76925f5a4f55", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/41f2fa036bd02acbc25b5358cd3f76925f5a4f55", "committedDate": "2020-10-21T17:32:33Z", "message": "Fix flaky unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MDM3MTAz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-514037103", "createdAt": "2020-10-21T18:00:50Z", "commit": {"oid": "41f2fa036bd02acbc25b5358cd3f76925f5a4f55"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MDQ5NjAw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-514049600", "createdAt": "2020-10-21T18:16:42Z", "commit": {"oid": "41f2fa036bd02acbc25b5358cd3f76925f5a4f55"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "400f20b759be0227794da7809067d286bde32f84", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/400f20b759be0227794da7809067d286bde32f84", "committedDate": "2020-10-22T21:57:11Z", "message": "System settings as Nucleus component configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb616d78099c4d7fd569eab084546c0b83974be2", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cb616d78099c4d7fd569eab084546c0b83974be2", "committedDate": "2020-10-22T21:57:11Z", "message": "Fix bug with builtin service topics getting removed on deployments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da00a651f8dcf6d1dcb3c36ae53e64f56d732093", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/da00a651f8dcf6d1dcb3c36ae53e64f56d732093", "committedDate": "2020-10-22T21:57:11Z", "message": "Added new config key for runwithDefault to nucleus recipe, fixed an integ test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f58e79169b335bac0d29f101368b9ad4cc15e505", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f58e79169b335bac0d29f101368b9ad4cc15e505", "committedDate": "2020-10-22T21:57:11Z", "message": "Fix integ tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2048772103e095612866a58b63ad7057f92c40c", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f2048772103e095612866a58b63ad7057f92c40c", "committedDate": "2020-10-22T21:57:11Z", "message": "Fix flaky unit test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7988782a6eee7ff4bb4be054de02ca85a8344d80", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7988782a6eee7ff4bb4be054de02ca85a8344d80", "committedDate": "2020-10-21T18:33:56Z", "message": "Merge branch 'master' into system-settings"}, "afterCommit": {"oid": "36d65d004e83b16b5a184dca747152ab77a244ae", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/36d65d004e83b16b5a184dca747152ab77a244ae", "committedDate": "2020-10-22T21:57:11Z", "message": "Fixes for not breaking UATs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36d65d004e83b16b5a184dca747152ab77a244ae", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/36d65d004e83b16b5a184dca747152ab77a244ae", "committedDate": "2020-10-22T21:57:11Z", "message": "Fixes for not breaking UATs"}, "afterCommit": {"oid": "096ce9232d8f3738c7a4f59a64819e4db2981ef0", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/096ce9232d8f3738c7a4f59a64819e4db2981ef0", "committedDate": "2020-10-22T22:05:50Z", "message": "Fixes for not breaking UATs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "096ce9232d8f3738c7a4f59a64819e4db2981ef0", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/096ce9232d8f3738c7a4f59a64819e4db2981ef0", "committedDate": "2020-10-22T22:05:50Z", "message": "Fixes for not breaking UATs"}, "afterCommit": {"oid": "c2a8787758d98ba64a0bc41f869f3352cbfbeccb", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c2a8787758d98ba64a0bc41f869f3352cbfbeccb", "committedDate": "2020-10-22T22:07:13Z", "message": "Fixes for not breaking UATs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56250b7435a9907cfb19dd58a3dcdfbe7a10f9bd", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/56250b7435a9907cfb19dd58a3dcdfbe7a10f9bd", "committedDate": "2020-10-22T22:30:25Z", "message": "Fixes for not breaking UATs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2a8787758d98ba64a0bc41f869f3352cbfbeccb", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c2a8787758d98ba64a0bc41f869f3352cbfbeccb", "committedDate": "2020-10-22T22:07:13Z", "message": "Fixes for not breaking UATs"}, "afterCommit": {"oid": "56250b7435a9907cfb19dd58a3dcdfbe7a10f9bd", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/56250b7435a9907cfb19dd58a3dcdfbe7a10f9bd", "committedDate": "2020-10-22T22:30:25Z", "message": "Fixes for not breaking UATs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MTg4MTcy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-515188172", "createdAt": "2020-10-22T23:35:19Z", "commit": {"oid": "56250b7435a9907cfb19dd58a3dcdfbe7a10f9bd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMzozNToxOVrOHm3Vvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMzozNToxOVrOHm3Vvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDUxNDYyMg==", "bodyText": "Thanks. With this, we can deprecate KernelVersion later", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#discussion_r510514622", "createdAt": "2020-10-22T23:35:19Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -41,15 +43,16 @@\n public class DeviceConfiguration {\n \n     public static final String DEFAULT_NUCLEUS_COMPONENT_NAME = \"aws.greengrass.Nucleus\";\n-    // TODO : The type should come from common model, remove these once it's available\n-    public static final String NUCLEUS_COMPONENT_TYPE = \"aws.greengrass.nucleus\";\n-    public static final String NUCLEUS_COMPONENT_TYPE_SHORT = \"Nucleus\";\n+    // TODO : Version should come from the installer based on which nucleus version it installed\n+    public static final String NUCLEUS_COMPONENT_VERSION = \"0.0.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56250b7435a9907cfb19dd58a3dcdfbe7a10f9bd"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aad20c83ca6b0b6e1c39b381fa6270caa832de5", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7aad20c83ca6b0b6e1c39b381fa6270caa832de5", "committedDate": "2020-10-22T23:49:58Z", "message": "Merge branch 'master' into system-settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b9fd6b79747281495b94c1fe8c2e63503b496c6", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6b9fd6b79747281495b94c1fe8c2e63503b496c6", "committedDate": "2020-10-23T04:19:02Z", "message": "Merge branch 'master' into system-settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aed96cd8dbd988ca5a07ba23d94373d6a978c439", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aed96cd8dbd988ca5a07ba23d94373d6a978c439", "committedDate": "2020-10-23T09:36:05Z", "message": "Merge branch 'master' into system-settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "046e86c14fe1aa3cd990c2c82c579df67c5723e2", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/046e86c14fe1aa3cd990c2c82c579df67c5723e2", "committedDate": "2020-10-23T15:20:45Z", "message": "Merge branch 'master' into system-settings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1ODU1MzM4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/513#pullrequestreview-515855338", "createdAt": "2020-10-23T17:10:04Z", "commit": {"oid": "046e86c14fe1aa3cd990c2c82c579df67c5723e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1936e15d92122616b9e16fb868ad367171732bfc", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1936e15d92122616b9e16fb868ad367171732bfc", "committedDate": "2020-10-23T18:22:10Z", "message": "Merge branch 'master' into system-settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f4d11c12b64e094e0a6c6d3cf4c8d0b1d9624a0", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7f4d11c12b64e094e0a6c6d3cf4c8d0b1d9624a0", "committedDate": "2020-10-23T20:35:15Z", "message": "Merge branch 'master' into system-settings"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3118, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}