{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2ODQ3NzU4", "number": 405, "title": "Fixing deployment problems", "bodyText": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel\nIssue #, if available:\nDescription of changes:\nFixes several deployment problems including support for on-demand lambdas (which was blocking the deployment from completing). Prevents deployments from running in parallel. Fixes local deployment which didn't read the correct values for the existing services list.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-01T06:30:55Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405", "merged": true, "mergeCommit": {"oid": "98fa16e50b8a27c37a39c3dfb7353a546e58cf1b"}, "closed": true, "closedAt": "2020-09-01T18:20:20Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEhen_gBqjM3MTMwNjIzNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdErlcegFqTQ4MDAwMzA5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e19b5bcc7ab2387f2f2a2ef286040a52d7a4fa8f", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e19b5bcc7ab2387f2f2a2ef286040a52d7a4fa8f", "committedDate": "2020-09-01T06:28:22Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}, "afterCommit": {"oid": "942b401de45532aac55545f6a990fc6b45966afd", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/942b401de45532aac55545f6a990fc6b45966afd", "committedDate": "2020-09-01T06:33:06Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "942b401de45532aac55545f6a990fc6b45966afd", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/942b401de45532aac55545f6a990fc6b45966afd", "committedDate": "2020-09-01T06:33:06Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}, "afterCommit": {"oid": "327462e9f4dd47caed559b48e23cddab59d9b5d4", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/327462e9f4dd47caed559b48e23cddab59d9b5d4", "committedDate": "2020-09-01T07:29:12Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "327462e9f4dd47caed559b48e23cddab59d9b5d4", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/327462e9f4dd47caed559b48e23cddab59d9b5d4", "committedDate": "2020-09-01T07:29:12Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}, "afterCommit": {"oid": "e8b4aeeba066ebc065f15697debd84edc673242a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e8b4aeeba066ebc065f15697debd84edc673242a", "committedDate": "2020-09-01T16:13:12Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "333818f02402297635b2abe57e13397465b1998a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/333818f02402297635b2abe57e13397465b1998a", "committedDate": "2020-09-01T16:45:56Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8b4aeeba066ebc065f15697debd84edc673242a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e8b4aeeba066ebc065f15697debd84edc673242a", "committedDate": "2020-09-01T16:13:12Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}, "afterCommit": {"oid": "333818f02402297635b2abe57e13397465b1998a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/333818f02402297635b2abe57e13397465b1998a", "committedDate": "2020-09-01T16:45:56Z", "message": "Fixing deployment problems which removed existing services, blocked forever, ran in parallel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5OTgzMTAx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#pullrequestreview-479983101", "createdAt": "2020-09-01T17:51:15Z", "commit": {"oid": "333818f02402297635b2abe57e13397465b1998a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNzo1MToxNVrOHLBzgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNzo1MToxNVrOHLBzgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyNTk1Mg==", "bodyText": "Will service.reachedDesiredState() include evaluating RUNNING and FINISHED check?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#discussion_r481325952", "createdAt": "2020-09-01T17:51:15Z", "author": {"login": "abanthiy"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/DeploymentConfigMerger.java", "diffHunk": "@@ -131,7 +131,8 @@ public static void waitForServicesToStart(Collection<EvergreenService> servicesT\n                     allServicesRunning = false;\n                     continue;\n                 }\n-                if (State.RUNNING.equals(state) || State.FINISHED.equals(state)) {\n+                if (State.RUNNING.equals(state) || State.FINISHED.equals(state) || !service.shouldAutoStart()\n+                        && service.reachedDesiredState()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333818f02402297635b2abe57e13397465b1998a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDAwMDA5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#pullrequestreview-480000009", "createdAt": "2020-09-01T18:15:21Z", "commit": {"oid": "333818f02402297635b2abe57e13397465b1998a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDAzMDk0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/405#pullrequestreview-480003094", "createdAt": "2020-09-01T18:19:45Z", "commit": {"oid": "333818f02402297635b2abe57e13397465b1998a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3236, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}