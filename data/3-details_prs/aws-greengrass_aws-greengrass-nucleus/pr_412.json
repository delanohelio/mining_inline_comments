{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5OTMxNjAx", "number": 412, "title": "Deployment service get component group configs", "bodyText": "Issue #, if available:\nDescription of changes:\nAdd functions in deployment service to get group configs from component names. Also added a function to get a list of all groups (for system components).\nWhy is this change necessary:\nThese functions will be used in logs manager to get the group(s) a component belongs to. The group information will be used to calculate the log stream names within a log group for a component.\nHow was this change tested:\nAdded a unit test.\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-04T17:57:03Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412", "merged": true, "mergeCommit": {"oid": "248256ad1d9c1c636a7910a332f13e588b66af27"}, "closed": true, "closedAt": "2020-09-04T21:06:32Z", "author": {"login": "nikkhilmuthye"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFo_j0gH2gAyNDc5OTMxNjAxOmI2OTA2ZmNkOTE5ZTNiNzQyOTA5YmRhNzZhNDQ2ZWVhMTdiNjg4ZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFru8bgFqTQ4MjkzODI0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b6906fcd919e3b742909bda76a446eea17b688fd", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b6906fcd919e3b742909bda76a446eea17b688fd", "committedDate": "2020-09-04T17:52:29Z", "message": "Get group config arns by component. Add unit test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTI2MzUw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#pullrequestreview-482926350", "createdAt": "2020-09-04T20:34:47Z", "commit": {"oid": "b6906fcd919e3b742909bda76a446eea17b688fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d8b385611b50b6beb259be6ee2007dfc38f82e8", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2d8b385611b50b6beb259be6ee2007dfc38f82e8", "committedDate": "2020-09-04T20:34:55Z", "message": "Merge branch 'master' into deploymentServiceGetComponentGroupChanges"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTI3OTEz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#pullrequestreview-482927913", "createdAt": "2020-09-04T20:38:48Z", "commit": {"oid": "2d8b385611b50b6beb259be6ee2007dfc38f82e8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDozODo0OFrOHNa7gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDozOToyMVrOHNa8MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNDc1Mw==", "bodyText": "nit: why not fleetConfigArn?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#discussion_r483834753", "createdAt": "2020-09-04T20:38:48Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/DeploymentService.java", "diffHunk": "@@ -67,7 +67,7 @@\n     public static final String GROUP_TO_ROOT_COMPONENTS_TOPICS = \"GroupToRootComponents\";\n     public static final String COMPONENTS_TO_GROUPS_TOPICS = \"ComponentToGroups\";\n     public static final String GROUP_TO_ROOT_COMPONENTS_VERSION_KEY = \"version\";\n-    public static final String GROUP_TO_ROOT_COMPONENTS_GROUP_DEPLOYMENT_ID = \"groupDeploymentId\";\n+    public static final String GROUP_TO_ROOT_COMPONENTS_GROUP_CONFIG_ARN = \"groupConfigArn\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d8b385611b50b6beb259be6ee2007dfc38f82e8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNDkyOQ==", "bodyText": "Are these two functions only used in tests?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#discussion_r483834929", "createdAt": "2020-09-04T20:39:21Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/iot/evergreen/deployment/DeploymentService.java", "diffHunk": "@@ -495,4 +495,41 @@ private void setComponentsToGroupsMapping(Topics groupsToRootComponents) {\n         }\n \n     }\n+\n+    /**\n+     * Gets the list of all the groups that the component is a part of.\n+     *\n+     * @param componentName The name of the component.\n+     * @return The list of groups the component is a part of.\n+     */\n+    public Set<String> getGroupConfigsForUserComponent(String componentName) {\n+        Topics componentsToGroupsTopics = config.lookupTopics(COMPONENTS_TO_GROUPS_TOPICS);\n+\n+        Set<String> componentGroups = new HashSet<>();\n+        if (componentsToGroupsTopics != null) {\n+            Topics groupsTopics = componentsToGroupsTopics.lookupTopics(componentName);\n+            groupsTopics.children.values().stream().map(n -> (Topic) n).map(Topic::getName)\n+                    .forEach(componentGroups::add);\n+        }\n+        return componentGroups;\n+    }\n+\n+    /**\n+     * Gets the list of all the groups that the thing is a part of.\n+     * @return All the group configs.\n+     */\n+    public Set<String> getAllGroupConfigs() {\n+        Topics componentsToGroupsTopics = config.lookupTopics(COMPONENTS_TO_GROUPS_TOPICS);\n+\n+        Set<String> componentGroups = new HashSet<>();\n+        if (componentsToGroupsTopics != null) {\n+            componentsToGroupsTopics.iterator().forEachRemaining(node -> {\n+                Topics groupsTopics = (Topics) node;\n+                groupsTopics.children.values().stream().map(n -> (Topic) n).map(Topic::getName)\n+                        .forEach(componentGroups::add);\n+\n+            });\n+        }\n+        return componentGroups;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d8b385611b50b6beb259be6ee2007dfc38f82e8"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTM4MjQ1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/412#pullrequestreview-482938245", "createdAt": "2020-09-04T21:04:03Z", "commit": {"oid": "2d8b385611b50b6beb259be6ee2007dfc38f82e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3252, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}