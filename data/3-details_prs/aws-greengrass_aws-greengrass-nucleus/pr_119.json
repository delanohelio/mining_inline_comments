{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMTU2NDkx", "number": 119, "title": "Provide details of dependency resolution conflicts", "bodyText": "Issue #, if available:\nDescription of changes:\nProvide error details when there is a conflict in dependency resolution.\nWhy is this change necessary:\nWithout the change, the exception of package conflict only gives the entire list of unresolved root packages, which is not helpful to root cause or solve the issue.\nHow was this change tested:\nUnit tests.\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-03-18T01:05:17Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/119", "merged": true, "mergeCommit": {"oid": "2ecad148cd5534397b5b2021003fd25284eb70d8"}, "closed": true, "closedAt": "2020-03-18T22:41:32Z", "author": {"login": "hui-yang"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOvxYjAFqTM3NjU1OTc2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO_KcfgFqTM3NzI4NTA0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTU5NzY4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/119#pullrequestreview-376559768", "createdAt": "2020-03-18T04:38:09Z", "commit": {"oid": "2832f883b3774ff287cbdbca206042016e6c9abf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNDozODowOVrOF32IRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNDo0MDoxNVrOF32J6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEwMjg1NA==", "bodyText": "This is fine, but why not just have the resolve method throw the exception?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/119#discussion_r394102854", "createdAt": "2020-03-18T04:38:09Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/DependencyResolver.java", "diffHunk": "@@ -84,10 +84,12 @@\n \n         // Map of package name and resolved version\n         Map<String, Semver> resolvedPackageNameToVersion = new HashMap<>();\n-        boolean resolved = resolveDependencyTree(resolvedPackageNameToVersion, packageNameToVersionConstraints,\n-                rootPackagesToResolve);\n-        if (!resolved) {\n-            throw new PackageVersionConflictException(\"Unresolved packages: \" + rootPackagesToResolve);\n+\n+        Optional<String> errorMessage = resolveDependencyTree(resolvedPackageNameToVersion,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2832f883b3774ff287cbdbca206042016e6c9abf"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEwMzA3NQ==", "bodyText": "String.format instead of concatenation would be preferred I think. Here and elsewhere.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/119#discussion_r394103075", "createdAt": "2020-03-18T04:39:15Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/DependencyResolver.java", "diffHunk": "@@ -335,4 +349,19 @@ private Package getPackage(final String pkgName, final Semver version) throws Pa\n         //}\n         //return (Map<String, String>) dependencyListForPlatform;\n     }\n+\n+    private String buildErrorMessage(final String pkgName, final Map<String, Semver> resolvedPackageNameToVersion,\n+                                     final Map<String, String> versionConstraints) {\n+        Map<PackageIdentifier, String> pkgIdToVersionRequirements = new HashMap<>();\n+        versionConstraints.forEach((dependingPkgName, versionRequirement) -> pkgIdToVersionRequirements.put(\n+                new PackageIdentifier(dependingPkgName, resolvedPackageNameToVersion.get(dependingPkgName)),\n+                versionRequirement));\n+        return \"Conflicts in resolving package \" + pkgName + \". Version constraints from upstream packages: \"\n+                + pkgIdToVersionRequirements;\n+    }\n+\n+    private String buildErrorMessage(PackageIdentifier pkg, PackageIdentifier dependingPkg, String requirement) {\n+        return \"Package version \" + pkg + \" does not satisfy requirements of \" + dependingPkg", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2832f883b3774ff287cbdbca206042016e6c9abf"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEwMzI3NA==", "bodyText": "Let's have a custom to string since the error this is used with will be customer facing.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/119#discussion_r394103274", "createdAt": "2020-03-18T04:40:15Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageIdentifier.java", "diffHunk": "@@ -7,12 +7,14 @@\n import lombok.AllArgsConstructor;\n import lombok.EqualsAndHashCode;\n import lombok.Getter;\n+import lombok.ToString;\n \n @JsonSerialize\n @JsonInclude(JsonInclude.Include.NON_NULL)\n @Getter\n @EqualsAndHashCode\n @AllArgsConstructor\n+@ToString", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2832f883b3774ff287cbdbca206042016e6c9abf"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2832f883b3774ff287cbdbca206042016e6c9abf", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2832f883b3774ff287cbdbca206042016e6c9abf", "committedDate": "2020-03-18T01:02:28Z", "message": "Provide details of dependency resolution conflicts"}, "afterCommit": {"oid": "801997e7676c861d3ab50e2a76cd3f7f3263a8b6", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/801997e7676c861d3ab50e2a76cd3f7f3263a8b6", "committedDate": "2020-03-18T18:12:20Z", "message": "Provide details of dependency resolution conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTU5NzEw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/119#pullrequestreview-377159710", "createdAt": "2020-03-18T19:10:27Z", "commit": {"oid": "801997e7676c861d3ab50e2a76cd3f7f3263a8b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e69926409fd76ca4df19709aecab67b0ba1b4d53", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e69926409fd76ca4df19709aecab67b0ba1b4d53", "committedDate": "2020-03-18T22:33:38Z", "message": "Provide details of dependency resolution conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "801997e7676c861d3ab50e2a76cd3f7f3263a8b6", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/801997e7676c861d3ab50e2a76cd3f7f3263a8b6", "committedDate": "2020-03-18T18:12:20Z", "message": "Provide details of dependency resolution conflicts"}, "afterCommit": {"oid": "e69926409fd76ca4df19709aecab67b0ba1b4d53", "author": {"user": {"login": "hui-yang", "name": "Hui Yang"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e69926409fd76ca4df19709aecab67b0ba1b4d53", "committedDate": "2020-03-18T22:33:38Z", "message": "Provide details of dependency resolution conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3Mjg1MDQ4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/119#pullrequestreview-377285048", "createdAt": "2020-03-18T22:36:27Z", "commit": {"oid": "e69926409fd76ca4df19709aecab67b0ba1b4d53"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2348, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}