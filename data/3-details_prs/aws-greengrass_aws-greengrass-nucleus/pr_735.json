{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NzczOTgy", "number": 735, "title": "Fix nucleus component change name", "bodyText": "Issue #, if available:\nDescription of changes:\nThe nucleus component name was only set once per startup which is not correct because the config is merged prior to kernel restarting if the nucleus component changes. Therefore, this was causing failures when looking for config topics which had been removed since the nucleus was changed from the default name to some new name. This change fixes this issue by updating the nucleus component name when necessary.\nWhy is this change necessary:\nHow was this change tested:\nVerified working by running Deployment-13-T6 which was previously failing due to this issue.\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-30T19:50:50Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735", "merged": true, "mergeCommit": {"oid": "80d5da0cbe701a9399c655a7271a0e48d2ebc50f"}, "closed": true, "closedAt": "2020-11-30T21:18:07Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhq2qHgBqjQwNTM2ODIxNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhsEZtAFqTU0MTMwMTU1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08243521a6f0954ac101c5461f46e89fae94f12d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/08243521a6f0954ac101c5461f46e89fae94f12d", "committedDate": "2020-11-30T19:44:53Z", "message": "Fix nucleus component change name"}, "afterCommit": {"oid": "b33dee31c4b8c188c367cf66053a2067938ceba6", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b33dee31c4b8c188c367cf66053a2067938ceba6", "committedDate": "2020-11-30T19:52:13Z", "message": "Fix nucleus component change name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95a93a8ab4d4d753c685911bf8d943f00f2f4ad2", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/95a93a8ab4d4d753c685911bf8d943f00f2f4ad2", "committedDate": "2020-11-30T19:54:12Z", "message": "Fix nucleus component change name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b33dee31c4b8c188c367cf66053a2067938ceba6", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b33dee31c4b8c188c367cf66053a2067938ceba6", "committedDate": "2020-11-30T19:52:13Z", "message": "Fix nucleus component change name"}, "afterCommit": {"oid": "95a93a8ab4d4d753c685911bf8d943f00f2f4ad2", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/95a93a8ab4d4d753c685911bf8d943f00f2f4ad2", "committedDate": "2020-11-30T19:54:12Z", "message": "Fix nucleus component change name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjUwNTM5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735#pullrequestreview-541250539", "createdAt": "2020-11-30T20:01:10Z", "commit": {"oid": "95a93a8ab4d4d753c685911bf8d943f00f2f4ad2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDowMToxMFrOH8Lt5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDowNzowMlrOH8L6RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg2ODU4MQ==", "bodyText": "synchronized?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735#discussion_r532868581", "createdAt": "2020-11-30T20:01:10Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -156,6 +153,20 @@ public DeviceConfiguration(Kernel kernel, String thingName, String iotDataEndpoi\n         validate();\n     }\n \n+    /**\n+     * Get the Nucleus component's name.\n+     *\n+     * @return Nucleus component name\n+     */\n+    public String getNucleusComponentName() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95a93a8ab4d4d753c685911bf8d943f00f2f4ad2"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg3MTc0OQ==", "bodyText": "Just to clarify, here onAnyChange doesn't need to be set up again by callers, because nucleusComponentName change can only happen in a nucleus update deployment, and when the config merges, all application should have been stopped", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735#discussion_r532871749", "createdAt": "2020-11-30T20:07:02Z", "author": {"login": "hui-yang"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -400,7 +411,7 @@ public Topic getDeploymentPollingFrequencySeconds() {\n      * @param cc Subscribe handler\n      */\n     public void onAnyChange(ChildChanged cc) {\n-        kernel.getConfig().lookupTopics(SERVICES_NAMESPACE_TOPIC, nucleusComponentName, CONFIGURATION_CONFIG_KEY)\n+        kernel.getConfig().lookupTopics(SERVICES_NAMESPACE_TOPIC, getNucleusComponentName(), CONFIGURATION_CONFIG_KEY)\n                 .subscribe(cc);\n         kernel.getConfig().lookupTopics(SYSTEM_NAMESPACE_KEY).subscribe(cc);\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95a93a8ab4d4d753c685911bf8d943f00f2f4ad2"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjU5NTM4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735#pullrequestreview-541259538", "createdAt": "2020-11-30T20:14:25Z", "commit": {"oid": "4b403f9f74bbf843fac2ce769274f130a7eb999a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjYzMDMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735#pullrequestreview-541263032", "createdAt": "2020-11-30T20:19:39Z", "commit": {"oid": "4b403f9f74bbf843fac2ce769274f130a7eb999a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "000871665a62618e26300a0312ad560a1e971fc5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/000871665a62618e26300a0312ad560a1e971fc5", "committedDate": "2020-11-30T20:28:59Z", "message": "Synchronize"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b403f9f74bbf843fac2ce769274f130a7eb999a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4b403f9f74bbf843fac2ce769274f130a7eb999a", "committedDate": "2020-11-30T20:11:59Z", "message": "Synchronize"}, "afterCommit": {"oid": "000871665a62618e26300a0312ad560a1e971fc5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/000871665a62618e26300a0312ad560a1e971fc5", "committedDate": "2020-11-30T20:28:59Z", "message": "Synchronize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjY5Njk1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735#pullrequestreview-541269695", "createdAt": "2020-11-30T20:29:39Z", "commit": {"oid": "000871665a62618e26300a0312ad560a1e971fc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzAxNTUy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/735#pullrequestreview-541301552", "createdAt": "2020-11-30T21:17:22Z", "commit": {"oid": "000871665a62618e26300a0312ad560a1e971fc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2772, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}