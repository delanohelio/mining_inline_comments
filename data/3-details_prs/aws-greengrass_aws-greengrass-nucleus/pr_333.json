{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NDI4MDI5", "number": 333, "title": "Add \"ComponentType\" key to Recipe", "bodyText": "Issue #, if available:\nDescription of changes:\nUpdated from Amit's comments on #327. Adds \"ComponentType\" key to recipe so that we can change what type of class is created for the service, not just GenericExternalService. Hard-codes the 2 options, Generic and Lambda to be GenericExternalService and the UserLambdaService. Options must be hardcoded because if they were dynamically added by lambda manager, for example, they would not be able to create the user lambda as a user lambda class after the lambda manager had updated the map.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-07-27T22:10:18Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333", "merged": true, "mergeCommit": {"oid": "1972ecb1e01f0ca1fc39b0228c9495b5a3381ccd"}, "closed": true, "closedAt": "2020-07-29T03:10:13Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5JZXYgBqjM1OTE4NDU5ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5iLeIAFqTQ1NzE2NDEyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79b446b2feac5e9d3f1cabb8d301bd248f3d196d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/79b446b2feac5e9d3f1cabb8d301bd248f3d196d", "committedDate": "2020-07-27T22:09:14Z", "message": "Add private namespace to comment"}, "afterCommit": {"oid": "22a838b2c1d6391fdd1630a9b67d55977e4f4c9b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/22a838b2c1d6391fdd1630a9b67d55977e4f4c9b", "committedDate": "2020-07-27T22:16:29Z", "message": "Add private namespace to comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a42412409d4fc027236d85f7c26bc64dc99e448", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0a42412409d4fc027236d85f7c26bc64dc99e448", "committedDate": "2020-07-27T22:28:54Z", "message": "Add class key to component recipe"}, "afterCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/32700c066dd0d61a8b29c9c3e8385370ebfc816a", "committedDate": "2020-07-27T22:39:24Z", "message": "Add class key to component recipe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTg4NDk2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-456188496", "createdAt": "2020-07-27T22:51:52Z", "commit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMjo1MTo1M1rOG32VtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMjo1MTo1M1rOG32VtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNTE1Ng==", "bodyText": "Does author have to specify the class? Is there a default value?\nIs it a good idea to use absolute namespace? what about the class path got changed later?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461215156", "createdAt": "2020-07-27T22:51:53Z", "author": {"login": "wikimonkey"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+Class: com.aws.iot.evergreen.kernel.EvergreenService", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjAxNTE3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-456201517", "createdAt": "2020-07-27T23:26:03Z", "commit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTkwNjk4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-456990698", "createdAt": "2020-07-28T20:34:52Z", "commit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDozNDo1MlrOG4dziA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDozNDo1MlrOG4dziA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg2MTc2OA==", "bodyText": "Curious, can you use @AllArgsConstructor @JsonSetter(nulls = Nulls.AS_EMPTY) and @JsonNaming(PropertyNamingStrategy.UpperCamelCaseStrategy.class) ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461861768", "createdAt": "2020-07-28T20:34:52Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/iot/evergreen/packagemanager/models/PackageRecipe.java", "diffHunk": "@@ -79,13 +82,13 @@ public PackageRecipe(@JsonProperty(\"RecipeTemplateVersion\") RecipeTemplateVersio\n                          @JsonProperty(\"ComponentName\") String componentName, @JsonProperty(\"Version\") Semver version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32700c066dd0d61a8b29c9c3e8385370ebfc816a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/32700c066dd0d61a8b29c9c3e8385370ebfc816a", "committedDate": "2020-07-27T22:39:24Z", "message": "Add class key to component recipe"}, "afterCommit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/211cb93fd1033ebf00d04713eb4d9d970f414303", "committedDate": "2020-07-28T22:53:47Z", "message": "Change Class to ComponentType to abstract the actual class used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MDg2MzE1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457086315", "createdAt": "2020-07-28T23:00:21Z", "commit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzowMDoyMVrOG4ipxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMzowMjozNFrOG4isqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk0MTE5MQ==", "bodyText": "What is Raw type?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461941191", "createdAt": "2020-07-28T23:00:21Z", "author": {"login": "fengwang666"}, "path": "src/integrationtests/resources/com/aws/iot/evergreen/integrationtests/deployment/local_store_content/recipes/ClassService-1.0.0.yaml", "diffHunk": "@@ -0,0 +1,7 @@\n+---\n+RecipeTemplateVersion: '2020-01-25'\n+ComponentName: ClassService\n+Description: Directly creates a raw EvergreenService instead of a GenericExternalService\n+Publisher: Me\n+Version: '1.0.0'\n+ComponentType: Raw", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk0MTkzMQ==", "bodyText": "Add unit tests for these two types?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461941931", "createdAt": "2020-07-28T23:02:34Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -119,6 +125,10 @@ public Kernel() {\n         context.put(DeploymentActivatorFactory.class, new DeploymentActivatorFactory(this));\n         context.put(BootstrapManager.class, new BootstrapManager(this));\n         context.put(Clock.class, Clock.systemUTC());\n+        Map<String, String> typeToClassMap = new ConcurrentHashMap<>();\n+        typeToClassMap.put(\"generic\", GenericExternalService.class.getName());\n+        typeToClassMap.put(\"lambda\", \"com.aws.iot.evergreen.lambdamanager.UserLambdaService\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MDkzOTA2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457093906", "createdAt": "2020-07-28T23:20:14Z", "commit": {"oid": "211cb93fd1033ebf00d04713eb4d9d970f414303"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTEwNDM0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457110434", "createdAt": "2020-07-29T00:08:35Z", "commit": {"oid": "f5ae26ecc174dc87906c93ecfc3850be18b07b9f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5ae26ecc174dc87906c93ecfc3850be18b07b9f", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f5ae26ecc174dc87906c93ecfc3850be18b07b9f", "committedDate": "2020-07-29T00:05:32Z", "message": "Scope down visibility of EGService methods"}, "afterCommit": {"oid": "6fef3424b328e4ed9720e7f19d97b6913329287d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6fef3424b328e4ed9720e7f19d97b6913329287d", "committedDate": "2020-07-29T00:09:01Z", "message": "Scope down visibility of EGService methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTMyNTk1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457132595", "createdAt": "2020-07-29T01:22:22Z", "commit": {"oid": "d4d6687bb77f259d4d07760ffca3b44addffd80f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToyMjoyMlrOG4lNNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMToyMjoyMlrOG4lNNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MzAyOQ==", "bodyText": "Are we okay with needing a new kernel version in rare cases where a new lambda manager version changes this class ?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#discussion_r461983029", "createdAt": "2020-07-29T01:22:22Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -119,6 +125,10 @@ public Kernel() {\n         context.put(DeploymentActivatorFactory.class, new DeploymentActivatorFactory(this));\n         context.put(BootstrapManager.class, new BootstrapManager(this));\n         context.put(Clock.class, Clock.systemUTC());\n+        Map<String, String> typeToClassMap = new ConcurrentHashMap<>();\n+        typeToClassMap.put(\"generic\", GenericExternalService.class.getName());\n+        typeToClassMap.put(\"lambda\", \"com.aws.iot.evergreen.lambdamanager.UserLambdaService\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4d6687bb77f259d4d07760ffca3b44addffd80f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTMyNjIz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457132623", "createdAt": "2020-07-29T01:22:27Z", "commit": {"oid": "d4d6687bb77f259d4d07760ffca3b44addffd80f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTM0Mjc0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457134274", "createdAt": "2020-07-29T01:27:54Z", "commit": {"oid": "d4d6687bb77f259d4d07760ffca3b44addffd80f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc6c3f3856b37f7adf4dcb6755fbc97389def3d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/dfc6c3f3856b37f7adf4dcb6755fbc97389def3d", "committedDate": "2020-07-29T01:30:28Z", "message": "Add private namespace to comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d7d6cf2b6de64b913d942ecfdbeb0f737dcbb23", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2d7d6cf2b6de64b913d942ecfdbeb0f737dcbb23", "committedDate": "2020-07-29T01:30:28Z", "message": "Add class key to component recipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "006bb69ea869091093d1d694af2522cf7f2158b3", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/006bb69ea869091093d1d694af2522cf7f2158b3", "committedDate": "2020-07-29T01:30:28Z", "message": "Change Class to ComponentType to abstract the actual class used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1682a6eba51e75b6853ae0bde3bb24238fa5657b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1682a6eba51e75b6853ae0bde3bb24238fa5657b", "committedDate": "2020-07-29T01:30:28Z", "message": "Wait for main to restart in test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70e7e4a154a188d958db8558490758a584a832a7", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/70e7e4a154a188d958db8558490758a584a832a7", "committedDate": "2020-07-29T01:30:28Z", "message": "Scope down visibility of EGService methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27e1fc55df39f0a8e1bba127d93a9104b950325b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/27e1fc55df39f0a8e1bba127d93a9104b950325b", "committedDate": "2020-07-29T01:31:09Z", "message": "Undo change to test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4d6687bb77f259d4d07760ffca3b44addffd80f", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d4d6687bb77f259d4d07760ffca3b44addffd80f", "committedDate": "2020-07-29T01:15:04Z", "message": "Increase timeout again"}, "afterCommit": {"oid": "27e1fc55df39f0a8e1bba127d93a9104b950325b", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/27e1fc55df39f0a8e1bba127d93a9104b950325b", "committedDate": "2020-07-29T01:31:09Z", "message": "Undo change to test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTQyNDAz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457142403", "createdAt": "2020-07-29T01:55:01Z", "commit": {"oid": "27e1fc55df39f0a8e1bba127d93a9104b950325b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTY0MTI3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/333#pullrequestreview-457164127", "createdAt": "2020-07-29T03:09:04Z", "commit": {"oid": "27e1fc55df39f0a8e1bba127d93a9104b950325b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2941, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}