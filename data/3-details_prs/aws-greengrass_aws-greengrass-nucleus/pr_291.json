{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMjg0OTk1", "number": 291, "title": "Split coverage reports and checks for unit and integ tests", "bodyText": "Issue #, if available:\nhttps://issues.amazon.com/issues/P37008620\nDescription of changes:\nSplitting coverage report generation, minimum coverage requirements and report uploading for unit and integration tests\nWhy is this change necessary:\nCurrent aggregate coverage report and requirements don't give much idea on where we need more unit tests vs integ tests resulting in poor coverage in both areas individually. This change intends to encourage developers to write more tests of both kinds and assess our progress for the ongoing task to improve test coverage.\nHow was this change tested:\nmvn -ntp clean verify\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-06-25T22:17:45Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291", "merged": true, "mergeCommit": {"oid": "3ca1602a6e7a8f317f9b1ec94371892b6a79c43e"}, "closed": true, "closedAt": "2020-06-26T21:12:30Z", "author": {"login": "shaguptashaikh"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu2QrEgFqTQzNzg5ODQwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvJyQtAFqTQzODU5NDM4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODk4NDAw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#pullrequestreview-437898400", "createdAt": "2020-06-25T22:19:40Z", "commit": {"oid": "5b127ed6497a6a3ee79eeb335972a7ed80d6f297"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMjoxOTo0MVrOGpNwdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMjoxOTo0MVrOGpNwdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg3MDE5OQ==", "bodyText": "This won't work. It will only put 1 comment and the second will overwrite the first.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#discussion_r445870199", "createdAt": "2020-06-25T22:19:41Z", "author": {"login": "MikeDombo"}, "path": ".github/workflows/maven.yml", "diffHunk": "@@ -58,6 +60,24 @@ jobs:\n           show_branch: true\n           # Use class names instead of the filename\n           show_class_names: true\n+      - name: cobertura-report-integration-test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b127ed6497a6a3ee79eeb335972a7ed80d6f297"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "committedDate": "2020-06-25T22:31:03Z", "message": "Split coverage reports and checks for unit and integ tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b127ed6497a6a3ee79eeb335972a7ed80d6f297", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5b127ed6497a6a3ee79eeb335972a7ed80d6f297", "committedDate": "2020-06-25T22:11:51Z", "message": "Split coverage reports and checks for unit and integ tests"}, "afterCommit": {"oid": "5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5ffea4ff9326a92e82bf62d4fadac11dd1da64fd", "committedDate": "2020-06-25T22:31:03Z", "message": "Split coverage reports and checks for unit and integ tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTg4NTI2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#pullrequestreview-437988526", "createdAt": "2020-06-26T03:16:20Z", "commit": {"oid": "117eafa68eb76766c2213499d748031385239682"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTg4Njc0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#pullrequestreview-437988674", "createdAt": "2020-06-26T03:16:57Z", "commit": {"oid": "117eafa68eb76766c2213499d748031385239682"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMzoxNjo1N1rOGpSaug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMzoxNjo1N1rOGpSaug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk0NjU1NA==", "bodyText": "Why add complexity too? Should we just settle on a single metric like line, branch, or instruction?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#discussion_r445946554", "createdAt": "2020-06-26T03:16:57Z", "author": {"login": "MikeDombo"}, "path": "pom.xml", "diffHunk": "@@ -376,53 +376,80 @@\n                         </goals>\n                     </execution>\n                     <execution>\n-                        <id>merge-results</id>\n+                        <id>unit-test-report</id>\n                         <phase>verify</phase>\n                         <goals>\n-                            <goal>merge</goal>\n+                            <goal>report</goal>\n                         </goals>\n                         <configuration>\n-                            <fileSets>\n-                                <fileSet>\n-                                    <directory>${project.build.directory}</directory>\n-                                    <includes>\n-                                        <include>*.exec</include>\n-                                    </includes>\n-                                    <excludes>\n-                                        <exclude>aggregate.exec</exclude>\n-                                    </excludes>\n-                                </fileSet>\n-                            </fileSets>\n-                            <destFile>${project.build.directory}/aggregate.exec</destFile>\n+                            <dataFile>${project.build.directory}/jacoco.exec</dataFile>\n+                            <outputDirectory>target/jacoco-report</outputDirectory>\n                         </configuration>\n                     </execution>\n                     <execution>\n-                        <id>post-merge-report</id>\n+                        <id>integration-test-report</id>\n                         <phase>verify</phase>\n                         <goals>\n                             <goal>report</goal>\n                         </goals>\n                         <configuration>\n-                            <dataFile>${project.build.directory}/aggregate.exec</dataFile>\n-                            <outputDirectory>target/jacoco-report</outputDirectory>\n+                            <dataFile>${project.build.directory}/jacoco-it.exec</dataFile>\n+                            <outputDirectory>target/jacoco-report/jacoco-it</outputDirectory>\n                         </configuration>\n                     </execution>\n                     <execution>\n-                        <id>jacoco-check</id>\n+                        <id>jacoco-check-unit-test</id>\n                         <phase>verify</phase>\n                         <goals>\n                             <goal>check</goal>\n                         </goals>\n                         <configuration>\n-                            <dataFile>${project.build.directory}/aggregate.exec</dataFile>\n+                            <dataFile>${project.build.directory}/jacoco.exec</dataFile>\n                             <rules>\n                                 <rule>\n                                     <element>BUNDLE</element>\n                                     <limits>\n                                         <limit>\n                                             <counter>INSTRUCTION</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.81</minimum>\n+                                            <minimum>0.66</minimum>\n+                                        </limit>\n+                                        <limit>\n+                                            <counter>LINE</counter>\n+                                            <value>COVEREDRATIO</value>\n+                                            <minimum>0.67</minimum>\n+                                        </limit>\n+                                        <limit>\n+                                            <counter>BRANCH</counter>\n+                                            <value>COVEREDRATIO</value>\n+                                            <minimum>0.59</minimum>\n+                                        </limit>\n+                                    </limits>\n+                                </rule>\n+                            </rules>\n+                        </configuration>\n+                    </execution>\n+                    <execution>\n+                        <id>jacoco-check-integration-test</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>check</goal>\n+                        </goals>\n+                        <configuration>\n+                            <dataFile>${project.build.directory}/jacoco-it.exec</dataFile>\n+                            <rules>\n+                                <rule>\n+                                    <element>BUNDLE</element>\n+                                    <limits>\n+                                        <limit>\n+                                            <counter>INSTRUCTION</counter>\n+                                            <value>COVEREDRATIO</value>\n+                                            <minimum>0.58</minimum>\n+                                        </limit>\n+                                        <limit>\n+                                            <counter>COMPLEXITY</counter>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "117eafa68eb76766c2213499d748031385239682"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cc4be6c93d06036cc14f04282aad2575989990a", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4cc4be6c93d06036cc14f04282aad2575989990a", "committedDate": "2020-06-26T18:48:44Z", "message": "[testing-only] enhancements to reports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "117eafa68eb76766c2213499d748031385239682", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/117eafa68eb76766c2213499d748031385239682", "committedDate": "2020-06-26T02:34:21Z", "message": "[testing-only] enhancements to reports"}, "afterCommit": {"oid": "4cc4be6c93d06036cc14f04282aad2575989990a", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4cc4be6c93d06036cc14f04282aad2575989990a", "committedDate": "2020-06-26T18:48:44Z", "message": "[testing-only] enhancements to reports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTQ1NDc0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#pullrequestreview-438545474", "createdAt": "2020-06-26T19:31:37Z", "commit": {"oid": "4cc4be6c93d06036cc14f04282aad2575989990a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTk0Mzg5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/291#pullrequestreview-438594389", "createdAt": "2020-06-26T21:04:34Z", "commit": {"oid": "4cc4be6c93d06036cc14f04282aad2575989990a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2843, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}