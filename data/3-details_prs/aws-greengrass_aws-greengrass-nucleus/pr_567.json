{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MTc1NDM1", "number": 567, "title": "Suspend service lifecycle when config is being merged during deployment", "bodyText": "Issue #, if available:\nConfiguration is updated asynchronously on each node, this will cause services to re-start with partially updated config.\nSuspend lifecycle thread when config is being updated in deployment to solve the issue.\nHold getConfig() response when service calls getConfig() during configuration update.\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-23T19:32:51Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567", "merged": true, "mergeCommit": {"oid": "17dc42f44b798a0c07616106d950fff7defeff55"}, "closed": true, "closedAt": "2020-10-28T22:43:01Z", "author": {"login": "ShirleyZheng92"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVb1OWgFqTUxNTk1NDUzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXEaKAgH2gAyNTA5MTc1NDM1OmNlMzY0MmRmNzc3MGM0MjFjZGJhM2E3NjMxMGVlZTUzY2NhNDcyOGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1OTU0NTM0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-515954534", "createdAt": "2020-10-23T19:35:13Z", "commit": {"oid": "5636aa429838681c2833c8c0056e0925d9d454c1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5636aa429838681c2833c8c0056e0925d9d454c1", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5636aa429838681c2833c8c0056e0925d9d454c1", "committedDate": "2020-10-23T19:32:59Z", "message": "Merge branch 'master' into lifecycle_fix"}, "afterCommit": {"oid": "8859f82a4e23cbeee04f7f49feb1a5d36da1b555", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8859f82a4e23cbeee04f7f49feb1a5d36da1b555", "committedDate": "2020-10-23T19:53:03Z", "message": "Suspend lifecycle when config is being merged.\n\nSo that service won't be started with partially updated config."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8859f82a4e23cbeee04f7f49feb1a5d36da1b555", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8859f82a4e23cbeee04f7f49feb1a5d36da1b555", "committedDate": "2020-10-23T19:53:03Z", "message": "Suspend lifecycle when config is being merged.\n\nSo that service won't be started with partially updated config."}, "afterCommit": {"oid": "8f7aff7f1fec9a6c9ffe0216c5b7f6f731b31f9d", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8f7aff7f1fec9a6c9ffe0216c5b7f6f731b31f9d", "committedDate": "2020-10-23T19:58:43Z", "message": "Suspend lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nSuspend lifecycle thread when config is being updated in deployment,\nso that service won't be started with partially updated config."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f7aff7f1fec9a6c9ffe0216c5b7f6f731b31f9d", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8f7aff7f1fec9a6c9ffe0216c5b7f6f731b31f9d", "committedDate": "2020-10-23T19:58:43Z", "message": "Suspend lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nSuspend lifecycle thread when config is being updated in deployment,\nso that service won't be started with partially updated config."}, "afterCommit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4b4565f861032e082e2a2f5bad9335a2ab80b88b", "committedDate": "2020-10-23T20:33:41Z", "message": "Suspend lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nSuspend lifecycle thread when config is being updated in deployment,\nso that service won't be started with partially updated config."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDA2Mzc2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-516006376", "createdAt": "2020-10-23T20:57:57Z", "commit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDo1Nzo1OFrOHneQaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDo1Nzo1OFrOHneQaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MjIzNQ==", "bodyText": "Configuration currently updating, will wait for the update to complete", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#discussion_r511152235", "createdAt": "2020-10-23T20:57:58Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/builtin/services/configstore/ConfigStoreIPCAgent.java", "diffHunk": "@@ -184,6 +185,19 @@ public GetConfigurationResponse getConfig(GetConfigurationRequest request, Conne\n         log.atDebug().kv(CONTEXT_LOGGING_KEY, context).log(\"Config IPC get config request\");\n         String serviceName = request.getComponentName() == null ? context.getServiceName() : request.getComponentName();\n         Topics serviceTopics = kernel.findServiceTopic(serviceName);\n+        if (DeploymentService.CONFIG_UNDER_UPDATE.get()) {\n+            log.info(\"Config is under update. Wait until config updated\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDA2OTc3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-516006977", "createdAt": "2020-10-23T20:59:06Z", "commit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDo1OTowNlrOHneSKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDo1OTowNlrOHneSKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MjY4Mg==", "bodyText": "if interrupted, the thread should quit.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#discussion_r511152682", "createdAt": "2020-10-23T20:59:06Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/builtin/services/configstore/ConfigStoreIPCAgent.java", "diffHunk": "@@ -184,6 +185,19 @@ public GetConfigurationResponse getConfig(GetConfigurationRequest request, Conne\n         log.atDebug().kv(CONTEXT_LOGGING_KEY, context).log(\"Config IPC get config request\");\n         String serviceName = request.getComponentName() == null ? context.getServiceName() : request.getComponentName();\n         Topics serviceTopics = kernel.findServiceTopic(serviceName);\n+        if (DeploymentService.CONFIG_UNDER_UPDATE.get()) {\n+            log.info(\"Config is under update. Wait until config updated\");\n+            synchronized (DeploymentService.CONFIG_UPDATE_NOTIFIER) {\n+                while (DeploymentService.CONFIG_UNDER_UPDATE.get()) {\n+                    try {\n+                        DeploymentService.CONFIG_UPDATE_NOTIFIER.wait(5000);\n+                    } catch (InterruptedException e) {\n+                        continue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDA3NjUx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-516007651", "createdAt": "2020-10-23T21:00:25Z", "commit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMTowMDoyNVrOHneUNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMTowMDoyNVrOHneUNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MzIwNw==", "bodyText": "do you think it is possible to have a more general solution? We ran into an issue with lambda because the updateMap causes lots of update callbacks that run before all the changes have actually gone through, so we read partial data.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#discussion_r511153207", "createdAt": "2020-10-23T21:00:25Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/activator/DefaultActivator.java", "diffHunk": "@@ -72,11 +73,17 @@ public void activate(Map<String, Object> newConfig, Deployment deployment,\n         // when deployment adds a new dependency (component B) to component A\n         // the config for component B has to be merged in before externalDependenciesTopic of component A trigger\n         // executing mergeMap using publish thread ensures this\n-        kernel.getContext().runOnPublishQueueAndWait(() ->\n-                kernel.getConfig().updateMap(deploymentDocument.getTimestamp(), newConfig, DEPLOYMENT_MERGE_BEHAVIOR));\n+        kernel.getContext().runOnPublishQueueAndWait(() -> {\n+            DeploymentService.CONFIG_UNDER_UPDATE.set(true);\n+            kernel.getConfig().updateMap(deploymentDocument.getTimestamp(), newConfig, DEPLOYMENT_MERGE_BEHAVIOR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDA4MDA1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-516008005", "createdAt": "2020-10-23T21:01:07Z", "commit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMTowMTowN1rOHneVRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMTowMTowN1rOHneVRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE1MzQ3OQ==", "bodyText": "why only these states?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#discussion_r511153479", "createdAt": "2020-10-23T21:01:07Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/Lifecycle.java", "diffHunk": "@@ -281,6 +282,17 @@ private void startStateTransition() throws InterruptedException {\n             State current = getState();\n             logger.atDebug(\"service-state-transition-start\").log();\n \n+            // postpone start/install when configuration is under update.\n+            if ((current == State.NEW || current == State.INSTALLED) && DeploymentService.CONFIG_UNDER_UPDATE.get()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b4565f861032e082e2a2f5bad9335a2ab80b88b", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4b4565f861032e082e2a2f5bad9335a2ab80b88b", "committedDate": "2020-10-23T20:33:41Z", "message": "Suspend lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nSuspend lifecycle thread when config is being updated in deployment,\nso that service won't be started with partially updated config."}, "afterCommit": {"oid": "3b112e2d9cee0050b98880d69596e709e5d716d9", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3b112e2d9cee0050b98880d69596e709e5d716d9", "committedDate": "2020-10-23T21:16:05Z", "message": "Suspend service lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nPostponse installing/starting when config is being updated in deployment,\nso that service won't be started with partially updated config."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b112e2d9cee0050b98880d69596e709e5d716d9", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3b112e2d9cee0050b98880d69596e709e5d716d9", "committedDate": "2020-10-23T21:16:05Z", "message": "Suspend service lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nPostponse installing/starting when config is being updated in deployment,\nso that service won't be started with partially updated config."}, "afterCommit": {"oid": "17b5e3281ed70ff7011189d4ad384cf6aa8f2c9f", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/17b5e3281ed70ff7011189d4ad384cf6aa8f2c9f", "committedDate": "2020-10-23T21:38:26Z", "message": "Suspend service lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nPostponse installing/starting when config is being updated in deployment,\nso that service won't be started with partially updated config."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17b5e3281ed70ff7011189d4ad384cf6aa8f2c9f", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/17b5e3281ed70ff7011189d4ad384cf6aa8f2c9f", "committedDate": "2020-10-23T21:38:26Z", "message": "Suspend service lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nPostponse installing/starting when config is being updated in deployment,\nso that service won't be started with partially updated config."}, "afterCommit": {"oid": "82ba30ad9aecab880b554a249b86c6a194c093a5", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/82ba30ad9aecab880b554a249b86c6a194c093a5", "committedDate": "2020-10-23T23:51:54Z", "message": "Address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3d7267ee2e592434730e9e7263d11147e641a9a", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e3d7267ee2e592434730e9e7263d11147e641a9a", "committedDate": "2020-10-26T19:12:14Z", "message": "Merge branch 'master' into lifecycle_fix"}, "afterCommit": {"oid": "677f1aea155f986c5046d5a6e2d2df153c6ef369", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/677f1aea155f986c5046d5a6e2d2df153c6ef369", "committedDate": "2020-10-26T19:45:13Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MjY5NDc2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-517269476", "createdAt": "2020-10-27T00:34:23Z", "commit": {"oid": "7c891d96b259127d5793d05c248c944c6ecd6087"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMDozNDoyM1rOHonP0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMDozNDoyM1rOHonP0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM0ODExNA==", "bodyText": "it isn't clear to me that this is the right place to stop. The requests have already been added to the queue, shouldn't it prevent the requestRestart or whatever at that point instead of here when we are going to do the transition?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#discussion_r512348114", "createdAt": "2020-10-27T00:34:23Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/Lifecycle.java", "diffHunk": "@@ -281,6 +282,18 @@ private void startStateTransition() throws InterruptedException {\n             State current = getState();\n             logger.atDebug(\"service-state-transition-start\").log();\n \n+            Configuration kernelConfig = greengrassService.getContext().get(Configuration.class);\n+            // postpone start/install when configuration is under update.\n+            if ((current == State.NEW || current == State.INSTALLED) && kernelConfig.configUnderUpdate.get()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c891d96b259127d5793d05c248c944c6ecd6087"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MjczMDA4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-517273008", "createdAt": "2020-10-27T00:46:32Z", "commit": {"oid": "7c891d96b259127d5793d05c248c944c6ecd6087"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MjczMTA1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-517273105", "createdAt": "2020-10-27T00:46:51Z", "commit": {"oid": "7c891d96b259127d5793d05c248c944c6ecd6087"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c891d96b259127d5793d05c248c944c6ecd6087", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7c891d96b259127d5793d05c248c944c6ecd6087", "committedDate": "2020-10-26T23:32:55Z", "message": "Merge branch 'master' into lifecycle_fix"}, "afterCommit": {"oid": "7a9cf48d5bc23b1118bba8f720dc359a3dee6379", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7a9cf48d5bc23b1118bba8f720dc359a3dee6379", "committedDate": "2020-10-27T19:24:16Z", "message": "Suspend service lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nPostponse installing/starting when config is being updated in deployment,\nso that service won't be started with partially updated config."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MDc1NDIw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-518075420", "createdAt": "2020-10-27T19:33:22Z", "commit": {"oid": "7a9cf48d5bc23b1118bba8f720dc359a3dee6379"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjA4MDg4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-518208088", "createdAt": "2020-10-27T22:49:33Z", "commit": {"oid": "b09c7e9bbab79ff842569c71ac69c3fc0392bdf2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjo0OTozM1rOHpT0dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjo0OTozM1rOHpT0dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA3ODM5MQ==", "bodyText": "Why are these public?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#discussion_r513078391", "createdAt": "2020-10-27T22:49:33Z", "author": {"login": "shaguptashaikh"}, "path": "src/main/java/com/aws/greengrass/config/Configuration.java", "diffHunk": "@@ -23,13 +23,17 @@\n import java.nio.file.Paths;\n import java.util.Map;\n import java.util.Objects;\n+import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.function.Consumer;\n import javax.annotation.Nullable;\n import javax.inject.Inject;\n \n import static com.aws.greengrass.util.Utils.extension;\n \n public class Configuration {\n+    public final AtomicBoolean configUnderUpdate = new AtomicBoolean(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b09c7e9bbab79ff842569c71ac69c3fc0392bdf2"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27497fecff6bf8c6625101f6587b76212c6dd441", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/27497fecff6bf8c6625101f6587b76212c6dd441", "committedDate": "2020-10-27T23:58:46Z", "message": "Suspend service lifecycle when config is being merged.\n\nConfiguration is updated asynchronously on each node, this will cause services to start with old config.\nPostponse installing/starting when config is being updated in deployment,\nso that service won't be started with partially updated config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33c50de767cdff5061875e30ecfe75b56a96ab71", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/33c50de767cdff5061875e30ecfe75b56a96ab71", "committedDate": "2020-10-28T00:09:08Z", "message": "Address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b09c7e9bbab79ff842569c71ac69c3fc0392bdf2", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b09c7e9bbab79ff842569c71ac69c3fc0392bdf2", "committedDate": "2020-10-27T21:51:03Z", "message": "Merge branch 'master' into lifecycle_fix"}, "afterCommit": {"oid": "33c50de767cdff5061875e30ecfe75b56a96ab71", "author": {"user": null}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/33c50de767cdff5061875e30ecfe75b56a96ab71", "committedDate": "2020-10-28T00:09:08Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjM5MjEy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-518239212", "createdAt": "2020-10-28T00:12:50Z", "commit": {"oid": "33c50de767cdff5061875e30ecfe75b56a96ab71"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjQ4ODMy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/567#pullrequestreview-518248832", "createdAt": "2020-10-28T00:43:03Z", "commit": {"oid": "33c50de767cdff5061875e30ecfe75b56a96ab71"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "442fc8d2731ee9a735283b2e55feac99ce286fdc", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/442fc8d2731ee9a735283b2e55feac99ce286fdc", "committedDate": "2020-10-28T00:46:20Z", "message": "Merge branch 'master' into lifecycle_fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd5b9d624752f644e92e71b05a1f7e3f055a84b", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9dd5b9d624752f644e92e71b05a1f7e3f055a84b", "committedDate": "2020-10-28T17:11:30Z", "message": "Merge branch 'master' into lifecycle_fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4abb84a1b6dd59f9e4e2e87709a508c6e4be135e", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4abb84a1b6dd59f9e4e2e87709a508c6e4be135e", "committedDate": "2020-10-28T20:22:15Z", "message": "Merge branch 'master' into lifecycle_fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce3642df7770c421cdba3a76310eee53cca4728b", "author": {"user": {"login": "ShirleyZheng92", "name": "Xueli Zheng "}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ce3642df7770c421cdba3a76310eee53cca4728b", "committedDate": "2020-10-28T21:25:41Z", "message": "Merge branch 'master' into lifecycle_fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2828, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}