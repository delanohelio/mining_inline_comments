{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MTc0Mjc0", "number": 147, "title": "Launch parameter", "bodyText": "Description of changes:\nClean up launch parameter parsing.  Make default root directory be an invisible subdirectory of $HOME, instead of $HOME itself (makes it easier to clean up and tell what files do or do not come from Evergreen).  Re-instate -r command line switch.\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-04-01T18:57:19Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147", "merged": true, "mergeCommit": {"oid": "7aa7b95a8d03cd974b7c9963bb561a64dca88013"}, "closed": true, "closedAt": "2020-04-01T23:01:11Z", "author": {"login": "JamesGosling"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTK-v_AH2gAyMzk3MTc0Mjc0OjQ2M2FmMzlkYzFjZTU2MTU5YWVmMDc1ZmY4NDI4NDgzOTA3OTA3NmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTdRfuAFqTM4NTg5Njg2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "463af39dc1ce56159aef075ff84284839079076b", "author": {"user": {"login": "JamesGosling", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/463af39dc1ce56159aef075ff84284839079076b", "committedDate": "2020-03-31T22:38:14Z", "message": "Update parameter parsing to default root to a subdirectory of ~, and\nre-enable the -r switch."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e045a1b6571044221f2ea2fb8caf3fc0f5f4e1d4", "author": {"user": {"login": "JamesGosling", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e045a1b6571044221f2ea2fb8caf3fc0f5f4e1d4", "committedDate": "2020-04-01T18:50:04Z", "message": "Update parameter parsing to default root to a subdirectory of ~, and\nre-enable the -r switch."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1ODY2NjEz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#pullrequestreview-385866613", "createdAt": "2020-04-01T19:01:33Z", "commit": {"oid": "e045a1b6571044221f2ea2fb8caf3fc0f5f4e1d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efe22d08b91fb77111aef6c3976127a0ced1cf22", "author": {"user": {"login": "JamesGosling", "name": null}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/efe22d08b91fb77111aef6c3976127a0ced1cf22", "committedDate": "2020-04-01T19:26:00Z", "message": "Merge branch 'master' into launchParameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1ODk2ODY4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#pullrequestreview-385896868", "createdAt": "2020-04-01T19:46:18Z", "commit": {"oid": "efe22d08b91fb77111aef6c3976127a0ced1cf22"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOTo0NjoxOFrOF_P_ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOTo1NjozN1rOF_QV_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg2NjU5Nw==", "bodyText": "better than (String) topic.getOnce()...", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#discussion_r401866597", "createdAt": "2020-04-01T19:46:18Z", "author": {"login": "leaf94"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -161,12 +155,26 @@ public Kernel parseArgs(String... args) {\n                 case \"-print\":\n                     writeConfig(new OutputStreamWriter(System.out, StandardCharsets.UTF_8));\n                     break;\n+                case \"-root\":\n+                case \"-r\":\n+                    rootAbsolutePath = getArg();\n+                    break;\n                 default:\n                     logger.atError().log(\"Undefined command line argument: {}\", arg);\n                     broken = true;\n                     break;\n             }\n         }\n+        if (Utils.isEmpty(rootAbsolutePath)) {\n+            rootAbsolutePath = \"~/.evergreen\";  // Default to hidden subdirectory of home.\n+        }\n+        rootAbsolutePath = deTilde(rootAbsolutePath);\n+        if (!ensureCreated(Paths.get(rootAbsolutePath))) {\n+            logger.atError().log(\"{}: not a valid root directory\", rootAbsolutePath);\n+            broken = true;\n+        }\n+        lookup(\"system\", \"rootpath\").dflt(rootAbsolutePath)\n+                .subscribe((whatHappened, topic) -> initPaths(Coerce.toString(topic)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe22d08b91fb77111aef6c3976127a0ced1cf22"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg3MjM4Mg==", "bodyText": "I guess new assignment of rootAbsolutePath  cannot be applied to the logging store for now, given how log4j initialized the file appender.\nBut we probably want to change that entirely and to re-instate the log queue, which would solve that from the source of evil (Sorry log4j...).", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/147#discussion_r401872382", "createdAt": "2020-04-01T19:56:37Z", "author": {"login": "leaf94"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Kernel.java", "diffHunk": "@@ -161,12 +155,26 @@ public Kernel parseArgs(String... args) {\n                 case \"-print\":\n                     writeConfig(new OutputStreamWriter(System.out, StandardCharsets.UTF_8));\n                     break;\n+                case \"-root\":\n+                case \"-r\":\n+                    rootAbsolutePath = getArg();\n+                    break;\n                 default:\n                     logger.atError().log(\"Undefined command line argument: {}\", arg);\n                     broken = true;\n                     break;\n             }\n         }\n+        if (Utils.isEmpty(rootAbsolutePath)) {\n+            rootAbsolutePath = \"~/.evergreen\";  // Default to hidden subdirectory of home.\n+        }\n+        rootAbsolutePath = deTilde(rootAbsolutePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe22d08b91fb77111aef6c3976127a0ced1cf22"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2395, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}