{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4OTUxMzcy", "number": 447, "title": "Correctly unwrap errors which are wrapped due to MQTT proxy + Fix multiple subscription", "bodyText": "Issue #, if available:\nDescription of changes:\nThis does not fix the error that I talked about in the chatroom, however it unwraps exceptions which can help us be more intelligent in how the retries are implemented when that happens. Also fixes duplicate subscriptions to Jobs.\nWhy is this change necessary:\nOur MqttClient class does not return futures for subscribe, instead it runs that as synchronous. The IotJobsClient uses a WrapperMqttClientConnection which wraps the synchronous calls in a future. This causes the future to resolve with an ExecutionException even though the real error may be a timeoutexception or an interruptedexception. Therefore, this change unwraps the cause to rethrow the real exception.\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-17T21:53:28Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/447", "merged": true, "mergeCommit": {"oid": "408808dd82b8e4fce2360f397d2847f6bc8865d4"}, "closed": true, "closedAt": "2020-09-21T20:04:03Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKOdnlABqjM3ODQ1NDYzNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLJC-kAFqTQ5MjkzODcyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f847d4fd8bd523fb71c6c479108f8f948424c8f", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6f847d4fd8bd523fb71c6c479108f8f948424c8f", "committedDate": "2020-09-17T22:30:15Z", "message": "Merge branch 'master' into dep"}, "afterCommit": {"oid": "4cdf8bc8f671bfed0215ab586774c6f48a8fa756", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4cdf8bc8f671bfed0215ab586774c6f48a8fa756", "committedDate": "2020-09-18T23:46:13Z", "message": "Correctly unwrap errors which are wrapped due to MQTT proxy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b19b48c96276a441b697c95ff4f27b61ba07c18a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b19b48c96276a441b697c95ff4f27b61ba07c18a", "committedDate": "2020-09-21T18:06:52Z", "message": "Correctly unwrap errors which are wrapped due to MQTT proxy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33fd5d90e80a31c9258ea046b45a0f943652af45", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/33fd5d90e80a31c9258ea046b45a0f943652af45", "committedDate": "2020-09-21T18:07:14Z", "message": "Use topics instead of map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65760aa6cfa41752184af239cdf6ddd045364733", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/65760aa6cfa41752184af239cdf6ddd045364733", "committedDate": "2020-09-21T18:07:17Z", "message": "Do not resubscribe as MQTT client already does this"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4cdf8bc8f671bfed0215ab586774c6f48a8fa756", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4cdf8bc8f671bfed0215ab586774c6f48a8fa756", "committedDate": "2020-09-18T23:46:13Z", "message": "Correctly unwrap errors which are wrapped due to MQTT proxy"}, "afterCommit": {"oid": "fa8f4062b8eaac240fd200d3dfd0422789d10051", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fa8f4062b8eaac240fd200d3dfd0422789d10051", "committedDate": "2020-09-21T18:07:23Z", "message": "Revert \"Use topics instead of map\"\n\nThis reverts commit 4ca2deb6dd79069bd4ac7fd01cbe5620c29f1e4c."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1", "committedDate": "2020-09-21T18:17:14Z", "message": "Revert \"Use topics instead of map\"\n\nThis reverts commit 4ca2deb6dd79069bd4ac7fd01cbe5620c29f1e4c."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa8f4062b8eaac240fd200d3dfd0422789d10051", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fa8f4062b8eaac240fd200d3dfd0422789d10051", "committedDate": "2020-09-21T18:07:23Z", "message": "Revert \"Use topics instead of map\"\n\nThis reverts commit 4ca2deb6dd79069bd4ac7fd01cbe5620c29f1e4c."}, "afterCommit": {"oid": "f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1", "committedDate": "2020-09-21T18:17:14Z", "message": "Revert \"Use topics instead of map\"\n\nThis reverts commit 4ca2deb6dd79069bd4ac7fd01cbe5620c29f1e4c."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyOTEzMTc2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/447#pullrequestreview-492913176", "createdAt": "2020-09-21T19:23:55Z", "commit": {"oid": "f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxOToyMzo1NVrOHVfN-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxOToyMzo1NVrOHVfN-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI5MzYyNQ==", "bodyText": "Does it matter that this catch clause is before L363?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/447#discussion_r492293625", "createdAt": "2020-09-21T19:23:55Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/deployment/IotJobsHelper.java", "diffHunk": "@@ -356,7 +356,13 @@ public void updateJobStatus(String jobId, JobStatus status, HashMap<String, Stri\n         try {\n             iotJobsClient.PublishUpdateJobExecution(updateJobRequest, QualityOfService.AT_LEAST_ONCE).get();\n         } catch (ExecutionException e) {\n-            gotResponse.completeExceptionally(e.getCause());\n+            try {\n+                unwrapExecutionException(e);\n+            } catch (ExecutionException e1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyOTI2MzEz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/447#pullrequestreview-492926313", "createdAt": "2020-09-21T19:44:01Z", "commit": {"oid": "f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyOTM4NzI5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/447#pullrequestreview-492938729", "createdAt": "2020-09-21T20:02:48Z", "commit": {"oid": "f1666183d1cb54aa2afbc1ffd8eb711af1ffb8f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2971, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}