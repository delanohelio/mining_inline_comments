{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzODM1NjQ1", "number": 602, "title": "Log newly added Topics in the tlog, even if no leaf nodes", "bodyText": "Issue #, if available:\nDescription of changes:\nTLog currently doesn't log when Topics are created without any Topic leaf nodes. This change modifies that behavior so that it is logged out so that we can fully recreate the in-memory config (which supports this behavior or empty maps).\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-02T06:50:41Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/602", "merged": true, "mergeCommit": {"oid": "abe3a58e7deb755760ae7f93f9fe8a346eac9474"}, "closed": true, "closedAt": "2020-11-02T20:03:25Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYfAgvAFqTUyMTM2ODQwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYqLsOAFqTUyMTk0MjQ4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMzY4NDA3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/602#pullrequestreview-521368407", "createdAt": "2020-11-02T06:59:02Z", "commit": {"oid": "6999934643672da00ec47cf43e60109e3638da42"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6999934643672da00ec47cf43e60109e3638da42", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6999934643672da00ec47cf43e60109e3638da42", "committedDate": "2020-11-02T06:50:14Z", "message": "Log newly added Topics in the tlog, even if no leaf nodes"}, "afterCommit": {"oid": "f915cd7e13a5dcc7910242cd3faec77f6880f2ef", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f915cd7e13a5dcc7910242cd3faec77f6880f2ef", "committedDate": "2020-11-02T07:24:13Z", "message": "Log newly added Topics in the tlog, even if no leaf nodes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f915cd7e13a5dcc7910242cd3faec77f6880f2ef", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f915cd7e13a5dcc7910242cd3faec77f6880f2ef", "committedDate": "2020-11-02T07:24:13Z", "message": "Log newly added Topics in the tlog, even if no leaf nodes"}, "afterCommit": {"oid": "05d2787fef04695fbdd0f973e880ca589899e264", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/05d2787fef04695fbdd0f973e880ca589899e264", "committedDate": "2020-11-02T16:03:36Z", "message": "Log newly added Topics in the tlog, even if no leaf nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30caf4b10f12b557273e967da11ff2a5e82c3a81", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/30caf4b10f12b557273e967da11ff2a5e82c3a81", "committedDate": "2020-11-02T16:11:43Z", "message": "Log newly added Topics in the tlog, even if no leaf nodes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05d2787fef04695fbdd0f973e880ca589899e264", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/05d2787fef04695fbdd0f973e880ca589899e264", "committedDate": "2020-11-02T16:03:36Z", "message": "Log newly added Topics in the tlog, even if no leaf nodes"}, "afterCommit": {"oid": "30caf4b10f12b557273e967da11ff2a5e82c3a81", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/30caf4b10f12b557273e967da11ff2a5e82c3a81", "committedDate": "2020-11-02T16:11:43Z", "message": "Log newly added Topics in the tlog, even if no leaf nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666027c419aa5ceecd004a9526b3ad59f527b6ca", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/666027c419aa5ceecd004a9526b3ad59f527b6ca", "committedDate": "2020-11-02T16:44:34Z", "message": "Merge branch 'master' into tlog-empty-maps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "898c166160455f27889e4c634551fb466b591738", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/898c166160455f27889e4c634551fb466b591738", "committedDate": "2020-11-02T17:41:24Z", "message": "Merge branch 'master' into tlog-empty-maps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODYzNjk2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/602#pullrequestreview-521863696", "createdAt": "2020-11-02T17:49:18Z", "commit": {"oid": "898c166160455f27889e4c634551fb466b591738"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0OToxOFrOHsPbiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0OToxOFrOHsPbiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE1MjIwMQ==", "bodyText": "Typo?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/602#discussion_r516152201", "createdAt": "2020-11-02T17:49:18Z", "author": {"login": "hui-yang"}, "path": "src/test/resources/com/aws/greengrass/config/test.tlog", "diffHunk": "@@ -16,5 +16,5 @@\n {\"TS\":1588872928102,\"TP\":[\"services\",\"_AUTH_TOKENS\",\"FakeToken\"],\"W\":\"changed\",\"V\":\"main\"}\n {\"TS\":1588872930080,\"TP\":[\"services\",\"_AUTH_TOKENS\",\"FakeToken2\"],\"W\":\"changed\",\"V\":\"YellowSignal\"}\n {\"TS\":1588872931120,\"TP\":[\"services\",\"YellowSignal\",\"notMerged\",\"testTopic\"],\"W\":\"changed\",\"V\":\"TLogValue\"}\n-{\"TS\":1588872931120,\"TP\":[\"services\",\"YellowSignal\",\"lifecycle\",\"shutdown\"],\"W\":\"removed\"}\n+{\"TS\":15888729311200,\"TP\":[\"services\",\"YellowSignal\",\"lifecycle\",\"shutdown\"],\"W\":\"removed\"}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "898c166160455f27889e4c634551fb466b591738"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98ada6581f9e544d508e342937924a8251768529", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/98ada6581f9e544d508e342937924a8251768529", "committedDate": "2020-11-02T18:28:55Z", "message": "TLog save null values too"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b2aa7353b34287f35fac02a3d374c030296e531", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9b2aa7353b34287f35fac02a3d374c030296e531", "committedDate": "2020-11-02T18:03:31Z", "message": "TLog save null values too"}, "afterCommit": {"oid": "98ada6581f9e544d508e342937924a8251768529", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/98ada6581f9e544d508e342937924a8251768529", "committedDate": "2020-11-02T18:28:55Z", "message": "TLog save null values too"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTE4NzYx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/602#pullrequestreview-521918761", "createdAt": "2020-11-02T19:08:46Z", "commit": {"oid": "98ada6581f9e544d508e342937924a8251768529"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTQyNDgy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/602#pullrequestreview-521942482", "createdAt": "2020-11-02T19:45:45Z", "commit": {"oid": "98ada6581f9e544d508e342937924a8251768529"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxOTo0NTo0NlrOHsTNeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxOTo0NTo0NlrOHsTNeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIxNDEzNw==", "bodyText": "config.lookup(\"j\", \"k\", \"l\"); is another way a null-valued node can be (implicitly) created. But it is fine because createLeafChild will still notify it.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/602#discussion_r516214137", "createdAt": "2020-11-02T19:45:46Z", "author": {"login": "tilo-chen"}, "path": "src/test/java/com/aws/greengrass/config/ConfigurationWriterTest.java", "diffHunk": "@@ -57,12 +58,20 @@ void GIVEN_config_with_configuration_writer_WHEN_config_changes_made_THEN_writte\n             config.lookup(\"a.x\", \"b\", \"c.f\", \"d\", \"e\").withValue(\"New Val\");\n             // Create another Topic and use yet another data type (list)\n             config.lookup(\"a.x\", \"b\", \"c.f\", \"d\", \"e3\").withValue(Arrays.asList(\"1\", \"2\", \"3\"));\n-            context.runOnPublishQueueAndWait(() -> {\n-            });\n+            // Create null-valued node\n+            config.lookup(\"a.x\", \"b\", \"c.f\", \"d\", \"e5\").withValue((String) null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98ada6581f9e544d508e342937924a8251768529"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2891, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}