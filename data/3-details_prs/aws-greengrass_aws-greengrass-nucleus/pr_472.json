{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNzM1ODEy", "number": 472, "title": "Set Group name along with deployment ID.", "bodyText": "Issue #, if available:\nDescription of changes:\nStore the group name along with the deployment ID for the components.\nWhy is this change necessary:\nNeed to store the information to get all the groups a component is associated with.\nHow was this change tested:\nUnit tests.\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-24T22:42:13Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472", "merged": true, "mergeCommit": {"oid": "bbd1bea65b6496ddee6d75f4ec5749bbfd5959c6"}, "closed": true, "closedAt": "2020-09-29T17:58:06Z", "author": {"login": "nikkhilmuthye"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMJFE4gH2gAyNDkyNzM1ODEyOmFiNmU2NGMyZTRhMzc4NTJhNGFlMmFhZGIwN2RlNzAzNjliOGRlNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNsBzzgFqTQ5ODc0MTMwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab6e64c2e4a37852a4ae2aadb07de70369b8de51", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ab6e64c2e4a37852a4ae2aadb07de70369b8de51", "committedDate": "2020-09-24T22:39:01Z", "message": "Set Group name along with dpeloyment ID."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDcwNDQx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#pullrequestreview-496070441", "createdAt": "2020-09-25T02:30:52Z", "commit": {"oid": "ab6e64c2e4a37852a4ae2aadb07de70369b8de51"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMjozMDo1MlrOHXy1Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMjo1MDozOVrOHXzJpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDcxMjA5OA==", "bodyText": "Curious, where is deploymentGroupToRootPackages used?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#discussion_r494712098", "createdAt": "2020-09-25T02:30:52Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -243,6 +245,8 @@ private void finishCurrentDeployment() throws InterruptedException {\n                             pkgDetails.put(GROUP_TO_ROOT_COMPONENTS_VERSION_KEY, pkgConfig.getResolvedVersion());\n                             pkgDetails.put(GROUP_TO_ROOT_COMPONENTS_GROUP_CONFIG_ARN,\n                                     deploymentDocument.getDeploymentId());\n+                            pkgDetails.put(GROUP_TO_ROOT_COMPONENTS_GROUP_NAME,\n+                                    deploymentDocument.getGroupName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab6e64c2e4a37852a4ae2aadb07de70369b8de51"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDcxNzM0OA==", "bodyText": "NIT: can you add a comment of what's the structure under componentsToGroupsTopics ?\ncomponentsToGroupsTopics:\n  <componentName>:\n    <deploymentConfigArn>: <groupName>", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#discussion_r494717348", "createdAt": "2020-09-25T02:50:39Z", "author": {"login": "ShirleyZheng92"}, "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -460,9 +464,12 @@ private void setComponentsToGroupsMapping(Topics groupsToRootComponents) {\n             Topic groupConfigTopic = componentTopics.lookup(GROUP_TO_ROOT_COMPONENTS_GROUP_CONFIG_ARN);\n             String groupConfig = Coerce.toString(groupConfigTopic);\n \n+            Topic groupNameTopic = componentTopics.lookup(GROUP_TO_ROOT_COMPONENTS_GROUP_NAME);\n+            String groupName = Coerce.toString(groupNameTopic);\n+\n             Map<String, Object> groupDeploymentIdSet = (Map<String, Object>) componentsToGroupsMappingCache\n                     .getOrDefault(componentTopics.getName(), new HashMap<>());\n-            groupDeploymentIdSet.putIfAbsent(groupConfig, true);\n+            groupDeploymentIdSet.putIfAbsent(groupConfig, groupName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab6e64c2e4a37852a4ae2aadb07de70369b8de51"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683ee6dce56ac4580ee449e434e55f6252b07be4", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/683ee6dce56ac4580ee449e434e55f6252b07be4", "committedDate": "2020-09-25T04:06:27Z", "message": "Address PR comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e20a7f4b0fc9341497d2c74fe8fe1968b7b591c5", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e20a7f4b0fc9341497d2c74fe8fe1968b7b591c5", "committedDate": "2020-09-25T15:26:11Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ceba704f76dbe402b05f08c8de79c15e9be9159", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2ceba704f76dbe402b05f08c8de79c15e9be9159", "committedDate": "2020-09-25T16:23:01Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTcxODA2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#pullrequestreview-496571806", "createdAt": "2020-09-25T16:27:29Z", "commit": {"oid": "2ceba704f76dbe402b05f08c8de79c15e9be9159"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoyNzoyOVrOHYKhUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoyNzoyOVrOHYKhUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEwMDI0MQ==", "bodyText": "use our own utils. Utils.isEmpty", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#discussion_r495100241", "createdAt": "2020-09-25T16:27:29Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeploymentService.java", "diffHunk": "@@ -502,14 +517,19 @@ private void setComponentsToGroupsMapping(Topics groupsToRootComponents) {\n      * @param componentName The name of the component.\n      * @return The list of groups the component is a part of.\n      */\n-    public Set<String> getGroupConfigsForUserComponent(String componentName) {\n+    public Set<String> getGroupNamesForUserComponent(String componentName) {\n         Topics componentsToGroupsTopics = config.lookupTopics(COMPONENTS_TO_GROUPS_TOPICS);\n \n         Set<String> componentGroups = new HashSet<>();\n         if (componentsToGroupsTopics != null) {\n             Topics groupsTopics = componentsToGroupsTopics.lookupTopics(componentName);\n-            groupsTopics.children.values().stream().map(n -> (Topic) n).map(Topic::getName)\n-                    .forEach(componentGroups::add);\n+            groupsTopics.children.values().stream().map(n -> (Topic) n)\n+                    .forEach(topic -> {\n+                        String groupName = Coerce.toString(topic);\n+                        if (!StringUtils.isNullOrEmpty(groupName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ceba704f76dbe402b05f08c8de79c15e9be9159"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd2c044c437e0cf83c56ab63dcc86fbfcba5c4b6", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bd2c044c437e0cf83c56ab63dcc86fbfcba5c4b6", "committedDate": "2020-09-25T16:50:19Z", "message": "Use Utils.isEmpty."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NjAwNTIx", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#pullrequestreview-496600521", "createdAt": "2020-09-25T17:09:17Z", "commit": {"oid": "bd2c044c437e0cf83c56ab63dcc86fbfcba5c4b6"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a6d75eb4f22341fe1ff5d2a21eb99f1fe0c71b7", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3a6d75eb4f22341fe1ff5d2a21eb99f1fe0c71b7", "committedDate": "2020-09-25T18:46:16Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c02e3dde2a42dba1e32339878bf28f170d77dce5", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c02e3dde2a42dba1e32339878bf28f170d77dce5", "committedDate": "2020-09-25T19:55:23Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2ODc0NzU0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#pullrequestreview-496874754", "createdAt": "2020-09-25T21:28:44Z", "commit": {"oid": "c02e3dde2a42dba1e32339878bf28f170d77dce5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62368b1da481e2fa79b9093d0a3d171bdb779850", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/62368b1da481e2fa79b9093d0a3d171bdb779850", "committedDate": "2020-09-26T14:47:37Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77caa7e87c17dccf92fd56024cf5761ce82be119", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/77caa7e87c17dccf92fd56024cf5761ce82be119", "committedDate": "2020-09-26T18:28:59Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dad06e6a35ff19718e0fa2714e221cc6d957654", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9dad06e6a35ff19718e0fa2714e221cc6d957654", "committedDate": "2020-09-28T15:22:23Z", "message": "Add test change to increase converage."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d57109e293e754ddae949b4335025c419963a084", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d57109e293e754ddae949b4335025c419963a084", "committedDate": "2020-09-28T19:16:25Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1efb791aca685ac0e4cb711f9c7fc3ef31c4180b", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1efb791aca685ac0e4cb711f9c7fc3ef31c4180b", "committedDate": "2020-09-28T20:32:55Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4168773fb52dffbeca201de689a9e233f4db85c", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c4168773fb52dffbeca201de689a9e233f4db85c", "committedDate": "2020-09-28T23:23:04Z", "message": "Merge branch 'master' into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "186a10760c76f673ad660d5388b5a37c2ec9f30b", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/186a10760c76f673ad660d5388b5a37c2ec9f30b", "committedDate": "2020-09-29T15:40:04Z", "message": "Add proper message to check why test is flaky."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f35cd40c11a15355aba2073f09b1e919182c3d09", "author": {"user": {"login": "nikkhilmuthye", "name": "Nikkhil Muthye"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f35cd40c11a15355aba2073f09b1e919182c3d09", "committedDate": "2020-09-29T15:40:35Z", "message": "Merge branch 'setGroupNameWithDeploymentId' of github.com:aws/aws-greengrass-kernel into setGroupNameWithDeploymentId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NzM1OTY1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#pullrequestreview-498735965", "createdAt": "2020-09-29T17:49:09Z", "commit": {"oid": "f35cd40c11a15355aba2073f09b1e919182c3d09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NzQxMzAy", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/472#pullrequestreview-498741302", "createdAt": "2020-09-29T17:56:03Z", "commit": {"oid": "f35cd40c11a15355aba2073f09b1e919182c3d09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3026, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}