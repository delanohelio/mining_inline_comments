{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMzQ4NTk2", "number": 677, "title": "Setup script further changes", "bodyText": "Issue #, if available:\nMore changes are needed to correct requires vs optional params, defaults, help text, fix for creating ggc_user and gg_group if no arg is given but only if the user not present in any of the config files, fix for help and version options not exiting etc\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-11-13T05:39:25Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677", "merged": true, "mergeCommit": {"oid": "55662211cf2ba0c32052f66ece5f7b1a67d94b7b"}, "closed": true, "closedAt": "2020-11-13T20:55:15Z", "author": {"login": "shaguptashaikh"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcAj0HAFqTUyOTc1MDQ4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcNN_rAH2gAyNTIwMzQ4NTk2OjAzY2Y4YjAxNjI1OWQwM2E1ZGI5OThiYTczNTZmZDBhYjI3OTJmMWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NzUwNDg2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#pullrequestreview-529750486", "createdAt": "2020-11-13T05:43:21Z", "commit": {"oid": "e3192ba23e0657f2004c07d77123127bda8a354f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwNTo0MzoyMVrOHydGFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwNTo0NToyOFrOHydIWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzU0Mw==", "bodyText": "we can probably get rid of this (or at least don't print it in the help)", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#discussion_r522667543", "createdAt": "2020-11-13T05:43:21Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/easysetup/GreengrassSetup.java", "diffHunk": "@@ -35,43 +37,77 @@\n  * Easy setup for getting started with Greengrass kernel on a device.\n  */\n public class GreengrassSetup {\n-    // GG_REL_BLOCKER: TODO: [P41215451]: Review with tech writer prior to launch (including TES)\n     private static final String SHOW_HELP_RESPONSE = \"DESCRIPTION\\n\"\n-            + \"\\tInstall Greengrass kernel on your device, register the device as IoT thing,\\n\"\n-            + \"\\tcreate certificates and attach role for TES to them, install the Greengrass\\n\"\n-            + \"\\tdevice CLI. Please set the AWS credentials in the environment variables\\n\"\n+            + \"\\tInstall the Greengrass Nucleus, (optional) install local development tools, and (optional)\\n\"\n+            + \"\\tregister your device as an AWS IoT thing. This creates device certificates, attaches a role\\n\"\n+            + \"\\tto use the AWS IoT credentials provider, and creates a role that provides AWS credentials.\\n\"\n             + \"\\n\"\n             + \"OPTIONS\\n\"\n-            + \"\\t--config, -i\\t\\t\\tPath to the configuration file to start Greengrass kernel with\\n\"\n-            + \"\\t--root, -r\\t\\t\\tPath to the directory to use as the root for Greengrass\\n\"\n-            + \"\\t--thing-name, -tn\\t\\tDesired thing name to register the device with in AWS IoT cloud\\n\"\n-            + \"\\t--thing-group-name, -tgn\\tDesired thing group to add the IoT Thing into\\n\"\n-            + \"\\t\u2014tes-role-name, -trn\\t\\tName of the IAM role to use for \"\n-            + TokenExchangeService.TOKEN_EXCHANGE_SERVICE_TOPICS\n-            + \"\\n\\t\\t\\t\\t\\tdevice to talk to AWS services, the default is GreengrassV2TokenExchangeRole.\\n\"\n-            + \"\\t\\t\\t\\t\\tIf the role does not exist in your account it will be created with a default policy\\n\"\n-            + \"\\t\\t\\t\\t\\tcalled GreengrassV2TokenExchangeRoleAccess, by default it DOES NOT have access\\n\"\n-            + \"\\t\\t\\t\\t\\tto your S3 buckets where you will host your private component artifacts, so you need\\n\"\n-            + \"\\t\\t\\t\\t\\tto add your component artifact S3 buckets/objects to that role in your AWS account.\\n\"\n-            + \"\\t--tes-role-alias-name, -tra\\tName of the RoleAlias to attach to the IAM role for\\n\"\n-            + \"\\t\\t\\t\\t\\t\"\n-            + TokenExchangeService.TOKEN_EXCHANGE_SERVICE_TOPICS\n-            + \"in the AWS IoT cloud if the role\\n\"\n-            + \"\\t\\t\\t\\t\\talias does not exist then it will be created in your AWS account\\n\"\n-            + \"\\t--provision, -p\\t\\t\\t/N Indicate if you want to register the device as an AWS IoT thing\\n\"\n-            + \"\\t--aws-region, -ar\\t\\tAWS region where the resources should be looked for/created\\n\"\n-            + \"\\t\\t\\t\\t\\tCorresponding Iot environment stage will be used.\\n\"\n-            + \"\\t--setup-system-service, -ss\\tY/N Indicate if you want to setup Greengrass as a system service\\n\"\n-            + \"\\t--component-default-user, -u\\tName of the default user that will be used to run component services\\n\"\n-            + (Exec.isWindows ? \"\" : \"\\t\\t\\t\\t\\tYou can use the following formats. If specifying a UID or GID, you must\"\n-            + \" specify it as a positive integer.\\n\"\n-            + \"\\t\\t\\t\\t\\tuser\\n\"\n-            + \"\\t\\t\\t\\t\\tuser:group\\n\"\n-            + \"\\t\\t\\t\\t\\tuid\\n\"\n-            + \"\\t\\t\\t\\t\\tuid:gid\\n\"\n-            + \"\\t\\t\\t\\t\\tuser:gid\\n\"\n-            + \"\\t\\t\\t\\t\\tuid:group\\n\"\n-            + \"\\n\\t\\t\\t\\t\\tIf a group is not specified the primary group of the user will be used.\\n\");\n+            + \"\\t--help, -h\\t\\t\\t(Optional) Show this help information and then exit.\\n\"\n+            + \"\\t--version\\t\\t\\t(Optional) Show the version of the AWS IoT Greengrass Core software, and then exit.\\n\"\n+            + \"\\t--aws-region, -ar\\t\\t\\tThe AWS Region to use. The AWS IoT Greengrass Core software uses this Region\\n\"\n+            + \"\\t\\t\\t\\t\\t to retrieve or create the AWS resources that it requires\\n\"\n+            + \"\\t--root, -r\\t\\t\\t(Optional) The path to the folder to use as the root for the AWS IoT Greengrass Core\\n\"\n+            + \"\\t\\t\\t\\t\\tsoftware. Defaults to ~/.greengrass.\\n\"\n+            + \"\\t--config, -i\\t\\t\\t(Optional) The path to the configuration file that you use to run the AWS IoT \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3192ba23e0657f2004c07d77123127bda8a354f"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzcyMA==", "bodyText": "why is this true? This only works on systemd which is quite limited", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#discussion_r522667720", "createdAt": "2020-11-13T05:44:09Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/easysetup/GreengrassSetup.java", "diffHunk": "@@ -107,15 +143,14 @@\n \n     private static final String AWS_REGION_ARG = \"--aws-region\";\n     private static final String AWS_REGION_ARG_SHORT = \"-ar\";\n-    private static final String AWS_REGION_DEFAULT = \"us-east-1\";\n \n     private static final String ENV_STAGE_ARG = \"--env-stage\";\n     private static final String ENV_STAGE_ARG_SHORT = \"-es\";\n     private static final String ENV_STAGE_DEFAULT = \"prod\";\n \n     private static final String SETUP_SYSTEM_SERVICE_ARG = \"--setup-system-service\";\n     private static final String SETUP_SYSTEM_SERVICE_ARG_SHORT = \"-ss\";\n-    private static final boolean SETUP_SYSTEM_SERVICE_ARG_DEFAULT = false;\n+    private static final boolean SETUP_SYSTEM_SERVICE_ARG_DEFAULT = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3192ba23e0657f2004c07d77123127bda8a354f"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2NzkzNw==", "bodyText": "doesn't this prevent us from testing? Return would do the same thing.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#discussion_r522667937", "createdAt": "2020-11-13T05:44:52Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/easysetup/GreengrassSetup.java", "diffHunk": "@@ -212,16 +253,28 @@ void performSetup() throws IOException, DeviceConfigurationException, URISyntaxE\n         // Describe usage of the command\n         if (showHelp) {\n             outStream.println(SHOW_HELP_RESPONSE);\n-            return;\n+            System.exit(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3192ba23e0657f2004c07d77123127bda8a354f"}, "originalPosition": 198}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY2ODEyMQ==", "bodyText": "does this take into account the fact that the region could be in the config store already?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#discussion_r522668121", "createdAt": "2020-11-13T05:45:28Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/easysetup/GreengrassSetup.java", "diffHunk": "@@ -212,16 +253,28 @@ void performSetup() throws IOException, DeviceConfigurationException, URISyntaxE\n         // Describe usage of the command\n         if (showHelp) {\n             outStream.println(SHOW_HELP_RESPONSE);\n-            return;\n+            System.exit(0);\n         }\n         if (showVersion) {\n             outStream.println(String.format(SHOW_VERSION_RESPONSE, KERNEL_VERSION));\n-            return;\n+            System.exit(0);\n+        }\n+        if (Utils.isEmpty(awsRegion)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3192ba23e0657f2004c07d77123127bda8a354f"}, "originalPosition": 205}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee3fa39fa0f4a8c31feb8b4956d88b49ab65fe55", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ee3fa39fa0f4a8c31feb8b4956d88b49ab65fe55", "committedDate": "2020-11-13T07:13:56Z", "message": "Setup script further changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3192ba23e0657f2004c07d77123127bda8a354f", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e3192ba23e0657f2004c07d77123127bda8a354f", "committedDate": "2020-11-13T05:34:53Z", "message": "Setup script further changes"}, "afterCommit": {"oid": "0158575bd757760f37895523e22817e684cb0de5", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0158575bd757760f37895523e22817e684cb0de5", "committedDate": "2020-11-13T07:13:56Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d3a5769e72ffda5eee425b9b799a34c92268665", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6d3a5769e72ffda5eee425b9b799a34c92268665", "committedDate": "2020-11-13T07:20:32Z", "message": "address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0158575bd757760f37895523e22817e684cb0de5", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0158575bd757760f37895523e22817e684cb0de5", "committedDate": "2020-11-13T07:13:56Z", "message": "address comments"}, "afterCommit": {"oid": "6d3a5769e72ffda5eee425b9b799a34c92268665", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6d3a5769e72ffda5eee425b9b799a34c92268665", "committedDate": "2020-11-13T07:20:32Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3d257a7667cff3d94e4d30c5a04b40848f59427", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f3d257a7667cff3d94e4d30c5a04b40848f59427", "committedDate": "2020-11-13T07:33:14Z", "message": "pmd"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzU1NTE1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#pullrequestreview-530355515", "createdAt": "2020-11-13T19:42:45Z", "commit": {"oid": "f3d257a7667cff3d94e4d30c5a04b40848f59427"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxOTo0Mjo0NVrOHy8oaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxOTo0Mjo0NVrOHy8oaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE4NDIzMw==", "bodyText": "we need the same behavior for default user, right? Or is that implemented already?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#discussion_r523184233", "createdAt": "2020-11-13T19:42:45Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/easysetup/GreengrassSetup.java", "diffHunk": "@@ -219,9 +260,27 @@ void performSetup() throws IOException, DeviceConfigurationException, URISyntaxE\n             return;\n         }\n \n-        setComponentDefaultUserAndGroup();\n+        kernel.parseArgs(kernelArgs.toArray(new String[]{}));\n \n-        Kernel kernel = getKernel().parseArgs(kernelArgs.toArray(new String[]{}));\n+        DeviceConfiguration deviceConfiguration = kernel.getContext().get(DeviceConfiguration.class);\n+\n+        if (Utils.isEmpty(awsRegion)) {\n+            awsRegion = Coerce.toString(deviceConfiguration.getAWSRegion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3d257a7667cff3d94e4d30c5a04b40848f59427"}, "originalPosition": 195}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzU1Nzkz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#pullrequestreview-530355793", "createdAt": "2020-11-13T19:43:12Z", "commit": {"oid": "f3d257a7667cff3d94e4d30c5a04b40848f59427"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzg1NzQ0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/677#pullrequestreview-530385744", "createdAt": "2020-11-13T20:29:10Z", "commit": {"oid": "f3d257a7667cff3d94e4d30c5a04b40848f59427"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03cf8b016259d03a5db998ba7356fd0ab2792f1f", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/03cf8b016259d03a5db998ba7356fd0ab2792f1f", "committedDate": "2020-11-13T20:31:10Z", "message": "Merge branch 'master' into setup-script"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2679, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}