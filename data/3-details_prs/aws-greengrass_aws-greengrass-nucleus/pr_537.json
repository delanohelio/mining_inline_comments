{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NjQ4NDM0", "number": 537, "title": "Runwith implementation - load user info considering default, component, and recipe and resolve which user to run as at execution time", "bodyText": "Look up a default RunWith in the DeviceConfiguration\nLookup RunWith per deployed component\nAllow running steps as a privileged user\nKeep track of the info used to start a service so that after a deployment, the same user that started the service will stop it\nAdd integration tests\nIssue #, if available:\nDescription of changes:\nStore default user/group/shell in DeviceConfiguration\nAdd RunWith model to deployment\nAdd RunWith node in KernelConfigResolver\nLoad User/Group and shell in GenericExternalService with methods that can be overloaded by other service types\nCheck RequiresPrivilege key in recipe to see if a lifecycle step needs to run as a privileged user (e.g. root)\nWhy is this change necessary:\nTo support running services with multiple users\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-10-16T07:25:54Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537", "merged": true, "mergeCommit": {"oid": "7ec82e312f12d143350d22805f06eba8d5829450"}, "closed": true, "closedAt": "2020-10-20T16:09:10Z", "author": {"login": "rbattle"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTAzIrgH2gAyNTA0NjQ4NDM0OmM5ZTg4YTQyNGFjZmRiYjE3MmM4YTIzM2FlZmE2MjQyZmQxNzUwNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUaqWzgH2gAyNTA0NjQ4NDM0OjFhYzE3NTY1Nzk4MzU0ZjdiNzU2NjQ3MjlhYWZhMGYyNDQwMTM2NWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c9e88a424acfdbb172c8a233aefa6242fd175061", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c9e88a424acfdbb172c8a233aefa6242fd175061", "committedDate": "2020-10-16T06:57:39Z", "message": "Implement RunWith for user and group\n\nLook up a default RunWith in the DeviceConfiguration\n\nLookup RunWith per deployed component\n\nAllow running steps as a privileged user\n\nKeep track of the info used to start a service so that after a deployment, the same user that started the service will stop it\n\nAdd integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0f31e76406c2e0eaf5e9e44a6b28d98bb321bff", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c0f31e76406c2e0eaf5e9e44a6b28d98bb321bff", "committedDate": "2020-10-16T07:14:31Z", "message": "Remove enableLogBash flag and always enable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4252e5fbf175c6936025c52561dd71862b96891", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e4252e5fbf175c6936025c52561dd71862b96891", "committedDate": "2020-10-16T07:17:56Z", "message": "Remove reference to logbash in comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93a9b90d01c7418beb291c376c4dbf412946c3c8", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/93a9b90d01c7418beb291c376c4dbf412946c3c8", "committedDate": "2020-10-16T07:27:06Z", "message": "Merge branch 'master' into runwith-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5b23ba99a51fe3d06fb8f78e502c8aa2d01e160", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a5b23ba99a51fe3d06fb8f78e502c8aa2d01e160", "committedDate": "2020-10-16T07:36:56Z", "message": "Remove redundant test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c85f3cf1a209f68dc2aff54144d14d110a74c80", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5c85f3cf1a209f68dc2aff54144d14d110a74c80", "committedDate": "2020-10-16T07:38:18Z", "message": "fix copyright"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78875834f38422174ccc9b7cff4501fdda49e007", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/78875834f38422174ccc9b7cff4501fdda49e007", "committedDate": "2020-10-16T07:39:48Z", "message": "change whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b54b82fc0f2e5de1254a12339158cc808e0d8360", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b54b82fc0f2e5de1254a12339158cc808e0d8360", "committedDate": "2020-10-16T15:39:39Z", "message": "Fix comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d9efe2bf8b4c3379cbf82b3c0c5621566256fb5", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0d9efe2bf8b4c3379cbf82b3c0c5621566256fb5", "committedDate": "2020-10-16T16:00:31Z", "message": "Add windows test that ignores posix user/group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f9362e2e6a07b9462f73abecf607465712034b2", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2f9362e2e6a07b9462f73abecf607465712034b2", "committedDate": "2020-10-16T16:31:40Z", "message": "remove stubbing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/eb143854e4f381772d4e84643d7f95d6715cc5d6", "committedDate": "2020-10-16T16:35:37Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjQ5Njg2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#pullrequestreview-510649686", "createdAt": "2020-10-16T17:03:42Z", "commit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNzowMzo0MlrOHjIyMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNzoyMToyMVrOHjJY0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYwNjEyOA==", "bodyText": "use a try-finally to remove the listener at the end.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506606128", "createdAt": "2020-10-16T17:03:42Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/deployment/DeploymentTaskIntegrationTest.java", "diffHunk": "@@ -724,6 +731,68 @@ void GIVEN_services_running_WHEN_service_added_and_deleted_THEN_add_remove_servi\n         assertThrows(ServiceLoadException.class, () -> kernel.locate(\"Mosquitto\"));\n         assertThrows(ServiceLoadException.class, () -> kernel.locate(\"GreenSignal\"));\n     }\n+    /**\n+     * Start a service running with a user, then deploy an update to change the user and ensure the correct user\n+     * stops the process and starts the new one.\n+     */\n+    @Test\n+    @Order(5) // deploy before tests that break services\n+    @EnabledOnOs(OS.LINUX)\n+    void GIVEN_a_deployment_with_runwith_config_WHEN_submitted_THEN_runwith_updated() throws Exception {\n+        ((Map) kernel.getContext().getvIfExists(Kernel.SERVICE_TYPE_TO_CLASS_MAP_KEY).get()).put(\"plugin\",\n+                GreengrassService.class.getName());\n+\n+        assumeCanSudoShell(kernel);\n+\n+        countDownLatch = new CountDownLatch(2);\n+        // Set up stdout listener to capture stdout for verifying users\n+        List<String> stdouts = new CopyOnWriteArrayList<>();\n+        Consumer<GreengrassLogMessage> listener = m -> {\n+            Map<String, String> contexts = m.getContexts();\n+            String messageOnStdout = contexts.get(\"stdout\");\n+            if (messageOnStdout != null && messageOnStdout.contains(\"with user\")) {\n+                stdouts.add(messageOnStdout);\n+                countDownLatch.countDown();\n+            }\n+        };\n+        Slf4jLogAdapter.addGlobalListener(listener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYwNzAyNA==", "bodyText": "[nit]\nYou could use a parameterized test for these", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506607024", "createdAt": "2020-10-16T17:05:23Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/lifecyclemanager/GenericExternalServiceTest.java", "diffHunk": "@@ -297,4 +299,50 @@ void GIVEN_bootstrap_command_WHEN_runs_longer_than_5_sec_THEN_timeout_exception_\n         // this runs 5 seconds\n         assertThrows(TimeoutException.class, serviceWithJustBootstrapAndShouldTimeout::bootstrap);\n     }\n+\n+    @EnabledOnOs(OS.LINUX)\n+    @Test\n+    void GIVEN_linux_default_user_WHEN_runs_THEN_runs_with_default_user() throws Exception {\n+        runPosixUserShellTest(\"config_run_with_user.yaml\", \"123456\");\n+\n+    }\n+\n+    @EnabledOnOs(OS.LINUX)\n+    @Test\n+    void GIVEN_linux_default_shell_WHEN_runs_THEN_runs_with_default_shell() throws Exception {\n+        runPosixUserShellTest(\"config_run_with_user_shell.yaml\", \"123456\");\n+    }\n+\n+    @EnabledOnOs(OS.LINUX)\n+    @Test\n+    void GIVEN_linux_requires_privilege_WHEN_runs_THEN_runs_with_root() throws Exception {\n+        runPosixUserShellTest(\"config_run_with_privilege.yaml\", \"0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxMDU1MQ==", "bodyText": "windows shell too? powershell vs. cmd?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506610551", "createdAt": "2020-10-16T17:11:49Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/DeviceConfiguration.java", "diffHunk": "@@ -135,6 +139,26 @@ private Validator getRegionValidator() {\n         };\n     }\n \n+    public Topics getRunWithTopic() {\n+        return getTopics(RUN_WITH_TOPIC);\n+    }\n+\n+    public Topic getRunWithDefaultPosixUser() {\n+        return getRunWithTopic().lookup(RUN_WITH_DEFAULT_POSIX_USER);\n+    }\n+\n+    public Topic getRunWithDefaultPosixGroup() {\n+        return getRunWithTopic().lookup(RUN_WITH_DEFAULT_POSIX_GROUP);\n+    }\n+\n+    public Topic getRunWithDefaultPosixShell() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxMTY3OA==", "bodyText": "not needed", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506611678", "createdAt": "2020-10-16T17:13:44Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/deployment/model/RunWith.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/* Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0 */\n+\n+package com.aws.greengrass.deployment.model;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+\n+/**\n+ * Class to represent info about how the kernel should run lifecycle commands.\n+ */\n+@Getter\n+@Builder\n+@JsonDeserialize\n+@JsonSerialize", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxMzc0Nw==", "bodyText": "why save to local vars and then the fields? Why not just write to the fields?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506613747", "createdAt": "2020-10-16T17:17:23Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java", "diffHunk": "@@ -324,6 +347,31 @@ public void handleError() throws InterruptedException {\n         run(\"recover\", null, lifecycleProcesses);\n     }\n \n+    /**\n+     * Store user, group, and shell that will be used to run the service. This should be used throughout the lifecycle.\n+     * This information can change with a deployment, but service *must* execute the lifecycle steps with the same\n+     * user/group/shell that was configured when it started.\n+     */\n+    protected void storeInitialRunWithConfiguration() {\n+        String user = null;\n+        String group = null;\n+        String shell = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxMzk2Nw==", "bodyText": "maybe just use if (!Exec.isWindows())", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506613967", "createdAt": "2020-10-16T17:17:42Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java", "diffHunk": "@@ -324,6 +347,31 @@ public void handleError() throws InterruptedException {\n         run(\"recover\", null, lifecycleProcesses);\n     }\n \n+    /**\n+     * Store user, group, and shell that will be used to run the service. This should be used throughout the lifecycle.\n+     * This information can change with a deployment, but service *must* execute the lifecycle steps with the same\n+     * user/group/shell that was configured when it started.\n+     */\n+    protected void storeInitialRunWithConfiguration() {\n+        String user = null;\n+        String group = null;\n+        String shell = null;\n+\n+        // TODO: Add support for Windows\n+        if (PlatformResolver.RANKS.get().containsKey(\"posix\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxNDQwMQ==", "bodyText": "use protected?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506614401", "createdAt": "2020-10-16T17:18:20Z", "author": {"login": "MikeDombo"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/GenericExternalService.java", "diffHunk": "@@ -443,4 +495,66 @@ protected void addEnv(Exec exec, Topics src) {\n             });\n         }\n     }\n+\n+    Exec addUserGroup(Exec exec) {\n+        return addUserGroup(exec, runWithUser, runWithGroup);\n+    }\n+\n+    private Exec addUserGroup(Exec exec, String user, String group) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 191}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxNjAxOQ==", "bodyText": "why only linux? Why not mac?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r506616019", "createdAt": "2020-10-16T17:21:21Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/lifecyclemanager/GenericExternalServiceTest.java", "diffHunk": "@@ -297,4 +299,50 @@ void GIVEN_bootstrap_command_WHEN_runs_longer_than_5_sec_THEN_timeout_exception_\n         // this runs 5 seconds\n         assertThrows(TimeoutException.class, serviceWithJustBootstrapAndShouldTimeout::bootstrap);\n     }\n+\n+    @EnabledOnOs(OS.LINUX)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb143854e4f381772d4e84643d7f95d6715cc5d6"}, "originalPosition": 120}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcea6b2b34bfb6d7824a7285a4af13b17164c1a1", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/dcea6b2b34bfb6d7824a7285a4af13b17164c1a1", "committedDate": "2020-10-16T17:49:38Z", "message": "cleanup tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2f76f4a0d91da62c6d816c7f7708e3e8c4260c6", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a2f76f4a0d91da62c6d816c7f7708e3e8c4260c6", "committedDate": "2020-10-16T17:56:52Z", "message": "remove annotations and fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87a2afd8ba24ca3cfdc9ac14f6d7cbe1ca9f4f73", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/87a2afd8ba24ca3cfdc9ac14f6d7cbe1ca9f4f73", "committedDate": "2020-10-16T18:28:14Z", "message": "paramaterize test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5453801c9943b5b3d61e6d9361569608d73280f8", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5453801c9943b5b3d61e6d9361569608d73280f8", "committedDate": "2020-10-16T18:28:30Z", "message": "Merge branch 'master' into runwith-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6676d929eecaa87673a28e096e07ead78e0ae52b", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6676d929eecaa87673a28e096e07ead78e0ae52b", "committedDate": "2020-10-18T23:13:32Z", "message": "Merge branch 'master' into runwith-impl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMjg4Nzk3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#pullrequestreview-511288797", "createdAt": "2020-10-18T23:40:51Z", "commit": {"oid": "6676d929eecaa87673a28e096e07ead78e0ae52b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMzo0MDo1MlrOHjwicg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMzo0MDo1MlrOHjwicg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzI1NzQ1OA==", "bodyText": "[nit]\nClose reader", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#discussion_r507257458", "createdAt": "2020-10-18T23:40:52Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/lifecyclemanager/GenericExternalServiceTest.java", "diffHunk": "@@ -297,4 +304,43 @@ void GIVEN_bootstrap_command_WHEN_runs_longer_than_5_sec_THEN_timeout_exception_\n         // this runs 5 seconds\n         assertThrows(TimeoutException.class, serviceWithJustBootstrapAndShouldTimeout::bootstrap);\n     }\n+\n+    @EnabledOnOs({OS.LINUX, OS.MAC})\n+    @ParameterizedTest\n+    @MethodSource(\"posixTestUserConfig\")\n+    void GIVEN_posix_default_user_WHEN_runs_THEN_runs_with_default_user(String file, String expectedUid)\n+            throws Exception {\n+        kernel.parseArgs(\"-i\", getClass().getResource(file).toString());\n+\n+        // skip when running as a user that cannot sudo to shell\n+        assumeCanSudoShell(kernel);\n+\n+        // create file for test to write UID into\n+        File testFile = File.createTempFile(\"user-test\", \".txt\");\n+        testFile.deleteOnExit();\n+        assertTrue(testFile.setWritable(true, false), \"could not set test file to be writable\");\n+        GenericExternalService service = (GenericExternalService) kernel.locate(\"echo_service\");\n+        service.getServiceConfig().find(SETENV_CONFIG_NAMESPACE, \"output_path\").withValue(testFile.getAbsolutePath());\n+\n+        CountDownLatch main = new CountDownLatch(1);\n+        kernel.getContext().addGlobalStateChangeListener((s, oldState, newState) -> {\n+            if (s.getName().equals(\"main\") && newState.equals(State.FINISHED)) {\n+                main.countDown();\n+            }\n+        });\n+        kernel.launch();\n+\n+        assertTrue(main.await(10, TimeUnit.SECONDS));\n+\n+        String user = Files.newBufferedReader(testFile.toPath()).readLine();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6676d929eecaa87673a28e096e07ead78e0ae52b"}, "originalPosition": 159}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa49c6fa606bbcf324e60a06eef77a6b1bbf2b69", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fa49c6fa606bbcf324e60a06eef77a6b1bbf2b69", "committedDate": "2020-10-18T23:53:54Z", "message": "Fix binaryCompatibility to find causes not just at the class level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExOTUwMjk3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#pullrequestreview-511950297", "createdAt": "2020-10-19T16:34:26Z", "commit": {"oid": "fa49c6fa606bbcf324e60a06eef77a6b1bbf2b69"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af98a1132e651007f0545b5608bcf045082d9ac2", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/af98a1132e651007f0545b5608bcf045082d9ac2", "committedDate": "2020-10-19T22:26:14Z", "message": "Merge branch 'master' into runwith-impl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODY1NTkw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/537#pullrequestreview-512865590", "createdAt": "2020-10-20T15:31:31Z", "commit": {"oid": "af98a1132e651007f0545b5608bcf045082d9ac2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ac17565798354f7b75664729aafa0f24401365f", "author": {"user": {"login": "rbattle", "name": "Robert Battle"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1ac17565798354f7b75664729aafa0f24401365f", "committedDate": "2020-10-20T15:39:31Z", "message": "Merge branch 'master' into runwith-impl"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3168, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}