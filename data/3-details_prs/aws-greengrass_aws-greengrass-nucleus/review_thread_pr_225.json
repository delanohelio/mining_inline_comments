{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MjM3OTUz", "number": 225, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo0MzoyOVrOD57OTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoxNzo0MFrOD6B6iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDY1NzQyOnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo0MzoyOVrOGReROQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxODowMzo1MFrOGRfE2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3NDkwNQ==", "bodyText": "can you rename this as GIVEN_WHEN_THEN like we did for Stream Manager?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420974905", "createdAt": "2020-05-06T17:43:29Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4NTIxNA==", "bodyText": "Let me do that. Do we follow that convention for all tests?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420985214", "createdAt": "2020-05-06T17:59:09Z", "author": {"login": "prateek-y"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3NDkwNQ=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4ODEyMg==", "bodyText": "Yes all of our new tests are supposed to be following that.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420988122", "createdAt": "2020-05-06T18:03:50Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3NDkwNQ=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDY2MjY5OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo0NDo0MVrOGReUfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo1ODoxNlrOGRe3DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3NTc0Mg==", "bodyText": "These look a bit separate, maybe should be in a different test which tests the working directory.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420975742", "createdAt": "2020-05-06T17:44:41Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4NDU4OA==", "bodyText": "I have organized tests based on the public methods in the class, I was trying to test all sh methods here. Since all of them call the same method, I did not put them in separate methods.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420984588", "createdAt": "2020-05-06T17:58:16Z", "author": {"login": "prateek-y"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3NTc0Mg=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDY2Nzc1OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo0NTo1N1rOGReXdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo1MjowMFrOGRenBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3NjUwMA==", "bodyText": "this isn't really testing anything JDK related, but testing that successful returns true or false based on the exit code (from what I can tell based on this test).", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420976500", "createdAt": "2020-05-06T17:45:57Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MDQ4Ng==", "bodyText": "Yeah, will rename or remove this, carried over from previous tests.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420980486", "createdAt": "2020-05-06T17:52:00Z", "author": {"login": "prateek-y"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3NjUwMA=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDY3NjE2OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo0Nzo1M1rOGRecgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxODowMDoyN1rOGRe84w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3Nzc5NA==", "bodyText": "is there anything to be tested with this? Verify that it is no-op or verify that the Process is no longer running?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420977794", "createdAt": "2020-05-06T17:47:53Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {\n         assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n         assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n                 .successful(false));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    void testExecCommandInBackground() throws Exception {\n         CountDownLatch done = new CountDownLatch(1);\n-        List<String> o = new ArrayList<>();\n-        List<String> e = new ArrayList<>();\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n \n-        new Exec().withShell(\"pwd\").withOut(str -> o.add(str.toString())).withErr(str -> e.add(str.toString()))\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n                 .background(exc -> done.countDown());\n-        assertTrue(done.await(10, TimeUnit.SECONDS));\n-        //        System.out.println(\"O: \"+deepToString(o));\n-        //        System.out.println(\"E: \"+deepToString(e));\n-        assertEquals(0, e.size());\n-        assertEquals(1, o.size());\n-        assertTrue(o.get(0).startsWith(\"/\"));\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n+    }\n+\n+    @Test\n+    void testClosingProcess() throws IOException, InterruptedException {\n+        String command = \"Sleep 10\";\n+        CountDownLatch done = new CountDownLatch(1);\n+        Exec exec = new Exec();\n+        exec.withShell(command).background(exc -> done.countDown());\n+        assertTrue(exec.isRunning());\n+        // close waits for atmost 7 seconds before close\n+        exec.close();\n+        assertFalse(exec.isRunning());\n+        //closing again should be no op\n+        exec.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MjE4OQ==", "bodyText": "It should not throw, thats what I had in mind, looking at the close() behavior.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420982189", "createdAt": "2020-05-06T17:54:33Z", "author": {"login": "prateek-y"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {\n         assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n         assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n                 .successful(false));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    void testExecCommandInBackground() throws Exception {\n         CountDownLatch done = new CountDownLatch(1);\n-        List<String> o = new ArrayList<>();\n-        List<String> e = new ArrayList<>();\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n \n-        new Exec().withShell(\"pwd\").withOut(str -> o.add(str.toString())).withErr(str -> e.add(str.toString()))\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n                 .background(exc -> done.countDown());\n-        assertTrue(done.await(10, TimeUnit.SECONDS));\n-        //        System.out.println(\"O: \"+deepToString(o));\n-        //        System.out.println(\"E: \"+deepToString(e));\n-        assertEquals(0, e.size());\n-        assertEquals(1, o.size());\n-        assertTrue(o.get(0).startsWith(\"/\"));\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n+    }\n+\n+    @Test\n+    void testClosingProcess() throws IOException, InterruptedException {\n+        String command = \"Sleep 10\";\n+        CountDownLatch done = new CountDownLatch(1);\n+        Exec exec = new Exec();\n+        exec.withShell(command).background(exc -> done.countDown());\n+        assertTrue(exec.isRunning());\n+        // close waits for atmost 7 seconds before close\n+        exec.close();\n+        assertFalse(exec.isRunning());\n+        //closing again should be no op\n+        exec.close();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3Nzc5NA=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MzcwOA==", "bodyText": "Got it. Please also check that the underlying Process is no longer alive as stopping processes is really important for our correctness.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420983708", "createdAt": "2020-05-06T17:56:53Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {\n         assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n         assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n                 .successful(false));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    void testExecCommandInBackground() throws Exception {\n         CountDownLatch done = new CountDownLatch(1);\n-        List<String> o = new ArrayList<>();\n-        List<String> e = new ArrayList<>();\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n \n-        new Exec().withShell(\"pwd\").withOut(str -> o.add(str.toString())).withErr(str -> e.add(str.toString()))\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n                 .background(exc -> done.countDown());\n-        assertTrue(done.await(10, TimeUnit.SECONDS));\n-        //        System.out.println(\"O: \"+deepToString(o));\n-        //        System.out.println(\"E: \"+deepToString(e));\n-        assertEquals(0, e.size());\n-        assertEquals(1, o.size());\n-        assertTrue(o.get(0).startsWith(\"/\"));\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n+    }\n+\n+    @Test\n+    void testClosingProcess() throws IOException, InterruptedException {\n+        String command = \"Sleep 10\";\n+        CountDownLatch done = new CountDownLatch(1);\n+        Exec exec = new Exec();\n+        exec.withShell(command).background(exc -> done.countDown());\n+        assertTrue(exec.isRunning());\n+        // close waits for atmost 7 seconds before close\n+        exec.close();\n+        assertFalse(exec.isRunning());\n+        //closing again should be no op\n+        exec.close();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3Nzc5NA=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4NjA4Mw==", "bodyText": "Makes sense.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r420986083", "createdAt": "2020-05-06T18:00:27Z", "author": {"login": "prateek-y"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {\n         assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n         assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n                 .successful(false));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    void testExecCommandInBackground() throws Exception {\n         CountDownLatch done = new CountDownLatch(1);\n-        List<String> o = new ArrayList<>();\n-        List<String> e = new ArrayList<>();\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n \n-        new Exec().withShell(\"pwd\").withOut(str -> o.add(str.toString())).withErr(str -> e.add(str.toString()))\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n                 .background(exc -> done.countDown());\n-        assertTrue(done.await(10, TimeUnit.SECONDS));\n-        //        System.out.println(\"O: \"+deepToString(o));\n-        //        System.out.println(\"E: \"+deepToString(e));\n-        assertEquals(0, e.size());\n-        assertEquals(1, o.size());\n-        assertTrue(o.get(0).startsWith(\"/\"));\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n+    }\n+\n+    @Test\n+    void testClosingProcess() throws IOException, InterruptedException {\n+        String command = \"Sleep 10\";\n+        CountDownLatch done = new CountDownLatch(1);\n+        Exec exec = new Exec();\n+        exec.withShell(command).background(exc -> done.countDown());\n+        assertTrue(exec.isRunning());\n+        // close waits for atmost 7 seconds before close\n+        exec.close();\n+        assertFalse(exec.isRunning());\n+        //closing again should be no op\n+        exec.close();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk3Nzc5NA=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDk1NjQ3OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTowMDoyMVrOGRhKxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTo0MToyM1rOGRilwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAyMjQwNA==", "bodyText": "I think it is not necessary to generate a random string here. Just use something like \"this_wont_exist_ever\"", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r421022404", "createdAt": "2020-05-06T19:00:21Z", "author": {"login": "fufranci"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {\n         assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n         assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n                 .successful(false));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    void testExecCommandInBackground() throws Exception {\n         CountDownLatch done = new CountDownLatch(1);\n-        List<String> o = new ArrayList<>();\n-        List<String> e = new ArrayList<>();\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n \n-        new Exec().withShell(\"pwd\").withOut(str -> o.add(str.toString())).withErr(str -> e.add(str.toString()))\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n                 .background(exc -> done.countDown());\n-        assertTrue(done.await(10, TimeUnit.SECONDS));\n-        //        System.out.println(\"O: \"+deepToString(o));\n-        //        System.out.println(\"E: \"+deepToString(e));\n-        assertEquals(0, e.size());\n-        assertEquals(1, o.size());\n-        assertTrue(o.get(0).startsWith(\"/\"));\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n+    }\n+\n+    @Test\n+    void testClosingProcess() throws IOException, InterruptedException {\n+        String command = \"Sleep 10\";\n+        CountDownLatch done = new CountDownLatch(1);\n+        Exec exec = new Exec();\n+        exec.withShell(command).background(exc -> done.countDown());\n+        assertTrue(exec.isRunning());\n+        // close waits for atmost 7 seconds before close\n+        exec.close();\n+        assertFalse(exec.isRunning());\n+        //closing again should be no op\n+        exec.close();\n+    }\n+\n+    @Test\n+    void testExecForStdOutputStdError() throws InterruptedException, IOException {\n+        Exec exec = new Exec();\n+        String expectedOutput = \"HELLO\";\n+        String command = \"echo \" + expectedOutput;\n+        StringBuilder stdout = new StringBuilder();\n+        StringBuilder stderr = new StringBuilder();\n+        Consumer<CharSequence> stdoutConsumer = c -> stdout.append(c);\n+        Consumer<CharSequence> stderrConsumer = c -> stderr.append(c);\n+        exec = exec.withShell(command).withOut(stdoutConsumer).withErr(stderrConsumer);\n+        assertTrue(exec.successful(false));\n+        // new line for shell\n+        assertEquals(expectedOutput.length() + 1, stdout.toString().length());\n+        assertEquals(0, stderr.toString().length());\n+\n+        // reinit consumers\n+        stdout.setLength(0);\n+        stderr.setLength(0);\n+\n+        command = command + \" 1>&2\";\n+        exec = exec.withShell(command);\n+        assertFalse(exec.successful(false));\n+        assertEquals(0, stdout.toString().length());\n+        // new line for shell\n+        assertEquals(expectedOutput.length() + 1, stderr.toString().length());\n+    }\n+\n+    @Test\n+    void testCD() throws InterruptedException, IOException {\n+        Exec exec = new Exec();\n+        final String getWorkingDirCmd = \"pwd\";\n+        // By default Exec uses home current directory for exec\n+        String expectedDir = System.getProperty(\"user.dir\");\n+        String defaultDir = exec.withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, defaultDir);\n+\n+        // Now change it to some other directory\n+        // TODO: Change this to a proper root to work on all platforms\n+        expectedDir = \"/\";\n+        String changedDir = exec.cd(new File(expectedDir)).withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+\n+        // Now use the file argument to change into another directory again\n+        // File argument would use the current directory (\"/\") as base\n+        expectedDir = System.getProperty(\"user.home\");\n+        changedDir = exec.cd(expectedDir).withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+\n+        // Now change it to root again\n+        expectedDir = \"/\";\n+        changedDir = exec.cd(new File(expectedDir)).withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+\n+        // by default cd change to home directory\n+        expectedDir = System.getProperty(\"user.home\");\n+        changedDir = exec.cd().withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+    }\n+\n+    @Test\n+    void testToString() {\n+        // TODO: length of 90 as per the class does not seem to work\n+        int maxStringLength = 50;\n+        String fakeCommand = Utils.generateRandomString(maxStringLength);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 159}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA0NTY5Ng==", "bodyText": "You are correct, I intended to have variable lengths string first, but ended up using just one. I will change this.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r421045696", "createdAt": "2020-05-06T19:41:23Z", "author": {"login": "prateek-y"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -4,58 +4,144 @@\n package com.aws.iot.evergreen.integrationtests.util;\n \n import com.aws.iot.evergreen.util.Exec;\n+import com.aws.iot.evergreen.util.Utils;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void testExecStaticCommands() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n+    void testGetOpenJDK() throws InterruptedException, IOException {\n         assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n         assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n                 .successful(false));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    void testExecCommandInBackground() throws Exception {\n         CountDownLatch done = new CountDownLatch(1);\n-        List<String> o = new ArrayList<>();\n-        List<String> e = new ArrayList<>();\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n \n-        new Exec().withShell(\"pwd\").withOut(str -> o.add(str.toString())).withErr(str -> e.add(str.toString()))\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n                 .background(exc -> done.countDown());\n-        assertTrue(done.await(10, TimeUnit.SECONDS));\n-        //        System.out.println(\"O: \"+deepToString(o));\n-        //        System.out.println(\"E: \"+deepToString(e));\n-        assertEquals(0, e.size());\n-        assertEquals(1, o.size());\n-        assertTrue(o.get(0).startsWith(\"/\"));\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n+    }\n+\n+    @Test\n+    void testClosingProcess() throws IOException, InterruptedException {\n+        String command = \"Sleep 10\";\n+        CountDownLatch done = new CountDownLatch(1);\n+        Exec exec = new Exec();\n+        exec.withShell(command).background(exc -> done.countDown());\n+        assertTrue(exec.isRunning());\n+        // close waits for atmost 7 seconds before close\n+        exec.close();\n+        assertFalse(exec.isRunning());\n+        //closing again should be no op\n+        exec.close();\n+    }\n+\n+    @Test\n+    void testExecForStdOutputStdError() throws InterruptedException, IOException {\n+        Exec exec = new Exec();\n+        String expectedOutput = \"HELLO\";\n+        String command = \"echo \" + expectedOutput;\n+        StringBuilder stdout = new StringBuilder();\n+        StringBuilder stderr = new StringBuilder();\n+        Consumer<CharSequence> stdoutConsumer = c -> stdout.append(c);\n+        Consumer<CharSequence> stderrConsumer = c -> stderr.append(c);\n+        exec = exec.withShell(command).withOut(stdoutConsumer).withErr(stderrConsumer);\n+        assertTrue(exec.successful(false));\n+        // new line for shell\n+        assertEquals(expectedOutput.length() + 1, stdout.toString().length());\n+        assertEquals(0, stderr.toString().length());\n+\n+        // reinit consumers\n+        stdout.setLength(0);\n+        stderr.setLength(0);\n+\n+        command = command + \" 1>&2\";\n+        exec = exec.withShell(command);\n+        assertFalse(exec.successful(false));\n+        assertEquals(0, stdout.toString().length());\n+        // new line for shell\n+        assertEquals(expectedOutput.length() + 1, stderr.toString().length());\n+    }\n+\n+    @Test\n+    void testCD() throws InterruptedException, IOException {\n+        Exec exec = new Exec();\n+        final String getWorkingDirCmd = \"pwd\";\n+        // By default Exec uses home current directory for exec\n+        String expectedDir = System.getProperty(\"user.dir\");\n+        String defaultDir = exec.withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, defaultDir);\n+\n+        // Now change it to some other directory\n+        // TODO: Change this to a proper root to work on all platforms\n+        expectedDir = \"/\";\n+        String changedDir = exec.cd(new File(expectedDir)).withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+\n+        // Now use the file argument to change into another directory again\n+        // File argument would use the current directory (\"/\") as base\n+        expectedDir = System.getProperty(\"user.home\");\n+        changedDir = exec.cd(expectedDir).withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+\n+        // Now change it to root again\n+        expectedDir = \"/\";\n+        changedDir = exec.cd(new File(expectedDir)).withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+\n+        // by default cd change to home directory\n+        expectedDir = System.getProperty(\"user.home\");\n+        changedDir = exec.cd().withExec(getWorkingDirCmd).execAndGetStringOutput();\n+        assertEquals(expectedDir, changedDir);\n+    }\n+\n+    @Test\n+    void testToString() {\n+        // TODO: length of 90 as per the class does not seem to work\n+        int maxStringLength = 50;\n+        String fakeCommand = Utils.generateRandomString(maxStringLength);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAyMjQwNA=="}, "originalCommit": {"oid": "3bf6949136c9c0817beddc8722691032133d429e"}, "originalPosition": 159}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTcwMzM0OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjo1NjoyNlrOGRoTmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoxMDo1M1rOGRonpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzOTM1Mw==", "bodyText": "Interesting. I didn't know there is a capital Sleep command!", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r421139353", "createdAt": "2020-05-06T22:56:26Z", "author": {"login": "fufranci"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -6,56 +6,139 @@\n import com.aws.iot.evergreen.util.Exec;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void Given_exec_WHEN_commands_executed_using_static_methods_THEN_success() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n-        assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n-        assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n-                .successful(false));\n+    void GIVEN_exec_WHEN_command_executed_in_background_THEN_success() throws Exception {\n+        CountDownLatch done = new CountDownLatch(1);\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n+\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n+                .background(exc -> done.countDown());\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    @SuppressWarnings(\"PMD.CloseResource\")\n+    void GIVEN_exec_WHEN_running_command_closed_THEN_success() throws IOException, InterruptedException {\n+        // close waits for atmost 7 seconds before close\n+        String command = \"Sleep 10\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8f08086c881a9d34b4ebfdefa207318071daad8"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0MDQ3MA==", "bodyText": "Oh I just tried on a Linux. There is no capital Sleep on Linux. It is only available on Mac.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r421140470", "createdAt": "2020-05-06T22:59:28Z", "author": {"login": "fufranci"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -6,56 +6,139 @@\n import com.aws.iot.evergreen.util.Exec;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void Given_exec_WHEN_commands_executed_using_static_methods_THEN_success() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n-        assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n-        assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n-                .successful(false));\n+    void GIVEN_exec_WHEN_command_executed_in_background_THEN_success() throws Exception {\n+        CountDownLatch done = new CountDownLatch(1);\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n+\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n+                .background(exc -> done.countDown());\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    @SuppressWarnings(\"PMD.CloseResource\")\n+    void GIVEN_exec_WHEN_running_command_closed_THEN_success() throws IOException, InterruptedException {\n+        // close waits for atmost 7 seconds before close\n+        String command = \"Sleep 10\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzOTM1Mw=="}, "originalCommit": {"oid": "c8f08086c881a9d34b4ebfdefa207318071daad8"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0NDQ4NQ==", "bodyText": "yeah. It was unintentional. mac has both apparently. :) change it to lower caps now.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r421144485", "createdAt": "2020-05-06T23:10:53Z", "author": {"login": "prateek-y"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -6,56 +6,139 @@\n import com.aws.iot.evergreen.util.Exec;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void Given_exec_WHEN_commands_executed_using_static_methods_THEN_success() throws InterruptedException, IOException {\n         if (Exec.isWindows) {\n             return;\n         }\n-        String s = Exec.cmd(\"pwd\");\n-        //        System.out.println(\"pwd: \"+s);\n+        final String command = \"pwd\";\n+        String s = Exec.cmd(command);\n         assertFalse(s.contains(\"\\n\"));\n         assertTrue(s.startsWith(\"/\"));\n-        assertEquals(s, Exec.sh(\"pwd\"));\n+        assertEquals(s, Exec.sh(command));\n         String s2 = Exec.sh(\"ifconfig -a;echo Hello\");\n-        //        System.out.println(s2);\n         assertTrue(s2.contains(\"Hello\"));\n+        String expectedDir = System.getProperty(\"user.home\");\n+        assertEquals(expectedDir, Exec.sh(new File(expectedDir), command));\n+        assertEquals(expectedDir, Exec.sh(Paths.get(expectedDir), command));\n+        assertTrue(Exec.successful(false, command));\n     }\n \n     @Test\n-    void test2() throws InterruptedException, IOException {\n-        //        System.out.println(Exec.sh(\"printenv;java --version\"));\n-        //        assertFalse(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *17\\\\.'\"));\n-        //        assertTrue(Exec.successful(\"java --version|egrep -i -q '(jdk|jre) *11\\\\.'\"));\n-        assertFalse(Exec.successful(false, \"echo openjdk 11.0|egrep -i -q '(jdk|jre) *18\\\\.'\"));\n-        assertTrue(new Exec().withShell(\"echo openjdk 11.0|egrep -i -q '(jdk|jre) *11\\\\.'\").withDumpOut()\n-                .successful(false));\n+    void GIVEN_exec_WHEN_command_executed_in_background_THEN_success() throws Exception {\n+        CountDownLatch done = new CountDownLatch(1);\n+        List<String> stdoutMessages = new ArrayList<>();\n+        List<String> stderrMessages = new ArrayList<>();\n+\n+        new Exec().withShell(\"pwd\")\n+                .withOut(str -> stdoutMessages.add(str.toString()))\n+                .withErr(str -> stderrMessages.add(str.toString()))\n+                .background(exc -> done.countDown());\n+        // Wait for 1 second for command to finish\n+        assertTrue(done.await(1, TimeUnit.SECONDS));\n+        assertEquals(0, stderrMessages.size());\n+        assertEquals(1, stdoutMessages.size());\n+        assertTrue(stdoutMessages.get(0).startsWith(\"/\"));\n     }\n \n     @Test\n-    void test3() throws Exception {\n+    @SuppressWarnings(\"PMD.CloseResource\")\n+    void GIVEN_exec_WHEN_running_command_closed_THEN_success() throws IOException, InterruptedException {\n+        // close waits for atmost 7 seconds before close\n+        String command = \"Sleep 10\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzOTM1Mw=="}, "originalCommit": {"oid": "c8f08086c881a9d34b4ebfdefa207318071daad8"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTc1MzY4OnYy", "diffSide": "RIGHT", "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoxNzo0MFrOGRowkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMzoxNzo0MFrOGRowkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0Njc2OA==", "bodyText": "nit: capitalize the GIVEN.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/225#discussion_r421146768", "createdAt": "2020-05-06T23:17:40Z", "author": {"login": "MikeDombo"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/util/ExecTest.java", "diffHunk": "@@ -6,56 +6,139 @@\n import com.aws.iot.evergreen.util.Exec;\n import org.junit.jupiter.api.Test;\n \n+import java.io.File;\n import java.io.IOException;\n+import java.nio.file.Paths;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n class ExecTest {\n     @Test\n-    void test() throws InterruptedException, IOException {\n+    void Given_exec_WHEN_commands_executed_using_static_methods_THEN_success() throws InterruptedException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "002b71d3be0c2658cace5a757145a286e3ebca29"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4672, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}