{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwNzk2MzA5", "number": 344, "title": "Set credential provider to be TES instead of environment credentials", "bodyText": "Issue #, if available:\nDescription of changes:\nUse TES to get credentials to call Evergreen cloud APIs. Required for UAT.\nUpdates BaseE2ETestCase to wait for TES to have the credentials ready because I've seen it take up to 90 seconds before we could get credentials from TES.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-08-01T05:15:17Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344", "merged": true, "mergeCommit": {"oid": "5ee3fae315311d064dc517b3f8c77c70d003dd92"}, "closed": true, "closedAt": "2020-08-03T20:07:46Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6iAlZABqjM2MTEyNTcxOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7WxrLgFqTQ2MDI2ODUzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9e8f407aaf97714a4f3cf9d526a5254e5e20f0f", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e9e8f407aaf97714a4f3cf9d526a5254e5e20f0f", "committedDate": "2020-08-01T05:14:35Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "d2b46635c6332b1139f24f53853addc3a0a062bf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d2b46635c6332b1139f24f53853addc3a0a062bf", "committedDate": "2020-08-01T05:30:59Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2b46635c6332b1139f24f53853addc3a0a062bf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d2b46635c6332b1139f24f53853addc3a0a062bf", "committedDate": "2020-08-01T05:30:59Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "236a3f3c526423a3308aee4b8b42eca175492a20", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/236a3f3c526423a3308aee4b8b42eca175492a20", "committedDate": "2020-08-01T05:56:06Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "236a3f3c526423a3308aee4b8b42eca175492a20", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/236a3f3c526423a3308aee4b8b42eca175492a20", "committedDate": "2020-08-01T05:56:06Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "fb8347fa1af22168594f877c3eb93d7d16fb5c16", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fb8347fa1af22168594f877c3eb93d7d16fb5c16", "committedDate": "2020-08-01T06:26:43Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb8347fa1af22168594f877c3eb93d7d16fb5c16", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/fb8347fa1af22168594f877c3eb93d7d16fb5c16", "committedDate": "2020-08-01T06:26:43Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "260988fe024a755714ca923cc0cee84b2ba0cca4", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/260988fe024a755714ca923cc0cee84b2ba0cca4", "committedDate": "2020-08-01T19:54:42Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "260988fe024a755714ca923cc0cee84b2ba0cca4", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/260988fe024a755714ca923cc0cee84b2ba0cca4", "committedDate": "2020-08-01T19:54:42Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "7f811f547178a8ce3ab3bd199288a3166cb916f5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7f811f547178a8ce3ab3bd199288a3166cb916f5", "committedDate": "2020-08-01T20:03:09Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f811f547178a8ce3ab3bd199288a3166cb916f5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7f811f547178a8ce3ab3bd199288a3166cb916f5", "committedDate": "2020-08-01T20:03:09Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "8dce249e895798a12b5d0656f07525fbc2de3b32", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8dce249e895798a12b5d0656f07525fbc2de3b32", "committedDate": "2020-08-01T20:22:58Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8dce249e895798a12b5d0656f07525fbc2de3b32", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8dce249e895798a12b5d0656f07525fbc2de3b32", "committedDate": "2020-08-01T20:22:58Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "759550e5183538c419efeb0e334229c26f9fdebf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/759550e5183538c419efeb0e334229c26f9fdebf", "committedDate": "2020-08-01T22:07:06Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "759550e5183538c419efeb0e334229c26f9fdebf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/759550e5183538c419efeb0e334229c26f9fdebf", "committedDate": "2020-08-01T22:07:06Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "88024e107c2a55dbcb9a8eee5b3ce33c280cbfc0", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/88024e107c2a55dbcb9a8eee5b3ce33c280cbfc0", "committedDate": "2020-08-01T22:08:06Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88024e107c2a55dbcb9a8eee5b3ce33c280cbfc0", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/88024e107c2a55dbcb9a8eee5b3ce33c280cbfc0", "committedDate": "2020-08-01T22:08:06Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "57bab11e112491536fa017230ad02461cb2eb1fd", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/57bab11e112491536fa017230ad02461cb2eb1fd", "committedDate": "2020-08-01T22:46:08Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57bab11e112491536fa017230ad02461cb2eb1fd", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/57bab11e112491536fa017230ad02461cb2eb1fd", "committedDate": "2020-08-01T22:46:08Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "aa9e0861bd704aa6d60b487044c5062059ec202d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aa9e0861bd704aa6d60b487044c5062059ec202d", "committedDate": "2020-08-01T23:04:29Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa9e0861bd704aa6d60b487044c5062059ec202d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/aa9e0861bd704aa6d60b487044c5062059ec202d", "committedDate": "2020-08-01T23:04:29Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "2a8785235cd06aca1f965b9a7a4c44496cb50f57", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2a8785235cd06aca1f965b9a7a4c44496cb50f57", "committedDate": "2020-08-01T23:09:33Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a8785235cd06aca1f965b9a7a4c44496cb50f57", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2a8785235cd06aca1f965b9a7a4c44496cb50f57", "committedDate": "2020-08-01T23:09:33Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "0aa0e9e318d8094d3bc23f1e3affe9138ffeb43e", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0aa0e9e318d8094d3bc23f1e3affe9138ffeb43e", "committedDate": "2020-08-01T23:18:12Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0aa0e9e318d8094d3bc23f1e3affe9138ffeb43e", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0aa0e9e318d8094d3bc23f1e3affe9138ffeb43e", "committedDate": "2020-08-01T23:18:12Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "6ab3ac996566a7b9353a8b1cac503098e4a77123", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6ab3ac996566a7b9353a8b1cac503098e4a77123", "committedDate": "2020-08-01T23:27:19Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ab3ac996566a7b9353a8b1cac503098e4a77123", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6ab3ac996566a7b9353a8b1cac503098e4a77123", "committedDate": "2020-08-01T23:27:19Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "53047c5921cedb82b2e4003f21f657bce3eb14b3", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/53047c5921cedb82b2e4003f21f657bce3eb14b3", "committedDate": "2020-08-01T23:36:52Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53047c5921cedb82b2e4003f21f657bce3eb14b3", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/53047c5921cedb82b2e4003f21f657bce3eb14b3", "committedDate": "2020-08-01T23:36:52Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "4ee744531beb208c8b6c8a1b2b0c070ad8241b0c", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4ee744531beb208c8b6c8a1b2b0c070ad8241b0c", "committedDate": "2020-08-01T23:46:14Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ee744531beb208c8b6c8a1b2b0c070ad8241b0c", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4ee744531beb208c8b6c8a1b2b0c070ad8241b0c", "committedDate": "2020-08-01T23:46:14Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "8acdc11bf6de51705952a6fddb7f1af8841115bf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8acdc11bf6de51705952a6fddb7f1af8841115bf", "committedDate": "2020-08-01T23:53:49Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8acdc11bf6de51705952a6fddb7f1af8841115bf", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8acdc11bf6de51705952a6fddb7f1af8841115bf", "committedDate": "2020-08-01T23:53:49Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "5b5026704559ab15bef52c18133ca63107434c44", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5b5026704559ab15bef52c18133ca63107434c44", "committedDate": "2020-08-02T00:25:09Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b5026704559ab15bef52c18133ca63107434c44", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/5b5026704559ab15bef52c18133ca63107434c44", "committedDate": "2020-08-02T00:25:09Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "84b259e3670e81bbde7d6fba27589f62fc64c169", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/84b259e3670e81bbde7d6fba27589f62fc64c169", "committedDate": "2020-08-02T00:44:40Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84b259e3670e81bbde7d6fba27589f62fc64c169", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/84b259e3670e81bbde7d6fba27589f62fc64c169", "committedDate": "2020-08-02T00:44:40Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "ae85de7b2e85449479544c115910d2f25909323a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ae85de7b2e85449479544c115910d2f25909323a", "committedDate": "2020-08-02T00:52:39Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae85de7b2e85449479544c115910d2f25909323a", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ae85de7b2e85449479544c115910d2f25909323a", "committedDate": "2020-08-02T00:52:39Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6d5c9fa0728c59283c5f2c35622ccc1de237717e", "committedDate": "2020-08-02T01:20:58Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjQ1NDA2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#pullrequestreview-460245406", "createdAt": "2020-08-03T18:21:26Z", "commit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyMToyN1rOG7EDEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyMToyN1rOG7EDEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4NTQ4OA==", "bodyText": "Can we have these in postInject?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#discussion_r464585488", "createdAt": "2020-08-03T18:21:27Z", "author": {"login": "youtuyy"}, "path": "src/main/java/com/aws/iot/evergreen/tes/TokenExchangeService.java", "diffHunk": "@@ -55,15 +55,16 @@ public TokenExchangeService(Topics topics,\n                                 CredentialRequestHandler credentialRequestHandler,\n                                 AuthorizationHandler authZHandler) {\n         super(topics);\n-        // TODO: Add support for other params like role Aliases\n         topics.lookup(PARAMETERS_CONFIG_KEY, PORT_TOPIC)\n                 .dflt(DEFAULT_PORT)\n                 .subscribe((why, newv) ->\n                         port = Coerce.toInt(newv));\n \n         topics.lookup(PARAMETERS_CONFIG_KEY, IOT_ROLE_ALIAS_TOPIC)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjQ2Nzg2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#pullrequestreview-460246786", "createdAt": "2020-08-03T18:23:37Z", "commit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyMzozOFrOG7EHHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyODoyN1rOG7EQug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4NjUyNg==", "bodyText": "Who is calling this method? Why do we need to implement com.amazonaws.auth.AWSCredentialsProvider?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#discussion_r464586526", "createdAt": "2020-08-03T18:23:38Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/tes/LazyCredentialProvider.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright Amazon.com Inc. or its affiliates.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.iot.evergreen.tes;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.auth.AWSCredentialsProvider;\n+import com.amazonaws.auth.BasicSessionCredentials;\n+import com.aws.iot.evergreen.dependency.Context;\n+import software.amazon.awssdk.auth.credentials.AwsCredentials;\n+import software.amazon.awssdk.auth.credentials.AwsCredentialsProvider;\n+import software.amazon.awssdk.auth.credentials.AwsSessionCredentials;\n+\n+import javax.inject.Inject;\n+\n+public class LazyCredentialProvider implements AWSCredentialsProvider, AwsCredentialsProvider {\n+\n+    private final Context context;\n+\n+    @Inject\n+    public LazyCredentialProvider(Context context) {\n+        this.context = context;\n+    }\n+\n+    @Override\n+    public AwsCredentials resolveCredentials() {\n+        return context.get(TokenExchangeService.class).resolveCredentials();\n+    }\n+\n+    @Override\n+    public AWSCredentials getCredentials() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4NzU3MA==", "bodyText": "not implemented? Should it throw an exception if it's not intended to be called.", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#discussion_r464587570", "createdAt": "2020-08-03T18:25:37Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/tes/LazyCredentialProvider.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright Amazon.com Inc. or its affiliates.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.iot.evergreen.tes;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.auth.AWSCredentialsProvider;\n+import com.amazonaws.auth.BasicSessionCredentials;\n+import com.aws.iot.evergreen.dependency.Context;\n+import software.amazon.awssdk.auth.credentials.AwsCredentials;\n+import software.amazon.awssdk.auth.credentials.AwsCredentialsProvider;\n+import software.amazon.awssdk.auth.credentials.AwsSessionCredentials;\n+\n+import javax.inject.Inject;\n+\n+public class LazyCredentialProvider implements AWSCredentialsProvider, AwsCredentialsProvider {\n+\n+    private final Context context;\n+\n+    @Inject\n+    public LazyCredentialProvider(Context context) {\n+        this.context = context;\n+    }\n+\n+    @Override\n+    public AwsCredentials resolveCredentials() {\n+        return context.get(TokenExchangeService.class).resolveCredentials();\n+    }\n+\n+    @Override\n+    public AWSCredentials getCredentials() {\n+        AwsSessionCredentials credentials = (AwsSessionCredentials) resolveCredentials();\n+        return new BasicSessionCredentials(credentials.accessKeyId(), credentials.secretAccessKey(),\n+                credentials.sessionToken());\n+    }\n+\n+    @Override\n+    public void refresh() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4ODk4Ng==", "bodyText": "Why throw an AssertionError?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#discussion_r464588986", "createdAt": "2020-08-03T18:28:27Z", "author": {"login": "fengwang666"}, "path": "src/integrationtests/java/com/aws/iot/evergreen/integrationtests/e2e/util/IotJobsUtils.java", "diffHunk": "@@ -59,8 +58,14 @@ public static void waitForJobExecutionStatusToSatisfy(IotClient client, String j\n                 status = client.describeJobExecution(\n                         DescribeJobExecutionRequest.builder().jobId(jobId).thingName(thingName).build()).execution()\n                         .status();\n-                if (condition.test(status)) {\n-                    return;\n+                // All statuses after and including SUCCEEDED are terminal, so they won't ever change\n+                // which means we can stop querying\n+                if (JobExecutionStatus.SUCCEEDED.ordinal() <= status.ordinal() || condition.test(status)) {\n+                    if (condition.test(status)) {\n+                        return;\n+                    }\n+                } else if (JobExecutionStatus.SUCCEEDED.ordinal() <= status.ordinal()) {\n+                    throw new AssertionError(\"Job ended in state: \" + status);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "876d9576072b9765c6672dd7895287b3dcf70693", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/876d9576072b9765c6672dd7895287b3dcf70693", "committedDate": "2020-08-03T18:42:41Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjU4MjY4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#pullrequestreview-460258268", "createdAt": "2020-08-03T18:42:52Z", "commit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjU4ODQ4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#pullrequestreview-460258848", "createdAt": "2020-08-03T18:43:51Z", "commit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d5c9fa0728c59283c5f2c35622ccc1de237717e", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6d5c9fa0728c59283c5f2c35622ccc1de237717e", "committedDate": "2020-08-02T01:20:58Z", "message": "Set credential provider to be TES instead of environment credentials"}, "afterCommit": {"oid": "876d9576072b9765c6672dd7895287b3dcf70693", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/876d9576072b9765c6672dd7895287b3dcf70693", "committedDate": "2020-08-03T18:42:41Z", "message": "Set credential provider to be TES instead of environment credentials"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjYxNzQ0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#pullrequestreview-460261744", "createdAt": "2020-08-03T18:48:40Z", "commit": {"oid": "876d9576072b9765c6672dd7895287b3dcf70693"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjY4NTM3", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/344#pullrequestreview-460268537", "createdAt": "2020-08-03T18:59:47Z", "commit": {"oid": "876d9576072b9765c6672dd7895287b3dcf70693"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2975, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}