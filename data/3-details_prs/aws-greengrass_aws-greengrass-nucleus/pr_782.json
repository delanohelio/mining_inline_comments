{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MzczOTYy", "number": 782, "title": "When a deferred deployment is cancelled send post update event so com\u2026", "bodyText": "\u2026ponents can resume their work\nScenario -\nDeployed two components -\nA - always defers for fixed amount of time\nB - does not defer\nDeployment gets cancelled while A keeps deferring update. Cancellation is processed on device, deployment finishes, but a post component update event is never sent to components to indicate they can resume their work since there are no disruptive changes going to happen. Components can keep on waiting for further communication depending on how critical a disruptive action is for them\nFix - send post update event on cancellation\nIssue #, if available:\nDescription of changes:\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nChecklist:\n\n Updated the README if applicable\n Updated or added new unit tests\n Updated or added new integration tests\n Updated or added new end-to-end tests\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-12-11T00:52:24Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/782", "merged": true, "mergeCommit": {"oid": "d58739cf7534eb783b0fc0c5077a41ad7fcf8527"}, "closed": true, "closedAt": "2020-12-11T02:00:04Z", "author": {"login": "shaguptashaikh"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk9HaigH2gAyNTM2MzczOTYyOmQwYjhkZWQ2Zjk3ODY3NjM2YTc4OWUzZTI1NjZmZmQ1NjQ3NDIwYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk9-mxAFqTU0OTc0NTg2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0b8ded6f97867636a789e3e2566ffd5647420b1", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d0b8ded6f97867636a789e3e2566ffd5647420b1", "committedDate": "2020-12-11T00:50:49Z", "message": "When a deferred deployment is cancelled send post update event so components can resume their work"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NzI4ODg4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/782#pullrequestreview-549728888", "createdAt": "2020-12-11T01:00:32Z", "commit": {"oid": "d0b8ded6f97867636a789e3e2566ffd5647420b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NzMzNTMw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/782#pullrequestreview-549733530", "createdAt": "2020-12-11T01:14:17Z", "commit": {"oid": "d0b8ded6f97867636a789e3e2566ffd5647420b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMToxNDoxN1rOIDkqfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMToxNDoxN1rOIDkqfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDYxNzM0MA==", "bodyText": "What's the reason of changing this from AtomicBoolean to AtomicReference?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/782#discussion_r540617340", "createdAt": "2020-12-11T01:14:17Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/greengrass/lifecyclemanager/UpdateSystemPolicyService.java", "diffHunk": "@@ -48,7 +48,7 @@\n     // represents the value in seconds the kernel will wait for components to respond to\n     // an precomponent update event\n     private final Map<String, UpdateAction> pendingActions = new LinkedHashMap<>();\n-    private final AtomicBoolean runningUpdateActions = new AtomicBoolean(false);\n+    private final AtomicReference<String> actionInProgress = new AtomicReference<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0b8ded6f97867636a789e3e2566ffd5647420b1"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d088c5ebb888cb6cfb4d1797d688a60a1434360", "author": {"user": {"login": "shaguptashaikh", "name": "Shagupta Shaikh"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3d088c5ebb888cb6cfb4d1797d688a60a1434360", "committedDate": "2020-12-11T01:43:44Z", "message": "Merge branch 'master' into post-update-event-on-cancel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NzQ1ODY2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/782#pullrequestreview-549745866", "createdAt": "2020-12-11T01:51:06Z", "commit": {"oid": "3d088c5ebb888cb6cfb4d1797d688a60a1434360"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2572, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}