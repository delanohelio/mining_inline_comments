{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMDg2Mzc5", "number": 175, "title": "Cleanup service logging, address ignored InterruptedExceptions", "bodyText": "Issue #, if available:\nDescription of changes:\nCleans up service logging to use short versions of APIs when possible. Sets \"currentState\" default key to getState so that with every log that is output, the state is automatically included and is up to date.\nAlso fixes a loop when the service is BROKEN which was due to the lifecycle thread continueing instead of breaking and thus waiting for an event. Before, it would print the error log continuously until the service was shutdown or was updated.\nAlso addresses 2 place where we were ignoring InterruptedException to pass them up or handle them more appropriately.\nWhy is this change necessary:\nHow was this change tested:\nAny additional information or context required to review the change:\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-04-10T22:07:44Z", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175", "merged": true, "mergeCommit": {"oid": "bc9affdbbcc884a7bbf81501c98973b4c8122c2b"}, "closed": true, "closedAt": "2020-04-11T00:17:28Z", "author": {"login": "MikeDombo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWYnVVABqjMyMjMyMjc3MzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWaZDpgFqTM5MTcxNTA4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30e2d1b11108d2bedb0e47eb5fb7aefefb6b59bc", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/30e2d1b11108d2bedb0e47eb5fb7aefefb6b59bc", "committedDate": "2020-04-10T22:04:17Z", "message": "Cleanup service logging, address ignored InterruptedExceptions"}, "afterCommit": {"oid": "f233853eb14a2a5a978409f7d0283da6e50fb94d", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/f233853eb14a2a5a978409f7d0283da6e50fb94d", "committedDate": "2020-04-10T22:12:59Z", "message": "Cleanup service logging, address ignored InterruptedExceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNjk4MTgw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#pullrequestreview-391698180", "createdAt": "2020-04-10T22:56:38Z", "commit": {"oid": "f233853eb14a2a5a978409f7d0283da6e50fb94d"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMjo1NjozOFrOGEHyjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQyMjo1NjozOFrOGEHyjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk3NTExOA==", "bodyText": "Use the short form?\nlogger.atInfo(\"service-set-state\").kv(\"newState\", newState).log();", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#discussion_r406975118", "createdAt": "2020-04-10T22:56:38Z", "author": {"login": "fengwang666"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -95,8 +94,7 @@ private void updateStateAndBroadcast(State newState) {\n         }\n \n         // TODO: Add validation\n-        logger.atInfo().setEventType(\"service-set-state\").kv(CURRENT_STATE_METRIC_NAME, currentState)\n-                .kv(\"newState\", newState).log();\n+        logger.atInfo().setEventType(\"service-set-state\").kv(\"newState\", newState).log();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f233853eb14a2a5a978409f7d0283da6e50fb94d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c9868928230a3f32cc18019f74a67a8fe5a00ce6", "committedDate": "2020-04-10T23:24:26Z", "message": "Cleanup service logging, address ignored InterruptedExceptions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c79cf9d4a9bed7c29a3528736b54f876a65230a5", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c79cf9d4a9bed7c29a3528736b54f876a65230a5", "committedDate": "2020-04-10T23:21:28Z", "message": "Merge branch 'master' into clean-log-interrupts"}, "afterCommit": {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6", "author": {"user": {"login": "MikeDombo", "name": "Michael Dombrowski"}}, "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c9868928230a3f32cc18019f74a67a8fe5a00ce6", "committedDate": "2020-04-10T23:24:26Z", "message": "Cleanup service logging, address ignored InterruptedExceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzEwMDk1", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#pullrequestreview-391710095", "createdAt": "2020-04-10T23:47:22Z", "commit": {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzEzOTYw", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#pullrequestreview-391713960", "createdAt": "2020-04-11T00:09:46Z", "commit": {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQwMDowOTo0NlrOGEIrdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQwMDowOTo0NlrOGEIrdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk4OTY4NQ==", "bodyText": "how does this fix the loop you mentioned, just curious. Wont the thread wait at stateEventQueue.take() anyway?", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#discussion_r406989685", "createdAt": "2020-04-11T00:09:46Z", "author": {"login": "fahadmohammed01"}, "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -290,8 +283,8 @@ private boolean handleCurrentStateBroken(Optional<State> desiredState) {\n         if (State.NEW.equals(desiredState.get())) {\n             updateStateAndBroadcast(State.NEW);\n         } else {\n-            logger.atError().setEventType(\"service-broken\")\n-                    .log(\"service is broken. Deployment is needed\");\n+            logger.atError(\"service-broken\").log(\"service is broken. Deployment is needed\");\n+            return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzE1MDgz", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/175#pullrequestreview-391715083", "createdAt": "2020-04-11T00:17:19Z", "commit": {"oid": "c9868928230a3f32cc18019f74a67a8fe5a00ce6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2105, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}