{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNDYzNzI1", "number": 874, "title": "Namedargs - built on top of Xiaochao's PR: #865", "bodyText": "", "createdAt": "2020-11-13T09:30:27Z", "url": "https://github.com/vmware/singleton/pull/874", "merged": true, "mergeCommit": {"oid": "4f707c8e9cf04f296a8307b259b7b41860a01ade"}, "closed": true, "closedAt": "2021-01-19T06:15:25Z", "author": {"login": "jessiejuachon"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZZc1mAH2gAyNTIwNDYzNzI1OjQzMWU2ZDM1YzFkNWNiY2NmOTM5MjFhM2EwM2U4M2VmMzEwMDkzNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdv96xogFqTU2Nzg3MDEzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "431e6d35c1d5cbccf93921a3a03e83ef31009357", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/431e6d35c1d5cbccf93921a3a03e83ef31009357", "committedDate": "2020-11-05T03:04:28Z", "message": "Add named arguments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c72af8d3f242261b31282cb817c58d46954f19a6", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/c72af8d3f242261b31282cb817c58d46954f19a6", "committedDate": "2020-11-05T03:06:37Z", "message": "Add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a28850b2d2d31643f490e92e59db9c183cd1f83", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/3a28850b2d2d31643f490e92e59db9c183cd1f83", "committedDate": "2020-11-06T01:59:06Z", "message": "ccc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe1fc98f0b311a7151c07e217465e7e6efa67f4f", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/fe1fc98f0b311a7151c07e217465e7e6efa67f4f", "committedDate": "2020-11-09T05:46:00Z", "message": "Merge remote-tracking branch 'remotes/upstream/g11n-java-client' into namedargs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "173181bfa04825a8e4dbeac881ff4106ddb0cf45", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/173181bfa04825a8e4dbeac881ff4106ddb0cf45", "committedDate": "2020-11-09T06:03:11Z", "message": "Change according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77ebef50f5b2c38072e644a7f83de5097f7b0717", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/77ebef50f5b2c38072e644a7f83de5097f7b0717", "committedDate": "2020-11-09T07:34:12Z", "message": "Remove messages == null because messages is never null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08ef7b6bc46ac5fb1bb03f3330117b1befcf3c05", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/08ef7b6bc46ac5fb1bb03f3330117b1befcf3c05", "committedDate": "2020-11-09T07:51:45Z", "message": "Extract a method to make code clear"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8187824d81840672c66dc23ab8f77c4ed7c06c70", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/8187824d81840672c66dc23ab8f77c4ed7c06c70", "committedDate": "2020-11-09T22:58:13Z", "message": "code suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb76545e1fa33113b4e29c20f0f968e6b2085f12", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/bb76545e1fa33113b4e29c20f0f968e6b2085f12", "committedDate": "2020-11-11T06:59:23Z", "message": "fix review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a867d9dbae7d362bee85b6daddc6a74a91fae965", "author": {"user": {"login": "Xiaochao8", "name": "Xiaochao Li"}}, "url": "https://github.com/vmware/singleton/commit/a867d9dbae7d362bee85b6daddc6a74a91fae965", "committedDate": "2020-11-11T07:02:15Z", "message": "minor change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8245cad7b348adb919d63417be9860888ea240f2", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/8245cad7b348adb919d63417be9860888ea240f2", "committedDate": "2020-11-13T02:45:09Z", "message": "code clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/946c59511e73bb0e37178dd25a1f448564d8cd96", "committedDate": "2020-11-13T02:49:24Z", "message": "Merge branch 'namedargs' into namedargs-jessie"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODY0Mjcx", "url": "https://github.com/vmware/singleton/pull/874#pullrequestreview-530864271", "createdAt": "2020-11-16T01:16:40Z", "commit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MDE4MTA4", "url": "https://github.com/vmware/singleton/pull/874#pullrequestreview-535018108", "createdAt": "2020-11-20T01:56:58Z", "commit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMTo1Njo1OFrOH26kvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMTo1Njo1OFrOH26kvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM0NDgyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private com.vmware.vipclient.i18n.messages.dto.MessagesDTO dto    = null;\n          \n          \n            \n                MessagesDTO dto = null;", "url": "https://github.com/vmware/singleton/pull/874#discussion_r527344828", "createdAt": "2020-11-20T01:56:58Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -23,7 +25,7 @@\n import org.slf4j.LoggerFactory;\n \n public class ComponentService {\n-    private MessagesDTO dto    = null;\n+    private com.vmware.vipclient.i18n.messages.dto.MessagesDTO dto    = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0MDgxMzM1", "url": "https://github.com/vmware/singleton/pull/874#pullrequestreview-564081335", "createdAt": "2021-01-08T08:33:02Z", "commit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwODozMzowMlrOIQJriw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwOToxODozMlrOIQLA8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgwNjczMQ==", "bodyText": "The premise for all codes after this line is source is not empty, so it's better use reverse judgment, suggest:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (source!=null && !source.isEmpty()) {\n          \n          \n            \n                    if (source==null || source.isEmpty()) {\n          \n          \n            \n                           return \"\";\n          \n          \n            \n                    }", "url": "https://github.com/vmware/singleton/pull/874#discussion_r553806731", "createdAt": "2021-01-08T08:33:02Z", "author": {"login": "huihuiw01"}, "path": "src/main/java/com/vmware/vipclient/i18n/base/instances/TranslationMessage.java", "diffHunk": "@@ -68,21 +56,48 @@ public TranslationMessage() {\n      * </ul>\n      */\n     public String getMessage(final Locale locale, final String component, final String key, final Object... args) {\n-    \t// Use source message if the message hasn't been collected/translated\n-    \tString source = getMessages(Locale.forLanguageTag(ConstantsKeys.SOURCE), component, false).get(key);\n-    \tString collectedSourceMsg = getMessages(LocaleUtility.getSourceLocale(), component, false).get(key);\n-    \tif (source!=null && !source.isEmpty() && !source.equals(collectedSourceMsg)) {\n-\t\t\treturn FormatUtils.format(source, LocaleUtility.getSourceLocale(), args);\n-\t\t}\n-    \t\n-    \tString message = FormatUtils.format(getMessages(locale, component).get(key), locale, args);\n-    \tif (message == null || message.isEmpty()) {\n-    \t\tthrow new VIPJavaClientException(FormatUtils.format(ConstantsMsg.GET_MESSAGE_FAILED, key, component, locale));\n-    \t}\n-    \t\n-    \treturn message;\n+    \treturn getMessageWithArgs(locale, component, key, args);\n     }\n-    \n+\n+    /**\n+     * Retrieves the localized message\n+     *\n+     * @param locale The locale in which the message is requested to be localized\n+     * @param component The Singleton component in which the message belongs\n+     * @param key The key that represents the message\n+     * @param args Named arguments to replace placeholders in the message with\n+     * @return One of the items in the following priority-ordered list:\n+     * @throws VIPJavaClientException If none from the list below is available\n+     * <ul>\n+     * \t\t<li>The source message, if source message hasn't been collected and translated</li>\n+     * \t\t<li>The message in the requested locale</li>\n+     * \t\t<li>The message in the next available fallback locale</li>\n+     * \t\t<li>The source message</li>\n+     * </ul>\n+     */\n+    public String getMessage(final Locale locale, final String component, final String key, final Map<String, Object> args) {\n+        return getMessageWithArgs(locale, component, key, args);\n+    }\n+\n+    private String getMessageWithArgs(final Locale locale, final String component, final String key, final Object args) {\n+        // Use source message if the message hasn't been collected/translated\n+        String source = getMessages(Locale.forLanguageTag(ConstantsKeys.SOURCE), component, false).getMessages().get(key);\n+        if (source!=null && !source.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgwODcyNA==", "bodyText": "How about adding 'locale' to MessageCacheItem instead of adding a new DTO object, and in that case you can avoid deprecating 'getMessages' methods and adding 'getTranslations' methods.", "url": "https://github.com/vmware/singleton/pull/874#discussion_r553808724", "createdAt": "2021-01-08T08:37:44Z", "author": {"login": "huihuiw01"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -71,36 +73,55 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \t}\n \n \t/**\n-\t * Get MessageCacheItem from cache.\n-\t * The cache is refreshed if MessageCacheItem is expired or not found.\n-\t * Pre-configured locale fallback queue is used on failure.\n+\t * @deprecated Use {@link #getTranslations()}.\n+\t */\n+\tpublic MessageCacheItem getMessages() {\n+\t\tIterator<Locale> fallbackLocalesIter = LocaleUtility.getFallbackLocales().iterator();\n+\t\treturn this.getMessages(fallbackLocalesIter);\n+\t}\n+\n+\t/**\n+\t * @deprecated Use {@link #getTranslations(Iterator)}.\n+\t */\n+\tpublic MessageCacheItem getMessages(Iterator<Locale> fallbackLocalesIter) {\n+\t\treturn new MessageCacheItem(this.getMessageCacheItem(fallbackLocalesIter).getMessages());\n+\t}\n+\n+\t/**\n+\t * Calls {@link #getTranslations(Iterator)} using the pre-configured locale fallback queue.\n \t *\n-\t * @return A MessageCacheItem whose message map is one of the items in the following priority-ordered list:\n+\t * @return A TranslationsDTO whose message map is one of the items in the following priority-ordered list:\n \t * <ul>\n \t * \t\t<li>The messages in the requested locale</li>\n-\t * \t\t<li>The messages in a default locale</li>\n+\t * \t\t<li>The messages in a fallback locale</li>\n \t * \t\t<li>The source messages</li>\n \t * \t\t<li>An empty map</li>\n \t * </ul>\n \t */\n-\tpublic MessageCacheItem getMessages() {\n+\tpublic TranslationsDTO getTranslations() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzgyODU5NQ==", "bodyText": "It's better add message fallback cases.", "url": "https://github.com/vmware/singleton/pull/874#discussion_r553828595", "createdAt": "2021-01-08T09:18:32Z", "author": {"login": "huihuiw01"}, "path": "src/test/java/com/vmware/vip/i18n/TranslationMessageTest.java", "diffHunk": "@@ -553,4 +553,22 @@ public void testGetSourcesOfMCompAndMLoc() {\n         // more cases to test cache\n         // more cases to test the message sending to server\n     }\n+\n+    @Test\n+    public void testNamedArgs() {\n+        String component = \"JAVA\";\n+        String key = \"NamedArgs\";\n+        Locale locale_en = new Locale(\"en\", \"US\");\n+        Locale locale_de = Locale.forLanguageTag(\"de\");\n+        Map<String, Object> msgArgs = new HashMap<>();\n+        msgArgs.put(\"start\", 1);\n+        msgArgs.put(\"to\", 5);\n+        msgArgs.put(\"total\", 10);\n+\n+        String message_en = translation.getMessage(locale_en, component, key, msgArgs);\n+        Assert.assertEquals(\"1 - 5 of 10 customers\", message_en);\n+\n+        String message_de = translation.getMessage(locale_de, component, key, msgArgs);\n+        Assert.assertEquals(\"1 - 5 of 10 kunden\", message_de);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3MzQ5OTEy", "url": "https://github.com/vmware/singleton/pull/874#pullrequestreview-567349912", "createdAt": "2021-01-13T15:41:10Z", "commit": {"oid": "946c59511e73bb0e37178dd25a1f448564d8cd96"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e58479a57f9d0c95d833ec3d23af758ea250a69", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/5e58479a57f9d0c95d833ec3d23af758ea250a69", "committedDate": "2021-01-13T16:35:59Z", "message": "Merge branch 'g11n-java-client' into namedargs-jessie"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66deb2e1b3a8f7ac37f4b0333e480f103a501918", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/66deb2e1b3a8f7ac37f4b0333e480f103a501918", "committedDate": "2021-01-13T16:38:24Z", "message": "Merge branch 'g11n-java-client' of github.com:vmware/singleton into namedargs-jessie"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cb00a0095bb73235a94920265000688059bc7f1", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/1cb00a0095bb73235a94920265000688059bc7f1", "committedDate": "2021-01-13T16:38:41Z", "message": "Merge branch 'namedargs-jessie' of github.com:jessiejuachon/singleton into namedargs-jessie"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3ODEwNzM0", "url": "https://github.com/vmware/singleton/pull/874#pullrequestreview-567810734", "createdAt": "2021-01-14T02:36:48Z", "commit": {"oid": "1cb00a0095bb73235a94920265000688059bc7f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3ODcwMTM0", "url": "https://github.com/vmware/singleton/pull/874#pullrequestreview-567870134", "createdAt": "2021-01-14T06:00:05Z", "commit": {"oid": "1cb00a0095bb73235a94920265000688059bc7f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4144, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}