{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MzQ4NDEz", "number": 556, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMzozNTozN1rOD9n_gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyODozNlrOD92htQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTQ0OTYxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/PatternService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMzozNTozN1rOGXOrDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNDoyMjo0MFrOGXPV3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAxMDgzMQ==", "bodyText": "are you sure locale.contains(\"en\") means the locale is default? A locale string could easily contain 'en'.", "url": "https://github.com/vmware/singleton/pull/556#discussion_r427010831", "createdAt": "2020-05-19T03:35:37Z", "author": {"login": "linr211"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/PatternService.java", "diffHunk": "@@ -63,7 +63,7 @@ public JSONObject getPatterns(String language, String region) {\n \n     private JSONObject getPatternsFromBundle(String locale) {\n         JSONObject patterns = null;\n-        if (LocaleUtility.isDefaultLocale(locale)) {\n+        if (LocaleUtility.isDefaultLocale(locale) || locale.contains(\"en\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4a388c17543e5197481497cdbc38c92da291ae6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAyMTc4OQ==", "bodyText": "Rolled back this change", "url": "https://github.com/vmware/singleton/pull/556#discussion_r427021789", "createdAt": "2020-05-19T04:22:40Z", "author": {"login": "jessiejuachon"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/PatternService.java", "diffHunk": "@@ -63,7 +63,7 @@ public JSONObject getPatterns(String language, String region) {\n \n     private JSONObject getPatternsFromBundle(String locale) {\n         JSONObject patterns = null;\n-        if (LocaleUtility.isDefaultLocale(locale)) {\n+        if (LocaleUtility.isDefaultLocale(locale) || locale.contains(\"en\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAxMDgzMQ=="}, "originalCommit": {"oid": "c4a388c17543e5197481497cdbc38c92da291ae6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MTc4NTg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/vmware/vipclient/i18n/messages/api/opt/local/LocalLocaleOpt.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToxOToxMlrOGXloGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToxOToxMlrOGXloGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM4NjkwNw==", "bodyText": "Merge this line and line 49 into one?", "url": "https://github.com/vmware/singleton/pull/556#discussion_r427386907", "createdAt": "2020-05-19T15:19:12Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/api/opt/local/LocalLocaleOpt.java", "diffHunk": "@@ -27,22 +32,37 @@\n     public Map<String, String> getLanguages(String displayLanguage) {\n    \n     \tMap<String, String> supportedLocales = new HashMap<String, String>();\n-    \tLocale inLocale = Locale.forLanguageTag(displayLanguage); \n-    \tString offlineResourcesBaseUrl = VIPCfg.getInstance().getOfflineResourcesBaseUrl();\n \t\ttry {\n-\t\t\tPath path = Paths.get(Thread.currentThread().getContextClassLoader().\n-\t\t\t\t\tgetResource(Paths.get(offlineResourcesBaseUrl).toString()).toURI());\n \t\t\t\n-\t\t\ttry (Stream<Path> listOfFiles = Files.walk(path).filter(p -> p.toFile().isFile())) {\n-\t\t\t\tlistOfFiles.map(file -> {\n-\t\t\t\t\tString fileName = file.getFileName().toString();\n-\t\t\t\t\treturn fileName.substring(BUNDLE_PREFIX.length(), fileName.indexOf('.'));\n-\t\t\t\t}).forEach(s->supportedLocales.put(s, Locale.forLanguageTag(s).getDisplayName(inLocale)));\n-\t\t\t}\t\t\n+\t\t\tPath path = Paths.get(VIPCfg.getInstance().getOfflineResourcesBaseUrl());\n+\t\t\t\n+\t\t\tURI uri = Thread.currentThread().getContextClassLoader().\n+\t\t\t\t\tgetResource(path.toString()).toURI();\n+\n+\t    \tif (uri.getScheme().equals(\"jar\")) {\n+\t    \t\ttry (FileSystem fileSystem = FileSystems.newFileSystem(uri, Collections.<String, Object>emptyMap())) {\n+\t    \t\t\tpath = fileSystem.getPath(path.toString());\n+\t    \t\t\tgetSupportedLocales(path, supportedLocales, displayLanguage);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "067d19d4bbd130bd36fd43d9c686fe8e1f22ef33"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MTc5MDQyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/vmware/vipclient/i18n/messages/api/opt/local/LocalMessagesOpt.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyMDoxMFrOGXlrCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyMDoxMFrOGXlrCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM4NzY1OA==", "bodyText": "Merge this line and line 70 into one?", "url": "https://github.com/vmware/singleton/pull/556#discussion_r427387658", "createdAt": "2020-05-19T15:20:10Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/api/opt/local/LocalMessagesOpt.java", "diffHunk": "@@ -46,13 +52,24 @@ public JSONObject getComponentMessages() {\n     public void getComponentMessages(MessageCacheItem cacheItem) {\n         Locale bestMatch = Locale.lookup(Arrays.asList(new Locale.LanguageRange((dto.getLocale()))),\n         \t\tgetSupportedLocales());\n-        \n \t\ttry {\n \t\t\tString filePath = FormatUtils.format(OFFLINE_RESOURCE_PATH, dto.getComponent(), bestMatch.toLanguageTag());\n-\t    \tPath path = Paths.get(VIPCfg.getInstance().getOfflineResourcesBaseUrl(), filePath);\n-\t\t\tpath = Paths.get(Thread.currentThread().getContextClassLoader().\n-\t\t\t\t\tgetResource(path.toString()).toURI());\n-\t\t\tMap<String, String> messages = JSONBundleUtil.getMessages(path);\n+\t\t\tPath path = Paths.get(VIPCfg.getInstance().getOfflineResourcesBaseUrl(), filePath);\n+\t\t\t\n+\t\t\tURI uri = Thread.currentThread().getContextClassLoader().\n+\t\t\t\t\tgetResource(path.toString()).toURI();\n+\t\t\t\n+\t\t\tMap<String, String> messages = null;\n+\t    \tif (uri.getScheme().equals(\"jar\")) {\n+\t\t\t\ttry(FileSystem fileSystem = FileSystems.newFileSystem(uri, Collections.<String, Object>emptyMap())) {\n+\t\t\t\t\tpath = fileSystem.getPath(path.toString());\n+\t\t\t\t\tmessages = JSONBundleUtil.getMessages(path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "067d19d4bbd130bd36fd43d9c686fe8e1f22ef33"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MTgzMDkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/PatternService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyODozNlrOGXmEdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyODozNlrOGXmEdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5NDE2Ng==", "bodyText": "This line is unnecessary.", "url": "https://github.com/vmware/singleton/pull/556#discussion_r427394166", "createdAt": "2020-05-19T15:28:36Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/PatternService.java", "diffHunk": "@@ -4,6 +4,8 @@\n  */\n package com.vmware.vipclient.i18n.messages.service;\n \n+import java.util.Locale;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "067d19d4bbd130bd36fd43d9c686fe8e1f22ef33"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4600, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}