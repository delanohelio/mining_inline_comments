{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MTc3Mzc5", "number": 829, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMTozODo1NlrOEvkIsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo0NzoxOVrOEv2njg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MzEwNTc5OnYy", "diffSide": "LEFT", "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwMTozODo1NlrOHkndAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMToxMjowM1rOHmFrcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1NzE4Nw==", "bodyText": "I don't agree. By setCacheItem, it can be null.", "url": "https://github.com/vmware/singleton/pull/829#discussion_r508157187", "createdAt": "2020-10-20T01:38:56Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "diffHunk": "@@ -73,18 +73,8 @@ public synchronized boolean isExpired() {\n     \tif (VIPCfg.getInstance().getCacheExpiredTime() != 0) {\n     \t\treturn false;\n     \t}\n-    \t\n-    \tLong responseTimeStamp = this.getTimestamp();\n-    \tif (responseTimeStamp == null) {\n-    \t\treturn true;\n-    \t}\n-    \t\n-    \tLong maxAgeResponse = this.getMaxAgeMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24272a6ef97d979921d84cd92a23240d17ab06e8"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4NzA1OQ==", "bodyText": "Do you mean the timestamp property? Its type is long, not Long. The default value of long is 0. It cannot be null because it is not a Java object.\nIf the value is zero, then System.currentTimeMillis() - this.getTimestamp() > this.getMaxAgeMillis() will be true", "url": "https://github.com/vmware/singleton/pull/829#discussion_r508787059", "createdAt": "2020-10-20T19:33:26Z", "author": {"login": "jessiejuachon"}, "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "diffHunk": "@@ -73,18 +73,8 @@ public synchronized boolean isExpired() {\n     \tif (VIPCfg.getInstance().getCacheExpiredTime() != 0) {\n     \t\treturn false;\n     \t}\n-    \t\n-    \tLong responseTimeStamp = this.getTimestamp();\n-    \tif (responseTimeStamp == null) {\n-    \t\treturn true;\n-    \t}\n-    \t\n-    \tLong maxAgeResponse = this.getMaxAgeMillis();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1NzE4Nw=="}, "originalCommit": {"oid": "24272a6ef97d979921d84cd92a23240d17ab06e8"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk1MDIxNg==", "bodyText": "I mean maxAgeMillis. It's Long type.", "url": "https://github.com/vmware/singleton/pull/829#discussion_r508950216", "createdAt": "2020-10-21T02:25:07Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "diffHunk": "@@ -73,18 +73,8 @@ public synchronized boolean isExpired() {\n     \tif (VIPCfg.getInstance().getCacheExpiredTime() != 0) {\n     \t\treturn false;\n     \t}\n-    \t\n-    \tLong responseTimeStamp = this.getTimestamp();\n-    \tif (responseTimeStamp == null) {\n-    \t\treturn true;\n-    \t}\n-    \t\n-    \tLong maxAgeResponse = this.getMaxAgeMillis();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1NzE4Nw=="}, "originalCommit": {"oid": "24272a6ef97d979921d84cd92a23240d17ab06e8"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTcwMDk3OA==", "bodyText": "How can it be null? There are 3 setCacheItem methods: lines 33, 38 and 46. All of them eventually execute lines 42-43:\nif (maxAgeMillis != null) this.maxAgeMillis = maxAgeMillis;\nSo if the maxAgeMillis parameter in any setCacheItem method is null, MessageCacheItem.maxAgeMillis will retain its initialization value which is 86400000l (in line 29)", "url": "https://github.com/vmware/singleton/pull/829#discussion_r509700978", "createdAt": "2020-10-21T21:12:03Z", "author": {"login": "jessiejuachon"}, "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "diffHunk": "@@ -73,18 +73,8 @@ public synchronized boolean isExpired() {\n     \tif (VIPCfg.getInstance().getCacheExpiredTime() != 0) {\n     \t\treturn false;\n     \t}\n-    \t\n-    \tLong responseTimeStamp = this.getTimestamp();\n-    \tif (responseTimeStamp == null) {\n-    \t\treturn true;\n-    \t}\n-    \t\n-    \tLong maxAgeResponse = this.getMaxAgeMillis();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1NzE4Nw=="}, "originalCommit": {"oid": "24272a6ef97d979921d84cd92a23240d17ab06e8"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NjEzMzkwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo0NzoxOVrOHlEfHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozMDo1MFrOHlN0Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYzMjg2MA==", "bodyText": "Same comment with xiaochao's comment to my PR:\n\nchange '>' to '>=';\nadd this line to synchronized block, or the timestamp and the maxAgeMillis may not match.", "url": "https://github.com/vmware/singleton/pull/829#discussion_r508632860", "createdAt": "2020-10-20T15:47:19Z", "author": {"login": "huihuiw01"}, "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "diffHunk": "@@ -73,18 +73,8 @@ public synchronized boolean isExpired() {\n     \tif (VIPCfg.getInstance().getCacheExpiredTime() != 0) {\n     \t\treturn false;\n     \t}\n-    \t\n-    \tLong responseTimeStamp = this.getTimestamp();\n-    \tif (responseTimeStamp == null) {\n-    \t\treturn true;\n-    \t}\n-    \t\n-    \tLong maxAgeResponse = this.getMaxAgeMillis();\n-    \tif (maxAgeResponse != null) {\n-    \t\tmaxAgeMillis = maxAgeResponse;\n-    \t}\n-    \t\t  \t\n-    \treturn System.currentTimeMillis() - responseTimeStamp > maxAgeMillis;\n+\n+    \treturn System.currentTimeMillis() - this.getTimestamp() > this.getMaxAgeMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24272a6ef97d979921d84cd92a23240d17ab06e8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4NTcwNg==", "bodyText": "Yes, I have that listed for another PR because it changes the logic somehow, but sure, I can change it here already. It's very minor anyway.\nThe while method is already synchronized. Nonetheless, it is also not related to the PR.", "url": "https://github.com/vmware/singleton/pull/829#discussion_r508785706", "createdAt": "2020-10-20T19:30:50Z", "author": {"login": "jessiejuachon"}, "path": "src/main/java/com/vmware/vipclient/i18n/base/cache/MessageCacheItem.java", "diffHunk": "@@ -73,18 +73,8 @@ public synchronized boolean isExpired() {\n     \tif (VIPCfg.getInstance().getCacheExpiredTime() != 0) {\n     \t\treturn false;\n     \t}\n-    \t\n-    \tLong responseTimeStamp = this.getTimestamp();\n-    \tif (responseTimeStamp == null) {\n-    \t\treturn true;\n-    \t}\n-    \t\n-    \tLong maxAgeResponse = this.getMaxAgeMillis();\n-    \tif (maxAgeResponse != null) {\n-    \t\tmaxAgeMillis = maxAgeResponse;\n-    \t}\n-    \t\t  \t\n-    \treturn System.currentTimeMillis() - responseTimeStamp > maxAgeMillis;\n+\n+    \treturn System.currentTimeMillis() - this.getTimestamp() > this.getMaxAgeMillis();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYzMjg2MA=="}, "originalCommit": {"oid": "24272a6ef97d979921d84cd92a23240d17ab06e8"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4352, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}