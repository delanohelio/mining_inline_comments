{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MTYzMzEy", "number": 813, "title": "Fix for bug 812 G11n-java-client New workflow's Translation.getMessage must be able to use latest source messages from VIP service", "bodyText": "Fix for bug 812: G11n-java-client New workflow's Translation.getMessage must be able to fallback to \"latest\" messages from VIP service if messages_source.json is not present locally(offline) in the client", "createdAt": "2020-10-02T22:35:37Z", "url": "https://github.com/vmware/singleton/pull/813", "merged": true, "mergeCommit": {"oid": "bfb7deb14393b24c26d37301d5a18b44ab1b1b23"}, "closed": true, "closedAt": "2020-10-14T23:06:59Z", "author": {"login": "jessiejuachon"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOtzxTgH2gAyNDk3MTYzMzEyOmRhYTZiMTNiMDljZmU3NzQ3ZTNmYmRmODk3NjBjYzgzZTE3YjYxY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSZs2MgFqTUwODE1NzY2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "daa6b13b09cfe7747e3fbdf89760cc83e17b61cd", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/daa6b13b09cfe7747e3fbdf89760cc83e17b61cd", "committedDate": "2020-10-02T22:34:27Z", "message": "Fix for bug 812 G11n-java-client New workflow's Translation.getMessage must be able to fallback to \"latest\" messages from VIP service if messages_source.json is not present locally(offline) in the client"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTQ1NTMz", "url": "https://github.com/vmware/singleton/pull/813#pullrequestreview-501545533", "createdAt": "2020-10-03T13:18:44Z", "commit": {"oid": "daa6b13b09cfe7747e3fbdf89760cc83e17b61cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMzoxODo0NFrOHcBiHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMzoxODo0NFrOHcBiHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NzI5Mw==", "bodyText": "If getting latest feom service successfully, is it still necessary to get from local?", "url": "https://github.com/vmware/singleton/pull/813#discussion_r499147293", "createdAt": "2020-10-03T13:18:44Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,24 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(\"source\")) {\n+\t\t\tdto.setLocale(\"latest\");\n+\t\t}\n \t\tdataSource.createMessageOpt(dto).getComponentMessages(cacheItem);\n \t\tlong timestamp = cacheItem.getTimestamp();\n \t\tif (timestampOld == timestamp) {\n \t\t\tlogger.debug(FormatUtils.format(ConstantsMsg.GET_MESSAGES_FAILED, dto.getComponent(), dto.getLocale(), dataSource.toString()));\n \t\t}\n+\t\tdto.setLocale(localeOrig);\n \n-\t\t// If timestamp is not 0, it means that cacheItem is in the cache already.\n-\t\t// Otherwise, try the next dataSource in the queue.\n-\t\tif (timestamp == 0) {\n+\t\t// If timestamp is 0, it means that cacheItem not yet in cache. So try the next data source.\n+\t\t// If locale is \"source\", use messages from DatasourceEnum.Bundle data store if it exists.\n+\t\tif (timestamp == 0 || dto.getLocale().equals(\"source\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daa6b13b09cfe7747e3fbdf89760cc83e17b61cd"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc6c88ad9ebd8040e0cc892fb3265187dd0ae292", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/bc6c88ad9ebd8040e0cc892fb3265187dd0ae292", "committedDate": "2020-10-03T21:50:52Z", "message": "code clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dc086d0c923729f53c4d91bc75062ee5908cebf", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/9dc086d0c923729f53c4d91bc75062ee5908cebf", "committedDate": "2020-10-05T20:15:50Z", "message": "Making the fallback behavior for \"source\" consistent with all locales (i.e. service first then local)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bf3d5367b6619935963275eddadd5dd2c8931ae", "author": {"user": {"login": "jessiejuachon", "name": "JESSIELY JUACHON"}}, "url": "https://github.com/vmware/singleton/commit/2bf3d5367b6619935963275eddadd5dd2c8931ae", "committedDate": "2020-10-05T21:07:35Z", "message": "Fixing a typo error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MjcyODYw", "url": "https://github.com/vmware/singleton/pull/813#pullrequestreview-506272860", "createdAt": "2020-10-12T03:36:09Z", "commit": {"oid": "2bf3d5367b6619935963275eddadd5dd2c8931ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDE4MTE2", "url": "https://github.com/vmware/singleton/pull/813#pullrequestreview-507018116", "createdAt": "2020-10-13T01:57:40Z", "commit": {"oid": "2bf3d5367b6619935963275eddadd5dd2c8931ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMTo1Nzo0MFrOHgSvKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMTo1Nzo0MFrOHgSvKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYyMzQ2Ng==", "bodyText": "Is it better unify the message file suffix in Singleton service and local bundle either to 'latest' or to 'source', then add the unified suffix to the fallback queue, in this case you needn't judge the data source and the requested locale here.", "url": "https://github.com/vmware/singleton/pull/813#discussion_r503623466", "createdAt": "2020-10-13T01:57:40Z", "author": {"login": "huihuiw01"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,23 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(ConstantsKeys.SOURCE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bf3d5367b6619935963275eddadd5dd2c8931ae"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTU3NjY0", "url": "https://github.com/vmware/singleton/pull/813#pullrequestreview-508157664", "createdAt": "2020-10-14T09:24:29Z", "commit": {"oid": "2bf3d5367b6619935963275eddadd5dd2c8931ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4089, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}