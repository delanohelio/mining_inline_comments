{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MTYzMzEy", "number": 813, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMzoxODo0NFrOEqBDLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMTo1Nzo0MFrOEs1kQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNDkyODQ2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMzoxODo0NFrOHcBiHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMDoxNDozM1rOHcsLXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NzI5Mw==", "bodyText": "If getting latest feom service successfully, is it still necessary to get from local?", "url": "https://github.com/vmware/singleton/pull/813#discussion_r499147293", "createdAt": "2020-10-03T13:18:44Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,24 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(\"source\")) {\n+\t\t\tdto.setLocale(\"latest\");\n+\t\t}\n \t\tdataSource.createMessageOpt(dto).getComponentMessages(cacheItem);\n \t\tlong timestamp = cacheItem.getTimestamp();\n \t\tif (timestampOld == timestamp) {\n \t\t\tlogger.debug(FormatUtils.format(ConstantsMsg.GET_MESSAGES_FAILED, dto.getComponent(), dto.getLocale(), dataSource.toString()));\n \t\t}\n+\t\tdto.setLocale(localeOrig);\n \n-\t\t// If timestamp is not 0, it means that cacheItem is in the cache already.\n-\t\t// Otherwise, try the next dataSource in the queue.\n-\t\tif (timestamp == 0) {\n+\t\t// If timestamp is 0, it means that cacheItem not yet in cache. So try the next data source.\n+\t\t// If locale is \"source\", use messages from DatasourceEnum.Bundle data store if it exists.\n+\t\tif (timestamp == 0 || dto.getLocale().equals(\"source\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daa6b13b09cfe7747e3fbdf89760cc83e17b61cd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE4NDgyOA==", "bodyText": "I am not so sure, actually. Is there a use case where a string has been updated only in local and not yet in remote? If yes, should the client use the local message or wait until message in service is updated?", "url": "https://github.com/vmware/singleton/pull/813#discussion_r499184828", "createdAt": "2020-10-03T21:53:21Z", "author": {"login": "jessiejuachon"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,24 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(\"source\")) {\n+\t\t\tdto.setLocale(\"latest\");\n+\t\t}\n \t\tdataSource.createMessageOpt(dto).getComponentMessages(cacheItem);\n \t\tlong timestamp = cacheItem.getTimestamp();\n \t\tif (timestampOld == timestamp) {\n \t\t\tlogger.debug(FormatUtils.format(ConstantsMsg.GET_MESSAGES_FAILED, dto.getComponent(), dto.getLocale(), dataSource.toString()));\n \t\t}\n+\t\tdto.setLocale(localeOrig);\n \n-\t\t// If timestamp is not 0, it means that cacheItem is in the cache already.\n-\t\t// Otherwise, try the next dataSource in the queue.\n-\t\tif (timestamp == 0) {\n+\t\t// If timestamp is 0, it means that cacheItem not yet in cache. So try the next data source.\n+\t\t// If locale is \"source\", use messages from DatasourceEnum.Bundle data store if it exists.\n+\t\tif (timestamp == 0 || dto.getLocale().equals(\"source\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NzI5Mw=="}, "originalCommit": {"oid": "daa6b13b09cfe7747e3fbdf89760cc83e17b61cd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE5NzUzNw==", "bodyText": "If you think locale take priority over remote, then you should get from local first, then remote. Don't need to get from service first then get from local.", "url": "https://github.com/vmware/singleton/pull/813#discussion_r499197537", "createdAt": "2020-10-04T02:01:06Z", "author": {"login": "Xiaochao8"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,24 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(\"source\")) {\n+\t\t\tdto.setLocale(\"latest\");\n+\t\t}\n \t\tdataSource.createMessageOpt(dto).getComponentMessages(cacheItem);\n \t\tlong timestamp = cacheItem.getTimestamp();\n \t\tif (timestampOld == timestamp) {\n \t\t\tlogger.debug(FormatUtils.format(ConstantsMsg.GET_MESSAGES_FAILED, dto.getComponent(), dto.getLocale(), dataSource.toString()));\n \t\t}\n+\t\tdto.setLocale(localeOrig);\n \n-\t\t// If timestamp is not 0, it means that cacheItem is in the cache already.\n-\t\t// Otherwise, try the next dataSource in the queue.\n-\t\tif (timestamp == 0) {\n+\t\t// If timestamp is 0, it means that cacheItem not yet in cache. So try the next data source.\n+\t\t// If locale is \"source\", use messages from DatasourceEnum.Bundle data store if it exists.\n+\t\tif (timestamp == 0 || dto.getLocale().equals(\"source\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NzI5Mw=="}, "originalCommit": {"oid": "daa6b13b09cfe7747e3fbdf89760cc83e17b61cd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg0NTk4Mg==", "bodyText": "I have studied existing use cases and official g11n testing happens with remote (VIP service) messages. As a conclusion, we will keep the behavior consistent with the behavior for all locales: Pull from remote(priority) when remote is available, from local only if remote is not available/not supported. I'll remove the change from line 70.", "url": "https://github.com/vmware/singleton/pull/813#discussion_r499845982", "createdAt": "2020-10-05T20:14:33Z", "author": {"login": "jessiejuachon"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,24 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(\"source\")) {\n+\t\t\tdto.setLocale(\"latest\");\n+\t\t}\n \t\tdataSource.createMessageOpt(dto).getComponentMessages(cacheItem);\n \t\tlong timestamp = cacheItem.getTimestamp();\n \t\tif (timestampOld == timestamp) {\n \t\t\tlogger.debug(FormatUtils.format(ConstantsMsg.GET_MESSAGES_FAILED, dto.getComponent(), dto.getLocale(), dataSource.toString()));\n \t\t}\n+\t\tdto.setLocale(localeOrig);\n \n-\t\t// If timestamp is not 0, it means that cacheItem is in the cache already.\n-\t\t// Otherwise, try the next dataSource in the queue.\n-\t\tif (timestamp == 0) {\n+\t\t// If timestamp is 0, it means that cacheItem not yet in cache. So try the next data source.\n+\t\t// If locale is \"source\", use messages from DatasourceEnum.Bundle data store if it exists.\n+\t\tif (timestamp == 0 || dto.getLocale().equals(\"source\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0NzI5Mw=="}, "originalCommit": {"oid": "daa6b13b09cfe7747e3fbdf89760cc83e17b61cd"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NDUwNDM1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMTo1Nzo0MFrOHgSvKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzoxODowOVrOHgxf4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYyMzQ2Ng==", "bodyText": "Is it better unify the message file suffix in Singleton service and local bundle either to 'latest' or to 'source', then add the unified suffix to the fallback queue, in this case you needn't judge the data source and the requested locale here.", "url": "https://github.com/vmware/singleton/pull/813#discussion_r503623466", "createdAt": "2020-10-13T01:57:40Z", "author": {"login": "huihuiw01"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,23 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(ConstantsKeys.SOURCE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bf3d5367b6619935963275eddadd5dd2c8931ae"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyNzQ1Nw==", "bodyText": "Yes, we will do that later on. We shall officially use \"source\" in the service (new version). Then in the client libraries, we have to support both versions of VIP service (old version with \"latest\" for backwards compatibility, and new version with \"source\").\nIn the meantime, for compatibility with current VIP service, we have to add this line.", "url": "https://github.com/vmware/singleton/pull/813#discussion_r504127457", "createdAt": "2020-10-13T17:18:09Z", "author": {"login": "jessiejuachon"}, "path": "src/main/java/com/vmware/vipclient/i18n/messages/service/ComponentService.java", "diffHunk": "@@ -54,18 +54,23 @@ private void refreshCacheItem(final MessageCacheItem cacheItem, Iterator<DataSou\n \n \t\tlong timestampOld = cacheItem.getTimestamp();\n \t\tDataSourceEnum dataSource = msgSourceQueueIter.next();\n+\t\tString localeOrig = dto.getLocale();\n+\t\tif (dataSource.equals(DataSourceEnum.VIP) && dto.getLocale().equals(ConstantsKeys.SOURCE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYyMzQ2Ng=="}, "originalCommit": {"oid": "2bf3d5367b6619935963275eddadd5dd2c8931ae"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4342, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}