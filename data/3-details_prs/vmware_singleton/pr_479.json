{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNTgxODQ3", "number": 479, "title": "[JsClient] Support downloading both translations and patterns by only\u2026", "bodyText": "\u2026 one request to Singleton Service", "createdAt": "2020-03-25T13:17:23Z", "url": "https://github.com/vmware/singleton/pull/479", "merged": true, "mergeCommit": {"oid": "39cf0f80875620f41d26b02bb353e201b03b92f6"}, "closed": true, "closedAt": "2020-04-23T02:34:30Z", "author": {"login": "songjiang320"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRlRKtAH2gAyMzkzNTgxODQ3OjVhYjYyZDdmNmJmOThiMWVlNzg0YWMxNzc4NmU4NTY2N2UzYzFhN2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaTiy_gFqTM5ODcxODU0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ab62d7f6bf98b1ee784ac17786e85667e3c1a7f", "author": {"user": {"login": "sjiang-cb", "name": "Song Jiang"}}, "url": "https://github.com/vmware/singleton/commit/5ab62d7f6bf98b1ee784ac17786e85667e3c1a7f", "committedDate": "2020-03-27T00:08:02Z", "message": "[JsClient] Support downloading both translations and patterns by only one request to Singleton Service"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MjQ2NjA2", "url": "https://github.com/vmware/singleton/pull/479#pullrequestreview-394246606", "createdAt": "2020-04-16T01:50:32Z", "commit": {"oid": "cf7764c94ca6206c3153473878b857133d26be9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMTo1MDozMlrOGGRoRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMTo1MDozMlrOGGRoRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIzMzQ3OQ==", "bodyText": "Logically, translation and pattern data validation should not be nested.", "url": "https://github.com/vmware/singleton/pull/479#discussion_r409233479", "createdAt": "2020-04-16T01:50:32Z", "author": {"login": "wangyi-e"}, "path": "src/services/core.service.ts", "diffHunk": "@@ -184,6 +198,35 @@ export class CoreService {\n             }).catch((err: any) => { this.logger.error('Load translations failed.', err.message); });\n     }\n \n+    public loadTranslationsAndPattern(language: string, region: string): Promise<any> | Promise<any>[] {\n+        const cachePattern = this.cacheManager.lookforPattern(language, region);\n+        if (typeof cachePattern !== 'undefined') {\n+            const cacheTranslation = this.cacheManager.lookforTranslationByComponent(this.config.component, language);\n+            if (typeof cacheTranslation === 'undefined') {\n+                return Promise.resolve({\n+                    components: [cacheTranslation],\n+                    pattern: cachePattern\n+                });\n+            }\n+        }\n+\n+        const url = this.getI18nResourceUrl(language, region);\n+        const promise = this.coreLoader.getI18nResource(url, this.httpOptions);\n+        return promise.then(\n+            (result: any) => {\n+                const translations = this.resParser.getTranslations(result);\n+                if (translations) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf7764c94ca6206c3153473878b857133d26be9f"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MjQ4NjM1", "url": "https://github.com/vmware/singleton/pull/479#pullrequestreview-394248635", "createdAt": "2020-04-16T01:57:19Z", "commit": {"oid": "cf7764c94ca6206c3153473878b857133d26be9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMTo1NzoxOVrOGGRvqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMTo1NzoxOVrOGGRvqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIzNTM2OQ==", "bodyText": "If this data can be checked in advance to keep loadTranslationsAndPattern clean.\nThe translation and pattern data validation should not be nested.", "url": "https://github.com/vmware/singleton/pull/479#discussion_r409235369", "createdAt": "2020-04-16T01:57:19Z", "author": {"login": "wangyi-e"}, "path": "src/services/core.service.ts", "diffHunk": "@@ -184,6 +198,35 @@ export class CoreService {\n             }).catch((err: any) => { this.logger.error('Load translations failed.', err.message); });\n     }\n \n+    public loadTranslationsAndPattern(language: string, region: string): Promise<any> | Promise<any>[] {\n+        const cachePattern = this.cacheManager.lookforPattern(language, region);\n+        if (typeof cachePattern !== 'undefined') {\n+            const cacheTranslation = this.cacheManager.lookforTranslationByComponent(this.config.component, language);\n+            if (typeof cacheTranslation === 'undefined') {\n+                return Promise.resolve({\n+                    components: [cacheTranslation],\n+                    pattern: cachePattern\n+                });\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf7764c94ca6206c3153473878b857133d26be9f"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a94f4bdd4790596bc796918d6aac5ac76bd71e7", "author": {"user": {"login": "sjiang-cb", "name": "Song Jiang"}}, "url": "https://github.com/vmware/singleton/commit/6a94f4bdd4790596bc796918d6aac5ac76bd71e7", "committedDate": "2020-04-18T12:29:15Z", "message": "Fix smoke test issue due to uri space in &region=${region}"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDA3NDg4", "url": "https://github.com/vmware/singleton/pull/479#pullrequestreview-398407488", "createdAt": "2020-04-22T17:18:12Z", "commit": {"oid": "45f9c36dd135ce4cd4292a515bffb631e56419f8"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d500d2cb7347220d99f7395b1f736526d03d422", "author": {"user": {"login": "sjiang-cb", "name": "Song Jiang"}}, "url": "https://github.com/vmware/singleton/commit/1d500d2cb7347220d99f7395b1f736526d03d422", "committedDate": "2020-04-23T01:58:36Z", "message": "When plural message falls back to 'en', the Number formatting in it will follow Region pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NzE4MDMy", "url": "https://github.com/vmware/singleton/pull/479#pullrequestreview-398718032", "createdAt": "2020-04-23T02:32:33Z", "commit": {"oid": "1d500d2cb7347220d99f7395b1f736526d03d422"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NzE4NTQ4", "url": "https://github.com/vmware/singleton/pull/479#pullrequestreview-398718548", "createdAt": "2020-04-23T02:34:19Z", "commit": {"oid": "1d500d2cb7347220d99f7395b1f736526d03d422"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4324, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}