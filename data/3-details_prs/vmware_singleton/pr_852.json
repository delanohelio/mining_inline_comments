{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzNzg5MDI1", "number": 852, "title": "remove the l10n  locale list match validate  ", "bodyText": "", "createdAt": "2020-11-02T05:10:12Z", "url": "https://github.com/vmware/singleton/pull/852", "merged": true, "mergeCommit": {"oid": "b591567690ed43724ea0346396a75facb7b228fb"}, "closed": true, "closedAt": "2020-11-03T10:02:36Z", "author": {"login": "tigershi"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYdSjoAH2gAyNTEzNzg5MDI1OjY0ZTg0ZDMwMWQzNzljZjI0OTBhOWEyZjI4NjJjYTg0ZDAzYWVkMjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY2JougFqTUyMjMzNjU5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20", "author": {"user": {"login": "tigershi", "name": "tigershi"}}, "url": "https://github.com/vmware/singleton/commit/64e84d301d379cf2490a9a2f2862ca84d03aed20", "committedDate": "2020-11-02T04:58:56Z", "message": "add the locale validate switch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDIxNzc3", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-521421777", "createdAt": "2020-11-02T08:38:22Z", "commit": {"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODozODoyMlrOHr6pkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODozODoyMlrOHr6pkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMTcyOA==", "bodyText": "Is it possible to use sourceLocales directly without adding a new parameter: sourceLocalesStr?", "url": "https://github.com/vmware/singleton/pull/852#discussion_r515811728", "createdAt": "2020-11-02T08:38:22Z", "author": {"login": "chaoq0318"}, "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -31,11 +31,13 @@\n \t\n \tprivate static Logger LOGGER = LoggerFactory.getLogger(CollectSourceValidationInterceptor.class);\n \t\n-\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap) {\n+\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap, String sourceLocalesStr) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDI3NTYx", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-521427561", "createdAt": "2020-11-02T08:46:52Z", "commit": {"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDM0MDYw", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-521434060", "createdAt": "2020-11-02T08:56:07Z", "commit": {"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo1NjowOFrOHr7PEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo1NzowM1rOHr7Q-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTMyOQ==", "bodyText": "Need to know the purposes of sourceLocales and sourceLocaleStr.", "url": "https://github.com/vmware/singleton/pull/852#discussion_r515821329", "createdAt": "2020-11-02T08:56:08Z", "author": {"login": "Xiaochao8"}, "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -31,11 +31,13 @@\n \t\n \tprivate static Logger LOGGER = LoggerFactory.getLogger(CollectSourceValidationInterceptor.class);\n \t\n-\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap) {\n+\tpublic CollectSourceValidationInterceptor(List<String> sourceLocales, Map<String, List<String>> allowListMap, String sourceLocalesStr) {\n \t\tthis.sourceLocales = sourceLocales;\n \t\tthis.allowList = allowListMap;\n+\t\tthis.sourceLocalesStr = sourceLocalesStr;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyMTgxOQ==", "bodyText": "It's strange to use argument of index 0 to judge.", "url": "https://github.com/vmware/singleton/pull/852#discussion_r515821819", "createdAt": "2020-11-02T08:57:03Z", "author": {"login": "Xiaochao8"}, "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,8 +183,9 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64e84d301d379cf2490a9a2f2862ca84d03aed20"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7de2712a402353de9f7a2a8e84e37f5527e1cd99", "author": {"user": {"login": "tigershi", "name": "tigershi"}}, "url": "https://github.com/vmware/singleton/commit/7de2712a402353de9f7a2a8e84e37f5527e1cd99", "committedDate": "2020-11-03T03:28:14Z", "message": "fixed the comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8241a0fdb29905e784d61408f3e219533014c38", "author": {"user": {"login": "tigershi", "name": "tigershi"}}, "url": "https://github.com/vmware/singleton/commit/b8241a0fdb29905e784d61408f3e219533014c38", "committedDate": "2020-11-03T03:33:14Z", "message": "fixed the comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5344713898379b29cf0599792e805545e5158ef", "author": {"user": {"login": "tigershi", "name": "tigershi"}}, "url": "https://github.com/vmware/singleton/commit/d5344713898379b29cf0599792e805545e5158ef", "committedDate": "2020-11-03T03:35:46Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjA0MjI4", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-522204228", "createdAt": "2020-11-03T05:57:48Z", "commit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo1Nzo0OFrOHshDEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo1Nzo0OFrOHshDEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0MDg0OA==", "bodyText": "Maybe we can use StringUtils.join directly, such as\nreturn StringUtils.join(sourceLocaleList, ConstantsChar.COMMA + ConstantsChar.SPACING);", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516440848", "createdAt": "2020-11-03T05:57:48Z", "author": {"login": "chaoq0318"}, "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,11 +182,24 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {\n+\t\t\tthrow new VIPAPIException(String.format(ValidationMsg.LOCALENAME_ONLY_SUPPORTED, getSourceSupportLocales(sourceLocales2)));\n \t\t}\n \t}\n \n+\tprivate static String getSourceSupportLocales(List<String> sourceLocaleList) {\n+\t\tif(sourceLocaleList == null || sourceLocaleList.size() == 0) {\n+\t\t\treturn \"\";\n+\t\t}\n+\t\tStringBuilder sb = new StringBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjIyMzE4", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-522222318", "createdAt": "2020-11-03T06:55:20Z", "commit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNjo1NToyMFrOHsh8pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzowNToxNVrOHsiHvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1NTU5MA==", "bodyText": "What locale?", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516455590", "createdAt": "2020-11-03T06:55:20Z", "author": {"login": "Xiaochao8"}, "path": "g11n-ws/vip-common/src/main/java/com/vmware/vip/common/constants/ValidationMsg.java", "diffHunk": "@@ -26,4 +26,5 @@\n \tpublic final static String PATTERN_NOT_VALIDE = \"Incorrect pattern(only allows letter)\";\n \tpublic final static String PRODUCTNAME_NOT_SUPPORTED = \"The product '%s' is NOT supported yet!\";\n \tpublic final static String LOCALENAME_NOT_SUPPORTED = \"The locale '%s' is NOT supported yet!\";\n+\tpublic final static String LOCALENAME_ONLY_SUPPORTED = \"The locale only support( '%s' )!\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1ODQyOA==", "bodyText": "If sourceLocales2 is empty, don't need to verify the locale. Is this more reasonable?", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516458428", "createdAt": "2020-11-03T07:05:15Z", "author": {"login": "Xiaochao8"}, "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,11 +182,24 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjI3NTgz", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-522227583", "createdAt": "2020-11-03T07:08:57Z", "commit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzowODo1N1rOHsiMNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzowODo1N1rOHsiMNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1OTU3NQ==", "bodyText": "To improve performance, it's better to prepare the supported locale string when application starts up.", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516459575", "createdAt": "2020-11-03T07:08:57Z", "author": {"login": "Xiaochao8"}, "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -181,11 +182,24 @@ private static void validateLocale(HttpServletRequest request, List<String> sour\n \t\t}\n \t\tif (!RegExpValidatorUtils.IsLetterAndNumberAndValidchar(locale)) {\n \t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n-\t\t}else if (!sourceLocales2.contains(locale)) {\n-\t\t\tthrow new VIPAPIException(ValidationMsg.LOCALE_NOT_VALIDE);\n+\t\t}\n+\t\tif (!sourceLocales2.get(0).equals(ConstantsKeys.FALSE) && !sourceLocales2.contains(locale)) {\n+\t\t\tthrow new VIPAPIException(String.format(ValidationMsg.LOCALENAME_ONLY_SUPPORTED, getSourceSupportLocales(sourceLocales2)));\n \t\t}\n \t}\n \n+\tprivate static String getSourceSupportLocales(List<String> sourceLocaleList) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0938d1ff13c20add1be66e44dd893b817324a4f8", "author": {"user": {"login": "tigershi", "name": "tigershi"}}, "url": "https://github.com/vmware/singleton/commit/0938d1ff13c20add1be66e44dd893b817324a4f8", "committedDate": "2020-11-03T07:40:48Z", "message": "remove source collectiong locale list validate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjQ2NDEx", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-522246411", "createdAt": "2020-11-03T07:51:04Z", "commit": {"oid": "d5344713898379b29cf0599792e805545e5158ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjQ3MTc2", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-522247176", "createdAt": "2020-11-03T07:52:31Z", "commit": {"oid": "0938d1ff13c20add1be66e44dd893b817324a4f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo1MjozMlrOHsjIxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNzo1MjozMlrOHsjIxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NTA3OQ==", "bodyText": "Is this used?", "url": "https://github.com/vmware/singleton/pull/852#discussion_r516475079", "createdAt": "2020-11-03T07:52:32Z", "author": {"login": "chaoq0318"}, "path": "g11n-ws/vip-manager-l10n/src/main/java/com/vmware/l10n/conf/CollectSourceValidationInterceptor.java", "diffHunk": "@@ -19,6 +19,7 @@\n \n import com.fasterxml.jackson.databind.ObjectMapper;\n import com.vmware.vip.api.rest.APIParamName;\n+import com.vmware.vip.common.constants.ConstantsChar;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0938d1ff13c20add1be66e44dd893b817324a4f8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMzM2NTkw", "url": "https://github.com/vmware/singleton/pull/852#pullrequestreview-522336590", "createdAt": "2020-11-03T09:56:49Z", "commit": {"oid": "0938d1ff13c20add1be66e44dd893b817324a4f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4117, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}