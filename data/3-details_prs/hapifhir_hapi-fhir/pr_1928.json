{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NDc1MDA1", "number": 1928, "title": "Im 20200615 mysql migration syntax", "bodyText": "Fix/enable migration tasks for MySQL. Ensured that these now work for both MySQL 5.7 and 8.0.", "createdAt": "2020-06-16T21:25:22Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/1928", "merged": true, "mergeCommit": {"oid": "abf0a0053d43f58f519d85387f20c1307f604fcd"}, "closed": true, "closedAt": "2020-06-17T18:21:18Z", "author": {"login": "IanMMarshall"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr68SPAH2gAyNDM1NDc1MDA1OjBiZDgwODRiNWU0MjUwYjk5NmQzNmRlZmE5OTViMDZmZTU0ZGViZmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsNC9ggFqTQzMjYwNjM4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0bd8084b5e4250b996d36defa995b06fe54debfb", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/0bd8084b5e4250b996d36defa995b06fe54debfb", "committedDate": "2020-06-16T20:05:10Z", "message": "Additional fixes to migration tasks for MySQL."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d857f484c4a3bfbc04c7ed3d4a792d72b8705c9", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/2d857f484c4a3bfbc04c7ed3d4a792d72b8705c9", "committedDate": "2020-06-16T21:13:00Z", "message": "Fix broken JUnit."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc7ed1b036061b8c04e58b57bbe73ae2ea5d2a67", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/cc7ed1b036061b8c04e58b57bbe73ae2ea5d2a67", "committedDate": "2020-06-16T21:21:17Z", "message": "Cleanup JUnit test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb990e9a68a855da05a7cfb1d268f12ad208f92d", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/eb990e9a68a855da05a7cfb1d268f12ad208f92d", "committedDate": "2020-06-17T13:05:53Z", "message": "Enhance added JUnit test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMzg5NDU1", "url": "https://github.com/hapifhir/hapi-fhir/pull/1928#pullrequestreview-432389455", "createdAt": "2020-06-17T13:17:07Z", "commit": {"oid": "eb990e9a68a855da05a7cfb1d268f12ad208f92d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzoxNzowN1rOGlFPqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzoxODo1MFrOGlFUSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzNjQyNA==", "bodyText": "In the rename scenario, don't we need to add those constraints back in after the rename?", "url": "https://github.com/hapifhir/hapi-fhir/pull/1928#discussion_r441536424", "createdAt": "2020-06-17T13:17:07Z", "author": {"login": "fil512"}, "path": "hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/taskdef/RenameColumnTask.java", "diffHunk": "@@ -82,6 +84,20 @@ public void doExecute() throws SQLException {\n \t\t\t\t\tthrow new SQLException(\"Can not rename \" + getTableName() + \".\" + myOldName + \" to \" + myNewName + \" because both columns exist and data exists in \" + myNewName);\n \t\t\t\t}\n \n+\t\t\t\tif (getDriverType().equals(DriverTypeEnum.MYSQL_5_7)) {\n+\t\t\t\t\t// Some DBs such as MYSQL require that foreign keys depending on the column be dropped before the column itself is dropped.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb990e9a68a855da05a7cfb1d268f12ad208f92d"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUzNzYxMA==", "bodyText": "I recommend adding a test for the rename column scenario to validate we don't lose the fk constraints on rename", "url": "https://github.com/hapifhir/hapi-fhir/pull/1928#discussion_r441537610", "createdAt": "2020-06-17T13:18:50Z", "author": {"login": "fil512"}, "path": "hapi-fhir-jpaserver-migrate/src/test/java/ca/uhn/fhir/jpa/migrate/taskdef/DropColumnTest.java", "diffHunk": "@@ -34,4 +36,39 @@ public void testDropColumn() throws SQLException {\n \n \t}\n \n+\t@Test\n+\tpublic void testDropForeignKeyColumn() throws SQLException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb990e9a68a855da05a7cfb1d268f12ad208f92d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d22af45bf60ea904b6071ca75d2ac138ab4a0c6", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/5d22af45bf60ea904b6071ca75d2ac138ab4a0c6", "committedDate": "2020-06-17T15:56:20Z", "message": "Added tests for cases where a renamed column is used in a Foreign Key constraint."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b120ee71e752d97098b2b6377199c502f79d948", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/5b120ee71e752d97098b2b6377199c502f79d948", "committedDate": "2020-06-17T15:57:37Z", "message": "Removed unused code and import statement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjA2Mzg2", "url": "https://github.com/hapifhir/hapi-fhir/pull/1928#pullrequestreview-432606386", "createdAt": "2020-06-17T17:10:46Z", "commit": {"oid": "5b120ee71e752d97098b2b6377199c502f79d948"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3960, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}