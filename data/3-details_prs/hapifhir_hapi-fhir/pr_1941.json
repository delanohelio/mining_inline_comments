{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODI1MTMx", "number": 1941, "title": "Empi 70 phonetic indexing", "bodyText": "", "createdAt": "2020-06-23T21:13:46Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/1941", "merged": true, "mergeCommit": {"oid": "714bd6216ee039509c04230994e52da8c78f146d"}, "closed": true, "closedAt": "2020-06-30T21:36:55Z", "author": {"login": "fil512"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuJLHSgH2gAyNDM4ODI1MTMxOmQ5M2Y3NmIzMjZlNWE2OGU2NGU5MDUyNDlmMGMwNWYyNGZhNmRlNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwbyCIAH2gAyNDM4ODI1MTMxOjk1NzdhOGU5YTQxY2YxOTJiMGVjMjQ3OThmZmZiNzhjNDdhYWQ2NzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d93f76b326e5a68e64e905249f0c05f24fa6de75", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/d93f76b326e5a68e64e905249f0c05f24fa6de75", "committedDate": "2020-06-23T17:47:53Z", "message": "start with failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "253690020ea28d100f72b4da6afaa45fb0754197", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/253690020ea28d100f72b4da6afaa45fb0754197", "committedDate": "2020-06-23T18:39:13Z", "message": "test passes with fixmes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eecf124178e19f27fb78cbd8e250a07b741490a9", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/eecf124178e19f27fb78cbd8e250a07b741490a9", "committedDate": "2020-06-23T21:10:11Z", "message": "javadoc and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bd295335b3c36d6fc895e1c9f95d0928afb31fd", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/8bd295335b3c36d6fc895e1c9f95d0928afb31fd", "committedDate": "2020-06-23T21:12:58Z", "message": "pre-review cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73966f00ffe7ba5abb681a9c9b1e47f972462832", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/73966f00ffe7ba5abb681a9c9b1e47f972462832", "committedDate": "2020-06-25T19:39:23Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95c2320cb01f8bdb92cf99111a05585059a9841c", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/95c2320cb01f8bdb92cf99111a05585059a9841c", "committedDate": "2020-06-25T22:36:35Z", "message": "generalize encoding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fafae59fb0cd8723ad7c14059eb1c928f61ce5d", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/9fafae59fb0cd8723ad7c14059eb1c928f61ce5d", "committedDate": "2020-06-25T23:19:43Z", "message": "test passes, but indexing needs to be optimized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9694e7eb738d5923ce00a8decbbb78a5ea926f8e", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/9694e7eb738d5923ce00a8decbbb78a5ea926f8e", "committedDate": "2020-06-25T23:19:50Z", "message": "test passes, but indexing needs to be optimized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed7548c2b6c2493fe993bd9cff686ad8c5987c7e", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/ed7548c2b6c2493fe993bd9cff686ad8c5987c7e", "committedDate": "2020-06-26T00:49:10Z", "message": "step 1 of optimization.  big refactor of all predicates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6040857ac10ecbb8e47508d6056272cf4d6c7378", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/6040857ac10ecbb8e47508d6056272cf4d6c7378", "committedDate": "2020-06-26T13:33:17Z", "message": "step 2 of optimization: determine phonetic encoder at time of RuntimeSearchParam creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bccd3a043fa9e9b855e6c714917151f0c6325968", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/bccd3a043fa9e9b855e6c714917151f0c6325968", "committedDate": "2020-06-26T13:33:34Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5dcb192a9941d2b4ffd411e796031778feacd79", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/e5dcb192a9941d2b4ffd411e796031778feacd79", "committedDate": "2020-06-26T18:29:44Z", "message": "integrated new phonetic encoders into empi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7350005865965b9d22b3db7c752c6a010712683b", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/7350005865965b9d22b3db7c752c6a010712683b", "committedDate": "2020-06-27T00:10:27Z", "message": "phonetic search implemented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ac73c0fa2783593ba0e66fa762e945fa6b0fbaf", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/1ac73c0fa2783593ba0e66fa762e945fa6b0fbaf", "committedDate": "2020-06-27T21:19:18Z", "message": "IT passes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53e491eb4dc3d7a4e2f81322971e1fc4877a8e62", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/53e491eb4dc3d7a4e2f81322971e1fc4877a8e62", "committedDate": "2020-06-27T21:22:18Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d976d0d4e23b9ee7a7c33cc04bfe1693b2c73939", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/d976d0d4e23b9ee7a7c33cc04bfe1693b2c73939", "committedDate": "2020-06-28T00:45:04Z", "message": "pre-review cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9702a0737fb17cb037ae1767ab0b4a04827b0331", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/9702a0737fb17cb037ae1767ab0b4a04827b0331", "committedDate": "2020-06-28T01:27:33Z", "message": "final pre-review cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb4f3e309874cc6858bdff9549ab8499bfd2ad9", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/8eb4f3e309874cc6858bdff9549ab8499bfd2ad9", "committedDate": "2020-06-28T01:58:04Z", "message": "final pre-review cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MTI3MzM1", "url": "https://github.com/hapifhir/hapi-fhir/pull/1941#pullrequestreview-439127335", "createdAt": "2020-06-29T13:11:56Z", "commit": {"oid": "8eb4f3e309874cc6858bdff9549ab8499bfd2ad9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzoxMTo1N1rOGqQPWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzoxMTo1N1rOGqQPWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk1OTQ1MQ==", "bodyText": "Whoa, you can do a soundex on an address line?! Cool...\nI'm assuming it normalizes the word component and leaves the numbers or something?", "url": "https://github.com/hapifhir/hapi-fhir/pull/1941#discussion_r446959451", "createdAt": "2020-06-29T13:11:57Z", "author": {"login": "jamesagnew"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/dao/dstu3/FhirResourceDaoDstu3PhoneticSearchNoFtTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+package ca.uhn.fhir.jpa.dao.dstu3;\n+\n+import ca.uhn.fhir.context.phonetic.ApacheEncoder;\n+import ca.uhn.fhir.context.phonetic.PhoneticEncoderEnum;\n+import ca.uhn.fhir.jpa.api.config.DaoConfig;\n+import ca.uhn.fhir.jpa.model.entity.ResourceIndexedSearchParamString;\n+import ca.uhn.fhir.jpa.model.util.JpaConstants;\n+import ca.uhn.fhir.jpa.searchparam.SearchParameterMap;\n+import ca.uhn.fhir.jpa.searchparam.registry.ISearchParamRegistry;\n+import ca.uhn.fhir.rest.param.StringParam;\n+import org.apache.commons.codec.language.Soundex;\n+import org.hl7.fhir.dstu3.model.Enumerations;\n+import org.hl7.fhir.dstu3.model.Patient;\n+import org.hl7.fhir.dstu3.model.SearchParameter;\n+import org.hl7.fhir.dstu3.model.StringType;\n+import org.hl7.fhir.instance.model.api.IIdType;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.hamcrest.Matchers.contains;\n+import static org.hamcrest.Matchers.containsInAnyOrder;\n+import static org.hamcrest.Matchers.hasSize;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertThat;\n+\n+public class FhirResourceDaoDstu3PhoneticSearchNoFtTest extends BaseJpaDstu3Test {\n+\tprivate static final org.slf4j.Logger ourLog = org.slf4j.LoggerFactory.getLogger(FhirResourceDaoDstu3PhoneticSearchNoFtTest.class);\n+\tpublic static final String GALE = \"Gale\";\n+\tpublic static final String GAIL = \"Gail\";\n+\tpublic static final String NAME_SOUNDEX_SP = \"nameSoundex\";\n+\tpublic static final String ADDRESS_LINE_SOUNDEX_SP = \"addressLineSoundex\";\n+\tprivate static final String BOB = \"BOB\";\n+\tprivate static final String ADDRESS = \"123 Nohili St\";\n+\tprivate static final String ADDRESS_CLOSE = \"123 Nohily St\";\n+\tprivate static final String ADDRESS_FAR = \"123 College St\";\n+\n+\t@Autowired\n+\tISearchParamRegistry mySearchParamRegistry;\n+\n+\t@Before\n+\tpublic void beforeDisableResultReuse() {\n+\t\tmyDaoConfig.setIndexMissingFields(DaoConfig.IndexEnabledEnum.DISABLED);\n+\t\tmyDaoConfig.setReuseCachedSearchResultsForMillis(null);\n+\t\tmyDaoConfig.setFetchSizeDefaultMaximum(new DaoConfig().getFetchSizeDefaultMaximum());\n+\n+\t\tcreateSoundexSearchParameter(NAME_SOUNDEX_SP, PhoneticEncoderEnum.SOUNDEX, \"Patient.name\");\n+\t\tcreateSoundexSearchParameter(ADDRESS_LINE_SOUNDEX_SP, PhoneticEncoderEnum.SOUNDEX, \"Patient.address.line\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb4f3e309874cc6858bdff9549ab8499bfd2ad9"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63ab9b6b5cce8e50b9614617e59f6b3b7d7e227f", "author": {"user": {"login": "fil512", "name": "Ken Stevens"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/63ab9b6b5cce8e50b9614617e59f6b3b7d7e227f", "committedDate": "2020-06-29T21:23:59Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b696d565734fd73a65f72567e181fe0aeba6b6b2", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/b696d565734fd73a65f72567e181fe0aeba6b6b2", "committedDate": "2020-06-30T20:18:24Z", "message": "Merge branch 'master' into empi-70-phonetic-indexing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9577a8e9a41cf192b0ec24798fffb78c47aad672", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/9577a8e9a41cf192b0ec24798fffb78c47aad672", "committedDate": "2020-06-30T20:36:32Z", "message": "Fix compile error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3968, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}