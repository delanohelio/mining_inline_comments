{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NDA5OTAx", "number": 2162, "title": "Improve ValueSet filtering", "bodyText": "", "createdAt": "2020-11-09T01:18:01Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/2162", "merged": true, "mergeCommit": {"oid": "63b7b379c2887c9b93c3af80ef3ba7a5c229f3c3"}, "closed": true, "closedAt": "2020-11-10T16:01:14Z", "author": {"login": "jamesagnew"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZUxtEAH2gAyNTE3NDA5OTAxOjA0ZTEyN2E5ODUwZThmYzVkYzA1YjFiYTZmMWIwMjkxNWEyMDhiNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbKTXyAH2gAyNTE3NDA5OTAxOjZjYTljNzUyYTMyZGZjY2Y3OGJjNWY4NWM4OWNhNDFmZjI1YWY4ODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "04e127a9850e8fc5dc05b1ba6f1b02915a208b6e", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/04e127a9850e8fc5dc05b1ba6f1b02915a208b6e", "committedDate": "2020-11-04T21:37:44Z", "message": "Improve filter search"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad0d9ac9ad77c66a371f5f80d2d98ec941ccb45d", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/ad0d9ac9ad77c66a371f5f80d2d98ec941ccb45d", "committedDate": "2020-11-06T10:24:48Z", "message": "Merge branch 'master' into ja_20201104_improve_filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbb601fdb446669ce4c8dfa194942721bf56c7f0", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/dbb601fdb446669ce4c8dfa194942721bf56c7f0", "committedDate": "2020-11-06T14:11:17Z", "message": "Merge branch 'master' into ja_20201104_improve_filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aea435fd7f7bf3473047ee59ec65da22cce06517", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/aea435fd7f7bf3473047ee59ec65da22cce06517", "committedDate": "2020-11-06T15:17:08Z", "message": "Filter improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dba54bcecf64b8edeca9f26db8f132dedea6397", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/4dba54bcecf64b8edeca9f26db8f132dedea6397", "committedDate": "2020-11-06T19:25:37Z", "message": "Tests passing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67a1c7cad3dadb678d58a5d11c9605a58ca22b7f", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/67a1c7cad3dadb678d58a5d11c9605a58ca22b7f", "committedDate": "2020-11-06T20:15:34Z", "message": "Test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61c62a0ce762927d737944debf448cebd92adb79", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/61c62a0ce762927d737944debf448cebd92adb79", "committedDate": "2020-11-09T01:17:23Z", "message": "Fix transaction filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d8bd1b573189525457ea784761134c5301a9321", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/6d8bd1b573189525457ea784761134c5301a9321", "committedDate": "2020-11-09T01:20:02Z", "message": "Add changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5514ebe4d191a0683729a4d9cd2ebed81befe42a", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/5514ebe4d191a0683729a4d9cd2ebed81befe42a", "committedDate": "2020-11-09T13:58:20Z", "message": "Test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MzUwMDk3", "url": "https://github.com/hapifhir/hapi-fhir/pull/2162#pullrequestreview-526350097", "createdAt": "2020-11-09T15:08:50Z", "commit": {"oid": "5514ebe4d191a0683729a4d9cd2ebed81befe42a"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNTowODo1MVrOHvzNkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNjoxMzowM1rOHv2MLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg4NDE3Ng==", "bodyText": "Typo.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ca.uhn.fhir.jpa.term.BaseTermReadSvcImpl.valueSetNotYetExpanded_OffsetNotAllowed=ValueSet expansion van not combine \"offset\" with \"ValueSet.compose.exclude\" unless the ValueSet has been pre-expanded. ValueSet \"{0}\" must be pre-expanded for this operation to work.\n          \n          \n            \n            ca.uhn.fhir.jpa.term.BaseTermReadSvcImpl.valueSetNotYetExpanded_OffsetNotAllowed=ValueSet expansion can not combine \"offset\" with \"ValueSet.compose.exclude\" unless the ValueSet has been pre-expanded. ValueSet \"{0}\" must be pre-expanded for this operation to work.", "url": "https://github.com/hapifhir/hapi-fhir/pull/2162#discussion_r519884176", "createdAt": "2020-11-09T15:08:51Z", "author": {"login": "dmuylwyk"}, "path": "hapi-fhir-base/src/main/resources/ca/uhn/fhir/i18n/hapi-messages.properties", "diffHunk": "@@ -1,5 +1,8 @@\n \n ca.uhn.fhir.jpa.term.BaseTermReadSvcImpl.expansionRefersToUnknownCs=Unknown CodeSystem URI \"{0}\" referenced from ValueSet\n+ca.uhn.fhir.jpa.term.BaseTermReadSvcImpl.valueSetNotYetExpanded=ValueSet \"{0}\" has not yet been pre-expanded. Performing in-memory expansion without parameters. Current status: {1} | {2}\n+ca.uhn.fhir.jpa.term.BaseTermReadSvcImpl.valueSetNotYetExpanded_OffsetNotAllowed=ValueSet expansion van not combine \"offset\" with \"ValueSet.compose.exclude\" unless the ValueSet has been pre-expanded. ValueSet \"{0}\" must be pre-expanded for this operation to work.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5514ebe4d191a0683729a4d9cd2ebed81befe42a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg5OTA0Mg==", "bodyText": "FIXME", "url": "https://github.com/hapifhir/hapi-fhir/pull/2162#discussion_r519899042", "createdAt": "2020-11-09T15:28:31Z", "author": {"login": "dmuylwyk"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/dao/r4/FhirResourceDaoR4TerminologyTest.java", "diffHunk": "@@ -1015,9 +1015,11 @@ public void testSearchCodeBelowBuiltInCodesystemUnqualified() {\n \t\tmyAllergyIntoleranceDao.create(ai3, mySrd).getId().toUnqualifiedVersionless().getValue();\n \n \t\tSearchParameterMap params;\n-\t\tparams = new SearchParameterMap();\n-\t\tparams.add(AllergyIntolerance.SP_CLINICAL_STATUS, new TokenParam(null, \"active\"));\n-\t\tassertThat(toUnqualifiedVersionlessIdValues(myAllergyIntoleranceDao.search(params)), containsInAnyOrder(id1));\n+\n+\t\t// FIXME: restore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5514ebe4d191a0683729a4d9cd2ebed81befe42a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkyODMwNw==", "bodyText": "Typo.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tfail(\"Expanded to \" + expansion.getExpansion().getContains().size() + \" but mas was \" + myDaoConfig.getMaximumExpansionSize());\n          \n          \n            \n            \t\t\tfail(\"Expanded to \" + expansion.getExpansion().getContains().size() + \" but max was \" + myDaoConfig.getMaximumExpansionSize());", "url": "https://github.com/hapifhir/hapi-fhir/pull/2162#discussion_r519928307", "createdAt": "2020-11-09T16:06:41Z", "author": {"login": "dmuylwyk"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/term/ValueSetExpansionR4Test.java", "diffHunk": "@@ -877,8 +1129,8 @@ public void testExpandValueSetInMemoryRespectsMaxSize() {\n \t\tValueSet.ConceptSetComponent include = vs.getCompose().addInclude();\n \t\tinclude.setSystem(CS_URL);\n \t\ttry {\n-\t\t\tmyTermSvc.expandValueSet(null, vs);\n-\t\t\tfail();\n+\t\t\tValueSet expansion = myTermSvc.expandValueSet(null, vs);\n+\t\t\tfail(\"Expanded to \" + expansion.getExpansion().getContains().size() + \" but mas was \" + myDaoConfig.getMaximumExpansionSize());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5514ebe4d191a0683729a4d9cd2ebed81befe42a"}, "originalPosition": 328}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkzMjk3NQ==", "bodyText": "Typo.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t * Execute in a new transasction only if we aren't already in one. We do this because in some cases\n          \n          \n            \n            \t * Execute in a new transaction only if we aren't already in one. We do this because in some cases", "url": "https://github.com/hapifhir/hapi-fhir/pull/2162#discussion_r519932975", "createdAt": "2020-11-09T16:13:03Z", "author": {"login": "dmuylwyk"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/BaseTermReadSvcImpl.java", "diffHunk": "@@ -603,47 +670,49 @@ private void expandValueSet(ValueSetExpansionOptions theExpansionOptions, ValueS\n \t\tourLog.debug(\"Done working with {} in {}ms\", valueSetInfo, sw.getMillis());\n \t}\n \n+\t/**\n+\t * Execute in a new transasction only if we aren't already in one. We do this because in some cases", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5514ebe4d191a0683729a4d9cd2ebed81befe42a"}, "originalPosition": 472}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16f5cedcd6bcfb8fc21aec166b62e357f4071cfe", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/16f5cedcd6bcfb8fc21aec166b62e357f4071cfe", "committedDate": "2020-11-09T22:59:33Z", "message": "Update hapi-fhir-base/src/main/resources/ca/uhn/fhir/i18n/hapi-messages.properties\n\nCo-authored-by: Diederik Muylwyk <diederik.muylwyk@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53c35fd8fe5d3401a0711148a504d7137bb20843", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/53c35fd8fe5d3401a0711148a504d7137bb20843", "committedDate": "2020-11-09T22:59:42Z", "message": "Update hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/BaseTermReadSvcImpl.java\n\nCo-authored-by: Diederik Muylwyk <diederik.muylwyk@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd4fef466651526a196973f736ca12484fa71f92", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/bd4fef466651526a196973f736ca12484fa71f92", "committedDate": "2020-11-09T23:00:51Z", "message": "Resolve FIXME"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d8ffd451f46a7c1fd6e28a68ce676d0d0e55a06", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/8d8ffd451f46a7c1fd6e28a68ce676d0d0e55a06", "committedDate": "2020-11-10T13:31:40Z", "message": "Test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ca9c752a32dfccf78bc5f85c89ca41ff25af882", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/6ca9c752a32dfccf78bc5f85c89ca41ff25af882", "committedDate": "2020-11-10T14:33:24Z", "message": "Update hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/term/ValueSetExpansionR4Test.java\n\nCo-authored-by: Diederik Muylwyk <diederik.muylwyk@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3907, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}