{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNDkzNzE2", "number": 2151, "title": "Im 20201028 fix versioned valueset expansions", "bodyText": "Fixed issue involving ValueSet validate-code operation where a pre-expanded ValueSet includes a versioned CodeSystem. Also fixed bug relating to ValueSet expand operation with URL and Filter parameters.", "createdAt": "2020-10-29T18:57:36Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/2151", "merged": true, "mergeCommit": {"oid": "38a975f09db76d1cbf9a5cd4e2708061506d7352"}, "closed": true, "closedAt": "2020-11-04T21:36:44Z", "author": {"login": "IanMMarshall"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXI0gUgH2gAyNTEyNDkzNzE2OjEwYjVmNTM0MzNhOGI0M2VjYWY1N2I3NzRlNTJkY2NjZDA3ODg2ZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZUwqqAFqTUyMzc1MjkyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "10b5f53433a8b43ecaf57b774e52dcccd07886e9", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/10b5f53433a8b43ecaf57b774e52dcccd07886e9", "committedDate": "2020-10-29T02:34:05Z", "message": "Fixes to ValueSet expansion for cases where CodeSystem is versioned."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "908744012f01c09ce84f63d559fa4b889a2244aa", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/908744012f01c09ce84f63d559fa4b889a2244aa", "committedDate": "2020-10-29T18:46:59Z", "message": "Fixes to ValueSet expansion for case where URL and filter parameters specified."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72915a32d30a7f7d8b72b8fa127296a408919844", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/72915a32d30a7f7d8b72b8fa127296a408919844", "committedDate": "2020-10-30T14:27:14Z", "message": "Restore maven-wrapper.properties file inadvertently deleted from GitHub."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "058ba914503d0932842e4c0bb9a18e9f0779b43c", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/058ba914503d0932842e4c0bb9a18e9f0779b43c", "committedDate": "2020-10-30T18:25:18Z", "message": "Fix JUnit tests and ValueSet exclude."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "628bf6528f7795aeaa764028d477cf56ec6188ae", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/628bf6528f7795aeaa764028d477cf56ec6188ae", "committedDate": "2020-10-30T20:07:54Z", "message": "Merge remote-tracking branch 'origin/master' into im_20201028_fix_versioned_valueset_expansions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzUyODM1", "url": "https://github.com/hapifhir/hapi-fhir/pull/2151#pullrequestreview-523752835", "createdAt": "2020-11-04T21:36:28Z", "commit": {"oid": "628bf6528f7795aeaa764028d477cf56ec6188ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMTozNjoyOFrOHtqjXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMTozNjoyOFrOHtqjXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NTE1MA==", "bodyText": "I'm going to fix this myself in another branch I have open so you don't need to address this comment but I'll comment here:\nBetter to use the value instead of the constant in the migration task, so that if the constant changes, the migration checker test will catch it.\nAlso, for the lines below, it's better to not reuse old index names, that's risky if the delete fails for any reason.", "url": "https://github.com/hapifhir/hapi-fhir/pull/2151#discussion_r517645150", "createdAt": "2020-11-04T21:36:28Z", "author": {"login": "jamesagnew"}, "path": "hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/tasks/HapiFhirJpaMigrationTasks.java", "diffHunk": "@@ -157,6 +158,12 @@ protected void init510() {\n \t\ttrmValueSet.addColumn(\"20200923.2\", \"VER\").nullable().type(ColumnTypeEnum.STRING, TermValueSet.MAX_VER_LENGTH);\n \t\ttrmValueSet.dropIndex(\"20200923.3\", \"IDX_VALUESET_URL\");\n \t\ttrmValueSet.addIndex(\"20200923.4\", \"IDX_VALUESET_URL\").unique(true).withColumns(\"URL\", \"VER\");\n+\n+\t\t//Term ValueSet Component add system version\n+\t\tBuilder.BuilderWithTableName trmValueSetComp = version.onTable(\"TRM_VALUESET_CONCEPT\");\n+\t\ttrmValueSetComp.addColumn(\"20201028.1\", \"SYSTEM_VER\").nullable().type(ColumnTypeEnum.STRING, TermCodeSystemVersion.MAX_VERSION_LENGTH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "628bf6528f7795aeaa764028d477cf56ec6188ae"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzUyOTI3", "url": "https://github.com/hapifhir/hapi-fhir/pull/2151#pullrequestreview-523752927", "createdAt": "2020-11-04T21:36:36Z", "commit": {"oid": "628bf6528f7795aeaa764028d477cf56ec6188ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3900, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}