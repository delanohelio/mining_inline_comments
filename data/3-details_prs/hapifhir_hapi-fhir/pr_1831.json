{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNTIzNzE5", "number": 1831, "title": "Allow disabling text modifier indexing", "bodyText": "", "createdAt": "2020-05-05T13:41:41Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/1831", "merged": true, "mergeCommit": {"oid": "35c2b7a2c12b9ece8a03ad44862ece89a559930b"}, "closed": true, "closedAt": "2020-05-05T16:16:56Z", "author": {"login": "jamesagnew"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceURvEgH2gAyNDEzNTIzNzE5OjEwNTIyMzYzZjE2ZWY4NDA0ZGFhNDJiZGZmOWZmNzdlODlkOGIyZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceV0uCAH2gAyNDEzNTIzNzE5OjRlMDA0ODM0YzYzMDk0YmFhNTg0NGNlMzZiNTEzNDcxMjUzZDlkYjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "10522363f16ef8404daa42bdff9ff77e89d8b2f0", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/10522363f16ef8404daa42bdff9ff77e89d8b2f0", "committedDate": "2020-05-05T13:41:17Z", "message": "Allow disabling text modifier indexing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "190cac2b1c3971c7c9f0259f7a99b808a8d7fee4", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/190cac2b1c3971c7c9f0259f7a99b808a8d7fee4", "committedDate": "2020-05-05T13:43:14Z", "message": "Add changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODcwOTg2", "url": "https://github.com/hapifhir/hapi-fhir/pull/1831#pullrequestreview-405870986", "createdAt": "2020-05-05T14:55:12Z", "commit": {"oid": "190cac2b1c3971c7c9f0259f7a99b808a8d7fee4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDo1NToxMlrOGQtY9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDo1NToxMlrOGQtY9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE3NDA2OA==", "bodyText": "Heya james, I took a whack at refactoring this, since i didn't like how we were relying on nullity of a Boolean. How does this look? Is this the logic you were encapsulating? Tests seem to pass against it\n\tpublic static boolean tokenTextIndexingEnabledForSearchParam(ModelConfig theModelConfig, RuntimeSearchParam theSearchParam) {\n\t\tOptional<Boolean> oSuppressForSearchParam = theSearchParam.getExtensions(JpaConstants.EXT_SEARCHPARAM_TOKEN_SUPPRESS_TEXT_INDEXING).stream()\n\t\t\t.map(IBaseExtension::getValue)\n\t\t\t.map(val -> (IPrimitiveType<?>) val)\n\t\t\t.map(IPrimitiveType::getValueAsString)\n\t\t\t.map(Boolean::parseBoolean)\n\t\t\t.findFirst();\n\n\t\t//if the SP doesn't care, use the system default.\n\t\tif (!oSuppressForSearchParam.isPresent()) {\n\t\t\treturn !theModelConfig.isSuppressStringIndexingInTokens();\n\t\t//If the SP does care, use its value.\n\t\t} else {\n\t\t\tboolean suppressForSearchParam = oSuppressForSearchParam.get();\n\t\tourLog.trace(\"{} text indexing for SearchParameter {}\", suppressForSearchParam? \"Suppressing\": \"Not Suppressing\", theSearchParam.getName());\n\t\treturn !suppressForSearchParam;\n\t\t}\n\t}", "url": "https://github.com/hapifhir/hapi-fhir/pull/1831#discussion_r420174068", "createdAt": "2020-05-05T14:55:12Z", "author": {"login": "tadgh"}, "path": "hapi-fhir-jpaserver-searchparam/src/main/java/ca/uhn/fhir/jpa/searchparam/extractor/BaseSearchParamExtractor.java", "diffHunk": "@@ -1112,6 +1128,32 @@ public void extract(SearchParamSet<BaseResourceIndexedSearchParam> params, Runti\n \t\t}\n \t}\n \n+\tpublic static boolean tokenTextIndexingEnabledForSearchParam(ModelConfig theModelConfig, RuntimeSearchParam theSearchParam) {\n+\t\tBoolean suppressViaSearchParam = null;\n+\t\tList<IBaseExtension<?, ?>> suppressExt = theSearchParam.getExtensions(JpaConstants.EXT_SEARCHPARAM_TOKEN_SUPPRESS_TEXT_INDEXING);\n+\t\tif (suppressExt.size() > 0) {\n+\t\t\tIPrimitiveType<?> value = (IPrimitiveType<?>) suppressExt.get(0).getValue();\n+\t\t\tif (\"true\".equals(value.getValueAsString())) {\n+\t\t\t\tourLog.trace(\"Suppressing text indexing for SearchParameter {}\", theSearchParam.getName());\n+\t\t\t\tsuppressViaSearchParam = true;\n+\t\t\t} else if (\"false\".equals(value.getValueAsString())) {\n+\t\t\t\tourLog.trace(\"Not suppressing text indexing for SearchParameter {}\", theSearchParam.getName());\n+\t\t\t\tsuppressViaSearchParam = false;\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (theModelConfig.isSuppressStringIndexingInTokens()) {\n+\t\t\tif (!Boolean.FALSE.equals(suppressViaSearchParam))\n+\t\t\t\treturn false;\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "190cac2b1c3971c7c9f0259f7a99b808a8d7fee4"}, "originalPosition": 142}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "717cc92603bccb7b71d8139a133a9d4e25a4c3fc", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/717cc92603bccb7b71d8139a133a9d4e25a4c3fc", "committedDate": "2020-05-05T15:15:20Z", "message": "Address review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a265691afb7d2b6dc8de30f6df645a11e440978f", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/a265691afb7d2b6dc8de30f6df645a11e440978f", "committedDate": "2020-05-05T15:18:04Z", "message": "Merge branch 'master' into ja_20200505_disable_text_modifier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e004834c63094baa5844ce36b513471253d9db3", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/4e004834c63094baa5844ce36b513471253d9db3", "committedDate": "2020-05-05T15:29:24Z", "message": "Resolve merge conflicts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4068, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}