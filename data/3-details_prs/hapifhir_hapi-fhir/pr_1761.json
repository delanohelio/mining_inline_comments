{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4NDg1NDk3", "number": 1761, "title": "Avoid duplicate predicate in _id queries", "bodyText": "", "createdAt": "2020-03-14T23:45:39Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/1761", "merged": true, "mergeCommit": {"oid": "5867d62d627535cb27b49c4d32b741fe2714909d"}, "closed": true, "closedAt": "2020-03-17T15:12:59Z", "author": {"login": "jamesagnew"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNtvaogH2gAyMzg4NDg1NDk3OmRhNmRiNjBkODc1Yzk5MDAwNWZmMDhlY2Y3ZDQwMTk4OGFiZGY5NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOkB33gH2gAyMzg4NDg1NDk3OjFjZTBmMzM0ZWM5ODI0OGQzNTY1MGU5YjI3Y2M2MmI1ZWVlNDgwODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "da6db60d875c990005ff08ecf7d401988abdf96a", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/da6db60d875c990005ff08ecf7d401988abdf96a", "committedDate": "2020-03-14T23:44:37Z", "message": "Avoid duplicate predicate in _id queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc7673374128a444bf57be8ac3ede48a5cd4007f", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/bc7673374128a444bf57be8ac3ede48a5cd4007f", "committedDate": "2020-03-14T23:48:07Z", "message": "Add changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04e9a0ae81061458b70f1f1866af9b7f432828f1", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/04e9a0ae81061458b70f1f1866af9b7f432828f1", "committedDate": "2020-03-15T00:15:38Z", "message": "Change to trigger CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDg0ODMy", "url": "https://github.com/hapifhir/hapi-fhir/pull/1761#pullrequestreview-375484832", "createdAt": "2020-03-16T18:33:46Z", "commit": {"oid": "04e9a0ae81061458b70f1f1866af9b7f432828f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODozMzo0NlrOF3BEJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODozMzo0NlrOF3BEJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzMzQ0NA==", "bodyText": "nice!", "url": "https://github.com/hapifhir/hapi-fhir/pull/1761#discussion_r393233444", "createdAt": "2020-03-16T18:33:46Z", "author": {"login": "tadgh"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/SearchBuilder.java", "diffHunk": "@@ -316,7 +345,8 @@ private void init(SearchParameterMap theParams, String theTheSearchUuid) {\n \t\t * If we have any joins to index tables, we get this behaviour already guaranteed so we don't\n \t\t * need an explicit predicate for it.\n \t\t */\n-\t\tif (!myQueryRoot.hasIndexJoins()) {\n+\t\tboolean haveNoIndexSearchParams = myParams.size() == 0 || myParams.keySet().stream().allMatch(t -> t.startsWith(\"_\"));\n+\t\tif (haveNoIndexSearchParams) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04e9a0ae81061458b70f1f1866af9b7f432828f1"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDg1MTc1", "url": "https://github.com/hapifhir/hapi-fhir/pull/1761#pullrequestreview-375485175", "createdAt": "2020-03-16T18:34:18Z", "commit": {"oid": "04e9a0ae81061458b70f1f1866af9b7f432828f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODozNDoxOFrOF3BFGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODozNDoxOFrOF3BFGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzMzY4OA==", "bodyText": "the logging part can be probably be removed for the merge", "url": "https://github.com/hapifhir/hapi-fhir/pull/1761#discussion_r393233688", "createdAt": "2020-03-16T18:34:18Z", "author": {"login": "tadgh"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/dao/r4/FhirResourceDaoR4SearchNoFtTest.java", "diffHunk": "@@ -1064,7 +1065,9 @@ public void testSearchByIdParam() {\n \n \t\tparams = new SearchParameterMap();\n \t\tparams.add(\"_id\", new StringParam(id1));\n+\t\tmyCaptureQueriesListener.clear();\n \t\tassertThat(toUnqualifiedVersionlessIdValues(myPatientDao.search(params)), contains(id1));\n+\t\tmyCaptureQueriesListener.logSelectQueriesForCurrentThread();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04e9a0ae81061458b70f1f1866af9b7f432828f1"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDg1NzE3", "url": "https://github.com/hapifhir/hapi-fhir/pull/1761#pullrequestreview-375485717", "createdAt": "2020-03-16T18:35:11Z", "commit": {"oid": "04e9a0ae81061458b70f1f1866af9b7f432828f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ce0f334ec98248d35650e9b27cc62b5eee48083", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/1ce0f334ec98248d35650e9b27cc62b5eee48083", "committedDate": "2020-03-17T14:59:39Z", "message": "Address review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4030, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}