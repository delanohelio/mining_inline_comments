{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzODU2MzYy", "number": 1989, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyNjo1MFrOEQs7Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyODo0MFrOEQs9vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTQ4Njg2OnYy", "diffSide": "RIGHT", "path": "hapi-fhir-jpaserver-empi/src/main/java/ca/uhn/fhir/jpa/empi/svc/EmpiMatchLinkSvc.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyNjo1MFrOG1AEkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyNjo1MFrOG1AEkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyODg4Mg==", "bodyText": "nice", "url": "https://github.com/hapifhir/hapi-fhir/pull/1989#discussion_r458228882", "createdAt": "2020-07-21T16:26:50Z", "author": {"login": "tadgh"}, "path": "hapi-fhir-jpaserver-empi/src/main/java/ca/uhn/fhir/jpa/empi/svc/EmpiMatchLinkSvc.java", "diffHunk": "@@ -101,14 +101,20 @@ private void handleEmpiWithMultipleCandidates(IAnyResource theResource, Candidat\n \t\t\tList<IAnyResource> persons = new ArrayList<>();\n \t\t\tfor (MatchedPersonCandidate matchedPersonCandidate : theCandidateList.getCandidates()) {\n \t\t\t\tIAnyResource person = myEmpiPersonFindingSvc.getPersonFromMatchedPersonCandidate(matchedPersonCandidate);\n-\t\t\t\tmyEmpiLinkSvc.updateLink(person, theResource, EmpiMatchOutcome.EID_POSSIBLE_MATCH, EmpiLinkSourceEnum.AUTO, theEmpiTransactionContext);\n+\t\t\t\tEmpiMatchOutcome outcome = EmpiMatchOutcome.POSSIBLE_MATCH;\n+\t\t\t\toutcome.setEidMatch(theCandidateList.isEidMatch());\n+\t\t\t\tmyEmpiLinkSvc.updateLink(person, theResource, outcome, EmpiLinkSourceEnum.AUTO, theEmpiTransactionContext);\n \t\t\t\tpersons.add(person);\n \t\t\t}\n \n \t\t\t//Set all Persons as POSSIBLE_DUPLICATE of the last person.\n \t\t\tIAnyResource firstPerson = persons.get(0);\n \t\t\tpersons.subList(1, persons.size())\n-\t\t\t\t.forEach(possibleDuplicatePerson -> myEmpiLinkSvc.updateLink(firstPerson, possibleDuplicatePerson, EmpiMatchOutcome.EID_POSSIBLE_DUPLICATE, EmpiLinkSourceEnum.AUTO, theEmpiTransactionContext));\n+\t\t\t\t.forEach(possibleDuplicatePerson -> {\n+\t\t\t\t\tEmpiMatchOutcome outcome = EmpiMatchOutcome.POSSIBLE_DUPLICATE;\n+\t\t\t\t\toutcome.setEidMatch(theCandidateList.isEidMatch());\n+\t\t\t\t\tmyEmpiLinkSvc.updateLink(firstPerson, possibleDuplicatePerson, outcome, EmpiLinkSourceEnum.AUTO, theEmpiTransactionContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49bdbb862a216c82b0152f5bd6e6809fa41093d3"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTQ5MzczOnYy", "diffSide": "RIGHT", "path": "hapi-fhir-jpaserver-empi/src/test/java/ca/uhn/fhir/jpa/empi/svc/EmpiMatchLinkSvcTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyODo0MFrOG1AJFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyODo0MFrOG1AJFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIzMDAzNw==", "bodyText": "not sure how much I like reading column by column in this format, but I can't think of a better way to do it.", "url": "https://github.com/hapifhir/hapi-fhir/pull/1989#discussion_r458230037", "createdAt": "2020-07-21T16:28:40Z", "author": {"login": "tadgh"}, "path": "hapi-fhir-jpaserver-empi/src/test/java/ca/uhn/fhir/jpa/empi/svc/EmpiMatchLinkSvcTest.java", "diffHunk": "@@ -332,13 +354,18 @@ public void testMATCHResultWithMultipleCandidatesCreatesPOSSIBLE_DUPLICATELinksA\n \t\t//Ensure there is no successful MATCH links for incomingJanePatient\n \t\tOptional<EmpiLink> matchedLinkForTargetPid = myEmpiLinkDaoSvc.getMatchedLinkForTargetPid(myIdHelperService.getPidOrNull(incomingJanePatient));\n \t\tassertThat(matchedLinkForTargetPid.isPresent(), is(false));\n+\n+\t\tlogAllLinks();\n+\t\tassertLinksMatchResult(MATCH, MATCH, POSSIBLE_MATCH, POSSIBLE_MATCH, POSSIBLE_DUPLICATE);\n+\t\tassertLinksNewPerson(true, true, false, false, false);\n+\t\tassertLinksMatchedByEid(false, false, false, false, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49bdbb862a216c82b0152f5bd6e6809fa41093d3"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1905, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}