{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NjY2NDIx", "number": 1693, "title": "Changes to schema to loosen dependencies involving Forced ID table", "bodyText": "This is a proposed and potentially breaking change intended to improve performance and should not be automatically merged.\nProposed change involves removing forced_id_pid columns from Resource and Resource History tables in the JPA server model and changing how the ResourceTable and ResourceHistory entities interact with each other and with the ForcedId entity.", "createdAt": "2020-01-31T16:35:57Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/1693", "merged": true, "mergeCommit": {"oid": "fba28950ec5759064eea39ecdc9b4744bd825e4b"}, "closed": true, "closedAt": "2020-02-18T19:16:10Z", "author": {"login": "IanMMarshall"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_xjQegH2gAyMzY5NjY2NDIxOjVkNWIzZDc2Mzk5MTBlMDA5YTc3Y2M4YWJkYzZjMjA2M2U2NzRkN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFm0_1gH2gAyMzY5NjY2NDIxOjJmNGY2MmIzMmViMThjOWNiNjI5YjNjYWNiMTliMDQyNmVhYTk3MjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5d5b3d7639910e009a77cc8abdc6c2063e674d7c", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/5d5b3d7639910e009a77cc8abdc6c2063e674d7c", "committedDate": "2020-01-31T16:16:01Z", "message": "Changes to schema to loosen dependencies between Forced ID table and the Resource and Resource History tables."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTAyNjI5", "url": "https://github.com/hapifhir/hapi-fhir/pull/1693#pullrequestreview-360502629", "createdAt": "2020-02-18T16:49:40Z", "commit": {"oid": "5d5b3d7639910e009a77cc8abdc6c2063e674d7c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjo0OTo0MFrOFrKMzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNjo1MjoxOVrOFrKTMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgwMDIwNQ==", "bodyText": "Can you merge master into this branch, and adjust this to put these tasks in a new init430 method with the current date on the tasks?", "url": "https://github.com/hapifhir/hapi-fhir/pull/1693#discussion_r380800205", "createdAt": "2020-02-18T16:49:40Z", "author": {"login": "jamesagnew"}, "path": "hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/tasks/HapiFhirJpaMigrationTasks.java", "diffHunk": "@@ -61,6 +61,11 @@ public HapiFhirJpaMigrationTasks(Set<String> theFlags) {\n \n \tprotected void init420() { // 20191015 - present\n \t\tBuilder version = forVersion(VersionEnum.V4_2_0);\n+\n+\t\t// Eliminate circular dependency.\n+\t\tversion.onTable(\"HFJ_RESOURCE\").dropColumn(\"20200130.1\", \"FORCED_ID_PID\");\n+\t\tversion.onTable(\"HFJ_RES_VER\").dropColumn(\"20200130.2\", \"FORCED_ID_PID\");\n+\t\tversion.onTable(\"HFJ_RES_VER\").addForeignKey(\"20200130.3\", \"FK_RESOURCE_HISTORY_RESOURCE\").toColumn(\"RES_ID\").references(\"HFJ_RESOURCE\", \"RES_ID\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d5b3d7639910e009a77cc8abdc6c2063e674d7c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgwMTg0MA==", "bodyText": "Overall comment- This could use a changelog.", "url": "https://github.com/hapifhir/hapi-fhir/pull/1693#discussion_r380801840", "createdAt": "2020-02-18T16:52:19Z", "author": {"login": "jamesagnew"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/expunge/ExpungeEverythingService.java", "diffHunk": "@@ -78,8 +78,6 @@ void expungeEverything(RequestDetails theRequest) {\n \t\tourLog.info(\"BEGINNING GLOBAL $expunge\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d5b3d7639910e009a77cc8abdc6c2063e674d7c"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7db280099f84a36d6ebef4fd09a4f82eaae3a45", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/f7db280099f84a36d6ebef4fd09a4f82eaae3a45", "committedDate": "2020-02-18T17:13:00Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into im_20200131_remove_circular_dependency_forcedid\n\n# Conflicts:\n#\thapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/tasks/HapiFhirJpaMigrationTasks.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96d00f633cdba901031f6aa5a8edf84978bd10ab", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/96d00f633cdba901031f6aa5a8edf84978bd10ab", "committedDate": "2020-02-18T19:09:17Z", "message": "Move new migration task to version 4.3.0."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4f62b32eb18c9cb629b3cacb19b0426eaa9720", "author": {"user": null}, "url": "https://github.com/hapifhir/hapi-fhir/commit/2f4f62b32eb18c9cb629b3cacb19b0426eaa9720", "committedDate": "2020-02-18T19:09:59Z", "message": "Add change log for Resource and Resource History table changes."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4110, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}