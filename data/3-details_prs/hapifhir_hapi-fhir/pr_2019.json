{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTg0MTE5", "number": 2019, "title": "Add a Minimum data requirement for EMPI processing", "bodyText": "With this PR, EMPI will drop resources that have no attributes populated that match up to Candidate Search Parameters the EMPI module cares about. e.g., if the candidate search params section of the empi-rules.json look like this:\n\"candidateSearchParams\": [\n{\n\t\"resourceType\": \"Patient\",\n\t\"searchParams\": [\"birthdate\"]\n}\nAnd you submit a resource without a birthdate, it will not enter EMPI processing and instead will be dropped.\nDetails:\n\nAdd a new EmpiResourceFilteringSvc whose sole purpose is to say whether or not an incoming IAnyResource has any attributes populated that match EMPI Candidate Search Parameters.\nRefactor tests to reflect new filtering rules.", "createdAt": "2020-08-06T18:06:07Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/2019", "merged": true, "mergeCommit": {"oid": "605c3d8f8a6b66da9f9677b77f53392f7ab57287"}, "closed": true, "closedAt": "2020-08-06T19:46:04Z", "author": {"login": "tadgh"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8DtQSgH2gAyNDY0MTg0MTE5Ojg3ZDE0ZjI2ZmVmODUwZjQzOTdlYzk3Y2YwZmVmYjEyMWFiMzhiNWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8USu3AFqTQ2Mjc4MTUzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "87d14f26fef850f4397ec97cf0fefb121ab38b5f", "author": {"user": {"login": "tadgh", "name": "Tadgh"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/87d14f26fef850f4397ec97cf0fefb121ab38b5f", "committedDate": "2020-08-05T23:20:41Z", "message": "Begin with a broken test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c92a77c8894792a1476ede43f4f08c66fd753e2e", "author": {"user": {"login": "tadgh", "name": "Tadgh"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/c92a77c8894792a1476ede43f4f08c66fd753e2e", "committedDate": "2020-08-06T04:48:06Z", "message": "Introduce Filtering service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed618613a65bd280232886fd9666904215204e20", "author": {"user": {"login": "tadgh", "name": "Tadgh"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/ed618613a65bd280232886fd9666904215204e20", "committedDate": "2020-08-06T17:58:37Z", "message": "Add type-based filtering to filter service. Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6ad4343393bfe1136224dca59fcaa54a859728a", "author": {"user": {"login": "tadgh", "name": "Tadgh"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/d6ad4343393bfe1136224dca59fcaa54a859728a", "committedDate": "2020-08-06T18:02:20Z", "message": "Rename class, add log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4fd055e523e274c2daac5380ccdcaeba746c894", "author": {"user": {"login": "tadgh", "name": "Tadgh"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/c4fd055e523e274c2daac5380ccdcaeba746c894", "committedDate": "2020-08-06T18:32:06Z", "message": "propagate class rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aa7d1c2d492efab996d64ae768bd667747fa894", "author": {"user": {"login": "tadgh", "name": "Tadgh"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/1aa7d1c2d492efab996d64ae768bd667747fa894", "committedDate": "2020-08-06T18:32:41Z", "message": "Remove dead comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a720d45c3deee7c37e47fedfaafc696f92be314", "author": {"user": {"login": "tadgh", "name": "Tadgh"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/5a720d45c3deee7c37e47fedfaafc696f92be314", "committedDate": "2020-08-06T18:33:38Z", "message": "Comment updates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNzgxNTMw", "url": "https://github.com/hapifhir/hapi-fhir/pull/2019#pullrequestreview-462781530", "createdAt": "2020-08-06T18:39:57Z", "commit": {"oid": "5a720d45c3deee7c37e47fedfaafc696f92be314"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODozOTo1N1rOG8_vLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODozOTo1N1rOG8_vLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxMjAxNA==", "bodyText": "sut?", "url": "https://github.com/hapifhir/hapi-fhir/pull/2019#discussion_r466612014", "createdAt": "2020-08-06T18:39:57Z", "author": {"login": "jamesagnew"}, "path": "hapi-fhir-jpaserver-empi/src/test/java/ca/uhn/fhir/jpa/empi/svc/EmpiResourceFilteringSvcTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package ca.uhn.fhir.jpa.empi.svc;\n+\n+import ca.uhn.fhir.jpa.empi.BaseEmpiR4Test;\n+import org.hl7.fhir.r4.model.BooleanType;\n+import org.hl7.fhir.r4.model.Patient;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+class EmpiResourceFilteringSvcTest extends BaseEmpiR4Test {\n+\n+\t@Autowired\n+\tprivate EmpiResourceFilteringSvc myEmpiResourceFilteringSvc;\n+\n+\t@Test\n+\tpublic void testFilterResourcesWhichHaveNoRelevantAttributes() {\n+\t\tPatient patient = new Patient();\n+\t\tpatient.setDeceased(new BooleanType(true)); //EMPI rules defined do not care about the deceased attribute.\n+\n+\t\t//SUT", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a720d45c3deee7c37e47fedfaafc696f92be314"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3836, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}