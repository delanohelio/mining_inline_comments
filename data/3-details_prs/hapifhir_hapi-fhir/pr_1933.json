{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MTc0MDI3", "number": 1933, "title": "Fix ValueSet$expand with offset and count parameters.", "bodyText": "BaseValidationSupportWrapper.expandValueSet(...) and ValidationSupportChain.expandValueSet(...) were incorrectly replacing expansion options (i.e. offset and count) with null.", "createdAt": "2020-06-22T20:58:25Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/1933", "merged": true, "mergeCommit": {"oid": "e849ff2cbc4edb24bc78f540874b89a195c69d54"}, "closed": true, "closedAt": "2020-06-22T22:30:22Z", "author": {"login": "dmuylwyk"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct3OHKAH2gAyNDM4MTc0MDI3OjMxNGRmNDMwOTEzZjFlMmQyNjlhNDgyYWFiYzA3MDFlZThhM2JlNmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABct3pGsgH2gAyNDM4MTc0MDI3OmNlMGNiODkxNmVkYTkzYjczMGUwYmI3ODdmNjBjOWI5NzcwNDlhN2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "314df430913f1e2d269a482aabc0701ee8a3be6f", "author": {"user": {"login": "dmuylwyk", "name": "Diederik Muylwyk"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/314df430913f1e2d269a482aabc0701ee8a3be6f", "committedDate": "2020-06-22T20:52:52Z", "message": "BaseValidationSupportWrapper.expandValueSet(...) and ValidationSupportChain.expandValueSet(...) were incorrectly replacing expansion options (i.e. offset and count) with null."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ced376f7ba0ecfa14003d58beb0914a474227b96", "author": {"user": {"login": "dmuylwyk", "name": "Diederik Muylwyk"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/ced376f7ba0ecfa14003d58beb0914a474227b96", "committedDate": "2020-06-22T21:02:08Z", "message": "Add changelog entry; fix typo."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjcyMDQ0", "url": "https://github.com/hapifhir/hapi-fhir/pull/1933#pullrequestreview-435272044", "createdAt": "2020-06-22T21:03:21Z", "commit": {"oid": "314df430913f1e2d269a482aabc0701ee8a3be6f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMTowMzoyMlrOGnQ6sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMTowNzoxMlrOGnRB4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNDgxNw==", "bodyText": "I think a better assert here would be to test that expanded.getContains().size() has a size of 1", "url": "https://github.com/hapifhir/hapi-fhir/pull/1933#discussion_r443824817", "createdAt": "2020-06-22T21:03:22Z", "author": {"login": "jamesagnew"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/provider/r5/ResourceProviderR5ValueSetTest.java", "diffHunk": "@@ -301,6 +301,122 @@ public void testExpandByIdWithPreExpansion() throws Exception {\n \n \t}\n \n+\t@Test\n+\tpublic void testExpandByIdWithPreExpansionWithOffset() throws Exception {\n+\t\tmyDaoConfig.setPreExpandValueSets(true);\n+\n+\t\tloadAndPersistCodeSystemAndValueSet(HTTPVerb.POST);\n+\t\tmyTermSvc.preExpandDeferredValueSetsToTerminologyTables();\n+\n+\t\tParameters respParam = ourClient\n+\t\t\t.operation()\n+\t\t\t.onInstance(myExtensionalVsId)\n+\t\t\t.named(\"expand\")\n+\t\t\t.withParameter(Parameters.class, \"offset\", new IntegerType(1))\n+\t\t\t.execute();\n+\t\tValueSet expanded = (ValueSet) respParam.getParameter().get(0).getResource();\n+\n+\t\tString resp = myFhirCtx.newXmlParser().setPrettyPrint(true).encodeResourceToString(expanded);\n+\t\tourLog.info(resp);\n+\t\tassertThat(resp, stringContainsInOrder(\n+\t\t\t\"<total value=\\\"24\\\"/>\\n\",\n+\t\t\t\"<offset value=\\\"1\\\"/>\\n\",\n+\t\t\t\"<parameter>\\n\",\n+\t\t\t\"<name value=\\\"offset\\\"/>\\n\",\n+\t\t\t\"<valueInteger value=\\\"1\\\"/>\\n\",\n+\t\t\t\"</parameter>\\n\",\n+\t\t\t\"<parameter>\\n\",\n+\t\t\t\"<name value=\\\"count\\\"/>\\n\",\n+\t\t\t\"<valueInteger value=\\\"1000\\\"/>\\n\",\n+\t\t\t\"</parameter>\\n\",\n+\t\t\t\"<contains>\\n\",\n+\t\t\t\"<system value=\\\"http://acme.org\\\"/>\\n\",\n+\t\t\t\"<code value=\\\"11378-7\\\"/>\\n\",\n+\t\t\t\"<display value=\\\"Systolic blood pressure at First encounter\\\"/>\\n\",\n+\t\t\t\"</contains>\\n\",\n+\t\t\t\"<contains>\\n\",\n+\t\t\t\"<system value=\\\"http://acme.org\\\"/>\\n\",\n+\t\t\t\"<code value=\\\"8493-9\\\"/>\\n\",\n+\t\t\t\"<display value=\\\"Systolic blood pressure 10 hour minimum\\\"/>\\n\",\n+\t\t\t\"</contains>\"));\n+\n+\t}\n+\n+\t@Test\n+\tpublic void testExpandByIdWithPreExpansionWithCount() throws Exception {\n+\t\tmyDaoConfig.setPreExpandValueSets(true);\n+\n+\t\tloadAndPersistCodeSystemAndValueSet(HTTPVerb.POST);\n+\t\tmyTermSvc.preExpandDeferredValueSetsToTerminologyTables();\n+\n+\t\tParameters respParam = ourClient\n+\t\t\t.operation()\n+\t\t\t.onInstance(myExtensionalVsId)\n+\t\t\t.named(\"expand\")\n+\t\t\t.withParameter(Parameters.class, \"count\", new IntegerType(1))\n+\t\t\t.execute();\n+\t\tValueSet expanded = (ValueSet) respParam.getParameter().get(0).getResource();\n+\n+\t\tString resp = myFhirCtx.newXmlParser().setPrettyPrint(true).encodeResourceToString(expanded);\n+\t\tourLog.info(resp);\n+\t\tassertThat(resp, stringContainsInOrder(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "314df430913f1e2d269a482aabc0701ee8a3be6f"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNjY1OQ==", "bodyText": "doh.....", "url": "https://github.com/hapifhir/hapi-fhir/pull/1933#discussion_r443826659", "createdAt": "2020-06-22T21:07:12Z", "author": {"login": "jamesagnew"}, "path": "hapi-fhir-validation/src/main/java/org/hl7/fhir/common/hapi/validation/support/BaseValidationSupportWrapper.java", "diffHunk": "@@ -70,7 +70,7 @@ public boolean isValueSetSupported(ValidationSupportContext theValidationSupport\n \n \t@Override\n \tpublic IValidationSupport.ValueSetExpansionOutcome expandValueSet(ValidationSupportContext theValidationSupportContext, ValueSetExpansionOptions theExpansionOptions, IBaseResource theValueSetToExpand) {\n-\t\treturn myWrap.expandValueSet(theValidationSupportContext, null, theValueSetToExpand);\n+\t\treturn myWrap.expandValueSet(theValidationSupportContext, theExpansionOptions, theValueSetToExpand);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "314df430913f1e2d269a482aabc0701ee8a3be6f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce0cb8916eda93b730e0bb787f60c9b977049a7f", "author": {"user": {"login": "dmuylwyk", "name": "Diederik Muylwyk"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/ce0cb8916eda93b730e0bb787f60c9b977049a7f", "committedDate": "2020-06-22T21:22:21Z", "message": "Improve tests."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3963, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}