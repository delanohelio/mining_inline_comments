{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMzMxOTI3", "number": 1917, "title": "Update for Loinc 2.68", "bodyText": "", "createdAt": "2020-06-11T21:06:52Z", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917", "merged": true, "mergeCommit": {"oid": "46c00f4efbe983f0cee7e3a403266063af15836b"}, "closed": true, "closedAt": "2020-06-18T20:55:12Z", "author": {"login": "jamesagnew"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclfwViAH2gAyNDMzMzMxOTI3OjdiOGI0OTJkMjBlZDAwZDZhZjJjZGRhMGE3YTBiZjI3MjhkNTg4ZWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsj7XMAH2gAyNDMzMzMxOTI3OmNkNzMwMzllODJlNDQ2NjUyMmNlNzA3NmY4OGRhZjM0MDI3NzQ1OWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b8b492d20ed00d6af2cdda0a7a0bf2728d588ea", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/7b8b492d20ed00d6af2cdda0a7a0bf2728d588ea", "committedDate": "2020-05-27T21:01:08Z", "message": "Work on loinc updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a27a6c069825a6bf7ac5dd87111b3aff53f08947", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/a27a6c069825a6bf7ac5dd87111b3aff53f08947", "committedDate": "2020-06-11T00:40:54Z", "message": "Merge branch 'master' into ja_20200527_account_for_loinc268"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec52c191c6c3359886fbc64fc91f5883c49d971f", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/ec52c191c6c3359886fbc64fc91f5883c49d971f", "committedDate": "2020-06-11T01:43:29Z", "message": "Work on loinc upload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd5eb39d7cfb417498f350064701abf94cb1174", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/9dd5eb39d7cfb417498f350064701abf94cb1174", "committedDate": "2020-06-11T20:46:14Z", "message": "Clean up CLI config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/49f2a1bebaf4c196f3e872afb69d99963ac74a65", "committedDate": "2020-06-11T21:07:56Z", "message": "Add changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzkwNDg1", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432790485", "createdAt": "2020-06-17T21:29:42Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMToyOTo0MlrOGlYFpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMToyOTo0MlrOGlYFpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0NTE1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tuploadProperties.getProperty(LOINC_PART_LINK_FILE_PRIMARY.getCode(), LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode()),\n          \n          \n            \n            \t\t\t\tuploadProperties.getProperty(LOINC_PART_LINK_FILE_PRIMARY.getCode(), LOINC_PART_LINK_FILE_PRIMARY_DEFAULT.getCode()),", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441845158", "createdAt": "2020-06-17T21:29:42Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermLoaderSvcImpl.java", "diffHunk": "@@ -119,7 +114,8 @@ public UploadStatistics loadLoinc(List<FileDescriptor> theFiles, RequestDetails\n \t\t\t\tuploadProperties.getProperty(LOINC_IEEE_MEDICAL_DEVICE_CODE_MAPPING_TABLE_FILE.getCode(), LOINC_IEEE_MEDICAL_DEVICE_CODE_MAPPING_TABLE_FILE_DEFAULT.getCode()),\n \t\t\t\tuploadProperties.getProperty(LOINC_IMAGING_DOCUMENT_CODES_FILE.getCode(), LOINC_IMAGING_DOCUMENT_CODES_FILE_DEFAULT.getCode()),\n \t\t\t\tuploadProperties.getProperty(LOINC_PART_FILE.getCode(), LOINC_PART_FILE_DEFAULT.getCode()),\n-\t\t\t\tuploadProperties.getProperty(LOINC_PART_LINK_FILE.getCode(), LOINC_PART_LINK_FILE_DEFAULT.getCode()),\n+\t\t\t\tuploadProperties.getProperty(LOINC_PART_LINK_FILE_PRIMARY.getCode(), LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzkwNzYx", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432790761", "createdAt": "2020-06-17T21:30:09Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMDoxMFrOGlYG1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMDoxMFrOGlYG1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0NTQ2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\titerateOverZipFile(theDescriptors, theUploadProperties.getProperty(LOINC_PART_LINK_FILE_PRIMARY.getCode(), LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode()), handler, ',', QuoteMode.NON_NUMERIC, false);\n          \n          \n            \n            \t\titerateOverZipFile(theDescriptors, theUploadProperties.getProperty(LOINC_PART_LINK_FILE_PRIMARY.getCode(), LOINC_PART_LINK_FILE_PRIMARY_DEFAULT.getCode()), handler, ',', QuoteMode.NON_NUMERIC, false);", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441845461", "createdAt": "2020-06-17T21:30:10Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermLoaderSvcImpl.java", "diffHunk": "@@ -469,6 +468,11 @@ UploadStatistics processLoincFiles(LoadedFileDescriptors theDescriptors, Request\n \t\thandler = new LoincParentGroupFileHandler(code2concept, valueSets, conceptMaps, theUploadProperties);\n \t\titerateOverZipFile(theDescriptors, theUploadProperties.getProperty(LOINC_PARENT_GROUP_FILE.getCode(), LOINC_PARENT_GROUP_FILE_DEFAULT.getCode()), handler, ',', QuoteMode.NON_NUMERIC, false);\n \n+\t\t// Part link\n+\t\thandler = new LoincPartLinkHandler(codeSystemVersion, code2concept, propertyNamesToTypes);\n+\t\titerateOverZipFile(theDescriptors, theUploadProperties.getProperty(LOINC_PART_LINK_FILE_PRIMARY.getCode(), LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode()), handler, ',', QuoteMode.NON_NUMERIC, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzkxMDAx", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432791001", "createdAt": "2020-06-17T21:30:37Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMDozN1rOGlYHog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMDozN1rOGlYHog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0NTY2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tLOINC_PART_LINK_FILE_PRTIMARY_DEFAULT(\"AccessoryFiles/PartFile/LoincPartLink_Primary.csv\"),\n          \n          \n            \n            \tLOINC_PART_LINK_FILE_PRIMARY_DEFAULT(\"AccessoryFiles/PartFile/LoincPartLink_Primary.csv\"),", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441845666", "createdAt": "2020-06-17T21:30:37Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/loinc/LoincUploadPropertiesEnum.java", "diffHunk": "@@ -67,9 +67,13 @@\n \t// Part\n \tLOINC_PART_FILE(\"loinc.part.file\"),\n \tLOINC_PART_FILE_DEFAULT(\"AccessoryFiles/PartFile/Part.csv\"),\n+\n \t// Part link\n-\tLOINC_PART_LINK_FILE(\"loinc.part.link.file\"),\n-\tLOINC_PART_LINK_FILE_DEFAULT(\"AccessoryFiles/PartFile/LoincPartLink.csv\"),\n+\tLOINC_PART_LINK_FILE_PRIMARY(\"loinc.part.link.primary.file\"),\n+\tLOINC_PART_LINK_FILE_PRTIMARY_DEFAULT(\"AccessoryFiles/PartFile/LoincPartLink_Primary.csv\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzkxMjEy", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432791212", "createdAt": "2020-06-17T21:30:56Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMDo1NlrOGlYILQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMDo1NlrOGlYILQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0NTgwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\taddFile(zos, LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode());\n          \n          \n            \n            \t\taddFile(zos, LOINC_PART_LINK_FILE_PRIMARY_DEFAULT.getCode());", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441845805", "createdAt": "2020-06-17T21:30:56Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/provider/r4/TerminologyUploaderProviderR4Test.java", "diffHunk": "@@ -492,7 +492,8 @@ private static void addFile(ZipOutputStream theZos, String theFileName) throws I\n \t\taddFile(zos, LOINC_GROUP_FILE_DEFAULT.getCode());\n \t\taddFile(zos, LOINC_GROUP_TERMS_FILE_DEFAULT.getCode());\n \t\taddFile(zos, LOINC_PARENT_GROUP_FILE_DEFAULT.getCode());\n-\t\taddFile(zos, LOINC_PART_LINK_FILE_DEFAULT.getCode());\n+\t\taddFile(zos, LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzkxMzc5", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432791379", "createdAt": "2020-06-17T21:31:15Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMToxNVrOGlYIvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozMToxNVrOGlYIvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0NTk0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\ttheFiles.addFileZip(\"/loinc/\", LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode());\n          \n          \n            \n            \t\ttheFiles.addFileZip(\"/loinc/\", LOINC_PART_LINK_FILE_PRIMARY_DEFAULT.getCode());", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441845949", "createdAt": "2020-06-17T21:31:15Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/term/TerminologyLoaderSvcLoincTest.java", "diffHunk": "@@ -379,7 +379,8 @@ public static void addLoincMandatoryFilesToZip(ZipCollectionBuilder theFiles) th\n \t\ttheFiles.addFileZip(\"/loinc/\", LOINC_ANSWERLIST_LINK_FILE_DEFAULT.getCode());\n \t\ttheFiles.addFileZip(\"/loinc/\", LOINC_ANSWERLIST_LINK_DUPLICATE_FILE_DEFAULT.getCode());\n \t\ttheFiles.addFileZip(\"/loinc/\", LOINC_PART_FILE_DEFAULT.getCode());\n-\t\ttheFiles.addFileZip(\"/loinc/\", LOINC_PART_LINK_FILE_DEFAULT.getCode());\n+\t\ttheFiles.addFileZip(\"/loinc/\", LOINC_PART_LINK_FILE_PRTIMARY_DEFAULT.getCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzk1Mjgx", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432795281", "createdAt": "2020-06-17T21:37:54Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozNzo1NFrOGlYUEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTozNzo1NFrOGlYUEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0ODg1MA==", "bodyText": "FIXME needs to be addressed.", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441848850", "createdAt": "2020-06-17T21:37:54Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/loinc/LoincHandler.java", "diffHunk": "@@ -86,44 +86,48 @@ public void accept(CSVRecord theRecord) {\n \t\t\t\t\t\t\tconcept.addPropertyString(nextPropertyName, nextPropertyValue);\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CODING:\n-\t\t\t\t\t\t\t// TODO: handle \"Ser/Plas^Donor\"\n-\t\t\t\t\t\t\tString propertyValue = nextPropertyValue;\n-\t\t\t\t\t\t\tif (nextPropertyName.equals(\"COMPONENT\")) {\n-\t\t\t\t\t\t\t\tif (propertyValue.contains(\"^\")) {\n-\t\t\t\t\t\t\t\t\tpropertyValue = propertyValue.substring(0, propertyValue.indexOf(\"^\"));\n-\t\t\t\t\t\t\t\t} else if (propertyValue.contains(\"/\")) {\n-\t\t\t\t\t\t\t\t\tpropertyValue = propertyValue.substring(0, propertyValue.indexOf(\"/\"));\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tPartTypeAndPartName key = new PartTypeAndPartName(nextPropertyName, propertyValue);\n-\t\t\t\t\t\t\tString partNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"TIME_ASPCT\")) {\n-\t\t\t\t\t\t\t\tkey = new PartTypeAndPartName(\"TIME\", nextPropertyValue);\n-\t\t\t\t\t\t\t\tpartNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"METHOD_TYP\")) {\n-\t\t\t\t\t\t\t\tkey = new PartTypeAndPartName(\"METHOD\", nextPropertyValue);\n-\t\t\t\t\t\t\t\tpartNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"SCALE_TYP\")) {\n-\t\t\t\t\t\t\t\tkey = new PartTypeAndPartName(\"SCALE\", nextPropertyValue);\n-\t\t\t\t\t\t\t\tpartNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"SYSTEM\") && nextPropertyValue.startsWith(\"^\")) {\n-\t\t\t\t\t\t\t\tcontinue;\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tif (isNotBlank(partNumber)) {\n-\t\t\t\t\t\t\t\tconcept.addPropertyCoding(nextPropertyName, ITermLoaderSvc.LOINC_URI, partNumber, nextPropertyValue);\n-\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\tString msg = \"Unable to find part code with TYPE[\" + key.getPartType() + \"] and NAME[\" + nextPropertyValue + \"] (using name \" + propertyValue + \")\";\n-\t\t\t\t\t\t\t\tourLog.warn(msg);\n-//\t\t\t\t\t\t\t\tthrow new InternalErrorException(msg);\n-\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t// These are handles by the LOINC PartLink file\n \t\t\t\t\t\t\tbreak;\n+\n+\t\t\t\t\t\t\t// FIXME: remove", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9099f73a83c41d40a7a445d6694f97a5cb7c7a9", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/c9099f73a83c41d40a7a445d6694f97a5cb7c7a9", "committedDate": "2020-06-17T21:41:15Z", "message": "Update hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermLoaderSvcImpl.java\n\nCo-authored-by: IanMMarshall <49525404+IanMMarshall@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c5cbe4ae81b65046b5802526b2fbfbd40ec6695", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/4c5cbe4ae81b65046b5802526b2fbfbd40ec6695", "committedDate": "2020-06-17T21:54:24Z", "message": "Update hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermLoaderSvcImpl.java\n\nCo-authored-by: IanMMarshall <49525404+IanMMarshall@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a7e55dd77b05628d34e4de9b830ac8e87831706", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/0a7e55dd77b05628d34e4de9b830ac8e87831706", "committedDate": "2020-06-17T21:54:32Z", "message": "Update hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/provider/r4/TerminologyUploaderProviderR4Test.java\n\nCo-authored-by: IanMMarshall <49525404+IanMMarshall@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyODA1ODY4", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432805868", "createdAt": "2020-06-17T21:57:31Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTo1NzozMVrOGlY0Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMTo1NzozMVrOGlY0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg1NzA3NQ==", "bodyText": "I think you might be able to remove the myPartTypeAndPartNameToPartNumber property as this commented block of code appears to be the only thing referencing this property.", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441857075", "createdAt": "2020-06-17T21:57:31Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/loinc/LoincHandler.java", "diffHunk": "@@ -86,44 +86,48 @@ public void accept(CSVRecord theRecord) {\n \t\t\t\t\t\t\tconcept.addPropertyString(nextPropertyName, nextPropertyValue);\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CODING:\n-\t\t\t\t\t\t\t// TODO: handle \"Ser/Plas^Donor\"\n-\t\t\t\t\t\t\tString propertyValue = nextPropertyValue;\n-\t\t\t\t\t\t\tif (nextPropertyName.equals(\"COMPONENT\")) {\n-\t\t\t\t\t\t\t\tif (propertyValue.contains(\"^\")) {\n-\t\t\t\t\t\t\t\t\tpropertyValue = propertyValue.substring(0, propertyValue.indexOf(\"^\"));\n-\t\t\t\t\t\t\t\t} else if (propertyValue.contains(\"/\")) {\n-\t\t\t\t\t\t\t\t\tpropertyValue = propertyValue.substring(0, propertyValue.indexOf(\"/\"));\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tPartTypeAndPartName key = new PartTypeAndPartName(nextPropertyName, propertyValue);\n-\t\t\t\t\t\t\tString partNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"TIME_ASPCT\")) {\n-\t\t\t\t\t\t\t\tkey = new PartTypeAndPartName(\"TIME\", nextPropertyValue);\n-\t\t\t\t\t\t\t\tpartNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"METHOD_TYP\")) {\n-\t\t\t\t\t\t\t\tkey = new PartTypeAndPartName(\"METHOD\", nextPropertyValue);\n-\t\t\t\t\t\t\t\tpartNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"SCALE_TYP\")) {\n-\t\t\t\t\t\t\t\tkey = new PartTypeAndPartName(\"SCALE\", nextPropertyValue);\n-\t\t\t\t\t\t\t\tpartNumber = myPartTypeAndPartNameToPartNumber.get(key);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tif (partNumber == null && nextPropertyName.equals(\"SYSTEM\") && nextPropertyValue.startsWith(\"^\")) {\n-\t\t\t\t\t\t\t\tcontinue;\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tif (isNotBlank(partNumber)) {\n-\t\t\t\t\t\t\t\tconcept.addPropertyCoding(nextPropertyName, ITermLoaderSvc.LOINC_URI, partNumber, nextPropertyValue);\n-\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\tString msg = \"Unable to find part code with TYPE[\" + key.getPartType() + \"] and NAME[\" + nextPropertyValue + \"] (using name \" + propertyValue + \")\";\n-\t\t\t\t\t\t\t\tourLog.warn(msg);\n-//\t\t\t\t\t\t\t\tthrow new InternalErrorException(msg);\n-\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t// These are handles by the LOINC PartLink file\n \t\t\t\t\t\t\tbreak;\n+\n+\t\t\t\t\t\t\t// FIXME: remove\n+//\t\t\t\t\t\t\t// TODO: handle \"Ser/Plas^Donor\"\n+//\t\t\t\t\t\t\tString propertyValue = nextPropertyValue;\n+//\t\t\t\t\t\t\tif (nextPropertyName.equals(\"COMPONENT\")) {\n+//\t\t\t\t\t\t\t\tif (propertyValue.contains(\"^\")) {\n+//\t\t\t\t\t\t\t\t\tpropertyValue = propertyValue.substring(0, propertyValue.indexOf(\"^\"));\n+//\t\t\t\t\t\t\t\t} else if (propertyValue.contains(\"/\")) {\n+//\t\t\t\t\t\t\t\t\tpropertyValue = propertyValue.substring(0, propertyValue.indexOf(\"/\"));\n+//\t\t\t\t\t\t\t\t}\n+//\t\t\t\t\t\t\t}\n+//\n+//\t\t\t\t\t\t\tPartTypeAndPartName key = new PartTypeAndPartName(nextPropertyName, propertyValue);\n+//\t\t\t\t\t\t\tString partNumber = myPartTypeAndPartNameToPartNumber.get(key);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0c5290fae8ec0c7edc667c47e51f0221c3327bb", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/d0c5290fae8ec0c7edc667c47e51f0221c3327bb", "committedDate": "2020-06-17T21:57:44Z", "message": "Update hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/loinc/LoincUploadPropertiesEnum.java\n\nCo-authored-by: IanMMarshall <49525404+IanMMarshall@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3605e408d13f006ef7830d75c03911f8e6d1db10", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/3605e408d13f006ef7830d75c03911f8e6d1db10", "committedDate": "2020-06-17T21:57:52Z", "message": "Update hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/term/TerminologyLoaderSvcLoincTest.java\n\nCo-authored-by: IanMMarshall <49525404+IanMMarshall@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyODA3OTIw", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432807920", "createdAt": "2020-06-17T22:01:20Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMjowMToyMVrOGlY6UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QyMjowMToyMVrOGlY6UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg1ODY0MA==", "bodyText": "I am confused here - the three new asserts here appear to simply duplicate the previous three assert statements. Were these supposed to be checking something else?", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#discussion_r441858640", "createdAt": "2020-06-17T22:01:21Z", "author": {"login": "IanMMarshall"}, "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/term/TerminologyLoaderSvcLoincTest.java", "diffHunk": "@@ -413,6 +414,9 @@ public void testLoadLoincMultiaxialHierarchySupport() throws Exception {\n \t\tassertEquals(ITermLoaderSvc.LOINC_URI, code.getCodingProperties(\"PROPERTY\").get(0).getSystem());\n \t\tassertEquals(\"LP6802-5\", code.getCodingProperties(\"PROPERTY\").get(0).getCode());\n \t\tassertEquals(\"Elpot\", code.getCodingProperties(\"PROPERTY\").get(0).getDisplay());\n+\t\tassertEquals(ITermLoaderSvc.LOINC_URI, code.getCodingProperties(\"PROPERTY\").get(0).getSystem());\n+\t\tassertEquals(\"LP6802-5\", code.getCodingProperties(\"PROPERTY\").get(0).getCode());\n+\t\tassertEquals(\"Elpot\", code.getCodingProperties(\"PROPERTY\").get(0).getDisplay());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyODA5NTM4", "url": "https://github.com/hapifhir/hapi-fhir/pull/1917#pullrequestreview-432809538", "createdAt": "2020-06-17T22:04:30Z", "commit": {"oid": "49f2a1bebaf4c196f3e872afb69d99963ac74a65"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40d8be205b9101708b412726a9606edfbee78c4d", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/40d8be205b9101708b412726a9606edfbee78c4d", "committedDate": "2020-06-18T14:28:04Z", "message": "Clean up imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7c40f6276d1e07bcac3bfb241f9e8c4e08bd1d7", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/c7c40f6276d1e07bcac3bfb241f9e8c4e08bd1d7", "committedDate": "2020-06-18T14:28:24Z", "message": "Merge branch 'master' into ja_20200527_account_for_loinc268"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e3533b31b5aa7e1f4d249f03a11359b2dc1c64f", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/9e3533b31b5aa7e1f4d249f03a11359b2dc1c64f", "committedDate": "2020-06-18T18:13:49Z", "message": "LOINC fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd73039e82e4466522ce7076f88daf340277459f", "author": {"user": {"login": "jamesagnew", "name": "James Agnew"}}, "url": "https://github.com/hapifhir/hapi-fhir/commit/cd73039e82e4466522ce7076f88daf340277459f", "committedDate": "2020-06-18T19:50:16Z", "message": "Loinc loader fixes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3947, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}