{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MTg3MDQy", "number": 2501, "title": "[RESTEASY-2683] NPE in ApacheHttpClient43Test because cache is null in MediaTypeMap", "bodyText": "The cache can result in null at initialization. I'm changing to always set the cache to classCache no matter if it was created by the same thread or by any another one. I also used a ConcurrentHashMap instead of normal HashMap.\nI'm not protecting the setting part in mergeEverything, if you think it's necessary to protect it too just let me know.", "createdAt": "2020-08-31T09:49:01Z", "url": "https://github.com/resteasy/resteasy/pull/2501", "merged": true, "mergeCommit": {"oid": "fed55666e9ef5c6e7366912742331de4de3688f4"}, "closed": true, "closedAt": "2020-09-10T00:36:40Z", "author": {"login": "rmartinc"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEkd0UgFqTQ3OTU4NTA1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEnIQhgBqjM3MTQ4Mzk4MTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTg1MDUz", "url": "https://github.com/resteasy/resteasy/pull/2501#pullrequestreview-479585053", "createdAt": "2020-09-01T10:02:05Z", "commit": {"oid": "77a67bcd2ae67442ed49dd7d7083609f0c89db34"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMDowMjowNVrOHKvGVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMDowMjowNVrOHKvGVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxOTQ3OA==", "bodyText": "Why is this line moved out of check block ?", "url": "https://github.com/resteasy/resteasy/pull/2501#discussion_r481019478", "createdAt": "2020-09-01T10:02:05Z", "author": {"login": "jimma"}, "path": "resteasy-core/src/main/java/org/jboss/resteasy/core/MediaTypeMap.java", "diffHunk": "@@ -550,8 +551,8 @@ private void mergeEverything(Entry<T> entry) {\n       CachedMediaTypeAndClass cacheEntry = null;\r\n       if (useCache)\r\n       {\r\n+         cacheEntry = new CachedMediaTypeAndClass(type, accept);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77a67bcd2ae67442ed49dd7d7083609f0c89db34"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTg3OTMy", "url": "https://github.com/resteasy/resteasy/pull/2501#pullrequestreview-479587932", "createdAt": "2020-09-01T10:03:35Z", "commit": {"oid": "77a67bcd2ae67442ed49dd7d7083609f0c89db34"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMDowMzozNVrOHKvJiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMDowMzozNVrOHKvJiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAyMDI5OQ==", "bodyText": "if (cache== null) check again here ?", "url": "https://github.com/resteasy/resteasy/pull/2501#discussion_r481020299", "createdAt": "2020-09-01T10:03:35Z", "author": {"login": "jimma"}, "path": "resteasy-core/src/main/java/org/jboss/resteasy/core/MediaTypeMap.java", "diffHunk": "@@ -576,14 +577,14 @@ private void mergeEverything(Entry<T> entry) {\n       cached = convert(matches);\r\n       if (useCache) {\r\n          Map<CachedMediaTypeAndClass, List<T>> cache = classCache;\r\n-         if (classCache == null) {\r\n+         if (cache == null) {\r\n             synchronized (this)\r\n             {\r\n                if (classCache == null)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77a67bcd2ae67442ed49dd7d7083609f0c89db34"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49e4c8f2f1bca480a1e696552081aa2275b86ece", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/resteasy/resteasy/commit/49e4c8f2f1bca480a1e696552081aa2275b86ece", "committedDate": "2020-09-01T12:27:33Z", "message": "[RESTEASY-2683] NPE in ApacheHttpClient43Test because cache is null in MediaTypeMap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77a67bcd2ae67442ed49dd7d7083609f0c89db34", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/resteasy/resteasy/commit/77a67bcd2ae67442ed49dd7d7083609f0c89db34", "committedDate": "2020-08-31T09:03:40Z", "message": "[RESTEASY-2683] NPE in ApacheHttpClient43Test because cache is null in MediaTypeMap"}, "afterCommit": {"oid": "49e4c8f2f1bca480a1e696552081aa2275b86ece", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/resteasy/resteasy/commit/49e4c8f2f1bca480a1e696552081aa2275b86ece", "committedDate": "2020-09-01T12:27:33Z", "message": "[RESTEASY-2683] NPE in ApacheHttpClient43Test because cache is null in MediaTypeMap"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1680, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}