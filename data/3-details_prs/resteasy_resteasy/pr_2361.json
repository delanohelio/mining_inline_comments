{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NjU3NDE3", "number": 2361, "title": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations", "bodyText": "", "createdAt": "2020-04-21T12:58:00Z", "url": "https://github.com/resteasy/resteasy/pull/2361", "merged": true, "mergeCommit": {"oid": "3e18532fefe889d3f681d5f9af677df10c1be962"}, "closed": true, "closedAt": "2020-05-15T13:05:18Z", "author": {"login": "jimma"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcauBaEgFqTM5OTc4MzI3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchhv6ZgFqTQxMjYyOTM4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NzgzMjcz", "url": "https://github.com/resteasy/resteasy/pull/2361#pullrequestreview-399783273", "createdAt": "2020-04-24T09:24:02Z", "commit": {"oid": "f6ff5ee23b16a3ce2792973e0fc30f169dc36a2d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOToyNDowMlrOGLOwPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOToyNDowMlrOGLOwPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyOTI0Nw==", "bodyText": "Shouldn't the client (and the event source) be closed before leaving the test?", "url": "https://github.com/resteasy/resteasy/pull/2361#discussion_r414429247", "createdAt": "2020-04-24T09:24:02Z", "author": {"login": "asoldano"}, "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/providers/sse/SseAPITest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package org.jboss.resteasy.test.providers.sse;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.ClientBuilder;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.sse.SseEventSource;\n+\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.resteasy.utils.PermissionUtil;\n+import org.jboss.resteasy.utils.PortProviderUtil;\n+import org.jboss.resteasy.utils.TestUtil;\n+import org.jboss.shrinkwrap.api.Archive;\n+import org.jboss.shrinkwrap.api.asset.EmptyAsset;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+@RunWith(Arquillian.class)\n+@RunAsClient\n+public class SseAPITest {\n+    @Deployment\n+    public static Archive<?> deploy() {\n+        WebArchive war = TestUtil.prepareArchive(SseAPITest.class.getSimpleName());\n+        war.addAsManifestResource(EmptyAsset.INSTANCE, \"beans.xml\");\n+        war.addAsManifestResource(PermissionUtil.createPermissionsXmlAsset(new RuntimePermission(\"modifyThread\")),\n+                \"permissions.xml\");\n+        return TestUtil.finishContainerPrepare(war, null, SseAPIImpl.class, SseAPI.class);\n+    }\n+\n+    private String generateURL(String path) {\n+        return PortProviderUtil.generateURL(path, SseAPITest.class.getSimpleName());\n+    }\n+\n+    // test for RESTEASY-2017:SSE doesn't work with inherited annotations\n+    @Test\n+    public void testAnnotaitonInherited() throws Exception {\n+        final List<String> results = new ArrayList<String>();\n+        Client client = ClientBuilder.newBuilder().build();\n+        WebTarget target = client.target(generateURL(\"/apitest/events\"));\n+        SseEventSource msgEventSource = SseEventSource.target(target).build();\n+\n+        try (SseEventSource eventSource = msgEventSource) {\n+            CountDownLatch countDownLatch = new CountDownLatch(1);\n+            eventSource.register(event -> {\n+                countDownLatch.countDown();\n+                results.add(event.readData(String.class));\n+            }, e -> {\n+                throw new RuntimeException(e);\n+            });\n+            eventSource.open();\n+            WebTarget sendTarget = client.target(generateURL(\"/apitest/send\"));\n+            sendTarget.request().get();\n+            boolean result = countDownLatch.await(30, TimeUnit.SECONDS);\n+            Assert.assertTrue(\"Waiting for event to be delivered has timed out.\", result);\n+        }\n+        Assert.assertEquals(\"One event message was expected.\", 1, results.size());\n+        Assert.assertTrue(\"Expected event contains:AnnotationInheritedEvent, but is:\" + results.get(0),\n+                results.get(0).contains(\"AnnotationInheritedEvent\"));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6ff5ee23b16a3ce2792973e0fc30f169dc36a2d"}, "originalPosition": 67}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f6ff5ee23b16a3ce2792973e0fc30f169dc36a2d", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/f6ff5ee23b16a3ce2792973e0fc30f169dc36a2d", "committedDate": "2020-04-21T11:40:58Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}, "afterCommit": {"oid": "3ab306fd0c755bf541ffdf328de8b808a823a086", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/3ab306fd0c755bf541ffdf328de8b808a823a086", "committedDate": "2020-04-26T13:17:10Z", "message": "RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ab306fd0c755bf541ffdf328de8b808a823a086", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/3ab306fd0c755bf541ffdf328de8b808a823a086", "committedDate": "2020-04-26T13:17:10Z", "message": "RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}, "afterCommit": {"oid": "8de691f916238f6e9d1a2c9372ed41c294ebf1d4", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/8de691f916238f6e9d1a2c9372ed41c294ebf1d4", "committedDate": "2020-04-28T03:04:48Z", "message": "RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8de691f916238f6e9d1a2c9372ed41c294ebf1d4", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/8de691f916238f6e9d1a2c9372ed41c294ebf1d4", "committedDate": "2020-04-28T03:04:48Z", "message": "RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}, "afterCommit": {"oid": "5160d6a610642f2a60d98b32947589e346786612", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/5160d6a610642f2a60d98b32947589e346786612", "committedDate": "2020-04-28T08:17:15Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5160d6a610642f2a60d98b32947589e346786612", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/5160d6a610642f2a60d98b32947589e346786612", "committedDate": "2020-04-28T08:17:15Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}, "afterCommit": {"oid": "962ec63e6bdf1cfb7f37d57b56efced2c5be7356", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/962ec63e6bdf1cfb7f37d57b56efced2c5be7356", "committedDate": "2020-04-28T12:05:36Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d3cb02eef3b7c1a29fef4e31f9f64fdf2d2bf31", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/8d3cb02eef3b7c1a29fef4e31f9f64fdf2d2bf31", "committedDate": "2020-04-29T13:18:00Z", "message": "More test improvement"}, "afterCommit": {"oid": "7b4f4c43c12b91ebdb76317afbb32f2d983d1977", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/7b4f4c43c12b91ebdb76317afbb32f2d983d1977", "committedDate": "2020-05-12T12:13:45Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f51064450974442425aac50b4b2875615072bfd", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/1f51064450974442425aac50b4b2875615072bfd", "committedDate": "2020-05-12T12:33:52Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b4f4c43c12b91ebdb76317afbb32f2d983d1977", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/7b4f4c43c12b91ebdb76317afbb32f2d983d1977", "committedDate": "2020-05-12T12:13:45Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}, "afterCommit": {"oid": "1f51064450974442425aac50b4b2875615072bfd", "author": {"user": {"login": "jimma", "name": "jimma"}}, "url": "https://github.com/resteasy/resteasy/commit/1f51064450974442425aac50b4b2875615072bfd", "committedDate": "2020-05-12T12:33:52Z", "message": "[RESTEASY-2017]:Fix SSE doesn't work with inherited annotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjI5Mzgy", "url": "https://github.com/resteasy/resteasy/pull/2361#pullrequestreview-412629382", "createdAt": "2020-05-15T13:04:47Z", "commit": {"oid": "1f51064450974442425aac50b4b2875615072bfd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1704, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}