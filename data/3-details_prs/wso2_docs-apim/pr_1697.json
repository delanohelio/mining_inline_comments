{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3Mjg3NTIz", "number": 1697, "title": "Adds documentation on custom scope creation for analytics.", "bodyText": "Purpose\nAdding documentation on custom scope creation and user role mapping in WSO2 API Manager Analytics.\nGoals\nEnhancing the doc.\nAutomation tests\n\nIntegration tests\nTested the rendering locally.\n\nSecurity checks\n\nFollowed secure coding standards in http://wso2.com/technical-reports/wso2-secure-engineering-guidelines? yes\nRan FindSecurityBugs plugin and verified report? N/A\nConfirmed that this PR doesn't commit any keys, passwords, tokens, usernames, or other secrets? yes\n\nRelated PRs\n#1690", "createdAt": "2020-08-13T10:11:54Z", "url": "https://github.com/wso2/docs-apim/pull/1697", "merged": true, "mergeCommit": {"oid": "c02c700fb2cad1eedd28cada163d002681c4a978"}, "closed": true, "closedAt": "2020-08-21T09:49:50Z", "author": {"login": "Ketharan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-dDILgH2gAyNDY3Mjg3NTIzOmJmYmY4ZWI0YTRkZTc1NWJhM2U5NWY4NzhhZjg3YmFjYmUyYWJlMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBBshvAFqTQ3MjM1NjgxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bfbf8eb4a4de755ba3e95f878af87bacbe2abe18", "author": {"user": {"login": "Ketharan", "name": null}}, "url": "https://github.com/wso2/docs-apim/commit/bfbf8eb4a4de755ba3e95f878af87bacbe2abe18", "committedDate": "2020-08-13T10:00:03Z", "message": "Adds documentation on custom scope creation for analytics."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df8c90a4adfe68a7829ac53ef4e07b8444a79a25", "author": {"user": {"login": "Ketharan", "name": null}}, "url": "https://github.com/wso2/docs-apim/commit/df8c90a4adfe68a7829ac53ef4e07b8444a79a25", "committedDate": "2020-08-13T10:07:36Z", "message": "Adds a trailing new line."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b", "author": {"user": {"login": "Ketharan", "name": null}}, "url": "https://github.com/wso2/docs-apim/commit/aac223045115b81741cde9e15c62b547804f6e6b", "committedDate": "2020-08-14T05:04:53Z", "message": "Fixes formatting in the config."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzIwMDAz", "url": "https://github.com/wso2/docs-apim/pull/1697#pullrequestreview-467320003", "createdAt": "2020-08-14T05:44:09Z", "commit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTY3MDEw", "url": "https://github.com/wso2/docs-apim/pull/1697#pullrequestreview-467967010", "createdAt": "2020-08-15T12:01:43Z", "commit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMjowMTo0M1rOHBJv8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxMjowOToxN1rOHBJysg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDM1NQ==", "bodyText": "what is the \"dashboard runtime\"? Don't we call t the analytics dashboard? If not, how do we set it up? Shall we link to the place where we can set it up? We need to add it as a pre requisite to the steps as well.", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970355", "createdAt": "2020-08-15T12:01:43Z", "author": {"login": "shaniR"}, "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -1,6 +1,6 @@\n # Managing Analytics Dashboard Permissions\n \n-You can view the API statistics related to both the API Publisher and the Developer Portal using the **dashboard** runtime of the WSO2 API-M Analytics server.\n+You can view the API statistics related to both the API Publisher and the Developer Portal using the **dashboard** runtime of the WSO2 API Manager Analytics server.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDQzMg==", "bodyText": "WSO2 API Manager Analytics uses a set of scopes  - > WSO2 API Manager Analytics makes use of a set of scopes", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970432", "createdAt": "2020-08-15T12:02:31Z", "author": {"login": "shaniR"}, "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -12,6 +12,101 @@ A dashboard has the following three levels of permissions.\n \n ## Configuring Dashboard Permissions\n \n+To support fine-grained access and permission control, WSO2 API Manager Analytics uses a set of scopes. Those scopes are assigned to each dashboard, mapping to different permission levels described above. The following table illustrates the default mapping between scopes and permission levels for each dashboard.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDU5Mw==", "bodyText": "based on the assigned scopes?", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970593", "createdAt": "2020-08-15T12:04:46Z", "author": {"login": "shaniR"}, "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -38,6 +133,8 @@ Follow the instructions below to change the default permissions that are set for\n \n ## Permission level and user role mapping\n \n+As described above the permission level of a logged-in user is decided based on the available scopes. The logged-in user possesses a user role, and scopes are mapped to that user role. You can find the mapping between default scopes and default user roles in the [role mapping table]({{base_path}}/administer/managing-users-and-roles/managing-user-roles/#adding-role-mappings).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDgxNg==", "bodyText": "Are the above permission levels mapped to roles? If so, we can add the role in the table or simply point to the role mapping table in the user management?", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970816", "createdAt": "2020-08-15T12:06:36Z", "author": {"login": "shaniR"}, "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -12,6 +12,101 @@ A dashboard has the following three levels of permissions.\n \n ## Configuring Dashboard Permissions\n \n+To support fine-grained access and permission control, WSO2 API Manager Analytics uses a set of scopes. Those scopes are assigned to each dashboard, mapping to different permission levels described above. The following table illustrates the default mapping between scopes and permission levels for each dashboard.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDQzMg=="}, "originalCommit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDk0NA==", "bodyText": "Break this into steps.\nwe need to point to how to create a custom scope.\nWe need to provide instructions or point to a page that includes them, on how to add role mapping.", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970944", "createdAt": "2020-08-15T12:08:03Z", "author": {"login": "shaniR"}, "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -48,3 +145,30 @@ The following table illustrates the default mapping between the permission level\n | Internal/publisher  | Not allowed               | Not allowed            | Viewer            | Not allowed    | Not allowed    |\n | Internal/subscriber | Viewer                    | Not allowed            | Not allowed       | Not allowed    | Not allowed    |\n \n+\n+Further, you can add custom scopes for WSO2 API Manager Analytics. In order to do that, you have to add the custom scope and role mapping to `RESTAPIScopes` value of `APIM_HOME/repository/resources/tenant-conf.json` file and configure that in `ANALYTICS_HOME/conf/dashboard/deployment.yaml`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDk5Mg==", "bodyText": "in the sample,  don't see where \"RESTAPIScopes\" is.", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970992", "createdAt": "2020-08-15T12:08:43Z", "author": {"login": "shaniR"}, "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -48,3 +145,30 @@ The following table illustrates the default mapping between the permission level\n | Internal/publisher  | Not allowed               | Not allowed            | Viewer            | Not allowed    | Not allowed    |\n | Internal/subscriber | Viewer                    | Not allowed            | Not allowed       | Not allowed    | Not allowed    |\n \n+\n+Further, you can add custom scopes for WSO2 API Manager Analytics. In order to do that, you have to add the custom scope and role mapping to `RESTAPIScopes` value of `APIM_HOME/repository/resources/tenant-conf.json` file and configure that in `ANALYTICS_HOME/conf/dashboard/deployment.yaml`.\n+\n+For example if you need to create a custom scope `apim_analytics:reports:view`,  and map with `Internal/analytics` and `Internal/creator` role, then you have to add  the following entry to `RESTAPIScopes` value.\n+\n+``` toml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTA1OA==", "bodyText": "add this under a step you'll be breaking, based on the above comment.", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470971058", "createdAt": "2020-08-15T12:09:17Z", "author": {"login": "shaniR"}, "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -48,3 +145,30 @@ The following table illustrates the default mapping between the permission level\n | Internal/publisher  | Not allowed               | Not allowed            | Viewer            | Not allowed    | Not allowed    |\n | Internal/subscriber | Viewer                    | Not allowed            | Not allowed       | Not allowed    | Not allowed    |\n \n+\n+Further, you can add custom scopes for WSO2 API Manager Analytics. In order to do that, you have to add the custom scope and role mapping to `RESTAPIScopes` value of `APIM_HOME/repository/resources/tenant-conf.json` file and configure that in `ANALYTICS_HOME/conf/dashboard/deployment.yaml`.\n+\n+For example if you need to create a custom scope `apim_analytics:reports:view`,  and map with `Internal/analytics` and `Internal/creator` role, then you have to add  the following entry to `RESTAPIScopes` value.\n+\n+``` toml\n+    \"Scope\": [\n+       ...,\n+       {\n+              \"Name\": \"apim_analytics:reports:view\",\n+              \"Roles\": \"Internal/analytics, Internal/creator\"\n+       },\n+       ... \n+    ]\n+```\n+\n+Then, you have to append the custom scope, `apim_analytics:reports:view` to the space-separated `allScopes` property in the `ANALYTICS_HOME/conf/dashboard/deployment.yaml` as follows.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aac223045115b81741cde9e15c62b547804f6e6b"}, "originalPosition": 139}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab12d89bb02874fd1eccd6b48d0a387a8ccd7ffa", "author": {"user": {"login": "Ketharan", "name": null}}, "url": "https://github.com/wso2/docs-apim/commit/ab12d89bb02874fd1eccd6b48d0a387a8ccd7ffa", "committedDate": "2020-08-17T09:05:48Z", "message": "Changes the wording and provides steps for custom scope creation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMzU2ODE3", "url": "https://github.com/wso2/docs-apim/pull/1697#pullrequestreview-472356817", "createdAt": "2020-08-21T09:49:42Z", "commit": {"oid": "ab12d89bb02874fd1eccd6b48d0a387a8ccd7ffa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1739, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}