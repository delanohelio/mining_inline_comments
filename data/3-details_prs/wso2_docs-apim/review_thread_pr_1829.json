{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MDY2MjAx", "number": 1829, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMzo1OTo0NFrOEpC2oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDowMDoyMFrOEpC3tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNDczODI1OnYy", "diffSide": "RIGHT", "path": "en/docs/develop/extending-api-manager/saml2-sso/configuring-identity-server-as-idp-for-sso.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMzo1OTo0NFrOHafAEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTozODoxMFrOHekowA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzMjk0NA==", "bodyText": "@isharac , this image is missing in the docs and this PR.", "url": "https://github.com/wso2/docs-apim/pull/1829#discussion_r497532944", "createdAt": "2020-09-30T13:59:44Z", "author": {"login": "Mariangela"}, "path": "en/docs/develop/extending-api-manager/saml2-sso/configuring-identity-server-as-idp-for-sso.md", "diffHunk": "@@ -1,221 +1,324 @@\n # Configuring Identity Server as IDP for SSO\n \n !!! info\n-    The **Single Sign-On with openID Connect** feature is enabled by default in the API Manager.  \n+    The **Single Sign-On with OpenID Connect** feature is enabled by default in WSO2 API Manager.  \n     \n-The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. We use **WSO2 IS 5.10.0** in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n+The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. **WSO2 IS 5.10.0** is used in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n \n-The topics below explain the configurations.\n+!!! tip\n+    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL]({{base_path}}/install-and-setup/setup/setting-up-databases/changing-default-databases/changing-to-mysql/#setting-up-mysql).\n \n--   [Sharing the user store](#sharing-the-user-store)\n--   [Configuring WSO2 API Manager as Service Provider for Identity Server](#configuring-wso2-api-manager-as-service-provider-for-identity-server)\n--   [Configuring WSO2 Identity Server as a SAML 2.0 SSO Identity Provider](#configuring-wso2-identity-server-as-a-saml-20-sso-identity-provider)\n--   [Configuring WSO2 API Manager apps as SAML 2.0 SSO service providers](#configuring-wso2-api-manager-apps-as-saml-20-sso-service-providers)\n+## Step 1 - Share the user store\n \n-!!! tip\n-    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL](https://docs.wso2.com/display/ADMIN44x/Setting+up+MySQL).\n+1. Configure your user store(s) (if you have not done so already).\n \n-## Sharing the user store\n+     Follow the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/).\n \n-1. Initially, configure your user store(s) (if you have not done so already), by following the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/) . \n-2. Thereafter, point both WSO2 IS and WSO2 API Manager to your user stores(s) using the instructions given below. \n-This is required to make sure that a user who tries to log in to the Developer Portal or the Publisher is authorized. When a user tries to log in to either of the applications, s/he is redirected to the configured identity provider (WSO2 IS in this case) where s/he provides the login credentials to be authenticated. \n-In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n-Hence, for the purpose of authorization, the IS and API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n+2. Point both WSO2 IS and WSO2 API Manager to your user stores(s). \n \n-For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as follows:\n+     This is required to make sure that a user who tries to sign in to the Developer Portal or the Publisher is authorized. When users try to sign in to either of the applications, they are redirected to the configured identity provider (WSO2 IS in this case) where they need to provide their login credentials to be authenticated.\n \n-1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n+     In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n \n-    !!! tip\n-        To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features, from [here](https://wso2.com/identity-and-access-management).\n+     Therefore, for the purpose of authorization, WSO2 IS and WSO2 API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n \n-2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n+     Follow the instructions below to point both WSO2 IS and WSO2 API Manager to your user stores(s):\n \n-3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n+     For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as explained below.\n \n-4.  Go to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n-  \n-    **Example**\n+    1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. \n+    \n+         `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n \n-    ``` toml\n-       [database.shared_db]\n-       type = \"mysql\"\n-       url = \"jdbc:mysql://localhost:3306/410_um_db\"\n-       username = \"wso2carbon\"\n-       password = \"wso2carbon\"   \n-    ```\n+        !!! tip\n+            To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features as follows:\n+            \n+            1. Access the [previous WSO2 API Manager related releases](https://wso2.com/api-management/previous-releases/).\n+            2. Select version 3.1.0.\n+            3. Click on the Identity Server as a Key Manager download option.\n \n-    !!! note\n-        Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n+    2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. \n     \n-    !!! info\n-        Refer [Configuring master-datasources.xml](https://docs.wso2.com/display/ADMIN44x/Configuring+master-datasources.xml) for descriptive information about each property of the datasource configuration.\n+         `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n \n-5.  Add the same datasource configuration above to `<IS_HOME>/repository/conf/deployment.toml` file.\n+    3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n \n-7.  The Identity Server has an embedded LDAP user store by default. As this is enabled by default, to change this to database user store, add the following to the `<IS_HOME>/repository/conf/deployment.toml`, follow the instructions in [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/) to disable the default LDAP and enable the JDBC user store instead. \n-  \n-    ``` toml\n-       [user_store]\n-       type = \"database\"\n-    ```\n-  \n-    !!! note\n-        In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e. The following configuration exists in `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, we are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store so that, their user stores are shared.\n+    4.  Navigate to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. \n+    \n+         For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n+    \n+        **Example**\n \n-6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+        ``` toml\n+        [database.shared_db]\n+        type = \"mysql\"\n+        url = \"jdbc:mysql://localhost:3306/410_um_db\"\n+        username = \"wso2carbon\"\n+        password = \"wso2carbon\"   \n+        ```\n+\n+        !!! note\n+            Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n \n+    5.  Add the latter datasource configuration that appears above in the `<IS_HOME>/repository/conf/deployment.toml` file.\n \n-## Configuring WSO2 API Manager as Service Provider for Identity Server\n+    6.  Disable the default LDAP and enable the JDBC user store instead.\n+    \n+         WSO2 Identity Server has an embedded LDAP user store by default. \n+         \n+         1. As the LDAP user store is enabled by default, add the following in the `<IS_HOME>/repository/conf/deployment.toml` file to change this to the database user store.\n+\n+            ``` toml\n+            [user_store]\n+            type = \"database\"\n+            ```\n+         \n+         2. Disable the default LDAP and enable the JDBC user store.\n+         \n+             For instructions, see [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/).  \n+    \n+        !!! note\n+            In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e., The following configuration exists in the `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, you are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store to share their user stores.\n+\n+    6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+\n+## Step 2 - Configure WSO2 API Manager as the Service Provider for WSO2 Identity Server\n \n 1.  Start WSO2 Identity Server.\n \n     ```\n-       ./wso2server.sh -DportOffset=1\n+    ./wso2server.sh -DportOffset=1\n     ```\n \n     !!! tip\n-        You also can change Port offset value in `<IS_HOME>/repository/conf/carbon.xml` file. Add the following to the `<IS_HOME>/repository/conf/deployment.toml`  \n+        You also can change the port offset value in the `<IS_HOME>/repository/conf/carbon.xml` file by adding the following to the `<IS_HOME>/repository/conf/deployment.toml` file.\n+\n         ``` toml\n-            [server]\n-            offset = \"1\"\n+        [server]\n+        offset = \"1\"\n         ```                \n \n-    !!! info\n-        What is port offset?\n+    ??? info \"What is port offset?\"\n         \n         The port offset feature allows you to run multiple WSO2 products, multiple instances of a WSO2 product, or multiple WSO2 product clusters on the same server or virtual machine (VM). The port offset defines the number by which all ports defined in the runtime, such as the HTTP/S ports, will be offset. For example, if the HTTPS port is defined as 9443 and the port offset is 1, the effective HTTPS port will be 9444.\n \n \n-2.  Sign in to the WSO2 IS Management Console UI ( e.g. `https://localhost:9444/carbon)`. \n+2.  Sign in to the WSO2 IS Management Console.\n+     \n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n     !!! tip\n-        If you use sign-in pages that are hosted externally to sign in to the Identity Server, give the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n+        If you are using sign-in pages that are hosted externally to sign in to the Identity Server, define the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n \n-3.  Select **Add** under the **Service Providers** menu.\n+3.  Click **Main**, **Identity**, and then click **Add** under the **Service Providers** menu.\n \n-    ![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n+     [![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n   \n-4.  Give a service provider name and click **Register**.\n-\n-    ![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n-\n-    !!! tip\n-        **In a multi-tenanted environment,** for all tenants to be able to log in to the APIM Web applications, do the following:\n-\n-        -   Click the **SaaS Application** option that appears after registering the service provider.\n-           \n-           ![]({{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png)\n-           \n-           If not, only users in the current tenant domain (the one you are defining the service provider in) will be allowed to log in to the Web application and you have to register new service providers for all Web applications (Developer Portal and API Publisher in this case) from each tenant space separately. For example, let's say you have three tenants as TA, TB and TC and you register the service provider in TA only. If you tick the **SaaS Application** option, all users in TA, TB, TC tenant domains will be able to log in. Else, only users in TA will be able to log in.\n+4.  Enter a Service Provider name and click **Register**.\n+\n+     The detailed configuration page appears.\n+\n+     [![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n+\n+    <div class=\"admonition tip\">\n+    <p class=\"admonition-title\">Multi-tenanted environment</p>\n+    <p>\n+    <p>Carry out the instructions given below for all the tenants to be able to sign in to the API-M Web applications in a <b>multi-tenanted environment</b>.</p>\n+    <p><ol><li>Click the **SaaS Application** option that appears after registering the service provider.</p>\n+    <a href=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"><img src=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"></a>\n+    <p>If you do not select the SaaS Application option, only users in the current tenant domain (the tenant domain that you are defining the service provider in) will be allowed to sign in to the Web application and you will need to register new service providers for all the Web applications (Developer Portal and API Publisher in this case) from each tenant space separately.</p>\n+    <p><br/>For example, let's say that you have three tenants as TA, TB and TC, and you register the service provider in TA only. If you tick the <b>SaaS Application</b> option, all users in TA, TB, TC tenant domains will be able to sign in. Else, only users in TA will be able to sign in.</p>\n+    </li>\n+    <li><p>As the servers in a multi-tenanted environment interact with all tenants, all nodes should share the same user store. Therefore, make sure you have a shared registry (JDBC mount, WSO2 Governance Registry, etc.) instance across all nodes.</p></li>\n+    </ol>\n+    </p>\n+    </div>\n+\n+5.  Expand the **Inbound Authentication Configuration** section, then expand the **SAML2 Web SSO Configuration** section, and click **Configure**.\n+    \n+     [![inbound-authentication-config]({{base_path}}/assets/img/learn/extensions/saml2-sso/inbound-authentication-config.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/inbound-authentication-config.png)\n   \n-        -   Because the servers in a multi-tenanted environment interact with all tenants, all nodes should share the same user store. Therefore, make sure you have a shared registry (JDBC mount, WSO2 Governance Registry, etc.) instance across all nodes.\n+    !!! note \"Enable a tenant-specific SSO for the Publisher and Developer Portal\"\n+        To enable a tenant-specific SSO with IS 5.10.0 for `Publisher` and the `Developer Portal`, enable the **Use tenant domain in local subject identifier** option under the **Local & Outbound Authentication Configuration** section.\n \n-5.  You are navigated to the detailed configuration page. Inside the **Inbound Authentication Configuration** section, expand **SAML2 Web SSO Configuration** and click **Configure** .\n-   ![inbound-authentication-config]({{base_path}}/assets/img/learn/extensions/saml2-sso/inbound-authentication-config.png)\n-  \n-    !!! note\n-        To enable tenant-specific SSO with IS 5.10.0 for `API Publisher` and `Developer Portal`, enable **Use tenant domain in local subject identifier** under the Local & Outbound Authentication Configuration section.\n+        [![enable-tenant-domain]({{base_path}}/assets/img/learn/extensions/saml2-sso/enable-tenant-domain.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/enable-tenant-domain.png)\n \n-        ![enable-tenant-domain]({{base_path}}/assets/img/learn/extensions/saml2-sso/enable-tenant-domain.png)\n+6.  Register the API Publisher as the SSO service provider. \n \n-6.  Provide the configurations to register the API Publisher as the SSO service provider. These sample values may change depending on your configuration.\n+     1. Enter the configurations to register the API Publisher as the SSO service provider. These sample values may change based on your configuration.\n \n-    -   **Issuer**: apim\n-    -   **Assertion Consumer URL**: `https://localhost:9443/commonauth`. Change the IP and port accordingly. This is the URL for the Assertion Consumer Services (ACS) page in your running publisher app.\n-    -   **Response Signing Algorithm**: rsa-sha256   \n-    -   Select the following options:\n-    \n-           -   **Enable Response Signing**\n-           -   **Enable Signature Validation in Authentication Requests and Logout Request**\n-           -   **Enable Single Logout**\n+        -   **Issuer**: apim\n+        -   **Assertion Consumer URL**: `https://localhost:9443/commonauth`. \n+            \n+            Change the IP and port accordingly. This is the URL for the Assertion Consumer Services (ACS) page in your running publisher app.\n+\n+        -   **Response Signing Algorithm**: rsa-sha256   \n+        -   Select the following options:\n+        \n+            -   **Enable Response Signing**\n+            -   **Enable Signature Validation in Authentication Requests and Logout Request**\n+            -   **Enable Single Logout**\n     \n-    -   Click **Register** once done.\n+    2.   Click **Register**.\n \n     **Example**\n     \n     [![sample-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-sp.png)\n \n-7. Upload the public certificate of the API Manager by selecting **Select SP Certificate Type**\n-\n-## Configuring WSO2 Identity Server as a SAML 2.0 SSO Identity Provider\n+7. Upload the public certificate of the API Manager by selecting **Select SP Certificate Type**.\n \n-Similarly, add Identity Server as an identity provider configurations in `https://localhost:9443/carbon`. These sample values may change depending in your configuration.\n+## Step 3 - Configure WSO2 Identity Server as a SAML 2.0 SSO Identity Provider\n \n 1. Start API Manager\n-  ```\n-       ./wso2server.sh\n-   ```\n+  \n+    ```\n+    ./wso2server.sh\n+    ```\n  \n-2.  Sign in to the WSO2 API Management Console UI ( e.g. `https://localhost:9443/carbon)`.\n+2.  Sign in to the WSO2 API Management Console.\n+\n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n-3.  Select **Add** under the **Identity Providers** menu.\n+3.  Click **Main**, **Identity**, and then click **Add** under the **Identity Providers** menu.\n \n-    ![add-idp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-idp.png)\n+     <a href=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/add-idp.png\"><img src=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/add-idp.png\" width=\"300\"></a>\n     \n-4. Upload public certificate of Identity Server in **Identity Provider Public Certificate**.\n+4. Upload the public certificate of Identity Server under **Identity Provider Public Certificate**.\n \n-5. Configure **Federated authenticators** > **SAML2 Web SSO Configurations**\n+5. Define the Federated authenticator.\n \n-    [![federated-auth]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)\n+    1. Expand the **Federated authenticators** section, then expand the **SAML2 Web SSO Configurations** section and define the Federated authenticator as follows:\n+\n+         [![federated-auth]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)\n     \n-    -   **Identity Provider Name**: is\n-    -   **Service Provider Entity ID**: apim . This value can change depending on the **Issuer** value defined in WSO2 IS SSO configuration above.\n-    -   **Identity Provider Entity ID**: localhost\n-    -   **SSO URL**: `https://localhost:9444/samlsso` Change the IP and port accordingly. This is the redirecting SSO URL in your running WSO2 IS server instance.\n-    -   **Signature Algorithm**: RSA with SHA256\n-    -   Select the following options:\n-        -   **Enable SAML2 Web SSO**\n-        -   **Enable Authentication Request Signing**\n-        -   **Enable Authentication Response Signing**\n-        -   **Enable Logout Request Signing**\n-        -   **Enable Logout**      \n-    -   Click **Register** once done.\n+        -   **Identity Provider Name**: is\n+        -   **Service Provider Entity ID**: apim\n+            \n+            This value can change depending on the **Issuer** value defined in WSO2 IS SSO configuration above.\n+        \n+        -   **Identity Provider Entity ID**: localhost\n+        -   **SSO URL**: `https://localhost:9444/samlsso` \n+        \n+            Change the IP and port accordingly. This is the redirecting SSO URL in your running WSO2 IS server instance.\n+\n+        -   **Signature Algorithm**: RSA with SHA256\n+        -   Select the following options:\n+            -   **Enable SAML2 Web SSO**\n+            -   **Enable Authentication Request Signing**\n+            -   **Enable Authentication Response Signing**\n+            -   **Enable Logout Request Signing**\n+            -   **Enable Logout**\n+\n+    2. Click **Register**.\n \n \n    **Example**\n   \n    [![sample-idp]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-idp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-idp.png)\n \n !!! note\n-    Make sure your service provider configuration in Identity server and identity provider configuration in API Manager is similarly reflect on each other. \n-    For an example, \n+    Make sure your service provider configurations in the Identity Server and the identity provider configurations in API Manager are similarly reflected to each other.\n+\n+    Example: \n     \n-    -   If **Response Signing Algorithm** in Identity Server is rsa-sha256, then **Signature Algorithm** API Manager should be RSA with SHA256.\n+    -   If the **Response Signing Algorithm** in Identity Server is `rsa-sha256`, then the **Signature Algorithm** in API Manager should be `RSA with SHA256`.\n     -   If you enabled **Enable Single Logout** in Identity Server, then enable **Enable Logout** in API Manager.\n \n-## Configuring WSO2 API Manager apps as SAML 2.0 SSO service providers\n+## Step 4 - Configure WSO2 API Manager apps as SAML 2.0 SSO service providers\n+\n+1.  Sign in to the WSO2 API-M Management Console.\n \n-1.  Sign in to the WSO2 API Management Console UI ( `https://localhost:9443/carbon)`.\n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n-2.  List service providers and select edit on API Publisher application.\n+2.  List the service providers and click the edit option that corresponds to the API Publisher.\n \n-    ![listed-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/listed-sp.png)\n+    [![listed-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/listed-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/listed-sp.png)\n   \n     !!! note\n-        Please note that the publisher and developer portal service providers will be listed under service providers after you have logged in to the publisher and the developer portal at least once. \n+        The Publisher and Developer Portal service providers will be listed under service providers after you have logged in to the Publisher and the Developer Portal at least once. \n          \n-3.  Go to **Local and Outbound Authentication Configuration** and select Identity Provider as the **Federated Authentication**.\n+3.  Navigate to **Local and Outbound Authentication Configuration** and select Identity Provider as the **Federated Authentication**.\n \n-    ![app-federate]({{base_path}}/assets/img/learn/extensions/saml2-sso/app-federate.png)\n+    [![app-federate]({{base_path}}/assets/img/learn/extensions/saml2-sso/app-federate.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/app-federate.png)\n   \n-4.  Click **update** once done.\n+4.  Click **Update**.\n \n-5.  Repeat the above steps (Step 2 to Step 4) to the Developer Portal Application as well.\n+5.  Repeat the above steps (Step 2 to Step 4) with regard to the Developer Portal as well.\n \n-4.  Access the API Publisher: `https://localhost:<PORT>/publisher` (e.g., `https://localhost:9443/publisher` ). Observe the request redirect to the WSO2 IS SAML2.0 based SSO login page. For example,\n-    ![login-page]({{base_path}}/assets/img/learn/extensions/saml2-sso/login-page.png)\n+4.  Access the Publisher.\n+\n+     `https://<hostname>:9443/publisher`\n+     \n+     `https://localhost:9443/publisher`\n+\n+     Observe that the request is redirected to the WSO2 IS SAML2.0 based SSO login page.\n+\n+    [![login-page]({{base_path}}/assets/img/learn/extensions/saml2-sso/login-page.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/login-page.png)\n   \n-5.  Enter user credentials. If the user authentication is successful against WSO2 IS, it will redirect to the API Publisher Web application with the user already authenticated.\n+5.  Enter the user credentials. \n \n-6.  Access the Developer Portal application, click its **Login** link (top, right-hand corner) and verify that the same user is already authenticated in Developer Portal.\n+     If the user authentication is successful against WSO2 IS, it will redirect to the API Publisher Web application with the user already authenticated.\n+\n+6.  Access the Developer Portal application, click its **Login** link (top, right-hand corner) and verify that the same user is already authenticated in the Developer Portal.\n \n !!! note\n-    Even with SSO enabled, if the user doesn't have sufficient privileges to access API Publisher/Developer Portal or any other application, s/he will not be authorized to access them.\n+    Even with SSO enabled, if users do not have sufficient privileges to access API Publisher/Developer Portal or any other application, they will not be authorized to access them.\n \n !!! info\n     To learn more about Single Sign-On with WSO2 Identity Server, see [SAML 2.0 Web SSO](https://is.docs.wso2.com/en/5.10.0/learn/saml-2.0-web-sso/) in the WSO2 Identity Server documentation.\n \n-\n-\n+## Step 5 - Configure the WSO2 API Manager Admin Portal as the SAML 2.0 SSO service provider\n+\n+1. Open the `<API-M_HOME>/repository/deployment/server/jaggeryapps/admin/site/conf/site.json` file.\n+\n+2. Modify the following configurations found under `ssoConfiguration`.\n+\n+    <table>\n+    <colgroup>\n+    <col width=\"33%\" />\n+    <col width=\"33%\" />\n+    <col width=\"33%\" />\n+    </colgroup>\n+    <thead>\n+    <tr class=\"header\">\n+    <th><b>Parameter</b></th>\n+    <th><b>Description</b></th>\n+    </tr>\n+    </thead>\n+    <tbody>\n+    <tr class=\"odd\">\n+    <td><pre><code>enabled</code></pre></td>\n+    <td>Set this value to <code>true</code> to enable SSO in the application.</td>\n+    </tr>\n+    <tr class=\"even\">\n+    <td><pre><code>issuer</code></pre></td>\n+    <td><code>ADMIN_PORTAL</code>\n+    <br/>This value can change depending on the Issuer value defined in WSO2 IS SSO configuration above.</td>\n+    </tr>\n+    <tr class=\"odd\">\n+    <td><pre><code>identityProviderURL</code></pre></td>\n+    <td><code>https://localhost:9444/samlsso</code>\n+    <br/> Change the IP and port accordingly. This is the redirecting SSO URL in your running WSO2 IS server instance.</td>\n+    </tr>\n+    <tr class=\"odd\">\n+    <td><pre><code>keyStoreName</code></pre></td>\n+    <td>The keystore of the running IDP. As you use a remote instance of WSO2 IS here, you can import the public certificate of the IS keystore to the APIM and then point to the APIM keystore. The default keystore of the APIM is <code>&lt;API-M_HOME&gt;/repository/resources/security/wso2carbon.jks</code>. Be sure to define the full path of the keystore here.</td>\n+    </tr>\n+    <tr class=\"even\">\n+    <td><pre><code>keyStorePassword</code></pre></td>\n+    <td>Password for the above keystore. The default <code>keyStorePassword</code> is <code>wso2carbon</code></td>\n+    </tr>\n+    <tr class=\"odd\">\n+    <td><pre><code>identityAlias</code></pre></td>\n+    <td><code>wso2carbon</code></td>\n+    </tr>\n+    </tbody>\n+    </table>\n+\n+     [![Admin Portal SSO Configuration]({{base_path}}/assets/img/develop/extensions/admin-portal-sso-config.png)]({{base_path}}/assets/img/develop/extensions/admin-portal-sso-config.png)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "134112039bc07ba6c9c6f1bcbab2e2f2a5f5fbed"}, "originalPosition": 454}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxOTU4NA==", "bodyText": "Created issue [1] to track the missing image and will remove the broken image link for the moment.\n[1] #2026", "url": "https://github.com/wso2/docs-apim/pull/1829#discussion_r501819584", "createdAt": "2020-10-08T15:38:10Z", "author": {"login": "Mariangela"}, "path": "en/docs/develop/extending-api-manager/saml2-sso/configuring-identity-server-as-idp-for-sso.md", "diffHunk": "@@ -1,221 +1,324 @@\n # Configuring Identity Server as IDP for SSO\n \n !!! info\n-    The **Single Sign-On with openID Connect** feature is enabled by default in the API Manager.  \n+    The **Single Sign-On with OpenID Connect** feature is enabled by default in WSO2 API Manager.  \n     \n-The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. We use **WSO2 IS 5.10.0** in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n+The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. **WSO2 IS 5.10.0** is used in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n \n-The topics below explain the configurations.\n+!!! tip\n+    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL]({{base_path}}/install-and-setup/setup/setting-up-databases/changing-default-databases/changing-to-mysql/#setting-up-mysql).\n \n--   [Sharing the user store](#sharing-the-user-store)\n--   [Configuring WSO2 API Manager as Service Provider for Identity Server](#configuring-wso2-api-manager-as-service-provider-for-identity-server)\n--   [Configuring WSO2 Identity Server as a SAML 2.0 SSO Identity Provider](#configuring-wso2-identity-server-as-a-saml-20-sso-identity-provider)\n--   [Configuring WSO2 API Manager apps as SAML 2.0 SSO service providers](#configuring-wso2-api-manager-apps-as-saml-20-sso-service-providers)\n+## Step 1 - Share the user store\n \n-!!! tip\n-    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL](https://docs.wso2.com/display/ADMIN44x/Setting+up+MySQL).\n+1. Configure your user store(s) (if you have not done so already).\n \n-## Sharing the user store\n+     Follow the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/).\n \n-1. Initially, configure your user store(s) (if you have not done so already), by following the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/) . \n-2. Thereafter, point both WSO2 IS and WSO2 API Manager to your user stores(s) using the instructions given below. \n-This is required to make sure that a user who tries to log in to the Developer Portal or the Publisher is authorized. When a user tries to log in to either of the applications, s/he is redirected to the configured identity provider (WSO2 IS in this case) where s/he provides the login credentials to be authenticated. \n-In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n-Hence, for the purpose of authorization, the IS and API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n+2. Point both WSO2 IS and WSO2 API Manager to your user stores(s). \n \n-For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as follows:\n+     This is required to make sure that a user who tries to sign in to the Developer Portal or the Publisher is authorized. When users try to sign in to either of the applications, they are redirected to the configured identity provider (WSO2 IS in this case) where they need to provide their login credentials to be authenticated.\n \n-1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n+     In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n \n-    !!! tip\n-        To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features, from [here](https://wso2.com/identity-and-access-management).\n+     Therefore, for the purpose of authorization, WSO2 IS and WSO2 API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n \n-2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n+     Follow the instructions below to point both WSO2 IS and WSO2 API Manager to your user stores(s):\n \n-3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n+     For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as explained below.\n \n-4.  Go to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n-  \n-    **Example**\n+    1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. \n+    \n+         `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n \n-    ``` toml\n-       [database.shared_db]\n-       type = \"mysql\"\n-       url = \"jdbc:mysql://localhost:3306/410_um_db\"\n-       username = \"wso2carbon\"\n-       password = \"wso2carbon\"   \n-    ```\n+        !!! tip\n+            To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features as follows:\n+            \n+            1. Access the [previous WSO2 API Manager related releases](https://wso2.com/api-management/previous-releases/).\n+            2. Select version 3.1.0.\n+            3. Click on the Identity Server as a Key Manager download option.\n \n-    !!! note\n-        Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n+    2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. \n     \n-    !!! info\n-        Refer [Configuring master-datasources.xml](https://docs.wso2.com/display/ADMIN44x/Configuring+master-datasources.xml) for descriptive information about each property of the datasource configuration.\n+         `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n \n-5.  Add the same datasource configuration above to `<IS_HOME>/repository/conf/deployment.toml` file.\n+    3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n \n-7.  The Identity Server has an embedded LDAP user store by default. As this is enabled by default, to change this to database user store, add the following to the `<IS_HOME>/repository/conf/deployment.toml`, follow the instructions in [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/) to disable the default LDAP and enable the JDBC user store instead. \n-  \n-    ``` toml\n-       [user_store]\n-       type = \"database\"\n-    ```\n-  \n-    !!! note\n-        In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e. The following configuration exists in `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, we are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store so that, their user stores are shared.\n+    4.  Navigate to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. \n+    \n+         For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n+    \n+        **Example**\n \n-6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+        ``` toml\n+        [database.shared_db]\n+        type = \"mysql\"\n+        url = \"jdbc:mysql://localhost:3306/410_um_db\"\n+        username = \"wso2carbon\"\n+        password = \"wso2carbon\"   \n+        ```\n+\n+        !!! note\n+            Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n \n+    5.  Add the latter datasource configuration that appears above in the `<IS_HOME>/repository/conf/deployment.toml` file.\n \n-## Configuring WSO2 API Manager as Service Provider for Identity Server\n+    6.  Disable the default LDAP and enable the JDBC user store instead.\n+    \n+         WSO2 Identity Server has an embedded LDAP user store by default. \n+         \n+         1. As the LDAP user store is enabled by default, add the following in the `<IS_HOME>/repository/conf/deployment.toml` file to change this to the database user store.\n+\n+            ``` toml\n+            [user_store]\n+            type = \"database\"\n+            ```\n+         \n+         2. Disable the default LDAP and enable the JDBC user store.\n+         \n+             For instructions, see [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/).  \n+    \n+        !!! note\n+            In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e., The following configuration exists in the `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, you are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store to share their user stores.\n+\n+    6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+\n+## Step 2 - Configure WSO2 API Manager as the Service Provider for WSO2 Identity Server\n \n 1.  Start WSO2 Identity Server.\n \n     ```\n-       ./wso2server.sh -DportOffset=1\n+    ./wso2server.sh -DportOffset=1\n     ```\n \n     !!! tip\n-        You also can change Port offset value in `<IS_HOME>/repository/conf/carbon.xml` file. Add the following to the `<IS_HOME>/repository/conf/deployment.toml`  \n+        You also can change the port offset value in the `<IS_HOME>/repository/conf/carbon.xml` file by adding the following to the `<IS_HOME>/repository/conf/deployment.toml` file.\n+\n         ``` toml\n-            [server]\n-            offset = \"1\"\n+        [server]\n+        offset = \"1\"\n         ```                \n \n-    !!! info\n-        What is port offset?\n+    ??? info \"What is port offset?\"\n         \n         The port offset feature allows you to run multiple WSO2 products, multiple instances of a WSO2 product, or multiple WSO2 product clusters on the same server or virtual machine (VM). The port offset defines the number by which all ports defined in the runtime, such as the HTTP/S ports, will be offset. For example, if the HTTPS port is defined as 9443 and the port offset is 1, the effective HTTPS port will be 9444.\n \n \n-2.  Sign in to the WSO2 IS Management Console UI ( e.g. `https://localhost:9444/carbon)`. \n+2.  Sign in to the WSO2 IS Management Console.\n+     \n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n     !!! tip\n-        If you use sign-in pages that are hosted externally to sign in to the Identity Server, give the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n+        If you are using sign-in pages that are hosted externally to sign in to the Identity Server, define the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n \n-3.  Select **Add** under the **Service Providers** menu.\n+3.  Click **Main**, **Identity**, and then click **Add** under the **Service Providers** menu.\n \n-    ![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n+     [![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n   \n-4.  Give a service provider name and click **Register**.\n-\n-    ![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n-\n-    !!! tip\n-        **In a multi-tenanted environment,** for all tenants to be able to log in to the APIM Web applications, do the following:\n-\n-        -   Click the **SaaS Application** option that appears after registering the service provider.\n-           \n-           ![]({{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png)\n-           \n-           If not, only users in the current tenant domain (the one you are defining the service provider in) will be allowed to log in to the Web application and you have to register new service providers for all Web applications (Developer Portal and API Publisher in this case) from each tenant space separately. For example, let's say you have three tenants as TA, TB and TC and you register the service provider in TA only. If you tick the **SaaS Application** option, all users in TA, TB, TC tenant domains will be able to log in. Else, only users in TA will be able to log in.\n+4.  Enter a Service Provider name and click **Register**.\n+\n+     The detailed configuration page appears.\n+\n+     [![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n+\n+    <div class=\"admonition tip\">\n+    <p class=\"admonition-title\">Multi-tenanted environment</p>\n+    <p>\n+    <p>Carry out the instructions given below for all the tenants to be able to sign in to the API-M Web applications in a <b>multi-tenanted environment</b>.</p>\n+    <p><ol><li>Click the **SaaS Application** option that appears after registering the service provider.</p>\n+    <a href=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"><img src=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"></a>\n+    <p>If you do not select the SaaS Application option, only users in the current tenant domain (the tenant domain that you are defining the service provider in) will be allowed to sign in to the Web application and you will need to register new service providers for all the Web applications (Developer Portal and API Publisher in this case) from each tenant space separately.</p>\n+    <p><br/>For example, let's say that you have three tenants as TA, TB and TC, and you register the service provider in TA only. If you tick the <b>SaaS Application</b> option, all users in TA, TB, TC tenant domains will be able to sign in. Else, only users in TA will be able to sign in.</p>\n+    </li>\n+    <li><p>As the servers in a multi-tenanted environment interact with all tenants, all nodes should share the same user store. Therefore, make sure you have a shared registry (JDBC mount, WSO2 Governance Registry, etc.) instance across all nodes.</p></li>\n+    </ol>\n+    </p>\n+    </div>\n+\n+5.  Expand the **Inbound Authentication Configuration** section, then expand the **SAML2 Web SSO Configuration** section, and click **Configure**.\n+    \n+     [![inbound-authentication-config]({{base_path}}/assets/img/learn/extensions/saml2-sso/inbound-authentication-config.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/inbound-authentication-config.png)\n   \n-        -   Because the servers in a multi-tenanted environment interact with all tenants, all nodes should share the same user store. Therefore, make sure you have a shared registry (JDBC mount, WSO2 Governance Registry, etc.) instance across all nodes.\n+    !!! note \"Enable a tenant-specific SSO for the Publisher and Developer Portal\"\n+        To enable a tenant-specific SSO with IS 5.10.0 for `Publisher` and the `Developer Portal`, enable the **Use tenant domain in local subject identifier** option under the **Local & Outbound Authentication Configuration** section.\n \n-5.  You are navigated to the detailed configuration page. Inside the **Inbound Authentication Configuration** section, expand **SAML2 Web SSO Configuration** and click **Configure** .\n-   ![inbound-authentication-config]({{base_path}}/assets/img/learn/extensions/saml2-sso/inbound-authentication-config.png)\n-  \n-    !!! note\n-        To enable tenant-specific SSO with IS 5.10.0 for `API Publisher` and `Developer Portal`, enable **Use tenant domain in local subject identifier** under the Local & Outbound Authentication Configuration section.\n+        [![enable-tenant-domain]({{base_path}}/assets/img/learn/extensions/saml2-sso/enable-tenant-domain.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/enable-tenant-domain.png)\n \n-        ![enable-tenant-domain]({{base_path}}/assets/img/learn/extensions/saml2-sso/enable-tenant-domain.png)\n+6.  Register the API Publisher as the SSO service provider. \n \n-6.  Provide the configurations to register the API Publisher as the SSO service provider. These sample values may change depending on your configuration.\n+     1. Enter the configurations to register the API Publisher as the SSO service provider. These sample values may change based on your configuration.\n \n-    -   **Issuer**: apim\n-    -   **Assertion Consumer URL**: `https://localhost:9443/commonauth`. Change the IP and port accordingly. This is the URL for the Assertion Consumer Services (ACS) page in your running publisher app.\n-    -   **Response Signing Algorithm**: rsa-sha256   \n-    -   Select the following options:\n-    \n-           -   **Enable Response Signing**\n-           -   **Enable Signature Validation in Authentication Requests and Logout Request**\n-           -   **Enable Single Logout**\n+        -   **Issuer**: apim\n+        -   **Assertion Consumer URL**: `https://localhost:9443/commonauth`. \n+            \n+            Change the IP and port accordingly. This is the URL for the Assertion Consumer Services (ACS) page in your running publisher app.\n+\n+        -   **Response Signing Algorithm**: rsa-sha256   \n+        -   Select the following options:\n+        \n+            -   **Enable Response Signing**\n+            -   **Enable Signature Validation in Authentication Requests and Logout Request**\n+            -   **Enable Single Logout**\n     \n-    -   Click **Register** once done.\n+    2.   Click **Register**.\n \n     **Example**\n     \n     [![sample-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-sp.png)\n \n-7. Upload the public certificate of the API Manager by selecting **Select SP Certificate Type**\n-\n-## Configuring WSO2 Identity Server as a SAML 2.0 SSO Identity Provider\n+7. Upload the public certificate of the API Manager by selecting **Select SP Certificate Type**.\n \n-Similarly, add Identity Server as an identity provider configurations in `https://localhost:9443/carbon`. These sample values may change depending in your configuration.\n+## Step 3 - Configure WSO2 Identity Server as a SAML 2.0 SSO Identity Provider\n \n 1. Start API Manager\n-  ```\n-       ./wso2server.sh\n-   ```\n+  \n+    ```\n+    ./wso2server.sh\n+    ```\n  \n-2.  Sign in to the WSO2 API Management Console UI ( e.g. `https://localhost:9443/carbon)`.\n+2.  Sign in to the WSO2 API Management Console.\n+\n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n-3.  Select **Add** under the **Identity Providers** menu.\n+3.  Click **Main**, **Identity**, and then click **Add** under the **Identity Providers** menu.\n \n-    ![add-idp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-idp.png)\n+     <a href=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/add-idp.png\"><img src=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/add-idp.png\" width=\"300\"></a>\n     \n-4. Upload public certificate of Identity Server in **Identity Provider Public Certificate**.\n+4. Upload the public certificate of Identity Server under **Identity Provider Public Certificate**.\n \n-5. Configure **Federated authenticators** > **SAML2 Web SSO Configurations**\n+5. Define the Federated authenticator.\n \n-    [![federated-auth]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)\n+    1. Expand the **Federated authenticators** section, then expand the **SAML2 Web SSO Configurations** section and define the Federated authenticator as follows:\n+\n+         [![federated-auth]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/federated-auth.png)\n     \n-    -   **Identity Provider Name**: is\n-    -   **Service Provider Entity ID**: apim . This value can change depending on the **Issuer** value defined in WSO2 IS SSO configuration above.\n-    -   **Identity Provider Entity ID**: localhost\n-    -   **SSO URL**: `https://localhost:9444/samlsso` Change the IP and port accordingly. This is the redirecting SSO URL in your running WSO2 IS server instance.\n-    -   **Signature Algorithm**: RSA with SHA256\n-    -   Select the following options:\n-        -   **Enable SAML2 Web SSO**\n-        -   **Enable Authentication Request Signing**\n-        -   **Enable Authentication Response Signing**\n-        -   **Enable Logout Request Signing**\n-        -   **Enable Logout**      \n-    -   Click **Register** once done.\n+        -   **Identity Provider Name**: is\n+        -   **Service Provider Entity ID**: apim\n+            \n+            This value can change depending on the **Issuer** value defined in WSO2 IS SSO configuration above.\n+        \n+        -   **Identity Provider Entity ID**: localhost\n+        -   **SSO URL**: `https://localhost:9444/samlsso` \n+        \n+            Change the IP and port accordingly. This is the redirecting SSO URL in your running WSO2 IS server instance.\n+\n+        -   **Signature Algorithm**: RSA with SHA256\n+        -   Select the following options:\n+            -   **Enable SAML2 Web SSO**\n+            -   **Enable Authentication Request Signing**\n+            -   **Enable Authentication Response Signing**\n+            -   **Enable Logout Request Signing**\n+            -   **Enable Logout**\n+\n+    2. Click **Register**.\n \n \n    **Example**\n   \n    [![sample-idp]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-idp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sample-idp.png)\n \n !!! note\n-    Make sure your service provider configuration in Identity server and identity provider configuration in API Manager is similarly reflect on each other. \n-    For an example, \n+    Make sure your service provider configurations in the Identity Server and the identity provider configurations in API Manager are similarly reflected to each other.\n+\n+    Example: \n     \n-    -   If **Response Signing Algorithm** in Identity Server is rsa-sha256, then **Signature Algorithm** API Manager should be RSA with SHA256.\n+    -   If the **Response Signing Algorithm** in Identity Server is `rsa-sha256`, then the **Signature Algorithm** in API Manager should be `RSA with SHA256`.\n     -   If you enabled **Enable Single Logout** in Identity Server, then enable **Enable Logout** in API Manager.\n \n-## Configuring WSO2 API Manager apps as SAML 2.0 SSO service providers\n+## Step 4 - Configure WSO2 API Manager apps as SAML 2.0 SSO service providers\n+\n+1.  Sign in to the WSO2 API-M Management Console.\n \n-1.  Sign in to the WSO2 API Management Console UI ( `https://localhost:9443/carbon)`.\n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n-2.  List service providers and select edit on API Publisher application.\n+2.  List the service providers and click the edit option that corresponds to the API Publisher.\n \n-    ![listed-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/listed-sp.png)\n+    [![listed-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/listed-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/listed-sp.png)\n   \n     !!! note\n-        Please note that the publisher and developer portal service providers will be listed under service providers after you have logged in to the publisher and the developer portal at least once. \n+        The Publisher and Developer Portal service providers will be listed under service providers after you have logged in to the Publisher and the Developer Portal at least once. \n          \n-3.  Go to **Local and Outbound Authentication Configuration** and select Identity Provider as the **Federated Authentication**.\n+3.  Navigate to **Local and Outbound Authentication Configuration** and select Identity Provider as the **Federated Authentication**.\n \n-    ![app-federate]({{base_path}}/assets/img/learn/extensions/saml2-sso/app-federate.png)\n+    [![app-federate]({{base_path}}/assets/img/learn/extensions/saml2-sso/app-federate.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/app-federate.png)\n   \n-4.  Click **update** once done.\n+4.  Click **Update**.\n \n-5.  Repeat the above steps (Step 2 to Step 4) to the Developer Portal Application as well.\n+5.  Repeat the above steps (Step 2 to Step 4) with regard to the Developer Portal as well.\n \n-4.  Access the API Publisher: `https://localhost:<PORT>/publisher` (e.g., `https://localhost:9443/publisher` ). Observe the request redirect to the WSO2 IS SAML2.0 based SSO login page. For example,\n-    ![login-page]({{base_path}}/assets/img/learn/extensions/saml2-sso/login-page.png)\n+4.  Access the Publisher.\n+\n+     `https://<hostname>:9443/publisher`\n+     \n+     `https://localhost:9443/publisher`\n+\n+     Observe that the request is redirected to the WSO2 IS SAML2.0 based SSO login page.\n+\n+    [![login-page]({{base_path}}/assets/img/learn/extensions/saml2-sso/login-page.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/login-page.png)\n   \n-5.  Enter user credentials. If the user authentication is successful against WSO2 IS, it will redirect to the API Publisher Web application with the user already authenticated.\n+5.  Enter the user credentials. \n \n-6.  Access the Developer Portal application, click its **Login** link (top, right-hand corner) and verify that the same user is already authenticated in Developer Portal.\n+     If the user authentication is successful against WSO2 IS, it will redirect to the API Publisher Web application with the user already authenticated.\n+\n+6.  Access the Developer Portal application, click its **Login** link (top, right-hand corner) and verify that the same user is already authenticated in the Developer Portal.\n \n !!! note\n-    Even with SSO enabled, if the user doesn't have sufficient privileges to access API Publisher/Developer Portal or any other application, s/he will not be authorized to access them.\n+    Even with SSO enabled, if users do not have sufficient privileges to access API Publisher/Developer Portal or any other application, they will not be authorized to access them.\n \n !!! info\n     To learn more about Single Sign-On with WSO2 Identity Server, see [SAML 2.0 Web SSO](https://is.docs.wso2.com/en/5.10.0/learn/saml-2.0-web-sso/) in the WSO2 Identity Server documentation.\n \n-\n-\n+## Step 5 - Configure the WSO2 API Manager Admin Portal as the SAML 2.0 SSO service provider\n+\n+1. Open the `<API-M_HOME>/repository/deployment/server/jaggeryapps/admin/site/conf/site.json` file.\n+\n+2. Modify the following configurations found under `ssoConfiguration`.\n+\n+    <table>\n+    <colgroup>\n+    <col width=\"33%\" />\n+    <col width=\"33%\" />\n+    <col width=\"33%\" />\n+    </colgroup>\n+    <thead>\n+    <tr class=\"header\">\n+    <th><b>Parameter</b></th>\n+    <th><b>Description</b></th>\n+    </tr>\n+    </thead>\n+    <tbody>\n+    <tr class=\"odd\">\n+    <td><pre><code>enabled</code></pre></td>\n+    <td>Set this value to <code>true</code> to enable SSO in the application.</td>\n+    </tr>\n+    <tr class=\"even\">\n+    <td><pre><code>issuer</code></pre></td>\n+    <td><code>ADMIN_PORTAL</code>\n+    <br/>This value can change depending on the Issuer value defined in WSO2 IS SSO configuration above.</td>\n+    </tr>\n+    <tr class=\"odd\">\n+    <td><pre><code>identityProviderURL</code></pre></td>\n+    <td><code>https://localhost:9444/samlsso</code>\n+    <br/> Change the IP and port accordingly. This is the redirecting SSO URL in your running WSO2 IS server instance.</td>\n+    </tr>\n+    <tr class=\"odd\">\n+    <td><pre><code>keyStoreName</code></pre></td>\n+    <td>The keystore of the running IDP. As you use a remote instance of WSO2 IS here, you can import the public certificate of the IS keystore to the APIM and then point to the APIM keystore. The default keystore of the APIM is <code>&lt;API-M_HOME&gt;/repository/resources/security/wso2carbon.jks</code>. Be sure to define the full path of the keystore here.</td>\n+    </tr>\n+    <tr class=\"even\">\n+    <td><pre><code>keyStorePassword</code></pre></td>\n+    <td>Password for the above keystore. The default <code>keyStorePassword</code> is <code>wso2carbon</code></td>\n+    </tr>\n+    <tr class=\"odd\">\n+    <td><pre><code>identityAlias</code></pre></td>\n+    <td><code>wso2carbon</code></td>\n+    </tr>\n+    </tbody>\n+    </table>\n+\n+     [![Admin Portal SSO Configuration]({{base_path}}/assets/img/develop/extensions/admin-portal-sso-config.png)]({{base_path}}/assets/img/develop/extensions/admin-portal-sso-config.png)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzMjk0NA=="}, "originalCommit": {"oid": "134112039bc07ba6c9c6f1bcbab2e2f2a5f5fbed"}, "originalPosition": 454}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNDc0MTAyOnYy", "diffSide": "RIGHT", "path": "en/docs/develop/extending-api-manager/saml2-sso/configuring-identity-server-as-idp-for-sso.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDowMDoyMFrOHafB3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo0MToxNVrOHekw9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzMzQwNw==", "bodyText": "Is it ok to state \"WSO2 Governance Registry\" here?", "url": "https://github.com/wso2/docs-apim/pull/1829#discussion_r497533407", "createdAt": "2020-09-30T14:00:20Z", "author": {"login": "Mariangela"}, "path": "en/docs/develop/extending-api-manager/saml2-sso/configuring-identity-server-as-idp-for-sso.md", "diffHunk": "@@ -1,221 +1,324 @@\n # Configuring Identity Server as IDP for SSO\n \n !!! info\n-    The **Single Sign-On with openID Connect** feature is enabled by default in the API Manager.  \n+    The **Single Sign-On with OpenID Connect** feature is enabled by default in WSO2 API Manager.  \n     \n-The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. We use **WSO2 IS 5.10.0** in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n+The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. **WSO2 IS 5.10.0** is used in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n \n-The topics below explain the configurations.\n+!!! tip\n+    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL]({{base_path}}/install-and-setup/setup/setting-up-databases/changing-default-databases/changing-to-mysql/#setting-up-mysql).\n \n--   [Sharing the user store](#sharing-the-user-store)\n--   [Configuring WSO2 API Manager as Service Provider for Identity Server](#configuring-wso2-api-manager-as-service-provider-for-identity-server)\n--   [Configuring WSO2 Identity Server as a SAML 2.0 SSO Identity Provider](#configuring-wso2-identity-server-as-a-saml-20-sso-identity-provider)\n--   [Configuring WSO2 API Manager apps as SAML 2.0 SSO service providers](#configuring-wso2-api-manager-apps-as-saml-20-sso-service-providers)\n+## Step 1 - Share the user store\n \n-!!! tip\n-    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL](https://docs.wso2.com/display/ADMIN44x/Setting+up+MySQL).\n+1. Configure your user store(s) (if you have not done so already).\n \n-## Sharing the user store\n+     Follow the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/).\n \n-1. Initially, configure your user store(s) (if you have not done so already), by following the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/) . \n-2. Thereafter, point both WSO2 IS and WSO2 API Manager to your user stores(s) using the instructions given below. \n-This is required to make sure that a user who tries to log in to the Developer Portal or the Publisher is authorized. When a user tries to log in to either of the applications, s/he is redirected to the configured identity provider (WSO2 IS in this case) where s/he provides the login credentials to be authenticated. \n-In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n-Hence, for the purpose of authorization, the IS and API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n+2. Point both WSO2 IS and WSO2 API Manager to your user stores(s). \n \n-For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as follows:\n+     This is required to make sure that a user who tries to sign in to the Developer Portal or the Publisher is authorized. When users try to sign in to either of the applications, they are redirected to the configured identity provider (WSO2 IS in this case) where they need to provide their login credentials to be authenticated.\n \n-1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n+     In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n \n-    !!! tip\n-        To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features, from [here](https://wso2.com/identity-and-access-management).\n+     Therefore, for the purpose of authorization, WSO2 IS and WSO2 API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n \n-2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n+     Follow the instructions below to point both WSO2 IS and WSO2 API Manager to your user stores(s):\n \n-3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n+     For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as explained below.\n \n-4.  Go to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n-  \n-    **Example**\n+    1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. \n+    \n+         `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n \n-    ``` toml\n-       [database.shared_db]\n-       type = \"mysql\"\n-       url = \"jdbc:mysql://localhost:3306/410_um_db\"\n-       username = \"wso2carbon\"\n-       password = \"wso2carbon\"   \n-    ```\n+        !!! tip\n+            To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features as follows:\n+            \n+            1. Access the [previous WSO2 API Manager related releases](https://wso2.com/api-management/previous-releases/).\n+            2. Select version 3.1.0.\n+            3. Click on the Identity Server as a Key Manager download option.\n \n-    !!! note\n-        Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n+    2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. \n     \n-    !!! info\n-        Refer [Configuring master-datasources.xml](https://docs.wso2.com/display/ADMIN44x/Configuring+master-datasources.xml) for descriptive information about each property of the datasource configuration.\n+         `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n \n-5.  Add the same datasource configuration above to `<IS_HOME>/repository/conf/deployment.toml` file.\n+    3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n \n-7.  The Identity Server has an embedded LDAP user store by default. As this is enabled by default, to change this to database user store, add the following to the `<IS_HOME>/repository/conf/deployment.toml`, follow the instructions in [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/) to disable the default LDAP and enable the JDBC user store instead. \n-  \n-    ``` toml\n-       [user_store]\n-       type = \"database\"\n-    ```\n-  \n-    !!! note\n-        In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e. The following configuration exists in `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, we are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store so that, their user stores are shared.\n+    4.  Navigate to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. \n+    \n+         For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n+    \n+        **Example**\n \n-6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+        ``` toml\n+        [database.shared_db]\n+        type = \"mysql\"\n+        url = \"jdbc:mysql://localhost:3306/410_um_db\"\n+        username = \"wso2carbon\"\n+        password = \"wso2carbon\"   \n+        ```\n+\n+        !!! note\n+            Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n \n+    5.  Add the latter datasource configuration that appears above in the `<IS_HOME>/repository/conf/deployment.toml` file.\n \n-## Configuring WSO2 API Manager as Service Provider for Identity Server\n+    6.  Disable the default LDAP and enable the JDBC user store instead.\n+    \n+         WSO2 Identity Server has an embedded LDAP user store by default. \n+         \n+         1. As the LDAP user store is enabled by default, add the following in the `<IS_HOME>/repository/conf/deployment.toml` file to change this to the database user store.\n+\n+            ``` toml\n+            [user_store]\n+            type = \"database\"\n+            ```\n+         \n+         2. Disable the default LDAP and enable the JDBC user store.\n+         \n+             For instructions, see [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/).  \n+    \n+        !!! note\n+            In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e., The following configuration exists in the `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, you are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store to share their user stores.\n+\n+    6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+\n+## Step 2 - Configure WSO2 API Manager as the Service Provider for WSO2 Identity Server\n \n 1.  Start WSO2 Identity Server.\n \n     ```\n-       ./wso2server.sh -DportOffset=1\n+    ./wso2server.sh -DportOffset=1\n     ```\n \n     !!! tip\n-        You also can change Port offset value in `<IS_HOME>/repository/conf/carbon.xml` file. Add the following to the `<IS_HOME>/repository/conf/deployment.toml`  \n+        You also can change the port offset value in the `<IS_HOME>/repository/conf/carbon.xml` file by adding the following to the `<IS_HOME>/repository/conf/deployment.toml` file.\n+\n         ``` toml\n-            [server]\n-            offset = \"1\"\n+        [server]\n+        offset = \"1\"\n         ```                \n \n-    !!! info\n-        What is port offset?\n+    ??? info \"What is port offset?\"\n         \n         The port offset feature allows you to run multiple WSO2 products, multiple instances of a WSO2 product, or multiple WSO2 product clusters on the same server or virtual machine (VM). The port offset defines the number by which all ports defined in the runtime, such as the HTTP/S ports, will be offset. For example, if the HTTPS port is defined as 9443 and the port offset is 1, the effective HTTPS port will be 9444.\n \n \n-2.  Sign in to the WSO2 IS Management Console UI ( e.g. `https://localhost:9444/carbon)`. \n+2.  Sign in to the WSO2 IS Management Console.\n+     \n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n     !!! tip\n-        If you use sign-in pages that are hosted externally to sign in to the Identity Server, give the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n+        If you are using sign-in pages that are hosted externally to sign in to the Identity Server, define the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n \n-3.  Select **Add** under the **Service Providers** menu.\n+3.  Click **Main**, **Identity**, and then click **Add** under the **Service Providers** menu.\n \n-    ![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n+     [![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n   \n-4.  Give a service provider name and click **Register**.\n-\n-    ![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n-\n-    !!! tip\n-        **In a multi-tenanted environment,** for all tenants to be able to log in to the APIM Web applications, do the following:\n-\n-        -   Click the **SaaS Application** option that appears after registering the service provider.\n-           \n-           ![]({{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png)\n-           \n-           If not, only users in the current tenant domain (the one you are defining the service provider in) will be allowed to log in to the Web application and you have to register new service providers for all Web applications (Developer Portal and API Publisher in this case) from each tenant space separately. For example, let's say you have three tenants as TA, TB and TC and you register the service provider in TA only. If you tick the **SaaS Application** option, all users in TA, TB, TC tenant domains will be able to log in. Else, only users in TA will be able to log in.\n+4.  Enter a Service Provider name and click **Register**.\n+\n+     The detailed configuration page appears.\n+\n+     [![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n+\n+    <div class=\"admonition tip\">\n+    <p class=\"admonition-title\">Multi-tenanted environment</p>\n+    <p>\n+    <p>Carry out the instructions given below for all the tenants to be able to sign in to the API-M Web applications in a <b>multi-tenanted environment</b>.</p>\n+    <p><ol><li>Click the **SaaS Application** option that appears after registering the service provider.</p>\n+    <a href=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"><img src=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"></a>\n+    <p>If you do not select the SaaS Application option, only users in the current tenant domain (the tenant domain that you are defining the service provider in) will be allowed to sign in to the Web application and you will need to register new service providers for all the Web applications (Developer Portal and API Publisher in this case) from each tenant space separately.</p>\n+    <p><br/>For example, let's say that you have three tenants as TA, TB and TC, and you register the service provider in TA only. If you tick the <b>SaaS Application</b> option, all users in TA, TB, TC tenant domains will be able to sign in. Else, only users in TA will be able to sign in.</p>\n+    </li>\n+    <li><p>As the servers in a multi-tenanted environment interact with all tenants, all nodes should share the same user store. Therefore, make sure you have a shared registry (JDBC mount, WSO2 Governance Registry, etc.) instance across all nodes.</p></li>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "134112039bc07ba6c9c6f1bcbab2e2f2a5f5fbed"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgyMTY4Ng==", "bodyText": "@bhathiya , please share your views.", "url": "https://github.com/wso2/docs-apim/pull/1829#discussion_r501821686", "createdAt": "2020-10-08T15:41:15Z", "author": {"login": "Mariangela"}, "path": "en/docs/develop/extending-api-manager/saml2-sso/configuring-identity-server-as-idp-for-sso.md", "diffHunk": "@@ -1,221 +1,324 @@\n # Configuring Identity Server as IDP for SSO\n \n !!! info\n-    The **Single Sign-On with openID Connect** feature is enabled by default in the API Manager.  \n+    The **Single Sign-On with OpenID Connect** feature is enabled by default in WSO2 API Manager.  \n     \n-The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. We use **WSO2 IS 5.10.0** in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n+The **Single Sign-On with SAML 2.0** feature in the API Manager is implemented according to the SAML 2.0 browser-based SSO support that is facilitated by WSO2 Identity Server (WSO2 IS). This feature is available in any WSO2 IS version from 4.1.0 onwards. **WSO2 IS 5.10.0** is used in this guide. WSO2 Identity Server acts as an identity service provider of systems enabled with single sign-on, while the Web applications act as SSO service providers. Using this feature, you can configure SSO with SAML 2.0 across the API Publisher and Developer Portal. After configuring, you can access the Developer Portal or API Publisher in a single authentication attempt.\n \n-The topics below explain the configurations.\n+!!! tip\n+    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL]({{base_path}}/install-and-setup/setup/setting-up-databases/changing-default-databases/changing-to-mysql/#setting-up-mysql).\n \n--   [Sharing the user store](#sharing-the-user-store)\n--   [Configuring WSO2 API Manager as Service Provider for Identity Server](#configuring-wso2-api-manager-as-service-provider-for-identity-server)\n--   [Configuring WSO2 Identity Server as a SAML 2.0 SSO Identity Provider](#configuring-wso2-identity-server-as-a-saml-20-sso-identity-provider)\n--   [Configuring WSO2 API Manager apps as SAML 2.0 SSO service providers](#configuring-wso2-api-manager-apps-as-saml-20-sso-service-providers)\n+## Step 1 - Share the user store\n \n-!!! tip\n-    In this documentation, MySQL is used as the database to configure WSO2 API Manager with WSO2 Identity Server. For instructions on replacing the default H2 database with MySQL, see [Setting up MySQL](https://docs.wso2.com/display/ADMIN44x/Setting+up+MySQL).\n+1. Configure your user store(s) (if you have not done so already).\n \n-## Sharing the user store\n+     Follow the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/).\n \n-1. Initially, configure your user store(s) (if you have not done so already), by following the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/) . \n-2. Thereafter, point both WSO2 IS and WSO2 API Manager to your user stores(s) using the instructions given below. \n-This is required to make sure that a user who tries to log in to the Developer Portal or the Publisher is authorized. When a user tries to log in to either of the applications, s/he is redirected to the configured identity provider (WSO2 IS in this case) where s/he provides the login credentials to be authenticated. \n-In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n-Hence, for the purpose of authorization, the IS and API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n+2. Point both WSO2 IS and WSO2 API Manager to your user stores(s). \n \n-For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as follows:\n+     This is required to make sure that a user who tries to sign in to the Developer Portal or the Publisher is authorized. When users try to sign in to either of the applications, they are redirected to the configured identity provider (WSO2 IS in this case) where they need to provide their login credentials to be authenticated.\n \n-1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n+     In addition to this, the user should also be authorized by the system to enable [Role-based Permissions]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-permissions/). \n \n-    !!! tip\n-        To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features, from [here](https://wso2.com/identity-and-access-management).\n+     Therefore, for the purpose of authorization, WSO2 IS and WSO2 API Manager needs to have a shared user store and user management database (by default, this is the H2 database in the `<API-M_HOME>/repository/conf/user-mgt.xml` file) where the user's role and permissions are stored.\n \n-2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n+     Follow the instructions below to point both WSO2 IS and WSO2 API Manager to your user stores(s):\n \n-3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n+     For example, let's share a JDBC user store (MySQL) with both the WSO2 Identity Server and WSO2 API Manager as explained below.\n \n-4.  Go to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n-  \n-    **Example**\n+    1.  Download WSO2 API Manager from [here](https://wso2.com/api-management/) and unzip it. \n+    \n+         `<API-M_HOME>` refers to the root folder where WSO2 API-M was unzipped.\n \n-    ``` toml\n-       [database.shared_db]\n-       type = \"mysql\"\n-       url = \"jdbc:mysql://localhost:3306/410_um_db\"\n-       username = \"wso2carbon\"\n-       password = \"wso2carbon\"   \n-    ```\n+        !!! tip\n+            To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features as follows:\n+            \n+            1. Access the [previous WSO2 API Manager related releases](https://wso2.com/api-management/previous-releases/).\n+            2. Select version 3.1.0.\n+            3. Click on the Identity Server as a Key Manager download option.\n \n-    !!! note\n-        Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n+    2.  Download WSO2 Identity Server (WSO2 IS) 5.10.0 from [here](https://wso2.com/identity-and-access-management) and unzip it. \n     \n-    !!! info\n-        Refer [Configuring master-datasources.xml](https://docs.wso2.com/display/ADMIN44x/Configuring+master-datasources.xml) for descriptive information about each property of the datasource configuration.\n+         `<IS_HOME>` refers to the root folder where WSO2 IS was unzipped.\n \n-5.  Add the same datasource configuration above to `<IS_HOME>/repository/conf/deployment.toml` file.\n+    3.  Create a MySQL database (e.g., 410\\_um\\_db) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables.\n \n-7.  The Identity Server has an embedded LDAP user store by default. As this is enabled by default, to change this to database user store, add the following to the `<IS_HOME>/repository/conf/deployment.toml`, follow the instructions in [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/) to disable the default LDAP and enable the JDBC user store instead. \n-  \n-    ``` toml\n-       [user_store]\n-       type = \"database\"\n-    ```\n-  \n-    !!! note\n-        In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e. The following configuration exists in `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, we are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store so that, their user stores are shared.\n+    4.  Navigate to the `<API-M_HOME>/repository/conf/deployment.toml` file and add database configurations. \n+    \n+         For example, you can share a single user store as follows. (If you are sharing multiple datasources, you need to define a datasource for each of the user stores that you are working with, so that they can be shared.)\n+    \n+        **Example**\n \n-6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+        ``` toml\n+        [database.shared_db]\n+        type = \"mysql\"\n+        url = \"jdbc:mysql://localhost:3306/410_um_db\"\n+        username = \"wso2carbon\"\n+        password = \"wso2carbon\"   \n+        ```\n+\n+        !!! note\n+            Change the database URL to the URL of the shared database (MySQL database) you have created above. Modify the username and password parameters in the above configuration with your database credentials.\n \n+    5.  Add the latter datasource configuration that appears above in the `<IS_HOME>/repository/conf/deployment.toml` file.\n \n-## Configuring WSO2 API Manager as Service Provider for Identity Server\n+    6.  Disable the default LDAP and enable the JDBC user store instead.\n+    \n+         WSO2 Identity Server has an embedded LDAP user store by default. \n+         \n+         1. As the LDAP user store is enabled by default, add the following in the `<IS_HOME>/repository/conf/deployment.toml` file to change this to the database user store.\n+\n+            ``` toml\n+            [user_store]\n+            type = \"database\"\n+            ```\n+         \n+         2. Disable the default LDAP and enable the JDBC user store.\n+         \n+             For instructions, see [Internal JDBC User Store Configuration](https://is.docs.wso2.com/en/5.10.0/setup/configuring-a-jdbc-user-store/).  \n+    \n+        !!! note\n+            In WSO2 API Manager, the JDBC User Store is enabled by default. (i.e., The following configuration exists in the `<API-M_HOME>/repository/conf/deployment.toml` by default.) By changing the default user store of the WSO2 Identity server to JDBC User Store, you are pointing both WSO2 API Manager and WSO2 Identity Server to the same user store to share their user stores.\n+\n+    6.  Copy the database driver JAR file to the `<IS_HOME>/repository/components/lib` and `<API-M_HOME>/repository/components/lib` directories.\n+\n+## Step 2 - Configure WSO2 API Manager as the Service Provider for WSO2 Identity Server\n \n 1.  Start WSO2 Identity Server.\n \n     ```\n-       ./wso2server.sh -DportOffset=1\n+    ./wso2server.sh -DportOffset=1\n     ```\n \n     !!! tip\n-        You also can change Port offset value in `<IS_HOME>/repository/conf/carbon.xml` file. Add the following to the `<IS_HOME>/repository/conf/deployment.toml`  \n+        You also can change the port offset value in the `<IS_HOME>/repository/conf/carbon.xml` file by adding the following to the `<IS_HOME>/repository/conf/deployment.toml` file.\n+\n         ``` toml\n-            [server]\n-            offset = \"1\"\n+        [server]\n+        offset = \"1\"\n         ```                \n \n-    !!! info\n-        What is port offset?\n+    ??? info \"What is port offset?\"\n         \n         The port offset feature allows you to run multiple WSO2 products, multiple instances of a WSO2 product, or multiple WSO2 product clusters on the same server or virtual machine (VM). The port offset defines the number by which all ports defined in the runtime, such as the HTTP/S ports, will be offset. For example, if the HTTPS port is defined as 9443 and the port offset is 1, the effective HTTPS port will be 9444.\n \n \n-2.  Sign in to the WSO2 IS Management Console UI ( e.g. `https://localhost:9444/carbon)`. \n+2.  Sign in to the WSO2 IS Management Console.\n+     \n+     `https://<hostname>:9443/carbon`\n+     \n+     `https://localhost:9443/carbon`\n \n     !!! tip\n-        If you use sign-in pages that are hosted externally to sign in to the Identity Server, give the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n+        If you are using sign-in pages that are hosted externally to sign in to the Identity Server, define the absolute URLs of those login pages in the `authenticators.xml` and `application-authenticators.xml` files in the `<IS_HOME>/repository/conf/identity` directory.\n \n-3.  Select **Add** under the **Service Providers** menu.\n+3.  Click **Main**, **Identity**, and then click **Add** under the **Service Providers** menu.\n \n-    ![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n+     [![add-sp]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/add-sp.png)\n   \n-4.  Give a service provider name and click **Register**.\n-\n-    ![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n-\n-    !!! tip\n-        **In a multi-tenanted environment,** for all tenants to be able to log in to the APIM Web applications, do the following:\n-\n-        -   Click the **SaaS Application** option that appears after registering the service provider.\n-           \n-           ![]({{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png)\n-           \n-           If not, only users in the current tenant domain (the one you are defining the service provider in) will be allowed to log in to the Web application and you have to register new service providers for all Web applications (Developer Portal and API Publisher in this case) from each tenant space separately. For example, let's say you have three tenants as TA, TB and TC and you register the service provider in TA only. If you tick the **SaaS Application** option, all users in TA, TB, TC tenant domains will be able to log in. Else, only users in TA will be able to log in.\n+4.  Enter a Service Provider name and click **Register**.\n+\n+     The detailed configuration page appears.\n+\n+     [![sp-name]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)]({{base_path}}/assets/img/learn/extensions/saml2-sso/sp-name.png)\n+\n+    <div class=\"admonition tip\">\n+    <p class=\"admonition-title\">Multi-tenanted environment</p>\n+    <p>\n+    <p>Carry out the instructions given below for all the tenants to be able to sign in to the API-M Web applications in a <b>multi-tenanted environment</b>.</p>\n+    <p><ol><li>Click the **SaaS Application** option that appears after registering the service provider.</p>\n+    <a href=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"><img src=\"{{base_path}}/assets/img/learn/extensions/saml2-sso/saas.png\"></a>\n+    <p>If you do not select the SaaS Application option, only users in the current tenant domain (the tenant domain that you are defining the service provider in) will be allowed to sign in to the Web application and you will need to register new service providers for all the Web applications (Developer Portal and API Publisher in this case) from each tenant space separately.</p>\n+    <p><br/>For example, let's say that you have three tenants as TA, TB and TC, and you register the service provider in TA only. If you tick the <b>SaaS Application</b> option, all users in TA, TB, TC tenant domains will be able to sign in. Else, only users in TA will be able to sign in.</p>\n+    </li>\n+    <li><p>As the servers in a multi-tenanted environment interact with all tenants, all nodes should share the same user store. Therefore, make sure you have a shared registry (JDBC mount, WSO2 Governance Registry, etc.) instance across all nodes.</p></li>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzMzQwNw=="}, "originalCommit": {"oid": "134112039bc07ba6c9c6f1bcbab2e2f2a5f5fbed"}, "originalPosition": 203}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1580, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}