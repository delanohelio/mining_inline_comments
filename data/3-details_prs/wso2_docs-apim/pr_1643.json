{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1Mjc1NzI0", "number": 1643, "title": "update mssql script 2.1 to 3.2 migration", "bodyText": "update mssql script for 2.1 -> 3.2 migration", "createdAt": "2020-08-10T05:10:14Z", "url": "https://github.com/wso2/docs-apim/pull/1643", "merged": true, "mergeCommit": {"oid": "32c5bd7526319e444e76ac798652e8f636edaaf6"}, "closed": true, "closedAt": "2020-08-10T05:23:52Z", "author": {"login": "dushansilva"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9bFnbAH2gAyNDY1Mjc1NzI0OmJkY2YxODdmM2Y0ZjkwMTllYmFmMmYzYTE4NTMwNmUwZjZjMmFmZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9bSeqgFqTQ2Mzk2MjgyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bdcf187f3f4f9019ebaf2f3a185306e0f6c2afdd", "author": {"user": {"login": "dushansilva", "name": "dushansilva"}}, "url": "https://github.com/wso2/docs-apim/commit/bdcf187f3f4f9019ebaf2f3a185306e0f6c2afdd", "committedDate": "2020-08-10T05:09:02Z", "message": "update mssql script 2.1 to 3.2 migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzOTYxMTQz", "url": "https://github.com/wso2/docs-apim/pull/1643#pullrequestreview-463961143", "createdAt": "2020-08-10T05:14:59Z", "commit": {"oid": "bdcf187f3f4f9019ebaf2f3a185306e0f6c2afdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNToxNDo1OVrOG-Bmbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNToxNDo1OVrOG-Bmbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5MTExOA==", "bodyText": "Shall we remove this extra line?", "url": "https://github.com/wso2/docs-apim/pull/1643#discussion_r467691118", "createdAt": "2020-08-10T05:14:59Z", "author": {"login": "Meruja"}, "path": "en/docs/install-and-setup/upgrading-wso2-api-manager/upgrading-from-210-to-320.md", "diffHunk": "@@ -1463,7 +1468,43 @@ Follow the instructions below to move all the existing API Manager configuration\n             UNIQUE (API_ID,TYPE,FIELD)\n         );\n         \n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD UUID VARCHAR(50);\n+        GO\n+        UPDATE AM_APPLICATION_KEY_MAPPING SET UUID = NEWID() WHERE UUID IS NULL;\n+        GO\n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD KEY_MANAGER VARCHAR(50) NOT NULL DEFAULT 'Resident Key Manager';\n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD APP_INFO VARBINARY;\n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD CONSTRAINT app_key_unique_cns UNIQUE (APPLICATION_ID,KEY_TYPE,KEY_MANAGER);\n+\n+        DECLARE @ap_keymap as VARCHAR(8000);\n+        SET @ap_keymap = (SELECT name from sys.objects where parent_object_id=object_id('AM_APPLICATION_KEY_MAPPING') AND type='PK');\n+        EXEC('ALTER TABLE AM_APPLICATION_KEY_MAPPING\n+        drop CONSTRAINT ' + @ap_keymap);\n+\n         UPDATE IDN_OAUTH_CONSUMER_APPS SET CALLBACK_URL='' WHERE CALLBACK_URL IS NULL;\n+        \n+        IF NOT  EXISTS (SELECT * FROM SYS.OBJECTS WHERE OBJECT_ID = OBJECT_ID(N'[DBO].[AM_SCOPE]') AND TYPE IN (N'U'))\n+        CREATE TABLE AM_SCOPE (\n+        SCOPE_ID INTEGER IDENTITY,\n+        NAME VARCHAR(255) NOT NULL,\n+        DISPLAY_NAME VARCHAR(255) NOT NULL,\n+        DESCRIPTION VARCHAR(512),\n+        TENANT_ID INTEGER NOT NULL DEFAULT -1,\n+        SCOPE_TYPE VARCHAR(255) NOT NULL,\n+        PRIMARY KEY (SCOPE_ID)\n+        );\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdcf187f3f4f9019ebaf2f3a185306e0f6c2afdd"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e1c51a86d8381a8555a7ab138602851072631cf", "author": {"user": {"login": "dushansilva", "name": "dushansilva"}}, "url": "https://github.com/wso2/docs-apim/commit/4e1c51a86d8381a8555a7ab138602851072631cf", "committedDate": "2020-08-10T05:18:34Z", "message": "remove extra line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzOTYyODIz", "url": "https://github.com/wso2/docs-apim/pull/1643#pullrequestreview-463962823", "createdAt": "2020-08-10T05:23:05Z", "commit": {"oid": "4e1c51a86d8381a8555a7ab138602851072631cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1716, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}