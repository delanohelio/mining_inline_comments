{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1ODgxMTIw", "number": 6176, "title": "Anomaly #33519: Broken import from geonames", "bodyText": "", "createdAt": "2020-12-10T11:52:12Z", "url": "https://github.com/axelor/axelor-open-suite/pull/6176", "merged": true, "mergeCommit": {"oid": "ed3a8053223ce0689b6e47b58ea3a052d2d63938"}, "closed": true, "closedAt": "2020-12-23T09:10:00Z", "author": {"login": "msh-axelor"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmT_E5gBqjQxMTI4Mzc1MjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdo33ljABqjQxNDI2Nzc0Mjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd345f3d7513fd0d55fc61b05871b74d3bd27ebc", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/cd345f3d7513fd0d55fc61b05871b74d3bd27ebc", "committedDate": "2020-12-10T11:50:11Z", "message": "Anomaly #33519: Broken import from geonames"}, "afterCommit": {"oid": "2aad155686cdd1d6da14f197a0d38d80b959be4a", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/2aad155686cdd1d6da14f197a0d38d80b959be4a", "committedDate": "2020-12-15T06:03:05Z", "message": "Anomaly #33519: Broken import from geonames"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2aad155686cdd1d6da14f197a0d38d80b959be4a", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/2aad155686cdd1d6da14f197a0d38d80b959be4a", "committedDate": "2020-12-15T06:03:05Z", "message": "Anomaly #33519: Broken import from geonames"}, "afterCommit": {"oid": "646147744e3f43bea96d80e14e72a5e198ef3645", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/646147744e3f43bea96d80e14e72a5e198ef3645", "committedDate": "2020-12-15T08:47:41Z", "message": "Anomaly #33519: Broken import from geonames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NDUzNDgz", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#pullrequestreview-554453483", "createdAt": "2020-12-17T10:08:48Z", "commit": {"oid": "646147744e3f43bea96d80e14e72a5e198ef3645"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMDowODo0OFrOIHuD9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMDowOTo0NVrOIHuGeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2NTYyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t   \t<string name=\"geoNamesUrl\" title=\"Geo names url\"/>\n          \n          \n            \n            \t   \t<string name=\"geoNamesUrl\" title=\"GeoNames URL\"/>\n          \n      \n    \n    \n  \n\nDon't forget to regenerate i18n", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r544965620", "createdAt": "2020-12-17T10:08:48Z", "author": {"login": "dtr-axelor"}, "path": "axelor-base/src/main/resources/domains/AppBase.xml", "diffHunk": "@@ -82,6 +82,8 @@\n \t   \t<many-to-one name=\"defaultMailMessageTemplate\" title=\"Default mail message template for notifications\" ref=\"com.axelor.apps.message.db.Template\"/>\n \n \t   \t<one-to-many name=\"mailTemplateAssociationList\" title=\"Email template list for notifications\" ref=\"com.axelor.apps.base.db.MailTemplateAssociation\"/>\n+\t   \t<string name=\"geoNamesUrl\" title=\"Geo names url\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "646147744e3f43bea96d80e14e72a5e198ef3645"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk2NjI2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t<panel name=\"geonamesPanel\" title=\"Geonames\"  colSpan=\"12\">\n          \n          \n            \n            \t\t\t\t<panel name=\"geoNamesPanel\" title=\"GeoNames\" colSpan=\"12\">", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r544966266", "createdAt": "2020-12-17T10:09:45Z", "author": {"login": "dtr-axelor"}, "path": "axelor-base/src/main/resources/views/AppBase.xml", "diffHunk": "@@ -69,6 +69,11 @@\n \t\t\t\t<panel name=\"wsPanel\" title=\"Webservices\"  colSpan=\"12\">\n \t\t\t\t\t<field name=\"currencyWsURL\" colSpan=\"12\"/>\n \t\t\t\t</panel>\n+\t\t\t\t\n+\t\t\t\t<panel name=\"geonamesPanel\" title=\"Geonames\"  colSpan=\"12\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "646147744e3f43bea96d80e14e72a5e198ef3645"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "646147744e3f43bea96d80e14e72a5e198ef3645", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/646147744e3f43bea96d80e14e72a5e198ef3645", "committedDate": "2020-12-15T08:47:41Z", "message": "Anomaly #33519: Broken import from geonames"}, "afterCommit": {"oid": "d32d16470a41d5b498005357e36ae2944ad8fc26", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/d32d16470a41d5b498005357e36ae2944ad8fc26", "committedDate": "2020-12-17T12:10:56Z", "message": "Anomaly #33519: Broken import from geonames"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d32d16470a41d5b498005357e36ae2944ad8fc26", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/d32d16470a41d5b498005357e36ae2944ad8fc26", "committedDate": "2020-12-17T12:10:56Z", "message": "Anomaly #33519: Broken import from geonames"}, "afterCommit": {"oid": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "committedDate": "2020-12-21T11:38:31Z", "message": "Anomaly #33519: Broken import from geonames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NDQxNTE0", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#pullrequestreview-556441514", "createdAt": "2020-12-21T15:00:52Z", "commit": {"oid": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTowMDo1MlrOIJbNMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTowMzo1M1rOIJbT1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc1Mzg0MQ==", "bodyText": "There are several occurrences of this delimiter. You should create a constant for it.", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r546753841", "createdAt": "2020-12-21T15:00:52Z", "author": {"login": "dtr-axelor"}, "path": "axelor-base/src/main/java/com/axelor/apps/base/service/imports/ImportCityServiceImpl.java", "diffHunk": "@@ -278,4 +296,92 @@ private MetaFile extractCityZip(MetaFile dataFile) throws Exception {\n \n     return metaFile;\n   }\n+\n+  private StringBuilder extractDataFromDownloadedFile(BufferedReader downloadedCityFileStream)\n+      throws IOException {\n+\n+    HashMap<String, String> regionMap = new HashMap<>();\n+    HashMap<String, String> departmentMap = new HashMap<>();\n+    HashMap<String, String> cantonMap = new HashMap<>();\n+    List<String> cityList = new ArrayList<>();\n+\n+    String line;\n+\n+    while ((line = downloadedCityFileStream.readLine()) != null) {\n+      String[] values = line.split(\"\\t\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc1NTU0Mg==", "bodyText": "All these constants should be protected instead of public.", "url": "https://github.com/axelor/axelor-open-suite/pull/6176#discussion_r546755542", "createdAt": "2020-12-21T15:03:53Z", "author": {"login": "dtr-axelor"}, "path": "axelor-base/src/main/java/com/axelor/apps/base/service/imports/ImportCityServiceImpl.java", "diffHunk": "@@ -53,9 +62,21 @@\n \n   @Inject private MetaFiles metaFiles;\n \n-  public static String CITYTEXTFILE = \"cityTextFile.txt\";\n+  public static final String CITYTEXTFILE = \"cityTextFile.txt\";\n \n-  public static String DOWNLOAD_LINK = \"http://download.geonames.org/export/zip/\";\n+  public static final String FEATURE_CLASS_FOR_CANTON_REGION_DEPARTMENT = \"A\";\n+\n+  public static final String FEATURE_CLASS_FOR_CITY = \"P\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_CANTON = \"ADM3\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_REGION = \"ADM1\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_DEPARTMENT = \"ADM2\";\n+\n+  public static final String FEATURE_CLASS_CODE_FOR_CITY = \"ADM4\";\n+\n+  public static final String CITY_NO_LONGER_EXIST_CODE = \"PPLH\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/67c86f9a65a6f976c85032f0e7be2a37fd05bd07", "committedDate": "2020-12-21T11:38:31Z", "message": "Anomaly #33519: Broken import from geonames"}, "afterCommit": {"oid": "440b29fbc5b932c78d07e3278d971f0118f68e4b", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/440b29fbc5b932c78d07e3278d971f0118f68e4b", "committedDate": "2020-12-22T10:46:14Z", "message": "Anomaly #33519: Broken import from geonames"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "440b29fbc5b932c78d07e3278d971f0118f68e4b", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/440b29fbc5b932c78d07e3278d971f0118f68e4b", "committedDate": "2020-12-22T10:46:14Z", "message": "Anomaly #33519: Broken import from geonames"}, "afterCommit": {"oid": "9bc8abd2b6b2f3fff09df08670d4b4f54133c931", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/9bc8abd2b6b2f3fff09df08670d4b4f54133c931", "committedDate": "2020-12-22T10:50:21Z", "message": "Anomaly #33519: Broken import from geonames"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "committedDate": "2020-12-23T04:59:22Z", "message": "Anomaly #33519: Broken import from geonames"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9bc8abd2b6b2f3fff09df08670d4b4f54133c931", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/9bc8abd2b6b2f3fff09df08670d4b4f54133c931", "committedDate": "2020-12-22T10:50:21Z", "message": "Anomaly #33519: Broken import from geonames"}, "afterCommit": {"oid": "48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "author": {"user": {"login": "msh-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/48a8cd97e7a4194e66b6b08abb21afbeee95fcdb", "committedDate": "2020-12-23T04:59:22Z", "message": "Anomaly #33519: Broken import from geonames"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2066, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}