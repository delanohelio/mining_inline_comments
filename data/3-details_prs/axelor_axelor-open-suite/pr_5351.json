{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MTk4NjE2", "number": 5351, "title": "RM27523 : Add inventory valuation config", "bodyText": "", "createdAt": "2020-04-22T10:30:29Z", "url": "https://github.com/axelor/axelor-open-suite/pull/5351", "merged": true, "mergeCommit": {"oid": "ac5b1436498c5698468f0a2a43506d9e823e170f"}, "closed": true, "closedAt": "2020-11-04T09:23:24Z", "author": {"login": "aol-axelor"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcay8aOgFqTQwMDAxODU0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZJ3YrgH2gAyNDA3MTk4NjE2OjZiZGQxODM0MmUxY2FkOTBjNTNkOThiMzlkZTBiMzZjMjVhYTliNDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDE4NTQx", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#pullrequestreview-400018541", "createdAt": "2020-04-24T14:52:24Z", "commit": {"oid": "bee84abe1dac0b200995b32511b30417c42b9e43"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDo1MjoyNFrOGLbfVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDo1MzozNFrOGLbiww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYzNzkwOA==", "bodyText": "Please compare selection value to static constant", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#discussion_r414637908", "createdAt": "2020-04-24T14:52:24Z", "author": {"login": "ale-axelor"}, "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/InventoryLineService.java", "diffHunk": "@@ -101,10 +100,28 @@ public InventoryLine compute(InventoryLine inventoryLine, Inventory inventory) {\n               : BigDecimal.ZERO;\n       inventoryLine.setGap(gap);\n \n+      BigDecimal price;\n+      int value = stockLocation.getCompany().getStockConfig().getInventoryValuationTypeSelect();\n+      if (value == 2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bee84abe1dac0b200995b32511b30417c42b9e43"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYzODc4Nw==", "bodyText": "do not comment out code, simply remove it.", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#discussion_r414638787", "createdAt": "2020-04-24T14:53:34Z", "author": {"login": "ale-axelor"}, "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/InventoryLineService.java", "diffHunk": "@@ -101,10 +100,28 @@ public InventoryLine compute(InventoryLine inventoryLine, Inventory inventory) {\n               : BigDecimal.ZERO;\n       inventoryLine.setGap(gap);\n \n+      BigDecimal price;\n+      int value = stockLocation.getCompany().getStockConfig().getInventoryValuationTypeSelect();\n+      if (value == 2) {\n+        price = product.getSalePrice();\n+      } else if (value == 3) {\n+        price = product.getCostPrice();\n+      } else {\n+        price = product.getAvgPrice();\n+      }\n+      inventoryLine.setGapValue(gap.multiply(price).setScale(2, RoundingMode.HALF_EVEN));\n+      inventoryLine.setRealValue(\n+          inventoryLine.getRealQty() != null\n+              ? inventoryLine.getRealQty().multiply(price).setScale(2, RoundingMode.HALF_EVEN)\n+              : BigDecimal.ZERO\n+      );\n+\n+      /*StockLocationLine stockLocationLine =\n+              Beans.get(StockLocationLineService.class).getStockLocationLine(stockLocation, product);\n       if (stockLocationLine != null) {\n         inventoryLine.setGapValue(\n             stockLocationLine.getAvgPrice().multiply(gap).setScale(2, RoundingMode.HALF_EVEN));\n-      }\n+      }*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bee84abe1dac0b200995b32511b30417c42b9e43"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bee84abe1dac0b200995b32511b30417c42b9e43", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/bee84abe1dac0b200995b32511b30417c42b9e43", "committedDate": "2020-04-22T10:29:26Z", "message": "RM27523 : Add inventory valuation config"}, "afterCommit": {"oid": "ee16370140064383ede7d7504d2da5e922a59447", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/ee16370140064383ede7d7504d2da5e922a59447", "committedDate": "2020-04-27T07:36:26Z", "message": "RM27523 : Add inventory valuation config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDcxNDQ1", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#pullrequestreview-485071445", "createdAt": "2020-09-09T14:30:54Z", "commit": {"oid": "ee16370140064383ede7d7504d2da5e922a59447"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDozMDo1NVrOHPKQ6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDozMDo1NVrOHPKQ6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY1ODg1OA==", "bodyText": "I think sale price should be chosen if we value using sale.", "url": "https://github.com/axelor/axelor-open-suite/pull/5351#discussion_r485658858", "createdAt": "2020-09-09T14:30:55Z", "author": {"login": "ale-axelor"}, "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/InventoryLineService.java", "diffHunk": "@@ -101,10 +102,21 @@ public InventoryLine compute(InventoryLine inventoryLine, Inventory inventory) {\n               : BigDecimal.ZERO;\n       inventoryLine.setGap(gap);\n \n-      if (stockLocationLine != null) {\n-        inventoryLine.setGapValue(\n-            stockLocationLine.getAvgPrice().multiply(gap).setScale(2, RoundingMode.HALF_EVEN));\n+      BigDecimal price;\n+      int value = stockLocation.getCompany().getStockConfig().getInventoryValuationTypeSelect();\n+      if (value == StockConfigRepository.VALUATION_TYPE_ACCOUNTING_VALUE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee16370140064383ede7d7504d2da5e922a59447"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cc44d069ed7667c4f6dda7f069d7467588b8eb1", "author": {"user": {"login": "ale-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/2cc44d069ed7667c4f6dda7f069d7467588b8eb1", "committedDate": "2020-09-16T15:33:11Z", "message": "Add github workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7429320151cb9f1d871a50abf00b5ada8c4218f8", "author": {"user": {"login": "rme-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/7429320151cb9f1d871a50abf00b5ada8c4218f8", "committedDate": "2020-09-17T04:58:18Z", "message": "Anomaly RM#31259 - Fix NPE when invoice has interco enabled and invoiceLine not having product"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a76f97b3b99c4946a83a955574054b0c51cfc223", "author": {"user": {"login": "sos-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/a76f97b3b99c4946a83a955574054b0c51cfc223", "committedDate": "2020-09-17T05:03:02Z", "message": "Code format fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57528be290c75e61005e36d009b33d0334b9e1af", "author": {"user": {"login": "rch-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/57528be290c75e61005e36d009b33d0334b9e1af", "committedDate": "2020-09-18T09:48:07Z", "message": "Anomaly RM#31300 TEAM : sale order and partner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c35695c6f43e4732f158c30b817441fe77cdc8a3", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/c35695c6f43e4732f158c30b817441fe77cdc8a3", "committedDate": "2020-09-21T09:15:30Z", "message": "RM27523 : Add inventory valuation config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee16370140064383ede7d7504d2da5e922a59447", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/ee16370140064383ede7d7504d2da5e922a59447", "committedDate": "2020-04-27T07:36:26Z", "message": "RM27523 : Add inventory valuation config"}, "afterCommit": {"oid": "c35695c6f43e4732f158c30b817441fe77cdc8a3", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/c35695c6f43e4732f158c30b817441fe77cdc8a3", "committedDate": "2020-09-21T09:15:30Z", "message": "RM27523 : Add inventory valuation config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90af914479152567e3aee16f1b9057a190ad2bf7", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/90af914479152567e3aee16f1b9057a190ad2bf7", "committedDate": "2020-09-21T09:19:33Z", "message": "Merge branch '5.3-dev' into dev-27523"}, "afterCommit": {"oid": "64defd3a722049f6e26a9f8d044802dc2abe81ae", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/64defd3a722049f6e26a9f8d044802dc2abe81ae", "committedDate": "2020-09-24T07:28:16Z", "message": "Merge branch '5.3-dev' into dev-27523"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ba0210f079ebab5fcfb69654a10c6b81f5bef78", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/9ba0210f079ebab5fcfb69654a10c6b81f5bef78", "committedDate": "2020-09-24T07:28:56Z", "message": "Merge branch '5.3-dev' into dev-27523"}, "afterCommit": {"oid": "bc312a6ac3eca6aa298fae6304f74d5f4b65b93f", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/bc312a6ac3eca6aa298fae6304f74d5f4b65b93f", "committedDate": "2020-09-30T08:50:04Z", "message": "Merge branch '5.3-dev' into dev-27523"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56c2ac8b3c4ac0b786d657207e2a8028578db369", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/56c2ac8b3c4ac0b786d657207e2a8028578db369", "committedDate": "2020-09-30T09:38:56Z", "message": "Merge branch '5.3-dev' into dev-27523"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c79c4201ad68a2169fb6901960309aa4dfd75e48", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/c79c4201ad68a2169fb6901960309aa4dfd75e48", "committedDate": "2020-09-30T08:52:07Z", "message": "Merge branch '5.3-dev' into dev-27523"}, "afterCommit": {"oid": "56c2ac8b3c4ac0b786d657207e2a8028578db369", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/56c2ac8b3c4ac0b786d657207e2a8028578db369", "committedDate": "2020-09-30T09:38:56Z", "message": "Merge branch '5.3-dev' into dev-27523"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bdd18342e1cad90c53d98b39de0b36c25aa9b42", "author": {"user": {"login": "aol-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/6bdd18342e1cad90c53d98b39de0b36c25aa9b42", "committedDate": "2020-11-04T08:54:59Z", "message": "Merge branch 'dev' into dev-27523"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1946, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}