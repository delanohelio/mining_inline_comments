{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MjY3NTQw", "number": 5902, "title": "#29776 - Modify appBaseService.getTodayDate()", "bodyText": "Modify appBaseService.getTodayDate() method to take into account the given company's timezone.\nFix RM-29776", "createdAt": "2020-09-28T16:34:35Z", "url": "https://github.com/axelor/axelor-open-suite/pull/5902", "merged": true, "mergeCommit": {"oid": "213538a509dfbcab0ea500302f04b4da2cea8a91"}, "closed": true, "closedAt": "2020-10-02T08:33:34Z", "author": {"login": "lde-axelor"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNWOpxAH2gAyNDk0MjY3NTQwOjk3MGQ2ZGU0MTQxYTk5ODI2YWM4ZWRlMGM4M2Y3MjE0MDkxOTUxZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOhxI_gH2gAyNDk0MjY3NTQwOjRkZTFkOWJhNTU5MmQ2ZGIxYWZmNGYxZDM2Y2M4ZmZlZjBjNzdkNWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "970d6de4141a99826ac8ede0c83f7214091951db", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/970d6de4141a99826ac8ede0c83f7214091951db", "committedDate": "2020-09-28T16:32:10Z", "message": "Modify appBaseService.getTodayDate() method to take into account the\ngiven company's timezone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca42e9cf7da841d29759f4b6446df034449ff0b", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/8ca42e9cf7da841d29759f4b6446df034449ff0b", "committedDate": "2020-09-28T16:41:52Z", "message": "Readd a deprecated getTodayDate() method without company for the client project's compatibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99bc001a9e0a67cff0cf24a26d6908b4cac01f15", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/99bc001a9e0a67cff0cf24a26d6908b4cac01f15", "committedDate": "2020-09-29T08:01:23Z", "message": "Apply spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c9e7bc86931dc2ce7105535401229cda5c4f6c4", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/4c9e7bc86931dc2ce7105535401229cda5c4f6c4", "committedDate": "2020-09-29T10:39:50Z", "message": "Fix DateTool's getTodayDateTime method when given timezone is null"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "135de227c46b9188dfc5497fc98b126b845b39cc", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/135de227c46b9188dfc5497fc98b126b845b39cc", "committedDate": "2020-09-29T09:46:13Z", "message": "Fix DateTool's getTodayDateTime method when given timezone is null"}, "afterCommit": {"oid": "4c9e7bc86931dc2ce7105535401229cda5c4f6c4", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/4c9e7bc86931dc2ce7105535401229cda5c4f6c4", "committedDate": "2020-09-29T10:39:50Z", "message": "Fix DateTool's getTodayDateTime method when given timezone is null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb67046ab8a31824758be6a75bd845ee2718e67e", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/eb67046ab8a31824758be6a75bd845ee2718e67e", "committedDate": "2020-09-30T13:14:45Z", "message": "Fix NPE in TemplateMessageServiceBaseImpl constructor in case connected user's activeCompany is null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f79096d4f5256829a116d118832da88bf9f073b6", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/f79096d4f5256829a116d118832da88bf9f073b6", "committedDate": "2020-09-30T13:18:25Z", "message": "Fix AuthUtils.getUser().getActiveCompany() related potentials NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23165378ce4319cd5f62049174c6a758643a2ede", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/23165378ce4319cd5f62049174c6a758643a2ede", "committedDate": "2020-09-30T13:28:57Z", "message": "Fix __user__.activeCompany related potentials NPE and apply spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "484039ea7f090f560f323734c21e656e9c444015", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/484039ea7f090f560f323734c21e656e9c444015", "committedDate": "2020-09-30T15:31:34Z", "message": "Fix NPE in computeAnalyticDistribution and createAnalyticDistributionWithTemplate of InvoiceLineServiceImpl if invoiceLine.getInvoice() is null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/de76e65bb2f4b037ca059238596932134d565f3a", "committedDate": "2020-09-30T16:24:28Z", "message": "Fix potentials NPE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzY1NDMx", "url": "https://github.com/axelor/axelor-open-suite/pull/5902#pullrequestreview-500365431", "createdAt": "2020-10-01T13:48:12Z", "commit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzo0ODoxMlrOHbLP0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDoxMDowOVrOHbMP1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1Nzg3NA==", "bodyText": "can values.get(\"endOfValidityDateShift\") return null here ?", "url": "https://github.com/axelor/axelor-open-suite/pull/5902#discussion_r498257874", "createdAt": "2020-10-01T13:48:12Z", "author": {"login": "ale-axelor"}, "path": "axelor-account/src/main/java/com/axelor/csv/script/ImportMoveTemplate.java", "diffHunk": "@@ -18,17 +18,27 @@\n package com.axelor.csv.script;\n \n import com.axelor.apps.account.db.MoveTemplate;\n+import com.axelor.apps.base.service.app.AppBaseService;\n+import com.axelor.common.StringUtils;\n+import com.axelor.inject.Beans;\n import java.io.IOException;\n import java.util.Map;\n \n public class ImportMoveTemplate {\n-  public Object setCompany(Object bean, Map<String, Object> values) throws IOException {\n+  public Object importMove(Object bean, Map<String, Object> values) throws IOException {\n     assert bean instanceof MoveTemplate;\n     MoveTemplate moveTemplate = (MoveTemplate) bean;\n \n     try {\n       if (moveTemplate.getJournal() != null) {\n         moveTemplate.setCompany(moveTemplate.getJournal().getCompany());\n+        String dateShift = values.get(\"endOfValidityDateShift\").toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI2MTkxNA==", "bodyText": "please translate javadoc to english", "url": "https://github.com/axelor/axelor-open-suite/pull/5902#discussion_r498261914", "createdAt": "2020-10-01T13:53:37Z", "author": {"login": "ale-axelor"}, "path": "axelor-base/src/main/java/com/axelor/apps/base/service/app/AppBaseService.java", "diffHunk": "@@ -36,21 +37,42 @@\n   // Date du jour\n \n   /**\n-   * R\u00e9cup\u00e9rer la date du jour avec l'heure. Retourne la date du jour param\u00e9tr\u00e9 dans l'utilisateur\n-   * si existe, sinon r\u00e9cup\u00e8re celle de l'administration g\u00e9n\u00e9rale, sinon date du jour. private\n+   * R\u00e9cup\u00e9rer la date du jour avec l'heure en fonction de la timezone du serveur. Retourne la date\n+   * du jour param\u00e9tr\u00e9 dans l'utilisateur si existe, sinon r\u00e9cup\u00e8re celle de l'administration\n+   * g\u00e9n\u00e9rale, sinon date du jour. private", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI2MjE0NQ==", "bodyText": "please translate javadoc to english", "url": "https://github.com/axelor/axelor-open-suite/pull/5902#discussion_r498262145", "createdAt": "2020-10-01T13:53:57Z", "author": {"login": "ale-axelor"}, "path": "axelor-base/src/main/java/com/axelor/apps/base/service/app/AppBaseService.java", "diffHunk": "@@ -36,21 +37,42 @@\n   // Date du jour\n \n   /**\n-   * R\u00e9cup\u00e9rer la date du jour avec l'heure. Retourne la date du jour param\u00e9tr\u00e9 dans l'utilisateur\n-   * si existe, sinon r\u00e9cup\u00e8re celle de l'administration g\u00e9n\u00e9rale, sinon date du jour. private\n+   * R\u00e9cup\u00e9rer la date du jour avec l'heure en fonction de la timezone du serveur. Retourne la date\n+   * du jour param\u00e9tr\u00e9 dans l'utilisateur si existe, sinon r\u00e9cup\u00e8re celle de l'administration\n+   * g\u00e9n\u00e9rale, sinon date du jour. private\n    *\n    * @return\n    */\n   public ZonedDateTime getTodayDateTime();\n \n   /**\n-   * R\u00e9cup\u00e9rer la date du jour. Retourne la date du jour param\u00e9tr\u00e9 dans l'utilisateur si existe,\n-   * sinon r\u00e9cup\u00e8re celle de l'administration g\u00e9n\u00e9rale, sinon date du jour.\n+   * R\u00e9cup\u00e9rer la date du jour avec l'heure en fonction de la timezone renseign\u00e9e dans la soci\u00e9t\u00e9", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI2Mjk1OA==", "bodyText": "see above", "url": "https://github.com/axelor/axelor-open-suite/pull/5902#discussion_r498262958", "createdAt": "2020-10-01T13:54:59Z", "author": {"login": "ale-axelor"}, "path": "axelor-base/src/main/java/com/axelor/apps/base/service/app/AppBaseService.java", "diffHunk": "@@ -36,21 +37,42 @@\n   // Date du jour\n \n   /**\n-   * R\u00e9cup\u00e9rer la date du jour avec l'heure. Retourne la date du jour param\u00e9tr\u00e9 dans l'utilisateur\n-   * si existe, sinon r\u00e9cup\u00e8re celle de l'administration g\u00e9n\u00e9rale, sinon date du jour. private\n+   * R\u00e9cup\u00e9rer la date du jour avec l'heure en fonction de la timezone du serveur. Retourne la date\n+   * du jour param\u00e9tr\u00e9 dans l'utilisateur si existe, sinon r\u00e9cup\u00e8re celle de l'administration\n+   * g\u00e9n\u00e9rale, sinon date du jour. private\n    *\n    * @return\n    */\n   public ZonedDateTime getTodayDateTime();\n \n   /**\n-   * R\u00e9cup\u00e9rer la date du jour. Retourne la date du jour param\u00e9tr\u00e9 dans l'utilisateur si existe,\n-   * sinon r\u00e9cup\u00e8re celle de l'administration g\u00e9n\u00e9rale, sinon date du jour.\n+   * R\u00e9cup\u00e9rer la date du jour avec l'heure en fonction de la timezone renseign\u00e9e dans la soci\u00e9t\u00e9\n+   * donn\u00e9e. Retourne la date du jour param\u00e9tr\u00e9 dans l'utilisateur si existe, sinon r\u00e9cup\u00e8re celle\n+   * de l'administration g\u00e9n\u00e9rale, sinon date du jour. private\n    *\n    * @return\n    */\n+  public ZonedDateTime getTodayDateTime(Company company);\n+\n+  /**\n+   * This method is deprecated. Please use the\n+   * com.axelor.apps.base.service.app.AppBaseService#getTodayDate(com.axelor.apps.base.db.Company)\n+   * method instead.\n+   *\n+   * @return\n+   */\n+  @Deprecated\n   public LocalDate getTodayDate();\n \n+  /**\n+   * R\u00e9cup\u00e9rer la date du jour en fonction de la timezone renseign\u00e9e dans la soci\u00e9t\u00e9 donn\u00e9e.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI3MDA1MQ==", "bodyText": "please do not use wildcards for import", "url": "https://github.com/axelor/axelor-open-suite/pull/5902#discussion_r498270051", "createdAt": "2020-10-01T14:04:22Z", "author": {"login": "ale-axelor"}, "path": "axelor-base/src/main/java/com/axelor/apps/base/service/app/AppBaseServiceImpl.java", "diffHunk": "@@ -18,10 +18,8 @@\n package com.axelor.apps.base.service.app;\n \n import com.axelor.app.AppSettings;\n-import com.axelor.apps.base.db.AppBase;\n-import com.axelor.apps.base.db.CurrencyConversionLine;\n-import com.axelor.apps.base.db.Language;\n-import com.axelor.apps.base.db.Unit;\n+import com.axelor.apps.base.db.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI3NDI2MA==", "bodyText": "it would be safer to check for NPE (I think using optional.map will be useful here)", "url": "https://github.com/axelor/axelor-open-suite/pull/5902#discussion_r498274260", "createdAt": "2020-10-01T14:10:09Z", "author": {"login": "ale-axelor"}, "path": "axelor-contract/src/main/java/com/axelor/apps/contract/service/ConsumptionLineServiceImpl.java", "diffHunk": "@@ -37,7 +37,9 @@ public ConsumptionLineServiceImpl(AppBaseService appBaseService) {\n   @Override\n   public ConsumptionLine fill(ConsumptionLine line, Product product) {\n     Preconditions.checkNotNull(product, I18n.get(IExceptionMessage.CONTRACT_EMPTY_PRODUCT));\n-    line.setLineDate(appBaseService.getTodayDate());\n+    line.setLineDate(\n+        appBaseService.getTodayDate(\n+            line.getContractLine().getContractVersion().getContract().getCompany()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de76e65bb2f4b037ca059238596932134d565f3a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8def22ab5100dcdcd2e1967ab1d9f30a964a05b9", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/8def22ab5100dcdcd2e1967ab1d9f30a964a05b9", "committedDate": "2020-10-02T08:09:30Z", "message": "Translate JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cce9a3ec40e7765e9f21b76522a3b91f6284b24", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/9cce9a3ec40e7765e9f21b76522a3b91f6284b24", "committedDate": "2020-10-02T08:09:58Z", "message": "Fix wildcard import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2ef7fd1d590183b5444cf50a755a968b2c3b050", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/a2ef7fd1d590183b5444cf50a755a968b2c3b050", "committedDate": "2020-10-02T08:13:49Z", "message": "Use Optional.map to prevent NPE"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c45e3feb9ec46375344c83716c44664be79af753", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/c45e3feb9ec46375344c83716c44664be79af753", "committedDate": "2020-10-02T08:10:34Z", "message": "Use Optional.map to prevent NPE"}, "afterCommit": {"oid": "a2ef7fd1d590183b5444cf50a755a968b2c3b050", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/a2ef7fd1d590183b5444cf50a755a968b2c3b050", "committedDate": "2020-10-02T08:13:49Z", "message": "Use Optional.map to prevent NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e08df9d41cec808e9cb70b7c9c55752f08d03e9c", "author": {"user": {"login": "lde-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/e08df9d41cec808e9cb70b7c9c55752f08d03e9c", "committedDate": "2020-10-02T08:30:51Z", "message": "Update CHANGELOG"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4de1d9ba5592d6db1aff4f1d36cc8ffef0c77d5b", "author": {"user": {"login": "ale-axelor", "name": null}}, "url": "https://github.com/axelor/axelor-open-suite/commit/4de1d9ba5592d6db1aff4f1d36cc8ffef0c77d5b", "committedDate": "2020-10-02T08:32:43Z", "message": "Merge branch 'dev' into zoned-gettodaydate"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2083, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}