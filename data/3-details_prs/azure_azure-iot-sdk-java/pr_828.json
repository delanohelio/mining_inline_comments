{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODA5NDcw", "number": 828, "title": "Run TPM tests in serial", "bodyText": "Two small e2e test changes. The TPM tests need to run in serial since they each need exclusive access to the tpm simulator in order to pass.\nThe twin tear down logic should never throw an exception that causes the test to fail since the teardown logic is part of what's being tested", "createdAt": "2020-06-26T22:19:54Z", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828", "merged": true, "mergeCommit": {"oid": "d2b48535af58600132146518856f10fb7c6a6454"}, "closed": true, "closedAt": "2020-06-26T23:55:30Z", "author": {"login": "timtay-microsoft"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvKea4AH2gAyNDQwODA5NDcwOjlmOWQwNTA5ZDhmNjIwZTIyMWFiMjgxZmUzYWE2NDdlYjIzNGU4ZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvMMucgFqTQzODY0ODg4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9f9d0509d8f620e221ab281fe3aa647eb234e8e4", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/9f9d0509d8f620e221ab281fe3aa647eb234e8e4", "committedDate": "2020-06-26T21:52:48Z", "message": "refactor(e2e): Prevent exceptions during tear down from failing twin e2e tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e58a3d6c76af310b82f9c11297d12afaea5bf722", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e58a3d6c76af310b82f9c11297d12afaea5bf722", "committedDate": "2020-06-26T22:18:07Z", "message": "fix(e2e): Fix tpm provisioning tests not being run in serial\n\nThese tests need exclusive access to the TPM, so they cannot run in parallel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjI2MjQy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#pullrequestreview-438626242", "createdAt": "2020-06-26T22:20:35Z", "commit": {"oid": "e58a3d6c76af310b82f9c11297d12afaea5bf722"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjoyMDozNVrOGpwOjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjoyMDozNVrOGpwOjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNDk1OQ==", "bodyText": "This dependency gives us the NotThreadSafe annotation", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446434959", "createdAt": "2020-06-26T22:20:35Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/pom.xml", "diffHunk": "@@ -93,6 +93,12 @@\n             <version>1.18.8</version>\n             <scope>provided</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>net.jcip</groupId>\n+            <artifactId>jcip-annotations</artifactId>\n+            <version>1.0</version>\n+            <scope>test</scope>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e58a3d6c76af310b82f9c11297d12afaea5bf722"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2feef4a129bd8ea805c158a2dc3f71ec4c42ccb", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/c2feef4a129bd8ea805c158a2dc3f71ec4c42ccb", "committedDate": "2020-06-26T22:21:31Z", "message": "squash"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a", "committedDate": "2020-06-26T22:23:20Z", "message": "squash"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjI5ODA3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#pullrequestreview-438629807", "createdAt": "2020-06-26T22:31:42Z", "commit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjozMTo0MlrOGpwaXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjozMTo0MlrOGpwaXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNzk4MA==", "bodyText": "why does it throw in those flaky instances? doesn't that indicate a problem? doesn't swallowing that exception mean we are ignoring a potential issue?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446437980", "createdAt": "2020-06-26T22:31:42Z", "author": {"login": "azabbasi"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -394,7 +394,14 @@ public void tearDownTwin(DeviceState deviceState) throws IOException\n         }\n         if (internalClient != null)\n         {\n-            internalClient.closeNow();\n+            try\n+            {\n+                internalClient.closeNow();\n+            }\n+            catch (IOException e)\n+            {\n+                // Ignore, the test isn't about being able to close the client", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c54d4beb0e47afd330f5bc07c1d3197d567f69ae", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/c54d4beb0e47afd330f5bc07c1d3197d567f69ae", "committedDate": "2020-06-26T22:35:11Z", "message": "squash"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/18ac5575b30db53496cc80b0b319042de842e215", "committedDate": "2020-06-26T22:50:10Z", "message": "squash"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjM2MDMy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#pullrequestreview-438636032", "createdAt": "2020-06-26T22:53:55Z", "commit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1Mzo1NVrOGpwvdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1Mzo1NVrOGpwvdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MzM4MQ==", "bodyText": "did you forget to remove this?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446443381", "createdAt": "2020-06-26T22:53:55Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "diffHunk": "@@ -141,17 +141,29 @@ public static Collection inputsCommon(AttestationType attestationType)\n         }\n         else if (attestationType == AttestationType.TPM)\n         {\n-            return Arrays.asList(\n-                    new Object[][]\n-                            {\n-                                    {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS_WS, attestationType}\n-\n-                                    //MQTT/MQTT_WS does not support tpm attestation\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT, attestationType},\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT_WS, attestationType},\n-                            });\n+            if (!isPullRequest)\n+            {\n+                //TODO TPM tests are flakey, so only run them for CI and nightly builds", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjM2NjUx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#pullrequestreview-438636651", "createdAt": "2020-06-26T22:56:17Z", "commit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1NjoxN1rOGpwxvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1NjoxN1rOGpwxvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0Mzk2NA==", "bodyText": "So was this not referenced earlier?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446443964", "createdAt": "2020-06-26T22:56:17Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "diffHunk": "@@ -141,17 +141,29 @@ public static Collection inputsCommon(AttestationType attestationType)\n         }\n         else if (attestationType == AttestationType.TPM)\n         {\n-            return Arrays.asList(\n-                    new Object[][]\n-                            {\n-                                    {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS_WS, attestationType}\n-\n-                                    //MQTT/MQTT_WS does not support tpm attestation\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT, attestationType},\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT_WS, attestationType},\n-                            });\n+            if (!isPullRequest)\n+            {\n+                //TODO TPM tests are flakey, so only run them for CI and nightly builds\n+                return Arrays.asList(\n+                        new Object[][]\n+                                {\n+                                        {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "933065ecd6361913fe4326310af2aaaa8c84b293", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/933065ecd6361913fe4326310af2aaaa8c84b293", "committedDate": "2020-06-26T23:21:34Z", "message": "Revert \"refactor(e2e): Prevent exceptions during tear down from failing twin e2e tests\"\n\nThis reverts commit 9f9d0509d8f620e221ab281fe3aa647eb234e8e4."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjQ4ODg0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#pullrequestreview-438648884", "createdAt": "2020-06-26T23:53:17Z", "commit": {"oid": "933065ecd6361913fe4326310af2aaaa8c84b293"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1703, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}