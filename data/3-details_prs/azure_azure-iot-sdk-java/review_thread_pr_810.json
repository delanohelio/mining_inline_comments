{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MzQyMzcz", "number": 810, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMzowMTo0MlrOEGIxhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzo0MDowNFrOEGcyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODcwNjYxOnYy", "diffSide": "LEFT", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/BasicTierOnlyRule.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMzowMTo0MlrOGkwBxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMzowMTo0MlrOGkwBxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE4ODgwNg==", "bodyText": "The concept of this rule still exists, but I renamed it and refactored it to match the other tags", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441188806", "createdAt": "2020-06-16T23:01:42Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/BasicTierOnlyRule.java", "diffHunk": "@@ -1,16 +0,0 @@\n-/*\n- *  Copyright (c) Microsoft. All rights reserved.\n- *  Licensed under the MIT license. See LICENSE file in the project root for full license information.\n- */\n-\n-package com.microsoft.azure.sdk.iot.common.helpers;\n-\n-public class BasicTierOnlyRule implements ConditionalIgnoreRule.IgnoreCondition\n-{\n-\n-    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MTk2NjE3OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNDo0OVrOGlQD-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNDo0OVrOGlQD-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxMzY1OA==", "bodyText": "This method is called prior to running any test method, and can be used to determine if the test should be run or skipped at runtime", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441713658", "createdAt": "2020-06-17T17:34:49Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.rules;\n+\n+import com.microsoft.azure.sdk.iot.common.helpers.IntegrationTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.BasicTierHubOnlyTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.IotHubTest;\n+import org.junit.Assume;\n+import org.junit.rules.TestRule;\n+import org.junit.runner.Description;\n+import org.junit.runners.model.Statement;\n+\n+public class BasicTierHubOnlyTestRule implements TestRule\n+{\n+    @Override\n+    public Statement apply(Statement base, Description description) {\n+        return new IgnorableStatement(base, description);\n+    }\n+\n+    private class IgnorableStatement extends Statement {\n+\n+        private final Statement base;\n+        private final Description description;\n+\n+        public IgnorableStatement(Statement base, Description description) {\n+            this.base = base;\n+            this.description = description;\n+        }\n+\n+        @Override\n+        public void evaluate() throws Throwable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MTk2ODUxOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNToyNFrOGlQFXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNToyNFrOGlQFXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNDAxNA==", "bodyText": "If the test method or its class is tagged with this annotation, then check if this test run is against a basic tier hub or not", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441714014", "createdAt": "2020-06-17T17:35:24Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.rules;\n+\n+import com.microsoft.azure.sdk.iot.common.helpers.IntegrationTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.BasicTierHubOnlyTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.IotHubTest;\n+import org.junit.Assume;\n+import org.junit.rules.TestRule;\n+import org.junit.runner.Description;\n+import org.junit.runners.model.Statement;\n+\n+public class BasicTierHubOnlyTestRule implements TestRule\n+{\n+    @Override\n+    public Statement apply(Statement base, Description description) {\n+        return new IgnorableStatement(base, description);\n+    }\n+\n+    private class IgnorableStatement extends Statement {\n+\n+        private final Statement base;\n+        private final Description description;\n+\n+        public IgnorableStatement(Statement base, Description description) {\n+            this.base = base;\n+            this.description = description;\n+        }\n+\n+        @Override\n+        public void evaluate() throws Throwable {\n+            BasicTierHubOnlyTest annotation = description.getAnnotation(BasicTierHubOnlyTest.class);\n+            BasicTierHubOnlyTest classAnnotation = description.getTestClass().getAnnotation(BasicTierHubOnlyTest.class);\n+            if (annotation != null || classAnnotation != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MTk3MTg4OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNjoyMVrOGlQHfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNjo0MFrOGlQIMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNDU1OQ==", "bodyText": "assumeTrue is not the same as assertTrue. AssumeTrue will return a status code equivalent to \"Ignored\" while assertTrue would return a status code equivalent to \"Failed\"", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441714559", "createdAt": "2020-06-17T17:36:21Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.rules;\n+\n+import com.microsoft.azure.sdk.iot.common.helpers.IntegrationTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.BasicTierHubOnlyTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.IotHubTest;\n+import org.junit.Assume;\n+import org.junit.rules.TestRule;\n+import org.junit.runner.Description;\n+import org.junit.runners.model.Statement;\n+\n+public class BasicTierHubOnlyTestRule implements TestRule\n+{\n+    @Override\n+    public Statement apply(Statement base, Description description) {\n+        return new IgnorableStatement(base, description);\n+    }\n+\n+    private class IgnorableStatement extends Statement {\n+\n+        private final Statement base;\n+        private final Description description;\n+\n+        public IgnorableStatement(Statement base, Description description) {\n+            this.base = base;\n+            this.description = description;\n+        }\n+\n+        @Override\n+        public void evaluate() throws Throwable {\n+            BasicTierHubOnlyTest annotation = description.getAnnotation(BasicTierHubOnlyTest.class);\n+            BasicTierHubOnlyTest classAnnotation = description.getTestClass().getAnnotation(BasicTierHubOnlyTest.class);\n+            if (annotation != null || classAnnotation != null)\n+            {\n+                Assume.assumeTrue(\"Test is ignored\", IntegrationTest.isBasicTierHub);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNDczNw==", "bodyText": "Or to simplify it even further, the test won't run if any assumptions are violated", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441714737", "createdAt": "2020-06-17T17:36:40Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.rules;\n+\n+import com.microsoft.azure.sdk.iot.common.helpers.IntegrationTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.BasicTierHubOnlyTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.IotHubTest;\n+import org.junit.Assume;\n+import org.junit.rules.TestRule;\n+import org.junit.runner.Description;\n+import org.junit.runners.model.Statement;\n+\n+public class BasicTierHubOnlyTestRule implements TestRule\n+{\n+    @Override\n+    public Statement apply(Statement base, Description description) {\n+        return new IgnorableStatement(base, description);\n+    }\n+\n+    private class IgnorableStatement extends Statement {\n+\n+        private final Statement base;\n+        private final Description description;\n+\n+        public IgnorableStatement(Statement base, Description description) {\n+            this.base = base;\n+            this.description = description;\n+        }\n+\n+        @Override\n+        public void evaluate() throws Throwable {\n+            BasicTierHubOnlyTest annotation = description.getAnnotation(BasicTierHubOnlyTest.class);\n+            BasicTierHubOnlyTest classAnnotation = description.getTestClass().getAnnotation(BasicTierHubOnlyTest.class);\n+            if (annotation != null || classAnnotation != null)\n+            {\n+                Assume.assumeTrue(\"Test is ignored\", IntegrationTest.isBasicTierHub);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNDU1OQ=="}, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MTk3NjIwOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNzoyNFrOGlQKAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozNzoyNFrOGlQKAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNTIwMw==", "bodyText": "This will call into all the other rules to see if the test method or its class are tagged with other annotations that could determine if the test should run or not.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441715203", "createdAt": "2020-06-17T17:37:24Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/rules/BasicTierHubOnlyTestRule.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.rules;\n+\n+import com.microsoft.azure.sdk.iot.common.helpers.IntegrationTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.BasicTierHubOnlyTest;\n+import com.microsoft.azure.sdk.iot.common.helpers.annotations.IotHubTest;\n+import org.junit.Assume;\n+import org.junit.rules.TestRule;\n+import org.junit.runner.Description;\n+import org.junit.runners.model.Statement;\n+\n+public class BasicTierHubOnlyTestRule implements TestRule\n+{\n+    @Override\n+    public Statement apply(Statement base, Description description) {\n+        return new IgnorableStatement(base, description);\n+    }\n+\n+    private class IgnorableStatement extends Statement {\n+\n+        private final Statement base;\n+        private final Description description;\n+\n+        public IgnorableStatement(Statement base, Description description) {\n+            this.base = base;\n+            this.description = description;\n+        }\n+\n+        @Override\n+        public void evaluate() throws Throwable {\n+            BasicTierHubOnlyTest annotation = description.getAnnotation(BasicTierHubOnlyTest.class);\n+            BasicTierHubOnlyTest classAnnotation = description.getTestClass().getAnnotation(BasicTierHubOnlyTest.class);\n+            if (annotation != null || classAnnotation != null)\n+            {\n+                Assume.assumeTrue(\"Test is ignored\", IntegrationTest.isBasicTierHub);\n+            }\n+\n+            base.evaluate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MTk4MDc3OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/annotations/DeviceProvisioningServiceTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozODo0MFrOGlQM8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzozOToyMVrOGlQOhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNTk1NA==", "bodyText": "No special rules for DPS tests to be defined here, but the DeviceProvisioningServiceTestRule class will check to see if a method/class is tagged with this annotation and run/skip the test accordingly", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441715954", "createdAt": "2020-06-17T17:38:40Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/annotations/DeviceProvisioningServiceTest.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.annotations;\n+\n+import java.lang.annotation.*;\n+\n+/**\n+ * Tests that use the Device Provisioning Service\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ElementType.TYPE, ElementType.METHOD})\n+@Inherited\n+public @interface DeviceProvisioningServiceTest\n+{\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNjM1OA==", "bodyText": "Same for all these other annotations (other than ContinuousIntegrationTest which has a timeout as an additional rule)", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441716358", "createdAt": "2020-06-17T17:39:21Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/annotations/DeviceProvisioningServiceTest.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.annotations;\n+\n+import java.lang.annotation.*;\n+\n+/**\n+ * Tests that use the Device Provisioning Service\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ElementType.TYPE, ElementType.METHOD})\n+@Inherited\n+public @interface DeviceProvisioningServiceTest\n+{\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNTk1NA=="}, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MTk4NTE1OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/annotations/ContinuousIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzo0MDowNFrOGlQP-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzo0MDowNFrOGlQP-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNjczMA==", "bodyText": "It's a long timeout, but only because we have a token renewal test that takes at least 10 minutes, and often runs for 16 minutes.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/810#discussion_r441716730", "createdAt": "2020-06-17T17:40:04Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/annotations/ContinuousIntegrationTest.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package com.microsoft.azure.sdk.iot.common.helpers.annotations;\n+\n+import org.junit.Rule;\n+import org.junit.rules.Timeout;\n+\n+import java.lang.annotation.*;\n+\n+/**\n+ * Tests with this annotation will only be run during nightly or continuous integration builds. Typically these tests\n+ * run longer than most tests, cover niche scenarios, or test failure case scenarios that are atypical for users.\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ElementType.TYPE, ElementType.METHOD})\n+@Inherited\n+public @interface ContinuousIntegrationTest {\n+    int E2E_TEST_TIMEOUT_MS = 17 * 60 * 1000;\n+\n+    // Each CI test must finish in under 17 minutes\n+    @Rule", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd288f0a9ba1d7b6d4ab7a7c9450e2222c0cac9"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2834, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}