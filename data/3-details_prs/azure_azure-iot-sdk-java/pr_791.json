{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Nzc5NDkx", "number": 791, "title": "feat(iot-dev): Add support for PnP Model Id", "bodyText": "", "createdAt": "2020-06-02T19:15:32Z", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791", "merged": true, "mergeCommit": {"oid": "254c7d33c35eb765c094c242681da3ebce6ab0ed"}, "closed": true, "closedAt": "2020-06-05T18:54:56Z", "author": {"login": "bikamani"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnZzNCgH2gAyNDI2Nzc5NDkxOjExMzBkOTFmZjA2MWU5MWQ4ZjBjOWFjMTEzYTQxMjUwMWEzNjMxMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnyVFsgFqTQyNDAxMDQzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/1130d91ff061e91d8f0c9ac113a412501a363122", "committedDate": "2020-06-02T19:12:41Z", "message": "model id initial changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyOTkyOTky", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-422992992", "createdAt": "2020-06-02T19:28:16Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOToyODoxNlrOGeA8ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOToyODoxNlrOGeA8ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyNTkyNQ==", "bodyText": "I am calling this the digital twin model id", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434125925", "createdAt": "2020-06-02T19:28:16Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/ClientOptions.java", "diffHunk": "@@ -0,0 +1,17 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.device;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+public final class ClientOptions\n+{\n+    /**\n+     * The Plug and Play Model Id associated with the device identity.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyOTk1NDQ0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-422995444", "createdAt": "2020-06-02T19:32:01Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozMjowMVrOGeBD5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozMjowMVrOGeBD5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyNzg0NA==", "bodyText": "Isn't lombok so cool! :)", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434127844", "createdAt": "2020-06-02T19:32:01Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "diffHunk": "@@ -38,6 +39,10 @@\n     private boolean useWebsocket;\n     private ProxySettings proxySettings;\n \n+    @Getter\n+    @Setter(AccessLevel.PROTECTED)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyOTk2ODYw", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-422996860", "createdAt": "2020-06-02T19:34:02Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNDowMlrOGeBIdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNDowMlrOGeBIdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyOTAxMw==", "bodyText": "I renamed this to API_VERSION_PREVIEW, and added a comment that clarifies that this is for pnp support", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434129013", "createdAt": "2020-06-02T19:34:02Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/net/IotHubUri.java", "diffHunk": "@@ -28,6 +28,9 @@\n     /** The API version will be passed as a param in the URI. */\n     public static final String API_VERSION = \"api-version=\" + TransportUtils.IOTHUB_API_VERSION;\n \n+    /** The API version will be passed as a param in the URI for PnP. */\n+    public static final String PNP_API_VERSION = \"api-version=\" + TransportUtils.PNP_IOTHUB_API_VERSION;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyOTk3MDg0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-422997084", "createdAt": "2020-06-02T19:34:22Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNDoyMlrOGeBJDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNDoyMlrOGeBJDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyOTE2Nw==", "bodyText": "This as \"preview\" as well", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434129167", "createdAt": "2020-06-02T19:34:22Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/TransportUtils.java", "diffHunk": "@@ -8,6 +8,7 @@\n public class TransportUtils\n {\n     public static String IOTHUB_API_VERSION = \"2019-10-01\";\n+    public static String PNP_IOTHUB_API_VERSION = \"2020-05-31-preview\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyOTk4MDQx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-422998041", "createdAt": "2020-06-02T19:35:47Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNTo0N1rOGeBL1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNTo0N1rOGeBL1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyOTg3OQ==", "bodyText": "modelId == null || modelId.isEmpty()", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434129879", "createdAt": "2020-06-02T19:35:47Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/mqtt/MqttIotHubConnection.java", "diffHunk": "@@ -151,7 +151,18 @@ else if (this.config.getAuthenticationType() == DeviceClientConfig.AuthType.X509\n                     clientId += \"/\" + moduleId;\n                 }\n \n-                this.iotHubUserName = this.config.getIotHubHostname() + \"/\" + clientId + \"/\" + API_VERSION + \"&\" + clientUserAgentIdentifier;\n+                String apiVersion;\n+                String modelId = this.config.getModelId();\n+                if(modelId == null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyOTk4NzIx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-422998721", "createdAt": "2020-06-02T19:36:50Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNjo1MFrOGeBN8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozNjo1MFrOGeBN8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMDQxOA==", "bodyText": "rename this to serverParam or something similar, this has both api version and model Id (for preview APIs)", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434130418", "createdAt": "2020-06-02T19:36:50Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/mqtt/MqttIotHubConnection.java", "diffHunk": "@@ -151,7 +151,18 @@ else if (this.config.getAuthenticationType() == DeviceClientConfig.AuthType.X509\n                     clientId += \"/\" + moduleId;\n                 }\n \n-                this.iotHubUserName = this.config.getIotHubHostname() + \"/\" + clientId + \"/\" + API_VERSION + \"&\" + clientUserAgentIdentifier;\n+                String apiVersion;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDAwNjkz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423000693", "createdAt": "2020-06-02T19:39:49Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozOTo0OVrOGeBTuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTozOTo0OVrOGeBTuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMTg5Ng==", "bodyText": "how is this assertion relevant here?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434131896", "createdAt": "2020-06-02T19:39:49Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -147,6 +148,34 @@ public void constructorSuccess() throws URISyntaxException, IOException\n         };\n     }\n \n+    @Test\n+    public void constructorWithClientOptionsSuccess() throws URISyntaxException, IOException\n+    {\n+        // arrange\n+        final String connString = \"HostName=iothub.device.com;CredentialType=SharedAccessKey;CredentialScope=Device;deviceId=testdevice;SharedAccessKey=adjkl234j52=;\";\n+        final IotHubClientProtocol protocol = IotHubClientProtocol.MQTT;\n+        final ClientOptions clientOptions = new ClientOptions();\n+        clientOptions.setModelId(\"dtmi:Company:device:1\");\n+\n+        // act\n+        final DeviceClient client = new DeviceClient(connString, protocol, clientOptions);\n+\n+        // assert\n+        new Verifications()\n+        {\n+            {\n+                IotHubConnectionString iotHubConnectionString = Deencapsulation.newInstance(IotHubConnectionString.class, connString);\n+                times = 1;\n+\n+                IoTHubConnectionType ioTHubConnectionType = Deencapsulation.getField(client, \"ioTHubConnectionType\");\n+                assertEquals(SINGLE_CLIENT, ioTHubConnectionType);\n+\n+                TransportClient transportClient = Deencapsulation.getField(client, \"transportClient\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDAxNTUy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423001552", "createdAt": "2020-06-02T19:41:06Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0MTowN1rOGeBWJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0MTowN1rOGeBWJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMjUxNg==", "bodyText": "Todo here", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434132516", "createdAt": "2020-06-02T19:41:07Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -245,6 +310,28 @@ public void createFromSecurityProviderUsesUriAndDeviceIdAndSavesSecurityProvider\n         };\n     }\n \n+    @Test\n+    public void createFromSecurityProviderUsesUriAndDeviceIdAndSavesSecurityProviderAndCreatesDeviceIOWithClientOptions() throws URISyntaxException, IOException\n+    {\n+        //arrange\n+        final String expectedUri = \"some uri\";\n+        final String expectedDeviceId = \"some device id\";\n+        final IotHubClientProtocol expectedProtocol = IotHubClientProtocol.HTTPS;\n+        final ClientOptions clientOptions = new ClientOptions();\n+        clientOptions.setModelId(\"dtmi:Company:device:1\");\n+\n+        //act\n+        DeviceClient.createFromSecurityProvider(expectedUri, expectedDeviceId, mockSecurityProvider, expectedProtocol);\n+\n+        //assert\n+        new Verifications()\n+        {\n+            {\n+                //TODO add check for super() call", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 107}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDAyMzIy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423002322", "createdAt": "2020-06-02T19:42:17Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0MjoxN1rOGeBYOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0MjoxN1rOGeBYOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMzA1MA==", "bodyText": "What are we doing with iotHubConnectionString here?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434133050", "createdAt": "2020-06-02T19:42:17Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -147,6 +148,34 @@ public void constructorSuccess() throws URISyntaxException, IOException\n         };\n     }\n \n+    @Test\n+    public void constructorWithClientOptionsSuccess() throws URISyntaxException, IOException\n+    {\n+        // arrange\n+        final String connString = \"HostName=iothub.device.com;CredentialType=SharedAccessKey;CredentialScope=Device;deviceId=testdevice;SharedAccessKey=adjkl234j52=;\";\n+        final IotHubClientProtocol protocol = IotHubClientProtocol.MQTT;\n+        final ClientOptions clientOptions = new ClientOptions();\n+        clientOptions.setModelId(\"dtmi:Company:device:1\");\n+\n+        // act\n+        final DeviceClient client = new DeviceClient(connString, protocol, clientOptions);\n+\n+        // assert\n+        new Verifications()\n+        {\n+            {\n+                IotHubConnectionString iotHubConnectionString = Deencapsulation.newInstance(IotHubConnectionString.class, connString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDAyNzEy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423002712", "createdAt": "2020-06-02T19:42:53Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0Mjo1M1rOGeBZdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0Mjo1M1rOGeBZdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMzM2NQ==", "bodyText": "Can you explain what we are testing here?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434133365", "createdAt": "2020-06-02T19:42:53Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -222,6 +251,42 @@ public void constructorWithSSLContextSuccess(@Mocked final SSLContext mockedSSLC\n         };\n     }\n \n+    @Test\n+    public void constructorWithSSLContextClientOptionsSuccess(@Mocked final SSLContext mockedSSLContext) throws URISyntaxException\n+    {\n+        // arrange\n+        final String connString =\n+                \"HostName=iothub.device.com;deviceId=testdevice;x509=true\";\n+        final IotHubClientProtocol protocol = IotHubClientProtocol.MQTT;\n+        final ClientOptions clientOptions = new ClientOptions();\n+        clientOptions.setModelId(\"dtmi:Company:device:1\");\n+\n+        new Expectations()\n+        {\n+            {\n+                new IotHubConnectionString(connString);\n+                result = mockIotHubConnectionString;\n+            }\n+        };\n+\n+        // act\n+        final DeviceClient client = new DeviceClient(connString, protocol, mockedSSLContext, clientOptions);\n+\n+        // assert\n+        new Verifications()\n+        {\n+            {\n+                IoTHubConnectionType ioTHubConnectionType = Deencapsulation.getField(client, \"ioTHubConnectionType\");\n+                assertEquals(SINGLE_CLIENT, ioTHubConnectionType);\n+\n+                TransportClient transportClient = Deencapsulation.getField(client, \"transportClient\");\n+                assertNull(transportClient);\n+\n+                new DeviceClientConfig(mockIotHubConnectionString, mockedSSLContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDA0OTc2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423004976", "createdAt": "2020-06-02T19:46:13Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0NjoxM1rOGeBgSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0NjoxM1rOGeBgSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzNTExNQ==", "bodyText": "nit: this assertion is not really relevant to this test", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434135115", "createdAt": "2020-06-02T19:46:13Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/mqtt/MqttIotHubConnectionTest.java", "diffHunk": "@@ -308,6 +310,53 @@ public void openEstablishesConnectionUsingCorrectConfig() throws IOException, Tr\n         };\n     }\n \n+    @Test\n+    public void openEstablishesConnectionUsingModelIdSetsCorrectPreviewApiVersion() throws IOException, TransportException\n+    {\n+        final String expectedSasToken = \"someToken\";\n+        final String serverUri = SSL_PREFIX + iotHubHostName + SSL_PORT_SUFFIX;\n+        baseExpectations();\n+\n+        new Expectations()\n+        {\n+            {\n+                mockConfig.getAuthenticationType();\n+                result = DeviceClientConfig.AuthType.SAS_TOKEN;\n+                mockConfig.getSasTokenAuthentication().getRenewedSasToken(false, false);\n+                result = expectedSasToken;\n+                mockConfig.isUseWebsocket();\n+                result = false;\n+                mockConfig.getModelId();\n+                result = modelId;\n+            }\n+        };\n+\n+        MqttIotHubConnection connection = new MqttIotHubConnection(mockConfig);\n+        Deencapsulation.setField(connection, \"listener\", mockedIotHubListener);\n+        connection.open(mockedQueue, mockedScheduledExecutorService);\n+\n+        final String actualIotHubUserName = Deencapsulation.getField(connection, \"iotHubUserName\");\n+\n+        String clientIdentifier = \"DeviceClientType=\" + URLEncoder.encode(TransportUtils.USER_AGENT_STRING, \"UTF-8\").replaceAll(\"\\\\+\", \"%20\");\n+        assertTrue(actualIotHubUserName.contains(iotHubHostName + \"/\" + deviceId + \"/\" + PNP_API_VERSION));\n+\n+        final String actualUserPassword = Deencapsulation.getField(connection, \"iotHubUserPassword\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDA1MTc2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423005176", "createdAt": "2020-06-02T19:46:30Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0NjozMFrOGeBg2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOTo0NjozMFrOGeBg2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzNTI1OQ==", "bodyText": "Add another test for scenario where you don't set the model Id", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434135259", "createdAt": "2020-06-02T19:46:30Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/mqtt/MqttIotHubConnectionTest.java", "diffHunk": "@@ -308,6 +310,53 @@ public void openEstablishesConnectionUsingCorrectConfig() throws IOException, Tr\n         };\n     }\n \n+    @Test\n+    public void openEstablishesConnectionUsingModelIdSetsCorrectPreviewApiVersion() throws IOException, TransportException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDEyMzU2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423012356", "createdAt": "2020-06-02T19:57:09Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDIyNDU5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423022459", "createdAt": "2020-06-02T20:12:22Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxMjoyMlrOGeCUkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxMjoyMlrOGeCUkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE0ODQ5OQ==", "bodyText": "Add a note that non plug and play users should not set this value", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434148499", "createdAt": "2020-06-02T20:12:22Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/ClientOptions.java", "diffHunk": "@@ -0,0 +1,17 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.device;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+public final class ClientOptions\n+{\n+    /**\n+     * The Plug and Play Model Id associated with the device identity.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDIyODg0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423022884", "createdAt": "2020-06-02T20:13:00Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxMzowMFrOGeCV3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxMzowMFrOGeCV3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE0ODgyOA==", "bodyText": "Add a description to this class. Something about how it is for constructor time options that won't change for as long as this client exists", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434148828", "createdAt": "2020-06-02T20:13:00Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/ClientOptions.java", "diffHunk": "@@ -0,0 +1,17 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.device;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+public final class ClientOptions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDIzNDY5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423023469", "createdAt": "2020-06-02T20:13:54Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxMzo1NVrOGeCXfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxMzo1NVrOGeCXfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE0OTI0NA==", "bodyText": "Just make this constructor call your new constructor but with a null client options. No need to call commonConstructorVerifications/setup here and in your new constructor", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434149244", "createdAt": "2020-06-02T20:13:55Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "diffHunk": "@@ -173,7 +173,7 @@ public DeviceClient(String connString, TransportClient transportClient) throws U\n     public DeviceClient(String connString, IotHubClientProtocol protocol) throws URISyntaxException, IllegalArgumentException\n     {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDI1NTk3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423025597", "createdAt": "2020-06-02T20:17:09Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNzowOVrOGeCd0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNzowOVrOGeCd0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE1MDg2Nw==", "bodyText": "What is this import for?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434150867", "createdAt": "2020-06-02T20:17:09Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -11,6 +11,7 @@\n import com.microsoft.azure.sdk.iot.device.fileupload.FileUpload;\n import com.microsoft.azure.sdk.iot.device.transport.amqps.IoTHubConnectionType;\n import com.microsoft.azure.sdk.iot.provisioning.security.SecurityProvider;\n+import com.sun.security.ntlm.Client;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDI1Nzg5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423025789", "createdAt": "2020-06-02T20:17:26Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNzoyNlrOGeCedQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNzoyNlrOGeCedQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE1MTAyOQ==", "bodyText": "TODO?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434151029", "createdAt": "2020-06-02T20:17:26Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -245,6 +310,28 @@ public void createFromSecurityProviderUsesUriAndDeviceIdAndSavesSecurityProvider\n         };\n     }\n \n+    @Test\n+    public void createFromSecurityProviderUsesUriAndDeviceIdAndSavesSecurityProviderAndCreatesDeviceIOWithClientOptions() throws URISyntaxException, IOException\n+    {\n+        //arrange\n+        final String expectedUri = \"some uri\";\n+        final String expectedDeviceId = \"some device id\";\n+        final IotHubClientProtocol expectedProtocol = IotHubClientProtocol.HTTPS;\n+        final ClientOptions clientOptions = new ClientOptions();\n+        clientOptions.setModelId(\"dtmi:Company:device:1\");\n+\n+        //act\n+        DeviceClient.createFromSecurityProvider(expectedUri, expectedDeviceId, mockSecurityProvider, expectedProtocol);\n+\n+        //assert\n+        new Verifications()\n+        {\n+            {\n+                //TODO add check for super() call", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 107}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDI2MTMw", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423026130", "createdAt": "2020-06-02T20:17:59Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNzo1OVrOGeCfgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNzo1OVrOGeCfgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE1MTI5Ng==", "bodyText": "factor out the \"?api-version=\" string and reference it in these two places", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434151296", "createdAt": "2020-06-02T20:17:59Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/mqtt/MqttIotHubConnectionTest.java", "diffHunk": "@@ -42,8 +42,10 @@\n     final String iotHubHostName = \"test.host.name\";\n     final String hubName = \"test.iothub\";\n     final String deviceId = \"test-deviceId\";\n+    final String modelId = \"dtmi:my:company:namespace;1\";\n     final String deviceKey = \"test-devicekey?&test\";\n-    final String API_VERSION = Deencapsulation.getField(MqttIotHubConnection.class, \"API_VERSION\");\n+    final String API_VERSION = \"?api-version=\" + TransportUtils.IOTHUB_API_VERSION;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDQ1Njcx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423045671", "createdAt": "2020-06-02T20:47:50Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDo0Nzo1MVrOGeDZ5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDo0Nzo1MVrOGeDZ5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE2NjI0Nw==", "bodyText": "Why can't SSLContext be part of clientOptions?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434166247", "createdAt": "2020-06-02T20:47:51Z", "author": {"login": "prmathur-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "diffHunk": "@@ -229,7 +255,26 @@ public DeviceClient(String connString, IotHubClientProtocol protocol, String pub\n      */\n     public DeviceClient(String connString, IotHubClientProtocol protocol, SSLContext sslContext) throws URISyntaxException\n     {\n-        super(new IotHubConnectionString(connString), protocol, sslContext, SEND_PERIOD_MILLIS, getReceivePeriod(protocol));\n+        super(new IotHubConnectionString(connString), protocol, sslContext, SEND_PERIOD_MILLIS, getReceivePeriod(protocol), null);\n+        commonConstructorVerifications();\n+        commonConstructorSetup();\n+    }\n+\n+    /**\n+     * Creates a device client that uses the provided SSLContext for SSL negotiation\n+     * @param connString the connection string for the device. May be an x509 connection string (format: \"HostName=...;DeviceId=...;x509=true\")\n+     *                   and it may be a SAS connection string (format: \"HostName=...;DeviceId=...;SharedAccessKey=...\"). If\n+     *                   this connection string is an x509 connection string, the client will use the provided SSLContext for authentication.\n+     * @param protocol the protocol to use when communicating with IotHub\n+     * @param sslContext the ssl context that will be used during authentication. If the provided connection string does not contain\n+     *                   SAS based credentials, then the sslContext will be used for x509 authentication. If the provided connection string\n+     *                   does contain SAS based credentials, the sslContext will still be used during SSL negotiation.\n+     * @param clientOptions The options that allow configuration of the device client instance during initialization\n+     * @throws URISyntaxException if the hostname in the connection string is not a valid URI\n+     */\n+    public DeviceClient(String connString, IotHubClientProtocol protocol, SSLContext sslContext, ClientOptions clientOptions) throws URISyntaxException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDQ2MzU0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423046354", "createdAt": "2020-06-02T20:48:55Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDo0ODo1NVrOGeDb1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDo0ODo1NVrOGeDb1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE2Njc0MQ==", "bodyText": "URI is not connection string. Isn't it hostname only?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434166741", "createdAt": "2020-06-02T20:48:55Z", "author": {"login": "prmathur-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "diffHunk": "@@ -247,7 +292,24 @@ public DeviceClient(String connString, IotHubClientProtocol protocol, SSLContext\n      */\n     public static DeviceClient createFromSecurityProvider(String uri, String deviceId, SecurityProvider securityProvider, IotHubClientProtocol protocol) throws URISyntaxException, IOException\n     {\n-        return new DeviceClient(uri, deviceId, securityProvider, protocol);\n+        return new DeviceClient(uri, deviceId, securityProvider, protocol, null);\n+    }\n+\n+    /**\n+     * Creates a device client that uses the provided security provider for authentication.\n+     *\n+     * @param uri The connection string for iot hub to connect to (format: \"yourHubName.azure-devices.net\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDQ5MTQ2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423049146", "createdAt": "2020-06-02T20:53:14Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDo1MzoxNFrOGeDkZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDo1MzoxNFrOGeDkZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE2ODkzNA==", "bodyText": "Please add a detail comment as to why are we adding preview API here", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434168934", "createdAt": "2020-06-02T20:53:14Z", "author": {"login": "prmathur-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/TransportUtils.java", "diffHunk": "@@ -8,6 +8,7 @@\n public class TransportUtils\n {\n     public static String IOTHUB_API_VERSION = \"2019-10-01\";\n+    public static String PNP_IOTHUB_API_VERSION = \"2020-05-31-preview\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDg1NjU2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423085656", "createdAt": "2020-06-02T21:56:51Z", "commit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTo1Njo1MVrOGeFVuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTo1Njo1MVrOGeFVuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5Nzk0NQ==", "bodyText": "is this a real connection string or fake?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434197945", "createdAt": "2020-06-02T21:56:51Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -147,6 +148,34 @@ public void constructorSuccess() throws URISyntaxException, IOException\n         };\n     }\n \n+    @Test\n+    public void constructorWithClientOptionsSuccess() throws URISyntaxException, IOException\n+    {\n+        // arrange\n+        final String connString = \"HostName=iothub.device.com;CredentialType=SharedAccessKey;CredentialScope=Device;deviceId=testdevice;SharedAccessKey=adjkl234j52=;\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1130d91ff061e91d8f0c9ac113a412501a363122"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61a643150c734a840275aea13c6127c7d50422d8", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/61a643150c734a840275aea13c6127c7d50422d8", "committedDate": "2020-06-02T23:01:10Z", "message": "address comments and remove unnecessary tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3edfdcc2077b7d6b78e66802b6bb8c85d314a4c5", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/3edfdcc2077b7d6b78e66802b6bb8c85d314a4c5", "committedDate": "2020-06-02T23:05:39Z", "message": "remove unnecessary test commit#2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTE3NDcz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423117473", "createdAt": "2020-06-02T23:13:04Z", "commit": {"oid": "3edfdcc2077b7d6b78e66802b6bb8c85d314a4c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMzoxMzowNVrOGeG8ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMzoxMzowNVrOGeG8ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIyNDMyMw==", "bodyText": "the hostname of the", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434224323", "createdAt": "2020-06-02T23:13:05Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "diffHunk": "@@ -229,15 +247,32 @@ public DeviceClient(String connString, IotHubClientProtocol protocol, String pub\n      */\n     public DeviceClient(String connString, IotHubClientProtocol protocol, SSLContext sslContext) throws URISyntaxException\n     {\n-        super(new IotHubConnectionString(connString), protocol, sslContext, SEND_PERIOD_MILLIS, getReceivePeriod(protocol));\n+        new DeviceClient(connString, protocol, sslContext, null);\n+    }\n+\n+    /**\n+     * Creates a device client that uses the provided SSLContext for SSL negotiation\n+     * @param connString the connection string for the device. May be an x509 connection string (format: \"HostName=...;DeviceId=...;x509=true\")\n+     *                   and it may be a SAS connection string (format: \"HostName=...;DeviceId=...;SharedAccessKey=...\"). If\n+     *                   this connection string is an x509 connection string, the client will use the provided SSLContext for authentication.\n+     * @param protocol the protocol to use when communicating with IotHub\n+     * @param sslContext the ssl context that will be used during authentication. If the provided connection string does not contain\n+     *                   SAS based credentials, then the sslContext will be used for x509 authentication. If the provided connection string\n+     *                   does contain SAS based credentials, the sslContext will still be used during SSL negotiation.\n+     * @param clientOptions The options that allow configuration of the device client instance during initialization\n+     * @throws URISyntaxException if the hostname in the connection string is not a valid URI\n+     */\n+    public DeviceClient(String connString, IotHubClientProtocol protocol, SSLContext sslContext, ClientOptions clientOptions) throws URISyntaxException\n+    {\n+        super(new IotHubConnectionString(connString), protocol, sslContext, SEND_PERIOD_MILLIS, getReceivePeriod(protocol), clientOptions);\n         commonConstructorVerifications();\n         commonConstructorSetup();\n     }\n \n     /**\n      * Creates a device client that uses the provided security provider for authentication.\n      *\n-     * @param uri The connection string for iot hub to connect to (format: \"yourHubName.azure-devices.net\")\n+     * @param uri The hostname of iot hub to connect to (format: \"yourHubName.azure-devices.net\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3edfdcc2077b7d6b78e66802b6bb8c85d314a4c5"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTE4MTU4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423118158", "createdAt": "2020-06-02T23:14:47Z", "commit": {"oid": "3edfdcc2077b7d6b78e66802b6bb8c85d314a4c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fadba8bb34e6809b1caa62262de3bab4a673170c", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/fadba8bb34e6809b1caa62262de3bab4a673170c", "committedDate": "2020-06-03T01:11:27Z", "message": "fix uts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02b4534942335cbba0e7800d99433f17a206dec9", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/02b4534942335cbba0e7800d99433f17a206dec9", "committedDate": "2020-06-03T01:12:44Z", "message": "add minor changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a107d7d2568b630ec0874873507b985000c8118", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7a107d7d2568b630ec0874873507b985000c8118", "committedDate": "2020-06-03T05:27:02Z", "message": "constructor changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzk1ODQ1", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423795845", "createdAt": "2020-06-03T17:54:11Z", "commit": {"oid": "7a107d7d2568b630ec0874873507b985000c8118"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzo1NDoxMlrOGenEzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzo1NDoxMlrOGenEzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc1MDY2OA==", "bodyText": "FYI - we do not want to use the term \"plug and play\" in any public comments/ APIs.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434750668", "createdAt": "2020-06-03T17:54:12Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/ClientOptions.java", "diffHunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.device;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+/**\n+ * Options that allow configuration of the device client instance during initialization.\n+ */\n+public final class ClientOptions\n+{\n+    /**\n+     * The Digital Twin Model Id associated with the device identity.\n+     * Non plug and play users should not set this value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a107d7d2568b630ec0874873507b985000c8118"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzODQ1NjAx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-423845601", "createdAt": "2020-06-03T19:03:38Z", "commit": {"oid": "7a107d7d2568b630ec0874873507b985000c8118"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxOTowMzozOFrOGepcgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxOTowMzozOFrOGepcgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4OTUwNA==", "bodyText": "shouldn't this be final?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434789504", "createdAt": "2020-06-03T19:03:38Z", "author": {"login": "prmathur-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/mqtt/MqttIotHubConnection.java", "diffHunk": "@@ -42,7 +42,7 @@\n     private static final String SSL_PREFIX = \"ssl://\";\n     private static final String SSL_PORT_SUFFIX = \":8883\";\n \n-    private static final String API_VERSION = \"?api-version=\" + TransportUtils.IOTHUB_API_VERSION;\n+    private static String ModelIdParam = \"digital-twin-model-id\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a107d7d2568b630ec0874873507b985000c8118"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e837bae881f0097d07a6ed8c116013089a6d04b8", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e837bae881f0097d07a6ed8c116013089a6d04b8", "committedDate": "2020-06-03T19:25:39Z", "message": "make modelparam final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDA0Mjcy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-424004272", "createdAt": "2020-06-03T23:28:47Z", "commit": {"oid": "fadba8bb34e6809b1caa62262de3bab4a673170c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMzoyODo0OFrOGew5CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMzoyODo0OFrOGew5CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkxMTQ5Nw==", "bodyText": "Why did we have to modify existing e2e?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#discussion_r434911497", "createdAt": "2020-06-03T23:28:48Z", "author": {"login": "prmathur-microsoft"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -129,7 +129,7 @@ public void constructorSuccess() throws URISyntaxException, IOException\n         final IotHubClientProtocol protocol = IotHubClientProtocol.AMQPS;\n \n         // act\n-        final DeviceClient client = new DeviceClient(connString, protocol);\n+        final DeviceClient client = new DeviceClient(connString, protocol, (ClientOptions) null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fadba8bb34e6809b1caa62262de3bab4a673170c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDEwNDM4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/791#pullrequestreview-424010438", "createdAt": "2020-06-03T23:47:25Z", "commit": {"oid": "e837bae881f0097d07a6ed8c116013089a6d04b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1646, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}