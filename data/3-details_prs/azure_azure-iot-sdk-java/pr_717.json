{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMTIzNzkz", "number": 717, "title": "Add support for JobProperties.StorageAuthenticationType property", "bodyText": "Adding support for JobProperties.StorageAuthenticationType property", "createdAt": "2020-02-27T23:25:36Z", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717", "merged": true, "mergeCommit": {"oid": "d4bf576fec8288ca9985c7326648ce70dbabbf1a"}, "closed": true, "closedAt": "2020-03-13T16:58:54Z", "author": {"login": "bikamani"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIjxa4AH2gAyMzgxMTIzNzkzOmUwMDQ3ZDMwMzY4MjlkNmNkODE2OTRkZGQwNjk2ZjY1YjNiODFmZjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNTPoXAFqTM3NDQ1OTY2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e0047d3036829d6cd81694ddd0696f65b3b81ff5", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e0047d3036829d6cd81694ddd0696f65b3b81ff5", "committedDate": "2020-02-27T23:18:08Z", "message": "Add support for JobProperties.StorageAuthenticationType property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "555ac589300ee55473a5ab145f80b2a01abfe82a", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/555ac589300ee55473a5ab145f80b2a01abfe82a", "committedDate": "2020-02-27T23:48:08Z", "message": "Add support for JobProperties.StorageAuthenticationType property"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MDgxMTI1", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-366081125", "createdAt": "2020-02-27T23:54:53Z", "commit": {"oid": "555ac589300ee55473a5ab145f80b2a01abfe82a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8ad5067b5494ac83fd511ef5d1bb77ceea57994", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e8ad5067b5494ac83fd511ef5d1bb77ceea57994", "committedDate": "2020-02-28T00:43:04Z", "message": "Merge branch 'master' into binal/StorageAuthType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "530a36bd96964e749eba63eca4f6465572fb3f24", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/530a36bd96964e749eba63eca4f6465572fb3f24", "committedDate": "2020-02-28T20:41:57Z", "message": "API version change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef7a5e27778acdf485b47eec6ea9372a437df7aa", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/ef7a5e27778acdf485b47eec6ea9372a437df7aa", "committedDate": "2020-02-28T21:47:24Z", "message": "Merge branch 'master' into binal/StorageAuthType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3535d8e72a935d3cac96d5964411fbf61989e03", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e3535d8e72a935d3cac96d5964411fbf61989e03", "committedDate": "2020-02-28T22:29:13Z", "message": "Merge branch 'binal/StorageAuthType' of https://github.com/Azure/azure-iot-sdk-java into binal/StorageAuthType"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NzI4NjIz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-366728623", "createdAt": "2020-02-28T22:44:13Z", "commit": {"oid": "e3535d8e72a935d3cac96d5964411fbf61989e03"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfbc8a03a719d5ec2ddcfd951322e0684209350d", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/dfbc8a03a719d5ec2ddcfd951322e0684209350d", "committedDate": "2020-02-28T22:56:48Z", "message": "beautifying code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "191b67cba8c6b9875080a1bb9f365a4e4218d4d1", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/191b67cba8c6b9875080a1bb9f365a4e4218d4d1", "committedDate": "2020-03-02T18:13:53Z", "message": "Merge branch 'master' into binal/StorageAuthType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a7723acc0748d8e9bf877a60d37a234a8c33700", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/0a7723acc0748d8e9bf877a60d37a234a8c33700", "committedDate": "2020-03-06T02:19:20Z", "message": "adding import export class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d4ab58bd6c2ae857cbd3ac36706e8dc8d406060", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7d4ab58bd6c2ae857cbd3ac36706e8dc8d406060", "committedDate": "2020-03-06T02:19:54Z", "message": "Merge branch 'binal/StorageAuthType' of https://github.com/Azure/azure-iot-sdk-java into binal/StorageAuthType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/d8ff8fd90932cbda2c213fc235640c4540ce0fa3", "committedDate": "2020-03-07T00:48:37Z", "message": "public api for import export"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA3ODI0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-370707824", "createdAt": "2020-03-07T01:15:15Z", "commit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToxNToxNVrOFzLmWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToxNToxNVrOFzLmWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxMTczOA==", "bodyText": "Shouldn't the serialized name be \"storageAuthenticationType\"?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r389211738", "createdAt": "2020-03-07T01:15:15Z", "author": {"login": "drwill-ms"}, "path": "deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/JobPropertiesParser.java", "diffHunk": "@@ -66,6 +66,11 @@\n     @SerializedName(FAILURE_REASON_NAME)\n     private String failureReason;\n \n+    private static final String STORAGE_AUTHENTICATION_TYPE = \"storageAuthenticationType\";\n+    @Expose(serialize = true, deserialize = true)\n+    @SerializedName(STORAGE_AUTHENTICATION_TYPE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA4MDA5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-370708009", "createdAt": "2020-03-07T01:16:29Z", "commit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToxNjozMFrOFzLnLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToxNjozMFrOFzLnLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxMTk1MA==", "bodyText": "This is missing the extra comment I added: This means authentication must be supplied in the storage URI(s)", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r389211950", "createdAt": "2020-03-07T01:16:30Z", "author": {"login": "drwill-ms"}, "path": "deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/StorageAuthenticationType.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.microsoft.azure.sdk.iot.deps.serializer;\n+\n+import com.google.gson.annotations.SerializedName;\n+/* Specifies authentication type being used for connecting to storage account */\n+public enum StorageAuthenticationType\n+{\n+    /** Use a shared access key for authentication */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA5NTU2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-370709556", "createdAt": "2020-03-07T01:28:22Z", "commit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToyODoyMlrOFzLtGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToyODoyMlrOFzLtGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxMzQ2Ng==", "bodyText": "\"containing SAS token\" is only true if the storageAuthenticationType is keyBased.\nCheck all these comments, and compare them against the updated ones in the c# PR.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r389213466", "createdAt": "2020-03-07T01:28:22Z", "author": {"login": "drwill-ms"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/JobProperties.java", "diffHunk": "@@ -126,6 +127,21 @@ public void setProgress(int progress) {\n         this.progress = progress;\n     }\n \n+    /**\n+     * @return System generated. Ignored at creation.\n+     * If status == failure, this represents a string containing the reason.\n+     */\n+    public String getFailureReason() {\n+        return failureReason;\n+    }\n+\n+    /**\n+     * @param failureReason the failure reason.\n+     */\n+    public void setFailureReason(String failureReason) {\n+        this.failureReason = failureReason;\n+    }\n+\n     /**\n      * @return URI containing SAS token to a blob container that contains registry data to sync.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47b218fe313dcf4f1f7697c606135d0756b45391", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/47b218fe313dcf4f1f7697c606135d0756b45391", "committedDate": "2020-03-07T01:35:28Z", "message": "clean up + create objects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b11af3a4e46ae47feaa05946923bab8736de48aa", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/b11af3a4e46ae47feaa05946923bab8736de48aa", "committedDate": "2020-03-11T00:43:50Z", "message": "Add ut and e2e tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/86690e2b24ec14c19cdb85fca8bf131919f16d3a", "committedDate": "2020-03-11T00:44:52Z", "message": "Merge branch 'master' into binal/StorageAuthType"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDE4MDg2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-372418086", "createdAt": "2020-03-11T01:08:19Z", "commit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMTowODoxOVrOF0mJSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMTowODoxOVrOF0mJSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NTI0MQ==", "bodyText": "minor: space between \"if\" and \"(\"", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r390695241", "createdAt": "2020-03-11T01:08:19Z", "author": {"login": "drwill-ms"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/tests/iothub/serviceclient/ExportImportTests.java", "diffHunk": "@@ -160,8 +213,18 @@ public void export_import_e2e() throws Exception\n         {\n             try\n             {\n-                exportJob = registryManager.exportDevices(containerSasUri, excludeKeys);\n-                exportJobScheduled = true;\n+                if(storageAuthenticationType.isPresent())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "originalPosition": 151}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDE4NTQ1", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-372418545", "createdAt": "2020-03-11T01:09:58Z", "commit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMTowOTo1OFrOF0mK3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMTowOTo1OFrOF0mK3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NTY0NQ==", "bodyText": "minor, extra space before ending parenthesis", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r390695645", "createdAt": "2020-03-11T01:09:58Z", "author": {"login": "drwill-ms"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/JobProperties.java", "diffHunk": "@@ -272,4 +290,76 @@ JobPropertiesParser toJobPropertiesParser()\n \n         return jobPropertiesParser;\n     }\n+\n+    /**\n+     * Creates an instance of JobProperties with parameters ready to start an Import job\n+     *\n+     * @param inputBlobContainerUri URI containing SAS token to a blob container that contains registry data to sync\n+     * @param outputBlobContainerUri URI containing SAS token to a blob container.  This is used to output the status of the job and the results.\n+     * @return An instance of JobProperties\n+     */\n+    public static JobProperties createForImportJob(\n+            String inputBlobContainerUri,\n+            String outputBlobContainerUri)\n+    {\n+        StorageAuthenticationType storageAuthenticationType = StorageAuthenticationType.KEY;\n+        return createForImportJob(inputBlobContainerUri, outputBlobContainerUri, storageAuthenticationType);\n+    }\n+\n+    /**\n+     * Creates an instance of JobProperties with parameters ready to start an Import job\n+     *\n+     * @param inputBlobContainerUri URI containing SAS token to a blob container that contains registry data to sync\n+     * @param outputBlobContainerUri URI containing SAS token to a blob container.  This is used to output the status of the job and the results.\n+     * @param storageAuthenticationType Specifies authentication type being used for connecting to storage account\n+     * @return An instance of JobProperties\n+     */\n+    public static JobProperties createForImportJob(\n+            String inputBlobContainerUri,\n+            String outputBlobContainerUri,\n+            StorageAuthenticationType storageAuthenticationType)\n+    {\n+        JobProperties importJobProperties = new JobProperties();\n+        importJobProperties.setType(JobProperties.JobType.IMPORT);\n+        importJobProperties.setInputBlobContainerUri(inputBlobContainerUri);\n+        importJobProperties.setOutputBlobContainerUri(outputBlobContainerUri);\n+        importJobProperties.setStorageAuthenticationType(storageAuthenticationType);\n+        return importJobProperties;\n+    }\n+\n+    /**\n+     * Creates an instance of JobProperties with parameters ready to start an Export job\n+     *\n+     * @param outputBlobContainerUri URI containing SAS token to a blob container.  This is used to output the status of the job and the results.\n+     * @param excludeKeysInExport Indicates if authorization keys are included in export output\n+     * @return An instance of JobProperties\n+     */\n+    public static JobProperties createForExportJob(\n+            String outputBlobContainerUri,\n+            Boolean excludeKeysInExport )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "originalPosition": 221}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDE4OTYz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-372418963", "createdAt": "2020-03-11T01:11:29Z", "commit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMToxMToyOVrOF0mMMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMToxMToyOVrOF0mMMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NTk4Ng==", "bodyText": "in c# we don't use multiple empty lines between class members. I don't now what Java's style guidelines are, but here's a note for you to check on that.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r390695986", "createdAt": "2020-03-11T01:11:29Z", "author": {"login": "drwill-ms"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/RegistryManager.java", "diffHunk": "@@ -1439,6 +1579,7 @@ private String CreateImportJobPropertiesJson(String importBlobContainerUri, Stri\n         return jobProperties.toJobPropertiesParser().toJson();\n     }\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "originalPosition": 158}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDIwMzY1", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-372420365", "createdAt": "2020-03-11T01:16:38Z", "commit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMToxNjozOFrOF0mQ3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMToxNjozOFrOF0mQ3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NzE4Mw==", "bodyText": "In my experience running several tests at once now, I've run into an JobQuotaExceededException. I thought of different ways of handling this, including using a semaphore, but that would only prevent tests in the same process from running at the same time.\nI eventually landed on just guarding against that exception and retrying a certain number of times.\nYou'll want to do the same, otherwise these tests will occasionally fail and be considered flaky.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r390697183", "createdAt": "2020-03-11T01:16:38Z", "author": {"login": "drwill-ms"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/tests/iothub/serviceclient/ExportImportTests.java", "diffHunk": "@@ -160,8 +213,18 @@ public void export_import_e2e() throws Exception\n         {\n             try\n             {\n-                exportJob = registryManager.exportDevices(containerSasUri, excludeKeys);\n-                exportJobScheduled = true;\n+                if(storageAuthenticationType.isPresent())\n+                {\n+                    JobProperties exportJobProperties = JobProperties.createForExportJob(containerSasUri, excludeKeys, storageAuthenticationType.get());\n+                    exportJob = registryManager.exportDevices(exportJobProperties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "originalPosition": 154}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjM2Nzcy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-366636772", "createdAt": "2020-02-28T19:35:13Z", "commit": {"oid": "e8ad5067b5494ac83fd511ef5d1bb77ceea57994"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxOTozNToxM1rOFwAdMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMToxODo1MFrOF0mS6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4MzQ0Mw==", "bodyText": "Should this be CAPS or CamelCasing?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r385883443", "createdAt": "2020-02-28T19:35:13Z", "author": {"login": "prmathur-microsoft"}, "path": "deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/StorageAuthenticationType.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.microsoft.azure.sdk.iot.deps.serializer;\n+\n+import com.google.gson.annotations.SerializedName;\n+/* Specifies authentication type being used for connecting to storage account */\n+public enum StorageAuthenticationType\n+{\n+    /* Use a shared access key for authentication */\n+    @SerializedName(\"keyBased\")\n+    KEY,\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8ad5067b5494ac83fd511ef5d1bb77ceea57994"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwOTYxOQ==", "bodyText": "Add description here", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r389209619", "createdAt": "2020-03-07T01:00:07Z", "author": {"login": "prmathur-microsoft"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/JobProperties.java", "diffHunk": "@@ -156,40 +172,32 @@ public void setOutputBlobContainerUri(String outputBlobContainerUri) {\n     }\n \n     /**\n-     * @return whether the keys are included in export or not.\n+     * @return\n      */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NjUwNw==", "bodyText": "Why not use primitive?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r390696507", "createdAt": "2020-03-11T01:13:35Z", "author": {"login": "prmathur-microsoft"}, "path": "deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/JobPropertiesParser.java", "diffHunk": "@@ -59,13 +59,18 @@\n     private static final String EXCLUDE_KEYS_IN_EXPORT_NAME = \"excludeKeysInExport\";\n     @Expose(serialize = true, deserialize = true)\n     @SerializedName(EXCLUDE_KEYS_IN_EXPORT_NAME)\n-    private boolean excludeKeysInExport;\n+    private Boolean excludeKeysInExport;\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86690e2b24ec14c19cdb85fca8bf131919f16d3a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NzcwNg==", "bodyText": "Where ever we expose a public API, we need better description, params etc. This data gets pulled into API reference doc we publish during release.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r390697706", "createdAt": "2020-03-11T01:18:50Z", "author": {"login": "prmathur-microsoft"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/JobProperties.java", "diffHunk": "@@ -156,40 +172,32 @@ public void setOutputBlobContainerUri(String outputBlobContainerUri) {\n     }\n \n     /**\n-     * @return whether the keys are included in export or not.\n+     * @return\n      */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIwOTYxOQ=="}, "originalCommit": {"oid": "d8ff8fd90932cbda2c213fc235640c4540ce0fa3"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df50d21410ef6062cd58997c39e2c9d62675ba49", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/df50d21410ef6062cd58997c39e2c9d62675ba49", "committedDate": "2020-03-11T22:25:13Z", "message": "Merge branch 'master' into binal/StorageAuthType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "855b660674b1a49261e2548e6fef6ba62e705e95", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/855b660674b1a49261e2548e6fef6ba62e705e95", "committedDate": "2020-03-11T22:35:38Z", "message": "env var changes for API version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec9a222a7924c8a525bc1831872d76f1edf84b79", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/ec9a222a7924c8a525bc1831872d76f1edf84b79", "committedDate": "2020-03-11T22:52:03Z", "message": "Merge branch 'binal/StorageAuthType' of https://github.com/Azure/azure-iot-sdk-java into binal/StorageAuthType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e6d3ede601e41bee9dc80a280804e7a9c30b599", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7e6d3ede601e41bee9dc80a280804e7a9c30b599", "committedDate": "2020-03-11T22:52:46Z", "message": "minor changes and addressing code review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTk4NDM3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373198437", "createdAt": "2020-03-11T23:47:00Z", "commit": {"oid": "7e6d3ede601e41bee9dc80a280804e7a9c30b599"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57b7e242907d551002946c7757e03e3ca8cb6575", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/57b7e242907d551002946c7757e03e3ca8cb6575", "committedDate": "2020-03-12T00:53:50Z", "message": "changes fixing test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODAzNzE0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373803714", "createdAt": "2020-03-12T18:30:19Z", "commit": {"oid": "57b7e242907d551002946c7757e03e3ca8cb6575"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxODozMDoxOVrOF1qbfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxODozMDoxOVrOF1qbfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgxNDAxMg==", "bodyText": "As this is a public API I would be hesistant to make this change. If we absolutely have to then we should follow the deprecation process here. Can you justify why?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r391814012", "createdAt": "2020-03-12T18:30:19Z", "author": {"login": "prmathur-microsoft"}, "path": "deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/JobPropertiesParser.java", "diffHunk": "@@ -270,7 +296,7 @@ public int getProgress()\n      *\n      * @return The value of excludeKeysInExport\n      */\n-    public boolean isExcludeKeysInExport()\n+    public Boolean isExcludeKeysInExport()\n     {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57b7e242907d551002946c7757e03e3ca8cb6575"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODMxOTE4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373831918", "createdAt": "2020-03-12T19:13:07Z", "commit": {"oid": "57b7e242907d551002946c7757e03e3ca8cb6575"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOToxMzowN1rOF1ryew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOToxMzowN1rOF1ryew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNjI4Mw==", "bodyText": "why static? wouldn't it vary per instance of the job?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r391836283", "createdAt": "2020-03-12T19:13:07Z", "author": {"login": "prmathur-microsoft"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/JobProperties.java", "diffHunk": "@@ -272,4 +298,76 @@ JobPropertiesParser toJobPropertiesParser()\n \n         return jobPropertiesParser;\n     }\n+\n+    /**\n+     * Creates an instance of JobProperties with parameters ready to start an Import job\n+     *\n+     * @param inputBlobContainerUri URI containing SAS token to a blob container that contains registry data to sync\n+     * @param outputBlobContainerUri URI containing SAS token to a blob container.  This is used to output the status of the job and the results.\n+     * @return An instance of JobProperties\n+     */\n+    public static JobProperties createForImportJob(\n+            String inputBlobContainerUri,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57b7e242907d551002946c7757e03e3ca8cb6575"}, "originalPosition": 201}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c72d55ef23e4255205c1c26f457c515749f53d33", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/c72d55ef23e4255205c1c26f457c515749f53d33", "committedDate": "2020-03-12T23:34:39Z", "message": "reverting Boolean changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f9d47ac2de3877551e496b897afb31b0b179355", "author": {"user": {"login": "bikamani", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/1f9d47ac2de3877551e496b897afb31b0b179355", "committedDate": "2020-03-13T00:07:25Z", "message": "improve comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTgxODQx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373981841", "createdAt": "2020-03-13T00:33:30Z", "commit": {"oid": "c72d55ef23e4255205c1c26f457c515749f53d33"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwMDozMzozMFrOF10Jcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwMDozMzozMFrOF10Jcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk3MzIzNQ==", "bodyText": "So where are you setting the env for this to work?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r391973235", "createdAt": "2020-03-13T00:33:30Z", "author": {"login": "prmathur-microsoft"}, "path": "service/iot-service-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/service/RegistryManagerTest.java", "diffHunk": "@@ -1162,7 +1163,74 @@ public Device getStatistics() throws IOException, IotHubException\n         registryManager.getStatisticsAsync();\n     }\n \n+    @Test\n+    public void exportDevices_jobProperties_good_case() throws Exception\n+    {\n+        String connectionString = \"HostName=aaa.bbb.ccc;SharedAccessKeyName=XXX;SharedAccessKey=YYY\";\n+\n+        new NonStrictExpectations()\n+        {\n+            {\n+                IotHubConnectionStringBuilder.createConnectionString(connectionString);\n+                result = iotHubConnectionString;\n+                iotHubConnectionString.getUrlCreateExportImportJob();\n+                result = mockUrl;\n+                mockHttpRequest.send();\n+                result = mockHttpResponse;\n+                mockIotHubExceptionManager.httpResponseVerification((HttpResponse) any);\n+                mockHttpResponse.getBody();\n+                result = jobPropertiesJson.getBytes();\n+            }\n+        };\n+\n+        RegistryManager registryManager = RegistryManager.createFromConnectionString(connectionString);\n+        JobProperties exportJobProperties =\n+                JobProperties.createForExportJob(\"blob1\", true, StorageAuthenticationType.IDENTITY);\n+        JobProperties jobProperties = registryManager.exportDevices(exportJobProperties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c72d55ef23e4255205c1c26f457c515749f53d33"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTgzODM2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373983836", "createdAt": "2020-03-13T00:41:42Z", "commit": {"oid": "c72d55ef23e4255205c1c26f457c515749f53d33"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTk2NDI5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373996429", "createdAt": "2020-03-13T01:31:24Z", "commit": {"oid": "1f9d47ac2de3877551e496b897afb31b0b179355"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwMTozMToyNFrOF107WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwMTozMToyNFrOF107WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk4NjAwOA==", "bodyText": "Does this set the new api-version globally, or just for import/export devices job?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r391986008", "createdAt": "2020-03-13T01:31:24Z", "author": {"login": "drwill-ms"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/IotHubConnectionString.java", "diffHunk": "@@ -632,7 +647,19 @@ public URL getUrlCreateExportImportJob() throws MalformedURLException\n         stringBuilder.append(URL_SEPARATOR_0);\n         stringBuilder.append(\"create\");\n         stringBuilder.append(URL_SEPARATOR_1);\n-        stringBuilder.append(URL_API_VERSION);\n+        // The new api-version is only available in a few initial regions\n+        // Control access via an environment variable. If a user wishes to try it out,\n+        // they can set \"EnabledStorageIdentity\" to \"1\". Otherwise, the SDK will still\n+        // default to the latest, broadly-supported api-version used in this SDK.\n+        IotHubConnectionString iotHubConnectionString = new IotHubConnectionString();\n+        if (iotHubConnectionString.IsStorageIdentityEnabled)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f9d47ac2de3877551e496b897afb31b0b179355"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTk4MjI4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373998228", "createdAt": "2020-03-13T01:39:09Z", "commit": {"oid": "1f9d47ac2de3877551e496b897afb31b0b179355"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwMTozOTowOVrOF11BnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwMTozOTowOVrOF11BnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk4NzYxMg==", "bodyText": "If this feature is off, you need to make sure the storageAuthenticationType is not serialized into the json, otherwise the service will reject the request.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#discussion_r391987612", "createdAt": "2020-03-13T01:39:09Z", "author": {"login": "drwill-ms"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/RegistryManager.java", "diffHunk": "@@ -718,6 +718,69 @@ public JobProperties exportDevices(String exportBlobContainerUri, Boolean exclud\n         return future;\n     }\n \n+    /**\n+     * Create a bulk export job.\n+     *\n+     * @param exportDevicesParameters A JobProperties object containing input parameters for export Devices job\n+     *\n+     * @return A JobProperties object for the newly created bulk export job\n+     *\n+     * @throws IllegalArgumentException This exception is thrown if the exportBlobContainerUri or excludeKeys parameters are null\n+     * @throws IOException This exception is thrown if the IO operation failed\n+     * @throws IotHubException This exception is thrown if the response verification failed\n+     */\n+    public JobProperties exportDevices(JobProperties exportDevicesParameters)\n+            throws IllegalArgumentException, IOException, IotHubException, JsonSyntaxException\n+    {\n+        // CODES_SRS_SERVICE_SDK_JAVA_REGISTRYMANAGER_15_062: [The function shall get the URL for the bulk export job creation]\n+        URL url = iotHubConnectionString.getUrlCreateExportImportJob();\n+\n+        // CODES_SRS_SERVICE_SDK_JAVA_REGISTRYMANAGER_15_063: [The function shall create a new SAS token for the bulk export job]\n+        String sasTokenString = new IotHubServiceSasToken(this.iotHubConnectionString).toString();\n+\n+        // CODES_SRS_SERVICE_SDK_JAVA_REGISTRYMANAGER_15_064: [The function shall create a new HttpRequest for the bulk export job creation ]\n+        exportDevicesParameters.setType(JobProperties.JobType.EXPORT);\n+        String jobPropertiesJson = exportDevicesParameters.toJobPropertiesParser().toJson();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f9d47ac2de3877551e496b897afb31b0b179355"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTk4Mzc2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-373998376", "createdAt": "2020-03-13T01:39:47Z", "commit": {"oid": "1f9d47ac2de3877551e496b897afb31b0b179355"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDU5NjYz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/717#pullrequestreview-374459663", "createdAt": "2020-03-13T16:52:22Z", "commit": {"oid": "1f9d47ac2de3877551e496b897afb31b0b179355"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1821, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}