{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MjU2MzAx", "number": 889, "title": "feat(device): support batch messages for HTTPS", "bodyText": "", "createdAt": "2020-08-10T03:36:31Z", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889", "merged": true, "mergeCommit": {"oid": "0b395e8a18ee88686de6d795e777445f126ab701"}, "closed": true, "closedAt": "2020-08-12T22:23:52Z", "author": {"login": "azabbasi"}, "timelineItems": {"totalCount": 44, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9ZwcQAH2gAyNDY1MjU2MzAxOjRjY2ZmMWQ3ZWY4ODc5NWI4ODU0MjNkNTA4YzRkZDcyZGUxMDMxMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-SQZJgH2gAyNDY1MjU2MzAxOmFlMDBmMGZkNGNmZTA0ZDU0OTI4MzcwZTMyM2RjYjE4ZDg3YWE2NjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ccff1d7ef88795b885423d508c4dd72de10310f", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/4ccff1d7ef88795b885423d508c4dd72de10310f", "committedDate": "2020-08-10T03:36:00Z", "message": "support batch messages for HTTPS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzOTQzMTc4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-463943178", "createdAt": "2020-08-10T03:37:20Z", "commit": {"oid": "4ccff1d7ef88795b885423d508c4dd72de10310f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMzozNzoyMFrOG-AlkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMzozNzoyMFrOG-AlkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3NDUxMw==", "bodyText": "This constructor is internal to the iot.device package.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r467674513", "createdAt": "2020-08-10T03:37:20Z", "author": {"login": "azabbasi"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/Message.java", "diffHunk": "@@ -165,6 +175,30 @@ public Message()\n         initialize();\n     }\n \n+    /**\n+     * Internal constructor to initialize a bulk message instance.\n+     * @param messages List of nested messages\n+     */\n+    Message(Set<Message> messages)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ccff1d7ef88795b885423d508c4dd72de10310f"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e54363af268cef73f59c75e500afec42df79188", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/4e54363af268cef73f59c75e500afec42df79188", "committedDate": "2020-08-10T03:38:21Z", "message": "Update InternalClient.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c079b945671aa1a40cca76366d7cd9a236c8f702", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/c079b945671aa1a40cca76366d7cd9a236c8f702", "committedDate": "2020-08-10T03:38:49Z", "message": "Update InternalClient.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/a58708a1f03a77ca9d90d44eabbc42185c490f79", "committedDate": "2020-08-10T03:39:01Z", "message": "Update InternalClient.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDA4NzI5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464408729", "createdAt": "2020-08-10T16:56:33Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjo1NjozM1rOG-XRFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjo1NjozM1rOG-XRFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjEwMA==", "bodyText": "MQTT and AMQP messages will be sent individually - protocol library restriction?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468046100", "createdAt": "2020-08-10T16:56:33Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/InternalClient.java", "diffHunk": "@@ -184,6 +184,33 @@ public void sendEventAsync(Message message, IotHubEventCallback callback, Object\n         deviceIO.sendEventAsync(message, callback, callbackContext, this.config.getDeviceId());\n     }\n \n+    /**\n+     * ASynchronously sends a batch of messages to the IoT Hub\n+     * HTTPS messages will be sent in a single batch and MQTT and AMQP messages will be sent individually.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDEzMDcx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464413071", "createdAt": "2020-08-10T17:02:27Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzowMjoyN1rOG-XeRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzowMjoyN1rOG-XeRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0OTQ3OQ==", "bodyText": "The ordering of the messages needs to be preserved, so maybe we should use a List instead? Or add a comment that the customer should supply an ordered implementation of Set?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468049479", "createdAt": "2020-08-10T17:02:27Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/InternalClient.java", "diffHunk": "@@ -184,6 +184,33 @@ public void sendEventAsync(Message message, IotHubEventCallback callback, Object\n         deviceIO.sendEventAsync(message, callback, callbackContext, this.config.getDeviceId());\n     }\n \n+    /**\n+     * ASynchronously sends a batch of messages to the IoT Hub\n+     * HTTPS messages will be sent in a single batch and MQTT and AMQP messages will be sent individually.\n+     * Maximum payload size for HTTPS is 255KB\n+     *\n+     * @param messages the list of message to be sent.\n+     * @param callback the callback to be invoked when a response is received.\n+     * Can be {@code null}.\n+     * @param callbackContext a context to be passed to the callback. Can be\n+     * {@code null} if no callback is provided.\n+     *\n+     * @throws IllegalArgumentException if the message provided is {@code null}.\n+     * @throws IllegalStateException if the client has not been opened yet or is\n+     * already closed.\n+     */\n+    public void sendEventBatchAsync(Set<Message> messages, IotHubEventCallback callback, Object callbackContext)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDE0MTkx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464414191", "createdAt": "2020-08-10T17:04:06Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzowNDowN1rOG-XhnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzowNDowN1rOG-XhnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA1MDMzMg==", "bodyText": "Does this have to be a set? What about a more generic type like Collection or Iterable?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468050332", "createdAt": "2020-08-10T17:04:07Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/InternalClient.java", "diffHunk": "@@ -184,6 +184,33 @@ public void sendEventAsync(Message message, IotHubEventCallback callback, Object\n         deviceIO.sendEventAsync(message, callback, callbackContext, this.config.getDeviceId());\n     }\n \n+    /**\n+     * ASynchronously sends a batch of messages to the IoT Hub\n+     * HTTPS messages will be sent in a single batch and MQTT and AMQP messages will be sent individually.\n+     * Maximum payload size for HTTPS is 255KB\n+     *\n+     * @param messages the list of message to be sent.\n+     * @param callback the callback to be invoked when a response is received.\n+     * Can be {@code null}.\n+     * @param callbackContext a context to be passed to the callback. Can be\n+     * {@code null} if no callback is provided.\n+     *\n+     * @throws IllegalArgumentException if the message provided is {@code null}.\n+     * @throws IllegalStateException if the client has not been opened yet or is\n+     * already closed.\n+     */\n+    public void sendEventBatchAsync(Set<Message> messages, IotHubEventCallback callback, Object callbackContext)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDE0MzY0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464414364", "createdAt": "2020-08-10T17:04:21Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzowNDoyMVrOG-XiHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzowNDoyMVrOG-XiHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA1MDQ2MQ==", "bodyText": "nit: add a log statement here", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468050461", "createdAt": "2020-08-10T17:04:21Z", "author": {"login": "abhipsaMisra"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/IotHubTransport.java", "diffHunk": "@@ -401,6 +401,17 @@ public void addMessage(Message message, IotHubEventCallback callback, Object cal\n \n         //Codes_SRS_IOTHUBTRANSPORT_34_042: [This function shall build a transport packet from the provided message,\n         // callback, and context and then add that packet to the waiting queue.]\n+\n+        if (message.isBulk() && !(this.iotHubTransportConnection instanceof HttpsIotHubConnection))\n+        {\n+            for (Message singleMessage : message.getNestedMessages())\n+            {\n+                waitingPacketsQueue.add(new IotHubTransportPacket(message, callback, callbackContext,null, System.currentTimeMillis()));\n+            }\n+\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDMwODIy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464430822", "createdAt": "2020-08-10T17:28:00Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzoyODowMFrOG-YU1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzoyODowMFrOG-YU1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA2MzQ0Nw==", "bodyText": "What about having a class BulkMessage that extends from this message class instead? That way in the lower layers, you can have code like\nif (message instanceof BulkMessage)\n{\n// bulk message logic\n}\nelse\n{\n//normal message logic\n}", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468063447", "createdAt": "2020-08-10T17:28:00Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/Message.java", "diffHunk": "@@ -212,6 +246,15 @@ public Message(String body)\n     \n     // ----- Public Methods -----\n \n+    /**\n+     * Indicates whether or not this instance is a bulk message instance.\n+     * @return Boolean value to indicate whether or not this is a bulk message instance.\n+     */\n+    public boolean isBulk()\n+    {\n+        return this.isBulk;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDM1NDIz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464435423", "createdAt": "2020-08-10T17:35:03Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzozNTowM1rOG-Yj0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzozNTowM1rOG-Yj0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA2NzI4MQ==", "bodyText": "You can make this catch more specific since only a IotHubSizeExceededException exception is thrown here", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468067281", "createdAt": "2020-08-10T17:35:03Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -80,7 +80,29 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n     {\n         synchronized (HTTPS_CONNECTION_LOCK)\n         {\n-            HttpsMessage httpsMessage = HttpsSingleMessage.parseHttpsMessage(message);\n+            // Here we check if it's a bulk message and serialize it.\n+            HttpsMessage httpsMessage = null;\n+\n+            if (message.isBulk())\n+            {\n+                HttpsBatchMessage batchMessage = new HttpsBatchMessage();\n+                for (Message singleMessage : message.getNestedMessages())\n+                {\n+                    try\n+                    {\n+                        batchMessage.addMessage(HttpsSingleMessage.parseHttpsMessage(singleMessage));\n+                    }\n+                    catch (Exception e)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDM1Nzg5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464435789", "createdAt": "2020-08-10T17:35:38Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzozNTozOFrOG-YlBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzozNTozOFrOG-YlBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA2NzU5MA==", "bodyText": "throw new TransportException(\"Failed to create http batch message\", e); to add context", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468067590", "createdAt": "2020-08-10T17:35:38Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -80,7 +80,29 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n     {\n         synchronized (HTTPS_CONNECTION_LOCK)\n         {\n-            HttpsMessage httpsMessage = HttpsSingleMessage.parseHttpsMessage(message);\n+            // Here we check if it's a bulk message and serialize it.\n+            HttpsMessage httpsMessage = null;\n+\n+            if (message.isBulk())\n+            {\n+                HttpsBatchMessage batchMessage = new HttpsBatchMessage();\n+                for (Message singleMessage : message.getNestedMessages())\n+                {\n+                    try\n+                    {\n+                        batchMessage.addMessage(HttpsSingleMessage.parseHttpsMessage(singleMessage));\n+                    }\n+                    catch (Exception e)\n+                    {\n+                        throw new TransportException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDQyMTYz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464442163", "createdAt": "2020-08-10T17:45:05Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzo0NTowNlrOG-Y5CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzo0NTowNlrOG-Y5CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA3MjcxMg==", "bodyText": "I think a good CI-only test to complement the above test is to try a bulk message made up of a large number of small messages. What do you think?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468072712", "createdAt": "2020-08-10T17:45:06Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/telemetry/SendMessagesTests.java", "diffHunk": "@@ -67,6 +67,14 @@ public void sendMessages() throws Exception\n         IotHubServicesCommon.sendMessages(testInstance.client, testInstance.protocol, NORMAL_MESSAGES_TO_SEND, RETRY_MILLISECONDS, SEND_TIMEOUT_MILLISECONDS, 0, null);\n     }\n \n+    @Test\n+    public void sendBulkMessages() throws Exception\n+    {\n+        this.testInstance.setup();\n+\n+        IotHubServicesCommon.sendBulkMessages(testInstance.client, testInstance.protocol, NORMAL_MESSAGES_TO_SEND, RETRY_MILLISECONDS, SEND_TIMEOUT_MILLISECONDS, 0, null);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDkxMzkz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464491393", "createdAt": "2020-08-10T18:56:49Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxODo1Njo0OVrOG-bSaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxODo1Njo0OVrOG-bSaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODExMTk3Nw==", "bodyText": "Use singleMessage when constructing the iothubtransportpacket, not message", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468111977", "createdAt": "2020-08-10T18:56:49Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/IotHubTransport.java", "diffHunk": "@@ -401,6 +401,17 @@ public void addMessage(Message message, IotHubEventCallback callback, Object cal\n \n         //Codes_SRS_IOTHUBTRANSPORT_34_042: [This function shall build a transport packet from the provided message,\n         // callback, and context and then add that packet to the waiting queue.]\n+\n+        if (message.isBulk() && !(this.iotHubTransportConnection instanceof HttpsIotHubConnection))\n+        {\n+            for (Message singleMessage : message.getNestedMessages())\n+            {\n+                waitingPacketsQueue.add(new IotHubTransportPacket(message, callback, callbackContext,null, System.currentTimeMillis()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjQ4OTE4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464648918", "createdAt": "2020-08-10T23:16:29Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzoxNjoyOVrOG-i5hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzoxNjoyOVrOG-i5hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIzNjY3Nw==", "bodyText": "what do nested messages mean here?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468236677", "createdAt": "2020-08-10T23:16:29Z", "author": {"login": "bikamani"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/Message.java", "diffHunk": "@@ -35,6 +35,16 @@\n      */\n     private String messageId;\n \n+    /**\n+     * Whether or not there is a list of nested messages included in this instance.\n+     */\n+    private boolean isBulk;\n+\n+    /**\n+     * List of nested messages.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjUwMDE4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464650018", "createdAt": "2020-08-10T23:19:39Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzoxOTozOVrOG-i9Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzoxOTozOVrOG-i9Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIzNzYyMw==", "bodyText": "so you can use lombok getter here right instead of line 194?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468237623", "createdAt": "2020-08-10T23:19:39Z", "author": {"login": "bikamani"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/Message.java", "diffHunk": "@@ -35,6 +35,16 @@\n      */\n     private String messageId;\n \n+    /**\n+     * Whether or not there is a list of nested messages included in this instance.\n+     */\n+    private boolean isBulk;\n+\n+    /**\n+     * List of nested messages.\n+     */\n+    private Set<Message> nestedMessages;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjUxNTI0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-464651524", "createdAt": "2020-08-10T23:24:03Z", "commit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzoyNDowM1rOG-jCsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzoyNDowM1rOG-jCsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIzOTAyNg==", "bodyText": "may be add some logging here?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r468239026", "createdAt": "2020-08-10T23:24:03Z", "author": {"login": "bikamani"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/IotHubTransport.java", "diffHunk": "@@ -401,6 +401,17 @@ public void addMessage(Message message, IotHubEventCallback callback, Object cal\n \n         //Codes_SRS_IOTHUBTRANSPORT_34_042: [This function shall build a transport packet from the provided message,\n         // callback, and context and then add that packet to the waiting queue.]\n+\n+        if (message.isBulk() && !(this.iotHubTransportConnection instanceof HttpsIotHubConnection))\n+        {\n+            for (Message singleMessage : message.getNestedMessages())\n+            {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a58708a1f03a77ca9d90d44eabbc42185c490f79"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d9adfc065ddc2e6360155f1151bc3528b4bcf5e", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/0d9adfc065ddc2e6360155f1151bc3528b4bcf5e", "committedDate": "2020-08-10T23:27:33Z", "message": "Address comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16174508139324697b9db02bd15047bdddce0fdf", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/16174508139324697b9db02bd15047bdddce0fdf", "committedDate": "2020-08-11T15:54:14Z", "message": "Implement batch messages."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d83efbc321b4b281526a053f55d62ceb79d0d90a", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/d83efbc321b4b281526a053f55d62ceb79d0d90a", "committedDate": "2020-08-11T15:55:24Z", "message": "Update Message.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff8f0cdfdace908c0c7f091946096a84295f6d90", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/ff8f0cdfdace908c0c7f091946096a84295f6d90", "committedDate": "2020-08-12T15:54:27Z", "message": "initial commit for samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5520d0fefa98989eb28de23d254f4921618fc6e1", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/5520d0fefa98989eb28de23d254f4921618fc6e1", "committedDate": "2020-08-12T17:03:54Z", "message": "Fix issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e4c4523aabcf3d0682512b0a0c011bd2e59b146", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/2e4c4523aabcf3d0682512b0a0c011bd2e59b146", "committedDate": "2020-08-12T17:10:40Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99d39fbf6fc555f1d46c19b939dcc50d950b8daf", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/99d39fbf6fc555f1d46c19b939dcc50d950b8daf", "committedDate": "2020-08-12T17:11:05Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b", "committedDate": "2020-08-12T17:13:13Z", "message": "Merge branch 'master' into feature/iot/azabbasi/httpbatch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTQzNTEw", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466143510", "createdAt": "2020-08-12T17:52:35Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1MjozNVrOG_sMQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1MjozNVrOG_sMQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQzNzUwNA==", "bodyText": "A javadoc at the class level would be helpful. It should explain what it is, and link it to the relevant device client method by using \"{@ link <classname>#<methodName>}\"", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469437504", "createdAt": "2020-08-12T17:52:35Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/BatchMessages.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package com.microsoft.azure.sdk.iot.device;\n+\n+import java.util.List;\n+\n+public class BatchMessages extends Message", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTQ2MzEz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466146313", "createdAt": "2020-08-12T17:56:22Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1NjoyMlrOG_sVLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1NjoyMlrOG_sVLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQzOTc4OA==", "bodyText": "\"@ param messages\" could use a description. Something like \"The messages that will be sent as a batch\"", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469439788", "createdAt": "2020-08-12T17:56:22Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/BatchMessages.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package com.microsoft.azure.sdk.iot.device;\n+\n+import java.util.List;\n+\n+public class BatchMessages extends Message\n+{\n+    /**\n+     * List of nested messages.\n+     */\n+    private List<Message> nestedMessages;\n+\n+    /**\n+     * Creates a batch message\n+     * This constructor is internal and can only be called within the com.microsoft.azure.sdk.iot.device package.\n+     * @param messages", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTQ2NzU3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466146757", "createdAt": "2020-08-12T17:56:58Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1Njo1OFrOG_sWng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1Njo1OFrOG_sWng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0MDE1OA==", "bodyText": "Clarify that this callback is all-or-nothing for each batch message, so it will only be fired once", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469440158", "createdAt": "2020-08-12T17:56:58Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/InternalClient.java", "diffHunk": "@@ -184,6 +185,33 @@ public void sendEventAsync(Message message, IotHubEventCallback callback, Object\n         deviceIO.sendEventAsync(message, callback, callbackContext, this.config.getDeviceId());\n     }\n \n+    /**\n+     * ASynchronously sends a batch of messages to the IoT Hub\n+     * HTTPS messages will be sent in a single batch and MQTT and AMQP messages will be sent individually.\n+     * Maximum payload size for HTTPS is 255KB\n+     *\n+     * @param messages the list of message to be sent.\n+     * @param callback the callback to be invoked when a response is received.\n+     * Can be {@code null}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTQ3NDI4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466147428", "createdAt": "2020-08-12T17:57:52Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1Nzo1MlrOG_sYqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1Nzo1MlrOG_sYqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0MDY4MQ==", "bodyText": "If you want to allow amqp/mqtt to use this batch API, then at least add a comment here explaining why only https doesn't split the batch message here", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469440681", "createdAt": "2020-08-12T17:57:52Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/IotHubTransport.java", "diffHunk": "@@ -401,6 +401,18 @@ public void addMessage(Message message, IotHubEventCallback callback, Object cal\n \n         //Codes_SRS_IOTHUBTRANSPORT_34_042: [This function shall build a transport packet from the provided message,\n         // callback, and context and then add that packet to the waiting queue.]\n+\n+        if (message instanceof BatchMessages && !(this.iotHubTransportConnection instanceof HttpsIotHubConnection))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTQ5MzM0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466149334", "createdAt": "2020-08-12T18:00:33Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMDozM1rOG_setw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMDozM1rOG_setw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0MjIzMQ==", "bodyText": "Is this a copy-paste error? It should be \"Send Batch Events Sample\"", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469442231", "createdAt": "2020-08-12T18:00:33Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-samples/send-batch-events/README.md", "diffHunk": "@@ -0,0 +1,60 @@\n+# Send Event Sample", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTQ5NzMx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466149731", "createdAt": "2020-08-12T18:01:06Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMTowN1rOG_sf1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMTowN1rOG_sf1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0MjUxNg==", "bodyText": "Again, make sure you update this readme to reflect the different jar file that gets generated when building this sample", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469442516", "createdAt": "2020-08-12T18:01:07Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-samples/send-batch-events/README.md", "diffHunk": "@@ -0,0 +1,60 @@\n+# Send Event Sample\n+\n+Sample application that uses the Azure IoT Java SDK to send telemetry messages to the\n+Azure IoT Hub cloud service or to an Azure IoT Edge device. The sample demonstrates how to connect\n+and send messages using a protocol of your choices as a parameter.\n+\n+## Build the sample\n+\n+```\n+$> cd {sample root}\n+$> mvn install -DskipTests\n+```\n+\n+## Run the sample\n+\n+Listed below is the command to launch the sample along with a description of its arguments\n+\n+```\n+$> cd {sample root}/send-event\n+$> java -jar target/send-event-{version}-with-deps.jar \"{connection string}\" {number of messages to send} {protocol}  {path to trusted root ca}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTUwMjA2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466150206", "createdAt": "2020-08-12T18:01:44Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMTo0NVrOG_shRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMTo0NVrOG_shRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0Mjg4NQ==", "bodyText": "I imagine that the bulk API callback only gets fired once, so this expected output looks wrong to me", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469442885", "createdAt": "2020-08-12T18:01:45Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-samples/send-batch-events/README.md", "diffHunk": "@@ -0,0 +1,60 @@\n+# Send Event Sample\n+\n+Sample application that uses the Azure IoT Java SDK to send telemetry messages to the\n+Azure IoT Hub cloud service or to an Azure IoT Edge device. The sample demonstrates how to connect\n+and send messages using a protocol of your choices as a parameter.\n+\n+## Build the sample\n+\n+```\n+$> cd {sample root}\n+$> mvn install -DskipTests\n+```\n+\n+## Run the sample\n+\n+Listed below is the command to launch the sample along with a description of its arguments\n+\n+```\n+$> cd {sample root}/send-event\n+$> java -jar target/send-event-{version}-with-deps.jar \"{connection string}\" {number of messages to send} {protocol}  {path to trusted root ca}\n+```\n+\n+### Arguments Description\n+\n+* Connection String:\n+  * IoT Hub connection string format:\n+\n+    ```\n+    HostName=your-hub.azure-devices.net;DeviceId=yourDevice;SharedAccessKey=XXXYYYZZZ=;\n+    ```\n+\n+  * IoT Edge connection string:\n+\n+    ```\n+    HostName=your-hub.azure-devices.net;DeviceId=yourDevice;SharedAccessKey=XXXYYYZZZ=;GatewayHostName=mygateway.contoso.com\n+    ```\n+\n+* Number of messages - Expressed in decimal\n+* Protocol - Choices are \"mqtt\", \"https\", \"amqps\", \"amqps_ws\", \"mqtt_ws\"\n+* Path to trusted CA certificate: This is optional for IoT Hub since it's certificate is signed by public root CA. For the Edge Hub, if the CA is not a public root, a path tp the root CA certificate in PEM format is absolutely required. This is required even if the root certificate is installed in the trusted certificate store of the OS.\n+\n+Sample command invocation:\n+\n+```\n+$> java -jar target/send-event-1.14.0-with-deps.jar \"{connection string}\" 20 mqtt /home/user/ca_cert.pem\n+```\n+\n+## Verify output\n+\n+If everything was correctly provided via the CLI arguments, the following should be observed on stdout\n+\n+```\n+...\n+IoT Hub responded to message d630cd17-4b84-49f1-878a-901f53ac4038 with status OK_EMPTY\n+IoT Hub responded to message e45e5998-5ea1-49bd-978c-5a149e2012e8 with status OK_EMPTY\n+IoT Hub responded to message f12eb242-b314-4ded-98a6-9f2229a9c2b7 with status OK_EMPTY\n+IoT Hub responded to message 033cc1fd-b3fe-43a8-b05a-5e1e188d2b8c with status OK_EMPTY\n+IoT Hub responded to message 1695f37f-455a-4386-a46b-57fe4e4fae44 with status OK_EMPTY", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTUxMTU5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466151159", "createdAt": "2020-08-12T18:03:06Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMzowNlrOG_skHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMzowNlrOG_skHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0MzYxNQ==", "bodyText": "By adding this to the InternalClient rather than device client, you are allowing ModuleClients to use this API, too. I don't think that is an issue, but I wanted to make sure you think about that.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469443615", "createdAt": "2020-08-12T18:03:06Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/InternalClient.java", "diffHunk": "@@ -184,6 +185,33 @@ public void sendEventAsync(Message message, IotHubEventCallback callback, Object\n         deviceIO.sendEventAsync(message, callback, callbackContext, this.config.getDeviceId());\n     }\n \n+    /**\n+     * ASynchronously sends a batch of messages to the IoT Hub\n+     * HTTPS messages will be sent in a single batch and MQTT and AMQP messages will be sent individually.\n+     * Maximum payload size for HTTPS is 255KB\n+     *\n+     * @param messages the list of message to be sent.\n+     * @param callback the callback to be invoked when a response is received.\n+     * Can be {@code null}.\n+     * @param callbackContext a context to be passed to the callback. Can be\n+     * {@code null} if no callback is provided.\n+     *\n+     * @throws IllegalArgumentException if the message provided is {@code null}.\n+     * @throws IllegalStateException if the client has not been opened yet or is\n+     * already closed.\n+     */\n+    public void sendEventBatchAsync(List<Message> messages, IotHubEventCallback callback, Object callbackContext)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTUxODA5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466151809", "createdAt": "2020-08-12T18:03:59Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMzo1OVrOG_smDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowMzo1OVrOG_smDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0NDExMA==", "bodyText": "nit: The class should be \"BatchMessage\" not \"BatchMessages\" since it is ultimately just one http request", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469444110", "createdAt": "2020-08-12T18:03:59Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/InternalClient.java", "diffHunk": "@@ -184,6 +185,33 @@ public void sendEventAsync(Message message, IotHubEventCallback callback, Object\n         deviceIO.sendEventAsync(message, callback, callbackContext, this.config.getDeviceId());\n     }\n \n+    /**\n+     * ASynchronously sends a batch of messages to the IoT Hub\n+     * HTTPS messages will be sent in a single batch and MQTT and AMQP messages will be sent individually.\n+     * Maximum payload size for HTTPS is 255KB\n+     *\n+     * @param messages the list of message to be sent.\n+     * @param callback the callback to be invoked when a response is received.\n+     * Can be {@code null}.\n+     * @param callbackContext a context to be passed to the callback. Can be\n+     * {@code null} if no callback is provided.\n+     *\n+     * @throws IllegalArgumentException if the message provided is {@code null}.\n+     * @throws IllegalStateException if the client has not been opened yet or is\n+     * already closed.\n+     */\n+    public void sendEventBatchAsync(List<Message> messages, IotHubEventCallback callback, Object callbackContext)\n+    {\n+        for (Message message: messages)\n+        {\n+            message.setConnectionDeviceId(this.config.getDeviceId());\n+        }\n+\n+        Message message = new BatchMessages(messages);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTUzMTM3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466153137", "createdAt": "2020-08-12T18:05:55Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowNTo1NVrOG_sqDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowNTo1NVrOG_sqDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0NTEzMw==", "bodyText": "I see this as a good CI test. If you'd like, you can tag it with @ContinuousIntegrationTest. That will make it only run during nightly builds and CI builds", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469445133", "createdAt": "2020-08-12T18:05:55Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/telemetry/SendMessagesTests.java", "diffHunk": "@@ -67,6 +69,28 @@ public void sendMessages() throws Exception\n         IotHubServicesCommon.sendMessages(testInstance.client, testInstance.protocol, NORMAL_MESSAGES_TO_SEND, RETRY_MILLISECONDS, SEND_TIMEOUT_MILLISECONDS, 0, null);\n     }\n \n+    @Test\n+    public void sendBulkMessages() throws Exception\n+    {\n+        this.testInstance.setup();\n+\n+        IotHubServicesCommon.sendBulkMessages(testInstance.client, testInstance.protocol, NORMAL_MESSAGES_TO_SEND, RETRY_MILLISECONDS, SEND_TIMEOUT_MILLISECONDS, 0, null);\n+    }\n+\n+    @Test\n+    public void sendManySmallMessagesAsBatch() throws Exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MTU0MzEx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466154311", "createdAt": "2020-08-12T18:07:39Z", "commit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowNzo0MFrOG_stzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowNzo0MFrOG_stzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0NjA5NQ==", "bodyText": "It looks like you edited the wrong readme. Double check the path of this file", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469446095", "createdAt": "2020-08-12T18:07:40Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-samples/send-event/README.md", "diffHunk": "@@ -1,8 +1,8 @@\n-# Send Event Sample\n+# Send Events In Batch Sample", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f87bdd6d8afa9ed1332cd24bd3c7b49ebc26103b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8319193859ca49cd1c40d318fbdb53be1fbde394", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/8319193859ca49cd1c40d318fbdb53be1fbde394", "committedDate": "2020-08-12T18:32:45Z", "message": "Address comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd5f915e1f00b9be10ebb4aab0e8f7ff1c5c9029", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/cd5f915e1f00b9be10ebb4aab0e8f7ff1c5c9029", "committedDate": "2020-08-12T18:32:47Z", "message": "Merge branch 'feature/iot/azabbasi/httpbatch' of https://github.com/Azure/azure-iot-sdk-java into feature/iot/azabbasi/httpbatch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e74e7e6a6a9c868a4cd4302eeb5379ff494cc80e", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e74e7e6a6a9c868a4cd4302eeb5379ff494cc80e", "committedDate": "2020-08-12T18:34:17Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35f58b6665c4e9c641c9f7b22af40c6c2f13b6ff", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/35f58b6665c4e9c641c9f7b22af40c6c2f13b6ff", "committedDate": "2020-08-12T18:35:40Z", "message": "Update README.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MjgyNTQx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466282541", "createdAt": "2020-08-12T21:14:46Z", "commit": {"oid": "35f58b6665c4e9c641c9f7b22af40c6c2f13b6ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToxNDo0NlrOG_zHrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToxNDo0NlrOG_zHrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1MTAyMA==", "bodyText": "Async not ASync", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#discussion_r469551020", "createdAt": "2020-08-12T21:14:46Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/InternalClient.java", "diffHunk": "@@ -184,6 +185,34 @@ public void sendEventAsync(Message message, IotHubEventCallback callback, Object\n         deviceIO.sendEventAsync(message, callback, callbackContext, this.config.getDeviceId());\n     }\n \n+    /**\n+     * ASynchronously sends a batch of messages to the IoT Hub", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35f58b6665c4e9c641c9f7b22af40c6c2f13b6ff"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MjgzNjE3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/889#pullrequestreview-466283617", "createdAt": "2020-08-12T21:16:41Z", "commit": {"oid": "35f58b6665c4e9c641c9f7b22af40c6c2f13b6ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adac7bc87f7afd290e5d7a94fed396f12b3c25df", "author": {"user": {"login": "azabbasi", "name": "Azad Abbasi"}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/adac7bc87f7afd290e5d7a94fed396f12b3c25df", "committedDate": "2020-08-12T21:17:10Z", "message": "Update InternalClient.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae00f0fd4cfe04d54928370e323dcb18d87aa663", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/ae00f0fd4cfe04d54928370e323dcb18d87aa663", "committedDate": "2020-08-12T21:25:35Z", "message": "Merge branch 'master' into feature/iot/azabbasi/httpbatch"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1539, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}