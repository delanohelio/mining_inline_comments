{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODA5NDcw", "number": 828, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjoyMDozNVrOEJR-JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1NjoxN1rOEJSUtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTY3MDc2OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjoyMDozNVrOGpwOjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjoyMDozNVrOGpwOjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNDk1OQ==", "bodyText": "This dependency gives us the NotThreadSafe annotation", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446434959", "createdAt": "2020-06-26T22:20:35Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/pom.xml", "diffHunk": "@@ -93,6 +93,12 @@\n             <version>1.18.8</version>\n             <scope>provided</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>net.jcip</groupId>\n+            <artifactId>jcip-annotations</artifactId>\n+            <version>1.0</version>\n+            <scope>test</scope>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e58a3d6c76af310b82f9c11297d12afaea5bf722"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTY5MDA4OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjozMTo0MlrOGpwaXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzoyMjowNlrOGpxHdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNzk4MA==", "bodyText": "why does it throw in those flaky instances? doesn't that indicate a problem? doesn't swallowing that exception mean we are ignoring a potential issue?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446437980", "createdAt": "2020-06-26T22:31:42Z", "author": {"login": "azabbasi"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -394,7 +394,14 @@ public void tearDownTwin(DeviceState deviceState) throws IOException\n         }\n         if (internalClient != null)\n         {\n-            internalClient.closeNow();\n+            try\n+            {\n+                internalClient.closeNow();\n+            }\n+            catch (IOException e)\n+            {\n+                // Ignore, the test isn't about being able to close the client", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzODI2Ng==", "bodyText": "We have tests where closing the client is part of the code under test, but this isn't one of them", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446438266", "createdAt": "2020-06-26T22:32:47Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -394,7 +394,14 @@ public void tearDownTwin(DeviceState deviceState) throws IOException\n         }\n         if (internalClient != null)\n         {\n-            internalClient.closeNow();\n+            try\n+            {\n+                internalClient.closeNow();\n+            }\n+            catch (IOException e)\n+            {\n+                // Ignore, the test isn't about being able to close the client", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNzk4MA=="}, "originalCommit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0NjY2OQ==", "bodyText": "that doesn't explain why it throws here though", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446446669", "createdAt": "2020-06-26T23:08:41Z", "author": {"login": "azabbasi"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -394,7 +394,14 @@ public void tearDownTwin(DeviceState deviceState) throws IOException\n         }\n         if (internalClient != null)\n         {\n-            internalClient.closeNow();\n+            try\n+            {\n+                internalClient.closeNow();\n+            }\n+            catch (IOException e)\n+            {\n+                // Ignore, the test isn't about being able to close the client", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNzk4MA=="}, "originalCommit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTM5MQ==", "bodyText": "I can take this out for now. I'm more interested in the TPM changes anyways", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446449391", "createdAt": "2020-06-26T23:21:23Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -394,7 +394,14 @@ public void tearDownTwin(DeviceState deviceState) throws IOException\n         }\n         if (internalClient != null)\n         {\n-            internalClient.closeNow();\n+            try\n+            {\n+                internalClient.closeNow();\n+            }\n+            catch (IOException e)\n+            {\n+                // Ignore, the test isn't about being able to close the client", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNzk4MA=="}, "originalCommit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTUyNw==", "bodyText": "I was under the impression that we generally don't fail a test if the cleanup fails, but this may be worth more discussion", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446449527", "createdAt": "2020-06-26T23:22:06Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -394,7 +394,14 @@ public void tearDownTwin(DeviceState deviceState) throws IOException\n         }\n         if (internalClient != null)\n         {\n-            internalClient.closeNow();\n+            try\n+            {\n+                internalClient.closeNow();\n+            }\n+            catch (IOException e)\n+            {\n+                // Ignore, the test isn't about being able to close the client", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNzk4MA=="}, "originalCommit": {"oid": "2d50d2cdfc7c0dcbfacd62dfbb26ca5712549f5a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTcyNDY4OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1Mzo1NVrOGpwvdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1NjoyNFrOGpwx1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MzM4MQ==", "bodyText": "did you forget to remove this?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446443381", "createdAt": "2020-06-26T22:53:55Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "diffHunk": "@@ -141,17 +141,29 @@ public static Collection inputsCommon(AttestationType attestationType)\n         }\n         else if (attestationType == AttestationType.TPM)\n         {\n-            return Arrays.asList(\n-                    new Object[][]\n-                            {\n-                                    {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS_WS, attestationType}\n-\n-                                    //MQTT/MQTT_WS does not support tpm attestation\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT, attestationType},\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT_WS, attestationType},\n-                            });\n+            if (!isPullRequest)\n+            {\n+                //TODO TPM tests are flakey, so only run them for CI and nightly builds", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MzkwNA==", "bodyText": "No, this is more of an explanation of why we don't run these tests for pull request builds", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446443904", "createdAt": "2020-06-26T22:56:04Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "diffHunk": "@@ -141,17 +141,29 @@ public static Collection inputsCommon(AttestationType attestationType)\n         }\n         else if (attestationType == AttestationType.TPM)\n         {\n-            return Arrays.asList(\n-                    new Object[][]\n-                            {\n-                                    {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS_WS, attestationType}\n-\n-                                    //MQTT/MQTT_WS does not support tpm attestation\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT, attestationType},\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT_WS, attestationType},\n-                            });\n+            if (!isPullRequest)\n+            {\n+                //TODO TPM tests are flakey, so only run them for CI and nightly builds", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MzM4MQ=="}, "originalCommit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0Mzk4OA==", "bodyText": "The TODO is just me being optimistic that we will eventually fix these tests to not be flakey", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446443988", "createdAt": "2020-06-26T22:56:24Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "diffHunk": "@@ -141,17 +141,29 @@ public static Collection inputsCommon(AttestationType attestationType)\n         }\n         else if (attestationType == AttestationType.TPM)\n         {\n-            return Arrays.asList(\n-                    new Object[][]\n-                            {\n-                                    {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS_WS, attestationType}\n-\n-                                    //MQTT/MQTT_WS does not support tpm attestation\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT, attestationType},\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT_WS, attestationType},\n-                            });\n+            if (!isPullRequest)\n+            {\n+                //TODO TPM tests are flakey, so only run them for CI and nightly builds", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MzM4MQ=="}, "originalCommit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTcyODU0OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1NjoxN1rOGpwxvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo1ODoxM1rOGpwzhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0Mzk2NA==", "bodyText": "So was this not referenced earlier?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446443964", "createdAt": "2020-06-26T22:56:17Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "diffHunk": "@@ -141,17 +141,29 @@ public static Collection inputsCommon(AttestationType attestationType)\n         }\n         else if (attestationType == AttestationType.TPM)\n         {\n-            return Arrays.asList(\n-                    new Object[][]\n-                            {\n-                                    {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS_WS, attestationType}\n-\n-                                    //MQTT/MQTT_WS does not support tpm attestation\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT, attestationType},\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT_WS, attestationType},\n-                            });\n+            if (!isPullRequest)\n+            {\n+                //TODO TPM tests are flakey, so only run them for CI and nightly builds\n+                return Arrays.asList(\n+                        new Object[][]\n+                                {\n+                                        {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0NDQyMQ==", "bodyText": "The TPM tests were being run previously. They were just returned as inputs above alongside x509 and symmetric key. This PR just splits the TPM tests into their own class so they can be run in serial while still running the x509 and symmetric key tests in parallel", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/828#discussion_r446444421", "createdAt": "2020-06-26T22:58:13Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/provisioning/setup/ProvisioningCommon.java", "diffHunk": "@@ -141,17 +141,29 @@ public static Collection inputsCommon(AttestationType attestationType)\n         }\n         else if (attestationType == AttestationType.TPM)\n         {\n-            return Arrays.asList(\n-                    new Object[][]\n-                            {\n-                                    {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS, attestationType},\n-                                    {ProvisioningDeviceClientTransportProtocol.AMQPS_WS, attestationType}\n-\n-                                    //MQTT/MQTT_WS does not support tpm attestation\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT, attestationType},\n-                                    //{ProvisioningDeviceClientTransportProtocol.MQTT_WS, attestationType},\n-                            });\n+            if (!isPullRequest)\n+            {\n+                //TODO TPM tests are flakey, so only run them for CI and nightly builds\n+                return Arrays.asList(\n+                        new Object[][]\n+                                {\n+                                        {ProvisioningDeviceClientTransportProtocol.HTTPS, attestationType},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0Mzk2NA=="}, "originalCommit": {"oid": "18ac5575b30db53496cc80b0b319042de842e215"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2874, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}