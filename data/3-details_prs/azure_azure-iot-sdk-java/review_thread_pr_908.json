{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwMTEyMTU1", "number": 908, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQyMzowOTo1M1rOEitzBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNzo1NVrOErtiNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0ODM3MzgyOnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQyMzowOTo1M1rOHQwIXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQyMzowOTo1M1rOHQwIXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzMyNzgzOA==", "bodyText": "This seemed like the best to validate that the correct exception is thrown. The exception type itself can be thrown for various reasons but we want to ensure it is thrown from the correct part of code.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r487327838", "createdAt": "2020-09-11T23:09:53Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/DeviceClientTest.java", "diffHunk": "@@ -1988,6 +1988,364 @@ public void setCertificateAuthorityThrowsIfOpenTransportClient()\n \n     }\n \n+    @Test\n+    public void setAmqpOpenAuthenticationSessionTimeout()\n+    {\n+        //arrange\n+        final int timeoutInSeconds = 10;\n+        DeviceClient client = Deencapsulation.newInstance(DeviceClient.class);\n+        Deencapsulation.setField(client, \"config\", mockConfig);\n+\n+        new NonStrictExpectations()\n+        {\n+            {\n+                mockConfig.getProtocol();\n+                result = IotHubClientProtocol.AMQPS;\n+\n+                mockConfig.getAuthenticationType();\n+                result = DeviceClientConfig.AuthType.SAS_TOKEN;\n+            }\n+        };\n+\n+        //act\n+        client.setOption(\"SetAmqpOpenAuthenticationSessionTimeout\", timeoutInSeconds);\n+\n+        //assert\n+        new Verifications() {\n+            {\n+                Deencapsulation.invoke(mockConfig, \"setAmqpOpenAuthenticationSessionTimeout\", timeoutInSeconds);\n+                times = 1;\n+            }\n+        };\n+    }\n+\n+    @Test\n+    public void setAmqpWsOpenAuthenticationSessionTimeout()\n+    {\n+        //arrange\n+        final int timeoutInSeconds = 10;\n+        DeviceClient client = Deencapsulation.newInstance(DeviceClient.class);\n+        Deencapsulation.setField(client, \"config\", mockConfig);\n+\n+        new NonStrictExpectations()\n+        {\n+            {\n+                mockConfig.getProtocol();\n+                result = IotHubClientProtocol.AMQPS_WS;\n+\n+                mockConfig.getAuthenticationType();\n+                result = DeviceClientConfig.AuthType.SAS_TOKEN;\n+            }\n+        };\n+\n+        //act\n+        client.setOption(\"SetAmqpOpenAuthenticationSessionTimeout\", timeoutInSeconds);\n+\n+        //assert\n+        new Verifications() {\n+            {\n+                Deencapsulation.invoke(mockConfig, \"setAmqpOpenAuthenticationSessionTimeout\", timeoutInSeconds);\n+                times = 1;\n+            }\n+        };\n+    }\n+\n+    @Test\n+    public void setNullAmqpWsOpenAuthenticationSessionTimeoutThrows()\n+    {\n+        //arrange\n+        DeviceClient client = Deencapsulation.newInstance(DeviceClient.class);\n+        Deencapsulation.setField(client, \"config\", mockConfig);\n+\n+        try {\n+            //act\n+            client.setOption(\"setAmqpOpenAuthenticationSessionTimeout\", null);\n+        } catch (IllegalArgumentException expected) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58d0fa6294680ad13f092cac70d785791594149b"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzOTQwMDEyOnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMzo0NTozOVrOHeJTwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMzo0Nzo1MVrOHeJWVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3MTg0Mg==", "bodyText": "Include a postfix of \"_SECONDS\" to these two constants to really drive home that they are in terms of seconds", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501371842", "createdAt": "2020-10-07T23:45:39Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "diffHunk": "@@ -31,6 +31,9 @@\n     private static final int DEFAULT_HTTPS_READ_TIMEOUT_MILLIS = 240000;\n     private static final int DEFAULT_HTTPS_CONNECT_TIMEOUT_MILLIS = 0; //no connect timeout\n \n+    private static final int DEFAULT_AMQP_OPEN_AUTHENTICATION_SESSION_TIMEOUT = 20; // 20 second timeout\n+    private static final int DEFAULT_AMQP_OPEN_DEVICE_SESSIONS_TIMEOUT = 60; // 60 second timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91f243b6b48eaba691f895825cd3efd9e76e1ced"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3MjUwMA==", "bodyText": "good idea. The name was too long so I was on the fence but it would be better.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501372500", "createdAt": "2020-10-07T23:47:51Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "diffHunk": "@@ -31,6 +31,9 @@\n     private static final int DEFAULT_HTTPS_READ_TIMEOUT_MILLIS = 240000;\n     private static final int DEFAULT_HTTPS_CONNECT_TIMEOUT_MILLIS = 0; //no connect timeout\n \n+    private static final int DEFAULT_AMQP_OPEN_AUTHENTICATION_SESSION_TIMEOUT = 20; // 20 second timeout\n+    private static final int DEFAULT_AMQP_OPEN_DEVICE_SESSIONS_TIMEOUT = 60; // 60 second timeout", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3MTg0Mg=="}, "originalCommit": {"oid": "91f243b6b48eaba691f895825cd3efd9e76e1ced"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjY3Mzg3OnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxMDoxMVrOHeoR8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxMTo1OVrOHeoWUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3OTI4Mw==", "bodyText": "should it match the parameter name of \"value\"?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501879283", "createdAt": "2020-10-08T17:10:11Z", "author": {"login": "drwill-ms"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "diffHunk": "@@ -725,7 +735,7 @@ public void setOption(String optionName, Object value) throws IllegalArgumentExc\n         else if (value == null)\n         {\n             // Codes_SRS_DEVICECLIENT_12_026: [The function shall trow IllegalArgumentException if the value is null.]\n-            throw new IllegalArgumentException(\"optionName is null\");\n+            throw new IllegalArgumentException(\"optionValue is null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d67c4b4765e07b658d67bc25d75ab155d75df388"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg4MDQwMw==", "bodyText": "I think it makes sense. the setOption has optionName and value and not optionValue.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501880403", "createdAt": "2020-10-08T17:11:59Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "diffHunk": "@@ -725,7 +735,7 @@ public void setOption(String optionName, Object value) throws IllegalArgumentExc\n         else if (value == null)\n         {\n             // Codes_SRS_DEVICECLIENT_12_026: [The function shall trow IllegalArgumentException if the value is null.]\n-            throw new IllegalArgumentException(\"optionName is null\");\n+            throw new IllegalArgumentException(\"optionValue is null\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3OTI4Mw=="}, "originalCommit": {"oid": "d67c4b4765e07b658d67bc25d75ab155d75df388"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjY3NDc1OnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxMDoyM1rOHeoSbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxMDoyM1rOHeoSbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3OTQwNg==", "bodyText": "extra newline", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501879406", "createdAt": "2020-10-08T17:10:23Z", "author": {"login": "drwill-ms"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClient.java", "diffHunk": "@@ -803,6 +813,17 @@ else if (value == null)\n                     return;\n                 }\n             }\n+            case SET_AMQP_OPEN_AUTHENTICATION_SESSION_TIMEOUT:\n+            {\n+                setOption_SetAmqpOpenAuthenticationSessionTimeout(value);\n+                return;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d67c4b4765e07b658d67bc25d75ab155d75df388"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjY4ODczOnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/amqps/AmqpsIotHubConnection.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNDoxNFrOHeobbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNDoxNFrOHeobbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg4MTcwOQ==", "bodyText": "FYI - The units have been changed but not the default. Instead of 20000 as default, the value is 20 now. The end result is 20 seconds either way. Along with this default, we now allow customers to specify a custom value.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501881709", "createdAt": "2020-10-08T17:14:14Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/amqps/AmqpsIotHubConnection.java", "diffHunk": "@@ -132,7 +130,7 @@ public void open(Queue<DeviceClientConfig> deviceClientConfigs) throws Transport\n                 this.openAsync();\n \n                 log.trace(\"Waiting for authentication links to open...\");\n-                boolean authenticationSessionOpenTimedOut = !this.authenticationSessionOpenedLatch.await(MAX_WAIT_TO_OPEN_AUTHENTICATION_SESSION, TimeUnit.MILLISECONDS);\n+                boolean authenticationSessionOpenTimedOut = !this.authenticationSessionOpenedLatch.await(this.deviceClientConfig.getAmqpOpenAuthenticationSessionTimeout(), TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0c23a57c69d3bfb027def4dbb303d6469fc3bdc"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjY5MTk0OnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNTowNlrOHeodcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNTowNlrOHeodcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg4MjIyNA==", "bodyText": "Defaults for the timeouts", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501882224", "createdAt": "2020-10-08T17:15:06Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "diffHunk": "@@ -31,6 +31,9 @@\n     private static final int DEFAULT_HTTPS_READ_TIMEOUT_MILLIS = 240000;\n     private static final int DEFAULT_HTTPS_CONNECT_TIMEOUT_MILLIS = 0; //no connect timeout\n \n+    private static final int DEFAULT_AMQP_OPEN_AUTHENTICATION_SESSION_TIMEOUT_IN_SECONDS = 20; // 20 second timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0c23a57c69d3bfb027def4dbb303d6469fc3bdc"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjcwMjYxOnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNzo1NVrOHeokSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoxNzo1NVrOHeokSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg4Mzk3Nw==", "bodyText": "Defaults for the timeouts", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/908#discussion_r501883977", "createdAt": "2020-10-08T17:17:55Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceClientConfig.java", "diffHunk": "@@ -31,6 +31,9 @@\n     private static final int DEFAULT_HTTPS_READ_TIMEOUT_MILLIS = 240000;\n     private static final int DEFAULT_HTTPS_CONNECT_TIMEOUT_MILLIS = 0; //no connect timeout\n \n+    private static final int DEFAULT_AMQP_OPEN_AUTHENTICATION_SESSION_TIMEOUT_IN_SECONDS = 20;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c494eb2f254573812a592cb29ac679aab4e487bc"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2682, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}