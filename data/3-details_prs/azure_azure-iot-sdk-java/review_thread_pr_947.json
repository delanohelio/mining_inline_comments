{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MDU5NTUz", "number": 947, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTo0NToxMlrOEouQpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxODoxMlrOEowrnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTM2NDIxOnYy", "diffSide": "RIGHT", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTo0NToxMlrOHZ-ifg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDo1Njo1MFrOHaBkuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwMTA4Ng==", "bodyText": "You're now sending the payload as a string as opposed to as an Object. Is this intentional?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497001086", "createdAt": "2020-09-29T19:45:12Z", "author": {"login": "barustum"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -183,13 +188,13 @@ public static DigitalTwinAsyncClient createFromConnectionString(String connectio\n             options = new DigitalTwinInvokeCommandRequestOptions();\n         }\n \n-        Object payloadAsObject = null;\n-        if(payload != null)\n+        // Retrofit does not work well with null in body\n+        if(payload == null)\n         {\n-            payloadAsObject = objectMapper.readValue(payload, Object.class);\n+            payload = \"\";\n         }\n \n-        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payloadAsObject, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())\n+        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payload, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA0MDkxOA==", "bodyText": "We have some issues with serialization. I was working on a fix for it and it is ready now. I will send it out in the next PR so that you can understand the difference.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497040918", "createdAt": "2020-09-29T20:47:10Z", "author": {"login": "vinagesh"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -183,13 +188,13 @@ public static DigitalTwinAsyncClient createFromConnectionString(String connectio\n             options = new DigitalTwinInvokeCommandRequestOptions();\n         }\n \n-        Object payloadAsObject = null;\n-        if(payload != null)\n+        // Retrofit does not work well with null in body\n+        if(payload == null)\n         {\n-            payloadAsObject = objectMapper.readValue(payload, Object.class);\n+            payload = \"\";\n         }\n \n-        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payloadAsObject, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())\n+        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payload, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwMTA4Ng=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA1MDgwOQ==", "bodyText": "#948", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497050809", "createdAt": "2020-09-29T20:56:50Z", "author": {"login": "vinagesh"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -183,13 +188,13 @@ public static DigitalTwinAsyncClient createFromConnectionString(String connectio\n             options = new DigitalTwinInvokeCommandRequestOptions();\n         }\n \n-        Object payloadAsObject = null;\n-        if(payload != null)\n+        // Retrofit does not work well with null in body\n+        if(payload == null)\n         {\n-            payloadAsObject = objectMapper.readValue(payload, Object.class);\n+            payload = \"\";\n         }\n \n-        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payloadAsObject, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())\n+        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payload, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwMTA4Ng=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTM3MzYzOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTo0Nzo1MFrOHZ-oIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTo0Nzo1MFrOHZ-oIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwMjUyOQ==", "bodyText": "remove space", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497002529", "createdAt": "2020-09-29T19:47:50Z", "author": {"login": "barustum"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.device.DeviceTwin.*;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+\n+@DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinClientComponentTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTM4NTkzOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTo1MToyOVrOHZ-vqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDo0NDoxNlrOHaAyXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwNDQ1Ng==", "bodyText": "empty test", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497004456", "createdAt": "2020-09-29T19:51:29Z", "author": {"login": "barustum"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.device.DeviceTwin.*;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+\n+@DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinClientComponentTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        digitalTwinClient = DigitalTwinClient.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);\n+        }\n+    }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+\n+        this.deviceId = DEVICE_ID_PREFIX.concat(UUID.randomUUID().toString());\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    @AfterClass\n+    public static void cleanUpAfterClass()\n+    {\n+        registryManager.close();\n+    }\n+\n+    @Test\n+    public void getDigitalTwin() {\n+        // act\n+        BasicDigitalTwin response = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = this.digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);\n+\n+        // assert\n+        assertEquals(response.getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+        assertEquals(responseWithHeaders.body().getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+    }\n+\n+    @Test\n+    public void updateDigitalTwin() throws IOException {\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAzNzkxOQ==", "bodyText": "yes it will be filled up in the next PR. I got tired and taking  a break before finishing update E2E test.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497037919", "createdAt": "2020-09-29T20:44:16Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.device.DeviceTwin.*;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+\n+@DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinClientComponentTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        digitalTwinClient = DigitalTwinClient.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);\n+        }\n+    }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+\n+        this.deviceId = DEVICE_ID_PREFIX.concat(UUID.randomUUID().toString());\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    @AfterClass\n+    public static void cleanUpAfterClass()\n+    {\n+        registryManager.close();\n+    }\n+\n+    @Test\n+    public void getDigitalTwin() {\n+        // act\n+        BasicDigitalTwin response = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = this.digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);\n+\n+        // assert\n+        assertEquals(response.getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+        assertEquals(responseWithHeaders.body().getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+    }\n+\n+    @Test\n+    public void updateDigitalTwin() throws IOException {\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwNDQ1Ng=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTM5NTMyOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTo1NDoxM1rOHZ-1Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDo0NjowOFrOHaA5sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwNTg5MA==", "bodyText": "extract 15 to constant since it's used in multiple tests", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497005890", "createdAt": "2020-09-29T19:54:13Z", "author": {"login": "barustum"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.device.DeviceTwin.*;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+\n+@DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinClientComponentTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        digitalTwinClient = DigitalTwinClient.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);\n+        }\n+    }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+\n+        this.deviceId = DEVICE_ID_PREFIX.concat(UUID.randomUUID().toString());\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    @AfterClass\n+    public static void cleanUpAfterClass()\n+    {\n+        registryManager.close();\n+    }\n+\n+    @Test\n+    public void getDigitalTwin() {\n+        // act\n+        BasicDigitalTwin response = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = this.digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);\n+\n+        // assert\n+        assertEquals(response.getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+        assertEquals(responseWithHeaders.body().getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+    }\n+\n+    @Test\n+    public void updateDigitalTwin() throws IOException {\n+    }\n+\n+    @Test\n+    public void invokeComponentLevelCommand() throws IOException {\n+        // arrange\n+        String componentName = \"thermostat1\";\n+        String commandName = \"getMaxMinReport\";\n+        String commandInput = ZonedDateTime.now(ZoneOffset.UTC).minusMinutes(5).format(DateTimeFormatter.ISO_DATE_TIME);\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);\n+        options.setResponseTimeoutInSeconds(15);\n+\n+        // setup device callback\n+        Integer deviceSuccessResponseStatus = 200;\n+        String deviceSuccessResponseMessage = \"Success\";\n+        Integer deviceFailureResponseStatus = 500;\n+        String deviceFailureResponseMessage = \"Failed\";\n+\n+        // Device method callback\n+        String componentCommandName = componentName + \"*\" + commandName;\n+        DeviceMethodCallback deviceMethodCallback = (methodName, methodData, context) -> {\n+            if(methodName.equalsIgnoreCase(componentCommandName)) {\n+                return new DeviceMethodData(deviceSuccessResponseStatus, deviceSuccessResponseMessage);\n+            }\n+            else {\n+                return new DeviceMethodData(deviceFailureResponseStatus, deviceFailureResponseMessage);\n+            }\n+        };\n+\n+        // IotHub event callback\n+        IotHubEventCallback iotHubEventCallback = (responseStatus, callbackContext) -> {};\n+\n+        deviceClient.subscribeToDeviceMethod(deviceMethodCallback, commandName, iotHubEventCallback, commandName);\n+\n+        // act\n+        DigitalTwinCommandResponse responseWithNoPayload = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, null);\n+        DigitalTwinCommandResponse response = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, commandInput);\n+        ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders> responseWithHeaders = this.digitalTwinClient.invokeComponentCommandWithResponse(deviceId, componentName, commandName, commandInput, options);\n+\n+        // assert\n+        String receivedDeviceResponseStatus = \"\\\"\" + deviceSuccessResponseMessage + \"\\\"\";\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithNoPayload.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, response.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithHeaders.body().getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithHeaders.body().getPayload());\n+    }\n+\n+    @Test\n+    public void invokeRootLevelCommand() throws IOException {\n+        // arrange\n+        String commandName = \"reboot\";\n+        String commandInput = \"5\";\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAzOTc5Mg==", "bodyText": "I felt it would be more readable for a test to have it right there. Specially you might want different tests to do different things. But I'm open to a discussion. For product code, I agree constants are good.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497039792", "createdAt": "2020-09-29T20:46:08Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.device.DeviceTwin.*;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+\n+@DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinClientComponentTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        digitalTwinClient = DigitalTwinClient.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);\n+        }\n+    }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+\n+        this.deviceId = DEVICE_ID_PREFIX.concat(UUID.randomUUID().toString());\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    @AfterClass\n+    public static void cleanUpAfterClass()\n+    {\n+        registryManager.close();\n+    }\n+\n+    @Test\n+    public void getDigitalTwin() {\n+        // act\n+        BasicDigitalTwin response = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = this.digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);\n+\n+        // assert\n+        assertEquals(response.getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+        assertEquals(responseWithHeaders.body().getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+    }\n+\n+    @Test\n+    public void updateDigitalTwin() throws IOException {\n+    }\n+\n+    @Test\n+    public void invokeComponentLevelCommand() throws IOException {\n+        // arrange\n+        String componentName = \"thermostat1\";\n+        String commandName = \"getMaxMinReport\";\n+        String commandInput = ZonedDateTime.now(ZoneOffset.UTC).minusMinutes(5).format(DateTimeFormatter.ISO_DATE_TIME);\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);\n+        options.setResponseTimeoutInSeconds(15);\n+\n+        // setup device callback\n+        Integer deviceSuccessResponseStatus = 200;\n+        String deviceSuccessResponseMessage = \"Success\";\n+        Integer deviceFailureResponseStatus = 500;\n+        String deviceFailureResponseMessage = \"Failed\";\n+\n+        // Device method callback\n+        String componentCommandName = componentName + \"*\" + commandName;\n+        DeviceMethodCallback deviceMethodCallback = (methodName, methodData, context) -> {\n+            if(methodName.equalsIgnoreCase(componentCommandName)) {\n+                return new DeviceMethodData(deviceSuccessResponseStatus, deviceSuccessResponseMessage);\n+            }\n+            else {\n+                return new DeviceMethodData(deviceFailureResponseStatus, deviceFailureResponseMessage);\n+            }\n+        };\n+\n+        // IotHub event callback\n+        IotHubEventCallback iotHubEventCallback = (responseStatus, callbackContext) -> {};\n+\n+        deviceClient.subscribeToDeviceMethod(deviceMethodCallback, commandName, iotHubEventCallback, commandName);\n+\n+        // act\n+        DigitalTwinCommandResponse responseWithNoPayload = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, null);\n+        DigitalTwinCommandResponse response = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, commandInput);\n+        ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders> responseWithHeaders = this.digitalTwinClient.invokeComponentCommandWithResponse(deviceId, componentName, commandName, commandInput, options);\n+\n+        // assert\n+        String receivedDeviceResponseStatus = \"\\\"\" + deviceSuccessResponseMessage + \"\\\"\";\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithNoPayload.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, response.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithHeaders.body().getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithHeaders.body().getPayload());\n+    }\n+\n+    @Test\n+    public void invokeRootLevelCommand() throws IOException {\n+        // arrange\n+        String commandName = \"reboot\";\n+        String commandInput = \"5\";\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwNTg5MA=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 173}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTM5NzMyOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTo1NDo0NVrOHZ-2Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDo0NjowNVrOHaA5cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwNjE3NA==", "bodyText": "extract variables in this block to constants", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497006174", "createdAt": "2020-09-29T19:54:45Z", "author": {"login": "barustum"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.device.DeviceTwin.*;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+\n+@DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinClientComponentTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        digitalTwinClient = DigitalTwinClient.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);\n+        }\n+    }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+\n+        this.deviceId = DEVICE_ID_PREFIX.concat(UUID.randomUUID().toString());\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    @AfterClass\n+    public static void cleanUpAfterClass()\n+    {\n+        registryManager.close();\n+    }\n+\n+    @Test\n+    public void getDigitalTwin() {\n+        // act\n+        BasicDigitalTwin response = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = this.digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);\n+\n+        // assert\n+        assertEquals(response.getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+        assertEquals(responseWithHeaders.body().getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+    }\n+\n+    @Test\n+    public void updateDigitalTwin() throws IOException {\n+    }\n+\n+    @Test\n+    public void invokeComponentLevelCommand() throws IOException {\n+        // arrange\n+        String componentName = \"thermostat1\";\n+        String commandName = \"getMaxMinReport\";\n+        String commandInput = ZonedDateTime.now(ZoneOffset.UTC).minusMinutes(5).format(DateTimeFormatter.ISO_DATE_TIME);\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);\n+        options.setResponseTimeoutInSeconds(15);\n+\n+        // setup device callback\n+        Integer deviceSuccessResponseStatus = 200;\n+        String deviceSuccessResponseMessage = \"Success\";\n+        Integer deviceFailureResponseStatus = 500;\n+        String deviceFailureResponseMessage = \"Failed\";\n+\n+        // Device method callback\n+        String componentCommandName = componentName + \"*\" + commandName;\n+        DeviceMethodCallback deviceMethodCallback = (methodName, methodData, context) -> {\n+            if(methodName.equalsIgnoreCase(componentCommandName)) {\n+                return new DeviceMethodData(deviceSuccessResponseStatus, deviceSuccessResponseMessage);\n+            }\n+            else {\n+                return new DeviceMethodData(deviceFailureResponseStatus, deviceFailureResponseMessage);\n+            }\n+        };\n+\n+        // IotHub event callback\n+        IotHubEventCallback iotHubEventCallback = (responseStatus, callbackContext) -> {};\n+\n+        deviceClient.subscribeToDeviceMethod(deviceMethodCallback, commandName, iotHubEventCallback, commandName);\n+\n+        // act\n+        DigitalTwinCommandResponse responseWithNoPayload = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, null);\n+        DigitalTwinCommandResponse response = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, commandInput);\n+        ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders> responseWithHeaders = this.digitalTwinClient.invokeComponentCommandWithResponse(deviceId, componentName, commandName, commandInput, options);\n+\n+        // assert\n+        String receivedDeviceResponseStatus = \"\\\"\" + deviceSuccessResponseMessage + \"\\\"\";\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithNoPayload.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, response.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithHeaders.body().getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithHeaders.body().getPayload());\n+    }\n+\n+    @Test\n+    public void invokeRootLevelCommand() throws IOException {\n+        // arrange\n+        String commandName = \"reboot\";\n+        String commandInput = \"5\";\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);\n+        options.setResponseTimeoutInSeconds(15);\n+\n+        // setup device callback\n+        Integer deviceSuccessResponseStatus = 200;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 177}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAzOTczMQ==", "bodyText": "I felt it would be more readable for a test to have it right there. Specially you might want different tests to do different things. But I'm open to a discussion. For product code, I agree constants are good.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497039731", "createdAt": "2020-09-29T20:46:05Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientComponentTests.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.device.DeviceTwin.*;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+\n+@DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinClientComponentTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        digitalTwinClient = DigitalTwinClient.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);\n+        }\n+    }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+\n+        this.deviceId = DEVICE_ID_PREFIX.concat(UUID.randomUUID().toString());\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    @AfterClass\n+    public static void cleanUpAfterClass()\n+    {\n+        registryManager.close();\n+    }\n+\n+    @Test\n+    public void getDigitalTwin() {\n+        // act\n+        BasicDigitalTwin response = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = this.digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);\n+\n+        // assert\n+        assertEquals(response.getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+        assertEquals(responseWithHeaders.body().getMetadata().getModelId(), E2ETestConstants.TEMPERATURE_CONTROLLER_MODEL_ID);\n+    }\n+\n+    @Test\n+    public void updateDigitalTwin() throws IOException {\n+    }\n+\n+    @Test\n+    public void invokeComponentLevelCommand() throws IOException {\n+        // arrange\n+        String componentName = \"thermostat1\";\n+        String commandName = \"getMaxMinReport\";\n+        String commandInput = ZonedDateTime.now(ZoneOffset.UTC).minusMinutes(5).format(DateTimeFormatter.ISO_DATE_TIME);\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);\n+        options.setResponseTimeoutInSeconds(15);\n+\n+        // setup device callback\n+        Integer deviceSuccessResponseStatus = 200;\n+        String deviceSuccessResponseMessage = \"Success\";\n+        Integer deviceFailureResponseStatus = 500;\n+        String deviceFailureResponseMessage = \"Failed\";\n+\n+        // Device method callback\n+        String componentCommandName = componentName + \"*\" + commandName;\n+        DeviceMethodCallback deviceMethodCallback = (methodName, methodData, context) -> {\n+            if(methodName.equalsIgnoreCase(componentCommandName)) {\n+                return new DeviceMethodData(deviceSuccessResponseStatus, deviceSuccessResponseMessage);\n+            }\n+            else {\n+                return new DeviceMethodData(deviceFailureResponseStatus, deviceFailureResponseMessage);\n+            }\n+        };\n+\n+        // IotHub event callback\n+        IotHubEventCallback iotHubEventCallback = (responseStatus, callbackContext) -> {};\n+\n+        deviceClient.subscribeToDeviceMethod(deviceMethodCallback, commandName, iotHubEventCallback, commandName);\n+\n+        // act\n+        DigitalTwinCommandResponse responseWithNoPayload = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, null);\n+        DigitalTwinCommandResponse response = this.digitalTwinClient.invokeComponentCommand(deviceId, componentName, commandName, commandInput);\n+        ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders> responseWithHeaders = this.digitalTwinClient.invokeComponentCommandWithResponse(deviceId, componentName, commandName, commandInput, options);\n+\n+        // assert\n+        String receivedDeviceResponseStatus = \"\\\"\" + deviceSuccessResponseMessage + \"\\\"\";\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithNoPayload.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithNoPayload.getStatus());\n+        assertEquals(receivedDeviceResponseStatus, response.getPayload());\n+        assertEquals(deviceSuccessResponseStatus, responseWithHeaders.body().getStatus());\n+        assertEquals(receivedDeviceResponseStatus, responseWithHeaders.body().getPayload());\n+    }\n+\n+    @Test\n+    public void invokeRootLevelCommand() throws IOException {\n+        // arrange\n+        String commandName = \"reboot\";\n+        String commandInput = \"5\";\n+        DigitalTwinInvokeCommandRequestOptions options = new DigitalTwinInvokeCommandRequestOptions();\n+        options.setConnectTimeoutInSeconds(15);\n+        options.setResponseTimeoutInSeconds(15);\n+\n+        // setup device callback\n+        Integer deviceSuccessResponseStatus = 200;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwNjE3NA=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 177}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTcyNDU2OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/helpers/E2ETestConstants.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMTowNjozMlrOHaCHqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxNDoyMlrOHaCWsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA1OTc1Mg==", "bodyText": "Temperature controller here?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497059752", "createdAt": "2020-09-29T21:06:32Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/helpers/E2ETestConstants.java", "diffHunk": "@@ -2,5 +2,6 @@\n \n public class E2ETestConstants {\n     public static final String IOTHUB_CONNECTION_STRING_ENV_VAR_NAME = \"IOTHUB_CONNECTION_STRING\";\n-    public static final String MODEL_ID = \"dtmi:com:example:Thermostat;1\";\n+    public static final String THERMOSTAT_MODEL_ID = \"dtmi:com:example:Thermostat;1\";\n+    public static final String TEMPERATURE_CONTROLLER_MODEL_ID = \"dtmi:com:example:Thermostat;1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2MzYwMQ==", "bodyText": "ohhh yes thanks. Good catch!", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497063601", "createdAt": "2020-09-29T21:14:22Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/helpers/E2ETestConstants.java", "diffHunk": "@@ -2,5 +2,6 @@\n \n public class E2ETestConstants {\n     public static final String IOTHUB_CONNECTION_STRING_ENV_VAR_NAME = \"IOTHUB_CONNECTION_STRING\";\n-    public static final String MODEL_ID = \"dtmi:com:example:Thermostat;1\";\n+    public static final String THERMOSTAT_MODEL_ID = \"dtmi:com:example:Thermostat;1\";\n+    public static final String TEMPERATURE_CONTROLLER_MODEL_ID = \"dtmi:com:example:Thermostat;1\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA1OTc1Mg=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTcyOTg2OnYy", "diffSide": "RIGHT", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMTowODoxM1rOHaCK9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxNTowOVrOHaCYLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2MDU5Nw==", "bodyText": "You won't need this since it is covered in withResponse overload", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497060597", "createdAt": "2020-09-29T21:08:13Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -164,6 +164,11 @@ public static DigitalTwinAsyncClient createFromConnectionString(String connectio\n      * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n      */\n     public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName, String payload) throws IOException {\n+        // Retrofit does not work well with null in body\n+        if(payload == null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2Mzk4MQ==", "bodyText": "yes i've cleaned up all of this in the follow up PR.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497063981", "createdAt": "2020-09-29T21:15:09Z", "author": {"login": "vinagesh"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -164,6 +164,11 @@ public static DigitalTwinAsyncClient createFromConnectionString(String connectio\n      * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n      */\n     public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName, String payload) throws IOException {\n+        // Retrofit does not work well with null in body\n+        if(payload == null)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2MDU5Nw=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTc1MTQ2OnYy", "diffSide": "RIGHT", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/models/DigitalTwinMetadata.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxNToxMVrOHaCYQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxNToxMVrOHaCYQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2NDAwMA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497064000", "createdAt": "2020-09-29T21:15:11Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/models/DigitalTwinMetadata.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n     /* Model-defined writable properties' request state. */\n     @JsonIgnore\n-    private final Map<String, Object> writeableProperties = new HashMap<>();\n+    private final Map<String, WritableProperty> writeableProperties = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTc1ODI2OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxNzoxN1rOHaCcTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToyMDoyNlrOHaCiuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2NTAzOA==", "bodyText": "We should call it a TEST_MODEL_ID instead", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497065038", "createdAt": "2020-09-29T21:17:17Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientTests.java", "diffHunk": "@@ -90,7 +92,7 @@ public void cleanUp() {\n \n     private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n         ClientOptions options = new ClientOptions();\n-        options.setModelId(E2ETestConstants.MODEL_ID);\n+        options.setModelId(E2ETestConstants.THERMOSTAT_MODEL_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2NjY4Mw==", "bodyText": "We have two different modelIds. I used these terms to differentiate.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497066683", "createdAt": "2020-09-29T21:20:26Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientTests.java", "diffHunk": "@@ -90,7 +92,7 @@ public void cleanUp() {\n \n     private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n         ClientOptions options = new ClientOptions();\n-        options.setModelId(E2ETestConstants.MODEL_ID);\n+        options.setModelId(E2ETestConstants.THERMOSTAT_MODEL_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2NTAzOA=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTc2MDkzOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxODoxMlrOHaCeDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMToxOTowNFrOHaCf2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2NTQ4Nw==", "bodyText": "I see so the idea here is testing both get overloads in same test?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497065487", "createdAt": "2020-09-29T21:18:12Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientTests.java", "diffHunk": "@@ -107,43 +109,61 @@ public static void cleanUpAfterClass()\n \n     @Test\n     public void getDigitalTwin() {\n-        BasicDigitalTwin getResponse = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n-        assertEquals(getResponse.getMetadata().getModelId(), E2ETestConstants.MODEL_ID);\n-    }\n-\n-    @Test\n-    public void getDigitalTwinWithResponse() {\n-        String digitalTwinId = \"\";\n-    }\n+        // act\n+        BasicDigitalTwin response = digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2NTk0NA==", "bodyText": "I thought it would reduce number of devices we create in the e2e. It should help scale better. What do you think?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/947#discussion_r497065944", "createdAt": "2020-09-29T21:19:04Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinClientTests.java", "diffHunk": "@@ -107,43 +109,61 @@ public static void cleanUpAfterClass()\n \n     @Test\n     public void getDigitalTwin() {\n-        BasicDigitalTwin getResponse = this.digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n-        assertEquals(getResponse.getMetadata().getModelId(), E2ETestConstants.MODEL_ID);\n-    }\n-\n-    @Test\n-    public void getDigitalTwinWithResponse() {\n-        String digitalTwinId = \"\";\n-    }\n+        // act\n+        BasicDigitalTwin response = digitalTwinClient.getDigitalTwin(deviceId, BasicDigitalTwin.class);\n+        ServiceResponseWithHeaders<BasicDigitalTwin, DigitalTwinGetHeaders> responseWithHeaders = digitalTwinClient.getDigitalTwinWithResponse(deviceId, BasicDigitalTwin.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA2NTQ4Nw=="}, "originalCommit": {"oid": "abe229a79decb254b16a81ca116ad640980502de"}, "originalPosition": 75}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2726, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}