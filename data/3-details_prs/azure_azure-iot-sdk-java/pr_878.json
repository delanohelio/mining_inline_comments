{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDE2MDUx", "number": 878, "title": "feat(iot-serv): Make http connect and read timeouts configurable on twin and methods clients", "bodyText": "Basically the same as how the registry manager takes these options.\nMaking the read/connect timeouts configurable will help with speeding up our e2e tests, and this is a useful feature for customers anyways", "createdAt": "2020-08-04T21:22:45Z", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878", "merged": true, "mergeCommit": {"oid": "fcd9272af689f90903005165201786375120a183"}, "closed": true, "closedAt": "2020-08-19T17:04:24Z", "author": {"login": "timtay-microsoft"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7uD9HABqjM2MjIxOTc4MzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAN-ulgH2gAyNDYzMDE2MDUxOmU3OWI0ZWQxYWUwMTk5ZTM0ODUxNDBlOGRlNGY3YTU3MzQ5N2UyMmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15ed8808102784bc0c84eb797b5a16d91153b6b2", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/15ed8808102784bc0c84eb797b5a16d91153b6b2", "committedDate": "2020-08-04T21:21:06Z", "message": "feat(iot-serv): Make http connect and read timeouts configurable on twin and methods clients\n\nadd unit tests"}, "afterCommit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/4763c59dd7c754e37f1f1520b9abb2e116a83be5", "committedDate": "2020-08-04T22:07:17Z", "message": "feat(iot-service): Add proxy support and configurable read/connect timeouts to methods/twin clients\n\nIn order to write tests for the proxy support, each test instance now has its own twin service client so that some can be configured to use proxies and others are not\n\nHaving the twin/method client's read/connect timeouts be configurable will help our e2e tests deal with timeouts when doing method/twin operations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjEzNTk1", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461213595", "createdAt": "2020-08-04T22:14:14Z", "commit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNDoxNFrOG7zVug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNDoxNFrOG7zVug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM2MDMxNA==", "bodyText": "By default, the test instance already has a methodServiceClient, but it isn't setup to use a proxy, so this will create a proxy enabled client for this test in particular", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465360314", "createdAt": "2020-08-04T22:14:14Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/methods/DeviceMethodTests.java", "diffHunk": "@@ -483,4 +489,39 @@ public void invokeMethodOnUnregisteredDevice() throws Exception\n             }\n         }\n     }\n+\n+    @Test\n+    @StandardTierHubOnlyTest\n+    public void invokeMethodWithServiceSideProxy() throws Exception\n+    {\n+        if (testInstance.protocol != IotHubClientProtocol.MQTT || testInstance.authenticationType != AuthenticationType.SAS)\n+        {\n+            // This test doesn't really care about the device side protocol or authentication, so just run it once\n+            // when the device is using MQTT with SAS auth\n+            return;\n+        }\n+\n+        String testProxyHostname = \"127.0.0.1\";\n+        int testProxyPort = 8894;\n+        HttpProxyServer proxyServer = DefaultHttpProxyServer.bootstrap()\n+                .withPort(testProxyPort)\n+                .start();\n+\n+        try\n+        {\n+            Proxy serviceSideProxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress(testProxyHostname, testProxyPort));\n+\n+            ProxyOptions proxyOptions = new ProxyOptions(serviceSideProxy);\n+            DeviceMethodClientOptions options = DeviceMethodClientOptions.builder().proxyOptions(proxyOptions).build();\n+\n+            this.testInstance.methodServiceClient = DeviceMethod.createFromConnectionString(iotHubConnectionString, options);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjEzNzk3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461213797", "createdAt": "2020-08-04T22:14:42Z", "commit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNDo0MlrOG7zWWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNDo0MlrOG7zWWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM2MDQ3Mg==", "bodyText": "This test method uses the above testInstance.methodServiceClient with the proxy configured", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465360472", "createdAt": "2020-08-04T22:14:42Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/methods/DeviceMethodTests.java", "diffHunk": "@@ -483,4 +489,39 @@ public void invokeMethodOnUnregisteredDevice() throws Exception\n             }\n         }\n     }\n+\n+    @Test\n+    @StandardTierHubOnlyTest\n+    public void invokeMethodWithServiceSideProxy() throws Exception\n+    {\n+        if (testInstance.protocol != IotHubClientProtocol.MQTT || testInstance.authenticationType != AuthenticationType.SAS)\n+        {\n+            // This test doesn't really care about the device side protocol or authentication, so just run it once\n+            // when the device is using MQTT with SAS auth\n+            return;\n+        }\n+\n+        String testProxyHostname = \"127.0.0.1\";\n+        int testProxyPort = 8894;\n+        HttpProxyServer proxyServer = DefaultHttpProxyServer.bootstrap()\n+                .withPort(testProxyPort)\n+                .start();\n+\n+        try\n+        {\n+            Proxy serviceSideProxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress(testProxyHostname, testProxyPort));\n+\n+            ProxyOptions proxyOptions = new ProxyOptions(serviceSideProxy);\n+            DeviceMethodClientOptions options = DeviceMethodClientOptions.builder().proxyOptions(proxyOptions).build();\n+\n+            this.testInstance.methodServiceClient = DeviceMethod.createFromConnectionString(iotHubConnectionString, options);\n+\n+            super.openDeviceClientAndSubscribeToMethods();\n+            super.invokeMethodSucceed();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjE0MDMx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461214031", "createdAt": "2020-08-04T22:15:14Z", "commit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNToxNFrOG7zXHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNToxNFrOG7zXHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM2MDY3MQ==", "bodyText": "In order for some tests to have the twin service client use a proxy, and others to not, each test must have its own", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465360671", "createdAt": "2020-08-04T22:15:14Z", "author": {"login": "timtay-microsoft"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -146,7 +145,6 @@ public static Collection inputs() throws Exception\n     protected static RegistryManager registryManager;\n     protected InternalClient internalClient;\n     protected static RawTwinQuery scRawTwinQueryClient;\n-    protected static DeviceTwin sCDeviceTwin;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjE1MTc5", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461215179", "createdAt": "2020-08-04T22:17:49Z", "commit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNzo0OVrOG7zbNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjoxNzo0OVrOG7zbNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM2MTcxNg==", "bodyText": "These default values have changed to 24 seconds each to follow the RegistryManager pattern", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465361716", "createdAt": "2020-08-04T22:17:49Z", "author": {"login": "timtay-microsoft"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceMethod.java", "diffHunk": "@@ -22,9 +23,9 @@\n {\n     private IotHubConnectionString iotHubConnectionString = null;\n     private Integer requestId = 0;\n-    private static final int DEFAULT_RESPONSE_TIMEOUT = 30; // default response timeout is 30 seconds\n-    private static final int DEFAULT_CONNECT_TIMEOUT = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4763c59dd7c754e37f1f1520b9abb2e116a83be5"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjQ5NzY0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461249764", "createdAt": "2020-08-04T23:49:52Z", "commit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjY4OTgy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461268982", "createdAt": "2020-08-05T00:52:53Z", "commit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1Mjo1M1rOG72VYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1Mjo1M1rOG72VYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQwOTM3OA==", "bodyText": "nit: extra line", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465409378", "createdAt": "2020-08-05T00:52:53Z", "author": {"login": "sharmasejal"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -422,6 +420,8 @@ public DeviceTwinCommon(IotHubClientProtocol protocol, AuthenticationType authen\n         public String x509Thumbprint;\n         public String uuid;\n         public ClientType clientType;\n+        public DeviceTwin sCDeviceTwin;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjY5OTUy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461269952", "createdAt": "2020-08-05T00:56:14Z", "commit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1NjoxNFrOG72ZFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1NjoxNFrOG72ZFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMDMyNw==", "bodyText": "add stop punctuation for consistency", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465410327", "createdAt": "2020-08-05T00:56:14Z", "author": {"login": "sharmasejal"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceMethod.java", "diffHunk": "@@ -33,17 +34,36 @@\n      * @throws IOException This exception is thrown if the object creation failed\n      */\n     public static DeviceMethod createFromConnectionString(String connectionString) throws IOException\n+    {\n+        return createFromConnectionString(connectionString, DeviceMethodClientOptions.builder()\n+                .httpConnectTimeout(DeviceMethodClientOptions.DEFAULT_HTTP_CONNECT_TIMEOUT_MS)\n+                .httpReadTimeout(DeviceMethodClientOptions.DEFAULT_HTTP_READ_TIMEOUT_MS)\n+                .build());\n+    }\n+\n+    /**\n+     * Create a DeviceMethod instance from the information in the connection string.\n+     *\n+     * @param connectionString is the IoTHub connection string.\n+     * @param options the configurable options for each operation on this client. May not be null.\n+     * @return an instance of the DeviceMethod.\n+     * @throws IOException This exception is thrown if the object creation failed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjcwNjEw", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461270610", "createdAt": "2020-08-05T00:58:18Z", "commit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1ODoxOVrOG72bWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1ODoxOVrOG72bWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMDkwNQ==", "bodyText": "nit: best if we can be consistent with stoppages", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465410905", "createdAt": "2020-08-05T00:58:19Z", "author": {"login": "sharmasejal"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceOperations.java", "diffHunk": "@@ -140,6 +143,91 @@ public static HttpResponse request(\n         return response;\n     }\n \n+    /**\n+     * Send a http request to the IoTHub using the Twin/Method standard, and return its response.\n+     *\n+     * @param iotHubConnectionString is the connection string for the IoTHub", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjcwODI3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461270827", "createdAt": "2020-08-05T00:59:02Z", "commit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1OTowMlrOG72cFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMDo1OTowMlrOG72cFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMTA5NA==", "bodyText": "nit: same as above", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465411094", "createdAt": "2020-08-05T00:59:02Z", "author": {"login": "sharmasejal"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceTwin.java", "diffHunk": "@@ -33,22 +34,36 @@\n      * @throws IOException This exception is thrown if the object creation failed\n      */\n     public static DeviceTwin createFromConnectionString(String connectionString) throws IOException\n+    {\n+        return createFromConnectionString(connectionString, DeviceTwinClientOptions.builder()\n+                .httpConnectTimeout(DeviceTwinClientOptions.DEFAULT_HTTP_CONNECT_TIMEOUT_MS)\n+                .httpReadTimeout(DeviceTwinClientOptions.DEFAULT_HTTP_READ_TIMEOUT_MS)\n+                .build());\n+    }\n+\n+    /**\n+     * Static constructor to create instance from connection string\n+     *\n+     * @param connectionString The iot hub connection string\n+     * @param options the configurable options for each operation on this client. May not be null.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjcxMjM0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461271234", "createdAt": "2020-08-05T01:00:20Z", "commit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMTowMDoyMFrOG72drA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMTowMDoyMFrOG72drA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMTUwMA==", "bodyText": "nit: stop punctuation", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465411500", "createdAt": "2020-08-05T01:00:20Z", "author": {"login": "sharmasejal"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceTwinClientOptions.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.microsoft.azure.sdk.iot.service.devicetwin;\n+\n+import com.microsoft.azure.sdk.iot.service.ProxyOptions;\n+import lombok.Builder;\n+import lombok.Getter;\n+\n+/**\n+ * Configurable options for all twin client operations\n+ */\n+@Builder\n+public class DeviceTwinClientOptions\n+{\n+    protected static final Integer DEFAULT_HTTP_READ_TIMEOUT_MS = 24000; // 24 seconds\n+    protected static final Integer DEFAULT_HTTP_CONNECT_TIMEOUT_MS = 24000; // 24 seconds\n+\n+    /**\n+     * The options that specify what proxy to tunnel through. If null, no proxy will be used", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d13d6874a433711423771bdb0c5bc6b88d3a307"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjk1OTk3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-461295997", "createdAt": "2020-08-05T02:23:48Z", "commit": {"oid": "0cb2068f13be11a0c302e6af1aef2029d3b827b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjoyMzo0OFrOG731NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwMjoyMzo0OFrOG731NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzMzkwOA==", "bodyText": "Can we not use a common client options for both methods and twins? They seem to be containing settings for the same properties.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r465433908", "createdAt": "2020-08-05T02:23:48Z", "author": {"login": "abhipsaMisra"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceTwinClientOptions.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.microsoft.azure.sdk.iot.service.devicetwin;\n+\n+import com.microsoft.azure.sdk.iot.service.ProxyOptions;\n+import lombok.Builder;\n+import lombok.Getter;\n+\n+/**\n+ * Configurable options for all twin client operations.\n+ */\n+@Builder\n+public class DeviceTwinClientOptions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cb2068f13be11a0c302e6af1aef2029d3b827b6"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODg3NzE4", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462887718", "createdAt": "2020-08-06T21:25:35Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyNTozNVrOG9EzJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyNTozNVrOG9EzJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5NDk1MA==", "bodyText": "Now is a good time to rename this one like we did for some other tests", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466694950", "createdAt": "2020-08-06T21:25:35Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -422,6 +420,7 @@ public DeviceTwinCommon(IotHubClientProtocol protocol, AuthenticationType authen\n         public String x509Thumbprint;\n         public String uuid;\n         public ClientType clientType;\n+        public DeviceTwin sCDeviceTwin;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODg5MDAy", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462889002", "createdAt": "2020-08-06T21:27:59Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyNzo1OVrOG9E3Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyNzo1OVrOG9E3Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5NjAwNg==", "bodyText": "so why are we doing it?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466696006", "createdAt": "2020-08-06T21:27:59Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -431,6 +430,17 @@ public DeviceTwinTestInstance(IotHubClientProtocol protocol, AuthenticationType\n             this.privateKey = privateKey;\n             this.x509Thumbprint = x509Thumbprint;\n             this.clientType = clientType;\n+\n+            try\n+            {\n+                this.sCDeviceTwin = DeviceTwin.createFromConnectionString(iotHubConnectionString);\n+            }\n+            catch (IOException e)\n+            {\n+                // A little odd to do this, but the createFromConnectionString call doesn't ever actually throw this exception, and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODg5OTI0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462889924", "createdAt": "2020-08-06T21:29:40Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyOTo0MFrOG9E6Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyOTo0MFrOG9E6Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5NjcxOQ==", "bodyText": "Since you are moving this one to test instance. Are others here not used as a common resource?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466696719", "createdAt": "2020-08-06T21:29:40Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -146,7 +145,6 @@ public static Collection inputs() throws Exception\n     protected static RegistryManager registryManager;\n     protected InternalClient internalClient;\n     protected static RawTwinQuery scRawTwinQueryClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODkwMjMz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462890233", "createdAt": "2020-08-06T21:30:15Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTozMDoxNVrOG9E7Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTozMDoxNVrOG9E7Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5Njk2Mw==", "bodyText": "When do we see this one - GeneralSecurityException ?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466696963", "createdAt": "2020-08-06T21:30:15Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/setup/DeviceTwinCommon.java", "diffHunk": "@@ -716,7 +725,7 @@ public void execute(IotHubConnectionStatus status, IotHubConnectionStatusChangeR\n         this.internalClient.registerConnectionStatusChangeCallback(connectionStatusUpdateCallback, null);\n     }\n \n-    protected void testGetDeviceTwin() throws IOException, InterruptedException, IotHubException\n+    protected void testGetDeviceTwin() throws IOException, InterruptedException, IotHubException, GeneralSecurityException, ModuleClientException, URISyntaxException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODk1NjIz", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462895623", "createdAt": "2020-08-06T21:40:38Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0MDozOVrOG9FL8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0MDozOVrOG9FL8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMTI5OQ==", "bodyText": "So if we are using in both the tests, why are we removing @before block?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466701299", "createdAt": "2020-08-06T21:40:39Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/twin/GetTwinTests.java", "diffHunk": "@@ -38,16 +47,47 @@ public GetTwinTests(IotHubClientProtocol protocol, AuthenticationType authentica\n         super(protocol, authenticationType, clientType, publicKeyCert, privateKey, x509Thumbprint);\n     }\n \n-    @Before\n-    public void setUpNewDeviceAndModule() throws IOException, IotHubException, URISyntaxException, InterruptedException, ModuleClientException, GeneralSecurityException\n+    @Test\n+    @StandardTierHubOnlyTest\n+    public void testGetDeviceTwin() throws IOException, InterruptedException, IotHubException, GeneralSecurityException, ModuleClientException, URISyntaxException\n     {\n         super.setUpNewDeviceAndModule();\n+        super.testGetDeviceTwin();\n     }\n \n     @Test\n     @StandardTierHubOnlyTest\n-    public void testGetDeviceTwin() throws IOException, InterruptedException, IotHubException\n+    public void testGetDeviceTwinWithProxy() throws IOException, InterruptedException, IotHubException, GeneralSecurityException, ModuleClientException, URISyntaxException\n     {\n-        super.testGetDeviceTwin();\n+        if (testInstance.protocol != IotHubClientProtocol.MQTT || testInstance.authenticationType != AuthenticationType.SAS || testInstance.clientType != ClientType.DEVICE_CLIENT)\n+        {\n+            // This test doesn't really care about the device side protocol or authentication, so just run it once\n+            // when the device is using MQTT with SAS auth\n+            return;\n+        }\n+\n+        super.setUpNewDeviceAndModule();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODk2MDcx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462896071", "createdAt": "2020-08-06T21:41:28Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0MToyOFrOG9FNQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0MToyOFrOG9FNQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMTYzNQ==", "bodyText": "nit: can we have the tabbing differentiate between the builder args and createFromConnectionString args. Eg:\npublic static DeviceMethod createFromConnectionString(String connectionString) throws IOException\n{\n    return createFromConnectionString(\n            connectionString,\n            DeviceMethodClientOptions.builder()\n                    .httpConnectTimeout(DeviceMethodClientOptions.DEFAULT_HTTP_CONNECT_TIMEOUT_MS)\n                    .httpReadTimeout(DeviceMethodClientOptions.DEFAULT_HTTP_READ_TIMEOUT_MS)\n                    .build());\n}", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466701635", "createdAt": "2020-08-06T21:41:28Z", "author": {"login": "abhipsaMisra"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceMethod.java", "diffHunk": "@@ -22,28 +23,47 @@\n {\n     private IotHubConnectionString iotHubConnectionString = null;\n     private Integer requestId = 0;\n-    private static final int DEFAULT_RESPONSE_TIMEOUT = 30; // default response timeout is 30 seconds\n-    private static final int DEFAULT_CONNECT_TIMEOUT = 0;\n-    private static final int THOUSAND_MS = 1000;\n+\n+    private DeviceMethodClientOptions options;\n+\n     /**\n      * Create a DeviceMethod instance from the information in the connection string.\n      *\n      * @param connectionString is the IoTHub connection string.\n      * @return an instance of the DeviceMethod.\n-     * @throws IOException This exception is thrown if the object creation failed\n+     * @throws IOException This exception is thrown if the object creation failed.\n      */\n     public static DeviceMethod createFromConnectionString(String connectionString) throws IOException\n+    {\n+        return createFromConnectionString(connectionString, DeviceMethodClientOptions.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODk5MzMw", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462899330", "createdAt": "2020-08-06T21:48:08Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0ODowOFrOG9FX2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0ODowOFrOG9FX2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNDM0NA==", "bodyText": "Is this a customer request?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466704344", "createdAt": "2020-08-06T21:48:08Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceMethodClientOptions.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.microsoft.azure.sdk.iot.service.devicetwin;\n+\n+import com.microsoft.azure.sdk.iot.service.ProxyOptions;\n+import lombok.Builder;\n+import lombok.Getter;\n+\n+/**\n+ * Configurable options for all device method operations.\n+ */\n+@Builder\n+public class DeviceMethodClientOptions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTAwNjIw", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462900620", "createdAt": "2020-08-06T21:50:31Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo1MDozMlrOG9FcDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo1MDozMlrOG9FcDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNTQyMw==", "bodyText": "Why are these values 24?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466705423", "createdAt": "2020-08-06T21:50:32Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceMethodClientOptions.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.microsoft.azure.sdk.iot.service.devicetwin;\n+\n+import com.microsoft.azure.sdk.iot.service.ProxyOptions;\n+import lombok.Builder;\n+import lombok.Getter;\n+\n+/**\n+ * Configurable options for all device method operations.\n+ */\n+@Builder\n+public class DeviceMethodClientOptions\n+{\n+    protected static final Integer DEFAULT_HTTP_READ_TIMEOUT_MS = 24000; // 24 seconds\n+    protected static final Integer DEFAULT_HTTP_CONNECT_TIMEOUT_MS = 24000; // 24 seconds", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTAwNjM0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462900634", "createdAt": "2020-08-06T21:50:33Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo1MDozM1rOG9FcGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo1MDozM1rOG9FcGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNTQzMw==", "bodyText": "If proxy is present as a part of options, then in order to invoke methods and update twins, I'd have to set proxy to their specific \"options\" types, correct?\nWouldn't that be a bit of overhead? What do think about having a ClientOptions type instead (with proxy, and anything else that would be common across the client), and have these operations specific options inherit from that?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466705433", "createdAt": "2020-08-06T21:50:33Z", "author": {"login": "abhipsaMisra"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceMethod.java", "diffHunk": "@@ -127,74 +147,43 @@ public synchronized MethodResult invoke(String deviceId, String moduleId, String\n      * @param methodName is the name of the method that shall be invoked on the device.\n      * @param responseTimeoutInSeconds is the maximum waiting time for a response from the device in seconds.\n      * @param connectTimeoutInSeconds is the maximum waiting time for a response from the connection in seconds.\n-     * @param payload is the the method parameter\n-     * @return the status and payload resulted from the method invoke\n-     * @throws IotHubException This exception is thrown if the response verification failed\n-     * @throws IOException This exception is thrown if the IO operation failed\n+     * @param payload is the the method parameter.\n+     * @return the status and payload resulted from the method invoke.\n+     * @throws IotHubException This exception is thrown if the response verification failed.\n+     * @throws IOException This exception is thrown if the IO operation failed.\n      */\n     private synchronized MethodResult invokeMethod(URL url, String methodName, Long responseTimeoutInSeconds, Long connectTimeoutInSeconds, Object payload) throws IotHubException, IOException\n     {\n-        /* Codes_SRS_DEVICEMETHOD_21_006: [The invoke shall throw IllegalArgumentException if the provided responseTimeoutInSeconds is negative.] */\n-        /* Codes_SRS_DEVICEMETHOD_21_007: [The invoke shall throw IllegalArgumentException if the provided connectTimeoutInSeconds is negative.] */\n-        /* Codes_SRS_DEVICEMETHOD_21_014: [The invoke shall bypass the Exception if one of the functions called by invoke failed.] */\n         MethodParser methodParser = new MethodParser(methodName, responseTimeoutInSeconds, connectTimeoutInSeconds, payload);\n \n-        /* Codes_SRS_DEVICEMETHOD_21_011: [The invoke shall add a HTTP body with Json created by the `serializer.MethodParser`.] */\n         String json = methodParser.toJson();\n         if(json == null)\n         {\n-            /* Codes_SRS_DEVICEMETHOD_21_012: [If `MethodParser` return a null Json, the invoke shall throw IllegalArgumentException.] */\n             throw new IllegalArgumentException(\"MethodParser return null Json\");\n         }\n \n-        long  responseTimeout, connectTimeout;\n+        Proxy proxy = options.getProxyOptions() != null ? options.getProxyOptions().getProxy() : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTA3ODYx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462907861", "createdAt": "2020-08-06T22:05:18Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjowNToxOFrOG9Fy9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjowNToxOFrOG9Fy9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxMTI4Ng==", "bodyText": "What happens if these are negative values?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466711286", "createdAt": "2020-08-06T22:05:18Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceMethodClientOptions.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.microsoft.azure.sdk.iot.service.devicetwin;\n+\n+import com.microsoft.azure.sdk.iot.service.ProxyOptions;\n+import lombok.Builder;\n+import lombok.Getter;\n+\n+/**\n+ * Configurable options for all device method operations.\n+ */\n+@Builder\n+public class DeviceMethodClientOptions\n+{\n+    protected static final Integer DEFAULT_HTTP_READ_TIMEOUT_MS = 24000; // 24 seconds\n+    protected static final Integer DEFAULT_HTTP_CONNECT_TIMEOUT_MS = 24000; // 24 seconds\n+\n+    /**\n+     * The options that specify what proxy to tunnel through. If null, no proxy will be used.\n+     */\n+    @Getter\n+    private ProxyOptions proxyOptions;\n+\n+    /**\n+     * The http read timeout to a specified timeout, in milliseconds. A non-zero value specifies the timeout when reading from\n+     * Input stream after a connection is established to a resource. If the timeout expires before there is data available\n+     * for read, a java.net.SocketTimeoutException is raised. A timeout of zero is interpreted as an infinite timeout.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTEwNTk2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462910596", "createdAt": "2020-08-06T22:11:23Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoxMToyM1rOG9F7dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoxMToyM1rOG9F7dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxMzQ2MA==", "bodyText": "Add a comment about this timeout values being in seconds", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466713460", "createdAt": "2020-08-06T22:11:23Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceOperations.java", "diffHunk": "@@ -141,9 +144,94 @@ public static HttpResponse request(\n     }\n \n     /**\n-     * Sets headers to be used on next HTTP request\n-     * @param httpHeaders non null and non empty custom headers\n-     * @throws IllegalArgumentException This exception is thrown if headers were null or empty\n+     * Send a http request to the IoTHub using the Twin/Method standard, and return its response.\n+     *\n+     * @param iotHubConnectionString is the connection string for the IoTHub.\n+     * @param url is the Twin URL for the device ID.\n+     * @param method is the HTTP method (GET, POST, DELETE, PATCH, PUT).\n+     * @param payload is the array of bytes that contains the payload.\n+     * @param requestId is an unique number that identify the request.\n+     * @param connectTimeout the http connect timeout to use.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTEwNjI3", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462910627", "createdAt": "2020-08-06T22:11:26Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoxMToyNlrOG9F7jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoxMToyNlrOG9F7jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxMzQ4NA==", "bodyText": "should we not check these values >= 0? What's the behavior otherwise?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466713484", "createdAt": "2020-08-06T22:11:26Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceOperations.java", "diffHunk": "@@ -141,9 +144,94 @@ public static HttpResponse request(\n     }\n \n     /**\n-     * Sets headers to be used on next HTTP request\n-     * @param httpHeaders non null and non empty custom headers\n-     * @throws IllegalArgumentException This exception is thrown if headers were null or empty\n+     * Send a http request to the IoTHub using the Twin/Method standard, and return its response.\n+     *\n+     * @param iotHubConnectionString is the connection string for the IoTHub.\n+     * @param url is the Twin URL for the device ID.\n+     * @param method is the HTTP method (GET, POST, DELETE, PATCH, PUT).\n+     * @param payload is the array of bytes that contains the payload.\n+     * @param requestId is an unique number that identify the request.\n+     * @param connectTimeout the http connect timeout to use.\n+     * @param readTimeout the http read timeout to use.\n+     * @param proxy the proxy to use, or null if no proxy will be used.\n+     * @return the result of the request.\n+     * @throws IotHubException This exception is thrown if the response verification failed.\n+     * @throws IOException This exception is thrown if the IO operation failed.\n+     */\n+    public static HttpResponse request(\n+            IotHubConnectionString iotHubConnectionString,\n+            URL url,\n+            HttpMethod method,\n+            byte[] payload,\n+            String requestId,\n+            int connectTimeout,\n+            int readTimeout,\n+            Proxy proxy)\n+            throws IOException, IotHubException, IllegalArgumentException\n+    {\n+        if (iotHubConnectionString == null)\n+        {\n+            throw new IllegalArgumentException(\"Null ConnectionString\");\n+        }\n+\n+        if (url == null)\n+        {\n+            throw new IllegalArgumentException(\"Null URL\");\n+        }\n+\n+        if (method == null)\n+        {\n+            throw new IllegalArgumentException(\"Null method\");\n+        }\n+\n+        String sasTokenString = new IotHubServiceSasToken(iotHubConnectionString).toString();\n+        if((sasTokenString == null) || sasTokenString.isEmpty())\n+        {\n+            throw new IOException(\"Illegal sasToken null or empty\");\n+        }\n+\n+        HttpRequest request;\n+        if (proxy != null)\n+        {\n+            request = new HttpRequest(url, method, payload, proxy);\n+        }\n+        else\n+        {\n+            request = new HttpRequest(url, method, payload);\n+        }\n+\n+        request.setReadTimeoutMillis(readTimeout);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTExMjky", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-462911292", "createdAt": "2020-08-06T22:12:46Z", "commit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoxMjo0NlrOG9F9bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoxMjo0NlrOG9F9bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxMzk2Nw==", "bodyText": "should we not catch exception here?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r466713967", "createdAt": "2020-08-06T22:12:46Z", "author": {"login": "bikamani"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceOperations.java", "diffHunk": "@@ -141,9 +144,94 @@ public static HttpResponse request(\n     }\n \n     /**\n-     * Sets headers to be used on next HTTP request\n-     * @param httpHeaders non null and non empty custom headers\n-     * @throws IllegalArgumentException This exception is thrown if headers were null or empty\n+     * Send a http request to the IoTHub using the Twin/Method standard, and return its response.\n+     *\n+     * @param iotHubConnectionString is the connection string for the IoTHub.\n+     * @param url is the Twin URL for the device ID.\n+     * @param method is the HTTP method (GET, POST, DELETE, PATCH, PUT).\n+     * @param payload is the array of bytes that contains the payload.\n+     * @param requestId is an unique number that identify the request.\n+     * @param connectTimeout the http connect timeout to use.\n+     * @param readTimeout the http read timeout to use.\n+     * @param proxy the proxy to use, or null if no proxy will be used.\n+     * @return the result of the request.\n+     * @throws IotHubException This exception is thrown if the response verification failed.\n+     * @throws IOException This exception is thrown if the IO operation failed.\n+     */\n+    public static HttpResponse request(\n+            IotHubConnectionString iotHubConnectionString,\n+            URL url,\n+            HttpMethod method,\n+            byte[] payload,\n+            String requestId,\n+            int connectTimeout,\n+            int readTimeout,\n+            Proxy proxy)\n+            throws IOException, IotHubException, IllegalArgumentException\n+    {\n+        if (iotHubConnectionString == null)\n+        {\n+            throw new IllegalArgumentException(\"Null ConnectionString\");\n+        }\n+\n+        if (url == null)\n+        {\n+            throw new IllegalArgumentException(\"Null URL\");\n+        }\n+\n+        if (method == null)\n+        {\n+            throw new IllegalArgumentException(\"Null method\");\n+        }\n+\n+        String sasTokenString = new IotHubServiceSasToken(iotHubConnectionString).toString();\n+        if((sasTokenString == null) || sasTokenString.isEmpty())\n+        {\n+            throw new IOException(\"Illegal sasToken null or empty\");\n+        }\n+\n+        HttpRequest request;\n+        if (proxy != null)\n+        {\n+            request = new HttpRequest(url, method, payload, proxy);\n+        }\n+        else\n+        {\n+            request = new HttpRequest(url, method, payload);\n+        }\n+\n+        request.setReadTimeoutMillis(readTimeout);\n+        request.setConnectTimeoutMillis(connectTimeout);\n+\n+        if((requestId != null) && !requestId.isEmpty())\n+        {\n+            request.setHeaderField(REQUEST_ID, requestId);\n+        }\n+\n+        request.setHeaderField(AUTHORIZATION, sasTokenString);\n+        request.setHeaderField(USER_AGENT, TransportUtils.javaServiceClientIdentifier + TransportUtils.serviceVersion);\n+        request.setHeaderField(ACCEPT, ACCEPT_VALUE);\n+        request.setHeaderField(CONTENT_TYPE, ACCEPT_VALUE + \"; \" + ACCEPT_CHARSET);\n+\n+        if (headers != null)\n+        {\n+            for(Map.Entry<String, String> header : headers.entrySet())\n+            {\n+                request.setHeaderField(header.getKey(), header.getValue());\n+            }\n+\n+            headers = null;\n+        }\n+\n+        HttpResponse response = request.send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a9cf16e5a95442c588c51539c3c0679978264e"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7da0f8d9531a021eab767e244234ed44e22c5b85", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7da0f8d9531a021eab767e244234ed44e22c5b85", "committedDate": "2020-08-10T18:31:40Z", "message": "feat(iot-service): Add proxy support and configurable read/connect timeouts to methods/twin clients\n\nIn order to write tests for the proxy support, each test instance now has its own twin service client so that some can be configured to use proxies and others are not\n\nHaving the twin/method client's read/connect timeouts be configurable will help our e2e tests deal with timeouts when doing method/twin operations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b06696af8c3b541295a471f7b5883932f75c7fd", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/6b06696af8c3b541295a471f7b5883932f75c7fd", "committedDate": "2020-08-10T18:25:55Z", "message": "CR comments"}, "afterCommit": {"oid": "7da0f8d9531a021eab767e244234ed44e22c5b85", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7da0f8d9531a021eab767e244234ed44e22c5b85", "committedDate": "2020-08-10T18:31:40Z", "message": "feat(iot-service): Add proxy support and configurable read/connect timeouts to methods/twin clients\n\nIn order to write tests for the proxy support, each test instance now has its own twin service client so that some can be configured to use proxies and others are not\n\nHaving the twin/method client's read/connect timeouts be configurable will help our e2e tests deal with timeouts when doing method/twin operations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTIxMjA2", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-464521206", "createdAt": "2020-08-10T19:35:06Z", "commit": {"oid": "7da0f8d9531a021eab767e244234ed44e22c5b85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTozNTowNlrOG-cueQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTozNTowNlrOG-cueQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEzNTU0NQ==", "bodyText": "nit: can we add some more context to these exception messages - http method is null, endpoint connecting to is null etc?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r468135545", "createdAt": "2020-08-10T19:35:06Z", "author": {"login": "abhipsaMisra"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceOperations.java", "diffHunk": "@@ -141,9 +144,94 @@ public static HttpResponse request(\n     }\n \n     /**\n-     * Sets headers to be used on next HTTP request\n-     * @param httpHeaders non null and non empty custom headers\n-     * @throws IllegalArgumentException This exception is thrown if headers were null or empty\n+     * Send a http request to the IoTHub using the Twin/Method standard, and return its response.\n+     *\n+     * @param iotHubConnectionString is the connection string for the IoTHub.\n+     * @param url is the Twin URL for the device ID.\n+     * @param method is the HTTP method (GET, POST, DELETE, PATCH, PUT).\n+     * @param payload is the array of bytes that contains the payload.\n+     * @param requestId is an unique number that identify the request.\n+     * @param connectTimeout the http connect timeout to use, in milliseconds.\n+     * @param readTimeout the http read timeout to use, in milliseconds.\n+     * @param proxy the proxy to use, or null if no proxy will be used.\n+     * @return the result of the request.\n+     * @throws IotHubException This exception is thrown if the response verification failed.\n+     * @throws IOException This exception is thrown if the IO operation failed.\n+     */\n+    public static HttpResponse request(\n+            IotHubConnectionString iotHubConnectionString,\n+            URL url,\n+            HttpMethod method,\n+            byte[] payload,\n+            String requestId,\n+            int connectTimeout,\n+            int readTimeout,\n+            Proxy proxy)\n+            throws IOException, IotHubException, IllegalArgumentException\n+    {\n+        if (iotHubConnectionString == null)\n+        {\n+            throw new IllegalArgumentException(\"Null ConnectionString\");\n+        }\n+\n+        if (url == null)\n+        {\n+            throw new IllegalArgumentException(\"Null URL\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7da0f8d9531a021eab767e244234ed44e22c5b85"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTIzMTkx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-464523191", "createdAt": "2020-08-10T19:38:17Z", "commit": {"oid": "7da0f8d9531a021eab767e244234ed44e22c5b85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTozODoxN1rOG-c0lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTozODoxN1rOG-c0lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEzNzExMA==", "bodyText": "Q - haven't seen this before! Do we have a sample/ test on how these non-sql queries are used?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#discussion_r468137110", "createdAt": "2020-08-10T19:38:17Z", "author": {"login": "abhipsaMisra"}, "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/QueryCollection.java", "diffHunk": "@@ -116,14 +127,86 @@ protected QueryCollection(int pageSize, QueryType requestQueryType, IotHubConnec\n         this.isInitialQuery = true;\n     }\n \n+    /**\n+     * Constructor for sql based queries\n+     *\n+     * @param query the sql query to use.\n+     * @param pageSize the size of the page to return per query collection response.\n+     * @param requestQueryType the type of query this is.\n+     * @param iotHubConnectionString the connection string to connect with to query against.\n+     * @param url the url to query against.\n+     * @param httpMethod the http method to call with the query.\n+     * @param httpConnectTimeout the http connect timeout to use.\n+     * @param httpReadTimeout the http read timeout to use.\n+     * @throws IllegalArgumentException if page size is 0 or negative, or if the query type is null or unknown, of if the query string is null or empty,\n+     *  or if the provided connection string is null, or if the provided url is null, or if the provided http method is null.\n+     */\n+    protected QueryCollection(String query, int pageSize, QueryType requestQueryType, IotHubConnectionString iotHubConnectionString, URL url, HttpMethod httpMethod, int httpConnectTimeout, int httpReadTimeout, Proxy proxy)\n+    {\n+        this.validateQueryRequestArguments(iotHubConnectionString, url, httpMethod, pageSize, requestQueryType);\n+\n+        ParserUtility.validateQuery(query);\n+\n+        this.pageSize = pageSize;\n+        this.query = query;\n+        this.requestQueryType = requestQueryType;\n+        this.iotHubConnectionString = iotHubConnectionString;\n+        this.responseContinuationToken = null;\n+        this.httpMethod = httpMethod;\n+        this.httpConnectTimeout = httpConnectTimeout;\n+        this.httpReadTimeout = httpReadTimeout;\n+        this.proxy = proxy;\n+        this.url = url;\n+        this.responseQueryType = QueryType.UNKNOWN;\n+\n+        this.isSqlQuery = true;\n+\n+        this.isInitialQuery = true;\n+    }\n+\n+    /**\n+     * Constructor for non-sql based queries.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7da0f8d9531a021eab767e244234ed44e22c5b85"}, "originalPosition": 137}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTIzODUx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-464523851", "createdAt": "2020-08-10T19:39:16Z", "commit": {"oid": "7da0f8d9531a021eab767e244234ed44e22c5b85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7030a4be028676b95b07d49e512d62d27ffbf4b4", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7030a4be028676b95b07d49e512d62d27ffbf4b4", "committedDate": "2020-08-13T20:54:37Z", "message": "cr comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5ODQ2NjQ1", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/878#pullrequestreview-469846645", "createdAt": "2020-08-18T21:34:03Z", "commit": {"oid": "7030a4be028676b95b07d49e512d62d27ffbf4b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e79b4ed1ae0199e3485140e8de4f7a573497e22e", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e79b4ed1ae0199e3485140e8de4f7a573497e22e", "committedDate": "2020-08-18T21:34:31Z", "message": "Merge branch 'master' into timtay/httpTimeouts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1770, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}