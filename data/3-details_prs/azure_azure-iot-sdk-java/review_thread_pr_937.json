{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNjM5MjE1", "number": 937, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNzo0ODowNFrOEn9iKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTo0MzoxOVrOEoO5Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzM4MDkwOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNzo0ODowNFrOHYyIsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNzo0ODowNFrOHYyIsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc0OTI5Ng==", "bodyText": "nit: change prefix to DigitalTwinClientE2ETests, or DigitalTwinServiceClientTests_ to match file name", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r495749296", "createdAt": "2020-09-28T07:48:04Z", "author": {"login": "barustum"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,90 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Rule;\n import org.junit.Test;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator.TestDigitalTwinDevice;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n+@Slf4j\n+@RunWith(Parameterized.class)\n public class DigitalTwinServiceClientTests {\n \n+    protected static String iotHubConnectionString = \"\";\n+    private TestDigitalTwinDevice testDevice;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinE2ETests_\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQ0MTQ5OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNjozNVrOHZFgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTozMDo0MVrOHZMpUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2Njc1OQ==", "bodyText": "Would suggest renaming to DigitalTwinTestDevice", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496066759", "createdAt": "2020-09-28T16:06:35Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3MTA3NA==", "bodyText": "On another note, we should just reuse this - TwinPnPTestInstance that already exists.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496071074", "createdAt": "2020-09-28T16:13:21Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2Njc1OQ=="}, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4MzYzNA==", "bodyText": "refactored some code and do not need the other class anymore", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496183634", "createdAt": "2020-09-28T19:30:41Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2Njc1OQ=="}, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQ0NDg2OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNzoyNlrOHZFi8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTozMTozMVrOHZMq4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2NzMxMg==", "bodyText": "nit - Everywhere else (samples) we are using this - IOTHUB_CONNECTON_STRING so we can follow that convention.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496067312", "createdAt": "2020-09-28T16:07:26Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {\n+    private static final String IOT_HUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4NDAzMg==", "bodyText": "Done", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496184032", "createdAt": "2020-09-28T19:31:31Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {\n+    private static final String IOT_HUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2NzMxMg=="}, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQ1MDAzOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowODo1NVrOHZFmRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowODo1NVrOHZFmRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2ODE2Nw==", "bodyText": "Do we need to register a callback at all for change of status? We will mostly need something for commands though.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496068167", "createdAt": "2020-09-28T16:08:55Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {\n+    private static final String IOT_HUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);\n+\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+\n+    public TestDigitalTwinDevice(@NonNull String deviceId, @NonNull IotHubClientProtocol protocol) throws IotHubException, IOException, URISyntaxException {\n+        if (!protocol.equals(IotHubClientProtocol.MQTT) && !protocol.equals(IotHubClientProtocol.MQTT_WS)) {\n+            throw new IllegalArgumentException(\"Supported protocols for DigitalTwin are MQTT, MQTT_WS\");\n+        }\n+            this.deviceId = deviceId;\n+            this.deviceClient = createDeviceClient(protocol);\n+            this.deviceClient.registerConnectionStatusChangeCallback((iotHubConnectionStatus, iotHubConnectionStatusChangeReason, throwable, o) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQ3NjQxOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoxNTowOFrOHZF2Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoxNTowOFrOHZF2Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3MjE5OQ==", "bodyText": "We won't need to add @Afte in this file if we reuse TwinPnPTestInstance  but we should try to use things like - @after and @before for setup and cleanup", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496072199", "createdAt": "2020-09-28T16:15:08Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {\n+    private static final String IOT_HUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);\n+\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+\n+    public TestDigitalTwinDevice(@NonNull String deviceId, @NonNull IotHubClientProtocol protocol) throws IotHubException, IOException, URISyntaxException {\n+        if (!protocol.equals(IotHubClientProtocol.MQTT) && !protocol.equals(IotHubClientProtocol.MQTT_WS)) {\n+            throw new IllegalArgumentException(\"Supported protocols for DigitalTwin are MQTT, MQTT_WS\");\n+        }\n+            this.deviceId = deviceId;\n+            this.deviceClient = createDeviceClient(protocol);\n+            this.deviceClient.registerConnectionStatusChangeCallback((iotHubConnectionStatus, iotHubConnectionStatusChangeReason, throwable, o) -> {\n+                TestDigitalTwinDevice testDigitalTwinDevice = (TestDigitalTwinDevice) o;\n+                log.debug(\"DeviceID={}; status={}, reason={}\", testDigitalTwinDevice.getDeviceId(), iotHubConnectionStatus, iotHubConnectionStatusChangeReason);\n+            }, this);\n+            log.debug(\"Created device: {}\", deviceId);\n+        }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        RegistryManager registryManager = RegistryManager.createFromConnectionString(IOT_HUB_CONNECTION_STRING);\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.MODEL_ID);\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        registryManager.close();\n+\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    public void closeAndDeleteDevice() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQ4ODgwOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoxNzo1NVrOHZF9aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoxNzo1NVrOHZF9aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3NDA4OQ==", "bodyText": "We should create just one static instance of registryManager and use that.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496074089", "createdAt": "2020-09-28T16:17:55Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {\n+    private static final String IOT_HUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);\n+\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+\n+    public TestDigitalTwinDevice(@NonNull String deviceId, @NonNull IotHubClientProtocol protocol) throws IotHubException, IOException, URISyntaxException {\n+        if (!protocol.equals(IotHubClientProtocol.MQTT) && !protocol.equals(IotHubClientProtocol.MQTT_WS)) {\n+            throw new IllegalArgumentException(\"Supported protocols for DigitalTwin are MQTT, MQTT_WS\");\n+        }\n+            this.deviceId = deviceId;\n+            this.deviceClient = createDeviceClient(protocol);\n+            this.deviceClient.registerConnectionStatusChangeCallback((iotHubConnectionStatus, iotHubConnectionStatusChangeReason, throwable, o) -> {\n+                TestDigitalTwinDevice testDigitalTwinDevice = (TestDigitalTwinDevice) o;\n+                log.debug(\"DeviceID={}; status={}, reason={}\", testDigitalTwinDevice.getDeviceId(), iotHubConnectionStatus, iotHubConnectionStatusChangeReason);\n+            }, this);\n+            log.debug(\"Created device: {}\", deviceId);\n+        }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        RegistryManager registryManager = RegistryManager.createFromConnectionString(IOT_HUB_CONNECTION_STRING);\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.MODEL_ID);\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        registryManager.close();\n+\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    public void closeAndDeleteDevice() {\n+        try {\n+            deviceClient.closeNow();\n+\n+            RegistryManager registryManager = RegistryManager.createFromConnectionString(IOT_HUB_CONNECTION_STRING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQ5MTI4OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoxODozMFrOHZF-5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTozMzoyOVrOHZMu2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3NDQ3MA==", "bodyText": "We should also add an assert that this test failed.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496074470", "createdAt": "2020-09-28T16:18:30Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {\n+    private static final String IOT_HUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);\n+\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+\n+    public TestDigitalTwinDevice(@NonNull String deviceId, @NonNull IotHubClientProtocol protocol) throws IotHubException, IOException, URISyntaxException {\n+        if (!protocol.equals(IotHubClientProtocol.MQTT) && !protocol.equals(IotHubClientProtocol.MQTT_WS)) {\n+            throw new IllegalArgumentException(\"Supported protocols for DigitalTwin are MQTT, MQTT_WS\");\n+        }\n+            this.deviceId = deviceId;\n+            this.deviceClient = createDeviceClient(protocol);\n+            this.deviceClient.registerConnectionStatusChangeCallback((iotHubConnectionStatus, iotHubConnectionStatusChangeReason, throwable, o) -> {\n+                TestDigitalTwinDevice testDigitalTwinDevice = (TestDigitalTwinDevice) o;\n+                log.debug(\"DeviceID={}; status={}, reason={}\", testDigitalTwinDevice.getDeviceId(), iotHubConnectionStatus, iotHubConnectionStatusChangeReason);\n+            }, this);\n+            log.debug(\"Created device: {}\", deviceId);\n+        }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        RegistryManager registryManager = RegistryManager.createFromConnectionString(IOT_HUB_CONNECTION_STRING);\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.MODEL_ID);\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        registryManager.close();\n+\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    public void closeAndDeleteDevice() {\n+        try {\n+            deviceClient.closeNow();\n+\n+            RegistryManager registryManager = RegistryManager.createFromConnectionString(IOT_HUB_CONNECTION_STRING);\n+            registryManager.removeDevice(deviceId);\n+            registryManager.close();\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4NTA1MA==", "bodyText": "Test hasn't failed this is actually just deleting device as part of cleanup", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496185050", "createdAt": "2020-09-28T19:33:29Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/simulator/TestDigitalTwinDevice.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.simulator;\n+\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.extern.slf4j.Slf4j;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+\n+@Slf4j\n+@Getter\n+public class TestDigitalTwinDevice {\n+    private static final String IOT_HUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);\n+\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+\n+    public TestDigitalTwinDevice(@NonNull String deviceId, @NonNull IotHubClientProtocol protocol) throws IotHubException, IOException, URISyntaxException {\n+        if (!protocol.equals(IotHubClientProtocol.MQTT) && !protocol.equals(IotHubClientProtocol.MQTT_WS)) {\n+            throw new IllegalArgumentException(\"Supported protocols for DigitalTwin are MQTT, MQTT_WS\");\n+        }\n+            this.deviceId = deviceId;\n+            this.deviceClient = createDeviceClient(protocol);\n+            this.deviceClient.registerConnectionStatusChangeCallback((iotHubConnectionStatus, iotHubConnectionStatusChangeReason, throwable, o) -> {\n+                TestDigitalTwinDevice testDigitalTwinDevice = (TestDigitalTwinDevice) o;\n+                log.debug(\"DeviceID={}; status={}, reason={}\", testDigitalTwinDevice.getDeviceId(), iotHubConnectionStatus, iotHubConnectionStatusChangeReason);\n+            }, this);\n+            log.debug(\"Created device: {}\", deviceId);\n+        }\n+\n+    private DeviceClient createDeviceClient(IotHubClientProtocol protocol) throws IOException, IotHubException, URISyntaxException {\n+        RegistryManager registryManager = RegistryManager.createFromConnectionString(IOT_HUB_CONNECTION_STRING);\n+        ClientOptions options = new ClientOptions();\n+        options.setModelId(E2ETestConstants.MODEL_ID);\n+        Device device = Device.createDevice(deviceId, AuthenticationType.SAS);\n+        Device registeredDevice = registryManager.addDevice(device);\n+        String deviceConnectionString = registryManager.getDeviceConnectionString(registeredDevice);\n+        registryManager.close();\n+\n+        return new DeviceClient(deviceConnectionString, protocol, options);\n+    }\n+\n+    public void closeAndDeleteDevice() {\n+        try {\n+            deviceClient.closeNow();\n+\n+            RegistryManager registryManager = RegistryManager.createFromConnectionString(IOT_HUB_CONNECTION_STRING);\n+            registryManager.removeDevice(deviceId);\n+            registryManager.close();\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3NDQ3MA=="}, "originalCommit": {"oid": "5c1dd786112a27a6704fb990654b19323096931c"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNjIxMzgwOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTozOTo1NFrOHZM7kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTo1OTowMVrOHZNiqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4ODMwNQ==", "bodyText": "Do we need this?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496188305", "createdAt": "2020-09-28T19:39:54Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,126 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n-import org.junit.Test;\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n-public class DigitalTwinServiceClientTests {\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinServiceClientTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+    public TwinPnPTests.TwinPnPTestInstance testInstance;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16adbeaa63d65f73dd100e0afde7b8f44ea3d666"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE5ODMxMw==", "bodyText": "Good catch removed", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496198313", "createdAt": "2020-09-28T19:59:01Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,126 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n-import org.junit.Test;\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n-public class DigitalTwinServiceClientTests {\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinServiceClientTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+    public TwinPnPTests.TwinPnPTestInstance testInstance;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4ODMwNQ=="}, "originalCommit": {"oid": "16adbeaa63d65f73dd100e0afde7b8f44ea3d666"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNjIyMjgyOnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTo0Mjo0MVrOHZNBLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMDowMTo0OFrOHZNoLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4OTc0Mg==", "bodyText": "Remove registryManager.close(); - This should only be done in @afterclass - line 99", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496189742", "createdAt": "2020-09-28T19:42:41Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,126 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n-import org.junit.Test;\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n-public class DigitalTwinServiceClientTests {\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinServiceClientTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+    public TwinPnPTests.TwinPnPTestInstance testInstance;\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        DigitalTwinAsyncClient asyncClient = new DigitalTwinAsyncClient(IOTHUB_CONNECTION_STRING);\n+        digitalTwinClient = new DigitalTwinClient(asyncClient);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+            registryManager.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16adbeaa63d65f73dd100e0afde7b8f44ea3d666"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE5OTcyNA==", "bodyText": "Totally agree. Fixed it", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496199724", "createdAt": "2020-09-28T20:01:48Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,126 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n-import org.junit.Test;\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n-public class DigitalTwinServiceClientTests {\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinServiceClientTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+    public TwinPnPTests.TwinPnPTestInstance testInstance;\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        DigitalTwinAsyncClient asyncClient = new DigitalTwinAsyncClient(IOTHUB_CONNECTION_STRING);\n+        digitalTwinClient = new DigitalTwinClient(asyncClient);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+            registryManager.close();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE4OTc0Mg=="}, "originalCommit": {"oid": "16adbeaa63d65f73dd100e0afde7b8f44ea3d666"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNjIyNDk5OnYy", "diffSide": "RIGHT", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxOTo0MzoxOVrOHZNChg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMDowNzo1OFrOHZN0Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE5MDA4Ng==", "bodyText": "We should add assert.False and fail the test.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496190086", "createdAt": "2020-09-28T19:43:19Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,126 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n-import org.junit.Test;\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n-public class DigitalTwinServiceClientTests {\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinServiceClientTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+    public TwinPnPTests.TwinPnPTestInstance testInstance;\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        DigitalTwinAsyncClient asyncClient = new DigitalTwinAsyncClient(IOTHUB_CONNECTION_STRING);\n+        digitalTwinClient = new DigitalTwinClient(asyncClient);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+            registryManager.close();\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16adbeaa63d65f73dd100e0afde7b8f44ea3d666"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE5ODczMA==", "bodyText": "This one's not really part of test. It should be fine if registrymanager could not delete one device since we are mainly testing service client", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496198730", "createdAt": "2020-09-28T19:59:47Z", "author": {"login": "bikamani"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,126 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n-import org.junit.Test;\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n-public class DigitalTwinServiceClientTests {\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinServiceClientTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+    public TwinPnPTests.TwinPnPTestInstance testInstance;\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        DigitalTwinAsyncClient asyncClient = new DigitalTwinAsyncClient(IOTHUB_CONNECTION_STRING);\n+        digitalTwinClient = new DigitalTwinClient(asyncClient);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+            registryManager.close();\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE5MDA4Ng=="}, "originalCommit": {"oid": "16adbeaa63d65f73dd100e0afde7b8f44ea3d666"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIwMjc5NQ==", "bodyText": "Yes but we want to know that our cleanup is failing. That is the pattern we follow everywhere. Update it in another PR.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/937#discussion_r496202795", "createdAt": "2020-09-28T20:07:58Z", "author": {"login": "vinagesh"}, "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -1,38 +1,126 @@\n package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;\n \n-import com.microsoft.azure.sdk.iot.device.exceptions.TransportException;\n-import org.junit.Test;\n+import com.microsoft.azure.sdk.iot.device.ClientOptions;\n+import com.microsoft.azure.sdk.iot.device.DeviceClient;\n+import com.microsoft.azure.sdk.iot.device.IotHubClientProtocol;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinAsyncClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.DigitalTwinClient;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.BasicDigitalTwin;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import lombok.extern.slf4j.Slf4j;\n+import org.junit.*;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.digitaltwin.helpers.E2ETestConstants;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.IntegrationTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.DigitalTwinTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.iothub.twin.TwinPnPTests;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collection;\n+import java.util.UUID;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n \n @DigitalTwinTest\n-public class DigitalTwinServiceClientTests {\n+@Slf4j\n+@RunWith(Parameterized.class)\n+public class DigitalTwinServiceClientTests extends IntegrationTest\n+{\n+\n+    private static final String IOTHUB_CONNECTION_STRING = Tools.retrieveEnvironmentVariableValue(E2ETestConstants.IOTHUB_CONNECTION_STRING_ENV_VAR_NAME);\n+    private static RegistryManager registryManager;\n+    private String deviceId;\n+    private DeviceClient deviceClient;\n+    private DigitalTwinClient digitalTwinClient = null;\n+    private static final String DEVICE_ID_PREFIX = \"DigitalTwinServiceClientTests_\";\n+    public TwinPnPTests.TwinPnPTestInstance testInstance;\n+\n+    @Rule\n+    public Timeout globalTimeout = Timeout.seconds(5 * 60); // 5 minutes max per method tested\n+\n+    @Parameterized.Parameter(0)\n+    public IotHubClientProtocol protocol;\n+\n+    @Parameterized.Parameters(name = \"{index}: Digital Twin Test: protocol={0}\")\n+    public static Collection<Object[]> data() {\n+        return asList(new Object[][] {\n+                {MQTT},\n+                {MQTT_WS},\n+        });\n+    }\n+\n+    @BeforeClass\n+    public static void setUpBeforeClass() throws IOException {\n+        registryManager = RegistryManager.createFromConnectionString(IOTHUB_CONNECTION_STRING);\n+    }\n+\n+    @Before\n+    public void setUp() throws URISyntaxException, IOException, IotHubException {\n+\n+        this.deviceClient = createDeviceClient(protocol);\n+        deviceClient.open();\n+        DigitalTwinAsyncClient asyncClient = new DigitalTwinAsyncClient(IOTHUB_CONNECTION_STRING);\n+        digitalTwinClient = new DigitalTwinClient(asyncClient);\n+    }\n+\n+    @After\n+    public void cleanUp() {\n+        try {\n+            deviceClient.closeNow();\n+            registryManager.removeDevice(deviceId);\n+            registryManager.close();\n+        } catch (Exception ex) {\n+            log.error(\"An exception occurred while closing/ deleting the device {}: {}\", deviceId, ex);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE5MDA4Ng=="}, "originalCommit": {"oid": "16adbeaa63d65f73dd100e0afde7b8f44ea3d666"}, "originalPosition": 86}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2711, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}