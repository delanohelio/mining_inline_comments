{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MDEwMTY1", "number": 891, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToxNDo0OVrOEXzUww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzo0Mjo1NFrOEX1jjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzkzNjAzOnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToxNDo0OVrOG_zHvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToyNzoyOVrOG_ze4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1MTAzNw==", "bodyText": "Can you point to where it is handled?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/891#discussion_r469551037", "createdAt": "2020-08-12T21:14:49Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -151,11 +151,6 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n                 //Codes_SRS_HTTPSIOTHUBCONNECTION_34_067: [If the response from the service is OK or OK_EMPTY, this function shall notify its listener that a message was sent with no exception.]\n                 this.listener.onMessageSent(transportMessage, null);\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4bab570b6b89c5be8e9c44ff4b4a4f4464afc95"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1MTMyNg==", "bodyText": "Never mind. Should have read description earlier :)", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/891#discussion_r469551326", "createdAt": "2020-08-12T21:15:22Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -151,11 +151,6 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n                 //Codes_SRS_HTTPSIOTHUBCONNECTION_34_067: [If the response from the service is OK or OK_EMPTY, this function shall notify its listener that a message was sent with no exception.]\n                 this.listener.onMessageSent(transportMessage, null);\n             }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1MTAzNw=="}, "originalCommit": {"oid": "a4bab570b6b89c5be8e9c44ff4b4a4f4464afc95"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1MjI1Ng==", "bodyText": "Sure, I can add a note that non-200 codes have their exceptions handled in the transport layer", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/891#discussion_r469552256", "createdAt": "2020-08-12T21:17:26Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -151,11 +151,6 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n                 //Codes_SRS_HTTPSIOTHUBCONNECTION_34_067: [If the response from the service is OK or OK_EMPTY, this function shall notify its listener that a message was sent with no exception.]\n                 this.listener.onMessageSent(transportMessage, null);\n             }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1MTAzNw=="}, "originalCommit": {"oid": "a4bab570b6b89c5be8e9c44ff4b4a4f4464afc95"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1Njk2Mg==", "bodyText": "That would be good", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/891#discussion_r469556962", "createdAt": "2020-08-12T21:27:29Z", "author": {"login": "vinagesh"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -151,11 +151,6 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n                 //Codes_SRS_HTTPSIOTHUBCONNECTION_34_067: [If the response from the service is OK or OK_EMPTY, this function shall notify its listener that a message was sent with no exception.]\n                 this.listener.onMessageSent(transportMessage, null);\n             }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1MTAzNw=="}, "originalCommit": {"oid": "a4bab570b6b89c5be8e9c44ff4b4a4f4464afc95"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNDMwMTU4OnYy", "diffSide": "RIGHT", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzo0Mjo1NFrOG_2iTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMzo1MDoyNFrOG_2rQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwNjk4OQ==", "bodyText": "so is it throwing exception at both layers currently?", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/891#discussion_r469606989", "createdAt": "2020-08-12T23:42:54Z", "author": {"login": "bikamani"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -173,11 +173,9 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n                 //Codes_SRS_HTTPSIOTHUBCONNECTION_34_067: [If the response from the service is OK or OK_EMPTY, this function shall notify its listener that a message was sent with no exception.]\n                 this.listener.onMessageSent(transportMessage, null);\n             }\n-            else\n-            {\n-                //Codes_SRS_HTTPSIOTHUBCONNECTION_34_068: [If the response from the service not OK or OK_EMPTY, this function shall notify its listener that a message was with the mapped IotHubServiceException.]\n-                this.listener.onMessageSent(transportMessage, IotHubStatusCode.getConnectionStatusException(status, \"\"));\n-            }\n+\n+            // Status codes other than 200 and 204 have their errors handled in the IotHubTransport layer once this method returns,\n+            // so there is no need to call \"this.listener.onMessageSent(transportMessage, someException)\" from this layer.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66c3061b1bae6b88895d8d60228a8390e8598deb"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwOTI4MA==", "bodyText": "Currently, the transport layer basically gets notified that the sent message failed twice. The first handling of the failed message works as expected, but the second handling fails because the message is already removed from the expected list and has already had its callback executed.", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/891#discussion_r469609280", "createdAt": "2020-08-12T23:50:24Z", "author": {"login": "timtay-microsoft"}, "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsIotHubConnection.java", "diffHunk": "@@ -173,11 +173,9 @@ public IotHubStatusCode sendMessage(Message message) throws TransportException\n                 //Codes_SRS_HTTPSIOTHUBCONNECTION_34_067: [If the response from the service is OK or OK_EMPTY, this function shall notify its listener that a message was sent with no exception.]\n                 this.listener.onMessageSent(transportMessage, null);\n             }\n-            else\n-            {\n-                //Codes_SRS_HTTPSIOTHUBCONNECTION_34_068: [If the response from the service not OK or OK_EMPTY, this function shall notify its listener that a message was with the mapped IotHubServiceException.]\n-                this.listener.onMessageSent(transportMessage, IotHubStatusCode.getConnectionStatusException(status, \"\"));\n-            }\n+\n+            // Status codes other than 200 and 204 have their errors handled in the IotHubTransport layer once this method returns,\n+            // so there is no need to call \"this.listener.onMessageSent(transportMessage, someException)\" from this layer.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYwNjk4OQ=="}, "originalCommit": {"oid": "66c3061b1bae6b88895d8d60228a8390e8598deb"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2674, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}