{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwNjgxMDU2", "number": 670, "title": "Refactor build gate to cut down on unnecessary testing", "bodyText": "This PR allows the gate to be smart enough to not run e2e tests if the only code changes were .md files\nIt also allows the gate to be smart enough to only run provisioning tests if only provisioning code was changed.\nChanges to IoT Hub code (device client, service client, or deps) will still require all e2e tests to be run.\nSome simple assumptions were made in these scripts:\n\nAny file change that contains \"provisioning\" in its path constitutes a change in the provisioning SDK\nAny file change that contains \"iothub\", \"deps\", \"iot-device-client\" or \"iot-service-client\" in its path constitutes a change in the iothub SDK\nAny file change that falls under common test helpers (i.e. proxy logic, android test group declarations) will require all e2e tests to be run because they may be used in any e2e test\n\nAll e2e test files were moved in order to fit these assumptions. The majority of the files changed in this PR are tied to this move, and are all contained in one commit. The other two commits are more worth reviewing", "createdAt": "2020-01-08T22:18:57Z", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/670", "merged": true, "mergeCommit": {"oid": "ebf8b4b353b70c7f76b4379428b1402860860498"}, "closed": true, "closedAt": "2020-01-15T23:10:58Z", "author": {"login": "timtay-microsoft"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4c9wWgBqjI5MzI5Mjg3MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6reJbgH2gAyMzYwNjgxMDU2OjVmOTZmMGQwOTEwOTUwNWMxNzUxN2UxMGQzNzkxYWM3NjNiNTI2NzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fc79237e2ad453e6ffc5fa193ae4878c188f8be", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/4fc79237e2ad453e6ffc5fa193ae4878c188f8be", "committedDate": "2020-01-08T22:12:03Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}, "afterCommit": {"oid": "45c3b90deb2ded293ff6dee440b807ded4a4e6c8", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/45c3b90deb2ded293ff6dee440b807ded4a4e6c8", "committedDate": "2020-01-08T22:19:18Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45c3b90deb2ded293ff6dee440b807ded4a4e6c8", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/45c3b90deb2ded293ff6dee440b807ded4a4e6c8", "committedDate": "2020-01-08T22:19:18Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}, "afterCommit": {"oid": "868d1714a49b0f0713ffb633649736ac1a688068", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/868d1714a49b0f0713ffb633649736ac1a688068", "committedDate": "2020-01-08T22:36:30Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "868d1714a49b0f0713ffb633649736ac1a688068", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/868d1714a49b0f0713ffb633649736ac1a688068", "committedDate": "2020-01-08T22:36:30Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}, "afterCommit": {"oid": "86492c99d690f3135ae3930a5594a777ea7b0c01", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/86492c99d690f3135ae3930a5594a777ea7b0c01", "committedDate": "2020-01-08T22:36:55Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86492c99d690f3135ae3930a5594a777ea7b0c01", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/86492c99d690f3135ae3930a5594a777ea7b0c01", "committedDate": "2020-01-08T22:36:55Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}, "afterCommit": {"oid": "145f2f35b9460122cb26369473e0f2b1ebba60f3", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/145f2f35b9460122cb26369473e0f2b1ebba60f3", "committedDate": "2020-01-09T20:02:51Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "145f2f35b9460122cb26369473e0f2b1ebba60f3", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/145f2f35b9460122cb26369473e0f2b1ebba60f3", "committedDate": "2020-01-09T20:02:51Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}, "afterCommit": {"oid": "f716e967ff2687d7e7bb3566c1003e468607bbd7", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/f716e967ff2687d7e7bb3566c1003e468607bbd7", "committedDate": "2020-01-13T18:52:19Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96bc4d6a36ef86727cfdf49dcd8647d8fbd53250", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/96bc4d6a36ef86727cfdf49dcd8647d8fbd53250", "committedDate": "2020-01-14T19:29:53Z", "message": "refactor(e2e): Move all e2e test code into provisioning/iothub folder structure\n\nAll iothub tests must have iothub in the path somewhere, likewise for provisioning"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f716e967ff2687d7e7bb3566c1003e468607bbd7", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/f716e967ff2687d7e7bb3566c1003e468607bbd7", "committedDate": "2020-01-13T18:52:19Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}, "afterCommit": {"oid": "556233ebeb7c183f533e74cd2740aee97a21f83c", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/556233ebeb7c183f533e74cd2740aee97a21f83c", "committedDate": "2020-01-14T19:29:53Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMDE4ODU0", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/670#pullrequestreview-343018854", "createdAt": "2020-01-15T07:03:31Z", "commit": {"oid": "5f1706c1bb2f8ae8d0d2492319f414578b810aac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwNzowMzozMVrOFdu2AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwNzowMzozMVrOFdu2AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjcyMDUxMw==", "bodyText": "Nit: this wording is a bit confusing, can be reworded into something along the lines of:\nIf it is an iot hub test, will skip the test when told to skip iot hub tests", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/670#discussion_r366720513", "createdAt": "2020-01-15T07:03:31Z", "author": {"login": "abhipsaMisra"}, "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/IntegrationTest.java", "diffHunk": "@@ -37,4 +40,27 @@ protected void finished(Description description)\n     public Timeout timeout = new Timeout(E2E_TEST_TIMEOUT_MS);\n \n     public static boolean isBasicTierHub;\n+\n+    //By default, run all tests. Even if env vars aren't set\n+    public static boolean runIotHubTests = Boolean.parseBoolean(Tools.retrieveEnvironmentVariableValue(\"RUN_IOTHUB_TESTS\", \"true\"));\n+    public static boolean runProvisioningTests = Boolean.parseBoolean(Tools.retrieveEnvironmentVariableValue(\"RUN_PROVISIONING_TESTS\", \"true\"));\n+\n+    public abstract boolean isProvisioningTest();\n+    public abstract boolean isIotHubTest();\n+\n+    @Before\n+    public void checkIfTestShouldBeRun()\n+    {\n+        if (isIotHubTest())\n+        {\n+            //Will skip the test if it is an iot hub test when told to skip iot hub tests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f1706c1bb2f8ae8d0d2492319f414578b810aac"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f94feca80c91660226253ae7dda5c5110475b8f", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/2f94feca80c91660226253ae7dda5c5110475b8f", "committedDate": "2020-01-15T19:07:28Z", "message": "refactor(e2e): Add iothub and provisioning integration test class\n\nAll integration tests now extend from either ProvisioningIntegrationTest or IotHubIntegrationTest for the purposes of setting up the build pipeline to only run provisioning and/or iothub tests as needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "183bbbc6b0b40ac3ce077d28e79fa0615884a408", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/183bbbc6b0b40ac3ce077d28e79fa0615884a408", "committedDate": "2020-01-15T19:07:28Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "556233ebeb7c183f533e74cd2740aee97a21f83c", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/556233ebeb7c183f533e74cd2740aee97a21f83c", "committedDate": "2020-01-14T19:29:53Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}, "afterCommit": {"oid": "183bbbc6b0b40ac3ce077d28e79fa0615884a408", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/183bbbc6b0b40ac3ce077d28e79fa0615884a408", "committedDate": "2020-01-15T19:07:28Z", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDYxNjgx", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/670#pullrequestreview-343461681", "createdAt": "2020-01-15T19:22:59Z", "commit": {"oid": "183bbbc6b0b40ac3ce077d28e79fa0615884a408"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f96f0d09109505c17517e10d3791ac763b52671", "author": {"user": {"login": "timtay-microsoft", "name": null}}, "url": "https://github.com/Azure/azure-iot-sdk-java/commit/5f96f0d09109505c17517e10d3791ac763b52671", "committedDate": "2020-01-15T20:21:23Z", "message": "Merge branch 'master' into smartGate"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1785, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}