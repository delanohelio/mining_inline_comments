{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxNzk0Mjk0", "number": 15136, "title": "Warn on logical operators AND and OR expressions without explicit parenthesization ", "bodyText": "Test plan - Tested locally\nAdded test cases to check is any warnings were thrown in TestWarnings.java\nFixes:\nIssue: #15106\nIssue: #15105\n== NO RELEASE NOTE ==", "createdAt": "2020-09-08T05:59:46Z", "url": "https://github.com/prestodb/presto/pull/15136", "merged": true, "mergeCommit": {"oid": "5bdb41d3c8d003290affac6f179b030b9de41a20"}, "closed": true, "closedAt": "2020-09-16T20:11:17Z", "author": {"login": "ankit0811"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGxfrmABqjM3MzkyNDYyNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJSUlsABqjM3NzA5NjU0MjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f0272d1a859cf8d3f77037c17cf57e2ff0bae36", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/8f0272d1a859cf8d3f77037c17cf57e2ff0bae36", "committedDate": "2020-09-08T05:56:57Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}, "afterCommit": {"oid": "85af18e254294c7bdb887fd9fc303d29ee7d3688", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/85af18e254294c7bdb887fd9fc303d29ee7d3688", "committedDate": "2020-09-08T06:20:05Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85af18e254294c7bdb887fd9fc303d29ee7d3688", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/85af18e254294c7bdb887fd9fc303d29ee7d3688", "committedDate": "2020-09-08T06:20:05Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}, "afterCommit": {"oid": "68c780c9c52c45f7d7e1266d7f86a07908833632", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/68c780c9c52c45f7d7e1266d7f86a07908833632", "committedDate": "2020-09-09T07:46:47Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68c780c9c52c45f7d7e1266d7f86a07908833632", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/68c780c9c52c45f7d7e1266d7f86a07908833632", "committedDate": "2020-09-09T07:46:47Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}, "afterCommit": {"oid": "e867ac044b6530baab9c6bcc53ceff55af007f47", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/e867ac044b6530baab9c6bcc53ceff55af007f47", "committedDate": "2020-09-09T08:22:39Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e867ac044b6530baab9c6bcc53ceff55af007f47", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/e867ac044b6530baab9c6bcc53ceff55af007f47", "committedDate": "2020-09-09T08:22:39Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}, "afterCommit": {"oid": "b66bea1bfdd743f33f00514d8c09d4b78b3df5a2", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/b66bea1bfdd743f33f00514d8c09d4b78b3df5a2", "committedDate": "2020-09-10T03:14:36Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b66bea1bfdd743f33f00514d8c09d4b78b3df5a2", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/b66bea1bfdd743f33f00514d8c09d4b78b3df5a2", "committedDate": "2020-09-10T03:14:36Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}, "afterCommit": {"oid": "7f6aef69f36e76ca0489fd3386b2dfcec52a6721", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/7f6aef69f36e76ca0489fd3386b2dfcec52a6721", "committedDate": "2020-09-10T04:07:46Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f6aef69f36e76ca0489fd3386b2dfcec52a6721", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/7f6aef69f36e76ca0489fd3386b2dfcec52a6721", "committedDate": "2020-09-10T04:07:46Z", "message": "Exposing WarningCollector in SqlParser and AstBuilder class"}, "afterCommit": {"oid": "468f683620c6d513c3541aaddc52bc1f8629be51", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/468f683620c6d513c3541aaddc52bc1f8629be51", "committedDate": "2020-09-12T00:47:02Z", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTI1NTkw", "url": "https://github.com/prestodb/presto/pull/15136#pullrequestreview-489125590", "createdAt": "2020-09-15T21:37:04Z", "commit": {"oid": "468f683620c6d513c3541aaddc52bc1f8629be51"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMTozNzowNVrOHSVeOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMTozNzoyNVrOHSVfUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4ODIxNw==", "bodyText": "We normally use expression instanceof LogicalBinaryExpression.", "url": "https://github.com/prestodb/presto/pull/15136#discussion_r488988217", "createdAt": "2020-09-15T21:37:05Z", "author": {"login": "rongrong"}, "path": "presto-parser/src/main/java/com/facebook/presto/sql/parser/AstBuilder.java", "diffHunk": "@@ -2410,6 +2436,23 @@ else if (context instanceof SqlBaseParser.RolePrincipalContext) {\n         }\n     }\n \n+    private boolean mixedAndOrOperatorParenthesisCheck(SqlBaseParser.BooleanExpressionContext node, LogicalBinaryExpression.Operator operator)\n+    {\n+        Expression expression = (Expression) visit(node);\n+        if (expression.getClass().equals(LogicalBinaryExpression.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "468f683620c6d513c3541aaddc52bc1f8629be51"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4ODQ5OA==", "bodyText": "Same here and next line. Use instanceof", "url": "https://github.com/prestodb/presto/pull/15136#discussion_r488988498", "createdAt": "2020-09-15T21:37:25Z", "author": {"login": "rongrong"}, "path": "presto-parser/src/main/java/com/facebook/presto/sql/parser/AstBuilder.java", "diffHunk": "@@ -2410,6 +2436,23 @@ else if (context instanceof SqlBaseParser.RolePrincipalContext) {\n         }\n     }\n \n+    private boolean mixedAndOrOperatorParenthesisCheck(SqlBaseParser.BooleanExpressionContext node, LogicalBinaryExpression.Operator operator)\n+    {\n+        Expression expression = (Expression) visit(node);\n+        if (expression.getClass().equals(LogicalBinaryExpression.class)) {\n+            if (((LogicalBinaryExpression) expression).getOperator().equals(operator)) {\n+                if (node.children.get(0).getClass().equals(SqlBaseParser.ValueExpressionDefaultContext.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "468f683620c6d513c3541aaddc52bc1f8629be51"}, "originalPosition": 64}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "468f683620c6d513c3541aaddc52bc1f8629be51", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/468f683620c6d513c3541aaddc52bc1f8629be51", "committedDate": "2020-09-12T00:47:02Z", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis."}, "afterCommit": {"oid": "e37e8b70178cec3a58b4d3279bcace8c4ee9d06d", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/e37e8b70178cec3a58b4d3279bcace8c4ee9d06d", "committedDate": "2020-09-15T22:56:58Z", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1acbd0aab26cd8046010d75ad773565beac80e4", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/c1acbd0aab26cd8046010d75ad773565beac80e4", "committedDate": "2020-09-16T01:31:08Z", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e37e8b70178cec3a58b4d3279bcace8c4ee9d06d", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/e37e8b70178cec3a58b4d3279bcace8c4ee9d06d", "committedDate": "2020-09-15T22:56:58Z", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis."}, "afterCommit": {"oid": "c1acbd0aab26cd8046010d75ad773565beac80e4", "author": {"user": {"login": "ankit0811", "name": "Ankit Kothari"}}, "url": "https://github.com/prestodb/presto/commit/c1acbd0aab26cd8046010d75ad773565beac80e4", "committedDate": "2020-09-16T01:31:08Z", "message": "Parser warnings when the query contains mixed AND/OR operator without proper parenthesis."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 82, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}