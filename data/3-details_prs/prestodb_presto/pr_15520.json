{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NzYyOTUw", "number": 15520, "title": "Replace Joda-Time libraries with java.time in Presto MongoDB", "bodyText": "Replace Joda-Time libraries with java.time in Presto MongoDB\nSince Java 8 we have java.time packages which are equivalent to Joda and\nthe recommendation from the author of the Joda-Time is to migrate to\njava.time(JSR-310) library.\n\nTest plan\n\nI updated TestMongoIntegrationSmokeTest.java to include TIME\nmvn test\n\n== NO RELEASE NOTE ==", "createdAt": "2020-12-14T19:57:42Z", "url": "https://github.com/prestodb/presto/pull/15520", "merged": true, "mergeCommit": {"oid": "cfe964254b14c684beeb6d795975a14842b1b704"}, "closed": true, "closedAt": "2020-12-16T22:24:26Z", "author": {"login": "sstoiana"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmMw6xgBqjQxMTE0NjEyOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm2nN6AFqTU1NDEzMzY1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "baedaeb066a569eca9336bb9ee964f54abb93191", "author": {"user": {"login": "sstoiana", "name": "Sorin Stoiana"}}, "url": "https://github.com/prestodb/presto/commit/baedaeb066a569eca9336bb9ee964f54abb93191", "committedDate": "2020-12-14T19:28:54Z", "message": "Deprecating Joda library in Presto Cassandra\n\nfrom https://www.joda.org/joda-time/\nNote that from Java SE 8 onwards, users are asked to migrate to java.time (JSR-310) - a core part of the JDK which replaces this project."}, "afterCommit": {"oid": "213d489b44ab8362126ad5695904c159de4e72c5", "author": {"user": {"login": "sstoiana", "name": "Sorin Stoiana"}}, "url": "https://github.com/prestodb/presto/commit/213d489b44ab8362126ad5695904c159de4e72c5", "committedDate": "2020-12-14T21:36:47Z", "message": "Deprecating Joda library in Presto MongoDB\n\nFrom https://www.joda.org/joda-time/\n> Note that from Java SE 8 onwards, users are asked to migrate to java.time (JSR-310) - a core part of the JDK which replaces this project."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMDI3MDQz", "url": "https://github.com/prestodb/presto/pull/15520#pullrequestreview-553027043", "createdAt": "2020-12-15T22:48:44Z", "commit": {"oid": "213d489b44ab8362126ad5695904c159de4e72c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo0ODo0NVrOIGjefQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo0ODo0NVrOIGjefQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0MzYxMw==", "bodyText": "can you test the same with the old code to ensure that it is the same, since this path was not getting tested previously.", "url": "https://github.com/prestodb/presto/pull/15520#discussion_r543743613", "createdAt": "2020-12-15T22:48:45Z", "author": {"login": "ajaygeorge"}, "path": "presto-mongodb/src/test/java/com/facebook/presto/mongodb/TestMongoIntegrationSmokeTest.java", "diffHunk": "@@ -132,6 +135,7 @@ public void testInsertWithEveryType()\n         assertEquals(row.getField(4), true);\n         assertEquals(row.getField(5), LocalDate.of(1980, 5, 7));\n         assertEquals(row.getField(6), LocalDateTime.of(1980, 5, 7, 11, 22, 33, 456_000_000));\n+        assertEquals(row.getField(7), LocalTime.of(11, 22, 33, 456_000_000));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "213d489b44ab8362126ad5695904c159de4e72c5"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMTM0ODIy", "url": "https://github.com/prestodb/presto/pull/15520#pullrequestreview-553134822", "createdAt": "2020-12-16T00:01:26Z", "commit": {"oid": "213d489b44ab8362126ad5695904c159de4e72c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d02426fe018406f5d6faa8b4e4c8c6c7480146fc", "author": {"user": {"login": "sstoiana", "name": "Sorin Stoiana"}}, "url": "https://github.com/prestodb/presto/commit/d02426fe018406f5d6faa8b4e4c8c6c7480146fc", "committedDate": "2020-12-16T00:04:32Z", "message": "Replace Joda-Time libraries with java.time in Presto MongoDB\n\nSince Java 8 we have java.time packages which are equivalent to Joda and\nthe recommendation from the author of the Joda-Time is to migrate to\njava.time(JSR-310) library."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "213d489b44ab8362126ad5695904c159de4e72c5", "author": {"user": {"login": "sstoiana", "name": "Sorin Stoiana"}}, "url": "https://github.com/prestodb/presto/commit/213d489b44ab8362126ad5695904c159de4e72c5", "committedDate": "2020-12-14T21:36:47Z", "message": "Deprecating Joda library in Presto MongoDB\n\nFrom https://www.joda.org/joda-time/\n> Note that from Java SE 8 onwards, users are asked to migrate to java.time (JSR-310) - a core part of the JDK which replaces this project."}, "afterCommit": {"oid": "d02426fe018406f5d6faa8b4e4c8c6c7480146fc", "author": {"user": {"login": "sstoiana", "name": "Sorin Stoiana"}}, "url": "https://github.com/prestodb/presto/commit/d02426fe018406f5d6faa8b4e4c8c6c7480146fc", "committedDate": "2020-12-16T00:04:32Z", "message": "Replace Joda-Time libraries with java.time in Presto MongoDB\n\nSince Java 8 we have java.time packages which are equivalent to Joda and\nthe recommendation from the author of the Joda-Time is to migrate to\njava.time(JSR-310) library."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzOTk1MTg4", "url": "https://github.com/prestodb/presto/pull/15520#pullrequestreview-553995188", "createdAt": "2020-12-16T19:02:27Z", "commit": {"oid": "d02426fe018406f5d6faa8b4e4c8c6c7480146fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOTowMjoyN1rOIHUn1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOTowMjoyN1rOIHUn1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU0ODgyMA==", "bodyText": "Can we directly create an instant from the long instead of casting to a date and then converting it to an instant?   e.g. Instant.ofEpochMilli(value)", "url": "https://github.com/prestodb/presto/pull/15520#discussion_r544548820", "createdAt": "2020-12-16T19:02:27Z", "author": {"login": "rschlussel"}, "path": "presto-mongodb/src/main/java/com/facebook/presto/mongodb/MongoPageSource.java", "diffHunk": "@@ -164,7 +166,7 @@ else if (type.equals(DATE)) {\n                     type.writeLong(output, TimeUnit.MILLISECONDS.toDays(utcMillis));\n                 }\n                 else if (type.equals(TIME)) {\n-                    type.writeLong(output, UTC_CHRONOLOGY.millisOfDay().get(((Date) value).getTime()));\n+                    type.writeLong(output, ZonedDateTime.ofInstant(((Date) value).toInstant(), UTC_ZONE_ID).get(ChronoField.MILLI_OF_DAY));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d02426fe018406f5d6faa8b4e4c8c6c7480146fc"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MTMzNjU5", "url": "https://github.com/prestodb/presto/pull/15520#pullrequestreview-554133659", "createdAt": "2020-12-16T22:24:04Z", "commit": {"oid": "d02426fe018406f5d6faa8b4e4c8c6c7480146fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4544, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}