{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NDM4MjUx", "number": 15190, "title": "Refactor more classes to use Page helper methods", "bodyText": "Comparable to changes in trinodb/trino#5218\nTwo commits:\n\nAdds Page#extractChannel(int) helper method to allow efficient single channel Page extraction\nRefactors more classes and operators to use application Page class helper methods which avoid extra allocations and copies of Block arrays\n\n== NO RELEASE NOTE ==", "createdAt": "2020-09-18T17:06:13Z", "url": "https://github.com/prestodb/presto/pull/15190", "merged": true, "mergeCommit": {"oid": "14ba79ce5c811636e2281b4fc1e7e519e01b16c8"}, "closed": true, "closedAt": "2020-09-21T17:32:06Z", "author": {"login": "pettyjamesm"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKIjnMgH2gAyNDg5NDM4MjUxOjgzOWVkZmNhYTUyNmU1ODE3YmJkYmM0MjBiOWIxOWVjNGJkMTI0NTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLC82ygBqjM3ODg1MjIwMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "839edfcaa526e5817bbdbc420b9b19ec4bd12458", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/prestodb/presto/commit/839edfcaa526e5817bbdbc420b9b19ec4bd12458", "committedDate": "2020-09-18T16:54:37Z", "message": "Add Page#extractChannel(int) to enable efficient single channel extraction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjYzNjI5", "url": "https://github.com/prestodb/presto/pull/15190#pullrequestreview-492263629", "createdAt": "2020-09-21T03:32:39Z", "commit": {"oid": "839edfcaa526e5817bbdbc420b9b19ec4bd12458"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMzozMjo0MFrOHU_2YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMzozNTo0NlrOHU_4eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc3OTY4MQ==", "bodyText": "Will this save CPU c.p. extractChannels(new int[]{channel});?", "url": "https://github.com/prestodb/presto/pull/15190#discussion_r491779681", "createdAt": "2020-09-21T03:32:40Z", "author": {"login": "highker"}, "path": "presto-common/src/main/java/com/facebook/presto/common/Page.java", "diffHunk": "@@ -329,6 +329,11 @@ public Page copyPositions(int[] retainedPositions, int offset, int length)\n         return wrapBlocksWithoutCopy(length, blocks);\n     }\n \n+    public Page extractChannel(int channel)\n+    {\n+        return wrapBlocksWithoutCopy(positionCount, new Block[]{this.blocks[channel]});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "839edfcaa526e5817bbdbc420b9b19ec4bd12458"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc4MDIxNw==", "bodyText": "keep this comment to the second to last line", "url": "https://github.com/prestodb/presto/pull/15190#discussion_r491780217", "createdAt": "2020-09-21T03:35:46Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/operator/aggregation/GenericAccumulatorFactory.java", "diffHunk": "@@ -550,14 +550,8 @@ public Type getFinalType()\n         @Override\n         public void addInput(GroupByIdBlock groupIdsBlock, Page page)\n         {\n-            Block[] blocks = new Block[page.getChannelCount() + 1];\n-            for (int i = 0; i < page.getChannelCount(); i++) {\n-                blocks[i] = page.getBlock(i);\n-            }\n-            // Add group id block", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bf4262fba5516ab2e0305801edfe3f6fab6aa65"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65bc8b8611282c5a8c4b87cac5a7f8da98eb295b", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/prestodb/presto/commit/65bc8b8611282c5a8c4b87cac5a7f8da98eb295b", "committedDate": "2020-09-21T12:56:22Z", "message": "Refactor more operators to use applicate Page method helpers\n\nAvoids extra copies of Block array values"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9bf4262fba5516ab2e0305801edfe3f6fab6aa65", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/prestodb/presto/commit/9bf4262fba5516ab2e0305801edfe3f6fab6aa65", "committedDate": "2020-09-18T17:01:51Z", "message": "Refactor more operators to use applicate Page method helpers\n\nAvoids extra copies of Block array values"}, "afterCommit": {"oid": "65bc8b8611282c5a8c4b87cac5a7f8da98eb295b", "author": {"user": {"login": "pettyjamesm", "name": "James Petty"}}, "url": "https://github.com/prestodb/presto/commit/65bc8b8611282c5a8c4b87cac5a7f8da98eb295b", "committedDate": "2020-09-21T12:56:22Z", "message": "Refactor more operators to use applicate Page method helpers\n\nAvoids extra copies of Block array values"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 154, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}