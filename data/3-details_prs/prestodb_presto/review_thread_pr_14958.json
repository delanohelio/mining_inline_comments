{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDg1NzQ4", "number": 14958, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDoyMzoyNVrOEVQJrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDozMjoxMlrOEVQPcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNzIwMTczOnYy", "diffSide": "RIGHT", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/event/VerifierQueryEvent.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDoyMzoyNVrOG75pPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxOToxNzoxNFrOG8XMbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MzYxMg==", "bodyText": "nit: is the indentation suggested by Intellij?", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465463612", "createdAt": "2020-08-05T04:23:25Z", "author": {"login": "wenleix"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/event/VerifierQueryEvent.java", "diffHunk": "@@ -113,10 +114,12 @@ public static VerifierQueryEvent skipped(\n                 Optional.empty(),\n                 Optional.empty(),\n                 Optional.empty(),\n-                new QueryInfo(\n+                skipControl\n+                        ? Optional.empty()\n+                        : Optional.of(new QueryInfo(\n                         sourceQuery.getControlConfiguration().getCatalog(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTkzMjE1MA==", "bodyText": "It is", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465932150", "createdAt": "2020-08-05T18:48:20Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/event/VerifierQueryEvent.java", "diffHunk": "@@ -113,10 +114,12 @@ public static VerifierQueryEvent skipped(\n                 Optional.empty(),\n                 Optional.empty(),\n                 Optional.empty(),\n-                new QueryInfo(\n+                skipControl\n+                        ? Optional.empty()\n+                        : Optional.of(new QueryInfo(\n                         sourceQuery.getControlConfiguration().getCatalog(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MzYxMg=="}, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk0Nzc1Nw==", "bodyText": "Resolved by moving ternary operator to the end of the line.", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465947757", "createdAt": "2020-08-05T19:17:14Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/event/VerifierQueryEvent.java", "diffHunk": "@@ -113,10 +114,12 @@ public static VerifierQueryEvent skipped(\n                 Optional.empty(),\n                 Optional.empty(),\n                 Optional.empty(),\n-                new QueryInfo(\n+                skipControl\n+                        ? Optional.empty()\n+                        : Optional.of(new QueryInfo(\n                         sourceQuery.getControlConfiguration().getCatalog(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MzYxMg=="}, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNzIwMzEzOnYy", "diffSide": "RIGHT", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDoyNDoyMlrOG75qJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDoyNDoyMlrOG75qJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2Mzg0Nw==", "bodyText": "nit: unnecessary line break?", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465463847", "createdAt": "2020-08-05T04:24:22Z", "author": {"login": "wenleix"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "diffHunk": "@@ -176,22 +185,25 @@ public VerificationResult run()\n             testQueryContext.setState(QueryState.SUCCEEDED);\n \n             // Verify results\n-            matchResult = Optional.of(verify(controlQueryBundle, test.get(), controlChecksumQueryContext, testChecksumQueryContext));\n+            if (!skipControl) {\n+                matchResult = Optional.of(verify(control.get(), test.get(), controlChecksumQueryContext, testChecksumQueryContext));\n \n-            // Determinism analysis\n-            if (matchResult.get().isMismatchPossiblyCausedByNonDeterminism()) {\n-                determinismAnalysis = Optional.of(determinismAnalyzer.analyze(controlQueryBundle, matchResult.get().getControlChecksum(), determinismAnalysisDetails));\n+                // Determinism analysis\n+                if (matchResult.get().isMismatchPossiblyCausedByNonDeterminism()) {\n+                    determinismAnalysis = Optional.of(determinismAnalyzer.analyze(control.get(), matchResult.get().getControlChecksum(), determinismAnalysisDetails));\n+                }\n             }\n \n-            partialResult = Optional.of(concludeVerificationPartial(control, test, controlQueryContext, matchResult, determinismAnalysis, Optional.empty()));\n+            partialResult = Optional.of(concludeVerificationPartial(control, test, controlQueryContext, testQueryContext, matchResult, determinismAnalysis, Optional.empty()));\n         }\n-        catch (Throwable t) {\n+        catch (\n+                Throwable t) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNzIwNTkyOnYy", "diffSide": "RIGHT", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDoyNTo1MVrOG75rsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDoyNTo1MVrOG75rsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2NDI0MA==", "bodyText": "nit: unnecessary empty line?", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465464240", "createdAt": "2020-08-05T04:25:51Z", "author": {"login": "wenleix"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "diffHunk": "@@ -204,18 +216,21 @@ public VerificationResult run()\n             }\n         }\n \n-        return concludeVerification(\n-                partialResult.get(),\n-                control,\n-                test,\n-                controlQueryContext,\n-                testQueryContext,\n-                matchResult,\n-                determinismAnalysis,\n-                controlChecksumQueryContext,\n-                testChecksumQueryContext,\n-                determinismAnalysisDetails.build(),\n-                throwable);\n+        return\n+\n+                concludeVerification(\n+                        partialResult.get(),\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNzIxNjQ5OnYy", "diffSide": "RIGHT", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNDozMjoxMlrOG75x1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxOToxNjoxNFrOG8XKXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2NTgxMw==", "bodyText": "nit: the indentation is not easy to read now...One idea is\n: Optional.of(\n      buildQueryInfo(\n            sourceQuery.getControlConfiguration(),\n............\nBut that's just my personal way. Feel free to keep the current approach if you see fit.", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465465813", "createdAt": "2020-08-05T04:32:12Z", "author": {"login": "wenleix"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "diffHunk": "@@ -301,12 +319,14 @@ private VerificationResult concludeVerification(\n                         Optional.of(determinismAnalysisDetails) :\n                         Optional.empty(),\n                 partialResult.getResolveMessage(),\n-                buildQueryInfo(\n+                skipControl\n+                        ? Optional.empty()\n+                        : Optional.of(buildQueryInfo(\n                         sourceQuery.getControlConfiguration(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTkzNjY0Mg==", "bodyText": "Unfortunately IntelliJ auto-formats to the following if buildQueryInfo is on the next line:\nskipControl\n    ? Optional.empty()\n    : Optional.of(\n    buildQueryInfo(\n        sourceQuery.getControlConfiguration(),\n        sourceQuery.getControlQuery(),\n        controlChecksumQueryContext,\n        control,\n        controlQueryContext)),", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465936642", "createdAt": "2020-08-05T18:56:27Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "diffHunk": "@@ -301,12 +319,14 @@ private VerificationResult concludeVerification(\n                         Optional.of(determinismAnalysisDetails) :\n                         Optional.empty(),\n                 partialResult.getResolveMessage(),\n-                buildQueryInfo(\n+                skipControl\n+                        ? Optional.empty()\n+                        : Optional.of(buildQueryInfo(\n                         sourceQuery.getControlConfiguration(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2NTgxMw=="}, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk0NzIzMA==", "bodyText": "Moving the ternary operator to the end of the line and indentation works better.", "url": "https://github.com/prestodb/presto/pull/14958#discussion_r465947230", "createdAt": "2020-08-05T19:16:14Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/AbstractVerification.java", "diffHunk": "@@ -301,12 +319,14 @@ private VerificationResult concludeVerification(\n                         Optional.of(determinismAnalysisDetails) :\n                         Optional.empty(),\n                 partialResult.getResolveMessage(),\n-                buildQueryInfo(\n+                skipControl\n+                        ? Optional.empty()\n+                        : Optional.of(buildQueryInfo(\n                         sourceQuery.getControlConfiguration(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2NTgxMw=="}, "originalCommit": {"oid": "2bfac9a2c5635536a4990bdecb2ff771ba128956"}, "originalPosition": 175}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2243, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}