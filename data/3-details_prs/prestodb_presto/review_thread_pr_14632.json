{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNzU4OTA1", "number": 14632, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDo0ODo0N1rOEGGn1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoyMzoyN1rOEKfRjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODM1NDE1OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/dispatcher/QueuedStatementResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDo0ODo0N1rOGksn5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDo0ODo0N1rOGksn5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEzMzAzMQ==", "bodyText": "Let's have static constants", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441133031", "createdAt": "2020-06-16T20:48:47Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/dispatcher/QueuedStatementResource.java", "diffHunk": "@@ -82,6 +83,7 @@\n import static javax.ws.rs.core.Response.Status.NOT_FOUND;\n \n @Path(\"/\")\n+@RolesAllowed(\"user\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d20f280bc648006f16758d11f87e7f5282094f5"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjIzMDA2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/dispatcher/QueuedStatementResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo0OToyNFrOGlSubA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo0OToyNFrOGlSubA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1NzI5Mg==", "bodyText": "nit: prefer static imports", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441757292", "createdAt": "2020-06-17T18:49:24Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/dispatcher/QueuedStatementResource.java", "diffHunk": "@@ -82,6 +84,7 @@\n import static javax.ws.rs.core.Response.Status.NOT_FOUND;\n \n @Path(\"/\")\n+@RolesAllowed(RoleType.USER)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjIzMzI4OnYy", "diffSide": "RIGHT", "path": "presto-proxy/pom.xml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo0OTo1N1rOGlSwsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNDo0NjozM1rOGlfcWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Nzg3NQ==", "bodyText": "We shouldn't import presto-main in presto-proxy.\n@mayankgarg1990 do we want to enforce security in presto-proxy?", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441757875", "createdAt": "2020-06-17T18:49:57Z", "author": {"login": "arhimondr"}, "path": "presto-proxy/pom.xml", "diffHunk": "@@ -154,16 +154,15 @@\n             <scope>runtime</scope>\n         </dependency>\n \n-        <!-- for testing -->\n         <dependency>\n-            <groupId>org.testng</groupId>\n-            <artifactId>testng</artifactId>\n-            <scope>test</scope>\n+            <groupId>com.facebook.presto</groupId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2MTk1OA==", "bodyText": "Yes, we need to have authn and authz in every single FB endpoint", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441761958", "createdAt": "2020-06-17T18:53:40Z", "author": {"login": "mayankgarg1990"}, "path": "presto-proxy/pom.xml", "diffHunk": "@@ -154,16 +154,15 @@\n             <scope>runtime</scope>\n         </dependency>\n \n-        <!-- for testing -->\n         <dependency>\n-            <groupId>org.testng</groupId>\n-            <artifactId>testng</artifactId>\n-            <scope>test</scope>\n+            <groupId>com.facebook.presto</groupId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Nzg3NQ=="}, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk0NTQ1NA==", "bodyText": "The presto-proxy is a standalone application. It is not defining any endpoints used by Presto.\nFrom presto-proxy readme\nThis proxy server allows clients to securely access a remote Presto\nserver (or set of servers) without having direct access to the server.\nFor example, if the Presto server is behind a firewall, only the proxy\nneeds to be exposed to the client.\n\nalso\nIf so configured, the proxy will generate JWT access tokens containing\nthe principal from the TLS client certificate presented to the proxy.\nThis allows using the proxy in secure environments without needing\nthe proxy to perform explicit validation of the username and principal.\n\nhttps://github.com/prestodb/presto/blob/master/presto-proxy/README.txt\nIt feels like the Proxy shouldn't enforce authorization. Instead it should be enforced by the presto server itself.", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441945454", "createdAt": "2020-06-18T03:18:43Z", "author": {"login": "arhimondr"}, "path": "presto-proxy/pom.xml", "diffHunk": "@@ -154,16 +154,15 @@\n             <scope>runtime</scope>\n         </dependency>\n \n-        <!-- for testing -->\n         <dependency>\n-            <groupId>org.testng</groupId>\n-            <artifactId>testng</artifactId>\n-            <scope>test</scope>\n+            <groupId>com.facebook.presto</groupId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Nzg3NQ=="}, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk2NTY1Ng==", "bodyText": "Makes sense :) We can skip this then.", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441965656", "createdAt": "2020-06-18T04:46:33Z", "author": {"login": "mayankgarg1990"}, "path": "presto-proxy/pom.xml", "diffHunk": "@@ -154,16 +154,15 @@\n             <scope>runtime</scope>\n         </dependency>\n \n-        <!-- for testing -->\n         <dependency>\n-            <groupId>org.testng</groupId>\n-            <artifactId>testng</artifactId>\n-            <scope>test</scope>\n+            <groupId>com.facebook.presto</groupId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc1Nzg3NQ=="}, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjI1Mzk1OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/server/security/RoleType.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo1MzoxN1rOGlS_Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMzoxNTo0OFrOGleKwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2MTU3OQ==", "bodyText": "I believe that we should move this class to presto-common package. @arhimondr - thoughts?", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441761579", "createdAt": "2020-06-17T18:53:17Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/server/security/RoleType.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.facebook.presto.server.security;\n+\n+public final class RoleType", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3MTExNg==", "bodyText": "Package com.facebook.presto.common.type seems like a fair option.", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441771116", "createdAt": "2020-06-17T19:05:25Z", "author": {"login": "zacw7"}, "path": "presto-main/src/main/java/com/facebook/presto/server/security/RoleType.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.facebook.presto.server.security;\n+\n+public final class RoleType", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2MTU3OQ=="}, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk0NDc2OA==", "bodyText": "If we really want to have authz for Presto proxy, then we should move it to presto-common. Importing presto-main to presto-proxy is definitely bad idea.", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r441944768", "createdAt": "2020-06-18T03:15:48Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/server/security/RoleType.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.facebook.presto.server.security;\n+\n+public final class RoleType", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2MTU3OQ=="}, "originalCommit": {"oid": "18a6de4bacd841d189c394daa4a7c0dc1ac94f2a"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDMwNzY5OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/server/ClusterStatsResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxNDozNFrOGrjWNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxNDozNFrOGrjWNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMTA3OQ==", "bodyText": "This is used by the UI which is generally visible to everyone - should this be just ADMIN? I believe that we should add USER here as well. Thoughts @arhimondr ?", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r448321079", "createdAt": "2020-07-01T12:14:34Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/server/ClusterStatsResource.java", "diffHunk": "@@ -22,17 +22,20 @@\n import com.fasterxml.jackson.annotation.JsonCreator;\n import com.fasterxml.jackson.annotation.JsonProperty;\n \n+import javax.annotation.security.RolesAllowed;\n import javax.inject.Inject;\n import javax.ws.rs.GET;\n import javax.ws.rs.Path;\n import javax.ws.rs.Produces;\n import javax.ws.rs.core.MediaType;\n import javax.ws.rs.core.Response;\n \n+import static com.facebook.presto.server.security.RoleType.ADMIN;\n import static java.util.Objects.requireNonNull;\n import static java.util.concurrent.TimeUnit.SECONDS;\n \n @Path(\"/v1/cluster\")\n+@RolesAllowed(ADMIN)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8d428082bbd487406cef4b9575b6df0e7cdb5a3"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDMxOTI2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/server/QueryStateInfoResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxODowMlrOGrjdEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxODowMlrOGrjdEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMjgzNA==", "bodyText": "This can also be used in UIs to serve information - should we also open this up to users?", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r448322834", "createdAt": "2020-07-01T12:18:02Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/server/QueryStateInfoResource.java", "diffHunk": "@@ -35,12 +36,14 @@\n import static com.facebook.presto.execution.QueryState.QUEUED;\n import static com.facebook.presto.server.QueryStateInfo.createQueryStateInfo;\n import static com.facebook.presto.server.QueryStateInfo.createQueuedQueryStateInfo;\n+import static com.facebook.presto.server.security.RoleType.ADMIN;\n import static com.google.common.base.Strings.isNullOrEmpty;\n import static com.google.common.collect.ImmutableList.toImmutableList;\n import static java.util.Objects.requireNonNull;\n import static javax.ws.rs.core.Response.Status.NOT_FOUND;\n \n @Path(\"/v1/queryState\")\n+@RolesAllowed(ADMIN)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8d428082bbd487406cef4b9575b6df0e7cdb5a3"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDMzNjE1OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/server/StageResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoyMzoyN1rOGrjnrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoyMzoyN1rOGrjnrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyNTU0OA==", "bodyText": "This is used in QueryResult to allow for users to cancel their query - we should make this USER", "url": "https://github.com/prestodb/presto/pull/14632#discussion_r448325548", "createdAt": "2020-07-01T12:23:27Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/server/StageResource.java", "diffHunk": "@@ -16,14 +16,17 @@\n import com.facebook.presto.execution.QueryManager;\n import com.facebook.presto.execution.StageId;\n \n+import javax.annotation.security.RolesAllowed;\n import javax.inject.Inject;\n import javax.ws.rs.DELETE;\n import javax.ws.rs.Path;\n import javax.ws.rs.PathParam;\n \n+import static com.facebook.presto.server.security.RoleType.ADMIN;\n import static java.util.Objects.requireNonNull;\n \n @Path(\"/v1/stage\")\n+@RolesAllowed(ADMIN)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8d428082bbd487406cef4b9575b6df0e7cdb5a3"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2416, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}