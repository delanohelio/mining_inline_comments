{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMjY5OTY1", "number": 15058, "title": "Improve PrestoSparkRunner capabilities", "bodyText": "Support writing query results into a file\nImprove PrestoSparkQueryInfo, make it more consistent with QueryResults from conventional Presto\nExpose more session parameters in the interface\n\n== NO RELEASE NOTE ==", "createdAt": "2020-08-20T22:19:11Z", "url": "https://github.com/prestodb/presto/pull/15058", "merged": true, "mergeCommit": {"oid": "6923691a0e8f6e83340180aacbea5d1ad9852519"}, "closed": true, "closedAt": "2020-08-25T20:09:39Z", "author": {"login": "arhimondr"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA8IBVAFqTQ3MjExNzUwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCa2RtABqjM2OTEyMzk0MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMTE3NTAy", "url": "https://github.com/prestodb/presto/pull/15058#pullrequestreview-472117502", "createdAt": "2020-08-21T03:09:57Z", "commit": {"oid": "1d23871b17dad2d27628c051de9a485b22e9b195"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMzowOTo1N1rOHEaGHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMzowOTo1N1rOHEaGHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM4MzkwMA==", "bodyText": "This is updateRowCount.", "url": "https://github.com/prestodb/presto/pull/15058#discussion_r474383900", "createdAt": "2020-08-21T03:09:57Z", "author": {"login": "viczhang861"}, "path": "presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkQueryExecutionFactory.java", "diffHunk": "@@ -698,7 +785,27 @@ else if (executionException instanceof PrestoSparkExecutionException) {\n                     result.add(unmodifiableList(columns));\n                 }\n             }\n-            return result.build();\n+            List<List<Object>> results = result.build();\n+\n+            // Based on com.facebook.presto.server.protocol.Query#getNextResult\n+            OptionalLong updateCount = OptionalLong.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d23871b17dad2d27628c051de9a485b22e9b195"}, "originalPosition": 200}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f20f9371aa8268f9793c4fe07f21e1bb3bc3c72", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/6f20f9371aa8268f9793c4fe07f21e1bb3bc3c72", "committedDate": "2020-08-20T19:39:04Z", "message": "Allow to store query results into a file in Presto on Spark"}, "afterCommit": {"oid": "ab9233e11726b940432b356a44c5447773fce4e5", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/ab9233e11726b940432b356a44c5447773fce4e5", "committedDate": "2020-08-21T14:56:48Z", "message": "Allow to store query results into a file in Presto on Spark"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczOTk4NDAw", "url": "https://github.com/prestodb/presto/pull/15058#pullrequestreview-473998400", "createdAt": "2020-08-24T23:40:03Z", "commit": {"oid": "32dbce345f85c8754f460bfeea9c876ef563c924"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMzo0MDowM1rOHF6raQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMzo0MDowM1rOHF6raQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk2NjMxMw==", "bodyText": "Curious about the usage of principal, extraCredentials and traceToken? -- probably relate to security story?", "url": "https://github.com/prestodb/presto/pull/15058#discussion_r475966313", "createdAt": "2020-08-24T23:40:03Z", "author": {"login": "wenleix"}, "path": "presto-spark-launcher/src/main/java/com/facebook/presto/spark/launcher/PrestoSparkRunner.java", "diffHunk": "@@ -63,26 +63,39 @@ public PrestoSparkRunner(PrestoSparkDistribution distribution)\n     }\n \n     public void run(\n+            String user,\n+            Optional<Principal> principal,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32dbce345f85c8754f460bfeea9c876ef563c924"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDAzMzIw", "url": "https://github.com/prestodb/presto/pull/15058#pullrequestreview-474003320", "createdAt": "2020-08-24T23:54:22Z", "commit": {"oid": "ab9233e11726b940432b356a44c5447773fce4e5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MDAzOTky", "url": "https://github.com/prestodb/presto/pull/15058#pullrequestreview-474003992", "createdAt": "2020-08-24T23:56:22Z", "commit": {"oid": "ab9233e11726b940432b356a44c5447773fce4e5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMzo1NjoyMlrOHF7YGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMzo1NjoyMlrOHF7YGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk3Nzc1NA==", "bodyText": "Note QueryResults in Presto classic implements two interface: QueryData and QueryStatusInfo. This seems more like QueryData, so maybe PrestoSparkQueryData?", "url": "https://github.com/prestodb/presto/pull/15058#discussion_r475977754", "createdAt": "2020-08-24T23:56:22Z", "author": {"login": "wenleix"}, "path": "presto-spark-common/src/main/java/com/facebook/presto/spark/PrestoSparkQueryResults.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spark;\n+\n+import com.facebook.presto.client.Column;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.collect.ImmutableList;\n+\n+import java.util.List;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class PrestoSparkQueryResults\n+{\n+    private final List<Column> columns;\n+    private final List<List<Object>> data;\n+\n+    @JsonCreator\n+    public PrestoSparkQueryResults(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab9233e11726b940432b356a44c5447773fce4e5"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f6cdde75933156f621cd0fbda82de208276a6e", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/99f6cdde75933156f621cd0fbda82de208276a6e", "committedDate": "2020-08-25T16:04:54Z", "message": "Expose more session parameters in PrestoSparkRunner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8457ca3dc60050c65c5fdd9a68d2ffb55b5698a", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/a8457ca3dc60050c65c5fdd9a68d2ffb55b5698a", "committedDate": "2020-08-25T16:27:11Z", "message": "Restructure PrestoSparkQueryInfo to resemble QueryResults"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b6c1523345dc4d05c006b0474df6c7d589b0c7", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/c9b6c1523345dc4d05c006b0474df6c7d589b0c7", "committedDate": "2020-08-25T16:32:24Z", "message": "Allow to store query results into a file in Presto on Spark"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab9233e11726b940432b356a44c5447773fce4e5", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/ab9233e11726b940432b356a44c5447773fce4e5", "committedDate": "2020-08-21T14:56:48Z", "message": "Allow to store query results into a file in Presto on Spark"}, "afterCommit": {"oid": "c9b6c1523345dc4d05c006b0474df6c7d589b0c7", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/c9b6c1523345dc4d05c006b0474df6c7d589b0c7", "committedDate": "2020-08-25T16:32:24Z", "message": "Allow to store query results into a file in Presto on Spark"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 291, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}