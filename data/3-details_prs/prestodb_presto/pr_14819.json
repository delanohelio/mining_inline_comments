{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MDYwNTQx", "number": 14819, "title": "Avoid fetching encryption information when no columns requested", "bodyText": "This can happen if the user is only asking for partition columns or something like count(). As of now,\nif the table has table level encryption key, we will try getting the key metadata for that key where\nas it is not needed. This change will allow users who don't have access to the table data to still be able\nto get the partition columns or count() and bring the implementation at par with column level encryption\nkey specification\n== NO RELEASE NOTE ==", "createdAt": "2020-07-09T19:50:26Z", "url": "https://github.com/prestodb/presto/pull/14819", "merged": true, "mergeCommit": {"oid": "614304448532309ff542e524bcc355281cd4803d"}, "closed": true, "closedAt": "2020-07-09T21:40:42Z", "author": {"login": "mayankgarg1990"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczUch6gH2gAyNDQ3MDYwNTQxOmZmOTBmOTZkYjM1NTIwZTJhYTM3OTc1Y2ZkYTkzOWJiZjJkODU2NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczVPyMAFqTQ0NTk1MzQyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ff90f96db35520e2aa37975cfda939bbf2d85645", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/ff90f96db35520e2aa37975cfda939bbf2d85645", "committedDate": "2020-07-09T19:45:29Z", "message": "Avoid fetching encryption information when no columns requested\n\nThis can happen if the user is only asking for partition columns or something like count(*). As of now,\nif the table has table level encryption key, we will try getting the key metadata for that key where\nas it is not needed. This change will allow users who don't have access to the table data to still be able\nto get the partition columns or count(*) and bring the implementation at par with column level encryption\nkey specification"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTI4MjA5", "url": "https://github.com/prestodb/presto/pull/14819#pullrequestreview-445928209", "createdAt": "2020-07-09T20:01:41Z", "commit": {"oid": "ff90f96db35520e2aa37975cfda939bbf2d85645"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDowMTo0MVrOGvf2uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDowMTo0MVrOGvf2uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ1ODE2OA==", "bodyText": "why would requested columns be absent?", "url": "https://github.com/prestodb/presto/pull/14819#discussion_r452458168", "createdAt": "2020-07-09T20:01:41Z", "author": {"login": "rschlussel"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/AbstractDwrfEncryptionInformationSource.java", "diffHunk": "@@ -106,7 +106,12 @@ protected abstract EncryptionInformation getWriteEncryptionInformationInternal(\n \n         Map<String, String> fieldToKeyReference;\n         if (encryptTable.isPresent()) {\n-            fieldToKeyReference = ImmutableMap.of(DwrfEncryptionMetadata.TABLE_IDENTIFIER, encryptTable.get());\n+            if (!requestedColumns.isPresent() || !requestedColumns.get().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff90f96db35520e2aa37975cfda939bbf2d85645"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTUzNDIy", "url": "https://github.com/prestodb/presto/pull/14819#pullrequestreview-445953422", "createdAt": "2020-07-09T20:41:28Z", "commit": {"oid": "ff90f96db35520e2aa37975cfda939bbf2d85645"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1236, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}