{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjA2OTgx", "number": 14983, "title": "Add warning message for UNION queries without ALL/DISTINCT keyword", "bodyText": "Co-authored-by: Sundeep Katepalli\n== RELEASE NOTES ==\n\nGeneral Changes\n* Added new warning message for UNION queries without ALL/DISTINCT keyword.", "createdAt": "2020-08-06T18:55:30Z", "url": "https://github.com/prestodb/presto/pull/14983", "merged": true, "mergeCommit": {"oid": "27e922f63cf90273b7746667c390bf3246117c4e"}, "closed": true, "closedAt": "2020-08-14T18:02:03Z", "author": {"login": "prithvip"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8XgudAFqTQ2MjkxNjQzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-mHHUgBqjM2NTM3NTczMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTE2NDM2", "url": "https://github.com/prestodb/presto/pull/14983#pullrequestreview-462916436", "createdAt": "2020-08-06T22:24:52Z", "commit": {"oid": "346013c718540c4f0fb4c7d0df00076499bbec0c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoyNDo1MlrOG9GNnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoyNDo1MlrOG9GNnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxODEwOQ==", "bodyText": "@kaikalur Should this be a parser warning or a performance warning? I'm debating on this...", "url": "https://github.com/prestodb/presto/pull/14983#discussion_r466718109", "createdAt": "2020-08-06T22:24:52Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -1254,10 +1255,24 @@ private boolean isExpensiveUnionDistinct(SetOperation setOperation, Type[] outpu\n                                             type instanceof RowType);\n         }\n \n+        @Override\n+        protected Scope visitUnion(Union node, Optional<Scope> scope)\n+        {\n+            if (!node.isDistinct().isPresent()) {\n+                warningCollector.add(new PrestoWarning(PARSER_WARNING,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "346013c718540c4f0fb4c7d0df00076499bbec0c"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTE4NjUy", "url": "https://github.com/prestodb/presto/pull/14983#pullrequestreview-462918652", "createdAt": "2020-08-06T22:30:11Z", "commit": {"oid": "346013c718540c4f0fb4c7d0df00076499bbec0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjozMDoxMVrOG9GVHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjozMToyOVrOG9GW5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMDAyOA==", "bodyText": "Let's not give the option to add DISTINCT here. So encourage them to add ALL. Most people would just do it. And if it's really needed they will figure it out or ask us. So reword it as something like:\n\"UNION without the ALL keyword is a computationally expensive operation and most often unnecessarry. Please add the ALL keyword.\"", "url": "https://github.com/prestodb/presto/pull/14983#discussion_r466720028", "createdAt": "2020-08-06T22:30:11Z", "author": {"login": "kaikalur"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -1254,10 +1255,24 @@ private boolean isExpensiveUnionDistinct(SetOperation setOperation, Type[] outpu\n                                             type instanceof RowType);\n         }\n \n+        @Override\n+        protected Scope visitUnion(Union node, Optional<Scope> scope)\n+        {\n+            if (!node.isDistinct().isPresent()) {\n+                warningCollector.add(new PrestoWarning(PARSER_WARNING,\n+                        \"UNION specified without ALL or DISTINCT\" +\n+                        \" keyword is equivalent to UNION DISTINCT, which is computationally expensive. \" +\n+                        \"Consider using UNION ALL when possible, or specifically add keyword DISTINCT to stop \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "346013c718540c4f0fb4c7d0df00076499bbec0c"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMDQ4Ng==", "bodyText": "Should be a performance warning given by the parser :)", "url": "https://github.com/prestodb/presto/pull/14983#discussion_r466720486", "createdAt": "2020-08-06T22:31:29Z", "author": {"login": "kaikalur"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -1254,10 +1255,24 @@ private boolean isExpensiveUnionDistinct(SetOperation setOperation, Type[] outpu\n                                             type instanceof RowType);\n         }\n \n+        @Override\n+        protected Scope visitUnion(Union node, Optional<Scope> scope)\n+        {\n+            if (!node.isDistinct().isPresent()) {\n+                warningCollector.add(new PrestoWarning(PARSER_WARNING,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxODEwOQ=="}, "originalCommit": {"oid": "346013c718540c4f0fb4c7d0df00076499bbec0c"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTIxNTk0", "url": "https://github.com/prestodb/presto/pull/14983#pullrequestreview-462921594", "createdAt": "2020-08-06T22:37:36Z", "commit": {"oid": "346013c718540c4f0fb4c7d0df00076499bbec0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "346013c718540c4f0fb4c7d0df00076499bbec0c", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/346013c718540c4f0fb4c7d0df00076499bbec0c", "committedDate": "2020-08-06T18:50:23Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword.\n\nCo-authored-by: Sundeep Katepalli"}, "afterCommit": {"oid": "4eb4a8be775d489a414c2792511391f8906fe721", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4eb4a8be775d489a414c2792511391f8906fe721", "committedDate": "2020-08-07T21:48:11Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword.\n\nCo-authored-by: Sundeep Katepalli"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4eb4a8be775d489a414c2792511391f8906fe721", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4eb4a8be775d489a414c2792511391f8906fe721", "committedDate": "2020-08-07T21:48:11Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword.\n\nCo-authored-by: Sundeep Katepalli"}, "afterCommit": {"oid": "58a2b926b940274c1172578a0ce3cce0b1223d40", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/58a2b926b940274c1172578a0ce3cce0b1223d40", "committedDate": "2020-08-10T23:42:10Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword.\n\nCo-authored-by: Sundeep Katepalli"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58a2b926b940274c1172578a0ce3cce0b1223d40", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/58a2b926b940274c1172578a0ce3cce0b1223d40", "committedDate": "2020-08-10T23:42:10Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword.\n\nCo-authored-by: Sundeep Katepalli"}, "afterCommit": {"oid": "7081c6ca5db82f665b1e97723a261b37a1c0b4a4", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/7081c6ca5db82f665b1e97723a261b37a1c0b4a4", "committedDate": "2020-08-11T18:00:29Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword.\n\nCo-authored-by: Sundeep Katepalli"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b94045f415d32b8565bcf6670a8dbd89976661e3", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/b94045f415d32b8565bcf6670a8dbd89976661e3", "committedDate": "2020-08-13T20:32:32Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword\n\nCo-authored-by: Sundeep Katepalli"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7081c6ca5db82f665b1e97723a261b37a1c0b4a4", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/7081c6ca5db82f665b1e97723a261b37a1c0b4a4", "committedDate": "2020-08-11T18:00:29Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword.\n\nCo-authored-by: Sundeep Katepalli"}, "afterCommit": {"oid": "b94045f415d32b8565bcf6670a8dbd89976661e3", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/b94045f415d32b8565bcf6670a8dbd89976661e3", "committedDate": "2020-08-13T20:32:32Z", "message": "Add warning message for UNION queries without ALL/DISTINCT keyword\n\nCo-authored-by: Sundeep Katepalli"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4996, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}