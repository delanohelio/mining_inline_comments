{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MjE4NTY3", "number": 15033, "title": "Add support for temporary (session-scoped) functions", "bodyText": "Depended by https://github.com/facebookexternal/presto-facebook/pull/1179\n== RELEASE NOTES ==\n\nGeneral Changes\n* Add support for temporary (session-scoped) functions", "createdAt": "2020-08-14T23:14:25Z", "url": "https://github.com/prestodb/presto/pull/15033", "merged": true, "mergeCommit": {"oid": "b1cee945babb7e8b4c60aafc6725ec19d3aa9d9f"}, "closed": true, "closedAt": "2021-01-28T00:18:37Z", "author": {"login": "prithvip"}, "timelineItems": {"totalCount": 49, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_AbRdABqjM2NTgxNzI0NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd0XUmigBqjQyNTgxMjEwNzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46622c6403dd67b817b088242798a2f4fbb23a40", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/46622c6403dd67b817b088242798a2f4fbb23a40", "committedDate": "2020-08-14T22:56:14Z", "message": "Add syntax support for CREATE TEMPORARY FUNCTION"}, "afterCommit": {"oid": "73559aa5faa35a0269b32e75792440bf1117b10e", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/73559aa5faa35a0269b32e75792440bf1117b10e", "committedDate": "2020-08-15T03:12:07Z", "message": "Add support for session-scoped temporary SQL functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73559aa5faa35a0269b32e75792440bf1117b10e", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/73559aa5faa35a0269b32e75792440bf1117b10e", "committedDate": "2020-08-15T03:12:07Z", "message": "Add support for session-scoped temporary SQL functions"}, "afterCommit": {"oid": "1cf17d168a511db4f7da842d94ce574e60fc2e24", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/1cf17d168a511db4f7da842d94ce574e60fc2e24", "committedDate": "2020-08-17T19:48:05Z", "message": "Add client-side support for session-scoped temporary SQL functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1cf17d168a511db4f7da842d94ce574e60fc2e24", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/1cf17d168a511db4f7da842d94ce574e60fc2e24", "committedDate": "2020-08-17T19:48:05Z", "message": "Add client-side support for session-scoped temporary SQL functions"}, "afterCommit": {"oid": "8b63c0b288ef89c7e1bc5b3470beb87bd7a4d948", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/8b63c0b288ef89c7e1bc5b3470beb87bd7a4d948", "committedDate": "2020-08-19T18:15:30Z", "message": "Add initial server-side support for temporary functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b63c0b288ef89c7e1bc5b3470beb87bd7a4d948", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/8b63c0b288ef89c7e1bc5b3470beb87bd7a4d948", "committedDate": "2020-08-19T18:15:30Z", "message": "Add initial server-side support for temporary functions"}, "afterCommit": {"oid": "c408bb8037b597db2fa60e02bdd6016de534f3b0", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/c408bb8037b597db2fa60e02bdd6016de534f3b0", "committedDate": "2020-09-08T17:57:11Z", "message": "Add support for temporary function coercion"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f705492fbbd17c51955652035b9586e2040960aa", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/f705492fbbd17c51955652035b9586e2040960aa", "committedDate": "2020-09-11T00:01:41Z", "message": "Store JSON representation of SqlInvokedFunction on client instead of SQL string"}, "afterCommit": {"oid": "78a0b25cf97c6639d92bcd3a0ec217f56bf871c6", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/78a0b25cf97c6639d92bcd3a0ec217f56bf871c6", "committedDate": "2020-09-11T14:46:30Z", "message": "Store JSON representation of SqlInvokedFunction on client instead of SQL string"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53aff5ba03b3c3a19a0853b7126f166272857744", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/53aff5ba03b3c3a19a0853b7126f166272857744", "committedDate": "2020-09-11T15:53:36Z", "message": "Clean up code"}, "afterCommit": {"oid": "8554981ff9352be44d7ac2c83146ca006a4736a6", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/8554981ff9352be44d7ac2c83146ca006a4736a6", "committedDate": "2020-09-11T17:35:19Z", "message": "Clean up code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8554981ff9352be44d7ac2c83146ca006a4736a6", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/8554981ff9352be44d7ac2c83146ca006a4736a6", "committedDate": "2020-09-11T17:35:19Z", "message": "Clean up code"}, "afterCommit": {"oid": "4ea40a51e5fd085003fa326dc2ee4ed4f0d1ea93", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4ea40a51e5fd085003fa326dc2ee4ed4f0d1ea93", "committedDate": "2020-09-11T17:58:46Z", "message": "Clean up code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MTg2NjA1", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-487186605", "createdAt": "2020-09-12T00:43:49Z", "commit": {"oid": "7037d770a633998f607e9e787af6e7c473468b1f"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMDo0Mzo1MFrOHQxLsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMTowMjoyOFrOHQxVNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM0NTA3NA==", "bodyText": "It's a reserved keyword in 92 but not 16? BTW adding new reserved keyword might cause pipelines to fail. So if we want to add it we probably first need to add warnings so people are aware.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r487345074", "createdAt": "2020-09-12T00:43:50Z", "author": {"login": "rongrong"}, "path": "presto-docs/src/main/sphinx/language/reserved.rst", "diffHunk": "@@ -68,6 +68,7 @@ Keyword                        SQL:2016      SQL-92\n ``ROLLUP``                     reserved\n ``SELECT``                     reserved      reserved\n ``TABLE``                      reserved      reserved\n+``TEMPORARY``                                reserved", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7037d770a633998f607e9e787af6e7c473468b1f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM0NTQ0Mg==", "bodyText": "Hmm, this makes me think. Can user create temporary function in any catalog.schema or only the default?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r487345442", "createdAt": "2020-09-12T00:46:16Z", "author": {"login": "rongrong"}, "path": "presto-parser/src/test/java/com/facebook/presto/sql/parser/TestSqlParser.java", "diffHunk": "@@ -1530,6 +1532,21 @@ public void testCreateFunction()\n                         \"RETURN rand()\",\n                 createFunctionRand);\n \n+        CreateFunction createTemporaryFunctionFoo = new CreateFunction(\n+                QualifiedName.of(\"dev\", \"testing\", \"foo\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7037d770a633998f607e9e787af6e7c473468b1f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM0NjE4Ng==", "bodyText": "This class is used to convert an Expression to RowExpression, not just for SQL function.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r487346186", "createdAt": "2020-09-12T00:51:26Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/relational/SqlToRowExpressionTranslator.java", "diffHunk": "@@ -407,7 +407,14 @@ protected RowExpression visitFunctionCall(FunctionCall node, Void context)\n                     .map(TypeSignatureProvider::new)\n                     .collect(toImmutableList());\n \n-            return call(node.getName().toString(), functionManager.resolveFunction(transactionId, qualifyFunctionName(node.getName()), argumentTypes), getType(node), arguments);\n+            return call(node.getName().toString(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "513f486d7c0fccaf4d531681d840cdca6b96d9e8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM0NjQ5Ng==", "bodyText": "PlanBuilder has Session as parameter so why not extract the session functions and support it in tests?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r487346496", "createdAt": "2020-09-12T00:53:48Z", "author": {"login": "rongrong"}, "path": "presto-main/src/test/java/com/facebook/presto/sql/planner/iterative/rule/test/PlanBuilder.java", "diffHunk": "@@ -340,6 +340,7 @@ private AggregationBuilder addAggregation(VariableReferenceExpression output, Ex\n             checkArgument(expression instanceof FunctionCall);\n             FunctionCall call = (FunctionCall) expression;\n             FunctionHandle functionHandle = metadata.getFunctionManager().resolveFunction(\n+                    Optional.empty(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "513f486d7c0fccaf4d531681d840cdca6b96d9e8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM0NjkxNw==", "bodyText": "I'm not sure there's confusion though. These functions are also session-scoped. The only difference is whether they are builtin or user-defined. Unless you want to repurpose the class name I think it's fine to leave it as SessionFunctions.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r487346917", "createdAt": "2020-09-12T00:57:24Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/operator/scalar/SessionInformationFunctions.java", "diffHunk": "@@ -23,9 +23,9 @@\n import static com.facebook.presto.spi.function.SqlFunctionVisibility.HIDDEN;\n import static io.airlift.slice.Slices.utf8Slice;\n \n-public final class SessionFunctions\n+public final class SessionInformationFunctions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc4149ae7eebe6af0d52a6ebae1b2957685e7ee9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM0NzUxMQ==", "bodyText": "You are by passing function resolution here, which is probably why you need to handle coercion separately. All function resolution should go through the same logic, which is wrapped in resolveFunctionInternal. Function namespaces are only providing candidates with getFunction(transactionID, functionName).", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r487347511", "createdAt": "2020-09-12T01:02:28Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/FunctionManager.java", "diffHunk": "@@ -271,6 +273,10 @@ public static QualifiedFunctionName qualifyFunctionName(QualifiedName name)\n      */\n     public FunctionHandle resolveFunction(Optional<Map<String, String>> sessionFunctions, Optional<TransactionId> transactionId, QualifiedFunctionName functionName, List<TypeSignatureProvider> parameterTypes)\n     {\n+        Optional<FunctionHandle> sessionFunctionHandle = sessionFunctionManager.getFunctionHandle(functionName, sessionFunctions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82b53cf5b10e7cc431584f91ba1ae2ff054a9f04"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ea40a51e5fd085003fa326dc2ee4ed4f0d1ea93", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4ea40a51e5fd085003fa326dc2ee4ed4f0d1ea93", "committedDate": "2020-09-11T17:58:46Z", "message": "Clean up code"}, "afterCommit": {"oid": "7ae5afeb7b57d6c394461b9eb6521140d2820f5d", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/7ae5afeb7b57d6c394461b9eb6521140d2820f5d", "committedDate": "2020-09-14T20:35:05Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ae5afeb7b57d6c394461b9eb6521140d2820f5d", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/7ae5afeb7b57d6c394461b9eb6521140d2820f5d", "committedDate": "2020-09-14T20:35:05Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "b7439b36d24cd8b1cce795d6513207e28d7e52cd", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/b7439b36d24cd8b1cce795d6513207e28d7e52cd", "committedDate": "2020-09-14T20:52:39Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7439b36d24cd8b1cce795d6513207e28d7e52cd", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/b7439b36d24cd8b1cce795d6513207e28d7e52cd", "committedDate": "2020-09-14T20:52:39Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "6652d656ee83351ba46cd733169a9e19588b5231", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6652d656ee83351ba46cd733169a9e19588b5231", "committedDate": "2020-09-18T20:12:13Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6652d656ee83351ba46cd733169a9e19588b5231", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6652d656ee83351ba46cd733169a9e19588b5231", "committedDate": "2020-09-18T20:12:13Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "6567ac8a8a845e2572e2b3d663e88cacc2d7739a", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6567ac8a8a845e2572e2b3d663e88cacc2d7739a", "committedDate": "2020-09-19T00:22:55Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6567ac8a8a845e2572e2b3d663e88cacc2d7739a", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6567ac8a8a845e2572e2b3d663e88cacc2d7739a", "committedDate": "2020-09-19T00:22:55Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "df00abff4c8b17d6377259851095a5905ec3af0a", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/df00abff4c8b17d6377259851095a5905ec3af0a", "committedDate": "2020-09-19T00:31:27Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df00abff4c8b17d6377259851095a5905ec3af0a", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/df00abff4c8b17d6377259851095a5905ec3af0a", "committedDate": "2020-09-19T00:31:27Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "ae37928b730ae4b07507c78b2d9b6b54b6f8249c", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/ae37928b730ae4b07507c78b2d9b6b54b6f8249c", "committedDate": "2020-09-19T01:47:09Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae37928b730ae4b07507c78b2d9b6b54b6f8249c", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/ae37928b730ae4b07507c78b2d9b6b54b6f8249c", "committedDate": "2020-09-19T01:47:09Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "2b28e560e38444c56a82a09e3c785503b32fd737", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/2b28e560e38444c56a82a09e3c785503b32fd737", "committedDate": "2020-09-19T01:56:25Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b28e560e38444c56a82a09e3c785503b32fd737", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/2b28e560e38444c56a82a09e3c785503b32fd737", "committedDate": "2020-09-19T01:56:25Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "d7e2b6e05c7fe965887c6a0b1ee2865126f59862", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/d7e2b6e05c7fe965887c6a0b1ee2865126f59862", "committedDate": "2020-09-20T14:04:47Z", "message": "Add support for temporary (session-scoped) functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7e2b6e05c7fe965887c6a0b1ee2865126f59862", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/d7e2b6e05c7fe965887c6a0b1ee2865126f59862", "committedDate": "2020-09-20T14:04:47Z", "message": "Add support for temporary (session-scoped) functions"}, "afterCommit": {"oid": "f20634dee0c52acbc897e38d897cb2bef9841727", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/f20634dee0c52acbc897e38d897cb2bef9841727", "committedDate": "2020-09-25T22:09:16Z", "message": "Add support for temporary functions in SHOW FUNCTIONS and SHOW CREATE FUNCTION"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTc2MjI4", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-497976228", "createdAt": "2020-09-29T00:03:15Z", "commit": {"oid": "68a157dd21a361f735358a66ebb2e1f9c90ad642"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMDowMzoxNVrOHZTxcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMDowOToyN1rOHZT4IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwMDQwMg==", "bodyText": "What about\nEach permanent function is uniquely identified by ...\n\nEach temporary function is uniquely identified by the function name. It cannot be qualified, nor collides with existing built-in functions.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496300402", "createdAt": "2020-09-29T00:03:15Z", "author": {"login": "caithagoras"}, "path": "presto-docs/src/main/sphinx/sql/create-function.rst", "diffHunk": "@@ -25,11 +25,15 @@ Description\n \n Create a new function with the specified definition.\n \n+When ``TEMPORARY`` is specified, the created function is valid and visible\n+within the current session, but no persistent entry is made.\n+\n Each function is uniquely identified by its qualified function name\n and its parameter type list. ``qualified_function_name`` needs to be in\n-the format of ``catalog.schema.function_name``.\n+the format of ``catalog.schema.function_name``. Temporary functions do not\n+need to be qualified.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68a157dd21a361f735358a66ebb2e1f9c90ad642"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwMDc5Mg==", "bodyText": "I think we should be able to support that and it could be useful, but sure, it could be a follow-up PR.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496300792", "createdAt": "2020-09-29T00:04:48Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -567,7 +567,12 @@ protected Scope visitCreateFunction(CreateFunction node, Optional<Scope> scope)\n             analysis.setUpdateType(\"CREATE FUNCTION\");\n \n             // Check function name\n-            checkFunctionName(node, node.getFunctionName());\n+            checkFunctionName(node, node.getFunctionName(), node.isTemporary());\n+\n+            // Check no replace with temporary functions\n+            if (node.isTemporary() && node.isReplace()) {\n+                throw new SemanticException(NOT_SUPPORTED, node, \"REPLACE is not supported for temporary functions\");\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68a157dd21a361f735358a66ebb2e1f9c90ad642"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwMTgwNA==", "bodyText": "What about functionName.getParts().size() != 1, which is identical but more explicit.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496301804", "createdAt": "2020-09-29T00:08:17Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -1608,9 +1613,15 @@ else if (column.getExpression() instanceof Identifier) {\n             return assignments.build();\n         }\n \n-        private void checkFunctionName(Statement node, QualifiedName functionName)\n+        private void checkFunctionName(Statement node, QualifiedName functionName, boolean isTemporary)\n         {\n-            if (functionName.getParts().size() != 3) {\n+            if (isTemporary && !functionName.getPrefix().equals(Optional.empty())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68a157dd21a361f735358a66ebb2e1f9c90ad642"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwMjExMw==", "bodyText": "What about\nif (isTemporary) {\n   if ...\n   if ...\n} else {\n   if ...\n}", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496302113", "createdAt": "2020-09-29T00:09:27Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/StatementAnalyzer.java", "diffHunk": "@@ -1608,9 +1613,15 @@ else if (column.getExpression() instanceof Identifier) {\n             return assignments.build();\n         }\n \n-        private void checkFunctionName(Statement node, QualifiedName functionName)\n+        private void checkFunctionName(Statement node, QualifiedName functionName, boolean isTemporary)\n         {\n-            if (functionName.getParts().size() != 3) {\n+            if (isTemporary && !functionName.getPrefix().equals(Optional.empty())) {\n+                throw new SemanticException(INVALID_FUNCTION_NAME, node, \"Temporary functions cannot be qualified.\");\n+            }\n+            if (isTemporary && metadata.getFunctionManager().listBuiltinFunctionNames().contains(functionName.toString())) {\n+                throw new SemanticException(INVALID_FUNCTION_NAME, node, format(\"Function %s is already registered as a built-in function.\", functionName));\n+            }\n+            if (!isTemporary && functionName.getParts().size() != 3) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68a157dd21a361f735358a66ebb2e1f9c90ad642"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTgwMTAy", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-497980102", "createdAt": "2020-09-29T00:15:47Z", "commit": {"oid": "1378e00bf51984ee2463e0e8f62b169e89cf650e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMDoxNTo0N1rOHZT_TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMDoxNTo0N1rOHZT_TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwMzk0OQ==", "bodyText": "nit: static import", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496303949", "createdAt": "2020-09-29T00:15:47Z", "author": {"login": "caithagoras"}, "path": "presto-client/src/main/java/com/facebook/presto/client/StatementClientV1.java", "diffHunk": "@@ -107,6 +110,8 @@\n     private final TimeZoneKey timeZone;\n     private final Duration requestTimeoutNanos;\n     private final String user;\n+    private final Map<String, String> addedSessionFunctions = new ConcurrentHashMap<>();\n+    private final Set<String> removedSessionFunctions = Sets.newConcurrentHashSet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1378e00bf51984ee2463e0e8f62b169e89cf650e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTgzMzE1", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-497983315", "createdAt": "2020-09-29T00:26:39Z", "commit": {"oid": "27b0576b0e6bb15513cbc514f9c6ff19f0d7808e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMDoyNjozOVrOHZUKNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMDoyNjozOVrOHZUKNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwNjc0MA==", "bodyText": "nit: Seems to me the old name createQueryRunner was just good enough.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496306740", "createdAt": "2020-09-29T00:26:39Z", "author": {"login": "caithagoras"}, "path": "presto-cli/src/test/java/com/facebook/presto/cli/AbstractCliTest.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.cli;\n+\n+import com.facebook.airlift.json.JsonCodec;\n+import com.facebook.presto.client.ClientSession;\n+import com.facebook.presto.client.Column;\n+import com.facebook.presto.client.QueryResults;\n+import com.facebook.presto.client.StatementStats;\n+import com.facebook.presto.common.type.BigintType;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n+import io.airlift.units.Duration;\n+import okhttp3.Headers;\n+import okhttp3.mockwebserver.MockResponse;\n+import okhttp3.mockwebserver.MockWebServer;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import static com.facebook.airlift.json.JsonCodec.jsonCodec;\n+import static com.facebook.presto.cli.ClientOptions.OutputFormat.CSV;\n+import static com.google.common.net.HttpHeaders.CONTENT_TYPE;\n+import static java.util.concurrent.TimeUnit.MINUTES;\n+import static org.testng.Assert.assertEquals;\n+\n+public abstract class AbstractCliTest\n+{\n+    protected static final JsonCodec<QueryResults> QUERY_RESULTS_JSON_CODEC = jsonCodec(QueryResults.class);\n+\n+    protected MockWebServer server;\n+\n+    @BeforeMethod\n+    public void setup()\n+            throws IOException\n+    {\n+        server = new MockWebServer();\n+        server.start();\n+    }\n+\n+    @AfterMethod\n+    public void teardown()\n+            throws IOException\n+    {\n+        server.close();\n+    }\n+\n+    protected ClientSession createMockClientSession()\n+    {\n+        return new ClientSession(\n+                server.url(\"/\").uri(),\n+                \"user\",\n+                \"source\",\n+                Optional.empty(),\n+                ImmutableSet.of(),\n+                \"clientInfo\",\n+                \"catalog\",\n+                \"schema\",\n+                \"America/Los_Angeles\",\n+                Locale.ENGLISH,\n+                ImmutableMap.of(),\n+                ImmutableMap.of(),\n+                ImmutableMap.of(),\n+                ImmutableMap.of(),\n+                ImmutableMap.of(),\n+                null,\n+                new Duration(2, MINUTES),\n+                ImmutableMap.of());\n+    }\n+\n+    protected QueryResults createMockQueryResults()\n+    {\n+        return new QueryResults(\n+                \"20160128_214710_00012_rk68b\",\n+                server.url(\"/query.html?20160128_214710_00012_rk68b\").uri(),\n+                null,\n+                null,\n+                ImmutableList.of(new Column(\"_col0\", BigintType.BIGINT)),\n+                ImmutableList.of(ImmutableList.of(123)),\n+                StatementStats.builder().setState(\"FINISHED\").build(),\n+                null,\n+                ImmutableList.of(),\n+                null,\n+                null);\n+    }\n+\n+    protected MockResponse createMockResponse()\n+    {\n+        return new MockResponse()\n+                .addHeader(CONTENT_TYPE, \"application/json\")\n+                .setBody(QUERY_RESULTS_JSON_CODEC.toJson(createMockQueryResults()));\n+    }\n+\n+    protected void executeQueries(List<String> queries)\n+    {\n+        Console console = new Console();\n+        QueryRunner queryRunner = createQueryRunnerWithClientSession(createMockClientSession());\n+        for (String query : queries) {\n+            console.executeCommand(queryRunner, query, CSV, false);\n+        }\n+    }\n+\n+    protected static QueryRunner createQueryRunnerWithClientSession(ClientSession clientSession)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27b0576b0e6bb15513cbc514f9c6ff19f0d7808e"}, "originalPosition": 120}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTg0MjE1", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-497984215", "createdAt": "2020-09-29T00:29:43Z", "commit": {"oid": "f20634dee0c52acbc897e38d897cb2bef9841727"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTg1NzAy", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-497985702", "createdAt": "2020-09-29T00:34:51Z", "commit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMDozNDo1MVrOHZUSWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMTowMTowMFrOHZUsdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwODgyNQ==", "bodyText": "ImmutableMap.copyOf", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496308825", "createdAt": "2020-09-29T00:34:51Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/FullConnectorSession.java", "diffHunk": "@@ -50,6 +51,7 @@ public FullConnectorSession(Session session, ConnectorIdentity identity)\n         this.catalog = null;\n         this.sessionPropertyManager = null;\n         this.sqlFunctionProperties = session.getSqlFunctionProperties();\n+        this.sessionFunctions = session.getSessionFunctions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMwODg0NQ==", "bodyText": "ImmutableMap.copyOf", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496308845", "createdAt": "2020-09-29T00:34:58Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/FullConnectorSession.java", "diffHunk": "@@ -67,6 +69,7 @@ public FullConnectorSession(\n         this.catalog = requireNonNull(catalog, \"catalog is null\");\n         this.sessionPropertyManager = requireNonNull(sessionPropertyManager, \"sessionPropertyManager is null\");\n         this.sqlFunctionProperties = session.getSqlFunctionProperties();\n+        this.sessionFunctions = session.getSessionFunctions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMTM1NA==", "bodyText": "\"TEMPORARY \" instead of \"TEMPORARY\".", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496311354", "createdAt": "2020-09-29T00:44:47Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/DropFunctionTask.java", "diffHunk": "@@ -53,19 +58,29 @@ public String getName()\n     @Override\n     public String explain(DropFunction statement, List<Expression> parameters)\n     {\n-        return \"DROP FUNCTION \" + statement.getFunctionName();\n+        return format(\"DROP %sFUNCTION %s\", statement.isTemporary() ? \"TEMPORARY\" : \"\", statement.getFunctionName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMzQwOQ==", "bodyText": "inline and defensive copy\nthis.name = requireNonNull(...);\nthis.parameterType = ImmutableList.copyOf(..)", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496313409", "createdAt": "2020-09-29T00:52:54Z", "author": {"login": "caithagoras"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/BasicSignature.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spi.function;\n+\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.common.type.TypeSignature;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.toList;\n+\n+@JsonPropertyOrder(alphabetic = true)\n+public class BasicSignature\n+{\n+    private final QualifiedFunctionName name;\n+    private final List<TypeSignature> parameterTypes;\n+\n+    @JsonCreator\n+    public BasicSignature(\n+            @JsonProperty(\"name\") QualifiedFunctionName name,\n+            @JsonProperty(\"parameterTypes\") List<TypeSignature> parameterTypes)\n+    {\n+        requireNonNull(name, \"name is null\");\n+        requireNonNull(parameterTypes, \"parameterTypes is null\");\n+\n+        this.name = name;\n+        this.parameterTypes = parameterTypes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxMzQ3NQ==", "bodyText": "Avoid string concat. Use String.format instead.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496313475", "createdAt": "2020-09-29T00:53:12Z", "author": {"login": "caithagoras"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/BasicSignature.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spi.function;\n+\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.common.type.TypeSignature;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.toList;\n+\n+@JsonPropertyOrder(alphabetic = true)\n+public class BasicSignature\n+{\n+    private final QualifiedFunctionName name;\n+    private final List<TypeSignature> parameterTypes;\n+\n+    @JsonCreator\n+    public BasicSignature(\n+            @JsonProperty(\"name\") QualifiedFunctionName name,\n+            @JsonProperty(\"parameterTypes\") List<TypeSignature> parameterTypes)\n+    {\n+        requireNonNull(name, \"name is null\");\n+        requireNonNull(parameterTypes, \"parameterTypes is null\");\n+\n+        this.name = name;\n+        this.parameterTypes = parameterTypes;\n+    }\n+\n+    public BasicSignature(Signature signature)\n+    {\n+        this(signature.getName(), signature.getArgumentTypes());\n+    }\n+\n+    @JsonProperty\n+    public QualifiedFunctionName getName()\n+    {\n+        return name;\n+    }\n+\n+    @JsonProperty\n+    public List<TypeSignature> getParameterTypes()\n+    {\n+        return parameterTypes;\n+    }\n+\n+    @Override\n+    public boolean equals(Object o)\n+    {\n+        if (this == o) {\n+            return true;\n+        }\n+        if (o == null || getClass() != o.getClass()) {\n+            return false;\n+        }\n+        BasicSignature that = (BasicSignature) o;\n+        return Objects.equals(name, that.name) &&\n+                Objects.equals(parameterTypes, that.parameterTypes);\n+    }\n+\n+    @Override\n+    public int hashCode()\n+    {\n+        return Objects.hash(name, parameterTypes);\n+    }\n+\n+    @Override\n+    public String toString()\n+    {\n+        return name + \"(\" + String.join(\",\", parameterTypes.stream().map(TypeSignature::toString).collect(toList())) + \")\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxNTUxMA==", "bodyText": "Is this required?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496315510", "createdAt": "2020-09-29T01:01:00Z", "author": {"login": "caithagoras"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/BasicSignature.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spi.function;\n+\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.common.type.TypeSignature;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.toList;\n+\n+@JsonPropertyOrder(alphabetic = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTk5OTU0", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-497999954", "createdAt": "2020-09-29T01:24:01Z", "commit": {"oid": "f20634dee0c52acbc897e38d897cb2bef9841727"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDAwMzc2", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-498000376", "createdAt": "2020-09-29T01:25:22Z", "commit": {"oid": "f20634dee0c52acbc897e38d897cb2bef9841727"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MDAwOTYw", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-498000960", "createdAt": "2020-09-29T01:27:14Z", "commit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMToyNzoxNFrOHZVHeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMTo0NjoxN1rOHZVa9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyMjQyNQ==", "bodyText": "What you can do is to return a boolean to indicate success / failure. Throw on the caller side if needed.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496322425", "createdAt": "2020-09-29T01:27:14Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -549,6 +569,34 @@ public void removePreparedStatement(String key)\n         deallocatedPreparedStatements.add(key);\n     }\n \n+    public void addSessionFunction(BasicSignature signature, SqlInvokedFunction function)\n+    {\n+        requireNonNull(signature, \"signature is null\");\n+        requireNonNull(function, \"function is null\");\n+\n+        String serializedSignature = BasicSignatureSerDe.serialize(signature);\n+        String serializedFunction = SqlInvokedFunctionSerDe.serialize(function);\n+\n+        if (session.getSessionFunctions().containsKey(serializedSignature) || addedSessionFunctions.putIfAbsent(serializedSignature, serializedFunction) != null) {\n+            throw new PrestoException(ALREADY_EXISTS, String.format(\"Session function %s has already been defined\", signature));\n+        }\n+    }\n+\n+    public void removeSessionFunction(BasicSignature signature, boolean suppressNotFoundException)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyMjQ5MQ==", "bodyText": "static import String.format", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496322491", "createdAt": "2020-09-29T01:27:31Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -549,6 +569,34 @@ public void removePreparedStatement(String key)\n         deallocatedPreparedStatements.add(key);\n     }\n \n+    public void addSessionFunction(BasicSignature signature, SqlInvokedFunction function)\n+    {\n+        requireNonNull(signature, \"signature is null\");\n+        requireNonNull(function, \"function is null\");\n+\n+        String serializedSignature = BasicSignatureSerDe.serialize(signature);\n+        String serializedFunction = SqlInvokedFunctionSerDe.serialize(function);\n+\n+        if (session.getSessionFunctions().containsKey(serializedSignature) || addedSessionFunctions.putIfAbsent(serializedSignature, serializedFunction) != null) {\n+            throw new PrestoException(ALREADY_EXISTS, String.format(\"Session function %s has already been defined\", signature));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyMjcyNg==", "bodyText": "Unnecessary. If null, line 577 will throw.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496322726", "createdAt": "2020-09-29T01:28:26Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -549,6 +569,34 @@ public void removePreparedStatement(String key)\n         deallocatedPreparedStatements.add(key);\n     }\n \n+    public void addSessionFunction(BasicSignature signature, SqlInvokedFunction function)\n+    {\n+        requireNonNull(signature, \"signature is null\");\n+        requireNonNull(function, \"function is null\");\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNDQxNQ==", "bodyText": "I don't like that they're still Strings in QueryStateMachine - they should have already been deserialized by now.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496324415", "createdAt": "2020-09-29T01:34:58Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -141,6 +146,9 @@\n     private final AtomicReference<Optional<Output>> output = new AtomicReference<>(Optional.empty());\n     private final StateMachine<Optional<QueryInfo>> finalQueryInfo;\n \n+    private final Map<String, String> addedSessionFunctions = new ConcurrentHashMap<>();\n+    private final Set<String> removedSessionFunctions = Sets.newConcurrentHashSet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNDYxOQ==", "bodyText": "Map instead of ImmutableMap", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496324619", "createdAt": "2020-09-29T01:35:40Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/SessionFunctionRegistry.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.metadata;\n+\n+import com.facebook.presto.common.CatalogSchemaName;\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.spi.function.BasicSignature;\n+import com.facebook.presto.spi.function.FunctionHandle;\n+import com.facebook.presto.spi.function.FunctionImplementationType;\n+import com.facebook.presto.spi.function.FunctionMetadata;\n+import com.facebook.presto.spi.function.FunctionNamespaceTransactionHandle;\n+import com.facebook.presto.spi.function.FunctionRegistry;\n+import com.facebook.presto.spi.function.Parameter;\n+import com.facebook.presto.spi.function.ScalarFunctionImplementation;\n+import com.facebook.presto.spi.function.Signature;\n+import com.facebook.presto.spi.function.SqlFunction;\n+import com.facebook.presto.spi.function.SqlInvokedFunction;\n+import com.facebook.presto.spi.function.SqlInvokedScalarFunctionImplementation;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.collect.ImmutableMap;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.server.SerializationUtils.BasicSignatureSerDe;\n+import static com.facebook.presto.server.SerializationUtils.SqlInvokedFunctionSerDe;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static java.util.stream.Collectors.collectingAndThen;\n+import static java.util.stream.Collectors.toMap;\n+\n+public class SessionFunctionRegistry\n+        implements FunctionRegistry<SqlFunction>\n+{\n+    public static final CatalogSchemaName SESSION_NAMESPACE = new CatalogSchemaName(\"presto\", \"session\");\n+\n+    private final ImmutableMap<BasicSignature, SqlInvokedFunction> sessionFunctions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNDc4Ng==", "bodyText": "Does it has to be array list, since sessionFunctions.values() is already a Collection?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496324786", "createdAt": "2020-09-29T01:36:13Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/SessionFunctionRegistry.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.metadata;\n+\n+import com.facebook.presto.common.CatalogSchemaName;\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.spi.function.BasicSignature;\n+import com.facebook.presto.spi.function.FunctionHandle;\n+import com.facebook.presto.spi.function.FunctionImplementationType;\n+import com.facebook.presto.spi.function.FunctionMetadata;\n+import com.facebook.presto.spi.function.FunctionNamespaceTransactionHandle;\n+import com.facebook.presto.spi.function.FunctionRegistry;\n+import com.facebook.presto.spi.function.Parameter;\n+import com.facebook.presto.spi.function.ScalarFunctionImplementation;\n+import com.facebook.presto.spi.function.Signature;\n+import com.facebook.presto.spi.function.SqlFunction;\n+import com.facebook.presto.spi.function.SqlInvokedFunction;\n+import com.facebook.presto.spi.function.SqlInvokedScalarFunctionImplementation;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.collect.ImmutableMap;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.server.SerializationUtils.BasicSignatureSerDe;\n+import static com.facebook.presto.server.SerializationUtils.SqlInvokedFunctionSerDe;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static java.util.stream.Collectors.collectingAndThen;\n+import static java.util.stream.Collectors.toMap;\n+\n+public class SessionFunctionRegistry\n+        implements FunctionRegistry<SqlFunction>\n+{\n+    public static final CatalogSchemaName SESSION_NAMESPACE = new CatalogSchemaName(\"presto\", \"session\");\n+\n+    private final ImmutableMap<BasicSignature, SqlInvokedFunction> sessionFunctions;\n+\n+    public SessionFunctionRegistry(Map<String, String> sessionFunctions)\n+    {\n+        this.sessionFunctions = sessionFunctions.entrySet().stream().collect(collectingAndThen(toMap(\n+                e -> BasicSignatureSerDe.deserialize(e.getKey()),\n+                e -> SqlInvokedFunctionSerDe.deserialize(e.getValue())), ImmutableMap::copyOf));\n+    }\n+\n+    @Override\n+    public Collection<SqlFunction> listFunctions()\n+    {\n+        return new ArrayList<>(sessionFunctions.values());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNTE0NA==", "bodyText": "nit: just call this sqlFunction", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496325144", "createdAt": "2020-09-29T01:37:34Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/SessionFunctionRegistry.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.metadata;\n+\n+import com.facebook.presto.common.CatalogSchemaName;\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.spi.function.BasicSignature;\n+import com.facebook.presto.spi.function.FunctionHandle;\n+import com.facebook.presto.spi.function.FunctionImplementationType;\n+import com.facebook.presto.spi.function.FunctionMetadata;\n+import com.facebook.presto.spi.function.FunctionNamespaceTransactionHandle;\n+import com.facebook.presto.spi.function.FunctionRegistry;\n+import com.facebook.presto.spi.function.Parameter;\n+import com.facebook.presto.spi.function.ScalarFunctionImplementation;\n+import com.facebook.presto.spi.function.Signature;\n+import com.facebook.presto.spi.function.SqlFunction;\n+import com.facebook.presto.spi.function.SqlInvokedFunction;\n+import com.facebook.presto.spi.function.SqlInvokedScalarFunctionImplementation;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.collect.ImmutableMap;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.server.SerializationUtils.BasicSignatureSerDe;\n+import static com.facebook.presto.server.SerializationUtils.SqlInvokedFunctionSerDe;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static java.util.stream.Collectors.collectingAndThen;\n+import static java.util.stream.Collectors.toMap;\n+\n+public class SessionFunctionRegistry\n+        implements FunctionRegistry<SqlFunction>\n+{\n+    public static final CatalogSchemaName SESSION_NAMESPACE = new CatalogSchemaName(\"presto\", \"session\");\n+\n+    private final ImmutableMap<BasicSignature, SqlInvokedFunction> sessionFunctions;\n+\n+    public SessionFunctionRegistry(Map<String, String> sessionFunctions)\n+    {\n+        this.sessionFunctions = sessionFunctions.entrySet().stream().collect(collectingAndThen(toMap(\n+                e -> BasicSignatureSerDe.deserialize(e.getKey()),\n+                e -> SqlInvokedFunctionSerDe.deserialize(e.getValue())), ImmutableMap::copyOf));\n+    }\n+\n+    @Override\n+    public Collection<SqlFunction> listFunctions()\n+    {\n+        return new ArrayList<>(sessionFunctions.values());\n+    }\n+\n+    @Override\n+    public Collection<SqlFunction> getFunctions(Optional<? extends FunctionNamespaceTransactionHandle> transactionHandle, QualifiedFunctionName functionName)\n+    {\n+        return sessionFunctions.entrySet().stream()\n+                .filter(e -> e.getKey().getName().getFunctionName().equals(functionName.getFunctionName()))\n+                .map(Map.Entry::getValue)\n+                .collect(toImmutableList());\n+    }\n+\n+    @Override\n+    public FunctionHandle getFunctionHandle(Optional<? extends FunctionNamespaceTransactionHandle> transactionHandle, Signature signature)\n+    {\n+        return new SessionFunctionHandle(sessionFunctions.get(new BasicSignature(signature)));\n+    }\n+\n+    @Override\n+    public FunctionMetadata getFunctionMetadata(FunctionHandle functionHandle)\n+    {\n+        checkArgument(functionHandle instanceof SessionFunctionHandle, \"Expected SessionFunctionHandle, got %s\", functionHandle.getClass());\n+        return ((SessionFunctionHandle) functionHandle).getFunctionMetadata();\n+    }\n+\n+    @Override\n+    public ScalarFunctionImplementation getScalarFunctionImplementation(FunctionHandle functionHandle)\n+    {\n+        checkArgument(functionHandle instanceof SessionFunctionHandle, \"Expected SessionFunctionHandle, got %s\", functionHandle.getClass());\n+        return ((SessionFunctionHandle) functionHandle).getScalarFunctionImplementation();\n+    }\n+\n+    public static class SessionFunctionHandle\n+            implements FunctionHandle\n+    {\n+        public final SqlInvokedFunction sqlFunction;\n+\n+        @JsonCreator\n+        public SessionFunctionHandle(@JsonProperty(\"sqlFunction\") SqlInvokedFunction sqlInvokedFunction)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNTE2Mg==", "bodyText": "nit: requireNonNull", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496325162", "createdAt": "2020-09-29T01:37:40Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/SessionFunctionRegistry.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.metadata;\n+\n+import com.facebook.presto.common.CatalogSchemaName;\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.spi.function.BasicSignature;\n+import com.facebook.presto.spi.function.FunctionHandle;\n+import com.facebook.presto.spi.function.FunctionImplementationType;\n+import com.facebook.presto.spi.function.FunctionMetadata;\n+import com.facebook.presto.spi.function.FunctionNamespaceTransactionHandle;\n+import com.facebook.presto.spi.function.FunctionRegistry;\n+import com.facebook.presto.spi.function.Parameter;\n+import com.facebook.presto.spi.function.ScalarFunctionImplementation;\n+import com.facebook.presto.spi.function.Signature;\n+import com.facebook.presto.spi.function.SqlFunction;\n+import com.facebook.presto.spi.function.SqlInvokedFunction;\n+import com.facebook.presto.spi.function.SqlInvokedScalarFunctionImplementation;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.collect.ImmutableMap;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.server.SerializationUtils.BasicSignatureSerDe;\n+import static com.facebook.presto.server.SerializationUtils.SqlInvokedFunctionSerDe;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static java.util.stream.Collectors.collectingAndThen;\n+import static java.util.stream.Collectors.toMap;\n+\n+public class SessionFunctionRegistry\n+        implements FunctionRegistry<SqlFunction>\n+{\n+    public static final CatalogSchemaName SESSION_NAMESPACE = new CatalogSchemaName(\"presto\", \"session\");\n+\n+    private final ImmutableMap<BasicSignature, SqlInvokedFunction> sessionFunctions;\n+\n+    public SessionFunctionRegistry(Map<String, String> sessionFunctions)\n+    {\n+        this.sessionFunctions = sessionFunctions.entrySet().stream().collect(collectingAndThen(toMap(\n+                e -> BasicSignatureSerDe.deserialize(e.getKey()),\n+                e -> SqlInvokedFunctionSerDe.deserialize(e.getValue())), ImmutableMap::copyOf));\n+    }\n+\n+    @Override\n+    public Collection<SqlFunction> listFunctions()\n+    {\n+        return new ArrayList<>(sessionFunctions.values());\n+    }\n+\n+    @Override\n+    public Collection<SqlFunction> getFunctions(Optional<? extends FunctionNamespaceTransactionHandle> transactionHandle, QualifiedFunctionName functionName)\n+    {\n+        return sessionFunctions.entrySet().stream()\n+                .filter(e -> e.getKey().getName().getFunctionName().equals(functionName.getFunctionName()))\n+                .map(Map.Entry::getValue)\n+                .collect(toImmutableList());\n+    }\n+\n+    @Override\n+    public FunctionHandle getFunctionHandle(Optional<? extends FunctionNamespaceTransactionHandle> transactionHandle, Signature signature)\n+    {\n+        return new SessionFunctionHandle(sessionFunctions.get(new BasicSignature(signature)));\n+    }\n+\n+    @Override\n+    public FunctionMetadata getFunctionMetadata(FunctionHandle functionHandle)\n+    {\n+        checkArgument(functionHandle instanceof SessionFunctionHandle, \"Expected SessionFunctionHandle, got %s\", functionHandle.getClass());\n+        return ((SessionFunctionHandle) functionHandle).getFunctionMetadata();\n+    }\n+\n+    @Override\n+    public ScalarFunctionImplementation getScalarFunctionImplementation(FunctionHandle functionHandle)\n+    {\n+        checkArgument(functionHandle instanceof SessionFunctionHandle, \"Expected SessionFunctionHandle, got %s\", functionHandle.getClass());\n+        return ((SessionFunctionHandle) functionHandle).getScalarFunctionImplementation();\n+    }\n+\n+    public static class SessionFunctionHandle\n+            implements FunctionHandle\n+    {\n+        public final SqlInvokedFunction sqlFunction;\n+\n+        @JsonCreator\n+        public SessionFunctionHandle(@JsonProperty(\"sqlFunction\") SqlInvokedFunction sqlInvokedFunction)\n+        {\n+            this.sqlFunction = sqlInvokedFunction;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNTE4Mg==", "bodyText": "private?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496325182", "createdAt": "2020-09-29T01:37:44Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/SessionFunctionRegistry.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.metadata;\n+\n+import com.facebook.presto.common.CatalogSchemaName;\n+import com.facebook.presto.common.function.QualifiedFunctionName;\n+import com.facebook.presto.spi.function.BasicSignature;\n+import com.facebook.presto.spi.function.FunctionHandle;\n+import com.facebook.presto.spi.function.FunctionImplementationType;\n+import com.facebook.presto.spi.function.FunctionMetadata;\n+import com.facebook.presto.spi.function.FunctionNamespaceTransactionHandle;\n+import com.facebook.presto.spi.function.FunctionRegistry;\n+import com.facebook.presto.spi.function.Parameter;\n+import com.facebook.presto.spi.function.ScalarFunctionImplementation;\n+import com.facebook.presto.spi.function.Signature;\n+import com.facebook.presto.spi.function.SqlFunction;\n+import com.facebook.presto.spi.function.SqlInvokedFunction;\n+import com.facebook.presto.spi.function.SqlInvokedScalarFunctionImplementation;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.collect.ImmutableMap;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.server.SerializationUtils.BasicSignatureSerDe;\n+import static com.facebook.presto.server.SerializationUtils.SqlInvokedFunctionSerDe;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.collect.ImmutableList.toImmutableList;\n+import static java.util.stream.Collectors.collectingAndThen;\n+import static java.util.stream.Collectors.toMap;\n+\n+public class SessionFunctionRegistry\n+        implements FunctionRegistry<SqlFunction>\n+{\n+    public static final CatalogSchemaName SESSION_NAMESPACE = new CatalogSchemaName(\"presto\", \"session\");\n+\n+    private final ImmutableMap<BasicSignature, SqlInvokedFunction> sessionFunctions;\n+\n+    public SessionFunctionRegistry(Map<String, String> sessionFunctions)\n+    {\n+        this.sessionFunctions = sessionFunctions.entrySet().stream().collect(collectingAndThen(toMap(\n+                e -> BasicSignatureSerDe.deserialize(e.getKey()),\n+                e -> SqlInvokedFunctionSerDe.deserialize(e.getValue())), ImmutableMap::copyOf));\n+    }\n+\n+    @Override\n+    public Collection<SqlFunction> listFunctions()\n+    {\n+        return new ArrayList<>(sessionFunctions.values());\n+    }\n+\n+    @Override\n+    public Collection<SqlFunction> getFunctions(Optional<? extends FunctionNamespaceTransactionHandle> transactionHandle, QualifiedFunctionName functionName)\n+    {\n+        return sessionFunctions.entrySet().stream()\n+                .filter(e -> e.getKey().getName().getFunctionName().equals(functionName.getFunctionName()))\n+                .map(Map.Entry::getValue)\n+                .collect(toImmutableList());\n+    }\n+\n+    @Override\n+    public FunctionHandle getFunctionHandle(Optional<? extends FunctionNamespaceTransactionHandle> transactionHandle, Signature signature)\n+    {\n+        return new SessionFunctionHandle(sessionFunctions.get(new BasicSignature(signature)));\n+    }\n+\n+    @Override\n+    public FunctionMetadata getFunctionMetadata(FunctionHandle functionHandle)\n+    {\n+        checkArgument(functionHandle instanceof SessionFunctionHandle, \"Expected SessionFunctionHandle, got %s\", functionHandle.getClass());\n+        return ((SessionFunctionHandle) functionHandle).getFunctionMetadata();\n+    }\n+\n+    @Override\n+    public ScalarFunctionImplementation getScalarFunctionImplementation(FunctionHandle functionHandle)\n+    {\n+        checkArgument(functionHandle instanceof SessionFunctionHandle, \"Expected SessionFunctionHandle, got %s\", functionHandle.getClass());\n+        return ((SessionFunctionHandle) functionHandle).getScalarFunctionImplementation();\n+    }\n+\n+    public static class SessionFunctionHandle\n+            implements FunctionHandle\n+    {\n+        public final SqlInvokedFunction sqlFunction;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNjA2OA==", "bodyText": "Once maps are deserialized from the http request. I don't think we have a reason to keep them as Map<String, String>. We should just make it return Map<BasicSignature, SqlInvokedFunction> here.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496326068", "createdAt": "2020-09-29T01:41:06Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/server/HttpRequestSessionContext.java", "diffHunk": "@@ -268,6 +272,27 @@ private static void assertRequest(boolean expression, String format, Object... a\n         }\n     }\n \n+    private static Map<String, String> parseSessionFunctionHeader(HttpServletRequest req)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMyNzQxNQ==", "bodyText": "Since we're doing any customized json serde here, we should just use the higher level API JsonCodec instead. This class won't be necessary.\npublic static JsonCodec<BasicSignature> JSON_CODEC = jsonCodec(BasicSignature.class);", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r496327415", "createdAt": "2020-09-29T01:46:17Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/server/SerializationUtils.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.server;\n+\n+import com.facebook.airlift.json.ObjectMapperProvider;\n+import com.facebook.presto.spi.function.BasicSignature;\n+import com.facebook.presto.spi.function.SqlInvokedFunction;\n+\n+import java.io.IOException;\n+\n+public final class SerializationUtils", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "731a2269b1050d946b62cc420c25b12914bfec6b"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f20634dee0c52acbc897e38d897cb2bef9841727", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/f20634dee0c52acbc897e38d897cb2bef9841727", "committedDate": "2020-09-25T22:09:16Z", "message": "Add support for temporary functions in SHOW FUNCTIONS and SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/ed3fecb66911fee8035d728deebf9875bd4a4d73", "committedDate": "2020-10-08T18:36:47Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MDk0Mjk2", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-505094296", "createdAt": "2020-10-08T19:19:59Z", "commit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxOToxOTo1OVrOHetEQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxOTo1NjowNFrOHeuNvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk1NzY5Nw==", "bodyText": "This might be masking ACL issues? Or is past that?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501957697", "createdAt": "2020-10-08T19:19:59Z", "author": {"login": "kaikalur"}, "path": "presto-cli/src/main/java/com/facebook/presto/cli/Console.java", "diffHunk": "@@ -356,6 +357,14 @@ private static boolean process(QueryRunner queryRunner, String sql, OutputFormat\n                 builder = builder.withPreparedStatements(preparedStatements);\n             }\n \n+            // update session functions if present\n+            if (!query.getAddedSessionFunctions().isEmpty() || !query.getRemovedSessionFunctions().isEmpty()) {\n+                Map<String, String> sessionFunctions = new HashMap<>(session.getSessionFunctions());\n+                sessionFunctions.putAll(query.getAddedSessionFunctions());\n+                sessionFunctions.keySet().removeAll(query.getRemovedSessionFunctions());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2MTA5Mg==", "bodyText": "How about error cases? Also, can they overwrite an existing function temporarily? If so, we want a test case for that as well.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501961092", "createdAt": "2020-10-08T19:26:31Z", "author": {"login": "kaikalur"}, "path": "presto-cli/src/test/java/com/facebook/presto/cli/TestTemporaryFunctions.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.cli;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.client.PrestoHeaders.PRESTO_ADDED_SESSION_FUNCTION;\n+import static com.facebook.presto.client.PrestoHeaders.PRESTO_REMOVED_SESSION_FUNCTION;\n+import static com.facebook.presto.client.PrestoHeaders.PRESTO_SESSION_FUNCTION;\n+\n+@Test\n+public class TestTemporaryFunctions\n+        extends AbstractCliTest\n+{\n+    @Test\n+    public void testAddAndDropTempFunctions()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2NjUwNA==", "bodyText": "Also test CREATE OR REPLACE", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501966504", "createdAt": "2020-10-08T19:36:18Z", "author": {"login": "kaikalur"}, "path": "presto-cli/src/test/java/com/facebook/presto/cli/TestTemporaryFunctions.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.cli;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n+import org.testng.annotations.Test;\n+\n+import static com.facebook.presto.client.PrestoHeaders.PRESTO_ADDED_SESSION_FUNCTION;\n+import static com.facebook.presto.client.PrestoHeaders.PRESTO_REMOVED_SESSION_FUNCTION;\n+import static com.facebook.presto.client.PrestoHeaders.PRESTO_SESSION_FUNCTION;\n+\n+@Test\n+public class TestTemporaryFunctions\n+        extends AbstractCliTest\n+{\n+    @Test\n+    public void testAddAndDropTempFunctions()\n+            throws InterruptedException\n+    {\n+        server.enqueue(createMockResponse().addHeader(PRESTO_ADDED_SESSION_FUNCTION, \"foo=foofunction\"));\n+        server.enqueue(createMockResponse().addHeader(PRESTO_ADDED_SESSION_FUNCTION, \"bar=barfunction\"));\n+        server.enqueue(createMockResponse());\n+        server.enqueue(createMockResponse().addHeader(PRESTO_REMOVED_SESSION_FUNCTION, \"foo\"));\n+        server.enqueue(createMockResponse());\n+        server.enqueue(createMockResponse().addHeader(PRESTO_REMOVED_SESSION_FUNCTION, \"bar\"));\n+        server.enqueue(createMockResponse());\n+\n+        executeQueries(ImmutableList.of(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2NjU1Nw==", "bodyText": "From the logic, it's not clear if we are supporting replace.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501966557", "createdAt": "2020-10-08T19:36:24Z", "author": {"login": "kaikalur"}, "path": "presto-docs/src/main/sphinx/sql/create-function.rst", "diffHunk": "@@ -7,7 +7,7 @@ Synopsis\n \n .. code-block:: none\n \n-    CREATE [ OR REPLACE ] FUNCTION\n+    CREATE [ OR REPLACE ] [TEMPORARY] FUNCTION", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2NjkyOQ==", "bodyText": "Do we have a link to what \"current session\" is? Also, is there a TTL?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501966929", "createdAt": "2020-10-08T19:37:06Z", "author": {"login": "kaikalur"}, "path": "presto-docs/src/main/sphinx/sql/create-function.rst", "diffHunk": "@@ -25,11 +25,18 @@ Description\n \n Create a new function with the specified definition.\n \n-Each function is uniquely identified by its qualified function name\n+When ``TEMPORARY`` is specified, the created function is valid and visible\n+within the current session, but no persistent entry is made.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2NzUyNw==", "bodyText": "I think it should be descriptive, not prescriprive. Say:\nWhen temporary is specified, a temporary function with the given signature is dropped.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501967527", "createdAt": "2020-10-08T19:38:13Z", "author": {"login": "kaikalur"}, "path": "presto-docs/src/main/sphinx/sql/drop-function.rst", "diffHunk": "@@ -7,14 +7,16 @@ Synopsis\n \n .. code-block:: none\n \n-    DROP FUNCTION [ IF EXISTS ] qualified_function_name [ ( parameter_type[, ...] ) ]\n+    DROP [TEMPORARY] FUNCTION [ IF EXISTS ] qualified_function_name [ ( parameter_type[, ...] ) ]\n \n \n Description\n -----------\n \n Drop an existing function.\n \n+The ``TEMPORARY`` modifier must be used to drop a temporary function.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2ODA5OQ==", "bodyText": "Can we make it a single api to get all visible functions instead of adding the second param through out?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501968099", "createdAt": "2020-10-08T19:39:25Z", "author": {"login": "kaikalur"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/orc/OrcSelectivePageSourceFactory.java", "diffHunk": "@@ -640,13 +640,13 @@ private static OrcPredicate toOrcPredicate(TupleDomain<Subfield> domainPredicate\n         filter = and(extractDynamicFilterResult.getStaticConjuncts());\n \n         if (!isAdaptiveFilterReorderingEnabled(session)) {\n-            filterFunctions.add(new FilterFunction(session.getSqlFunctionProperties(), determinismEvaluator.isDeterministic(filter), predicateCompiler.compilePredicate(session.getSqlFunctionProperties(), filter).get()));\n+            filterFunctions.add(new FilterFunction(session.getSqlFunctionProperties(), determinismEvaluator.isDeterministic(filter), predicateCompiler.compilePredicate(session.getSqlFunctionProperties(), session.getSessionFunctions(), filter).get()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk3Mzc3Ng==", "bodyText": "isReplace check here?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501973776", "createdAt": "2020-10-08T19:50:34Z", "author": {"login": "kaikalur"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/CreateFunctionTask.java", "diffHunk": "@@ -82,13 +85,21 @@ public String explain(CreateFunction statement, List<Expression> parameters)\n             throw new PrestoException(NOT_SUPPORTED, \"Invoking a dynamically registered function in SQL function body is not supported\");\n         }\n \n-        metadata.getFunctionManager().createFunction(createSqlInvokedFunction(statement, metadata, analysis), statement.isReplace());\n+        SqlInvokedFunction function = createSqlInvokedFunction(statement, metadata, analysis);\n+        if (statement.isTemporary()) {\n+            stateMachine.addSessionFunction(new BasicSignature(function.getSignature()), function);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk3NDIwMw==", "bodyText": "Where is the error if the function doesn't exist?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501974203", "createdAt": "2020-10-08T19:51:30Z", "author": {"login": "kaikalur"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/DropFunctionTask.java", "diffHunk": "@@ -53,19 +58,29 @@ public String getName()\n     @Override\n     public String explain(DropFunction statement, List<Expression> parameters)\n     {\n-        return \"DROP FUNCTION \" + statement.getFunctionName();\n+        return format(\"DROP %sFUNCTION %s\", statement.isTemporary() ? \"TEMPORARY \" : \"\", statement.getFunctionName());\n     }\n \n     @Override\n     public ListenableFuture<?> execute(DropFunction statement, TransactionManager transactionManager, Metadata metadata, AccessControl accessControl, QueryStateMachine stateMachine, List<Expression> parameters)\n     {\n         Analyzer analyzer = new Analyzer(stateMachine.getSession(), metadata, sqlParser, accessControl, Optional.empty(), parameters, stateMachine.getWarningCollector());\n         analyzer.analyze(statement);\n+        Optional<List<TypeSignature>> parameterTypes = statement.getParameterTypes().map(types -> types.stream().map(TypeSignature::parseTypeSignature).collect(toImmutableList()));\n \n-        metadata.getFunctionManager().dropFunction(\n-                qualifyFunctionName(statement.getFunctionName()),\n-                statement.getParameterTypes().map(types -> types.stream().map(TypeSignature::parseTypeSignature).collect(toImmutableList())),\n-                statement.isExists());\n+        if (statement.isTemporary()) {\n+            stateMachine.removeSessionFunction(\n+                    new BasicSignature(\n+                            QualifiedFunctionName.of(SESSION_NAMESPACE, statement.getFunctionName().getSuffix()),\n+                            parameterTypes.orElse(emptyList())),\n+                    statement.isExists());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk3NjUxMQ==", "bodyText": "Is it just a refactor? Or did you have more changes too? If it's just a simple refactor, may be move it out.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r501976511", "createdAt": "2020-10-08T19:56:04Z", "author": {"login": "kaikalur"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/FunctionSignatureResolver.java", "diffHunk": "@@ -0,0 +1,325 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTQxNzA2", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-506941706", "createdAt": "2020-10-12T21:56:35Z", "commit": {"oid": "d708def2c3bdab58b07b1c038fab5ac7c3ea2a42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMTo1NjozNlrOHgOiLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMTo1NjozNlrOHgOiLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU1NDYwNQ==", "bodyText": "ImmutableMap.copyOf\nImmutableSet.copyOf", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r503554605", "createdAt": "2020-10-12T21:56:36Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryInfo.java", "diffHunk": "@@ -170,6 +178,8 @@ public QueryInfo(\n         this.queryType = queryType;\n         this.failedTasks = failedTasks;\n         this.runtimeOptimizedStages = runtimeOptimizedStages;\n+        this.addedSessionFunctions = addedSessionFunctions;\n+        this.removedSessionFunctions = removedSessionFunctions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d708def2c3bdab58b07b1c038fab5ac7c3ea2a42"}, "originalPosition": 43}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/ed3fecb66911fee8035d728deebf9875bd4a4d73", "committedDate": "2020-10-08T18:36:47Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "4c3da6e36d487e4a1b076da535ae877a41dd8747", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4c3da6e36d487e4a1b076da535ae877a41dd8747", "committedDate": "2020-12-30T14:06:28Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c3da6e36d487e4a1b076da535ae877a41dd8747", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4c3da6e36d487e4a1b076da535ae877a41dd8747", "committedDate": "2020-12-30T14:06:28Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "6c7c7a553a85ade64bb479f3998a61ac97b38986", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6c7c7a553a85ade64bb479f3998a61ac97b38986", "committedDate": "2020-12-31T01:14:38Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c7c7a553a85ade64bb479f3998a61ac97b38986", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6c7c7a553a85ade64bb479f3998a61ac97b38986", "committedDate": "2020-12-31T01:14:38Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "c24fe2197befb08bb3fb24befecfd2605f4e6ab0", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/c24fe2197befb08bb3fb24befecfd2605f4e6ab0", "committedDate": "2020-12-31T01:26:14Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c24fe2197befb08bb3fb24befecfd2605f4e6ab0", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/c24fe2197befb08bb3fb24befecfd2605f4e6ab0", "committedDate": "2020-12-31T01:26:14Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "0af43ff2c2d5f860a80b258dc12247e2f622ea6f", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/0af43ff2c2d5f860a80b258dc12247e2f622ea6f", "committedDate": "2020-12-31T02:13:58Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0af43ff2c2d5f860a80b258dc12247e2f622ea6f", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/0af43ff2c2d5f860a80b258dc12247e2f622ea6f", "committedDate": "2020-12-31T02:13:58Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "8033f7ac2c421783b22c5aabdca17df73bf6264a", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/8033f7ac2c421783b22c5aabdca17df73bf6264a", "committedDate": "2020-12-31T05:44:03Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMzUyMTMy", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-561352132", "createdAt": "2021-01-04T21:18:41Z", "commit": {"oid": "af235588b4449825fb46f3e92726ef9c60e92efa"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMToxODo0MVrOIOBbZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMToyOToxMVrOIOBvLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU3NDM3Mw==", "bodyText": "Related: if you are introducing this, maybe worth rewrite listFunctions to use this as well. But this doesn't need to be in this diff / PR.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r551574373", "createdAt": "2021-01-04T21:18:41Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/FunctionAndTypeManager.java", "diffHunk": "@@ -253,6 +253,11 @@ public void registerBuiltInFunctions(List<? extends SqlFunction> functions)\n                 .collect(toImmutableList());\n     }\n \n+    public Collection<SqlFunction> listBuiltInFunctions()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af235588b4449825fb46f3e92726ef9c60e92efa"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU3NjA2MQ==", "bodyText": "What would happen if I create foo, drop foo then create foo again? Why do we need to track removed functions rather than just removing them?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r551576061", "createdAt": "2021-01-04T21:22:15Z", "author": {"login": "rongrong"}, "path": "presto-cli/src/main/java/com/facebook/presto/cli/Console.java", "diffHunk": "@@ -356,6 +357,14 @@ private static boolean process(QueryRunner queryRunner, String sql, OutputFormat\n                 builder = builder.withPreparedStatements(preparedStatements);\n             }\n \n+            // update session functions if present\n+            if (!query.getAddedSessionFunctions().isEmpty() || !query.getRemovedSessionFunctions().isEmpty()) {\n+                Map<String, String> sessionFunctions = new HashMap<>(session.getSessionFunctions());\n+                sessionFunctions.putAll(query.getAddedSessionFunctions());\n+                sessionFunctions.keySet().removeAll(query.getRemovedSessionFunctions());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk1NzY5Nw=="}, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU3NzYxNA==", "bodyText": "Should this change go into the first commit?", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r551577614", "createdAt": "2021-01-04T21:25:30Z", "author": {"login": "rongrong"}, "path": "presto-docs/src/main/sphinx/sql/drop-function.rst", "diffHunk": "@@ -7,14 +7,16 @@ Synopsis\n \n .. code-block:: none\n \n-    DROP FUNCTION [ IF EXISTS ] qualified_function_name [ ( parameter_type[, ...] ) ]\n+    DROP [TEMPORARY] FUNCTION [ IF EXISTS ] qualified_function_name [ ( parameter_type[, ...] ) ]\n \n \n Description\n -----------\n \n Drop an existing function.\n \n+The ``TEMPORARY`` modifier must be used to drop a temporary function.\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2NzUyNw=="}, "originalCommit": {"oid": "ed3fecb66911fee8035d728deebf9875bd4a4d73"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU3ODc3MQ==", "bodyText": "What about calling this FunctionSignature? I don't really get what BasicSignature is supposed to mean.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r551578771", "createdAt": "2021-01-04T21:27:51Z", "author": {"login": "rongrong"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/BasicSignature.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spi.function;\n+\n+import com.facebook.presto.common.QualifiedObjectName;\n+import com.facebook.presto.common.type.TypeSignature;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.joining;\n+\n+public class BasicSignature", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68f075180070d8ab3602b77d03fe232fdd10bb47"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU3OTQzNw==", "bodyText": "Also, this class looks the same as the SqlFunctionId so maybe you want to just use that.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r551579437", "createdAt": "2021-01-04T21:29:11Z", "author": {"login": "rongrong"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/BasicSignature.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spi.function;\n+\n+import com.facebook.presto.common.QualifiedObjectName;\n+import com.facebook.presto.common.type.TypeSignature;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+import static java.lang.String.format;\n+import static java.util.Objects.requireNonNull;\n+import static java.util.stream.Collectors.joining;\n+\n+public class BasicSignature", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU3ODc3MQ=="}, "originalCommit": {"oid": "68f075180070d8ab3602b77d03fe232fdd10bb47"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8033f7ac2c421783b22c5aabdca17df73bf6264a", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/8033f7ac2c421783b22c5aabdca17df73bf6264a", "committedDate": "2020-12-31T05:44:03Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "e9547a05a87e7730f2ce1d8f63c4e32b8f9d7b25", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/e9547a05a87e7730f2ce1d8f63c4e32b8f9d7b25", "committedDate": "2021-01-13T23:02:03Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9547a05a87e7730f2ce1d8f63c4e32b8f9d7b25", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/e9547a05a87e7730f2ce1d8f63c4e32b8f9d7b25", "committedDate": "2021-01-13T23:02:03Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "d3360755b32a875ddb10423cb45ef039f2dc886c", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/d3360755b32a875ddb10423cb45ef039f2dc886c", "committedDate": "2021-01-14T01:04:25Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyNzMxNTc5", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-572731579", "createdAt": "2021-01-20T23:07:03Z", "commit": {"oid": "d3360755b32a875ddb10423cb45ef039f2dc886c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyNzUzNjA1", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-572753605", "createdAt": "2021-01-20T23:18:36Z", "commit": {"oid": "d3360755b32a875ddb10423cb45ef039f2dc886c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQyMzoxODozN1rOIXXZbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQyMzoxODozN1rOIXXZbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTM3MTUwMA==", "bodyText": "I kinda prefer this to be function_name(type,type,type...). Looks more like a function signature.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r561371500", "createdAt": "2021-01-20T23:18:37Z", "author": {"login": "rongrong"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/SqlFunctionId.java", "diffHunk": "@@ -86,4 +84,29 @@ public String toString()\n                 .collect(joining(\", \"));\n         return format(\"%s(%s)\", functionName, arguments);\n     }\n+\n+    @JsonValue\n+    public String toJsonString()\n+    {\n+        return format(\"%s;%s\", functionName.toString(), argumentTypes.stream().map(TypeSignature::toString).collect(joining(\";\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3360755b32a875ddb10423cb45ef039f2dc886c"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyNzk0MjE0", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-572794214", "createdAt": "2021-01-20T23:58:29Z", "commit": {"oid": "d3360755b32a875ddb10423cb45ef039f2dc886c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQyMzo1ODoyOVrOIXZKsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQyMzo1ODoyOVrOIXZKsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTQwMDQ5OQ==", "bodyText": "The result of the SHOW CREATE foo should be a CREATE TEMPORARY FUNCTION statement. The result SQL by itself is not semantically valid, as it is attempting to create a permanent function foo without specifying catalog and schema.", "url": "https://github.com/prestodb/presto/pull/15033#discussion_r561400499", "createdAt": "2021-01-20T23:58:29Z", "author": {"login": "caithagoras"}, "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestSqlFunctions.java", "diffHunk": "@@ -251,6 +251,31 @@ public void testTemporarySqlFunctions()\n         assertQuery(createSessionWithTempFunctionFoo(), \"SELECT foo(foo(2))\", \"SELECT 8\");\n     }\n \n+    @Test\n+    public void testShowTemporaryFunctions()\n+    {\n+        MaterializedResult result = computeActual(createSessionWithTempFunctionFoo(), \"SHOW FUNCTIONS\");\n+        MaterializedRow row = result.getMaterializedRows().get(result.getMaterializedRows().size() - 1);\n+        assertEquals(row.getField(0), \"foo\");\n+    }\n+\n+    @Test\n+    public void testShowCreateTemporaryFunction()\n+    {\n+        MaterializedRow result = computeActual(createSessionWithTempFunctionFoo(), \"SHOW CREATE FUNCTION foo(bigint)\").getMaterializedRows().get(0);\n+        String createFunctionFooFormatted = \"CREATE FUNCTION foo (\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3360755b32a875ddb10423cb45ef039f2dc886c"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3360755b32a875ddb10423cb45ef039f2dc886c", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/d3360755b32a875ddb10423cb45ef039f2dc886c", "committedDate": "2021-01-14T01:04:25Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "33822f191b1d3e96d2afabd66c872d991a1d6f9d", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/33822f191b1d3e96d2afabd66c872d991a1d6f9d", "committedDate": "2021-01-27T00:32:01Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc3NzQ2NTM0", "url": "https://github.com/prestodb/presto/pull/15033#pullrequestreview-577746534", "createdAt": "2021-01-27T20:50:52Z", "commit": {"oid": "33822f191b1d3e96d2afabd66c872d991a1d6f9d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c735273ea6d6aa96d0801bd4526aa8d9655f400a", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/c735273ea6d6aa96d0801bd4526aa8d9655f400a", "committedDate": "2021-01-27T21:11:15Z", "message": "Add syntax support for CREATE/DROP TEMPORARY FUNCTION"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "427709785dc825e78ea10dcc4255107bc387e489", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/427709785dc825e78ea10dcc4255107bc387e489", "committedDate": "2021-01-27T21:11:15Z", "message": "Refactor client-side tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fee41ad894313fddc4c399ee798bc45f8d7e9689", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/fee41ad894313fddc4c399ee798bc45f8d7e9689", "committedDate": "2021-01-27T21:11:15Z", "message": "Add client-side support for temporary functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1a42cf8ccf0db6800fc32ca05c3c579ed518de", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/1d1a42cf8ccf0db6800fc32ca05c3c579ed518de", "committedDate": "2021-01-27T21:11:15Z", "message": "Refactor task tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27d97f87bd12d8da09baf52577257d67fd9859c3", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/27d97f87bd12d8da09baf52577257d67fd9859c3", "committedDate": "2021-01-27T21:11:15Z", "message": "Add server-side support for temporary functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33822f191b1d3e96d2afabd66c872d991a1d6f9d", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/33822f191b1d3e96d2afabd66c872d991a1d6f9d", "committedDate": "2021-01-27T00:32:01Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "9e5c2fd16abe35934328fd6436a7ebaeefad0ccc", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/9e5c2fd16abe35934328fd6436a7ebaeefad0ccc", "committedDate": "2021-01-27T21:11:15Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d5e01458cdce5434fd71bb628deb30d52383a99", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4d5e01458cdce5434fd71bb628deb30d52383a99", "committedDate": "2021-01-27T21:51:17Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e5c2fd16abe35934328fd6436a7ebaeefad0ccc", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/9e5c2fd16abe35934328fd6436a7ebaeefad0ccc", "committedDate": "2021-01-27T21:11:15Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}, "afterCommit": {"oid": "4d5e01458cdce5434fd71bb628deb30d52383a99", "author": {"user": {"login": "prithvip", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4d5e01458cdce5434fd71bb628deb30d52383a99", "committedDate": "2021-01-27T21:51:17Z", "message": "Add support for temp functions in SHOW FUNCTIONS/SHOW CREATE FUNCTION"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 253, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}