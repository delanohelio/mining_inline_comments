{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NzE4OTU0", "number": 14496, "title": "Presto on Spark small refactorings and bug fixes", "bodyText": "Required to prepare Presto on Spark for running AbstractTestQueries\n== NO RELEASE NOTE ==", "createdAt": "2020-05-07T14:21:32Z", "url": "https://github.com/prestodb/presto/pull/14496", "merged": true, "mergeCommit": {"oid": "83882e0c29fb1316a020ad01464927174680fff6"}, "closed": true, "closedAt": "2020-05-11T21:21:41Z", "author": {"login": "arhimondr"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce-HErgBqjMzMTMxNTI2MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgVjR6ABqjMzMjQ2MTcwMjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7ec67a19f8169db46282b30e2b15215773722eb", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/f7ec67a19f8169db46282b30e2b15215773722eb", "committedDate": "2020-05-07T14:17:36Z", "message": "Ensure only single SparkContext exist per jvm\n\nMore than one active spark context per jvm is not supported"}, "afterCommit": {"oid": "bb88251d29367e1b1a8d7b978ae7b70ffaa6de4c", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/bb88251d29367e1b1a8d7b978ae7b70ffaa6de4c", "committedDate": "2020-05-07T14:25:29Z", "message": "Ensure only single SparkContext exist per jvm\n\nMore than one active spark context per jvm is not supported"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb93ec2eebb7c1a9c18a0a1806d62078bf9a4019", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/cb93ec2eebb7c1a9c18a0a1806d62078bf9a4019", "committedDate": "2020-05-11T16:12:04Z", "message": "Fix PrestoSparkOutputOperator\n\nIn case of 0 columns row the output can be empty. Empty output\ndoes not contain byte array."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb88251d29367e1b1a8d7b978ae7b70ffaa6de4c", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/bb88251d29367e1b1a8d7b978ae7b70ffaa6de4c", "committedDate": "2020-05-07T14:25:29Z", "message": "Ensure only single SparkContext exist per jvm\n\nMore than one active spark context per jvm is not supported"}, "afterCommit": {"oid": "52e140206eefd3b41d7ff01ae65b1e9aa1219c31", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/52e140206eefd3b41d7ff01ae65b1e9aa1219c31", "committedDate": "2020-05-11T16:12:55Z", "message": "Ensure only single SparkContext exist per jvm\n\nMore than one active spark context per jvm is not supported"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDI0MDMy", "url": "https://github.com/prestodb/presto/pull/14496#pullrequestreview-409424032", "createdAt": "2020-05-11T18:29:51Z", "commit": {"oid": "a1c81a1d72d1c643f683a3f8925d6574b6df6727"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoyOTo1MlrOGToSqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoyOTo1MlrOGToSqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzNjI2NA==", "bodyText": "nit: maybe this should be a static field instead?", "url": "https://github.com/prestodb/presto/pull/14496#discussion_r423236264", "createdAt": "2020-05-11T18:29:52Z", "author": {"login": "shixuan-fan"}, "path": "presto-spark-base/src/main/java/com/facebook/presto/spark/node/PrestoSparkInternalNodeManager.java", "diffHunk": "@@ -38,30 +38,34 @@\n     public Set<InternalNode> getActiveConnectorNodes(ConnectorId connectorId)\n     {\n         // TODO: Hack to make TPCH connector work\n-        return ImmutableSet.of(\n-                new InternalNode(\"spark1\", URI.create(\"http://127.0.0.1:60041\"), NodeVersion.UNKNOWN, false),\n-                new InternalNode(\"spark2\", URI.create(\"http://127.0.0.1:60042\"), NodeVersion.UNKNOWN, false),\n-                new InternalNode(\"spark3\", URI.create(\"http://127.0.0.1:60043\"), NodeVersion.UNKNOWN, false),\n-                new InternalNode(\"spark4\", URI.create(\"http://127.0.0.1:60044\"), NodeVersion.UNKNOWN, false));\n+        return getAllNodes().getActiveNodes();\n     }\n \n     @Override\n     public InternalNode getCurrentNode()\n     {\n         // TODO: Hack to make TPCH connector work\n-        return new InternalNode(\"spark1\", URI.create(\"http://127.0.0.1:1111\"), NodeVersion.UNKNOWN, false);\n+        return new InternalNode(\"spark1\", URI.create(\"http://127.0.0.1:1111\"), NodeVersion.UNKNOWN, true);\n     }\n \n     @Override\n     public Set<InternalNode> getCoordinators()\n     {\n-        throw new UnsupportedOperationException();\n+        return ImmutableSet.of(getCurrentNode());\n     }\n \n     @Override\n     public AllNodes getAllNodes()\n     {\n-        throw new UnsupportedOperationException();\n+        return new AllNodes(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1c81a1d72d1c643f683a3f8925d6574b6df6727"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDQ5MTQw", "url": "https://github.com/prestodb/presto/pull/14496#pullrequestreview-409449140", "createdAt": "2020-05-11T19:03:45Z", "commit": {"oid": "300735d5d41669da4807039d6fdff8a958211015"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTowMzo0NVrOGTpcDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxOTowMzo0NVrOGTpcDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI1NTA1NA==", "bodyText": "I'm not particularly sure if we should have two separate constructors, but I don't have strong opinion on this.", "url": "https://github.com/prestodb/presto/pull/14496#discussion_r423255054", "createdAt": "2020-05-11T19:03:45Z", "author": {"login": "shixuan-fan"}, "path": "presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkInjectorFactory.java", "diffHunk": "@@ -44,13 +45,27 @@\n     private final Map<String, String> configProperties;\n     private final Map<String, Map<String, String>> catalogProperties;\n     private final List<Module> additionalModules;\n+    private final Optional<Module> accessControlModuleOverride;\n \n-    public PrestoSparkInjectorFactory(Map<String, String> configProperties, Map<String, Map<String, String>> catalogProperties, List<Module> additionalModules)\n+    public PrestoSparkInjectorFactory(\n+            Map<String, String> configProperties,\n+            Map<String, Map<String, String>> catalogProperties,\n+            List<Module> additionalModules)\n+    {\n+        this(configProperties, catalogProperties, additionalModules, Optional.empty());\n+    }\n+\n+    public PrestoSparkInjectorFactory(\n+            Map<String, String> configProperties,\n+            Map<String, Map<String, String>> catalogProperties,\n+            List<Module> additionalModules,\n+            Optional<Module> accessControlModuleOverride)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "300735d5d41669da4807039d6fdff8a958211015"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDUxODg5", "url": "https://github.com/prestodb/presto/pull/14496#pullrequestreview-409451889", "createdAt": "2020-05-11T19:07:54Z", "commit": {"oid": "52e140206eefd3b41d7ff01ae65b1e9aa1219c31"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c9243e6e99d2620816ea9129c7ba156b6ef7c53", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/9c9243e6e99d2620816ea9129c7ba156b6ef7c53", "committedDate": "2020-05-11T20:16:34Z", "message": "Register system catalog for Presto on Spark\n\nIt is generally useful to provide the same set of system table as convetional\nPresto does. But the main reson here is that AbstractTestQueries expects this\ncatalog to exist."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "258d6499fdd35728d7a3bb7b5b758f31c267ea82", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/258d6499fdd35728d7a3bb7b5b758f31c267ea82", "committedDate": "2020-05-11T20:16:34Z", "message": "Improve PrestoSparkQueryRunner\n\nMake it ready to run AbstractTestQueries:\n\n- Setup TestingAccessControlManager in PrestoSparkQueryRunner\n- Register testing functions in PrestoSparkQueryRunner\n- Register testing session properties for PrestoSparkQueryRunner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb5cc8dec223f4c4756a511c123dc326aa1892a8", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/eb5cc8dec223f4c4756a511c123dc326aa1892a8", "committedDate": "2020-05-11T20:16:34Z", "message": "Use Hive connector in PrestoSparkQueryRunner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4f717536655734d8ca93991d2ea1edad3dc6dfa", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/f4f717536655734d8ca93991d2ea1edad3dc6dfa", "committedDate": "2020-05-11T20:16:34Z", "message": "Decrease logging in PrestoSparkQueryRunner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94ced3c4d1323f47b68fe3098fde1736b3c8b472", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/94ced3c4d1323f47b68fe3098fde1736b3c8b472", "committedDate": "2020-05-11T20:16:35Z", "message": "Run presto-spark-base tests in a separate travis job"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fed2784eb9e113781a8c615bf3ada5d3e533e1f1", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/fed2784eb9e113781a8c615bf3ada5d3e533e1f1", "committedDate": "2020-05-11T20:16:35Z", "message": "Ensure only single SparkContext exist per jvm\n\nMore than one active spark context per jvm is not supported"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52e140206eefd3b41d7ff01ae65b1e9aa1219c31", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/52e140206eefd3b41d7ff01ae65b1e9aa1219c31", "committedDate": "2020-05-11T16:12:55Z", "message": "Ensure only single SparkContext exist per jvm\n\nMore than one active spark context per jvm is not supported"}, "afterCommit": {"oid": "fed2784eb9e113781a8c615bf3ada5d3e533e1f1", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/fed2784eb9e113781a8c615bf3ada5d3e533e1f1", "committedDate": "2020-05-11T20:16:35Z", "message": "Ensure only single SparkContext exist per jvm\n\nMore than one active spark context per jvm is not supported"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1589, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}