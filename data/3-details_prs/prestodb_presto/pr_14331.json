{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4Mjg2MzA4", "number": 14331, "title": "EXPLAIN (TYPE IO) support for Aria", "bodyText": "Allow Connectors to control column constraints in IOPlanPrinter\n\nAdd a new metadata method . toExplainIOConstraints to the Metadata and ConnectorMetadata interfaces to optionally return only Constraint for use in IOPlanPrinter.\nInterface default method returns the current constraints\nImplement HiveConnector.toExplainIOConstraints() to filter out non-partition key columns.\n\nAre there additional data types that Aria can return in Constraints that can also be partition columns?\n\nSupported:\n\nVarcharType\nTinyintType, SmallintType, IntegerType, BigintType\nBooleanType\n\n\n\nI need some pointer on how to test this.", "createdAt": "2020-04-03T17:02:55Z", "url": "https://github.com/prestodb/presto/pull/14331", "merged": true, "mergeCommit": {"oid": "60fbdb065db0d7f4e0d34a7da638f812842629e2"}, "closed": true, "closedAt": "2020-04-16T16:03:24Z", "author": {"login": "jbroll"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUHQanABqjMxOTc5Njc2NTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYLKyOABqjMyMzk1MDMzMjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce4c47def40adb5caa6934e1ea3daf2e6a5c0861", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/ce4c47def40adb5caa6934e1ea3daf2e6a5c0861", "committedDate": "2020-04-03T16:46:18Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "f8afb915b87304f161c4facf438003cf3a8e4458", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/f8afb915b87304f161c4facf438003cf3a8e4458", "committedDate": "2020-04-03T20:51:34Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8afb915b87304f161c4facf438003cf3a8e4458", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/f8afb915b87304f161c4facf438003cf3a8e4458", "committedDate": "2020-04-03T20:51:34Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "e4bafeb50f1d6a92a22963a79202dfddcfd9de21", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/e4bafeb50f1d6a92a22963a79202dfddcfd9de21", "committedDate": "2020-04-06T13:58:43Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4bafeb50f1d6a92a22963a79202dfddcfd9de21", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/e4bafeb50f1d6a92a22963a79202dfddcfd9de21", "committedDate": "2020-04-06T13:58:43Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "2f22c7ba49319aee44c65c1ea8ae47209e5b2106", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/2f22c7ba49319aee44c65c1ea8ae47209e5b2106", "committedDate": "2020-04-13T17:57:25Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f22c7ba49319aee44c65c1ea8ae47209e5b2106", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/2f22c7ba49319aee44c65c1ea8ae47209e5b2106", "committedDate": "2020-04-13T17:57:25Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "7af97d2ff39a624ef3a251d95105286636b8274c", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/7af97d2ff39a624ef3a251d95105286636b8274c", "committedDate": "2020-04-13T22:24:53Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7af97d2ff39a624ef3a251d95105286636b8274c", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/7af97d2ff39a624ef3a251d95105286636b8274c", "committedDate": "2020-04-13T22:24:53Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "committedDate": "2020-04-14T14:38:02Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDczOTA2", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393073906", "createdAt": "2020-04-14T16:01:29Z", "commit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjowMToyOVrOGFVzMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjowMToyOVrOGFVzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI1MzIzNQ==", "bodyText": "Purposefully left this comment to reviews to chime in...", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408253235", "createdAt": "2020-04-14T16:01:29Z", "author": {"login": "jbroll"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -546,7 +546,12 @@ private String getVarcharValue(Type type, Object value)\n             if (type instanceof BooleanType) {\n                 return ((Boolean) value).toString();\n             }\n-            throw new PrestoException(NOT_SUPPORTED, format(\"Unsupported data type in EXPLAIN (TYPE IO): %s\", type.getDisplayName()));\n+\n+            // Are there additional types that could be partition columns in Aria that we now need to support?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTE2NDg1", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393116485", "createdAt": "2020-04-14T16:53:03Z", "commit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1MzowM1rOGFX8pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1MzowM1rOGFX8pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4ODQyMA==", "bodyText": "Explain (Type IO)", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408288420", "createdAt": "2020-04-14T16:53:03Z", "author": {"login": "bhhari"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveMetadata.java", "diffHunk": "@@ -713,6 +713,17 @@ public ColumnMetadata getColumnMetadata(ConnectorSession session, ConnectorTable\n         return ((HiveColumnHandle) columnHandle).getColumnMetadata(typeManager);\n     }\n \n+    /**\n+     * Returns a TupleDomain of constraints that is suitable for ExplainIO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTE2NzMy", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393116732", "createdAt": "2020-04-14T16:53:21Z", "commit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1MzoyMVrOGFX9aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1MzoyMVrOGFX9aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4ODYxNw==", "bodyText": "IO planning instead of OI", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408288617", "createdAt": "2020-04-14T16:53:21Z", "author": {"login": "bhhari"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveMetadata.java", "diffHunk": "@@ -713,6 +713,17 @@ public ColumnMetadata getColumnMetadata(ConnectorSession session, ConnectorTable\n         return ((HiveColumnHandle) columnHandle).getColumnMetadata(typeManager);\n     }\n \n+    /**\n+     * Returns a TupleDomain of constraints that is suitable for ExplainIO\n+     *\n+     * Only Hive partition columns that are used in OI planning.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTE4MjQy", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393118242", "createdAt": "2020-04-14T16:55:08Z", "commit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1NTowOFrOGFYCPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1NTowOFrOGFYCPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4OTg1NQ==", "bodyText": "We need to keep the throw exception as we are not changing the existing behavior", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408289855", "createdAt": "2020-04-14T16:55:08Z", "author": {"login": "bhhari"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -546,7 +546,12 @@ private String getVarcharValue(Type type, Object value)\n             if (type instanceof BooleanType) {\n                 return ((Boolean) value).toString();\n             }\n-            throw new PrestoException(NOT_SUPPORTED, format(\"Unsupported data type in EXPLAIN (TYPE IO): %s\", type.getDisplayName()));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTE4OTky", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393118992", "createdAt": "2020-04-14T16:55:59Z", "commit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/8e9bc56482774f7db6c524ddc09ed9559c8a51dc", "committedDate": "2020-04-14T14:38:02Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "88260d688f6e82b0e2dfd2e48c02177142691a00", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/88260d688f6e82b0e2dfd2e48c02177142691a00", "committedDate": "2020-04-14T17:49:01Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTYyMTEy", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393162112", "createdAt": "2020-04-14T17:52:52Z", "commit": {"oid": "88260d688f6e82b0e2dfd2e48c02177142691a00"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1Mjo1M1rOGFaPdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1Mjo1OVrOGFaPtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjAwNg==", "bodyText": "what's the purpose of this filter?", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408326006", "createdAt": "2020-04-14T17:52:53Z", "author": {"login": "mbasmanova"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -517,6 +519,7 @@ private FormattedDomain parseDomain(Domain domain)\n                     discreteValues -> formattedRanges.addAll(\n                             discreteValues.getValues().stream()\n                                     .map(value -> getVarcharValue(type, value))\n+                                    .filter(Objects::nonNull)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88260d688f6e82b0e2dfd2e48c02177142691a00"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjA3MQ==", "bodyText": "wrong indentation", "url": "https://github.com/prestodb/presto/pull/14331#discussion_r408326071", "createdAt": "2020-04-14T17:52:59Z", "author": {"login": "mbasmanova"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/IOPlanPrinter.java", "diffHunk": "@@ -497,7 +499,7 @@ public Void visitTableFinish(TableFinishNode node, IOPlanBuilder context)\n             for (Map.Entry<ColumnHandle, Domain> entry : constraint.getDomains().get().entrySet()) {\n                 ColumnMetadata columnMetadata = metadata.getColumnMetadata(session, tableHandle, entry.getKey());\n                 columnConstraints.add(new ColumnConstraint(\n-                        columnMetadata.getName(),\n+                                columnMetadata.getName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88260d688f6e82b0e2dfd2e48c02177142691a00"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88260d688f6e82b0e2dfd2e48c02177142691a00", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/88260d688f6e82b0e2dfd2e48c02177142691a00", "committedDate": "2020-04-14T17:49:01Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195", "committedDate": "2020-04-15T00:55:28Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzkxNzgz", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393391783", "createdAt": "2020-04-15T01:01:27Z", "commit": {"oid": "5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzkzNDcw", "url": "https://github.com/prestodb/presto/pull/14331#pullrequestreview-393393470", "createdAt": "2020-04-15T01:07:11Z", "commit": {"oid": "5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/5a5ed0dd8f138970e6ef84ac8cf6f9182a5f4195", "committedDate": "2020-04-15T00:55:28Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "95d75a50aadf7b2a1de780d49c63916148ad0853", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/95d75a50aadf7b2a1de780d49c63916148ad0853", "committedDate": "2020-04-15T12:34:09Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9434d7d79e1456e9168c6737073dfed49b345f1e", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/9434d7d79e1456e9168c6737073dfed49b345f1e", "committedDate": "2020-04-16T11:39:58Z", "message": "Fix EXPLAIN (TYPE IO) when Aria scan is ON"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95d75a50aadf7b2a1de780d49c63916148ad0853", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/95d75a50aadf7b2a1de780d49c63916148ad0853", "committedDate": "2020-04-15T12:34:09Z", "message": "[WIP] EXPLAIN (TYPE IO) support for Aria"}, "afterCommit": {"oid": "9434d7d79e1456e9168c6737073dfed49b345f1e", "author": {"user": {"login": "jbroll", "name": "john roll"}}, "url": "https://github.com/prestodb/presto/commit/9434d7d79e1456e9168c6737073dfed49b345f1e", "committedDate": "2020-04-16T11:39:58Z", "message": "Fix EXPLAIN (TYPE IO) when Aria scan is ON"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1772, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}