{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NjgyMTk3", "number": 14147, "title": "Use absolute error when a floating point column mean is close to 0", "bodyText": "Instead of requiring either the control mean or the test mean to be exactly 0, use the absolute error rule when at least one of them is close to 0.\nWhen checking a floating point column using the absolute error rule, match if both are control mean and test mean are within the absolute margin, mismatch otherwise.\n\n== RELEASE NOTES ==\n\nVerifier Changes\n* Improve correctness check for floating point columns whose mean values of either the control query or the test query is closed to 0.", "createdAt": "2020-02-23T08:46:29Z", "url": "https://github.com/prestodb/presto/pull/14147", "merged": true, "mergeCommit": {"oid": "fb05233667d336bc31ab6a65601e9eb2d0fde5b2"}, "closed": true, "closedAt": "2020-02-25T05:19:21Z", "author": {"login": "caithagoras"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHE7zzABqjMwNjMyNzU1MDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHmq-UgBqjMwNjc0NjQ1NTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "848f9dd281902bfce9376b166e6d93f8ecd6d1b5", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/848f9dd281902bfce9376b166e6d93f8ecd6d1b5", "committedDate": "2020-02-23T08:41:34Z", "message": "Use absolute error when a floating point column is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}, "afterCommit": {"oid": "0cb30a613dc7f724656f04401606d646f550ee8b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0cb30a613dc7f724656f04401606d646f550ee8b", "committedDate": "2020-02-23T08:48:22Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0cb30a613dc7f724656f04401606d646f550ee8b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0cb30a613dc7f724656f04401606d646f550ee8b", "committedDate": "2020-02-23T08:48:22Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}, "afterCommit": {"oid": "dcf0ace0eb064996316a3f086f6ffda1567c8921", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dcf0ace0eb064996316a3f086f6ffda1567c8921", "committedDate": "2020-02-23T08:49:09Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNTAzMTI5", "url": "https://github.com/prestodb/presto/pull/14147#pullrequestreview-363503129", "createdAt": "2020-02-24T16:02:54Z", "commit": {"oid": "dcf0ace0eb064996316a3f086f6ffda1567c8921"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNjowMjo1NVrOFtmI1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNjowMjo1NVrOFtmI1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM1NTA5Mg==", "bodyText": "It is possible for controlResult.getRowCount() to return zero here? If not, perhaps, add a comment to explain why.", "url": "https://github.com/prestodb/presto/pull/14147#discussion_r383355092", "createdAt": "2020-02-24T16:02:55Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/FloatingPointColumnValidator.java", "diffHunk": "@@ -158,14 +158,13 @@ public FloatingPointColumnValidator(VerifierConfig config)\n         }\n \n         // Use absolute error margin if either control sum or test sum is 0\n-        if (controlSum == 0 || testSum == 0) {\n-            double controlMean = controlSum / controlResult.getRowCount();\n-            double testMean = testSum / controlResult.getRowCount();\n-            double difference = abs(controlMean - testMean);\n+        double controlMean = controlSum / controlResult.getRowCount();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcf0ace0eb064996316a3f086f6ffda1567c8921"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dcf0ace0eb064996316a3f086f6ffda1567c8921", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dcf0ace0eb064996316a3f086f6ffda1567c8921", "committedDate": "2020-02-23T08:49:09Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}, "afterCommit": {"oid": "c28f0054369d4b01a07f4a6e9890b71d2b87a9eb", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c28f0054369d4b01a07f4a6e9890b71d2b87a9eb", "committedDate": "2020-02-25T00:04:42Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "committedDate": "2020-02-25T00:06:44Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c28f0054369d4b01a07f4a6e9890b71d2b87a9eb", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c28f0054369d4b01a07f4a6e9890b71d2b87a9eb", "committedDate": "2020-02-25T00:04:42Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}, "afterCommit": {"oid": "dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dcb9be7a85e4d5a68eb4ee6b901d046103762d7d", "committedDate": "2020-02-25T00:06:44Z", "message": "Use absolute error when a floating point column mean is close to 0\n\nInstead of requiring either the control mean or the test mean to\nbe exactly 0, use the absolute error rule when at least one of them\nis close to 0."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2314, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}