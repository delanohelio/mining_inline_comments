{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNTAyMzg4", "number": 15536, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToxNjo1MlrOFH74Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowNDozOVrOFIAV_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODY1MzgzOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/StoragePartitionLoader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToxNjo1MlrOIJmLQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMzo1Njo0NlrOIJpt5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzMzU3MQ==", "bodyText": "Without file renaming, how did we sort bucket file names before? Do we append 0s in front of file names?", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r546933571", "createdAt": "2020-12-21T21:16:52Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/StoragePartitionLoader.java", "diffHunk": "@@ -346,8 +348,23 @@ private static boolean shouldUseFileSplitsFromInputFormat(InputFormat<?, ?> inpu\n                             partitionName));\n         }\n \n-        // Sort FileStatus objects (instead of, e.g., fileStatus.getPath().toString). This matches org.apache.hadoop.hive.ql.metadata.Table.getSortedPaths\n-        fileInfos.sort(null);\n+        if (fileInfos.get(0).getPath().getName().matches(\"\\\\d+\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47918eae68bd4b4a2970b2205d31d8c1ad4c7e2e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk5MTU4OA==", "bodyText": "Yes correct. We append 0s in front.", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r546991588", "createdAt": "2020-12-21T23:56:46Z", "author": {"login": "NikhilCollooru"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/StoragePartitionLoader.java", "diffHunk": "@@ -346,8 +348,23 @@ private static boolean shouldUseFileSplitsFromInputFormat(InputFormat<?, ?> inpu\n                             partitionName));\n         }\n \n-        // Sort FileStatus objects (instead of, e.g., fileStatus.getPath().toString). This matches org.apache.hadoop.hive.ql.metadata.Table.getSortedPaths\n-        fileInfos.sort(null);\n+        if (fileInfos.get(0).getPath().getName().matches(\"\\\\d+\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzMzU3MQ=="}, "originalCommit": {"oid": "47918eae68bd4b4a2970b2205d31d8c1ad4c7e2e"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODY1NTc1OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToxNzozN1rOIJmMaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToxNzozN1rOIJmMaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzMzg2Nw==", "bodyText": "leave the first param to its own line", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r546933867", "createdAt": "2020-12-21T21:17:37Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -112,17 +112,36 @@ public static long getFileSize(Page statisticsPage, int position)\n         ImmutableMap.Builder<String, String> partitionMetadata = ImmutableMap.builder();\n         List<FileWriteInfo> fileWriteInfos = new ArrayList<>(partitionUpdate.getFileWriteInfos());\n \n+        if (!partitionUpdate.containsNumberedFileNames()) {\n+            // Filenames starting with \".tmp.presto\" will be renamed in TableFinishOperator. So it doesn't make sense to store the filenames in manifest\n+            return metadata;\n+        }\n+\n         // Sort the file infos based on fileName\n         fileWriteInfos.sort(Comparator.comparing(info -> Integer.valueOf(info.getWriteFileName())));\n \n+        List<String> fileNames = fileWriteInfos.stream().map(FileWriteInfo::getWriteFileName).collect(toImmutableList());\n+        List<Long> fileSizes = fileWriteInfos.stream().map(FileWriteInfo::getFileSize).filter(Optional::isPresent).map(Optional::get).collect(toImmutableList());\n+\n+        if (fileSizes.size() < fileNames.size()) {\n+            if (fileSizes.size() == 0) {\n+                // These files may not have been written by OrcFileWriter. So file sizes not available.\n+                return metadata;\n+            }\n+            throw new PrestoException(\n+                    MALFORMED_HIVE_FILE_STATISTICS,\n+                    format(\"During manifest creation for partition= %s, filename count= %s is not equal to filesizes count= %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2d199d6b88039219dfe55cc92a8c05f6aaba5a6"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODY1Nzc2OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToxODoyNFrOIJmNnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToxODoyNFrOIJmNnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzNDE3Mw==", "bodyText": "fileSizes.isEmpty()", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r546934173", "createdAt": "2020-12-21T21:18:24Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -112,17 +112,36 @@ public static long getFileSize(Page statisticsPage, int position)\n         ImmutableMap.Builder<String, String> partitionMetadata = ImmutableMap.builder();\n         List<FileWriteInfo> fileWriteInfos = new ArrayList<>(partitionUpdate.getFileWriteInfos());\n \n+        if (!partitionUpdate.containsNumberedFileNames()) {\n+            // Filenames starting with \".tmp.presto\" will be renamed in TableFinishOperator. So it doesn't make sense to store the filenames in manifest\n+            return metadata;\n+        }\n+\n         // Sort the file infos based on fileName\n         fileWriteInfos.sort(Comparator.comparing(info -> Integer.valueOf(info.getWriteFileName())));\n \n+        List<String> fileNames = fileWriteInfos.stream().map(FileWriteInfo::getWriteFileName).collect(toImmutableList());\n+        List<Long> fileSizes = fileWriteInfos.stream().map(FileWriteInfo::getFileSize).filter(Optional::isPresent).map(Optional::get).collect(toImmutableList());\n+\n+        if (fileSizes.size() < fileNames.size()) {\n+            if (fileSizes.size() == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2d199d6b88039219dfe55cc92a8c05f6aaba5a6"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODY2MzEyOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToyMDozNFrOIJmQ1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMToyMDozNFrOIJmQ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzNDk5Ng==", "bodyText": "why we need a new ArrayList?", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r546934996", "createdAt": "2020-12-21T21:20:34Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -148,6 +150,18 @@ public static long getFileSize(Page statisticsPage, int position)\n         return partitionMetadata.build();\n     }\n \n+    public static long getManifestSizeInBytes(ConnectorSession session, PartitionUpdate partitionUpdate)\n+    {\n+        if (isFileRenamingEnabled(session) && partitionUpdate.containsNumberedFileNames()) {\n+            List<FileWriteInfo> fileWriteInfos = new ArrayList<>(partitionUpdate.getFileWriteInfos());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdb06a65b9502515f42bbb1ed3f4bda415e87da"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODY4ODEyOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMTozMDoyMVrOIJmfoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMTozMDoyMVrOIJmfoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzODc4NQ==", "bodyText": "This is duplicated logic. We can directly get the size info from extraPartitionMetadata in HiveMetadata.finishInsert. No need to compute it again.", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r546938785", "createdAt": "2020-12-21T21:30:21Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -148,6 +150,18 @@ public static long getFileSize(Page statisticsPage, int position)\n         return partitionMetadata.build();\n     }\n \n+    public static long getManifestSizeInBytes(ConnectorSession session, PartitionUpdate partitionUpdate)\n+    {\n+        if (isFileRenamingEnabled(session) && partitionUpdate.containsNumberedFileNames()) {\n+            List<FileWriteInfo> fileWriteInfos = new ArrayList<>(partitionUpdate.getFileWriteInfos());\n+            return compressFileNames(fileWriteInfos.stream().map(FileWriteInfo::getWriteFileName).collect(toImmutableList())).length()\n+                    + compressFileSizes(fileWriteInfos.stream().map(FileWriteInfo::getFileSize).filter(Optional::isPresent).map(Optional::get).collect(toImmutableList())).length();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdb06a65b9502515f42bbb1ed3f4bda415e87da"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzOTM4MjE2OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowMjoyOFrOIJstqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowMjoyOFrOIJstqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0MDY4Mg==", "bodyText": "createPartitionManifest is actually not used anymore. I guess we can remove it", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r547040682", "createdAt": "2020-12-22T03:02:28Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -149,6 +151,21 @@ public static long getFileSize(Page statisticsPage, int position)\n         return partitionMetadata.build();\n     }\n \n+    public static long getManifestSizeInBytes(ConnectorSession session, PartitionUpdate partitionUpdate, Map<String, String> parameters)\n+    {\n+        if (isFileRenamingEnabled(session) && partitionUpdate.containsNumberedFileNames()) {\n+            if (parameters.containsKey(FILE_NAMES) && parameters.containsKey(FILE_SIZES)) {\n+                return parameters.get(FILE_NAMES).length() + parameters.get(FILE_SIZES).length();\n+            }\n+            List<FileWriteInfo> fileWriteInfos = partitionUpdate.getFileWriteInfos();\n+            return compressFileNames(fileWriteInfos.stream().map(FileWriteInfo::getWriteFileName).collect(toImmutableList())).length()\n+                    + compressFileSizes(fileWriteInfos.stream().map(FileWriteInfo::getFileSize).filter(Optional::isPresent).map(Optional::get).collect(toImmutableList())).length();\n+        }\n+\n+        Optional<Page> manifestBlob = createPartitionManifest(partitionUpdate);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04e97e1cc48fb1f1bc2320277098f987958b6d1"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzOTM4MjY3OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowMjo1NVrOIJsuCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxOTozMDowN1rOIKGy_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0MDc3OQ==", "bodyText": "We don't need this part, this is duplication with updatePartitionMetadataWithFileNamesAndSizes", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r547040779", "createdAt": "2020-12-22T03:02:55Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -149,6 +151,21 @@ public static long getFileSize(Page statisticsPage, int position)\n         return partitionMetadata.build();\n     }\n \n+    public static long getManifestSizeInBytes(ConnectorSession session, PartitionUpdate partitionUpdate, Map<String, String> parameters)\n+    {\n+        if (isFileRenamingEnabled(session) && partitionUpdate.containsNumberedFileNames()) {\n+            if (parameters.containsKey(FILE_NAMES) && parameters.containsKey(FILE_SIZES)) {\n+                return parameters.get(FILE_NAMES).length() + parameters.get(FILE_SIZES).length();\n+            }\n+            List<FileWriteInfo> fileWriteInfos = partitionUpdate.getFileWriteInfos();\n+            return compressFileNames(fileWriteInfos.stream().map(FileWriteInfo::getWriteFileName).collect(toImmutableList())).length()\n+                    + compressFileSizes(fileWriteInfos.stream().map(FileWriteInfo::getFileSize).filter(Optional::isPresent).map(Optional::get).collect(toImmutableList())).length();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04e97e1cc48fb1f1bc2320277098f987958b6d1"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ2ODAyOA==", "bodyText": "updatePartitionMetadataWithFileNamesAndSizes gets called only when hive.prefer-manifests-to-list-files and file_renaming are enabled. But i want to track the manifest size even when just file_renaming is enabled. Hence this logic is needed  here as well. compressFileNames() will be invoked only once. Either in updatePartitionMetadataWithFileNamesAndSizes or here.", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r547468028", "createdAt": "2020-12-22T19:30:07Z", "author": {"login": "NikhilCollooru"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -149,6 +151,21 @@ public static long getFileSize(Page statisticsPage, int position)\n         return partitionMetadata.build();\n     }\n \n+    public static long getManifestSizeInBytes(ConnectorSession session, PartitionUpdate partitionUpdate, Map<String, String> parameters)\n+    {\n+        if (isFileRenamingEnabled(session) && partitionUpdate.containsNumberedFileNames()) {\n+            if (parameters.containsKey(FILE_NAMES) && parameters.containsKey(FILE_SIZES)) {\n+                return parameters.get(FILE_NAMES).length() + parameters.get(FILE_SIZES).length();\n+            }\n+            List<FileWriteInfo> fileWriteInfos = partitionUpdate.getFileWriteInfos();\n+            return compressFileNames(fileWriteInfos.stream().map(FileWriteInfo::getWriteFileName).collect(toImmutableList())).length()\n+                    + compressFileSizes(fileWriteInfos.stream().map(FileWriteInfo::getFileSize).filter(Optional::isPresent).map(Optional::get).collect(toImmutableList())).length();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0MDc3OQ=="}, "originalCommit": {"oid": "f04e97e1cc48fb1f1bc2320277098f987958b6d1"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzOTM4NDg2OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowNDoxNlrOIJsvTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowNDoxNlrOIJsvTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0MTEwMA==", "bodyText": "We just check if the extra params contains MANIFEST_VERSION. If yes, we sum up the values' lengths for FILE_NAMES and FILE_SIZES.", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r547041100", "createdAt": "2020-12-22T03:04:16Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -149,6 +151,21 @@ public static long getFileSize(Page statisticsPage, int position)\n         return partitionMetadata.build();\n     }\n \n+    public static long getManifestSizeInBytes(ConnectorSession session, PartitionUpdate partitionUpdate, Map<String, String> parameters)\n+    {\n+        if (isFileRenamingEnabled(session) && partitionUpdate.containsNumberedFileNames()) {\n+            if (parameters.containsKey(FILE_NAMES) && parameters.containsKey(FILE_SIZES)) {\n+                return parameters.get(FILE_NAMES).length() + parameters.get(FILE_SIZES).length();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04e97e1cc48fb1f1bc2320277098f987958b6d1"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzOTM4NTAxOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowNDoyMlrOIJsvZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowNDoyMlrOIJsvZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0MTEyNA==", "bodyText": "return optional long", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r547041124", "createdAt": "2020-12-22T03:04:22Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveManifestUtils.java", "diffHunk": "@@ -149,6 +151,21 @@ public static long getFileSize(Page statisticsPage, int position)\n         return partitionMetadata.build();\n     }\n \n+    public static long getManifestSizeInBytes(ConnectorSession session, PartitionUpdate partitionUpdate, Map<String, String> parameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04e97e1cc48fb1f1bc2320277098f987958b6d1"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzOTM4NTU4OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveMetadata.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowNDozOVrOIJsvsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMzowNDozOVrOIJsvsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA0MTIwMQ==", "bodyText": "Only add to the stats if it's not optional empty.", "url": "https://github.com/prestodb/presto/pull/15536#discussion_r547041201", "createdAt": "2020-12-22T03:04:39Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveMetadata.java", "diffHunk": "@@ -1941,10 +1940,8 @@ else if (partitionUpdate.getUpdateMode() == NEW || partitionUpdate.getUpdateMode\n                     extraPartitionMetadata = updatePartitionMetadataWithFileNamesAndSizes(partitionUpdate, extraPartitionMetadata);\n                 }\n \n-                // TODO: Put the manifest blob in partition parameters\n                 // Track the manifest blob size\n-                Optional<Page> manifestBlob = createPartitionManifest(partitionUpdate);\n-                manifestBlob.ifPresent(manifest -> hivePartitionStats.addManifestSizeInBytes(manifest.getRetainedSizeInBytes()));\n+                hivePartitionStats.addManifestSizeInBytes(getManifestSizeInBytes(session, partitionUpdate, extraPartitionMetadata));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04e97e1cc48fb1f1bc2320277098f987958b6d1"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3296, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}