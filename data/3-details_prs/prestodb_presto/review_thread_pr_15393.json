{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1MDE5NjI1", "number": 15393, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoxOToxM1rOE7uxeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoyMTo0NFrOE7uz_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMDY3NzY5OnYy", "diffSide": "RIGHT", "path": "presto-client/src/main/java/com/facebook/presto/client/ClientSession.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoxOToxM1rOH3ioyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzo1NTozMFrOH3kZeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMTIyNQ==", "bodyText": "Can we instead use compressionEnabled? Disabled would incur one more flip in mind :)", "url": "https://github.com/prestodb/presto/pull/15393#discussion_r528001225", "createdAt": "2020-11-20T22:19:13Z", "author": {"login": "shixuan-fan"}, "path": "presto-client/src/main/java/com/facebook/presto/client/ClientSession.java", "diffHunk": "@@ -51,6 +51,7 @@\n     private final Map<String, String> extraCredentials;\n     private final String transactionId;\n     private final Duration clientRequestTimeout;\n+    private final boolean compressionDisabled;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6f5f5b385288ddaacd318b96cf9250f9cf125d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMzU2NA==", "bodyText": "The phrasing is a little weird, but the mechanism here doesn't actually let you force compression- only disable compression. Same thing with the server side logic. Default negotiation happens inside of jetty around the client Accept-Encoding header and server's chosen mime-type and Content-Encoding headers.", "url": "https://github.com/prestodb/presto/pull/15393#discussion_r528003564", "createdAt": "2020-11-20T22:26:00Z", "author": {"login": "pettyjamesm"}, "path": "presto-client/src/main/java/com/facebook/presto/client/ClientSession.java", "diffHunk": "@@ -51,6 +51,7 @@\n     private final Map<String, String> extraCredentials;\n     private final String transactionId;\n     private final Duration clientRequestTimeout;\n+    private final boolean compressionDisabled;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMTIyNQ=="}, "originalCommit": {"oid": "a6f5f5b385288ddaacd318b96cf9250f9cf125d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyNzc4Nw==", "bodyText": "I see. But we could probably just flip the boolean when it is used? I'm just worried this might be error-prone.", "url": "https://github.com/prestodb/presto/pull/15393#discussion_r528027787", "createdAt": "2020-11-20T23:45:44Z", "author": {"login": "shixuan-fan"}, "path": "presto-client/src/main/java/com/facebook/presto/client/ClientSession.java", "diffHunk": "@@ -51,6 +51,7 @@\n     private final Map<String, String> extraCredentials;\n     private final String transactionId;\n     private final Duration clientRequestTimeout;\n+    private final boolean compressionDisabled;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMTIyNQ=="}, "originalCommit": {"oid": "a6f5f5b385288ddaacd318b96cf9250f9cf125d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAzMDA3Mg==", "bodyText": "In general I\u2019m worried about the impression that \u201cenabled\u201d will give. To me, that sounds like the client has ultimate control of the decision when in fact, they do not. The client only as the option to opt-out of compression.", "url": "https://github.com/prestodb/presto/pull/15393#discussion_r528030072", "createdAt": "2020-11-20T23:55:30Z", "author": {"login": "pettyjamesm"}, "path": "presto-client/src/main/java/com/facebook/presto/client/ClientSession.java", "diffHunk": "@@ -51,6 +51,7 @@\n     private final Map<String, String> extraCredentials;\n     private final String transactionId;\n     private final Duration clientRequestTimeout;\n+    private final boolean compressionDisabled;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMTIyNQ=="}, "originalCommit": {"oid": "a6f5f5b385288ddaacd318b96cf9250f9cf125d1"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMDY4NDE1OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/QueuedStatementResource.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoyMTo0NFrOH3isbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMzo0NTo1MFrOH3kQmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMjE1Ng==", "bodyText": "I understand that we are trying to reduce duplicate code, but passing compressionEnabled  to withCompressionEnabled is a bit weird and sounds like this should be done outside.", "url": "https://github.com/prestodb/presto/pull/15393#discussion_r528002156", "createdAt": "2020-11-20T22:21:44Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/QueuedStatementResource.java", "diffHunk": "@@ -380,7 +392,7 @@ public synchronized QueryResults getInitialQueryResults(UriInfo uriInfo, String\n                             uriInfo,\n                             xForwardedProto,\n                             DispatchInfo.queued(NO_DURATION, NO_DURATION));\n-                    return immediateFuture(Response.ok(queryResults).build());\n+                    return immediateFuture(withCompressionEnabled(Response.ok(queryResults), compressionEnabled).build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6f5f5b385288ddaacd318b96cf9250f9cf125d1"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwNDUyOQ==", "bodyText": "Maybe: withCompressionConfiguration(Response.Builder builder, boolean compressionDisabled) ?", "url": "https://github.com/prestodb/presto/pull/15393#discussion_r528004529", "createdAt": "2020-11-20T22:28:43Z", "author": {"login": "pettyjamesm"}, "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/QueuedStatementResource.java", "diffHunk": "@@ -380,7 +392,7 @@ public synchronized QueryResults getInitialQueryResults(UriInfo uriInfo, String\n                             uriInfo,\n                             xForwardedProto,\n                             DispatchInfo.queued(NO_DURATION, NO_DURATION));\n-                    return immediateFuture(Response.ok(queryResults).build());\n+                    return immediateFuture(withCompressionEnabled(Response.ok(queryResults), compressionEnabled).build());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMjE1Ng=="}, "originalCommit": {"oid": "a6f5f5b385288ddaacd318b96cf9250f9cf125d1"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyNzgwMw==", "bodyText": "Yeah that seems better :D", "url": "https://github.com/prestodb/presto/pull/15393#discussion_r528027803", "createdAt": "2020-11-20T23:45:50Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/QueuedStatementResource.java", "diffHunk": "@@ -380,7 +392,7 @@ public synchronized QueryResults getInitialQueryResults(UriInfo uriInfo, String\n                             uriInfo,\n                             xForwardedProto,\n                             DispatchInfo.queued(NO_DURATION, NO_DURATION));\n-                    return immediateFuture(Response.ok(queryResults).build());\n+                    return immediateFuture(withCompressionEnabled(Response.ok(queryResults), compressionEnabled).build());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMjE1Ng=="}, "originalCommit": {"oid": "a6f5f5b385288ddaacd318b96cf9250f9cf125d1"}, "originalPosition": 78}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3365, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}