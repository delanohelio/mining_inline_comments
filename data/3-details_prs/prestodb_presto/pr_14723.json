{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMjAyMzk1", "number": 14723, "title": "Write support for DWRF encryption at rest", "bodyText": "Flow EncryptionInformation to HiveOutputTableHandle and HiveInsertTableHandle through HiveWritableTableHandle. Extended the HiveEncryptionInformationProvider to also provide the EncryptionInformation necessary for when we are writing data.\nIn addition to this, did some refactor in HiveMetadata to better re-use code for translating settings between table properties and hive properties for both read and write cases.\n== NO RELEASE NOTE ==\n\nDepended by facebookexternal/presto-facebook#1053", "createdAt": "2020-06-25T19:00:55Z", "url": "https://github.com/prestodb/presto/pull/14723", "merged": true, "mergeCommit": {"oid": "a5434172d75ca4bc8f0cba930abb2a07e6ba4965"}, "closed": true, "closedAt": "2020-07-06T21:05:19Z", "author": {"login": "mayankgarg1990"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwCSPjgBqjM0OTMxMzYyNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyUyctABqjM1MTY5ODIyNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b24c72648256ef574c7bcacad6cfa4a775df763", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/4b24c72648256ef574c7bcacad6cfa4a775df763", "committedDate": "2020-06-25T18:56:33Z", "message": "Pass table encryption settings to `HiveWritableTableHandle`"}, "afterCommit": {"oid": "df5c4dfe9a1a1611d931ae1cf05905f7f7c37c8b", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/df5c4dfe9a1a1611d931ae1cf05905f7f7c37c8b", "committedDate": "2020-06-29T14:53:42Z", "message": "Pass table encryption settings to `HiveWritableTableHandle`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df5c4dfe9a1a1611d931ae1cf05905f7f7c37c8b", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/df5c4dfe9a1a1611d931ae1cf05905f7f7c37c8b", "committedDate": "2020-06-29T14:53:42Z", "message": "Pass table encryption settings to `HiveWritableTableHandle`"}, "afterCommit": {"oid": "8d818dd6be375c7d33c0c62048cd086dd6f7d082", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/8d818dd6be375c7d33c0c62048cd086dd6f7d082", "committedDate": "2020-06-29T19:54:33Z", "message": "Pass table encryption settings to `HiveWritableTableHandle`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17f85c779489cf50e77c7381a34b56585a5f46e7", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/17f85c779489cf50e77c7381a34b56585a5f46e7", "committedDate": "2020-06-29T21:51:07Z", "message": "Pass DwrfWriterEncryption when creating OrcWriter"}, "afterCommit": {"oid": "145806cf94928144a7cfccd4fc2aac7b4c7f0863", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/145806cf94928144a7cfccd4fc2aac7b4c7f0863", "committedDate": "2020-06-29T22:05:36Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "145806cf94928144a7cfccd4fc2aac7b4c7f0863", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/145806cf94928144a7cfccd4fc2aac7b4c7f0863", "committedDate": "2020-06-29T22:05:36Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "55c0ab4161ab09cbe7f6825b9e339d54ecea3be3", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/55c0ab4161ab09cbe7f6825b9e339d54ecea3be3", "committedDate": "2020-06-30T04:49:43Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55c0ab4161ab09cbe7f6825b9e339d54ecea3be3", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/55c0ab4161ab09cbe7f6825b9e339d54ecea3be3", "committedDate": "2020-06-30T04:49:43Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "898ead6f50807fe0166b801202944acccdd028d8", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/898ead6f50807fe0166b801202944acccdd028d8", "committedDate": "2020-06-30T22:55:14Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8f23fb31c7316b7295f966641726c334b16ecca", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/c8f23fb31c7316b7295f966641726c334b16ecca", "committedDate": "2020-07-01T12:30:58Z", "message": "Remove unused methods"}, "afterCommit": {"oid": "0219acd4dadde5afd12fa5e6b4e9d44761710821", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/0219acd4dadde5afd12fa5e6b4e9d44761710821", "committedDate": "2020-07-01T16:11:45Z", "message": "Pass table encryption settings to `HiveWritableTableHandle`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0219acd4dadde5afd12fa5e6b4e9d44761710821", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/0219acd4dadde5afd12fa5e6b4e9d44761710821", "committedDate": "2020-07-01T16:11:45Z", "message": "Pass table encryption settings to `HiveWritableTableHandle`"}, "afterCommit": {"oid": "a2c91895b44309c43edcd43ca0bb2ce6b207eba3", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/a2c91895b44309c43edcd43ca0bb2ce6b207eba3", "committedDate": "2020-07-01T16:23:25Z", "message": "Pass table encryption settings to `HiveWritableTableHandle`\n\nAdding support for file format encryption while writing data to Hive.\n\nUsing `HiveWritableTableHandle` as a way to transfer to the worker encryption information.\nThen as we are finishing on the final writes to the Hive metastore at that point, add\nsupport for writing metadata related to encryption to the table or partition parameters.\n\nRefactored table properties into `DwrfTableEncryptionProperties` to help keep the logic\nin a single place and make it easy to pass this information around."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b85f54e437dcfcc498c615f4fe134e1779f1382", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/3b85f54e437dcfcc498c615f4fe134e1779f1382", "committedDate": "2020-07-01T18:39:27Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "486c80d28ff5f1c159ad78043a276163b11f5d55", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/486c80d28ff5f1c159ad78043a276163b11f5d55", "committedDate": "2020-07-01T21:49:23Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "486c80d28ff5f1c159ad78043a276163b11f5d55", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/486c80d28ff5f1c159ad78043a276163b11f5d55", "committedDate": "2020-07-01T21:49:23Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "a85da0f010ba5146efc3e0a98a12a69d9f0c8fb7", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/a85da0f010ba5146efc3e0a98a12a69d9f0c8fb7", "committedDate": "2020-07-02T17:06:08Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTM2NjY2", "url": "https://github.com/prestodb/presto/pull/14723#pullrequestreview-441936666", "createdAt": "2020-07-02T18:37:25Z", "commit": {"oid": "cb1371bfeecfdb6efb993f3e255dd1c2b8041bf5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODozNzoyNlrOGsZHaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODozNzoyNlrOGsZHaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMjAyNA==", "bodyText": "Maybe I missed it, but I think none of these tests are using unpartitioned tables. Maybe add a test for that?", "url": "https://github.com/prestodb/presto/pull/14723#discussion_r449202024", "createdAt": "2020-07-02T18:37:26Z", "author": {"login": "rschlussel"}, "path": "presto-hive/src/test/java/com/facebook/presto/hive/TestHiveMetadataFileFormatEncryptionSettings.java", "diffHunk": "@@ -125,13 +143,15 @@ public void tearDown()\n         }\n     }\n \n-    private static ConnectorTableMetadata getConnectorTableMetadata(String tableName, Map<String, Object> tableProperties)\n+    private static ConnectorTableMetadata getConnectorTableMetadata(String tableName, Map<String, Object> tableProperties, boolean isPartitioned)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb1371bfeecfdb6efb993f3e255dd1c2b8041bf5"}, "originalPosition": 85}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a85da0f010ba5146efc3e0a98a12a69d9f0c8fb7", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/a85da0f010ba5146efc3e0a98a12a69d9f0c8fb7", "committedDate": "2020-07-02T17:06:08Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "434f71b1d43108b0be975bdf67446bee3c29e47a", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/434f71b1d43108b0be975bdf67446bee3c29e47a", "committedDate": "2020-07-02T21:10:04Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "434f71b1d43108b0be975bdf67446bee3c29e47a", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/434f71b1d43108b0be975bdf67446bee3c29e47a", "committedDate": "2020-07-02T21:10:04Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "6a09c091c748b11807cefc13fb25559d5cf9bbea", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/6a09c091c748b11807cefc13fb25559d5cf9bbea", "committedDate": "2020-07-03T21:52:41Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMTE2NzQ0", "url": "https://github.com/prestodb/presto/pull/14723#pullrequestreview-443116744", "createdAt": "2020-07-06T14:16:27Z", "commit": {"oid": "6a09c091c748b11807cefc13fb25559d5cf9bbea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a09c091c748b11807cefc13fb25559d5cf9bbea", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/6a09c091c748b11807cefc13fb25559d5cf9bbea", "committedDate": "2020-07-03T21:52:41Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "243907860f99cc3e1230cbfe3fc982a0edb0f96c", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/243907860f99cc3e1230cbfe3fc982a0edb0f96c", "committedDate": "2020-07-06T16:47:09Z", "message": "Rebecca's fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "243907860f99cc3e1230cbfe3fc982a0edb0f96c", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/243907860f99cc3e1230cbfe3fc982a0edb0f96c", "committedDate": "2020-07-06T16:47:09Z", "message": "Rebecca's fix"}, "afterCommit": {"oid": "67d45be8ee33d238a63e3a3b6dd7a0985741195c", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/67d45be8ee33d238a63e3a3b6dd7a0985741195c", "committedDate": "2020-07-06T16:48:37Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8b499609889a2a0017207e8370a772fb4e10a57", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/d8b499609889a2a0017207e8370a772fb4e10a57", "committedDate": "2020-07-06T17:19:23Z", "message": "Write support for DWRF encryption at rest\n\nAdding support for file format encryption while writing data to Hive.\n\nUsing `HiveWritableTableHandle` as a way to transfer to the worker encryption information.\nThen as we are finishing on the final writes to the Hive metastore at that point, add\nsupport for writing metadata related to encryption to the table or partition parameters.\n\nRefactored table properties into `DwrfTableEncryptionProperties` to help keep the logic\nin a single place and make it easy to pass this information around."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ea1eb0b588be345478e407a2fa54f686a7c6557", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/8ea1eb0b588be345478e407a2fa54f686a7c6557", "committedDate": "2020-07-06T17:19:29Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67d45be8ee33d238a63e3a3b6dd7a0985741195c", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/67d45be8ee33d238a63e3a3b6dd7a0985741195c", "committedDate": "2020-07-06T16:48:37Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}, "afterCommit": {"oid": "8ea1eb0b588be345478e407a2fa54f686a7c6557", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/8ea1eb0b588be345478e407a2fa54f686a7c6557", "committedDate": "2020-07-06T17:19:29Z", "message": "Pass DwrfWriterEncryption into OrcWriter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1500, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}