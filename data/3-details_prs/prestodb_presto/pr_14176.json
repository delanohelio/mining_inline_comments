{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMTYyNjQ2", "number": 14176, "title": "Improve determinism analysis of queries with top-level LIMIT clause", "bodyText": "== RELEASE NOTES ==\n\nVerifier Changes\n* Fix incorrect decision for determinism analysis of queries with top-level ``LIMIT`` clause. (:pr:`14176`)\n* Improve query performance during determinism analysis of queries with top-level ``LIMIT`` clause.", "createdAt": "2020-02-28T01:54:04Z", "url": "https://github.com/prestodb/presto/pull/14176", "merged": true, "mergeCommit": {"oid": "3f980812cc0096f3bfce55de7c1656f4044ec3f3"}, "closed": true, "closedAt": "2020-03-01T04:26:21Z", "author": {"login": "caithagoras"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcImEOYgBqjMwODAxNjgwNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcI3tjugBqjMwODM3NDc3MzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "923dfed7d15d65cf133c0d37ec0533056658b67c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/923dfed7d15d65cf133c0d37ec0533056658b67c", "committedDate": "2020-02-28T01:48:01Z", "message": "Do not run limit query determinism analysis for LIMIT ALL"}, "afterCommit": {"oid": "dcbac5f01cb6934f1bb3b8d044f44bb601fa15a4", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dcbac5f01cb6934f1bb3b8d044f44bb601fa15a4", "committedDate": "2020-02-28T01:55:23Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dcbac5f01cb6934f1bb3b8d044f44bb601fa15a4", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dcbac5f01cb6934f1bb3b8d044f44bb601fa15a4", "committedDate": "2020-02-28T01:55:23Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}, "afterCommit": {"oid": "2d79dd15a88a08f135824fa00734667f5743ca1c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/2d79dd15a88a08f135824fa00734667f5743ca1c", "committedDate": "2020-02-28T02:54:46Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d79dd15a88a08f135824fa00734667f5743ca1c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/2d79dd15a88a08f135824fa00734667f5743ca1c", "committedDate": "2020-02-28T02:54:46Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}, "afterCommit": {"oid": "7943e09894206cdea8dbec0d96632776aed653a1", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7943e09894206cdea8dbec0d96632776aed653a1", "committedDate": "2020-02-28T06:11:33Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7943e09894206cdea8dbec0d96632776aed653a1", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7943e09894206cdea8dbec0d96632776aed653a1", "committedDate": "2020-02-28T06:11:33Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}, "afterCommit": {"oid": "42062c906187e255d792aaab6650869679e7a728", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/42062c906187e255d792aaab6650869679e7a728", "committedDate": "2020-02-28T06:13:59Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42062c906187e255d792aaab6650869679e7a728", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/42062c906187e255d792aaab6650869679e7a728", "committedDate": "2020-02-28T06:13:59Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}, "afterCommit": {"oid": "9eec1819e1661dda18d1f426ffb45f0dbfb29c3f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9eec1819e1661dda18d1f426ffb45f0dbfb29c3f", "committedDate": "2020-02-28T06:16:23Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9eec1819e1661dda18d1f426ffb45f0dbfb29c3f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9eec1819e1661dda18d1f426ffb45f0dbfb29c3f", "committedDate": "2020-02-28T06:16:23Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}, "afterCommit": {"oid": "af06b58ffd007eead6414af47396303307731b3b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/af06b58ffd007eead6414af47396303307731b3b", "committedDate": "2020-02-28T06:18:30Z", "message": "Restructure LimitQueryDeterminismAnalyzer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af06b58ffd007eead6414af47396303307731b3b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/af06b58ffd007eead6414af47396303307731b3b", "committedDate": "2020-02-28T06:18:30Z", "message": "Restructure LimitQueryDeterminismAnalyzer"}, "afterCommit": {"oid": "e8b9c5d3c05e64d6208af5506cee84941010ee19", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/e8b9c5d3c05e64d6208af5506cee84941010ee19", "committedDate": "2020-02-28T07:48:45Z", "message": "Support determinism analysis for ORDER BY LIMIT queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8b9c5d3c05e64d6208af5506cee84941010ee19", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/e8b9c5d3c05e64d6208af5506cee84941010ee19", "committedDate": "2020-02-28T07:48:45Z", "message": "Support determinism analysis for ORDER BY LIMIT queries"}, "afterCommit": {"oid": "b492938308478a6b3783fd2822c7b43e30a500f8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b492938308478a6b3783fd2822c7b43e30a500f8", "committedDate": "2020-02-28T07:57:57Z", "message": "Support determinism analysis for ORDER BY LIMIT queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b492938308478a6b3783fd2822c7b43e30a500f8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b492938308478a6b3783fd2822c7b43e30a500f8", "committedDate": "2020-02-28T07:57:57Z", "message": "Support determinism analysis for ORDER BY LIMIT queries"}, "afterCommit": {"oid": "ade7bd8873e7bebb853e359b369f95b3c9ba0792", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ade7bd8873e7bebb853e359b369f95b3c9ba0792", "committedDate": "2020-02-28T08:32:01Z", "message": "Support determinism analysis for ORDER BY LIMIT queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ade7bd8873e7bebb853e359b369f95b3c9ba0792", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ade7bd8873e7bebb853e359b369f95b3c9ba0792", "committedDate": "2020-02-28T08:32:01Z", "message": "Support determinism analysis for ORDER BY LIMIT queries"}, "afterCommit": {"oid": "9abd37d7498247e8c795be8acafc2444644a789f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9abd37d7498247e8c795be8acafc2444644a789f", "committedDate": "2020-02-28T07:57:56Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9abd37d7498247e8c795be8acafc2444644a789f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9abd37d7498247e8c795be8acafc2444644a789f", "committedDate": "2020-02-28T07:57:56Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}, "afterCommit": {"oid": "7a55630cdf50561657dae9ffc30c110533c1ba61", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7a55630cdf50561657dae9ffc30c110533c1ba61", "committedDate": "2020-02-28T08:33:41Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a55630cdf50561657dae9ffc30c110533c1ba61", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7a55630cdf50561657dae9ffc30c110533c1ba61", "committedDate": "2020-02-28T08:33:41Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n+1 query instead of a query without LIMIT clause."}, "afterCommit": {"oid": "6bd1d7eee241c576eb9e39ed75ffb0bbadcec396", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6bd1d7eee241c576eb9e39ed75ffb0bbadcec396", "committedDate": "2020-02-28T08:37:12Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2Mjc5NTQ5", "url": "https://github.com/prestodb/presto/pull/14176#pullrequestreview-366279549", "createdAt": "2020-02-28T09:59:21Z", "commit": {"oid": "a2f984fd6fdc0cdf063d5de1cff6908711ebe17a"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwOTo1OToyMVrOFvvceg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMDowMzo1NlrOFvvlug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYwNDczMA==", "bodyText": "nit: check that rowCount > 0", "url": "https://github.com/prestodb/presto/pull/14176#discussion_r385604730", "createdAt": "2020-02-28T09:59:21Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/LimitQueryDeterminismAnalyzer.java", "diffHunk": "@@ -45,26 +45,37 @@\n     private final PrestoAction prestoAction;\n     private final boolean enabled;\n \n-    public LimitQueryDeterminismAnalyzer(PrestoAction prestoAction, boolean enabled)\n+    private final Statement statement;\n+    private final long rowCount;\n+    private final VerificationContext verificationContext;\n+\n+    public LimitQueryDeterminismAnalyzer(\n+            PrestoAction prestoAction,\n+            boolean enabled,\n+            Statement statement,\n+            long rowCount,\n+            VerificationContext verificationContext)\n     {\n         this.prestoAction = requireNonNull(prestoAction, \"prestoAction is null\");\n         this.enabled = enabled;\n+        this.statement = requireNonNull(statement, \"statement is null\");\n+        this.rowCount = rowCount;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2f984fd6fdc0cdf063d5de1cff6908711ebe17a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYwNjIxOA==", "bodyText": "nit: move Pattern.compile(\"all\", CASE_INSENSITIVE) into a static variable to avoid re-compiling on each call", "url": "https://github.com/prestodb/presto/pull/14176#discussion_r385606218", "createdAt": "2020-02-28T10:02:12Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/LimitQueryDeterminismAnalyzer.java", "diffHunk": "@@ -135,29 +148,34 @@ private LimitQueryDeterminismAnalysis analyzeQuerySpecification(Optional<With> w\n                         querySpecification.getGroupBy(),\n                         querySpecification.getHaving(),\n                         Optional.empty(),\n-                        Optional.empty()),\n+                        newLimit),\n                 Optional.empty(),\n                 Optional.empty());\n-        return analyzeLimitNoOrderBy(queryNoLimit);\n+        return analyzeLimitNoOrderBy(newLimitQuery, limit);\n     }\n \n-    private LimitQueryDeterminismAnalysis analyzeLimitNoOrderBy(Query queryNoLimit)\n+    private LimitQueryDeterminismAnalysis analyzeLimitNoOrderBy(Query newLimitQuery, long limit)\n     {\n         Query rowCountQuery = simpleQuery(\n                 new Select(false, ImmutableList.of(new SingleColumn(new FunctionCall(QualifiedName.of(\"count\"), ImmutableList.of(new LongLiteral(\"1\")))))),\n-                new TableSubquery(queryNoLimit));\n+                new TableSubquery(newLimitQuery));\n \n         QueryResult<Long> result = callWithQueryStatsConsumer(\n                 () -> prestoAction.execute(rowCountQuery, DETERMINISM_ANALYSIS, resultSet -> resultSet.getLong(1)),\n                 stats -> verificationContext.setLimitQueryAnalysisQueryId(stats.getQueryId()));\n \n         long rowCountNoLimit = getOnlyElement(result.getResults());\n-        if (rowCountNoLimit > rowCount) {\n-            return NON_DETERMINISTIC;\n-        }\n         if (rowCountNoLimit == rowCount) {\n             return DETERMINISTIC;\n         }\n+        if (rowCount >= limit && rowCountNoLimit > rowCount) {\n+            return NON_DETERMINISTIC;\n+        }\n         return FAILED_DATA_CHANGED;\n     }\n+\n+    private static boolean isLimitAll(String limitClause)\n+    {\n+        return Pattern.compile(\"all\", CASE_INSENSITIVE).matcher(limitClause).matches();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd1d7eee241c576eb9e39ed75ffb0bbadcec396"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYwNzA5OA==", "bodyText": "nit: perhaps, rename rowCountNoLimit to avoid suggesting that the query had no limit, but rather a higher limit\nrowCountHigherLimit", "url": "https://github.com/prestodb/presto/pull/14176#discussion_r385607098", "createdAt": "2020-02-28T10:03:56Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/LimitQueryDeterminismAnalyzer.java", "diffHunk": "@@ -135,29 +148,34 @@ private LimitQueryDeterminismAnalysis analyzeQuerySpecification(Optional<With> w\n                         querySpecification.getGroupBy(),\n                         querySpecification.getHaving(),\n                         Optional.empty(),\n-                        Optional.empty()),\n+                        newLimit),\n                 Optional.empty(),\n                 Optional.empty());\n-        return analyzeLimitNoOrderBy(queryNoLimit);\n+        return analyzeLimitNoOrderBy(newLimitQuery, limit);\n     }\n \n-    private LimitQueryDeterminismAnalysis analyzeLimitNoOrderBy(Query queryNoLimit)\n+    private LimitQueryDeterminismAnalysis analyzeLimitNoOrderBy(Query newLimitQuery, long limit)\n     {\n         Query rowCountQuery = simpleQuery(\n                 new Select(false, ImmutableList.of(new SingleColumn(new FunctionCall(QualifiedName.of(\"count\"), ImmutableList.of(new LongLiteral(\"1\")))))),\n-                new TableSubquery(queryNoLimit));\n+                new TableSubquery(newLimitQuery));\n \n         QueryResult<Long> result = callWithQueryStatsConsumer(\n                 () -> prestoAction.execute(rowCountQuery, DETERMINISM_ANALYSIS, resultSet -> resultSet.getLong(1)),\n                 stats -> verificationContext.setLimitQueryAnalysisQueryId(stats.getQueryId()));\n \n         long rowCountNoLimit = getOnlyElement(result.getResults());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bd1d7eee241c576eb9e39ed75ffb0bbadcec396"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa7673911e018ed835bff91cf778bc106ee658ef", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/aa7673911e018ed835bff91cf778bc106ee658ef", "committedDate": "2020-02-28T21:26:11Z", "message": "Restructure LimitQueryDeterminismAnalyzer\n\n- Break handling of Query and QuerySpecification into two methods.\n- Decouple test methods by removing shared fields.\n- Rename test methods."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bd1d7eee241c576eb9e39ed75ffb0bbadcec396", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6bd1d7eee241c576eb9e39ed75ffb0bbadcec396", "committedDate": "2020-02-28T08:37:12Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}, "afterCommit": {"oid": "caaa14f80fd840779140c591b79ddcb8f2402498", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/caaa14f80fd840779140c591b79ddcb8f2402498", "committedDate": "2020-02-28T21:26:12Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "caaa14f80fd840779140c591b79ddcb8f2402498", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/caaa14f80fd840779140c591b79ddcb8f2402498", "committedDate": "2020-02-28T21:26:12Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}, "afterCommit": {"oid": "dd5ea75f1d70c14f23b404546335242ff0b2c89d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dd5ea75f1d70c14f23b404546335242ff0b2c89d", "committedDate": "2020-02-28T21:34:29Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8095175160872d41564b7b5dde07a614ad59918a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/8095175160872d41564b7b5dde07a614ad59918a", "committedDate": "2020-02-28T22:31:52Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd5ea75f1d70c14f23b404546335242ff0b2c89d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dd5ea75f1d70c14f23b404546335242ff0b2c89d", "committedDate": "2020-02-28T21:34:29Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}, "afterCommit": {"oid": "8095175160872d41564b7b5dde07a614ad59918a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/8095175160872d41564b7b5dde07a614ad59918a", "committedDate": "2020-02-28T22:31:52Z", "message": "Fix and improve performance for limit query determinism analysis\n\n- Do not run analysis for queries with LIMIT ALL clause\n- If row count is less than the limit and row count has changed,\n  FAILED_DATA_CHANGED should be the conclusion instead of\n  NON_DETERMINISTIC.\n- Use a LIMIT n + 1 query instead of a query without LIMIT clause,\n  which is more efficient and less likely to fail."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2355, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}