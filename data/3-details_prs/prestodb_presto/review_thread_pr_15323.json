{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MTI4MjMz", "number": 15323, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0NTozNlrOEya6LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0OToxNFrOEybCQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzA1MTMyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0NTozNlrOHpDPZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNjowMzoyN1rOHpENPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwNjc1OA==", "bodyText": "what's this?", "url": "https://github.com/prestodb/presto/pull/15323#discussion_r512806758", "createdAt": "2020-10-27T15:45:36Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -111,6 +111,8 @@\n \n     private final AtomicLong peakTaskUserMemory = new AtomicLong();\n     private final AtomicLong peakTaskTotalMemory = new AtomicLong();\n+    // TODO populate this value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9032d0f6ee4504bc53adfdcc76d0196ac8ee3d66"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgyMjU5MA==", "bodyText": "Didn't push an updated version of this. I populated it with the task statistics.", "url": "https://github.com/prestodb/presto/pull/15323#discussion_r512822590", "createdAt": "2020-10-27T16:03:27Z", "author": {"login": "aweisberg"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -111,6 +111,8 @@\n \n     private final AtomicLong peakTaskUserMemory = new AtomicLong();\n     private final AtomicLong peakTaskTotalMemory = new AtomicLong();\n+    // TODO populate this value", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwNjc1OA=="}, "originalCommit": {"oid": "9032d0f6ee4504bc53adfdcc76d0196ac8ee3d66"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzA1MzU4OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0NjowMVrOHpDQ3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0NjowMVrOHpDQ3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwNzEzMg==", "bodyText": "nit: one parameter per line", "url": "https://github.com/prestodb/presto/pull/15323#discussion_r512807132", "createdAt": "2020-10-27T15:46:01Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -302,14 +309,15 @@ public WarningCollector getWarningCollector()\n         return warningCollector;\n     }\n \n-    public void updateMemoryUsage(long deltaUserMemoryInBytes, long deltaTotalMemoryInBytes, long taskUserMemoryInBytes, long taskTotalMemoryInBytes)\n+    public void updateMemoryUsage(long deltaUserMemoryInBytes, long deltaTotalMemoryInBytes, long taskUserMemoryInBytes, long taskTotalMemoryInBytes, long peakNodeTotalMemoryInBytes)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9032d0f6ee4504bc53adfdcc76d0196ac8ee3d66"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzA2ODM2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/memory/QueryContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0ODo0MlrOHpDaVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMToxMToyN1rOHpRLNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwOTU1Nw==", "bodyText": "nit: what about using totalMemory  as variable name and also use it in line 424?", "url": "https://github.com/prestodb/presto/pull/15323#discussion_r512809557", "createdAt": "2020-10-27T15:48:42Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/memory/QueryContext.java", "diffHunk": "@@ -413,9 +420,11 @@ private void enforceUserMemoryLimit(long allocated, long delta, long maxMemory)\n     @GuardedBy(\"this\")\n     private void enforceTotalMemoryLimit(long allocated, long delta, long maxMemory)\n     {\n+        long newTotal = allocated + delta;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9032d0f6ee4504bc53adfdcc76d0196ac8ee3d66"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAzNTA2MA==", "bodyText": "Oops, I meant to reuse it. Will rename it.", "url": "https://github.com/prestodb/presto/pull/15323#discussion_r513035060", "createdAt": "2020-10-27T21:11:27Z", "author": {"login": "aweisberg"}, "path": "presto-main/src/main/java/com/facebook/presto/memory/QueryContext.java", "diffHunk": "@@ -413,9 +420,11 @@ private void enforceUserMemoryLimit(long allocated, long delta, long maxMemory)\n     @GuardedBy(\"this\")\n     private void enforceTotalMemoryLimit(long allocated, long delta, long maxMemory)\n     {\n+        long newTotal = allocated + delta;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgwOTU1Nw=="}, "originalCommit": {"oid": "9032d0f6ee4504bc53adfdcc76d0196ac8ee3d66"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMzA3MjAzOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/memory/QueryContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0OToxNFrOHpDcnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTo0OToxNFrOHpDcnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgxMDE0Mw==", "bodyText": "Wondering if this could be done before line 424? -- no strong opinion.", "url": "https://github.com/prestodb/presto/pull/15323#discussion_r512810143", "createdAt": "2020-10-27T15:49:14Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/memory/QueryContext.java", "diffHunk": "@@ -413,9 +420,11 @@ private void enforceUserMemoryLimit(long allocated, long delta, long maxMemory)\n     @GuardedBy(\"this\")\n     private void enforceTotalMemoryLimit(long allocated, long delta, long maxMemory)\n     {\n+        long newTotal = allocated + delta;\n         if (allocated + delta > maxMemory) {\n             throw exceededLocalTotalMemoryLimit(succinctBytes(maxMemory), getAdditionalFailureInfo(allocated, delta));\n         }\n+        peakNodeTotalMemory = Math.max(newTotal, peakNodeTotalMemory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9032d0f6ee4504bc53adfdcc76d0196ac8ee3d66"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3522, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}