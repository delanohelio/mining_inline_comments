{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5ODQzMjQx", "number": 14159, "title": "Minor refactor of array_position", "bodyText": "Remove redundant logic to check null on equal method invocation\nClarify error message\n\n== NO RELEASE NOTE ==", "createdAt": "2020-02-25T22:34:48Z", "url": "https://github.com/prestodb/presto/pull/14159", "merged": true, "mergeCommit": {"oid": "8cfcd15b29db39dcbc8d2cb207d56a0a6c6ecc2d"}, "closed": true, "closedAt": "2020-02-26T14:12:15Z", "author": {"login": "rongrong"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH6bGngFqTM2NDUxNTIwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH7LoFgBqjMwNzE1Mzk2NDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTE1MjA5", "url": "https://github.com/prestodb/presto/pull/14159#pullrequestreview-364515209", "createdAt": "2020-02-25T23:04:52Z", "commit": {"oid": "ad5295eeae4b05e26488302706cd850ecc7e1442"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzowNDo1MlrOFuYiCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzowNzoxN1rOFuYldw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4MDc0NQ==", "bodyText": "Maybe something like array_position does not support elements of complex types that contain null? In theory T can be a map or a row.", "url": "https://github.com/prestodb/presto/pull/14159#discussion_r384180745", "createdAt": "2020-02-25T23:04:52Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/operator/scalar/ArrayPositionFunction.java", "diffHunk": "@@ -158,7 +159,9 @@ public static long arrayPosition(\n                 Object arrayValue = type.getObject(array, i);\n                 try {\n                     Boolean result = (Boolean) equalMethodHandle.invoke(arrayValue, element);\n-                    checkNotIndeterminate(result);\n+                    if (result == null) {\n+                        throw new PrestoException(NOT_SUPPORTED, \"array_position does not support element of array type that contains null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad5295eeae4b05e26488302706cd850ecc7e1442"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4MTYyMw==", "bodyText": "nit: This check rather looks like an assertion. No matter what arguments are passed to this function the equals function should never return null, as the null case is explicitly checked before. For such assertions usually verify is preferred. (same for others).", "url": "https://github.com/prestodb/presto/pull/14159#discussion_r384181623", "createdAt": "2020-02-25T23:07:17Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/operator/scalar/ArrayPositionFunction.java", "diffHunk": "@@ -131,7 +132,7 @@ public static long arrayPosition(\n                 Slice arrayValue = type.getSlice(array, i);\n                 try {\n                     Boolean result = (Boolean) equalMethodHandle.invokeExact(arrayValue, element);\n-                    checkNotIndeterminate(result);\n+                    checkArgument(result != null, \"Array element should not be nulll\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad5295eeae4b05e26488302706cd850ecc7e1442"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d610addd3440258f2d39051140f7fcc2a1afcfdb", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/d610addd3440258f2d39051140f7fcc2a1afcfdb", "committedDate": "2020-02-25T23:59:57Z", "message": "Minor refactor of array_position\n\n* Remove redundant logic to check null on equal method invocation\n* Clarify error message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad5295eeae4b05e26488302706cd850ecc7e1442", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/ad5295eeae4b05e26488302706cd850ecc7e1442", "committedDate": "2020-02-25T22:33:42Z", "message": "Minor refactor of array_position\n\n* Remove redundant logic to check null on equal method invocation\n* Clarify error message"}, "afterCommit": {"oid": "d610addd3440258f2d39051140f7fcc2a1afcfdb", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/d610addd3440258f2d39051140f7fcc2a1afcfdb", "committedDate": "2020-02-25T23:59:57Z", "message": "Minor refactor of array_position\n\n* Remove redundant logic to check null on equal method invocation\n* Clarify error message"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2339, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}