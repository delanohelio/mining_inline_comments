{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4ODczOTY2", "number": 15276, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMDowNlrOEsISOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQyMzoyNzoxMlrOEsOOFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NzA4NTM5OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveClientModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMDowNlrOHfR2og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMDowNlrOHfR2og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2MDQxOA==", "bodyText": "nit: isMetadataCacheEnabled()", "url": "https://github.com/prestodb/presto/pull/15276#discussion_r502560418", "createdAt": "2020-10-09T17:00:06Z", "author": {"login": "shixuan-fan"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveClientModule.java", "diffHunk": "@@ -293,4 +299,23 @@ public StripeMetadataSource createStripeMetadataSource(OrcCacheConfig orcCacheCo\n         }\n         return stripeMetadataSource;\n     }\n+\n+    @Singleton\n+    @Provides\n+    public ParquetMetadataSource createParquetMetadataSource(ParquetCacheConfig parquetCacheConfig, MBeanExporter exporter)\n+    {\n+        ParquetMetadataSource parquetMetadataSource = new MetadataReader();\n+        if (parquetCacheConfig.ismetadataCacheEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa1f04f883227213964b004010a67f8dd97224f"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NzA4NjY0OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveClientModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMDoyNVrOHfR3Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMDoyNVrOHfR3Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2MDYwMg==", "bodyText": "nit: getMetadataCacheSize()", "url": "https://github.com/prestodb/presto/pull/15276#discussion_r502560602", "createdAt": "2020-10-09T17:00:25Z", "author": {"login": "shixuan-fan"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveClientModule.java", "diffHunk": "@@ -293,4 +299,23 @@ public StripeMetadataSource createStripeMetadataSource(OrcCacheConfig orcCacheCo\n         }\n         return stripeMetadataSource;\n     }\n+\n+    @Singleton\n+    @Provides\n+    public ParquetMetadataSource createParquetMetadataSource(ParquetCacheConfig parquetCacheConfig, MBeanExporter exporter)\n+    {\n+        ParquetMetadataSource parquetMetadataSource = new MetadataReader();\n+        if (parquetCacheConfig.ismetadataCacheEnabled()) {\n+            Cache<ParquetDataSourceId, ParquetFileMetadata> cache = CacheBuilder.newBuilder()\n+                    .maximumWeight(parquetCacheConfig.getmetadataCacheSize().toBytes())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa1f04f883227213964b004010a67f8dd97224f"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NzA5NjUwOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveClientModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMzozMFrOHfR9nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQyMjowNDoyMFrOHfZpow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2MjIwNQ==", "bodyText": "nit: getMetadataCacheTtlSinceLastAccess", "url": "https://github.com/prestodb/presto/pull/15276#discussion_r502562205", "createdAt": "2020-10-09T17:03:30Z", "author": {"login": "shixuan-fan"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveClientModule.java", "diffHunk": "@@ -293,4 +299,23 @@ public StripeMetadataSource createStripeMetadataSource(OrcCacheConfig orcCacheCo\n         }\n         return stripeMetadataSource;\n     }\n+\n+    @Singleton\n+    @Provides\n+    public ParquetMetadataSource createParquetMetadataSource(ParquetCacheConfig parquetCacheConfig, MBeanExporter exporter)\n+    {\n+        ParquetMetadataSource parquetMetadataSource = new MetadataReader();\n+        if (parquetCacheConfig.ismetadataCacheEnabled()) {\n+            Cache<ParquetDataSourceId, ParquetFileMetadata> cache = CacheBuilder.newBuilder()\n+                    .maximumWeight(parquetCacheConfig.getmetadataCacheSize().toBytes())\n+                    .weigher((id, metadata) -> ((ParquetFileMetadata) metadata).getMetadataSize())\n+                    .expireAfterAccess(parquetCacheConfig.getmetadataCacheTtlSinceLastAccess().toMillis(), TimeUnit.MILLISECONDS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa1f04f883227213964b004010a67f8dd97224f"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY4ODE2Mw==", "bodyText": "static import MILLISECONDS", "url": "https://github.com/prestodb/presto/pull/15276#discussion_r502688163", "createdAt": "2020-10-09T22:04:20Z", "author": {"login": "zhenxiao"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveClientModule.java", "diffHunk": "@@ -293,4 +299,23 @@ public StripeMetadataSource createStripeMetadataSource(OrcCacheConfig orcCacheCo\n         }\n         return stripeMetadataSource;\n     }\n+\n+    @Singleton\n+    @Provides\n+    public ParquetMetadataSource createParquetMetadataSource(ParquetCacheConfig parquetCacheConfig, MBeanExporter exporter)\n+    {\n+        ParquetMetadataSource parquetMetadataSource = new MetadataReader();\n+        if (parquetCacheConfig.ismetadataCacheEnabled()) {\n+            Cache<ParquetDataSourceId, ParquetFileMetadata> cache = CacheBuilder.newBuilder()\n+                    .maximumWeight(parquetCacheConfig.getmetadataCacheSize().toBytes())\n+                    .weigher((id, metadata) -> ((ParquetFileMetadata) metadata).getMetadataSize())\n+                    .expireAfterAccess(parquetCacheConfig.getmetadataCacheTtlSinceLastAccess().toMillis(), TimeUnit.MILLISECONDS)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2MjIwNQ=="}, "originalCommit": {"oid": "8aa1f04f883227213964b004010a67f8dd97224f"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NzExODg3OnYy", "diffSide": "RIGHT", "path": "presto-parquet/src/main/java/com/facebook/presto/parquet/cache/ParquetCacheConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzoxMDoyNFrOHfSLFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzoxMDoyNFrOHfSLFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2NTY1Mw==", "bodyText": "nit: Capitalize the first letter after get and set in this class", "url": "https://github.com/prestodb/presto/pull/15276#discussion_r502565653", "createdAt": "2020-10-09T17:10:24Z", "author": {"login": "shixuan-fan"}, "path": "presto-parquet/src/main/java/com/facebook/presto/parquet/cache/ParquetCacheConfig.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.parquet.cache;\n+\n+import com.facebook.airlift.configuration.Config;\n+import com.facebook.airlift.configuration.ConfigDescription;\n+import io.airlift.units.DataSize;\n+import io.airlift.units.Duration;\n+import io.airlift.units.MinDataSize;\n+import io.airlift.units.MinDuration;\n+\n+import static io.airlift.units.DataSize.Unit.BYTE;\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+public class ParquetCacheConfig\n+{\n+    private boolean metadataCacheEnabled;\n+    private DataSize metadataCacheSize = new DataSize(0, BYTE);\n+    private Duration metadataCacheTtlSinceLastAccess = new Duration(0, SECONDS);\n+\n+    public boolean ismetadataCacheEnabled()\n+    {\n+        return metadataCacheEnabled;\n+    }\n+\n+    @Config(\"parquet.metadata-cache-enabled\")\n+    @ConfigDescription(\"Enable cache for parquet metadata\")\n+    public ParquetCacheConfig setmetadataCacheEnabled(boolean metadataCacheEnabled)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8aa1f04f883227213964b004010a67f8dd97224f"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0ODA1NzgxOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/test/java/com/facebook/presto/hive/parquet/AbstractTestParquetReader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQyMzoyNzoxMlrOHfbCxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQyMzoyNzoxMlrOHfbCxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxMDk4Mg==", "bodyText": "duplicate line?", "url": "https://github.com/prestodb/presto/pull/15276#discussion_r502710982", "createdAt": "2020-10-09T23:27:12Z", "author": {"login": "zhenxiao"}, "path": "presto-hive/src/test/java/com/facebook/presto/hive/parquet/AbstractTestParquetReader.java", "diffHunk": "@@ -1517,6 +1532,7 @@ private void setParquetLogging()\n     {\n         Logger.getLogger(ParquetOutputFormat.class.getName()).setLevel(Level.WARNING);\n         Logger.getLogger(CodecConfig.class.getName()).setLevel(Level.WARNING);\n+        Logger.getLogger(CodecConfig.class.getName()).setLevel(Level.WARNING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36876ac30fbd4bdb9f1f8e8ddc4418aa5e29f836"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3483, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}