{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDc4MDc0", "number": 14225, "title": "Optimize socket pooling", "bodyText": "== RELEASE NOTES ==\n\nGeneral Changes\n* Optimize connection pooling to avoid running out of sockets in certain cases", "createdAt": "2020-03-07T00:42:17Z", "url": "https://github.com/prestodb/presto/pull/14225", "merged": true, "mergeCommit": {"oid": "c61194f4cbe704f3c410b3d0526e7a9007b32201"}, "closed": true, "closedAt": "2020-03-17T00:43:02Z", "author": {"login": "arhimondr"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMr7C1gFqTM3MzA0NDE3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOXxIPAFqTM3NTY3MDMwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDQ0MTc1", "url": "https://github.com/prestodb/presto/pull/14225#pullrequestreview-373044175", "createdAt": "2020-03-11T19:02:57Z", "commit": {"oid": "3ff655b1cf89f34b3007910d311d36abced34a0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOTowMjo1N1rOF1EzMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOTowMjo1N1rOF1EzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE5NzQ5MA==", "bodyText": "Is this the correct semantic when the RpcShuffleClient is Thrift based?  More generally, should this change be implemented in the HttpClient (the future it returns won't support cancellation?)", "url": "https://github.com/prestodb/presto/pull/14225#discussion_r391197490", "createdAt": "2020-03-11T19:02:57Z", "author": {"login": "tdcmeehan"}, "path": "presto-main/src/main/java/com/facebook/presto/operator/PageBufferClient.java", "diffHunk": "@@ -197,23 +196,17 @@ public synchronized boolean isRunning()\n     public void close()\n     {\n         boolean shouldSendDelete;\n-        Future<?> future;\n         synchronized (this) {\n             shouldSendDelete = !closed;\n \n             closed = true;\n \n-            future = this.future;\n-\n+            // do not cancel the request to avoid closing a pooled connection", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ff655b1cf89f34b3007910d311d36abced34a0f"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d46e20040b6deed665094bfa017cdaffc257d627", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/d46e20040b6deed665094bfa017cdaffc257d627", "committedDate": "2020-03-13T11:53:33Z", "message": "Remove overrides for idle connection timeout\n\nThe override was added when the idle timeout was low in the HttpClient\nconfiguration. Now the default is 1m, thus it is even higher than the\nspecified 30s timeout."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ad8e9fad5c3c9adf2b1722c590add8743e4bbc3", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/0ad8e9fad5c3c9adf2b1722c590add8743e4bbc3", "committedDate": "2020-03-13T11:53:34Z", "message": "Update Airlift to 0.191"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd3fdb9e1f548851325bc3bb115296b9b600a966", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/dd3fdb9e1f548851325bc3bb115296b9b600a966", "committedDate": "2020-03-13T11:53:35Z", "message": "Do not cancel running HTTP requests\n\nCanceling a running HTTP request when using HTTP/1 closes underlying\nconnection decreasing the pooling efficiency. It is also possible to\nrun out of ports ff the connections are closed and reopened too\nfrequently."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ff655b1cf89f34b3007910d311d36abced34a0f", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/3ff655b1cf89f34b3007910d311d36abced34a0f", "committedDate": "2020-03-06T21:29:18Z", "message": "Remove override for idle connection timeout\n\nThe override was added when the idle timeout was low in the HttpClient\nconfiguration. Now the default is 1m, thus it is even higher than the\nspecified 30s timeout."}, "afterCommit": {"oid": "dd3fdb9e1f548851325bc3bb115296b9b600a966", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/dd3fdb9e1f548851325bc3bb115296b9b600a966", "committedDate": "2020-03-13T11:53:35Z", "message": "Do not cancel running HTTP requests\n\nCanceling a running HTTP request when using HTTP/1 closes underlying\nconnection decreasing the pooling efficiency. It is also possible to\nrun out of ports ff the connections are closed and reopened too\nfrequently."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjM1MjQz", "url": "https://github.com/prestodb/presto/pull/14225#pullrequestreview-374635243", "createdAt": "2020-03-13T21:42:00Z", "commit": {"oid": "dd3fdb9e1f548851325bc3bb115296b9b600a966"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjcwMzAx", "url": "https://github.com/prestodb/presto/pull/14225#pullrequestreview-375670301", "createdAt": "2020-03-17T00:42:30Z", "commit": {"oid": "dd3fdb9e1f548851325bc3bb115296b9b600a966"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2020, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}