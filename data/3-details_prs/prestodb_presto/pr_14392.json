{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNDYxNzQy", "number": 14392, "title": "Support built-in SQL scalar functions", "bodyText": "== RELEASE NOTES ==\n\nGeneral Changes\n* Add support for defining SQL-invoked functions in plugins.\n* Add functions :func:`array_sum` and :func:`map_normalize`.", "createdAt": "2020-04-14T23:24:56Z", "url": "https://github.com/prestodb/presto/pull/14392", "merged": true, "mergeCommit": {"oid": "dbadef16fea9259171def38b47950056aaf0e84c"}, "closed": true, "closedAt": "2020-06-12T00:37:18Z", "author": {"login": "caithagoras"}, "timelineItems": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZZIrvABqjMyNTAyNjk2ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqGDnigBqjM0MzIzNDU1ODE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5721575b3c3849837276a86d000f31a471e65dbe", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/5721575b3c3849837276a86d000f31a471e65dbe", "committedDate": "2020-04-14T23:21:16Z", "message": "Store SqlFunction instead of BuiltInFunction in built-in FNM"}, "afterCommit": {"oid": "682376bd4ae980dbb237ad7c351a5d784e50fa99", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/682376bd4ae980dbb237ad7c351a5d784e50fa99", "committedDate": "2020-04-20T06:31:10Z", "message": "Store SqlFunction instead of BuiltInFunction in built-in FNM"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "682376bd4ae980dbb237ad7c351a5d784e50fa99", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/682376bd4ae980dbb237ad7c351a5d784e50fa99", "committedDate": "2020-04-20T06:31:10Z", "message": "Store SqlFunction instead of BuiltInFunction in built-in FNM"}, "afterCommit": {"oid": "c1b2cb3bc85f653406b221cff8d5c03f3bbfb1d3", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c1b2cb3bc85f653406b221cff8d5c03f3bbfb1d3", "committedDate": "2020-04-20T06:31:19Z", "message": "Store SqlFunction in built-in Function Namespace Manager\n\nas opposed to BuiltInFunction."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1b2cb3bc85f653406b221cff8d5c03f3bbfb1d3", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c1b2cb3bc85f653406b221cff8d5c03f3bbfb1d3", "committedDate": "2020-04-20T06:31:19Z", "message": "Store SqlFunction in built-in Function Namespace Manager\n\nas opposed to BuiltInFunction."}, "afterCommit": {"oid": "4c2faadf77ba7ebc3b95249dcaf794460f5478cb", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4c2faadf77ba7ebc3b95249dcaf794460f5478cb", "committedDate": "2020-04-20T06:32:11Z", "message": "Rename SqlParameter to Parameter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c2faadf77ba7ebc3b95249dcaf794460f5478cb", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4c2faadf77ba7ebc3b95249dcaf794460f5478cb", "committedDate": "2020-04-20T06:32:11Z", "message": "Rename SqlParameter to Parameter"}, "afterCommit": {"oid": "8aaed652403d929f73df446f660b37629e5f55c2", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/8aaed652403d929f73df446f660b37629e5f55c2", "committedDate": "2020-04-20T08:47:07Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8aaed652403d929f73df446f660b37629e5f55c2", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/8aaed652403d929f73df446f660b37629e5f55c2", "committedDate": "2020-04-20T08:47:07Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "de851c0de47a562ec3ed0732b764d378ef86fb85", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/de851c0de47a562ec3ed0732b764d378ef86fb85", "committedDate": "2020-04-20T08:49:11Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de851c0de47a562ec3ed0732b764d378ef86fb85", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/de851c0de47a562ec3ed0732b764d378ef86fb85", "committedDate": "2020-04-20T08:49:11Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "fa4ca16dcc03fb19303a5d498261ec3d82e1e985", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/fa4ca16dcc03fb19303a5d498261ec3d82e1e985", "committedDate": "2020-04-20T08:52:57Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa4ca16dcc03fb19303a5d498261ec3d82e1e985", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/fa4ca16dcc03fb19303a5d498261ec3d82e1e985", "committedDate": "2020-04-20T08:52:57Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "12456b6bb53cea3600a3c96ab31b4b92ad883186", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/12456b6bb53cea3600a3c96ab31b4b92ad883186", "committedDate": "2020-04-20T08:55:33Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12456b6bb53cea3600a3c96ab31b4b92ad883186", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/12456b6bb53cea3600a3c96ab31b4b92ad883186", "committedDate": "2020-04-20T08:55:33Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "b745152f70bf14f46a195e66ad65bca43a4ee19c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b745152f70bf14f46a195e66ad65bca43a4ee19c", "committedDate": "2020-04-20T08:59:42Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b745152f70bf14f46a195e66ad65bca43a4ee19c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b745152f70bf14f46a195e66ad65bca43a4ee19c", "committedDate": "2020-04-20T08:59:42Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "98c50e876721bed4f2c5b32c85a1345151bf2af3", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/98c50e876721bed4f2c5b32c85a1345151bf2af3", "committedDate": "2020-04-20T09:04:29Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98c50e876721bed4f2c5b32c85a1345151bf2af3", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/98c50e876721bed4f2c5b32c85a1345151bf2af3", "committedDate": "2020-04-20T09:04:29Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "0ab4a50c4432a064f0246aafb70faf78da73fe95", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0ab4a50c4432a064f0246aafb70faf78da73fe95", "committedDate": "2020-04-20T09:14:37Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ab4a50c4432a064f0246aafb70faf78da73fe95", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0ab4a50c4432a064f0246aafb70faf78da73fe95", "committedDate": "2020-04-20T09:14:37Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "b98838e59a6d3183fb1c31daa9b15c511492358b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b98838e59a6d3183fb1c31daa9b15c511492358b", "committedDate": "2020-04-20T10:37:54Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b98838e59a6d3183fb1c31daa9b15c511492358b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b98838e59a6d3183fb1c31daa9b15c511492358b", "committedDate": "2020-04-20T10:37:54Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "7be480144c31114cb2d4d9bd334550f952b39fbd", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7be480144c31114cb2d4d9bd334550f952b39fbd", "committedDate": "2020-04-20T21:16:27Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7be480144c31114cb2d4d9bd334550f952b39fbd", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7be480144c31114cb2d4d9bd334550f952b39fbd", "committedDate": "2020-04-20T21:16:27Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "827f47524ef88b990a5cceb8e567e3b065985653", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/827f47524ef88b990a5cceb8e567e3b065985653", "committedDate": "2020-04-20T21:26:52Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "827f47524ef88b990a5cceb8e567e3b065985653", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/827f47524ef88b990a5cceb8e567e3b065985653", "committedDate": "2020-04-20T21:26:52Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "8d7bb688508d5c2b6aad3cfadc487a91d5f7c910", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/8d7bb688508d5c2b6aad3cfadc487a91d5f7c910", "committedDate": "2020-04-20T21:31:02Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d7bb688508d5c2b6aad3cfadc487a91d5f7c910", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/8d7bb688508d5c2b6aad3cfadc487a91d5f7c910", "committedDate": "2020-04-20T21:31:02Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "0a50ac1b6dd0c0dc2b0e4f99fefc8cdd97580553", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0a50ac1b6dd0c0dc2b0e4f99fefc8cdd97580553", "committedDate": "2020-04-20T21:59:43Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a50ac1b6dd0c0dc2b0e4f99fefc8cdd97580553", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0a50ac1b6dd0c0dc2b0e4f99fefc8cdd97580553", "committedDate": "2020-04-20T21:59:43Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "e745dcf893ffb552c3ffb4e0c7bc1b715bc65743", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/e745dcf893ffb552c3ffb4e0c7bc1b715bc65743", "committedDate": "2020-04-20T22:12:09Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e745dcf893ffb552c3ffb4e0c7bc1b715bc65743", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/e745dcf893ffb552c3ffb4e0c7bc1b715bc65743", "committedDate": "2020-04-20T22:12:09Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "665ae2dd76c32aaca839eda0ebd7d4cc9f6edcd8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/665ae2dd76c32aaca839eda0ebd7d4cc9f6edcd8", "committedDate": "2020-04-20T22:13:36Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "665ae2dd76c32aaca839eda0ebd7d4cc9f6edcd8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/665ae2dd76c32aaca839eda0ebd7d4cc9f6edcd8", "committedDate": "2020-04-20T22:13:36Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "08f6a55ce8b66398f7d8d362d992ab262b63850c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/08f6a55ce8b66398f7d8d362d992ab262b63850c", "committedDate": "2020-04-20T22:14:06Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08f6a55ce8b66398f7d8d362d992ab262b63850c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/08f6a55ce8b66398f7d8d362d992ab262b63850c", "committedDate": "2020-04-20T22:14:06Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "5dd63dfc53e86ae6c3c3df03cdf3af4576bd240d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/5dd63dfc53e86ae6c3c3df03cdf3af4576bd240d", "committedDate": "2020-04-20T22:14:24Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTIxNTUy", "url": "https://github.com/prestodb/presto/pull/14392#pullrequestreview-396921552", "createdAt": "2020-04-21T01:11:21Z", "commit": {"oid": "8d7bb688508d5c2b6aad3cfadc487a91d5f7c910"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMToxMTo0OFrOGIuEQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwMToxMTo0OFrOGIuEQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5NjU0Nw==", "bodyText": "May be mention here that it's similar to the SUM aggregation.", "url": "https://github.com/prestodb/presto/pull/14392#discussion_r411796547", "createdAt": "2020-04-21T01:11:48Z", "author": {"login": "kaikalur"}, "path": "presto-docs/src/main/sphinx/functions/array.rst", "diffHunk": "@@ -102,6 +102,11 @@ Array Functions\n                                        -1,\n                                        IF(cardinality(x) = cardinality(y), 0, 1))); -- [[1, 2], [2, 3, 1], [4, 2, 1, 4]]\n \n+.. function:: array_sum(array(T)) -> T\n+\n+    Returns the sum of all non-null elements of the ``array``. If there is no non-null elements, returns ``0``.\n+    ``T`` must be coercible to ``double`` or ``bigint``.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dd63dfc53e86ae6c3c3df03cdf3af4576bd240d"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5dd63dfc53e86ae6c3c3df03cdf3af4576bd240d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/5dd63dfc53e86ae6c3c3df03cdf3af4576bd240d", "committedDate": "2020-04-20T22:14:24Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "6aaf8a6078bf4faae53d4bb238cae9fc50a07f3d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6aaf8a6078bf4faae53d4bb238cae9fc50a07f3d", "committedDate": "2020-04-23T22:33:02Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6aaf8a6078bf4faae53d4bb238cae9fc50a07f3d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6aaf8a6078bf4faae53d4bb238cae9fc50a07f3d", "committedDate": "2020-04-23T22:33:02Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "1a983095f24218ec1fea3c225d4ee1a36860c6b7", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1a983095f24218ec1fea3c225d4ee1a36860c6b7", "committedDate": "2020-04-23T22:33:47Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTgwNzE5", "url": "https://github.com/prestodb/presto/pull/14392#pullrequestreview-402180719", "createdAt": "2020-04-28T20:20:03Z", "commit": {"oid": "1a983095f24218ec1fea3c225d4ee1a36860c6b7"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMDoyMDowM1rOGNlVcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMDozNDozNlrOGNl1-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg5NjM3MA==", "bodyText": "It might worth looking into supporting generics in signatures for builtin sql functions.", "url": "https://github.com/prestodb/presto/pull/14392#discussion_r416896370", "createdAt": "2020-04-28T20:20:03Z", "author": {"login": "rongrong"}, "path": "presto-docs/src/main/sphinx/functions/array.rst", "diffHunk": "@@ -102,6 +102,11 @@ Array Functions\n                                        -1,\n                                        IF(cardinality(x) = cardinality(y), 0, 1))); -- [[1, 2], [2, 3, 1], [4, 2, 1, 4]]\n \n+.. function:: array_sum(array(T)) -> T\n+\n+    Returns the sum of all non-null elements of the ``array``. If there is no non-null elements, returns ``0``.\n+    ``T`` must be coercible to ``double`` or ``bigint``.\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5NjU0Nw=="}, "originalCommit": {"oid": "5dd63dfc53e86ae6c3c3df03cdf3af4576bd240d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg5ODEyMQ==", "bodyText": "I think it's probably make sense to add language to SqlFunction. Implementation type is sort of a derived metadata from language. That could clean up some of the type checks you have in your code.", "url": "https://github.com/prestodb/presto/pull/14392#discussion_r416898121", "createdAt": "2020-04-28T20:23:07Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/BuiltInFunctionNamespaceManager.java", "diffHunk": "@@ -785,8 +801,13 @@ public FunctionMetadata getFunctionMetadata(FunctionHandle functionHandle)\n             throw e;\n         }\n         SqlFunction function = functionKey.getFunction();\n+        FunctionImplementationType implementationType = function instanceof SqlInvokedFunction ? SQL : BUILTIN;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a983095f24218ec1fea3c225d4ee1a36860c6b7"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkwNDY5OA==", "bodyText": "Please try not to rename spi classes unless absolutely necessary.", "url": "https://github.com/prestodb/presto/pull/14392#discussion_r416904698", "createdAt": "2020-04-28T20:34:36Z", "author": {"login": "rongrong"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/Parameter.java", "diffHunk": "@@ -21,13 +21,13 @@\n \n import static java.util.Objects.requireNonNull;\n \n-public class SqlParameter\n+public class Parameter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2db1f3a82ddcf94b541d7cdb0b18b13630fa7d"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a983095f24218ec1fea3c225d4ee1a36860c6b7", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1a983095f24218ec1fea3c225d4ee1a36860c6b7", "committedDate": "2020-04-23T22:33:47Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "098499848a42d7ba508e7289dec5997c4a6a899f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/098499848a42d7ba508e7289dec5997c4a6a899f", "committedDate": "2020-04-30T22:45:09Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "098499848a42d7ba508e7289dec5997c4a6a899f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/098499848a42d7ba508e7289dec5997c4a6a899f", "committedDate": "2020-04-30T22:45:09Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "436174cf2a360da8c25d0a4c696e8ac7b42a58cf", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/436174cf2a360da8c25d0a4c696e8ac7b42a58cf", "committedDate": "2020-05-01T00:57:02Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "436174cf2a360da8c25d0a4c696e8ac7b42a58cf", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/436174cf2a360da8c25d0a4c696e8ac7b42a58cf", "committedDate": "2020-05-01T00:57:02Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "2a3e834e396d952af120d0e551c941faef678d3f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/2a3e834e396d952af120d0e551c941faef678d3f", "committedDate": "2020-06-09T19:54:02Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a3e834e396d952af120d0e551c941faef678d3f", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/2a3e834e396d952af120d0e551c941faef678d3f", "committedDate": "2020-06-09T19:54:02Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "4ea255b3c043bde383bbadb5588fd4696ed7ce4b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4ea255b3c043bde383bbadb5588fd4696ed7ce4b", "committedDate": "2020-06-09T20:05:30Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ea255b3c043bde383bbadb5588fd4696ed7ce4b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4ea255b3c043bde383bbadb5588fd4696ed7ce4b", "committedDate": "2020-06-09T20:05:30Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "f1135f7d0c3380e080a12ae8653b0f2b03a85a7a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/f1135f7d0c3380e080a12ae8653b0f2b03a85a7a", "committedDate": "2020-06-09T20:19:17Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1135f7d0c3380e080a12ae8653b0f2b03a85a7a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/f1135f7d0c3380e080a12ae8653b0f2b03a85a7a", "committedDate": "2020-06-09T20:19:17Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "326e55c09888fed9b421596cae1a62fcacdd02f1", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/326e55c09888fed9b421596cae1a62fcacdd02f1", "committedDate": "2020-06-10T00:11:48Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "326e55c09888fed9b421596cae1a62fcacdd02f1", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/326e55c09888fed9b421596cae1a62fcacdd02f1", "committedDate": "2020-06-10T00:11:48Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "1de9e7e07d2fd7ade42b552a397f05f5a6aa2eb9", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1de9e7e07d2fd7ade42b552a397f05f5a6aa2eb9", "committedDate": "2020-06-10T00:21:43Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjM0MzA0", "url": "https://github.com/prestodb/presto/pull/14392#pullrequestreview-427634304", "createdAt": "2020-06-10T00:31:14Z", "commit": {"oid": "1de9e7e07d2fd7ade42b552a397f05f5a6aa2eb9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMDozMToxNFrOGhg55A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMDozNjoyN1rOGhg-qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5NTMwMA==", "bodyText": "You might want to just say array_average(array<double>) -> double instead, rather than saying it's a generic type T that's coercible to double. This would be more consistent with code. Also, for map_normalize you just used map<varchar,double> rather than saying map<varchar,T>. People should know that you can all a function that takes array<double> with array<T coercible with double>.", "url": "https://github.com/prestodb/presto/pull/14392#discussion_r437795300", "createdAt": "2020-06-10T00:31:14Z", "author": {"login": "rongrong"}, "path": "presto-docs/src/main/sphinx/functions/array.rst", "diffHunk": "@@ -35,6 +35,13 @@ Array Functions\n     array is empty); ``NULL`` if the predicate function returns ``NULL`` for one or more elements and ``false``\n     for all other elements.\n \n+.. function:: array_average(array(T)) -> double", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1de9e7e07d2fd7ade42b552a397f05f5a6aa2eb9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5NjUyMQ==", "bodyText": "Can we combine the two? I don't see the point to have a different annotation for multiple functions and single function. We use @ScalarFunction to annotate both class and method. It's also quite confusing to user since it's very hard to notice the difference of the two (so very easily to use the wrong one).", "url": "https://github.com/prestodb/presto/pull/14392#discussion_r437796521", "createdAt": "2020-06-10T00:36:27Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/FunctionExtractor.java", "diffHunk": "@@ -55,6 +58,14 @@ private FunctionExtractor() {}\n             return ScalarFromAnnotationsParser.parseFunctionDefinition(clazz);\n         }\n \n+        if (clazz.isAnnotationPresent(SqlInvokedScalarFunctions.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1de9e7e07d2fd7ade42b552a397f05f5a6aa2eb9"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1de9e7e07d2fd7ade42b552a397f05f5a6aa2eb9", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1de9e7e07d2fd7ade42b552a397f05f5a6aa2eb9", "committedDate": "2020-06-10T00:21:43Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "001c5aee7a5c2e49c74cb20588276f06856845f8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/001c5aee7a5c2e49c74cb20588276f06856845f8", "committedDate": "2020-06-10T01:02:49Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjQ0OTM3", "url": "https://github.com/prestodb/presto/pull/14392#pullrequestreview-427644937", "createdAt": "2020-06-10T01:08:02Z", "commit": {"oid": "001c5aee7a5c2e49c74cb20588276f06856845f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMTowODowM1rOGhhdpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMTowODowM1rOGhhdpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgwNDQ1Mg==", "bodyText": "Remove this line.", "url": "https://github.com/prestodb/presto/pull/14392#discussion_r437804452", "createdAt": "2020-06-10T01:08:03Z", "author": {"login": "rongrong"}, "path": "presto-docs/src/main/sphinx/functions/array.rst", "diffHunk": "@@ -35,6 +35,13 @@ Array Functions\n     array is empty); ``NULL`` if the predicate function returns ``NULL`` for one or more elements and ``false``\n     for all other elements.\n \n+.. function:: array_average(array(double)) -> double\n+\n+    Returns the average of all non-null elements of the ``array``. If there is no non-null elements, returns\n+    ``null``.\n+\n+    ``T`` must be coercible to ``double``.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "001c5aee7a5c2e49c74cb20588276f06856845f8"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjQ1MDg3", "url": "https://github.com/prestodb/presto/pull/14392#pullrequestreview-427645087", "createdAt": "2020-06-10T01:08:34Z", "commit": {"oid": "001c5aee7a5c2e49c74cb20588276f06856845f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "001c5aee7a5c2e49c74cb20588276f06856845f8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/001c5aee7a5c2e49c74cb20588276f06856845f8", "committedDate": "2020-06-10T01:02:49Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "4293df83a01ea3c2af03b54913cd08ea8c509801", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4293df83a01ea3c2af03b54913cd08ea8c509801", "committedDate": "2020-06-10T01:24:08Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4293df83a01ea3c2af03b54913cd08ea8c509801", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4293df83a01ea3c2af03b54913cd08ea8c509801", "committedDate": "2020-06-10T01:24:08Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "ceb1c4c9e2d340af1382e1370a7bc62acc682690", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ceb1c4c9e2d340af1382e1370a7bc62acc682690", "committedDate": "2020-06-10T22:22:09Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ceb1c4c9e2d340af1382e1370a7bc62acc682690", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ceb1c4c9e2d340af1382e1370a7bc62acc682690", "committedDate": "2020-06-10T22:22:09Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "4d4f136964660a122a5c906ce0caff5acd47a7ab", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4d4f136964660a122a5c906ce0caff5acd47a7ab", "committedDate": "2020-06-10T22:28:16Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d4f136964660a122a5c906ce0caff5acd47a7ab", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4d4f136964660a122a5c906ce0caff5acd47a7ab", "committedDate": "2020-06-10T22:28:16Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "1bc556d39c9ce9954b8164ca0f7c8719dde45ab6", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1bc556d39c9ce9954b8164ca0f7c8719dde45ab6", "committedDate": "2020-06-11T00:34:48Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebcea0e6cd188891a680f3cd878c62a028cf3175", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ebcea0e6cd188891a680f3cd878c62a028cf3175", "committedDate": "2020-06-11T03:54:05Z", "message": "Store SqlFunction in built-in Function Namespace Manager\n\nas opposed to BuiltInFunction."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e355c7f1f0482719b4d6e84ee83a329bc4347d26", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/e355c7f1f0482719b4d6e84ee83a329bc4347d26", "committedDate": "2020-06-11T03:54:05Z", "message": "Rename SqlParameter to Parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c5d5d9503ab1d0d46cf309d0de824fc77b8481d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/4c5d5d9503ab1d0d46cf309d0de824fc77b8481d", "committedDate": "2020-06-11T03:54:05Z", "message": "Combine FunctionMetadata constructors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb504e665d428a4e8aaa0af7be31e4cc93f3f1fb", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/fb504e665d428a4e8aaa0af7be31e4cc93f3f1fb", "committedDate": "2020-06-11T03:54:05Z", "message": "Support built-in SQL-invoked functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bc556d39c9ce9954b8164ca0f7c8719dde45ab6", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1bc556d39c9ce9954b8164ca0f7c8719dde45ab6", "committedDate": "2020-06-11T00:34:48Z", "message": "Support built-in SQL-invoked functions"}, "afterCommit": {"oid": "fb504e665d428a4e8aaa0af7be31e4cc93f3f1fb", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/fb504e665d428a4e8aaa0af7be31e4cc93f3f1fb", "committedDate": "2020-06-11T03:54:05Z", "message": "Support built-in SQL-invoked functions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1858, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}