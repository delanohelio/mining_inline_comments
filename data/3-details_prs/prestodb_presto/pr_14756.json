{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNDQxODAw", "number": 14756, "title": "Ensure exception thrown by scheduled tasks are logged", "bodyText": "Regularly scheduled tasks are dying as long as at least single run fails.\nCatching and logging the failures will help to debug problems in scheduled tasks.\n== NO RELEASE NOTE ==", "createdAt": "2020-07-01T04:58:24Z", "url": "https://github.com/prestodb/presto/pull/14756", "merged": true, "mergeCommit": {"oid": "4479e85c7b22e6cfb109c7459e94f65cdf2dedb7"}, "closed": true, "closedAt": "2020-08-10T17:19:22Z", "author": {"login": "arhimondr"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwpb19AFqTQ0MDgyMzAyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9kO7YgBqjM2MzkzOTAzNjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwODIzMDI4", "url": "https://github.com/prestodb/presto/pull/14756#pullrequestreview-440823028", "createdAt": "2020-07-01T12:29:25Z", "commit": {"oid": "e0273d18de07b64b150a682162f6c54aeb795945"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoyOToyNVrOGrj0uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjozMDoxN1rOGrj2mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyODg5MQ==", "bodyText": "In my opinion we should log and throw until and unless we are confident it is OK to retry and also that retry can fix things. If we get into a situation that 1 eentry is causing problems and that is causing this executor to always exit midway, then dying and complaining is probably a better solution.", "url": "https://github.com/prestodb/presto/pull/14756#discussion_r448328891", "createdAt": "2020-07-01T12:29:25Z", "author": {"login": "mayankgarg1990"}, "path": "presto-cache/src/main/java/com/facebook/presto/cache/filemerge/FileMergeCacheManager.java", "diffHunk": "@@ -153,8 +153,13 @@ public FileMergeCacheManager(\n \n         this.cacheSizeCalculateExecutor.scheduleAtFixedRate(\n                 () -> {\n-                    cacheScopeFiles.keySet().forEach(cacheIdentifier -> cacheScopeSizeInBytes.put(cacheIdentifier, getCacheScopeSizeInBytes(cacheIdentifier)));\n-                    cacheScopeSizeInBytes.keySet().removeIf(key -> !cacheScopeFiles.containsKey(key));\n+                    try {\n+                        cacheScopeFiles.keySet().forEach(cacheIdentifier -> cacheScopeSizeInBytes.put(cacheIdentifier, getCacheScopeSizeInBytes(cacheIdentifier)));\n+                        cacheScopeSizeInBytes.keySet().removeIf(key -> !cacheScopeFiles.containsKey(key));\n+                    }\n+                    catch (Throwable t) {\n+                        log.error(t, \"Error calculating cache size\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0273d18de07b64b150a682162f6c54aeb795945"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyOTM3MQ==", "bodyText": "It is better to not to schedule rather than to die midway everytime. Detecting and fixing no scheduling is easier than partial scheduling.", "url": "https://github.com/prestodb/presto/pull/14756#discussion_r448329371", "createdAt": "2020-07-01T12:30:17Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/resourceGroups/InternalResourceGroupManager.java", "diffHunk": "@@ -200,7 +200,6 @@ public void start()\n                 }\n                 catch (Throwable t) {\n                     log.error(t, \"Error while executing refreshAndStartQueries\");\n-                    throw t;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0273d18de07b64b150a682162f6c54aeb795945"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0273d18de07b64b150a682162f6c54aeb795945", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/e0273d18de07b64b150a682162f6c54aeb795945", "committedDate": "2020-07-01T04:35:03Z", "message": "Ensure exception thrown by scheduled tasks are logged\n\nRegularly scheduled tasks are dying as long as at least single run fails.\nCatching and logging the failures will help to debug problems in scheduled tasks."}, "afterCommit": {"oid": "1e2068a586fcb030d5defacb9b6679c1634441a2", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/1e2068a586fcb030d5defacb9b6679c1634441a2", "committedDate": "2020-07-01T22:10:50Z", "message": "Ensure exception thrown by scheduled tasks are logged\n\nRegularly scheduled tasks are dying as long as at least single run fails.\nCatching and logging the failures will help to debug problems in scheduled tasks."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTEyNzY4", "url": "https://github.com/prestodb/presto/pull/14756#pullrequestreview-462912768", "createdAt": "2020-08-06T22:16:10Z", "commit": {"oid": "1e2068a586fcb030d5defacb9b6679c1634441a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5574dc3b266f7ccc3958df0d1ef57c8ff85e6ea", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/f5574dc3b266f7ccc3958df0d1ef57c8ff85e6ea", "committedDate": "2020-08-10T15:06:38Z", "message": "Ensure exception thrown by scheduled tasks are logged\n\nRegularly scheduled tasks are dying as long as at least single run fails.\nCatching and logging the failures will help to debug problems in scheduled tasks."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e2068a586fcb030d5defacb9b6679c1634441a2", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/1e2068a586fcb030d5defacb9b6679c1634441a2", "committedDate": "2020-07-01T22:10:50Z", "message": "Ensure exception thrown by scheduled tasks are logged\n\nRegularly scheduled tasks are dying as long as at least single run fails.\nCatching and logging the failures will help to debug problems in scheduled tasks."}, "afterCommit": {"oid": "f5574dc3b266f7ccc3958df0d1ef57c8ff85e6ea", "author": {"user": {"login": "arhimondr", "name": "Andrii Rosa"}}, "url": "https://github.com/prestodb/presto/commit/f5574dc3b266f7ccc3958df0d1ef57c8ff85e6ea", "committedDate": "2020-08-10T15:06:38Z", "message": "Ensure exception thrown by scheduled tasks are logged\n\nRegularly scheduled tasks are dying as long as at least single run fails.\nCatching and logging the failures will help to debug problems in scheduled tasks."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1146, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}