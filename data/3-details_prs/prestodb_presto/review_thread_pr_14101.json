{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MTk0OTU0", "number": 14101, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo1MVrODfz75Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMDozMToxNFrODgAmCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjgzMzY1OnYy", "diffSide": "LEFT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo1MVrOFpu0-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo1MVrOFpu0-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzE2MQ==", "bodyText": "boolean forceLocalScheduling = nodeSelectionStrategy == HARD_AFFINITY", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303161", "createdAt": "2020-02-14T08:30:51Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -133,15 +130,11 @@ public InternalHiveSplitFactory(\n             return Optional.empty();\n         }\n \n-        boolean forceLocalScheduling = this.forceLocalScheduling;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjgzMzgyOnYy", "diffSide": "LEFT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo1NlrOFpu1Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo1NlrOFpu1Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzE5MA==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303190", "createdAt": "2020-02-14T08:30:56Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -133,15 +130,11 @@ public InternalHiveSplitFactory(\n             return Optional.empty();\n         }\n \n-        boolean forceLocalScheduling = this.forceLocalScheduling;\n-\n         // For empty files, some filesystem (e.g. LocalFileSystem) produce one empty block\n         // while others (e.g. hdfs.DistributedFileSystem) produces no block.\n         // Synthesize an empty block if one does not already exist.\n         if (fileSize == 0 && blockLocations.length == 0) {\n             blockLocations = new BlockLocation[] {new BlockLocation()};\n-            // Turn off force local scheduling because hosts list doesn't exist.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjgzNDI0OnYy", "diffSide": "LEFT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMTowM1rOFpu1Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMTowM1rOFpu1Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzI0Nw==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303247", "createdAt": "2020-02-14T08:31:03Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -159,7 +152,7 @@ public InternalHiveSplitFactory(\n             }\n \n             List<HostAddress> addresses = getHostAddresses(blockLocation);\n-            if (!needsHostAddresses(forceLocalScheduling, addresses)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjgzNDM3OnYy", "diffSide": "LEFT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMTowN1rOFpu1Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMTowN1rOFpu1Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzI2Ng==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303266", "createdAt": "2020-02-14T08:31:07Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -170,7 +163,7 @@ public InternalHiveSplitFactory(\n         if (!splittable) {\n             // not splittable, use the hosts from the first block if it exists\n             List<HostAddress> addresses = blocks.get(0).getAddresses();\n-            if (!needsHostAddresses(forceLocalScheduling, addresses)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjgzNTIzOnYy", "diffSide": "LEFT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMToyNlrOFpu15w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMToyNlrOFpu15w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzM5OQ==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303399", "createdAt": "2020-02-14T08:31:26Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -186,16 +179,15 @@ public InternalHiveSplitFactory(\n                 readBucketNumber,\n                 tableBucketNumber,\n                 splittable,\n-                forceLocalScheduling && allBlocksHaveRealAddress(blocks),\n                 (nodeSelectionStrategy == HARD_AFFINITY && !allBlocksHaveRealAddress(blocks)) ? NO_PREFERENCE : nodeSelectionStrategy,\n                 s3SelectPushdownEnabled && S3SelectPushdown.isCompressionCodecSupported(inputFormat, path),\n                 partitionInfo,\n                 extraFileInfo));\n     }\n \n-    private boolean needsHostAddresses(boolean forceLocalScheduling, List<HostAddress> addresses)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0Njg1OTczOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODo0MTo0M1rOFpvE-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODo0MTo0M1rOFpvE-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwNzI1Ng==", "bodyText": "I think this should be\nforceLocalScheduling && allBlocksHaveRealAddress(blocks) && nodeSelectionStrategy == HARD_AFFINITY ? HARD_AFFINITY : nodeSelectionStrategy\nBecause forceLocalScheduling can be turned off", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379307256", "createdAt": "2020-02-14T08:41:43Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -186,16 +179,15 @@ public InternalHiveSplitFactory(\n                 readBucketNumber,\n                 tableBucketNumber,\n                 splittable,\n-                forceLocalScheduling && allBlocksHaveRealAddress(blocks),\n                 (nodeSelectionStrategy == HARD_AFFINITY && !allBlocksHaveRealAddress(blocks)) ? NO_PREFERENCE : nodeSelectionStrategy,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0ODkwNzYyOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMDozMToxNFrOFqC2hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMDozNToxMVrOFqC8Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYzMTIzOA==", "bodyText": "You need && nodeSelectionStrategy == HARD_AFFINITY", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379631238", "createdAt": "2020-02-14T20:31:14Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -186,8 +181,7 @@ public InternalHiveSplitFactory(\n                 readBucketNumber,\n                 tableBucketNumber,\n                 splittable,\n-                forceLocalScheduling && allBlocksHaveRealAddress(blocks),\n-                (nodeSelectionStrategy == HARD_AFFINITY && !allBlocksHaveRealAddress(blocks)) ? NO_PREFERENCE : nodeSelectionStrategy,\n+                forceLocalScheduling && allBlocksHaveRealAddress(blocks) ? HARD_AFFINITY : nodeSelectionStrategy,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d0dd121e20ec8e182c0f427ab603997fc333d54"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYzMjcyMg==", "bodyText": "You need && nodeSelectionStrategy == HARD_AFFINITY\n\nIDE indicates that It's actually redundant and it is", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379632722", "createdAt": "2020-02-14T20:35:11Z", "author": {"login": "kewang1024"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -186,8 +181,7 @@ public InternalHiveSplitFactory(\n                 readBucketNumber,\n                 tableBucketNumber,\n                 splittable,\n-                forceLocalScheduling && allBlocksHaveRealAddress(blocks),\n-                (nodeSelectionStrategy == HARD_AFFINITY && !allBlocksHaveRealAddress(blocks)) ? NO_PREFERENCE : nodeSelectionStrategy,\n+                forceLocalScheduling && allBlocksHaveRealAddress(blocks) ? HARD_AFFINITY : nodeSelectionStrategy,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYzMTIzOA=="}, "originalCommit": {"oid": "1d0dd121e20ec8e182c0f427ab603997fc333d54"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3009, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}