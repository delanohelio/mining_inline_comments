{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjM4OTIy", "number": 14985, "title": "Thrift udf api", "bodyText": "Test plan - travis\n== RELEASE NOTES ==\n\nThrift Connector Changes\n* Rename ``presto-thrift-connector-api`` to ``presto-thrift-api`` and have separate packages for datatypes, valuesets and connector.", "createdAt": "2020-08-06T20:08:41Z", "url": "https://github.com/prestodb/presto/pull/14985", "merged": true, "mergeCommit": {"oid": "dd95430e90d91ffe588e6999a9b23f51719c1081"}, "closed": true, "closedAt": "2020-08-06T22:33:53Z", "author": {"login": "rongrong"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8Ve19AH2gAyNDY0MjM4OTIyOjdlZDhiZTc5MjUyODI0YjNlYWNjMjMxNjlmYjMwMjQ5ZWRjNmU5YmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8WTZPAFqTQ2Mjg3MzMyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7ed8be79252824b3eacc23169fb30249edc6e9ba", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/7ed8be79252824b3eacc23169fb30249edc6e9ba", "committedDate": "2020-08-06T20:03:14Z", "message": "Refactor presto-thrift-connector-api\n\n* Rename to presto-thrift-api\n* Have separate package for datatypes, valuesets and connector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODQyODQy", "url": "https://github.com/prestodb/presto/pull/14985#pullrequestreview-462842842", "createdAt": "2020-08-06T20:12:58Z", "commit": {"oid": "4a8e66fb6eb7da4c36f717690fe39a0b478cfac7"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDoxMjo1OFrOG9CqaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDoxNDoxMVrOG9Csvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1OTk0NA==", "bodyText": "Why not just @ThriftMethod without (\"prestoInvokeUdf\")", "url": "https://github.com/prestodb/presto/pull/14985#discussion_r466659944", "createdAt": "2020-08-06T20:12:58Z", "author": {"login": "caithagoras"}, "path": "presto-thrift-api/src/main/java/com/facebook/presto/thrift/api/udf/PrestoThriftUdfService.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.thrift.api.udf;\n+\n+import com.facebook.drift.TException;\n+import com.facebook.drift.annotations.ThriftField;\n+import com.facebook.drift.annotations.ThriftMethod;\n+import com.facebook.drift.annotations.ThriftService;\n+import com.google.common.util.concurrent.ListenableFuture;\n+\n+@ThriftService(value = \"presto-udf\", idlName = \"PrestoThriftUdfService\")\n+public interface PrestoThriftUdfService\n+{\n+    @ThriftMethod(\"prestoInvokeUdf\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a8e66fb6eb7da4c36f717690fe39a0b478cfac7"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MDA5Nw==", "bodyText": "(name = ) is unnecessary IIUC.", "url": "https://github.com/prestodb/presto/pull/14985#discussion_r466660097", "createdAt": "2020-08-06T20:13:16Z", "author": {"login": "caithagoras"}, "path": "presto-thrift-api/src/main/java/com/facebook/presto/thrift/api/udf/PrestoThriftUdfService.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.thrift.api.udf;\n+\n+import com.facebook.drift.TException;\n+import com.facebook.drift.annotations.ThriftField;\n+import com.facebook.drift.annotations.ThriftMethod;\n+import com.facebook.drift.annotations.ThriftService;\n+import com.google.common.util.concurrent.ListenableFuture;\n+\n+@ThriftService(value = \"presto-udf\", idlName = \"PrestoThriftUdfService\")\n+public interface PrestoThriftUdfService\n+{\n+    @ThriftMethod(\"prestoInvokeUdf\")\n+    ListenableFuture<PrestoThriftUdfResult> invokeUdf(\n+            @ThriftField(name = \"functionHandle\") PrestoThriftFunctionHandle functionHandle,\n+            @ThriftField(name = \"inputs\") PrestoThriftUdfPage inputs)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a8e66fb6eb7da4c36f717690fe39a0b478cfac7"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2MDU0Mw==", "bodyText": "Usually we do\nthrows TException,\n@ThriftId(1) PrestoThriftUdfServiceException;", "url": "https://github.com/prestodb/presto/pull/14985#discussion_r466660543", "createdAt": "2020-08-06T20:14:11Z", "author": {"login": "caithagoras"}, "path": "presto-thrift-api/src/main/java/com/facebook/presto/thrift/api/udf/PrestoThriftUdfService.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.thrift.api.udf;\n+\n+import com.facebook.drift.TException;\n+import com.facebook.drift.annotations.ThriftField;\n+import com.facebook.drift.annotations.ThriftMethod;\n+import com.facebook.drift.annotations.ThriftService;\n+import com.google.common.util.concurrent.ListenableFuture;\n+\n+@ThriftService(value = \"presto-udf\", idlName = \"PrestoThriftUdfService\")\n+public interface PrestoThriftUdfService\n+{\n+    @ThriftMethod(\"prestoInvokeUdf\")\n+    ListenableFuture<PrestoThriftUdfResult> invokeUdf(\n+            @ThriftField(name = \"functionHandle\") PrestoThriftFunctionHandle functionHandle,\n+            @ThriftField(name = \"inputs\") PrestoThriftUdfPage inputs)\n+            throws PrestoThriftUdfServiceException, TException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a8e66fb6eb7da4c36f717690fe39a0b478cfac7"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODQ2ODA1", "url": "https://github.com/prestodb/presto/pull/14985#pullrequestreview-462846805", "createdAt": "2020-08-06T20:19:02Z", "commit": {"oid": "4a8e66fb6eb7da4c36f717690fe39a0b478cfac7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a8e66fb6eb7da4c36f717690fe39a0b478cfac7", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/4a8e66fb6eb7da4c36f717690fe39a0b478cfac7", "committedDate": "2020-08-06T20:03:14Z", "message": "Introduce Thrift UDF service APIs"}, "afterCommit": {"oid": "b5cf7b161f01f03d8dde08846103fb2cb80ea97a", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/b5cf7b161f01f03d8dde08846103fb2cb80ea97a", "committedDate": "2020-08-06T20:36:37Z", "message": "Introduce Thrift UDF service APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3efad9f03b24e66e50049a1cce55c3160adb392", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/a3efad9f03b24e66e50049a1cce55c3160adb392", "committedDate": "2020-08-06T20:57:38Z", "message": "Introduce Thrift UDF service APIs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5cf7b161f01f03d8dde08846103fb2cb80ea97a", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/b5cf7b161f01f03d8dde08846103fb2cb80ea97a", "committedDate": "2020-08-06T20:36:37Z", "message": "Introduce Thrift UDF service APIs"}, "afterCommit": {"oid": "a3efad9f03b24e66e50049a1cce55c3160adb392", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/a3efad9f03b24e66e50049a1cce55c3160adb392", "committedDate": "2020-08-06T20:57:38Z", "message": "Introduce Thrift UDF service APIs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODczMzIz", "url": "https://github.com/prestodb/presto/pull/14985#pullrequestreview-462873323", "createdAt": "2020-08-06T21:00:31Z", "commit": {"oid": "a3efad9f03b24e66e50049a1cce55c3160adb392"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTowMDozMVrOG9EGvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTowMDozMVrOG9EGvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MzU4MQ==", "bodyText": "Let's use Optional instead of @Nullable.", "url": "https://github.com/prestodb/presto/pull/14985#discussion_r466683581", "createdAt": "2020-08-06T21:00:31Z", "author": {"login": "caithagoras"}, "path": "presto-thrift-api/src/main/java/com/facebook/presto/thrift/api/udf/ThriftUdfPage.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.thrift.api.udf;\n+\n+import com.facebook.drift.annotations.ThriftConstructor;\n+import com.facebook.drift.annotations.ThriftField;\n+import com.facebook.drift.annotations.ThriftStruct;\n+import com.facebook.presto.thrift.api.datatypes.PrestoThriftBlock;\n+\n+import javax.annotation.Nullable;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static com.facebook.drift.annotations.ThriftField.Requiredness.OPTIONAL;\n+import static com.facebook.presto.thrift.api.udf.ThriftUdfPageFormat.PRESTO_THRIFT;\n+\n+@ThriftStruct(\"UdfPage\")\n+public class ThriftUdfPage\n+{\n+    private final ThriftUdfPageFormat pageFormat;\n+    private final List<PrestoThriftBlock> thriftBlocks;\n+\n+    @ThriftConstructor\n+    public ThriftUdfPage(\n+            ThriftUdfPageFormat pageFormat,\n+            @Nullable List<PrestoThriftBlock> thriftBlocks)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3efad9f03b24e66e50049a1cce55c3160adb392"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1112, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}