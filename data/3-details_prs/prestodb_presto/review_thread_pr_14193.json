{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNjY5NjA2", "number": 14193, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoyOToyMVrODlMSTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo0NjoxN1rODlmRCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzI1MTk2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/ScaledWriterScheduler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDoyOToyMVrOFx8h2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo0MjozMlrOFylN8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxNjI0OQ==", "bodyText": "I'm a little bit confused about this loging. I was thinking more about changing the condition to something like if 50% overutilized OR 90% non empty - add more writer. Thoughts?", "url": "https://github.com/prestodb/presto/pull/14193#discussion_r387916249", "createdAt": "2020-03-04T20:29:21Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/ScaledWriterScheduler.java", "diffHunk": "@@ -105,15 +116,30 @@ private int getNewTaskCount()\n             return 1;\n         }\n \n+        if (optimizedScaleWriterProducerBuffer) {\n+            double totalProducerBufferUtilization = sourceTasksProvider.get().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4b40869383a9d71aac7eea6cd169fade4587643"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4Mjg5OA==", "bodyText": "@arhimondr : Addressed the comments per offline discussion. Basically now we add more writers if the overall buffer utilization is more than the number of writers.\nWe don't need to worry about accidentally open too many writers since overall writtenBytes has to be more than writerMinSizeBytes * scheduledNodes.size()\n            writtenBytes >= writerMinSizeBytes * scheduledNodes.size())", "url": "https://github.com/prestodb/presto/pull/14193#discussion_r388582898", "createdAt": "2020-03-05T21:42:32Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/ScaledWriterScheduler.java", "diffHunk": "@@ -105,15 +116,30 @@ private int getNewTaskCount()\n             return 1;\n         }\n \n+        if (optimizedScaleWriterProducerBuffer) {\n+            double totalProducerBufferUtilization = sourceTasksProvider.get().stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkxNjI0OQ=="}, "originalCommit": {"oid": "b4b40869383a9d71aac7eea6cd169fade4587643"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNzUwODU2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/ScaledWriterScheduler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo0NjoxN1rOFylUtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo0NjoxN1rOFylUtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4NDYyOQ==", "bodyText": "This is unused now", "url": "https://github.com/prestodb/presto/pull/14193#discussion_r388584629", "createdAt": "2020-03-05T21:46:17Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/ScaledWriterScheduler.java", "diffHunk": "@@ -40,13 +40,19 @@\n public class ScaledWriterScheduler\n         implements StageScheduler\n {\n+    private static final int SCHEDULED_ROUND_REQUIRED_FOR_EQUILIBRIUM = 5;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40fa3031e6f9d8f57efdac347891a23589bcc083"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3130, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}