{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5ODk0Mzgz", "number": 14352, "title": "Add Internationalization (i18n) plugin and Myanmar UDFs", "bodyText": "RELEASE NOTES\nContext\nText entered in Myanmar is often entered in non-Unicode-compliant Zawgyi. These are rendered differently based on the font encoding of devices in Myanmar. This means if someone entered Burmese-script text on a Zawgyi device, someone on a Unicode device could not read it, and vice versa.\nExample:\n\nUnicode: \u1014\u1004\u103a \u1021\u1001\u102f\u1018\u101a\u103a\u1019\u103e\u102c\u101c\u1032? (readable)\nZawgyi: \u1014\u1004\u1039 \u1021\u1001\u102f\u1018\u101a\u1039\u1019\u103d\u102c\u101c\u1032? (unreadable)\n\nYou can learn more about the overall issue at http://www.unicode.org/faq/myanmar.html\nSo if you query a search term in a Myanmar script in Presto, you'll only match text entered with the same font encoding.\nThese changes propose to functions to help resolve this:\n\nMYANMAR_FONT_ENCODING(text) which simply returns whether the encoding is Zawgyi or Unicode\nMYANMAR_NORMALIZE_UNICODE(text) which leaves Unicode as is and converts Zawgyi to Unicode using Google's Myanmar Tools algorithm: https://github.com/google/myanmar-tools\n\nThis change also adds an Internationalization or i18n plugin to cover other cases unique to certain languages", "createdAt": "2020-04-06T20:40:56Z", "url": "https://github.com/prestodb/presto/pull/14352", "merged": true, "mergeCommit": {"oid": "669cf6ea45945d61d90784dfc65be2804a5f81b2"}, "closed": true, "closedAt": "2020-04-16T18:55:51Z", "author": {"login": "nlagrow"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVa6scAFqTM4OTUyNzkxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX8nsYAFqTM5NDA0MDAzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTI3OTE2", "url": "https://github.com/prestodb/presto/pull/14352#pullrequestreview-389527916", "createdAt": "2020-04-07T22:14:00Z", "commit": {"oid": "f80b7213cc55fa07cbc3b5b8ecb2790d73efd93e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjoxNDowMFrOGCYEuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjoxODozMlrOGCYLeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0NDc2Mw==", "bodyText": "Put this in a section as Myanmar Functions maybe?", "url": "https://github.com/prestodb/presto/pull/14352#discussion_r405144763", "createdAt": "2020-04-07T22:14:00Z", "author": {"login": "rongrong"}, "path": "presto-docs/src/main/sphinx/functions/internationalization.rst", "diffHunk": "@@ -0,0 +1,20 @@\n+==============================\n+Internationalization Functions\n+==============================\n+\n+.. note::", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f80b7213cc55fa07cbc3b5b8ecb2790d73efd93e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0NTUxMg==", "bodyText": "is 0.9 always a good threshold?", "url": "https://github.com/prestodb/presto/pull/14352#discussion_r405145512", "createdAt": "2020-04-07T22:15:57Z", "author": {"login": "rongrong"}, "path": "presto-i18n/src/main/java/com/facebook/presto/i18n/I18nMyanmarFunctions.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.i18n;\n+\n+import com.facebook.presto.spi.function.Description;\n+import com.facebook.presto.spi.function.ScalarFunction;\n+import com.facebook.presto.spi.function.SqlType;\n+import com.facebook.presto.spi.type.StandardTypes;\n+import com.google.myanmartools.TransliterateZ2U;\n+import com.google.myanmartools.ZawgyiDetector;\n+import io.airlift.slice.Slice;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+public final class I18nMyanmarFunctions\n+{\n+    private I18nMyanmarFunctions() {}\n+\n+    static ZawgyiDetector detector = new ZawgyiDetector();\n+    static TransliterateZ2U z2uTransliterator = new TransliterateZ2U(\"Zawgyi to Unicode\");\n+\n+    @Description(\"labels whether input strings use Unicode or Zawgyi font encoding\")\n+    @ScalarFunction\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice myanmarFontEncoding(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        if (detector.getZawgyiProbability(slice.toStringUtf8()) > 0.9) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f80b7213cc55fa07cbc3b5b8ecb2790d73efd93e"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0NjQ4OA==", "bodyText": "Let's name it presto-i18n-functions since this is a function plugin package.", "url": "https://github.com/prestodb/presto/pull/14352#discussion_r405146488", "createdAt": "2020-04-07T22:18:32Z", "author": {"login": "rongrong"}, "path": "presto-i18n/pom.xml", "diffHunk": "@@ -0,0 +1,90 @@\n+<?xml version=\"1.0\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>com.facebook.presto</groupId>\n+        <artifactId>presto-root</artifactId>\n+        <version>0.235-SNAPSHOT</version>\n+    </parent>\n+\n+    <artifactId>presto-i18n</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f80b7213cc55fa07cbc3b5b8ecb2790d73efd93e"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f80b7213cc55fa07cbc3b5b8ecb2790d73efd93e", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/f80b7213cc55fa07cbc3b5b8ecb2790d73efd93e", "committedDate": "2020-04-06T20:16:13Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}, "afterCommit": {"oid": "426f00b99686c7e9eb11b32b99426fca2882fa82", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/426f00b99686c7e9eb11b32b99426fca2882fa82", "committedDate": "2020-04-07T23:08:09Z", "message": "Change plugin to presto-i18n-functions. Add Myanmar section to docs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "426f00b99686c7e9eb11b32b99426fca2882fa82", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/426f00b99686c7e9eb11b32b99426fca2882fa82", "committedDate": "2020-04-07T23:08:09Z", "message": "Change plugin to presto-i18n-functions. Add Myanmar section to docs."}, "afterCommit": {"oid": "5441b3c35bbfcfecabb9cc4335082e95c9c70408", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/5441b3c35bbfcfecabb9cc4335082e95c9c70408", "committedDate": "2020-04-07T23:19:04Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5441b3c35bbfcfecabb9cc4335082e95c9c70408", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/5441b3c35bbfcfecabb9cc4335082e95c9c70408", "committedDate": "2020-04-07T23:19:04Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}, "afterCommit": {"oid": "6a25a23402e2168d3fddee2bcc2ff373efc55e42", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/6a25a23402e2168d3fddee2bcc2ff373efc55e42", "committedDate": "2020-04-10T18:38:13Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzA3MDY4", "url": "https://github.com/prestodb/presto/pull/14352#pullrequestreview-393307068", "createdAt": "2020-04-14T21:25:06Z", "commit": {"oid": "6a25a23402e2168d3fddee2bcc2ff373efc55e42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMToyNTowNlrOGFhgag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMToyNTowNlrOGFhgag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ0NTAzNA==", "bodyText": "Do you want to use the constant ZAWGYI_PROBABILITY_THRESHOLD  here as well?", "url": "https://github.com/prestodb/presto/pull/14352#discussion_r408445034", "createdAt": "2020-04-14T21:25:06Z", "author": {"login": "rongrong"}, "path": "presto-i18n-functions/src/main/java/com/facebook/presto/i18n/functions/I18nMyanmarFunctions.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.i18n.functions;\n+\n+import com.facebook.presto.spi.function.Description;\n+import com.facebook.presto.spi.function.ScalarFunction;\n+import com.facebook.presto.spi.function.SqlType;\n+import com.facebook.presto.spi.type.StandardTypes;\n+import com.google.myanmartools.TransliterateZ2U;\n+import com.google.myanmartools.ZawgyiDetector;\n+import io.airlift.slice.Slice;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+public final class I18nMyanmarFunctions\n+{\n+    private I18nMyanmarFunctions() {}\n+\n+    static ZawgyiDetector detector = new ZawgyiDetector();\n+    static TransliterateZ2U z2uTransliterator = new TransliterateZ2U(\"Zawgyi to Unicode\");\n+\n+    /**\n+     * ZawgyiDetector returns a confidence score that a given string is Zawgyi encoded.\n+     * This constant defines the default confidence at which a string is treated as Zawgyi.\n+     */\n+    private static final double ZAWGYI_PROBABILITY_THRESHOLD = 0.9;\n+\n+    @Description(\"labels whether input strings use Unicode or Zawgyi font encoding\")\n+    @ScalarFunction\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice myanmarFontEncoding(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        if (detector.getZawgyiProbability(slice.toStringUtf8()) > 0.9) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a25a23402e2168d3fddee2bcc2ff373efc55e42"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a25a23402e2168d3fddee2bcc2ff373efc55e42", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/6a25a23402e2168d3fddee2bcc2ff373efc55e42", "committedDate": "2020-04-10T18:38:13Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}, "afterCommit": {"oid": "172e5d21d99bf5fdf7811d63d2c531419f22d4e1", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/172e5d21d99bf5fdf7811d63d2c531419f22d4e1", "committedDate": "2020-04-14T21:56:53Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzQzNjIy", "url": "https://github.com/prestodb/presto/pull/14352#pullrequestreview-393343622", "createdAt": "2020-04-14T22:38:36Z", "commit": {"oid": "172e5d21d99bf5fdf7811d63d2c531419f22d4e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjozODozN1rOGFjcwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjozODozN1rOGFjcwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3Njg2NQ==", "bodyText": "Actually should these also be private static final? Put the variables before the constructor per convention.", "url": "https://github.com/prestodb/presto/pull/14352#discussion_r408476865", "createdAt": "2020-04-14T22:38:37Z", "author": {"login": "rongrong"}, "path": "presto-i18n-functions/src/main/java/com/facebook/presto/i18n/functions/I18nMyanmarFunctions.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.i18n.functions;\n+\n+import com.facebook.presto.spi.function.Description;\n+import com.facebook.presto.spi.function.ScalarFunction;\n+import com.facebook.presto.spi.function.SqlType;\n+import com.facebook.presto.spi.type.StandardTypes;\n+import com.google.myanmartools.TransliterateZ2U;\n+import com.google.myanmartools.ZawgyiDetector;\n+import io.airlift.slice.Slice;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+public final class I18nMyanmarFunctions\n+{\n+    private I18nMyanmarFunctions() {}\n+\n+    static ZawgyiDetector detector = new ZawgyiDetector();\n+    static TransliterateZ2U z2uTransliterator = new TransliterateZ2U(\"Zawgyi to Unicode\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "172e5d21d99bf5fdf7811d63d2c531419f22d4e1"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4af53919666abdd656f3023ae415d65f9c6b6283", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/4af53919666abdd656f3023ae415d65f9c6b6283", "committedDate": "2020-04-14T22:52:56Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "172e5d21d99bf5fdf7811d63d2c531419f22d4e1", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/172e5d21d99bf5fdf7811d63d2c531419f22d4e1", "committedDate": "2020-04-14T21:56:53Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}, "afterCommit": {"oid": "4af53919666abdd656f3023ae415d65f9c6b6283", "author": {"user": {"login": "nlagrow", "name": "Nick LaGrow"}}, "url": "https://github.com/prestodb/presto/commit/4af53919666abdd656f3023ae415d65f9c6b6283", "committedDate": "2020-04-14T22:52:56Z", "message": "Add Internationalization (i18n) plugin and Myanmar UDFs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDQwMDMy", "url": "https://github.com/prestodb/presto/pull/14352#pullrequestreview-394040032", "createdAt": "2020-04-15T18:44:00Z", "commit": {"oid": "4af53919666abdd656f3023ae415d65f9c6b6283"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1802, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}