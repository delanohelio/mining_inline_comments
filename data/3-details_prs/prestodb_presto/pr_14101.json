{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MTk0OTU0", "number": 14101, "title": "Remove forceLocalScheduling for hive connector", "bodyText": "== NO RELEASE NOTE ==", "createdAt": "2020-02-14T03:32:26Z", "url": "https://github.com/prestodb/presto/pull/14101", "merged": true, "mergeCommit": {"oid": "ccbb3bf45b2c27ef75e470a211ad1a9c11c15d7e"}, "closed": true, "closedAt": "2020-02-14T22:02:20Z", "author": {"login": "kewang1024"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEHFcwAFqTM1ODY5NTY4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEVssOAFqTM1OTIwNTY4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4Njk1Njg1", "url": "https://github.com/prestodb/presto/pull/14101#pullrequestreview-358695685", "createdAt": "2020-02-14T03:37:04Z", "commit": {"oid": "df676789ce86c84769ff9e7424384ad492166b50"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df676789ce86c84769ff9e7424384ad492166b50", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/df676789ce86c84769ff9e7424384ad492166b50", "committedDate": "2020-02-14T03:28:59Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}, "afterCommit": {"oid": "c3779c5e8d6d49d28bb97988cbf995f4dff9aab5", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/c3779c5e8d6d49d28bb97988cbf995f4dff9aab5", "committedDate": "2020-02-14T04:29:34Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3779c5e8d6d49d28bb97988cbf995f4dff9aab5", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/c3779c5e8d6d49d28bb97988cbf995f4dff9aab5", "committedDate": "2020-02-14T04:29:34Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}, "afterCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/90bd86a2ad03304c2ca9cf0023fcee7692270dbd", "committedDate": "2020-02-14T06:58:25Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4Nzc3ODQ5", "url": "https://github.com/prestodb/presto/pull/14101#pullrequestreview-358777849", "createdAt": "2020-02-14T08:30:50Z", "commit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo1MVrOFpu0-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODo0MTo0M1rOFpvE-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzE2MQ==", "bodyText": "boolean forceLocalScheduling = nodeSelectionStrategy == HARD_AFFINITY", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303161", "createdAt": "2020-02-14T08:30:51Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -133,15 +130,11 @@ public InternalHiveSplitFactory(\n             return Optional.empty();\n         }\n \n-        boolean forceLocalScheduling = this.forceLocalScheduling;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzE5MA==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303190", "createdAt": "2020-02-14T08:30:56Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -133,15 +130,11 @@ public InternalHiveSplitFactory(\n             return Optional.empty();\n         }\n \n-        boolean forceLocalScheduling = this.forceLocalScheduling;\n-\n         // For empty files, some filesystem (e.g. LocalFileSystem) produce one empty block\n         // while others (e.g. hdfs.DistributedFileSystem) produces no block.\n         // Synthesize an empty block if one does not already exist.\n         if (fileSize == 0 && blockLocations.length == 0) {\n             blockLocations = new BlockLocation[] {new BlockLocation()};\n-            // Turn off force local scheduling because hosts list doesn't exist.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzI0Nw==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303247", "createdAt": "2020-02-14T08:31:03Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -159,7 +152,7 @@ public InternalHiveSplitFactory(\n             }\n \n             List<HostAddress> addresses = getHostAddresses(blockLocation);\n-            if (!needsHostAddresses(forceLocalScheduling, addresses)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzI2Ng==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303266", "createdAt": "2020-02-14T08:31:07Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -170,7 +163,7 @@ public InternalHiveSplitFactory(\n         if (!splittable) {\n             // not splittable, use the hosts from the first block if it exists\n             List<HostAddress> addresses = blocks.get(0).getAddresses();\n-            if (!needsHostAddresses(forceLocalScheduling, addresses)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzM5OQ==", "bodyText": "keep", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379303399", "createdAt": "2020-02-14T08:31:26Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -186,16 +179,15 @@ public InternalHiveSplitFactory(\n                 readBucketNumber,\n                 tableBucketNumber,\n                 splittable,\n-                forceLocalScheduling && allBlocksHaveRealAddress(blocks),\n                 (nodeSelectionStrategy == HARD_AFFINITY && !allBlocksHaveRealAddress(blocks)) ? NO_PREFERENCE : nodeSelectionStrategy,\n                 s3SelectPushdownEnabled && S3SelectPushdown.isCompressionCodecSupported(inputFormat, path),\n                 partitionInfo,\n                 extraFileInfo));\n     }\n \n-    private boolean needsHostAddresses(boolean forceLocalScheduling, List<HostAddress> addresses)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwNzI1Ng==", "bodyText": "I think this should be\nforceLocalScheduling && allBlocksHaveRealAddress(blocks) && nodeSelectionStrategy == HARD_AFFINITY ? HARD_AFFINITY : nodeSelectionStrategy\nBecause forceLocalScheduling can be turned off", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379307256", "createdAt": "2020-02-14T08:41:43Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -186,16 +179,15 @@ public InternalHiveSplitFactory(\n                 readBucketNumber,\n                 tableBucketNumber,\n                 splittable,\n-                forceLocalScheduling && allBlocksHaveRealAddress(blocks),\n                 (nodeSelectionStrategy == HARD_AFFINITY && !allBlocksHaveRealAddress(blocks)) ? NO_PREFERENCE : nodeSelectionStrategy,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd"}, "originalPosition": 63}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90bd86a2ad03304c2ca9cf0023fcee7692270dbd", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/90bd86a2ad03304c2ca9cf0023fcee7692270dbd", "committedDate": "2020-02-14T06:58:25Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}, "afterCommit": {"oid": "4f7510798d5e9d870e5da7b42a22637e036215f6", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/4f7510798d5e9d870e5da7b42a22637e036215f6", "committedDate": "2020-02-14T18:38:24Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d0dd121e20ec8e182c0f427ab603997fc333d54", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/1d0dd121e20ec8e182c0f427ab603997fc333d54", "committedDate": "2020-02-14T19:09:02Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f7510798d5e9d870e5da7b42a22637e036215f6", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/4f7510798d5e9d870e5da7b42a22637e036215f6", "committedDate": "2020-02-14T18:38:24Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}, "afterCommit": {"oid": "1d0dd121e20ec8e182c0f427ab603997fc333d54", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/1d0dd121e20ec8e182c0f427ab603997fc333d54", "committedDate": "2020-02-14T19:09:02Z", "message": "Remove forceLocalScheduling for hive connector\n\nAs we already have NodeSelectionStrategy to indicate node selection affinity,\ndeprecate forceLocalScheduling."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjAyMTU3", "url": "https://github.com/prestodb/presto/pull/14101#pullrequestreview-359202157", "createdAt": "2020-02-14T20:31:14Z", "commit": {"oid": "1d0dd121e20ec8e182c0f427ab603997fc333d54"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMDozMToxNFrOFqC2hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMDozMToxNFrOFqC2hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYzMTIzOA==", "bodyText": "You need && nodeSelectionStrategy == HARD_AFFINITY", "url": "https://github.com/prestodb/presto/pull/14101#discussion_r379631238", "createdAt": "2020-02-14T20:31:14Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/InternalHiveSplitFactory.java", "diffHunk": "@@ -186,8 +181,7 @@ public InternalHiveSplitFactory(\n                 readBucketNumber,\n                 tableBucketNumber,\n                 splittable,\n-                forceLocalScheduling && allBlocksHaveRealAddress(blocks),\n-                (nodeSelectionStrategy == HARD_AFFINITY && !allBlocksHaveRealAddress(blocks)) ? NO_PREFERENCE : nodeSelectionStrategy,\n+                forceLocalScheduling && allBlocksHaveRealAddress(blocks) ? HARD_AFFINITY : nodeSelectionStrategy,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d0dd121e20ec8e182c0f427ab603997fc333d54"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjA1Njg1", "url": "https://github.com/prestodb/presto/pull/14101#pullrequestreview-359205685", "createdAt": "2020-02-14T20:38:36Z", "commit": {"oid": "1d0dd121e20ec8e182c0f427ab603997fc333d54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2205, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}