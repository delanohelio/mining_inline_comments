{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMDAwNTc4", "number": 14739, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzoyMToxNFrOEJp-ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoxMDo1OFrOETsk0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NTYwNDUxOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzoyMToxNFrOGqQoJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNzozNzo0MVrOGsA_JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NTc5OQ==", "bodyText": "getQueryMaxScanPhysicalBytes(session) returns a value that can be used as is without further checking.\nThis code ensures that this property defaults to what's specified in config:\n                dataSizeProperty(\n                        QUERY_MAX_SCAN_PHYSICAL_BYTES,\n                        \"Maximum scan physical bytes of a query\",\n                        queryManagerConfig.getQueryMaxScanPhysicalBytes(),\n                        false),\n\nand this code defines the default value that is used if nothing is specified in config file:\nprivate DataSize queryMaxScanPhysicalBytes = DataSize.succinctDataSize(1, PETABYTE);\n\nHence, the code can be simplified like this:\n        for (QueryExecution query : queryTracker.getAllQueries()) {\n            DataSize limit = getQueryMaxScanPhysicalBytes(query.getSession());\n            DataSize scan = query.getQueryInfo().getQueryStats().getRawInputDataSize();\n            if (scan.compareTo(limit) >= 0) {\n                query.fail(new ExceededScanLimitException(limit));\n            }\n        }", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r446965799", "createdAt": "2020-06-29T13:21:14Z", "author": {"login": "mbasmanova"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +326,22 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize limitOpt = Optional.ofNullable(getQueryMaxScanPhysicalBytes(query.getSession()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwNjY5Mw==", "bodyText": "Many thanks for the proposal. I have made another version of how to implement this limit based on your suggestion. The new version is now includes a method defines in QueryExecution to collect scanned data size which is implemented in SqlQueryExecution to collect finalQueryInfo's rawInputDataSize. Please help review again.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r448806693", "createdAt": "2020-07-02T07:37:41Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +326,22 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize limitOpt = Optional.ofNullable(getQueryMaxScanPhysicalBytes(query.getSession()))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NTc5OQ=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NTYxMDEyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/ExceededScanLimitException.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzoyMjoyOVrOGqQrlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMToyNjozOVrOG3BXLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NjY3OQ==", "bodyText": "Let's clarify what does the limit applies to? E.g. whether it applies to amount of data read from storage before or after compression?", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r446966679", "createdAt": "2020-06-29T13:22:29Z", "author": {"login": "mbasmanova"}, "path": "presto-main/src/main/java/com/facebook/presto/ExceededScanLimitException.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto;\n+\n+import com.facebook.presto.spi.PrestoException;\n+import io.airlift.units.DataSize;\n+\n+import static com.facebook.presto.spi.StandardErrorCode.EXCEEDED_SCAN_LIMIT;\n+\n+public class ExceededScanLimitException\n+        extends PrestoException\n+{\n+    public ExceededScanLimitException(DataSize limit)\n+    {\n+        super(EXCEEDED_SCAN_LIMIT, \"Exceeded Scan limit of \" + limit.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwNDE2MA==", "bodyText": "This is the amount of consumed input bytes read from storage via QueryInfo's getQueryStats().getRawInputDataSize()", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r448804160", "createdAt": "2020-07-02T07:32:39Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/ExceededScanLimitException.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto;\n+\n+import com.facebook.presto.spi.PrestoException;\n+import io.airlift.units.DataSize;\n+\n+import static com.facebook.presto.spi.StandardErrorCode.EXCEEDED_SCAN_LIMIT;\n+\n+public class ExceededScanLimitException\n+        extends PrestoException\n+{\n+    public ExceededScanLimitException(DataSize limit)\n+    {\n+        super(EXCEEDED_SCAN_LIMIT, \"Exceeded Scan limit of \" + limit.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NjY3OQ=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzNzM5Nw==", "bodyText": "Concurring @mbasmanova's comment - we should be clear about what scan limit has been exceeded. I will recommend EXCEEDED_SCAN_RAW_BYTES_READ_LIMIT. The message can also be made more explicit", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449137397", "createdAt": "2020-07-02T16:32:09Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/ExceededScanLimitException.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto;\n+\n+import com.facebook.presto.spi.PrestoException;\n+import io.airlift.units.DataSize;\n+\n+import static com.facebook.presto.spi.StandardErrorCode.EXCEEDED_SCAN_LIMIT;\n+\n+public class ExceededScanLimitException\n+        extends PrestoException\n+{\n+    public ExceededScanLimitException(DataSize limit)\n+    {\n+        super(EXCEEDED_SCAN_LIMIT, \"Exceeded Scan limit of \" + limit.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NjY3OQ=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM0NzE4Mw==", "bodyText": "the message has been fixed to indicate the scan bytes limit has exceeded for this exception", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460347183", "createdAt": "2020-07-25T01:26:39Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/ExceededScanLimitException.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto;\n+\n+import com.facebook.presto.spi.PrestoException;\n+import io.airlift.units.DataSize;\n+\n+import static com.facebook.presto.spi.StandardErrorCode.EXCEEDED_SCAN_LIMIT;\n+\n+public class ExceededScanLimitException\n+        extends PrestoException\n+{\n+    public ExceededScanLimitException(DataSize limit)\n+    {\n+        super(EXCEEDED_SCAN_LIMIT, \"Exceeded Scan limit of \" + limit.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NjY3OQ=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NTYxNDE0OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/SystemSessionProperties.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzoyMzoyM1rOGqQuEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNjozMzozMVrOGsVOBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NzMxNA==", "bodyText": "Let's clarify. Is this before or after compression? Before or after filtering? I assume it is after compression but before filtering.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r446967314", "createdAt": "2020-06-29T13:23:23Z", "author": {"login": "mbasmanova"}, "path": "presto-main/src/main/java/com/facebook/presto/SystemSessionProperties.java", "diffHunk": "@@ -423,6 +425,11 @@ public SystemSessionProperties(\n                         \"Use resources which are not guaranteed to be available to the query\",\n                         false,\n                         false),\n+                dataSizeProperty(\n+                        QUERY_MAX_SCAN_PHYSICAL_BYTES,\n+                        \"Maximum scan physical bytes of a query\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwMzE2Mw==", "bodyText": "Thank you Maria, this is a good point. So to clarify the confusion how the scan size is measured, I have implicitly implemented the SqlQueryExecution.getScannedBytes method to extract the query scanned size from QueryInfo's rawInputDataSize stats which is the consumed input bytes, and yes it should be the actual data size before filtering.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r448803163", "createdAt": "2020-07-02T07:30:37Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/SystemSessionProperties.java", "diffHunk": "@@ -423,6 +425,11 @@ public SystemSessionProperties(\n                         \"Use resources which are not guaranteed to be available to the query\",\n                         false,\n                         false),\n+                dataSizeProperty(\n+                        QUERY_MAX_SCAN_PHYSICAL_BYTES,\n+                        \"Maximum scan physical bytes of a query\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NzMxNA=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzODE4Mw==", "bodyText": "Should we just say QUERY_MAX_SCAN_RAW_INPUT_BYTES that way it matches the public stat that we publish and it is easy for people to understand which metric did they exceed? @mbasmanova thoughts?", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449138183", "createdAt": "2020-07-02T16:33:31Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/SystemSessionProperties.java", "diffHunk": "@@ -423,6 +425,11 @@ public SystemSessionProperties(\n                         \"Use resources which are not guaranteed to be available to the query\",\n                         false,\n                         false),\n+                dataSizeProperty(\n+                        QUERY_MAX_SCAN_PHYSICAL_BYTES,\n+                        \"Maximum scan physical bytes of a query\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2NzMxNA=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4Nzc1MDQ5OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryManagerConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjo0NzozMVrOGqlK7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxNjowMDozM1rOG3FskQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjM4Mg==", "bodyText": "Is QueryStats::rawInputDataSize equivalent to scanPhysicalBytes?  does reading from materialized intermediate table included? cc @arhimondr", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r447302382", "createdAt": "2020-06-29T22:47:31Z", "author": {"login": "viczhang861"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryManagerConfig.java", "diffHunk": "@@ -66,6 +69,8 @@\n     private Duration queryMaxExecutionTime = new Duration(100, TimeUnit.DAYS);\n     private Duration queryMaxCpuTime = new Duration(1_000_000_000, TimeUnit.DAYS);\n \n+    private DataSize queryMaxScanPhysicalBytes = DataSize.succinctDataSize(1, PETABYTE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQxODE5Mw==", "bodyText": "Same comment as in SystemSessionProperties - lets use the same name as the actual metric - queryMaxRawInputBytes. In accordance with that lets change the config name as well - query.max-raw-input-bytes.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460418193", "createdAt": "2020-07-25T16:00:33Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryManagerConfig.java", "diffHunk": "@@ -66,6 +69,8 @@\n     private Duration queryMaxExecutionTime = new Duration(100, TimeUnit.DAYS);\n     private Duration queryMaxCpuTime = new Duration(1_000_000_000, TimeUnit.DAYS);\n \n+    private DataSize queryMaxScanPhysicalBytes = DataSize.succinctDataSize(1, PETABYTE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjM4Mg=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4Nzc1MjU2OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjo0ODoyMlrOGqlMJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNzo0MToyN1rOGsBHFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjY5NA==", "bodyText": "Remember to remove this.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r447302694", "createdAt": "2020-06-29T22:48:22Z", "author": {"login": "viczhang861"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -70,6 +74,8 @@\n \n     private final Duration maxQueryCpuTime;\n \n+    private final Optional<DataSize> maxQueryScanPhysicalBytes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwODcyNw==", "bodyText": "consider it done, thanks", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r448808727", "createdAt": "2020-07-02T07:41:27Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -70,6 +74,8 @@\n \n     private final Duration maxQueryCpuTime;\n \n+    private final Optional<DataSize> maxQueryScanPhysicalBytes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjY5NA=="}, "originalCommit": {"oid": "0b8fd9a9e8219a758ed73ca0f5cf857fd59678cd"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5ODQzMzEwOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryExecution.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjo0Mjo1MVrOGsLHgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMjowODo0NFrOG3Bnqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3MjY3Mw==", "bodyText": "Given that there is only 1 implementation, any reason to go for a default implementation?", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r448972673", "createdAt": "2020-07-02T12:42:51Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryExecution.java", "diffHunk": "@@ -53,6 +53,11 @@\n \n     QueryInfo getQueryInfo();\n \n+    default DataSize getScannedBytes()\n+    {\n+        return new DataSize(0, DataSize.Unit.BYTE);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIyNDIzNA==", "bodyText": "The thought here is that we are implementing limit for scanned bytes from raw input's perspective, eventually we can add more knobs to control the scanned bytes for output data size, post-compressed size, etc. the default scannedBytes gives a general guideline for all implementations with datasize=0b to start with", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449224234", "createdAt": "2020-07-02T19:25:58Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryExecution.java", "diffHunk": "@@ -53,6 +53,11 @@\n \n     QueryInfo getQueryInfo();\n \n+    default DataSize getScannedBytes()\n+    {\n+        return new DataSize(0, DataSize.Unit.BYTE);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3MjY3Mw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIzNTI4NA==", "bodyText": "My apologies - your point is not very clear to me. scannedBytes for output data size - should we just not call it getOutputDataBytes. I am not sure what kind of guidance are we offering when we start with datasize=0b", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449235284", "createdAt": "2020-07-02T19:52:07Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryExecution.java", "diffHunk": "@@ -53,6 +53,11 @@\n \n     QueryInfo getQueryInfo();\n \n+    default DataSize getScannedBytes()\n+    {\n+        return new DataSize(0, DataSize.Unit.BYTE);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3MjY3Mw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5MzA2Ng==", "bodyText": "I was reading through this again and have the same question.  Why make this a default, why not just move this default method to DataDefinitionExecution?", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r458793066", "createdAt": "2020-07-22T13:31:15Z", "author": {"login": "tdcmeehan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryExecution.java", "diffHunk": "@@ -53,6 +53,11 @@\n \n     QueryInfo getQueryInfo();\n \n+    default DataSize getScannedBytes()\n+    {\n+        return new DataSize(0, DataSize.Unit.BYTE);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3MjY3Mw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM1MTQwMw==", "bodyText": "Sorry, missed this comment. yes agree with you all, so instead of going to default value, I will just remove this definition and simply take session value and config value into account. If we want to implement further based on scannedbyte config like scan limit for different connectors, we can add it back to set a bar as a default scan byte limit for general purpose, but for now I will remove this block of code", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460351403", "createdAt": "2020-07-25T02:08:44Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryExecution.java", "diffHunk": "@@ -53,6 +53,11 @@\n \n     QueryInfo getQueryInfo();\n \n+    default DataSize getScannedBytes()\n+    {\n+        return new DataSize(0, DataSize.Unit.BYTE);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3MjY3Mw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5OTQ2ODAxOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNjozODo1OVrOGsVZ8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwMTo0NjoxM1rOG3BfUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTIzMw==", "bodyText": "I can see a lot of issues with this logic:\n\nWe are reading finalQueryInfo which is published only when the query is finished - can you test and see if this number is actually published when the query is running ?\nFor every stage that is a scan stage, we take the whole query's bytes read and add it. So if there are 2 scan stages - in that case, you will just return 2 * bytesreadbyquery.\ngetAllStages does a DFS traversal every time - and given that it will be called in a loop, this might be an expensive operation and we don't really care about the ordering here.\n\nIn my opinion - we should do something similar to the existing logic that exists for getTotalCpuTime. That will help ensure that the logics are similar and it is easy to change them together if we ever decide to head that path.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449141233", "createdAt": "2020-07-02T16:38:59Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -752,6 +753,23 @@ public void setUpdateType(String updateType)\n         this.updateType.set(updateType);\n     }\n \n+    public long getScannedBytes(StageInfo rootStage)\n+    {\n+        long rawInputDataSize = 0;\n+        for (StageInfo stageInfo : getAllStages(Optional.of(rootStage))) {\n+            if (stageInfo.getPlan().isPresent()) {\n+                PlanFragment plan = stageInfo.getPlan().get();\n+                if (!plan.getTableScanSchedulingOrder().isEmpty()) {\n+                    Optional<QueryInfo> queryInfo = finalQueryInfo.get();\n+                    if (queryInfo.isPresent()) {\n+                        QueryStats queryStats = queryInfo.get().getQueryStats();\n+                        rawInputDataSize += queryStats.getRawInputDataSize().toBytes();\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIzNDQyMQ==", "bodyText": "ok so this is newly implemented, the original proposal was a simple approach which is to obtain the scanned data size from queryInfo::queryStats if the final resolution is to do something similiar to the existing logic with getTotalCpuTime.\nDataSize scan = query.getQueryInfo().getQueryStats().getRawInputDataSize();\n@mbasmanova what's your suggestion on this one?", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449234421", "createdAt": "2020-07-02T19:50:12Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -752,6 +753,23 @@ public void setUpdateType(String updateType)\n         this.updateType.set(updateType);\n     }\n \n+    public long getScannedBytes(StageInfo rootStage)\n+    {\n+        long rawInputDataSize = 0;\n+        for (StageInfo stageInfo : getAllStages(Optional.of(rootStage))) {\n+            if (stageInfo.getPlan().isPresent()) {\n+                PlanFragment plan = stageInfo.getPlan().get();\n+                if (!plan.getTableScanSchedulingOrder().isEmpty()) {\n+                    Optional<QueryInfo> queryInfo = finalQueryInfo.get();\n+                    if (queryInfo.isPresent()) {\n+                        QueryStats queryStats = queryInfo.get().getQueryStats();\n+                        rawInputDataSize += queryStats.getRawInputDataSize().toBytes();\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTIzMw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1MDc0NA==", "bodyText": "query.getQueryInfo().getQueryStats() is a sort of expensive method since it aggregates all the stats and not just bytes read. We should keep this data collection as light as possible in my opinion.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449250744", "createdAt": "2020-07-02T20:28:54Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -752,6 +753,23 @@ public void setUpdateType(String updateType)\n         this.updateType.set(updateType);\n     }\n \n+    public long getScannedBytes(StageInfo rootStage)\n+    {\n+        long rawInputDataSize = 0;\n+        for (StageInfo stageInfo : getAllStages(Optional.of(rootStage))) {\n+            if (stageInfo.getPlan().isPresent()) {\n+                PlanFragment plan = stageInfo.getPlan().get();\n+                if (!plan.getTableScanSchedulingOrder().isEmpty()) {\n+                    Optional<QueryInfo> queryInfo = finalQueryInfo.get();\n+                    if (queryInfo.isPresent()) {\n+                        QueryStats queryStats = queryInfo.get().getQueryStats();\n+                        rawInputDataSize += queryStats.getRawInputDataSize().toBytes();\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTIzMw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM2NDEyOA==", "bodyText": "Agree with @mayankgarg1990 -- this can be made to be less expensive and consistent with how we calculate CPU time.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r450364128", "createdAt": "2020-07-06T17:09:20Z", "author": {"login": "tdcmeehan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -752,6 +753,23 @@ public void setUpdateType(String updateType)\n         this.updateType.set(updateType);\n     }\n \n+    public long getScannedBytes(StageInfo rootStage)\n+    {\n+        long rawInputDataSize = 0;\n+        for (StageInfo stageInfo : getAllStages(Optional.of(rootStage))) {\n+            if (stageInfo.getPlan().isPresent()) {\n+                PlanFragment plan = stageInfo.getPlan().get();\n+                if (!plan.getTableScanSchedulingOrder().isEmpty()) {\n+                    Optional<QueryInfo> queryInfo = finalQueryInfo.get();\n+                    if (queryInfo.isPresent()) {\n+                        QueryStats queryStats = queryInfo.get().getQueryStats();\n+                        rawInputDataSize += queryStats.getRawInputDataSize().toBytes();\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTIzMw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM2OTY4OQ==", "bodyText": "thank you @mayankgarg1990 @tdcmeehan for the comment, will revise this code accordingly to align with general data collection logic", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r450369689", "createdAt": "2020-07-06T17:20:07Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -752,6 +753,23 @@ public void setUpdateType(String updateType)\n         this.updateType.set(updateType);\n     }\n \n+    public long getScannedBytes(StageInfo rootStage)\n+    {\n+        long rawInputDataSize = 0;\n+        for (StageInfo stageInfo : getAllStages(Optional.of(rootStage))) {\n+            if (stageInfo.getPlan().isPresent()) {\n+                PlanFragment plan = stageInfo.getPlan().get();\n+                if (!plan.getTableScanSchedulingOrder().isEmpty()) {\n+                    Optional<QueryInfo> queryInfo = finalQueryInfo.get();\n+                    if (queryInfo.isPresent()) {\n+                        QueryStats queryStats = queryInfo.get().getQueryStats();\n+                        rawInputDataSize += queryStats.getRawInputDataSize().toBytes();\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTIzMw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5MjI4NA==", "bodyText": "Were these comments addressed?", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r458792284", "createdAt": "2020-07-22T13:30:05Z", "author": {"login": "tdcmeehan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -752,6 +753,23 @@ public void setUpdateType(String updateType)\n         this.updateType.set(updateType);\n     }\n \n+    public long getScannedBytes(StageInfo rootStage)\n+    {\n+        long rawInputDataSize = 0;\n+        for (StageInfo stageInfo : getAllStages(Optional.of(rootStage))) {\n+            if (stageInfo.getPlan().isPresent()) {\n+                PlanFragment plan = stageInfo.getPlan().get();\n+                if (!plan.getTableScanSchedulingOrder().isEmpty()) {\n+                    Optional<QueryInfo> queryInfo = finalQueryInfo.get();\n+                    if (queryInfo.isPresent()) {\n+                        QueryStats queryStats = queryInfo.get().getQueryStats();\n+                        rawInputDataSize += queryStats.getRawInputDataSize().toBytes();\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTIzMw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM0OTI2Ng==", "bodyText": "yes this code block has been removed as to make it simple and similar to how cpu limits enforcement is handled", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460349266", "createdAt": "2020-07-25T01:46:13Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryStateMachine.java", "diffHunk": "@@ -752,6 +753,23 @@ public void setUpdateType(String updateType)\n         this.updateType.set(updateType);\n     }\n \n+    public long getScannedBytes(StageInfo rootStage)\n+    {\n+        long rawInputDataSize = 0;\n+        for (StageInfo stageInfo : getAllStages(Optional.of(rootStage))) {\n+            if (stageInfo.getPlan().isPresent()) {\n+                PlanFragment plan = stageInfo.getPlan().get();\n+                if (!plan.getTableScanSchedulingOrder().isEmpty()) {\n+                    Optional<QueryInfo> queryInfo = finalQueryInfo.get();\n+                    if (queryInfo.isPresent()) {\n+                        QueryStats queryStats = queryInfo.get().getQueryStats();\n+                        rawInputDataSize += queryStats.getRawInputDataSize().toBytes();\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTIzMw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5OTQ3MDAyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNjozOTozMFrOGsVbHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOToyOTo0MlrOGsakXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTUzMw==", "bodyText": "nit: remove", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449141533", "createdAt": "2020-07-02T16:39:30Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +322,19 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize limit = getQueryMaxScanPhysicalBytes(query.getSession());\n+            // DataSize scan = query.getQueryInfo().getQueryStats().getRawInputDataSize();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIyNTgyMw==", "bodyText": "done", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449225823", "createdAt": "2020-07-02T19:29:42Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +322,19 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize limit = getQueryMaxScanPhysicalBytes(query.getSession());\n+            // DataSize scan = query.getQueryInfo().getQueryStats().getRawInputDataSize();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MTUzMw=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5OTQ3NDUxOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNjo0MDo0OFrOGsVd5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDozNToyNFrOGscQ5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MjI0NA==", "bodyText": "Over here we are just using the session property - which a user can override. Similar to how this is being done for enforceCpuLimits where in we take the min of the cluster setting and session property and enforce based on that.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449142244", "createdAt": "2020-07-02T16:40:48Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +322,19 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize limit = getQueryMaxScanPhysicalBytes(query.getSession());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIzMjI3NA==", "bodyText": "right that's the idea, getQueryMaxScanPhysicalBytes obtains the value set from system property so that it can be compared with the actual scanned value", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449232274", "createdAt": "2020-07-02T19:44:54Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +322,19 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize limit = getQueryMaxScanPhysicalBytes(query.getSession());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MjI0NA=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1MzYwNg==", "bodyText": "Properties defined in SystemSessionProperties are properties that can be overridden by users by saying:\nSET SESSION query_max_scan_physical_bytes=100000000000000000;\nSELECT * FROM very_large_table;\n\nIf as a system administrator I want to cap the amountt of data a query can read - then this doesn't work since any user can override it.\nIf you check enforceCpuLimit, there we do:\nDuration sessionLimit = getQueryMaxCpuTime(query.getSession()); // value from SystemSessionProperties\nDuration limit = Ordering.natural().min(maxQueryCpuTime, sessionLimit);  // maxQueryCpuTime is from QueryManagerConfig\n\nAnd hence in this example - a user can lower their allowed limit, but not go beyond what the system administrator has set as the cluster setting.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r449253606", "createdAt": "2020-07-02T20:35:24Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +322,19 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize limit = getQueryMaxScanPhysicalBytes(query.getSession());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0MjI0NA=="}, "originalCommit": {"oid": "1949ae3d7718a55bf865074aaee6ab95071c2e12"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3Mzc0NDQyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/SystemSessionProperties.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxNTo1Njo0M1rOG3FrOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNTowMTowMVrOG3JZeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQxNzg1MA==", "bodyText": "Putting a new comment since the old comment was marked as resolved. Lets match this with the actual metric (rawInputBytes) and the exception name - QUERY_MAX_SCAN_RAW_INPUT_BYTES", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460417850", "createdAt": "2020-07-25T15:56:43Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/SystemSessionProperties.java", "diffHunk": "@@ -424,6 +426,11 @@ public SystemSessionProperties(\n                         \"Use resources which are not guaranteed to be available to the query\",\n                         false,\n                         false),\n+                dataSizeProperty(\n+                        QUERY_MAX_SCAN_PHYSICAL_BYTES,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ3ODg0Mg==", "bodyText": "sure actually I would synchronize all method call names and varilables to QueryMaxScanRawInputBytes to map with rawInputBytes", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460478842", "createdAt": "2020-07-26T05:01:01Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/SystemSessionProperties.java", "diffHunk": "@@ -424,6 +426,11 @@ public SystemSessionProperties(\n                         \"Use resources which are not guaranteed to be available to the query\",\n                         false,\n                         false),\n+                dataSizeProperty(\n+                        QUERY_MAX_SCAN_PHYSICAL_BYTES,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQxNzg1MA=="}, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3Mzc1NjIxOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxNjoxMjoyOVrOG3Fwyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNTowNDozMFrOG3JaYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQxOTI3NQ==", "bodyText": "these 2 are not being used - remove these", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460419275", "createdAt": "2020-07-25T16:12:29Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +324,21 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            BasicQueryStats basicQueryStats = query.getBasicQueryInfo().getQueryStats();\n+            QueryStats queryStats = query.getQueryInfo().getQueryStats();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ3OTA3NQ==", "bodyText": "sure, it's removed", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460479075", "createdAt": "2020-07-26T05:04:30Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +324,21 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            BasicQueryStats basicQueryStats = query.getBasicQueryInfo().getQueryStats();\n+            QueryStats queryStats = query.getQueryInfo().getQueryStats();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQxOTI3NQ=="}, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3Mzc3NzY3OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxNjo0MDozN1rOG3F7AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwNzo1MjoyMVrOG4szTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyMTg4OQ==", "bodyText": "This is still a bit expensive since getting querystats involves -> for all stages, for all tasks, for all metrics.\nThe way CPU does it is still cheaper -> all stages, all tasks, just the cpu - so we can do something similar here and make it even cheaper -\nWe can follow a similar flow here\nSqlQueryManager -> SqlQuerySchedulerInterface#getTotalCpuTime -> SqlStageExecution#getTotalCpuTime\nand just sum up the bytes involved.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460421889", "createdAt": "2020-07-25T16:40:37Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +324,21 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            BasicQueryStats basicQueryStats = query.getBasicQueryInfo().getQueryStats();\n+            QueryStats queryStats = query.getQueryInfo().getQueryStats();\n+            DataSize scan = query.getBasicQueryInfo().getQueryStats().getRawInputDataSize();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ4MDMzOQ==", "bodyText": "I'm not certain if your approach about summing up bytes from SqlStageExecution#getTotalScanBytes is accurate... it's always the best practice to inherit scanned byte size from existing querystats to ensure the result is correct. I suggest we maintain current implementation with SqlQueryManager:getBasicQueryInfo-> BasicQueryStats:getQueryStats . How much cheaper are we suggesting to reduce if we want to bypass the existing logic with a risk that we might have a false result?\nMy option is that rawInputDataSize should be the only reliable source of truth when setting against with the hard scan limit.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r460480339", "createdAt": "2020-07-26T05:22:46Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +324,21 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            BasicQueryStats basicQueryStats = query.getBasicQueryInfo().getQueryStats();\n+            QueryStats queryStats = query.getQueryInfo().getQueryStats();\n+            DataSize scan = query.getBasicQueryInfo().getQueryStats().getRawInputDataSize();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyMTg4OQ=="}, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAwODkxNA==", "bodyText": "I don't agree that BasicQueryStats:getQueryStats is the only trusted source. As you can see, we are already doing this for total cpu ms and memory limits so I don't see why raw input bytes will be any different here. Again, my only concern is that this is a single thread already doing cpu and memory enforcements and we should keep it as light weight as possible and by keeping this trend, we will ensure that the new entries that are added also follow this lighter weight approach.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r461008914", "createdAt": "2020-07-27T16:18:25Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +324,21 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            BasicQueryStats basicQueryStats = query.getBasicQueryInfo().getQueryStats();\n+            QueryStats queryStats = query.getQueryInfo().getQueryStats();\n+            DataSize scan = query.getBasicQueryInfo().getQueryStats().getRawInputDataSize();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyMTg4OQ=="}, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEwNzQ2OA==", "bodyText": "understood, thank you! I have implemented your approach, I think it is safer and cheaper to acquire actual number via SqlQuerySchedulerInterface::getRawInputDataSize -> QueryExecution::getRawInputDataSize, and sum up all task's stats via SqlStageExecution::getRawInputDataSize. Please review the revised commit again, many thanks!", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r462107468", "createdAt": "2020-07-29T07:52:21Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +324,21 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            BasicQueryStats basicQueryStats = query.getBasicQueryInfo().getQueryStats();\n+            QueryStats queryStats = query.getQueryInfo().getQueryStats();\n+            DataSize scan = query.getBasicQueryInfo().getQueryStats().getRawInputDataSize();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyMTg4OQ=="}, "originalCommit": {"oid": "e714b67d68ff68b39a131c283013a1c634b79ea8"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4Njk5OTM4OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNjoxMToyMlrOG4_ziw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNzo1ODoxMFrOG5DzRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQxODgyNw==", "bodyText": "nit - lets rename this as rawInputSize", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r462418827", "createdAt": "2020-07-29T16:11:22Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +323,19 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize scan = query.getRawInputDataSize();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7837b6b1f5179afb8be2f09ebf34d61aee45f3be"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4NDI5NQ==", "bodyText": "fixed, thanks", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r462484295", "createdAt": "2020-07-29T17:58:10Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlQueryManager.java", "diffHunk": "@@ -312,4 +323,19 @@ private void enforceCpuLimits()\n             }\n         }\n     }\n+\n+    /**\n+     * Enforce query scan physical bytes limits\n+     */\n+    private void enforceScanLimits()\n+    {\n+        for (QueryExecution query : queryTracker.getAllQueries()) {\n+            DataSize scan = query.getRawInputDataSize();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQxODgyNw=="}, "originalCommit": {"oid": "7837b6b1f5179afb8be2f09ebf34d61aee45f3be"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzAyNDU5OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlStageExecution.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNjoxNzoyNFrOG5ADPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODowODozOVrOG5EKqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyMjg0NQ==", "bodyText": "Lets add this check at the top to ensure that we are only considering table scan nodes -\nif (planFragment.getTableScanSchedulingOrder().isEmpty()) {\n    return new DataSize(0, BYTE);\n}", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r462422845", "createdAt": "2020-07-29T16:17:24Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlStageExecution.java", "diffHunk": "@@ -333,6 +334,14 @@ public synchronized Duration getTotalCpuTime()\n         return new Duration(millis, TimeUnit.MILLISECONDS);\n     }\n \n+    public synchronized DataSize getRawInputDataSize()\n+    {\n+        long datasize = getAllTasks().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7837b6b1f5179afb8be2f09ebf34d61aee45f3be"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5MDI4MA==", "bodyText": "agree, we need to bypass when source is empty, fixed", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r462490280", "createdAt": "2020-07-29T18:08:39Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlStageExecution.java", "diffHunk": "@@ -333,6 +334,14 @@ public synchronized Duration getTotalCpuTime()\n         return new Duration(millis, TimeUnit.MILLISECONDS);\n     }\n \n+    public synchronized DataSize getRawInputDataSize()\n+    {\n+        long datasize = getAllTasks().stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyMjg0NQ=="}, "originalCommit": {"oid": "7837b6b1f5179afb8be2f09ebf34d61aee45f3be"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzUzODAzOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryManagerConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODozNDowOFrOG5FFBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODo1MToyNFrOG5Fq9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUwNTIyMw==", "bodyText": "Lets set the default to a higher number to avoid unexpected failures when people deploy this new version. Every sys admin should be able to set a reasonable value in their configurations. How about an exabyte (1000, PETABYTE)?", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r462505223", "createdAt": "2020-07-29T18:34:08Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryManagerConfig.java", "diffHunk": "@@ -66,6 +69,8 @@\n     private Duration queryMaxExecutionTime = new Duration(100, TimeUnit.DAYS);\n     private Duration queryMaxCpuTime = new Duration(1_000_000_000, TimeUnit.DAYS);\n \n+    private DataSize queryMaxScanRawInputBytes = DataSize.succinctDataSize(1, PETABYTE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4279dc5593d2d8e1a745059458ba4417bc10eef"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxNDkzNA==", "bodyText": "sure, this field is adjustable anytime by DBAs. Default is revised to 1000PB.", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r462514934", "createdAt": "2020-07-29T18:51:24Z", "author": {"login": "fgwang7w"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/QueryManagerConfig.java", "diffHunk": "@@ -66,6 +69,8 @@\n     private Duration queryMaxExecutionTime = new Duration(100, TimeUnit.DAYS);\n     private Duration queryMaxCpuTime = new Duration(1_000_000_000, TimeUnit.DAYS);\n \n+    private DataSize queryMaxScanRawInputBytes = DataSize.succinctDataSize(1, PETABYTE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUwNTIyMw=="}, "originalCommit": {"oid": "e4279dc5593d2d8e1a745059458ba4417bc10eef"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDg4NzIyOnYy", "diffSide": "RIGHT", "path": "presto-spi/src/main/java/com/facebook/presto/spi/session/PropertyMetadata.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoxMDo1OFrOG5kzEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoxMDo1OFrOG5kzEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAyNDkxNQ==", "bodyText": "Nice", "url": "https://github.com/prestodb/presto/pull/14739#discussion_r463024915", "createdAt": "2020-07-30T14:10:58Z", "author": {"login": "tdcmeehan"}, "path": "presto-spi/src/main/java/com/facebook/presto/spi/session/PropertyMetadata.java", "diffHunk": "@@ -199,4 +200,17 @@ public Object encode(T value)\n                 String.class::cast,\n                 object -> object);\n     }\n+\n+    public static PropertyMetadata<DataSize> dataSizeProperty(String name, String description, DataSize defaultValue, boolean hidden)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c712cb2388bf21af26703e90f5b4e011c8a0b49"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2549, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}