{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwMDUwOTMw", "number": 15125, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxNjo1NVrOEggxlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxOTo1NVrOEgg0Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTI2ODY5OnYy", "diffSide": "RIGHT", "path": "presto-hive-common/src/main/java/com/facebook/presto/hive/HiveFileContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxNjo1NVrOHNafHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxNjo1NVrOHNafHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNzQ4NA==", "bodyText": "Move fileSize after extraFileInfo\nMake the type OptionalLong rather than -1 to denote unknown", "url": "https://github.com/prestodb/presto/pull/15125#discussion_r483827484", "createdAt": "2020-09-04T20:16:55Z", "author": {"login": "highker"}, "path": "presto-hive-common/src/main/java/com/facebook/presto/hive/HiveFileContext.java", "diffHunk": "@@ -20,17 +20,20 @@\n \n public class HiveFileContext\n {\n-    public static final HiveFileContext DEFAULT_HIVE_FILE_CONTEXT = new HiveFileContext(true, NO_CACHE_CONSTRAINTS, Optional.empty());\n+    public static final long UNKNOWN_LENGTH = -1;\n+    public static final HiveFileContext DEFAULT_HIVE_FILE_CONTEXT = new HiveFileContext(true, NO_CACHE_CONSTRAINTS, Optional.empty(), UNKNOWN_LENGTH);\n \n     private final boolean cacheable;\n     private final CacheQuota cacheQuota;\n+    private final long fileSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fdd35c3a065344bf3a0c932e76fb689614af3a2"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTI3MDgyOnYy", "diffSide": "RIGHT", "path": "presto-hive-common/src/main/java/com/facebook/presto/hive/HiveFileContext.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxNzo0OVrOHNagUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDo0Nzo0MlrOHNbHFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNzc5Mg==", "bodyText": "remove", "url": "https://github.com/prestodb/presto/pull/15125#discussion_r483827792", "createdAt": "2020-09-04T20:17:49Z", "author": {"login": "highker"}, "path": "presto-hive-common/src/main/java/com/facebook/presto/hive/HiveFileContext.java", "diffHunk": "@@ -20,17 +20,20 @@\n \n public class HiveFileContext\n {\n-    public static final HiveFileContext DEFAULT_HIVE_FILE_CONTEXT = new HiveFileContext(true, NO_CACHE_CONSTRAINTS, Optional.empty());\n+    public static final long UNKNOWN_LENGTH = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fdd35c3a065344bf3a0c932e76fb689614af3a2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNzcxNg==", "bodyText": "done", "url": "https://github.com/prestodb/presto/pull/15125#discussion_r483837716", "createdAt": "2020-09-04T20:47:42Z", "author": {"login": "apc999"}, "path": "presto-hive-common/src/main/java/com/facebook/presto/hive/HiveFileContext.java", "diffHunk": "@@ -20,17 +20,20 @@\n \n public class HiveFileContext\n {\n-    public static final HiveFileContext DEFAULT_HIVE_FILE_CONTEXT = new HiveFileContext(true, NO_CACHE_CONSTRAINTS, Optional.empty());\n+    public static final long UNKNOWN_LENGTH = -1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNzc5Mg=="}, "originalCommit": {"oid": "6fdd35c3a065344bf3a0c932e76fb689614af3a2"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTI3MTEwOnYy", "diffSide": "RIGHT", "path": "presto-hive-common/src/main/java/com/facebook/presto/hive/HiveFileContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxNzo1N1rOHNagew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxNzo1N1rOHNagew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNzgzNQ==", "bodyText": "remove", "url": "https://github.com/prestodb/presto/pull/15125#discussion_r483827835", "createdAt": "2020-09-04T20:17:57Z", "author": {"login": "highker"}, "path": "presto-hive-common/src/main/java/com/facebook/presto/hive/HiveFileContext.java", "diffHunk": "@@ -54,6 +57,14 @@ public CacheQuota getCacheQuota()\n         return extraFileInfo;\n     }\n \n+    /**\n+     * file length in bytes or -1 if it is unknown\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fdd35c3a065344bf3a0c932e76fb689614af3a2"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTI3NDk1OnYy", "diffSide": "RIGHT", "path": "presto-cache/src/main/java/com/facebook/presto/cache/alluxio/AlluxioCachingFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxOTo1NVrOHNaiug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMDoxOTo1NVrOHNaiug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyODQxMA==", "bodyText": "FileInfo info = new FileInfo().setFileIdentifier(md5().hashString(path.toString(), UTF_8).toString())\n                    .setPath(path.toString())\n                    .setFolder(false)\n                    .setLength(hiveFileContext.getFileSize());", "url": "https://github.com/prestodb/presto/pull/15125#discussion_r483828410", "createdAt": "2020-09-04T20:19:55Z", "author": {"login": "highker"}, "path": "presto-cache/src/main/java/com/facebook/presto/cache/alluxio/AlluxioCachingFileSystem.java", "diffHunk": "@@ -56,9 +59,16 @@ public FSDataInputStream openFile(Path path, HiveFileContext hiveFileContext)\n             throws Exception\n     {\n         if (hiveFileContext.isCacheable()) {\n-            FileStatus fileStatus = dataTier.getFileStatus(path);\n+            // FilePath is a unique identifier for a file, however it can be a long string\n+            // hence using md5 hash of the file path as the identifier in the cache.\n+            // We don't set fileId because fileId is Alluxio specific\n+            FileInfo info = new FileInfo();\n+            info.setFileIdentifier(md5().hashString(path.toString(), UTF_8).toString())\n+                    .setPath(path.toString())\n+                    .setFolder(false)\n+                    .setLength(hiveFileContext.getFileSize());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fdd35c3a065344bf3a0c932e76fb689614af3a2"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3622, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}