{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0ODg4MzYw", "number": 14403, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMzoyNTo1NFrODywJIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMzoyODoxN1rODywKjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NTQ0MTYyOnYy", "diffSide": "RIGHT", "path": "presto-tests/src/test/java/com/facebook/presto/execution/TestWarnings.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMzoyNTo1NFrOGG-pSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMzoyNTo1NFrOGG-pSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTk3MTAxOQ==", "bodyText": "nit:static import", "url": "https://github.com/prestodb/presto/pull/14403#discussion_r409971019", "createdAt": "2020-04-17T03:25:54Z", "author": {"login": "caithagoras"}, "path": "presto-tests/src/test/java/com/facebook/presto/execution/TestWarnings.java", "diffHunk": "@@ -64,40 +64,49 @@ public void testStageCountWarningThreshold()\n                     .append(stageIndex);\n         }\n         String query = queryBuilder.toString();\n-        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableList.of(TOO_MANY_STAGES.toWarningCode()));\n-        assertWarnings(queryRunner, TEST_SESSION, noWarningsQuery, ImmutableList.of());\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(TOO_MANY_STAGES.toWarningCode()));\n+        assertWarnings(queryRunner, TEST_SESSION, noWarningsQuery, ImmutableSet.of());\n     }\n \n     @Test\n     public void testNonReservedWordWarning()\n     {\n         String query = \"SELECT CURRENT_ROLE, t.current_role FROM (VALUES (3)) t(current_role)\";\n-        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableList.of(PARSER_WARNING.toWarningCode()));\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(PARSER_WARNING.toWarningCode()));\n     }\n \n     @Test\n     public void testNewReservedWordsWarning()\n     {\n         String query = \"SELECT CALLED, t.called FROM (VALUES (3)) t(called)\";\n-        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableList.of(PARSER_WARNING.toWarningCode()));\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(PARSER_WARNING.toWarningCode()));\n+    }\n+\n+    @Test\n+    public void testWarningsAreNotStateful()\n+    {\n+        String query = \"SELECT CALLED, t.called FROM (VALUES (3)) t(called)\";\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(PARSER_WARNING.toWarningCode()));\n+        // Make sure the previous warning is not carried into the next query\n+        query = \"SELECT UNCALLED, t.uncalled FROM (VALUES (3)) t(uncalled)\";\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of());\n     }\n \n     @Test\n     public void testQuotedIdentifiersDoNotTriggerWarning()\n     {\n         String query = \"SELECT \\\"CALLED\\\" FROM (VALUES (3)) t(\\\"called\\\")\";\n-        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableList.of());\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of());\n     }\n \n-    private static void assertWarnings(QueryRunner queryRunner, Session session, @Language(\"SQL\") String sql, List<WarningCode> expectedWarnings)\n+    private static void assertWarnings(QueryRunner queryRunner, Session session, @Language(\"SQL\") String sql, Set<WarningCode> expectedWarnings)\n     {\n         Set<WarningCode> warnings = queryRunner.execute(session, sql).getWarnings().stream()\n                 .map(PrestoWarning::getWarningCode)\n                 .collect(toImmutableSet());\n-        for (WarningCode warningCode : expectedWarnings) {\n-            if (!warnings.contains(warningCode)) {\n-                fail(\"Expected warning: \" + warningCode);\n-            }\n-        }\n+        Set<WarningCode> expectedButMissing = Sets.difference(expectedWarnings, warnings);\n+        Set<WarningCode> unexpectedWarnings = Sets.difference(warnings, expectedWarnings);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "beb9cd85534c4f636af1473ba7c022e1e18b6505"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NTQ0NTI3OnYy", "diffSide": "RIGHT", "path": "presto-tests/src/test/java/com/facebook/presto/execution/TestWarnings.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMzoyODoxN1rOGG-rcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMzoyODoxN1rOGG-rcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTk3MTU2OQ==", "bodyText": "nit: add a line break before line 90 for readability.", "url": "https://github.com/prestodb/presto/pull/14403#discussion_r409971569", "createdAt": "2020-04-17T03:28:17Z", "author": {"login": "caithagoras"}, "path": "presto-tests/src/test/java/com/facebook/presto/execution/TestWarnings.java", "diffHunk": "@@ -64,40 +64,49 @@ public void testStageCountWarningThreshold()\n                     .append(stageIndex);\n         }\n         String query = queryBuilder.toString();\n-        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableList.of(TOO_MANY_STAGES.toWarningCode()));\n-        assertWarnings(queryRunner, TEST_SESSION, noWarningsQuery, ImmutableList.of());\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(TOO_MANY_STAGES.toWarningCode()));\n+        assertWarnings(queryRunner, TEST_SESSION, noWarningsQuery, ImmutableSet.of());\n     }\n \n     @Test\n     public void testNonReservedWordWarning()\n     {\n         String query = \"SELECT CURRENT_ROLE, t.current_role FROM (VALUES (3)) t(current_role)\";\n-        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableList.of(PARSER_WARNING.toWarningCode()));\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(PARSER_WARNING.toWarningCode()));\n     }\n \n     @Test\n     public void testNewReservedWordsWarning()\n     {\n         String query = \"SELECT CALLED, t.called FROM (VALUES (3)) t(called)\";\n-        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableList.of(PARSER_WARNING.toWarningCode()));\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(PARSER_WARNING.toWarningCode()));\n+    }\n+\n+    @Test\n+    public void testWarningsAreNotStateful()\n+    {\n+        String query = \"SELECT CALLED, t.called FROM (VALUES (3)) t(called)\";\n+        assertWarnings(queryRunner, TEST_SESSION, query, ImmutableSet.of(PARSER_WARNING.toWarningCode()));\n+        // Make sure the previous warning is not carried into the next query", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "beb9cd85534c4f636af1473ba7c022e1e18b6505"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2798, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}