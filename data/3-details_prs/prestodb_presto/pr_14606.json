{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NjI5NDk1", "number": 14606, "title": "Create warning for COUNT(DISTINCT) to use approx_distinct", "bodyText": "COUNT(DISTINCT xxx) can be a very expensive operation when the cardinality is high for xxx. In most scenarios, approx_distinct would be enough. This commit produces a warning if COUNT(DISTINCT) is detected.\n== RELEASE NOTES ==\nGeneral Changes\n* COUNT(DISTINCT) suggests using approx_distinct instead", "createdAt": "2020-06-04T06:58:29Z", "url": "https://github.com/prestodb/presto/pull/14606", "merged": true, "mergeCommit": {"oid": "793ef467c5f9fc24c9eba456cafe8a0f696585b2"}, "closed": true, "closedAt": "2020-06-09T18:25:49Z", "author": {"login": "mbriskar"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoKPJhgFqTQyNDk3NTY1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcppUlTAFqTQyNzQyOTUwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0OTc1NjU1", "url": "https://github.com/prestodb/presto/pull/14606#pullrequestreview-424975655", "createdAt": "2020-06-05T03:38:38Z", "commit": {"oid": "74998eec9904348c00c9b160c93ea15acb148047"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMzozODozOFrOGffXrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMzozODozOFrOGffXrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY3MzAwNA==", "bodyText": "COUNT is an aggregation function so you can add this check in the following block. And let's use standard libraries to check for function FunctionResolution.isCountFunction.", "url": "https://github.com/prestodb/presto/pull/14606#discussion_r435673004", "createdAt": "2020-06-05T03:38:38Z", "author": {"login": "rongrong"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/AggregationAnalyzer.java", "diffHunk": "@@ -314,6 +322,7 @@ protected Boolean visitInPredicate(InPredicate node, Void context)\n         @Override\n         protected Boolean visitFunctionCall(FunctionCall node, Void context)\n         {\n+            warnIfDistinctCount(node);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74998eec9904348c00c9b160c93ea15acb148047"}, "originalPosition": 70}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74998eec9904348c00c9b160c93ea15acb148047", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/74998eec9904348c00c9b160c93ea15acb148047", "committedDate": "2020-06-04T06:52:53Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct"}, "afterCommit": {"oid": "23dfdc8cc9608af556e281726a5baf0bba89db53", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/23dfdc8cc9608af556e281726a5baf0bba89db53", "committedDate": "2020-06-05T04:22:41Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23dfdc8cc9608af556e281726a5baf0bba89db53", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/23dfdc8cc9608af556e281726a5baf0bba89db53", "committedDate": "2020-06-05T04:22:41Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct"}, "afterCommit": {"oid": "8095e6c807e8b31d14ac2b54ddf81613d2e510ea", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/8095e6c807e8b31d14ac2b54ddf81613d2e510ea", "committedDate": "2020-06-08T19:21:06Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct due to performance savings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8095e6c807e8b31d14ac2b54ddf81613d2e510ea", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/8095e6c807e8b31d14ac2b54ddf81613d2e510ea", "committedDate": "2020-06-08T19:21:06Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct due to performance savings"}, "afterCommit": {"oid": "f331a5d486ea83d5375f4822816764d63012fd53", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/f331a5d486ea83d5375f4822816764d63012fd53", "committedDate": "2020-06-08T23:52:56Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct due to performance savings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f331a5d486ea83d5375f4822816764d63012fd53", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/f331a5d486ea83d5375f4822816764d63012fd53", "committedDate": "2020-06-08T23:52:56Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct due to performance savings"}, "afterCommit": {"oid": "be4a8cd8a91cd1c4870e4fbbb3171fb6645bfecc", "author": {"user": {"login": "mbriskar", "name": "Matej Briskar"}}, "url": "https://github.com/prestodb/presto/commit/be4a8cd8a91cd1c4870e4fbbb3171fb6645bfecc", "committedDate": "2020-06-08T23:55:38Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6ed76db7fbdfd62590db4bd9acf32a55665e0dd", "author": {"user": {"login": "mbriskar", "name": "Matej Briskar"}}, "url": "https://github.com/prestodb/presto/commit/f6ed76db7fbdfd62590db4bd9acf32a55665e0dd", "committedDate": "2020-06-09T03:00:39Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct for performance benefits"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be4a8cd8a91cd1c4870e4fbbb3171fb6645bfecc", "author": {"user": {"login": "mbriskar", "name": "Matej Briskar"}}, "url": "https://github.com/prestodb/presto/commit/be4a8cd8a91cd1c4870e4fbbb3171fb6645bfecc", "committedDate": "2020-06-08T23:55:38Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct"}, "afterCommit": {"oid": "f6ed76db7fbdfd62590db4bd9acf32a55665e0dd", "author": {"user": {"login": "mbriskar", "name": "Matej Briskar"}}, "url": "https://github.com/prestodb/presto/commit/f6ed76db7fbdfd62590db4bd9acf32a55665e0dd", "committedDate": "2020-06-09T03:00:39Z", "message": "Create warning for COUNT(DISTINCT) to use approx_distinct for performance benefits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDAyNzE3", "url": "https://github.com/prestodb/presto/pull/14606#pullrequestreview-427402717", "createdAt": "2020-06-09T17:50:14Z", "commit": {"oid": "f6ed76db7fbdfd62590db4bd9acf32a55665e0dd"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDI5NTAz", "url": "https://github.com/prestodb/presto/pull/14606#pullrequestreview-427429503", "createdAt": "2020-06-09T18:25:34Z", "commit": {"oid": "f6ed76db7fbdfd62590db4bd9acf32a55665e0dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1757, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}