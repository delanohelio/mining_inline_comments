{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3ODQ0MDg4", "number": 14124, "title": "Optimize scan of filter-only no-nulls integers", "bodyText": "== NO RELEASE NOTE ==", "createdAt": "2020-02-20T16:10:35Z", "url": "https://github.com/prestodb/presto/pull/14124", "merged": true, "mergeCommit": {"oid": "a553d1cfb5a7df64e761f50b5e995e6152589607"}, "closed": true, "closedAt": "2020-02-21T16:20:54Z", "author": {"login": "mbasmanova"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGTkclAFqTM2MjI5NTg4MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGgy_SgBqjMwNjA3Mjc4NTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjk1ODgx", "url": "https://github.com/prestodb/presto/pull/14124#pullrequestreview-362295881", "createdAt": "2020-02-20T22:59:20Z", "commit": {"oid": "ec20ae17f7884244ef25414d2bcb429e3733ec44"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1OToyMVrOFsmIuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1OToyMVrOFsmIuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMwNjQ4OA==", "bodyText": "This can be readOffset = offset + positionCount;", "url": "https://github.com/prestodb/presto/pull/14124#discussion_r382306488", "createdAt": "2020-02-20T22:59:21Z", "author": {"login": "yingsu00"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/LongDirectSelectiveStreamReader.java", "diffHunk": "@@ -115,6 +115,25 @@ public int read(int offset, int[] positions, int positionCount)\n                 skip(offset - readOffset);\n             }\n \n+            if (positions[positionCount - 1] == positionCount - 1) {\n+                // no skipping\n+                if (presentStream == null) {\n+                    // no nulls\n+                    if (!outputRequired && filter != null && !filter.isPositionalFilter()) {\n+                        // no output; just filter\n+                        for (int i = 0; i < positionCount; i++) {\n+                            long value = dataStream.next();\n+                            if (filter.testLong(value)) {\n+                                outputPositions[outputPositionCount] = positions[i];\n+                                outputPositionCount++;\n+                            }\n+                        }\n+                        readOffset = offset + positions[positionCount - 1] + 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec20ae17f7884244ef25414d2bcb429e3733ec44"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec20ae17f7884244ef25414d2bcb429e3733ec44", "author": {"user": {"login": "mbasmanova", "name": "Maria Basmanova"}}, "url": "https://github.com/prestodb/presto/commit/ec20ae17f7884244ef25414d2bcb429e3733ec44", "committedDate": "2020-02-20T16:08:55Z", "message": "Optimize scan of filter-only no-nulls integers"}, "afterCommit": {"oid": "69f6c4e13ece8f52d540a7e887acfa71d561099c", "author": {"user": {"login": "mbasmanova", "name": "Maria Basmanova"}}, "url": "https://github.com/prestodb/presto/commit/69f6c4e13ece8f52d540a7e887acfa71d561099c", "committedDate": "2020-02-21T01:17:30Z", "message": "Optimize scan of filter-only no-nulls integers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMzc2OTIy", "url": "https://github.com/prestodb/presto/pull/14124#pullrequestreview-362376922", "createdAt": "2020-02-21T03:13:56Z", "commit": {"oid": "69f6c4e13ece8f52d540a7e887acfa71d561099c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDc2Mzg5", "url": "https://github.com/prestodb/presto/pull/14124#pullrequestreview-362476389", "createdAt": "2020-02-21T08:51:27Z", "commit": {"oid": "69f6c4e13ece8f52d540a7e887acfa71d561099c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODo1MToyN1rOFsvlPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwODo1MToyN1rOFsvlPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ2MTI0Nw==", "bodyText": "javadoc maybe", "url": "https://github.com/prestodb/presto/pull/14124#discussion_r382461247", "createdAt": "2020-02-21T08:51:27Z", "author": {"login": "highker"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/TupleDomainFilter.java", "diffHunk": "@@ -93,6 +93,9 @@\n      */\n     int getSucceedingPositionsToFail();\n \n+    // Returns true if getPrecedingPositionsToFail or getSucceedingPositionsToFail may return non-zero values", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f6c4e13ece8f52d540a7e887acfa71d561099c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e04dda1113794b55108c482582a0a99bf3a75aad", "author": {"user": {"login": "mbasmanova", "name": "Maria Basmanova"}}, "url": "https://github.com/prestodb/presto/commit/e04dda1113794b55108c482582a0a99bf3a75aad", "committedDate": "2020-02-21T14:42:07Z", "message": "Optimize scan of filter-only no-nulls integers"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69f6c4e13ece8f52d540a7e887acfa71d561099c", "author": {"user": {"login": "mbasmanova", "name": "Maria Basmanova"}}, "url": "https://github.com/prestodb/presto/commit/69f6c4e13ece8f52d540a7e887acfa71d561099c", "committedDate": "2020-02-21T01:17:30Z", "message": "Optimize scan of filter-only no-nulls integers"}, "afterCommit": {"oid": "e04dda1113794b55108c482582a0a99bf3a75aad", "author": {"user": {"login": "mbasmanova", "name": "Maria Basmanova"}}, "url": "https://github.com/prestodb/presto/commit/e04dda1113794b55108c482582a0a99bf3a75aad", "committedDate": "2020-02-21T14:42:07Z", "message": "Optimize scan of filter-only no-nulls integers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2266, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}