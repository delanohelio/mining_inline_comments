{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MTc5ODIy", "number": 14670, "title": "BenchmarkRunner fixes and make it extensible", "bodyText": "== NO RELEASE NOTES ==", "createdAt": "2020-06-18T01:47:20Z", "url": "https://github.com/prestodb/presto/pull/14670", "merged": true, "mergeCommit": {"oid": "2cb629e8658bc0781f310ae4b08d8da4b9972d73"}, "closed": true, "closedAt": "2020-07-22T22:31:47Z", "author": {"login": "caithagoras"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsVqWkgBqjM0NTYxNjY2NzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczBj9SAFqTQ0NTE1MDAwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d5bb66b8947704dcf8d8a2a2b926e2bdbca5331", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/5d5bb66b8947704dcf8d8a2a2b926e2bdbca5331", "committedDate": "2020-06-18T01:42:35Z", "message": "Make max concurrency optional in ConcurrentExecutionPhase\n\n- Max concurrency can be optional ConcurrentExecutionPhase.\n- Max concurrency can also be specified through configuration property\n  max-concurrency. If specified, it supercedes the value in\n  ConcurrentExecutionPhase.\n- If max concurrency is specified in neither places, a default of\n  70 is applied."}, "afterCommit": {"oid": "c2b99c1ed7f4da3ae7af5b25648054a8cf8d35e1", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c2b99c1ed7f4da3ae7af5b25648054a8cf8d35e1", "committedDate": "2020-06-18T03:12:53Z", "message": "Make max concurrency optional in ConcurrentExecutionPhase\n\n- Max concurrency can be optional ConcurrentExecutionPhase.\n- Max concurrency can also be specified through configuration property\n  max-concurrency. If specified, it supercedes the value in\n  ConcurrentExecutionPhase.\n- If max concurrency is specified in neither places, a default of\n  70 is applied."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2b99c1ed7f4da3ae7af5b25648054a8cf8d35e1", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c2b99c1ed7f4da3ae7af5b25648054a8cf8d35e1", "committedDate": "2020-06-18T03:12:53Z", "message": "Make max concurrency optional in ConcurrentExecutionPhase\n\n- Max concurrency can be optional ConcurrentExecutionPhase.\n- Max concurrency can also be specified through configuration property\n  max-concurrency. If specified, it supercedes the value in\n  ConcurrentExecutionPhase.\n- If max concurrency is specified in neither places, a default of\n  70 is applied."}, "afterCommit": {"oid": "95eb1a01245c66ffff38e98dbbf1250a78c090de", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/95eb1a01245c66ffff38e98dbbf1250a78c090de", "committedDate": "2020-06-18T03:13:28Z", "message": "Make max concurrency optional in ConcurrentExecutionPhase\n\n- Max concurrency can be optional ConcurrentExecutionPhase.\n- Max concurrency can also be specified through configuration property\n  max-concurrency. If specified, it supercedes the value in\n  ConcurrentExecutionPhase.\n- If max concurrency is specified in neither places, a default of\n  70 is applied."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyOTU4OTA4", "url": "https://github.com/prestodb/presto/pull/14670#pullrequestreview-432958908", "createdAt": "2020-06-18T05:51:43Z", "commit": {"oid": "b83828f58b1f98567435bd92a5d7a06db4b2c146"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNTo1MTo0M1rOGlgfyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNTo1MTo0M1rOGlgfyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk4MjkyMA==", "bodyText": "nit: start a new line for getBenchmarkSuiteObject(SUITE, QUERY_SET)?", "url": "https://github.com/prestodb/presto/pull/14670#discussion_r441982920", "createdAt": "2020-06-18T05:51:43Z", "author": {"login": "yingsu00"}, "path": "presto-benchmark-runner/src/test/java/com/facebook/presto/benchmark/source/TestMySqlBenchmarkSuiteSupplier.java", "diffHunk": "@@ -73,6 +74,8 @@ public void testSupplySuite()\n \n         insertBenchmarkSuite(handle, SUITE, QUERY_SET, PHASE_SPECIFICATION_LIST_CODEC.toJson(getBenchmarkSuitePhases()), MAP_CODEC.toJson(getBenchmarkSuiteSessionProperties()));\n \n-        assertEquals(new DbBenchmarkSuiteSupplier(jdbi, new BenchmarkSuiteConfig().setSuite(SUITE)).get(), getBenchmarkSuiteObject(SUITE, QUERY_SET));\n+        assertEquals(new MySqlBenchmarkSuiteSupplier(\n+                new MySqlBenchmarkSuiteConfig().setDatabaseUrl(mySqlServer.getJdbcUrl(XDB)),\n+                new BenchmarkSuiteConfig().setSuite(SUITE)).get(), getBenchmarkSuiteObject(SUITE, QUERY_SET));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b83828f58b1f98567435bd92a5d7a06db4b2c146"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95eb1a01245c66ffff38e98dbbf1250a78c090de", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/95eb1a01245c66ffff38e98dbbf1250a78c090de", "committedDate": "2020-06-18T03:13:28Z", "message": "Make max concurrency optional in ConcurrentExecutionPhase\n\n- Max concurrency can be optional ConcurrentExecutionPhase.\n- Max concurrency can also be specified through configuration property\n  max-concurrency. If specified, it supercedes the value in\n  ConcurrentExecutionPhase.\n- If max concurrency is specified in neither places, a default of\n  70 is applied."}, "afterCommit": {"oid": "a3ad1588dbab9d5f36b323f397d2a1b1d837c549", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a3ad1588dbab9d5f36b323f397d2a1b1d837c549", "committedDate": "2020-06-18T19:53:35Z", "message": "Make max concurrency optional in ConcurrentExecutionPhase\n\n- Max concurrency can be optional ConcurrentExecutionPhase.\n- Max concurrency can also be specified through configuration property\n  max-concurrency. If specified, it supercedes the value in\n  ConcurrentExecutionPhase.\n- If max concurrency is specified in neither places, a default of\n  70 is applied."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3ad1588dbab9d5f36b323f397d2a1b1d837c549", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a3ad1588dbab9d5f36b323f397d2a1b1d837c549", "committedDate": "2020-06-18T19:53:35Z", "message": "Make max concurrency optional in ConcurrentExecutionPhase\n\n- Max concurrency can be optional ConcurrentExecutionPhase.\n- Max concurrency can also be specified through configuration property\n  max-concurrency. If specified, it supercedes the value in\n  ConcurrentExecutionPhase.\n- If max concurrency is specified in neither places, a default of\n  70 is applied."}, "afterCommit": {"oid": "1914034351b35d5a41e651ad9bdf980aa314572b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1914034351b35d5a41e651ad9bdf980aa314572b", "committedDate": "2020-06-18T03:10:34Z", "message": "Fix PhaseSpecification\n\nFix JSON serialization and deserialization for subclasses of\nPhaseSpecification. It is unnecessay to make ExecutionStrategy\na field or JSON field. Instead, ExecutionStrategy is static for\nany subclasses of PhaseExecution.\n\nAlso,\n- Fix equals() and hashCode()\n- Move ExecutionStrategy to top-level"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6837a7622f5698272a56349a247c3fb59d0b5ea", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/d6837a7622f5698272a56349a247c3fb59d0b5ea", "committedDate": "2020-06-19T04:39:05Z", "message": "Allow session properties to be specified with queries"}, "afterCommit": {"oid": "a462337c1a6aec4b0a4ea3e6e1851ff1f1d7d1ca", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a462337c1a6aec4b0a4ea3e6e1851ff1f1d7d1ca", "committedDate": "2020-06-19T04:44:17Z", "message": "Allow session properties to be specified with queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a054bcbf3f4c5f431728a033779b05f8227e7de6", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a054bcbf3f4c5f431728a033779b05f8227e7de6", "committedDate": "2020-06-19T05:38:04Z", "message": "Refactor PhaseExecutor\n\n- Redefine interface PhaseExecutor so that a PhaseExecutor is a\n  stateless object and is reused across phases.\n- Move BenchmarQueryRunner into AbstractPhaseExecutor.\n- Shutdown executor in a single place.\n- Post events in single places."}, "afterCommit": {"oid": "1de16ce5debaa08862861cc3e5c02a8fbe5d54e3", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1de16ce5debaa08862861cc3e5c02a8fbe5d54e3", "committedDate": "2020-06-19T05:41:27Z", "message": "Refactor PhaseExecutor\n\n- Redefine interface PhaseExecutor so that a PhaseExecutor is a\n  stateless object and is reused across phases.\n- Move BenchmarQueryRunner into AbstractPhaseExecutor.\n- Shutdown executor in a single place.\n- Post events in single places."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10c70f4ad3dc315e34cd5128f79e2a3312b0f4d6", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/10c70f4ad3dc315e34cd5128f79e2a3312b0f4d6", "committedDate": "2020-06-19T05:58:30Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "7103f33d1e542bcbcab11c9e3de816abb33abeac", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7103f33d1e542bcbcab11c9e3de816abb33abeac", "committedDate": "2020-06-19T06:09:39Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7103f33d1e542bcbcab11c9e3de816abb33abeac", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7103f33d1e542bcbcab11c9e3de816abb33abeac", "committedDate": "2020-06-19T06:09:39Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "798149f84dedb468f648530b4e639250f599e96b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/798149f84dedb468f648530b4e639250f599e96b", "committedDate": "2020-06-19T22:40:40Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "798149f84dedb468f648530b4e639250f599e96b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/798149f84dedb468f648530b4e639250f599e96b", "committedDate": "2020-06-19T22:40:40Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "b7d5f38e4cab0f01463bd205e6b93a72a60d05d9", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b7d5f38e4cab0f01463bd205e6b93a72a60d05d9", "committedDate": "2020-06-19T22:41:54Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7d5f38e4cab0f01463bd205e6b93a72a60d05d9", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/b7d5f38e4cab0f01463bd205e6b93a72a60d05d9", "committedDate": "2020-06-19T22:41:54Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "683066561b71c521f7c26316f41e7795f0e1ccb0", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/683066561b71c521f7c26316f41e7795f0e1ccb0", "committedDate": "2020-06-19T22:44:18Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "683066561b71c521f7c26316f41e7795f0e1ccb0", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/683066561b71c521f7c26316f41e7795f0e1ccb0", "committedDate": "2020-06-19T22:44:18Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "96294e74084548a42aae8e2866c57469bcfb7279", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/96294e74084548a42aae8e2866c57469bcfb7279", "committedDate": "2020-06-19T22:44:26Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTUyMzc1", "url": "https://github.com/prestodb/presto/pull/14670#pullrequestreview-437952375", "createdAt": "2020-06-26T01:00:10Z", "commit": {"oid": "1914034351b35d5a41e651ad9bdf980aa314572b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMTowMDoxMFrOGpQhvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMTowMDoxMFrOGpQhvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkxNTU4Mg==", "bodyText": "Does STREAM mean single stream and CONCURRENT means multiple of streams? Or CONCURRENT means no streams? Could you add some comment?", "url": "https://github.com/prestodb/presto/pull/14670#discussion_r445915582", "createdAt": "2020-06-26T01:00:10Z", "author": {"login": "yingsu00"}, "path": "presto-benchmark-runner/src/main/java/com/facebook/presto/benchmark/framework/ExecutionStrategy.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.benchmark.framework;\n+\n+public enum ExecutionStrategy\n+{\n+    STREAM,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1914034351b35d5a41e651ad9bdf980aa314572b"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTczMTY5", "url": "https://github.com/prestodb/presto/pull/14670#pullrequestreview-437973169", "createdAt": "2020-06-26T02:16:26Z", "commit": {"oid": "96294e74084548a42aae8e2866c57469bcfb7279"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTk2NTQ2", "url": "https://github.com/prestodb/presto/pull/14670#pullrequestreview-437996546", "createdAt": "2020-06-26T03:51:34Z", "commit": {"oid": "0f02adae990b674fd83b26729a72689d7dba41af"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMzo1MTozNFrOGpS1lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMzo1ODowNFrOGpS6pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1MzQyOQ==", "bodyText": "Why is the queries mutable? Everything else is final, why does the queries need to change given a fixed suite and querySet?", "url": "https://github.com/prestodb/presto/pull/14670#discussion_r445953429", "createdAt": "2020-06-26T03:51:34Z", "author": {"login": "yingsu00"}, "path": "presto-benchmark-runner/src/main/java/com/facebook/presto/benchmark/framework/BenchmarkSuite.java", "diffHunk": "@@ -63,13 +85,54 @@ public boolean equals(Object obj)\n             return false;\n         }\n         BenchmarkSuite o = (BenchmarkSuite) obj;\n-        return Objects.equals(suiteInfo, o.suiteInfo) &&\n+        return Objects.equals(suite, o.suite) &&\n+                Objects.equals(querySet, o.querySet) &&\n+                Objects.equals(phases, o.phases) &&\n+                Objects.equals(sessionProperties, o.sessionProperties) &&\n                 Objects.equals(queries, o.queries);\n     }\n \n     @Override\n     public int hashCode()\n     {\n-        return Objects.hash(suiteInfo, queries);\n+        return Objects.hash(suite, querySet, phases, sessionProperties, queries);\n+    }\n+\n+    public static class JdbiBuilder\n+    {\n+        private final String suite;\n+        private final String querySet;\n+        private final List<PhaseSpecification> phases;\n+        private final Map<String, String> sessionProperties;\n+        private List<BenchmarkQuery> queries;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f02adae990b674fd83b26729a72689d7dba41af"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1MzkwNg==", "bodyText": "Same question as above: why do we need to use setQueries instead of make it part of the constructor?", "url": "https://github.com/prestodb/presto/pull/14670#discussion_r445953906", "createdAt": "2020-06-26T03:53:45Z", "author": {"login": "yingsu00"}, "path": "presto-benchmark-runner/src/main/java/com/facebook/presto/benchmark/source/AbstractJdbiBenchmarkSuiteSupplier.java", "diffHunk": "@@ -40,11 +39,8 @@ public BenchmarkSuite get()\n     {\n         return jdbi.inTransaction(handle -> {\n             BenchmarkSuiteDao dao = handle.attach(BenchmarkSuiteDao.class);\n-            BenchmarkSuiteInfo suiteInfo = dao.getBenchmarkSuiteInfo(suitesTableName, suite);\n-            return new BenchmarkSuite(\n-                    suite,\n-                    suiteInfo,\n-                    dao.getBenchmarkQueries(queriesTableName, suiteInfo.getQuerySet()));\n+            BenchmarkSuite.JdbiBuilder suiteBuilder = dao.getBenchmarkSuite(suitesTableName, suite);\n+            return suiteBuilder.setQueries(dao.getBenchmarkQueries(queriesTableName, suiteBuilder.getQuerySet())).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f02adae990b674fd83b26729a72689d7dba41af"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NDcyNw==", "bodyText": "Why are all tests with empty session properties? Can we add some test with non-empty session properties?", "url": "https://github.com/prestodb/presto/pull/14670#discussion_r445954727", "createdAt": "2020-06-26T03:58:04Z", "author": {"login": "yingsu00"}, "path": "presto-benchmark-runner/src/test/java/com/facebook/presto/benchmark/BenchmarkTestUtil.java", "diffHunk": "@@ -126,9 +127,9 @@ public static void insertBenchmarkSuite(Handle handle, String suite, String quer\n \n     public static BenchmarkSuite getBenchmarkSuiteObject(String suite, String querySet)\n     {\n-        BenchmarkQuery benchmarkQuery1 = new BenchmarkQuery(\"Q1\", \"SELECT 1\", CATALOG, SCHEMA);\n-        BenchmarkQuery benchmarkQuery2 = new BenchmarkQuery(\"Q2\", \"SELECT 2\", CATALOG, SCHEMA);\n-        BenchmarkQuery benchmarkQuery3 = new BenchmarkQuery(\"Q3\", \"SELECT 3\", CATALOG, SCHEMA);\n+        BenchmarkQuery benchmarkQuery1 = new BenchmarkQuery(\"Q1\", \"SELECT 1\", CATALOG, SCHEMA, Optional.empty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a462337c1a6aec4b0a4ea3e6e1851ff1f1d7d1ca"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd91b166c450f34d6c0bd0c4c9d87e5374aef5c4", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/bd91b166c450f34d6c0bd0c4c9d87e5374aef5c4", "committedDate": "2020-06-30T20:04:11Z", "message": "Make BenchmarkSuiteSupplier extensible\n\n- Move the logic of DbBenchmarkSuiteSupplier into an abastract\n  base class AbstractJdbiBenchmarkSuiteSupplier.\n- Move MySqlBenchmarkSuiteConfig to the correct package."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94fad97f0c01e97bb5ddedead6ca327cbb6ca07c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/94fad97f0c01e97bb5ddedead6ca327cbb6ca07c", "committedDate": "2020-06-30T20:04:11Z", "message": "Make benchmark runner extensible\n\nMove logic from PrestoBenchmarkCommand to an abstract base class."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96294e74084548a42aae8e2866c57469bcfb7279", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/96294e74084548a42aae8e2866c57469bcfb7279", "committedDate": "2020-06-19T22:44:26Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "6df620b9ee8295481f67feaab921d42eabffed9d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6df620b9ee8295481f67feaab921d42eabffed9d", "committedDate": "2020-06-30T20:04:11Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da84dc5b2a2954af285bf748acede11d6844ca62", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/da84dc5b2a2954af285bf748acede11d6844ca62", "committedDate": "2020-06-30T20:13:14Z", "message": "Fix PhaseSpecification\n\nFix JSON serialization and deserialization for subclasses of\nPhaseSpecification. It is unnecessay to make ExecutionStrategy\na field or JSON field. Instead, ExecutionStrategy is static for\nany subclasses of PhaseExecution.\n\nAlso,\n- Fix equals() and hashCode()\n- Move ExecutionStrategy to top-level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60147d757fcd77c839e15a1ed2d221f31fa2d560", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/60147d757fcd77c839e15a1ed2d221f31fa2d560", "committedDate": "2020-06-30T20:13:14Z", "message": "Refactor BenchmarkSuite\n\nRemove BenchmarkSuiteInfo and move all its fields into BenchmarkSuite.\nUse a builder object of BenchmarkSuite to hold the intermediate\nsuite information fetched from MySQL."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6df620b9ee8295481f67feaab921d42eabffed9d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6df620b9ee8295481f67feaab921d42eabffed9d", "committedDate": "2020-06-30T20:04:11Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "a1b8e30a517be92d9ae46fae47d1d8ebe1967e27", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a1b8e30a517be92d9ae46fae47d1d8ebe1967e27", "committedDate": "2020-06-30T20:13:15Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03be023c0896264fd9946632244f4f74d1cd8fae", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/03be023c0896264fd9946632244f4f74d1cd8fae", "committedDate": "2020-06-30T20:45:53Z", "message": "Allow session properties to be specified with queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29a508bad61b888fb5abc7b030f051b691ce261a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/29a508bad61b888fb5abc7b030f051b691ce261a", "committedDate": "2020-06-30T20:45:53Z", "message": "Refactor PhaseExecutor\n\n- Re-define interface PhaseExecutor so that a PhaseExecutor is a\n  stateless object and is reused across phases.\n- Move BenchmarQueryRunner into AbstractPhaseExecutor.\n- Shutdown executor in a single place.\n- Post events in single places.\n- Move all classes in executor package to framework package."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cf42b06ec8402b069488f46ddd3e44fba38607a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1cf42b06ec8402b069488f46ddd3e44fba38607a", "committedDate": "2020-06-30T20:46:44Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1b8e30a517be92d9ae46fae47d1d8ebe1967e27", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a1b8e30a517be92d9ae46fae47d1d8ebe1967e27", "committedDate": "2020-06-30T20:13:15Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}, "afterCommit": {"oid": "1cf42b06ec8402b069488f46ddd3e44fba38607a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1cf42b06ec8402b069488f46ddd3e44fba38607a", "committedDate": "2020-06-30T20:46:44Z", "message": "Make maxConcurrency optional in ConcurrentExecutionPhase\n\nAllow max concurrency for concurrent phases to be specified\nthrough config.\n\n- Use the max concurrency from config if specified.\n- Else, use the max concurrency specified in phase specification.\n- Else, use the default max concurrency 70."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzg1NTI5", "url": "https://github.com/prestodb/presto/pull/14670#pullrequestreview-440385529", "createdAt": "2020-06-30T21:06:10Z", "commit": {"oid": "1cf42b06ec8402b069488f46ddd3e44fba38607a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MTUwMDA0", "url": "https://github.com/prestodb/presto/pull/14670#pullrequestreview-445150004", "createdAt": "2020-07-08T21:43:25Z", "commit": {"oid": "29a508bad61b888fb5abc7b030f051b691ce261a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMTo0MzoyNVrOGu6QWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMTo0MzoyNVrOGu6QWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg0MjEzOA==", "bodyText": "So basically BenchmarkRunner will have as many executors are there are execution strategies?", "url": "https://github.com/prestodb/presto/pull/14670#discussion_r451842138", "createdAt": "2020-07-08T21:43:25Z", "author": {"login": "rongrong"}, "path": "presto-benchmark-runner/src/main/java/com/facebook/presto/benchmark/framework/BenchmarkRunner.java", "diffHunk": "@@ -16,72 +16,78 @@\n import com.facebook.airlift.event.client.EventClient;\n import com.facebook.presto.benchmark.event.BenchmarkPhaseEvent;\n import com.facebook.presto.benchmark.event.BenchmarkSuiteEvent;\n-import com.facebook.presto.benchmark.executor.PhaseExecutor;\n-import com.facebook.presto.benchmark.executor.PhaseExecutorFactory;\n import com.facebook.presto.benchmark.source.BenchmarkSuiteSupplier;\n import com.google.common.collect.ImmutableSet;\n import com.google.inject.Inject;\n \n import javax.annotation.PostConstruct;\n \n-import java.util.List;\n import java.util.Set;\n \n import static com.facebook.presto.benchmark.event.BenchmarkPhaseEvent.Status.FAILED;\n import static com.facebook.presto.benchmark.event.BenchmarkPhaseEvent.Status.SUCCEEDED;\n+import static com.facebook.presto.benchmark.framework.ExecutionStrategy.CONCURRENT;\n+import static java.lang.String.format;\n import static java.util.Objects.requireNonNull;\n \n public class BenchmarkRunner\n {\n     private final BenchmarkSuiteSupplier benchmarkSuiteSupplier;\n-    private final PhaseExecutorFactory phaseExecutorFactory;\n+    private final ConcurrentPhaseExecutor concurrentPhaseExecutor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29a508bad61b888fb5abc7b030f051b691ce261a"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1401, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}