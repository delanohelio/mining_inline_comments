{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NDc2ODU5", "number": 14255, "title": "Relax length limit of parameter type list and return type", "bodyText": "Relax the length of the parameter type list and the return type of\na CREATE FUNCTION statement to 30k to support functions with\ncomplex row types as the input parameters and the return value.\nTo support this:\n\nfunction_id may have a length over 30k characters, and must be\nstored as text, and can no longer be part of an index. Instead,\nstore its hash value in the MySQL table as well and use the hash\nin the index.\nparameter is the JSON representation of the input parameters, which may\nhave a length over 2^16, and must be stored as mediumtext.\nreturn_type may have a length over 30k characters, and must be\nstored as text.\n\n== RELEASE NOTES ==\n\nGeneral Changes\n* Improve ``CREATE FUNCTION`` to allow parameter type list and return type to have a length\n  up to 30k characters.", "createdAt": "2020-03-16T20:24:11Z", "url": "https://github.com/prestodb/presto/pull/14255", "merged": true, "mergeCommit": {"oid": "4c4307526af2185a8b494d29d59f654d48d51773"}, "closed": true, "closedAt": "2020-04-08T07:34:30Z", "author": {"login": "caithagoras"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOVbyngBqjMxMzUxMDMzMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVhdYVgBqjMyMTI2MzAwNzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "673fbe67fe088ec2a434e92e72c536976ccf5fb3", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/673fbe67fe088ec2a434e92e72c536976ccf5fb3", "committedDate": "2020-03-16T21:58:34Z", "message": "Sanitize SQL function table schemas"}, "afterCommit": {"oid": "584b2390ed8a496881256b3fd9ef2c5f21df4b22", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/584b2390ed8a496881256b3fd9ef2c5f21df4b22", "committedDate": "2020-03-16T21:59:10Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "584b2390ed8a496881256b3fd9ef2c5f21df4b22", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/584b2390ed8a496881256b3fd9ef2c5f21df4b22", "committedDate": "2020-03-16T21:59:10Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "134a08d88b3974bc58ab73e45b4dadcbb26436e4", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/134a08d88b3974bc58ab73e45b4dadcbb26436e4", "committedDate": "2020-03-16T22:01:31Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "134a08d88b3974bc58ab73e45b4dadcbb26436e4", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/134a08d88b3974bc58ab73e45b4dadcbb26436e4", "committedDate": "2020-03-16T22:01:31Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "c0d5348d816c185b4eb7646f1256a41ac2af5497", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c0d5348d816c185b4eb7646f1256a41ac2af5497", "committedDate": "2020-03-16T22:05:57Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjM5NTk2", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-375639596", "createdAt": "2020-03-16T23:01:27Z", "commit": {"oid": "38f6b5f5190c7805138fe4e8ea2db4092a1af6e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzowMToyN1rOF3Ik7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzowMToyN1rOF3Ik7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1NjUyNA==", "bodyText": "text are stored in separate pages form the table so moving this to text effectively adds an additional page load to each row. Overall text type is very inefficient. I think this is an overkill as a solution to support large parameters. Most of the functions would have a small parameter list. I suggest to use encoding rather than just dump everything blindly into a blob.", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r393356524", "createdAt": "2020-03-16T23:01:27Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/FunctionNamespaceDao.java", "diffHunk": "@@ -51,13 +51,14 @@\n \n     @SqlUpdate(\"CREATE TABLE IF NOT EXISTS <sql_functions_table> (\\n\" +\n             \"  id bigint(20) NOT NULL AUTO_INCREMENT,\\n\" +\n-            \"  function_id varchar(700) NOT NULL,\\n\" +\n+            \"  function_id_hash varchar(128) NOT NULL,\\n\" +\n+            \"  function_id text NOT NULL,\\n\" +\n             \"  version bigint(20) unsigned NOT NULL,\\n\" +\n             \"  catalog_name varchar(128) NOT NULL,\\n\" +\n             \"  schema_name varchar(128) NOT NULL,\\n\" +\n             \"  function_name varchar(256) NOT NULL,\\n\" +\n-            \"  parameters varchar(40000) NOT NULL,\\n\" +\n-            \"  return_type varchar(256) NOT NULL,\\n\" +\n+            \"  parameters mediumtext NOT NULL,\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38f6b5f5190c7805138fe4e8ea2db4092a1af6e7"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjQwMDIx", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-375640021", "createdAt": "2020-03-16T23:02:36Z", "commit": {"oid": "38f6b5f5190c7805138fe4e8ea2db4092a1af6e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzowMjozNlrOF3In5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzowMjozNlrOF3In5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1NzI4NA==", "bodyText": "Since this is a hash, what if there's collision?", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r393357284", "createdAt": "2020-03-16T23:02:36Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/FunctionNamespaceDao.java", "diffHunk": "@@ -66,7 +67,7 @@\n             \"  create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\\n\" +\n             \"  update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\\n\" +\n             \"  PRIMARY KEY (id),\\n\" +\n-            \"  UNIQUE KEY function_id_version (function_id, version),\\n\" +\n+            \"  UNIQUE KEY function_id_hash_version (function_id_hash, version),\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38f6b5f5190c7805138fe4e8ea2db4092a1af6e7"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0d5348d816c185b4eb7646f1256a41ac2af5497", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c0d5348d816c185b4eb7646f1256a41ac2af5497", "committedDate": "2020-03-16T22:05:57Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "ea2e41904aad945184b3d13779f1e7f1e1ccd9a5", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ea2e41904aad945184b3d13779f1e7f1e1ccd9a5", "committedDate": "2020-03-16T23:35:22Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjU1MzI5", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-375655329", "createdAt": "2020-03-16T23:51:00Z", "commit": {"oid": "c0d5348d816c185b4eb7646f1256a41ac2af5497"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo1MToyOFrOF3JkiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo1MToyOFrOF3JkiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MjgwOQ==", "bodyText": "This is a potential security loophole. I can potentially modify other people's function if I manage to come up with a signature with the same hash right? There at least needs to be some verification that the function you get is the function you actually want to get?", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r393372809", "createdAt": "2020-03-16T23:51:28Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/MySqlFunctionNamespaceManager.java", "diffHunk": "@@ -149,7 +151,7 @@ public void createFunction(SqlInvokedFunction function, boolean replace)\n \n         jdbi.useTransaction(handle -> {\n             FunctionNamespaceDao transactionDao = handle.attach(FunctionNamespaceDao.class);\n-            Optional<SqlInvokedFunctionRecord> latestVersion = transactionDao.getLatestRecordForUpdate(function.getFunctionId());\n+            Optional<SqlInvokedFunctionRecord> latestVersion = transactionDao.getLatestRecordForUpdate(hash(function.getFunctionId()), function.getFunctionId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea2e41904aad945184b3d13779f1e7f1e1ccd9a5"}, "originalPosition": 53}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea2e41904aad945184b3d13779f1e7f1e1ccd9a5", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ea2e41904aad945184b3d13779f1e7f1e1ccd9a5", "committedDate": "2020-03-16T23:35:22Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "804638df7d5a2c959d4a2b58d85f0ab3233c829e", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/804638df7d5a2c959d4a2b58d85f0ab3233c829e", "committedDate": "2020-03-24T07:04:01Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "804638df7d5a2c959d4a2b58d85f0ab3233c829e", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/804638df7d5a2c959d4a2b58d85f0ab3233c829e", "committedDate": "2020-03-24T07:04:01Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "ed0b70bc1e4af588aa29546da65a70698c83432b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ed0b70bc1e4af588aa29546da65a70698c83432b", "committedDate": "2020-03-24T07:06:24Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzg3MjMw", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-380787230", "createdAt": "2020-03-25T00:28:37Z", "commit": {"oid": "ed0b70bc1e4af588aa29546da65a70698c83432b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDoyODozOFrOF7ICdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDoyODozOFrOF7ICdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU0MjAwNA==", "bodyText": "Why do we need this?", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r397542004", "createdAt": "2020-03-25T00:28:38Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/FunctionNamespaceDao.java", "diffHunk": "@@ -44,13 +44,15 @@\n public interface FunctionNamespaceDao\n {\n     @SqlUpdate(\"CREATE TABLE IF NOT EXISTS <function_namespaces_table> (\\n\" +\n+            \"   id int(11) unsigned NOT NULL AUTO_INCREMENT,\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed0b70bc1e4af588aa29546da65a70698c83432b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzg3NjU0", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-380787654", "createdAt": "2020-03-25T00:30:05Z", "commit": {"oid": "ed0b70bc1e4af588aa29546da65a70698c83432b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDozMDowNVrOF7IEFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDozMDowNVrOF7IEFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU0MjQyMQ==", "bodyText": "Why not require these to be NOT NULL?", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r397542421", "createdAt": "2020-03-25T00:30:05Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/FunctionNamespaceDao.java", "diffHunk": "@@ -64,8 +66,8 @@\n             \"  description text,\\n\" +\n             \"  deleted boolean NOT NULL DEFAULT false,\\n\" +\n             \"  delete_time TIMESTAMP NULL DEFAULT NULL,\\n\" +\n-            \"  create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\\n\" +\n-            \"  update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\\n\" +\n+            \"  create_time TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed0b70bc1e4af588aa29546da65a70698c83432b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzg5MDkz", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-380789093", "createdAt": "2020-03-25T00:34:59Z", "commit": {"oid": "8dfba0c0862912c2a1d836f2caeb60a285440d9b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDozNDo1OVrOF7IJfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDozNDo1OVrOF7IJfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU0MzgwNA==", "bodyText": "You can just use text rather than medium text if this is the upper limit?", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r397543804", "createdAt": "2020-03-25T00:34:59Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/MySqlFunctionNamespaceManager.java", "diffHunk": "@@ -57,8 +59,8 @@\n     private static final int MAX_CATALOG_NAME_LENGTH = 128;\n     private static final int MAX_SCHEMA_NAME_LENGTH = 128;\n     private static final int MAX_FUNCTION_NAME_LENGTH = 256;\n-    private static final int MAX_PARAMETER_TYPES_LENGTH = 500;\n-    private static final int MAX_RETURN_TYPE_LENGTH = 256;\n+    private static final int MAX_PARAMETER_TYPES_LENGTH = 20000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfba0c0862912c2a1d836f2caeb60a285440d9b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzkwMDkz", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-380790093", "createdAt": "2020-03-25T00:38:26Z", "commit": {"oid": "8dfba0c0862912c2a1d836f2caeb60a285440d9b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDozODoyNlrOF7INKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDozODoyNlrOF7INKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU0NDc0Ng==", "bodyText": "At this point i think if you store parameters as separate list of name and list of type you can remove function_id. This is just a waste of storage space. You can argue who cares about it it's not that much resource anyways. So I won't insist.", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r397544746", "createdAt": "2020-03-25T00:38:26Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/FunctionNamespaceDao.java", "diffHunk": "@@ -51,13 +51,14 @@\n \n     @SqlUpdate(\"CREATE TABLE IF NOT EXISTS <sql_functions_table> (\\n\" +\n             \"  id bigint(20) NOT NULL AUTO_INCREMENT,\\n\" +\n-            \"  function_id varchar(700) NOT NULL,\\n\" +\n+            \"  function_id_hash varchar(128) NOT NULL,\\n\" +\n+            \"  function_id text NOT NULL,\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfba0c0862912c2a1d836f2caeb60a285440d9b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzkwODQ0", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-380790844", "createdAt": "2020-03-25T00:41:10Z", "commit": {"oid": "ed0b70bc1e4af588aa29546da65a70698c83432b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed0b70bc1e4af588aa29546da65a70698c83432b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ed0b70bc1e4af588aa29546da65a70698c83432b", "committedDate": "2020-03-24T07:06:24Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "f5bcc414dae874b67b2f6bce49d55a1e7b538f2e", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/f5bcc414dae874b67b2f6bce49d55a1e7b538f2e", "committedDate": "2020-03-25T01:34:58Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5bcc414dae874b67b2f6bce49d55a1e7b538f2e", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/f5bcc414dae874b67b2f6bce49d55a1e7b538f2e", "committedDate": "2020-03-25T01:34:58Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "05ca509771c5eaff5c79d577a677f0f2828d877b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/05ca509771c5eaff5c79d577a677f0f2828d877b", "committedDate": "2020-04-06T23:35:02Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05ca509771c5eaff5c79d577a677f0f2828d877b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/05ca509771c5eaff5c79d577a677f0f2828d877b", "committedDate": "2020-04-06T23:35:02Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "08f782da8c431ead7edacf87fb41d03320c67bc8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/08f782da8c431ead7edacf87fb41d03320c67bc8", "committedDate": "2020-04-06T23:37:26Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08f782da8c431ead7edacf87fb41d03320c67bc8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/08f782da8c431ead7edacf87fb41d03320c67bc8", "committedDate": "2020-04-06T23:37:26Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "9de3e193455aeb7b2630d57ed1b703e99cd3fbe8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9de3e193455aeb7b2630d57ed1b703e99cd3fbe8", "committedDate": "2020-04-07T00:09:24Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9de3e193455aeb7b2630d57ed1b703e99cd3fbe8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9de3e193455aeb7b2630d57ed1b703e99cd3fbe8", "committedDate": "2020-04-07T00:09:24Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "a6f4c6dc994c019f23df2547dde2eda6db9e2257", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a6f4c6dc994c019f23df2547dde2eda6db9e2257", "committedDate": "2020-04-07T08:34:31Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDc3NTUx", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-389477551", "createdAt": "2020-04-07T20:46:45Z", "commit": {"oid": "a6f4c6dc994c019f23df2547dde2eda6db9e2257"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDo0Njo0NVrOGCVeAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDo0Njo0NVrOGCVeAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwMjA4MQ==", "bodyText": "Where did id go?", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r405102081", "createdAt": "2020-04-07T20:46:45Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/FunctionNamespaceDao.java", "diffHunk": "@@ -50,23 +50,23 @@\n     void createFunctionNamespacesTableIfNotExists();\n \n     @SqlUpdate(\"CREATE TABLE IF NOT EXISTS <sql_functions_table> (\\n\" +\n-            \"  id bigint(20) NOT NULL AUTO_INCREMENT,\\n\" +\n-            \"  function_id varchar(700) NOT NULL,\\n\" +\n+            \"  function_id_hash varchar(128) NOT NULL,\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6f4c6dc994c019f23df2547dde2eda6db9e2257"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDgzMDk1", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-389483095", "createdAt": "2020-04-07T20:55:07Z", "commit": {"oid": "a6f4c6dc994c019f23df2547dde2eda6db9e2257"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDo1NTowN1rOGCVwug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDo1NTowN1rOGCVwug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwNjg3NA==", "bodyText": "Do we have test for this? We probably should?", "url": "https://github.com/prestodb/presto/pull/14255#discussion_r405106874", "createdAt": "2020-04-07T20:55:07Z", "author": {"login": "rongrong"}, "path": "presto-function-namespace-managers/src/main/java/com/facebook/presto/functionNamespace/mysql/FunctionNamespaceDao.java", "diffHunk": "@@ -50,23 +50,23 @@\n     void createFunctionNamespacesTableIfNotExists();\n \n     @SqlUpdate(\"CREATE TABLE IF NOT EXISTS <sql_functions_table> (\\n\" +\n-            \"  id bigint(20) NOT NULL AUTO_INCREMENT,\\n\" +\n-            \"  function_id varchar(700) NOT NULL,\\n\" +\n+            \"  function_id_hash varchar(128) NOT NULL,\\n\" +\n+            \"  function_id text NOT NULL,\\n\" +\n             \"  version bigint(20) unsigned NOT NULL,\\n\" +\n             \"  catalog_name varchar(128) NOT NULL,\\n\" +\n             \"  schema_name varchar(128) NOT NULL,\\n\" +\n             \"  function_name varchar(256) NOT NULL,\\n\" +\n-            \"  parameters varchar(40000) NOT NULL,\\n\" +\n-            \"  return_type varchar(256) NOT NULL,\\n\" +\n+            \"  parameters text NOT NULL,\\n\" +\n+            \"  return_type text NOT NULL,\\n\" +\n             \"  routine_characteristics text NOT NULL,\\n\" +\n             \"  body mediumtext,\\n\" +\n             \"  description text,\\n\" +\n             \"  deleted boolean NOT NULL DEFAULT false,\\n\" +\n             \"  delete_time TIMESTAMP NULL DEFAULT NULL,\\n\" +\n-            \"  create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\\n\" +\n-            \"  update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\\n\" +\n+            \"  create_time TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,\\n\" +\n+            \"  update_time TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\\n\" +\n             \"  PRIMARY KEY (id),\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6f4c6dc994c019f23df2547dde2eda6db9e2257"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6f4c6dc994c019f23df2547dde2eda6db9e2257", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a6f4c6dc994c019f23df2547dde2eda6db9e2257", "committedDate": "2020-04-07T08:34:31Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "a402bd6b1f956acba119ab96270e1a84e50c5c67", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a402bd6b1f956acba119ab96270e1a84e50c5c67", "committedDate": "2020-04-07T22:29:18Z", "message": "Sanitize SQL function table schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a402bd6b1f956acba119ab96270e1a84e50c5c67", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a402bd6b1f956acba119ab96270e1a84e50c5c67", "committedDate": "2020-04-07T22:29:18Z", "message": "Sanitize SQL function table schema"}, "afterCommit": {"oid": "2817df976813348b3e28afc5e9987caca88786ea", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/2817df976813348b3e28afc5e9987caca88786ea", "committedDate": "2020-04-07T22:30:59Z", "message": "Make timesstamp columns nullable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2817df976813348b3e28afc5e9987caca88786ea", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/2817df976813348b3e28afc5e9987caca88786ea", "committedDate": "2020-04-07T22:30:59Z", "message": "Make timesstamp columns nullable"}, "afterCommit": {"oid": "26c898c13000c7681276b4cdb5c03b4dbb8d5a4c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/26c898c13000c7681276b4cdb5c03b4dbb8d5a4c", "committedDate": "2020-04-08T00:18:08Z", "message": "Make timestamp columns nullable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTc1NDM5", "url": "https://github.com/prestodb/presto/pull/14255#pullrequestreview-389575439", "createdAt": "2020-04-08T00:18:46Z", "commit": {"oid": "2817df976813348b3e28afc5e9987caca88786ea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad72b6d3b19f0ae7bc399e55b1bd7f106f0d8f7", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/2ad72b6d3b19f0ae7bc399e55b1bd7f106f0d8f7", "committedDate": "2020-04-08T05:57:13Z", "message": "Improve TestMySqlFunctionNamespaceManager\n\n- Update error message.\n- Update method names.\n- Add test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b9dc1002c9a6a2197da820f95d122d90831a74d", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/8b9dc1002c9a6a2197da820f95d122d90831a74d", "committedDate": "2020-04-08T05:57:13Z", "message": "Relax length limit of parameter type list and return type\n\nRelax the length of the parameter type list and the return type of\na CREATE FUNCTION statement to 30k to support functions with\ncomplex row types as the input parameters and the return value.\n\nTo support this:\n- function_id may have a length over 30k characters, and must be\n  stored as text, and can no longer be part of an index. Instead,\n  store its hash value in the MySQL table as well and use the hash\n  in the index.\n- return_type may have a length over 30k characters, and must be\n  stored as text.\n- Add limits for parameter count and parameter name lengths."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6250a153fc4a0dcbc5d1bfce23fa1c49347de38", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a6250a153fc4a0dcbc5d1bfce23fa1c49347de38", "committedDate": "2020-04-08T05:57:13Z", "message": "Make timestamp columns nullable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26c898c13000c7681276b4cdb5c03b4dbb8d5a4c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/26c898c13000c7681276b4cdb5c03b4dbb8d5a4c", "committedDate": "2020-04-08T00:18:08Z", "message": "Make timestamp columns nullable"}, "afterCommit": {"oid": "a6250a153fc4a0dcbc5d1bfce23fa1c49347de38", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a6250a153fc4a0dcbc5d1bfce23fa1c49347de38", "committedDate": "2020-04-08T05:57:13Z", "message": "Make timestamp columns nullable"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2062, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}