{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTk1NzY5", "number": 14475, "title": "FastutilSetHelper ObjectStrategy#equals result can be null.", "bodyText": "We're seeing some queries fail due to this verify check. The assumption here seems to be that SET_CONTAINS would be used only for non-complex types, but it reality can also be used for complex types - eg: the test case included in TestHivePushdownFilterQueries\n== NO RELEASE NOTE ==", "createdAt": "2020-05-04T21:30:14Z", "url": "https://github.com/prestodb/presto/pull/14475", "merged": true, "mergeCommit": {"oid": "e4fbf228981ab834f065a8d70ea6a98b0dffae1c"}, "closed": true, "closedAt": "2020-05-07T18:06:14Z", "author": {"login": "sujay-jain"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceHbj7gBqjMzMDE5OTkxMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce_lcuAFqTQwNzYyMzM4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9a80de69f93c106588120531ff9f3a7e55337bc", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/c9a80de69f93c106588120531ff9f3a7e55337bc", "committedDate": "2020-05-04T21:26:34Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}, "afterCommit": {"oid": "95aad6a8cb6eacb2e0eee6e5c7ff9292acd3ab89", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/95aad6a8cb6eacb2e0eee6e5c7ff9292acd3ab89", "committedDate": "2020-05-04T22:42:44Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDA1NDMz", "url": "https://github.com/prestodb/presto/pull/14475#pullrequestreview-405405433", "createdAt": "2020-05-04T23:01:59Z", "commit": {"oid": "95aad6a8cb6eacb2e0eee6e5c7ff9292acd3ab89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMzowMTo1OVrOGQVPSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMzowMTo1OVrOGQVPSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc3ODM3OQ==", "bodyText": "generate the ROW(1,%s)", "url": "https://github.com/prestodb/presto/pull/14475#discussion_r419778379", "createdAt": "2020-05-04T23:01:59Z", "author": {"login": "bhhari"}, "path": "presto-hive/src/test/java/com/facebook/presto/hive/TestHivePushdownFilterQueries.java", "diffHunk": "@@ -337,6 +337,17 @@ public void testFloats()\n         assertFilterProject(\"reals[1] > 0.01\", \"count(*)\");\n     }\n \n+    @Test\n+    public void testInComplexTypes()\n+    {\n+          String query = \"select * from (values('a'), (null)) as t (name) where ROW('1', name) IN ( ROW('1','2'), ROW('1','3'), \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95aad6a8cb6eacb2e0eee6e5c7ff9292acd3ab89"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95aad6a8cb6eacb2e0eee6e5c7ff9292acd3ab89", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/95aad6a8cb6eacb2e0eee6e5c7ff9292acd3ab89", "committedDate": "2020-05-04T22:42:44Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}, "afterCommit": {"oid": "a4a541df1a378f8c3c42e2bcec004963de937e66", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/a4a541df1a378f8c3c42e2bcec004963de937e66", "committedDate": "2020-05-05T00:19:00Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4a541df1a378f8c3c42e2bcec004963de937e66", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/a4a541df1a378f8c3c42e2bcec004963de937e66", "committedDate": "2020-05-05T00:19:00Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}, "afterCommit": {"oid": "5f72b87b3cbbeae1645ce553df3026d099ee42d5", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/5f72b87b3cbbeae1645ce553df3026d099ee42d5", "committedDate": "2020-05-05T16:06:57Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDI0Njg4", "url": "https://github.com/prestodb/presto/pull/14475#pullrequestreview-407024688", "createdAt": "2020-05-06T22:14:33Z", "commit": {"oid": "5f72b87b3cbbeae1645ce553df3026d099ee42d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDM1NDg3", "url": "https://github.com/prestodb/presto/pull/14475#pullrequestreview-407035487", "createdAt": "2020-05-06T22:39:21Z", "commit": {"oid": "5f72b87b3cbbeae1645ce553df3026d099ee42d5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjozOToyMlrOGRn6uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjozOToyMlrOGRn6uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzMjk4NQ==", "bodyText": "Please add this test case as well to make sure that correct answer (NULL) is returned.\n        StringBuilder query = new StringBuilder(\"select ROW(null_value) IN ( \");\n        for (int i = 0; i < 32; i++) {\n            query.append(String.format(\"ROW(%s), \", i));\n        }\n        query.append(\"ROW(32)) \");\n        query.append(\"FROM (values(null)) as t (null_value)\");\n        assertQuery(query.toString(), \"SELECT NULL\");\n\nThe ROW(NULL) IN (ROW(0), ...)  creates a collision required to get the equals path executed.\nAlso I would suggest moving this test to AbstractTestQueries, as there's nothing Hive specific about it.\nAlso please add a comment describing what kind of black magic are we doing here.", "url": "https://github.com/prestodb/presto/pull/14475#discussion_r421132985", "createdAt": "2020-05-06T22:39:22Z", "author": {"login": "arhimondr"}, "path": "presto-hive/src/test/java/com/facebook/presto/hive/TestHivePushdownFilterQueries.java", "diffHunk": "@@ -337,6 +337,19 @@ public void testFloats()\n         assertFilterProject(\"reals[1] > 0.01\", \"count(*)\");\n     }\n \n+    @Test\n+    public void testInComplexTypes()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f72b87b3cbbeae1645ce553df3026d099ee42d5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96322404ad428892ac025f73141d0b0c9d9634be", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/96322404ad428892ac025f73141d0b0c9d9634be", "committedDate": "2020-05-06T23:32:14Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f72b87b3cbbeae1645ce553df3026d099ee42d5", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/5f72b87b3cbbeae1645ce553df3026d099ee42d5", "committedDate": "2020-05-05T16:06:57Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}, "afterCommit": {"oid": "96322404ad428892ac025f73141d0b0c9d9634be", "author": {"user": {"login": "sujay-jain", "name": null}}, "url": "https://github.com/prestodb/presto/commit/96322404ad428892ac025f73141d0b0c9d9634be", "committedDate": "2020-05-06T23:32:14Z", "message": "FastutilSetHelper ObjectStrategy equals result can be null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjIzMzg0", "url": "https://github.com/prestodb/presto/pull/14475#pullrequestreview-407623384", "createdAt": "2020-05-07T16:08:44Z", "commit": {"oid": "96322404ad428892ac025f73141d0b0c9d9634be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1562, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}