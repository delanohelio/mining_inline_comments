{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyOTQxNjQ1", "number": 15077, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjowNjowMVrOEfybCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjoxMzo0MFrOEfyg0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNzY3NDM1OnYy", "diffSide": "RIGHT", "path": "presto-hive/src/test/java/com/facebook/presto/hive/TestHiveDistributedJoinQueriesWithDynamicFilteringAndAria.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjowNjowMVrOHMSkJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjowNjowMVrOHMSkJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0OTEyNA==", "bodyText": "TestHiveDistributedJoinQueriesWithDynamicFilteringAndFilterPushdown", "url": "https://github.com/prestodb/presto/pull/15077#discussion_r482649124", "createdAt": "2020-09-03T02:06:01Z", "author": {"login": "highker"}, "path": "presto-hive/src/test/java/com/facebook/presto/hive/TestHiveDistributedJoinQueriesWithDynamicFilteringAndAria.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.hive;\n+\n+import com.facebook.presto.Session;\n+import com.facebook.presto.tests.AbstractTestJoinQueries;\n+\n+import static com.facebook.presto.SystemSessionProperties.ENABLE_DYNAMIC_FILTERING;\n+import static com.facebook.presto.SystemSessionProperties.JOIN_DISTRIBUTION_TYPE;\n+import static com.facebook.presto.SystemSessionProperties.PUSHDOWN_SUBFIELDS_ENABLED;\n+import static com.facebook.presto.hive.HiveQueryRunner.HIVE_CATALOG;\n+import static com.facebook.presto.hive.HiveQueryRunner.createQueryRunner;\n+import static com.facebook.presto.hive.HiveSessionProperties.PUSHDOWN_FILTER_ENABLED;\n+import static com.facebook.presto.sql.analyzer.FeaturesConfig.JoinDistributionType.BROADCAST;\n+import static io.airlift.tpch.TpchTable.getTables;\n+\n+public class TestHiveDistributedJoinQueriesWithDynamicFilteringAndAria", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f432106386727ebeb6107396109c1fd2ce95c74"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNzY3NDkzOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/sanity/DynamicFiltersChecker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjowNjoyNVrOHMSkiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjowNjoyNVrOHMSkiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY0OTIyNw==", "bodyText": "one param per line", "url": "https://github.com/prestodb/presto/pull/15077#discussion_r482649227", "createdAt": "2020-09-03T02:06:25Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/sanity/DynamicFiltersChecker.java", "diffHunk": "@@ -97,7 +97,8 @@ public void validate(PlanNode plan, Session session, Metadata metadata, SqlParse\n                 Set<String> currentJoinDynamicFilters = node.getDynamicFilters().keySet();\n                 Set<String> consumedProbeSide = node.getProbe().accept(this, context);\n                 Set<String> unconsumedByProbeSide = difference(currentJoinDynamicFilters, consumedProbeSide);\n-                verify(unconsumedByProbeSide.isEmpty(), \"Dynamic filters %s present in join were not fully consumed by its probe side.\", unconsumedByProbeSide);\n+                verify(unconsumedByProbeSide.isEmpty(), \"Dynamic filters %s present in join were not fully consumed by its probe side,\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f432106386727ebeb6107396109c1fd2ce95c74"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNzY4MjkzOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/rule/HiveFilterPushdown.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjoxMDo0MlrOHMSpJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjoxMDo0MlrOHMSpJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY1MDQwNQ==", "bodyText": "break a line after this.", "url": "https://github.com/prestodb/presto/pull/15077#discussion_r482650405", "createdAt": "2020-09-03T02:10:42Z", "author": {"login": "highker"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/rule/HiveFilterPushdown.java", "diffHunk": "@@ -248,6 +250,12 @@ public static ConnectorPushdownFilterResult pushdownFilter(\n                 .collect(toImmutableMap(HiveColumnHandle::getName, Functions.identity()));\n \n         SchemaTableName tableName = ((HiveTableHandle) tableHandle).getSchemaTableName();\n+\n+        LogicalRowExpressions logicalRowExpressions = new LogicalRowExpressions(rowExpressionService.getDeterminismEvaluator(), functionResolution, functionMetadataManager);\n+        RowExpression remainingExpression = decomposedFilter.getRemainingExpression();\n+        DynamicFilters.DynamicFilterExtractRowExpression dynamicFilterExtractRowExpression = extractDynamicFiltersRowExpression(remainingExpression);\n+        RowExpression dynamicFilterExpression = logicalRowExpressions.combineConjuncts(dynamicFilterExtractRowExpression.getDynamicConjuncts());\n+        remainingExpression = logicalRowExpressions.combineConjuncts(dynamicFilterExtractRowExpression.getStaticConjuncts());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f432106386727ebeb6107396109c1fd2ce95c74"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNzY4ODgxOnYy", "diffSide": "RIGHT", "path": "presto-expressions/src/main/java/com/facebook/presto/expressions/DynamicFilters.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjoxMzozMlrOHMSsZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjoxMzozMlrOHMSsZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY1MTIzNg==", "bodyText": "Let's just do two interfaces:\n\nRowExpression extractDynamicConjuncts(RowExpression expression) and\nRowExpression extractStaticConjuncts(RowExpression expression)", "url": "https://github.com/prestodb/presto/pull/15077#discussion_r482651236", "createdAt": "2020-09-03T02:13:32Z", "author": {"login": "highker"}, "path": "presto-expressions/src/main/java/com/facebook/presto/expressions/DynamicFilters.java", "diffHunk": "@@ -60,6 +60,26 @@ public static DynamicFilterExtractResult extractDynamicFilters(RowExpression exp\n         return new DynamicFilterExtractResult(staticConjuncts.build(), dynamicConjuncts.build());\n     }\n \n+    public static DynamicFilterExtractRowExpression extractDynamicFiltersRowExpression(RowExpression expression)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f432106386727ebeb6107396109c1fd2ce95c74"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNzY4OTE0OnYy", "diffSide": "RIGHT", "path": "presto-expressions/src/main/java/com/facebook/presto/expressions/DynamicFilters.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjoxMzo0MFrOHMSslA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMjoxMzo0MFrOHMSslA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY1MTI4NA==", "bodyText": "remove this", "url": "https://github.com/prestodb/presto/pull/15077#discussion_r482651284", "createdAt": "2020-09-03T02:13:40Z", "author": {"login": "highker"}, "path": "presto-expressions/src/main/java/com/facebook/presto/expressions/DynamicFilters.java", "diffHunk": "@@ -110,6 +130,28 @@ public DynamicFilterExtractResult(List<RowExpression> staticConjuncts, List<Dyna\n         }\n     }\n \n+    public static class DynamicFilterExtractRowExpression", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f432106386727ebeb6107396109c1fd2ce95c74"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3570, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}