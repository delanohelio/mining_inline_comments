{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNDQzNjAw", "number": 14641, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNTowODowOVrOEGMeRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNzoyNjozMFrOEIddlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0OTMxMjcxOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/Query.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNTowODowOVrOGk1yFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjo1NzowOVrOGlOtLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4MzA5NQ==", "bodyText": "how about getTargetResultSize(session).ifPresent( targetResultSize ->  uri.queryParam(\"targetResultSize\", targetResultSize)) ?", "url": "https://github.com/prestodb/presto/pull/14641#discussion_r441283095", "createdAt": "2020-06-17T05:08:09Z", "author": {"login": "cemcayiroglu"}, "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/Query.java", "diffHunk": "@@ -507,14 +509,18 @@ private synchronized void setQueryOutputInfo(QueryExecution.QueryOutputInfo outp\n \n     private synchronized URI createNextResultsUri(String scheme, UriInfo uriInfo, long nextToken)\n     {\n-        return uriInfo.getBaseUriBuilder()\n+        UriBuilder uri = uriInfo.getBaseUriBuilder()\n                 .scheme(scheme)\n                 .replacePath(\"/v1/statement/executing\")\n                 .path(queryId.toString())\n                 .path(String.valueOf(nextToken))\n                 .replaceQuery(\"\")\n-                .queryParam(\"slug\", slug)\n-                .build();\n+                .queryParam(\"slug\", this.slug);\n+        Optional<DataSize> targetResultSize = getTargetResultSize(session);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec5a4f705ae64f47732dd87e611c01caeece40d"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY5MTQzOA==", "bodyText": "It's a small point, but I didn't want the detail of whether or not the builder returns a copy to change the behavior.", "url": "https://github.com/prestodb/presto/pull/14641#discussion_r441691438", "createdAt": "2020-06-17T16:57:09Z", "author": {"login": "tdcmeehan"}, "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/Query.java", "diffHunk": "@@ -507,14 +509,18 @@ private synchronized void setQueryOutputInfo(QueryExecution.QueryOutputInfo outp\n \n     private synchronized URI createNextResultsUri(String scheme, UriInfo uriInfo, long nextToken)\n     {\n-        return uriInfo.getBaseUriBuilder()\n+        UriBuilder uri = uriInfo.getBaseUriBuilder()\n                 .scheme(scheme)\n                 .replacePath(\"/v1/statement/executing\")\n                 .path(queryId.toString())\n                 .path(String.valueOf(nextToken))\n                 .replaceQuery(\"\")\n-                .queryParam(\"slug\", slug)\n-                .build();\n+                .queryParam(\"slug\", this.slug);\n+        Optional<DataSize> targetResultSize = getTargetResultSize(session);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4MzA5NQ=="}, "originalCommit": {"oid": "9ec5a4f705ae64f47732dd87e611c01caeece40d"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MzA2NzcyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/Query.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNzoyNjozMFrOGob_gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNzozMDozM1rOGocIfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA1NDg1MA==", "bodyText": "How this param is going to be used?", "url": "https://github.com/prestodb/presto/pull/14641#discussion_r445054850", "createdAt": "2020-06-24T17:26:30Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/Query.java", "diffHunk": "@@ -507,14 +509,18 @@ private synchronized void setQueryOutputInfo(QueryExecution.QueryOutputInfo outp\n \n     private synchronized URI createNextResultsUri(String scheme, UriInfo uriInfo, long nextToken)\n     {\n-        return uriInfo.getBaseUriBuilder()\n+        UriBuilder uri = uriInfo.getBaseUriBuilder()\n                 .scheme(scheme)\n                 .replacePath(\"/v1/statement/executing\")\n                 .path(queryId.toString())\n                 .path(String.valueOf(nextToken))\n                 .replaceQuery(\"\")\n-                .queryParam(\"slug\", slug)\n-                .build();\n+                .queryParam(\"slug\", this.slug);\n+        Optional<DataSize> targetResultSize = getTargetResultSize(session);\n+        if (targetResultSize.isPresent()) {\n+            uri = uri.queryParam(\"targetResultSize\", targetResultSize.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec5a4f705ae64f47732dd87e611c01caeece40d"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA1NzE1MQ==", "bodyText": "It's used here: https://github.com/prestodb/presto/blob/master/presto-main/src/main/java/com/facebook/presto/server/protocol/ExecutingStatementResource.java#L152\nThis will change the batch size to be streamed back from the coordinator to the client.\nThis change could have been made differently.  We could have chosen to not add this as a query parameter, and instead use it directly inside the coordinator (without parsing it from the URI).  The intent is to set a default from the coordinator to be sent back to the client.  Because there's already a query parameter for this in ExecutingStatementResource, it seemed natural to simply add it to the nextUri.", "url": "https://github.com/prestodb/presto/pull/14641#discussion_r445057151", "createdAt": "2020-06-24T17:30:33Z", "author": {"login": "tdcmeehan"}, "path": "presto-main/src/main/java/com/facebook/presto/server/protocol/Query.java", "diffHunk": "@@ -507,14 +509,18 @@ private synchronized void setQueryOutputInfo(QueryExecution.QueryOutputInfo outp\n \n     private synchronized URI createNextResultsUri(String scheme, UriInfo uriInfo, long nextToken)\n     {\n-        return uriInfo.getBaseUriBuilder()\n+        UriBuilder uri = uriInfo.getBaseUriBuilder()\n                 .scheme(scheme)\n                 .replacePath(\"/v1/statement/executing\")\n                 .path(queryId.toString())\n                 .path(String.valueOf(nextToken))\n                 .replaceQuery(\"\")\n-                .queryParam(\"slug\", slug)\n-                .build();\n+                .queryParam(\"slug\", this.slug);\n+        Optional<DataSize> targetResultSize = getTargetResultSize(session);\n+        if (targetResultSize.isPresent()) {\n+            uri = uri.queryParam(\"targetResultSize\", targetResultSize.get());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA1NDg1MA=="}, "originalCommit": {"oid": "9ec5a4f705ae64f47732dd87e611c01caeece40d"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2433, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}