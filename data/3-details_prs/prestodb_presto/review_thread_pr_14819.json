{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MDYwNTQx", "number": 14819, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDowMTo0MVrOENCX8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDowMTo0MVrOENCX8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTA1ODQxOnYy", "diffSide": "RIGHT", "path": "presto-hive/src/main/java/com/facebook/presto/hive/AbstractDwrfEncryptionInformationSource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDowMTo0MVrOGvf2uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDoyNjo0M1rOGvgmcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ1ODE2OA==", "bodyText": "why would requested columns be absent?", "url": "https://github.com/prestodb/presto/pull/14819#discussion_r452458168", "createdAt": "2020-07-09T20:01:41Z", "author": {"login": "rschlussel"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/AbstractDwrfEncryptionInformationSource.java", "diffHunk": "@@ -106,7 +106,12 @@ protected abstract EncryptionInformation getWriteEncryptionInformationInternal(\n \n         Map<String, String> fieldToKeyReference;\n         if (encryptTable.isPresent()) {\n-            fieldToKeyReference = ImmutableMap.of(DwrfEncryptionMetadata.TABLE_IDENTIFIER, encryptTable.get());\n+            if (!requestedColumns.isPresent() || !requestedColumns.get().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff90f96db35520e2aa37975cfda939bbf2d85645"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3MDM4Nw==", "bodyText": "why would it be absent (requestedColumns.isPresent()) or the underlying set by empty (requestedColumns.get.isEmpty())?\nFor requestedColumns.isPresent() it is being populated by an optimizer and it is easy for a company to not have that optimizer in their list of optimizers and that is when this will be empty. The implication is that we will try to get the keys for all columns and hence the user needs to have access to everything in the table.\nFor requestedColumns.get().isEmpty()) - this happens when you have a query like SELECT partitionCol FROM tableorSELECT count(*) FROM table` where we are not selecting or filtering on a column.", "url": "https://github.com/prestodb/presto/pull/14819#discussion_r452470387", "createdAt": "2020-07-09T20:26:43Z", "author": {"login": "mayankgarg1990"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/AbstractDwrfEncryptionInformationSource.java", "diffHunk": "@@ -106,7 +106,12 @@ protected abstract EncryptionInformation getWriteEncryptionInformationInternal(\n \n         Map<String, String> fieldToKeyReference;\n         if (encryptTable.isPresent()) {\n-            fieldToKeyReference = ImmutableMap.of(DwrfEncryptionMetadata.TABLE_IDENTIFIER, encryptTable.get());\n+            if (!requestedColumns.isPresent() || !requestedColumns.get().isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ1ODE2OA=="}, "originalCommit": {"oid": "ff90f96db35520e2aa37975cfda939bbf2d85645"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2341, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}