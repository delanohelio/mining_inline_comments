{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MDE4NTk3", "number": 14594, "title": "Making Node Status Service Optional", "bodyText": "Making default NodeStatuService binding as optional. So if no binding is provided DiscoveryNodeService won't check for NodeStatus but if an implementation is provided for the NodeStatusService, nodes status is being checked using isActive method and filter out nodes which are up and connected to Discovery Service but are not in active state (i.e. in Maintenance mode but still up and running).\nReason: previous binding was not allowing it to be overridden with alternative implementation and it was always bind with AllowAllStatusService which leads to allow all hosts all the time.\n== RELEASE NOTES ==\n\nGeneral Changes\n* Optional NodeStatusService to check Nodes status (i.e. Available/In Maintenance) through some external source and mark them Inactive if not available to process queries.", "createdAt": "2020-06-01T14:34:58Z", "url": "https://github.com/prestodb/presto/pull/14594", "merged": true, "mergeCommit": {"oid": "3692a11a7bbab443dfe8d731ec1347a06d6d09b3"}, "closed": true, "closedAt": "2020-06-10T23:48:14Z", "author": {"login": "swapsmagic"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnHnP4AFqTQyMjIxMjQ0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqChmsgFqTQyODUwMTcxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjEyNDQy", "url": "https://github.com/prestodb/presto/pull/14594#pullrequestreview-422212442", "createdAt": "2020-06-01T22:01:19Z", "commit": {"oid": "f225123f0df76a37bffabda690588a97650b0fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMjowMToyMFrOGdblbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMjowMToyMFrOGdblbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzUxMzgzOA==", "bodyText": "can you clarify why do we need currentNode.getNodeIdentifier().compareTo(...)?", "url": "https://github.com/prestodb/presto/pull/14594#discussion_r433513838", "createdAt": "2020-06-01T22:01:20Z", "author": {"login": "mayankgarg1990"}, "path": "presto-main/src/main/java/com/facebook/presto/metadata/DiscoveryNodeManager.java", "diffHunk": "@@ -230,7 +230,7 @@ private synchronized void refreshNodesInternal()\n         // TODO: make it a whitelist (a failure-detecting service selector) and maybe build in support for injecting this in airlift\n         Set<ServiceDescriptor> services = serviceSelector.selectAllServices().stream()\n                 .filter(service -> !failureDetector.getFailed().contains(service))\n-                .filter(service -> nodeStatusService.isAllowed(service.getNodeId()))\n+                .filter(service -> !nodeStatusService.isPresent() || nodeStatusService.get().isAllowed(service.getNodeId()) || currentNode.getNodeIdentifier().compareTo(service.getNodeId()) == 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f225123f0df76a37bffabda690588a97650b0fd4"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjY2MTI1", "url": "https://github.com/prestodb/presto/pull/14594#pullrequestreview-422266125", "createdAt": "2020-06-02T00:29:14Z", "commit": {"oid": "f225123f0df76a37bffabda690588a97650b0fd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f225123f0df76a37bffabda690588a97650b0fd4", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/f225123f0df76a37bffabda690588a97650b0fd4", "committedDate": "2020-06-01T14:30:43Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}, "afterCommit": {"oid": "234899521db8b1cc7f4a9197880f56435e08cbe9", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/234899521db8b1cc7f4a9197880f56435e08cbe9", "committedDate": "2020-06-02T01:26:42Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "234899521db8b1cc7f4a9197880f56435e08cbe9", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/234899521db8b1cc7f4a9197880f56435e08cbe9", "committedDate": "2020-06-02T01:26:42Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}, "afterCommit": {"oid": "ec81ea2bdec0a86b7b1fea9c6122aa7834df4548", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/ec81ea2bdec0a86b7b1fea9c6122aa7834df4548", "committedDate": "2020-06-02T23:03:42Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec81ea2bdec0a86b7b1fea9c6122aa7834df4548", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/ec81ea2bdec0a86b7b1fea9c6122aa7834df4548", "committedDate": "2020-06-02T23:03:42Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}, "afterCommit": {"oid": "b93bcb4eacfcac43bd00e6900cdd1b3a276fe9fd", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/b93bcb4eacfcac43bd00e6900cdd1b3a276fe9fd", "committedDate": "2020-06-10T10:51:47Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef6a651b40022ff52d942f8d9fd329132df6ed93", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/ef6a651b40022ff52d942f8d9fd329132df6ed93", "committedDate": "2020-06-10T22:00:00Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b93bcb4eacfcac43bd00e6900cdd1b3a276fe9fd", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/b93bcb4eacfcac43bd00e6900cdd1b3a276fe9fd", "committedDate": "2020-06-10T10:51:47Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}, "afterCommit": {"oid": "ef6a651b40022ff52d942f8d9fd329132df6ed93", "author": {"user": {"login": "swapsmagic", "name": "Swapnil"}}, "url": "https://github.com/prestodb/presto/commit/ef6a651b40022ff52d942f8d9fd329132df6ed93", "committedDate": "2020-06-10T22:00:00Z", "message": "Making Node Status Service Optional\n\nAllowing Node Status service to optional. Specific implemenation can be injected using newOptionalBinder.setInstance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NTAxNzEy", "url": "https://github.com/prestodb/presto/pull/14594#pullrequestreview-428501712", "createdAt": "2020-06-10T23:47:25Z", "commit": {"oid": "ef6a651b40022ff52d942f8d9fd329132df6ed93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1730, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}