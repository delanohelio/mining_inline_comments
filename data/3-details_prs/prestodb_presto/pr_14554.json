{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5OTE3MTc4", "number": 14554, "title": "Add additional logging to resource group scheduler", "bodyText": "This is needed for an ongoing debugging where in we are seeing queries\ngetting stuck and not being moved from the queued state to the running\nstate\n== NO RELEASE NOTE ==", "createdAt": "2020-05-19T06:57:13Z", "url": "https://github.com/prestodb/presto/pull/14554", "merged": true, "mergeCommit": {"oid": "081de9638fb5db5f04151d03d7586187cea75a7f"}, "closed": true, "closedAt": "2020-05-20T21:35:10Z", "author": {"login": "mayankgarg1990"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci22oPgFqTQxNDYwODQyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjPOy1ABqjMzNTgyMjkzOTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjA4NDI2", "url": "https://github.com/prestodb/presto/pull/14554#pullrequestreview-414608426", "createdAt": "2020-05-19T16:14:03Z", "commit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjoxNDowM1rOGXoDZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjoxNDowM1rOGXoDZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQyNjY2MQ==", "bodyText": "Let's suppress this Exception per the docs: https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html#scheduleWithFixedDelay-java.lang.Runnable-long-long-java.util.concurrent.TimeUnit-\nLogging should be sufficient.", "url": "https://github.com/prestodb/presto/pull/14554#discussion_r427426661", "createdAt": "2020-05-19T16:14:03Z", "author": {"login": "tdcmeehan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/resourceGroups/InternalResourceGroupManager.java", "diffHunk": "@@ -191,7 +192,17 @@ public void destroy()\n     public void start()\n     {\n         if (started.compareAndSet(false, true)) {\n-            refreshExecutor.scheduleWithFixedDelay(this::refreshAndStartQueries, 1, 1, TimeUnit.MILLISECONDS);\n+            refreshExecutor.scheduleWithFixedDelay(() -> {\n+                try {\n+                    refreshAndStartQueries();\n+                }\n+                catch (Throwable t) {\n+                    log.error(t, \"Error while executing refreshAndStartQueries\");\n+                    throw t;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTc5ODAz", "url": "https://github.com/prestodb/presto/pull/14554#pullrequestreview-415579803", "createdAt": "2020-05-20T17:54:41Z", "commit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTg3NzIy", "url": "https://github.com/prestodb/presto/pull/14554#pullrequestreview-415587722", "createdAt": "2020-05-20T18:05:22Z", "commit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjY1MzE2", "url": "https://github.com/prestodb/presto/pull/14554#pullrequestreview-415665316", "createdAt": "2020-05-20T19:52:08Z", "commit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxOTo1MjowOFrOGYbfnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxOTo1MjoxNlrOGYbf3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI2OTQ2OA==", "bodyText": "nit: static import currentTimeMillis", "url": "https://github.com/prestodb/presto/pull/14554#discussion_r428269468", "createdAt": "2020-05-20T19:52:08Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/resourceGroups/InternalResourceGroupManager.java", "diffHunk": "@@ -283,6 +294,12 @@ public int getQueriesQueuedOnInternal()\n         return queriesQueuedInternal;\n     }\n \n+    @Managed\n+    public long getLastSchedulingCycleRuntimeDelayMs()\n+    {\n+        return System.currentTimeMillis() - lastSchedulingCycleRunTimeMs.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI2OTUzNQ==", "bodyText": "nit: static import MILLISECONDS", "url": "https://github.com/prestodb/presto/pull/14554#discussion_r428269535", "createdAt": "2020-05-20T19:52:16Z", "author": {"login": "caithagoras"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/resourceGroups/InternalResourceGroupManager.java", "diffHunk": "@@ -191,7 +192,17 @@ public void destroy()\n     public void start()\n     {\n         if (started.compareAndSet(false, true)) {\n-            refreshExecutor.scheduleWithFixedDelay(this::refreshAndStartQueries, 1, 1, TimeUnit.MILLISECONDS);\n+            refreshExecutor.scheduleWithFixedDelay(() -> {\n+                try {\n+                    refreshAndStartQueries();\n+                }\n+                catch (Throwable t) {\n+                    log.error(t, \"Error while executing refreshAndStartQueries\");\n+                    throw t;\n+                }\n+\n+                lastSchedulingCycleRunTimeMs.getAndSet(System.currentTimeMillis());\n+            }, 1, 1, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1Njg4OTA5", "url": "https://github.com/prestodb/presto/pull/14554#pullrequestreview-415688909", "createdAt": "2020-05-20T20:27:13Z", "commit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjkyMjk2", "url": "https://github.com/prestodb/presto/pull/14554#pullrequestreview-415692296", "createdAt": "2020-05-20T20:32:26Z", "commit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09d715e63f5cbf66b77a6a712f6b1821d2541ade", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/09d715e63f5cbf66b77a6a712f6b1821d2541ade", "committedDate": "2020-05-20T20:37:22Z", "message": "Add additional logging to resource group scheduler\n\nThis is needed for an ongoing debugging where in we are seeing queries\ngetting stuck and not being moved from the queued state to the running\nstate"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "959c047d1cb9c946b48f8d20086c1649e828f7af", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/959c047d1cb9c946b48f8d20086c1649e828f7af", "committedDate": "2020-05-19T06:43:56Z", "message": "Add additional logging to resource group scheduler\n\nThis is needed for an ongoing debugging where in we are seeing queries\ngetting stuck and not being moved from the queued state to the running\nstate"}, "afterCommit": {"oid": "09d715e63f5cbf66b77a6a712f6b1821d2541ade", "author": {"user": {"login": "mayankgarg1990", "name": null}}, "url": "https://github.com/prestodb/presto/commit/09d715e63f5cbf66b77a6a712f6b1821d2541ade", "committedDate": "2020-05-20T20:37:22Z", "message": "Add additional logging to resource group scheduler\n\nThis is needed for an ongoing debugging where in we are seeing queries\ngetting stuck and not being moved from the queued state to the running\nstate"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1679, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}