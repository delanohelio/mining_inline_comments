{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzODAzODA2", "number": 14209, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMToyMVrODlNQTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTozNDowNFrODl6kaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzQxMDY4OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMToyMVrOFx-ENg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMToyMVrOFx-ENg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0MTQzMA==", "bodyText": "remove this empty line", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387941430", "createdAt": "2020-03-04T21:21:21Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -70,6 +70,8 @@\n     private final int maxPendingSplitsPerTask;\n     private final int maxTasksPerStage;\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzQxMTYzOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMTo0MVrOFx-ExQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMTo0MVrOFx-ExQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0MTU3Mw==", "bodyText": "move this below nodeManager", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387941573", "createdAt": "2020-03-04T21:21:41Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -70,6 +70,8 @@\n     private final int maxPendingSplitsPerTask;\n     private final int maxTasksPerStage;\n \n+    private final NodeSelectionStats nodeSelectionStats;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzQxMjA5OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMTo0OFrOFx-FBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMTo0OFrOFx-FBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0MTYzOQ==", "bodyText": "move this below nodeManager", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387941639", "createdAt": "2020-03-04T21:21:48Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -78,7 +80,8 @@ public SimpleNodeSelector(\n             int minCandidates,\n             int maxSplitsPerNode,\n             int maxPendingSplitsPerTask,\n-            int maxTasksPerStage)\n+            int maxTasksPerStage,\n+            NodeSelectionStats nodeSelectionStats)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzQxMjQ4OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMTo1N1rOFx-FRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMTo1N1rOFx-FRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0MTcwMw==", "bodyText": "same", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387941703", "createdAt": "2020-03-04T21:21:57Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -88,6 +91,7 @@ public SimpleNodeSelector(\n         this.maxSplitsPerNode = maxSplitsPerNode;\n         this.maxPendingSplitsPerTask = maxPendingSplitsPerTask;\n         this.maxTasksPerStage = maxTasksPerStage;\n+        this.nodeSelectionStats = requireNonNull(nodeSelectionStats, \"NodeSelectionStats is null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzQxNjA4OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/NodeScheduler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMzowM1rOFx-Hdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyMzowM1rOFx-Hdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0MjI2Mw==", "bodyText": "same", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387942263", "createdAt": "2020-03-04T21:23:03Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/NodeScheduler.java", "diffHunk": "@@ -74,11 +75,12 @@\n     private final NodeTaskMap nodeTaskMap;\n     private final boolean useNetworkTopology;\n     private final Duration nodeMapRefreshInterval;\n+    private final NodeSelectionStats nodeSelectionStats;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzQzMDQ3OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/NodeSelectionStats.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyNzo0OFrOFx-Qbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMjowMzo1NFrOFx_USg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0NDU1OA==", "bodyText": "We shall give better names to these stats: (I'm not an expert on naming; maybe @shixuan-fan can give suggestions)\nprimaryPreferredNodeSelectedCount\nsecondaryPreferredNodeSelectedCount\nnonPreferredNodeSelectedCount", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387944558", "createdAt": "2020-03-04T21:27:48Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/NodeSelectionStats.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.execution.scheduler.nodeSelection;\n+\n+import org.weakref.jmx.Managed;\n+\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+@ThreadSafe\n+public class NodeSelectionStats\n+{\n+    private final AtomicLong primaryHit = new AtomicLong();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk2MTkzMA==", "bodyText": "@highker I'm even less of an expert on naming than you :D Your suggestions look good to me.", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387961930", "createdAt": "2020-03-04T22:03:54Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/NodeSelectionStats.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.execution.scheduler.nodeSelection;\n+\n+import org.weakref.jmx.Managed;\n+\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+@ThreadSafe\n+public class NodeSelectionStats\n+{\n+    private final AtomicLong primaryHit = new AtomicLong();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0NDU1OA=="}, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMzQzMzU0OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/NodeSelectionStats.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMToyODo1N1rOFx-SYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMjozNToxNVrOFyAK0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0NTA1OQ==", "bodyText": "This class indicates hard assumption on \"we only have 2 preferred nodes and all other selections are random\". I'm ok with this for now. @shixuan-fan, do you have better suggestions?", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387945059", "createdAt": "2020-03-04T21:28:57Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/NodeSelectionStats.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.execution.scheduler.nodeSelection;\n+\n+import org.weakref.jmx.Managed;\n+\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+@ThreadSafe\n+public class NodeSelectionStats", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk2NjMxMQ==", "bodyText": "I share the similar concern and it does not seem to fit the angle from engine's perspective, as 2 preferred nodes are something very hive-specific.\nIf weakref could generate different stats for elements in a list, that's great, but I highly doubt that is possible.\nThe other way is we only take primary, non primary, and random (seems to be the easiest fix).\nOne final random thought is: since 2 preferred nodes are hive-specific, I'm curious if this is something that could be done in connector. For example, engine passed the decision back to connector, and let the connector collect the stats? But this is a bit weird because node selection is done in the engine.\nI personally think the most feasible one is to change secondary to non-primary.", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387966311", "createdAt": "2020-03-04T22:13:02Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/NodeSelectionStats.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.execution.scheduler.nodeSelection;\n+\n+import org.weakref.jmx.Managed;\n+\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+@ThreadSafe\n+public class NodeSelectionStats", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0NTA1OQ=="}, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk3NTg5MQ==", "bodyText": "Agree. Let's change secondary to non-primary", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r387975891", "createdAt": "2020-03-04T22:35:15Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/NodeSelectionStats.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.execution.scheduler.nodeSelection;\n+\n+import org.weakref.jmx.Managed;\n+\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+@ThreadSafe\n+public class NodeSelectionStats", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk0NTA1OQ=="}, "originalCommit": {"oid": "bcb9d30d85ae7e86348108090eef0ca53e98fadc"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDU4Njk1OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxODowODowOVrOFzCUyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTozNToxOVrOFzE1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1OTc4Ng==", "bodyText": "I'm not entirely sure if we should keep it static and pass stats in, or remove static. @highker: Any suggestion?", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r389059786", "createdAt": "2020-03-06T18:08:09Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -196,7 +199,7 @@ public SplitPlacementResult computeAssignments(Set<Split> splits, List<RemoteTas\n         return selectDistributionNodes(nodeMap.get().get(), nodeTaskMap, maxSplitsPerNode, maxPendingSplitsPerTask, splits, existingTasks, bucketNodeMap);\n     }\n \n-    private static Optional<InternalNodeInfo> chooseLeastBusyNode(List<InternalNode> candidateNodes, Function<InternalNode, Integer> splitCountProvider, OptionalInt preferredNodeCount, int maxSplitCount)\n+    private Optional<InternalNodeInfo> chooseLeastBusyNode(List<InternalNode> candidateNodes, Function<InternalNode, Integer> splitCountProvider, OptionalInt preferredNodeCount, int maxSplitCount)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b3388028711a66a1901ebf618b7a1a743b77296"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA5OTY4Nw==", "bodyText": "I'm fine both ways actually given it's private.", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r389099687", "createdAt": "2020-03-06T19:32:47Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -196,7 +199,7 @@ public SplitPlacementResult computeAssignments(Set<Split> splits, List<RemoteTas\n         return selectDistributionNodes(nodeMap.get().get(), nodeTaskMap, maxSplitsPerNode, maxPendingSplitsPerTask, splits, existingTasks, bucketNodeMap);\n     }\n \n-    private static Optional<InternalNodeInfo> chooseLeastBusyNode(List<InternalNode> candidateNodes, Function<InternalNode, Integer> splitCountProvider, OptionalInt preferredNodeCount, int maxSplitCount)\n+    private Optional<InternalNodeInfo> chooseLeastBusyNode(List<InternalNode> candidateNodes, Function<InternalNode, Integer> splitCountProvider, OptionalInt preferredNodeCount, int maxSplitCount)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1OTc4Ng=="}, "originalCommit": {"oid": "5b3388028711a66a1901ebf618b7a1a743b77296"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwMDg0OQ==", "bodyText": "Then let's just keep it as is :)", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r389100849", "createdAt": "2020-03-06T19:35:19Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -196,7 +199,7 @@ public SplitPlacementResult computeAssignments(Set<Split> splits, List<RemoteTas\n         return selectDistributionNodes(nodeMap.get().get(), nodeTaskMap, maxSplitsPerNode, maxPendingSplitsPerTask, splits, existingTasks, bucketNodeMap);\n     }\n \n-    private static Optional<InternalNodeInfo> chooseLeastBusyNode(List<InternalNode> candidateNodes, Function<InternalNode, Integer> splitCountProvider, OptionalInt preferredNodeCount, int maxSplitCount)\n+    private Optional<InternalNodeInfo> chooseLeastBusyNode(List<InternalNode> candidateNodes, Function<InternalNode, Integer> splitCountProvider, OptionalInt preferredNodeCount, int maxSplitCount)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1OTc4Ng=="}, "originalCommit": {"oid": "5b3388028711a66a1901ebf618b7a1a743b77296"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDU5MzM3OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/NodeScheduler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxODoxMDoyNlrOFzCYug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxODozNjoxN1rOFzDIzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2MDc5NA==", "bodyText": "Would you need a getter for this class to ensure it could be exposed to jmx?", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r389060794", "createdAt": "2020-03-06T18:10:26Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/NodeScheduler.java", "diffHunk": "@@ -67,6 +68,7 @@\n     private final List<CounterStat> topologicalSplitCounters;\n     private final List<String> networkLocationSegmentNames;\n     private final InternalNodeManager nodeManager;\n+    private final NodeSelectionStats nodeSelectionStats;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b3388028711a66a1901ebf618b7a1a743b77296"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA3MzEwMw==", "bodyText": "There are getters inside NodeSelectionStats, which would be exposed to JMX. I have tested on our cluster.", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r389073103", "createdAt": "2020-03-06T18:36:17Z", "author": {"login": "kewang1024"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/NodeScheduler.java", "diffHunk": "@@ -67,6 +68,7 @@\n     private final List<CounterStat> topologicalSplitCounters;\n     private final List<String> networkLocationSegmentNames;\n     private final InternalNodeManager nodeManager;\n+    private final NodeSelectionStats nodeSelectionStats;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2MDc5NA=="}, "originalCommit": {"oid": "5b3388028711a66a1901ebf618b7a1a743b77296"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDgzNDk5OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTozNDowNFrOFzEy-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTozNDowNFrOFzEy-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEwMDI4MA==", "bodyText": "\"nodeSelectionStats is null\"", "url": "https://github.com/prestodb/presto/pull/14209#discussion_r389100280", "createdAt": "2020-03-06T19:34:04Z", "author": {"login": "highker"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/SimpleNodeSelector.java", "diffHunk": "@@ -80,6 +82,7 @@ public SimpleNodeSelector(\n             int maxTasksPerStage)\n     {\n         this.nodeManager = requireNonNull(nodeManager, \"nodeManager is null\");\n+        this.nodeSelectionStats = requireNonNull(nodeSelectionStats, \"NodeSelectionStats is null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b3388028711a66a1901ebf618b7a1a743b77296"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2856, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}