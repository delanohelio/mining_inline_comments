{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2Nzc1NzI4", "number": 14113, "title": "Add ZSTD support for writing ORC and DWRF tables", "bodyText": "Add ZSTD support for writing ORC and DWRF tables\nTo enable ZSTD compression, use session property hive.compression_codec='ZSTD'.\n== RELEASE NOTES ==\nHive Changes\n\nAdd ZSTD support for writing ORC and DWRF tables. To enable ZSTD compression, use session property hive.compression_codec='ZSTD'.", "createdAt": "2020-02-18T18:43:34Z", "url": "https://github.com/prestodb/presto/pull/14113", "merged": true, "mergeCommit": {"oid": "5d1797c745fa406d4d5ab96423b1ca5f40a00157"}, "closed": true, "closedAt": "2020-03-14T00:03:51Z", "author": {"login": "jainxrohit"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFoQSnABqjMwNDg3NzQ4MDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNCs-dAFqTM3MzkxOTMxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "289a3a86732e4e611da5584b78ac46698ba55300", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/289a3a86732e4e611da5584b78ac46698ba55300", "committedDate": "2020-02-15T02:09:34Z", "message": "Add ZSTD support for Hive Compression codec"}, "afterCommit": {"oid": "bfccbd0150e2a383ddcafe07c1e14ab68d9ee803", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/bfccbd0150e2a383ddcafe07c1e14ab68d9ee803", "committedDate": "2020-02-18T20:49:30Z", "message": "Add ZSTD support for Hive Compression codec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfccbd0150e2a383ddcafe07c1e14ab68d9ee803", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/bfccbd0150e2a383ddcafe07c1e14ab68d9ee803", "committedDate": "2020-02-18T20:49:30Z", "message": "Add ZSTD support for Hive Compression codec"}, "afterCommit": {"oid": "aa529d41952d8c5c5572939da440eabfc193171b", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/aa529d41952d8c5c5572939da440eabfc193171b", "committedDate": "2020-02-25T00:50:14Z", "message": "Add ZSTD support for Hive Compression codec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa529d41952d8c5c5572939da440eabfc193171b", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/aa529d41952d8c5c5572939da440eabfc193171b", "committedDate": "2020-02-25T00:50:14Z", "message": "Add ZSTD support for Hive Compression codec"}, "afterCommit": {"oid": "bb978339d921e1d831c2bc656f1b069ce479dabb", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/bb978339d921e1d831c2bc656f1b069ce479dabb", "committedDate": "2020-02-25T18:33:39Z", "message": "Add ZSTD support for Hive Compression codec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb978339d921e1d831c2bc656f1b069ce479dabb", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/bb978339d921e1d831c2bc656f1b069ce479dabb", "committedDate": "2020-02-25T18:33:39Z", "message": "Add ZSTD support for Hive Compression codec"}, "afterCommit": {"oid": "ce97cf76285bbdd756071d51c386c1755e0ddeb8", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/ce97cf76285bbdd756071d51c386c1755e0ddeb8", "committedDate": "2020-03-11T22:45:30Z", "message": "Add ZSTD support for Hive Compression codec"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce97cf76285bbdd756071d51c386c1755e0ddeb8", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/ce97cf76285bbdd756071d51c386c1755e0ddeb8", "committedDate": "2020-03-11T22:45:30Z", "message": "Add ZSTD support for Hive Compression codec"}, "afterCommit": {"oid": "6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318", "committedDate": "2020-03-11T23:11:42Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property prism.compression_codec."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTg5MjAx", "url": "https://github.com/prestodb/presto/pull/14113#pullrequestreview-373189201", "createdAt": "2020-03-11T23:18:51Z", "commit": {"oid": "6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMzoxODo1MVrOF1MgRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMzoyMDoxOFrOF1MhvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMyMzcxNw==", "bodyText": "nit: requireNonNull", "url": "https://github.com/prestodb/presto/pull/14113#discussion_r391323717", "createdAt": "2020-03-11T23:18:51Z", "author": {"login": "mbasmanova"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveCompressionCodec.java", "diffHunk": "@@ -20,24 +20,44 @@\n import parquet.hadoop.metadata.CompressionCodecName;\n \n import java.util.Optional;\n+import java.util.function.Predicate;\n \n+import static com.facebook.presto.hive.HiveStorageFormat.DWRF;\n+import static com.facebook.presto.hive.HiveStorageFormat.ORC;\n import static java.util.Objects.requireNonNull;\n \n public enum HiveCompressionCodec\n {\n-    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED),\n-    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY),\n-    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP);\n+    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED, allStorageFormatsSupported().negate()),\n+    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY, allStorageFormatsSupported()),\n+    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP, allStorageFormatsSupported()),\n+    ZSTD(null, CompressionKind.ZSTD, null, supportedStorageFormatsForZSTD());\n \n     private final Optional<Class<? extends CompressionCodec>> codec;\n     private final CompressionKind orcCompressionKind;\n     private final CompressionCodecName parquetCompressionCodec;\n+    private final Predicate<HiveStorageFormat> supportedStorageFormats;\n \n-    HiveCompressionCodec(Class<? extends CompressionCodec> codec, CompressionKind orcCompressionKind, CompressionCodecName parquetCompressionCodec)\n+    HiveCompressionCodec(\n+            Class<? extends CompressionCodec> codec,\n+            CompressionKind orcCompressionKind,\n+            CompressionCodecName parquetCompressionCodec,\n+            Predicate<HiveStorageFormat> supportedStorageFormats)\n     {\n         this.codec = Optional.ofNullable(codec);\n         this.orcCompressionKind = requireNonNull(orcCompressionKind, \"orcCompressionKind is null\");\n-        this.parquetCompressionCodec = requireNonNull(parquetCompressionCodec, \"parquetCompressionCodec is null\");\n+        this.parquetCompressionCodec = parquetCompressionCodec;\n+        this.supportedStorageFormats = supportedStorageFormats;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMyMzk2OQ==", "bodyText": "nit: f -> false might be shorter and easier to read", "url": "https://github.com/prestodb/presto/pull/14113#discussion_r391323969", "createdAt": "2020-03-11T23:19:50Z", "author": {"login": "mbasmanova"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveCompressionCodec.java", "diffHunk": "@@ -20,24 +20,44 @@\n import parquet.hadoop.metadata.CompressionCodecName;\n \n import java.util.Optional;\n+import java.util.function.Predicate;\n \n+import static com.facebook.presto.hive.HiveStorageFormat.DWRF;\n+import static com.facebook.presto.hive.HiveStorageFormat.ORC;\n import static java.util.Objects.requireNonNull;\n \n public enum HiveCompressionCodec\n {\n-    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED),\n-    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY),\n-    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP);\n+    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED, allStorageFormatsSupported().negate()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMyNDAwMg==", "bodyText": "perhaps, f -> true", "url": "https://github.com/prestodb/presto/pull/14113#discussion_r391324002", "createdAt": "2020-03-11T23:19:58Z", "author": {"login": "mbasmanova"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveCompressionCodec.java", "diffHunk": "@@ -20,24 +20,44 @@\n import parquet.hadoop.metadata.CompressionCodecName;\n \n import java.util.Optional;\n+import java.util.function.Predicate;\n \n+import static com.facebook.presto.hive.HiveStorageFormat.DWRF;\n+import static com.facebook.presto.hive.HiveStorageFormat.ORC;\n import static java.util.Objects.requireNonNull;\n \n public enum HiveCompressionCodec\n {\n-    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED),\n-    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY),\n-    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP);\n+    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED, allStorageFormatsSupported().negate()),\n+    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY, allStorageFormatsSupported()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMyNDA5Mw==", "bodyText": "perhaps, f -> f == ORC || f == DWRF", "url": "https://github.com/prestodb/presto/pull/14113#discussion_r391324093", "createdAt": "2020-03-11T23:20:18Z", "author": {"login": "mbasmanova"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveCompressionCodec.java", "diffHunk": "@@ -20,24 +20,44 @@\n import parquet.hadoop.metadata.CompressionCodecName;\n \n import java.util.Optional;\n+import java.util.function.Predicate;\n \n+import static com.facebook.presto.hive.HiveStorageFormat.DWRF;\n+import static com.facebook.presto.hive.HiveStorageFormat.ORC;\n import static java.util.Objects.requireNonNull;\n \n public enum HiveCompressionCodec\n {\n-    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED),\n-    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY),\n-    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP);\n+    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED, allStorageFormatsSupported().negate()),\n+    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY, allStorageFormatsSupported()),\n+    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP, allStorageFormatsSupported()),\n+    ZSTD(null, CompressionKind.ZSTD, null, supportedStorageFormatsForZSTD());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/6634f9ea1d05cc0f695d4b1d20653e5a4a6ac318", "committedDate": "2020-03-11T23:11:42Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property prism.compression_codec."}, "afterCommit": {"oid": "e4e4f6012193d2c2906d7f1a3d0e7666eef3b62b", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/e4e4f6012193d2c2906d7f1a3d0e7666eef3b62b", "committedDate": "2020-03-11T23:39:01Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property prism.compression_codec."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTk3OTA5", "url": "https://github.com/prestodb/presto/pull/14113#pullrequestreview-373197909", "createdAt": "2020-03-11T23:45:22Z", "commit": {"oid": "e4e4f6012193d2c2906d7f1a3d0e7666eef3b62b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMzo0NToyMlrOF1M_Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMzo0NToyMlrOF1M_Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMzMTYxOA==", "bodyText": "@jainxrohit We tend to add a message like this:\nrequireNonNull(supportedStorageFormats, \"supportedStorageFormats is null\")", "url": "https://github.com/prestodb/presto/pull/14113#discussion_r391331618", "createdAt": "2020-03-11T23:45:22Z", "author": {"login": "mbasmanova"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveCompressionCodec.java", "diffHunk": "@@ -20,24 +20,44 @@\n import parquet.hadoop.metadata.CompressionCodecName;\n \n import java.util.Optional;\n+import java.util.function.Predicate;\n \n+import static com.facebook.presto.hive.HiveStorageFormat.DWRF;\n+import static com.facebook.presto.hive.HiveStorageFormat.ORC;\n import static java.util.Objects.requireNonNull;\n \n public enum HiveCompressionCodec\n {\n-    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED),\n-    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY),\n-    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP);\n+    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED, allStorageFormatsSupported().negate()),\n+    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY, allStorageFormatsSupported()),\n+    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP, allStorageFormatsSupported()),\n+    ZSTD(null, CompressionKind.ZSTD, null, supportedStorageFormatsForZSTD());\n \n     private final Optional<Class<? extends CompressionCodec>> codec;\n     private final CompressionKind orcCompressionKind;\n-    private final CompressionCodecName parquetCompressionCodec;\n+    private final Optional<CompressionCodecName> parquetCompressionCodec;\n+    private final Predicate<HiveStorageFormat> supportedStorageFormats;\n \n-    HiveCompressionCodec(Class<? extends CompressionCodec> codec, CompressionKind orcCompressionKind, CompressionCodecName parquetCompressionCodec)\n+    HiveCompressionCodec(\n+            Class<? extends CompressionCodec> codec,\n+            CompressionKind orcCompressionKind,\n+            CompressionCodecName parquetCompressionCodec,\n+            Predicate<HiveStorageFormat> supportedStorageFormats)\n     {\n         this.codec = Optional.ofNullable(codec);\n         this.orcCompressionKind = requireNonNull(orcCompressionKind, \"orcCompressionKind is null\");\n-        this.parquetCompressionCodec = requireNonNull(parquetCompressionCodec, \"parquetCompressionCodec is null\");\n+        this.parquetCompressionCodec = Optional.ofNullable(parquetCompressionCodec);\n+        this.supportedStorageFormats = requireNonNull(supportedStorageFormats);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4e4f6012193d2c2906d7f1a3d0e7666eef3b62b"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4e4f6012193d2c2906d7f1a3d0e7666eef3b62b", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/e4e4f6012193d2c2906d7f1a3d0e7666eef3b62b", "committedDate": "2020-03-11T23:39:01Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property prism.compression_codec."}, "afterCommit": {"oid": "77ccce5cc35cc1a7cf9867cc5e18547c12da7c86", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/77ccce5cc35cc1a7cf9867cc5e18547c12da7c86", "committedDate": "2020-03-11T23:47:51Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property prism.compression_codec."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77ccce5cc35cc1a7cf9867cc5e18547c12da7c86", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/77ccce5cc35cc1a7cf9867cc5e18547c12da7c86", "committedDate": "2020-03-11T23:47:51Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property prism.compression_codec."}, "afterCommit": {"oid": "955c3f65b046301bed278987a35a0a1adc04dc81", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/955c3f65b046301bed278987a35a0a1adc04dc81", "committedDate": "2020-03-12T06:03:23Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property hive.compression_codec."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "955c3f65b046301bed278987a35a0a1adc04dc81", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/955c3f65b046301bed278987a35a0a1adc04dc81", "committedDate": "2020-03-12T06:03:23Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property hive.compression_codec."}, "afterCommit": {"oid": "7057290c8e5c9b4a588cf025cbc3451b82a583e6", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/7057290c8e5c9b4a588cf025cbc3451b82a583e6", "committedDate": "2020-03-12T15:48:08Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property hive.compression_codec."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7057290c8e5c9b4a588cf025cbc3451b82a583e6", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/7057290c8e5c9b4a588cf025cbc3451b82a583e6", "committedDate": "2020-03-12T15:48:08Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property hive.compression_codec."}, "afterCommit": {"oid": "23f6fe3ff4022713059ce36f1ed30296bae188cd", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/23f6fe3ff4022713059ce36f1ed30296bae188cd", "committedDate": "2020-03-12T15:48:28Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property hive.compression_codec."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjgwOTkz", "url": "https://github.com/prestodb/presto/pull/14113#pullrequestreview-373680993", "createdAt": "2020-03-12T15:52:24Z", "commit": {"oid": "23f6fe3ff4022713059ce36f1ed30296bae188cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo1MjoyNVrOF1khZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo1MjoyNVrOF1khZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcxNzIyMQ==", "bodyText": "nit: parquetCompressionCodec -> codec in the lambda\ncompression.getParquetCompressionCodec().ifPresent(codec -> config.set(ParquetOutputFormat.COMPRESSION, codec.name()));", "url": "https://github.com/prestodb/presto/pull/14113#discussion_r391717221", "createdAt": "2020-03-12T15:52:25Z", "author": {"login": "mbasmanova"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/util/ConfigurationUtils.java", "diffHunk": "@@ -113,7 +113,7 @@ private static void setCompressionProperties(Configuration config, HiveCompressi\n             config.unset(FileOutputFormat.COMPRESS_CODEC);\n         }\n         // For Parquet\n-        config.set(ParquetOutputFormat.COMPRESSION, compression.getParquetCompressionCodec().name());\n+        compression.getParquetCompressionCodec().ifPresent(parquetCompressionCodec -> config.set(ParquetOutputFormat.COMPRESSION, parquetCompressionCodec.name()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23f6fe3ff4022713059ce36f1ed30296bae188cd"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23f6fe3ff4022713059ce36f1ed30296bae188cd", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/23f6fe3ff4022713059ce36f1ed30296bae188cd", "committedDate": "2020-03-12T15:48:28Z", "message": "Add ZSTD support for write\n\nAdding ZSTD support for writing table. It is only supported with\nORC and DWRF.\nIt is supported via session property hive.compression_codec."}, "afterCommit": {"oid": "8c3a2743e1358ec39f5e61ae139fa0cc492a5341", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/8c3a2743e1358ec39f5e61ae139fa0cc492a5341", "committedDate": "2020-03-12T15:59:23Z", "message": "Add ZSTD support for write\n\nAdd ZSTD support for writing ORC and DWRF tables.\nTo enable ZSTD compression, use session property hive.compression_codec='ZSTD'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e841b3020b443b4730393178f714496ec682730f", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/e841b3020b443b4730393178f714496ec682730f", "committedDate": "2020-03-12T16:04:52Z", "message": "Add ZSTD support for writing ORC and DWRF tables\n\nTo enable ZSTD compression, use session property hive.compression_codec='ZSTD'."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c3a2743e1358ec39f5e61ae139fa0cc492a5341", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/8c3a2743e1358ec39f5e61ae139fa0cc492a5341", "committedDate": "2020-03-12T15:59:23Z", "message": "Add ZSTD support for write\n\nAdd ZSTD support for writing ORC and DWRF tables.\nTo enable ZSTD compression, use session property hive.compression_codec='ZSTD'."}, "afterCommit": {"oid": "e841b3020b443b4730393178f714496ec682730f", "author": {"user": {"login": "jainxrohit", "name": "Rohit Jain"}}, "url": "https://github.com/prestodb/presto/commit/e841b3020b443b4730393178f714496ec682730f", "committedDate": "2020-03-12T16:04:52Z", "message": "Add ZSTD support for writing ORC and DWRF tables\n\nTo enable ZSTD compression, use session property hive.compression_codec='ZSTD'."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTE5MzEx", "url": "https://github.com/prestodb/presto/pull/14113#pullrequestreview-373919311", "createdAt": "2020-03-12T21:36:02Z", "commit": {"oid": "e841b3020b443b4730393178f714496ec682730f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMTozNjowMlrOF1wYDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMTozNjowMlrOF1wYDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTkxMTQzOQ==", "bodyText": "nit: what about format -> true ? ditto for other lambdas.", "url": "https://github.com/prestodb/presto/pull/14113#discussion_r391911439", "createdAt": "2020-03-12T21:36:02Z", "author": {"login": "wenleix"}, "path": "presto-hive/src/main/java/com/facebook/presto/hive/HiveCompressionCodec.java", "diffHunk": "@@ -20,24 +20,34 @@\n import parquet.hadoop.metadata.CompressionCodecName;\n \n import java.util.Optional;\n+import java.util.function.Predicate;\n \n+import static com.facebook.presto.hive.HiveStorageFormat.DWRF;\n+import static com.facebook.presto.hive.HiveStorageFormat.ORC;\n import static java.util.Objects.requireNonNull;\n \n public enum HiveCompressionCodec\n {\n-    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED),\n-    SNAPPY(SnappyCodec.class, CompressionKind.SNAPPY, CompressionCodecName.SNAPPY),\n-    GZIP(GzipCodec.class, CompressionKind.ZLIB, CompressionCodecName.GZIP);\n+    NONE(null, CompressionKind.NONE, CompressionCodecName.UNCOMPRESSED, f -> true),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e841b3020b443b4730393178f714496ec682730f"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2236, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}