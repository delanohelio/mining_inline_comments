{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3OTYzMTI2", "number": 14909, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMDo1ODoyMVrOET5P1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMDo0OToyMFrOEUwMYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5Mjk2MzQyOnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/operator/OperatorContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMDo1ODoyMVrOG54r1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMDo1ODoyMVrOG54r1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM1MDc0Mw==", "bodyText": "This looks quite general, surprised not added before when adding aggregation spilling", "url": "https://github.com/prestodb/presto/pull/14909#discussion_r463350743", "createdAt": "2020-07-31T00:58:21Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/operator/OperatorContext.java", "diffHunk": "@@ -264,6 +264,12 @@ public AggregatedMemoryContext aggregateUserMemoryContext()\n         return new InternalAggregatedMemoryContext(operatorMemoryContext.aggregateUserMemoryContext(), memoryFuture, this::updatePeakMemoryReservations, false);\n     }\n \n+    // caller shouldn't close this context as it's managed by the OperatorContext\n+    public AggregatedMemoryContext aggregateRevocableMemoryContext()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c70a756973facf3a7b5d6e140f10e73266c70a98"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMTk2NTc3OnYy", "diffSide": "RIGHT", "path": "presto-main/src/main/java/com/facebook/presto/operator/WindowOperator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMDo0OToyMFrOG7IQrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMDo0OToyMFrOG7IQrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY1NDUxMQ==", "bodyText": "I assume \"us\" here means this window operator itself, especially SpillablePagesToPagesIndexes#process", "url": "https://github.com/prestodb/presto/pull/14909#discussion_r464654511", "createdAt": "2020-08-03T20:49:20Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/operator/WindowOperator.java", "diffHunk": "@@ -567,12 +567,14 @@ void updateMemoryUsage()\n         final SpillerFactory spillerFactory;\n         final PageWithPositionComparator pageWithPositionComparator;\n \n+        boolean spillingWhenConvertingRevocableMemory;\n         boolean resetPagesIndex;\n         int pendingInputPosition;\n \n         Optional<Page> currentSpillGroupRowPage;\n         Optional<Spiller> spiller;\n-        ListenableFuture<?> spillInProgress = immediateFuture(null);\n+        // Spill can be trigger by Driver, by us or both. `spillInProgress` is not empty when spill was triggered but not `finishMemoryRevoke()` yet", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3943eab82865250ab304474b260c7fa3b73d0edd"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2194, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}