{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyODg1NzEy", "number": 14636, "title": "Make TaskStatus Leaner", "bodyText": "taskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement.\n== NO RELEASE NOTE ==", "createdAt": "2020-06-11T07:14:19Z", "url": "https://github.com/prestodb/presto/pull/14636", "merged": true, "mergeCommit": {"oid": "9c5aee1bff00bc50e4e7c7ab527aeba12ae8f78a"}, "closed": true, "closedAt": "2020-06-18T14:12:17Z", "author": {"login": "ajaygeorge"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqRbmXABqjM0MzUxNDI3OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsW4xIAFqTQzMjkzNTE2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09ab0ea1f6acc9b13ee9067370c7c40c1fe8bc54", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/09ab0ea1f6acc9b13ee9067370c7c40c1fe8bc54", "committedDate": "2020-06-11T07:05:41Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}, "afterCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/f7bd96787fd6ce5a925a8e404684e3f2ee278da4", "committedDate": "2020-06-11T17:09:19Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MTQzMzEy", "url": "https://github.com/prestodb/presto/pull/14636#pullrequestreview-429143312", "createdAt": "2020-06-11T17:38:32Z", "commit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNzozODozM1rOGinxaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNzozODozM1rOGinxaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk1NjM5NQ==", "bodyText": "I went with maintaining both the string representation and the UUID so that the existing code which uses the string representation continues to do so and whatever extra cost of calling UUID.toString each time getTaskInstanceId is called is avoided. If removing the string representation is deemed cleaner I can take this out.", "url": "https://github.com/prestodb/presto/pull/14636#discussion_r438956395", "createdAt": "2020-06-11T17:38:33Z", "author": {"login": "ajaygeorge"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlTask.java", "diffHunk": "@@ -71,6 +71,7 @@\n     private static final Logger log = Logger.get(SqlTask.class);\n \n     private final TaskId taskId;\n+    private final UUID taskInstanceUUID;\n     private final String taskInstanceId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MTYzMjQz", "url": "https://github.com/prestodb/presto/pull/14636#pullrequestreview-429163243", "createdAt": "2020-06-11T18:03:48Z", "commit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODowMzo0OFrOGio7gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODoxMTo0M1rOGipMnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3NTM2Mg==", "bodyText": "let's not abreviate, call it LeastSignificantBits", "url": "https://github.com/prestodb/presto/pull/14636#discussion_r438975362", "createdAt": "2020-06-11T18:03:48Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/TaskStatus.java", "diffHunk": "@@ -86,7 +88,8 @@ public TaskStatus(\n             @JsonProperty(\"fullGcCount\") long fullGcCount,\n             @JsonProperty(\"fullGcTimeInMillis\") long fullGcTimeInMillis)\n     {\n-        this.taskInstanceId = requireNonNull(taskInstanceId, \"taskInstanceId is null\");\n+        this.taskInstanceIdLsb = taskInstanceIdLsb;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3OTc0Mw==", "bodyText": "It's a little weird to have them both. It feels like a single part (one long) should have enough entropy. Should we simply switch to a single long?", "url": "https://github.com/prestodb/presto/pull/14636#discussion_r438979743", "createdAt": "2020-06-11T18:11:43Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlTask.java", "diffHunk": "@@ -123,7 +124,8 @@ private SqlTask(\n             DataSize maxBufferSize)\n     {\n         this.taskId = requireNonNull(taskId, \"taskId is null\");\n-        this.taskInstanceId = UUID.randomUUID().toString();\n+        this.taskInstanceUUID = UUID.randomUUID();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MjIwNDU5", "url": "https://github.com/prestodb/presto/pull/14636#pullrequestreview-429220459", "createdAt": "2020-06-11T19:28:37Z", "commit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxOToyODozN1rOGirn6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxOTozMzowMFrOGirwiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAxOTQ5OQ==", "bodyText": "I think we should create a class to represent taskInstanceId  that  holds long taskInstanceIdLsb and long taskInstanceIdMsb. It may increase the overhead on JSON.", "url": "https://github.com/prestodb/presto/pull/14636#discussion_r439019499", "createdAt": "2020-06-11T19:28:37Z", "author": {"login": "cemcayiroglu"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/TaskStatus.java", "diffHunk": "@@ -70,7 +71,8 @@\n \n     @JsonCreator\n     public TaskStatus(\n-            @JsonProperty(\"taskInstanceId\") String taskInstanceId,\n+            @JsonProperty(\"taskInstanceIdLsb\") long taskInstanceIdLsb,\n+            @JsonProperty(\"taskInstanceIdMsb\") long taskInstanceIdMsb,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAxOTk3Ng==", "bodyText": "We can move this logic to the new TaskInstanceId.", "url": "https://github.com/prestodb/presto/pull/14636#discussion_r439019976", "createdAt": "2020-06-11T19:29:36Z", "author": {"login": "cemcayiroglu"}, "path": "presto-main/src/main/java/com/facebook/presto/server/remotetask/ContinuousTaskStatusFetcher.java", "diffHunk": "@@ -230,7 +229,8 @@ void updateTaskStatus(TaskStatus newValue)\n         AtomicBoolean taskMismatch = new AtomicBoolean();\n         taskStatus.setIf(newValue, oldValue -> {\n             // did the task instance id change\n-            if (!isNullOrEmpty(oldValue.getTaskInstanceId()) && !oldValue.getTaskInstanceId().equals(newValue.getTaskInstanceId())) {\n+            boolean isOldValueEmpty = oldValue.getTaskInstanceIdLsb() == 0 && oldValue.getTaskInstanceIdMsb() == 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAyMTcwNQ==", "bodyText": "Ideally, we should try to keep an object in wire and memory same/similar to avoid additional decoding. I suggest to use TaskInstanceId class everywhere that I described above.", "url": "https://github.com/prestodb/presto/pull/14636#discussion_r439021705", "createdAt": "2020-06-11T19:33:00Z", "author": {"login": "cemcayiroglu"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/SqlTask.java", "diffHunk": "@@ -123,7 +124,8 @@ private SqlTask(\n             DataSize maxBufferSize)\n     {\n         this.taskId = requireNonNull(taskId, \"taskId is null\");\n-        this.taskInstanceId = UUID.randomUUID().toString();\n+        this.taskInstanceUUID = UUID.randomUUID();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3OTc0Mw=="}, "originalCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7bd96787fd6ce5a925a8e404684e3f2ee278da4", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/f7bd96787fd6ce5a925a8e404684e3f2ee278da4", "committedDate": "2020-06-11T17:09:19Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}, "afterCommit": {"oid": "4e1edd262f46d4920828b9c2f66fb0b8a5cd74be", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/4e1edd262f46d4920828b9c2f66fb0b8a5cd74be", "committedDate": "2020-06-17T05:58:52Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e1edd262f46d4920828b9c2f66fb0b8a5cd74be", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/4e1edd262f46d4920828b9c2f66fb0b8a5cd74be", "committedDate": "2020-06-17T05:58:52Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}, "afterCommit": {"oid": "d4268bfa7b2a018ab00b8913bd4c5667c5b35821", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/d4268bfa7b2a018ab00b8913bd4c5667c5b35821", "committedDate": "2020-06-17T06:07:48Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4268bfa7b2a018ab00b8913bd4c5667c5b35821", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/d4268bfa7b2a018ab00b8913bd4c5667c5b35821", "committedDate": "2020-06-17T06:07:48Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}, "afterCommit": {"oid": "18771607143e8667bb34a2f8ef3dcbc1e4183f8a", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/18771607143e8667bb34a2f8ef3dcbc1e4183f8a", "committedDate": "2020-06-17T06:14:32Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18771607143e8667bb34a2f8ef3dcbc1e4183f8a", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/18771607143e8667bb34a2f8ef3dcbc1e4183f8a", "committedDate": "2020-06-17T06:14:32Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}, "afterCommit": {"oid": "8307c5e396487580ba59021d4b2d134a1a4ee0c0", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/8307c5e396487580ba59021d4b2d134a1a4ee0c0", "committedDate": "2020-06-17T06:53:45Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8307c5e396487580ba59021d4b2d134a1a4ee0c0", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/8307c5e396487580ba59021d4b2d134a1a4ee0c0", "committedDate": "2020-06-17T06:53:45Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}, "afterCommit": {"oid": "96bb897fd7a1a14c94ec6dda9da510c5d85072e2", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/96bb897fd7a1a14c94ec6dda9da510c5d85072e2", "committedDate": "2020-06-17T20:53:53Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1de7000b7b38b6fe8a0587c5b3e38882fd77cb93", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/1de7000b7b38b6fe8a0587c5b3e38882fd77cb93", "committedDate": "2020-06-17T21:14:43Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96bb897fd7a1a14c94ec6dda9da510c5d85072e2", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/96bb897fd7a1a14c94ec6dda9da510c5d85072e2", "committedDate": "2020-06-17T20:53:53Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}, "afterCommit": {"oid": "1de7000b7b38b6fe8a0587c5b3e38882fd77cb93", "author": {"user": {"login": "ajaygeorge", "name": "Ajay George"}}, "url": "https://github.com/prestodb/presto/commit/1de7000b7b38b6fe8a0587c5b3e38882fd77cb93", "committedDate": "2020-06-17T21:14:43Z", "message": "Make TaskStatus Leaner\n\ntaskInstanceId field is currently represented as a UUID string which\ntakes up 72 bytes whereas representing them as two longs takes only\n16 bytes which is a 78% improvement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyOTE2Mjgx", "url": "https://github.com/prestodb/presto/pull/14636#pullrequestreview-432916281", "createdAt": "2020-06-18T03:30:48Z", "commit": {"oid": "1de7000b7b38b6fe8a0587c5b3e38882fd77cb93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyOTM1MTYz", "url": "https://github.com/prestodb/presto/pull/14636#pullrequestreview-432935163", "createdAt": "2020-06-18T04:38:40Z", "commit": {"oid": "1de7000b7b38b6fe8a0587c5b3e38882fd77cb93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1350, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}