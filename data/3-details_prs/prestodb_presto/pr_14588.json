{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0ODg2NDk4", "number": 14588, "title": "Add support for Druid's basic and kerberos authentication", "bodyText": "Basic authentication is supported by airlift's BasicAuthRequestFilter\nKerberos authentication is supported by the embedded SpnegoAuthentication in airlift's http-client\n== RELEASE NOTES ==\n\nGeneral Changes\n* Add support for Druid's basic and kerberos authentication", "createdAt": "2020-05-29T05:02:01Z", "url": "https://github.com/prestodb/presto/pull/14588", "merged": true, "mergeCommit": {"oid": "89feb611e434d259c6f7881083a5cc40e85e9865"}, "closed": true, "closedAt": "2020-05-31T23:25:57Z", "author": {"login": "beinan"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcl7EdagH2gAyNDI0ODg2NDk4OmM0NWEwNTU4M2YzOWYyODVmMmQxYWNiOTRkOTMyYWZkNTdhY2JiYWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmNEIcgFqTQyMTM2NzU3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c45a05583f39f285f2d1acb94d932afd57acbbae", "author": {"user": {"login": "beinan", "name": "Beinan"}}, "url": "https://github.com/prestodb/presto/commit/c45a05583f39f285f2d1acb94d932afd57acbbae", "committedDate": "2020-05-29T04:50:33Z", "message": "Add druid authentication type to DruidConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29", "author": {"user": {"login": "beinan", "name": "Beinan"}}, "url": "https://github.com/prestodb/presto/commit/8ea5d08fed91bdd4ab867240d83c10a9d3109a29", "committedDate": "2020-05-29T04:50:52Z", "message": "Implement druid http basic authentication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9e7b065b614ceedbe084c9f0ce63c4212d82142", "author": {"user": {"login": "beinan", "name": "Beinan"}}, "url": "https://github.com/prestodb/presto/commit/f9e7b065b614ceedbe084c9f0ce63c4212d82142", "committedDate": "2020-05-29T04:51:06Z", "message": "Implement druid kerberos authentication"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTgyMDgw", "url": "https://github.com/prestodb/presto/pull/14588#pullrequestreview-421182080", "createdAt": "2020-05-29T18:17:23Z", "commit": {"oid": "c45a05583f39f285f2d1acb94d932afd57acbbae"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODoxNzoyM1rOGcnUCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxODoyMzoxNFrOGcnhSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1NzQxNg==", "bodyText": "KERBEROS, -> KERBEROS", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432657416", "createdAt": "2020-05-29T18:17:23Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/DruidConfig.java", "diffHunk": "@@ -29,6 +29,14 @@\n     private String schema = \"druid\";\n     private boolean pushdown;\n     private List<String> hadoopConfiguration = ImmutableList.of();\n+    private DruidAuthenticationType druidAuthenticationType = DruidAuthenticationType.NONE;\n+\n+    public enum DruidAuthenticationType\n+    {\n+        NONE,\n+        BASIC,\n+        KERBEROS,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c45a05583f39f285f2d1acb94d932afd57acbbae"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1Nzk3MQ==", "bodyText": "should it be DruidAuthenticationType.NONE?", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432657971", "createdAt": "2020-05-29T18:18:32Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/test/java/com/facebook/presto/druid/TestDruidConfig.java", "diffHunk": "@@ -33,7 +33,8 @@ public void testDefaults()\n                 .setDruidCoordinatorUrl(null)\n                 .setDruidSchema(\"druid\")\n                 .setComputePushdownEnabled(false)\n-                .setHadoopConfiguration(\"\"));\n+                .setHadoopConfiguration(\"\")\n+                .setDruidAuthenticationType(null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c45a05583f39f285f2d1acb94d932afd57acbbae"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1ODYxNQ==", "bodyText": "static import DruidConfig.DruidAuthenticationType.NONE", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432658615", "createdAt": "2020-05-29T18:19:39Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/authentication/DruidAuthenticationModule.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.druid.authentication;\n+\n+import com.facebook.airlift.configuration.AbstractConfigurationAwareModule;\n+import com.facebook.presto.druid.DruidConfig;\n+import com.facebook.presto.druid.ForDruidClient;\n+import com.google.inject.Binder;\n+import com.google.inject.Module;\n+\n+import java.util.function.Predicate;\n+\n+import static com.facebook.airlift.configuration.ConditionalModule.installModuleIf;\n+import static com.facebook.airlift.http.client.HttpClientBinder.httpClientBinder;\n+\n+public class DruidAuthenticationModule\n+        extends AbstractConfigurationAwareModule\n+{\n+    @Override\n+    protected void setup(Binder binder)\n+    {\n+        bindAuthenticationModule(\n+                config -> config.getDruidAuthenticationType() == DruidConfig.DruidAuthenticationType.NONE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1ODg0MA==", "bodyText": "static import DruidConfig.DruidAuthenticationType.BASIC", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432658840", "createdAt": "2020-05-29T18:19:57Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/authentication/DruidAuthenticationModule.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.druid.authentication;\n+\n+import com.facebook.airlift.configuration.AbstractConfigurationAwareModule;\n+import com.facebook.presto.druid.DruidConfig;\n+import com.facebook.presto.druid.ForDruidClient;\n+import com.google.inject.Binder;\n+import com.google.inject.Module;\n+\n+import java.util.function.Predicate;\n+\n+import static com.facebook.airlift.configuration.ConditionalModule.installModuleIf;\n+import static com.facebook.airlift.http.client.HttpClientBinder.httpClientBinder;\n+\n+public class DruidAuthenticationModule\n+        extends AbstractConfigurationAwareModule\n+{\n+    @Override\n+    protected void setup(Binder binder)\n+    {\n+        bindAuthenticationModule(\n+                config -> config.getDruidAuthenticationType() == DruidConfig.DruidAuthenticationType.NONE,\n+                noneAuthenticationModule());\n+\n+        bindAuthenticationModule(\n+                config -> config.getDruidAuthenticationType() == DruidConfig.DruidAuthenticationType.BASIC,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1OTk5Mg==", "bodyText": "s/username/basicAuthenticationUsername/g", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432659992", "createdAt": "2020-05-29T18:21:36Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/DruidConfig.java", "diffHunk": "@@ -30,6 +31,8 @@\n     private boolean pushdown;\n     private List<String> hadoopConfiguration = ImmutableList.of();\n     private DruidAuthenticationType druidAuthenticationType = DruidAuthenticationType.NONE;\n+    private String username;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2MDA5OA==", "bodyText": "s/password/basicAuthenticationPassword/g", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432660098", "createdAt": "2020-05-29T18:21:51Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/DruidConfig.java", "diffHunk": "@@ -30,6 +31,8 @@\n     private boolean pushdown;\n     private List<String> hadoopConfiguration = ImmutableList.of();\n     private DruidAuthenticationType druidAuthenticationType = DruidAuthenticationType.NONE;\n+    private String username;\n+    private String password;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2MDIwMw==", "bodyText": "getBasicAuthenticationUsername", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432660203", "createdAt": "2020-05-29T18:22:03Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/DruidConfig.java", "diffHunk": "@@ -130,4 +133,30 @@ public DruidConfig setDruidAuthenticationType(DruidAuthenticationType druidAuthe\n         }\n         return this;\n     }\n+\n+    @Nullable\n+    public String getUsername()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2MDI4OQ==", "bodyText": "getBasicAuthenticationPassword", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432660289", "createdAt": "2020-05-29T18:22:15Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/DruidConfig.java", "diffHunk": "@@ -130,4 +133,30 @@ public DruidConfig setDruidAuthenticationType(DruidAuthenticationType druidAuthe\n         }\n         return this;\n     }\n+\n+    @Nullable\n+    public String getUsername()\n+    {\n+        return username;\n+    }\n+\n+    @Config(\"druid.authentication.username\")\n+    public DruidConfig setUsername(String username)\n+    {\n+        this.username = username;\n+        return this;\n+    }\n+\n+    @Nullable\n+    public String getPassword()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2MDUwMA==", "bodyText": "druid.basic.authentication.username\nsetBasicAuthenticationUserName", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432660500", "createdAt": "2020-05-29T18:22:40Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/DruidConfig.java", "diffHunk": "@@ -130,4 +133,30 @@ public DruidConfig setDruidAuthenticationType(DruidAuthenticationType druidAuthe\n         }\n         return this;\n     }\n+\n+    @Nullable\n+    public String getUsername()\n+    {\n+        return username;\n+    }\n+\n+    @Config(\"druid.authentication.username\")\n+    public DruidConfig setUsername(String username)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2MDYwMA==", "bodyText": "similar to above", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432660600", "createdAt": "2020-05-29T18:22:50Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/DruidConfig.java", "diffHunk": "@@ -130,4 +133,30 @@ public DruidConfig setDruidAuthenticationType(DruidAuthenticationType druidAuthe\n         }\n         return this;\n     }\n+\n+    @Nullable\n+    public String getUsername()\n+    {\n+        return username;\n+    }\n+\n+    @Config(\"druid.authentication.username\")\n+    public DruidConfig setUsername(String username)\n+    {\n+        this.username = username;\n+        return this;\n+    }\n+\n+    @Nullable\n+    public String getPassword()\n+    {\n+        return password;\n+    }\n+\n+    @Config(\"druid.authentication.password\")\n+    public DruidConfig setPassword(String password)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ea5d08fed91bdd4ab867240d83c10a9d3109a29"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY2MDgwOQ==", "bodyText": "static import DruidConfig.DruidAuthenticationType.KERBEROS", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432660809", "createdAt": "2020-05-29T18:23:14Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/main/java/com/facebook/presto/druid/authentication/DruidAuthenticationModule.java", "diffHunk": "@@ -37,6 +37,10 @@ protected void setup(Binder binder)\n         bindAuthenticationModule(\n                 config -> config.getDruidAuthenticationType() == DruidConfig.DruidAuthenticationType.BASIC,\n                 basicAuthenticationModule());\n+\n+        bindAuthenticationModule(\n+                config -> config.getDruidAuthenticationType() == DruidConfig.DruidAuthenticationType.KERBEROS,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e7b065b614ceedbe084c9f0ce63c4212d82142"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzY0NTQw", "url": "https://github.com/prestodb/presto/pull/14588#pullrequestreview-421364540", "createdAt": "2020-05-30T01:14:15Z", "commit": {"oid": "f4d40d664e9c32bb9c618fb427efaae8c2d7c122"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMToxNDoxNVrOGcvypQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMToxNDoxNVrOGcvypQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5NjMyNQ==", "bodyText": "static import DruidConfig.DruidAuthenticationType.NONE?", "url": "https://github.com/prestodb/presto/pull/14588#discussion_r432796325", "createdAt": "2020-05-30T01:14:15Z", "author": {"login": "zhenxiao"}, "path": "presto-druid/src/test/java/com/facebook/presto/druid/TestDruidConfig.java", "diffHunk": "@@ -33,7 +33,10 @@ public void testDefaults()\n                 .setDruidCoordinatorUrl(null)\n                 .setDruidSchema(\"druid\")\n                 .setComputePushdownEnabled(false)\n-                .setHadoopConfiguration(\"\"));\n+                .setHadoopConfiguration(\"\")\n+                .setDruidAuthenticationType(DruidConfig.DruidAuthenticationType.NONE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d40d664e9c32bb9c618fb427efaae8c2d7c122"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebd2a290396b0cdaf8faa6a45bd7f3b5cc982d05", "author": {"user": {"login": "beinan", "name": "Beinan"}}, "url": "https://github.com/prestodb/presto/commit/ebd2a290396b0cdaf8faa6a45bd7f3b5cc982d05", "committedDate": "2020-05-30T01:23:56Z", "message": "Code refactoring and fix code review issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4d40d664e9c32bb9c618fb427efaae8c2d7c122", "author": {"user": {"login": "beinan", "name": "Beinan"}}, "url": "https://github.com/prestodb/presto/commit/f4d40d664e9c32bb9c618fb427efaae8c2d7c122", "committedDate": "2020-05-29T22:26:10Z", "message": "Code refactoring and fix code review issue"}, "afterCommit": {"oid": "ebd2a290396b0cdaf8faa6a45bd7f3b5cc982d05", "author": {"user": {"login": "beinan", "name": "Beinan"}}, "url": "https://github.com/prestodb/presto/commit/ebd2a290396b0cdaf8faa6a45bd7f3b5cc982d05", "committedDate": "2020-05-30T01:23:56Z", "message": "Code refactoring and fix code review issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzY3NTc0", "url": "https://github.com/prestodb/presto/pull/14588#pullrequestreview-421367574", "createdAt": "2020-05-30T01:48:29Z", "commit": {"oid": "ebd2a290396b0cdaf8faa6a45bd7f3b5cc982d05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1718, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}