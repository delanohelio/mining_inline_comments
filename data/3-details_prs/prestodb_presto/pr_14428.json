{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NzUxMjg2", "number": 14428, "title": "Remove positionCount check in createRandomLongDecimalsBlock", "bodyText": "== NO RELEASE NOTE ==", "createdAt": "2020-04-23T08:08:18Z", "url": "https://github.com/prestodb/presto/pull/14428", "merged": true, "mergeCommit": {"oid": "aaeaa5ba217dc5af865e624b388823be86d8f03b"}, "closed": true, "closedAt": "2020-04-28T12:57:21Z", "author": {"login": "yingsu00"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcajZ5ygH2gAyNDA3NzUxMjg2OmYyYmU1ZDhjOTBkMTEwODA2NjAwNjk1OGQ0ZGQ0YWYyNTY4ZDFlMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb4OVtgFqTQwMTQwNTU5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f2be5d8c90d1108066006958d4dd4af2568d1e27", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/f2be5d8c90d1108066006958d4dd4af2568d1e27", "committedDate": "2020-04-23T21:03:05Z", "message": "Fix \"bound must be positive\" exception when creating DictionaryBlock"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0d93acb1ce2f8dbbb0133a512495e5133032bfb", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/d0d93acb1ce2f8dbbb0133a512495e5133032bfb", "committedDate": "2020-04-23T08:07:24Z", "message": "Remove positionCount check in createRandomLongDecimalsBlock\n\nTestRowBasedSerialization sometimes fails calling\ncreateRandomLongDecimalsBlock with less than 10 positions. We should\nallow blocks with less than 10 positions to be created if there are\nsuch needs. This commit removes the check to enforce the positionCount\ncheck, and comments were added to suggest the user use a larger\npositinCount when desired nullRate > 0."}, "afterCommit": {"oid": "5a684268c1bc6eab55f0cf602ecfb5a847df742a", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/5a684268c1bc6eab55f0cf602ecfb5a847df742a", "committedDate": "2020-04-23T21:03:27Z", "message": "Remove positionCount check in createRandomLongDecimalsBlock\n\nTestRowBasedSerialization sometimes fails calling\ncreateRandomLongDecimalsBlock with less than 10 positions. We should\nallow blocks with less than 10 positions to be created if there are\nsuch needs. This commit removes the check to enforce the positionCount\ncheck, and comments were added to suggest the user use a larger\npositinCount when desired nullRate > 0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTc1MzQx", "url": "https://github.com/prestodb/presto/pull/14428#pullrequestreview-399975341", "createdAt": "2020-04-24T14:03:17Z", "commit": {"oid": "5a684268c1bc6eab55f0cf602ecfb5a847df742a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDowMzoxN1rOGLZPnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDowMzoxN1rOGLZPnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwMTExNg==", "bodyText": "@yingsu00\nnit: consider shortening to Use positionCount >= 10 when nullRate > 0...\nWhat does nullRate can be close to the desired value mean?", "url": "https://github.com/prestodb/presto/pull/14428#discussion_r414601116", "createdAt": "2020-04-24T14:03:17Z", "author": {"login": "mbasmanova"}, "path": "presto-main/src/test/java/com/facebook/presto/block/BlockAssertions.java", "diffHunk": "@@ -265,6 +265,7 @@ public static Block createBooleansBlock(Iterable<Boolean> values)\n         return builder.build();\n     }\n \n+    // It is recommended to have positionCount >= 10 when nullRate > 0, so that the nullRate can be close to the desired value.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a684268c1bc6eab55f0cf602ecfb5a847df742a"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a684268c1bc6eab55f0cf602ecfb5a847df742a", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/5a684268c1bc6eab55f0cf602ecfb5a847df742a", "committedDate": "2020-04-23T21:03:27Z", "message": "Remove positionCount check in createRandomLongDecimalsBlock\n\nTestRowBasedSerialization sometimes fails calling\ncreateRandomLongDecimalsBlock with less than 10 positions. We should\nallow blocks with less than 10 positions to be created if there are\nsuch needs. This commit removes the check to enforce the positionCount\ncheck, and comments were added to suggest the user use a larger\npositinCount when desired nullRate > 0."}, "afterCommit": {"oid": "61ea3b30b593ad3c03278a87157af746aa53c889", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/61ea3b30b593ad3c03278a87157af746aa53c889", "committedDate": "2020-04-25T23:19:17Z", "message": "Remove positionCount check in createRandomLongDecimalsBlock\n\nTestRowBasedSerialization sometimes fails calling\ncreateRandomLongDecimalsBlock with less than 10 positions. We should\nallow blocks with less than 10 positions to be created if there are\nsuch needs. This commit removes the check to enforce the positionCount\ncheck, and comments were added to suggest the user use a larger\npositinCount when desired nullRate > 0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMDAwODgw", "url": "https://github.com/prestodb/presto/pull/14428#pullrequestreview-401000880", "createdAt": "2020-04-27T14:21:36Z", "commit": {"oid": "61ea3b30b593ad3c03278a87157af746aa53c889"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNDoyMTozNlrOGMlxHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNDoyMTozNlrOGMlxHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg1NDg3Ng==", "bodyText": "@yingsu00 should this comment be updated to match the rest?", "url": "https://github.com/prestodb/presto/pull/14428#discussion_r415854876", "createdAt": "2020-04-27T14:21:36Z", "author": {"login": "mbasmanova"}, "path": "presto-main/src/test/java/com/facebook/presto/block/BlockAssertions.java", "diffHunk": "@@ -708,15 +713,18 @@ public static DictionaryBlock createRandomDictionaryBlock(Block dictionary, int\n \n     public static DictionaryBlock createRandomDictionaryBlock(Block dictionary, int positionCount, boolean isView)\n     {\n+        checkArgument(dictionary.getPositionCount() > 0, format(\"dictionary's positionCount %d is less than or equal to 0\", dictionary.getPositionCount()));\n+\n         int idsOffset = 0;\n         if (isView) {\n             idsOffset = min(ThreadLocalRandom.current().nextInt(dictionary.getPositionCount()), 1);\n         }\n \n-        int[] ids = IntStream.range(0, positionCount + idsOffset).map(i -> ThreadLocalRandom.current().nextInt(dictionary.getPositionCount() / 10)).toArray();\n+        int[] ids = IntStream.range(0, positionCount + idsOffset).map(i -> ThreadLocalRandom.current().nextInt(max(dictionary.getPositionCount() / 10, 1))).toArray();\n         return new DictionaryBlock(idsOffset, positionCount, dictionary, ids, false, randomDictionaryId());\n     }\n \n+    // It is recommended to have positionCount >= (10 / nestedNullRate) when nestedNullRate > 0, so that the nullRate can be close to the desired value.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61ea3b30b593ad3c03278a87157af746aa53c889"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzc2MzU4", "url": "https://github.com/prestodb/presto/pull/14428#pullrequestreview-401376358", "createdAt": "2020-04-27T22:37:44Z", "commit": {"oid": "61ea3b30b593ad3c03278a87157af746aa53c889"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dae0dafc4cc28928127556d7708f7950b6bb9d1", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/2dae0dafc4cc28928127556d7708f7950b6bb9d1", "committedDate": "2020-04-27T23:49:32Z", "message": "Remove positionCount check in createRandomLongDecimalsBlock\n\nTestRowBasedSerialization sometimes fails calling\ncreateRandomLongDecimalsBlock with less than 10 positions. We should\nallow blocks with less than 10 positions to be created if there are\nsuch needs. This commit removes the check to enforce the positionCount\ncheck, and comments were added to suggest the user use a larger\npositinCount when desired nullRate > 0."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61ea3b30b593ad3c03278a87157af746aa53c889", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/61ea3b30b593ad3c03278a87157af746aa53c889", "committedDate": "2020-04-25T23:19:17Z", "message": "Remove positionCount check in createRandomLongDecimalsBlock\n\nTestRowBasedSerialization sometimes fails calling\ncreateRandomLongDecimalsBlock with less than 10 positions. We should\nallow blocks with less than 10 positions to be created if there are\nsuch needs. This commit removes the check to enforce the positionCount\ncheck, and comments were added to suggest the user use a larger\npositinCount when desired nullRate > 0."}, "afterCommit": {"oid": "2dae0dafc4cc28928127556d7708f7950b6bb9d1", "author": {"user": null}, "url": "https://github.com/prestodb/presto/commit/2dae0dafc4cc28928127556d7708f7950b6bb9d1", "committedDate": "2020-04-27T23:49:32Z", "message": "Remove positionCount check in createRandomLongDecimalsBlock\n\nTestRowBasedSerialization sometimes fails calling\ncreateRandomLongDecimalsBlock with less than 10 positions. We should\nallow blocks with less than 10 positions to be created if there are\nsuch needs. This commit removes the check to enforce the positionCount\ncheck, and comments were added to suggest the user use a larger\npositinCount when desired nullRate > 0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDA1NTk2", "url": "https://github.com/prestodb/presto/pull/14428#pullrequestreview-401405596", "createdAt": "2020-04-27T23:52:23Z", "commit": {"oid": "2dae0dafc4cc28928127556d7708f7950b6bb9d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1889, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}