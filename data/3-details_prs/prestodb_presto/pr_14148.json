{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NzgzNDkx", "number": 14148, "title": "Failure resolver improvements", "bodyText": "Most of this PR is refactoring, with a few functional changes:\n\nEach failures resolvers can be enabled and disabled individually.\nVerification was skipped when a checksum query fails with COMPILER_ERROR. It is now marked as FAILED_RESOLVED.\nOnly control checksum query failed with COMPILER_ERROR will now gets resolved; test and determinism analysis checksum query will not.\nResolve message updated.\n\n== RELEASE NOTES ==\n\nVerifier Changes\n* Add support to disable individual failure resolvers (:pr:`14148`).\n* Add support to auto-resolve control checksum query failures with ``COMPILER_ERROR`,\n  instead of skipping the verification.", "createdAt": "2020-02-24T02:11:50Z", "url": "https://github.com/prestodb/presto/pull/14148", "merged": true, "mergeCommit": {"oid": "66e4101f3bc88a92dd78827148828d5f51ac5c1f"}, "closed": true, "closedAt": "2020-03-01T04:26:38Z", "author": {"login": "caithagoras"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHT4VkgBqjMwNjM5MjY0NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcI3srFgFqTM2NjcyMzg1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c7a52eafb65d5ca15f31e02837a77f8b14b2465", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7c7a52eafb65d5ca15f31e02837a77f8b14b2465", "committedDate": "2020-02-24T02:10:28Z", "message": "Use failure resolver for checksum query compiler error"}, "afterCommit": {"oid": "f83c622ebc44d0ce23dae253176e38b9822c3b4b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/f83c622ebc44d0ce23dae253176e38b9822c3b4b", "committedDate": "2020-02-24T02:13:06Z", "message": "Use failure resolver for checksum query compiler error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f83c622ebc44d0ce23dae253176e38b9822c3b4b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/f83c622ebc44d0ce23dae253176e38b9822c3b4b", "committedDate": "2020-02-24T02:13:06Z", "message": "Use failure resolver for checksum query compiler error"}, "afterCommit": {"oid": "46a7614551c77a83f91b8f83658466f7dba02eec", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/46a7614551c77a83f91b8f83658466f7dba02eec", "committedDate": "2020-02-24T02:18:14Z", "message": "Auto resolve checksum query failure due to array comparison"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46a7614551c77a83f91b8f83658466f7dba02eec", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/46a7614551c77a83f91b8f83658466f7dba02eec", "committedDate": "2020-02-24T02:18:14Z", "message": "Auto resolve checksum query failure due to array comparison"}, "afterCommit": {"oid": "570732a014c7ced9497cc3cc852b01c8efae3875", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/570732a014c7ced9497cc3cc852b01c8efae3875", "committedDate": "2020-02-24T02:32:12Z", "message": "Auto resolve checksum query failure due to array comparison"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "570732a014c7ced9497cc3cc852b01c8efae3875", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/570732a014c7ced9497cc3cc852b01c8efae3875", "committedDate": "2020-02-24T02:32:12Z", "message": "Auto resolve checksum query failure due to array comparison"}, "afterCommit": {"oid": "48e8f0a81a693e2fd993e7a506fb53efed6e0dfc", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/48e8f0a81a693e2fd993e7a506fb53efed6e0dfc", "committedDate": "2020-02-24T02:32:09Z", "message": "Use failure resolver for checksum query compiler error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48e8f0a81a693e2fd993e7a506fb53efed6e0dfc", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/48e8f0a81a693e2fd993e7a506fb53efed6e0dfc", "committedDate": "2020-02-24T02:32:09Z", "message": "Use failure resolver for checksum query compiler error"}, "afterCommit": {"oid": "0ea5ffa508e4441514e465dca40ca15b7533af95", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0ea5ffa508e4441514e465dca40ca15b7533af95", "committedDate": "2020-02-24T02:33:24Z", "message": "Use failure resolver for checksum query compiler error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ea5ffa508e4441514e465dca40ca15b7533af95", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0ea5ffa508e4441514e465dca40ca15b7533af95", "committedDate": "2020-02-24T02:33:24Z", "message": "Use failure resolver for checksum query compiler error"}, "afterCommit": {"oid": "19138ee94aed6c19d27adb8d5e9a99ed632feaa8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/19138ee94aed6c19d27adb8d5e9a99ed632feaa8", "committedDate": "2020-02-24T02:40:02Z", "message": "Use failure resolver for checksum query compiler error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19138ee94aed6c19d27adb8d5e9a99ed632feaa8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/19138ee94aed6c19d27adb8d5e9a99ed632feaa8", "committedDate": "2020-02-24T02:40:02Z", "message": "Use failure resolver for checksum query compiler error"}, "afterCommit": {"oid": "9d4de0a54975d5803a08b8e982e8cd4f060f2bce", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9d4de0a54975d5803a08b8e982e8cd4f060f2bce", "committedDate": "2020-02-24T02:41:13Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d4de0a54975d5803a08b8e982e8cd4f060f2bce", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9d4de0a54975d5803a08b8e982e8cd4f060f2bce", "committedDate": "2020-02-24T02:41:13Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "90cfe679217ad3ba1b7513e7211d84bf5bd522e2", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/90cfe679217ad3ba1b7513e7211d84bf5bd522e2", "committedDate": "2020-02-24T02:42:28Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90cfe679217ad3ba1b7513e7211d84bf5bd522e2", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/90cfe679217ad3ba1b7513e7211d84bf5bd522e2", "committedDate": "2020-02-24T02:42:28Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "cb621673295ce808d43cb8c4ccd8711790ca33c8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/cb621673295ce808d43cb8c4ccd8711790ca33c8", "committedDate": "2020-02-24T05:27:48Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb621673295ce808d43cb8c4ccd8711790ca33c8", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/cb621673295ce808d43cb8c4ccd8711790ca33c8", "committedDate": "2020-02-24T05:27:48Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "a8c69277c02211c942a77c895b152e71ec294296", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a8c69277c02211c942a77c895b152e71ec294296", "committedDate": "2020-02-24T05:48:23Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8c69277c02211c942a77c895b152e71ec294296", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a8c69277c02211c942a77c895b152e71ec294296", "committedDate": "2020-02-24T05:48:23Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "d685f286bc03253425deb600f803209313772092", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/d685f286bc03253425deb600f803209313772092", "committedDate": "2020-02-24T05:54:11Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d685f286bc03253425deb600f803209313772092", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/d685f286bc03253425deb600f803209313772092", "committedDate": "2020-02-24T05:54:11Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "7c940c84f39991e3c16868dace4866980a07df0a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7c940c84f39991e3c16868dace4866980a07df0a", "committedDate": "2020-02-24T05:58:21Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c940c84f39991e3c16868dace4866980a07df0a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7c940c84f39991e3c16868dace4866980a07df0a", "committedDate": "2020-02-24T05:58:21Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "89abcc4f362d2718c4efa5faa4f9b4409a63a05a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/89abcc4f362d2718c4efa5faa4f9b4409a63a05a", "committedDate": "2020-02-24T06:10:22Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89abcc4f362d2718c4efa5faa4f9b4409a63a05a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/89abcc4f362d2718c4efa5faa4f9b4409a63a05a", "committedDate": "2020-02-24T06:10:22Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "c87459c5a3158a7f432772a580cba4fef6c1ab15", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c87459c5a3158a7f432772a580cba4fef6c1ab15", "committedDate": "2020-02-24T06:11:06Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c87459c5a3158a7f432772a580cba4fef6c1ab15", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c87459c5a3158a7f432772a580cba4fef6c1ab15", "committedDate": "2020-02-24T06:11:06Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "270d376c0e2d77bb12eea8ad134f1f106f411d73", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/270d376c0e2d77bb12eea8ad134f1f106f411d73", "committedDate": "2020-02-24T06:13:38Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "270d376c0e2d77bb12eea8ad134f1f106f411d73", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/270d376c0e2d77bb12eea8ad134f1f106f411d73", "committedDate": "2020-02-24T06:13:38Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "60add968e91d177bf8dba7a6befe2b2ffc2850d6", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/60add968e91d177bf8dba7a6befe2b2ffc2850d6", "committedDate": "2020-02-24T06:19:56Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60add968e91d177bf8dba7a6befe2b2ffc2850d6", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/60add968e91d177bf8dba7a6befe2b2ffc2850d6", "committedDate": "2020-02-24T06:19:56Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "33aede6c8974ac6413db74a61dd3a00d682d8dff", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/33aede6c8974ac6413db74a61dd3a00d682d8dff", "committedDate": "2020-02-24T06:23:07Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33aede6c8974ac6413db74a61dd3a00d682d8dff", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/33aede6c8974ac6413db74a61dd3a00d682d8dff", "committedDate": "2020-02-24T06:23:07Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "1a9cdb48d26374b8de828625aac718786c5e3408", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1a9cdb48d26374b8de828625aac718786c5e3408", "committedDate": "2020-02-24T10:46:15Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDYwNDc1", "url": "https://github.com/prestodb/presto/pull/14148#pullrequestreview-363460475", "createdAt": "2020-02-24T15:10:46Z", "commit": {"oid": "85b916f02bdda0e7d6e7ac5c629fa75623091742"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNToxMDo0NlrOFtkE9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNToxMDo0NlrOFtkE9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMyMTMzNQ==", "bodyText": "@caithagoras I find it strange to include these type of methods in the abstract class. This make this abstract class tightly couples with its subclasses. It think it would be clearer to remove these methods and move the logic into the callers or move them into a separate utils class.", "url": "https://github.com/prestodb/presto/pull/14148#discussion_r383321335", "createdAt": "2020-02-24T15:10:46Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/framework/QueryException.java", "diffHunk": "@@ -14,111 +14,70 @@\n package com.facebook.presto.verifier.framework;\n \n import com.facebook.presto.jdbc.QueryStats;\n-import com.facebook.presto.spi.ErrorCode;\n-import com.facebook.presto.spi.ErrorCodeSupplier;\n import com.facebook.presto.verifier.event.QueryFailure;\n-import com.google.common.base.Function;\n \n import java.util.Optional;\n \n-import static com.facebook.presto.verifier.framework.QueryException.Type.CLUSTER_CONNECTION;\n-import static com.facebook.presto.verifier.framework.QueryException.Type.PRESTO;\n+import static com.google.common.base.Preconditions.checkState;\n import static com.google.common.base.Throwables.getStackTraceAsString;\n-import static java.lang.String.format;\n import static java.util.Objects.requireNonNull;\n \n-public class QueryException\n+public abstract class QueryException\n         extends RuntimeException\n {\n-    public enum Type\n-    {\n-        CLUSTER_CONNECTION(qe -> {\n-            requireNonNull(qe, \"queryException is null\");\n-            requireNonNull(qe.getCause(), \"cause is null\");\n-            return qe.getCause().getClass().getSimpleName();\n-        }),\n-        PRESTO(qe -> {\n-            requireNonNull(qe, \"queryException is null\");\n-            return qe.prestoErrorCode.map(ErrorCodeSupplier::toErrorCode).map(ErrorCode::getName).orElse(\"UNKNOWN\");\n-        });\n-\n-        private final Function<QueryException, String> descriptionGenerator;\n-\n-        Type(Function<QueryException, String> descriptionGenerator)\n-        {\n-            this.descriptionGenerator = requireNonNull(descriptionGenerator, \"descriptionGenerator is null\");\n-        }\n-    }\n-\n-    private final Type type;\n-    private final Optional<ErrorCodeSupplier> prestoErrorCode;\n     private final boolean retryable;\n-    private final Optional<QueryStats> queryStats;\n     private final QueryStage queryStage;\n \n-    private QueryException(\n-            Throwable cause,\n-            Type type,\n-            Optional<ErrorCodeSupplier> prestoErrorCode,\n-            boolean retryable,\n-            Optional<QueryStats> queryStats,\n-            QueryStage queryStage)\n+    public QueryException(Throwable cause, boolean retryable, QueryStage queryStage)\n     {\n         super(cause);\n-        this.type = requireNonNull(type, \"type is null\");\n-        this.prestoErrorCode = requireNonNull(prestoErrorCode, \"errorCode is null\");\n         this.retryable = retryable;\n-        this.queryStats = requireNonNull(queryStats, \"queryStats is null\");\n         this.queryStage = requireNonNull(queryStage, \"queryStage is null\");\n     }\n \n-    public static QueryException forClusterConnection(Throwable cause, QueryStage queryStage)\n+    public abstract String getErrorCodeName();\n+\n+    public boolean isClusterConnectionException()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85b916f02bdda0e7d6e7ac5c629fa75623091742"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDY3MDk1", "url": "https://github.com/prestodb/presto/pull/14148#pullrequestreview-363467095", "createdAt": "2020-02-24T15:19:10Z", "commit": {"oid": "c6097d0049f79185080d2aa51cdc2c4623878b28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNToxOToxMFrOFtkZGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNToxOToxMFrOFtkZGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMyNjQ5MQ==", "bodyText": "@caithagoras Based on the usage of this method, I think a signature with a callback may work better.\n    public static <T> Optional<T> mapMatchingPrestoException(\n            QueryException queryException,\n            QueryStage queryStage,\n            ErrorCodeSupplier errorCode,\n            Function<PrestoQueryException, T> mapper)\n    {\n        if (queryException.getQueryStage() != queryStage || !queryException.isPrestoQueryException()) {\n            return Optional.empty();\n        }\n\n        return Optional.of(mapper.apply((PrestoQueryException) queryException));\n    }\n\npublic class ExceededGlobalMemoryLimitFailureResolver\n        implements FailureResolver\n{\n    public static final String NAME = \"exceeded-global-memory-limit\";\n\n    @Override\n    public Optional<String> resolve(QueryStats controlQueryStats, QueryException queryException, Optional<QueryBundle> test)\n    {\n        return mapMatchingPrestoException(queryException, TEST_MAIN, EXCEEDED_GLOBAL_MEMORY_LIMIT,\n                e -> \"Control query uses more memory than the test cluster memory limit\");\n    }\n}", "url": "https://github.com/prestodb/presto/pull/14148#discussion_r383326491", "createdAt": "2020-02-24T15:19:10Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/resolver/FailureResolverUtil.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.verifier.resolver;\n+\n+import com.facebook.presto.spi.ErrorCodeSupplier;\n+import com.facebook.presto.verifier.framework.PrestoQueryException;\n+import com.facebook.presto.verifier.framework.QueryException;\n+import com.facebook.presto.verifier.framework.QueryStage;\n+\n+import java.util.Optional;\n+\n+public class FailureResolverUtil\n+{\n+    private FailureResolverUtil() {}\n+\n+    public static boolean isMatchingPrestoException(QueryException queryException, QueryStage queryStage, ErrorCodeSupplier errorCode)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6097d0049f79185080d2aa51cdc2c4623878b28"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDcwOTYw", "url": "https://github.com/prestodb/presto/pull/14148#pullrequestreview-363470960", "createdAt": "2020-02-24T15:23:52Z", "commit": {"oid": "1a9cdb48d26374b8de828625aac718786c5e3408"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDcxNzY4", "url": "https://github.com/prestodb/presto/pull/14148#pullrequestreview-363471768", "createdAt": "2020-02-24T15:24:51Z", "commit": {"oid": "1a9cdb48d26374b8de828625aac718786c5e3408"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDczNzAw", "url": "https://github.com/prestodb/presto/pull/14148#pullrequestreview-363473700", "createdAt": "2020-02-24T15:27:09Z", "commit": {"oid": "1a9cdb48d26374b8de828625aac718786c5e3408"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a9cdb48d26374b8de828625aac718786c5e3408", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1a9cdb48d26374b8de828625aac718786c5e3408", "committedDate": "2020-02-24T10:46:15Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "23de76d0494a37d3cb7d199d97ae2803f951a763", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/23de76d0494a37d3cb7d199d97ae2803f951a763", "committedDate": "2020-02-27T01:36:23Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23de76d0494a37d3cb7d199d97ae2803f951a763", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/23de76d0494a37d3cb7d199d97ae2803f951a763", "committedDate": "2020-02-27T01:36:23Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "0822737e30229c7628eee7f95fc0d81e3d31574b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0822737e30229c7628eee7f95fc0d81e3d31574b", "committedDate": "2020-02-27T01:38:36Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0822737e30229c7628eee7f95fc0d81e3d31574b", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0822737e30229c7628eee7f95fc0d81e3d31574b", "committedDate": "2020-02-27T01:38:36Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "dbdff73ae7b1f8340491d0333b5fb213890781c0", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dbdff73ae7b1f8340491d0333b5fb213890781c0", "committedDate": "2020-02-27T06:52:40Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dbdff73ae7b1f8340491d0333b5fb213890781c0", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/dbdff73ae7b1f8340491d0333b5fb213890781c0", "committedDate": "2020-02-27T06:52:40Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "9d9fce5752f54dcb6e7564fce802507a4397a348", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9d9fce5752f54dcb6e7564fce802507a4397a348", "committedDate": "2020-02-27T20:22:48Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d9fce5752f54dcb6e7564fce802507a4397a348", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9d9fce5752f54dcb6e7564fce802507a4397a348", "committedDate": "2020-02-27T20:22:48Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "c857978c1672e3e97ae10bdd0dee5c623136e994", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c857978c1672e3e97ae10bdd0dee5c623136e994", "committedDate": "2020-02-27T20:32:37Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c857978c1672e3e97ae10bdd0dee5c623136e994", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/c857978c1672e3e97ae10bdd0dee5c623136e994", "committedDate": "2020-02-27T20:32:37Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "ae73c02c8ef4d115b351fbfd0cba6c5d7d66ea4a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ae73c02c8ef4d115b351fbfd0cba6c5d7d66ea4a", "committedDate": "2020-02-27T20:33:48Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae73c02c8ef4d115b351fbfd0cba6c5d7d66ea4a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/ae73c02c8ef4d115b351fbfd0cba6c5d7d66ea4a", "committedDate": "2020-02-27T20:33:48Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "6cc4b06ee619c9799eb75c34f2d76b56dadcb83c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6cc4b06ee619c9799eb75c34f2d76b56dadcb83c", "committedDate": "2020-02-27T20:41:40Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6cc4b06ee619c9799eb75c34f2d76b56dadcb83c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/6cc4b06ee619c9799eb75c34f2d76b56dadcb83c", "committedDate": "2020-02-27T20:41:40Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "a09270d9d4524648f8a0a55062673ff7cedfe104", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a09270d9d4524648f8a0a55062673ff7cedfe104", "committedDate": "2020-02-27T20:46:07Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a09270d9d4524648f8a0a55062673ff7cedfe104", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a09270d9d4524648f8a0a55062673ff7cedfe104", "committedDate": "2020-02-27T20:46:07Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "9d950c9ab6fd02ad80030de11a4ecc349d810b38", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9d950c9ab6fd02ad80030de11a4ecc349d810b38", "committedDate": "2020-02-27T20:50:20Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d950c9ab6fd02ad80030de11a4ecc349d810b38", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9d950c9ab6fd02ad80030de11a4ecc349d810b38", "committedDate": "2020-02-27T20:50:20Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "7809294e4799cc7419826712e24ce8c1214e1299", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/7809294e4799cc7419826712e24ce8c1214e1299", "committedDate": "2020-02-28T00:52:10Z", "message": "Use HiveFileContext for StripeMetadataSource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0450d9c099cc182afc1019155dfb29afe3a02be6", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/0450d9c099cc182afc1019155dfb29afe3a02be6", "committedDate": "2020-02-28T07:55:43Z", "message": "Separate QueryException into two classes\n\nCluster connection failure and Presto query failure are two different\ntypes of QueryException. Separate them into 2 sub-classes of\nQueryException for better encapsulation.\n\nRemove unused method in AbstractVerification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d5d89ded7f06934d931baa238988b0e1093b28a", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/7d5d89ded7f06934d931baa238988b0e1093b28a", "committedDate": "2020-02-28T22:27:56Z", "message": "Remove AbstractPrestoQueryFailureResolver\n\nThis abstract implementation of FailureResolver made inconsistent\nassumption. It supports specifying the expected QueryStage in order\nfor resolution to happen, but it exposes an abstract method\nresolveTestQueryFailure, which assumes test query are failed.\n\nInstead, we should be able to resolve checksum query failure as well.\n\nAlso, update resolve message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cfa17ae86f1f1c15a38fe677fbafe393c9fa8f7", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/1cfa17ae86f1f1c15a38fe677fbafe393c9fa8f7", "committedDate": "2020-02-28T22:27:56Z", "message": "Allow failure resolvers to be disabled individually\n\nFor each failure resolver, a configuration property is available to\nenable and disable the resolver, in the format of\n<name>.failure-resolver.enable, e.g. too-many-open-partitions.failure-\nresolver.enable.\n\nThe failure resolvers can still be disabled altogether by\nfailure-resolver.enabled.\n\nAlso,\n- Do not require factory class for simple FailureResolver.\n- Simplify FailureResolverFactoryContext.\n- Seperate specfic resolver config into separate class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55b2bf5de1172472a8694fe28ca08facbc0d463c", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/55b2bf5de1172472a8694fe28ca08facbc0d463c", "committedDate": "2020-02-28T22:27:56Z", "message": "Distinguish between control, test, and determinism analysis checksum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a903da14ab8e81ee33f386a8bf2ea45b84eb7b00", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a903da14ab8e81ee33f386a8bf2ea45b84eb7b00", "committedDate": "2020-02-28T22:28:30Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fbb53435e03cfb57c7b9236a68460aedc7b77a0", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/9fbb53435e03cfb57c7b9236a68460aedc7b77a0", "committedDate": "2020-02-28T07:55:44Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}, "afterCommit": {"oid": "a903da14ab8e81ee33f386a8bf2ea45b84eb7b00", "author": {"user": {"login": "caithagoras", "name": "Leiqing Cai"}}, "url": "https://github.com/prestodb/presto/commit/a903da14ab8e81ee33f386a8bf2ea45b84eb7b00", "committedDate": "2020-02-28T22:28:30Z", "message": "Resolve checksum query compiler error instead of skipping it\n\nAlso, only resolve for control checksum failure."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NzIzODUy", "url": "https://github.com/prestodb/presto/pull/14148#pullrequestreview-366723852", "createdAt": "2020-02-28T22:31:03Z", "commit": {"oid": "a903da14ab8e81ee33f386a8bf2ea45b84eb7b00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2319, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}