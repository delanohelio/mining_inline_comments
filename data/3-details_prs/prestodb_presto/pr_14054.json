{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNTM3NjU0", "number": 14054, "title": "Improve verification for map columns", "bodyText": "Part of #13809\n== RELEASE NOTES ==\n\nVerifier Changes\n* Add checks for keys, values, and cardinality sum when validating a map column.", "createdAt": "2020-02-03T21:44:47Z", "url": "https://github.com/prestodb/presto/pull/14054", "merged": true, "mergeCommit": {"oid": "6e24976c079481a4dd7d0220c1d2c6f3603b9daf"}, "closed": true, "closedAt": "2020-02-18T15:09:29Z", "author": {"login": "brendan-driscoll"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcA0mhGgFqTM1MjYwNTYxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcD_Y5UABqjMwMzYwNjAzMzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjA1NjEz", "url": "https://github.com/prestodb/presto/pull/14054#pullrequestreview-352605613", "createdAt": "2020-02-03T22:21:48Z", "commit": {"oid": "a80129143eb365ef0d5c8a8111dd625d629927a0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QyMjoyMTo0OFrOFlCCiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QyMjoyMjoxMlrOFlCDJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM3NTA1MQ==", "bodyText": "This doesn't seem right. I think we need to have multiple columns here, e.g. checksum(m), checksum(array_sort(map_keys(m))) and checksum(array_sort(map_values(m)))", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r374375051", "createdAt": "2020-02-03T22:21:48Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/MapColumnValidator.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.verifier.checksum;\n+\n+import com.facebook.presto.spi.type.MapType;\n+import com.facebook.presto.spi.type.Type;\n+import com.facebook.presto.sql.tree.CoalesceExpression;\n+import com.facebook.presto.sql.tree.Expression;\n+import com.facebook.presto.sql.tree.FunctionCall;\n+import com.facebook.presto.sql.tree.LongLiteral;\n+import com.facebook.presto.sql.tree.QualifiedName;\n+import com.facebook.presto.sql.tree.SingleColumn;\n+import com.facebook.presto.verifier.framework.Column;\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.inject.Inject;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.verifier.framework.VerifierUtil.delimitedIdentifier;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static java.lang.String.format;\n+\n+public class MapColumnValidator\n+        implements ColumnValidator\n+{\n+    @Inject\n+    public MapColumnValidator()\n+    {\n+    }\n+\n+    @Override\n+    public List<SingleColumn> generateChecksumColumns(Column column)\n+    {\n+        checkArgument(column.getType() instanceof MapType, \"Expect MapType, found %s\", column.getType().getDisplayName());\n+        Type keyType = ((MapType) column.getType()).getKeyType();\n+        Type valueType = ((MapType) column.getType()).getValueType();\n+\n+        ImmutableList.Builder<Expression> checksums = ImmutableList.builder();\n+        checksums.add(new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(column.getIdentifier())));\n+\n+        Expression mapCardinalitySum = new CoalesceExpression(\n+                new FunctionCall(\n+                        QualifiedName.of(\"sum\"),\n+                        ImmutableList.of(new FunctionCall(QualifiedName.of(\"cardinality\"), ImmutableList.of(column.getIdentifier())))),\n+                new LongLiteral(\"0\"));\n+\n+        if (keyType.isOrderable()) {\n+            FunctionCall mapKeys = new FunctionCall(QualifiedName.of(\"map_keys\"), ImmutableList.of(column.getIdentifier()));\n+            FunctionCall sortKeys = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapKeys));\n+            checksums.add(new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortKeys)));\n+        }\n+\n+        if (valueType.isOrderable()) {\n+            FunctionCall mapValues = new FunctionCall(QualifiedName.of(\"map_values\"), ImmutableList.of(column.getIdentifier()));\n+            FunctionCall sortValues = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapValues));\n+            checksums.add(new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortValues)));\n+        }\n+\n+        return ImmutableList.of(\n+                new SingleColumn(new CoalesceExpression(checksums.build()), Optional.of(delimitedIdentifier(getChecksumColumnAlias(column)))),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a80129143eb365ef0d5c8a8111dd625d629927a0"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM3NTIwNA==", "bodyText": "Shouldn't there be separate checksums for keys and values?", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r374375204", "createdAt": "2020-02-03T22:22:12Z", "author": {"login": "mbasmanova"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/MapColumnValidator.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.verifier.checksum;\n+\n+import com.facebook.presto.spi.type.MapType;\n+import com.facebook.presto.spi.type.Type;\n+import com.facebook.presto.sql.tree.CoalesceExpression;\n+import com.facebook.presto.sql.tree.Expression;\n+import com.facebook.presto.sql.tree.FunctionCall;\n+import com.facebook.presto.sql.tree.LongLiteral;\n+import com.facebook.presto.sql.tree.QualifiedName;\n+import com.facebook.presto.sql.tree.SingleColumn;\n+import com.facebook.presto.verifier.framework.Column;\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.inject.Inject;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.verifier.framework.VerifierUtil.delimitedIdentifier;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static java.lang.String.format;\n+\n+public class MapColumnValidator\n+        implements ColumnValidator\n+{\n+    @Inject\n+    public MapColumnValidator()\n+    {\n+    }\n+\n+    @Override\n+    public List<SingleColumn> generateChecksumColumns(Column column)\n+    {\n+        checkArgument(column.getType() instanceof MapType, \"Expect MapType, found %s\", column.getType().getDisplayName());\n+        Type keyType = ((MapType) column.getType()).getKeyType();\n+        Type valueType = ((MapType) column.getType()).getValueType();\n+\n+        ImmutableList.Builder<Expression> checksums = ImmutableList.builder();\n+        checksums.add(new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(column.getIdentifier())));\n+\n+        Expression mapCardinalitySum = new CoalesceExpression(\n+                new FunctionCall(\n+                        QualifiedName.of(\"sum\"),\n+                        ImmutableList.of(new FunctionCall(QualifiedName.of(\"cardinality\"), ImmutableList.of(column.getIdentifier())))),\n+                new LongLiteral(\"0\"));\n+\n+        if (keyType.isOrderable()) {\n+            FunctionCall mapKeys = new FunctionCall(QualifiedName.of(\"map_keys\"), ImmutableList.of(column.getIdentifier()));\n+            FunctionCall sortKeys = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapKeys));\n+            checksums.add(new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortKeys)));\n+        }\n+\n+        if (valueType.isOrderable()) {\n+            FunctionCall mapValues = new FunctionCall(QualifiedName.of(\"map_values\"), ImmutableList.of(column.getIdentifier()));\n+            FunctionCall sortValues = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapValues));\n+            checksums.add(new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortValues)));\n+        }\n+\n+        return ImmutableList.of(\n+                new SingleColumn(new CoalesceExpression(checksums.build()), Optional.of(delimitedIdentifier(getChecksumColumnAlias(column)))),\n+                new SingleColumn(mapCardinalitySum, Optional.of(delimitedIdentifier(getCardinalitySumColumnAlias(column)))));\n+    }\n+\n+    @Override\n+    public ColumnMatchResult validate(Column column, ChecksumResult controlResult, ChecksumResult testResult)\n+    {\n+        String checksumColumnAlias = getChecksumColumnAlias(column);\n+        Object controlChecksum = controlResult.getChecksum(checksumColumnAlias);\n+        Object testChecksum = testResult.getChecksum(checksumColumnAlias);\n+\n+        String cardinalitySumColumnAlias = getCardinalitySumColumnAlias(column);\n+        Object controlCardinalitySum = controlResult.getChecksum(cardinalitySumColumnAlias);\n+        Object testCardinalitySum = testResult.getChecksum(cardinalitySumColumnAlias);\n+\n+        return new ColumnMatchResult(\n+                Objects.equals(controlChecksum, testChecksum) && Objects.equals(controlCardinalitySum, testCardinalitySum),\n+                format(\n+                        \"control(checksum: %s, cardinality_sum: %s) test(checksum: %s, cardinality_sum: %s)\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a80129143eb365ef0d5c8a8111dd625d629927a0"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MDAzMDUw", "url": "https://github.com/prestodb/presto/pull/14054#pullrequestreview-354003050", "createdAt": "2020-02-05T20:02:07Z", "commit": {"oid": "e7a519d9f9153feb5349e185b8e73524ff8ec56b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMDowNToyMVrOFmFecA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMDoxMjowOFrOFmFqWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ3OTkyMA==", "bodyText": "typo: value", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r375479920", "createdAt": "2020-02-05T20:05:21Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/MapColumnValidator.java", "diffHunk": "@@ -0,0 +1,140 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.verifier.checksum;\n+\n+import com.facebook.presto.spi.type.MapType;\n+import com.facebook.presto.spi.type.Type;\n+import com.facebook.presto.sql.tree.CoalesceExpression;\n+import com.facebook.presto.sql.tree.Expression;\n+import com.facebook.presto.sql.tree.FunctionCall;\n+import com.facebook.presto.sql.tree.LongLiteral;\n+import com.facebook.presto.sql.tree.QualifiedName;\n+import com.facebook.presto.sql.tree.SingleColumn;\n+import com.facebook.presto.verifier.framework.Column;\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.inject.Inject;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.verifier.framework.VerifierUtil.delimitedIdentifier;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static java.lang.String.format;\n+\n+public class MapColumnValidator\n+        implements ColumnValidator\n+{\n+    @Inject\n+    public MapColumnValidator()\n+    {\n+    }\n+\n+    @Override\n+    public List<SingleColumn> generateChecksumColumns(Column column)\n+    {\n+        checkArgument(column.getType() instanceof MapType, \"Expect MapType, found %s\", column.getType().getDisplayName());\n+        Type keyType = ((MapType) column.getType()).getKeyType();\n+        Type valueType = ((MapType) column.getType()).getValueType();\n+\n+        Expression checksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(column.getIdentifier()));\n+\n+        Expression keysChecksum;\n+        FunctionCall mapKeys = new FunctionCall(QualifiedName.of(\"map_keys\"), ImmutableList.of(column.getIdentifier()));\n+        if (keyType.isOrderable()) {\n+            FunctionCall sortKeys = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapKeys));\n+            keysChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortKeys));\n+        }\n+        else {\n+            keysChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(mapKeys));\n+        }\n+\n+        Expression valuesChecksum;\n+        FunctionCall mapValues = new FunctionCall(QualifiedName.of(\"map_values\"), ImmutableList.of(column.getIdentifier()));\n+        if (valueType.isOrderable()) {\n+            FunctionCall sortValues = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapValues));\n+            valuesChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortValues));\n+        }\n+        else {\n+            valuesChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(mapValues));\n+        }\n+\n+        Expression mapCardinalitySum = new CoalesceExpression(\n+                new FunctionCall(\n+                        QualifiedName.of(\"sum\"),\n+                        ImmutableList.of(new FunctionCall(QualifiedName.of(\"cardinality\"), ImmutableList.of(column.getIdentifier())))),\n+                new LongLiteral(\"0\"));\n+\n+        return ImmutableList.of(\n+                new SingleColumn(checksum, Optional.of(delimitedIdentifier(getChecksumColumnAlias(column)))),\n+                new SingleColumn(keysChecksum, Optional.of(delimitedIdentifier(getKeysChecksumColumnAlias(column)))),\n+                new SingleColumn(valuesChecksum, Optional.of(delimitedIdentifier(getValuesChecksumColumnAlias(column)))),\n+                new SingleColumn(mapCardinalitySum, Optional.of(delimitedIdentifier(getCardinalitySumColumnAlias(column)))));\n+    }\n+\n+    @Override\n+    public ColumnMatchResult validate(Column column, ChecksumResult controlResult, ChecksumResult testResult)\n+    {\n+        String checksumColumnAlias = getChecksumColumnAlias(column);\n+        Object controlChecksum = controlResult.getChecksum(checksumColumnAlias);\n+        Object testChecksum = testResult.getChecksum(checksumColumnAlias);\n+\n+        String keysChecksumColumnAlias = getKeysChecksumColumnAlias(column);\n+        Object controlKeysChecksum = controlResult.getChecksum(keysChecksumColumnAlias);\n+        Object testKeysChecksum = testResult.getChecksum(keysChecksumColumnAlias);\n+\n+        String valuesChecksumColumnAlias = getValuesChecksumColumnAlias(column);\n+        Object controlValuesChecksum = controlResult.getChecksum(valuesChecksumColumnAlias);\n+        Object testValuesChecksum = testResult.getChecksum(valuesChecksumColumnAlias);\n+\n+        String cardinalitySumColumnAlias = getCardinalitySumColumnAlias(column);\n+        Object controlCardinalitySum = controlResult.getChecksum(cardinalitySumColumnAlias);\n+        Object testCardinalitySum = testResult.getChecksum(cardinalitySumColumnAlias);\n+\n+        return new ColumnMatchResult(\n+                Objects.equals(controlChecksum, testChecksum) && Objects.equals(controlCardinalitySum, testCardinalitySum),\n+                format(\n+                        \"control(checksum: %s, keys_checksum: %s, alues_checksum: %s, cardinality_sum: %s) \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7a519d9f9153feb5349e185b8e73524ff8ec56b"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ4MTM2Mw==", "bodyText": "Can be simplified as, as below\nFunctionCall keys = ...\nif (keyType.isOrderable()) {\n   keys = ...\n}\nExpression keysChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(keys));", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r375481363", "createdAt": "2020-02-05T20:08:38Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/MapColumnValidator.java", "diffHunk": "@@ -0,0 +1,140 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.verifier.checksum;\n+\n+import com.facebook.presto.spi.type.MapType;\n+import com.facebook.presto.spi.type.Type;\n+import com.facebook.presto.sql.tree.CoalesceExpression;\n+import com.facebook.presto.sql.tree.Expression;\n+import com.facebook.presto.sql.tree.FunctionCall;\n+import com.facebook.presto.sql.tree.LongLiteral;\n+import com.facebook.presto.sql.tree.QualifiedName;\n+import com.facebook.presto.sql.tree.SingleColumn;\n+import com.facebook.presto.verifier.framework.Column;\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.inject.Inject;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.verifier.framework.VerifierUtil.delimitedIdentifier;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static java.lang.String.format;\n+\n+public class MapColumnValidator\n+        implements ColumnValidator\n+{\n+    @Inject\n+    public MapColumnValidator()\n+    {\n+    }\n+\n+    @Override\n+    public List<SingleColumn> generateChecksumColumns(Column column)\n+    {\n+        checkArgument(column.getType() instanceof MapType, \"Expect MapType, found %s\", column.getType().getDisplayName());\n+        Type keyType = ((MapType) column.getType()).getKeyType();\n+        Type valueType = ((MapType) column.getType()).getValueType();\n+\n+        Expression checksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(column.getIdentifier()));\n+\n+        Expression keysChecksum;\n+        FunctionCall mapKeys = new FunctionCall(QualifiedName.of(\"map_keys\"), ImmutableList.of(column.getIdentifier()));\n+        if (keyType.isOrderable()) {\n+            FunctionCall sortKeys = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapKeys));\n+            keysChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortKeys));\n+        }\n+        else {\n+            keysChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(mapKeys));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7a519d9f9153feb5349e185b8e73524ff8ec56b"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ4Mjk3MA==", "bodyText": "Also make sure key checksum matches and and value checksum matches.\nnit: one condition per line for long line:\nObject.equals(...)\n    && Object.equals(...)\n    && Object.equals(...)\n    && Object.equals(...)", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r375482970", "createdAt": "2020-02-05T20:12:08Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/MapColumnValidator.java", "diffHunk": "@@ -0,0 +1,140 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.verifier.checksum;\n+\n+import com.facebook.presto.spi.type.MapType;\n+import com.facebook.presto.spi.type.Type;\n+import com.facebook.presto.sql.tree.CoalesceExpression;\n+import com.facebook.presto.sql.tree.Expression;\n+import com.facebook.presto.sql.tree.FunctionCall;\n+import com.facebook.presto.sql.tree.LongLiteral;\n+import com.facebook.presto.sql.tree.QualifiedName;\n+import com.facebook.presto.sql.tree.SingleColumn;\n+import com.facebook.presto.verifier.framework.Column;\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.inject.Inject;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.verifier.framework.VerifierUtil.delimitedIdentifier;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static java.lang.String.format;\n+\n+public class MapColumnValidator\n+        implements ColumnValidator\n+{\n+    @Inject\n+    public MapColumnValidator()\n+    {\n+    }\n+\n+    @Override\n+    public List<SingleColumn> generateChecksumColumns(Column column)\n+    {\n+        checkArgument(column.getType() instanceof MapType, \"Expect MapType, found %s\", column.getType().getDisplayName());\n+        Type keyType = ((MapType) column.getType()).getKeyType();\n+        Type valueType = ((MapType) column.getType()).getValueType();\n+\n+        Expression checksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(column.getIdentifier()));\n+\n+        Expression keysChecksum;\n+        FunctionCall mapKeys = new FunctionCall(QualifiedName.of(\"map_keys\"), ImmutableList.of(column.getIdentifier()));\n+        if (keyType.isOrderable()) {\n+            FunctionCall sortKeys = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapKeys));\n+            keysChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortKeys));\n+        }\n+        else {\n+            keysChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(mapKeys));\n+        }\n+\n+        Expression valuesChecksum;\n+        FunctionCall mapValues = new FunctionCall(QualifiedName.of(\"map_values\"), ImmutableList.of(column.getIdentifier()));\n+        if (valueType.isOrderable()) {\n+            FunctionCall sortValues = new FunctionCall(QualifiedName.of(\"array_sort\"), ImmutableList.of(mapValues));\n+            valuesChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(sortValues));\n+        }\n+        else {\n+            valuesChecksum = new FunctionCall(QualifiedName.of(\"checksum\"), ImmutableList.of(mapValues));\n+        }\n+\n+        Expression mapCardinalitySum = new CoalesceExpression(\n+                new FunctionCall(\n+                        QualifiedName.of(\"sum\"),\n+                        ImmutableList.of(new FunctionCall(QualifiedName.of(\"cardinality\"), ImmutableList.of(column.getIdentifier())))),\n+                new LongLiteral(\"0\"));\n+\n+        return ImmutableList.of(\n+                new SingleColumn(checksum, Optional.of(delimitedIdentifier(getChecksumColumnAlias(column)))),\n+                new SingleColumn(keysChecksum, Optional.of(delimitedIdentifier(getKeysChecksumColumnAlias(column)))),\n+                new SingleColumn(valuesChecksum, Optional.of(delimitedIdentifier(getValuesChecksumColumnAlias(column)))),\n+                new SingleColumn(mapCardinalitySum, Optional.of(delimitedIdentifier(getCardinalitySumColumnAlias(column)))));\n+    }\n+\n+    @Override\n+    public ColumnMatchResult validate(Column column, ChecksumResult controlResult, ChecksumResult testResult)\n+    {\n+        String checksumColumnAlias = getChecksumColumnAlias(column);\n+        Object controlChecksum = controlResult.getChecksum(checksumColumnAlias);\n+        Object testChecksum = testResult.getChecksum(checksumColumnAlias);\n+\n+        String keysChecksumColumnAlias = getKeysChecksumColumnAlias(column);\n+        Object controlKeysChecksum = controlResult.getChecksum(keysChecksumColumnAlias);\n+        Object testKeysChecksum = testResult.getChecksum(keysChecksumColumnAlias);\n+\n+        String valuesChecksumColumnAlias = getValuesChecksumColumnAlias(column);\n+        Object controlValuesChecksum = controlResult.getChecksum(valuesChecksumColumnAlias);\n+        Object testValuesChecksum = testResult.getChecksum(valuesChecksumColumnAlias);\n+\n+        String cardinalitySumColumnAlias = getCardinalitySumColumnAlias(column);\n+        Object controlCardinalitySum = controlResult.getChecksum(cardinalitySumColumnAlias);\n+        Object testCardinalitySum = testResult.getChecksum(cardinalitySumColumnAlias);\n+\n+        return new ColumnMatchResult(\n+                Objects.equals(controlChecksum, testChecksum) && Objects.equals(controlCardinalitySum, testCardinalitySum),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7a519d9f9153feb5349e185b8e73524ff8ec56b"}, "originalPosition": 107}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MDg3Nzkx", "url": "https://github.com/prestodb/presto/pull/14054#pullrequestreview-354087791", "createdAt": "2020-02-05T22:31:38Z", "commit": {"oid": "3dfe36c5e4b016c2b0ac1877e41ab82f04d46550"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjozMTozOFrOFmJdwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMjozNTo1NFrOFmJkAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0NTI4Mg==", "bodyText": "Your formatting is off. Please follow 7e and 7f  in https://our.internmc.facebook.com/intern/wiki/DataInfra/Presto/Source/\nto install Airlift code style, and then format the file with (option + cmd + L).", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r375545282", "createdAt": "2020-02-05T22:31:38Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/test/java/com/facebook/presto/verifier/checksum/TestChecksumValidator.java", "diffHunk": "@@ -297,9 +304,9 @@ public void testArray()\n         ChecksumResult controlChecksum = new ChecksumResult(\n                 5,\n                 ImmutableMap.<String, Object>builder()\n-                        .put(\"int_array_checksum\", new SqlVarbinary(new byte[] {0xa}))\n+                        .put(\"int_array_checksum\", new SqlVarbinary(new byte[]{0xa}))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dfe36c5e4b016c2b0ac1877e41ab82f04d46550"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU0Njg4Mw==", "bodyText": "nit: all arguments on the same line, or one argument per line. Same below.", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r375546883", "createdAt": "2020-02-05T22:35:54Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/test/java/com/facebook/presto/verifier/checksum/TestChecksumValidator.java", "diffHunk": "@@ -387,4 +394,70 @@ public void testRow()\n                         .put(ROW_COLUMN, new ColumnMatchResult(false, \"control(row_checksum: 0a, row$$col3_checksum: 0d) test(row_checksum: 1a, row$$col3_checksum: 1d)\"))\n                         .build());\n     }\n+\n+    @Test\n+    public void testMap()\n+    {\n+        List<Column> columns = ImmutableList.of(MAP_COLUMN);\n+\n+        ChecksumResult controlChecksum = new ChecksumResult(\n+                5,\n+                ImmutableMap.<String, Object>builder()\n+                        .put(\"map_checksum\", new SqlVarbinary(new byte[] {0xa}))\n+                        .put(\"map_keys_checksum\", new SqlVarbinary(new byte[] {0xb}))\n+                        .put(\"map_values_checksum\", new SqlVarbinary(new byte[] {0xc}))\n+                        .put(\"map_cardinality_sum\", 3L)\n+                        .build());\n+\n+        // Matched\n+        assertTrue(checksumValidator.getMismatchedColumns(columns, controlChecksum, controlChecksum).isEmpty());\n+\n+        // Mismatched map checksum\n+        ChecksumResult testChecksum = new ChecksumResult(\n+                5,\n+                ImmutableMap.<String, Object>builder()\n+                        .put(\"map_checksum\", new SqlVarbinary(new byte[]{0x1a}))\n+                        .put(\"map_keys_checksum\", new SqlVarbinary(new byte[]{0x0b}))\n+                        .put(\"map_values_checksum\", new SqlVarbinary(new byte[]{0x0c}))\n+                        .put(\"map_cardinality_sum\", 3L)\n+                        .build());\n+        assertEquals(\n+                checksumValidator.getMismatchedColumns(columns, controlChecksum, testChecksum),\n+                ImmutableMap.builder()\n+                        .put(MAP_COLUMN, new ColumnMatchResult(false, \"control(checksum: 0a, keys_checksum: 0b, values_checksum: 0c, cardinality_sum: 3) \" +\n+                                \"test(checksum: 1a, keys_checksum: 0b, values_checksum: 0c, cardinality_sum: 3)\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dfe36c5e4b016c2b0ac1877e41ab82f04d46550"}, "originalPosition": 106}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41ab1633f9f1026e83fd79af0919ebc8a013ec3d", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/41ab1633f9f1026e83fd79af0919ebc8a013ec3d", "committedDate": "2020-02-06T15:39:45Z", "message": "Merge branch 'verify-map-columns' of github.com:brendan-driscoll/presto into verify-map-columns"}, "afterCommit": {"oid": "cb58b5928b9b111581bcc9d547436164ae874183", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/cb58b5928b9b111581bcc9d547436164ae874183", "committedDate": "2020-02-06T16:28:26Z", "message": "Initial commit: add verification mismatch info for map columns\n\nAdd separate columns for map keys checksum and values checksum\n\nAddress code comments and add tests\n\nFix formatting\n\nFix formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0ODI3ODAx", "url": "https://github.com/prestodb/presto/pull/14054#pullrequestreview-354827801", "createdAt": "2020-02-06T22:49:46Z", "commit": {"oid": "cb58b5928b9b111581bcc9d547436164ae874183"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb58b5928b9b111581bcc9d547436164ae874183", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/cb58b5928b9b111581bcc9d547436164ae874183", "committedDate": "2020-02-06T16:28:26Z", "message": "Initial commit: add verification mismatch info for map columns\n\nAdd separate columns for map keys checksum and values checksum\n\nAddress code comments and add tests\n\nFix formatting\n\nFix formatting"}, "afterCommit": {"oid": "c36408419e2eb8820390d27a6a2aff9e1d5fb33b", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/c36408419e2eb8820390d27a6a2aff9e1d5fb33b", "committedDate": "2020-02-07T15:59:43Z", "message": "Improve verification for map columns"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c36408419e2eb8820390d27a6a2aff9e1d5fb33b", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/c36408419e2eb8820390d27a6a2aff9e1d5fb33b", "committedDate": "2020-02-07T15:59:43Z", "message": "Improve verification for map columns"}, "afterCommit": {"oid": "2cbe26951bf8480f2bced6848bb3da6f9b0206ba", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/2cbe26951bf8480f2bced6848bb3da6f9b0206ba", "committedDate": "2020-02-10T16:06:25Z", "message": "Resolve merge conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2cbe26951bf8480f2bced6848bb3da6f9b0206ba", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/2cbe26951bf8480f2bced6848bb3da6f9b0206ba", "committedDate": "2020-02-10T16:06:25Z", "message": "Resolve merge conflicts"}, "afterCommit": {"oid": "1022df1279ef704f4b37d77b01769fa0ceca8db0", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/1022df1279ef704f4b37d77b01769fa0ceca8db0", "committedDate": "2020-02-10T16:23:40Z", "message": "Improve verification for map columns\n\nAdd checksums for map key, values and map sizes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f673412c056699dbd97fda5f9cb5b6954a5aed1f", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/f673412c056699dbd97fda5f9cb5b6954a5aed1f", "committedDate": "2020-02-12T16:53:06Z", "message": "Fix failing tests"}, "afterCommit": {"oid": "a8a94472ea4c9d0964faac46082c829a94a2c2a2", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/a8a94472ea4c9d0964faac46082c829a94a2c2a2", "committedDate": "2020-02-12T16:54:23Z", "message": "Improve verification for map columns\n\nAdd checksums for map key, values and map sizes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3OTQyMzU2", "url": "https://github.com/prestodb/presto/pull/14054#pullrequestreview-357942356", "createdAt": "2020-02-13T04:02:54Z", "commit": {"oid": "a8a94472ea4c9d0964faac46082c829a94a2c2a2"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNDowMjo1NVrOFpGaBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNDowMzozNlrOFpGaqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0MDkwMw==", "bodyText": "You can combine those mismatched cases into one.\nAlso, add a test case where the key/value are not orderable and hence the array_sort function call is not used.", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r378640903", "createdAt": "2020-02-13T04:02:55Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/test/java/com/facebook/presto/verifier/checksum/TestChecksumValidator.java", "diffHunk": "@@ -387,6 +393,78 @@ public void testRow()\n                         .build());\n     }\n \n+    @Test\n+    public void testMap()\n+    {\n+        List<Column> columns = ImmutableList.of(MAP_COLUMN);\n+\n+        ChecksumResult controlChecksum = new ChecksumResult(\n+                5,\n+                ImmutableMap.<String, Object>builder()\n+                        .put(\"map_checksum\", new SqlVarbinary(new byte[] {0xa}))\n+                        .put(\"map_keys_checksum\", new SqlVarbinary(new byte[] {0xb}))\n+                        .put(\"map_values_checksum\", new SqlVarbinary(new byte[] {0xc}))\n+                        .put(\"map_cardinality_sum\", 3L)\n+                        .build());\n+\n+        // Matched\n+        assertTrue(checksumValidator.getMismatchedColumns(columns, controlChecksum, controlChecksum).isEmpty());\n+\n+        // Mismatched map checksum\n+        ChecksumResult testChecksum = new ChecksumResult(\n+                5,\n+                ImmutableMap.<String, Object>builder()\n+                        .put(\"map_checksum\", new SqlVarbinary(new byte[] {0x1a}))\n+                        .put(\"map_keys_checksum\", new SqlVarbinary(new byte[] {0x0b}))\n+                        .put(\"map_values_checksum\", new SqlVarbinary(new byte[] {0x0c}))\n+                        .put(\"map_cardinality_sum\", 3L)\n+                        .build());\n+\n+        String expectedOutput = \"control(checksum: 0a, keys_checksum: 0b, values_checksum: 0c, cardinality_sum: 3) \" +\n+                \"test(checksum: 1a, keys_checksum: 0b, values_checksum: 0c, cardinality_sum: 3)\";\n+        assertEquals(\n+                checksumValidator.getMismatchedColumns(columns, controlChecksum, testChecksum),\n+                ImmutableMap.builder()\n+                        .put(MAP_COLUMN, new ColumnMatchResult(false, MAP_COLUMN, expectedOutput))\n+                        .build());\n+\n+        // Mismatched map keys & values checksum\n+        testChecksum = new ChecksumResult(\n+                5,\n+                ImmutableMap.<String, Object>builder()\n+                        .put(\"map_checksum\", new SqlVarbinary(new byte[] {0x0a}))\n+                        .put(\"map_keys_checksum\", new SqlVarbinary(new byte[] {0x1b}))\n+                        .put(\"map_values_checksum\", new SqlVarbinary(new byte[] {0x1c}))\n+                        .put(\"map_cardinality_sum\", 3L)\n+                        .build());\n+\n+        expectedOutput = \"control(checksum: 0a, keys_checksum: 0b, values_checksum: 0c, cardinality_sum: 3) \" +\n+                \"test(checksum: 0a, keys_checksum: 1b, values_checksum: 1c, cardinality_sum: 3)\";\n+        assertEquals(\n+                checksumValidator.getMismatchedColumns(columns, controlChecksum, testChecksum),\n+                ImmutableMap.builder()\n+                        .put(MAP_COLUMN, new ColumnMatchResult(false, MAP_COLUMN, expectedOutput))\n+                        .build());\n+\n+        // Mismatched map cardinality sum\n+        testChecksum = new ChecksumResult(\n+                5,\n+                ImmutableMap.<String, Object>builder()\n+                        .put(\"map_checksum\", new SqlVarbinary(new byte[] {0x0a}))\n+                        .put(\"map_keys_checksum\", new SqlVarbinary(new byte[] {0x0b}))\n+                        .put(\"map_values_checksum\", new SqlVarbinary(new byte[] {0x0c}))\n+                        .put(\"map_cardinality_sum\", 4L)\n+                        .build());\n+\n+        expectedOutput = \"control(checksum: 0a, keys_checksum: 0b, values_checksum: 0c, cardinality_sum: 3) \" +\n+                \"test(checksum: 0a, keys_checksum: 0b, values_checksum: 0c, cardinality_sum: 4)\";\n+        assertEquals(\n+                checksumValidator.getMismatchedColumns(columns, controlChecksum, testChecksum),\n+                ImmutableMap.builder()\n+                        .put(MAP_COLUMN, new ColumnMatchResult(false, MAP_COLUMN, expectedOutput))\n+                        .build());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a94472ea4c9d0964faac46082c829a94a2c2a2"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0MTA2Ng==", "bodyText": "Usually, one line for empty constructor:\npublic MapColumnValidator() {}", "url": "https://github.com/prestodb/presto/pull/14054#discussion_r378641066", "createdAt": "2020-02-13T04:03:36Z", "author": {"login": "caithagoras"}, "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/checksum/MapColumnValidator.java", "diffHunk": "@@ -0,0 +1,133 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.verifier.checksum;\n+\n+import com.facebook.presto.spi.type.MapType;\n+import com.facebook.presto.spi.type.Type;\n+import com.facebook.presto.sql.tree.CoalesceExpression;\n+import com.facebook.presto.sql.tree.Expression;\n+import com.facebook.presto.sql.tree.LongLiteral;\n+import com.facebook.presto.sql.tree.SingleColumn;\n+import com.facebook.presto.verifier.framework.Column;\n+import com.google.common.collect.ImmutableList;\n+\n+import javax.inject.Inject;\n+\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import static com.facebook.presto.sql.QueryUtil.functionCall;\n+import static com.facebook.presto.verifier.framework.VerifierUtil.delimitedIdentifier;\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static java.lang.String.format;\n+\n+public class MapColumnValidator\n+        implements ColumnValidator\n+{\n+    @Inject\n+    public MapColumnValidator()\n+    {\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a94472ea4c9d0964faac46082c829a94a2c2a2"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b6846fd4419c4f3212ae47be128c78c068d0fb1", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/3b6846fd4419c4f3212ae47be128c78c068d0fb1", "committedDate": "2020-02-13T18:38:39Z", "message": "Improve verification for map columns\n\nAdd checksums for map key, values and map sizes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "006c1f3ea9cf346d348d8b403ee2f1e5cdff7860", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/006c1f3ea9cf346d348d8b403ee2f1e5cdff7860", "committedDate": "2020-02-13T18:38:17Z", "message": "Consolidate map test + add non-orderable map test"}, "afterCommit": {"oid": "3b6846fd4419c4f3212ae47be128c78c068d0fb1", "author": {"user": {"login": "brendan-driscoll", "name": null}}, "url": "https://github.com/prestodb/presto/commit/3b6846fd4419c4f3212ae47be128c78c068d0fb1", "committedDate": "2020-02-13T18:38:39Z", "message": "Improve verification for map columns\n\nAdd checksums for map key, values and map sizes."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2550, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}