{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NDE1NjYy", "number": 14886, "title": "Unify grouped execution properties", "bodyText": "Turn grouped execution on by default and introduce a new property grouped_execution to eventually replace all other grouped execution properties\n#14885\n== RELEASE NOTES ==\nGeneral Changes\n* Enable ``dynamic-schedule-for-grouped-execution`` by default.  In future releases, we will remove this property, and grouped execution will always use dynamic scheduling.\n* Enable ``grouped-execution-for-aggregation`` and ``experimental.grouped-execution-for-eligible-table-scans`` by default\n* Introduce new configuration property ``grouped-execution-enabled`` and session property ``grouped_execution`` to turn grouped execution on or off.  This property is true by default.  If set to false, it is equivalent to setting all of ``grouped-execution-for-aggregation``, ``grouped-execution-for-join``, and ``experimental.grouped-execution-for-eligible-table-scans`` to false.  In future releases we will remove these other properties and only have a single switch for enabling and disabling grouped execution.", "createdAt": "2020-07-24T17:55:11Z", "url": "https://github.com/prestodb/presto/pull/14886", "merged": true, "mergeCommit": {"oid": "7cb1d7a1500a0d552f735ffec74642ba426c29aa"}, "closed": true, "closedAt": "2020-07-27T17:51:57Z", "author": {"login": "rschlussel"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4JByEAFqTQ1NTEyNzg3MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5EEYJABqjM1OTA1Njc3Nzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTI3ODcx", "url": "https://github.com/prestodb/presto/pull/14886#pullrequestreview-455127871", "createdAt": "2020-07-24T19:16:56Z", "commit": {"oid": "33edfb72968de62244128b1ee785b8def08fa791"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33edfb72968de62244128b1ee785b8def08fa791", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/33edfb72968de62244128b1ee785b8def08fa791", "committedDate": "2020-07-24T17:36:43Z", "message": "Unify grouped execution properties"}, "afterCommit": {"oid": "7d3eaa50f02e0f6fa6328f84086bda35fef7164a", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/7d3eaa50f02e0f6fa6328f84086bda35fef7164a", "committedDate": "2020-07-27T15:43:10Z", "message": "Unify grouped execution properties\n\nAdd grouped-execution-enabled property to replace\ngrouped-execution-for-aggregation-enabled,\ngrouped-execution-for-join-enabled,\ngrouped-execution-for-eligible-tablescans-enabled.  These other\nproperties will be removed in a future release."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTA2ODY5", "url": "https://github.com/prestodb/presto/pull/14886#pullrequestreview-455906869", "createdAt": "2020-07-27T15:44:57Z", "commit": {"oid": "33edfb72968de62244128b1ee785b8def08fa791"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNTo1NjowNFrOG3o33g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNTo1NjowNFrOG3o33g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NDUyNg==", "bodyText": "Personally I would prefer to disable the grouped execution for local query runner explicitly (or at least explicitly check for the forceSinceNode flag).", "url": "https://github.com/prestodb/presto/pull/14886#discussion_r460994526", "createdAt": "2020-07-27T15:56:04Z", "author": {"login": "arhimondr"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/PlanFragmenter.java", "diffHunk": "@@ -248,7 +248,7 @@ private SubPlan analyzeGroupedExecution(Session session, SubPlan subPlan, boolea\n     {\n         PlanFragment fragment = subPlan.getFragment();\n         GroupedExecutionProperties properties = fragment.getRoot().accept(new GroupedExecutionTagger(session, metadata, nodePartitioningManager), null);\n-        if (properties.isSubTreeUseful()) {\n+        if (properties.isSubTreeUseful() && !(fragment.getPartitioning().getConnectorHandle() instanceof SystemPartitioningHandle)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d3eaa50f02e0f6fa6328f84086bda35fef7164a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e9a2fd7f039fbbd732feacbaedbcabe785d41dd", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/5e9a2fd7f039fbbd732feacbaedbcabe785d41dd", "committedDate": "2020-07-27T16:03:51Z", "message": "Don't try grouped execution for forceSingleNode\n\nGrouped execution is not supported for SystemPartitioningHandles, and\nwill fail gettting the bucket node map. forceSingleNode uses\nSystemPartitioningHandle.SINGLE_DISTRIBUTION as the partitioning."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c210f1e384f5980e2b4251f32f9d62f2ee709b7e", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/c210f1e384f5980e2b4251f32f9d62f2ee709b7e", "committedDate": "2020-07-27T16:03:51Z", "message": "Enable grouped execution by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ff7709248d881b38778dea7e2b59d6b59215a5f", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/9ff7709248d881b38778dea7e2b59d6b59215a5f", "committedDate": "2020-07-27T16:03:51Z", "message": "Unify grouped execution properties\n\nAdd grouped-execution-enabled property to replace\ngrouped-execution-for-aggregation-enabled,\ngrouped-execution-for-join-enabled,\ngrouped-execution-for-eligible-tablescans-enabled.  These other\nproperties will be removed in a future release."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d3eaa50f02e0f6fa6328f84086bda35fef7164a", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/7d3eaa50f02e0f6fa6328f84086bda35fef7164a", "committedDate": "2020-07-27T15:43:10Z", "message": "Unify grouped execution properties\n\nAdd grouped-execution-enabled property to replace\ngrouped-execution-for-aggregation-enabled,\ngrouped-execution-for-join-enabled,\ngrouped-execution-for-eligible-tablescans-enabled.  These other\nproperties will be removed in a future release."}, "afterCommit": {"oid": "9ff7709248d881b38778dea7e2b59d6b59215a5f", "author": {"user": {"login": "rschlussel", "name": "Rebecca Schlussel"}}, "url": "https://github.com/prestodb/presto/commit/9ff7709248d881b38778dea7e2b59d6b59215a5f", "committedDate": "2020-07-27T16:03:51Z", "message": "Unify grouped execution properties\n\nAdd grouped-execution-enabled property to replace\ngrouped-execution-for-aggregation-enabled,\ngrouped-execution-for-join-enabled,\ngrouped-execution-for-eligible-tablescans-enabled.  These other\nproperties will be removed in a future release."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 319, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}