{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NjQwNjcw", "number": 14816, "title": "Include scheduling stats of bucketed table to NodeSelectionStats", "bodyText": "== NO RELEASE NOTE ==", "createdAt": "2020-07-09T06:11:27Z", "url": "https://github.com/prestodb/presto/pull/14816", "merged": true, "mergeCommit": {"oid": "058bda43f81e2819f7a2cb8deccc3f014e06815e"}, "closed": true, "closedAt": "2020-07-13T18:21:26Z", "author": {"login": "kewang1024"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczSZbSgBqjM1MzA3MTUwNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0lcz3AFqTQ0NzQ4MzAwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fae28522781aa9109630654d16a3b2e8d12ee163", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/fae28522781aa9109630654d16a3b2e8d12ee163", "committedDate": "2020-07-09T06:06:46Z", "message": "Include scheduling stats of bucketed table to NodeSelectionStats\n\nPreviously we only took scheduling for unbucketed situation into\nconsideration for NodeSelectionStats, which is not sufficient.\nNow add scheduling stats for bucketed table to NodeSelectionStats\nas well."}, "afterCommit": {"oid": "9fa80a460dcf46b5d5ffc9c931a3859c5d4e2c4a", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/9fa80a460dcf46b5d5ffc9c931a3859c5d4e2c4a", "committedDate": "2020-07-09T17:21:44Z", "message": "Include scheduling stats of bucketed table to NodeSelectionStats\n\nPreviously we only took scheduling for unbucketed situation into\nconsideration for NodeSelectionStats, which is not sufficient.\nNow add scheduling stats for bucketed table to NodeSelectionStats\nas well."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fa80a460dcf46b5d5ffc9c931a3859c5d4e2c4a", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/9fa80a460dcf46b5d5ffc9c931a3859c5d4e2c4a", "committedDate": "2020-07-09T17:21:44Z", "message": "Include scheduling stats of bucketed table to NodeSelectionStats\n\nPreviously we only took scheduling for unbucketed situation into\nconsideration for NodeSelectionStats, which is not sufficient.\nNow add scheduling stats for bucketed table to NodeSelectionStats\nas well."}, "afterCommit": {"oid": "3da4f50e8323c14330e70c7ee4d32927637efb97", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/3da4f50e8323c14330e70c7ee4d32927637efb97", "committedDate": "2020-07-09T19:19:30Z", "message": "Include scheduling stats of bucketed table to NodeSelectionStats\n\nPreviously we only took scheduling for unbucketed situation into\nconsideration for NodeSelectionStats, which is not sufficient.\nNow add scheduling stats for bucketed table to NodeSelectionStats\nas well."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NjEyNjc5", "url": "https://github.com/prestodb/presto/pull/14816#pullrequestreview-446612679", "createdAt": "2020-07-10T18:29:42Z", "commit": {"oid": "3da4f50e8323c14330e70c7ee4d32927637efb97"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxODoyOTo0MlrOGwBSeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxODozMToyOVrOGwBVxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNTk0NA==", "bodyText": "nit: \"nodeSelectionStats is null\"", "url": "https://github.com/prestodb/presto/pull/14816#discussion_r453005944", "createdAt": "2020-07-10T18:29:42Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/nodeSelection/TopologyAwareNodeSelector.java", "diffHunk": "@@ -85,6 +87,7 @@ public TopologyAwareNodeSelector(\n             NetworkLocationCache networkLocationCache)\n     {\n         this.nodeManager = requireNonNull(nodeManager, \"nodeManager is null\");\n+        this.nodeSelectionStats = requireNonNull(nodeSelectionStats, \"nodeSelectionStats\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3da4f50e8323c14330e70c7ee4d32927637efb97"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNjc4OQ==", "bodyText": "Sorry if it is mentioned before, does bucketed table node selection have non-primary preferred node?", "url": "https://github.com/prestodb/presto/pull/14816#discussion_r453006789", "createdAt": "2020-07-10T18:31:29Z", "author": {"login": "shixuan-fan"}, "path": "presto-main/src/main/java/com/facebook/presto/execution/scheduler/NodeScheduler.java", "diffHunk": "@@ -308,6 +310,10 @@ public static SplitPlacementResult selectDistributionNodes(\n                     assignmentStats.getQueuedSplitCountForStage(node) < maxPendingSplitsPerTask) {\n                 if (isCacheable) {\n                     split = new Split(split.getConnectorId(), split.getTransactionHandle(), split.getConnectorSplit(), split.getLifespan(), new SplitContext(true));\n+                    nodeSelectionStats.incrementBucketedPreferredNodeSelectedCount();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3da4f50e8323c14330e70c7ee4d32927637efb97"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cdcb1715974865c844e38bc658587ce105bd904", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/0cdcb1715974865c844e38bc658587ce105bd904", "committedDate": "2020-07-10T18:38:58Z", "message": "Include scheduling stats of bucketed table to NodeSelectionStats\n\nPreviously we only took scheduling for unbucketed situation into\nconsideration for NodeSelectionStats, which is not sufficient.\nNow add scheduling stats for bucketed table to NodeSelectionStats\nas well."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3da4f50e8323c14330e70c7ee4d32927637efb97", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/3da4f50e8323c14330e70c7ee4d32927637efb97", "committedDate": "2020-07-09T19:19:30Z", "message": "Include scheduling stats of bucketed table to NodeSelectionStats\n\nPreviously we only took scheduling for unbucketed situation into\nconsideration for NodeSelectionStats, which is not sufficient.\nNow add scheduling stats for bucketed table to NodeSelectionStats\nas well."}, "afterCommit": {"oid": "0cdcb1715974865c844e38bc658587ce105bd904", "author": {"user": {"login": "kewang1024", "name": "Ke"}}, "url": "https://github.com/prestodb/presto/commit/0cdcb1715974865c844e38bc658587ce105bd904", "committedDate": "2020-07-10T18:38:58Z", "message": "Include scheduling stats of bucketed table to NodeSelectionStats\n\nPreviously we only took scheduling for unbucketed situation into\nconsideration for NodeSelectionStats, which is not sufficient.\nNow add scheduling stats for bucketed table to NodeSelectionStats\nas well."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NDgzMDA3", "url": "https://github.com/prestodb/presto/pull/14816#pullrequestreview-447483007", "createdAt": "2020-07-13T18:08:06Z", "commit": {"oid": "0cdcb1715974865c844e38bc658587ce105bd904"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1233, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}