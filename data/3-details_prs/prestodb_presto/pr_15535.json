{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNTAxODc0", "number": 15535, "title": "Add PrestoThriftPage", "bodyText": "Wrap List with positionCount so we can handle\nfunctions taking no arguments.\nTest plan - travis\n== NO RELEASE NOTE ==", "createdAt": "2020-12-16T23:33:37Z", "url": "https://github.com/prestodb/presto/pull/15535", "merged": true, "mergeCommit": {"oid": "bb3a2b78f97fd97b3ae005d5dbf8f46552309fcf"}, "closed": true, "closedAt": "2020-12-18T23:47:26Z", "author": {"login": "rongrong"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm5dlyAH2gAyNTQxNTAxODc0OjJlODNhYmU1NzBjMjY1ZjZlYmViM2JjYThlNzA3M2U5MzI0Yjg2MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnIk3DgFqTU1NDkxMzg4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2e83abe570c265f6ebeb3bca8e7073e9324b861b", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/2e83abe570c265f6ebeb3bca8e7073e9324b861b", "committedDate": "2020-12-17T01:43:16Z", "message": "Add PrestoThriftPage\n\nWrap List<PrestoThriftBlock> with positionCount so we can handle\nfunctions taking no arguments."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f6083410b5cda1d4828650c196768bd90cd2049", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/6f6083410b5cda1d4828650c196768bd90cd2049", "committedDate": "2020-12-16T23:25:32Z", "message": "Add PrestoThriftPage\n\nWrap List<PrestoThriftBlock> with positionCount so we can handle\nfunctions taking no arguments."}, "afterCommit": {"oid": "2e83abe570c265f6ebeb3bca8e7073e9324b861b", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/2e83abe570c265f6ebeb3bca8e7073e9324b861b", "committedDate": "2020-12-17T01:43:16Z", "message": "Add PrestoThriftPage\n\nWrap List<PrestoThriftBlock> with positionCount so we can handle\nfunctions taking no arguments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0ODU2MDQ3", "url": "https://github.com/prestodb/presto/pull/15535#pullrequestreview-554856047", "createdAt": "2020-12-17T18:03:15Z", "commit": {"oid": "2e83abe570c265f6ebeb3bca8e7073e9324b861b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODowMzoxNVrOIICDGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODoxODozN1rOIIComA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI5MzA4MA==", "bodyText": "Since this is an example to help people write their own UDF service, maybe we should show a working case for no-arg UDFs, since there might be some confusion on how to properly handle it? It's not obvious what needs to be done for that situation. For example, need to write back results equal to number of input rows, etc.", "url": "https://github.com/prestodb/presto/pull/15535#discussion_r545293080", "createdAt": "2020-12-17T18:03:15Z", "author": {"login": "prithvip"}, "path": "presto-thrift-testing-udf-server/src/main/java/com/facebook/presto/udf/thrift/EchoFirstInputThriftUdfService.java", "diffHunk": "@@ -50,7 +51,11 @@ public EchoFirstInputThriftUdfService(BlockEncodingSerde blockEncodingSerde)\n         ThriftUdfPage result;\n         switch (inputs.getPageFormat()) {\n             case PRESTO_THRIFT:\n-                result = thriftPage(ImmutableList.of(inputs.getThriftBlocks().get(0)));\n+                PrestoThriftPage thriftPage = inputs.getThriftPage();\n+                if (thriftPage.getThriftBlocks().isEmpty()) {\n+                    throw new UnsupportedOperationException(\"No input to echo\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e83abe570c265f6ebeb3bca8e7073e9324b861b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwMjY4MA==", "bodyText": "I think we should model this as a ThriftUnion, since it is an either/or with ThriftSerializedPage vs PrestoThriftPage. Clients won't have to write guard code to check to make sure that one of these is non-empty, and it would clarify the API.", "url": "https://github.com/prestodb/presto/pull/15535#discussion_r545302680", "createdAt": "2020-12-17T18:18:37Z", "author": {"login": "prithvip"}, "path": "presto-thrift-api/src/main/java/com/facebook/presto/thrift/api/udf/ThriftUdfPage.java", "diffHunk": "@@ -54,9 +52,9 @@ public ThriftUdfPageFormat getPageFormat()\n \n     @Nullable\n     @ThriftField(value = 2, requiredness = OPTIONAL)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e83abe570c265f6ebeb3bca8e7073e9324b861b"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTEzODg3", "url": "https://github.com/prestodb/presto/pull/15535#pullrequestreview-554913887", "createdAt": "2020-12-17T19:19:47Z", "commit": {"oid": "2e83abe570c265f6ebeb3bca8e7073e9324b861b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4571, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}