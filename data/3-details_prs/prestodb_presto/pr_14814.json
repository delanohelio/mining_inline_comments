{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NTU1MTkx", "number": 14814, "title": "Use the same RowExpressionCompiler in CursorProcessorCompiler", "bodyText": "", "createdAt": "2020-07-09T00:48:48Z", "url": "https://github.com/prestodb/presto/pull/14814", "merged": true, "mergeCommit": {"oid": "f700b2417e263a217c5a117ea2873f5b28212ca2"}, "closed": true, "closedAt": "2020-07-09T18:02:34Z", "author": {"login": "rongrong"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczEIyHAH2gAyNDQ2NTU1MTkxOmY3OGRiOTIwYTFhNTQ1MDQ1YjFiOTZhNmU0MjBiNjAyZDJlNmQ4ZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczFxNtAFqTQ0NTIzMzI3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f78db920a1a545045b1b96a6e420b602d2e6d8eb", "author": {"user": {"login": "rongrong", "name": "Rongrong Zhong"}}, "url": "https://github.com/prestodb/presto/commit/f78db920a1a545045b1b96a6e420b602d2e6d8eb", "committedDate": "2020-07-09T00:45:26Z", "message": "Use the same RowExpressionCompiler in CursorProcessorCompiler\n\nIn CursorProcessorCompiler, we created new RowExpressionCompiler when compiling\nevery expression. Now that RowExpressionCompiler is no longer stateless\n(compiledLambdaMap needs to be updated), this becomes problematic. Conceptually,\nRowExpressionCompiler is adding methods to a generated class, and all codegen\nrelated to the same generated class should use the same RowExpressionCompiler.\nModify the code accordingly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MjMzMjc3", "url": "https://github.com/prestodb/presto/pull/14814#pullrequestreview-445233277", "createdAt": "2020-07-09T01:36:34Z", "commit": {"oid": "f78db920a1a545045b1b96a6e420b602d2e6d8eb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMTozNjozNFrOGu-q2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMTozNjozNFrOGu-q2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkxNDQ1Ng==", "bodyText": "Before the change , looks like cursor is a parameter, while now it's a variable in the scope?\nParameter cursor = arg(\"cursor\", RecordCursor.class);", "url": "https://github.com/prestodb/presto/pull/14814#discussion_r451914456", "createdAt": "2020-07-09T01:36:34Z", "author": {"login": "wenleix"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/gen/CursorProcessorCompiler.java", "diffHunk": "@@ -275,6 +265,7 @@ public BytecodeNode visitInputReference(InputReferenceExpression node, Scope sco\n                 int field = node.getField();\n                 Type type = node.getType();\n                 Variable wasNullVariable = scope.getVariable(\"wasNull\");\n+                Variable cursorVariable = scope.getVariable(\"cursor\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f78db920a1a545045b1b96a6e420b602d2e6d8eb"}, "originalPosition": 110}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1225, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}