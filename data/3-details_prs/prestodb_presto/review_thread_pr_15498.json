{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMTQwMjUw", "number": 15498, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzoyNTozMFrOFAi7Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzo1MDowNFrOFAjYug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MTE2NTM5OnYy", "diffSide": "LEFT", "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/MapFlatBatchStreamReader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzoyNTozMFrOH-5yEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMTozMToyNVrOH-8xig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTcyMDQ2NQ==", "bodyText": "Just for my understanding, I believe this is the real bug. But inMapVectors[i] is already null as it was just allocated in the top so this code is no-op,so this entire code is removed.", "url": "https://github.com/prestodb/presto/pull/15498#discussion_r535720465", "createdAt": "2020-12-03T23:25:30Z", "author": {"login": "arunthirupathi"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/MapFlatBatchStreamReader.java", "diffHunk": "@@ -158,13 +158,7 @@ public Block readBlock()\n         else {\n             nullVector = new boolean[nextBatchSize];\n             int nullValues = presentStream.getUnsetBits(nextBatchSize, nullVector);\n-            if (nullValues == nextBatchSize) {\n-                for (int i = 0; i < inMapStreams.size(); i++) {\n-                    inMapVectors[i] = null;\n-                    totalMapEntries += nextBatchSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7503d3c63001d2184e81055d742ec7ceeb4d155f"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc2OTQ4Mg==", "bodyText": "exactly", "url": "https://github.com/prestodb/presto/pull/15498#discussion_r535769482", "createdAt": "2020-12-04T01:31:25Z", "author": {"login": "zzhao0"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/reader/MapFlatBatchStreamReader.java", "diffHunk": "@@ -158,13 +158,7 @@ public Block readBlock()\n         else {\n             nullVector = new boolean[nextBatchSize];\n             int nullValues = presentStream.getUnsetBits(nextBatchSize, nullVector);\n-            if (nullValues == nextBatchSize) {\n-                for (int i = 0; i < inMapStreams.size(); i++) {\n-                    inMapVectors[i] = null;\n-                    totalMapEntries += nextBatchSize;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTcyMDQ2NQ=="}, "originalCommit": {"oid": "7503d3c63001d2184e81055d742ec7ceeb4d155f"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MTIzOTcyOnYy", "diffSide": "RIGHT", "path": "presto-orc/src/test/java/com/facebook/presto/orc/TestMapFlatBatchStreamReader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzo0OTozOVrOH-6awA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzo0OTozOVrOH-6awA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczMDg4MA==", "bodyText": "typo: everyflat -> every flat", "url": "https://github.com/prestodb/presto/pull/15498#discussion_r535730880", "createdAt": "2020-12-03T23:49:39Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/test/java/com/facebook/presto/orc/TestMapFlatBatchStreamReader.java", "diffHunk": "@@ -314,6 +315,17 @@ public void testWithAllNulls()\n                 ExpectedValuesBuilder.get(Function.identity()).setNullRowsFrequency(ALL));\n     }\n \n+    @Test\n+    public void testWithAllNullsExceptFirst()\n+            throws Exception\n+    {\n+        // A test case where everyflat map is null except the first one", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7503d3c63001d2184e81055d742ec7ceeb4d155f"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MTI0MDkwOnYy", "diffSide": "RIGHT", "path": "presto-orc/src/test/java/com/facebook/presto/orc/TestMapFlatSelectiveStreamReader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzo1MDowNFrOH-6bbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzo1MDowNFrOH-6bbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczMTA1Mg==", "bodyText": "typo: everyflat -> every flat", "url": "https://github.com/prestodb/presto/pull/15498#discussion_r535731052", "createdAt": "2020-12-03T23:50:04Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/test/java/com/facebook/presto/orc/TestMapFlatSelectiveStreamReader.java", "diffHunk": "@@ -313,6 +314,17 @@ public void testWithAllNulls()\n                 ExpectedValuesBuilder.get(Function.identity()).setNullRowsFrequency(ALL));\n     }\n \n+    @Test\n+    public void testWithAllNullsExceptFirst()\n+            throws Exception\n+    {\n+        // A test case where everyflat map is null except the first one", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7503d3c63001d2184e81055d742ec7ceeb4d155f"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3250, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}