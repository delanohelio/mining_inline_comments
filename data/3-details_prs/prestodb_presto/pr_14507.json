{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTA1NzE4", "number": 14507, "title": "Fix timeout of testQueuingWhenTaskLimitExceeds", "bodyText": "When InternalResourceGroupManager::taskLimitExceeded is updated by testing method setTaskLimitExceeded, there is a delay in updating root resource group's state (each resource group could have its own limit and this is updated asynchronously).\nThis flaw exists only in testing method.\nBefore this fix:\nOne failure out of 30 running of test testQueuingWhenTaskLimitExceeds on average.\nAfter the fix:\nNo failure after 100 runs.\n== NO RELEASE NOTE ==", "createdAt": "2020-05-09T03:12:23Z", "url": "https://github.com/prestodb/presto/pull/14507", "merged": true, "mergeCommit": {"oid": "a6ea2487ad2aaf3006caa037017402053ac4f092"}, "closed": true, "closedAt": "2020-05-12T09:42:18Z", "author": {"login": "viczhang861"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfd19PgBqjMzMTg5NTAwMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgXGrPAFqTQwOTU2NTE4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8ad2a8f268f335f5c822c477d89e642c0703cc2", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/a8ad2a8f268f335f5c822c477d89e642c0703cc2", "committedDate": "2020-05-09T02:49:10Z", "message": "Fix timeout of testQueuingdWhenTaskLimitExceeds"}, "afterCommit": {"oid": "83090bc12b504a0dec7f65001ad17af9e1ed8753", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/83090bc12b504a0dec7f65001ad17af9e1ed8753", "committedDate": "2020-05-09T03:22:51Z", "message": "Fix timeout of testQueuingWhenTaskLimitExceeds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjA3MzEy", "url": "https://github.com/prestodb/presto/pull/14507#pullrequestreview-408607312", "createdAt": "2020-05-09T03:23:56Z", "commit": {"oid": "a8ad2a8f268f335f5c822c477d89e642c0703cc2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjA3Mzcw", "url": "https://github.com/prestodb/presto/pull/14507#pullrequestreview-408607370", "createdAt": "2020-05-09T03:24:50Z", "commit": {"oid": "83090bc12b504a0dec7f65001ad17af9e1ed8753"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwMzoyNDo1MFrOGS4I9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwMzoyNDo1MFrOGS4I9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ0NzM1MA==", "bodyText": "nit: typo: \"Queuingd\"", "url": "https://github.com/prestodb/presto/pull/14507#discussion_r422447350", "createdAt": "2020-05-09T03:24:50Z", "author": {"login": "caithagoras"}, "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestQueryTaskLimit.java", "diffHunk": "@@ -88,7 +88,7 @@ public void testExceedTaskLimit()\n         }\n     }\n \n-    @Test(timeOut = 30_000)\n+    @Test(timeOut = 120_000)\n     public void testQueuingdWhenTaskLimitExceeds()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83090bc12b504a0dec7f65001ad17af9e1ed8753"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "83090bc12b504a0dec7f65001ad17af9e1ed8753", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/83090bc12b504a0dec7f65001ad17af9e1ed8753", "committedDate": "2020-05-09T03:22:51Z", "message": "Fix timeout of testQueuingWhenTaskLimitExceeds"}, "afterCommit": {"oid": "8231ed0efc4234669ed55a5d4688942e5723c801", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/8231ed0efc4234669ed55a5d4688942e5723c801", "committedDate": "2020-05-09T03:50:30Z", "message": "Fix timeout of testQueuingWhenTaskLimitExceeds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MjE1ODg2", "url": "https://github.com/prestodb/presto/pull/14507#pullrequestreview-409215886", "createdAt": "2020-05-11T14:17:45Z", "commit": {"oid": "8231ed0efc4234669ed55a5d4688942e5723c801"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8231ed0efc4234669ed55a5d4688942e5723c801", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/8231ed0efc4234669ed55a5d4688942e5723c801", "committedDate": "2020-05-09T03:50:30Z", "message": "Fix timeout of testQueuingWhenTaskLimitExceeds"}, "afterCommit": {"oid": "c51ee9c72851cd3ffc6e2225205832f37a32cf3f", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/c51ee9c72851cd3ffc6e2225205832f37a32cf3f", "committedDate": "2020-05-11T16:47:19Z", "message": "Increase the timeout of task limit test\n\n- testQueuingWhenTaskLimitExceeds finishes around 15s in most times,\n  however, time out at 30s happens occasionally.\n- Statcktrace from failed tests show that it is waiting for query\n  runner to close.\n- Increase timeout to 120s to confirm that it is query runner\n  issue not test itself."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c51ee9c72851cd3ffc6e2225205832f37a32cf3f", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/c51ee9c72851cd3ffc6e2225205832f37a32cf3f", "committedDate": "2020-05-11T16:47:19Z", "message": "Increase the timeout of task limit test\n\n- testQueuingWhenTaskLimitExceeds finishes around 15s in most times,\n  however, time out at 30s happens occasionally.\n- Statcktrace from failed tests show that it is waiting for query\n  runner to close.\n- Increase timeout to 120s to confirm that it is query runner\n  issue not test itself."}, "afterCommit": {"oid": "c8dc5da6e2d0c0fc9ef07307b4a885941e149f38", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/c8dc5da6e2d0c0fc9ef07307b4a885941e149f38", "committedDate": "2020-05-11T18:15:22Z", "message": "Increase the timeout of task limit test\n\n- testQueuingWhenTaskLimitExceeds finishes within 15s in most times,\n  however, time out at 30s happens occasionally.\n- Statcktrace from failed tests show that it is waiting for query\n  runner to close.\n- Increase timeout to 120s to confirm that it is query runner\n  issue not test itself."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2334636118a5da50753d09b0036ddda87dbf6e8", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/b2334636118a5da50753d09b0036ddda87dbf6e8", "committedDate": "2020-05-11T21:35:51Z", "message": "Update task limit state without delay for testing\n\n- Fix synchronization issue in testQueuingWhenTaskLimitExceeds.\n- When InternalResourceGroupManager::taskLimitExceeded is updated by\n  testing method setTaskLimitExceeded, there is a delay in updating\n  root resource group's state, this PR fixes it.\n- Improve test by removing unnecessary steps."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8dc5da6e2d0c0fc9ef07307b4a885941e149f38", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/c8dc5da6e2d0c0fc9ef07307b4a885941e149f38", "committedDate": "2020-05-11T18:15:22Z", "message": "Increase the timeout of task limit test\n\n- testQueuingWhenTaskLimitExceeds finishes within 15s in most times,\n  however, time out at 30s happens occasionally.\n- Statcktrace from failed tests show that it is waiting for query\n  runner to close.\n- Increase timeout to 120s to confirm that it is query runner\n  issue not test itself."}, "afterCommit": {"oid": "b2334636118a5da50753d09b0036ddda87dbf6e8", "author": {"user": {"login": "viczhang861", "name": "Vic Zhang"}}, "url": "https://github.com/prestodb/presto/commit/b2334636118a5da50753d09b0036ddda87dbf6e8", "committedDate": "2020-05-11T21:35:51Z", "message": "Update task limit state without delay for testing\n\n- Fix synchronization issue in testQueuingWhenTaskLimitExceeds.\n- When InternalResourceGroupManager::taskLimitExceeded is updated by\n  testing method setTaskLimitExceeded, there is a delay in updating\n  root resource group's state, this PR fixes it.\n- Improve test by removing unnecessary steps."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTY1MTg3", "url": "https://github.com/prestodb/presto/pull/14507#pullrequestreview-409565187", "createdAt": "2020-05-11T22:06:46Z", "commit": {"oid": "b2334636118a5da50753d09b0036ddda87dbf6e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1614, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}