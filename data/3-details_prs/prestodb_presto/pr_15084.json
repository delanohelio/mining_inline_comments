{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczNTg2NTYy", "number": 15084, "title": "Adds support for microsecond timestamp precision", "bodyText": "Adds support for microseconds precision for presto-orc reader. There are no plans to enable it for presto sql, but other projects may employ the setting for higher precision.\nTest plan - added unit test TestApacheHiveTimestampDecoder\n== NO RELEASE NOTE ==", "createdAt": "2020-08-26T01:18:21Z", "url": "https://github.com/prestodb/presto/pull/15084", "merged": true, "mergeCommit": {"oid": "a703fc48010461d1100aa5268c4a50970fdc36aa"}, "closed": true, "closedAt": "2020-08-28T03:32:32Z", "author": {"login": "borovsky-d"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdChZPLgBqjM2OTI1MTE3MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDKJwfgBqjM3MDE5MTc4Nzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e84fd9889f1b4ae9b457c44f214d2ad0fce3876c", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/e84fd9889f1b4ae9b457c44f214d2ad0fce3876c", "committedDate": "2020-08-26T01:14:39Z", "message": "adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "eed4b19ecc109b58de3df506ede18e46b3c7e9c9", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/eed4b19ecc109b58de3df506ede18e46b3c7e9c9", "committedDate": "2020-08-26T01:19:15Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eed4b19ecc109b58de3df506ede18e46b3c7e9c9", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/eed4b19ecc109b58de3df506ede18e46b3c7e9c9", "committedDate": "2020-08-26T01:19:15Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "886a6ddccfd31f5112bb484e38353adea80a3429", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/886a6ddccfd31f5112bb484e38353adea80a3429", "committedDate": "2020-08-26T18:50:15Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "886a6ddccfd31f5112bb484e38353adea80a3429", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/886a6ddccfd31f5112bb484e38353adea80a3429", "committedDate": "2020-08-26T18:50:15Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "69fe2d46c523b09f9a2f7f10958d06e5c9d5c603", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/69fe2d46c523b09f9a2f7f10958d06e5c9d5c603", "committedDate": "2020-08-26T21:33:52Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69fe2d46c523b09f9a2f7f10958d06e5c9d5c603", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/69fe2d46c523b09f9a2f7f10958d06e5c9d5c603", "committedDate": "2020-08-26T21:33:52Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "a165602e5141d14c6142a977c3f810a92cefd50f", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/a165602e5141d14c6142a977c3f810a92cefd50f", "committedDate": "2020-08-27T01:06:05Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a165602e5141d14c6142a977c3f810a92cefd50f", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/a165602e5141d14c6142a977c3f810a92cefd50f", "committedDate": "2020-08-27T01:06:05Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/07d5482832f0d2cb45a1d07976b73db99abb7792", "committedDate": "2020-08-27T01:07:54Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDc1NzA2", "url": "https://github.com/prestodb/presto/pull/15084#pullrequestreview-477075706", "createdAt": "2020-08-27T20:57:34Z", "commit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMDo1NzozNVrOHIhAHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMDo1NzozNVrOHIhAHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5MTM1OA==", "bodyText": "getTimestampTimeUnit", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478691358", "createdAt": "2020-08-27T20:57:35Z", "author": {"login": "bhhari"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/OrcReaderOptions.java", "diffHunk": "@@ -63,4 +73,9 @@ public boolean mapNullKeysEnabled()\n     {\n         return mapNullKeysEnabled;\n     }\n+\n+    public TimeUnit timestampTimeUnit()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDc3MTc4", "url": "https://github.com/prestodb/presto/pull/15084#pullrequestreview-477077178", "createdAt": "2020-08-27T20:59:50Z", "commit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMDo1OTo1MVrOHIhEtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMDo1OTo1MVrOHIhEtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5MjUzMw==", "bodyText": "timeStampTimeUnit.compareTo(TimeUnit.SECONDS) <=0 and move the convert into getter\nsomething like this\n\npublic class DecodeTimestampOptions\n{\n    private static final int MILLIS_PER_SECOND = 1000;\n\n    private final TimeUnit timeUnit;\n    private final long baseTimestampInSeconds;\n\n    public DecodeTimestampOptions(\n            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n    {\n        checkState(timestampTimeUnit.compareTo(TimeUnit.SECONDS) <=0 && timestampTimeUnit.compareTo(TimeUnit.NANOSECONDS)>=0);\n        this.timeUnit = timestampTimeUnit;\n        this.baseTimestampInSeconds = new DateTime(2015, 1, 1, 0, 0, requireNonNull(hiveStorageTimeZone, \"hiveStorageTimeZone is null\")).getMillis() / MILLIS_PER_SECOND;\n    }\n\n    public long timestampUnitsPerSecond()\n    {\n        return timeUnit.convert(1, TimeUnit.SECONDS);\n    }\n\n    public long nanosecondsPerTimestampUnit()\n    {\n        return timeUnit.convert(1, TimeUnit.NANOSECONDS);\n    }\n\n    public long baseTimestampInSeconds()\n    {\n        return baseTimestampInSeconds;\n    }\n}", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478692533", "createdAt": "2020-08-27T20:59:51Z", "author": {"login": "bhhari"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n+    {\n+        this.timestampUnitsPerSecond = requireNonNull(timestampTimeUnit).convert(1, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDc5Mzgx", "url": "https://github.com/prestodb/presto/pull/15084#pullrequestreview-477079381", "createdAt": "2020-08-27T21:03:21Z", "commit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTowMzoyMVrOHIhLVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTowMzoyMVrOHIhLVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5NDIzMA==", "bodyText": "timeStampTimeUnit.compareTo(TimeUnit.NANOSECONDS) >=0", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478694230", "createdAt": "2020-08-27T21:03:21Z", "author": {"login": "bhhari"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n+    {\n+        this.timestampUnitsPerSecond = requireNonNull(timestampTimeUnit).convert(1, TimeUnit.SECONDS);\n+        if (this.timestampUnitsPerSecond == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be <= second\");\n+        }\n+        this.nanosecondsPerTimeUnit = TimeUnit.NANOSECONDS.convert(1, requireNonNull(timestampTimeUnit));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDg4Nzc5", "url": "https://github.com/prestodb/presto/pull/15084#pullrequestreview-477088779", "createdAt": "2020-08-27T21:14:23Z", "commit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07d5482832f0d2cb45a1d07976b73db99abb7792", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/07d5482832f0d2cb45a1d07976b73db99abb7792", "committedDate": "2020-08-27T01:07:54Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/4ff542c296baa4a675691c66f7d0a4fb952dfa30", "committedDate": "2020-08-27T21:21:01Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTUzNDgz", "url": "https://github.com/prestodb/presto/pull/15084#pullrequestreview-477153483", "createdAt": "2020-08-27T23:42:13Z", "commit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo0MjoxM1rOHIkzuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMzo0NTo0N1rOHIk37w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1MzcyMw==", "bodyText": "It looks like there are only 2 possible values for timestampTimeUnit: MILLISECONDS and MICROSECONDS. Perhaps, add a check that this is so and also consider using a boolean to distinguish between the two possibilities.\nnit: timestampTimeUnit -> timeUnit since class name includes \"timestamp\"", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478753723", "createdAt": "2020-08-27T23:42:13Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NDEyNg==", "bodyText": "This error message seems too cryptic. Wouldn't it be enough to assert that timestampTimeUnit is either MILLI or MICROSECONDS?", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478754126", "createdAt": "2020-08-27T23:43:39Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n+    {\n+        this.timestampUnitsPerSecond = requireNonNull(timestampTimeUnit).convert(1, TimeUnit.SECONDS);\n+        if (this.timestampUnitsPerSecond == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be <= second\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NDIzOA==", "bodyText": "Why is this particular date? A comment is needed. Using TimeUnit instead of / MILLIS_PER_SECOND", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478754238", "createdAt": "2020-08-27T23:44:08Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n+    {\n+        this.timestampUnitsPerSecond = requireNonNull(timestampTimeUnit).convert(1, TimeUnit.SECONDS);\n+        if (this.timestampUnitsPerSecond == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be <= second\");\n+        }\n+        this.nanosecondsPerTimeUnit = TimeUnit.NANOSECONDS.convert(1, requireNonNull(timestampTimeUnit));\n+        if (this.nanosecondsPerTimeUnit == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be >= nanosecond\");\n+        }\n+        this.baseTimestampInSeconds = new DateTime(2015, 1, 1, 0, 0, requireNonNull(hiveStorageTimeZone, \"hiveStorageTimeZone is null\")).getMillis() / MILLIS_PER_SECOND;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NDM4Mw==", "bodyText": "nit: getTimestampUnitsPerSecond -> getUnitsPerSecond", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478754383", "createdAt": "2020-08-27T23:44:36Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n+    {\n+        this.timestampUnitsPerSecond = requireNonNull(timestampTimeUnit).convert(1, TimeUnit.SECONDS);\n+        if (this.timestampUnitsPerSecond == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be <= second\");\n+        }\n+        this.nanosecondsPerTimeUnit = TimeUnit.NANOSECONDS.convert(1, requireNonNull(timestampTimeUnit));\n+        if (this.nanosecondsPerTimeUnit == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be >= nanosecond\");\n+        }\n+        this.baseTimestampInSeconds = new DateTime(2015, 1, 1, 0, 0, requireNonNull(hiveStorageTimeZone, \"hiveStorageTimeZone is null\")).getMillis() / MILLIS_PER_SECOND;\n+    }\n+\n+    public long getTimestampUnitsPerSecond()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NDQ0NQ==", "bodyText": "nit: getNanosecondsPerTimestampUnit -> getNanosPerUnit", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478754445", "createdAt": "2020-08-27T23:44:46Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n+    {\n+        this.timestampUnitsPerSecond = requireNonNull(timestampTimeUnit).convert(1, TimeUnit.SECONDS);\n+        if (this.timestampUnitsPerSecond == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be <= second\");\n+        }\n+        this.nanosecondsPerTimeUnit = TimeUnit.NANOSECONDS.convert(1, requireNonNull(timestampTimeUnit));\n+        if (this.nanosecondsPerTimeUnit == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be >= nanosecond\");\n+        }\n+        this.baseTimestampInSeconds = new DateTime(2015, 1, 1, 0, 0, requireNonNull(hiveStorageTimeZone, \"hiveStorageTimeZone is null\")).getMillis() / MILLIS_PER_SECOND;\n+    }\n+\n+    public long getTimestampUnitsPerSecond()\n+    {\n+        return timestampUnitsPerSecond;\n+    }\n+\n+    public long getNanosecondsPerTimestampUnit()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NDU3OA==", "bodyText": "nit: getBaseTimestampInSeconds -> getBaseSeconds + comment explaining what this is", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478754578", "createdAt": "2020-08-27T23:45:09Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/DecodeTimestampOptions.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.orc;\n+\n+import org.joda.time.DateTime;\n+import org.joda.time.DateTimeZone;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class DecodeTimestampOptions\n+{\n+    private static final int MILLIS_PER_SECOND = 1000;\n+\n+    private final long timestampUnitsPerSecond;\n+    private final long nanosecondsPerTimeUnit;\n+    private final long baseTimestampInSeconds;\n+\n+    public DecodeTimestampOptions(\n+            DateTimeZone hiveStorageTimeZone, TimeUnit timestampTimeUnit)\n+    {\n+        this.timestampUnitsPerSecond = requireNonNull(timestampTimeUnit).convert(1, TimeUnit.SECONDS);\n+        if (this.timestampUnitsPerSecond == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be <= second\");\n+        }\n+        this.nanosecondsPerTimeUnit = TimeUnit.NANOSECONDS.convert(1, requireNonNull(timestampTimeUnit));\n+        if (this.nanosecondsPerTimeUnit == 0) {\n+            throw new IllegalArgumentException(timestampTimeUnit + \" should be >= nanosecond\");\n+        }\n+        this.baseTimestampInSeconds = new DateTime(2015, 1, 1, 0, 0, requireNonNull(hiveStorageTimeZone, \"hiveStorageTimeZone is null\")).getMillis() / MILLIS_PER_SECOND;\n+    }\n+\n+    public long getTimestampUnitsPerSecond()\n+    {\n+        return timestampUnitsPerSecond;\n+    }\n+\n+    public long getNanosecondsPerTimestampUnit()\n+    {\n+        return nanosecondsPerTimeUnit;\n+    }\n+\n+    public long getBaseTimestampInSeconds()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc1NDc5OQ==", "bodyText": "nit: message is missing\nthis.timestampTimeUnit = requireNonNull(timestampTimeUnit, \"timestampTimeUnit is null\");", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478754799", "createdAt": "2020-08-27T23:45:47Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/OrcRecordReaderOptions.java", "diffHunk": "@@ -23,18 +25,25 @@\n     private final DataSize tinyStripeThreshold;\n     private final DataSize maxBlockSize;\n     private final boolean mapNullKeysEnabled;\n+    private final TimeUnit timestampTimeUnit;\n \n     public OrcRecordReaderOptions(OrcReaderOptions options)\n     {\n-        this(options.getMaxMergeDistance(), options.getTinyStripeThreshold(), options.getMaxBlockSize(), options.mapNullKeysEnabled());\n+        this(options.getMaxMergeDistance(), options.getTinyStripeThreshold(), options.getMaxBlockSize(), options.mapNullKeysEnabled(), options.getTimestampTimeUnit());\n     }\n \n-    public OrcRecordReaderOptions(DataSize maxMergeDistance, DataSize tinyStripeThreshold, DataSize maxBlockSize, boolean mapNullKeysEnabled)\n+    public OrcRecordReaderOptions(\n+            DataSize maxMergeDistance,\n+            DataSize tinyStripeThreshold,\n+            DataSize maxBlockSize,\n+            boolean mapNullKeysEnabled,\n+            TimeUnit timestampTimeUnit)\n     {\n         this.maxMergeDistance = requireNonNull(maxMergeDistance, \"maxMergeDistance is null\");\n         this.maxBlockSize = requireNonNull(maxBlockSize, \"maxBlockSize is null\");\n         this.tinyStripeThreshold = requireNonNull(tinyStripeThreshold, \"tinyStripeThreshold is null\");\n         this.mapNullKeysEnabled = mapNullKeysEnabled;\n+        this.timestampTimeUnit = requireNonNull(timestampTimeUnit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ff542c296baa4a675691c66f7d0a4fb952dfa30", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/4ff542c296baa4a675691c66f7d0a4fb952dfa30", "committedDate": "2020-08-27T21:21:01Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "a6576bf7a5e31718c2c0a24a6fef8d634f1309f1", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/a6576bf7a5e31718c2c0a24a6fef8d634f1309f1", "committedDate": "2020-08-28T00:21:22Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6576bf7a5e31718c2c0a24a6fef8d634f1309f1", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/a6576bf7a5e31718c2c0a24a6fef8d634f1309f1", "committedDate": "2020-08-28T00:21:22Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "2d178fad48595cbfea7e6efc39beb691ebb3c88a", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/2d178fad48595cbfea7e6efc39beb691ebb3c88a", "committedDate": "2020-08-28T00:25:30Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTcxNjM4", "url": "https://github.com/prestodb/presto/pull/15084#pullrequestreview-477171638", "createdAt": "2020-08-28T00:45:14Z", "commit": {"oid": "2d178fad48595cbfea7e6efc39beb691ebb3c88a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDo0NToxNFrOHIlzXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwMDo0NTozOVrOHIlzvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc3MDAxMg==", "bodyText": "typo: Micros -> Micro", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478770012", "createdAt": "2020-08-28T00:45:14Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/OrcReaderOptions.java", "diffHunk": "@@ -63,4 +71,9 @@ public boolean mapNullKeysEnabled()\n     {\n         return mapNullKeysEnabled;\n     }\n+\n+    public boolean enableTimestampMicrosPrecision()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d178fad48595cbfea7e6efc39beb691ebb3c88a"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc3MDExMQ==", "bodyText": "typo: Micros -> Micro", "url": "https://github.com/prestodb/presto/pull/15084#discussion_r478770111", "createdAt": "2020-08-28T00:45:39Z", "author": {"login": "mbasmanova"}, "path": "presto-orc/src/main/java/com/facebook/presto/orc/OrcRecordReaderOptions.java", "diffHunk": "@@ -23,18 +23,25 @@\n     private final DataSize tinyStripeThreshold;\n     private final DataSize maxBlockSize;\n     private final boolean mapNullKeysEnabled;\n+    private final boolean enableTimestampMicrosPrecision;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d178fad48595cbfea7e6efc39beb691ebb3c88a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd1c5bead9ce3871245d766d0dff8d6e8ae63534", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/cd1c5bead9ce3871245d766d0dff8d6e8ae63534", "committedDate": "2020-08-28T00:48:26Z", "message": "Adds support for microsecond timestamp precision"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d178fad48595cbfea7e6efc39beb691ebb3c88a", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/2d178fad48595cbfea7e6efc39beb691ebb3c88a", "committedDate": "2020-08-28T00:25:30Z", "message": "Adds support for microsecond timestamp precision"}, "afterCommit": {"oid": "cd1c5bead9ce3871245d766d0dff8d6e8ae63534", "author": {"user": {"login": "borovsky-d", "name": "Dmitry Borovsky"}}, "url": "https://github.com/prestodb/presto/commit/cd1c5bead9ce3871245d766d0dff8d6e8ae63534", "committedDate": "2020-08-28T00:48:26Z", "message": "Adds support for microsecond timestamp precision"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 12, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}