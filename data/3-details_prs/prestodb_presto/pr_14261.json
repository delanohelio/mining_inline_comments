{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMTE4MTUz", "number": 14261, "title": "Add JSON format for EXPLAIN with type LOGICAL and DISTRIBUTED", "bodyText": "Add Json format for EXPLAIN with type LOGICAL and DISTRIBUTED. (Issue #11189)\n\n\nfor both Logical and distributed type, I use JsonRenderedNode in  JsonRenderer (link)\n\n\nDistributed plan is using sorted map base on QueryMonitor. (Also moved JsonPlanFragment from QueryMonitor to JsonRenderer.)\n\n\nsample output in this gist\n\n\n== RELEASE NOTES ==\n\nGeneral Changes\n* Add JSON format for `EXPLAIN` with type `LOGICAL` and `DISTRIBUTED`.", "createdAt": "2020-03-17T22:51:03Z", "url": "https://github.com/prestodb/presto/pull/14261", "merged": true, "mergeCommit": {"oid": "20c5d563a51eda554c615cdefb7c277d7678f90f"}, "closed": true, "closedAt": "2020-06-03T13:03:04Z", "author": {"login": "chyikwei"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQVm3sABqjMxNTM0NzMwODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcneWlegFqTQyMzE0MzQ3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "708c9d873d159bddde9731a99d5a0b1f721108ff", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/708c9d873d159bddde9731a99d5a0b1f721108ff", "committedDate": "2020-03-18T01:25:35Z", "message": "fix test function"}, "afterCommit": {"oid": "dc9d7bf3c35f2561401e5afa61fc034b529d811c", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/dc9d7bf3c35f2561401e5afa61fc034b529d811c", "committedDate": "2020-03-23T03:18:13Z", "message": "Add JSON format for EXPLAIN"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc9d7bf3c35f2561401e5afa61fc034b529d811c", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/dc9d7bf3c35f2561401e5afa61fc034b529d811c", "committedDate": "2020-03-23T03:18:13Z", "message": "Add JSON format for EXPLAIN"}, "afterCommit": {"oid": "4ce3cf47619c30531b63090322e42a8def52d2d5", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/4ce3cf47619c30531b63090322e42a8def52d2d5", "committedDate": "2020-04-03T01:51:48Z", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ce3cf47619c30531b63090322e42a8def52d2d5", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/4ce3cf47619c30531b63090322e42a8def52d2d5", "committedDate": "2020-04-03T01:51:48Z", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer"}, "afterCommit": {"oid": "6c3c1542fc7998630e54f5c2ae891805958f72fd", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/6c3c1542fc7998630e54f5c2ae891805958f72fd", "committedDate": "2020-04-03T17:22:05Z", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c3c1542fc7998630e54f5c2ae891805958f72fd", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/6c3c1542fc7998630e54f5c2ae891805958f72fd", "committedDate": "2020-04-03T17:22:05Z", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer"}, "afterCommit": {"oid": "e228e6471559cb70e2ce826cfde4ce2c90f47011", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/e228e6471559cb70e2ce826cfde4ce2c90f47011", "committedDate": "2020-04-07T03:22:48Z", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNzg3MTM1", "url": "https://github.com/prestodb/presto/pull/14261#pullrequestreview-401787135", "createdAt": "2020-04-28T12:32:50Z", "commit": {"oid": "e228e6471559cb70e2ce826cfde4ce2c90f47011"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMjozMjo1MFrOGNRrlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMjozNDo1NFrOGNRwoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NDM1OQ==", "bodyText": "nit: put this method before the previous one.", "url": "https://github.com/prestodb/presto/pull/14261#discussion_r416574359", "createdAt": "2020-04-28T12:32:50Z", "author": {"login": "rschlussel"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/planPrinter/PlanPrinter.java", "diffHunk": "@@ -247,6 +249,53 @@ public static String textDistributedPlan(SubPlan plan, FunctionManager functionM\n         return builder.toString();\n     }\n \n+    public static String jsonLogicalPlan(\n+            PlanNode plan,\n+            TypeProvider types,\n+            Optional<StageExecutionDescriptor> stageExecutionStrategy,\n+            FunctionManager functionManager,\n+            StatsAndCosts estimatedStatsAndCosts,\n+            Session session,\n+            Optional<Map<PlanNodeId, PlanNodeStats>> stats)\n+    {\n+        return new PlanPrinter(plan, types, stageExecutionStrategy, functionManager, estimatedStatsAndCosts, session, stats).toJson();\n+    }\n+\n+    public static String jsonLogicalPlan(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e228e6471559cb70e2ce826cfde4ce2c90f47011"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NTU0Nw==", "bodyText": "nit: static import", "url": "https://github.com/prestodb/presto/pull/14261#discussion_r416575547", "createdAt": "2020-04-28T12:34:45Z", "author": {"login": "rschlussel"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/QueryExplainer.java", "diffHunk": "@@ -160,10 +160,17 @@ public String getJsonPlan(Session session, Statement statement, Type planType, L\n             return explainTask(statement, task, parameters);\n         }\n \n+        Plan plan;\n         switch (planType) {\n             case IO:\n-                Plan plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n                 return textIOPlan(plan.getRoot(), metadata, session);\n+            case LOGICAL:\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                return PlanPrinter.jsonLogicalPlan(plan.getRoot(), plan.getTypes(), metadata.getFunctionManager(), plan.getStatsAndCosts(), session);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e228e6471559cb70e2ce826cfde4ce2c90f47011"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NTY0OA==", "bodyText": "static import", "url": "https://github.com/prestodb/presto/pull/14261#discussion_r416575648", "createdAt": "2020-04-28T12:34:54Z", "author": {"login": "rschlussel"}, "path": "presto-main/src/main/java/com/facebook/presto/sql/analyzer/QueryExplainer.java", "diffHunk": "@@ -160,10 +160,17 @@ public String getJsonPlan(Session session, Statement statement, Type planType, L\n             return explainTask(statement, task, parameters);\n         }\n \n+        Plan plan;\n         switch (planType) {\n             case IO:\n-                Plan plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n                 return textIOPlan(plan.getRoot(), metadata, session);\n+            case LOGICAL:\n+                plan = getLogicalPlan(session, statement, parameters, warningCollector);\n+                return PlanPrinter.jsonLogicalPlan(plan.getRoot(), plan.getTypes(), metadata.getFunctionManager(), plan.getStatsAndCosts(), session);\n+            case DISTRIBUTED:\n+                SubPlan subPlan = getDistributedPlan(session, statement, parameters, warningCollector);\n+                return PlanPrinter.jsonDistributedPlan(subPlan);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e228e6471559cb70e2ce826cfde4ce2c90f47011"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a073948d842cd1cab53e041243a5fc934702eb10", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/a073948d842cd1cab53e041243a5fc934702eb10", "committedDate": "2020-06-01T22:19:01Z", "message": "use static import"}, "afterCommit": {"oid": "6f8e023326142dfb140b27af207c873046bdecfb", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/6f8e023326142dfb140b27af207c873046bdecfb", "committedDate": "2020-06-01T22:42:22Z", "message": "use static import\n\nchange method order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8940a1b11cc5017d5f3ef55fb0e1bb1e3280bbff", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/8940a1b11cc5017d5f3ef55fb0e1bb1e3280bbff", "committedDate": "2020-06-02T00:45:04Z", "message": "use sorted map for distributed plan\n\n- change distributed plan to sorted map\n- move JsonPlanFragment from QueryMonitor to JsonRenderer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "committedDate": "2020-06-02T00:45:04Z", "message": "use static import\n\nchange method order"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f8e023326142dfb140b27af207c873046bdecfb", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/6f8e023326142dfb140b27af207c873046bdecfb", "committedDate": "2020-06-01T22:42:22Z", "message": "use static import\n\nchange method order"}, "afterCommit": {"oid": "c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "author": {"user": {"login": "chyikwei", "name": "Chyi-Kwei Yau"}}, "url": "https://github.com/prestodb/presto/commit/c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828", "committedDate": "2020-06-02T00:45:04Z", "message": "use static import\n\nchange method order"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTQzNDc2", "url": "https://github.com/prestodb/presto/pull/14261#pullrequestreview-423143476", "createdAt": "2020-06-03T00:30:57Z", "commit": {"oid": "c9fc3cd9fab51c6fb9071f2a62920b6dbdd98828"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2066, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}