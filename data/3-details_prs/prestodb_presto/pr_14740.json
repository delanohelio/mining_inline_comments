{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMDI1MDIz", "number": 14740, "title": "Fix confusion matrix computation for classification function", "bodyText": "Fixes #14731 and fixes #14750\n\nfix document mistake for classification_fall_out\nfix confusion matrix computation.\n\nDefinition: https://en.wikipedia.org/wiki/Precision_and_recall#Definition_(classification_context)\n\n\n\n\npredicated positive\npredicated negative\n\n\n\n\ncondition positive\nTrue Positive(TP)\nFalse Negative(FN)\n\n\ncondition negative\nFalse Positive(FP)\nTrue Negative(TN)\n\n\n\nthere are some variables in code.\ntotalTrueWeight = {sum of condition positive}\ntotalFalseWeight = {sum of condition negative}\nrunningTrueWeight = {sum of predicated negative in {condition positive}}\nrunningFalseWeight = {sum of predicated negative in {condition negative}}\n\nSo we got\n\n\n\n\npredicated positive\npredicated negative\n\n\n\n\n\ncondition positive\ntotalTrueWeight - runningTrueWeight\nrunningTrueWeight\ntotalTrueWeight\n\n\ncondition negative\ntotalFalseWeight - runningFalseWeight\nrunningFalseWeight\ntotalFalseWeight\n\n\n\n== RELEASE NOTES ==\n\nGeneral Changes\n* Fix  :func:`classification_miss_rate` and :func:`classification_fall_out` functions (:pr:`14740`)", "createdAt": "2020-06-28T08:50:36Z", "url": "https://github.com/prestodb/presto/pull/14740", "merged": true, "mergeCommit": {"oid": "d80fc51bcadcfb4a8003eb12da98d12d0dc8afbc"}, "closed": true, "closedAt": "2020-06-30T17:55:43Z", "author": {"login": "fornaix"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwH0edAFqTQzOTQ5Nzg0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwWmCFAFqTQ0MDA3OTI2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDk3ODQx", "url": "https://github.com/prestodb/presto/pull/14740#pullrequestreview-439497841", "createdAt": "2020-06-29T21:02:07Z", "commit": {"oid": "481855a79cd658ba5f9c31b5601b60b26ed09e22"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTowMjowN1rOGqiFqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTowMjo1N1rOGqiHTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MTg4MQ==", "bodyText": "Could you also define falseNegative before calculating miss rate,  to be consistent with that in TestClassificationPrecisionAggregation.java", "url": "https://github.com/prestodb/presto/pull/14740#discussion_r447251881", "createdAt": "2020-06-29T21:02:07Z", "author": {"login": "viczhang861"}, "path": "presto-main/src/test/java/com/facebook/presto/operator/TestClassificationMissRateAggregation.java", "diffHunk": "@@ -34,7 +34,7 @@ public TestClassificationMissRateAggregation()\n         final ArrayList<Double> expected = new ArrayList<>();\n         while (iterator.hasNext()) {\n             final BucketResult result = iterator.next();\n-            final double missRate = result.remainingFalseWeight / result.totalTrueWeight;\n+            final double missRate = (result.totalTrueWeight - result.remainingTrueWeight) / result.totalTrueWeight;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "481855a79cd658ba5f9c31b5601b60b26ed09e22"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1MjMwMA==", "bodyText": "Did we only test execution path rather than real expected value? Ideally, unit test should exist to catch this error.", "url": "https://github.com/prestodb/presto/pull/14740#discussion_r447252300", "createdAt": "2020-06-29T21:02:57Z", "author": {"login": "viczhang861"}, "path": "presto-main/src/test/java/com/facebook/presto/operator/TestClassificationMissRateAggregation.java", "diffHunk": "@@ -34,7 +34,7 @@ public TestClassificationMissRateAggregation()\n         final ArrayList<Double> expected = new ArrayList<>();\n         while (iterator.hasNext()) {\n             final BucketResult result = iterator.next();\n-            final double missRate = result.remainingFalseWeight / result.totalTrueWeight;\n+            final double missRate = (result.totalTrueWeight - result.remainingTrueWeight) / result.totalTrueWeight;\n             expected.add(missRate);\n         }\n         return expected;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "481855a79cd658ba5f9c31b5601b60b26ed09e22"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "481855a79cd658ba5f9c31b5601b60b26ed09e22", "author": {"user": {"login": "fornaix", "name": null}}, "url": "https://github.com/prestodb/presto/commit/481855a79cd658ba5f9c31b5601b60b26ed09e22", "committedDate": "2020-06-28T08:37:25Z", "message": "Fix confusion matrix computation for classification function"}, "afterCommit": {"oid": "0d64fedfc6feb63977e32e07b9fc83c3cc76b9bb", "author": {"user": {"login": "fornaix", "name": null}}, "url": "https://github.com/prestodb/presto/commit/0d64fedfc6feb63977e32e07b9fc83c3cc76b9bb", "committedDate": "2020-06-30T07:48:11Z", "message": "Fix confusion matrix computation for classification function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "author": {"user": {"login": "fornaix", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "committedDate": "2020-06-30T08:20:07Z", "message": "Fix confusion matrix computation for classification function"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d64fedfc6feb63977e32e07b9fc83c3cc76b9bb", "author": {"user": {"login": "fornaix", "name": null}}, "url": "https://github.com/prestodb/presto/commit/0d64fedfc6feb63977e32e07b9fc83c3cc76b9bb", "committedDate": "2020-06-30T07:48:11Z", "message": "Fix confusion matrix computation for classification function"}, "afterCommit": {"oid": "6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "author": {"user": {"login": "fornaix", "name": null}}, "url": "https://github.com/prestodb/presto/commit/6d8dd9159ca7897f0d9991d32976c33fbebff3e3", "committedDate": "2020-06-30T08:20:07Z", "message": "Fix confusion matrix computation for classification function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMDc5MjY2", "url": "https://github.com/prestodb/presto/pull/14740#pullrequestreview-440079266", "createdAt": "2020-06-30T14:33:54Z", "commit": {"oid": "6d8dd9159ca7897f0d9991d32976c33fbebff3e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1528, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}