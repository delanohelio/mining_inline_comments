{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NzkzNjA5", "number": 3662, "title": "DB-9552: fix JarLoader", "bodyText": "", "createdAt": "2020-06-05T21:52:36Z", "url": "https://github.com/splicemachine/spliceengine/pull/3662", "merged": true, "mergeCommit": {"oid": "c1adddfbcf71b1837cac3c3218a095ded0cba5c3"}, "closed": true, "closedAt": "2020-07-24T03:31:41Z", "author": {"login": "jyuanca"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctuX7zgFqTQzNDgwMTE1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3dDIXgBqjM1NzY0ODU3OTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODAxMTU3", "url": "https://github.com/splicemachine/spliceengine/pull/3662#pullrequestreview-434801157", "createdAt": "2020-06-22T10:34:27Z", "commit": {"oid": "7cffa073fd8eeea47da5e1f0b49c987f7e945f7f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODQzMDM3", "url": "https://github.com/splicemachine/spliceengine/pull/3662#pullrequestreview-434843037", "createdAt": "2020-06-22T11:41:59Z", "commit": {"oid": "7cffa073fd8eeea47da5e1f0b49c987f7e945f7f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo0MTo1OVrOGm9Bzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo0MTo1OVrOGm9Bzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ5ODk1OA==", "bodyText": "If running in a NLJ, union operation or other contexts they could be running in a different thread, we need a different way to identify RS vs Olap/Spark", "url": "https://github.com/splicemachine/spliceengine/pull/3662#discussion_r443498958", "createdAt": "2020-06-22T11:41:59Z", "author": {"login": "dgomezferro"}, "path": "db-engine/src/main/java/com/splicemachine/db/impl/services/reflect/UpdateLoader.java", "diffHunk": "@@ -211,6 +205,7 @@ public Object run(){\n \tClass loadClass(String className, boolean resolve) \n \t\tthrows ClassNotFoundException {\n \n+\t\tboolean isRS = Thread.currentThread().getName().contains(\"DRDAConnThread\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cffa073fd8eeea47da5e1f0b49c987f7e945f7f"}, "originalPosition": 63}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a63dc98612f6e74811b2a545f897a345134b5b5", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/9a63dc98612f6e74811b2a545f897a345134b5b5", "committedDate": "2020-07-02T03:29:44Z", "message": "whether jar loader is on spark or hbase"}, "afterCommit": {"oid": "af36d34c1d168f668834b5018be4fab3b8b4b20e", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/af36d34c1d168f668834b5018be4fab3b8b4b20e", "committedDate": "2020-07-02T03:58:37Z", "message": "whether jar loader is on spark or hbase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMjM1NDI2", "url": "https://github.com/splicemachine/spliceengine/pull/3662#pullrequestreview-442235426", "createdAt": "2020-07-03T08:22:18Z", "commit": {"oid": "af36d34c1d168f668834b5018be4fab3b8b4b20e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODoyMjoxOFrOGsoGvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODoyMjoxOFrOGsoGvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ0NzYxNA==", "bodyText": "I don't think this should be a ThreadLocal, are we setting this property for every Thread that could access this field? If  a NLJ runs in a different thread that might not have executed bootDatabase() it will think it's not in a regionServer. This should be either a static volatile boolean / static AtomicBoolean or we'd need a different mechanism.", "url": "https://github.com/splicemachine/spliceengine/pull/3662#discussion_r449447614", "createdAt": "2020-07-03T08:22:18Z", "author": {"login": "dgomezferro"}, "path": "db-engine/src/main/java/com/splicemachine/db/impl/jdbc/EmbedConnection.java", "diffHunk": "@@ -112,7 +112,9 @@\n      */\n     public static final SQLException NO_MEM =\n         Util.generateCsSQLException(SQLState.LOGIN_FAILED, \"java.lang.OutOfMemoryError\");\n-    \n+\n+\tpublic static final ThreadLocal<Boolean> isHBaseJVM = new ThreadLocal<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af36d34c1d168f668834b5018be4fab3b8b4b20e"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af36d34c1d168f668834b5018be4fab3b8b4b20e", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/af36d34c1d168f668834b5018be4fab3b8b4b20e", "committedDate": "2020-07-02T03:58:37Z", "message": "whether jar loader is on spark or hbase"}, "afterCommit": {"oid": "d5d3e7ed05e2017137b51b7944589eac24212c65", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/d5d3e7ed05e2017137b51b7944589eac24212c65", "committedDate": "2020-07-08T04:31:29Z", "message": "address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MzMxMTAw", "url": "https://github.com/splicemachine/spliceengine/pull/3662#pullrequestreview-446331100", "createdAt": "2020-07-10T11:35:13Z", "commit": {"oid": "d5d3e7ed05e2017137b51b7944589eac24212c65"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5d3e7ed05e2017137b51b7944589eac24212c65", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/d5d3e7ed05e2017137b51b7944589eac24212c65", "committedDate": "2020-07-08T04:31:29Z", "message": "address review comments"}, "afterCommit": {"oid": "5ffa83febd8fadefab0aeb5fa97cfde84d8601ba", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/5ffa83febd8fadefab0aeb5fa97cfde84d8601ba", "committedDate": "2020-07-14T18:08:13Z", "message": "DB-9552: fix JarLoader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTM2ODc0", "url": "https://github.com/splicemachine/spliceengine/pull/3662#pullrequestreview-449536874", "createdAt": "2020-07-16T06:22:35Z", "commit": {"oid": "5ffa83febd8fadefab0aeb5fa97cfde84d8601ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "414ef9324aed89e453c405542e29276ccd87d64a", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/414ef9324aed89e453c405542e29276ccd87d64a", "committedDate": "2020-07-22T15:58:30Z", "message": "DB-9552: fix JarLoader"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ffa83febd8fadefab0aeb5fa97cfde84d8601ba", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/5ffa83febd8fadefab0aeb5fa97cfde84d8601ba", "committedDate": "2020-07-14T18:08:13Z", "message": "DB-9552: fix JarLoader"}, "afterCommit": {"oid": "414ef9324aed89e453c405542e29276ccd87d64a", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/414ef9324aed89e453c405542e29276ccd87d64a", "committedDate": "2020-07-22T15:58:30Z", "message": "DB-9552: fix JarLoader"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1313, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}