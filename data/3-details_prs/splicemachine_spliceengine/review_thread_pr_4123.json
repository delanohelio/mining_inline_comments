{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTUwNDQ5", "number": 4123, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDo0NDozM1rOFFhULw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDo0NDozM1rOFFhULw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzMzMDM5OnYy", "diffSide": "RIGHT", "path": "pipelines/spliceengine-PR/Jenkinsfile", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDo0NDozM1rOIGEgEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMDo0NDozM1rOIGEgEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzNjExMw==", "bodyText": "duplicated?", "url": "https://github.com/splicemachine/spliceengine/pull/4123#discussion_r543236113", "createdAt": "2020-12-15T10:44:33Z", "author": {"login": "dgomezferro"}, "path": "pipelines/spliceengine-PR/Jenkinsfile", "diffHunk": "@@ -0,0 +1,118 @@\n+@Library('jenkins-shared-library')_\n+\n+properties([\n+    parameters([\n+        stringParam(\n+         defaultValue: \"${ghprbPullId}\",\n+         description: 'Pull ID',\n+         name: 'pr_id'\n+       )\n+    ]),\n+])\n+\n+node('spliceengine'){\n+    def artifact_values  = [\n+        [$class: 'VaultSecret', path: \"secret/aws/jenkins/colo_jenkins\", secretValues: [\n+            [$class: 'VaultSecretValue', envVar: 'ARTIFACT_USER', vaultKey: 'user'],\n+            [$class: 'VaultSecretValue', envVar: 'ARTIFACT_PASSWORD', vaultKey: 'pass']]]\n+    ]\n+    try{\n+        stage('Prep Node') {\n+                sh \"\"\"\n+                wget http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.rpm; sudo yum localinstall jdk-8u121-linux-x64.rpm\n+                sudo yum install curl epel-release git wget nmap rlwrap patch openssh-server openssh-clients openssh ntp nscd nc ftp -y\n+                sudo sed -i '/requiretty/ s/^/#/' /etc/sudoers\n+                sudo service nscd start  && sudo service ntpd start  && sudo service sshd start\n+                wget https://downloads.apache.org/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz -P /tmp \n+                sudo tar xf /tmp/apache-maven-3.6.3-bin.tar.gz -C /opt\n+                sudo ln -sfn /opt/apache-maven-3.6.3 /opt/maven\n+                wget https://archive.apache.org/dist/ant/binaries/apache-ant-1.9.9-bin.tar.gz -P /tmp\n+                sudo tar xf /tmp/apache-ant-1.9.9-bin.tar.gz -C /opt\n+                sudo ln -sfn /opt/apache-ant-1.9.9 /opt/ant\n+                \"\"\"\n+        } \n+        stage('Checkout') {\n+                // Get some code from a GitHub repository\n+                checkout([  \n+                    $class: 'GitSCM', \n+                    branches: [[name: \"\"\"refs/heads/${ghprbSourceBranch}\"\"\"]], \n+                    doGenerateSubmoduleConfigurations: false, \n+                    extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'spliceengine-ee']], \n+                    submoduleCfg: [], \n+                    userRemoteConfigs: [[credentialsId: '88647ede-744a-444b-8c08-8313cc137944', url: 'https://github.com/splicemachine/spliceengine-ee.git']]\n+                ])\n+                checkout([  \n+                    $class: 'GitSCM', \n+                    branches: [[name: \"\"\"refs/heads/${ghprbSourceBranch}\"\"\"]], \n+                    doGenerateSubmoduleConfigurations: false, \n+                    extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'spliceengine']], \n+                    submoduleCfg: [], \n+                    userRemoteConfigs: [[credentialsId: '88647ede-744a-444b-8c08-8313cc137944', url: 'https://github.com/splicemachine/spliceengine.git']]\n+                ])\n+        }\n+        stage(\"Build/Test\"){\n+            // Run Maven on a Unix agent.\n+            wrap([$class: 'VaultBuildWrapper', vaultSecrets: artifact_values]) {\n+                dir('spliceengine'){\n+                    sh \"\"\"\n+                    export platform=\\$(echo \"$ghprbCommentBody\" | cut -d \"@\" -f2)\n+                    export shortbranch=\"\\$(echo ${ghprbSourceBranch} | awk -F/ '{print \\$NF}')\"\n+                    echo \"Git branch ${ghprbSourceBranch} short name is \\${shortbranch}\"\n+                    export srcver=\"\\$(mvn org.apache.maven.plugins:maven-help-plugin:2.1.1:evaluate -Dexpression=project.version 2>&1 | egrep -v '(^\\\\[|Download(ed|ing):)' | grep '^[0-9]' | head -1)\"\n+                    echo \"Maven project version is \\${srcver}\"\n+                    export newsrcver=\"\\${srcver}-${BUILD_NUMBER}-\\${shortbranch}\"\n+                    echo \"New Maven version is \\${newsrcver}\"\n+                    echo \"Using Maven versions plugin and in-line sed to set version to \\${newsrcver}\" \n+                    mvn versions:set -DnewVersion=\"\\${newsrcver}\" -Pcore,\\${platform},ee -l /dev/null\n+                    mvn versions:commit\n+                    echo \"Saving branch and version info to branch.env\"\n+                    echo \"export shortbranch=\\${shortbranch}\" > branch.env\n+                    echo \"export srcver=\\${srcver}\" >> branch.env\n+                    echo \"export newsrcver=\\${newsrcver}\" >> branch.env\n+                    echo \"\\${newsrcver}\" > version.txt\n+                    mvn -B -e --fail-at-end clean -DskipTests\n+                    cp pipelines/template/settings.xml ~/.m2/settings.xml\n+                    sed  -i \"s/REPLACE_USER/$ARTIFACT_USER/\" ~/.m2/settings.xml\n+                    sed  -i \"s/REPLACE_PASS/$ARTIFACT_PASSWORD/\" ~/.m2/settings.xml\n+\n+                    if [[ \"\\$platform\" =~ ^mem ]] ; then\n+                        profiles=\"core,mem\"\n+                    elif [[ \"\\$platform\" =~ ^cdh ]] ; then\n+                        profiles=\"core,ee,parcel,\\$platform\"\n+                    elif [[ \"\\$platform\" =~ ^hdp ]] ; then\n+                        profiles=\"core,ee,hdp_service,\\$platform\"\n+                    elif [[ \"\\$platform\" =~ ^hdp ]] ; then\n+                        profiles=\"core,ee,hdp_service,\\$platform\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8b1f6fa46e5400861743da418ff891eaaf17037"}, "originalPosition": 85}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2987, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}