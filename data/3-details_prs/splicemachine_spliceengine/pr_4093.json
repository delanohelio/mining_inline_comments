{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMzg2NDIx", "number": 4093, "title": "DB-10194 Create new database through JDBC connect", "bodyText": "", "createdAt": "2020-09-07T13:23:00Z", "url": "https://github.com/splicemachine/spliceengine/pull/4093", "merged": true, "mergeCommit": {"oid": "69238bf0d955ddb242d3ee51ec7cb5294a2db798"}, "closed": true, "closedAt": "2020-09-14T16:43:32Z", "author": {"login": "arnaud-splice"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGi6yhAH2gAyNDgxMzg2NDIxOmFiY2VkZWFkZjY4NWIxMDMyNzlkODgyNTUzMWYzNzU1Yzg4YjFmZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIyNfUgFqTQ4NzY5NDA3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "abcedeadf685b103279d8825531f3755c88b1fed", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/abcedeadf685b103279d8825531f3755c88b1fed", "committedDate": "2020-09-07T13:21:46Z", "message": "DB-10194 Multidatabase first commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12ec3394e5f2a9f304a861b887d80bbd8851c480", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/12ec3394e5f2a9f304a861b887d80bbd8851c480", "committedDate": "2020-09-07T13:21:58Z", "message": "DB-10194 Support 'show databases' in sqlshell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9501b63d987c662b8fa1183ae24f0e84bc8c4351", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/9501b63d987c662b8fa1183ae24f0e84bc8c4351", "committedDate": "2020-09-07T13:22:02Z", "message": "DB-10194 Create new database with correct uuid. New schemas use that uuid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6262470187844dbb180354b71a4e60b9bb64aa", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/9d6262470187844dbb180354b71a4e60b9bb64aa", "committedDate": "2020-09-07T13:22:08Z", "message": "DB-10194 Use placeholders in database authorizationId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f2ccd4b963bd8c79109c5f524990a3a0119c478", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/2f2ccd4b963bd8c79109c5f524990a3a0119c478", "committedDate": "2020-09-07T17:26:57Z", "message": "DB-10194 Fix spotbugs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d266e38cc4b3ccef3e928af3c905ab6d4c974e4f", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/d266e38cc4b3ccef3e928af3c905ab6d4c974e4f", "committedDate": "2020-09-07T16:46:29Z", "message": "DB-10194 Fix spotbugs"}, "afterCommit": {"oid": "2f2ccd4b963bd8c79109c5f524990a3a0119c478", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/2f2ccd4b963bd8c79109c5f524990a3a0119c478", "committedDate": "2020-09-07T17:26:57Z", "message": "DB-10194 Fix spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71fe88feb22ffbeb20c871532504e87e5a757229", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/71fe88feb22ffbeb20c871532504e87e5a757229", "committedDate": "2020-09-08T08:24:51Z", "message": "DB-10194 Fix more spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48c4bbf426ce5b81f6a89da0c10edf0c3a29fe35", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/48c4bbf426ce5b81f6a89da0c10edf0c3a29fe35", "committedDate": "2020-09-08T11:53:37Z", "message": "DB-10194 Fix even more spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bc871ce0ff9e97edd16d380bdf41f4f5e01e833", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/3bc871ce0ff9e97edd16d380bdf41f4f5e01e833", "committedDate": "2020-09-08T12:05:47Z", "message": "DB-10194 Fix even more spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09a33748eaf83acd39ca0ac3bd9375ac5bb29294", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/09a33748eaf83acd39ca0ac3bd9375ac5bb29294", "committedDate": "2020-09-08T20:28:42Z", "message": "DB-10194 Fix aggressive assert"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDIxNDIz", "url": "https://github.com/splicemachine/spliceengine/pull/4093#pullrequestreview-485421423", "createdAt": "2020-09-09T21:37:41Z", "commit": {"oid": "09a33748eaf83acd39ca0ac3bd9375ac5bb29294"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTozNzo0MVrOHPbMaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTozNzo0MVrOHPbMaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzNjIzMw==", "bodyText": "SYS tables are not open for public to SELECT. So normally we don't directly query SYS but views in SYSVW. Please see if there is a need to create a corresponding view in SYSVW, and query the view instead.", "url": "https://github.com/splicemachine/spliceengine/pull/4093#discussion_r485936233", "createdAt": "2020-09-09T21:37:41Z", "author": {"login": "yxia92"}, "path": "db-tools-ij/src/main/grammar/ij.jj", "diffHunk": "@@ -983,168 +983,197 @@ class ij {\n         }\n     }\n \n-\t/**\n-\t   Return a resultset of schemas from database metadata\n-\t */\n-\tpublic ijResult showSchemas() throws SQLException {\n-\t\tResultSet rs = null;\n-\t\ttry {\n-\t\t\thaveConnection();\n+    /**\n+       Return a resultset of schemas from database metadata\n+     */\n+    public ijResult showSchemas() throws SQLException {\n+        ResultSet rs = null;\n+        try {\n+            haveConnection();\n \n-\t\t\tDatabaseMetaData dbmd = theConnection.getMetaData();\n-\t\t\trs = dbmd.getSchemas();\n+            DatabaseMetaData dbmd = theConnection.getMetaData();\n+            rs = dbmd.getSchemas();\n \n-\t\t\tint[] displayColumns = new int[] {\n-\t\t\t\trs.findColumn(\"TABLE_SCHEM\")\n-\t\t\t};\n-\t\t\tint[] columnWidths = new int[] {\n-\t\t\t\t30\n-\t\t\t};\n+            int[] displayColumns = new int[] {\n+                rs.findColumn(\"TABLE_SCHEM\")\n+            };\n+            int[] columnWidths = new int[] {\n+                30\n+            };\n \n-\t\t\treturn new ijResultSetResult(rs, displayColumns, columnWidths);\n-\t\t} catch (SQLException e) {\n+            return new ijResultSetResult(rs, displayColumns, columnWidths);\n+        } catch (SQLException e) {\n+            try {\n+                if(rs!=null)\n+                    rs.close();\n+            } catch (SQLException se) {\n+            }\n+            throw e;\n+        }\n+    }\n+\n+    /**\n+       Return a resultset of databases from database metadata\n+     */\n+    public ijResult showDatabases() throws SQLException {\n+        ResultSet rs = null;\n+        try {\n+            haveConnection();\n+\n+            rs = theConnection.createStatement().executeQuery\n+                (\"SELECT DATABASENAME FROM SYS.SYSDATABASES\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09a33748eaf83acd39ca0ac3bd9375ac5bb29294"}, "originalPosition": 1388}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/d080b39e81b476882b750fc41fdaf85254ab3f30", "committedDate": "2020-09-10T12:19:21Z", "message": "DB-10194 Use sysvw instead of sys in 'show databases'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTU5NTk5", "url": "https://github.com/splicemachine/spliceengine/pull/4093#pullrequestreview-486959599", "createdAt": "2020-09-11T16:39:31Z", "commit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjM0MTIy", "url": "https://github.com/splicemachine/spliceengine/pull/4093#pullrequestreview-487634122", "createdAt": "2020-09-14T10:47:49Z", "commit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMDo0Nzo0OVrOHROLjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMDo0Nzo0OVrOHROLjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgyMDE3NQ==", "bodyText": "this call is not assign to any variable, usually paramType. Looks like not needed any more and can be removed.", "url": "https://github.com/splicemachine/spliceengine/pull/4093#discussion_r487820175", "createdAt": "2020-09-14T10:47:49Z", "author": {"login": "ipraznik-splice"}, "path": "db-client/src/main/java/com/splicemachine/db/client/am/PreparedStatement.java", "diffHunk": "@@ -941,8 +944,8 @@ public void setRowId(int parameterIndex, java.sql.RowId x) throws SQLException{\n                     agent_.logWriter_.traceEntry(this, \"setRowId\", parameterIndex, x);\n                 }\n \n-                final int paramType =\n-                        getColumnMetaDataX().getColumnType(parameterIndex);\n+                getColumnMetaDataX().getColumnType(parameterIndex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjM4MDg5", "url": "https://github.com/splicemachine/spliceengine/pull/4093#pullrequestreview-487638089", "createdAt": "2020-09-14T10:53:20Z", "commit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMDo1MzoyMFrOHROWjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMDo1MzoyMFrOHROWjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgyMjk5MA==", "bodyText": "this call is not assign to any variable", "url": "https://github.com/splicemachine/spliceengine/pull/4093#discussion_r487822990", "createdAt": "2020-09-14T10:53:20Z", "author": {"login": "ipraznik-splice"}, "path": "db-client/src/main/java/com/splicemachine/db/client/net/NetConnectionReply.java", "diffHunk": "@@ -296,8 +289,9 @@ private void parseSECCHKreply(NetConnection netConnection) throws DisconnectExce\n             // incorrect but consider it a conversation protocol error\n             // 0x03 - OBJDSS sent when not allowed.\n             //parseSECTKN (true);\n-            boolean done = false;\n-            byte[] bytes = parseSECTKN(false);\n+            //boolean done = false;\n+            //byte[] bytes = parseSECTKN(false);\n+            parseSECTKN(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjUyODQz", "url": "https://github.com/splicemachine/spliceengine/pull/4093#pullrequestreview-487652843", "createdAt": "2020-09-14T11:15:22Z", "commit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMToxNToyM1rOHRPCpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMToxNToyM1rOHRPCpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzNDI3OQ==", "bodyText": "is it used somewhere in subclasses? in EmbedConnection I see only .set and .remove", "url": "https://github.com/splicemachine/spliceengine/pull/4093#discussion_r487834279", "createdAt": "2020-09-14T11:15:23Z", "author": {"login": "ipraznik-splice"}, "path": "db-engine/src/main/java/com/splicemachine/db/impl/jdbc/EmbedConnection.java", "diffHunk": "@@ -101,7 +102,8 @@\n  */\n public abstract class EmbedConnection implements EngineConnection\n {\n-\tprotected static final StandardException exceptionClose = StandardException.closeException();\n+    public static final ThreadLocal<Boolean> isCreate = new ThreadLocal<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjkyOTQz", "url": "https://github.com/splicemachine/spliceengine/pull/4093#pullrequestreview-487692943", "createdAt": "2020-09-14T12:16:59Z", "commit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMjoxNzowMFrOHRQ9kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMjoxNzowMFrOHRQ9kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2NTc0Ng==", "bodyText": "Should be removed?:)", "url": "https://github.com/splicemachine/spliceengine/pull/4093#discussion_r487865746", "createdAt": "2020-09-14T12:17:00Z", "author": {"login": "ipraznik-splice"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/jdbc/SpliceTransactionResourceImpl.java", "diffHunk": "@@ -51,14 +51,18 @@\n     protected LanguageConnectionContext lcc;\n     protected String ipAddress;\n \n-    public SpliceTransactionResourceImpl() throws SQLException{\n-        this(CONNECTION_STRING, new Properties());\n+    public SpliceTransactionResourceImpl() throws SQLException{ // XXX Remove this one and properly pass the right DB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Njk0MDcz", "url": "https://github.com/splicemachine/spliceengine/pull/4093#pullrequestreview-487694073", "createdAt": "2020-09-14T12:18:37Z", "commit": {"oid": "d080b39e81b476882b750fc41fdaf85254ab3f30"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1157, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}