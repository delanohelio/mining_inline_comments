{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3ODU4MTY5", "number": 3475, "title": "DB-9439 Handle carried bytes correctly when computing cutpoints", "bodyText": "", "createdAt": "2020-04-23T11:36:34Z", "url": "https://github.com/splicemachine/spliceengine/pull/3475", "merged": true, "mergeCommit": {"oid": "7fc3e35d552900483de75948535c069384d1475c"}, "closed": true, "closedAt": "2020-04-29T04:48:19Z", "author": {"login": "dgomezferro"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcabRkCAH2gAyNDA3ODU4MTY5Ojk0OWY3M2Q2YmRjYjQ0Y2M1MDdhMjEyMmQ3ZjE5MTBlZDFmOTllN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb-g9SgFqTQwMTU1NTM5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "949f73d6bdcb44cc507a2122d7f1910ed1f99e7b", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/949f73d6bdcb44cc507a2122d7f1910ed1f99e7b", "committedDate": "2020-04-23T11:34:44Z", "message": "DB-9439 Handle carried bytes correctly when computing cutpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11b572fd16c283f60cf0ec4f712c79e1e8f6bcaa", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/11b572fd16c283f60cf0ec4f712c79e1e8f6bcaa", "committedDate": "2020-04-23T16:08:16Z", "message": "DB-9439 Always check source for region sizes when computing splits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NTIzMjcw", "url": "https://github.com/splicemachine/spliceengine/pull/3475#pullrequestreview-399523270", "createdAt": "2020-04-23T22:33:11Z", "commit": {"oid": "11b572fd16c283f60cf0ec4f712c79e1e8f6bcaa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMjozMzoxMVrOGK-zcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMjozMzoxMVrOGK-zcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE2NzkyMg==", "bodyText": "Why do we need to add store.getMemStoreSize() in the calculation? How do we compute the cutpoint for content in memStore? I don't see any logic about it. Will all content in memStore go into one split?\nA few lines below bytesPerSplitEvenDistribution is computed which is the value eventually used as the splitBlockSize to calculate the cutpoints. And it uses this formula:\n            long bytesPerSplitEvenDistribution = totalStoreFileInBytes / numSplits;\n\nThis does not consider memStoreSize. is it intended?", "url": "https://github.com/splicemachine/spliceengine/pull/3475#discussion_r414167922", "createdAt": "2020-04-23T22:33:11Z", "author": {"login": "yxia92"}, "path": "hbase_storage/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionUtil.java", "diffHunk": "@@ -98,7 +98,7 @@ public static void updateReadRequests(HRegion region,long numReads){\n                     totalStoreFileInBytes += ((HStoreFile) file).getFileInfo().getFileStatus().getLen();\n                 }\n             }\n-            numSplits = totalStoreFileInBytes / bytesPerSplit;\n+            numSplits = (totalStoreFileInBytes + store.getMemStoreSize()) / bytesPerSplit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11b572fd16c283f60cf0ec4f712c79e1e8f6bcaa"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9693f9579bceb7de6fb777dae5c29603702f5df", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/f9693f9579bceb7de6fb777dae5c29603702f5df", "committedDate": "2020-04-24T08:38:42Z", "message": "DB-9439 Add clarifying comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "622e23edd31ce1d3ecfb9152884e3084ba56ae9c", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/622e23edd31ce1d3ecfb9152884e3084ba56ae9c", "committedDate": "2020-04-24T15:59:49Z", "message": "DB-9439 Fix build, 2.0 API change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDkyODI1", "url": "https://github.com/splicemachine/spliceengine/pull/3475#pullrequestreview-400092825", "createdAt": "2020-04-24T16:23:33Z", "commit": {"oid": "622e23edd31ce1d3ecfb9152884e3084ba56ae9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMjIyNDAy", "url": "https://github.com/splicemachine/spliceengine/pull/3475#pullrequestreview-401222402", "createdAt": "2020-04-27T18:35:44Z", "commit": {"oid": "622e23edd31ce1d3ecfb9152884e3084ba56ae9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNTU1Mzk3", "url": "https://github.com/splicemachine/spliceengine/pull/3475#pullrequestreview-401555397", "createdAt": "2020-04-28T07:12:09Z", "commit": {"oid": "622e23edd31ce1d3ecfb9152884e3084ba56ae9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1376, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}