{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMTIxNjk2", "number": 4574, "title": "DB-10705 fix transaction time travel search algorithm behavior", "bodyText": "The time travel search algorithm is a simple binary search algorithm whose search domain is splice transaction table. When implementing this algorithm I made the wrong assumption that transactions have uniquely identified active timestamps. This false assumption went unnoticed under normal workloads, however testing with a TPC-C which puts the system under heavy transactional load exposed it because many transactions could actually share the same time causing the algorithm to loop forever.\nA unit test is added that simulates such workload and verifies the fix.", "createdAt": "2020-11-12T19:54:32Z", "url": "https://github.com/splicemachine/spliceengine/pull/4574", "merged": true, "mergeCommit": {"oid": "6d9160fca10e185c54478825541ce48d2c715205"}, "closed": true, "closedAt": "2020-11-13T00:23:48Z", "author": {"login": "hatyo"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbzcYegH2gAyNTIwMTIxNjk2OjMzYTNkMDg5MjAxNmVhZGFkNmY2MjEyMzg2ZjU3YjZjZDM2NTc1NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdb6OW5AFqTUyOTU0ODIwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "33a3d0892016eadad6f6212386f57b6cd365755e", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/33a3d0892016eadad6f6212386f57b6cd365755e", "committedDate": "2020-11-12T14:29:21Z", "message": "DB-10705 WIP."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "191b1e504fbed0f4d6b9bb3b5014621b59799966", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/191b1e504fbed0f4d6b9bb3b5014621b59799966", "committedDate": "2020-11-12T19:45:00Z", "message": "DB-10705 fix txn traveler search algorithm behavior."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61d9757759963d938c58ab99a21ca07c79f74927", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/61d9757759963d938c58ab99a21ca07c79f74927", "committedDate": "2020-11-12T19:46:25Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10705"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NDc0MTIw", "url": "https://github.com/splicemachine/spliceengine/pull/4574#pullrequestreview-529474120", "createdAt": "2020-11-12T20:31:41Z", "commit": {"oid": "61d9757759963d938c58ab99a21ca07c79f74927"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NTAyMTMy", "url": "https://github.com/splicemachine/spliceengine/pull/4574#pullrequestreview-529502132", "createdAt": "2020-11-12T21:14:06Z", "commit": {"oid": "61d9757759963d938c58ab99a21ca07c79f74927"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMToxNDowNlrOHyOmcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMToxNDowNlrOHyOmcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQzMDA2NA==", "bodyText": "changed = true; is common in both conditional branches, can be moved outside if", "url": "https://github.com/splicemachine/spliceengine/pull/4574#discussion_r522430064", "createdAt": "2020-11-12T21:14:06Z", "author": {"login": "OlegMazurov"}, "path": "hbase_storage/src/main/java/com/splicemachine/si/impl/region/TxnTimeTraveler.java", "diffHunk": "@@ -52,14 +52,14 @@ public TxnTimeTraveler(TxnFinder txnFinder) {\n             if(middleTS == needleTS) {\n                 return middleTx;\n             } else if(needleTS < middleTS) {\n+                right = toRowKeyWithBucket(middleTx.getFirst(), bucket);\n                 if(middleTS == rightTS)\n                 {\n                     reversed = true;\n                     changed = true;\n                 }\n                 else if(middleTS < rightTS)\n                 {\n-                    right = toRowKeyWithBucket(middleTx.getFirst(), bucket);\n                     rightTS = middleTS;\n                     changed = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61d9757759963d938c58ab99a21ca07c79f74927"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NTQ4MjAy", "url": "https://github.com/splicemachine/spliceengine/pull/4574#pullrequestreview-529548202", "createdAt": "2020-11-12T22:23:22Z", "commit": {"oid": "61d9757759963d938c58ab99a21ca07c79f74927"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1046, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}