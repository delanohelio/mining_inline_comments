{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzUxNDAy", "number": 3668, "title": "DB-8190 DB-9604 Make Spark fetch and shuffle partitions configurable", "bodyText": "", "createdAt": "2020-06-10T10:10:25Z", "url": "https://github.com/splicemachine/spliceengine/pull/3668", "merged": true, "mergeCommit": {"oid": "13605026f448bd857b55ad751e28f58705f41737"}, "closed": true, "closedAt": "2020-06-16T15:33:45Z", "author": {"login": "dgomezferro"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpmGWFAH2gAyNDMyMzUxNDAyOjk5NjM3ZGM0OTkyOTE5NzY3OWIwNDNhZmJjM2JhMDU4ZTExYWIzMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr21rmAFqTQzMTYxOTkwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "99637dc49929197679b043afbc3ba058e11ab30b", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/99637dc49929197679b043afbc3ba058e11ab30b", "committedDate": "2020-06-09T14:40:18Z", "message": "DB-8190 Make ParallelPartitions configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5d6ed1fce94ada9cae0a6bed81c0d594c550397", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/c5d6ed1fce94ada9cae0a6bed81c0d594c550397", "committedDate": "2020-06-09T14:40:49Z", "message": "DB-9604 Make spark shuffle partitions configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "319406a823cbc845302de4aa4609007a97f32e7f", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/319406a823cbc845302de4aa4609007a97f32e7f", "committedDate": "2020-06-10T10:07:03Z", "message": "DB-8190 DB-9604 Fix connection string properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MTY5ODc2", "url": "https://github.com/splicemachine/spliceengine/pull/3668#pullrequestreview-429169876", "createdAt": "2020-06-11T18:13:28Z", "commit": {"oid": "319406a823cbc845302de4aa4609007a97f32e7f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODoxMzoyOFrOGipQQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODoxMzoyOFrOGipQQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk4MDY3NA==", "bodyText": "Is it possible session is not initialized and null when getSession s called first time?", "url": "https://github.com/splicemachine/spliceengine/pull/3668#discussion_r438980674", "createdAt": "2020-06-11T18:13:28Z", "author": {"login": "jyuanca"}, "path": "hbase_sql/src/main/java/com/splicemachine/derby/impl/SpliceSpark.java", "diffHunk": "@@ -70,14 +71,23 @@ private SpliceSpark() {} // private constructor forbids creating instances\n     private static final String OLD_SCOPE_KEY = \"spark.rdd.scope.old\";\n     private static final String OLD_SCOPE_OVERRIDE = \"spark.rdd.scope.noOverride.old\";\n \n+    public static void resetSession() {\n+        sessions.remove();\n+    }\n+\n     // Sets both ctx and session\n     public static synchronized SparkSession getSession() {\n         String threadName = Thread.currentThread().getName();\n         if (!SpliceClient.isClient() && !threadName.startsWith(\"olap-worker-\")) {\n              // Not running on the Olap Server... raise exception. Use getSessionUnsafe() if you know what you are doing.\n             throw new RuntimeException(\"Trying to get a SparkSession from outside the OlapServer\");\n         }\n-        return getSessionUnsafe();\n+        SparkSession result = sessions.get();\n+        if (result == null) {\n+            result = session.newSession();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "319406a823cbc845302de4aa4609007a97f32e7f"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MjA1MjQ5", "url": "https://github.com/splicemachine/spliceengine/pull/3668#pullrequestreview-429205249", "createdAt": "2020-06-11T19:05:30Z", "commit": {"oid": "c5d6ed1fce94ada9cae0a6bed81c0d594c550397"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxOTowNTozMFrOGiq6mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxOTowNTozMFrOGiq6mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAwNzg5OA==", "bodyText": "Why do we need to set shuffle partition property both here and in QueryJob?", "url": "https://github.com/splicemachine/spliceengine/pull/3668#discussion_r439007898", "createdAt": "2020-06-11T19:05:30Z", "author": {"login": "yxia92"}, "path": "hbase_sql/src/main/java/com/splicemachine/stream/StreamableRDD.java", "diffHunk": "@@ -153,6 +156,8 @@ private void submitBatch(int batch, int batchSize, int numPartitions, final Java\n             public Object call() throws Exception {\n                 SparkContext sc = SpliceSpark.getContextUnsafe().sc();\n                 sc.setLocalProperties(properties);\n+                if (shufflePartitions != null)\n+                    sc.setLocalProperty(SQLConf.SHUFFLE_PARTITIONS().key(), shufflePartitions.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5d6ed1fce94ada9cae0a6bed81c0d594c550397"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf20af02b3bf7ee7a11de04c35b2d60d621c344c", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/cf20af02b3bf7ee7a11de04c35b2d60d621c344c", "committedDate": "2020-06-12T10:47:13Z", "message": "DB-9604 Remove shufflePartitions from StreamableRDD\n\nThat was dead code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3760e9c2370913b5bc16826243941b062587e4b0", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/3760e9c2370913b5bc16826243941b062587e4b0", "committedDate": "2020-06-12T14:58:28Z", "message": "Merge remote-tracking branch 'origin/master' into DB-8190-DB-9604"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5ODc1NTQ2", "url": "https://github.com/splicemachine/spliceengine/pull/3668#pullrequestreview-429875546", "createdAt": "2020-06-12T16:21:42Z", "commit": {"oid": "3760e9c2370913b5bc16826243941b062587e4b0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f1684c81f814292d59265cdfadfd3e56f9b4739", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/6f1684c81f814292d59265cdfadfd3e56f9b4739", "committedDate": "2020-06-16T08:39:03Z", "message": "DB-9604 Make sure session is always initialized"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNTYwNjA5", "url": "https://github.com/splicemachine/spliceengine/pull/3668#pullrequestreview-431560609", "createdAt": "2020-06-16T14:24:44Z", "commit": {"oid": "6f1684c81f814292d59265cdfadfd3e56f9b4739"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjE5OTA1", "url": "https://github.com/splicemachine/spliceengine/pull/3668#pullrequestreview-431619905", "createdAt": "2020-06-16T15:18:20Z", "commit": {"oid": "6f1684c81f814292d59265cdfadfd3e56f9b4739"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1317, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}