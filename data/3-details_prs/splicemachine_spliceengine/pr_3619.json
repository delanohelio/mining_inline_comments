{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NjMzNTIy", "number": 3619, "title": "DB-9613 DefaultSourceIT Insertion with Sampling Fix", "bodyText": "Setting hbase.rpc.timeout to avoid rpc timeouts in Jenkins.\nThe reason for setting hbase.rootdir as a system property: the sqlContext.read calls returning the dataframes are implemented as calls to SplicemachineContext.df() in SpliceRelation.buildScan().  The df function uses an EmbeddedConnection to query the data from the db.  Somewhere in the call stack, SplitRegionScanner.createAndRegisterClientSideRegionScanner() is called and it looks for hbase.rootdir in config files or in system properties.  It wasn\u2019t getting the correct value for hbase.rootdir.  So the code was probably reading rows from the memstore, but didn\u2019t have the right path to HBase to be able to read the additional rows stored in HFiles, and so it wasn't returning all of the rows.  The solution for DefaultSourceIT was to set the value in system properties at the beginning of the test.  In normal environments, hbase-site.xml in the driver/executor extraClassPath would provide hbase.rootdir.  (Thanks to Jun for troubleshooting the cause of not all rows being retrieved.)", "createdAt": "2020-05-28T17:36:35Z", "url": "https://github.com/splicemachine/spliceengine/pull/3619", "merged": true, "mergeCommit": {"oid": "db0d2d2085fe44ed28feb5c88844c7a3af963d23"}, "closed": true, "closedAt": "2020-07-08T15:59:11Z", "author": {"login": "jpanko1"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclxK0rgH2gAyNDI0NjMzNTIyOjcwMmJjMzY4NDM0NjUwOTExOTMxODAxMDhjNTU3ODAwOTkxNWZlOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw36epAFqTQ0MTM1ODA0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "702bc36843465091193180108c5578009915fe90", "author": {"user": {"login": "jpanko1", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/702bc36843465091193180108c5578009915fe90", "committedDate": "2020-05-28T17:18:27Z", "message": "DB-9613 In DefaultSourceIT insertion with sampling test, decreased number of rows from 8,388,608 to 262,144."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMzYxMjEx", "url": "https://github.com/splicemachine/spliceengine/pull/3619#pullrequestreview-420361211", "createdAt": "2020-05-28T18:02:12Z", "commit": {"oid": "702bc36843465091193180108c5578009915fe90"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e07ff1b4188abf87f7849b331216165423f5966e", "author": {"user": {"login": "jpanko1", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/e07ff1b4188abf87f7849b331216165423f5966e", "committedDate": "2020-05-29T00:22:49Z", "message": "DB-9613 In DefaultSourceIT insertion with sampling test, restored number of rows to 8,388,608, and using jdbc internal connection for test setup and verification."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNzE1MTcw", "url": "https://github.com/splicemachine/spliceengine/pull/3619#pullrequestreview-420715170", "createdAt": "2020-05-29T07:30:42Z", "commit": {"oid": "e07ff1b4188abf87f7849b331216165423f5966e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTE0NjY0", "url": "https://github.com/splicemachine/spliceengine/pull/3619#pullrequestreview-421114664", "createdAt": "2020-05-29T16:40:34Z", "commit": {"oid": "e07ff1b4188abf87f7849b331216165423f5966e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5db0f4ca83d2b82f31efc5af5827d05d8ceb3660", "author": {"user": {"login": "jpanko1", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/5db0f4ca83d2b82f31efc5af5827d05d8ceb3660", "committedDate": "2020-06-03T00:35:19Z", "message": "DB-9613 In DefaultSourceIT insertion with sampling test, added hbase.rootdir as a system prop and removed use of jdbc internal connection."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2bfa78b48ac92d76c129353f5e5cb9ef20e166", "author": {"user": {"login": "jpanko1", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/fb2bfa78b48ac92d76c129353f5e5cb9ef20e166", "committedDate": "2020-06-03T21:44:52Z", "message": "DB-9613 In DefaultSourceIT insertion with sampling test, increased hbase.rpc.timeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MTkwMTk5", "url": "https://github.com/splicemachine/spliceengine/pull/3619#pullrequestreview-424190199", "createdAt": "2020-06-04T07:54:41Z", "commit": {"oid": "fb2bfa78b48ac92d76c129353f5e5cb9ef20e166"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNzo1NDo0MVrOGe6DFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNzo1NDo0MVrOGe6DFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA2MTUyNQ==", "bodyText": "Would it be possible to make hbase-site.xml be part of the classpath of the ITs? I'm worried about other tests failing in the same way\nWe write hbase-site.xml to platform_it/target when standing up standalone, I think it would be a matter of adding that file to the ITs classpath", "url": "https://github.com/splicemachine/spliceengine/pull/3619#discussion_r435061525", "createdAt": "2020-06-04T07:54:41Z", "author": {"login": "dgomezferro"}, "path": "splice_spark/src/test/scala/com/splicemachine/spark/splicemachine/DefaultSourceIT.scala", "diffHunk": "@@ -117,9 +117,14 @@ class DefaultSourceIT extends FunSuite with TestContext with BeforeAndAfter with\n     assert(newDF.count == 20)\n   }\n \n-  test(\"insertion with sampling\") {  // DB-9395\n+  test(\"insertion with sampling\") {\n     val userDir: String = System.getProperty(\"user.dir\")\n-    val dataDir = userDir+\"/src/test/data/lineitem.csv\";\n+    val hbaseDir = new File(userDir).getParent + \"/platform_it/target/hbase\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb2bfa78b48ac92d76c129353f5e5cb9ef20e166"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee792542207900abb0bf287398b0c9c1246c0798", "author": {"user": {"login": "jpanko1", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/ee792542207900abb0bf287398b0c9c1246c0798", "committedDate": "2020-06-27T21:20:31Z", "message": "Merge branch 'master' into DB-9613"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2b5164b423898a54cde93d82af5b3fbcee96522", "author": {"user": {"login": "jpanko1", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/b2b5164b423898a54cde93d82af5b3fbcee96522", "committedDate": "2020-06-27T21:51:40Z", "message": "DB-9613 Removing unused import."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fb55e9202962c914d4ab8aca4884771f49ae943", "author": {"user": {"login": "jpanko1", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/9fb55e9202962c914d4ab8aca4884771f49ae943", "committedDate": "2020-06-27T21:53:06Z", "message": "DB-9613 Added hbase-site.xml to IT classpath."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMTU2OTA4", "url": "https://github.com/splicemachine/spliceengine/pull/3619#pullrequestreview-440156908", "createdAt": "2020-06-30T15:52:01Z", "commit": {"oid": "9fb55e9202962c914d4ab8aca4884771f49ae943"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzU4MDQz", "url": "https://github.com/splicemachine/spliceengine/pull/3619#pullrequestreview-441358043", "createdAt": "2020-07-02T05:23:06Z", "commit": {"oid": "9fb55e9202962c914d4ab8aca4884771f49ae943"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1301, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}