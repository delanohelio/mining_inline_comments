{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMDUxNTcy", "number": 4646, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDozNzoxNFrOE8pvow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNToyMTo1OVrOE8xcFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMDMzOTU1OnYy", "diffSide": "RIGHT", "path": "splice_machine/src/main/java/com/splicemachine/derby/utils/SpliceAdmin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDozNzoxNFrOH450tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDoxNzoyMFrOH5C4Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQyOTY4Nw==", "bodyText": "i guess we can remove this comment, since SELECT * FROM VALUES also has other problems (like fails for long results, see DB-10542)", "url": "https://github.com/splicemachine/spliceengine/pull/4646#discussion_r529429687", "createdAt": "2020-11-24T10:37:14Z", "author": {"login": "martinrupp"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/utils/SpliceAdmin.java", "diffHunk": "@@ -2273,16 +2273,22 @@ public static void INVALIDATE_GLOBAL_DICTIONARY_CACHE() throws Exception {\n     }\n \n     @SuppressFBWarnings(value=\"SQL_NONCONSTANT_STRING_PASSED_TO_EXECUTE\", justification=\"Intentional\")\n-    public static void SHOW_CREATE_TABLE(String schemaName, String tableName, ResultSet[] resultSet) throws SQLException\n+    public static void SHOW_CREATE_TABLE(String schemaName, String tableName, ResultSet[] resultSet) throws SQLException, StandardException\n     {\n-        List<String> ddls = SHOW_CREATE_TABLE_CORE(schemaName, tableName, false, true);\n-        StringBuilder sb = new StringBuilder(\"SELECT * FROM (VALUES '\");\n-        sb.append(ddls.get(0));\n-        sb.append(\";') FOO (DDL)\");\n-        resultSet[0] = executeStatement(sb);\n+        List<String> ddls = SHOW_CREATE_TABLE_CORE(schemaName, tableName, false);\n+\n+//        There are two solutions to have one place to escape single quotes. During the PR can chosen be the best one:\n+//        1) just to replace single quote by double quotes before wrapping to sql\n+//        StringBuilder sb = new StringBuilder(\"SELECT * FROM (VALUES '\");\n+//        sb.append(ddls.get(0).replace(\"'\", \"''\"));\n+//        sb.append(\";') FOO (DDL)\");\n+//        resultSet[0] = executeStatement(sb);\n+\n+//        2) to use ProcedureUtils.generateResult", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e124c3e202d10e6c8d3c900f08c137a7cf5cd40"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU3Nzk5MA==", "bodyText": "done", "url": "https://github.com/splicemachine/spliceengine/pull/4646#discussion_r529577990", "createdAt": "2020-11-24T14:17:20Z", "author": {"login": "ipraznik-splice"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/utils/SpliceAdmin.java", "diffHunk": "@@ -2273,16 +2273,22 @@ public static void INVALIDATE_GLOBAL_DICTIONARY_CACHE() throws Exception {\n     }\n \n     @SuppressFBWarnings(value=\"SQL_NONCONSTANT_STRING_PASSED_TO_EXECUTE\", justification=\"Intentional\")\n-    public static void SHOW_CREATE_TABLE(String schemaName, String tableName, ResultSet[] resultSet) throws SQLException\n+    public static void SHOW_CREATE_TABLE(String schemaName, String tableName, ResultSet[] resultSet) throws SQLException, StandardException\n     {\n-        List<String> ddls = SHOW_CREATE_TABLE_CORE(schemaName, tableName, false, true);\n-        StringBuilder sb = new StringBuilder(\"SELECT * FROM (VALUES '\");\n-        sb.append(ddls.get(0));\n-        sb.append(\";') FOO (DDL)\");\n-        resultSet[0] = executeStatement(sb);\n+        List<String> ddls = SHOW_CREATE_TABLE_CORE(schemaName, tableName, false);\n+\n+//        There are two solutions to have one place to escape single quotes. During the PR can chosen be the best one:\n+//        1) just to replace single quote by double quotes before wrapping to sql\n+//        StringBuilder sb = new StringBuilder(\"SELECT * FROM (VALUES '\");\n+//        sb.append(ddls.get(0).replace(\"'\", \"''\"));\n+//        sb.append(\";') FOO (DDL)\");\n+//        resultSet[0] = executeStatement(sb);\n+\n+//        2) to use ProcedureUtils.generateResult", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQyOTY4Nw=="}, "originalCommit": {"oid": "9e124c3e202d10e6c8d3c900f08c137a7cf5cd40"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMTYwMDIzOnYy", "diffSide": "RIGHT", "path": "splice_machine/src/test/java/com/splicemachine/derby/utils/ShowCreateTableIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNToyMTo1OVrOH5F8XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNToyMTo1OVrOH5F8XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTYyODI1Mg==", "bodyText": "awesome", "url": "https://github.com/splicemachine/spliceengine/pull/4646#discussion_r529628252", "createdAt": "2020-11-24T15:21:59Z", "author": {"login": "martinrupp"}, "path": "splice_machine/src/test/java/com/splicemachine/derby/utils/ShowCreateTableIT.java", "diffHunk": "@@ -618,4 +619,29 @@ private static void  checkEqualIgnoreConstraintOrder(String expected, String act\n         String expectedResult = Stream.of(expected.split(\"CONSTRAINT \")).map(str -> str.substring(0, str.length() - 2)).sorted().collect(Collectors.joining(\", \"));\n         Assert.assertEquals(expectedResult, result);\n     }\n+\n+    @Test\n+    public void testTableDDLLonger32672() throws Exception {\n+        StringBuilder columnsDdlBuilder = new StringBuilder();\n+        final String columnTypes[] = {\"VARCHAR(30)\", \"CHAR(10)\", \"BIGINT\", \"DATE\", \"INTEGER\", \"DECIMAL(4,2)\"};\n+        Random rand = new Random();\n+\n+        int columnCounter = 0;\n+        while (columnsDdlBuilder.length() < 43100) {\n+            if (columnCounter > 0) {\n+                columnsDdlBuilder.append(\",\");\n+            }\n+            columnsDdlBuilder.append(String.format(\"\\\"COL_%d\\\" %s\\n\", columnCounter++, columnTypes[rand.nextInt(columnTypes.length)]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "405661c3076f028741331061fa2fd89dd0044b03"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2801, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}