{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3Nzg2ODA2", "number": 4229, "title": "DB-10253 Extend AS OF to all types of scan", "bodyText": "", "createdAt": "2020-10-05T11:30:18Z", "url": "https://github.com/splicemachine/spliceengine/pull/4229", "merged": true, "mergeCommit": {"oid": "4c7f8bc3a3846ac59cdc0c5ee0698fe2f4c8234f"}, "closed": true, "closedAt": "2020-10-15T14:09:49Z", "author": {"login": "hatyo"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPh_HFAH2gAyNDk3Nzg2ODA2OmUzOTllNDRhYmRkMGNmNDAwMTI3YTcwN2QzMzNkYTc2ZGVjZmJjYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSiXiMgFqTUwODY2MjkwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e399e44abdd0cf400127a707d333da76decfbcc4", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/e399e44abdd0cf400127a707d333da76decfbcc4", "committedDate": "2020-10-05T11:21:54Z", "message": "DB-10253 Extend AS OF to all types of scan."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8580e6761c715e87a4f137d45441e880b9fb8334", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/8580e6761c715e87a4f137d45441e880b9fb8334", "committedDate": "2020-10-05T11:22:11Z", "message": "DB-10253 fix SpotBugs issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/3323e25407471c83337caa59887f632bd274a3cd", "committedDate": "2020-10-05T11:22:32Z", "message": "DB-10253 fix handling of null min. retention period."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzIyODY4", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-502722868", "createdAt": "2020-10-06T08:54:01Z", "commit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1NDowMVrOHc8gHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1NDowMVrOHc8gHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDExMzQzOQ==", "bodyText": "Given the code for SQLTimestamp above, it seems supporting SQLTime is trivial. Any reason to leave it for now?", "url": "https://github.com/splicemachine/spliceengine/pull/4229#discussion_r500113439", "createdAt": "2020-10-06T08:54:01Z", "author": {"login": "ascend1"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/operations/ScanOperation.java", "diffHunk": "@@ -450,4 +472,40 @@ public int getSplits() {\n     public FormatableBitSet getAccessedColumns() throws StandardException{\n         return scanInformation.getAccessedColumns();\n     }\n+\n+    private long mapToTxId(DataValueDescriptor dataValue) throws StandardException {\n+        if(dataValue instanceof SQLTimestamp) {\n+            Timestamp ts = ((SQLTimestamp)dataValue).getTimestamp(null);\n+            SpliceLogUtils.trace(LOG,\"time travel ts=%s\", ts.toString());\n+            try {\n+                return SIDriver.driver().getTxnStore().getTxnAt(ts.getTime());\n+            } catch (IOException e) {\n+                throw Exceptions.parseException(e);\n+            }\n+        }else if(dataValue instanceof SQLTinyint || dataValue instanceof SQLSmallint || dataValue instanceof SQLInteger || dataValue instanceof SQLLongint) {\n+            return dataValue.getLong();\n+        }else {\n+            throw StandardException.newException(SQLState.NOT_IMPLEMENTED); // fix me, we should read SqlTime as well.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzI1OTcy", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-502725972", "createdAt": "2020-10-06T08:57:34Z", "commit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1NzozNVrOHc8pKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1NzozNVrOHc8pKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDExNTc1NA==", "bodyText": "Is it sufficient to get one from activation.getLanguageConnectionContext().getContextManager()?", "url": "https://github.com/splicemachine/spliceengine/pull/4229#discussion_r500115754", "createdAt": "2020-10-06T08:57:35Z", "author": {"login": "ascend1"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/operations/ScanOperation.java", "diffHunk": "@@ -450,4 +472,40 @@ public int getSplits() {\n     public FormatableBitSet getAccessedColumns() throws StandardException{\n         return scanInformation.getAccessedColumns();\n     }\n+\n+    private long mapToTxId(DataValueDescriptor dataValue) throws StandardException {\n+        if(dataValue instanceof SQLTimestamp) {\n+            Timestamp ts = ((SQLTimestamp)dataValue).getTimestamp(null);\n+            SpliceLogUtils.trace(LOG,\"time travel ts=%s\", ts.toString());\n+            try {\n+                return SIDriver.driver().getTxnStore().getTxnAt(ts.getTime());\n+            } catch (IOException e) {\n+                throw Exceptions.parseException(e);\n+            }\n+        }else if(dataValue instanceof SQLTinyint || dataValue instanceof SQLSmallint || dataValue instanceof SQLInteger || dataValue instanceof SQLLongint) {\n+            return dataValue.getLong();\n+        }else {\n+            throw StandardException.newException(SQLState.NOT_IMPLEMENTED); // fix me, we should read SqlTime as well.\n+        }\n+    }\n+\n+    /**\n+     * @param pastTx The ID of the past transaction.\n+     * @return a view of a past transaction.\n+     */\n+    protected TxnView getPastTransaction(long pastTx) throws StandardException {\n+        TransactionController transactionExecute=activation.getLanguageConnectionContext().getTransactionExecute();\n+        ContextManager cm = ContextService.getFactory().newContextManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd"}, "originalPosition": 111}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzM3NTI2", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-502737526", "createdAt": "2020-10-06T09:11:31Z", "commit": {"oid": "e399e44abdd0cf400127a707d333da76decfbcc4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToxMTozMVrOHc9KOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToxMTozMVrOHc9KOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyNDIxOA==", "bodyText": "NOT_IMPLEMENTED is \"Feature not implemented: {0}.\", so requires a parameter.\ne.g.\nthrow StandardException.newException(SQLState.NOT_IMPLEMENTED, dataValue.getClass().getSimpleName() + \" can't be used in mapToTxId\" );", "url": "https://github.com/splicemachine/spliceengine/pull/4229#discussion_r500124218", "createdAt": "2020-10-06T09:11:31Z", "author": {"login": "martinrupp"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/operations/ScanOperation.java", "diffHunk": "@@ -450,4 +472,40 @@ public int getSplits() {\n     public FormatableBitSet getAccessedColumns() throws StandardException{\n         return scanInformation.getAccessedColumns();\n     }\n+\n+    private long mapToTxId(DataValueDescriptor dataValue) throws StandardException {\n+        if(dataValue instanceof SQLTimestamp) {\n+            Timestamp ts = ((SQLTimestamp)dataValue).getTimestamp(null);\n+            SpliceLogUtils.trace(LOG,\"time travel ts=%s\", ts.toString());\n+            try {\n+                return SIDriver.driver().getTxnStore().getTxnAt(ts.getTime());\n+            } catch (IOException e) {\n+                throw Exceptions.parseException(e);\n+            }\n+        }else if(dataValue instanceof SQLTinyint || dataValue instanceof SQLSmallint || dataValue instanceof SQLInteger || dataValue instanceof SQLLongint) {\n+            return dataValue.getLong();\n+        }else {\n+            throw StandardException.newException(SQLState.NOT_IMPLEMENTED); // fix me, we should read SqlTime as well.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e399e44abdd0cf400127a707d333da76decfbcc4"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNDk3MDQ5", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-503497049", "createdAt": "2020-10-07T03:17:20Z", "commit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNTQwMjIw", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-503540220", "createdAt": "2020-10-07T05:44:40Z", "commit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjEwNDc0", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-507210474", "createdAt": "2020-10-13T08:51:45Z", "commit": {"oid": "3323e25407471c83337caa59887f632bd274a3cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66a11add3619fabf4bce5a96dc3937cbc74d2091", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/66a11add3619fabf4bce5a96dc3937cbc74d2091", "committedDate": "2020-10-14T08:38:36Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10253"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c611027cecc5fdd1df4b225b26fd99c1949a59b", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/1c611027cecc5fdd1df4b225b26fd99c1949a59b", "committedDate": "2020-10-14T09:13:57Z", "message": "DB-10253 address comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTUzMzQ0", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-508153344", "createdAt": "2020-10-14T09:19:18Z", "commit": {"oid": "1c611027cecc5fdd1df4b225b26fd99c1949a59b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NjYyOTAx", "url": "https://github.com/splicemachine/spliceengine/pull/4229#pullrequestreview-508662901", "createdAt": "2020-10-14T19:30:21Z", "commit": {"oid": "1c611027cecc5fdd1df4b225b26fd99c1949a59b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1144, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}