{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExODg4Mjc3", "number": 4410, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToyNTo1OVrOEzEArQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToyNTo1OVrOEzEArQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxOTc4NTQxOnYy", "diffSide": "RIGHT", "path": "hbase_storage/src/main/java/com/splicemachine/si/impl/region/V2TxnDecoder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMToyNTo1OVrOHqDaqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo0MDozNVrOHqTsgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1ODIxNg==", "bodyText": "This is labelled \"committedWithoutGlobalTS\", but we're not checking if the transaction state is COMMITTED.  Should we add this state check so we don't resolve active transactions?", "url": "https://github.com/splicemachine/spliceengine/pull/4410#discussion_r513858216", "createdAt": "2020-10-29T01:25:59Z", "author": {"login": "msirek"}, "path": "hbase_storage/src/main/java/com/splicemachine/si/impl/region/V2TxnDecoder.java", "diffHunk": "@@ -197,9 +200,15 @@ protected long toLong(Cell data){\n         if (taskKv != null) {\n             taskId = decodeTaskId(taskKv);\n         }\n-        return composeValue(destinationTables,level,txnId,beginTs,parentTxnId,hasAdditive,\n-                isAdditive,commitTs,globalTs,state,kaTime,rollbackSubIds,taskId);\n+        TxnMessage.Txn txn = composeValue(destinationTables, level, txnId, beginTs, parentTxnId, hasAdditive,\n+                isAdditive, commitTs, globalTs, state, kaTime, rollbackSubIds, taskId);\n+\n+        boolean committedWithoutGlobalTS = txn.getInfo().getParentTxnid() > 0 && txn.getGlobalCommitTs() < 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43b10e2b1d71e99cf81fb3bb3650bd818345a8f2"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEyNDkzMQ==", "bodyText": "Good catch @msirek ! It's even worse than that, because we could resolve RolledBack subtransactions and end up in a similar situation to what this was trying to solve. I also added a test. Thanks!", "url": "https://github.com/splicemachine/spliceengine/pull/4410#discussion_r514124931", "createdAt": "2020-10-29T09:40:35Z", "author": {"login": "dgomezferro"}, "path": "hbase_storage/src/main/java/com/splicemachine/si/impl/region/V2TxnDecoder.java", "diffHunk": "@@ -197,9 +200,15 @@ protected long toLong(Cell data){\n         if (taskKv != null) {\n             taskId = decodeTaskId(taskKv);\n         }\n-        return composeValue(destinationTables,level,txnId,beginTs,parentTxnId,hasAdditive,\n-                isAdditive,commitTs,globalTs,state,kaTime,rollbackSubIds,taskId);\n+        TxnMessage.Txn txn = composeValue(destinationTables, level, txnId, beginTs, parentTxnId, hasAdditive,\n+                isAdditive, commitTs, globalTs, state, kaTime, rollbackSubIds, taskId);\n+\n+        boolean committedWithoutGlobalTS = txn.getInfo().getParentTxnid() > 0 && txn.getGlobalCommitTs() < 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1ODIxNg=="}, "originalCommit": {"oid": "43b10e2b1d71e99cf81fb3bb3650bd818345a8f2"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2844, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}