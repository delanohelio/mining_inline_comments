{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzkxMjI3", "number": 3425, "title": "SPLICE-1806 NullPointerException in the PipingCallBuffer (2.8)", "bodyText": "Backporting from 3.0", "createdAt": "2020-04-13T19:08:41Z", "url": "https://github.com/splicemachine/spliceengine/pull/3425", "merged": true, "mergeCommit": {"oid": "2d4785bb06cb53871beb07fee995cb1616091a65"}, "closed": true, "closedAt": "2020-04-16T05:07:47Z", "author": {"login": "OlegMazurov"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXTv4RAH2gAyNDAyNzkxMjI3OmQ3NTc4ZWRiZTAwNzU4YTQ1ZWRlNjNjNDQxZjFkZGNjMTQ1NDQ4YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYEBJKAFqTM5NDI3MjA3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d7578edbe00758a45ede63c441f1ddcc145448c6", "author": {"user": {"login": "OlegMazurov", "name": "Oleg Mazurov"}}, "url": "https://github.com/splicemachine/spliceengine/commit/d7578edbe00758a45ede63c441f1ddcc145448c6", "committedDate": "2020-04-13T19:06:50Z", "message": "SPLICE-1806 NullPointerException in the PipingCallBuffer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDk1NzA5", "url": "https://github.com/splicemachine/spliceengine/pull/3425#pullrequestreview-393095709", "createdAt": "2020-04-14T16:27:12Z", "commit": {"oid": "d7578edbe00758a45ede63c441f1ddcc145448c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MjcyMDc0", "url": "https://github.com/splicemachine/spliceengine/pull/3425#pullrequestreview-394272074", "createdAt": "2020-04-16T03:18:54Z", "commit": {"oid": "d7578edbe00758a45ede63c441f1ddcc145448c6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoxODo1NVrOGGTEZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoxODo1NVrOGGTEZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1NzA2Mg==", "bodyText": "Does skipping offline regions ever result in a case where we miss data? That is, is tableLocations ever used in a way that ignores a region that's temporarily down (due to an RS failure, say) such that the missing region doesn't get detected and reported later?", "url": "https://github.com/splicemachine/spliceengine/pull/3425#discussion_r409257062", "createdAt": "2020-04-16T03:18:55Z", "author": {"login": "carolp-503"}, "path": "hbase_storage/hbase1.1.2.2.5/src/main/java/com/splicemachine/storage/ClientPartition.java", "diffHunk": "@@ -153,32 +153,26 @@ public boolean checkAndPut(byte[] key,byte[] family,byte[] qualifier,byte[] expe\n             List<Partition> partitions;\n             if (!refresh) {\n                 partitions = partitionInfoCache.getIfPresent(tableName);\n-                if (partitions == null) {\n-                    partitions = formatPartitions(getAllRegionLocations(false));\n-                    assert partitions!=null:\"partitions are null\";\n-                    partitionInfoCache.put(tableName, partitions);\n+                if (partitions != null) {\n+                    return partitions;\n                 }\n-                return partitions;\n             }\n-            partitions = formatPartitions(getAllRegionLocations(true));\n-            partitionInfoCache.invalidate(tableName);\n-            assert partitions!=null:\"partitions are null\";\n-            partitionInfoCache.put(tableName,partitions);\n+            List<HRegionLocation> tableLocations = ((ClusterConnection) connection).locateRegions(tableName, !refresh, false);\n+            partitions = new ArrayList<>(tableLocations.size());\n+            for (HRegionLocation location : tableLocations){\n+                if (location.getServerName() == null) {     // ensure no offline regions\n+                    continue;\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7578edbe00758a45ede63c441f1ddcc145448c6"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1367, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}