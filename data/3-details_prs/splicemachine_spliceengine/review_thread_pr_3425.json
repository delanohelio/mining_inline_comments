{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzkxMjI3", "number": 3425, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoxODo1NVrODyUkxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoxODo1NVrODyUkxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDkyNDg3OnYy", "diffSide": "RIGHT", "path": "hbase_storage/hbase1.1.2.2.5/src/main/java/com/splicemachine/storage/ClientPartition.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoxODo1NVrOGGTEZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzoxODo1NVrOGGTEZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1NzA2Mg==", "bodyText": "Does skipping offline regions ever result in a case where we miss data? That is, is tableLocations ever used in a way that ignores a region that's temporarily down (due to an RS failure, say) such that the missing region doesn't get detected and reported later?", "url": "https://github.com/splicemachine/spliceengine/pull/3425#discussion_r409257062", "createdAt": "2020-04-16T03:18:55Z", "author": {"login": "carolp-503"}, "path": "hbase_storage/hbase1.1.2.2.5/src/main/java/com/splicemachine/storage/ClientPartition.java", "diffHunk": "@@ -153,32 +153,26 @@ public boolean checkAndPut(byte[] key,byte[] family,byte[] qualifier,byte[] expe\n             List<Partition> partitions;\n             if (!refresh) {\n                 partitions = partitionInfoCache.getIfPresent(tableName);\n-                if (partitions == null) {\n-                    partitions = formatPartitions(getAllRegionLocations(false));\n-                    assert partitions!=null:\"partitions are null\";\n-                    partitionInfoCache.put(tableName, partitions);\n+                if (partitions != null) {\n+                    return partitions;\n                 }\n-                return partitions;\n             }\n-            partitions = formatPartitions(getAllRegionLocations(true));\n-            partitionInfoCache.invalidate(tableName);\n-            assert partitions!=null:\"partitions are null\";\n-            partitionInfoCache.put(tableName,partitions);\n+            List<HRegionLocation> tableLocations = ((ClusterConnection) connection).locateRegions(tableName, !refresh, false);\n+            partitions = new ArrayList<>(tableLocations.size());\n+            for (HRegionLocation location : tableLocations){\n+                if (location.getServerName() == null) {     // ensure no offline regions\n+                    continue;\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7578edbe00758a45ede63c441f1ddcc145448c6"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3255, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}