{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNDkxMDMz", "number": 4264, "title": "DB-10368 Add SPLIT_PART function", "bodyText": "", "createdAt": "2020-10-12T10:44:58Z", "url": "https://github.com/splicemachine/spliceengine/pull/4264", "merged": true, "mergeCommit": {"oid": "299101bc52e45c166e8549d8e30a52fae3148389"}, "closed": true, "closedAt": "2020-10-15T14:07:11Z", "author": {"login": "ipraznik-splice"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRxlR-gH2gAyNTAxNDkxMDMzOjg2MzU0MzMyODM0MTEzZjRjZTMxMTAzM2EyMzk2OTMzZWY2NTc3MzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSyMF6AFqTUwOTQwNzIwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86354332834113f4ce311033a2396933ef657733", "author": {"user": {"login": "ipraznik-splice", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/86354332834113f4ce311033a2396933ef657733", "committedDate": "2020-10-12T10:40:01Z", "message": "DB-10368 Add SPLIT_PART function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjMzNDE3", "url": "https://github.com/splicemachine/spliceengine/pull/4264#pullrequestreview-507233417", "createdAt": "2020-10-13T09:17:53Z", "commit": {"oid": "86354332834113f4ce311033a2396933ef657733"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjM1MzE5", "url": "https://github.com/splicemachine/spliceengine/pull/4264#pullrequestreview-507235319", "createdAt": "2020-10-13T09:20:10Z", "commit": {"oid": "86354332834113f4ce311033a2396933ef657733"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOToyMDoxMFrOHgdaLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOToyMDoxMFrOHgdaLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5ODMxOA==", "bodyText": "Should that be a reserved keyword? I would rather have added it in the non reserved keyword list.", "url": "https://github.com/splicemachine/spliceengine/pull/4264#discussion_r503798318", "createdAt": "2020-10-13T09:20:10Z", "author": {"login": "arnaud-splice"}, "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/sqlgrammar.jj", "diffHunk": "@@ -18002,6 +18038,7 @@ reservedKeyword() :\n |    tok = <XMLSERIALIZE>\n |    tok = <XMLEXISTS>\n |    tok = <XMLQUERY>\n+|    tok = <SPLIT_PART>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86354332834113f4ce311033a2396933ef657733"}, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjM1Mzk2", "url": "https://github.com/splicemachine/spliceengine/pull/4264#pullrequestreview-507235396", "createdAt": "2020-10-13T09:20:16Z", "commit": {"oid": "86354332834113f4ce311033a2396933ef657733"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOToyMDoxNlrOHgdadQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOToyOTo1M1rOHgd0vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5ODM4OQ==", "bodyText": "what happens if partIndex is negative?", "url": "https://github.com/splicemachine/spliceengine/pull/4264#discussion_r503798389", "createdAt": "2020-10-13T09:20:16Z", "author": {"login": "hatyo"}, "path": "db-engine/src/main/java/com/splicemachine/db/iapi/types/SQLChar.java", "diffHunk": "@@ -2644,6 +2645,57 @@ public ConcatableDataValue substring(\n         return stringResult;\n     }\n \n+    /**\n+     * The SQL split_part() is used to split a given string based on a delimiter and pick out the desired field from the string, start from the left of the string.\n+     *\n+     * @param delimiter the delimiter of the defined string\n+     * @param fieldNumber number of a result field\n+     * @param result The result of a previous call to this method, null if not called yet.\n+     *\n+     * @return  A StringDataValue containing the result of the split_part()\n+     *\n+     * @exception StandardException     Thrown on error\n+     */\n+    public StringDataValue split_part(\n+            StringDataValue delimiter,\n+            NumberDataValue fieldNumber,\n+            StringDataValue result)\n+            throws StandardException\n+    {\n+        StringDataValue stringResult;\n+\n+        if (result == null)\n+        {\n+            result = getNewVarchar();\n+        }\n+\n+        stringResult = (StringDataValue) result;\n+\n+        // The result is null if the receiver (this) is null\n+        // or either operand is null.\n+\n+        if (this.isNull() ||\n+                delimiter == null || delimiter.isNull() || delimiter.getString() == null ||\n+                fieldNumber == null || fieldNumber.isNull())\n+        {\n+            stringResult.setToNull();\n+            return stringResult;\n+        }\n+\n+        String valueParts[] = getString().split(Pattern.quote(delimiter.getString()));\n+        int partIndex = fieldNumber.getInt();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86354332834113f4ce311033a2396933ef657733"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwNTExOQ==", "bodyText": "Could you please rewrite:\nString.format(\"select split_part(e, ' ', %d), e from \", fieldNumber) + tableWatcherB\nto:\nString.format(\"select split_part(e, ' ', %d), e from %s\", fieldNumber, tableWatcherB)", "url": "https://github.com/splicemachine/spliceengine/pull/4264#discussion_r503805119", "createdAt": "2020-10-13T09:29:53Z", "author": {"login": "hatyo"}, "path": "splice_machine/src/test/java/com/splicemachine/derby/impl/sql/execute/operations/TernaryOperationIT.java", "diffHunk": "@@ -484,5 +481,49 @@ public void testSTRIPNegative() throws Exception {\n             Assert.assertTrue(\"Unexpected error code: \" + e.getSQLState(),  SQLState.LANG_SYNTAX_ERROR.startsWith(e.getSQLState()));\n         }\n     }\n+\n+    private void executeAndCheckSplitPart(int fieldNumber) throws SQLException {\n+        int count = 0;\n+        String sCell1 = null;\n+        String sCell2 = null;\n+        ResultSet rs;\n+\n+        rs = methodWatcher.executeQuery(String.format(\"select split_part(e, ' ', %d), e from \", fieldNumber) + tableWatcherB);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86354332834113f4ce311033a2396933ef657733"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c377cd5c2d34460a36f5d2860692756f277c2887", "author": {"user": {"login": "ipraznik-splice", "name": null}}, "url": "https://github.com/splicemachine/spliceengine/commit/c377cd5c2d34460a36f5d2860692756f277c2887", "committedDate": "2020-10-14T09:27:10Z", "message": "DB-10368 PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODE4MDU5", "url": "https://github.com/splicemachine/spliceengine/pull/4264#pullrequestreview-508818059", "createdAt": "2020-10-14T22:36:50Z", "commit": {"oid": "c377cd5c2d34460a36f5d2860692756f277c2887"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDkwNzcy", "url": "https://github.com/splicemachine/spliceengine/pull/4264#pullrequestreview-509090772", "createdAt": "2020-10-15T07:28:40Z", "commit": {"oid": "c377cd5c2d34460a36f5d2860692756f277c2887"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NDA3MjAy", "url": "https://github.com/splicemachine/spliceengine/pull/4264#pullrequestreview-509407202", "createdAt": "2020-10-15T13:56:20Z", "commit": {"oid": "c377cd5c2d34460a36f5d2860692756f277c2887"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1092, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}