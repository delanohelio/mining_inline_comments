{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NzA2NzY5", "number": 3458, "title": "DB-9423: fix foreign key constraint uniqueness", "bodyText": "", "createdAt": "2020-04-21T14:21:19Z", "url": "https://github.com/splicemachine/spliceengine/pull/3458", "merged": true, "mergeCommit": {"oid": "c83809fa23d37b81f991f4d3ca43ad1584cc4aae"}, "closed": true, "closedAt": "2020-07-17T17:54:38Z", "author": {"login": "jyuanca"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ11StAFqTM5NzQ1ODEwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1Y9NlgFqTQ0OTUzMTAxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NDU4MTA2", "url": "https://github.com/splicemachine/spliceengine/pull/3458#pullrequestreview-397458106", "createdAt": "2020-04-21T15:57:23Z", "commit": {"oid": "a38e1181d1856f765d446d7ac1942836bb184ada"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a38e1181d1856f765d446d7ac1942836bb184ada", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/a38e1181d1856f765d446d7ac1942836bb184ada", "committedDate": "2020-04-21T14:19:14Z", "message": "DB-9423: fix foreign key constraint uniqueness"}, "afterCommit": {"oid": "7b0f32b303efaaf0791e18c78e4314849575b055", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/7b0f32b303efaaf0791e18c78e4314849575b055", "committedDate": "2020-04-25T00:41:16Z", "message": "DB-9423: fix foreign key constraint uniqueness"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "738f005bae97a353aad671d5ddca63715a582741", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/738f005bae97a353aad671d5ddca63715a582741", "committedDate": "2020-05-13T00:11:03Z", "message": "address review comments"}, "afterCommit": {"oid": "28928badb575891ff2754fa0e5eb3f558cf0b9f0", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/28928badb575891ff2754fa0e5eb3f558cf0b9f0", "committedDate": "2020-06-11T16:13:54Z", "message": "address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjI3OTg1", "url": "https://github.com/splicemachine/spliceengine/pull/3458#pullrequestreview-441227985", "createdAt": "2020-07-01T22:09:32Z", "commit": {"oid": "28928badb575891ff2754fa0e5eb3f558cf0b9f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjQ3NDEz", "url": "https://github.com/splicemachine/spliceengine/pull/3458#pullrequestreview-441247413", "createdAt": "2020-07-01T23:00:25Z", "commit": {"oid": "28928badb575891ff2754fa0e5eb3f558cf0b9f0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzowMDoyNVrOGr39Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzowMDoyNVrOGr39Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1ODczOA==", "bodyText": "Could you also add check so that if  excludeNulls or excludeDefaults do not match, the index cannot be shared either?\nHere is a test case:\ncreate table b(i int, j int, primary key (i));\ncreate table a (i int, j int);\ninsert into b values (1,1);\ninsert into a values (1,1);\ncreate index aj on a(j) exclude null keys;\nalter table a add CONSTRAINT fc FOREIGN KEY(j) REFERENCES b(i) ON UPDATE NO ACTION ON DELETE restrict;\nsplice> show indexes from a;\nTABLE_NAME                                        |INDEX_NAME                                        |COLUMN_NAME         |ORDINAL&|NON_UNIQUE|TYPE |ASC&|CONGLOM_NO\n--------------------------------------------------------------------------------------------------------------------------------------------------------------------\nA                                                 |AJ                                                |J                   |1       |true      |BTREE|A   |1665      \nA                                                 |SQL200701155616910                                |J                   |1       |true      |BTREE|A   |1665      \n\n2 rows selected\nELAPSED TIME = 1531 milliseconds", "url": "https://github.com/splicemachine/spliceengine/pull/3458#discussion_r448658738", "createdAt": "2020-07-01T23:00:25Z", "author": {"login": "yxia92"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/CreateIndexConstantOperation.java", "diffHunk": "@@ -452,6 +452,9 @@ public void executeConstantAction( Activation activation ) throws StandardExcept\n                 }\n \n                 IndexRowGenerator irg = cd.getIndexDescriptor();\n+                if (irg.isUnique() != unique) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28928badb575891ff2754fa0e5eb3f558cf0b9f0"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28928badb575891ff2754fa0e5eb3f558cf0b9f0", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/28928badb575891ff2754fa0e5eb3f558cf0b9f0", "committedDate": "2020-06-11T16:13:54Z", "message": "address review comments"}, "afterCommit": {"oid": "26d5a3494447575f9221abdb727bf1ac40ba8052", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/26d5a3494447575f9221abdb727bf1ac40ba8052", "committedDate": "2020-07-02T04:29:52Z", "message": "DB-9423: fix foreign key constraint uniqueness"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODcxODQ1", "url": "https://github.com/splicemachine/spliceengine/pull/3458#pullrequestreview-441871845", "createdAt": "2020-07-02T16:57:39Z", "commit": {"oid": "26d5a3494447575f9221abdb727bf1ac40ba8052"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2f92aebe2c891d16c61a67077d1dbe1c28712ef", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/f2f92aebe2c891d16c61a67077d1dbe1c28712ef", "committedDate": "2020-07-08T05:11:43Z", "message": "DB-9423: fix foreign key constraint uniqueness"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26d5a3494447575f9221abdb727bf1ac40ba8052", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/26d5a3494447575f9221abdb727bf1ac40ba8052", "committedDate": "2020-07-02T04:29:52Z", "message": "DB-9423: fix foreign key constraint uniqueness"}, "afterCommit": {"oid": "f2f92aebe2c891d16c61a67077d1dbe1c28712ef", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/f2f92aebe2c891d16c61a67077d1dbe1c28712ef", "committedDate": "2020-07-08T05:11:43Z", "message": "DB-9423: fix foreign key constraint uniqueness"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MjcxMzAx", "url": "https://github.com/splicemachine/spliceengine/pull/3458#pullrequestreview-447271301", "createdAt": "2020-07-13T13:52:31Z", "commit": {"oid": "f2f92aebe2c891d16c61a67077d1dbe1c28712ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTMxMDE5", "url": "https://github.com/splicemachine/spliceengine/pull/3458#pullrequestreview-449531019", "createdAt": "2020-07-16T06:08:39Z", "commit": {"oid": "f2f92aebe2c891d16c61a67077d1dbe1c28712ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1370, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}