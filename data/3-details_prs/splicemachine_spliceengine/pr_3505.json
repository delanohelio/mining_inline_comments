{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNjAyNDY4", "number": 3505, "title": "DB-9109 fix jenkins problem with testCollectStats", "bodyText": "in the previous version the temporary directory gets deleted after every test,\nhowever the table gets only deleted after the whole class shuts down,\nso e.g. analyze schema fails as it can't access those tables anymore\nwhat will happen now:\n\nbefore instantiating a test class like, e.g. ExternalTableIT would go to /platform_it/target/external + /SCHEMA_NAME,\ne.g. /platform_it/target/external/EXTERNALTABLEIT, wipe that directory (with @BeforeClass)\nwe then run all tests, create external tables in that subdirectory (e.g. .../external/EXTNERALTABLEIT/avro_simple_file_test etc.)\nat the end of the whole class @afterclass, delete the temporary directory (target/external/EXTERNALTABLEIT), but not all of target/external\n\nwith this\n\nallows parallel runs of ExternalTableIT while running ExternalTablePartitionIT\ntemporary files are delete when running normally\neven if VM crashes or similar, the directory will be cleaned the next time, reducing trash on developers system", "createdAt": "2020-04-30T15:01:09Z", "url": "https://github.com/splicemachine/spliceengine/pull/3505", "merged": true, "mergeCommit": {"oid": "b591c8f9bd79f38d44c46c907e4dd8224d8915dc"}, "closed": true, "closedAt": "2020-04-30T19:02:10Z", "author": {"login": "martinrupp"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccuXKvAH2gAyNDExNjAyNDY4OjQ1NjE1ZGE5ZGI5OGY2MjcxYzgxZjVkYjIxZjMzNjdmNzlmZWI1MmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccxoD4AFqTQwMzc4NTExNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "45615da9db98f6271c81f5db21f3367f79feb52a", "author": {"user": {"login": "martinrupp", "name": "Martin Rupp"}}, "url": "https://github.com/splicemachine/spliceengine/commit/45615da9db98f6271c81f5db21f3367f79feb52a", "committedDate": "2020-04-30T14:56:54Z", "message": "DB-9109 fix jenkins problem with testCollectStats\n\nin the previous version the temporary directory gets deleted after every test,\nhowever the table gets only deleted after the whole class shuts down,\nso e.g. analyze schema fails as it can't access those tables anymore\n\nwhat will happen now:\n- before instantiating a test class like, e.g. ExternalTableIT would go to /platform_it/target/external + /SCHEMA_NAME,\ne.g. /platform_it/target/external/EXTERNALTABLEIT, wipe that directory (with @BeforeClass)\n- we then run all tests, create external tables in that subdirectory (e.g. .../external/EXTNERALTABLEIT/avro_simple_file_test etc.)\n- at the end of the whole class @AfterClass, delete the temporary directory (target/external/EXTERNALTABLEIT), but not all of target/external\n\nwith this\n- allows parallel runs of ExternalTableIT while running ExternalTablePartitionIT\n- temporary files are delete when running normally\n- even if VM crashes or similar, the directory will be cleaned the next time, reducing trash on developers system"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNjE5ODY5", "url": "https://github.com/splicemachine/spliceengine/pull/3505#pullrequestreview-403619869", "createdAt": "2020-04-30T15:14:44Z", "commit": {"oid": "45615da9db98f6271c81f5db21f3367f79feb52a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToxNDo0NFrOGOt_bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToxNDo0NFrOGOt_bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA4Njc2NQ==", "bodyText": "Can you add these methods to SpliceUnitTest ?\nIf you don't want to create a temp directory for every class even if it doesn't use it we can create the directory on demand in getExternalResourceDirectory() (if not already created) and remove it if exists in deleteTempDirectory", "url": "https://github.com/splicemachine/spliceengine/pull/3505#discussion_r418086765", "createdAt": "2020-04-30T15:14:44Z", "author": {"login": "dgomezferro"}, "path": "splice_machine/src/test/java/com/splicemachine/derby/utils/ShowCreateTableIT.java", "diffHunk": "@@ -101,6 +102,26 @@ public static void cleanup()\n         classWatcher.closeAll();\n     }\n \n+    static File tempDir;\n+\n+    @BeforeClass\n+    public static void createTempDirectory() throws Exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45615da9db98f6271c81f5db21f3367f79feb52a"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzQ3MDg2", "url": "https://github.com/splicemachine/spliceengine/pull/3505#pullrequestreview-403747086", "createdAt": "2020-04-30T17:51:24Z", "commit": {"oid": "45615da9db98f6271c81f5db21f3367f79feb52a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzg1MTE2", "url": "https://github.com/splicemachine/spliceengine/pull/3505#pullrequestreview-403785116", "createdAt": "2020-04-30T18:45:04Z", "commit": {"oid": "45615da9db98f6271c81f5db21f3367f79feb52a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1329, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}