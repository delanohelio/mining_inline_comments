{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyODU2NzQz", "number": 4900, "title": "DB-10759 Tell Spark where to find jars for user VTIs", "bodyText": "This allows user-defined VTIs to be written as FlatMapFunctions to process rows in the splice DataSet operation tree.\nSparkContext.addJar is called on the VTI jar file that splice internally stores in HDFS.\nNote that if the VTI definition is changed, the Olap Server must be restarted to pick up the change because there is no way to remove a jar from the spark context.\nIn the future we'll try to do away with this limitation, perhaps by switching internally to a new OlapServer every time a VTI is compiled.", "createdAt": "2020-12-19T01:42:39Z", "url": "https://github.com/splicemachine/spliceengine/pull/4900", "merged": true, "mergeCommit": {"oid": "83a6b7ebc68d80c0527e7cb1cb4986c3f73c650b"}, "closed": true, "closedAt": "2021-01-08T22:47:44Z", "author": {"login": "msirek"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdooJBoAFqTU1Njk4MzczOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABduLdXdgFqTU2NDQwNTc1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTgzNzM4", "url": "https://github.com/splicemachine/spliceengine/pull/4900#pullrequestreview-556983738", "createdAt": "2020-12-22T10:40:16Z", "commit": {"oid": "4bffdb0e68fa1a5487799e838539002734f792eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjc0NzAw", "url": "https://github.com/splicemachine/spliceengine/pull/4900#pullrequestreview-561674700", "createdAt": "2021-01-05T10:26:12Z", "commit": {"oid": "4bffdb0e68fa1a5487799e838539002734f792eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjczMzc2", "url": "https://github.com/splicemachine/spliceengine/pull/4900#pullrequestreview-561673376", "createdAt": "2021-01-05T10:24:15Z", "commit": {"oid": "4bffdb0e68fa1a5487799e838539002734f792eb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMDoyNDoxNVrOIORynw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMDoyNDoxNVrOIORynw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTg0MjQ2Mw==", "bodyText": "We should try to reduce direct dependencies on Spark in \"core\" modules such as db-engine.", "url": "https://github.com/splicemachine/spliceengine/pull/4900#discussion_r551842463", "createdAt": "2021-01-05T10:24:15Z", "author": {"login": "dgomezferro"}, "path": "db-engine/src/main/java/com/splicemachine/db/iapi/sql/conn/LanguageConnectionContext.java", "diffHunk": "@@ -1491,4 +1492,16 @@ void setDB2VarcharCompatibilityModeNeedsReset(boolean newValue,\n \n     boolean isCompilingFromTableTempTrigger();\n \n+    void addUserJarsToSparkContext();\n+\n+    boolean isSparkJob();\n+\n+    void setSparkContext(SparkContext sparkContext);\n+\n+    SparkContext getSparkContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bffdb0e68fa1a5487799e838539002734f792eb"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fde6193fa176ac9f4046a321a35a06c883d352a8", "author": {"user": {"login": "msirek", "name": "Mark Sirek"}}, "url": "https://github.com/splicemachine/spliceengine/commit/fde6193fa176ac9f4046a321a35a06c883d352a8", "committedDate": "2021-01-05T18:35:29Z", "message": "DB-10759 Tell Spark where to find jars for user VTIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "039d594a771949c0ab573d702cb495a8c4358677", "author": {"user": {"login": "msirek", "name": "Mark Sirek"}}, "url": "https://github.com/splicemachine/spliceengine/commit/039d594a771949c0ab573d702cb495a8c4358677", "committedDate": "2021-01-05T18:35:29Z", "message": "DB-10759 Fix Spotbugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a74d601557c231a0368c92222272600b88c23101", "author": {"user": {"login": "msirek", "name": "Mark Sirek"}}, "url": "https://github.com/splicemachine/spliceengine/commit/a74d601557c231a0368c92222272600b88c23101", "committedDate": "2021-01-05T18:35:29Z", "message": "DB-10759 Fix Spotbugs, part 2."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bffdb0e68fa1a5487799e838539002734f792eb", "author": {"user": {"login": "msirek", "name": "Mark Sirek"}}, "url": "https://github.com/splicemachine/spliceengine/commit/4bffdb0e68fa1a5487799e838539002734f792eb", "committedDate": "2020-12-19T05:54:20Z", "message": "DB-10759 Fix Spotbugs, part 2."}, "afterCommit": {"oid": "a74d601557c231a0368c92222272600b88c23101", "author": {"user": {"login": "msirek", "name": "Mark Sirek"}}, "url": "https://github.com/splicemachine/spliceengine/commit/a74d601557c231a0368c92222272600b88c23101", "committedDate": "2021-01-05T18:35:29Z", "message": "DB-10759 Fix Spotbugs, part 2."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "932e8dcfb67567148b25f74fafcff4cd09b5f48d", "author": {"user": {"login": "msirek", "name": "Mark Sirek"}}, "url": "https://github.com/splicemachine/spliceengine/commit/932e8dcfb67567148b25f74fafcff4cd09b5f48d", "committedDate": "2021-01-06T02:57:36Z", "message": "DB-10759 Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMzQ4MDY5", "url": "https://github.com/splicemachine/spliceengine/pull/4900#pullrequestreview-562348069", "createdAt": "2021-01-06T06:13:42Z", "commit": {"oid": "932e8dcfb67567148b25f74fafcff4cd09b5f48d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMzc5NjQ4", "url": "https://github.com/splicemachine/spliceengine/pull/4900#pullrequestreview-563379648", "createdAt": "2021-01-07T10:35:29Z", "commit": {"oid": "932e8dcfb67567148b25f74fafcff4cd09b5f48d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMDozNToyOVrOIPnZCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMDozNToyOVrOIPnZCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI0NDkzNw==", "bodyText": "The implementation for all platforms is the same, it should be in spark_sql/src/main/java only once instead of copied in multiple platforms.", "url": "https://github.com/splicemachine/spliceengine/pull/4900#discussion_r553244937", "createdAt": "2021-01-07T10:35:29Z", "author": {"login": "dgomezferro"}, "path": "spark_sql/src/main/spark2.1/src/main/java/com/splicemachine/sparksql/SparkSQLUtilsImpl.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright (c) 2012 - 2021 Splice Machine, Inc.\n+ *\n+ * This file is part of Splice Machine.\n+ * Splice Machine is free software: you can redistribute it and/or modify it under the terms of the\n+ * GNU Affero General Public License as published by the Free Software Foundation, either\n+ * version 3, or (at your option) any later version.\n+ * Splice Machine is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ * See the GNU Affero General Public License for more details.\n+ * You should have received a copy of the GNU Affero General Public License along with Splice Machine.\n+ * If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.splicemachine.sparksql;\n+\n+\n+import com.splicemachine.utils.SparkSQLUtils;\n+import org.apache.spark.SparkContext;\n+\n+/* Purpose:  Provide interfaces to access Spark objects or APIs\n+ *           which may differ depending on the Spark version.\n+ */\n+public class SparkSQLUtilsImpl implements SparkSQLUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "932e8dcfb67567148b25f74fafcff4cd09b5f48d"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3582515837b2943cbb3942f143d166d3f0ba813a", "author": {"user": {"login": "msirek", "name": "Mark Sirek"}}, "url": "https://github.com/splicemachine/spliceengine/commit/3582515837b2943cbb3942f143d166d3f0ba813a", "committedDate": "2021-01-07T20:27:36Z", "message": "DB-10759 Address review comments, part 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0NDA1NzUz", "url": "https://github.com/splicemachine/spliceengine/pull/4900#pullrequestreview-564405753", "createdAt": "2021-01-08T16:38:47Z", "commit": {"oid": "3582515837b2943cbb3942f143d166d3f0ba813a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 990, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}