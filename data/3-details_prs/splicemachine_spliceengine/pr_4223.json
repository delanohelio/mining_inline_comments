{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NDk1OTEw", "number": 4223, "title": "DB-10328: clean up serialization for spark execution", "bodyText": "", "createdAt": "2020-10-04T20:42:49Z", "url": "https://github.com/splicemachine/spliceengine/pull/4223", "merged": true, "mergeCommit": {"oid": "ac5c98ec7dd6cc2a67f38d1ae8e92db78b21bc52"}, "closed": true, "closedAt": "2020-10-13T08:14:36Z", "author": {"login": "jyuanca"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPrbFYABqjM4NDI2NTc3MTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSCxDuAFqTUwNzExMDg4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bc3d8c05a3992e879bcfa04900405e30368fb7b", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/4bc3d8c05a3992e879bcfa04900405e30368fb7b", "committedDate": "2020-10-03T19:11:45Z", "message": "DB-10328: clean up serialization for spark execution"}, "afterCommit": {"oid": "559b33f44dad12ea2ee23652548b14b8154794dc", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/559b33f44dad12ea2ee23652548b14b8154794dc", "committedDate": "2020-10-05T22:21:01Z", "message": "DB-10328: clean up serialization for spark execution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/a8a0eb0788ba7eb099ff981c583965a3e88f3f3f", "committedDate": "2020-10-05T22:30:40Z", "message": "DB-10328: clean up serialization for spark execution"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "559b33f44dad12ea2ee23652548b14b8154794dc", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/559b33f44dad12ea2ee23652548b14b8154794dc", "committedDate": "2020-10-05T22:21:01Z", "message": "DB-10328: clean up serialization for spark execution"}, "afterCommit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/a8a0eb0788ba7eb099ff981c583965a3e88f3f3f", "committedDate": "2020-10-05T22:30:40Z", "message": "DB-10328: clean up serialization for spark execution"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzM0OTIx", "url": "https://github.com/splicemachine/spliceengine/pull/4223#pullrequestreview-502734921", "createdAt": "2020-10-06T09:08:22Z", "commit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowODoyM1rOHc9C1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToxMDo0MlrOHc9Iag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMjMyNg==", "bodyText": "This method is very similar to generateExpression(), would it be possible to extract the commonalities so that there isn't so much copy paste?", "url": "https://github.com/splicemachine/spliceengine/pull/4223#discussion_r500122326", "createdAt": "2020-10-06T09:08:23Z", "author": {"login": "dgomezferro"}, "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/SubqueryNode.java", "diffHunk": "@@ -1386,6 +1386,209 @@ public void generateExpression(ExpressionClassBuilder expressionBuilder,\n             mbex.pushThis();\n             mbex.callMethod(VMOpcode.INVOKEVIRTUAL,null,mb.getName(),subqueryTypeString,0);\n         }\n+\n+        generateSubqueryResultSet(expressionBuilder);\n+    }\n+\n+    public void generateSubqueryResultSet(ExpressionClassBuilder expressionBuilder) throws StandardException {\n+        CompilerContext cc=getCompilerContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMzc1NA==", "bodyText": "Why do we need this one to be externalizable?", "url": "https://github.com/splicemachine/spliceengine/pull/4223#discussion_r500123754", "createdAt": "2020-10-06T09:10:42Z", "author": {"login": "dgomezferro"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/operations/ScanOperation.java", "diffHunk": "@@ -34,12 +34,13 @@\n import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;\n import org.apache.log4j.Logger;\n \n+import java.io.Externalizable;\n import java.io.IOException;\n import java.io.ObjectInput;\n import java.io.ObjectOutput;\n import java.util.Arrays;\n \n-public abstract class ScanOperation extends SpliceBaseOperation{\n+public abstract class ScanOperation extends SpliceBaseOperation implements Externalizable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzY5NDAy", "url": "https://github.com/splicemachine/spliceengine/pull/4223#pullrequestreview-502769402", "createdAt": "2020-10-06T09:51:12Z", "commit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzg2NTEz", "url": "https://github.com/splicemachine/spliceengine/pull/4223#pullrequestreview-502786513", "createdAt": "2020-10-06T10:13:26Z", "commit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoxMzoyNlrOHc_aGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoxMzoyNlrOHc_aGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2MTA1MA==", "bodyText": "please remove (same below)", "url": "https://github.com/splicemachine/spliceengine/pull/4223#discussion_r500161050", "createdAt": "2020-10-06T10:13:26Z", "author": {"login": "hatyo"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/operations/ScanOperation.java", "diffHunk": "@@ -135,7 +136,7 @@ public ScanOperation(long conglomId,Activation activation,int resultSetNumber,\n     @Override\n     @SuppressWarnings(\"unchecked\")\n     public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException{\n-        super.readExternal(in);\n+        //super.readExternal(in);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzkzOTI0", "url": "https://github.com/splicemachine/spliceengine/pull/4223#pullrequestreview-502793924", "createdAt": "2020-10-06T10:23:38Z", "commit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoyMzozOFrOHc_vuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoyMzozOFrOHc_vuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2NjU4NA==", "bodyText": "source.openCore(); is already called once in populateCache(), is it necessary to call it again here?", "url": "https://github.com/splicemachine/spliceengine/pull/4223#discussion_r500166584", "createdAt": "2020-10-06T10:23:38Z", "author": {"login": "hatyo"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/operations/CachedOperation.java", "diffHunk": "@@ -134,6 +109,8 @@ public String prettyPrint(int indentLevel) {\n     public DataSet<ExecRow> getDataSet(DataSetProcessor dsp) throws StandardException {\n         if (!isOpen)\n             throw new IllegalStateException(\"Operation is not open\");\n+        populateCache();\n+        source.openCore(dsp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzk3MzMz", "url": "https://github.com/splicemachine/spliceengine/pull/4223#pullrequestreview-502797333", "createdAt": "2020-10-06T10:28:27Z", "commit": {"oid": "a8a0eb0788ba7eb099ff981c583965a3e88f3f3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1262d7086d36fbe923ee9e9d8afa2a3e7c075468", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/1262d7086d36fbe923ee9e9d8afa2a3e7c075468", "committedDate": "2020-10-07T04:34:13Z", "message": "refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b502f279a9a952aab6994eba51ca2df3da99aa3", "author": {"user": null}, "url": "https://github.com/splicemachine/spliceengine/commit/9b502f279a9a952aab6994eba51ca2df3da99aa3", "committedDate": "2020-10-07T14:32:52Z", "message": "cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzIyODIz", "url": "https://github.com/splicemachine/spliceengine/pull/4223#pullrequestreview-506722823", "createdAt": "2020-10-12T15:32:15Z", "commit": {"oid": "9b502f279a9a952aab6994eba51ca2df3da99aa3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTEwODgz", "url": "https://github.com/splicemachine/spliceengine/pull/4223#pullrequestreview-507110883", "createdAt": "2020-10-13T06:41:16Z", "commit": {"oid": "9b502f279a9a952aab6994eba51ca2df3da99aa3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1141, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}