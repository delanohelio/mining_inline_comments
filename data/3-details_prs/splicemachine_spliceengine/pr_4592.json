{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNTM2NjI4", "number": 4592, "title": "DB-10723 Support cast to [VAR]CHAR as SBCS DATA ", "bodyText": "", "createdAt": "2020-11-13T11:54:48Z", "url": "https://github.com/splicemachine/spliceengine/pull/4592", "merged": true, "mergeCommit": {"oid": "994182db8e0dc3911b9f9bb15c26e36ae5981beb"}, "closed": true, "closedAt": "2020-11-13T19:52:38Z", "author": {"login": "arnaud-splice"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcD83tgH2gAyNTIwNTM2NjI4OmEyYWYzMDg5Y2FjZGExOTA4ZTRkMTA3M2RmNzQ2NDI5OWQ0MjZlZmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcMShCAFqTUzMDM0NTQwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2af3089cacda1908e4d1073df7464299d426efb", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/a2af3089cacda1908e4d1073df7464299d426efb", "committedDate": "2020-11-13T09:43:19Z", "message": "DB-10722 Support cast as [var]char(n) ccsid ascii\n\nThis is basically a no-op"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ab8fc35d280435182265459ab00ff52e5501fb3", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/9ab8fc35d280435182265459ab00ff52e5501fb3", "committedDate": "2020-11-13T11:49:01Z", "message": "DB-10723 Support cast to [VAR]CHAR as SBCS DATA"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd4dae8a1c72a77b342d75c586a1322518cc63af", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/bd4dae8a1c72a77b342d75c586a1322518cc63af", "committedDate": "2020-11-13T13:41:25Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10723"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fe0add2b542e22e53e35a8db3f8ac7d80e44e57", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/2fe0add2b542e22e53e35a8db3f8ac7d80e44e57", "committedDate": "2020-11-13T13:43:16Z", "message": "DB-10723 Test on spark and control"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTA3Nzgx", "url": "https://github.com/splicemachine/spliceengine/pull/4592#pullrequestreview-530107781", "createdAt": "2020-11-13T14:30:49Z", "commit": {"oid": "2fe0add2b542e22e53e35a8db3f8ac7d80e44e57"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNDozMDo1MFrOHywgqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNDozMTo0OFrOHywjSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk4NTY0MA==", "bodyText": "You can do insert into sbcs values (NULL, NULL) the case trick is only needed when you want a NULL in the select portion of a query I think.", "url": "https://github.com/splicemachine/spliceengine/pull/4592#discussion_r522985640", "createdAt": "2020-11-13T14:30:50Z", "author": {"login": "dgomezferro"}, "path": "splice_machine/src/test/java/com/splicemachine/derby/impl/sql/execute/operations/FunctionIT.java", "diffHunk": "@@ -782,5 +782,36 @@ public void testLengthOfCastToVarchar() throws Exception {\n             assertEquals(2, rs.getInt(1));\n         }\n     }\n+\n+    @Test\n+    public void testCastToCharCcsidAscii() throws SQLException {\n+        try (ResultSet rs = methodWatcher.executeQuery(\"select cast('abc' as char(5)), cast('abc' as char(5) ccsid ascii),\" +\n+                \"cast('abc' as varchar(5)), cast('abc' as varchar(5) ccsid ascii)\")) {\n+            rs.next();\n+            assertEquals(rs.getString(1), rs.getString(2));\n+            assertEquals(rs.getString(3), rs.getString(4));\n+        }\n+    }\n+\n+    @Test\n+    public void testCastToCharForSbcsData() throws Exception\n+    {\n+        methodWatcher.executeUpdate(\"drop table sbcs if exists\");\n+        methodWatcher.executeUpdate(\"create table sbcs(a varchar(30) for bit data, b char(30) for bit data)\");\n+        methodWatcher.executeUpdate(\"insert into sbcs values (cast('a' as varchar(30) for bit data), cast('b' as char(30) for bit data))\");\n+        methodWatcher.executeUpdate(\"insert into sbcs values (case when 1 = 2 then 'dummy' end, case when 1 = 2 then 'dummy' end)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fe0add2b542e22e53e35a8db3f8ac7d80e44e57"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk4NjMxNA==", "bodyText": "@arnaud-splice have you tested this with triggers?\n@jyuanca @yxia92 do you think this could cause issues if we don't serialize it?", "url": "https://github.com/splicemachine/spliceengine/pull/4592#discussion_r522986314", "createdAt": "2020-11-13T14:31:48Z", "author": {"login": "dgomezferro"}, "path": "db-engine/src/main/java/com/splicemachine/db/catalog/types/TypeDescriptorImpl.java", "diffHunk": "@@ -65,6 +65,8 @@\n     private int                        scale;\n     private boolean                    isNullable;\n     private int                        maximumWidth;\n+\n+    transient private boolean          forSbcsData;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fe0add2b542e22e53e35a8db3f8ac7d80e44e57"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c6e938f58ccef181e8549eeb949815c923a22ef", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/3c6e938f58ccef181e8549eeb949815c923a22ef", "committedDate": "2020-11-13T15:23:41Z", "message": "DB-10723 Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTU4NzQw", "url": "https://github.com/splicemachine/spliceengine/pull/4592#pullrequestreview-530158740", "createdAt": "2020-11-13T15:29:56Z", "commit": {"oid": "3c6e938f58ccef181e8549eeb949815c923a22ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd4eb6b5007075f06aeaf7727f1bd08c97e9677f", "author": {"user": {"login": "arnaud-splice", "name": "Arnaud Lacurie"}}, "url": "https://github.com/splicemachine/spliceengine/commit/dd4eb6b5007075f06aeaf7727f1bd08c97e9677f", "committedDate": "2020-11-13T17:15:00Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10723"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzAxMjc4", "url": "https://github.com/splicemachine/spliceengine/pull/4592#pullrequestreview-530301278", "createdAt": "2020-11-13T18:18:41Z", "commit": {"oid": "dd4eb6b5007075f06aeaf7727f1bd08c97e9677f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzQ1NDA3", "url": "https://github.com/splicemachine/spliceengine/pull/4592#pullrequestreview-530345407", "createdAt": "2020-11-13T19:26:12Z", "commit": {"oid": "dd4eb6b5007075f06aeaf7727f1bd08c97e9677f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1049, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}