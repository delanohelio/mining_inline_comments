{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NTcyMDcy", "number": 3149, "title": "SPLICE-1806 NullPointerException in PipingCallBuffer (3.0)", "bodyText": "Extensively tested in bespoke/AWS with TPC-C. Runs are much cleaner and there is also some noticeable performance improvement (up to 10%; tpmC ~= 32K in a 4 node cluster).", "createdAt": "2020-01-19T19:56:02Z", "url": "https://github.com/splicemachine/spliceengine/pull/3149", "merged": true, "mergeCommit": {"oid": "de5ea89408f8d8b764e10f6add694bcf752cf34e"}, "closed": true, "closedAt": "2020-01-23T04:34:19Z", "author": {"login": "OlegMazurov"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb79QP2gH2gAyMzY0NTcyMDcyOmUzYzQyNmFhMTE0OWM5MmZiZDJlNDhjZmI5YzYxYzg4Mzk3NjcxZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9B2lTAFqTM0NzA0MjQ3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e3c426aa1149c92fbd2e48cfb9c61c88397671f4", "author": {"user": {"login": "OlegMazurov", "name": "Oleg Mazurov"}}, "url": "https://github.com/splicemachine/spliceengine/commit/e3c426aa1149c92fbd2e48cfb9c61c88397671f4", "committedDate": "2020-01-19T19:38:25Z", "message": "SPLICE-1806 NullPointerException in PipingCallBuffer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2ODYzMzYw", "url": "https://github.com/splicemachine/spliceengine/pull/3149#pullrequestreview-346863360", "createdAt": "2020-01-22T19:59:09Z", "commit": {"oid": "e3c426aa1149c92fbd2e48cfb9c61c88397671f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTo1OTowOVrOFgpKeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTo1OTowOVrOFgpKeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc3MzE3OA==", "bodyText": "Is it OK to ignore offline regions?  The old code kept retrying until all regions were online.  Could we potentially end up not scanning all rows in the table?", "url": "https://github.com/splicemachine/spliceengine/pull/3149#discussion_r369773178", "createdAt": "2020-01-22T19:59:09Z", "author": {"login": "msirek"}, "path": "hbase_storage/src/main/java/com/splicemachine/storage/ClientPartition.java", "diffHunk": "@@ -155,32 +152,26 @@ public boolean checkAndPut(byte[] key,byte[] family,byte[] qualifier,byte[] expe\n             List<Partition> partitions;\n             if (!refresh) {\n                 partitions = partitionInfoCache.getIfPresent(tableName);\n-                if (partitions == null) {\n-                    partitions = formatPartitions(getAllRegionLocations(false));\n-                    assert partitions!=null:\"partitions are null\";\n-                    partitionInfoCache.put(tableName, partitions);\n+                if (partitions != null) {\n+                    return partitions;\n                 }\n-                return partitions;\n             }\n-            partitions = formatPartitions(getAllRegionLocations(true));\n-            partitionInfoCache.invalidate(tableName);\n-            assert partitions!=null:\"partitions are null\";\n-            partitionInfoCache.put(tableName,partitions);\n+            List<HRegionLocation> tableLocations = ((ClusterConnection) connection).locateRegions(tableName, !refresh, false);\n+            partitions = new ArrayList<>(tableLocations.size());\n+            for (HRegionLocation location : tableLocations){\n+                if (location.getServerName() == null) {     // ensure no offline regions\n+                    continue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3c426aa1149c92fbd2e48cfb9c61c88397671f4"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2OTM0NDU2", "url": "https://github.com/splicemachine/spliceengine/pull/3149#pullrequestreview-346934456", "createdAt": "2020-01-22T22:01:39Z", "commit": {"oid": "e3c426aa1149c92fbd2e48cfb9c61c88397671f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDA1NTU2", "url": "https://github.com/splicemachine/spliceengine/pull/3149#pullrequestreview-347005556", "createdAt": "2020-01-23T01:01:05Z", "commit": {"oid": "e3c426aa1149c92fbd2e48cfb9c61c88397671f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDQyNDc3", "url": "https://github.com/splicemachine/spliceengine/pull/3149#pullrequestreview-347042477", "createdAt": "2020-01-23T03:33:50Z", "commit": {"oid": "e3c426aa1149c92fbd2e48cfb9c61c88397671f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 944, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}