{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0ODU0ODU3", "number": 3770, "title": "DB-9764 Add IF NOT EXISTS option to CREATE TABLE statement", "bodyText": "", "createdAt": "2020-07-06T15:40:30Z", "url": "https://github.com/splicemachine/spliceengine/pull/3770", "merged": true, "mergeCommit": {"oid": "69afad6dc4bfb9fd49be1eae54ec4a9e2386540e"}, "closed": true, "closedAt": "2020-07-16T18:22:56Z", "author": {"login": "ascend1"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyaZq8AFqTQ0MzQ3OTk2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1iXmUgBqjM1NTQyNTEyMzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDc5OTYy", "url": "https://github.com/splicemachine/spliceengine/pull/3770#pullrequestreview-443479962", "createdAt": "2020-07-07T00:07:52Z", "commit": {"oid": "45b1f4143db7aec0d39eece647b9bafb7f77882c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNzEwMjk0", "url": "https://github.com/splicemachine/spliceengine/pull/3770#pullrequestreview-443710294", "createdAt": "2020-07-07T09:16:21Z", "commit": {"oid": "45b1f4143db7aec0d39eece647b9bafb7f77882c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwOToxNjoyMlrOGt2BIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwOToxNzoxN1rOGt2DXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcyNDEzMQ==", "bodyText": "Is it possible to simplify this pattern a little bit? At least remove the \"notTok\" and \"existsTok\" variables, I don't think those are needed, and then haveboolean ifNotExists = ifTok != null || ifTok2 != null;", "url": "https://github.com/splicemachine/spliceengine/pull/3770#discussion_r450724131", "createdAt": "2020-07-07T09:16:22Z", "author": {"login": "dgomezferro"}, "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/sqlgrammar.jj", "diffHunk": "@@ -4785,13 +4787,25 @@ declareTemporaryTableDeclaration() throws StandardException :\n     TableName            tableName;\n     TableElementList tableElementList;\n     Object[] declareTableClauses = new Object[3];\n+    Token ifTok = null;\n+    Token notTok = null;\n+    Token existsTok = null;\n+    Token ifTok2 = null;\n+    Token notTok2 = null;\n+    Token existsTok2 = null;\n }\n {\n-    <DECLARE> <GLOBAL> <TEMPORARY> <TABLE> tableName = qualifiedName(Limits.MAX_IDENTIFIER_LENGTH)\n+    <DECLARE> <GLOBAL> <TEMPORARY> <TABLE> [ ifTok = <IF> notTok = <NOT> existsTok = <EXISTS> ] tableName = qualifiedName(Limits.MAX_IDENTIFIER_LENGTH) [ ifTok2 = <IF> notTok2 = <NOT> existsTok2 = <EXISTS> ]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45b1f4143db7aec0d39eece647b9bafb7f77882c"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcyNDcwMw==", "bodyText": "Why do we need this?", "url": "https://github.com/splicemachine/spliceengine/pull/3770#discussion_r450724703", "createdAt": "2020-07-07T09:17:17Z", "author": {"login": "dgomezferro"}, "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/conn/GenericLanguageConnectionContext.java", "diffHunk": "@@ -1333,6 +1333,10 @@ public void removeStatement(GenericStatement statement) throws StandardException\n     public PreparedStatement lookupStatement(GenericStatement statement) throws StandardException{\n         GenericStorablePreparedStatement ps = getDataDictionary().getDataDictionaryCache().statementCacheFind(statement);\n         if (ps==null) {\n+            String sqlText = statement.getSource().toUpperCase();\n+            if ((sqlText.startsWith(\"CREATE\") || sqlText.startsWith(\"DECLARE\")) && sqlText.contains(\"IF NOT EXISTS\")){\n+                return null;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45b1f4143db7aec0d39eece647b9bafb7f77882c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NTE4Nzgx", "url": "https://github.com/splicemachine/spliceengine/pull/3770#pullrequestreview-445518781", "createdAt": "2020-07-09T11:14:19Z", "commit": {"oid": "f07b6a232d6d5f87f8c07120861a424badb1b001"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2OTgxMTU3", "url": "https://github.com/splicemachine/spliceengine/pull/3770#pullrequestreview-446981157", "createdAt": "2020-07-13T04:58:09Z", "commit": {"oid": "f07b6a232d6d5f87f8c07120861a424badb1b001"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79c1dab964d15564bf6d0e84b6e0e2e72d492ff1", "author": {"user": {"login": "ascend1", "name": "Zhen Li"}}, "url": "https://github.com/splicemachine/spliceengine/commit/79c1dab964d15564bf6d0e84b6e0e2e72d492ff1", "committedDate": "2020-07-16T17:05:26Z", "message": "DB-9764 Add IF NOT EXISTS option to CREATE TABLE statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f07b6a232d6d5f87f8c07120861a424badb1b001", "author": {"user": {"login": "ascend1", "name": "Zhen Li"}}, "url": "https://github.com/splicemachine/spliceengine/commit/f07b6a232d6d5f87f8c07120861a424badb1b001", "committedDate": "2020-07-09T10:43:02Z", "message": "DB-9764 Remove statement cache hack and add proper check in constant action"}, "afterCommit": {"oid": "79c1dab964d15564bf6d0e84b6e0e2e72d492ff1", "author": {"user": {"login": "ascend1", "name": "Zhen Li"}}, "url": "https://github.com/splicemachine/spliceengine/commit/79c1dab964d15564bf6d0e84b6e0e2e72d492ff1", "committedDate": "2020-07-16T17:05:26Z", "message": "DB-9764 Add IF NOT EXISTS option to CREATE TABLE statement"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1291, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}