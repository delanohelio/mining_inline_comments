{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NzA2NzY5", "number": 3458, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzowMDoyNVrOEKsAqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzowMDoyNVrOEKsAqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NjQyMjgxOnYy", "diffSide": "RIGHT", "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/CreateIndexConstantOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzowMDoyNVrOGr39Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzowMDoyNVrOGr39Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1ODczOA==", "bodyText": "Could you also add check so that if  excludeNulls or excludeDefaults do not match, the index cannot be shared either?\nHere is a test case:\ncreate table b(i int, j int, primary key (i));\ncreate table a (i int, j int);\ninsert into b values (1,1);\ninsert into a values (1,1);\ncreate index aj on a(j) exclude null keys;\nalter table a add CONSTRAINT fc FOREIGN KEY(j) REFERENCES b(i) ON UPDATE NO ACTION ON DELETE restrict;\nsplice> show indexes from a;\nTABLE_NAME                                        |INDEX_NAME                                        |COLUMN_NAME         |ORDINAL&|NON_UNIQUE|TYPE |ASC&|CONGLOM_NO\n--------------------------------------------------------------------------------------------------------------------------------------------------------------------\nA                                                 |AJ                                                |J                   |1       |true      |BTREE|A   |1665      \nA                                                 |SQL200701155616910                                |J                   |1       |true      |BTREE|A   |1665      \n\n2 rows selected\nELAPSED TIME = 1531 milliseconds", "url": "https://github.com/splicemachine/spliceengine/pull/3458#discussion_r448658738", "createdAt": "2020-07-01T23:00:25Z", "author": {"login": "yxia92"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/CreateIndexConstantOperation.java", "diffHunk": "@@ -452,6 +452,9 @@ public void executeConstantAction( Activation activation ) throws StandardExcept\n                 }\n \n                 IndexRowGenerator irg = cd.getIndexDescriptor();\n+                if (irg.isUnique() != unique) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28928badb575891ff2754fa0e5eb3f558cf0b9f0"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3262, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}