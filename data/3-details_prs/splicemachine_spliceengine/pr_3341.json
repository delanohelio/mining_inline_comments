{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNTUyMjk1", "number": 3341, "title": "DB-9309 Reduce memory pressure on RegionServers", "bodyText": "", "createdAt": "2020-03-25T12:12:39Z", "url": "https://github.com/splicemachine/spliceengine/pull/3341", "merged": true, "mergeCommit": {"oid": "3a071035517f6af1e6e520546c86f1692ff8e333"}, "closed": true, "closedAt": "2020-05-12T16:44:47Z", "author": {"login": "dgomezferro"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRGUWPgH2gAyMzkzNTUyMjk1OmY1ZWIxNjY4YzNhM2U1M2JmYjA2NTQ3ZjlkZmRkMzYxNWY5MTExYjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfAFuJgFqTQwNzY1MTgxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f5eb1668c3a3e53bfb06547f9dfdd3615f9111b8", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/f5eb1668c3a3e53bfb06547f9dfdd3615f9111b8", "committedDate": "2020-03-25T12:04:27Z", "message": "DB-9309 Reduce buffering when streaming BLOBs from Spark"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b238a2631286dc0295cf9299a58d9d4af4c19c4c", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/b238a2631286dc0295cf9299a58d9d4af4c19c4c", "committedDate": "2020-03-25T12:04:27Z", "message": "DB-9309 Reduce memory pressure when compacting on RSs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "412f837ece0d9b77ba6fdda84c5b34757d11c52b", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/412f837ece0d9b77ba6fdda84c5b34757d11c52b", "committedDate": "2020-03-25T12:04:27Z", "message": "DB-9309 Improve error reporting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjI5OTgw", "url": "https://github.com/splicemachine/spliceengine/pull/3341#pullrequestreview-381229980", "createdAt": "2020-03-25T14:56:40Z", "commit": {"oid": "412f837ece0d9b77ba6fdda84c5b34757d11c52b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDo1Njo0MFrOF7fJAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowMDoyOVrOF7fVvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyMDUxMw==", "bodyText": "Shouldn't the permit be release if an exception was thrown and we are in the catch block?", "url": "https://github.com/splicemachine/spliceengine/pull/3341#discussion_r397920513", "createdAt": "2020-03-25T14:56:40Z", "author": {"login": "arnaud-splice"}, "path": "hbase_storage/src/main/java/com/splicemachine/si/impl/server/AbstractSICompactionScanner.java", "diffHunk": "@@ -75,13 +78,15 @@ public boolean next(List<Cell> list) throws IOException{\n         Entry entry;\n         try {\n             entry = queue.take();\n+            int toRelease = entry.cells.size();\n             final boolean more = entry.more;\n             List<TxnView> txns = waitFor(entry.txns);\n             compactionState.mutate(entry.cells, txns, list, purgeConfig);\n             if (!more) {\n                 timer.cancel();\n-                    context.close();\n+                context.close();\n             }\n+            permits.release(toRelease);\n             return more;\n         } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "412f837ece0d9b77ba6fdda84c5b34757d11c52b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyMzc3NA==", "bodyText": "Why?", "url": "https://github.com/splicemachine/spliceengine/pull/3341#discussion_r397923774", "createdAt": "2020-03-25T15:00:29Z", "author": {"login": "arnaud-splice"}, "path": "start-splice-cluster", "diffHunk": "@@ -48,7 +48,7 @@ wait_for () {\n }\n \n BASE_DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\"\n-DEFAULT_PROFILE=\"hdp3.1.0\"  # default hbase platform profile\n+DEFAULT_PROFILE=\"cdh6.3.0\"  # default hbase platform profile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "412f837ece0d9b77ba6fdda84c5b34757d11c52b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34f76f824c95e33ef7686c5da50a710afa715b30", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/34f76f824c95e33ef7686c5da50a710afa715b30", "committedDate": "2020-03-25T15:59:58Z", "message": "DB-9309 Handle failure cases more gracefully on compactions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MDkwMjY1", "url": "https://github.com/splicemachine/spliceengine/pull/3341#pullrequestreview-388090265", "createdAt": "2020-04-06T09:44:50Z", "commit": {"oid": "34f76f824c95e33ef7686c5da50a710afa715b30"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjQ2NjIy", "url": "https://github.com/splicemachine/spliceengine/pull/3341#pullrequestreview-399646622", "createdAt": "2020-04-24T05:19:55Z", "commit": {"oid": "34f76f824c95e33ef7686c5da50a710afa715b30"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxOTI3NDY4", "url": "https://github.com/splicemachine/spliceengine/pull/3341#pullrequestreview-401927468", "createdAt": "2020-04-28T15:02:03Z", "commit": {"oid": "34f76f824c95e33ef7686c5da50a710afa715b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTowMjowNFrOGNYi2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTowMjowNFrOGNYi2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY4NjgwOQ==", "bodyText": "Why the buffer size is set to LocalCompactionResolutionBufferSize for precompact()? Should it be used for preFlush() instead?", "url": "https://github.com/splicemachine/spliceengine/pull/3341#discussion_r416686809", "createdAt": "2020-04-28T15:02:04Z", "author": {"login": "jyuanca"}, "path": "hbase_storage/src/main/java/com/splicemachine/si/data/hbase/coprocessor/SIObserver.java", "diffHunk": "@@ -230,7 +229,7 @@ public InternalScanner preCompact(ObserverContext<RegionCoprocessorEnvironment>\n                 }\n                 SICompactionScanner siScanner = new SICompactionScanner(\n                         state, scanner, purgeConfig,\n-                        conf.getOlapCompactionResolutionShare(), conf.getOlapCompactionResolutionBufferSize(), context);\n+                        conf.getOlapCompactionResolutionShare(), conf.getLocalCompactionResolutionBufferSize(), context);\n                 siScanner.start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34f76f824c95e33ef7686c5da50a710afa715b30"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9dc8c350b8b2ee57ee37877eb4fc7b36ddb9fc6", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/f9dc8c350b8b2ee57ee37877eb4fc7b36ddb9fc6", "committedDate": "2020-05-07T07:55:43Z", "message": "DB-9309 Add clarifying comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cac28985510a02edcad0f5bc3fce9f21b39d783", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/3cac28985510a02edcad0f5bc3fce9f21b39d783", "committedDate": "2020-05-07T07:59:21Z", "message": "Merge remote-tracking branch 'origin/master' into DB-9309"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afcb5996e211fcb00eea735b98f9b141c0e8cca6", "author": {"user": {"login": "dgomezferro", "name": "Daniel G\u00f3mez Ferro"}}, "url": "https://github.com/splicemachine/spliceengine/commit/afcb5996e211fcb00eea735b98f9b141c0e8cca6", "committedDate": "2020-05-07T08:12:28Z", "message": "Merge remote-tracking branch 'origin/master' into DB-9309"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjUxODE5", "url": "https://github.com/splicemachine/spliceengine/pull/3341#pullrequestreview-407651819", "createdAt": "2020-05-07T16:43:59Z", "commit": {"oid": "afcb5996e211fcb00eea735b98f9b141c0e8cca6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1395, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}