{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNjM3NjUx", "number": 4043, "title": "DB-10059 Implement SQL procedure that allow setting retention period", "bodyText": "", "createdAt": "2020-08-24T16:41:28Z", "url": "https://github.com/splicemachine/spliceengine/pull/4043", "merged": true, "mergeCommit": {"oid": "46c352e01c3399123760e9c5ddc79637acb7e990"}, "closed": true, "closedAt": "2020-09-09T20:37:20Z", "author": {"login": "hatyo"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdALTyKAH2gAyNDcyNjM3NjUxOmFiZTNlM2Y0N2Y3ZmQ2MDQ5NmI0MDAzMDhmOWEyYmNiNDRjMjEwNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHIkShgBqjM3NDQ4MTgyODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "abe3e3f47f7fd60496b400308f9a2bcb44c21056", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/abe3e3f47f7fd60496b400308f9a2bcb44c21056", "committedDate": "2020-08-18T18:27:48Z", "message": "DB-10045 refactor system tables row factory."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08373b8a6984d961ee93889ecd94c8680fa5871b", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/08373b8a6984d961ee93889ecd94c8680fa5871b", "committedDate": "2020-08-18T18:28:01Z", "message": "DB-10045 add MIN_RETAINED_VERSIONS column to SYSTABLES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01a18f0a84f880b82e5cfcfdcb96e847291935b2", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/01a18f0a84f880b82e5cfcfdcb96e847291935b2", "committedDate": "2020-08-19T08:31:47Z", "message": "DB-10045 fix spotbugs issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7cd2390342268607142d296e1c9bd95e26bd25d", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/e7cd2390342268607142d296e1c9bd95e26bd25d", "committedDate": "2020-08-21T15:52:13Z", "message": "DB-10045 renamed field to minRetentionPeriod"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31f0415c89417a3fb8d1aebc534afcd4a2c7dfe0", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/31f0415c89417a3fb8d1aebc534afcd4a2c7dfe0", "committedDate": "2020-08-21T16:03:10Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10045"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODg4MzM0", "url": "https://github.com/splicemachine/spliceengine/pull/4043#pullrequestreview-475888334", "createdAt": "2020-08-26T21:57:59Z", "commit": {"oid": "bbc3987debfa0938adcda9018584e9a9c4b2e8c2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo1Nzo1OVrOHHfLBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo1ODoxOVrOHHfLjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYxMjgwNw==", "bodyText": "We need to use SYSVW.SYSTABLESVIEW instead of SYS.SYSTABLES as with schema restriction feature, regular user cannot acces the SYS schema.", "url": "https://github.com/splicemachine/spliceengine/pull/4043#discussion_r477612807", "createdAt": "2020-08-26T21:57:59Z", "author": {"login": "yxia92"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/utils/SpliceAdmin.java", "diffHunk": "@@ -1090,6 +1090,21 @@ public static String getSqlConglomsInSchema(){\n         return sqlConglomsInSchema;\n     }\n \n+    private static final String sqlGetTablesInSchema= \"SELECT TABLEID FROM SYS.SYSTABLES WHERE SCHEMAID = ?\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbc3987debfa0938adcda9018584e9a9c4b2e8c2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYxMjk0MA==", "bodyText": "Could you close the resultSet at the end?", "url": "https://github.com/splicemachine/spliceengine/pull/4043#discussion_r477612940", "createdAt": "2020-08-26T21:58:19Z", "author": {"login": "yxia92"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/utils/SpliceAdmin.java", "diffHunk": "@@ -1090,6 +1090,21 @@ public static String getSqlConglomsInSchema(){\n         return sqlConglomsInSchema;\n     }\n \n+    private static final String sqlGetTablesInSchema= \"SELECT TABLEID FROM SYS.SYSTABLES WHERE SCHEMAID = ?\";\n+\n+    private static List<TableDescriptor> getTablesInSchema(DataDictionary dataDictionary,\n+                                                           Connection connection,\n+                                                           String schemaId) throws SQLException, StandardException {\n+        PreparedStatement statement = connection.prepareStatement(sqlGetTablesInSchema);\n+        statement.setString(1, schemaId);\n+        ResultSet resultSet = statement.executeQuery();\n+        List<TableDescriptor> tableDescriptors = new ArrayList<>();\n+        while(resultSet.next()) {\n+            tableDescriptors.add(dataDictionary.getTableDescriptor(new BasicUUID(resultSet.getString(1))));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbc3987debfa0938adcda9018584e9a9c4b2e8c2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90d68339c7383fb3bf57cbcf3857043bc8e0e28d", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/90d68339c7383fb3bf57cbcf3857043bc8e0e28d", "committedDate": "2020-08-27T08:30:20Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10045"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a20c124c194b24035c61fdc6b3a6a06f5c6ea830", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/a20c124c194b24035c61fdc6b3a6a06f5c6ea830", "committedDate": "2020-08-27T14:12:51Z", "message": "DB-10045 Add upgrade script for minRetentionPeriod column."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a2d2c8491c0b071827d5a345cc1d268f9a0e57b", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/6a2d2c8491c0b071827d5a345cc1d268f9a0e57b", "committedDate": "2020-08-24T16:38:34Z", "message": "DB-10059 Add tests for SET_MIN_RETENTION_PERIOD."}, "afterCommit": {"oid": "1717d44ab20c5fa558c89fff2d338dc410acd379", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/1717d44ab20c5fa558c89fff2d338dc410acd379", "committedDate": "2020-08-27T16:53:59Z", "message": "DB-10059 Add tests for SET_MIN_RETENTION_PERIOD."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eed0230ad08bd8bebbb66ca900e95d97466a69e", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/3eed0230ad08bd8bebbb66ca900e95d97466a69e", "committedDate": "2020-08-28T17:17:08Z", "message": "DB-10045 address comments."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1717d44ab20c5fa558c89fff2d338dc410acd379", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/1717d44ab20c5fa558c89fff2d338dc410acd379", "committedDate": "2020-08-27T16:53:59Z", "message": "DB-10059 Add tests for SET_MIN_RETENTION_PERIOD."}, "afterCommit": {"oid": "32a2ea5217632dfcba385a7a4ade6bc9312cb0df", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/32a2ea5217632dfcba385a7a4ade6bc9312cb0df", "committedDate": "2020-08-28T17:34:08Z", "message": "DB-10059 address comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f42033bc14ffcec5900110b4eb293302435cab37", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/f42033bc14ffcec5900110b4eb293302435cab37", "committedDate": "2020-08-31T07:50:18Z", "message": "DB-10045 Set upgrade version to 1974."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15d8765e24bb16b43afb270d35c35108fc5bb9b0", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/15d8765e24bb16b43afb270d35c35108fc5bb9b0", "committedDate": "2020-08-31T08:37:41Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10045"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32a2ea5217632dfcba385a7a4ade6bc9312cb0df", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/32a2ea5217632dfcba385a7a4ade6bc9312cb0df", "committedDate": "2020-08-28T17:34:08Z", "message": "DB-10059 address comments."}, "afterCommit": {"oid": "86e01d36dcf57284a1b5e0a75fbd6eaea768e3d4", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/86e01d36dcf57284a1b5e0a75fbd6eaea768e3d4", "committedDate": "2020-08-31T08:39:25Z", "message": "DB-10059 address comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NDAwOTcy", "url": "https://github.com/splicemachine/spliceengine/pull/4043#pullrequestreview-479400972", "createdAt": "2020-09-01T04:59:56Z", "commit": {"oid": "86e01d36dcf57284a1b5e0a75fbd6eaea768e3d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2d34652296eff2a5fb37e2f24800bc2d308ca9f", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/c2d34652296eff2a5fb37e2f24800bc2d308ca9f", "committedDate": "2020-09-01T14:57:23Z", "message": "DB-10045 fix test."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86e01d36dcf57284a1b5e0a75fbd6eaea768e3d4", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/86e01d36dcf57284a1b5e0a75fbd6eaea768e3d4", "committedDate": "2020-08-31T08:39:25Z", "message": "DB-10059 address comments."}, "afterCommit": {"oid": "4cbd2a3d53fa0fe4cf33d90d6893b19f1dfe2124", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/4cbd2a3d53fa0fe4cf33d90d6893b19f1dfe2124", "committedDate": "2020-09-01T15:00:52Z", "message": "DB-10059 address comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDcyMDkx", "url": "https://github.com/splicemachine/spliceengine/pull/4043#pullrequestreview-481472091", "createdAt": "2020-09-03T03:48:19Z", "commit": {"oid": "4cbd2a3d53fa0fe4cf33d90d6893b19f1dfe2124"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMzo0ODoxOVrOHMU0_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwMzo0ODoxOVrOHMU0_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjY4NjIwNg==", "bodyText": "you may use .catalog(\"tableName\") and .catalog(\"schemaName\")", "url": "https://github.com/splicemachine/spliceengine/pull/4043#discussion_r482686206", "createdAt": "2020-09-03T03:48:19Z", "author": {"login": "jyuanca"}, "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/catalog/SpliceSystemProcedures.java", "diffHunk": "@@ -1186,6 +1186,16 @@ public SpliceSystemProcedures(DataDictionary dictionary) {\n                             .build();\n                     procedures.add(purgeDeletedRows);\n \n+                    Procedure minRetentionPeriod = Procedure.newBuilder().name(\"SET_MIN_RETENTION_PERIOD\")\n+                            .varchar(\"schemaName\", 128)\n+                            .varchar(\"tableName\", 128)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cbd2a3d53fa0fe4cf33d90d6893b19f1dfe2124"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzY1MDk3", "url": "https://github.com/splicemachine/spliceengine/pull/4043#pullrequestreview-483765097", "createdAt": "2020-09-08T02:56:56Z", "commit": {"oid": "4cbd2a3d53fa0fe4cf33d90d6893b19f1dfe2124"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8e5e980b27fb03dfcec599c9a736f8c45a96a09", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/a8e5e980b27fb03dfcec599c9a736f8c45a96a09", "committedDate": "2020-09-09T08:57:40Z", "message": "Merge remote-tracking branch 'origin/master' into DB-10045"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c8ebebc8035b26eb485d20471b38e3a3f25b05c", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/1c8ebebc8035b26eb485d20471b38e3a3f25b05c", "committedDate": "2020-09-09T09:04:06Z", "message": "DB-10059 Add system procedure to set retention period.\n\n- Add new system procedure SET_MIN_RETENTION_PERIOD which\n  allows setting the mininmum retention period for a table\n  or all tables in a schema."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bea34ad6e16c497d0d3482f51042882357851c79", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/bea34ad6e16c497d0d3482f51042882357851c79", "committedDate": "2020-09-09T09:04:06Z", "message": "DB-10059 Add tests for SET_MIN_RETENTION_PERIOD."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac8a7900bb0a82a1532b31e0569aa949d2d97735", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/ac8a7900bb0a82a1532b31e0569aa949d2d97735", "committedDate": "2020-09-09T09:04:06Z", "message": "DB-10059 address comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c28aaf8440617f9be04e02f48757dab6eda9b0d1", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/c28aaf8440617f9be04e02f48757dab6eda9b0d1", "committedDate": "2020-09-09T09:13:07Z", "message": "DB-10059 address comment."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4cbd2a3d53fa0fe4cf33d90d6893b19f1dfe2124", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/4cbd2a3d53fa0fe4cf33d90d6893b19f1dfe2124", "committedDate": "2020-09-01T15:00:52Z", "message": "DB-10059 address comments."}, "afterCommit": {"oid": "c28aaf8440617f9be04e02f48757dab6eda9b0d1", "author": {"user": {"login": "hatyo", "name": "Youssef Hatem"}}, "url": "https://github.com/splicemachine/spliceengine/commit/c28aaf8440617f9be04e02f48757dab6eda9b0d1", "committedDate": "2020-09-09T09:13:07Z", "message": "DB-10059 address comment."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1186, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}