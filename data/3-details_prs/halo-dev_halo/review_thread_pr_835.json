{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MzYwNjQy", "number": 835, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjozODo0MVrOEFnPxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0NzoxOVrOEFnbsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MzIxMzUxOnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/utils/GitUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjozODo0MVrOGj6GuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjozODo0MVrOGj6GuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNTMzNw==", "bodyText": "\u5efa\u8bae\u5c06 exception \u8bbe\u7f6e\u5230 log \u4e2d\uff0c\u4ee5\u8bb0\u5f55\u5b8c\u6574\u7684\u9519\u8bef\u6808\u3002\u4e0b\u540c\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440305337", "createdAt": "2020-06-15T16:38:41Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/utils/GitUtils.java", "diffHunk": "@@ -59,6 +69,43 @@ public static Git openOrInit(Path repoPath) throws IOException, GitAPIException\n         return git;\n     }\n \n+    public static void cloneFromGit(@NonNull String repoUrl, @NonNull Path targetPath, @NonNull String branchName) throws GitAPIException {\n+        Assert.hasText(repoUrl, \"Repository remote url must not be blank\");\n+        Assert.notNull(targetPath, \"Target path must not be null\");\n+\n+        Git git = null;\n+        try {\n+            git = Git.cloneRepository()\n+                    .setURI(repoUrl)\n+                    .setDirectory(targetPath.toFile())\n+                    .setBranchesToClone(Arrays.asList(\"refs/heads/\" + branchName))\n+                    .setBranch(\"refs/heads/\" + branchName)\n+                    .call();\n+        } finally {\n+            closeQuietly(git);\n+        }\n+    }\n+\n+    public static List<String> getAllBranches(@NonNull String repoUrl) {\n+        List<String> branches = new ArrayList<String>();\n+        try {\n+            Collection<Ref> refs = Git.lsRemoteRepository()\n+                    .setHeads(true)\n+                    .setRemote(repoUrl)\n+                    .call();\n+            for (Ref ref : refs) {\n+                branches.add(ref.getName().substring(ref.getName().lastIndexOf(\"/\") + 1, ref.getName().length()));\n+            }\n+        } catch (InvalidRemoteException e) {\n+            log.warn(\"Git url is not valid\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MzIxOTU1OnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/utils/GitUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0MDoyNlrOGj6Kwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0MDoyNlrOGj6Kwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNjM3MA==", "bodyText": "\u6211\u53d1\u73b0 GithubUtils \u4e2d\u5df2\u7ecf\u5305\u542b\u4e86 PREFIX\uff0c\u6240\u4ee5\u8fd9\u91cc\u5f97 PREFIX \u53ef\u80fd\u6709\u4e9b\u591a\u4f59\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440306370", "createdAt": "2020-06-15T16:40:26Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/utils/GitUtils.java", "diffHunk": "@@ -20,6 +24,12 @@\n @Slf4j\n public class GitUtils {\n \n+    static final String PREFIX = \"https://github.com/\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MzIyNDMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/utils/GithubUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0MTo0NFrOGj6NpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0MTo0NFrOGj6NpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNzEwOQ==", "bodyText": "\u5c06 e \u66f4\u6539\u4e3a ingored \u6216 log.warn  \u8bb0\u5f55\u3002\u4e0b\u540c\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440307109", "createdAt": "2020-06-15T16:41:44Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/utils/GithubUtils.java", "diffHunk": "@@ -0,0 +1,364 @@\n+package run.halo.app.utils;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+import org.kohsuke.github.*;\n+import run.halo.app.service.ThemeService;\n+\n+import java.io.FileNotFoundException;\n+import java.util.*;\n+\n+/**\n+ * GithubUtils send request to api.github.com\n+ *\n+ * @author bigbang019\n+ * @date 2020-05-31\n+ */\n+@Slf4j\n+public class GithubUtils {\n+\n+    /**\n+     * The prefix need to remove\n+     */\n+    static final String PREFIX = \"https://github.com/\";\n+\n+    /**\n+     * Get latest release\n+     * @param uri repository url must not be null\n+     * @return the map object containning tagname and zipfile url\n+     */\n+    public static Map<String, Object> getLatestRelease(String uri) {\n+        String repoUrl = StringUtils.removeStartIgnoreCase(uri, PREFIX);\n+\n+        try {\n+            GithubLatestRelease githubLatestRelease = new GithubLatestRelease(repoUrl);\n+\n+            Thread thread = new Thread(githubLatestRelease);\n+\n+            thread.start();\n+\n+            thread.join(10 * 1000);\n+\n+            return githubLatestRelease.result;\n+        } catch (InterruptedException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MzIzNTQ5OnYy", "diffSide": "RIGHT", "path": "src/test/java/run/halo/app/service/impl/ThemeServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0NTowMVrOGj6U-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0NTowMVrOGj6U-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwODk4NQ==", "bodyText": "\u53ef\u4ee5\u4e0d\u7528 @RunWith(SpringRunner.class) \u6ce8\u89e3\u4e86\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440308985", "createdAt": "2020-06-15T16:45:01Z", "author": {"login": "JohnNiang"}, "path": "src/test/java/run/halo/app/service/impl/ThemeServiceImplTest.java", "diffHunk": "@@ -0,0 +1,177 @@\n+package run.halo.app.service.impl;\n+\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import run.halo.app.handler.theme.config.support.ThemeProperty;\n+import run.halo.app.utils.GitUtils;\n+import run.halo.app.utils.HaloUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.*;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+@RunWith(SpringRunner.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MzI0NDAzOnYy", "diffSide": "RIGHT", "path": "src/test/java/run/halo/app/service/impl/ThemeServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0NzoxOVrOGj6aXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0NzoxOVrOGj6aXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxMDM2NA==", "bodyText": "\u5efa\u8bae\u7528 Mockito \u6765\u6d4b\u8bd5\uff0c\u5982\u679c\u76f4\u63a5\u771f\u662f\u8c03\u7528 Github \u53ef\u80fd\u4f1a\u5bfc\u81f4\u5728\u672c\u5730\u6d4b\u8bd5\u975e\u5e38\u7f13\u6162\u751a\u81f3\u76f4\u63a5\u5f02\u5e38\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440310364", "createdAt": "2020-06-15T16:47:19Z", "author": {"login": "JohnNiang"}, "path": "src/test/java/run/halo/app/service/impl/ThemeServiceImplTest.java", "diffHunk": "@@ -0,0 +1,177 @@\n+package run.halo.app.service.impl;\n+\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import run.halo.app.handler.theme.config.support.ThemeProperty;\n+import run.halo.app.utils.GitUtils;\n+import run.halo.app.utils.HaloUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.*;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@ActiveProfiles(\"test\")\n+@Slf4j\n+public class ThemeServiceImplTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2048, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}