{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5OTI2Mzgw", "number": 1199, "title": "add API for markdown-export", "bodyText": "\u5df2\u7ecf\u63d0\u4ea4 Issue #1198\uff0c\n\u6dfb\u52a0\u4e86\u4e00\u952e\u4ee5Markdown\u683c\u5f0f\u5bfc\u51faHalo\u6240\u6709\u7684\u6587\u7ae0(\u6253\u5305ZIP)\u7684API\uff1a\n\n/api/admin/backups/markdown-export [GET] \u83b7\u53d6\u6587\u4ef6\u5217\u8868\n/api/admin/backups/markdown-export [POST] \u5bfc\u51fa\u4e3aZIP\n/api/admin/backups/markdown-export [DELETE] \u5220\u9664\u6587\u4ef6\n/api/admin/backups/markdown-export/{filename=} [GET] \u4e0b\u8f7d\n\n\u524d\u7aef\u9875\u9762\u540e\u7eed\u518d\u4fee\u6539Halo-admin\u9879\u76ee", "createdAt": "2020-12-15T02:17:23Z", "url": "https://github.com/halo-dev/halo/pull/1199", "merged": true, "mergeCommit": {"oid": "8ba115ffb6fd08568b7699ced72e0baa91f87759"}, "closed": true, "closedAt": "2020-12-27T15:58:53Z", "author": {"login": "Raremaa"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmQflMAH2gAyNTM5OTI2MzgwOmU1MWU2NTAyYmUwZGU1MjhhYjI4Njk5YTZkZGU4YzAxNjE1ZjJiNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpzh2sAFqTU1ODg0NDAyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e51e6502be0de528ab28699a6dde8c01615f2b78", "author": {"user": {"login": "Raremaa", "name": null}}, "url": "https://github.com/halo-dev/halo/commit/e51e6502be0de528ab28699a6dde8c01615f2b78", "committedDate": "2020-12-15T01:59:20Z", "message": "add API for markdown-export"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMjQ1Mjc1", "url": "https://github.com/halo-dev/halo/pull/1199#pullrequestreview-553245275", "createdAt": "2020-12-16T01:21:21Z", "commit": {"oid": "e51e6502be0de528ab28699a6dde8c01615f2b78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMzA1MzEz", "url": "https://github.com/halo-dev/halo/pull/1199#pullrequestreview-553305313", "createdAt": "2020-12-16T02:13:31Z", "commit": {"oid": "e51e6502be0de528ab28699a6dde8c01615f2b78"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMjoxMzozMlrOIGovJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMjoxNDo0MlrOIGozPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgyOTc5OQ==", "bodyText": "\u5efa\u8bae\u76f4\u63a5 markdown", "url": "https://github.com/halo-dev/halo/pull/1199#discussion_r543829799", "createdAt": "2020-12-16T02:13:32Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/BackupController.java", "diffHunk": "@@ -132,4 +131,50 @@ public void deleteExportedData(@RequestParam(\"filename\") String filename) {\n                 .header(HttpHeaders.CONTENT_DISPOSITION, \"attachment; filename=\\\"\" + exportDataResource.getFilename() + \"\\\"\")\n                 .body(exportDataResource);\n     }\n+\n+    @PostMapping(\"markdown-export\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51e6502be0de528ab28699a6dde8c01615f2b78"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgzMDg0NA==", "bodyText": "\u662f\u5426\u8003\u8651\u5728 Markdown \u4e2d\u751f\u6210\u989d\u5916\u7684\u4fe1\u606f\uff08Front-matter\uff09", "url": "https://github.com/halo-dev/halo/pull/1199#discussion_r543830844", "createdAt": "2020-12-16T02:14:42Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/service/impl/BackupServiceImpl.java", "diffHunk": "@@ -429,6 +431,102 @@ public void importData(MultipartFile file) throws IOException {\n         eventPublisher.publishEvent(new ThemeUpdatedEvent(this));\n     }\n \n+    @Override\n+    public BackupDTO exportMarkdowns() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51e6502be0de528ab28699a6dde8c01615f2b78"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "545bd691df5496ed5b0bf0d5c7e233a0b76e09ec", "author": {"user": {"login": "Raremaa", "name": null}}, "url": "https://github.com/halo-dev/halo/commit/545bd691df5496ed5b0bf0d5c7e233a0b76e09ec", "committedDate": "2020-12-25T03:58:41Z", "message": "add front-matter support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODE5NTY2", "url": "https://github.com/halo-dev/halo/pull/1199#pullrequestreview-558819566", "createdAt": "2020-12-25T14:13:11Z", "commit": {"oid": "545bd691df5496ed5b0bf0d5c7e233a0b76e09ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxNDoxMzoxMVrOILc0Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxNDoxOToxNVrOILc2-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg3NzM1MQ==", "bodyText": "\u5efa\u8bae\u5728  FrontMatter \u548c\u6b63\u6587\u4e4b\u95f4\u52a0\u4e2a\u6362\u884c\u7b26\u3002", "url": "https://github.com/halo-dev/halo/pull/1199#discussion_r548877351", "createdAt": "2020-12-25T14:13:11Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/service/impl/BackupServiceImpl.java", "diffHunk": "@@ -429,6 +438,121 @@ public void importData(MultipartFile file) throws IOException {\n         eventPublisher.publishEvent(new ThemeUpdatedEvent(this));\n     }\n \n+    @Override\n+    public BackupDTO exportMarkdowns(PostMarkdownParam postMarkdownParam) throws IOException {\n+        // Query all Post data\n+        List<PostMarkdownVO> postMarkdownList = postService.listPostMarkdowns();\n+        Assert.notEmpty(postMarkdownList, \"\u5f53\u524d\u65e0\u6587\u7ae0\u53ef\u4ee5\u5bfc\u51fa\");\n+\n+        // Write files to the temporary directory\n+        String markdownFileTempPathName = haloProperties.getBackupMarkdownDir() + IdUtil.simpleUUID().hashCode();\n+        for (int i = 0; i < postMarkdownList.size(); i++) {\n+            PostMarkdownVO postMarkdownVO = postMarkdownList.get(i);\n+            StringBuilder content = new StringBuilder();\n+            Boolean needFrontMatter = Optional.ofNullable(postMarkdownParam.getNeedFrontMatter()).orElse(false);\n+            if (needFrontMatter) {\n+                // Add front-matter\n+                content.append(postMarkdownVO.getFrontMatter());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "545bd691df5496ed5b0bf0d5c7e233a0b76e09ec"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg3ODA3Mw==", "bodyText": "\u6587\u4ef6\u540d\u540e\u9762\u52a0\u4e0a\u4e00\u4e32 hashCode \u7684\u4f5c\u7528\u662f\uff1f", "url": "https://github.com/halo-dev/halo/pull/1199#discussion_r548878073", "createdAt": "2020-12-25T14:19:15Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/service/impl/BackupServiceImpl.java", "diffHunk": "@@ -429,6 +438,121 @@ public void importData(MultipartFile file) throws IOException {\n         eventPublisher.publishEvent(new ThemeUpdatedEvent(this));\n     }\n \n+    @Override\n+    public BackupDTO exportMarkdowns(PostMarkdownParam postMarkdownParam) throws IOException {\n+        // Query all Post data\n+        List<PostMarkdownVO> postMarkdownList = postService.listPostMarkdowns();\n+        Assert.notEmpty(postMarkdownList, \"\u5f53\u524d\u65e0\u6587\u7ae0\u53ef\u4ee5\u5bfc\u51fa\");\n+\n+        // Write files to the temporary directory\n+        String markdownFileTempPathName = haloProperties.getBackupMarkdownDir() + IdUtil.simpleUUID().hashCode();\n+        for (int i = 0; i < postMarkdownList.size(); i++) {\n+            PostMarkdownVO postMarkdownVO = postMarkdownList.get(i);\n+            StringBuilder content = new StringBuilder();\n+            Boolean needFrontMatter = Optional.ofNullable(postMarkdownParam.getNeedFrontMatter()).orElse(false);\n+            if (needFrontMatter) {\n+                // Add front-matter\n+                content.append(postMarkdownVO.getFrontMatter());\n+            }\n+            content.append(postMarkdownVO.getOriginalContent());\n+            try {\n+                String markdownFileName = postMarkdownVO.getTitle() + \"-\" + IdUtil.simpleUUID().hashCode() + \".md\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "545bd691df5496ed5b0bf0d5c7e233a0b76e09ec"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "304daaed839697338e48dc7f6a18d648728b961e", "author": {"user": {"login": "Raremaa", "name": null}}, "url": "https://github.com/halo-dev/halo/commit/304daaed839697338e48dc7f6a18d648728b961e", "committedDate": "2020-12-25T15:18:25Z", "message": "optimize fileName for markdown-export"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODIyODMw", "url": "https://github.com/halo-dev/halo/pull/1199#pullrequestreview-558822830", "createdAt": "2020-12-25T15:02:20Z", "commit": {"oid": "545bd691df5496ed5b0bf0d5c7e233a0b76e09ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxNTowMjoyMFrOILdH3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxNTowMjoyMFrOILdH3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4MjM5Ng==", "bodyText": "src/main/java/run/halo/app/service/impl/PostServiceImpl.java#868\n\u6709\u52a0\u6362\u884c\u7b26\uff0c\u8fd9\u91cc\u5f97\u5230\u7684PostMarkdownVO\u5176\u5b9e\u5c01\u88c5\u4e863\u90e8\u5206\u5185\u5bb9\uff1a\n\n\u6807\u9898\nfront-matter\n\u6b63\u6587\n\u5176\u4e2d\uff0cfront-matter\u5728postService\u4e2d\u7ed3\u5c3e\u5df2\u7ecf\u5e26\u4e86\u6362\u884c\u7b26", "url": "https://github.com/halo-dev/halo/pull/1199#discussion_r548882396", "createdAt": "2020-12-25T15:02:20Z", "author": {"login": "Raremaa"}, "path": "src/main/java/run/halo/app/service/impl/BackupServiceImpl.java", "diffHunk": "@@ -429,6 +438,121 @@ public void importData(MultipartFile file) throws IOException {\n         eventPublisher.publishEvent(new ThemeUpdatedEvent(this));\n     }\n \n+    @Override\n+    public BackupDTO exportMarkdowns(PostMarkdownParam postMarkdownParam) throws IOException {\n+        // Query all Post data\n+        List<PostMarkdownVO> postMarkdownList = postService.listPostMarkdowns();\n+        Assert.notEmpty(postMarkdownList, \"\u5f53\u524d\u65e0\u6587\u7ae0\u53ef\u4ee5\u5bfc\u51fa\");\n+\n+        // Write files to the temporary directory\n+        String markdownFileTempPathName = haloProperties.getBackupMarkdownDir() + IdUtil.simpleUUID().hashCode();\n+        for (int i = 0; i < postMarkdownList.size(); i++) {\n+            PostMarkdownVO postMarkdownVO = postMarkdownList.get(i);\n+            StringBuilder content = new StringBuilder();\n+            Boolean needFrontMatter = Optional.ofNullable(postMarkdownParam.getNeedFrontMatter()).orElse(false);\n+            if (needFrontMatter) {\n+                // Add front-matter\n+                content.append(postMarkdownVO.getFrontMatter());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg3NzM1MQ=="}, "originalCommit": {"oid": "545bd691df5496ed5b0bf0d5c7e233a0b76e09ec"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11d3b66989db5788570bd9ba24cff2ff1ea3b6bf", "author": {"user": {"login": "Raremaa", "name": null}}, "url": "https://github.com/halo-dev/halo/commit/11d3b66989db5788570bd9ba24cff2ff1ea3b6bf", "committedDate": "2020-12-25T15:26:17Z", "message": "fornt-matter\u4e0e\u6b63\u6587\u4e2d\u95f4\u589e\u52a0\u6362\u884c\u7b26"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODQ0MDI3", "url": "https://github.com/halo-dev/halo/pull/1199#pullrequestreview-558844027", "createdAt": "2020-12-26T02:30:16Z", "commit": {"oid": "11d3b66989db5788570bd9ba24cff2ff1ea3b6bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4162, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}