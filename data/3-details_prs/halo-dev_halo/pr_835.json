{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MzYwNjQy", "number": 835, "title": "fix issue 515&592", "bodyText": "\u9488\u5bf9 #515\n\n1 \u6bcf\u6b21\u66f4\u65b0\u5f3a\u5236\u66f4\u65b0\u5230\u6700\u65b0\u7684release\u800c\u4e0d\u662fmaster\n2 \u8ba1\u5212\u53ef\u4ee5\u5728\u8fdc\u7a0b\u62c9\u53d6\u7684\u65f6\u5019\u9009\u62e9\u7a33\u5b9a\u7248\uff08latest release\uff09\u548c\u5f00\u53d1\u7248\uff08\u5404\u4e2abranch\uff09\nProgress:\n1 \u76f8\u5e94\u7684\u540e\u7aef\u903b\u8f91\uff08themeService.java GitUtil.java themeServiceImpl.java\uff09\u5df2\u7ecf\u6dfb\u52a0\uff0c\u524d\u7aef\u903b\u8f91\u548ccontroller\u8fd8\u672a\u6dfb\u52a0 ----- done\n2 Test\u548cJavaDoc\u672a\u5b8c\u5584 ----- done", "createdAt": "2020-05-08T18:10:30Z", "url": "https://github.com/halo-dev/halo/pull/835", "merged": true, "mergeCommit": {"oid": "2b99bd599fd20161fd5a5c9a021291ea5ea7fe2b"}, "closed": true, "closedAt": "2020-07-02T15:34:48Z", "author": {"login": "BigBang019"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfCrS1AH2gAyNDE1MzYwNjQyOmEwMjExOGIyZTY4NGI3YzQzZDYyZjQ4YWRjOWFiZmYxMzJmOTNhZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxAo64AFqTQ0MTgwNTExMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a02118b2e684b7c43d62f48adc9abff132f93af8", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/a02118b2e684b7c43d62f48adc9abff132f93af8", "committedDate": "2020-05-07T19:44:50Z", "message": "add release access and branch access(#515)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87683b8f70ff291a8b2585432c404175d6b3b43e", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/87683b8f70ff291a8b2585432c404175d6b3b43e", "committedDate": "2020-05-07T22:11:54Z", "message": "add release and branch access(#515)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77cc2792f77d55f943f240706e3d547290b4a1ad", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/77cc2792f77d55f943f240706e3d547290b4a1ad", "committedDate": "2020-05-08T08:40:33Z", "message": "always update to latest release(#515)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "382147f4d23e6a255e025e2005bfb9b90ae58575", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/382147f4d23e6a255e025e2005bfb9b90ae58575", "committedDate": "2020-05-08T18:19:39Z", "message": "#515"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e62e4dae9ccd8889c02ef024bd55b2ebf318900", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/0e62e4dae9ccd8889c02ef024bd55b2ebf318900", "committedDate": "2020-05-08T18:25:42Z", "message": "#515"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a49c3ac99554611a9186fca20539273ff1ee54a", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/1a49c3ac99554611a9186fca20539273ff1ee54a", "committedDate": "2020-05-08T19:57:45Z", "message": "add testcases(#515)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffbb62d38f50a7eebf0c365dc13aec2771464a6c", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/ffbb62d38f50a7eebf0c365dc13aec2771464a6c", "committedDate": "2020-05-08T20:22:28Z", "message": "fix 515"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3a1eac42a624421dc6d8076941e025a9a1a0e31", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/d3a1eac42a624421dc6d8076941e025a9a1a0e31", "committedDate": "2020-05-08T20:24:07Z", "message": "fix 515"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "673c7996c84b22b6fac58dd0090bb4b7d5ccadb7", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/673c7996c84b22b6fac58dd0090bb4b7d5ccadb7", "committedDate": "2020-05-12T13:09:11Z", "message": "deal with connection refused"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ca41a70c464abb77c6c1ae49f4a0b87e05ed5b7", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/2ca41a70c464abb77c6c1ae49f4a0b87e05ed5b7", "committedDate": "2020-05-12T13:22:07Z", "message": "disable disk operation related test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0314f745ad6536aba2eca515986106c4274bb88", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/c0314f745ad6536aba2eca515986106c4274bb88", "committedDate": "2020-05-31T06:24:57Z", "message": "fix #592"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abb9454bd46369d5248035c2aa2e9fc9f1d8841d", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/abb9454bd46369d5248035c2aa2e9fc9f1d8841d", "committedDate": "2020-05-31T11:53:21Z", "message": "fix #515 & #592"}, "afterCommit": {"oid": "c0314f745ad6536aba2eca515986106c4274bb88", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/c0314f745ad6536aba2eca515986106c4274bb88", "committedDate": "2020-05-31T06:24:57Z", "message": "fix #592"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/bd2db3670b28e22e672bb917ce4a279573b7b46c", "committedDate": "2020-05-31T12:03:26Z", "message": "fix #515 & #592"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODEzMzUw", "url": "https://github.com/halo-dev/halo/pull/835#pullrequestreview-430813350", "createdAt": "2020-06-15T16:38:41Z", "commit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjozODo0MVrOGj6GuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNjo0NzoxOVrOGj6aXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNTMzNw==", "bodyText": "\u5efa\u8bae\u5c06 exception \u8bbe\u7f6e\u5230 log \u4e2d\uff0c\u4ee5\u8bb0\u5f55\u5b8c\u6574\u7684\u9519\u8bef\u6808\u3002\u4e0b\u540c\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440305337", "createdAt": "2020-06-15T16:38:41Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/utils/GitUtils.java", "diffHunk": "@@ -59,6 +69,43 @@ public static Git openOrInit(Path repoPath) throws IOException, GitAPIException\n         return git;\n     }\n \n+    public static void cloneFromGit(@NonNull String repoUrl, @NonNull Path targetPath, @NonNull String branchName) throws GitAPIException {\n+        Assert.hasText(repoUrl, \"Repository remote url must not be blank\");\n+        Assert.notNull(targetPath, \"Target path must not be null\");\n+\n+        Git git = null;\n+        try {\n+            git = Git.cloneRepository()\n+                    .setURI(repoUrl)\n+                    .setDirectory(targetPath.toFile())\n+                    .setBranchesToClone(Arrays.asList(\"refs/heads/\" + branchName))\n+                    .setBranch(\"refs/heads/\" + branchName)\n+                    .call();\n+        } finally {\n+            closeQuietly(git);\n+        }\n+    }\n+\n+    public static List<String> getAllBranches(@NonNull String repoUrl) {\n+        List<String> branches = new ArrayList<String>();\n+        try {\n+            Collection<Ref> refs = Git.lsRemoteRepository()\n+                    .setHeads(true)\n+                    .setRemote(repoUrl)\n+                    .call();\n+            for (Ref ref : refs) {\n+                branches.add(ref.getName().substring(ref.getName().lastIndexOf(\"/\") + 1, ref.getName().length()));\n+            }\n+        } catch (InvalidRemoteException e) {\n+            log.warn(\"Git url is not valid\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNjM3MA==", "bodyText": "\u6211\u53d1\u73b0 GithubUtils \u4e2d\u5df2\u7ecf\u5305\u542b\u4e86 PREFIX\uff0c\u6240\u4ee5\u8fd9\u91cc\u5f97 PREFIX \u53ef\u80fd\u6709\u4e9b\u591a\u4f59\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440306370", "createdAt": "2020-06-15T16:40:26Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/utils/GitUtils.java", "diffHunk": "@@ -20,6 +24,12 @@\n @Slf4j\n public class GitUtils {\n \n+    static final String PREFIX = \"https://github.com/\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNzEwOQ==", "bodyText": "\u5c06 e \u66f4\u6539\u4e3a ingored \u6216 log.warn  \u8bb0\u5f55\u3002\u4e0b\u540c\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440307109", "createdAt": "2020-06-15T16:41:44Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/utils/GithubUtils.java", "diffHunk": "@@ -0,0 +1,364 @@\n+package run.halo.app.utils;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+import org.kohsuke.github.*;\n+import run.halo.app.service.ThemeService;\n+\n+import java.io.FileNotFoundException;\n+import java.util.*;\n+\n+/**\n+ * GithubUtils send request to api.github.com\n+ *\n+ * @author bigbang019\n+ * @date 2020-05-31\n+ */\n+@Slf4j\n+public class GithubUtils {\n+\n+    /**\n+     * The prefix need to remove\n+     */\n+    static final String PREFIX = \"https://github.com/\";\n+\n+    /**\n+     * Get latest release\n+     * @param uri repository url must not be null\n+     * @return the map object containning tagname and zipfile url\n+     */\n+    public static Map<String, Object> getLatestRelease(String uri) {\n+        String repoUrl = StringUtils.removeStartIgnoreCase(uri, PREFIX);\n+\n+        try {\n+            GithubLatestRelease githubLatestRelease = new GithubLatestRelease(repoUrl);\n+\n+            Thread thread = new Thread(githubLatestRelease);\n+\n+            thread.start();\n+\n+            thread.join(10 * 1000);\n+\n+            return githubLatestRelease.result;\n+        } catch (InterruptedException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwODk4NQ==", "bodyText": "\u53ef\u4ee5\u4e0d\u7528 @RunWith(SpringRunner.class) \u6ce8\u89e3\u4e86\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440308985", "createdAt": "2020-06-15T16:45:01Z", "author": {"login": "JohnNiang"}, "path": "src/test/java/run/halo/app/service/impl/ThemeServiceImplTest.java", "diffHunk": "@@ -0,0 +1,177 @@\n+package run.halo.app.service.impl;\n+\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import run.halo.app.handler.theme.config.support.ThemeProperty;\n+import run.halo.app.utils.GitUtils;\n+import run.halo.app.utils.HaloUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.*;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+@RunWith(SpringRunner.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxMDM2NA==", "bodyText": "\u5efa\u8bae\u7528 Mockito \u6765\u6d4b\u8bd5\uff0c\u5982\u679c\u76f4\u63a5\u771f\u662f\u8c03\u7528 Github \u53ef\u80fd\u4f1a\u5bfc\u81f4\u5728\u672c\u5730\u6d4b\u8bd5\u975e\u5e38\u7f13\u6162\u751a\u81f3\u76f4\u63a5\u5f02\u5e38\u3002", "url": "https://github.com/halo-dev/halo/pull/835#discussion_r440310364", "createdAt": "2020-06-15T16:47:19Z", "author": {"login": "JohnNiang"}, "path": "src/test/java/run/halo/app/service/impl/ThemeServiceImplTest.java", "diffHunk": "@@ -0,0 +1,177 @@\n+package run.halo.app.service.impl;\n+\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.commons.lang3.StringUtils;\n+import org.junit.Assert;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import run.halo.app.handler.theme.config.support.ThemeProperty;\n+import run.halo.app.utils.GitUtils;\n+import run.halo.app.utils.HaloUtils;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.*;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@ActiveProfiles(\"test\")\n+@Slf4j\n+public class ThemeServiceImplTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd2db3670b28e22e672bb917ce4a279573b7b46c"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f417f32873389ae6116901c558ccac8110adbd7", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/5f417f32873389ae6116901c558ccac8110adbd7", "committedDate": "2020-06-19T12:49:10Z", "message": "mockito test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bbb20cce205c303de06588244da8c9fc62a141f", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/4bbb20cce205c303de06588244da8c9fc62a141f", "committedDate": "2020-06-19T13:53:59Z", "message": "ignored network related test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "197205a35e459962c4692bb0582ac9d06f788ddd", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/197205a35e459962c4692bb0582ac9d06f788ddd", "committedDate": "2020-06-28T02:20:12Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b59602cf491b2ddea76b523d4476367b7ad16a", "author": {"user": {"login": "BigBang019", "name": "Xingyu ZHU"}}, "url": "https://github.com/halo-dev/halo/commit/12b59602cf491b2ddea76b523d4476367b7ad16a", "committedDate": "2020-06-28T06:27:47Z", "message": "resolve conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODA1MTEw", "url": "https://github.com/halo-dev/halo/pull/835#pullrequestreview-441805110", "createdAt": "2020-07-02T15:33:04Z", "commit": {"oid": "12b59602cf491b2ddea76b523d4476367b7ad16a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4193, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}