{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MjY4NDEz", "number": 569, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo0NFrODfz7wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwOTowMzowNFrODf0dTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjgzMzI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo0NFrOFpu0yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMDo0NFrOFpu0yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzExMg==", "bodyText": "\u53ef\u4ee5\u5220\u6389\u4e86", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379303112", "createdAt": "2020-02-14T08:30:44Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package run.halo.app.handler.aspect;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Pointcut;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Component;\n+import run.halo.app.Application;\n+import run.halo.app.model.annotation.DisableApi;\n+import run.halo.app.model.enums.Mode;\n+import run.halo.app.model.support.BaseResponse;\n+\n+/**\n+ * \u81ea\u5b9a\u4e49\u6ce8\u89e3DisableApi\u7684\u5207\u9762\n+ * @author guqing\n+ * @date 2020-02-14 14:08\n+ */\n+@Aspect\n+@Component\n+public class DisableApiAspect {\n+    @Value(\"${spring.profiles.active:prod}\")\n+    private String activeProfile;\n+\n+    @Pointcut(\"@annotation(run.halo.app.model.annotation.DisableApi)\")\n+    public void pointcut(){}\n+\n+    @Around(\"pointcut() && @annotation(disableApi)\")\n+    public Object around(ProceedingJoinPoint joinPoint,\n+                         DisableApi disableApi){\n+        Mode mode = disableApi.mode();\n+        System.out.println(activeProfile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjgzNjQ5OnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "isResolved": true, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODozMjowMlrOFpu2uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMDo0NTozM1rOFpylrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA==", "bodyText": "\u4e0d\u6b62\u5bc6\u7801\uff0c\u8fd8\u6709\u4fee\u6539\u7cfb\u7edf\u8bbe\u7f6e", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379303608", "createdAt": "2020-02-14T08:32:02Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzg5Mw==", "bodyText": "\u8fd8\u6709\u5f00\u53d1\u8005\u9009\u9879\u91cc\u9762\u7684\u4e00\u4e9b API", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379303893", "createdAt": "2020-02-14T08:32:50Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwNjMwNg==", "bodyText": "\u8fd8\u6ca1\u5199\u5b8c  \u4e00\u4f1a\u513f\u6539\ud83d\ude02\u8fd8\u6709\u5b9a\u65f6\u590d\u539f\u7684\u529f\u80fd", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379306306", "createdAt": "2020-02-14T08:39:10Z", "author": {"login": "guqing"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwNzY3OQ==", "bodyText": "run.halo.app.controller.admin.api.OptionController#saveOptions\nrun.halo.app.controller.admin.api.OptionController#createBy\nrun.halo.app.controller.admin.api.OptionController#updateBy\nrun.halo.app.controller.admin.api.OptionController#deletePermanently\nrun.halo.app.controller.admin.api.OptionController#saveOptionsWithMapView\nrun.halo.app.controller.admin.api.AdminController#resetPassword\nrun.halo.app.controller.admin.api.AdminController#updateSpringApplicationConfig\nrun.halo.app.controller.admin.api.AdminController#restartApplication", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379307679", "createdAt": "2020-02-14T08:42:48Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwNzkzNw==", "bodyText": "\u597d\u7684", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379307937", "createdAt": "2020-02-14T08:43:27Z", "author": {"login": "guqing"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwODQyMg==", "bodyText": "\u8fd8\u6ca1\u5199\u5b8c \u4e00\u4f1a\u513f\u6539\ud83d\ude02\u8fd8\u6709\u5b9a\u65f6\u590d\u539f\u7684\u529f\u80fd\n\n\u5b9a\u65f6\u590d\u539f\u7684\u903b\u8f91\u4e5f\u8981\u52a0\u5417\uff1f", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379308422", "createdAt": "2020-02-14T08:44:41Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMxNjgxMA==", "bodyText": "\u4f60\u4eec\u4e0d\u662f\u90fd\u8bf4\u9700\u8981\u8fd9\u4e2a\u529f\u80fd\u5417\uff0c\u4e0d\u8981\u4e5f\u53ef\u4ee5\u4e0d\u5199", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379316810", "createdAt": "2020-02-14T09:04:05Z", "author": {"login": "guqing"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2NDIyNw==", "bodyText": "\u4e0d\u5efa\u8bae\u52a0\u5728 halo \u91cc\u9762", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379364227", "createdAt": "2020-02-14T10:44:14Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2NDc4Mw==", "bodyText": "\u597d\u7684", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379364783", "createdAt": "2020-02-14T10:45:33Z", "author": {"login": "guqing"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -49,6 +50,7 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n     }\n \n     @PutMapping(\"profiles/password\")\n+    @DisableApi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwMzYwOA=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0Njg2NTY3OnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODo0NDowNVrOFpvIoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwODo1MzoyMlrOFpvXvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwODE5Mg==", "bodyText": "\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u629b\u51fa ForbiddenException", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379308192", "createdAt": "2020-02-14T08:44:05Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package run.halo.app.handler.aspect;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Pointcut;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Component;\n+import run.halo.app.Application;\n+import run.halo.app.model.annotation.DisableApi;\n+import run.halo.app.model.enums.Mode;\n+import run.halo.app.model.support.BaseResponse;\n+\n+/**\n+ * \u81ea\u5b9a\u4e49\u6ce8\u89e3DisableApi\u7684\u5207\u9762\n+ * @author guqing\n+ * @date 2020-02-14 14:08\n+ */\n+@Aspect\n+@Component\n+public class DisableApiAspect {\n+    @Value(\"${spring.profiles.active:prod}\")\n+    private String activeProfile;\n+\n+    @Pointcut(\"@annotation(run.halo.app.model.annotation.DisableApi)\")\n+    public void pointcut(){}\n+\n+    @Around(\"pointcut() && @annotation(disableApi)\")\n+    public Object around(ProceedingJoinPoint joinPoint,\n+                         DisableApi disableApi){\n+        Mode mode = disableApi.mode();\n+        System.out.println(activeProfile);\n+        System.out.println(mode.name());\n+        if(StringUtils.equalsIgnoreCase(mode.name(), activeProfile)) {\n+            return new BaseResponse<>(HttpStatus.FORBIDDEN.value(), \"\u7981\u6b62\u8bbf\u95ee\",null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwODc2Mg==", "bodyText": "\u629b\u5f02\u5e38\u4e0d\u592a\u53cb\u597d\u5427", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379308762", "createdAt": "2020-02-14T08:45:28Z", "author": {"login": "guqing"}, "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package run.halo.app.handler.aspect;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Pointcut;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Component;\n+import run.halo.app.Application;\n+import run.halo.app.model.annotation.DisableApi;\n+import run.halo.app.model.enums.Mode;\n+import run.halo.app.model.support.BaseResponse;\n+\n+/**\n+ * \u81ea\u5b9a\u4e49\u6ce8\u89e3DisableApi\u7684\u5207\u9762\n+ * @author guqing\n+ * @date 2020-02-14 14:08\n+ */\n+@Aspect\n+@Component\n+public class DisableApiAspect {\n+    @Value(\"${spring.profiles.active:prod}\")\n+    private String activeProfile;\n+\n+    @Pointcut(\"@annotation(run.halo.app.model.annotation.DisableApi)\")\n+    public void pointcut(){}\n+\n+    @Around(\"pointcut() && @annotation(disableApi)\")\n+    public Object around(ProceedingJoinPoint joinPoint,\n+                         DisableApi disableApi){\n+        Mode mode = disableApi.mode();\n+        System.out.println(activeProfile);\n+        System.out.println(mode.name());\n+        if(StringUtils.equalsIgnoreCase(mode.name(), activeProfile)) {\n+            return new BaseResponse<>(HttpStatus.FORBIDDEN.value(), \"\u7981\u6b62\u8bbf\u95ee\",null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwODE5Mg=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMxMjA2Mg==", "bodyText": "\u76f4\u63a5\u629b\u5f02\u5e38\u5373\u53ef", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379312062", "createdAt": "2020-02-14T08:53:22Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package run.halo.app.handler.aspect;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Pointcut;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Component;\n+import run.halo.app.Application;\n+import run.halo.app.model.annotation.DisableApi;\n+import run.halo.app.model.enums.Mode;\n+import run.halo.app.model.support.BaseResponse;\n+\n+/**\n+ * \u81ea\u5b9a\u4e49\u6ce8\u89e3DisableApi\u7684\u5207\u9762\n+ * @author guqing\n+ * @date 2020-02-14 14:08\n+ */\n+@Aspect\n+@Component\n+public class DisableApiAspect {\n+    @Value(\"${spring.profiles.active:prod}\")\n+    private String activeProfile;\n+\n+    @Pointcut(\"@annotation(run.halo.app.model.annotation.DisableApi)\")\n+    public void pointcut(){}\n+\n+    @Around(\"pointcut() && @annotation(disableApi)\")\n+    public Object around(ProceedingJoinPoint joinPoint,\n+                         DisableApi disableApi){\n+        Mode mode = disableApi.mode();\n+        System.out.println(activeProfile);\n+        System.out.println(mode.name());\n+        if(StringUtils.equalsIgnoreCase(mode.name(), activeProfile)) {\n+            return new BaseResponse<>(HttpStatus.FORBIDDEN.value(), \"\u7981\u6b62\u8bbf\u95ee\",null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMwODE5Mg=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjkwOTI3OnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwOTowMDowM1rOFpvjHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwOTowMDowM1rOFpvjHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMxNDk3NQ==", "bodyText": "\u5efa\u8bae\u7528 log \u8fdb\u884c\u6253\u5370\u65e5\u5fd7\uff0c\u5c3d\u53ef\u80fd\u4e0d\u8981\u4f7f\u7528 System.out\u3002", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379314975", "createdAt": "2020-02-14T09:00:03Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package run.halo.app.handler.aspect;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Pointcut;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Component;\n+import run.halo.app.Application;\n+import run.halo.app.model.annotation.DisableApi;\n+import run.halo.app.model.enums.Mode;\n+import run.halo.app.model.support.BaseResponse;\n+\n+/**\n+ * \u81ea\u5b9a\u4e49\u6ce8\u89e3DisableApi\u7684\u5207\u9762\n+ * @author guqing\n+ * @date 2020-02-14 14:08\n+ */\n+@Aspect\n+@Component\n+public class DisableApiAspect {\n+    @Value(\"${spring.profiles.active:prod}\")\n+    private String activeProfile;\n+\n+    @Pointcut(\"@annotation(run.halo.app.model.annotation.DisableApi)\")\n+    public void pointcut(){}\n+\n+    @Around(\"pointcut() && @annotation(disableApi)\")\n+    public Object around(ProceedingJoinPoint joinPoint,\n+                         DisableApi disableApi){\n+        Mode mode = disableApi.mode();\n+        System.out.println(activeProfile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0NjkxOTE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwOTowMzowNFrOFpvoyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwOToyODowMlrOFpwTZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMxNjQyNg==", "bodyText": "\u4e0d\u8981\u76f4\u63a5 printStackTrace()\uff0c\u7528  log.error \u66ff\u4ee3\u3002\u800c\u4e14\uff0c\u5982\u679c\u8fd9\u91cc\u5ffd\u7565\u4e86\u5f02\u5e38\uff0c\u90a3\u4e48\u5728 Filter \u540e\u9762\u5c31\u65e0\u6cd5\u6355\u6349\u5230\u5f02\u5e38\u4e86\uff0c\u5bfc\u81f4 Service\uff0cDao \u4e2d\u629b\u51fa\u7684\u5f02\u5e38\u90fd\u5c06\u5931\u6548\u3002", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379316426", "createdAt": "2020-02-14T09:03:04Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package run.halo.app.handler.aspect;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Pointcut;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Component;\n+import run.halo.app.Application;\n+import run.halo.app.model.annotation.DisableApi;\n+import run.halo.app.model.enums.Mode;\n+import run.halo.app.model.support.BaseResponse;\n+\n+/**\n+ * \u81ea\u5b9a\u4e49\u6ce8\u89e3DisableApi\u7684\u5207\u9762\n+ * @author guqing\n+ * @date 2020-02-14 14:08\n+ */\n+@Aspect\n+@Component\n+public class DisableApiAspect {\n+    @Value(\"${spring.profiles.active:prod}\")\n+    private String activeProfile;\n+\n+    @Pointcut(\"@annotation(run.halo.app.model.annotation.DisableApi)\")\n+    public void pointcut(){}\n+\n+    @Around(\"pointcut() && @annotation(disableApi)\")\n+    public Object around(ProceedingJoinPoint joinPoint,\n+                         DisableApi disableApi){\n+        Mode mode = disableApi.mode();\n+        System.out.println(activeProfile);\n+        System.out.println(mode.name());\n+        if(StringUtils.equalsIgnoreCase(mode.name(), activeProfile)) {\n+            return new BaseResponse<>(HttpStatus.FORBIDDEN.value(), \"\u7981\u6b62\u8bbf\u95ee\",null);\n+        }\n+        Object proceed = null;\n+        try {\n+            proceed = joinPoint.proceed();\n+        } catch (Throwable throwable) {\n+            throwable.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMyNzMzNA==", "bodyText": "\u597d\u7684", "url": "https://github.com/halo-dev/halo/pull/569#discussion_r379327334", "createdAt": "2020-02-14T09:28:02Z", "author": {"login": "guqing"}, "path": "src/main/java/run/halo/app/handler/aspect/DisableApiAspect.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package run.halo.app.handler.aspect;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.annotation.Pointcut;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.stereotype.Component;\n+import run.halo.app.Application;\n+import run.halo.app.model.annotation.DisableApi;\n+import run.halo.app.model.enums.Mode;\n+import run.halo.app.model.support.BaseResponse;\n+\n+/**\n+ * \u81ea\u5b9a\u4e49\u6ce8\u89e3DisableApi\u7684\u5207\u9762\n+ * @author guqing\n+ * @date 2020-02-14 14:08\n+ */\n+@Aspect\n+@Component\n+public class DisableApiAspect {\n+    @Value(\"${spring.profiles.active:prod}\")\n+    private String activeProfile;\n+\n+    @Pointcut(\"@annotation(run.halo.app.model.annotation.DisableApi)\")\n+    public void pointcut(){}\n+\n+    @Around(\"pointcut() && @annotation(disableApi)\")\n+    public Object around(ProceedingJoinPoint joinPoint,\n+                         DisableApi disableApi){\n+        Mode mode = disableApi.mode();\n+        System.out.println(activeProfile);\n+        System.out.println(mode.name());\n+        if(StringUtils.equalsIgnoreCase(mode.name(), activeProfile)) {\n+            return new BaseResponse<>(HttpStatus.FORBIDDEN.value(), \"\u7981\u6b62\u8bbf\u95ee\",null);\n+        }\n+        Object proceed = null;\n+        try {\n+            proceed = joinPoint.proceed();\n+        } catch (Throwable throwable) {\n+            throwable.printStackTrace();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMxNjQyNg=="}, "originalCommit": {"oid": "7933bc172058aee53ada61f23b5e8a93da848e13"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2070, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}