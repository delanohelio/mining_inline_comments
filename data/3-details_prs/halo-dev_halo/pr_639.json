{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NjU3NjQ2", "number": 639, "title": "optimize FileHandler's logic", "bodyText": "Optimize FileHandler's logic to  improve performance", "createdAt": "2020-03-13T08:42:27Z", "url": "https://github.com/halo-dev/halo/pull/639", "merged": true, "mergeCommit": {"oid": "1d020ff550cf9dd760e433aa4381f7b0f20feec5"}, "closed": true, "closedAt": "2020-03-14T02:05:53Z", "author": {"login": "bestsort"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNMLGcgH2gAyMzg3NjU3NjQ2Ojc1MDhiZmRjZGU5N2I4YzgzZDdiN2ZmNWU4ZWMwZGFmNjJmNGRjYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNbJ4wAFqTM3NDY4OTEzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7508bfdcde97b8c83d7b7ff5e8ec0daf62f4dcc4", "author": {"user": {"login": "bestsort", "name": "bestsort"}}, "url": "https://github.com/halo-dev/halo/commit/7508bfdcde97b8c83d7b7ff5e8ec0daf62f4dcc4", "committedDate": "2020-03-13T08:38:05Z", "message": "optimize FileHandler's logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MTMzMzgz", "url": "https://github.com/halo-dev/halo/pull/639#pullrequestreview-374133383", "createdAt": "2020-03-13T08:54:12Z", "commit": {"oid": "7508bfdcde97b8c83d7b7ff5e8ec0daf62f4dcc4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwODo1NDoxMlrOF171Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwODo1NTowMFrOF172rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA5OTE2Nw==", "bodyText": "\u5982\u679c\u6709\u591a\u4e2a FileHandler \u652f\u6301\u7684 AttachmentType \u4f1a\u88ab\u76f4\u63a5\u8986\u76d6\u6389\uff0c\u662f\u5426\u9700\u8981\u629b\u5f02\u5e38\u6216\u8005\u7ed9\u51fa\u65e5\u5fd7\uff1f", "url": "https://github.com/halo-dev/halo/pull/639#discussion_r392099167", "createdAt": "2020-03-13T08:54:12Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/handler/file/FileHandlers.java", "diffHunk": "@@ -112,8 +72,18 @@ public void delete(@Nullable String type, @NonNull String key) {\n     @NonNull\n     public FileHandlers addFileHandlers(@Nullable Collection<FileHandler> fileHandlers) {\n         if (!CollectionUtils.isEmpty(fileHandlers)) {\n-            this.fileHandlers.addAll(fileHandlers);\n+            for (FileHandler handler : fileHandlers){\n+                this.fileHandlers.put(handler.getAttachmentType(), handler);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7508bfdcde97b8c83d7b7ff5e8ec0daf62f4dcc4"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA5OTUwMw==", "bodyText": "\u8003\u8651\u5230\u591a\u7ebf\u7a0b\u8bbf\u95ee\u6b64\u7c7b\uff0c\u662f\u5426\u8003\u8651\u7528 ConcurrentHashMap \u5462\uff1f", "url": "https://github.com/halo-dev/halo/pull/639#discussion_r392099503", "createdAt": "2020-03-13T08:55:00Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/handler/file/FileHandlers.java", "diffHunk": "@@ -29,7 +29,7 @@\n     /**\n      * File handler container.\n      */\n-    private final Collection<FileHandler> fileHandlers = new LinkedList<>();\n+    private final HashMap<AttachmentType, FileHandler> fileHandlers = new HashMap<>(16);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7508bfdcde97b8c83d7b7ff5e8ec0daf62f4dcc4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c82c091ea49d19c14fd2cf8c72884575ff8d12c0", "author": {"user": {"login": "bestsort", "name": "bestsort"}}, "url": "https://github.com/halo-dev/halo/commit/c82c091ea49d19c14fd2cf8c72884575ff8d12c0", "committedDate": "2020-03-13T09:24:53Z", "message": "fix code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a09cae234ef0132b9c175e361695f7bd0e87299e", "author": {"user": {"login": "bestsort", "name": "bestsort"}}, "url": "https://github.com/halo-dev/halo/commit/a09cae234ef0132b9c175e361695f7bd0e87299e", "committedDate": "2020-03-13T12:55:13Z", "message": "fix: maybe happen OOM when file upload, see #529"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDIxNTI3", "url": "https://github.com/halo-dev/halo/pull/639#pullrequestreview-374421527", "createdAt": "2020-03-13T16:01:56Z", "commit": {"oid": "a09cae234ef0132b9c175e361695f7bd0e87299e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a80bfa2c2a85a7e24d692be87a43a5ead95aa67", "author": {"user": {"login": "bestsort", "name": "bestsort"}}, "url": "https://github.com/halo-dev/halo/commit/9a80bfa2c2a85a7e24d692be87a43a5ead95aa67", "committedDate": "2020-03-14T00:04:27Z", "message": "refactor: HashMap -> ConcurrentHashMap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "209389446f3dc981bc5aabfcd328a115d8e9cd7a", "author": {"user": {"login": "bestsort", "name": "bestsort"}}, "url": "https://github.com/halo-dev/halo/commit/209389446f3dc981bc5aabfcd328a115d8e9cd7a", "committedDate": "2020-03-14T00:09:14Z", "message": "remove unused class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Njg5MTM5", "url": "https://github.com/halo-dev/halo/pull/639#pullrequestreview-374689139", "createdAt": "2020-03-14T02:05:20Z", "commit": {"oid": "209389446f3dc981bc5aabfcd328a115d8e9cd7a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4241, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}