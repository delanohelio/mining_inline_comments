{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNDY3NjIw", "number": 563, "title": "Feature/custom url", "bodyText": "\u4f60\u4eec\u8fb9\u770b\uff0c\u6211\u8fb9\u5199\u3002\n\u76ee\u524d\u81ea\u5b9a\u4e49 url \u4e2d\u7684\u751f\u6210 fullPath \u90e8\u5206\u5df2\u7ecf\u57fa\u672c\u5b8c\u6210\uff0c\u53ef\u80fd\u8fd8\u6709\u90e8\u5206\u672a\u8003\u8651\u7684\u5230\u7684\u60c5\u51b5\u3002\nhalo-admin \u5173\u4e8e\u6587\u7ae0\u548c\u81ea\u5b9a\u4e49\u9875\u9762\u7684 fullPath \u5df2\u7ecf\u505a\u4e86\u4fee\u6539\uff0chalo-dev/halo-admin@79325ac", "createdAt": "2020-02-11T04:24:52Z", "url": "https://github.com/halo-dev/halo/pull/563", "merged": true, "mergeCommit": {"oid": "c224b68fbcf1d3996154c4af9b9abf61b27ebbdb"}, "closed": true, "closedAt": "2020-02-24T15:42:55Z", "author": {"login": "ruibaby"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDAlxrgH2gAyMzczNDY3NjIwOjU4ZjM2NWRkZGJkODVkZThmNTM3MjRkMDYzODhlMjNkMmExMmZhMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHfb4oAH2gAyMzczNDY3NjIwOmE3NDUwMTFiNWY5ZTRhODA5ZmQwOGExZWYyYTQ4MzU3NzAwMmM5MTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58f365dddbd85de8f53724d06388e23d2a12fa02", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/58f365dddbd85de8f53724d06388e23d2a12fa02", "committedDate": "2020-02-10T17:29:07Z", "message": "feat: build full path for category and tag."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df3a4d6348eb6751c1c198b0f9f430c39bd1f0a3", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/df3a4d6348eb6751c1c198b0f9f430c39bd1f0a3", "committedDate": "2020-02-10T18:00:03Z", "message": "feat: build full path for post."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1a430cc2e50cc6477e8b447b81c3e512ecb03e2", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/f1a430cc2e50cc6477e8b447b81c3e512ecb03e2", "committedDate": "2020-02-10T18:09:57Z", "message": "feat: build full path for sheet."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4da89205c563a19b896e06eb83e179682fcaa35", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/a4da89205c563a19b896e06eb83e179682fcaa35", "committedDate": "2020-02-11T04:18:05Z", "message": "feat: build full path for post."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9b9e0a1c33c6c889fe317c3fbbb7bab9b42915c", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/a9b9e0a1c33c6c889fe317c3fbbb7bab9b42915c", "committedDate": "2020-02-11T04:50:59Z", "message": "feat: change post url for rss sitemap pages."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NDEzNzQy", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-356413742", "createdAt": "2020-02-11T04:34:25Z", "commit": {"oid": "a4da89205c563a19b896e06eb83e179682fcaa35"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNDozNDoyNVrOFn9SPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNDozNDoyNVrOFn9SPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0Mjg3OA==", "bodyText": "\u8fd9\u4e2a\u62fc\u63a5\u7684\u90e8\u5206\u548ctag\u903b\u8f91\u5dee\u4e0d\u591a\u662f\u4e0d\u662f\u8003\u8651\u62bd\u53d6\u4e00\u4e0b", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r377442878", "createdAt": "2020-02-11T04:34:25Z", "author": {"login": "guqing"}, "path": "src/main/java/run/halo/app/service/impl/CategoryServiceImpl.java", "diffHunk": "@@ -188,7 +193,23 @@ public void removeCategoryAndPostCategoryBy(Integer categoryId) {\n     public CategoryDTO convertTo(Category category) {\n         Assert.notNull(category, \"Category must not be null\");\n \n-        return new CategoryDTO().convertFrom(category);\n+        CategoryDTO categoryDTO = new CategoryDTO().convertFrom(category);\n+\n+        StringBuilder fullPath = new StringBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4da89205c563a19b896e06eb83e179682fcaa35"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f0c7df0ee3a471f08bd0b560b35262ce1da936c", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/9f0c7df0ee3a471f08bd0b560b35262ce1da936c", "committedDate": "2020-02-11T05:53:04Z", "message": "feat: support set links/photos/journal page prefix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70ae56e5dcf1dd1b20fef58241d79ed33cd1c471", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/70ae56e5dcf1dd1b20fef58241d79ed33cd1c471", "committedDate": "2020-02-11T06:43:32Z", "message": "feat: support set internal sheet's title."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5c180ca33e8d1ccf2bbd450316f463e02273e61", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/d5c180ca33e8d1ccf2bbd450316f463e02273e61", "committedDate": "2020-02-11T07:04:21Z", "message": "refactor: build full path method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2f33d58268bde595b9bf3e7a0bd601c6dddda13", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/a2f33d58268bde595b9bf3e7a0bd601c6dddda13", "committedDate": "2020-02-11T12:48:31Z", "message": "refactor: archives post full path."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/65dd741ede1c73d8eeeca2bb5adcb332a58fa620", "committedDate": "2020-02-14T06:05:51Z", "message": "feat: support nextPageFullPath and prePageFullPath variable in pageable pages."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NzMwNjY2", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-358730666", "createdAt": "2020-02-14T06:15:47Z", "commit": {"oid": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwNjoxNTo0N1rOFpsiwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwNjoxNTo0N1rOFpsiwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2NTcyOQ==", "bodyText": "\u8fd9\u4e48\u591a if  else\uff0c\u5f97\u8003\u8651\u4f18\u5316\u4e00\u4e0b\u4e86\u3002", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r379265729", "createdAt": "2020-02-14T06:15:47Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/controller/content/ContentContentController.java", "diffHunk": "@@ -37,41 +34,56 @@\n \n     private final TagModel tagModel;\n \n+    private final JournalModel journalModel;\n+\n+    private final PhotoModel photoModel;\n+\n     private final OptionService optionService;\n \n     private final PostService postService;\n \n     private final SheetService sheetService;\n \n+    private final ThemeService themeService;\n+\n     public ContentContentController(PostModel postModel,\n                                     SheetModel sheetModel,\n                                     CategoryModel categoryModel,\n                                     TagModel tagModel,\n+                                    JournalModel journalModel,\n+                                    PhotoModel photoModel,\n                                     OptionService optionService,\n                                     PostService postService,\n-                                    SheetService sheetService) {\n+                                    SheetService sheetService,\n+                                    ThemeService themeService) {\n         this.postModel = postModel;\n         this.sheetModel = sheetModel;\n         this.categoryModel = categoryModel;\n         this.tagModel = tagModel;\n+        this.journalModel = journalModel;\n+        this.photoModel = photoModel;\n         this.optionService = optionService;\n         this.postService = postService;\n         this.sheetService = sheetService;\n+        this.themeService = themeService;\n     }\n \n     @GetMapping(\"{prefix}\")\n     public String content(@PathVariable(\"prefix\") String prefix,\n                           Model model) {\n-        String archivesPrefix = optionService.getByPropertyOrDefault(PermalinkProperties.ARCHIVES_PREFIX, String.class, PermalinkProperties.ARCHIVES_PREFIX.defaultValue());\n-        String categoriesPrefix = optionService.getByPropertyOrDefault(PermalinkProperties.CATEGORIES_PREFIX, String.class, PermalinkProperties.CATEGORIES_PREFIX.defaultValue());\n-        String tagsPrefix = optionService.getByPropertyOrDefault(PermalinkProperties.TAGS_PREFIX, String.class, PermalinkProperties.TAGS_PREFIX.defaultValue());\n-\n-        if (archivesPrefix.equals(prefix)) {\n+        if (optionService.getArchivesPrefix().equals(prefix)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NzM0Mzgz", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-358734383", "createdAt": "2020-02-14T06:30:05Z", "commit": {"oid": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NzM2MDk2", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-358736096", "createdAt": "2020-02-14T06:36:15Z", "commit": {"oid": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NzM2Mjkw", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-358736290", "createdAt": "2020-02-14T06:36:57Z", "commit": {"oid": "65dd741ede1c73d8eeeca2bb5adcb332a58fa620"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98a0592e7c28851dc1a8bbed1e7f3ccdfe7c824c", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/98a0592e7c28851dc1a8bbed1e7f3ccdfe7c824c", "committedDate": "2020-02-14T06:48:20Z", "message": "Update CommentEventListener.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NzQyMjA1", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-358742205", "createdAt": "2020-02-14T06:56:53Z", "commit": {"oid": "98a0592e7c28851dc1a8bbed1e7f3ccdfe7c824c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "470c96474ec81fc95ad319ffdfd0d9ce2a5bd5b7", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/470c96474ec81fc95ad319ffdfd0d9ce2a5bd5b7", "committedDate": "2020-02-15T09:10:11Z", "message": "feat: make rss formats more standard."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MzM2Mjk5", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-359336299", "createdAt": "2020-02-15T09:21:34Z", "commit": {"oid": "470c96474ec81fc95ad319ffdfd0d9ce2a5bd5b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MzM2NTMz", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-359336533", "createdAt": "2020-02-15T09:26:16Z", "commit": {"oid": "470c96474ec81fc95ad319ffdfd0d9ce2a5bd5b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e8593c2f78fb60c1928751723393cb0ad5871d8", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/7e8593c2f78fb60c1928751723393cb0ad5871d8", "committedDate": "2020-02-15T16:17:01Z", "message": "feat: add some useful freemarker variable."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MzUzMjYx", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-359353261", "createdAt": "2020-02-15T16:22:22Z", "commit": {"oid": "7e8593c2f78fb60c1928751723393cb0ad5871d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc1e9f63f5efdd448452aaeb904ebaadfb1263cc", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/fc1e9f63f5efdd448452aaeb904ebaadfb1263cc", "committedDate": "2020-02-16T05:01:02Z", "message": "feat: add some useful freemarker variable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea17f22d38f801901fbc676a58debd502d2b80f2", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/ea17f22d38f801901fbc676a58debd502d2b80f2", "committedDate": "2020-02-16T05:04:46Z", "message": "feat: add some useful freemarker variable."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MzgwNTY5", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-359380569", "createdAt": "2020-02-16T05:06:06Z", "commit": {"oid": "ea17f22d38f801901fbc676a58debd502d2b80f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f0cd86b97122e37d54f2a9a66561537a23c1984", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/7f0cd86b97122e37d54f2a9a66561537a23c1984", "committedDate": "2020-02-16T06:38:03Z", "message": "refactor: preview post and password post."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MzgzMzQ0", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-359383344", "createdAt": "2020-02-16T06:42:22Z", "commit": {"oid": "7f0cd86b97122e37d54f2a9a66561537a23c1984"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Mzg1OTQz", "url": "https://github.com/halo-dev/halo/pull/563#pullrequestreview-359385943", "createdAt": "2020-02-16T07:52:12Z", "commit": {"oid": "7f0cd86b97122e37d54f2a9a66561537a23c1984"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQwNzo1MjoxMlrOFqSNAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQwNzo1MjoxMlrOFqSNAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg4Mjc1Mw==", "bodyText": "\u8fd9\u91cc\u53ef\u4ee5\u8003\u8651\u7528 OneTimeTokenService \u6765\u4ee3\u66ff\u3002", "url": "https://github.com/halo-dev/halo/pull/563#discussion_r379882753", "createdAt": "2020-02-16T07:52:12Z", "author": {"login": "JohnNiang"}, "path": "src/main/java/run/halo/app/controller/content/ContentContentController.java", "diffHunk": "@@ -170,4 +181,38 @@ public String content(@PathVariable(\"year\") Integer year,\n             throw new NotFoundException(\"Not Found\");\n         }\n     }\n+\n+    @PostMapping(value = \"archives/{url:.*}/password\")\n+    @CacheLock(traceRequest = true, expired = 2)\n+    public String password(@PathVariable(\"url\") String url,\n+                           @RequestParam(value = \"password\") String password) throws UnsupportedEncodingException {\n+        Post post = postService.getBy(PostStatus.INTIMATE, url);\n+\n+        post.setUrl(URLEncoder.encode(post.getUrl(), StandardCharsets.UTF_8.name()));\n+\n+        BasePostMinimalDTO postMinimalDTO = postService.convertToMinimal(post);\n+\n+        StringBuilder redirectUrl = new StringBuilder();\n+\n+        if (!optionService.isEnabledAbsolutePath()) {\n+            redirectUrl.append(optionService.getBlogBaseUrl());\n+        }\n+\n+        redirectUrl.append(postMinimalDTO.getFullPath());\n+\n+        if (password.equals(post.getPassword())) {\n+            String token = IdUtil.simpleUUID();\n+            cacheStore.putAny(token, token, 10, TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f0cd86b97122e37d54f2a9a66561537a23c1984"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a745011b5f9e4a809fd08a1ef2a483577002c914", "author": {"user": {"login": "ruibaby", "name": "Ryan Wang"}}, "url": "https://github.com/halo-dev/halo/commit/a745011b5f9e4a809fd08a1ef2a483577002c914", "committedDate": "2020-02-24T15:41:04Z", "message": "Merge branch 'master' into feature/custom-url"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4220, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}