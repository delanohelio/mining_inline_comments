{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NDg0MDM3", "number": 745, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDoxNjo1MlrODt-VpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDoxNzoxOVrODt-Wdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTMzODYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/controller/admin/api/AdminController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDoxNjo1MlrOF_tYMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDoxNjo1MlrOF_tYMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM0ODA4Mw==", "bodyText": "\u8fd9\u4e2a\u63a5\u53e3\u9700\u8981\u5728 https://github.com/halo-dev/halo/blob/master/src/main/java/run/halo/app/security/filter/AdminAuthenticationFilter.java#L59 \u8fd9\u91cc\u5f00\u653e\u3002", "url": "https://github.com/halo-dev/halo/pull/745#discussion_r402348083", "createdAt": "2020-04-02T14:16:52Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/AdminController.java", "diffHunk": "@@ -46,11 +49,19 @@ public boolean isInstall() {\n         return optionService.getByPropertyOrDefault(PrimaryProperties.IS_INSTALLED, Boolean.class, false);\n     }\n \n+    @PostMapping(\"login/precheck\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d8c93a9fde6aaad47e78377787506d9c10778"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTM0MDcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDoxNzoxOVrOF_tZig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDoxNzoxOVrOF_tZig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM0ODQyNg==", "bodyText": "\u4e2d\u82f1\u6587\u95f4\u7528\u7a7a\u683c\u9694\u5f00\u3002", "url": "https://github.com/halo-dev/halo/pull/745#discussion_r402348426", "createdAt": "2020-04-02T14:17:19Z", "author": {"login": "ruibaby"}, "path": "src/main/java/run/halo/app/controller/admin/api/UserController.java", "diffHunk": "@@ -57,4 +66,42 @@ public UserDTO updateProfile(@RequestBody UserParam userParam, User user) {\n         userService.updatePassword(passwordParam.getOldPassword(), passwordParam.getNewPassword(), user.getId());\n         return BaseResponse.ok(\"\u5bc6\u7801\u4fee\u6539\u6210\u529f\");\n     }\n+\n+    @PutMapping(\"mfa/generate\")\n+    @ApiOperation(\"Generate Multi-Factor Auth qr image\")\n+    @DisableOnCondition\n+    public MultiFactorAuthVO generateMFAQrImage(@RequestBody MultiFactorAuthParam multiFactorAuthParam, User user) {\n+        if (MFAType.NONE == user.getMfaType()) {\n+            if (MFAType.TFA_TOTP == multiFactorAuthParam.getMfaType()) {\n+                String mfaKey = TwoFactorAuthUtils.generateTFAKey();\n+                String optAuthUrl = TwoFactorAuthUtils.generateOtpAuthUrl(user.getNickname(), mfaKey);\n+                String qrImageBase64 = \"data:image/png;base64,\" +\n+                        Base64.encode(QrCodeUtil.generatePng(optAuthUrl, 128, 128));\n+                return new MultiFactorAuthVO(qrImageBase64, optAuthUrl, mfaKey, MFAType.TFA_TOTP);\n+            } else {\n+                throw new BadRequestException(\"\u6682\u4e0d\u652f\u6301\u7684MFA\u8ba4\u8bc1\u7684\u65b9\u5f0f\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d8c93a9fde6aaad47e78377787506d9c10778"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2036, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}