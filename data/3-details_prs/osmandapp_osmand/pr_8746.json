{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MTI1MTQ3", "number": 8746, "title": "Drawer logo", "bodyText": "", "createdAt": "2020-04-01T17:15:02Z", "url": "https://github.com/osmandapp/OsmAnd/pull/8746", "merged": true, "mergeCommit": {"oid": "63ad9b11ba55f4973e148122b0d8768f6d8d2000"}, "closed": true, "closedAt": "2020-04-03T16:20:55Z", "author": {"login": "Chumva"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTZvMUgH2gAyMzk3MTI1MTQ3OjZlYzVkNTI2YTgxZGQ5NDYyMzQzOWZmOTlhYzVhNzZlMmUyM2I1NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUC0QFgH2gAyMzk3MTI1MTQ3OmZlYjZkMTFmZTA5OTNhYzE2NWNkMWYxNTZiZmZmMjk4ZmVjN2MyMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ec5d526a81dd94623439ff99ac5a76e2e23b557", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/6ec5d526a81dd94623439ff99ac5a76e2e23b557", "committedDate": "2020-04-01T15:49:49Z", "message": "Add branding profile logo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63e4716708eb6b1ec014dd36207d31f86a865437", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/63e4716708eb6b1ec014dd36207d31f86a865437", "committedDate": "2020-04-01T16:24:08Z", "message": "Add check for osf extension in folder name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50577f3f323dd06111ea297ef4536b64decb921d", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/50577f3f323dd06111ea297ef4536b64decb921d", "committedDate": "2020-04-01T16:46:02Z", "message": "Remove nav drawer footer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fac0833cc7691fcb715d3b3ae16588e5b73be26", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/2fac0833cc7691fcb715d3b3ae16588e5b73be26", "committedDate": "2020-04-03T11:02:17Z", "message": "Fix plugin dependent quick actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d65373647c4927b8f902e668a94c6b97358cb10", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/5d65373647c4927b8f902e668a94c6b97358cb10", "committedDate": "2020-04-03T12:23:57Z", "message": "Remove unnecessary changes and move formatWarnings to android utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "649f7e594b4b88e5d2173f1f1f5cf71e273d4aee", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/649f7e594b4b88e5d2173f1f1f5cf71e273d4aee", "committedDate": "2020-04-03T14:07:41Z", "message": "Add warnings to settings items"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/16a52a0b5dab9f0e202821ae37d399ca6078b7cc", "committedDate": "2020-04-03T14:10:36Z", "message": "Merge branch 'master' of https://github.com/osmandapp/Osmand into import_fixes\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzU1NTg5", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#pullrequestreview-387355589", "createdAt": "2020-04-03T15:23:37Z", "commit": {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyMzozN1rOGAaQTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyMzozN1rOGAaQTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4MzM0MA==", "bodyText": "No ignore should always be in logs", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#discussion_r403083340", "createdAt": "2020-04-03T15:23:37Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/OsmAndAppCustomization.java", "diffHunk": "@@ -227,18 +255,43 @@ public Bitmap getNavDrawerLogo() {\n \t}\n \n \tpublic boolean setNavDrawerLogo(String uri, @Nullable String packageName, @Nullable String intent) {\n+\t\tString connectedAppDirPath = IndexConstants.PLUGINS_DIR + packageName;\n+\t\tFile connectedAppDir = app.getAppPath(connectedAppDirPath);\n \t\tif (TextUtils.isEmpty(uri)) {\n-\t\t\tnavDrawerLogo = null;\n+\t\t\tapp.getSettings().NAV_DRAWER_LOGO.resetToDefault();\n+\t\t\tAlgorithms.removeAllFiles(connectedAppDir);\n \t\t} else {\n \t\t\ttry {\n-\t\t\t\tInputStream is = app.getContentResolver().openInputStream(Uri.parse(uri));\n+\t\t\t\tUri fileUri = Uri.parse(uri);\n+\t\t\t\tInputStream is = app.getContentResolver().openInputStream(fileUri);\n \t\t\t\tif (is != null) {\n-\t\t\t\t\tnavDrawerLogo = BitmapFactory.decodeStream(is);\n-\t\t\t\t\tis.close();\n-\n+\t\t\t\t\tString iconName = ImportHelper.getNameFromContentUri(app, fileUri);\n+\t\t\t\t\tif (!connectedAppDir.exists()) {\n+\t\t\t\t\t\tconnectedAppDir.mkdirs();\n+\t\t\t\t\t}\n+\t\t\t\t\tOutputStream fout = new FileOutputStream(new File(connectedAppDir, iconName));\n+\t\t\t\t\ttry {\n+\t\t\t\t\t\tAlgorithms.streamCopy(is, fout);\n+\t\t\t\t\t} finally {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tis.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tfout.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t\tJSONObject json = new JSONObject();\n+\t\t\t\t\tjson.put(\"\", connectedAppDirPath + \"/\" + iconName);\n+\t\t\t\t\tapp.getSettings().NAV_DRAWER_LOGO.set(json.toString());\n \t\t\t\t}\n \t\t\t} catch (FileNotFoundException e) {\n \t\t\t\treturn false;\n+\t\t\t} catch (JSONException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzU1Njg4", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#pullrequestreview-387355688", "createdAt": "2020-04-03T15:23:43Z", "commit": {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyMzo0NFrOGAaQmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyMzo0NFrOGAaQmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4MzQxNg==", "bodyText": "Use logging system", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#discussion_r403083416", "createdAt": "2020-04-03T15:23:44Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/OsmAndAppCustomization.java", "diffHunk": "@@ -227,18 +255,43 @@ public Bitmap getNavDrawerLogo() {\n \t}\n \n \tpublic boolean setNavDrawerLogo(String uri, @Nullable String packageName, @Nullable String intent) {\n+\t\tString connectedAppDirPath = IndexConstants.PLUGINS_DIR + packageName;\n+\t\tFile connectedAppDir = app.getAppPath(connectedAppDirPath);\n \t\tif (TextUtils.isEmpty(uri)) {\n-\t\t\tnavDrawerLogo = null;\n+\t\t\tapp.getSettings().NAV_DRAWER_LOGO.resetToDefault();\n+\t\t\tAlgorithms.removeAllFiles(connectedAppDir);\n \t\t} else {\n \t\t\ttry {\n-\t\t\t\tInputStream is = app.getContentResolver().openInputStream(Uri.parse(uri));\n+\t\t\t\tUri fileUri = Uri.parse(uri);\n+\t\t\t\tInputStream is = app.getContentResolver().openInputStream(fileUri);\n \t\t\t\tif (is != null) {\n-\t\t\t\t\tnavDrawerLogo = BitmapFactory.decodeStream(is);\n-\t\t\t\t\tis.close();\n-\n+\t\t\t\t\tString iconName = ImportHelper.getNameFromContentUri(app, fileUri);\n+\t\t\t\t\tif (!connectedAppDir.exists()) {\n+\t\t\t\t\t\tconnectedAppDir.mkdirs();\n+\t\t\t\t\t}\n+\t\t\t\t\tOutputStream fout = new FileOutputStream(new File(connectedAppDir, iconName));\n+\t\t\t\t\ttry {\n+\t\t\t\t\t\tAlgorithms.streamCopy(is, fout);\n+\t\t\t\t\t} finally {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tis.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tfout.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzU2MTM0", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#pullrequestreview-387356134", "createdAt": "2020-04-03T15:24:13Z", "commit": {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyNDoxM1rOGAaR9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToyNDoxM1rOGAaR9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4Mzc2NA==", "bodyText": "ArrayList -> List", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#discussion_r403083764", "createdAt": "2020-04-03T15:24:13Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/osmedit/OsmEditingPlugin.java", "diffHunk": "@@ -139,10 +140,12 @@ public OsmBugsDbHelper getDBBug() {\n //\tprivate EditingPOIDialogProvider poiActions;\n \n \t@Override\n-\tprotected void registerQuickActionTypes(List<QuickActionType> quickActionTypes) {\n+\tprotected List<QuickActionType> getQuickActionTypes() {\n+\t\tArrayList<QuickActionType> quickActionTypes = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6438de2c82b126307f481791ddf2bbc8cf78d597", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/6438de2c82b126307f481791ddf2bbc8cf78d597", "committedDate": "2020-04-03T15:33:19Z", "message": "Add logs to nav drawer logo loading"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ddf71193682787f78e0f06bbf0393f81292be3", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/32ddf71193682787f78e0f06bbf0393f81292be3", "committedDate": "2020-04-03T15:39:19Z", "message": "Remove explicit list type from quickActionTypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb6d11fe0993ac165cd1f156bfff298fec7c201", "author": {"user": {"login": "Chumva", "name": "Vitaliy"}}, "url": "https://github.com/osmandapp/OsmAnd/commit/feb6d11fe0993ac165cd1f156bfff298fec7c201", "committedDate": "2020-04-03T15:41:27Z", "message": "Add missing log"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3544, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}