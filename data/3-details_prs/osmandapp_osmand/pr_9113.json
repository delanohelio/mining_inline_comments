{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1ODc2MjY0", "number": 9113, "title": "Change Wikipedia poi behaviour", "bodyText": "", "createdAt": "2020-06-01T10:00:57Z", "url": "https://github.com/osmandapp/OsmAnd/pull/9113", "merged": true, "mergeCommit": {"oid": "0172445571bffdc7896fcd37b33091a6cb7dd2a0"}, "closed": true, "closedAt": "2020-06-02T14:13:40Z", "author": {"login": "nazar-kutz"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcm9S3OgH2gAyNDI1ODc2MjY0OjA1ZWI0ZDcwMWM3NmUxN2UxMWMyNTM5NzY4OTk5ZGNmMzUyOWMyNWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnBMUEgH2gAyNDI1ODc2MjY0Ojc0YTQxZWI1MjUxZGZiNGM5NTZhZjMxNjI3N2FlYWFjYzUzOTU2ZDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05eb4d701c76e17e11c2539768999dcf3529c25e", "author": {"user": null}, "url": "https://github.com/osmandapp/OsmAnd/commit/05eb4d701c76e17e11c2539768999dcf3529c25e", "committedDate": "2020-06-01T10:00:01Z", "message": "Change Wikipedia poi behaviour"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzgxNjA0", "url": "https://github.com/osmandapp/OsmAnd/pull/9113#pullrequestreview-421781604", "createdAt": "2020-06-01T11:45:26Z", "commit": {"oid": "05eb4d701c76e17e11c2539768999dcf3529c25e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMTo0NToyNlrOGdHsgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMTo0NToyNlrOGdHsgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4Nzk2OQ==", "bodyText": "?", "url": "https://github.com/osmandapp/OsmAnd/pull/9113#discussion_r433187969", "createdAt": "2020-06-01T11:45:26Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/poi/PoiFiltersHelper.java", "diffHunk": "@@ -55,10 +55,10 @@\n \tprivate PoiUIFilter customPOIFilter;\n \tprivate PoiUIFilter showAllPOIFilter;\n \tprivate PoiUIFilter localWikiPoiFilter;\n-\tprivate PoiUIFilter globalWikiPoiFilter;\n+\tprivate PoiUIFilter topWikiPoiFilter;\n \tprivate List<PoiUIFilter> cacheTopStandardFilters;\n-\tprivate List<PoiUIFilter> cacheWikipediaFilters;\n-\tprivate Map<PoiTemplateList, Set<PoiUIFilter>> selectedPoiFilters = new TreeMap<>();\n+\tprivate Set<PoiUIFilter> selectedPoiFilters = new TreeSet<>();\n+\tprivate boolean updatePoiFiltersOnMap;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05eb4d701c76e17e11c2539768999dcf3529c25e"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzgyMDU3", "url": "https://github.com/osmandapp/OsmAnd/pull/9113#pullrequestreview-421782057", "createdAt": "2020-06-01T11:46:26Z", "commit": {"oid": "05eb4d701c76e17e11c2539768999dcf3529c25e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMTo0NjoyNlrOGdHuLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMTo0NjoyNlrOGdHuLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4ODM5OA==", "bodyText": "is this correct method?", "url": "https://github.com/osmandapp/OsmAnd/pull/9113#discussion_r433188398", "createdAt": "2020-06-01T11:46:26Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/poi/PoiFiltersHelper.java", "diffHunk": "@@ -139,56 +135,42 @@ public PoiUIFilter getLocalWikiPOIFilter() {\n \t\treturn localWikiPoiFilter;\n \t}\n \n-\tpublic PoiUIFilter getGlobalWikiPoiFilter() {\n-\t\tif (globalWikiPoiFilter == null) {\n-\t\t\tString wikiFilterId = PoiUIFilter.STD_PREFIX + \"osmwiki\";\n-\t\t\tfor (PoiUIFilter filter : getTopDefinedPoiFilters()) {\n-\t\t\t\tif (wikiFilterId.equals(filter.getFilterId())) {\n-\t\t\t\t\tglobalWikiPoiFilter = filter;\n-\t\t\t\t\tbreak;\n+\tpublic void prepareTopWikiFilter(@NonNull PoiUIFilter wiki) {\n+\t\tboolean prepareByDefault = true;\n+\t\tBundle wikiSettings = WikipediaPoiMenu.getWikiPoiSettings(application);\n+\t\tif (wikiSettings != null) {\n+\t\t\tboolean allLanguages = wikiSettings.getBoolean(GLOBAL_WIKI_POI_ENABLED_KEY);\n+\t\t\tList<String> languages = wikiSettings\n+\t\t\t\t\t.getStringArrayList(ENABLED_WIKI_POI_LANGUAGES_KEY);\n+\t\t\tif (!allLanguages && languages != null) {\n+\t\t\t\tprepareByDefault = false;\n+\t\t\t\tString wikiLang = \"wiki:lang:\";\n+\t\t\t\tStringBuilder sb = new StringBuilder();\n+\t\t\t\tfor (String lang : languages) {\n+\t\t\t\t\tif (sb.length() > 1) {\n+\t\t\t\t\t\tsb.append(\" \");\n+\t\t\t\t\t}\n+\t\t\t\t\tsb.append(wikiLang).append(lang);\n \t\t\t\t}\n+\t\t\t\twiki.setFilterByName(sb.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05eb4d701c76e17e11c2539768999dcf3529c25e"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1228dc82f37fec75298085cb39842240dde438d", "author": {"user": null}, "url": "https://github.com/osmandapp/OsmAnd/commit/c1228dc82f37fec75298085cb39842240dde438d", "committedDate": "2020-06-01T14:25:22Z", "message": "wikipedia poi fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74a41eb5251dfb4c956af316277aeaacc53956d6", "author": {"user": null}, "url": "https://github.com/osmandapp/OsmAnd/commit/74a41eb5251dfb4c956af316277aeaacc53956d6", "committedDate": "2020-06-01T14:32:29Z", "message": "small fixes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3516, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}