{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MTYwMjUz", "number": 10369, "title": "travel obf resource manager reader added", "bodyText": "", "createdAt": "2020-12-09T12:56:31Z", "url": "https://github.com/osmandapp/OsmAnd/pull/10369", "merged": true, "mergeCommit": {"oid": "7538d5bea12ec399b0398c0c6799805fadcfe8bd"}, "closed": true, "closedAt": "2020-12-15T15:26:17Z", "author": {"login": "angry010101"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkeSPVgH2gAyNTM1MTYwMjUzOjE2YWU3YjI4YzE2OTljY2RlY2ZiYTFkOTI4M2JmYTNhNjNmZjJmOTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmcBexgH2gAyNTM1MTYwMjUzOjQ2YzcwODY1NDQ3Yjg1ZTY0MjM2YWY1MmNkMDgzNDY0NmRkOGZiZWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16ae7b28c1699ccdecfba1d9283bfa3a63ff2f91", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/16ae7b28c1699ccdecfba1d9283bfa3a63ff2f91", "committedDate": "2020-12-09T12:55:35Z", "message": "travel obf resource manager reader added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6babf25c399fac50d560ed87a5a501519df1c0bb", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/6babf25c399fac50d560ed87a5a501519df1c0bb", "committedDate": "2020-12-09T13:30:45Z", "message": "cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MjIwMDE4", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-548220018", "createdAt": "2020-12-09T14:10:54Z", "commit": {"oid": "6babf25c399fac50d560ed87a5a501519df1c0bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDoxMDo1NFrOICWh0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDoxMDo1NFrOICWh0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMzNzE2OQ==", "bodyText": "wiki? I thought it should be \"travel\"", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r539337169", "createdAt": "2020-12-09T14:10:54Z", "author": {"login": "MadWasp79"}, "path": "OsmAnd/src/net/osmand/plus/resources/ResourceManager.java", "diffHunk": "@@ -1132,12 +1134,29 @@ public synchronized void close(){\n \t\treturn readers.toArray(new BinaryMapIndexReader[0]);\n \t}\n \n+\tpublic BinaryMapIndexReader[] getTravelFiles() {\n+\t\tCollection<BinaryMapReaderResource> fileReaders = getFileReaders();\n+\t\tList<BinaryMapIndexReader> readers = new ArrayList<>(fileReaders.size());\n+\t\tfor (BinaryMapReaderResource res : fileReaders) {\n+\t\t\tif (!res.filename.toString().toLowerCase().contains(\"wiki\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6babf25c399fac50d560ed87a5a501519df1c0bb"}, "originalPosition": 612}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f31ad60d471870a66b70f90a1f4c8224dd29bf32", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/f31ad60d471870a66b70f90a1f4c8224dd29bf32", "committedDate": "2020-12-09T14:29:59Z", "message": "travel constant fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aac3e5fd89002c27169a5b819a391542c7ac5d7", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/2aac3e5fd89002c27169a5b819a391542c7ac5d7", "committedDate": "2020-12-09T15:15:48Z", "message": "formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzEwODgz", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-548310883", "createdAt": "2020-12-09T15:36:26Z", "commit": {"oid": "2aac3e5fd89002c27169a5b819a391542c7ac5d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTozNjoyNlrOICa9XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTozNjoyNlrOICa9XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQwOTc1Ng==", "bodyText": "IndexConstants for constants", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r539409756", "createdAt": "2020-12-09T15:36:26Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/resources/ResourceManager.java", "diffHunk": "@@ -1132,6 +1134,24 @@ public synchronized void close(){\n \t\treturn readers.toArray(new BinaryMapIndexReader[0]);\n \t}\n \n+\tpublic BinaryMapIndexReader[] getTravelFiles() {\n+\t\tCollection<BinaryMapReaderResource> fileReaders = getFileReaders();\n+\t\tList<BinaryMapIndexReader> readers = new ArrayList<>(fileReaders.size());\n+\t\tfor (BinaryMapReaderResource res : fileReaders) {\n+\t\t\tif (!res.filename.toString().toLowerCase().contains(\"travel.obf\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aac3e5fd89002c27169a5b819a391542c7ac5d7"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzEyMTUw", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-548312150", "createdAt": "2020-12-09T15:37:37Z", "commit": {"oid": "2aac3e5fd89002c27169a5b819a391542c7ac5d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTozNzozN1rOICbBRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTozNzozN1rOICbBRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQxMDc1OQ==", "bodyText": "@alex-osm why is it needed", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r539410759", "createdAt": "2020-12-09T15:37:37Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/resources/ResourceManager.java", "diffHunk": "@@ -1132,6 +1134,24 @@ public synchronized void close(){\n \t\treturn readers.toArray(new BinaryMapIndexReader[0]);\n \t}\n \n+\tpublic BinaryMapIndexReader[] getTravelFiles() {\n+\t\tCollection<BinaryMapReaderResource> fileReaders = getFileReaders();\n+\t\tList<BinaryMapIndexReader> readers = new ArrayList<>(fileReaders.size());\n+\t\tfor (BinaryMapReaderResource res : fileReaders) {\n+\t\t\tif (!res.filename.toString().toLowerCase().contains(\"travel.obf\")) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tBinaryMapIndexReader index = res.getReader(BinaryMapReaderResourceType.POI);\n+\t\t\tfor (BinaryIndexPart p : index.getIndexes()) {\n+\t\t\t\tif (p instanceof BinaryMapPoiReaderAdapter.PoiRegion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aac3e5fd89002c27169a5b819a391542c7ac5d7"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2231387ca63057103b070de659f293fcf273c0cb", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/2231387ca63057103b070de659f293fcf273c0cb", "committedDate": "2020-12-10T13:24:10Z", "message": "cnflt resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dba3c4c62d1e78a3230a0569be8f137786634f4", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/1dba3c4c62d1e78a3230a0569be8f137786634f4", "committedDate": "2020-12-10T13:40:44Z", "message": "Merge branch 'master' of https://github.com/osmandapp/OsmAnd into issue_336_wikiwoyage_bigfix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11aeaef2c5a2e80c734c20f62dce28d1765ddda5", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/11aeaef2c5a2e80c734c20f62dce28d1765ddda5", "committedDate": "2020-12-10T14:42:09Z", "message": "starting obf helper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "621a18f1e49be5c5e408630a2614bee387618c1d", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/621a18f1e49be5c5e408630a2614bee387618c1d", "committedDate": "2020-12-15T08:53:46Z", "message": "resourse manager travel repositories aded"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ecaacbe8c7af2e9b14104221ae143037e70f85", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/a1ecaacbe8c7af2e9b14104221ae143037e70f85", "committedDate": "2020-12-15T08:58:07Z", "message": "formatting changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "203934cc1d94119313127a2d07bca3ed6018c165", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/203934cc1d94119313127a2d07bca3ed6018c165", "committedDate": "2020-12-15T09:26:42Z", "message": "travel reader added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7dddc3f23217b6460bf4586ad6131ec2564df0b", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/c7dddc3f23217b6460bf4586ad6131ec2564df0b", "committedDate": "2020-12-15T13:19:45Z", "message": "removed unused methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/29a57dc562c6004bd632537c0c9742a3e7b45e87", "committedDate": "2020-12-15T13:22:10Z", "message": "check db file exists added"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDYwMjIy", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-552460222", "createdAt": "2020-12-15T13:41:44Z", "commit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MTo0NFrOIGLb-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MTo0NFrOIGLb-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM0OTc1Mw==", "bodyText": "null", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r543349753", "createdAt": "2020-12-15T13:41:44Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/wikivoyage/data/TravelObfHelper.java", "diffHunk": "@@ -0,0 +1,189 @@\n+package net.osmand.plus.wikivoyage.data;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import net.osmand.CollatorStringMatcher;\n+import net.osmand.GPXUtilities;\n+import net.osmand.IndexConstants;\n+import net.osmand.PlatformUtil;\n+import net.osmand.ResultMatcher;\n+import net.osmand.binary.BinaryMapIndexReader;\n+import net.osmand.data.Amenity;\n+import net.osmand.data.MapObject;\n+import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.R;\n+import net.osmand.plus.api.SQLiteAPI;\n+import net.osmand.util.Algorithms;\n+\n+import org.apache.commons.logging.Log;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class TravelObfHelper implements TravelHelper {\n+\n+\tprivate static final Log LOG = PlatformUtil.getLog(TravelObfHelper.class);\n+\n+\tprivate static final int POPULAR_LIMIT = 25;\n+\n+\tprivate final OsmandApplication application;\n+\n+\tprivate TravelLocalDataHelper localDataHelper;\n+\n+\tprivate List<BinaryMapIndexReader> files;\n+\tprivate List<File> existingTravelBooks = new ArrayList<>();\n+\tprivate List<TravelArticle> popularArticles = new ArrayList<TravelArticle>();\n+\n+\n+\tpublic TravelObfHelper(OsmandApplication application) {\n+\t\tthis.application = application;\n+\t\tlocalDataHelper = new TravelLocalDataHelper(application);\n+\t}\n+\n+\tpublic TravelLocalDataHelper getBookmarksHelper() {\n+\t\treturn localDataHelper;\n+\t}\n+\n+\t@Override\n+\tpublic void initializeDataOnAppStartup() {\n+\n+\t}\n+\n+\t@Override\n+\tpublic boolean isAnyTravelBookPresent() {\n+\t\treturn checkIfObfFileExists(application);\n+\t}\n+\n+\n+\tpublic void initializeDataToDisplay() {\n+\t\tlocalDataHelper.refreshCachedData();\n+\t\tloadPopularArticles();\n+\t}\n+\n+\n+\t@NonNull\n+\tpublic List<WikivoyageSearchResult> search(final String searchQuery) {\n+\t\t// TODO remove\n+\t\t//this.files = application.getResourceManager().getTravelFiles();\n+\t\tList<WikivoyageSearchResult> res = new ArrayList<>();\n+//\t\tList<Amenity> searchObjects = new ArrayList<>();\n+//\t\tfor (BinaryMapIndexReader reader : files) {\n+//\t\t\ttry {\n+//\t\t\t\tBinaryMapIndexReader.SearchRequest<Amenity> searchRequest = BinaryMapIndexReader.\n+//\t\t\t\t\t\tbuildSearchPoiRequest(0, 0, searchQuery,\n+//\t\t\t\t\t\t\t\t0, Integer.MAX_VALUE, 0, Integer.MAX_VALUE, null);\n+//\n+//\t\t\t\tsearchObjects = reader.searchPoiByName(searchRequest);\n+//\t\t\t} catch (IOException e) {\n+//\t\t\t\tLOG.error(e);\n+//\t\t\t}\n+//\t\t}\n+//\t\tfor (MapObject obj : searchObjects) {\n+//\t\t\t//TODO map\n+//\t\t\tWikivoyageSearchResult r = new WikivoyageSearchResult();\n+//\t\t\tr.articleTitles = Collections.singletonList(obj.getName());\n+//\t\t\tr.langs = Collections.singletonList(obj.getName());\n+//\t\t\tr.imageTitle = (obj.getName());\n+//\t\t\tr.isPartOf = Collections.singletonList(obj.getName());\n+//\t\t\tr.routeId = \"routeid\";//obj.getId();\n+//\t\t\tres.add(r);\n+//\t\t}\n+\t\treturn res;\n+\t}\n+\n+\t@NonNull\n+\tpublic List<TravelArticle> getPopularArticles() {\n+\t\treturn popularArticles;\n+\t}\n+\n+\t@Override\n+\tpublic Map<WikivoyageSearchResult, List<WikivoyageSearchResult>> getNavigationMap(TravelArticle article) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic TravelArticle getArticleById(String routeId, String lang) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic TravelArticle getArticleByTitle(String title, String lang) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic String getArticleId(String title, String lang) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic ArrayList<String> getArticleLangs(String articleId) {\n+\t\treturn null;\n+\t}\n+\n+\t@NonNull\n+\tpublic List<TravelArticle> loadPopularArticles() {\n+\t\tpopularArticles = new ArrayList<>();\n+\t\treturn popularArticles;\n+\t}\n+\n+\tpublic String formatTravelBookName(File tb) {\n+\t\tif (tb == null) {\n+\t\t\treturn application.getString(R.string.shared_string_none);\n+\t\t}\n+\t\tString nm = tb.getName();\n+\t\treturn nm.substring(0, nm.indexOf('.')).replace('_', ' ');\n+\t}\n+\n+\tpublic String getGPXName(TravelArticle article) {\n+\t\treturn article.getTitle().replace('/', '_').replace('\\'', '_')\n+\t\t\t\t.replace('\\\"', '_') + IndexConstants.GPX_FILE_EXT;\n+\t}\n+\n+\tpublic File createGpxFile(TravelArticle article) {\n+\t\tfinal GPXUtilities.GPXFile gpx = article.getGpxFile();\n+\t\tFile file = application.getAppPath(IndexConstants.GPX_TRAVEL_DIR + getGPXName(article));\n+\t\tif (!file.exists()) {\n+\t\t\tGPXUtilities.writeGpxFile(file, gpx);\n+\t\t}\n+\t\treturn file;\n+\t}\n+\n+\t@Override\n+\tpublic String getSelectedTravelBookName() {\n+\t\t//TODO REPLACE\n+\t\treturn \"OBF TRAVEL BOOK\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "originalPosition": 160}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDYwNjM1", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-552460635", "createdAt": "2020-12-15T13:42:08Z", "commit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MjowOFrOIGLdSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MjowOFrOIGLdSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM1MDA4OA==", "bodyText": "Duplicate to checkIfObfFileExists", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r543350088", "createdAt": "2020-12-15T13:42:08Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/wikivoyage/data/TravelDbHelper.java", "diffHunk": "@@ -114,6 +114,18 @@ public TravelDbHelper(OsmandApplication application) {\n \t\tlocalDataHelper = new TravelLocalDataHelper(application);\n \t}\n \n+\tpublic static boolean checkIfDbFileExists(OsmandApplication app) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDYyMjMy", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-552462232", "createdAt": "2020-12-15T13:43:00Z", "commit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MzowMFrOIGLgBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MzowMFrOIGLgBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM1MDc5MQ==", "bodyText": "ResourceManager", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r543350791", "createdAt": "2020-12-15T13:43:00Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/wikivoyage/data/TravelObfHelper.java", "diffHunk": "@@ -0,0 +1,189 @@\n+package net.osmand.plus.wikivoyage.data;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import net.osmand.CollatorStringMatcher;\n+import net.osmand.GPXUtilities;\n+import net.osmand.IndexConstants;\n+import net.osmand.PlatformUtil;\n+import net.osmand.ResultMatcher;\n+import net.osmand.binary.BinaryMapIndexReader;\n+import net.osmand.data.Amenity;\n+import net.osmand.data.MapObject;\n+import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.R;\n+import net.osmand.plus.api.SQLiteAPI;\n+import net.osmand.util.Algorithms;\n+\n+import org.apache.commons.logging.Log;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class TravelObfHelper implements TravelHelper {\n+\n+\tprivate static final Log LOG = PlatformUtil.getLog(TravelObfHelper.class);\n+\n+\tprivate static final int POPULAR_LIMIT = 25;\n+\n+\tprivate final OsmandApplication application;\n+\n+\tprivate TravelLocalDataHelper localDataHelper;\n+\n+\tprivate List<BinaryMapIndexReader> files;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDYyNTg4", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-552462588", "createdAt": "2020-12-15T13:43:11Z", "commit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MzoxMVrOIGLgYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0MzoxMVrOIGLgYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM1MDg4MA==", "bodyText": "Why it is needed?", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r543350880", "createdAt": "2020-12-15T13:43:11Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/wikivoyage/data/TravelObfHelper.java", "diffHunk": "@@ -0,0 +1,189 @@\n+package net.osmand.plus.wikivoyage.data;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import net.osmand.CollatorStringMatcher;\n+import net.osmand.GPXUtilities;\n+import net.osmand.IndexConstants;\n+import net.osmand.PlatformUtil;\n+import net.osmand.ResultMatcher;\n+import net.osmand.binary.BinaryMapIndexReader;\n+import net.osmand.data.Amenity;\n+import net.osmand.data.MapObject;\n+import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.R;\n+import net.osmand.plus.api.SQLiteAPI;\n+import net.osmand.util.Algorithms;\n+\n+import org.apache.commons.logging.Log;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class TravelObfHelper implements TravelHelper {\n+\n+\tprivate static final Log LOG = PlatformUtil.getLog(TravelObfHelper.class);\n+\n+\tprivate static final int POPULAR_LIMIT = 25;\n+\n+\tprivate final OsmandApplication application;\n+\n+\tprivate TravelLocalDataHelper localDataHelper;\n+\n+\tprivate List<BinaryMapIndexReader> files;\n+\tprivate List<File> existingTravelBooks = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b439a4c80677172be9bfa3ad59227a7e219ae9a", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/2b439a4c80677172be9bfa3ad59227a7e219ae9a", "committedDate": "2020-12-15T13:45:23Z", "message": "update travelobfhelper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDY4MjI1", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#pullrequestreview-552468225", "createdAt": "2020-12-15T13:46:45Z", "commit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0Njo0NlrOIGLqmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzo0Njo0NlrOIGLqmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM1MzQ5Nw==", "bodyText": "Delete not used class", "url": "https://github.com/osmandapp/OsmAnd/pull/10369#discussion_r543353497", "createdAt": "2020-12-15T13:46:46Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/wikivoyage/data/TravelObfHelper.java", "diffHunk": "@@ -0,0 +1,189 @@\n+package net.osmand.plus.wikivoyage.data;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import net.osmand.CollatorStringMatcher;\n+import net.osmand.GPXUtilities;\n+import net.osmand.IndexConstants;\n+import net.osmand.PlatformUtil;\n+import net.osmand.ResultMatcher;\n+import net.osmand.binary.BinaryMapIndexReader;\n+import net.osmand.data.Amenity;\n+import net.osmand.data.MapObject;\n+import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.R;\n+import net.osmand.plus.api.SQLiteAPI;\n+import net.osmand.util.Algorithms;\n+\n+import org.apache.commons.logging.Log;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class TravelObfHelper implements TravelHelper {\n+\n+\tprivate static final Log LOG = PlatformUtil.getLog(TravelObfHelper.class);\n+\n+\tprivate static final int POPULAR_LIMIT = 25;\n+\n+\tprivate final OsmandApplication application;\n+\n+\tprivate TravelLocalDataHelper localDataHelper;\n+\n+\tprivate List<BinaryMapIndexReader> files;\n+\tprivate List<File> existingTravelBooks = new ArrayList<>();\n+\tprivate List<TravelArticle> popularArticles = new ArrayList<TravelArticle>();\n+\n+\n+\tpublic TravelObfHelper(OsmandApplication application) {\n+\t\tthis.application = application;\n+\t\tlocalDataHelper = new TravelLocalDataHelper(application);\n+\t}\n+\n+\tpublic TravelLocalDataHelper getBookmarksHelper() {\n+\t\treturn localDataHelper;\n+\t}\n+\n+\t@Override\n+\tpublic void initializeDataOnAppStartup() {\n+\n+\t}\n+\n+\t@Override\n+\tpublic boolean isAnyTravelBookPresent() {\n+\t\treturn checkIfObfFileExists(application);\n+\t}\n+\n+\n+\tpublic void initializeDataToDisplay() {\n+\t\tlocalDataHelper.refreshCachedData();\n+\t\tloadPopularArticles();\n+\t}\n+\n+\n+\t@NonNull\n+\tpublic List<WikivoyageSearchResult> search(final String searchQuery) {\n+\t\t// TODO remove\n+\t\t//this.files = application.getResourceManager().getTravelFiles();\n+\t\tList<WikivoyageSearchResult> res = new ArrayList<>();\n+//\t\tList<Amenity> searchObjects = new ArrayList<>();\n+//\t\tfor (BinaryMapIndexReader reader : files) {\n+//\t\t\ttry {\n+//\t\t\t\tBinaryMapIndexReader.SearchRequest<Amenity> searchRequest = BinaryMapIndexReader.\n+//\t\t\t\t\t\tbuildSearchPoiRequest(0, 0, searchQuery,\n+//\t\t\t\t\t\t\t\t0, Integer.MAX_VALUE, 0, Integer.MAX_VALUE, null);\n+//\n+//\t\t\t\tsearchObjects = reader.searchPoiByName(searchRequest);\n+//\t\t\t} catch (IOException e) {\n+//\t\t\t\tLOG.error(e);\n+//\t\t\t}\n+//\t\t}\n+//\t\tfor (MapObject obj : searchObjects) {\n+//\t\t\t//TODO map\n+//\t\t\tWikivoyageSearchResult r = new WikivoyageSearchResult();\n+//\t\t\tr.articleTitles = Collections.singletonList(obj.getName());\n+//\t\t\tr.langs = Collections.singletonList(obj.getName());\n+//\t\t\tr.imageTitle = (obj.getName());\n+//\t\t\tr.isPartOf = Collections.singletonList(obj.getName());\n+//\t\t\tr.routeId = \"routeid\";//obj.getId();\n+//\t\t\tres.add(r);\n+//\t\t}\n+\t\treturn res;\n+\t}\n+\n+\t@NonNull\n+\tpublic List<TravelArticle> getPopularArticles() {\n+\t\treturn popularArticles;\n+\t}\n+\n+\t@Override\n+\tpublic Map<WikivoyageSearchResult, List<WikivoyageSearchResult>> getNavigationMap(TravelArticle article) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic TravelArticle getArticleById(String routeId, String lang) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic TravelArticle getArticleByTitle(String title, String lang) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic String getArticleId(String title, String lang) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic ArrayList<String> getArticleLangs(String articleId) {\n+\t\treturn null;\n+\t}\n+\n+\t@NonNull\n+\tpublic List<TravelArticle> loadPopularArticles() {\n+\t\tpopularArticles = new ArrayList<>();\n+\t\treturn popularArticles;\n+\t}\n+\n+\tpublic String formatTravelBookName(File tb) {\n+\t\tif (tb == null) {\n+\t\t\treturn application.getString(R.string.shared_string_none);\n+\t\t}\n+\t\tString nm = tb.getName();\n+\t\treturn nm.substring(0, nm.indexOf('.')).replace('_', ' ');\n+\t}\n+\n+\tpublic String getGPXName(TravelArticle article) {\n+\t\treturn article.getTitle().replace('/', '_').replace('\\'', '_')\n+\t\t\t\t.replace('\\\"', '_') + IndexConstants.GPX_FILE_EXT;\n+\t}\n+\n+\tpublic File createGpxFile(TravelArticle article) {\n+\t\tfinal GPXUtilities.GPXFile gpx = article.getGpxFile();\n+\t\tFile file = application.getAppPath(IndexConstants.GPX_TRAVEL_DIR + getGPXName(article));\n+\t\tif (!file.exists()) {\n+\t\t\tGPXUtilities.writeGpxFile(file, gpx);\n+\t\t}\n+\t\treturn file;\n+\t}\n+\n+\t@Override\n+\tpublic String getSelectedTravelBookName() {\n+\t\t//TODO REPLACE\n+\t\treturn \"OBF TRAVEL BOOK\";\n+\t}\n+\n+\tpublic static boolean checkIfObfFileExists(OsmandApplication app) {\n+\t\tFile[] files = app.getAppPath(IndexConstants.WIKIVOYAGE_INDEX_DIR).listFiles();\n+\t\tif (files != null) {\n+\t\t\tfor (File f : files) {\n+\t\t\t\tif (f.getName().contains(IndexConstants.BINARY_TRAVEL_GUIDE_MAP_INDEX_EXT)) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\t// might use in future\n+\tprotected static class PopularArticle {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29a57dc562c6004bd632537c0c9742a3e7b45e87"}, "originalPosition": 176}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89ad77ba0248bbe57bd188879f13bd53f5b580c7", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/89ad77ba0248bbe57bd188879f13bd53f5b580c7", "committedDate": "2020-12-15T14:54:14Z", "message": "travel obf helper updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "358590cd6806172677f33ab15352d05e40fe6142", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/358590cd6806172677f33ab15352d05e40fe6142", "committedDate": "2020-12-15T15:12:25Z", "message": "small changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b5982e3e6ca3ca960849396d77d0db71424d141", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/9b5982e3e6ca3ca960849396d77d0db71424d141", "committedDate": "2020-12-15T15:23:44Z", "message": "index name updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46c70865447b85e64236af52cd0834646dd8fbeb", "author": {"user": {"login": "angry010101", "name": null}}, "url": "https://github.com/osmandapp/OsmAnd/commit/46c70865447b85e64236af52cd0834646dd8fbeb", "committedDate": "2020-12-15T15:25:19Z", "message": "index name updated"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3371, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}