{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNjQzMjYy", "number": 9569, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoxNTowN1rOEVbrkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0NDowN1rOEVcfIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTA5MDc0OnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/measurementtool/ProfileCard.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoxNTowN1rOG8LpfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoxNTowN1rOG8LpfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc1ODU4OA==", "bodyText": "initSelected > resetSelection", "url": "https://github.com/osmandapp/OsmAnd/pull/9569#discussion_r465758588", "createdAt": "2020-08-05T14:15:07Z", "author": {"login": "max-klaus"}, "path": "OsmAnd/src/net/osmand/plus/measurementtool/ProfileCard.java", "diffHunk": "@@ -0,0 +1,87 @@\n+package net.osmand.plus.measurementtool;\n+\n+import android.graphics.drawable.Drawable;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ImageView;\n+import android.widget.LinearLayout;\n+import android.widget.RadioButton;\n+import android.widget.TextView;\n+\n+import net.osmand.plus.R;\n+import net.osmand.plus.UiUtilities;\n+import net.osmand.plus.activities.MapActivity;\n+import net.osmand.plus.routepreparationmenu.cards.BaseCard;\n+import net.osmand.plus.settings.backend.ApplicationMode;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class ProfileCard extends BaseCard {\n+\n+\tpublic static final int INIT_MODE = 0;\n+\tApplicationMode selectedMode;\n+\n+\tpublic ProfileCard(MapActivity mapActivity) {\n+\t\tsuper(mapActivity);\n+\t}\n+\n+\tpublic ApplicationMode getSelectedMode() {\n+\t\treturn selectedMode;\n+\t}\n+\n+\t@Override\n+\tpublic int getCardLayoutId() {\n+\t\treturn R.layout.navigation_profiles_card;\n+\t}\n+\n+\t@Override\n+\tprotected void updateContent() {\n+\n+\t\tfinal List<ApplicationMode> modes = new ArrayList<>(ApplicationMode.values(app));\n+\t\tmodes.remove(ApplicationMode.DEFAULT);\n+\t\tfor (int i = 0; i < modes.size(); i++) {\n+\t\t\tApplicationMode mode = modes.get(i);\n+\t\t\tLinearLayout container = view.findViewById(R.id.content_container);\n+\t\t\tDrawable icon = app.getUIUtilities().getIcon(mode.getIconRes(), mode.getIconColorInfo().getColor(nightMode));\n+\t\t\tString title = mode.toHumanString();\n+\t\t\tView.OnClickListener onClickListener = new View.OnClickListener() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic void onClick(View v) {\n+\t\t\t\t\tRadioButton selectedProfile = v.findViewById(R.id.compound_button);\n+\t\t\t\t\tselectedMode = modes.get((Integer) v.getTag());\n+\t\t\t\t\tclearChecked();\n+\t\t\t\t\tselectedProfile.setChecked(true);\n+\t\t\t\t}\n+\n+\t\t\t\tprivate void clearChecked() {\n+\t\t\t\t\tfor (int i = 0; i < modes.size(); i++) {\n+\t\t\t\t\t\tRadioButton profile = view.findViewWithTag(i).findViewById(R.id.compound_button);\n+\t\t\t\t\t\tprofile.setChecked(false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t};\n+\t\t\taddProfileView(container, onClickListener, i, icon, title);\n+\t\t}\n+\t\tinitSelected(modes);\n+\t}\n+\n+\tprivate void initSelected(List<ApplicationMode> modes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b58751667a190c14ee72d641885454f94449280"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTA5MzU3OnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/measurementtool/ProfileCard.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoxNTo0OFrOG8LrcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoxNTo0OFrOG8LrcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc1OTA4OA==", "bodyText": "Drop INIT_MODE const", "url": "https://github.com/osmandapp/OsmAnd/pull/9569#discussion_r465759088", "createdAt": "2020-08-05T14:15:48Z", "author": {"login": "max-klaus"}, "path": "OsmAnd/src/net/osmand/plus/measurementtool/ProfileCard.java", "diffHunk": "@@ -0,0 +1,87 @@\n+package net.osmand.plus.measurementtool;\n+\n+import android.graphics.drawable.Drawable;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ImageView;\n+import android.widget.LinearLayout;\n+import android.widget.RadioButton;\n+import android.widget.TextView;\n+\n+import net.osmand.plus.R;\n+import net.osmand.plus.UiUtilities;\n+import net.osmand.plus.activities.MapActivity;\n+import net.osmand.plus.routepreparationmenu.cards.BaseCard;\n+import net.osmand.plus.settings.backend.ApplicationMode;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class ProfileCard extends BaseCard {\n+\n+\tpublic static final int INIT_MODE = 0;\n+\tApplicationMode selectedMode;\n+\n+\tpublic ProfileCard(MapActivity mapActivity) {\n+\t\tsuper(mapActivity);\n+\t}\n+\n+\tpublic ApplicationMode getSelectedMode() {\n+\t\treturn selectedMode;\n+\t}\n+\n+\t@Override\n+\tpublic int getCardLayoutId() {\n+\t\treturn R.layout.navigation_profiles_card;\n+\t}\n+\n+\t@Override\n+\tprotected void updateContent() {\n+\n+\t\tfinal List<ApplicationMode> modes = new ArrayList<>(ApplicationMode.values(app));\n+\t\tmodes.remove(ApplicationMode.DEFAULT);\n+\t\tfor (int i = 0; i < modes.size(); i++) {\n+\t\t\tApplicationMode mode = modes.get(i);\n+\t\t\tLinearLayout container = view.findViewById(R.id.content_container);\n+\t\t\tDrawable icon = app.getUIUtilities().getIcon(mode.getIconRes(), mode.getIconColorInfo().getColor(nightMode));\n+\t\t\tString title = mode.toHumanString();\n+\t\t\tView.OnClickListener onClickListener = new View.OnClickListener() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic void onClick(View v) {\n+\t\t\t\t\tRadioButton selectedProfile = v.findViewById(R.id.compound_button);\n+\t\t\t\t\tselectedMode = modes.get((Integer) v.getTag());\n+\t\t\t\t\tclearChecked();\n+\t\t\t\t\tselectedProfile.setChecked(true);\n+\t\t\t\t}\n+\n+\t\t\t\tprivate void clearChecked() {\n+\t\t\t\t\tfor (int i = 0; i < modes.size(); i++) {\n+\t\t\t\t\t\tRadioButton profile = view.findViewWithTag(i).findViewById(R.id.compound_button);\n+\t\t\t\t\t\tprofile.setChecked(false);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t};\n+\t\t\taddProfileView(container, onClickListener, i, icon, title);\n+\t\t}\n+\t\tinitSelected(modes);\n+\t}\n+\n+\tprivate void initSelected(List<ApplicationMode> modes) {\n+\t\tselectedMode = modes.get(INIT_MODE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b58751667a190c14ee72d641885454f94449280"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTA5OTk3OnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoxNzowOVrOG8Lvbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoxNzowOVrOG8Lvbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc2MDExMQ==", "bodyText": "Drop firstShow", "url": "https://github.com/osmandapp/OsmAnd/pull/9569#discussion_r465760111", "createdAt": "2020-08-05T14:17:09Z", "author": {"login": "max-klaus"}, "path": "OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java", "diffHunk": "@@ -123,6 +126,7 @@\n \tprivate boolean progressBarVisible;\n \tprivate boolean pointsListOpened;\n \tprivate boolean planRouteMode = false;\n+\tprivate boolean firstShow = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b58751667a190c14ee72d641885454f94449280"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTE1MjQ3OnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/measurementtool/RouteBetweenPointsBottomSheetDialogFragment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoyODoxMVrOG8MP_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoyODoxMVrOG8MP_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc2ODQ0Nw==", "bodyText": "Move to UiUtilities", "url": "https://github.com/osmandapp/OsmAnd/pull/9569#discussion_r465768447", "createdAt": "2020-08-05T14:28:11Z", "author": {"login": "max-klaus"}, "path": "OsmAnd/src/net/osmand/plus/measurementtool/RouteBetweenPointsBottomSheetDialogFragment.java", "diffHunk": "@@ -0,0 +1,253 @@\n+package net.osmand.plus.measurementtool;\n+\n+import android.app.Dialog;\n+import android.graphics.Color;\n+import android.graphics.drawable.Drawable;\n+import android.graphics.drawable.GradientDrawable;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.view.Window;\n+import android.view.WindowManager;\n+import android.widget.FrameLayout;\n+import android.widget.ImageView;\n+import android.widget.LinearLayout;\n+import android.widget.RadioButton;\n+import android.widget.TextView;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.content.ContextCompat;\n+import androidx.fragment.app.FragmentActivity;\n+import androidx.fragment.app.FragmentManager;\n+\n+import net.osmand.AndroidUtils;\n+import net.osmand.PlatformUtil;\n+import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.R;\n+import net.osmand.plus.UiUtilities;\n+import net.osmand.plus.base.BottomSheetDialogFragment;\n+import net.osmand.plus.helpers.AndroidUiHelper;\n+import net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType;\n+import net.osmand.plus.settings.backend.ApplicationMode;\n+\n+import org.apache.commons.logging.Log;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType.NEXT_SEGMENT;\n+import static net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType.WHOLE_TRACK;\n+\n+public class RouteBetweenPointsBottomSheetDialogFragment extends BottomSheetDialogFragment {\n+\n+\tprivate static final Log LOG = PlatformUtil.getLog(RouteBetweenPointsBottomSheetDialogFragment.class);\n+\tpublic static final String TAG = RouteBetweenPointsBottomSheetDialogFragment.class.getSimpleName();\n+\tpublic static final int STRAIGHT_LINE_TAG = -1;\n+\n+\tprivate RouteBetweenPointsFragmentListener listener;\n+\tprivate boolean nightMode;\n+\tprivate boolean portrait;\n+\tprivate boolean snapToRoadEnabled;\n+\tprivate TextView segmentBtn;\n+\tprivate TextView wholeTrackBtn;\n+\tprivate TextView btnDescription;\n+\tprivate FrameLayout segmentBtnContainer;\n+\tprivate FrameLayout wholeTrackBtnContainer;\n+\tprivate CalculationType calculationType = WHOLE_TRACK;\n+\tprivate ApplicationMode snapToRoadAppMode;\n+\n+\tpublic void setListener(RouteBetweenPointsFragmentListener listener) {\n+\t\tthis.listener = listener;\n+\t}\n+\n+\t@Nullable\n+\t@Override\n+\tpublic View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n+\t\tOsmandApplication app = requiredMyApplication();\n+\t\tnightMode = app.getDaynightHelper().isNightModeForMapControls();\n+\t\tFragmentActivity activity = requireActivity();\n+\t\tportrait = AndroidUiHelper.isOrientationPortrait(activity);\n+\t\tfinal View mainView = inflater.inflate(R.layout.fragment_route_between_points_bottom_sheet_dialog,\n+\t\t\t\tcontainer, false);\n+\t\tAndroidUtils.setBackground(activity, mainView, nightMode,\n+\t\t\t\tportrait ? R.drawable.bg_bottom_menu_light : R.drawable.bg_bottom_sheet_topsides_landscape_light,\n+\t\t\t\tportrait ? R.drawable.bg_bottom_menu_dark : R.drawable.bg_bottom_sheet_topsides_landscape_dark);\n+\n+\t\tView cancelButton = mainView.findViewById(R.id.dismiss_button);\n+\t\tUiUtilities.setupDialogButton(nightMode, cancelButton, UiUtilities.DialogButtonType.SECONDARY,\n+\t\t\t\tR.string.shared_string_close);\n+\t\tmainView.findViewById(R.id.dismiss_button).setOnClickListener(new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View view) {\n+\t\t\t\tdismiss();\n+\t\t\t}\n+\t\t});\n+\t\tsegmentBtnContainer = mainView.findViewById(R.id.next_segment_btn_container);\n+\t\tsegmentBtn = mainView.findViewById(R.id.next_segment_btn);\n+\t\twholeTrackBtnContainer = mainView.findViewById(R.id.whole_track_btn_container);\n+\t\twholeTrackBtn = mainView.findViewById(R.id.whole_track_btn);\n+\t\tbtnDescription = mainView.findViewById(R.id.button_description);\n+\n+\t\tLinearLayout navigationType = (LinearLayout) mainView.findViewById(R.id.navigation_types_container);\n+\t\tfinal List<ApplicationMode> modes = new ArrayList<>(ApplicationMode.values(app));\n+\t\tmodes.remove(ApplicationMode.DEFAULT);\n+\n+\t\tView.OnClickListener onClickListener = new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View view) {\n+\t\t\t\tsnapToRoadEnabled = false;\n+\t\t\t\tif (listener != null) {\n+\t\t\t\t\tApplicationMode mode = null;\n+\t\t\t\t\tif ((int) view.getTag() != STRAIGHT_LINE_TAG) {\n+\t\t\t\t\t\tmode = modes.get((int) view.getTag());\n+\t\t\t\t\t\tsnapToRoadEnabled = true;\n+\t\t\t\t\t}\n+\t\t\t\t\tlistener.onApplicationModeItemClick(mode);\n+\t\t\t\t}\n+\t\t\t\tdismiss();\n+\t\t\t}\n+\t\t};\n+\n+\t\tDrawable icon = app.getUIUtilities().getIcon(R.drawable.ic_action_split_interval, nightMode);\n+\t\taddProfileView(navigationType, onClickListener, STRAIGHT_LINE_TAG, icon,\n+\t\t\t\tapp.getText(R.string.routing_profile_straightline), snapToRoadAppMode == null);\n+\t\taddDelimiterView(navigationType);\n+\n+\t\tfor (int i = 0; i < modes.size(); i++) {\n+\t\t\tApplicationMode mode = modes.get(i);\n+\t\t\ticon = app.getUIUtilities().getIcon(mode.getIconRes(), mode.getIconColorInfo().getColor(nightMode));\n+\t\t\taddProfileView(navigationType, onClickListener, i, icon, mode.toHumanString(), mode.equals(snapToRoadAppMode));\n+\t\t}\n+\n+\t\tsegmentBtn.setOnClickListener(new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View v) {\n+\t\t\t\tupdateModeButtons(NEXT_SEGMENT);\n+\t\t\t}\n+\t\t});\n+\t\twholeTrackBtn.setOnClickListener(new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View v) {\n+\t\t\t\tupdateModeButtons(WHOLE_TRACK);\n+\t\t\t}\n+\t\t});\n+\t\tupdateModeButtons(calculationType);\n+\t\treturn mainView;\n+\t}\n+\n+\tprivate void addDelimiterView(LinearLayout container) {\n+\t\tView row = UiUtilities.getInflater(getContext(), nightMode).inflate(R.layout.divider, container, false);\n+\t\tView divider = row.findViewById(R.id.divider);\n+\t\tViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) divider.getLayoutParams();\n+\t\tparams.topMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_title_padding_bottom);\n+\t\tparams.bottomMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_title_padding_bottom);\n+\t\tcontainer.addView(row);\n+\t}\n+\n+\tprivate void updateModeButtons(CalculationType calculationType) {\n+\t\tOsmandApplication app = requiredMyApplication();\n+\t\tint activeColor = ContextCompat.getColor(app, nightMode\n+\t\t\t\t? R.color.active_color_primary_dark\n+\t\t\t\t: R.color.active_color_primary_light);\n+\t\tint textColor = ContextCompat.getColor(app, nightMode\n+\t\t\t\t? R.color.text_color_primary_dark\n+\t\t\t\t: R.color.text_color_primary_light);\n+\t\tint radius = AndroidUtils.dpToPx(app, 4);\n+\n+\t\tGradientDrawable background = new GradientDrawable();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b58751667a190c14ee72d641885454f94449280"}, "originalPosition": 159}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTIyMTgwOnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/measurementtool/RouteBetweenPointsBottomSheetDialogFragment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0Mzo1NFrOG8M71g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0Mzo1NFrOG8M71g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3OTY3MA==", "bodyText": "Fix screen rotate", "url": "https://github.com/osmandapp/OsmAnd/pull/9569#discussion_r465779670", "createdAt": "2020-08-05T14:43:54Z", "author": {"login": "max-klaus"}, "path": "OsmAnd/src/net/osmand/plus/measurementtool/RouteBetweenPointsBottomSheetDialogFragment.java", "diffHunk": "@@ -0,0 +1,253 @@\n+package net.osmand.plus.measurementtool;\n+\n+import android.app.Dialog;\n+import android.graphics.Color;\n+import android.graphics.drawable.Drawable;\n+import android.graphics.drawable.GradientDrawable;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.view.Window;\n+import android.view.WindowManager;\n+import android.widget.FrameLayout;\n+import android.widget.ImageView;\n+import android.widget.LinearLayout;\n+import android.widget.RadioButton;\n+import android.widget.TextView;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.content.ContextCompat;\n+import androidx.fragment.app.FragmentActivity;\n+import androidx.fragment.app.FragmentManager;\n+\n+import net.osmand.AndroidUtils;\n+import net.osmand.PlatformUtil;\n+import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.R;\n+import net.osmand.plus.UiUtilities;\n+import net.osmand.plus.base.BottomSheetDialogFragment;\n+import net.osmand.plus.helpers.AndroidUiHelper;\n+import net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType;\n+import net.osmand.plus.settings.backend.ApplicationMode;\n+\n+import org.apache.commons.logging.Log;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType.NEXT_SEGMENT;\n+import static net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType.WHOLE_TRACK;\n+\n+public class RouteBetweenPointsBottomSheetDialogFragment extends BottomSheetDialogFragment {\n+\n+\tprivate static final Log LOG = PlatformUtil.getLog(RouteBetweenPointsBottomSheetDialogFragment.class);\n+\tpublic static final String TAG = RouteBetweenPointsBottomSheetDialogFragment.class.getSimpleName();\n+\tpublic static final int STRAIGHT_LINE_TAG = -1;\n+\n+\tprivate RouteBetweenPointsFragmentListener listener;\n+\tprivate boolean nightMode;\n+\tprivate boolean portrait;\n+\tprivate boolean snapToRoadEnabled;\n+\tprivate TextView segmentBtn;\n+\tprivate TextView wholeTrackBtn;\n+\tprivate TextView btnDescription;\n+\tprivate FrameLayout segmentBtnContainer;\n+\tprivate FrameLayout wholeTrackBtnContainer;\n+\tprivate CalculationType calculationType = WHOLE_TRACK;\n+\tprivate ApplicationMode snapToRoadAppMode;\n+\n+\tpublic void setListener(RouteBetweenPointsFragmentListener listener) {\n+\t\tthis.listener = listener;\n+\t}\n+\n+\t@Nullable\n+\t@Override\n+\tpublic View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n+\t\tOsmandApplication app = requiredMyApplication();\n+\t\tnightMode = app.getDaynightHelper().isNightModeForMapControls();\n+\t\tFragmentActivity activity = requireActivity();\n+\t\tportrait = AndroidUiHelper.isOrientationPortrait(activity);\n+\t\tfinal View mainView = inflater.inflate(R.layout.fragment_route_between_points_bottom_sheet_dialog,\n+\t\t\t\tcontainer, false);\n+\t\tAndroidUtils.setBackground(activity, mainView, nightMode,\n+\t\t\t\tportrait ? R.drawable.bg_bottom_menu_light : R.drawable.bg_bottom_sheet_topsides_landscape_light,\n+\t\t\t\tportrait ? R.drawable.bg_bottom_menu_dark : R.drawable.bg_bottom_sheet_topsides_landscape_dark);\n+\n+\t\tView cancelButton = mainView.findViewById(R.id.dismiss_button);\n+\t\tUiUtilities.setupDialogButton(nightMode, cancelButton, UiUtilities.DialogButtonType.SECONDARY,\n+\t\t\t\tR.string.shared_string_close);\n+\t\tmainView.findViewById(R.id.dismiss_button).setOnClickListener(new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View view) {\n+\t\t\t\tdismiss();\n+\t\t\t}\n+\t\t});\n+\t\tsegmentBtnContainer = mainView.findViewById(R.id.next_segment_btn_container);\n+\t\tsegmentBtn = mainView.findViewById(R.id.next_segment_btn);\n+\t\twholeTrackBtnContainer = mainView.findViewById(R.id.whole_track_btn_container);\n+\t\twholeTrackBtn = mainView.findViewById(R.id.whole_track_btn);\n+\t\tbtnDescription = mainView.findViewById(R.id.button_description);\n+\n+\t\tLinearLayout navigationType = (LinearLayout) mainView.findViewById(R.id.navigation_types_container);\n+\t\tfinal List<ApplicationMode> modes = new ArrayList<>(ApplicationMode.values(app));\n+\t\tmodes.remove(ApplicationMode.DEFAULT);\n+\n+\t\tView.OnClickListener onClickListener = new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View view) {\n+\t\t\t\tsnapToRoadEnabled = false;\n+\t\t\t\tif (listener != null) {\n+\t\t\t\t\tApplicationMode mode = null;\n+\t\t\t\t\tif ((int) view.getTag() != STRAIGHT_LINE_TAG) {\n+\t\t\t\t\t\tmode = modes.get((int) view.getTag());\n+\t\t\t\t\t\tsnapToRoadEnabled = true;\n+\t\t\t\t\t}\n+\t\t\t\t\tlistener.onApplicationModeItemClick(mode);\n+\t\t\t\t}\n+\t\t\t\tdismiss();\n+\t\t\t}\n+\t\t};\n+\n+\t\tDrawable icon = app.getUIUtilities().getIcon(R.drawable.ic_action_split_interval, nightMode);\n+\t\taddProfileView(navigationType, onClickListener, STRAIGHT_LINE_TAG, icon,\n+\t\t\t\tapp.getText(R.string.routing_profile_straightline), snapToRoadAppMode == null);\n+\t\taddDelimiterView(navigationType);\n+\n+\t\tfor (int i = 0; i < modes.size(); i++) {\n+\t\t\tApplicationMode mode = modes.get(i);\n+\t\t\ticon = app.getUIUtilities().getIcon(mode.getIconRes(), mode.getIconColorInfo().getColor(nightMode));\n+\t\t\taddProfileView(navigationType, onClickListener, i, icon, mode.toHumanString(), mode.equals(snapToRoadAppMode));\n+\t\t}\n+\n+\t\tsegmentBtn.setOnClickListener(new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View v) {\n+\t\t\t\tupdateModeButtons(NEXT_SEGMENT);\n+\t\t\t}\n+\t\t});\n+\t\twholeTrackBtn.setOnClickListener(new View.OnClickListener() {\n+\t\t\t@Override\n+\t\t\tpublic void onClick(View v) {\n+\t\t\t\tupdateModeButtons(WHOLE_TRACK);\n+\t\t\t}\n+\t\t});\n+\t\tupdateModeButtons(calculationType);\n+\t\treturn mainView;\n+\t}\n+\n+\tprivate void addDelimiterView(LinearLayout container) {\n+\t\tView row = UiUtilities.getInflater(getContext(), nightMode).inflate(R.layout.divider, container, false);\n+\t\tView divider = row.findViewById(R.id.divider);\n+\t\tViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) divider.getLayoutParams();\n+\t\tparams.topMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_title_padding_bottom);\n+\t\tparams.bottomMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_title_padding_bottom);\n+\t\tcontainer.addView(row);\n+\t}\n+\n+\tprivate void updateModeButtons(CalculationType calculationType) {\n+\t\tOsmandApplication app = requiredMyApplication();\n+\t\tint activeColor = ContextCompat.getColor(app, nightMode\n+\t\t\t\t? R.color.active_color_primary_dark\n+\t\t\t\t: R.color.active_color_primary_light);\n+\t\tint textColor = ContextCompat.getColor(app, nightMode\n+\t\t\t\t? R.color.text_color_primary_dark\n+\t\t\t\t: R.color.text_color_primary_light);\n+\t\tint radius = AndroidUtils.dpToPx(app, 4);\n+\n+\t\tGradientDrawable background = new GradientDrawable();\n+\t\tbackground.setColor(UiUtilities.getColorWithAlpha(activeColor, 0.1f));\n+\t\tbackground.setStroke(AndroidUtils.dpToPx(app, 1), UiUtilities.getColorWithAlpha(activeColor, 0.5f));\n+\n+\t\tif (calculationType == NEXT_SEGMENT) {\n+\t\t\tbackground.setCornerRadii(new float[]{radius, radius, 0, 0, 0, 0, radius, radius});\n+\t\t\twholeTrackBtnContainer.setBackgroundColor(Color.TRANSPARENT);\n+\t\t\twholeTrackBtn.setTextColor(activeColor);\n+\t\t\tsegmentBtnContainer.setBackgroundDrawable(background);\n+\t\t\tsegmentBtn.setTextColor(textColor);\n+\t\t\tbtnDescription.setText(R.string.rourte_between_points_next_segment_button_desc);\n+\t\t} else {\n+\t\t\tbackground.setCornerRadii(new float[]{0, 0, radius, radius, radius, radius, 0, 0});\n+\t\t\twholeTrackBtnContainer.setBackgroundDrawable(background);\n+\t\t\twholeTrackBtn.setTextColor(textColor);\n+\t\t\tsegmentBtnContainer.setBackgroundColor(Color.TRANSPARENT);\n+\t\t\tsegmentBtn.setTextColor(activeColor);\n+\t\t\tbtnDescription.setText(R.string.rourte_between_points_whole_track_button_desc);\n+\t\t}\n+\t\tsetCalculationType(calculationType);\n+\t\tif (listener != null) {\n+\t\t\tlistener.onCalculationTypeChanges(calculationType);\n+\t\t}\n+\t}\n+\n+\tprivate void addProfileView(LinearLayout container, View.OnClickListener onClickListener, Object tag,\n+\t                            Drawable icon, CharSequence title, boolean check) {\n+\t\tView row = UiUtilities.getInflater(getContext(), nightMode)\n+\t\t\t\t.inflate(R.layout.bottom_sheet_item_with_radio_btn, container, false);\n+\t\t((RadioButton) row.findViewById(R.id.compound_button)).setChecked(check);\n+\t\tImageView imageView = row.findViewById(R.id.icon);\n+\t\timageView.setImageDrawable(icon);\n+\t\tViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) imageView.getLayoutParams();\n+\t\tparams.rightMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_icon_margin_large);\n+\t\t((TextView) row.findViewById(R.id.title)).setText(title);\n+\t\trow.setOnClickListener(onClickListener);\n+\t\trow.setTag(tag);\n+\t\tcontainer.addView(row);\n+\t}\n+\n+\t@Override\n+\tpublic void onStart() {\n+\t\tsuper.onStart();\n+\t\tif (!portrait) {\n+\t\t\tDialog dialog = getDialog();\n+\t\t\tif (dialog != null && dialog.getWindow() != null) {\n+\t\t\t\tWindow window = dialog.getWindow();\n+\t\t\t\tWindowManager.LayoutParams params = window.getAttributes();\n+\t\t\t\tparams.width = dialog.getContext().getResources().getDimensionPixelSize(R.dimen.landscape_bottom_sheet_dialog_fragment_width);\n+\t\t\t\twindow.setAttributes(params);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void onDestroyView() {\n+\t\tif (listener != null) {\n+\t\t\tlistener.onDestroyView(snapToRoadEnabled);\n+\t\t}\n+\t\tsuper.onDestroyView();\n+\t}\n+\n+\n+\tpublic void setRouteMode(ApplicationMode snapToRoadAppMode) {\n+\t\tthis.snapToRoadAppMode = snapToRoadAppMode;\n+\t}\n+\n+\tpublic void setCalculationType(CalculationType calculationType) {\n+\t\tthis.calculationType = calculationType;\n+\t}\n+\n+\tpublic static void showInstance(FragmentManager fm, RouteBetweenPointsFragmentListener listener,\n+\t                                CalculationType calculationType, ApplicationMode applicationMode) {\n+\t\ttry {\n+\t\t\tif (!fm.isStateSaved()) {\n+\t\t\t\tRouteBetweenPointsBottomSheetDialogFragment fragment = new RouteBetweenPointsBottomSheetDialogFragment();\n+\t\t\t\tfragment.setListener(listener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b58751667a190c14ee72d641885454f94449280"}, "originalPosition": 235}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTIyMjc0OnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/measurementtool/OptionsBottomSheetDialogFragment.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0NDowN1rOG8M8eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDo0NDowN1rOG8M8eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc3OTgzMw==", "bodyText": "Fix screen rotate", "url": "https://github.com/osmandapp/OsmAnd/pull/9569#discussion_r465779833", "createdAt": "2020-08-05T14:44:07Z", "author": {"login": "max-klaus"}, "path": "OsmAnd/src/net/osmand/plus/measurementtool/OptionsBottomSheetDialogFragment.java", "diffHunk": "@@ -164,6 +158,33 @@ public void onClick(View v) {\n \t\t\t\t.create();\n \t}\n \n+\t@Override\n+\tpublic void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n+\t\tsuper.onViewCreated(view, savedInstanceState);\n+\t\tImageView icon = view.findViewById(R.id.icon);\n+\t\tViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) icon.getLayoutParams();\n+\t\tparams.rightMargin = view.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_icon_margin_large);\n+\t}\n+\n+\tpublic static void showInstance(@NonNull FragmentManager fm, boolean trackSnappedToRoad, boolean snapToRoad,\n+\t                                ApplicationMode routeAppMode, OptionsFragmentListener optionsFragmentListener) {\n+\t\ttry {\n+\t\t\tif (!fm.isStateSaved()) {\n+\t\t\t\tBundle args = new Bundle();\n+\t\t\t\targs.putBoolean(TRACK_SNAPPED_TO_ROAD_KEY, trackSnappedToRoad);\n+\t\t\t\targs.putBoolean(SNAP_TO_ROAD_ENABLED_KEY, snapToRoad);\n+\t\t\t\tOptionsBottomSheetDialogFragment fragment = new OptionsBottomSheetDialogFragment();\n+\t\t\t\tfragment.setArguments(args);\n+\t\t\t\tfragment.setRouteAppMode(routeAppMode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b58751667a190c14ee72d641885454f94449280"}, "originalPosition": 234}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3448, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}