{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MTAxNDE3", "number": 8967, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyNTo0OVrOD8jlkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyNzo1N1rOD8jpyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0ODI0MjEwOnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/AppInitializer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyNTo0OVrOGVkZPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyNzoyM1rOGVkevQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2OTU2Ng==", "bodyText": "Looks bad\nWhy it is not simply prevAppVersion < VERSION_3_7_1", "url": "https://github.com/osmandapp/OsmAnd/pull/8967#discussion_r425269566", "createdAt": "2020-05-14T16:25:49Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/AppInitializer.java", "diffHunk": "@@ -228,8 +228,20 @@ public void onFinish(AppInitializer init) {\n \t\t\t\tapp.getSettings().migratePreferences();\n \t\t\t\tstartPrefs.edit().putInt(VERSION_INSTALLED_NUMBER, VERSION_3_6).commit();\n \t\t\t}\n-\t\t\tif (prevAppVersion < VERSION_3_7) {\n+\t\t\tif (prevAppVersion < VERSION_3_7 || Version.getAppVersion(app).equals(\"3.7.1\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e5078dd4b157f7b94fb6ad58473f6af11acecc8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI3MDY2Nw==", "bodyText": "// Make 4 digits version  from now\npublic static final int VERSION_3_7_1 = 3710;", "url": "https://github.com/osmandapp/OsmAnd/pull/8967#discussion_r425270667", "createdAt": "2020-05-14T16:26:57Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/AppInitializer.java", "diffHunk": "@@ -228,8 +228,20 @@ public void onFinish(AppInitializer init) {\n \t\t\t\tapp.getSettings().migratePreferences();\n \t\t\t\tstartPrefs.edit().putInt(VERSION_INSTALLED_NUMBER, VERSION_3_6).commit();\n \t\t\t}\n-\t\t\tif (prevAppVersion < VERSION_3_7) {\n+\t\t\tif (prevAppVersion < VERSION_3_7 || Version.getAppVersion(app).equals(\"3.7.1\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2OTU2Ng=="}, "originalCommit": {"oid": "0e5078dd4b157f7b94fb6ad58473f6af11acecc8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI3MDk3Mw==", "bodyText": "Move all migration code to Another class AppVersionUpgradeOnInit", "url": "https://github.com/osmandapp/OsmAnd/pull/8967#discussion_r425270973", "createdAt": "2020-05-14T16:27:23Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/AppInitializer.java", "diffHunk": "@@ -228,8 +228,20 @@ public void onFinish(AppInitializer init) {\n \t\t\t\tapp.getSettings().migratePreferences();\n \t\t\t\tstartPrefs.edit().putInt(VERSION_INSTALLED_NUMBER, VERSION_3_6).commit();\n \t\t\t}\n-\t\t\tif (prevAppVersion < VERSION_3_7) {\n+\t\t\tif (prevAppVersion < VERSION_3_7 || Version.getAppVersion(app).equals(\"3.7.1\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2OTU2Ng=="}, "originalCommit": {"oid": "0e5078dd4b157f7b94fb6ad58473f6af11acecc8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0ODI1MjkxOnYy", "diffSide": "RIGHT", "path": "OsmAnd/src/net/osmand/plus/FavouritesDbHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyNzo1N1rOGVkgLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNjoyNzo1N1rOGVkgLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI3MTM0Mw==", "bodyText": "Is there a ready method for updating all listeners?", "url": "https://github.com/osmandapp/OsmAnd/pull/8967#discussion_r425271343", "createdAt": "2020-05-14T16:27:57Z", "author": {"login": "vshcherb"}, "path": "OsmAnd/src/net/osmand/plus/FavouritesDbHelper.java", "diffHunk": "@@ -183,6 +183,28 @@ public void run() {\n \t\t});\n \t}\n \n+\tvoid fixBlackBackground() {\n+\t\tflatGroups.clear();\n+\t\tfavoriteGroups.clear();\n+\t\tfor (FavouritePoint fp : cachedFavoritePoints) {\n+\t\t\tif (fp.getColor() == 0xFF000000) {\n+\t\t\t\tfp.setColor(0);\n+\t\t\t}\n+\t\t\tFavoriteGroup group = getOrCreateGroup(fp, 0);\n+\t\t\tgroup.points.add(fp);\n+\t\t}\n+\t\tsortAll();\n+\t\tsaveCurrentPointsIntoFile();\n+\t\tcontext.runInUIThread(new Runnable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e5078dd4b157f7b94fb6ad58473f6af11acecc8"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3341, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}