{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MjkxMTIz", "number": 579, "title": "Fix to ModCount Tests", "bodyText": "Description of the Change\nUnit tests in ModCountNGTest was failing because the mod counter was being increased by 1 sometimes due to layer attributes being added to the StoreGraph.\nThese unit test now pass and the change made was to change calls to ensure() to get() in StoreGraph. The ensuring now happens in the LayersController.\nThis means that if you open a new graph with no other views open and add attributes, nodes are added with no understanding of layers (i.e same as before the introduction of the Layers View).\nIf you open the Layers view to play with layers then required attributes are added to the graph to make the layers view work.\nThe context menus to add and remove nodes from layers work with the layers view opened or not and based on testing seems to function as before.\nAlso added LayerConcept to group all of the layer mask and layer visibility attributes together.\n\nThis PR also fixes a unit test with IONGTest. If the default value of a StringAttributeDescription attribute is null then it should honour that and be allowed. The use of StringUtils.isBlank() prevented that from happening.\nAlternate Designs\n\nWhy Should This Be In Core?\n\nBenefits\n\nPossible Drawbacks\n\nVerification Process\nI've tested adding layers to nodes with the layers view open and when it was closed and all scenarios seem to work and the layers view functions as expected.\nApplicable Issues\n#550", "createdAt": "2020-06-15T05:13:20Z", "url": "https://github.com/constellation-app/constellation/pull/579", "merged": true, "mergeCommit": {"oid": "ff4c991167309c482bc32411dc018dad6a38e5bd"}, "closed": true, "closedAt": "2020-06-15T08:19:28Z", "author": {"login": "arcturus2"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcptkCWAH2gAyNDM0MjkxMTIzOmFjYjU0MDcxY2EwMThiNzU4MjgxMDQ5NTU3ZTM0OGI1ODgyNjdmYzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrcO6DgFqTQzMDQxODk4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "acb54071ca018b758281049557e348b588267fc1", "author": {"user": {"login": "arcturus2", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/acb54071ca018b758281049557e348b588267fc1", "committedDate": "2020-06-09T23:22:04Z", "message": "WIP to fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f230c82b1b1a06538ed243d7fc79fffd7a844fbd", "author": {"user": {"login": "arcturus2", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/f230c82b1b1a06538ed243d7fc79fffd7a844fbd", "committedDate": "2020-06-15T05:04:25Z", "message": ":art: Minor refactor of Layer attributes\n* Added `LayerConcept` to group all of the layer mask and layer visibility attributes together.\n* This change fixes unit test errors with mod counters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b04c690745feec629481eff58cbe25055c1b3068", "author": {"user": {"login": "arcturus2", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/b04c690745feec629481eff58cbe25055c1b3068", "committedDate": "2020-06-15T05:18:45Z", "message": ":art: Remove some commented code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzI5NTU2", "url": "https://github.com/constellation-app/constellation/pull/579#pullrequestreview-430329556", "createdAt": "2020-06-15T05:24:53Z", "commit": {"oid": "f230c82b1b1a06538ed243d7fc79fffd7a844fbd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNToyNDo1M1rOGjjlRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNToyNDo1M1rOGjjlRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzNjMyNw==", "bodyText": "The idea here was so that we didn't call to update the layer bit masks of Vertices or Transactions when an update to their Id was called. Every other instance that a Vertex or Transaction was altered will result in an update here. Just prevents a loop: update color -> trigger bitmask recalc -> change vertex bitmask -> trigger bitmask recalc. Value is set again and it continues to loop.", "url": "https://github.com/constellation-app/constellation/pull/579#discussion_r439936327", "createdAt": "2020-06-15T05:24:53Z", "author": {"login": "aldebaran30701"}, "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/StoreGraph.java", "diffHunk": "@@ -2223,43 +2200,13 @@ private void updateLayerMask(final int attributeId, final GraphElementType eleme\n \n     // update the layer visibility for an element when an attribute changes\n     private void updateLayerMask(final int attributeId, final int elementid) {\n-        if (transactionLayerVisibilityAttributeId == Graph.NOT_FOUND) {\n-            transactionLayerVisibilityAttributeId = this.addAttribute(\n-                    GraphElementType.TRANSACTION,\n-                    FloatAttributeDescription.ATTRIBUTE_NAME,\n-                    LAYER_VISIBILITY_ATTRIBUTE_LABEL,\n-                    \"The visibility of the transaction given \"\n-                    + \"the layers it belongs to\", 1.0f, null);\n-        }\n-        if (vertexLayerVisibilityAttributeId == Graph.NOT_FOUND) {\n-            vertexLayerVisibilityAttributeId = this.addAttribute(\n-                    GraphElementType.VERTEX,\n-                    FloatAttributeDescription.ATTRIBUTE_NAME,\n-                    LAYER_VISIBILITY_ATTRIBUTE_LABEL,\n-                    \"The visibility of the vertex given \"\n-                    + \"the layers it belongs to\", 1.0f, null);\n-        }\n-        if (layerMaskSelectedAttributeId == Graph.NOT_FOUND) {\n-            layerMaskSelectedAttributeId = this.addAttribute(\n-                    GraphElementType.GRAPH,\n-                    IntegerAttributeDescription.ATTRIBUTE_NAME,\n-                    LAYER_MASK_SELECTED_ATTRIBUTE_LABEL,\n-                    \"The layers currently enabled for display\", 1, null);\n-        }\n-        if (vertexLayerMaskAttribureId == Graph.NOT_FOUND) {\n-            vertexLayerMaskAttribureId = this.addAttribute(\n-                    GraphElementType.VERTEX,\n-                    IntegerAttributeDescription.ATTRIBUTE_NAME,\n-                    LAYER_MASK_ATTRIBUTE_LABEL,\n-                    \"Bitmask identifying the layers this vertex belongs to\", 1, null);\n-        }\n-        if (transactionFilterBitmaskAttrId == Graph.NOT_FOUND) {\n-            transactionFilterBitmaskAttrId = this.addAttribute(\n-                    GraphElementType.TRANSACTION,\n-                    IntegerAttributeDescription.ATTRIBUTE_NAME,\n-                    LAYER_MASK_ATTRIBUTE_LABEL,\n-                    \"Bitmask identifying the layers this transaction belongs to\", 1, null);\n-        }\n+        layerMaskSelectedAttributeId = LayersConcept.GraphAttribute.LAYER_MASK_SELECTED.get(this);\n+        vertexLayerMaskAttribureId = LayersConcept.VertexAttribute.LAYER_MASK.get(this);\n+        vertexLayerVisibilityAttributeId = LayersConcept.VertexAttribute.LAYER_VISIBILITY.get(this);\n+        transactionLayerMaskAttrId = LayersConcept.TransactionAttribute.LAYER_MASK.get(this);\n+        transactionLayerVisibilityAttributeId = LayersConcept.TransactionAttribute.LAYER_VISIBILITY.get(this);\n+\n+        // TODO: not sure about why we have to keep id's recorded", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f230c82b1b1a06538ed243d7fc79fffd7a844fbd"}, "originalPosition": 171}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4309e86247dd7600f3f16d3a5a76a941b62f87d6", "author": {"user": {"login": "arcturus2", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/4309e86247dd7600f3f16d3a5a76a941b62f87d6", "committedDate": "2020-06-15T05:39:18Z", "message": ":shirt: Fix to some minor SonarQube warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e646b8fd1a8cf63214f499a841c5c719a5ca8394", "author": {"user": {"login": "arcturus2", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/e646b8fd1a8cf63214f499a841c5c719a5ca8394", "committedDate": "2020-06-15T05:40:48Z", "message": "Merge branch 'master' into bugfix/unit-test-fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzU5MTU0", "url": "https://github.com/constellation-app/constellation/pull/579#pullrequestreview-430359154", "createdAt": "2020-06-15T06:42:40Z", "commit": {"oid": "e646b8fd1a8cf63214f499a841c5c719a5ca8394"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e17a08aaa688c3c238e5ed59c8e1d5189c6f162", "author": {"user": {"login": "arcturus2", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/1e17a08aaa688c3c238e5ed59c8e1d5189c6f162", "committedDate": "2020-06-15T08:06:28Z", "message": "Merge branch 'master' into bugfix/unit-test-fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDE4OTgw", "url": "https://github.com/constellation-app/constellation/pull/579#pullrequestreview-430418980", "createdAt": "2020-06-15T08:18:27Z", "commit": {"oid": "1e17a08aaa688c3c238e5ed59c8e1d5189c6f162"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3559, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}