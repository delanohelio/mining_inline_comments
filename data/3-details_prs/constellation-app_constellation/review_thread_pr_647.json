{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1OTc4MDE0", "number": 647, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjowNTo1OVrOEMV90Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxNzozMVrOEMWH3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzc4MjU3OnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjowNTo1OVrOGuZXqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjowNTo1OVrOGuZXqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMzMzOQ==", "bodyText": "Add Final String warningMsg", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451303339", "createdAt": "2020-07-08T06:05:59Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportController.java", "diffHunk": "@@ -449,9 +470,19 @@ private void updateSampleData() {\n                 currentColumns = new String[columns.length + 1];\n                 System.arraycopy(columns, 0, currentColumns, 1, columns.length);\n                 currentColumns[0] = \"Row\";\n-            } catch (IOException ex) {\n-                final NotifyDescriptor nd = new NotifyDescriptor.Message(ex.getMessage(), NotifyDescriptor.WARNING_MESSAGE);\n-                DialogDisplayer.getDefault().notify(nd);\n+            } catch (FileNotFoundException ex) {\n+                String warningMsg = \"The following file could not be found and has been excluded from the import set:\\n  \" + sampleFile.getPath();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzc4Mjk5OnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjowNjoxNFrOGuZX6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjowNjoxNFrOGuZX6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMzQwMQ==", "bodyText": "Add a final", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451303401", "createdAt": "2020-07-08T06:06:14Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportController.java", "diffHunk": "@@ -449,9 +470,19 @@ private void updateSampleData() {\n                 currentColumns = new String[columns.length + 1];\n                 System.arraycopy(columns, 0, currentColumns, 1, columns.length);\n                 currentColumns[0] = \"Row\";\n-            } catch (IOException ex) {\n-                final NotifyDescriptor nd = new NotifyDescriptor.Message(ex.getMessage(), NotifyDescriptor.WARNING_MESSAGE);\n-                DialogDisplayer.getDefault().notify(nd);\n+            } catch (FileNotFoundException ex) {\n+                String warningMsg = \"The following file could not be found and has been excluded from the import set:\\n  \" + sampleFile.getPath();\n+                LOGGER.log(Level.INFO, warningMsg);\n+                displayAlert(\"Invalid file selected\", warningMsg, Alert.AlertType.WARNING);\n+                files.remove(sampleFile);\n+                stage.getSourcePane().removeFile(sampleFile);\n+            }\n+            catch (IOException ex) {\n+                String warningMsg = \"The following file could not be parsed and has been excluded from the import set:\\n  \" + sampleFile.getPath();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzc4NjM1OnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjowNzo0OVrOGuZZ-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjowNzo0OVrOGuZZ-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMzkyOQ==", "bodyText": "Make parameters final", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451303929", "createdAt": "2020-07-08T06:07:49Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -112,6 +115,58 @@ public PluginParameters createParameters() {\n \n         return params;\n     }\n+    \n+    /**\n+     * Build up an import summary dialog detailing successful and unsuccessful file imports.\n+     * \n+     * @param title Title to add to status dialog\n+     * @param importedRows Number of rows successfully imported (from valid files)\n+     * @param validFilenames List of filenames that were imported from\n+     * @param invalidFilenames List of files that couldn't be opened/parsed. We try to limit this possibility by pre-screening\n+     *                         files during the initial file selection.\n+     */\n+    private void displaySummaryAlert(int importedRows, List<String> validFilenames, List<String> invalidFilenames) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzc5MTU0OnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMDoyM1rOGuZdLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMDoyM1rOGuZdLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNDc0OQ==", "bodyText": "Make both lists final", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451304749", "createdAt": "2020-07-08T06:10:23Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -124,33 +179,50 @@ protected void edit(final GraphWriteMethods graph, final PluginInteraction inter\n         final PluginParameters parserParameters = (PluginParameters) parameters.getParameters().get(PARSER_PARAMETER_IDS_PARAMETER_ID).getObjectValue();\n         final List<Integer> newVertices = new ArrayList<>();\n         boolean positionalAtrributesExist = false;\n+        List<String> validFiles = new ArrayList<>();\n+        List<String> invalidFiles = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzc5MjQ0OnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMDo0MlrOGuZdvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMDo0MlrOGuZdvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNDg5Mg==", "bodyText": "final", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451304892", "createdAt": "2020-07-08T06:10:42Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -124,33 +179,50 @@ protected void edit(final GraphWriteMethods graph, final PluginInteraction inter\n         final PluginParameters parserParameters = (PluginParameters) parameters.getParameters().get(PARSER_PARAMETER_IDS_PARAMETER_ID).getObjectValue();\n         final List<Integer> newVertices = new ArrayList<>();\n         boolean positionalAtrributesExist = false;\n+        List<String> validFiles = new ArrayList<>();\n+        List<String> invalidFiles = new ArrayList<>();\n+        int importRows = 0;\n \n         for (final File file : files) {\n             interaction.setProgress(0, 0, \"Reading File: \" + file.getName(), true);\n             List<String[]> data = null;\n+            \n             try {\n                 data = parser.parse(new InputSource(file), parserParameters);\n+                importRows = importRows + data.size() - 1;\n+                validFiles.add(file.getPath());\n+                LOGGER.log(Level.INFO, \"Imported {0} rows of data from file {1}. {2} total rows imported\", new Object[]{(data.size() - 1), file.getPath(), importRows});\n+            } catch (FileNotFoundException ex) {\n+                String errorMsg = file.getPath() + \" could not be found. Ignoring file during import.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzc5Mjc3OnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMDo1M1rOGuZd7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMDo1M1rOGuZd7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNDk0MQ==", "bodyText": "final", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451304941", "createdAt": "2020-07-08T06:10:53Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/ImportDelimitedPlugin.java", "diffHunk": "@@ -124,33 +179,50 @@ protected void edit(final GraphWriteMethods graph, final PluginInteraction inter\n         final PluginParameters parserParameters = (PluginParameters) parameters.getParameters().get(PARSER_PARAMETER_IDS_PARAMETER_ID).getObjectValue();\n         final List<Integer> newVertices = new ArrayList<>();\n         boolean positionalAtrributesExist = false;\n+        List<String> validFiles = new ArrayList<>();\n+        List<String> invalidFiles = new ArrayList<>();\n+        int importRows = 0;\n \n         for (final File file : files) {\n             interaction.setProgress(0, 0, \"Reading File: \" + file.getName(), true);\n             List<String[]> data = null;\n+            \n             try {\n                 data = parser.parse(new InputSource(file), parserParameters);\n+                importRows = importRows + data.size() - 1;\n+                validFiles.add(file.getPath());\n+                LOGGER.log(Level.INFO, \"Imported {0} rows of data from file {1}. {2} total rows imported\", new Object[]{(data.size() - 1), file.getPath(), importRows});\n+            } catch (FileNotFoundException ex) {\n+                String errorMsg = file.getPath() + \" could not be found. Ignoring file during import.\";\n+                LOGGER.log(Level.INFO, errorMsg);\n+                invalidFiles.add(file.getPath());\n             } catch (IOException ex) {\n-                throw new PluginException(this, PluginNotificationLevel.ERROR, \"Error reading file: \" + file.getName(), ex);\n+                String errorMsg = file.getPath() + \" could not be parsed. Removing file during import.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzc5OTQzOnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMzo1NFrOGuZh1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxMzo1NFrOGuZh1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNTk0MA==", "bodyText": "May as well add a final here\nfor (final File file : newFiles) {", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451305940", "createdAt": "2020-07-08T06:13:54Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "diffHunk": "@@ -155,11 +161,24 @@ public SourcePane(final ImportController importController) {\n                     SourcePane.this.importFileParserComboBox.setDisable(true);\n                 }\n                 ObservableList<File> files = FXCollections.observableArrayList(fileListView.getItems());\n+                String warningMsg = \"The following files could not be parsed and have been excluded from import set:\";\n+                boolean foundInvalidFile = false;\n                 for (File file : newFiles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzgwNDU2OnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxNTo1NVrOGuZk0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxNTo1NVrOGuZk0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNjcwNQ==", "bodyText": "I know this isn't your change but maybe adding a final here?", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451306705", "createdAt": "2020-07-08T06:15:55Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "diffHunk": "@@ -155,11 +161,24 @@ public SourcePane(final ImportController importController) {\n                     SourcePane.this.importFileParserComboBox.setDisable(true);\n                 }\n                 ObservableList<File> files = FXCollections.observableArrayList(fileListView.getItems());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzgwODMxOnYy", "diffSide": "RIGHT", "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxNzozMVrOGuZm8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxNzozMVrOGuZm8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzI1MA==", "bodyText": "final", "url": "https://github.com/constellation-app/constellation/pull/647#discussion_r451307250", "createdAt": "2020-07-08T06:17:31Z", "author": {"login": "aldebaran30701"}, "path": "CoreImportExportPlugins/src/au/gov/asd/tac/constellation/plugins/importexport/delimited/SourcePane.java", "diffHunk": "@@ -252,6 +268,16 @@ public void setParameters(final PluginParameters parameters) {\n             parametersPane.getChildren().add(pluginParametersPane);\n         }\n     }\n+    \n+    /** Allow a file to be removed from fileListView. This would be triggered by code in InputController if the file\n+     * was found to be missing or invalid - these checks are triggered when a new file is selected in the fileListView.\n+     * @param file The file to remove.\n+     */\n+    public void removeFile(File file) {\n+        ObservableList<File> files = fileListView.getItems();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512236173af54168b8afcf45485d54c704187fcd"}, "originalPosition": 117}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2206, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}