{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNTA0MjUz", "number": 472, "title": "Map view invert mouse controls", "bodyText": "This makes the functionality consistent with the CONSTELLATION graph. Addresses current issue #45.  It is an extension of the previous pull request and should replace it.\n=== Description of the Change\nThis PR addresses the issue (#45 ) of inverted mouse controls on the Map View when compared to the graph view. Coming from the graph view the user would expect a right click and drag to pan and a left click and drag to select markers on the map, in reality this is inverted. This PR fixes this to be consistent with the graph view.\nWhen the user left clicks and drags the markers are selected. (It's hard to tell that it's a left click but trust me :))\n\nWhen the user right clicks and drag the map will pan to the new position ( you may also have to trust me that I'm using the right click). The other map features function as they were before such as the zoom on on scroll and left click zoom and the measurement tools.\nthanks to @arcturus2 for pointing out the following issues that have now been resolved except for the last one that involves designs decisions so I will create a separate ticket:\n\nDouble click is deselect on the graph, but zoom on the map - perhaps move the zoom feature to the right mouse button too?\nif you open the Overview Overlay and drag the red box around with the left mouse button, it both pans and selects (this shouldn't happen).\nIf you open the Tools Overlay and use the measure or draw tool, you can select markers while measuring or drawing (this shouldn't be the case).\nIf you have custom markers on the map (drawn or added using the zoom to location tool), then toggle the 'selected only' option on and off, the custom markers remain invisible (this is probably not to do with your changes, but is a bug nonetheless).\nif you turn on marker labels and then select a marker, a NullPointerException is thrown (also likely not your changes, but a bug nonetheless).  Will add as a separate ticket.\n\n=== Alternate Designs\nThe alternate design was to add the inverted mouse controls as an optional feature to the open source map library, Unfolded, and make use of this change in Constellation. Due to the following reasons I decided against adding to Unfolded and added to Constellation instead:\n\n\nInactivity of Unfolding Maps\n\n\nThe feature is specific to Constellation with no open issue on Unfolded.\n\n\nUnfolded API allows the controls to inverted with minimal duplication (a couple of lines)\n\n\n=== Why Should This Be In Core?\nThis adds to the user experience giving a consistent user experience across the application.\n=== Benefits\n=== Possible Drawbacks\n=== Verification Process\n\nOpen Map View\nLeft click & drag to select markers\nRight click and drag to pan the map\nApplicable Issues", "createdAt": "2020-04-30T13:36:41Z", "url": "https://github.com/constellation-app/constellation/pull/472", "merged": true, "mergeCommit": {"oid": "865ac20ca10ef23428c0898897ea58b5a65e661f"}, "closed": true, "closedAt": "2020-05-19T01:19:02Z", "author": {"login": "Guilty-Spark-343"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWjRFKgH2gAyNDExNTA0MjUzOmYyNTJjM2E5NmNiNzk2OGZiYzc4MjBmZDQzMjZiN2JjMGRiMzIyN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcidrLbgH2gAyNDExNTA0MjUzOjM2MmUxN2FkM2E0ZmI1OTJkYjc3ZjkzNDViNzZiOTcyNTVhMGQ5NzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f252c3a96cb7968fbc7820fd4326b7bc0db3227b", "author": {"user": {"login": "bentipping", "name": "Ben Tipping"}}, "url": "https://github.com/constellation-app/constellation/commit/f252c3a96cb7968fbc7820fd4326b7bc0db3227b", "committedDate": "2020-04-11T10:37:45Z", "message": "Change feature in Map View to invert the mouse click controls.\nThis makes the functionality consistent with the CONSTELLATION graph.  Addresses current issue #45"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20fb64a232116629d3aca82b67b0bc1262641f8c", "author": {"user": {"login": "bentipping", "name": "Ben Tipping"}}, "url": "https://github.com/constellation-app/constellation/commit/20fb64a232116629d3aca82b67b0bc1262641f8c", "committedDate": "2020-04-12T13:57:51Z", "message": "Add change to CHANGELOG about the Map View Controls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f88c17fbfa262c8d8114b7102b6cad89adbd65e8", "author": {"user": {"login": "bentipping", "name": "Ben Tipping"}}, "url": "https://github.com/constellation-app/constellation/commit/f88c17fbfa262c8d8114b7102b6cad89adbd65e8", "committedDate": "2020-04-12T14:06:13Z", "message": "Update whats new message to include changes in map view mouse controls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01263a6abec918e02301147d0bf46edf7e850ad3", "author": {"user": {"login": "bentipping", "name": "Ben Tipping"}}, "url": "https://github.com/constellation-app/constellation/commit/01263a6abec918e02301147d0bf46edf7e850ad3", "committedDate": "2020-04-12T14:14:53Z", "message": "Merge branch 'master' into MapViewInvertMouseControls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07f02bbc1db2e610c4e9d2f7e0029d1a0e70ce9f", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/07f02bbc1db2e610c4e9d2f7e0029d1a0e70ce9f", "committedDate": "2020-04-28T00:31:09Z", "message": "Fixed both the OverviewOverlay and ToolsOverlay to not select markers when in use"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22fd858e058ebbb1941b95edabfad5308150f554", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/22fd858e058ebbb1941b95edabfad5308150f554", "committedDate": "2020-04-28T02:45:18Z", "message": "Changed MapView default double left click to right click to be similar to graph view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4549476ae053bea521581dd13afb4bbad9ddd3d0", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/4549476ae053bea521581dd13afb4bbad9ddd3d0", "committedDate": "2020-04-30T01:40:34Z", "message": "Fixed issue where custom markers were always hidden when toggling 'Selected only'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea699f615a17f252b82caf9d0eb3218bb2c05532", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/ea699f615a17f252b82caf9d0eb3218bb2c05532", "committedDate": "2020-04-30T12:41:39Z", "message": "cleaned up Overview overlay"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa6a84ec66d480e79bc210b30315d0ed9493d413", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/aa6a84ec66d480e79bc210b30315d0ed9493d413", "committedDate": "2020-04-30T13:30:47Z", "message": "Updated styling in Map Tile Viewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b17a8c7ec89e4a65a38b6c5d43b21beaf70fced2", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/b17a8c7ec89e4a65a38b6c5d43b21beaf70fced2", "committedDate": "2020-04-30T13:38:28Z", "message": "Merge branch 'master' into MapViewInvertMouseControls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDIzMjIy", "url": "https://github.com/constellation-app/constellation/pull/472#pullrequestreview-404023222", "createdAt": "2020-05-01T05:10:30Z", "commit": {"oid": "b17a8c7ec89e4a65a38b6c5d43b21beaf70fced2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mzk0MzUw", "url": "https://github.com/constellation-app/constellation/pull/472#pullrequestreview-405394350", "createdAt": "2020-05-04T22:34:22Z", "commit": {"oid": "b17a8c7ec89e4a65a38b6c5d43b21beaf70fced2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjozNDoyMlrOGQUoog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjozNzo0MVrOGQUtKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2ODQ4Mg==", "bodyText": "add finals.", "url": "https://github.com/constellation-app/constellation/pull/472#discussion_r419768482", "createdAt": "2020-05-04T22:34:22Z", "author": {"login": "cygnus-x-1"}, "path": "CoreMapView/src/au/gov/asd/tac/constellation/views/mapview/MapViewTileRenderer.java", "diffHunk": "@@ -461,17 +464,46 @@ public void mousePressed(final MouseEvent event) {\n     @Override\n     public void mouseDragged(final MouseEvent event) {\n         assert !SwingUtilities.isEventDispatchThread();\n-\n-        if (event.getButton() == PConstants.CENTER) {\n-            // zoom to box\n-            boxZoomEnabled = true;\n-            boxDeltaX = event.getX();\n-            boxDeltaY = event.getY();\n-        } else if (event.getButton() == PConstants.RIGHT) {\n-            // select markers\n-            boxSelectionEnabled = true;\n-            boxDeltaX = event.getX();\n-            boxDeltaY = event.getY();\n+        \n+        //Checks to see if click was on the map\n+        final boolean ignoreMapInteractions = isIgnoreMapInteractions();\n+        \n+        switch (event.getButton()) {\n+            case PConstants.CENTER:\n+                // zoom to box\n+                boxZoomEnabled = true;\n+                boxDeltaX = event.getX();\n+                boxDeltaY = event.getY();\n+                break;\n+            case PConstants.RIGHT:\n+                // select markers\n+                boxSelectionEnabled = false;\n+                \n+                if (!ignoreMapInteractions) {\n+                    // Triggers a pan event for a right click & drag if within map\n+                    dispatcher.register(map, PanMapEvent.TYPE_PAN, map.getId());\n+                    Location oldLocation = map.getLocation(pmouseX, pmouseY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b17a8c7ec89e4a65a38b6c5d43b21beaf70fced2"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2OTY0Mw==", "bodyText": "There should not be any references to specific plugins in the tile renderer if at all possible. Perhaps instead you could add an abstract method to MapOverlay to signal when the overlay has priority on interactions. This way any overlay could take control of interactions when it makes sense for that overlay.", "url": "https://github.com/constellation-app/constellation/pull/472#discussion_r419769643", "createdAt": "2020-05-04T22:37:41Z", "author": {"login": "cygnus-x-1"}, "path": "CoreMapView/src/au/gov/asd/tac/constellation/views/mapview/MapViewTileRenderer.java", "diffHunk": "@@ -461,17 +464,46 @@ public void mousePressed(final MouseEvent event) {\n     @Override\n     public void mouseDragged(final MouseEvent event) {\n         assert !SwingUtilities.isEventDispatchThread();\n-\n-        if (event.getButton() == PConstants.CENTER) {\n-            // zoom to box\n-            boxZoomEnabled = true;\n-            boxDeltaX = event.getX();\n-            boxDeltaY = event.getY();\n-        } else if (event.getButton() == PConstants.RIGHT) {\n-            // select markers\n-            boxSelectionEnabled = true;\n-            boxDeltaX = event.getX();\n-            boxDeltaY = event.getY();\n+        \n+        //Checks to see if click was on the map\n+        final boolean ignoreMapInteractions = isIgnoreMapInteractions();\n+        \n+        switch (event.getButton()) {\n+            case PConstants.CENTER:\n+                // zoom to box\n+                boxZoomEnabled = true;\n+                boxDeltaX = event.getX();\n+                boxDeltaY = event.getY();\n+                break;\n+            case PConstants.RIGHT:\n+                // select markers\n+                boxSelectionEnabled = false;\n+                \n+                if (!ignoreMapInteractions) {\n+                    // Triggers a pan event for a right click & drag if within map\n+                    dispatcher.register(map, PanMapEvent.TYPE_PAN, map.getId());\n+                    Location oldLocation = map.getLocation(pmouseX, pmouseY);\n+                    Location newLocation = map.getLocation(mouseX, mouseY);\n+                    PanMapEvent panMapEvent = new PanMapEvent(this, map.getId(), PanMapEvent.PAN_BY);\n+                    panMapEvent.setFromLocation(oldLocation);\n+                    panMapEvent.setToLocation(newLocation);\n+                    dispatcher.fireMapEvent(panMapEvent);\n+                    dispatcher.unregister(map, PanMapEvent.TYPE_PAN, map.getId());\n+                }   \n+                break;\n+            case PConstants.LEFT:\n+                // select markers\n+                final boolean isMeasuring = overlays.stream().filter( overlay -> \n+                        ToolsOverlay.class.isInstance(overlay) && overlay.isEnabled()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b17a8c7ec89e4a65a38b6c5d43b21beaf70fced2"}, "originalPosition": 134}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7328866d6788003428b6f832449f0b46683e42e", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/b7328866d6788003428b6f832449f0b46683e42e", "committedDate": "2020-05-05T10:39:31Z", "message": "Merge branch 'MapViewInvertMouseControls' of github.com:bentipping/constellation into MapViewInvertMouseControls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9212297cf983352b22cd742701b0e9337b7bc8b", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/b9212297cf983352b22cd742701b0e9337b7bc8b", "committedDate": "2020-05-05T11:17:22Z", "message": "Changed mouse deselect to double click"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdc32db645ec38066312fe3ea41fad2895d2ed54", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/bdc32db645ec38066312fe3ea41fad2895d2ed54", "committedDate": "2020-05-05T11:21:45Z", "message": "Fixed single click map deselect to double click"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c30a99c47def44f105010a98208ac2c2f136804", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/2c30a99c47def44f105010a98208ac2c2f136804", "committedDate": "2020-05-05T15:48:23Z", "message": "Fixed direct reference to ToolOverlay in TileView to allow overlays to steal focus"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea136fc8e5258631b09f93f21555b3b0de8d7285", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/ea136fc8e5258631b09f93f21555b3b0de8d7285", "committedDate": "2020-05-05T16:02:36Z", "message": "Merged master with revision"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58a1a8daed7978b80bfbbeb3c9995412ff69f116", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/58a1a8daed7978b80bfbbeb3c9995412ff69f116", "committedDate": "2020-05-05T16:17:35Z", "message": "reverting merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8300e3accc860de68ca7f3480f07e21a7a2b7319", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/8300e3accc860de68ca7f3480f07e21a7a2b7319", "committedDate": "2020-05-05T16:26:27Z", "message": "abstracting isInFocus to the overlays"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b602ef37e16db37b56b455c32023289467afa424", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/b602ef37e16db37b56b455c32023289467afa424", "committedDate": "2020-05-05T16:29:13Z", "message": "Merge branch 'master' into MapViewInvertMouseControls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c75ea51f7066b2aa457a8417fb66d68f68c2d814", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/c75ea51f7066b2aa457a8417fb66d68f68c2d814", "committedDate": "2020-05-05T16:54:30Z", "message": "Fixed map double click deselect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82c350411e49c090c95b0695725ae47df6102ff4", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/82c350411e49c090c95b0695725ae47df6102ff4", "committedDate": "2020-05-05T17:03:17Z", "message": "Merge branch 'MapViewInvertMouseControls' of https://github.com/Guilty-Spark-343/constellation into MapViewInvertMouseControls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59b36fb444e54f6e41611e41315ef2ebe53f24ec", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/59b36fb444e54f6e41611e41315ef2ebe53f24ec", "committedDate": "2020-05-05T17:10:01Z", "message": "Revert \"Fixed map double click deselect\"\n\nThis reverts commit c75ea51f7066b2aa457a8417fb66d68f68c2d814."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e893b476d2d78e3ff59da1c0ab27cb697963cefe", "author": {"user": {"login": "Guilty-Spark-343", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/e893b476d2d78e3ff59da1c0ab27cb697963cefe", "committedDate": "2020-05-05T17:43:10Z", "message": "Refix the double click deselect on map view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "362e17ad3a4fb592db77f9345b76b97255a0d975", "author": {"user": {"login": "arcturus2", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/362e17ad3a4fb592db77f9345b76b97255a0d975", "committedDate": "2020-05-18T10:53:55Z", "message": "Merge branch 'master' into MapViewInvertMouseControls"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3711, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}