{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MzYwNDY1", "number": 185, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzozNjozMFrODZZdLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzozOTo0MFrODZZfXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3OTU4MDYyOnYy", "diffSide": "RIGHT", "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzozNjozMFrOFfwn1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxMjo0NDoxOVrOFjHF0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0NjgwNA==", "bodyText": "@formalhaut69 thanks for this.\n@cygnus-x-1 I wanted to ask if you have any ideas about how we could format this a bit better so that we don't have to be so verbose and replace the type <string> to get this to work.\nWe can replace query.keys() with ((GraphRecordStore) query).keysWithType() which will work for line 160 but then the if block (162-164) comparing x, y and z will not work because the key is now x<float>.\nTo me something looks wrong with the design of the GraphRecordStore. Keen for feedback from anyone.", "url": "https://github.com/constellation-app/constellation/pull/185#discussion_r368846804", "createdAt": "2020-01-21T07:36:30Z", "author": {"login": "arcturus2"}, "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "diffHunk": "@@ -152,6 +152,25 @@ private void editResultStore(final RecordStore result, final String left, final\n             result.set(GraphRecordStoreUtilities.SOURCE + AnalyticConcept.VertexAttribute.TYPE, leftVertexTypesMatches.get(0));\n         }\n         result.set(GraphRecordStoreUtilities.DESTINATION + VisualConcept.VertexAttribute.IDENTIFIER, right);\n+        \n+        //Loops through all of the Node attributes and copies them to the new node\n+        query.reset();\n+        while(query.next()){\n+            for (final String key : query.keys()){\n+                if(SOURCE_ID.replace(\"<string>\", \"\").equals(key) || SOURCE_IDENTIFIER.replace(\"<string>\", \"\").equals(key)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c1d07e3f3b799ebae773f386ce3770d254365a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5MTgyMA==", "bodyText": "You shouldn't need to worry about the field type, as the default behaviour of GraphRecordStore.keys is to explicitly not return field types.", "url": "https://github.com/constellation-app/constellation/pull/185#discussion_r370491820", "createdAt": "2020-01-24T06:42:39Z", "author": {"login": "cygnus-x-1"}, "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "diffHunk": "@@ -152,6 +152,25 @@ private void editResultStore(final RecordStore result, final String left, final\n             result.set(GraphRecordStoreUtilities.SOURCE + AnalyticConcept.VertexAttribute.TYPE, leftVertexTypesMatches.get(0));\n         }\n         result.set(GraphRecordStoreUtilities.DESTINATION + VisualConcept.VertexAttribute.IDENTIFIER, right);\n+        \n+        //Loops through all of the Node attributes and copies them to the new node\n+        query.reset();\n+        while(query.next()){\n+            for (final String key : query.keys()){\n+                if(SOURCE_ID.replace(\"<string>\", \"\").equals(key) || SOURCE_IDENTIFIER.replace(\"<string>\", \"\").equals(key)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0NjgwNA=="}, "originalCommit": {"oid": "90c1d07e3f3b799ebae773f386ce3770d254365a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzMDY3Ng==", "bodyText": "constellation/CoreGraph/src/au/gov/asd/tac/constellation/graph/processing/GraphRecordStoreUtilities.java\n    \n    \n         Line 59\n      in\n      28443a9\n    \n    \n    \n    \n\n        \n          \n           public static final String ID = \"[id]<string>\"; \n        \n    \n  \n\n\n@cygnus-x-1 @arcturus2 I've made a mistake here sorry, the SOURCE_IDENTIFIER never contains <string> so when comparing it to the key, we don't need to replace <string>. The SOURCE_ID does still contain it's type so we still need to replace <string> for it. You can see in GraphRecordStoreUtilities it's declared with <string> in its value . The X,Y and Z values are declared without their type.", "url": "https://github.com/constellation-app/constellation/pull/185#discussion_r371530676", "createdAt": "2020-01-27T23:00:41Z", "author": {"login": "formalhaut69"}, "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "diffHunk": "@@ -152,6 +152,25 @@ private void editResultStore(final RecordStore result, final String left, final\n             result.set(GraphRecordStoreUtilities.SOURCE + AnalyticConcept.VertexAttribute.TYPE, leftVertexTypesMatches.get(0));\n         }\n         result.set(GraphRecordStoreUtilities.DESTINATION + VisualConcept.VertexAttribute.IDENTIFIER, right);\n+        \n+        //Loops through all of the Node attributes and copies them to the new node\n+        query.reset();\n+        while(query.next()){\n+            for (final String key : query.keys()){\n+                if(SOURCE_ID.replace(\"<string>\", \"\").equals(key) || SOURCE_IDENTIFIER.replace(\"<string>\", \"\").equals(key)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0NjgwNA=="}, "originalCommit": {"oid": "90c1d07e3f3b799ebae773f386ce3770d254365a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1MTg4Mw==", "bodyText": "While GraphRecordStoreUtilites.ID does explicitly declare a type (because it's designed to work with GraphRecordStore which requires typed fields), this type will only be recorded in the typedRecords object. GraphRecordStore.keys will return the keys of its records object (which has no types as it comes from TabularRecordStore) whereas GraphRecordStore.keysWithType will return keys from typedRecords. Since you are using GraphRecordStore.keys in this case, you shouldn't have to worry about types.", "url": "https://github.com/constellation-app/constellation/pull/185#discussion_r371651883", "createdAt": "2020-01-28T08:00:48Z", "author": {"login": "cygnus-x-1"}, "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "diffHunk": "@@ -152,6 +152,25 @@ private void editResultStore(final RecordStore result, final String left, final\n             result.set(GraphRecordStoreUtilities.SOURCE + AnalyticConcept.VertexAttribute.TYPE, leftVertexTypesMatches.get(0));\n         }\n         result.set(GraphRecordStoreUtilities.DESTINATION + VisualConcept.VertexAttribute.IDENTIFIER, right);\n+        \n+        //Loops through all of the Node attributes and copies them to the new node\n+        query.reset();\n+        while(query.next()){\n+            for (final String key : query.keys()){\n+                if(SOURCE_ID.replace(\"<string>\", \"\").equals(key) || SOURCE_IDENTIFIER.replace(\"<string>\", \"\").equals(key)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0NjgwNA=="}, "originalCommit": {"oid": "90c1d07e3f3b799ebae773f386ce3770d254365a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIxNjQ3NQ==", "bodyText": "Thanks @formalhaut69 for the fix.\nThanks @cygnus-x-1 for the explanation.\nIt looks like we are using features from the TabularRecordStore and GraphRecordStore causing issues. Though I'm not a fan of magic strings (i.e \".[id]\"), I don't know how best to solve this one without going deep into the framework...and I don't feel its worth it right now given what @formalhaut69 has proposed works and I'm worrying about semantics.", "url": "https://github.com/constellation-app/constellation/pull/185#discussion_r372216475", "createdAt": "2020-01-29T07:03:34Z", "author": {"login": "arcturus2"}, "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "diffHunk": "@@ -152,6 +152,25 @@ private void editResultStore(final RecordStore result, final String left, final\n             result.set(GraphRecordStoreUtilities.SOURCE + AnalyticConcept.VertexAttribute.TYPE, leftVertexTypesMatches.get(0));\n         }\n         result.set(GraphRecordStoreUtilities.DESTINATION + VisualConcept.VertexAttribute.IDENTIFIER, right);\n+        \n+        //Loops through all of the Node attributes and copies them to the new node\n+        query.reset();\n+        while(query.next()){\n+            for (final String key : query.keys()){\n+                if(SOURCE_ID.replace(\"<string>\", \"\").equals(key) || SOURCE_IDENTIFIER.replace(\"<string>\", \"\").equals(key)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0NjgwNA=="}, "originalCommit": {"oid": "90c1d07e3f3b799ebae773f386ce3770d254365a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2MDY1OQ==", "bodyText": "A simple fix might be to create TabularRecordStoreUtilities.ID as an untyped analogue to GraphRecordStoreUtilities.ID and to use that instead. But @arcturus2 is right, it's not really a big deal.", "url": "https://github.com/constellation-app/constellation/pull/185#discussion_r372360659", "createdAt": "2020-01-29T12:44:19Z", "author": {"login": "cygnus-x-1"}, "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "diffHunk": "@@ -152,6 +152,25 @@ private void editResultStore(final RecordStore result, final String left, final\n             result.set(GraphRecordStoreUtilities.SOURCE + AnalyticConcept.VertexAttribute.TYPE, leftVertexTypesMatches.get(0));\n         }\n         result.set(GraphRecordStoreUtilities.DESTINATION + VisualConcept.VertexAttribute.IDENTIFIER, right);\n+        \n+        //Loops through all of the Node attributes and copies them to the new node\n+        query.reset();\n+        while(query.next()){\n+            for (final String key : query.keys()){\n+                if(SOURCE_ID.replace(\"<string>\", \"\").equals(key) || SOURCE_IDENTIFIER.replace(\"<string>\", \"\").equals(key)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0NjgwNA=="}, "originalCommit": {"oid": "90c1d07e3f3b799ebae773f386ce3770d254365a"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3OTU4NjIyOnYy", "diffSide": "RIGHT", "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzozOTo0MFrOFfwraQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzozOTo0MFrOFfwraQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0NzcyMQ==", "bodyText": "A very minor comment but I would put this in 1 line because it is a little confusing seeing the query.get on its own.", "url": "https://github.com/constellation-app/constellation/pull/185#discussion_r368847721", "createdAt": "2020-01-21T07:39:40Z", "author": {"login": "arcturus2"}, "path": "CoreDataAccessView/src/au/gov/asd/tac/constellation/views/dataaccess/plugins/clean/SplitNodesPlugin.java", "diffHunk": "@@ -152,6 +152,25 @@ private void editResultStore(final RecordStore result, final String left, final\n             result.set(GraphRecordStoreUtilities.SOURCE + AnalyticConcept.VertexAttribute.TYPE, leftVertexTypesMatches.get(0));\n         }\n         result.set(GraphRecordStoreUtilities.DESTINATION + VisualConcept.VertexAttribute.IDENTIFIER, right);\n+        \n+        //Loops through all of the Node attributes and copies them to the new node\n+        query.reset();\n+        while(query.next()){\n+            for (final String key : query.keys()){\n+                if(SOURCE_ID.replace(\"<string>\", \"\").equals(key) || SOURCE_IDENTIFIER.replace(\"<string>\", \"\").equals(key)) {\n+                     //Skips the id and Identifier to make the new node unique\n+                } else if ((GraphRecordStoreUtilities.SOURCE + VisualConcept.VertexAttribute.X).equals(key) \n+                        || (GraphRecordStoreUtilities.SOURCE + VisualConcept.VertexAttribute.Y).equals(key) \n+                        || (GraphRecordStoreUtilities.SOURCE + VisualConcept.VertexAttribute.Z).equals(key)){ \n+                    //The coordinates are also skipped so that the second node is not created in the exact same location\n+                    //as the first node\n+                } else {\n+                     result.set(GraphRecordStoreUtilities.DESTINATION + key.replace(GraphRecordStoreUtilities.SOURCE, \"\"), ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90c1d07e3f3b799ebae773f386ce3770d254365a"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2469, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}