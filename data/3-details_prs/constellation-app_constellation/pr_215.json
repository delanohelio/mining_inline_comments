{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3ODA3NDE1", "number": 215, "title": ":bug: Analytic state attribute 54", "bodyText": "Description of the Change\nImplement state attribute usage for a currently opened graph.\nReads from the state to display saved graph plugins and parameters\nWrites changes to the state attribute on selection or change of plugin\n\nAlternate Designs\nRead from state as single plugin\nWrite to state as another plugin\nThis faced concurrency issues when selection was performed fast\n\nWhy Should This Be In Core?\nIt solves the bug of not keeping memory of plugins selected between graphs\n\nBenefits\nManages the state of plugins for the graph. Automatically saves the selections temporarily until complete graph save.\n\nPossible Drawbacks\nwhen you open a file and change some values within plugin parameters of the Analytic view and then close that graph. The Analytic view shows the previously entered parameter values instead of a default set. The parameters get refreshed to default once the application restarts.\n\nVerification Process\nOpen graph -> open analytic view -> select plugins\n-> select categories (maintained selection)\n-> select questions (maintained selection)\n-> deselect plugins (maintained selection)\n-> save graph (maintained selection)\n-> load same graph to verify state is maintained (maintained selection)\n-> Open new graph\n-> switch between graphs to ensure state is refreshed on switching (maintained selection)\nThere seems to be no issue in the operation as far as I have tested.\n\nApplicable Issues\n#54", "createdAt": "2020-01-28T03:24:32Z", "url": "https://github.com/constellation-app/constellation/pull/215", "merged": true, "mergeCommit": {"oid": "96f9534c1a7d784f779d5e6f029655875d52264c"}, "closed": true, "closedAt": "2020-02-05T03:59:14Z", "author": {"login": "aldebaran30701"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7CIjmgH2gAyMzY3ODA3NDE1OjdiNmM3OTQzMjczMjc2NTc0MjY0ZDJjOWM3NTA4ODM2Yzk5MmM1ZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA9emhgFqTM1MjgwMTI0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b6c7943273276574264d2c9c7508836c992c5d3", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/7b6c7943273276574264d2c9c7508836c992c5d3", "committedDate": "2020-01-16T22:45:37Z", "message": "Initial testing of implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40a6da64fb30d8db17fdce992fd4d9b7f46f24a4", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/40a6da64fb30d8db17fdce992fd4d9b7f46f24a4", "committedDate": "2020-01-20T04:05:01Z", "message": "Implement update handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "591408c905f1a71dff9e75ba6b599669f8cd1f40", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/591408c905f1a71dff9e75ba6b599669f8cd1f40", "committedDate": "2020-01-21T23:31:56Z", "message": "Merge pull request #7 from constellation-app/master\n\nUpdate Master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5b3d3a2f170d7fb221aa296dd63d38b1306b013", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/d5b3d3a2f170d7fb221aa296dd63d38b1306b013", "committedDate": "2020-01-21T23:32:12Z", "message": "Code Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cd191c003cfb1c91d1152f0c741b81bdcd150c1", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/0cd191c003cfb1c91d1152f0c741b81bdcd150c1", "committedDate": "2020-01-21T23:32:45Z", "message": "Merge branch 'master' into Analytic-State_Attribute-54"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd5cf50e7e6fb3e21ae254caedde257fe54c7c5", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/6bd5cf50e7e6fb3e21ae254caedde257fe54c7c5", "committedDate": "2020-01-23T01:41:38Z", "message": "Implement plugin selection and deselection from state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1a70938d9a3789e1328c9b0cbae1f0feb3943d4", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/c1a70938d9a3789e1328c9b0cbae1f0feb3943d4", "committedDate": "2020-01-24T04:35:20Z", "message": "Implement read write of state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf775c2a88a157e9e9fb62d758014269c2b8586a", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/cf775c2a88a157e9e9fb62d758014269c2b8586a", "committedDate": "2020-01-28T01:08:18Z", "message": "Refactor variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15b37bc387c702d43beac8ba7574e1c3f6aaec3", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/f15b37bc387c702d43beac8ba7574e1c3f6aaec3", "committedDate": "2020-01-28T01:09:31Z", "message": "Merge pull request #8 from constellation-app/master\n\nUpdate Master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2275588afe92b48c079874514bd52cc1c52ec44a", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/2275588afe92b48c079874514bd52cc1c52ec44a", "committedDate": "2020-01-28T01:10:18Z", "message": "Merge branch 'master' into Analytic-State_Attribute-54"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7bbe1f5d8d9338fce2496334d3aca44af61a0e5", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/a7bbe1f5d8d9338fce2496334d3aca44af61a0e5", "committedDate": "2020-01-28T03:08:16Z", "message": "Code Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd79295a690315c7c95dce7902538afb57167be0", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/cd79295a690315c7c95dce7902538afb57167be0", "committedDate": "2020-01-28T03:27:14Z", "message": "refactor comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "committedDate": "2020-01-28T03:28:03Z", "message": "refactor comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MTcyNjI0", "url": "https://github.com/constellation-app/constellation/pull/215#pullrequestreview-349172624", "createdAt": "2020-01-28T07:35:29Z", "commit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzozNToyOVrOFibV4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNzo0ODowMFrOFibkzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Mzg3NA==", "bodyText": "What is happening here?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371643874", "createdAt": "2020-01-28T07:35:29Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -490,15 +510,29 @@ public static final SelectableAnalyticPlugin lookupSelectablePlugin(final String\n         return NAME_TO_SELECTABLE_PLUGIN_MAP.get(selectableAnalyticPluginName);\n     }\n \n+    private static void setSuppressedFlag(final boolean newValue) {\n+        selectionSuppressed = newValue;\n+    }\n+\n     public final class SelectableAnalyticPlugin {\n \n         private final CheckBox checkbox;\n+        private ListCell<SelectableAnalyticPlugin> parent;\n         private final AnalyticPlugin plugin;\n         private PluginParameters parameters;\n         private PluginParameters updatedParameters;\n \n         public SelectableAnalyticPlugin(final AnalyticPlugin plugin) {\n             this.checkbox = new CheckBox();\n+            // Allows triggering of selection listener when a checkbox is changed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NDU0Mw==", "bodyText": "Should this be categoryWasSelected?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371644543", "createdAt": "2020-01-28T07:37:45Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -582,4 +620,71 @@ public String getName() {\n             return \"Analytic View: Update State\";\n         }\n     }\n+    \n+    /**\n+     * Update the display by reading and writing to/from the state attribute. \n+     */\n+    private static final class AnalyticViewStateUpdater extends SimpleEditPlugin {\n+\n+        private final AnalyticConfigurationPane analyticConfigurationPane;\n+        private final boolean pluginWasSelected;\n+        \n+        public AnalyticViewStateUpdater(final AnalyticConfigurationPane analyticConfigurationPane, final boolean categoryWasSelected) {\n+            this.analyticConfigurationPane = analyticConfigurationPane;\n+            this.pluginWasSelected = categoryWasSelected;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NTQ5Ng==", "bodyText": "What's the advantage of this, isn't it functionally equivalent to what was there before?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371645496", "createdAt": "2020-01-28T07:41:15Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/state/AnalyticViewState.java", "diffHunk": "@@ -65,7 +66,11 @@ public void setCurrentAnalyticQuestionIndex(final int currentAnalyticQuestionInd\n \n     public void addAnalyticQuestion(final AnalyticQuestionDescription<?> question, final List<SelectableAnalyticPlugin> selectablePlugins) {\n         activeAnalyticQuestions.add(question);\n-        activeSelectablePlugins.add(selectablePlugins);\n+        for (SelectableAnalyticPlugin plugin : selectablePlugins) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Njk0OA==", "bodyText": "Why are you doing this? In fact why is activeSelectablePlugins a list of lists?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371646948", "createdAt": "2020-01-28T07:45:47Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/state/AnalyticViewState.java", "diffHunk": "@@ -65,7 +66,11 @@ public void setCurrentAnalyticQuestionIndex(final int currentAnalyticQuestionInd\n \n     public void addAnalyticQuestion(final AnalyticQuestionDescription<?> question, final List<SelectableAnalyticPlugin> selectablePlugins) {\n         activeAnalyticQuestions.add(question);\n-        activeSelectablePlugins.add(selectablePlugins);\n+        for (SelectableAnalyticPlugin plugin : selectablePlugins) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ==", "bodyText": "Why have you removed all the attribute listeners? Also, is there a reason you haven't implemented the structure and state listeners above?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647125", "createdAt": "2020-01-28T07:46:08Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticViewTopComponent.java", "diffHunk": "@@ -109,16 +109,6 @@ public AnalyticViewTopComponent() {\n                 prerequisiteAttributes.get(attribute).add(plugin);\n             });\n         });\n-        prerequisiteAttributes.forEach((attribute, plugins) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzI2NA==", "bodyText": "Shouldn't all this be in the state listener on the top component?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647264", "createdAt": "2020-01-28T07:46:37Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -582,4 +620,71 @@ public String getName() {\n             return \"Analytic View: Update State\";\n         }\n     }\n+    \n+    /**\n+     * Update the display by reading and writing to/from the state attribute. \n+     */\n+    private static final class AnalyticViewStateUpdater extends SimpleEditPlugin {\n+\n+        private final AnalyticConfigurationPane analyticConfigurationPane;\n+        private final boolean pluginWasSelected;\n+        \n+        public AnalyticViewStateUpdater(final AnalyticConfigurationPane analyticConfigurationPane, final boolean categoryWasSelected) {\n+            this.analyticConfigurationPane = analyticConfigurationPane;\n+            this.pluginWasSelected = categoryWasSelected;\n+        }\n+\n+        @Override\n+        public void edit(final GraphWriteMethods graph, final PluginInteraction interaction, final PluginParameters parameters) throws InterruptedException, PluginException {\n+            String currentCategory = analyticConfigurationPane.categoryList.getSelectionModel().getSelectedItem();\n+            int stateAttributeId = AnalyticViewConcept.MetaAttribute.ANALYTIC_VIEW_STATE.ensure(graph);\n+            \n+            // Make a copy in case the state on the graph is currently being modified.\n+            AnalyticViewState currentState = graph.getObjectValue(stateAttributeId, 0);\n+            currentState = (currentState == null) ? new AnalyticViewState() : new AnalyticViewState(currentState);\n+            \n+            if (pluginWasSelected) {\n+                // remove all plugins matching category\n+                currentState.removePluginsMatchingCategory(currentCategory);\n+                // grab all plugins from currently selected category\n+                List<SelectableAnalyticPlugin> checkedPlugins = new ArrayList<>();\n+                // adding items to checkedPlugins array when they are selected\n+                analyticConfigurationPane.pluginList.getItems().forEach(selectablePlugin -> {\n+                    if (selectablePlugin.isSelected()) {\n+                        checkedPlugins.add(selectablePlugin);\n+                    }\n+                });\n+                if (!checkedPlugins.isEmpty()) {\n+                    currentState.addAnalyticQuestion(analyticConfigurationPane.currentQuestion, checkedPlugins);\n+                }\n+                graph.setObjectValue(stateAttributeId, 0, currentState);\n+            }\n+            \n+            // get question only if one exists ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzUyNA==", "bodyText": "Should this be categoryWasSelected?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647524", "createdAt": "2020-01-28T07:47:26Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -582,4 +620,71 @@ public String getName() {\n             return \"Analytic View: Update State\";\n         }\n     }\n+    \n+    /**\n+     * Update the display by reading and writing to/from the state attribute. \n+     */\n+    private static final class AnalyticViewStateUpdater extends SimpleEditPlugin {\n+\n+        private final AnalyticConfigurationPane analyticConfigurationPane;\n+        private final boolean pluginWasSelected;\n+        \n+        public AnalyticViewStateUpdater(final AnalyticConfigurationPane analyticConfigurationPane, final boolean categoryWasSelected) {\n+            this.analyticConfigurationPane = analyticConfigurationPane;\n+            this.pluginWasSelected = categoryWasSelected;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzY5Mg==", "bodyText": "What is this trying to achieve?", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647692", "createdAt": "2020-01-28T07:48:00Z", "author": {"login": "cygnus-x-1"}, "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -490,15 +510,29 @@ public static final SelectableAnalyticPlugin lookupSelectablePlugin(final String\n         return NAME_TO_SELECTABLE_PLUGIN_MAP.get(selectableAnalyticPluginName);\n     }\n \n+    private static void setSuppressedFlag(final boolean newValue) {\n+        selectionSuppressed = newValue;\n+    }\n+\n     public final class SelectableAnalyticPlugin {\n \n         private final CheckBox checkbox;\n+        private ListCell<SelectableAnalyticPlugin> parent;\n         private final AnalyticPlugin plugin;\n         private PluginParameters parameters;\n         private PluginParameters updatedParameters;\n \n         public SelectableAnalyticPlugin(final AnalyticPlugin plugin) {\n             this.checkbox = new CheckBox();\n+            // Allows triggering of selection listener when a checkbox is changed\n+            this.checkbox.selectedProperty().addListener((observable, oldValue, newValue) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c"}, "originalPosition": 113}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8bad43ae498c20024996eebf50e1f941eec4b7b", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/a8bad43ae498c20024996eebf50e1f941eec4b7b", "committedDate": "2020-01-28T23:24:02Z", "message": "Refactor Analytic Config Pane\n\nName change of boolean flag pluginWasSelected"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52679593a8b80d00c5e03498cbda4203188be4c7", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/52679593a8b80d00c5e03498cbda4203188be4c7", "committedDate": "2020-01-29T23:18:31Z", "message": "Comment out unimplemented options menu\n\nLocated within Analytic View"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fee225ecddc24bf6b5fbeadbf04384d75e562cd", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/6fee225ecddc24bf6b5fbeadbf04384d75e562cd", "committedDate": "2020-01-30T00:45:50Z", "message": "Add support for multiple tabs\n\nImplement plugins stored within single list\nImplement question storage within state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3df416ef5e7c0b1bca4e9cb92868916c8c44fb3d", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/3df416ef5e7c0b1bca4e9cb92868916c8c44fb3d", "committedDate": "2020-01-30T03:40:58Z", "message": "Add graph and state listener functionality\n\nimplement change of graph and parameter loop for saving of state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19349880555d771cc6b133aa81a3bf941b21e3f5", "author": {"user": {"login": "aldebaran30701", "name": null}}, "url": "https://github.com/constellation-app/constellation/commit/19349880555d771cc6b133aa81a3bf941b21e3f5", "committedDate": "2020-02-04T00:24:45Z", "message": "Add Eventhandler to top component\n\nsuppress an event only when manual update is called initially"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODAxMjQ5", "url": "https://github.com/constellation-app/constellation/pull/215#pullrequestreview-352801249", "createdAt": "2020-02-04T08:43:43Z", "commit": {"oid": "19349880555d771cc6b133aa81a3bf941b21e3f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3900, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}