{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMDc4ODY4", "number": 4482, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNjo0NzowM1rODjtg5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNjo0NzowM1rODjtg5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NzcyNDUzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/fao/geonet/kernel/search/IndexAndTaxonomy.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNjo0NzowM1rOFvq_pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNjo0NzowM1rOFvq_pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUzMTgxMg==", "bodyText": "The taxonomyReader is used in LuceneSearcher and CatalogSearcher during the searches to build the facet summary.  In LuceneSearcher:\n\n  \n    \n      core-geonetwork/core/src/main/java/org/fao/geonet/kernel/search/LuceneSearcher.java\n    \n    \n        Lines 1649 to 1662\n      in\n      c085520\n    \n    \n    \n    \n\n        \n          \n           private TopDocs performQuery(ServiceContext context, int startHit, int endHit, boolean buildSummary) throws Exception { \n        \n\n        \n          \n               IndexAndTaxonomy indexAndTaxonomy = _sm.getIndexReader(_language.presentationLanguage, _versionToken); \n        \n\n        \n          \n               _versionToken = indexAndTaxonomy.version; \n        \n\n        \n          \n               Pair<TopDocs, Element> results; \n        \n\n        \n          \n               try { \n        \n\n        \n          \n                   results = doSearchAndMakeSummary(endHit, startHit, endHit, \n        \n\n        \n          \n                       _language.presentationLanguage, \n        \n\n        \n          \n                       _summaryConfig, _luceneConfig, \n        \n\n        \n          \n                       indexAndTaxonomy.indexReader, \n        \n\n        \n          \n                       _query, _filter, _sort, indexAndTaxonomy.taxonomyReader, \n        \n\n        \n          \n                       buildSummary); \n        \n\n        \n          \n               } finally { \n        \n\n        \n          \n                   _sm.releaseIndexReader(indexAndTaxonomy); \n        \n\n        \n          \n               } \n        \n    \n  \n\n\nProbably can be closed, but the existing code is not even calling IndexAndTaxonomy.close(), but _sm.releaseIndexReader(indexAndTaxonomy); that does the same code as in IndexAndTaxonomy.close():\n\n  \n    \n      core-geonetwork/core/src/main/java/org/fao/geonet/kernel/search/SearchManager.java\n    \n    \n        Lines 1211 to 1213\n      in\n      c085520\n    \n    \n    \n    \n\n        \n          \n           public void releaseIndexReader(IndexAndTaxonomy reader) throws InterruptedException, IOException { \n        \n\n        \n          \n               reader.indexReader.releaseToNRTManager(); \n        \n\n        \n          \n           }", "url": "https://github.com/geonetwork/core-geonetwork/pull/4482#discussion_r385531812", "createdAt": "2020-02-28T06:47:03Z", "author": {"login": "josegar74"}, "path": "core/src/main/java/org/fao/geonet/kernel/search/IndexAndTaxonomy.java", "diffHunk": "@@ -44,5 +44,7 @@ public IndexAndTaxonomy(long version, GeonetworkMultiReader indexReader, Taxonom\n     @Override\n     public void close() throws IOException {\n         indexReader.releaseToNRTManager();\n+        //TODO: this has a taxonomyReader in it, and it should be \"closed\" (decrement a ref)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe48ce70b13d509fae5a0434b532c1fce6b30f7"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4198, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}