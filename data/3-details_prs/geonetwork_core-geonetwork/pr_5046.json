{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNjgzNjMz", "number": 5046, "title": "impr iso19139 jsonld formatter", "bodyText": "fixes #4872\n\nif license is a url, use it else introduce it as a creative work (license as text fails in ggl)\nsplit out contacts to multiple roles (try to use at least 1 creator, recommended by ggl)", "createdAt": "2020-09-24T20:31:22Z", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046", "merged": true, "mergeCommit": {"oid": "bec544a39f12e697406b85af34b25bc436910461"}, "closed": true, "closedAt": "2020-09-28T13:54:13Z", "author": {"login": "pvgenuchten"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMHMDxAH2gAyNDkyNjgzNjMzOjk1ZmZjN2VjMjcxY2E0YTExOTQ3YjZhOWQ0YmFhM2ZlMjIyNmJkMWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNT94JAFqTQ5NzUzNTQxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d", "author": {"user": {"login": "pvgenuchten", "name": "paul van genuchten"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d", "committedDate": "2020-09-24T20:26:50Z", "message": "split out contacts to multiple roles\nif license is a url, use it else introduce it as a creative work"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzMzMzIy", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#pullrequestreview-497333322", "createdAt": "2020-09-28T09:22:01Z", "commit": {"oid": "95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOToyMjowMVrOHY1ZRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOToyMzo1N1rOHY1dyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgwMjY5Mg==", "bodyText": "This code adds any gmd:contact as provider, in the previous version that element was not processed. To confirm that is ok.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#discussion_r495802692", "createdAt": "2020-09-28T09:22:01Z", "author": {"login": "josegar74"}, "path": "schemas/iso19139/src/main/plugin/iso19139/formatter/jsonld/iso19139-to-jsonld.xsl", "diffHunk": "@@ -185,67 +185,45 @@\n \n \n     <!--\n-    TODO: Dispatch in author, contributor, copyrightHolder, editor, funder,\n+    Dispatch in creator, author, contributor, copyrightHolder, editor, funder,\n     producer, provider, sponsor\n-    TODO: sourceOrganization\n-      <xsl:variable name=\"role\" select=\"*/gmd:role/gmd:CI_RoleCode/@codeListValue\" />\n-      <xsl:choose>\n-        <xsl:when test=\"$role='resourceProvider'\">provider</xsl:when>\n-        <xsl:when test=\"$role='custodian'\">provider</xsl:when>\n-        <xsl:when test=\"$role='owner'\">copyrightHolder</xsl:when>\n-        <xsl:when test=\"$role='user'\">user</xsl:when>\n-        <xsl:when test=\"$role='distributor'\">publisher</xsl:when>\n-        <xsl:when test=\"$role='originator'\">sourceOrganization</xsl:when>\n-        <xsl:when test=\"$role='pointOfContact'\">provider</xsl:when>\n-        <xsl:when test=\"$role='principalInvestigator'\">producer</xsl:when>\n-        <xsl:when test=\"$role='processor'\">provider</xsl:when>\n-        <xsl:when test=\"$role='publisher'\">publisher</xsl:when>\n-        <xsl:when test=\"$role='author'\">author</xsl:when>\n-        <xsl:otherwise>provider</xsl:otherwise>\n-      </xsl:choose>\n-\n     -->\n-    \"publisher\": [\n-      <xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*\">\n-        {\n-        <!-- TODO: Id could also be website if set -->\n-        <xsl:variable name=\"id\"\n-                      select=\"gmd:contactInfo/*/gmd:address/*/gmd:electronicMailAddress/*/text()[1]\"/>\n-        \"@id\":\"<xsl:value-of select=\"$id\"/>\",\n-        \"@type\":\"Organization\"\n-        <xsl:for-each select=\"gmd:organisationName\">\n-          ,\"name\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                       select=\".\"/>\n-        </xsl:for-each>\n-        <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:electronicMailAddress\">\n-          ,\"email\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                       select=\".\"/>\n-        </xsl:for-each>\n \n-        <!-- TODO: only if children available -->\n-        ,\"contactPoint\": {\n-          \"@type\" : \"PostalAddress\"\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:country\">\n-            ,\"addressCountry\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:city\">\n-            ,\"addressLocality\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:postalCode\">\n-            ,\"postalCode\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          <xsl:for-each select=\"gmd:contactInfo/*/gmd:address/*/gmd:deliveryPoint\">\n-            ,\"streetAddress\": <xsl:apply-templates mode=\"toJsonLDLocalized\"\n-                                                   select=\".\"/>\n-          </xsl:for-each>\n-          }\n-        }\n-        <xsl:if test=\"position() != last()\">,</xsl:if>\n-      </xsl:for-each>\n-    ]\n+    \"author\": [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='author']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    <xsl:if test=\"position() != last()\">,</xsl:if>\n+    </xsl:for-each>],\n+    \"contributor\": [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='processor']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    <xsl:if test=\"position() != last()\">,</xsl:if>\n+    </xsl:for-each>],\n+    \"creator\": [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='pointOfContact' or gmd:role/gmd:CI_RoleCode/@codeListValue='originator']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    <xsl:if test=\"position() != last()\">,</xsl:if>\n+    </xsl:for-each>],\n+    \"provider\" : [<xsl:for-each select=\"gmd:identificationInfo/*/gmd:pointOfContact/*[gmd:role/gmd:CI_RoleCode/@codeListValue='resourceProvider' or gmd:role/gmd:CI_RoleCode/@codeListValue='custodian']\">\n+    <xsl:apply-templates mode=\"doContact\" select=\".\"/>\n+    </xsl:for-each>\n+    <xsl:for-each select=\"gmd:contact/*\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgwMzg0OQ==", "bodyText": "What is the reason to set the @type to the value CreativeWork?", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#discussion_r495803849", "createdAt": "2020-09-28T09:23:57Z", "author": {"login": "josegar74"}, "path": "schemas/iso19139/src/main/plugin/iso19139/formatter/jsonld/iso19139-to-jsonld.xsl", "diffHunk": "@@ -331,14 +309,66 @@\n     <xsl:if test=\"count(gmd:identificationInfo/*/gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:otherConstraints[normalize-space(.) != '']) > 0\"> \n       ,\"license\":  [<xsl:for-each \n         select=\"gmd:identificationInfo/*/gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:otherConstraints\">\n-          <xsl:apply-templates mode=\"toJsonLDLocalized\" select=\".\"/>\n+        <xsl:choose>\n+          <xsl:when test=\"starts-with(normalize-space(string-join(gco:CharacterString/text(),'')),'http') or starts-with(normalize-space(string-join(gco:CharacterString/text(),'')),'//')\">\n+            \"<xsl:value-of select=\"normalize-space(string-join(gco:CharacterString/text(),''))\"/>\"\n+          </xsl:when>\n+          <xsl:when test=\"starts-with(string-join(gmx:Anchor/@xlink:href,''),'http') or starts-with(./@xlink:href,'//')\">\n+            \"<xsl:value-of select=\"string-join(gmx:Anchor/@xlink:href,'')\"/>\"\n+          </xsl:when>\n+          <xsl:otherwise>\n+            {\n+              \"@type\": \"CreativeWork\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95ffc7ec271ca4a11947b6a9d4baa3fe2226bd1d"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6708107ea199c26b518ce9e4e94a86191b99f9a", "author": {"user": {"login": "pvgenuchten", "name": "paul van genuchten"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/e6708107ea199c26b518ce9e4e94a86191b99f9a", "committedDate": "2020-09-28T13:51:35Z", "message": "adding comment related to metadata contact as suggested by @josegar74"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NTM1NDEx", "url": "https://github.com/geonetwork/core-geonetwork/pull/5046#pullrequestreview-497535411", "createdAt": "2020-09-28T13:54:02Z", "commit": {"oid": "e6708107ea199c26b518ce9e4e94a86191b99f9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1796, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}