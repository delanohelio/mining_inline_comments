{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNDc1Njcx", "number": 5037, "title": "ISODate UTC timezone fixes", "bodyText": "Fix ISODate parsing to respect use of Z suffix to indicate UTC timezone\n Document ISODate constructor use of milliseconds against UTC timezone\n\nFor more information see #5016", "createdAt": "2020-09-23T03:38:57Z", "url": "https://github.com/geonetwork/core-geonetwork/pull/5037", "merged": true, "mergeCommit": {"oid": "582d49f0f5791452a39eaacacce7699e3a807866"}, "closed": true, "closedAt": "2020-10-02T07:04:21Z", "author": {"login": "jodygarnett"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLqU-4AFqTQ5NDUzMjEzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOgW9ggBqjM4MzI2MTE0MTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTMyMTM4", "url": "https://github.com/geonetwork/core-geonetwork/pull/5037#pullrequestreview-494532138", "createdAt": "2020-09-23T10:49:19Z", "commit": {"oid": "0d1cc265c65d2ea8a48e53e29cb31cbb7b9b74d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDo0OToyMFrOHWlVgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDo0OToyMFrOHWlVgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ0MjQzMw==", "bodyText": "Any reason to check the same thing twice?", "url": "https://github.com/geonetwork/core-geonetwork/pull/5037#discussion_r493442433", "createdAt": "2020-09-23T10:49:20Z", "author": {"login": "ianwallen"}, "path": "domain/src/main/java/org/fao/geonet/domain/ISODate.java", "diffHunk": "@@ -430,7 +447,8 @@ public void setDateAndTime(String isoDate) {\n             // JODAISODate. This class converts to UTC format to avoid timezones\n             // issues.\n             String afterT = timeAndDate.substring(indexOfT + 1);\n-            boolean timeZoneInfo = afterT.contains(\"+\") || afterT.contains(\"-\");\n+            boolean timeZoneInfo = afterT.contains(\"+\") || afterT.contains(\"-\")\n+                || afterT.endsWith(\"Z\") || afterT.endsWith(\"Z\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1cc265c65d2ea8a48e53e29cb31cbb7b9b74d6"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NjU4MTE4", "url": "https://github.com/geonetwork/core-geonetwork/pull/5037#pullrequestreview-494658118", "createdAt": "2020-09-23T13:27:14Z", "commit": {"oid": "0d1cc265c65d2ea8a48e53e29cb31cbb7b9b74d6"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzoyNzoxNFrOHWuIog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMzozMjo0OVrOHWugIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU4NjU5NA==", "bodyText": "It is incorrect to use PST since it is PDT roughly half of the year.\nGenerally prefer to use the zone name i.e. in \"Pacific Time Zone\" or \"Pacific\"\nSame for EST below.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5037#discussion_r493586594", "createdAt": "2020-09-23T13:27:14Z", "author": {"login": "ianwallen"}, "path": "domain/src/test/java/org/fao/geonet/domain/ISODateTest.java", "diffHunk": "@@ -448,4 +453,34 @@ public void testSub() throws Exception {\n         org.junit.Assert.assertEquals(-60, isoDate2.timeDifferenceInSeconds(isoDate1));\n     }\n \n+\n+    @Test\n+    public void testZ() throws Exception {\n+        ISODate isoDate = new ISODate(\"2019-06-01T00:00Z\");\n+        Instant instant = isoDate.toDate().toInstant().truncatedTo(ChronoUnit.SECONDS);\n+\n+        ZonedDateTime expectedDateTime =\n+            ZonedDateTime.of(\n+                2019, 6, 1, 0, 0, 0, 0, ZoneId.of(\"Z\").normalized());\n+        Instant expected = expectedDateTime.toInstant().truncatedTo(ChronoUnit.SECONDS);\n+        assertEquals( \"Z\", expected, instant );\n+\n+        ISODate pstDate = new ISODate(\"2019-06-01T00:00-07:00\");\n+        instant = pstDate.toDate().toInstant().truncatedTo(ChronoUnit.SECONDS);\n+\n+        ZonedDateTime pstDateTime =\n+            ZonedDateTime.of(\n+                2019, 6, 1, 0, 0, 0, 0, ZoneId.of(\"America/Vancouver\").normalized());\n+        expected = pstDateTime.toInstant().truncatedTo(ChronoUnit.SECONDS);\n+        assertEquals( \"PST\", expected, instant );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1cc265c65d2ea8a48e53e29cb31cbb7b9b74d6"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU4OTE4OA==", "bodyText": "I see that you are using \"-04:00\" in the test and comparing it to \"America/Toronto\"\nI believe this test will fail roughly half the year when it switches to EDT", "url": "https://github.com/geonetwork/core-geonetwork/pull/5037#discussion_r493589188", "createdAt": "2020-09-23T13:29:35Z", "author": {"login": "ianwallen"}, "path": "domain/src/test/java/org/fao/geonet/domain/ISODateTest.java", "diffHunk": "@@ -448,4 +453,34 @@ public void testSub() throws Exception {\n         org.junit.Assert.assertEquals(-60, isoDate2.timeDifferenceInSeconds(isoDate1));\n     }\n \n+\n+    @Test\n+    public void testZ() throws Exception {\n+        ISODate isoDate = new ISODate(\"2019-06-01T00:00Z\");\n+        Instant instant = isoDate.toDate().toInstant().truncatedTo(ChronoUnit.SECONDS);\n+\n+        ZonedDateTime expectedDateTime =\n+            ZonedDateTime.of(\n+                2019, 6, 1, 0, 0, 0, 0, ZoneId.of(\"Z\").normalized());\n+        Instant expected = expectedDateTime.toInstant().truncatedTo(ChronoUnit.SECONDS);\n+        assertEquals( \"Z\", expected, instant );\n+\n+        ISODate pstDate = new ISODate(\"2019-06-01T00:00-07:00\");\n+        instant = pstDate.toDate().toInstant().truncatedTo(ChronoUnit.SECONDS);\n+\n+        ZonedDateTime pstDateTime =\n+            ZonedDateTime.of(\n+                2019, 6, 1, 0, 0, 0, 0, ZoneId.of(\"America/Vancouver\").normalized());\n+        expected = pstDateTime.toInstant().truncatedTo(ChronoUnit.SECONDS);\n+        assertEquals( \"PST\", expected, instant );\n+\n+        ISODate estDate = new ISODate(\"2019-06-01T00:00-04:00\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1cc265c65d2ea8a48e53e29cb31cbb7b9b74d6"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU5MjYwOA==", "bodyText": "I see that you are using \"-07:00\" in the test and comparing it to \"America/Vancouver\"\nI believe this test will fail roughly half the year when it switches to PDT\nI believe you may need to get the current timezone offset for the same zone to do the comparison.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5037#discussion_r493592608", "createdAt": "2020-09-23T13:32:49Z", "author": {"login": "ianwallen"}, "path": "domain/src/test/java/org/fao/geonet/domain/ISODateTest.java", "diffHunk": "@@ -448,4 +453,34 @@ public void testSub() throws Exception {\n         org.junit.Assert.assertEquals(-60, isoDate2.timeDifferenceInSeconds(isoDate1));\n     }\n \n+\n+    @Test\n+    public void testZ() throws Exception {\n+        ISODate isoDate = new ISODate(\"2019-06-01T00:00Z\");\n+        Instant instant = isoDate.toDate().toInstant().truncatedTo(ChronoUnit.SECONDS);\n+\n+        ZonedDateTime expectedDateTime =\n+            ZonedDateTime.of(\n+                2019, 6, 1, 0, 0, 0, 0, ZoneId.of(\"Z\").normalized());\n+        Instant expected = expectedDateTime.toInstant().truncatedTo(ChronoUnit.SECONDS);\n+        assertEquals( \"Z\", expected, instant );\n+\n+        ISODate pstDate = new ISODate(\"2019-06-01T00:00-07:00\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1cc265c65d2ea8a48e53e29cb31cbb7b9b74d6"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10f1557b5f1aeb80d7cbe918480572c44824d83e", "author": {"user": {"login": "jodygarnett", "name": "Jody Garnett"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/10f1557b5f1aeb80d7cbe918480572c44824d83e", "committedDate": "2020-10-02T06:53:58Z", "message": "ISODate Z indicate UTC timezone and document ISODate constructor use of milliseconds\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b723c37c2dd1a142a98fdc2847adfa98cc4664d2", "author": {"user": {"login": "jodygarnett", "name": "Jody Garnett"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/b723c37c2dd1a142a98fdc2847adfa98cc4664d2", "committedDate": "2020-10-02T06:53:58Z", "message": "Test using UTC-04:00 rather than location for ZoneId\n\nThis prevents the tests failing due to location based ZoneId adjusting to daylight saving time changes over the course of hte year\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae284117a4e874e8e0606965ebb139982712599d", "author": {"user": {"login": "jodygarnett", "name": "Jody Garnett"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/ae284117a4e874e8e0606965ebb139982712599d", "committedDate": "2020-09-23T17:27:52Z", "message": "Test using UTC-04:00 rather than location for ZoneId\n\nThis prevents the tests failing due to location based ZoneId adjusting to daylight saving time changes over the course of hte year\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>"}, "afterCommit": {"oid": "b723c37c2dd1a142a98fdc2847adfa98cc4664d2", "author": {"user": {"login": "jodygarnett", "name": "Jody Garnett"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/b723c37c2dd1a142a98fdc2847adfa98cc4664d2", "committedDate": "2020-10-02T06:53:58Z", "message": "Test using UTC-04:00 rather than location for ZoneId\n\nThis prevents the tests failing due to location based ZoneId adjusting to daylight saving time changes over the course of hte year\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1793, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}