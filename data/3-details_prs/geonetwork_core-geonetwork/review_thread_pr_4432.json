{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNzA3MjY4", "number": 4432, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMTowMzo0OVrODeRGfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjozNFrODeaDQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDY0MDYzOnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/templates/admin/harvest/harvest-settings.html", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMTowMzo0OVrOFnUeGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMTowMzo0OVrOFnUeGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc3NDE2OQ==", "bodyText": "This change may no longer be needed, server now checks to ensure only one logfile is returned (and ensures the file exists and is readable also).", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376774169", "createdAt": "2020-02-09T11:03:49Z", "author": {"login": "jodygarnett"}, "path": "web-ui/src/main/resources/catalog/templates/admin/harvest/harvest-settings.html", "diffHunk": "@@ -238,9 +238,9 @@ <h4 data-ng-show=\"h.deleted == 'false'\" class=\"timeline-title\">\n                     {{k}}: {{v}}\n                   </li>\n                 </ul>\n-\n+                <!-- in some scenario logfile returns an array of files, take first -->\n                 <a data-ng-show=\"h.info[0].logfile\"\n-                   href=\"admin.harvester.log?file={{h.info[0].logfile}}\" target=\"_blank\"\n+                   href=\"admin.harvester.log?file={{ encodeURI((h.info[0].logfile | asArray)[0]) }}\" target=\"_blank\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjA5ODk0OnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDowNFrOFnha9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDowNFrOFnha9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NjM1Nw==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376986357", "createdAt": "2020-02-10T10:44:04Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjA5OTU3OnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDoxOVrOFnhbWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDoxOVrOFnhbWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NjQ1OA==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376986458", "createdAt": "2020-02-10T10:44:19Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwMDEzOnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDozMFrOFnhbrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDozMFrOFnhbrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NjU0Mw==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376986543", "createdAt": "2020-02-10T10:44:30Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwMDk3OnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDo0OFrOFnhcOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NDo0OFrOFnhcOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NjY4MQ==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376986681", "createdAt": "2020-02-10T10:44:48Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){\n+                 Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history unexpectedly lists multiple logfiles: \" + logfileElements.size() );\n+            }\n+            boolean isLogFileFound = false;\n+            for(Iterator iter = logfileElements.iterator(); iter.hasNext(); ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwMjY1OnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NToyNFrOFnhdVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NToyNFrOFnhdVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4Njk2Ng==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376986966", "createdAt": "2020-02-10T10:45:24Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){\n+                 Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history unexpectedly lists multiple logfiles: \" + logfileElements.size() );\n+            }\n+            boolean isLogFileFound = false;\n+            for(Iterator iter = logfileElements.iterator(); iter.hasNext(); ){\n+                Element logfile = (Element) iter.next();\n+                String path = logfile.getText();\n+                File file = new File( path );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwMzM5OnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTozNVrOFnhdvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTozNVrOFnhdvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzA2OQ==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987069", "createdAt": "2020-02-10T10:45:35Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){\n+                 Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history unexpectedly lists multiple logfiles: \" + logfileElements.size() );\n+            }\n+            boolean isLogFileFound = false;\n+            for(Iterator iter = logfileElements.iterator(); iter.hasNext(); ){\n+                Element logfile = (Element) iter.next();\n+                String path = logfile.getText();\n+                File file = new File( path );\n+                if (file.exists() && file.canRead() ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwMzgwOnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo0MlrOFnhd_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo0MlrOFnhd_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzEzMg==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987132", "createdAt": "2020-02-10T10:45:42Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){\n+                 Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history unexpectedly lists multiple logfiles: \" + logfileElements.size() );\n+            }\n+            boolean isLogFileFound = false;\n+            for(Iterator iter = logfileElements.iterator(); iter.hasNext(); ){\n+                Element logfile = (Element) iter.next();\n+                String path = logfile.getText();\n+                File file = new File( path );\n+                if (file.exists() && file.canRead() ){\n+                    if(isLogFileFound){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwNDI1OnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo1MVrOFnheRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo1MVrOFnheRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzIwNw==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987207", "createdAt": "2020-02-10T10:45:51Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){\n+                 Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history unexpectedly lists multiple logfiles: \" + logfileElements.size() );\n+            }\n+            boolean isLogFileFound = false;\n+            for(Iterator iter = logfileElements.iterator(); iter.hasNext(); ){\n+                Element logfile = (Element) iter.next();\n+                String path = logfile.getText();\n+                File file = new File( path );\n+                if (file.exists() && file.canRead() ){\n+                    if(isLogFileFound){\n+                        // we already have one logfile\n+                        Log.warning(Constants.DOMAIN_LOG_MODULE, \"Ignoring add unexpected logfile: `\" + path +\"`\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwNDgxOnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo1OVrOFnhemg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NTo1OVrOFnhemg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzI5MA==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987290", "createdAt": "2020-02-10T10:45:59Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){\n+                 Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history unexpectedly lists multiple logfiles: \" + logfileElements.size() );\n+            }\n+            boolean isLogFileFound = false;\n+            for(Iterator iter = logfileElements.iterator(); iter.hasNext(); ){\n+                Element logfile = (Element) iter.next();\n+                String path = logfile.getText();\n+                File file = new File( path );\n+                if (file.exists() && file.canRead() ){\n+                    if(isLogFileFound){\n+                        // we already have one logfile\n+                        Log.warning(Constants.DOMAIN_LOG_MODULE, \"Ignoring add unexpected logfile: `\" + path +\"`\");\n+                        iter.remove();\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwNTQ1OnYy", "diffSide": "RIGHT", "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjowOVrOFnhe9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjowOVrOFnhe9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzM4MA==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987380", "createdAt": "2020-02-10T10:46:09Z", "author": {"login": "juanluisrp"}, "path": "domain/src/main/java/org/fao/geonet/domain/HarvestHistory.java", "diffHunk": "@@ -271,7 +274,53 @@ public Element getInfoAsXml() throws IOException, JDOMException {\n         if (info == null) {\n             return null;\n         }\n-        return Xml.loadString(info, false);\n+        Element infoAsXml = Xml.loadString(info, false);\n+        infoAsXml = checkInfoXml( infoAsXml );\n+        return infoAsXml;\n+    }\n+\n+    /**\n+     * Check infoAsXml definition content.\n+     * <p>\n+     * Content checks:\n+     * <ul>\n+     *     <li>Check if multiple logfile definitions are present</li>\n+     *     <li>Check if logfile path file exists /li>\n+     * </ul>\n+     *\n+     * </p>\n+     * @param infoAsXml Harvest info xml definition\n+     * @return Harvest info xml definition, with any content checks applied\n+     */\n+    private Element checkInfoXml(Element infoAsXml) {\n+        List<Element> logfileElements = infoAsXml.getChildren(\"logfile\");\n+        // check logfiles present to ensure path exists\n+        if( logfileElements.size() > 0 ) {\n+            if( logfileElements.size() != 1 ){\n+                 Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history unexpectedly lists multiple logfiles: \" + logfileElements.size() );\n+            }\n+            boolean isLogFileFound = false;\n+            for(Iterator iter = logfileElements.iterator(); iter.hasNext(); ){\n+                Element logfile = (Element) iter.next();\n+                String path = logfile.getText();\n+                File file = new File( path );\n+                if (file.exists() && file.canRead() ){\n+                    if(isLogFileFound){\n+                        // we already have one logfile\n+                        Log.warning(Constants.DOMAIN_LOG_MODULE, \"Ignoring add unexpected logfile: `\" + path +\"`\");\n+                        iter.remove();\n+                    }\n+                    else {\n+                        isLogFileFound = true;\n+                    }\n+                }\n+                else {\n+                    Log.warning(Constants.DOMAIN_LOG_MODULE, \"Harvest history logfile `\"+path+\"` ignored, no longer available\" );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwNTkyOnYy", "diffSide": "RIGHT", "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjoxN1rOFnhfNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjoxN1rOFnhfNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzQ0Nw==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987447", "createdAt": "2020-02-10T10:46:17Z", "author": {"login": "juanluisrp"}, "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java", "diffHunk": "@@ -712,8 +712,15 @@ private void logHarvest(String logfile, Logger logger, String nodeName, String l\n             if (error != null) {\n                 result = JeevesException.toElement(error);\n             }\n+            Element priorLogfile_ = result.getChild(\"logfile\");\n+            if( priorLogfile_ != null ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwNjI0OnYy", "diffSide": "RIGHT", "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjoyNFrOFnhfbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjoyNFrOFnhfbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzUwMg==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987502", "createdAt": "2020-02-10T10:46:24Z", "author": {"login": "juanluisrp"}, "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java", "diffHunk": "@@ -712,8 +712,15 @@ private void logHarvest(String logfile, Logger logger, String nodeName, String l\n             if (error != null) {\n                 result = JeevesException.toElement(error);\n             }\n+            Element priorLogfile_ = result.getChild(\"logfile\");\n+            if( priorLogfile_ != null ){\n+                // removing prior logfile\n+                logger.warning(\"Detected duplicate logfile: \"+priorLogfile_.getText());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjEwNjkwOnYy", "diffSide": "RIGHT", "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjozNFrOFnhf0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDo0NjozNFrOFnhf0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk4NzYwMQ==", "bodyText": "Follow project coding conventions", "url": "https://github.com/geonetwork/core-geonetwork/pull/4432#discussion_r376987601", "createdAt": "2020-02-10T10:46:34Z", "author": {"login": "juanluisrp"}, "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/AbstractHarvester.java", "diffHunk": "@@ -712,8 +712,15 @@ private void logHarvest(String logfile, Logger logger, String nodeName, String l\n             if (error != null) {\n                 result = JeevesException.toElement(error);\n             }\n+            Element priorLogfile_ = result.getChild(\"logfile\");\n+            if( priorLogfile_ != null ){\n+                // removing prior logfile\n+                logger.warning(\"Detected duplicate logfile: \"+priorLogfile_.getText());\n+                result.getChildren().remove( priorLogfile_ );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae8d4de56b57c0e93987897f9e689927962a9e03"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4220, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}