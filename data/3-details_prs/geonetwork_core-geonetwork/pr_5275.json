{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMzg2Mzc3", "number": 5275, "title": "Update-fixed-info / Use db dates ", "bodyText": "Set the update date to the same date as in the database.\nIn ISO19115-3, also set record creation date from the database date.\n\nThe issue here is that if you duplicate an ISO19115-3 records, the create date of the record is the one from the copy.\nThis change allow user to remove the creation date in the editor and then the db date is used to set the value. Not an optimal option.\n@josegar74 any other suggestion to handle that case?", "createdAt": "2020-12-18T08:14:38Z", "url": "https://github.com/geonetwork/core-geonetwork/pull/5275", "merged": true, "mergeCommit": {"oid": "aef2a2f23fff5740701cf983314392c2aba86a39"}, "closed": true, "closedAt": "2021-04-14T05:49:32Z", "author": {"login": "fxprunayre"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnTnEUgH2gAyNTQyMzg2Mzc3OmMyNjRjZGVjZWQ4ZjY5ZWFjOWUzZTlmMmY0ODkxN2JhOTA4MDRiOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeM7tYlgFqTYzNTIzMjEyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c264cdeced8f69eac9e3e9f2f48917ba90804b95", "author": {"user": {"login": "fxprunayre", "name": "Fran\u00e7ois Prunayre"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/c264cdeced8f69eac9e3e9f2f48917ba90804b95", "committedDate": "2020-12-18T08:11:09Z", "message": "Update-fixed-info / Set the update date to the same date as in the database. In ISO19115-3, also set record creation date from the database date."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MzYyNDEz", "url": "https://github.com/geonetwork/core-geonetwork/pull/5275#pullrequestreview-556362413", "createdAt": "2020-12-21T13:02:23Z", "commit": {"oid": "c264cdeced8f69eac9e3e9f2f48917ba90804b95"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMzowMjoyNFrOIJXhJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMzowMzoyNFrOIJXirQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY5MzQxNQ==", "bodyText": "There's some previous code doing similar stuff:\n\n  \n    \n      core-geonetwork/core/src/main/java/org/fao/geonet/kernel/datamanager/base/BaseMetadataManager.java\n    \n    \n        Lines 918 to 920\n      in\n      c264cde\n    \n    \n    \n    \n\n        \n          \n           if (metadataId.isPresent()) { \n        \n\n        \n          \n               metadata = metadataUtils.findOne(metadataId.get()); \n        \n\n        \n          \n           }", "url": "https://github.com/geonetwork/core-geonetwork/pull/5275#discussion_r546693415", "createdAt": "2020-12-21T13:02:24Z", "author": {"login": "josegar74"}, "path": "core/src/main/java/org/fao/geonet/kernel/datamanager/base/BaseMetadataManager.java", "diffHunk": "@@ -935,7 +935,17 @@ public Element updateFixedInfo(String schema, Optional<Integer> metadataId, Stri\n             env.addContent(schemaLoc);\n \n             if (updateDatestamp == UpdateDatestamp.YES) {\n-                env.addContent(new Element(\"changeDate\").setText(new ISODate().toString()));\n+                String changeDate = new ISODate().toString();\n+                String createDate = \"\";\n+                if (metadataId.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c264cdeced8f69eac9e3e9f2f48917ba90804b95"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY5MzgwNQ==", "bodyText": "update-fixed-info is applied before the metadata is saved in the database, no? I think this code will retrieve the previous change date?", "url": "https://github.com/geonetwork/core-geonetwork/pull/5275#discussion_r546693805", "createdAt": "2020-12-21T13:03:24Z", "author": {"login": "josegar74"}, "path": "core/src/main/java/org/fao/geonet/kernel/datamanager/base/BaseMetadataManager.java", "diffHunk": "@@ -935,7 +935,17 @@ public Element updateFixedInfo(String schema, Optional<Integer> metadataId, Stri\n             env.addContent(schemaLoc);\n \n             if (updateDatestamp == UpdateDatestamp.YES) {\n-                env.addContent(new Element(\"changeDate\").setText(new ISODate().toString()));\n+                String changeDate = new ISODate().toString();\n+                String createDate = \"\";\n+                if (metadataId.isPresent()) {\n+                    java.util.Optional<Metadata> record = metadataRepository.findById(metadataId.get());\n+                    if (record.isPresent()) {\n+                        changeDate = record.get().getDataInfo().getChangeDate().getDateAndTime();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c264cdeced8f69eac9e3e9f2f48917ba90804b95"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "357c70cdc236888e71f7c1cb6b7f0354065f481f", "author": {"user": {"login": "fxprunayre", "name": "Fran\u00e7ois Prunayre"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/357c70cdc236888e71f7c1cb6b7f0354065f481f", "committedDate": "2021-04-13T08:52:34Z", "message": "Update-fixed-info / Use db dates / Remove existing check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c5d30dd0d595fc0ca910635c3242e39aa4272d1", "author": {"user": {"login": "fxprunayre", "name": "Fran\u00e7ois Prunayre"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/6c5d30dd0d595fc0ca910635c3242e39aa4272d1", "committedDate": "2021-04-13T08:53:31Z", "message": "Update-fixed-info / Use db dates / Remove existing check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM1MjMyMTIz", "url": "https://github.com/geonetwork/core-geonetwork/pull/5275#pullrequestreview-635232123", "createdAt": "2021-04-14T05:49:27Z", "commit": {"oid": "6c5d30dd0d595fc0ca910635c3242e39aa4272d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1732, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}