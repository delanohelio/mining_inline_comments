{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNDE3MDQ2", "number": 5140, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjozMToxM1rOE0W5vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNjoxODoyOFrOE0crDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzM2NjM5OnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/partials/wfsfilterfacet.html", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjozMToxM1rOHsCarQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNTo1NTo1NVrOHsKfNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkzODk4OQ==", "bodyText": "this sounds highly related to sextant no?", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r515938989", "createdAt": "2020-11-02T12:31:13Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/partials/wfsfilterfacet.html", "diffHunk": "@@ -95,11 +95,16 @@ <h5 gn-collapsible=\"indexObject.geomField.expanded\">\n     <!--admin buttons-->\n     <div class=\"btn-group dropup wfs-filter-group\">\n       <button class=\"btn btn-default btn-xs\" ng-class=\"{ disabled: !filtersChanged }\"\n-        data-gn-click-and-spin=\"filterWMS()\"\n-        data-gn-click-and-spin-stay-disabled=\"true\">\n+              data-gn-click-and-spin=\"filterWMS()\"\n+              data-gn-click-and-spin-stay-disabled=\"true\">\n         <i class=\"fa fa-filter\"></i>&nbsp;\n         <span data-translate=\"\">applyFilter</span>\n       </button>\n+      <button  ng-if=\"::sextant\" class=\"btn btn-default btn-xs\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f695a84a4a7e16cd14673da63c368bdf5fb221bb"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MTIyMA==", "bodyText": "I did not find what is this used for in sextant. Just dropped.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r516071220", "createdAt": "2020-11-02T15:55:55Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/partials/wfsfilterfacet.html", "diffHunk": "@@ -95,11 +95,16 @@ <h5 gn-collapsible=\"indexObject.geomField.expanded\">\n     <!--admin buttons-->\n     <div class=\"btn-group dropup wfs-filter-group\">\n       <button class=\"btn btn-default btn-xs\" ng-class=\"{ disabled: !filtersChanged }\"\n-        data-gn-click-and-spin=\"filterWMS()\"\n-        data-gn-click-and-spin-stay-disabled=\"true\">\n+              data-gn-click-and-spin=\"filterWMS()\"\n+              data-gn-click-and-spin-stay-disabled=\"true\">\n         <i class=\"fa fa-filter\"></i>&nbsp;\n         <span data-translate=\"\">applyFilter</span>\n       </button>\n+      <button  ng-if=\"::sextant\" class=\"btn btn-default btn-xs\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkzODk4OQ=="}, "originalCommit": {"oid": "f695a84a4a7e16cd14673da63c368bdf5fb221bb"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzQzNDgwOnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo1MDo0MlrOHsDClQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNTo1NjoxOFrOHsKgSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0OTIwNQ==", "bodyText": "Same here, looks to be used in Sextant for something else\n\n          // SEXTANT SPECIFIC\n          // use nested wms if we're in a group\n          if (scope.baseLayer.get('originalWms')) {\n            scope.layer = scope.baseLayer.get('originalWms');\n          } else {\n            scope.layer = scope.baseLayer\n          }\n          // END SEXTANT SPECIFIC\n\nCurrently layer is never set ... maybe we should add some config to handle both strategies.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r515949205", "createdAt": "2020-11-02T12:50:42Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -110,24 +110,29 @@\n     'wfsFilterService',\n     '$q',\n     '$rootScope',\n+    '$translate',\n     'gnIndexRequestManager',\n     'gnIndexService',\n     'gnGlobalSettings',\n     'gnSearchSettings',\n     'gnFeaturesTableManager',\n-    function($http, wfsFilterService, $q, $rootScope,\n+    'gnHttp',\n+    'gnAlertService',\n+    'gnFacetTree',\n+    function($http, wfsFilterService, $q, $rootScope, $translate,\n              gnIndexRequestManager, gnIndexService, gnGlobalSettings,\n-             gnSearchSettings, gnFeaturesTableManager) {\n+             gnSearchSettings, gnFeaturesTableManager, gnHttp,\n+             gnAlertService, gnFacetTree) {\n       return {\n         restrict: 'A',\n         replace: true,\n         templateUrl: '../../catalog/components/viewer/wfsfilter/' +\n-            'partials/wfsfilterfacet.html',\n+          'partials/wfsfilterfacet.html',\n         scope: {\n           featureTypeName: '@',\n           wfsUrl: '@',\n           displayCount: '@',\n-          layer: '='\n+          baseLayer: '=layer'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f695a84a4a7e16cd14673da63c368bdf5fb221bb"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MTQ5Ng==", "bodyText": "Added both. Sextant can set baseLayer if needed which takes priority.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r516071496", "createdAt": "2020-11-02T15:56:18Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -110,24 +110,29 @@\n     'wfsFilterService',\n     '$q',\n     '$rootScope',\n+    '$translate',\n     'gnIndexRequestManager',\n     'gnIndexService',\n     'gnGlobalSettings',\n     'gnSearchSettings',\n     'gnFeaturesTableManager',\n-    function($http, wfsFilterService, $q, $rootScope,\n+    'gnHttp',\n+    'gnAlertService',\n+    'gnFacetTree',\n+    function($http, wfsFilterService, $q, $rootScope, $translate,\n              gnIndexRequestManager, gnIndexService, gnGlobalSettings,\n-             gnSearchSettings, gnFeaturesTableManager) {\n+             gnSearchSettings, gnFeaturesTableManager, gnHttp,\n+             gnAlertService, gnFacetTree) {\n       return {\n         restrict: 'A',\n         replace: true,\n         templateUrl: '../../catalog/components/viewer/wfsfilter/' +\n-            'partials/wfsfilterfacet.html',\n+          'partials/wfsfilterfacet.html',\n         scope: {\n           featureTypeName: '@',\n           wfsUrl: '@',\n           displayCount: '@',\n-          layer: '='\n+          baseLayer: '=layer'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0OTIwNQ=="}, "originalCommit": {"oid": "f695a84a4a7e16cd14673da63c368bdf5fb221bb"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzQ2MDE3OnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo1NzozN1rOHsDRzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo1NzozN1rOHsDRzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk1MzEwMA==", "bodyText": "No, if version 4, you don't need this function call.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r515953100", "createdAt": "2020-11-02T12:57:37Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -193,28 +200,29 @@\n                 scope.wfsUrl || scope.layer.get('url').replace(/wms/i, 'wfs'))\n             });\n \n-            uuid = scope.md && scope.md.uuid;\n+            uuid = scope.md && scope.md.getUuid();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f695a84a4a7e16cd14673da63c368bdf5fb221bb"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzQ4MjkzOnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterService.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMzowNDoxMlrOHsDfmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMzoyMDo0OFrOHsEE8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk1NjYzMg==", "bodyText": "Do not reintroduce version number in API path. In version 4, the API version is GN version. Version in path has been removed.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r515956632", "createdAt": "2020-11-02T13:04:12Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterService.js", "diffHunk": "@@ -195,12 +276,12 @@\n        * @param {string} wfsUrl url of the wfs service\n        */\n       this.getApplicationProfile = function(uuid, ftName, wfsUrl, protocol) {\n-        return $http.post('../api/records/' + uuid +\n-            '/query/wfs-indexing-config', {\n-              url: wfsUrl,\n-              name: ftName,\n-              protocol: protocol\n-            });\n+        return $http.post('../api/0.1/records/' + uuid +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2519c3c30710b49628de9e0ee40a64b93b6cd2e6"}, "originalPosition": 205}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk2NjE5NA==", "bodyText": "noted, thanks", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r515966194", "createdAt": "2020-11-02T13:20:48Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterService.js", "diffHunk": "@@ -195,12 +276,12 @@\n        * @param {string} wfsUrl url of the wfs service\n        */\n       this.getApplicationProfile = function(uuid, ftName, wfsUrl, protocol) {\n-        return $http.post('../api/records/' + uuid +\n-            '/query/wfs-indexing-config', {\n-              url: wfsUrl,\n-              name: ftName,\n-              protocol: protocol\n-            });\n+        return $http.post('../api/0.1/records/' + uuid +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk1NjYzMg=="}, "originalCommit": {"oid": "2519c3c30710b49628de9e0ee40a64b93b6cd2e6"}, "originalPosition": 205}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzY0NDM5OnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMzo0ODoxOFrOHsFCkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNTo1Njo0NVrOHsKhfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4MTk2OQ==", "bodyText": "Maybe we should continue to support both approach. md and Linkstree field may not be defined. Will rework it with a promise.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r515981969", "createdAt": "2020-11-02T13:48:18Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -712,15 +816,31 @@\n            * Only available for administrators.\n            */\n           scope.indexWFSFeatures = function(version) {\n-            appProfilePromise.then(function() {\n-              wfsFilterService.indexWFSFeatures(\n-                  scope.url,\n-                  ftName,\n-                  appProfile ? appProfile.tokenizedFields : null,\n-                  appProfile ? appProfile.treeFields : null,\n-                  uuid,\n-                  version);\n-            });\n+            var applicationProfile = scope.md.linksTree.map(function (d) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2519c3c30710b49628de9e0ee40a64b93b6cd2e6"}, "originalPosition": 510}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MTgwNQ==", "bodyText": "Restored a promise which resolves to linksTree if defined.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r516071805", "createdAt": "2020-11-02T15:56:45Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -712,15 +816,31 @@\n            * Only available for administrators.\n            */\n           scope.indexWFSFeatures = function(version) {\n-            appProfilePromise.then(function() {\n-              wfsFilterService.indexWFSFeatures(\n-                  scope.url,\n-                  ftName,\n-                  appProfile ? appProfile.tokenizedFields : null,\n-                  appProfile ? appProfile.treeFields : null,\n-                  uuid,\n-                  version);\n-            });\n+            var applicationProfile = scope.md.linksTree.map(function (d) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4MTk2OQ=="}, "originalCommit": {"oid": "2519c3c30710b49628de9e0ee40a64b93b6cd2e6"}, "originalPosition": 510}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDMxMTgxOnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNjoxODoyOFrOHsLdkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNjozNDo1OFrOHsMMtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA4NzE4Nw==", "bodyText": "Maybe we should add the missing entries here? \n  \n    \n      core-geonetwork/web-ui/src/main/resources/catalog/components/catalog/CatalogService.js\n    \n    \n         Line 321\n      in\n      6991fff\n    \n    \n    \n    \n\n        \n          \n           indexproxy: '../../index/records' \n        \n    \n  \n\n\nInstead of writing down a hardcoded url.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r516087187", "createdAt": "2020-11-02T16:18:28Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -991,7 +980,7 @@\n           }\n \n           // check whether the WFS service is already in the database\n-          scope.messageProducersApiUrl = gnHttp.getService('wfsMessageProducers');\n+          scope.messageProducersApiUrl = '../api/msg_producers';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6991fffabc8566339c48cb8b23b919d259dbe9b8"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5Mzc4MA==", "bodyText": "The gnHttpServices\nhttps://github.com/geonetwork/core-geonetwork/blame/4.0.x/web-ui/src/main/resources/catalog/components/catalog/CatalogService.js#L299-L322 has not been modified in the last 2 years, so probably not the main way we are using for accessing the API (even if it was probably a good idea 7 years ago).", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r516093780", "createdAt": "2020-11-02T16:27:42Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -991,7 +980,7 @@\n           }\n \n           // check whether the WFS service is already in the database\n-          scope.messageProducersApiUrl = gnHttp.getService('wfsMessageProducers');\n+          scope.messageProducersApiUrl = '../api/msg_producers';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA4NzE4Nw=="}, "originalCommit": {"oid": "6991fffabc8566339c48cb8b23b919d259dbe9b8"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5OTI1Mw==", "bodyText": "Ok, no worries", "url": "https://github.com/geonetwork/core-geonetwork/pull/5140#discussion_r516099253", "createdAt": "2020-11-02T16:34:58Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/viewer/wfsfilter/WfsFilterDirective.js", "diffHunk": "@@ -991,7 +980,7 @@\n           }\n \n           // check whether the WFS service is already in the database\n-          scope.messageProducersApiUrl = gnHttp.getService('wfsMessageProducers');\n+          scope.messageProducersApiUrl = '../api/msg_producers';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA4NzE4Nw=="}, "originalCommit": {"oid": "6991fffabc8566339c48cb8b23b919d259dbe9b8"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4271, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}