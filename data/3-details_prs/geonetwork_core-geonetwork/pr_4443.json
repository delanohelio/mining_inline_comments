{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0MTk4MjI5", "number": 4443, "title": "Stop infinite CSW harvester loop if start > nextRecord", "bodyText": "Some server aren't compliant with CSW specification. In some cases they can  return a value\ndifferent of 0 for nextRecord when the harvester has reached the end of the available\nresults.\nThis commit stops the harvesting loop if the value of nextResult returned by the server\nis smaller than the current start record.\nCould be a complement to #3713.", "createdAt": "2020-02-12T09:28:55Z", "url": "https://github.com/geonetwork/core-geonetwork/pull/4443", "merged": true, "mergeCommit": {"oid": "94586e42f6f6236d0a65ab09174e05f13c0a3630"}, "closed": true, "closedAt": "2020-02-13T12:30:08Z", "author": {"login": "juanluisrp"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDi1F0gH2gAyMzc0MTk4MjI5OmQ2NjAwN2NiMmNmZGU5NDk3NmM2YWQyYjcyZTQ5ZGE0MjE1MTI3NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDo4rfAFqTM1NzU5NzAxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d66007cb2cfde94976c6ad2b72e49da421512754", "author": {"user": {"login": "juanluisrp", "name": "Juan Luis Rodr\u00edguez Ponce"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/d66007cb2cfde94976c6ad2b72e49da421512754", "committedDate": "2020-02-12T09:22:37Z", "message": "Stop infinite harvester loop if start > nextRecord\n\nSome server aren't compliant with CSW specification. In some cases they can  return a value\ndifferent of 0 for nextRecord when the harvester has reached the end of the available\nresults.\nThis commit stops the harvesting loop if the value of `nextResult` returned by the server\nis smaller than the current `start` record.\n\nCould be a complement to #3713."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDkyNjcw", "url": "https://github.com/geonetwork/core-geonetwork/pull/4443#pullrequestreview-357492670", "createdAt": "2020-02-12T14:26:20Z", "commit": {"oid": "d66007cb2cfde94976c6ad2b72e49da421512754"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNDoyNjoyMFrOFowj9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNDoyNjoyMFrOFowj9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI4Mjk5Nw==", "bodyText": "This is a nice detailed warning", "url": "https://github.com/geonetwork/core-geonetwork/pull/4443#discussion_r378282997", "createdAt": "2020-02-12T14:26:20Z", "author": {"login": "jodygarnett"}, "path": "harvesters/src/main/java/org/fao/geonet/kernel/harvest/harvester/csw/Harvester.java", "diffHunk": "@@ -375,14 +379,19 @@ private void searchAndAlign(CswServer server, Search s, Set<String> uuids,\n                 break;\n             }\n \n+            // Some misbehaving CSW return nextRecord = 1 when start is over numberOfRecordsMatched\n+            // Break the loop if nextRecord is smaller than start.\n+            if (nextRecord != null && nextRecord < start) {\n+                log.warning(String.format(\"Forcing harvest end since nextRecord < start (nextRecord = %d, start = %d)\", nextRecord, start));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d66007cb2cfde94976c6ad2b72e49da421512754"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDkzOTYy", "url": "https://github.com/geonetwork/core-geonetwork/pull/4443#pullrequestreview-357493962", "createdAt": "2020-02-12T14:27:52Z", "commit": {"oid": "d66007cb2cfde94976c6ad2b72e49da421512754"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NTk3MDEx", "url": "https://github.com/geonetwork/core-geonetwork/pull/4443#pullrequestreview-357597011", "createdAt": "2020-02-12T16:25:58Z", "commit": {"oid": "d66007cb2cfde94976c6ad2b72e49da421512754"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1663, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}