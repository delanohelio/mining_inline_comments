{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzUzOTUx", "number": 4599, "title": "JNDI support improvements", "bodyText": "JNDI support improvements:\n\nAdd examples for Tomcat configuration.\nChange Jetty JNDI to use H2 by default.\nSupport different databases (current support was focus on Postgres).\n\nJNDI example files for Tomcat\nThis folder contains JNDI example files for Tomcat for H2, Oracle and Postgres.\n\nPick the jndi configuration for the database you want to use and fill the relevant parameters for your database\nRename the file to geonetwork.xml (or to appName.xml if you use another name)\nPut the file inside TOMCAT_DIR/conf/Catalina/localhost\nBe sure that the jar for the driver you want to use is in TOMCAT_DIR/lib\n\nNote: replace TOMCAT_DIR with Tomcat path.\nCheck the following links for additional documentation about JNDI configuration in Tomcat:\n\nhttps://tomcat.apache.org/tomcat-8.5-doc/jndi-resources-howto.html#JDBC_Data_Sources\nhttps://tomcat.apache.org/tomcat-8.5-doc/jndi-datasource-examples-howto.html\n\nPostgres database example\nFor a Postgres database use the file postgres_JNDI_Example.xml, configuring the following parameters:\n\nurl: JDBC connection string for Postgresql database, typically fill the hostname/port/database name. See additional parameters in https://jdbc.postgresql.org/documentation/head/connect.html\nusername: database username with read/write permissions in the database\npassword: database user password.\nFor other parameters check additional documentation in https://tomcat.apache.org/tomcat-8.5-doc/jndi-resources-howto.html#JDBC_Data_Sources\n\n<Context>\n  <Environment name=\"gnDatabaseDialect\" value=\"POSTGRESQL\" type=\"java.lang.String\" override=\"false\"/>\n  <Resource name=\"jdbc/geonetwork\" auth=\"Container\"\n            factory=\"org.apache.tomcat.jdbc.pool.DataSourceFactory\"\n            type=\"javax.sql.DataSource\" driverClassName=\"org.postgresql.Driver\"\n            url=\"jdbc:postgresql://localhost:5432/postgres\"\n            username=\"postgres\" password=\"postgres\" \n            maxActive=\"20\" maxIdle=\"10\" defaultAutoCommit=\"false\" maxWait=\"-1\"/>\n</Context>\nOnce configured, assuming GeoNetwork is deployed as geonetwork (otherwise use the proper application name),\nrename the file to geonetwork.xml and copy it to TOMCAT_DIR/conf/Catalina/localhost.\nCopy the Postgresql JDBC driver to TOMCAT_DIR/lib.\nNote: replace TOMCAT_DIR with Tomcat path.\nPostgis support\nAdditionally if you want to enable the spatial index to be stored in Postgis, you should add the Postgis extension to your database:\nCREATE EXTENSION postgis;\nSee additional details in https://postgis.net/install/\nAnd uncomment the following Spring beans in the file TOMCAT_DIR/webapps/geonetwork/WEB-INF/config-db/jndi.xml:\n  <!-- Enable for PostGis configuration with JNDI -->\n  <bean id=\"datastoreFactory\" class=\"org.geotools.data.postgis.PostgisNGJNDIDataStoreFactory\"/>\n  <bean id=\"datastore\" factory-bean=\"datastoreFactory\" factory-method=\"createDataStore\">\n    <constructor-arg>\n      <map>\n        <description>The datastore factory parameters see Geotools documentation for details.\n          http://docs.geotools.org/latest/userguide/library/data/datastore.html\n        </description>\n        <entry key=\"dbtype\" value=\"postgis\"/>\n        <entry key=\"Data Source\" value-ref=\"jdbcDataSource\"/>\n        <entry key=\"Loose bbox\" value=\"true\"/>\n        <entry key=\"Estimated extends\" value=\"true\"/>\n        <entry key=\"encode functions\" value=\"true\"/>\n        <entry key=\"validate connections\" value=\"true\"/>\n        <entry key=\"fetch size\" value=\"1000\"/>\n        <entry key=\"Expose primary keys\" value=\"true\"/>\n      </map>\n    </constructor-arg>\n  </bean>", "createdAt": "2020-04-13T17:38:59Z", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599", "merged": true, "mergeCommit": {"oid": "b1c4a20fab2e8c1d7bd07a2936d9210b3485abec"}, "closed": true, "closedAt": "2020-04-22T08:18:35Z", "author": {"login": "josegar74"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXSdrhgH2gAyNDAyNzUzOTUxOmYxMDE1MzIyM2E1ZDU2ZTBkYzViYmI4NWNjYzc1NTU4N2ExYzQyNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ5zSkAFqTM5NzY1NDg1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f10153223a5d56e0dc5bbb85ccc755587a1c4269", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/f10153223a5d56e0dc5bbb85ccc755587a1c4269", "committedDate": "2020-04-13T17:37:03Z", "message": "JNDI support improvements:\n- Add examples for Tomcat configuration.\n- Change Jetty JNDI to use H2 by default.\n- Support different databases (current support was focus on Postgres)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyOTY1OTAy", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#pullrequestreview-392965902", "createdAt": "2020-04-14T14:10:59Z", "commit": {"oid": "f10153223a5d56e0dc5bbb85ccc755587a1c4269"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDoxMDo1OVrOGFQj6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDoxMDo1OVrOGFQj6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE2NzQwMw==", "bodyText": "why are we setting this to public?\ncan't we take this value from the jndi configuration?", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408167403", "createdAt": "2020-04-14T14:10:59Z", "author": {"login": "pvgenuchten"}, "path": "web/src/main/webResources/WEB-INF/config-db/jndi.xml", "diffHunk": "@@ -62,14 +52,12 @@\n         <entry key=\"Data Source\" value-ref=\"jdbcDataSource\"/>\n         <entry key=\"Loose bbox\" value=\"true\"/>\n         <entry key=\"Estimated extends\" value=\"true\"/>\n-        <entry key=\"schema\" value=\"${database.schema}\" />\n+        <entry key=\"schema\" value=\"public\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f10153223a5d56e0dc5bbb85ccc755587a1c4269"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyOTcwMTkx", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#pullrequestreview-392970191", "createdAt": "2020-04-14T14:15:21Z", "commit": {"oid": "f10153223a5d56e0dc5bbb85ccc755587a1c4269"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDoxNToyMlrOGFQwqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDoxNToyMlrOGFQwqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3MDY2NQ==", "bodyText": "can we provide some guidance here, like:\n\nmove this file into tomcat/conf folder (I guess this is the step required?)\nfill relevant connection parameters\nread more about jndi in tomcat at ...", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#discussion_r408170665", "createdAt": "2020-04-14T14:15:22Z", "author": {"login": "pvgenuchten"}, "path": "web/src/main/webResources/WEB-INF/config-db/jndiExamples_tomcat/oracle_JNDI_Example.xml", "diffHunk": "@@ -0,0 +1,32 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright (C) 2001-2016 Food and Agriculture Organization of the\n+  ~ United Nations (FAO-UN), United Nations World Food Programme (WFP)\n+  ~ and United Nations Environment Programme (UNEP)\n+  ~\n+  ~ This program is free software; you can redistribute it and/or modify\n+  ~ it under the terms of the GNU General Public License as published by\n+  ~ the Free Software Foundation; either version 2 of the License, or (at\n+  ~ your option) any later version.\n+  ~\n+  ~ This program is distributed in the hope that it will be useful, but\n+  ~ WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU General Public License\n+  ~ along with this program; if not, write to the Free Software\n+  ~ Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA\n+  ~\n+  ~ Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,\n+  ~ Rome - Italy. email: geonetwork@osgeo.org\n+  -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f10153223a5d56e0dc5bbb85ccc755587a1c4269"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9aaad92709f0c70e1c87635f858ffe7cc377774", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/e9aaad92709f0c70e1c87635f858ffe7cc377774", "committedDate": "2020-04-15T07:42:55Z", "message": "JNDI support improvements - remove schema from postgis JNDI datastore, should use the schema configured in the JNDI (https://docs.geotools.org/stable/userguide/library/jdbc/datastore.html#using-jndi)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccc7f0fc792c6d5e3f57acec22d6ecf0ec50c1fc", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/ccc7f0fc792c6d5e3f57acec22d6ecf0ec50c1fc", "committedDate": "2020-04-15T08:05:37Z", "message": "JNDI support improvements - additional documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjUzODc2", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#pullrequestreview-397653876", "createdAt": "2020-04-21T20:33:22Z", "commit": {"oid": "ccc7f0fc792c6d5e3f57acec22d6ecf0ec50c1fc"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjU0ODUz", "url": "https://github.com/geonetwork/core-geonetwork/pull/4599#pullrequestreview-397654853", "createdAt": "2020-04-21T20:34:48Z", "commit": {"oid": "ccc7f0fc792c6d5e3f57acec22d6ecf0ec50c1fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1618, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}