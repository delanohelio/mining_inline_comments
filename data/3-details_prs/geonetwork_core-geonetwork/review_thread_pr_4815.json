{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMTE0MDc4", "number": 4815, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxMzo0NVrOEKfFiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNToxMzowMlrOEK8G0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDMwNTM3OnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/SearchFilterTagsDirective.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxMzo0NVrOGrjUyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjoxMzo0NVrOGrjUyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMDcxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    let elem = {};\n          \n          \n            \n                                    var elem = {};", "url": "https://github.com/geonetwork/core-geonetwork/pull/4815#discussion_r448320713", "createdAt": "2020-07-01T12:13:45Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/SearchFilterTagsDirective.js", "diffHunk": "@@ -179,20 +179,45 @@\n                 }\n \n                 // general case\n-                scope.currentFilters.push({\n-                  key: filterKey,\n-                  value: value\n-                });\n+                if (filterKey===\"query_string\"){\n+                  angular.forEach(JSON.parse(value), function(facetValues, facetKey) {\n+                    if (typeof facetValues === 'object') {\n+                      angular.forEach(facetValues, function (values, facetValuesKey) {\n+                        let elem = {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3359ad4a63374fa31c6b0244a11cd9827468052e"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDYyNzcwOnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/SearchFilterTagsDirective.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMzo0MzowNFrOGrmeQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMzo0MzowNFrOGrmeQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MjI5MQ==", "bodyText": "Commented code should be removed", "url": "https://github.com/geonetwork/core-geonetwork/pull/4815#discussion_r448372291", "createdAt": "2020-07-01T13:43:04Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/SearchFilterTagsDirective.js", "diffHunk": "@@ -179,20 +179,45 @@\n                 }\n \n                 // general case\n-                scope.currentFilters.push({\n-                  key: filterKey,\n-                  value: value\n-                });\n+                if (filterKey===\"query_string\"){\n+                  angular.forEach(JSON.parse(value), function(facetValues, facetKey) {\n+                    if (typeof facetValues === 'object') {\n+                      angular.forEach(facetValues, function (values, facetValuesKey) {\n+                        let elem = {};\n+                        elem[facetValuesKey]=values;\n+                        scope.currentFilters.push({\n+                          key: facetKey,\n+                          value: elem\n+                        })\n+                      })\n+                    }\n+                    else {\n+                      scope.currentFilters.push({\n+                        key: facetKey,\n+                        value: facetValues\n+                      })\n+                    }\n+                  })\n+                }\n+                else {\n+                }\n               }\n             }, true);\n \n             scope.removeFilter = function(filter) {\n-              if (filter.isFacet) {\n+              removeFacetElement=[]\n+              removeFacetElement.push(filter.key)\n+              if (Object.keys(filter.value)[0] != 0)\n+                removeFacetElement.push(Object.keys(filter.value)[0])\n+              else\n+                removeFacetElement.push(filter.value)\n+              ngSearchFormCtrl.updateState(removeFacetElement, true);\n+              /*if (filter.isFacet) {\n                 var facetQuery = removeFacet(filter.facetKey, getSearchParams()['facet.q']);\n                 setSearchParameter('facet.q', facetQuery);\n               } else {\n                 setSearchParameter(filter.key, null);\n-              }\n+              }*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3359ad4a63374fa31c6b0244a11cd9827468052e"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NDY2NDU2OnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/SearchFilterTagsDirective.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMzo1MjoyNVrOGrm2BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMzo1MjoyNVrOGrm2BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3ODM3Mg==", "bodyText": "Same here, commented out code should be removed.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4815#discussion_r448378372", "createdAt": "2020-07-01T13:52:25Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/SearchFilterTagsDirective.js", "diffHunk": "@@ -227,7 +262,7 @@\n         }\n       });\n \n-      return result;\n+      return result;*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3359ad4a63374fa31c6b0244a11cd9827468052e"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5ODMwOTY5OnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/search/searchmanager/SearchFormDirective.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjowNTo1NVrOGsJ6UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjowNTo1NVrOGsJ6UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1MjkxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                };\n          \n          \n            \n                }", "url": "https://github.com/geonetwork/core-geonetwork/pull/4815#discussion_r448952912", "createdAt": "2020-07-02T12:05:55Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/search/searchmanager/SearchFormDirective.js", "diffHunk": "@@ -432,22 +432,26 @@\n     }\n \n     this.updateState = function(path, value, doNotRemove) {\n-      var filters = $scope.searchObj.state.filters;\n-      var getter = parse(path.join('^^^'));\n-      var existingValue = getter(filters);\n-      if(angular.isUndefined(existingValue) || doNotRemove) {\n-        var setter = getter.assign;\n-        setter(filters, value)\n+      if(path[0] === 'any') {\n+        delete $scope.searchObj.params.any;\n       } else {\n-        if(existingValue !== value) {\n+        var filters = $scope.searchObj.state.filters;\n+        var getter = parse(path.join('^^^'));\n+        var existingValue = getter(filters);\n+        if(angular.isUndefined(existingValue) || doNotRemove) {\n           var setter = getter.assign;\n           setter(filters, value)\n         } else {\n-          removeKey(filters, path)\n+          if(existingValue !== value) {\n+            var setter = getter.assign;\n+            setter(filters, value)\n+          } else {\n+            removeKey(filters, path)\n+          }\n         }\n       }\n       this.triggerSearch();\n-    }\n+    };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5363099585a377e19d950a28e44dcf505fe36ea8"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5OTA2MDAzOnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/partials/searchFilterTagsTemplate.html", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNToxMzowMlrOGsRRTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNToxMzowMlrOGsRRTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA3MzQ4Ng==", "bodyText": "The translate directive should be added here, otherwise the translation does not happen.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4815#discussion_r449073486", "createdAt": "2020-07-02T15:13:02Z", "author": {"login": "jahow"}, "path": "web-ui/src/main/resources/catalog/components/search/searchfiltertag/partials/searchFilterTagsTemplate.html", "diffHunk": "@@ -12,7 +12,10 @@\n        ng-repeat=\"filter in currentFilters\"\n        ng-click=\"removeFilter(filter)\">\n       <span class=\"fa fa-times text-danger delete-icon\"></span>\n-      <strong class=\"text-no-wrap text-uppercase\" translate>{{filter.key}}</strong>\n+      <strong class=\"text-no-wrap text-uppercase\" translate>\n+        <span ng-if=\"filter.key!='any'\">{{('facet-' + filter.key)}}</span>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dba0b77c51efe24b0e12c8b2678b4eb67247309f"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4128, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}