{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4Mzk5MTc4", "number": 4633, "title": "Shibboleth improvements", "bodyText": "This PR replaces #3790, with some additional updates:\n\nAdd support for organisation header (Shib-EP-organisation)\nGive precedence to header with group/roles (Shib-EP-GroupsRoles) over over individual headers for each items (Shib-EP-Groups, Shib-EP-Entitlement) if all are provided.\nFix unit tests\nRemove non existing multiNodeAuthenticationFilter reference\n\n\nGroup/profile information using Shib-EP-Groups (groups), Shib-EP-Entitlement (profiles) headers\n2 separate headers for groups and profiles separated by comma (separator can be configured in https://github.com/geonetwork/core-geonetwork/blob/master/web/src/main/webapp/WEB-INF/config-security/config-security-shibboleth-overrides.properties)\nExample:\nShib-EP-Groups=group1,group1\nShib-EP-Entitlement=Reviewer,UserAdmin\n\n\n\nIf the list of profiles has less elements than the list of groups, the remaining groups are assigned the Guest profile.\n\n\nIf the list of groups has less elements than the list of profiles, the remaining profiles are ignored.\n\n\nGroup/profile information using Shib-EP-GroupsRoles header\nA list of group/profiles with the format: group1,profile1;group2;profile2 (separators can be configured in https://github.com/geonetwork/core-geonetwork/blob/master/web/src/main/webapp/WEB-INF/config-security/config-security-shibboleth-overrides.properties)\nExample:\nShib-EP-GroupsRoles=sample,UserAdmin;sample,Editor\n\nIf Shib-EP-GroupsRoles header is provided, has precedence over Shib-EP-Groups, Shib-EP-Entitlementheaders.\n\nThese developments have been funded by Bundesamt fuer Strahlenschutz / Federal Office for Radiation Protection.", "createdAt": "2020-04-24T08:12:34Z", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633", "merged": true, "mergeCommit": {"oid": "2f1ba04d7c9f7f5496d6b11280fe3d654409f086"}, "closed": true, "closedAt": "2020-04-27T07:08:15Z", "author": {"login": "josegar74"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABan4ZRzgH2gAyNDA4Mzk5MTc4OjYyMzRlMTUxMDRjNzI4ZDNkMmM1MzE4NzM5ODRmOTQzNmNmZTQ0YjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbpoOggH2gAyNDA4Mzk5MTc4OmUxNDA1YTFmNDBkMmM2NTJlZjQ0N2E2MTU2MDQ2MmZiMjgwZjE3MjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6234e15104c728d3d2c531873984f9436cfe44b0", "author": {"user": {"login": "Delawen", "name": "Mar\u00eda Arias de Reyna"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/6234e15104c728d3d2c531873984f9436cfe44b0", "committedDate": "2019-05-03T14:29:07Z", "message": "In Shibboleth authentication, allow to login (or not) using other methods (BA, form,...). Configurable using a property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa8983faacbc7682348aa117f31df90a6255cc1b", "author": {"user": {"login": "Delawen", "name": "Mar\u00eda Arias de Reyna"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/fa8983faacbc7682348aa117f31df90a6255cc1b", "committedDate": "2019-05-06T09:53:26Z", "message": "Adding a shared profile/group header to have the list on the same header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a22aa11de52c2276364785edbec101709848ad01", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/a22aa11de52c2276364785edbec101709848ad01", "committedDate": "2020-04-24T06:22:18Z", "message": "Merge branch 'master' of https://github.com/geonetwork/core-geonetwork into shibboleth_improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03f5de4425a86e27de3e98487e0a6a4280f0ecf0", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/03f5de4425a86e27de3e98487e0a6a4280f0ecf0", "committedDate": "2020-04-24T07:47:58Z", "message": "Shibboleth changes:\n- Add support for organisation header (Shib-EP-organisation)\n- Give precedence to header with group/roles (Shib-EP-GroupsRoles) over over individual headers for each items (Shib-EP-Groups, Shib-EP-Entitlement) if all are provided.\n- Fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc02a61a7769e47ef297a9e7b097fb7db82afc85", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/cc02a61a7769e47ef297a9e7b097fb7db82afc85", "committedDate": "2020-04-24T08:00:47Z", "message": "Shibboleth configuration - remove non existing multiNodeAuthenticationFilter reference"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Nzk4MTI1", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#pullrequestreview-399798125", "createdAt": "2020-04-24T09:44:51Z", "commit": {"oid": "cc02a61a7769e47ef297a9e7b097fb7db82afc85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOTo0NDo1MVrOGLPkZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOTo0NDo1MVrOGLPkZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ0MjU5Ng==", "bodyText": "typo", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414442596", "createdAt": "2020-04-24T09:44:51Z", "author": {"login": "fxprunayre"}, "path": "core/src/test/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtilsTest.java", "diffHunk": "@@ -4,7 +4,7 @@\n  * and United Nations Environment Programme (UNEP)\n  *\n  * This program is free software; you can redistribute it and/or modify\n- * it under the terms of the GNU General Public License as published by\n+ * it under the terms of thgroupLengthNotMatchProfileLengthe GNU General Public License as published by", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc02a61a7769e47ef297a9e7b097fb7db82afc85"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Nzk4OTU2", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#pullrequestreview-399798956", "createdAt": "2020-04-24T09:46:05Z", "commit": {"oid": "cc02a61a7769e47ef297a9e7b097fb7db82afc85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/ea3b60d68195aefcb270f5dc4ebcc7a282a068db", "committedDate": "2020-04-24T09:52:54Z", "message": "Fix typo in file header comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODQ3ODg4", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#pullrequestreview-399847888", "createdAt": "2020-04-24T11:02:38Z", "commit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMTowMjozOFrOGLSXqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMToxMzo1MlrOGLSwBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4ODQ4OQ==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414488489", "createdAt": "2020-04-24T11:02:38Z", "author": {"login": "juanluisrp"}, "path": "core/src/main/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtils.java", "diffHunk": "@@ -95,20 +98,47 @@ protected UserDetails setupUser(ServletRequest request, ShibbolethUserConfigurat\n \t\tString username = getHeader(req, config.getUsernameKey(), \"\");\n \t\tString surname = getHeader(req, config.getSurnameKey(), \"\");\n \t\tString firstname = getHeader(req, config.getFirstnameKey(), \"\");\n+        String organisation = getHeader(req, config.getOrganisationKey(), \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5MDM4OA==", "bodyText": "You can init this with groups.length size.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414490388", "createdAt": "2020-04-24T11:06:08Z", "author": {"login": "juanluisrp"}, "path": "core/src/main/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtils.java", "diffHunk": "@@ -95,20 +98,47 @@ protected UserDetails setupUser(ServletRequest request, ShibbolethUserConfigurat\n \t\tString username = getHeader(req, config.getUsernameKey(), \"\");\n \t\tString surname = getHeader(req, config.getSurnameKey(), \"\");\n \t\tString firstname = getHeader(req, config.getFirstnameKey(), \"\");\n+        String organisation = getHeader(req, config.getOrganisationKey(), \"\");\n \t\tString email = getHeader(req, config.getEmailKey(), \"\");\n \t\tString arraySeparator = config.getArraySeparator();\n-\n-\t\tString profile_header = getHeader(req, config.getProfileKey(), Profile.Guest.name());\n-\t\tString[] profiles = new String[0];\n-\t\tif (!StringUtils.isEmpty(profile_header)) {\n-\t\t\tprofiles = profile_header.split(arraySeparator);\n-\t\t}\n-\n-\t\tString group_header = getHeader(req, config.getGroupKey(), config.getDefaultGroup());\n-\t\tString[] groups = new String[0];\n-\t\tif (!StringUtils.isEmpty(group_header)) {\n-\t\t\tgroups = group_header.split(arraySeparator);\n-\t\t}\n+\t\tString roleGroupSeparator = config.getRoleGroupSeparator();\n+\n+        // RoleGroupKey header format: sample,UserAdmin;sample,Editor\n+        // It has precedence over individual ProfileKey and GroupKey headers if all are provided.\n+        //      - ProfileKey header format: UserAdmin;Editor\n+        //      - GroupKey header format: sample;sample\n+        String roleGroup_header = getHeader(req, config.getRoleGroupKey(), \"\");\n+        String[] roleGroups = new String[0];\n+        if (!StringUtils.isEmpty(roleGroup_header)) {\n+            roleGroups = roleGroup_header.split(arraySeparator);\n+        } else {\n+            String profile_header = getHeader(req, config.getProfileKey(), Profile.Guest.name());\n+            String[] profiles = new String[0];\n+            if (!StringUtils.isEmpty(profile_header)) {\n+                profiles = profile_header.split(arraySeparator);\n+            }\n+\n+            String group_header = getHeader(req, config.getGroupKey(), config.getDefaultGroup());\n+            String[] groups = new String[0];\n+            if (!StringUtils.isEmpty(group_header)) {\n+                groups = group_header.split(arraySeparator);\n+            }\n+\n+            List<String> roleGroupsList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5MDc0Mg==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414490742", "createdAt": "2020-04-24T11:06:44Z", "author": {"login": "juanluisrp"}, "path": "core/src/main/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtils.java", "diffHunk": "@@ -141,16 +172,18 @@ protected UserDetails setupUser(ServletRequest request, ShibbolethUserConfigurat\n \t\t\t\tuser.setUsername(username);\n \t\t\t\tuser.setSurname(surname);\n \t\t\t\tuser.setName(firstname);\n+                user.setOrganisation(organisation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5MDkzMQ==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414490931", "createdAt": "2020-04-24T11:07:02Z", "author": {"login": "juanluisrp"}, "path": "core/src/main/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtils.java", "diffHunk": "@@ -165,6 +198,7 @@ protected UserDetails setupUser(ServletRequest request, ShibbolethUserConfigurat\n \t\t\t\tif (ldapUserDetails == null) {\n \t\t\t\t\tldapUserDetails = new LDAPUser(username);\n \t\t\t\t\tldapUserDetails.getUser().setName(firstname).setSurname(surname);\n+                    ldapUserDetails.getUser().setOrganisation(organisation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5MTM3NA==", "bodyText": "formatting: should be for (...", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414491374", "createdAt": "2020-04-24T11:07:53Z", "author": {"login": "juanluisrp"}, "path": "core/src/main/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtils.java", "diffHunk": "@@ -95,20 +98,47 @@ protected UserDetails setupUser(ServletRequest request, ShibbolethUserConfigurat\n \t\tString username = getHeader(req, config.getUsernameKey(), \"\");\n \t\tString surname = getHeader(req, config.getSurnameKey(), \"\");\n \t\tString firstname = getHeader(req, config.getFirstnameKey(), \"\");\n+        String organisation = getHeader(req, config.getOrganisationKey(), \"\");\n \t\tString email = getHeader(req, config.getEmailKey(), \"\");\n \t\tString arraySeparator = config.getArraySeparator();\n-\n-\t\tString profile_header = getHeader(req, config.getProfileKey(), Profile.Guest.name());\n-\t\tString[] profiles = new String[0];\n-\t\tif (!StringUtils.isEmpty(profile_header)) {\n-\t\t\tprofiles = profile_header.split(arraySeparator);\n-\t\t}\n-\n-\t\tString group_header = getHeader(req, config.getGroupKey(), config.getDefaultGroup());\n-\t\tString[] groups = new String[0];\n-\t\tif (!StringUtils.isEmpty(group_header)) {\n-\t\t\tgroups = group_header.split(arraySeparator);\n-\t\t}\n+\t\tString roleGroupSeparator = config.getRoleGroupSeparator();\n+\n+        // RoleGroupKey header format: sample,UserAdmin;sample,Editor\n+        // It has precedence over individual ProfileKey and GroupKey headers if all are provided.\n+        //      - ProfileKey header format: UserAdmin;Editor\n+        //      - GroupKey header format: sample;sample\n+        String roleGroup_header = getHeader(req, config.getRoleGroupKey(), \"\");\n+        String[] roleGroups = new String[0];\n+        if (!StringUtils.isEmpty(roleGroup_header)) {\n+            roleGroups = roleGroup_header.split(arraySeparator);\n+        } else {\n+            String profile_header = getHeader(req, config.getProfileKey(), Profile.Guest.name());\n+            String[] profiles = new String[0];\n+            if (!StringUtils.isEmpty(profile_header)) {\n+                profiles = profile_header.split(arraySeparator);\n+            }\n+\n+            String group_header = getHeader(req, config.getGroupKey(), config.getDefaultGroup());\n+            String[] groups = new String[0];\n+            if (!StringUtils.isEmpty(group_header)) {\n+                groups = group_header.split(arraySeparator);\n+            }\n+\n+            List<String> roleGroupsList = new ArrayList<>();\n+            for(int i = 0; i < groups.length; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5Mjg2OA==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414492868", "createdAt": "2020-04-24T11:10:39Z", "author": {"login": "juanluisrp"}, "path": "core/src/main/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtils.java", "diffHunk": "@@ -251,7 +293,8 @@ private void assignProfile(String[] profiles, User user) {\n \t\tprivate String username;\n \t\tprivate String name;\n \t\tprivate String surname;\n-\t\tprivate String profile;\n+\t\tprivate String organisation;\n+        private String profile;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 213}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5Mjk5OQ==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414492999", "createdAt": "2020-04-24T11:10:53Z", "author": {"login": "juanluisrp"}, "path": "core/src/main/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtils.java", "diffHunk": "@@ -261,6 +304,7 @@ static MinimalUser create(ServletRequest request, ShibbolethUserConfiguration co\n \t\t\tString username = getHeader(req, config.getUsernameKey(), \"\");\n \t\t\tString surname = getHeader(req, config.getSurnameKey(), \"\");\n \t\t\tString firstname = getHeader(req, config.getFirstnameKey(), \"\");\n+            String organisation = getHeader(req, config.getOrganisationKey(), \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 221}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5NDA3NA==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414494074", "createdAt": "2020-04-24T11:12:45Z", "author": {"login": "juanluisrp"}, "path": "core/src/test/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtilsTest.java", "diffHunk": "@@ -80,7 +81,9 @@ public void setUp() {\n \t\tconfig.setSurnameKey(\"SURNAME_KEY\");\n \t\tconfig.setUpdateGroup(true);\n \t\tconfig.setUpdateProfile(true);\n-\t\tconfig.setUsernameKey(\"USERNAME_KEY\");\n+        config.setUsernameKey(\"USERNAME_KEY\");\n+\t\tconfig.setOrganisationKey(\"ORGANISATION_KEY\");\n+        config.setRoleGroupSeparator(\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5NDE3NQ==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414494175", "createdAt": "2020-04-24T11:12:54Z", "author": {"login": "juanluisrp"}, "path": "core/src/test/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtilsTest.java", "diffHunk": "@@ -106,12 +109,13 @@ public void twoConsecutiveLogins() throws Exception {\n \t\tassertNull(\"User already exists\", user);\n \n \t\tString group = groupname + \"1\";\n-\t\tString profile = Profile.UserAdmin.name() + config.getArraySeparator() + Profile.Administrator.name();\n+\t\tString groups = group + config.getArraySeparator() + group;\n+        String profile = Profile.UserAdmin.name() + config.getArraySeparator() + Profile.Administrator.name();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5NDI3Mw==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414494273", "createdAt": "2020-04-24T11:13:04Z", "author": {"login": "juanluisrp"}, "path": "core/src/test/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtilsTest.java", "diffHunk": "@@ -129,11 +133,12 @@ public void twoConsecutiveLogins() throws Exception {\n \n \t\t// Second round, same user different authorization\n \t\tgroup = groupname + \"3\";\n-\t\tprofile = Profile.Guest.name() + config.getArraySeparator() + Profile.Editor.name();\n+        groups = group + config.getArraySeparator() + group;\n+        profile = Profile.Guest.name() + config.getArraySeparator() + Profile.Editor.name();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5NDQxNg==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414494416", "createdAt": "2020-04-24T11:13:18Z", "author": {"login": "juanluisrp"}, "path": "core/src/test/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtilsTest.java", "diffHunk": "@@ -160,12 +165,13 @@ public void twoConsecutiveLoginsNoAuthorization() throws Exception {\n \t\tassertNull(\"User already exists\", user);\n \n \t\tString group = groupname + \"1\";\n+        String groups = group + config.getArraySeparator() + group ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5NDY1NQ==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414494655", "createdAt": "2020-04-24T11:13:45Z", "author": {"login": "juanluisrp"}, "path": "core/src/test/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtilsTest.java", "diffHunk": "@@ -183,10 +189,12 @@ public void twoConsecutiveLoginsNoAuthorization() throws Exception {\n \n \t\t// Second round, same user different authorization but the original\n \t\t// authorization should be kept (no updateProfile, updateGroups)\n+        String groupNew = groupname + \"3\";\n+        String groupsgroupNew = groupNew + config.getArraySeparator() + groupNew ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5NDcyNg==", "bodyText": "Indentation", "url": "https://github.com/geonetwork/core-geonetwork/pull/4633#discussion_r414494726", "createdAt": "2020-04-24T11:13:52Z", "author": {"login": "juanluisrp"}, "path": "core/src/test/java/org/fao/geonet/kernel/security/shibboleth/ShibbolethUserUtilsTest.java", "diffHunk": "@@ -221,6 +229,7 @@ public void groupLengthNotMatchProfileLength() throws Exception {\n \t\trequest.addHeader(this.config.getProfileKey(), profile);\n \t\trequest.addHeader(this.config.getSurnameKey(), surname);\n \t\trequest.addHeader(this.config.getUsernameKey(), username);\n+        request.addHeader(this.config.getOrganisationKey(), organisation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea3b60d68195aefcb270f5dc4ebcc7a282a068db"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1405a1f40d2c652ef447a61560462fb280f1720", "author": {"user": {"login": "josegar74", "name": "Jose Garc\u00eda"}}, "url": "https://github.com/geonetwork/core-geonetwork/commit/e1405a1f40d2c652ef447a61560462fb280f1720", "committedDate": "2020-04-27T06:52:05Z", "message": "Fix indentation issues and code improvements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1623, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}