{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0OTU2MjI1", "number": 4766, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjozNjozNVrOEFzOBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwNzoyMDo0NVrOET9MEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NTE3NTA5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjozNjozNVrOGkNIAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMjozMDo0N1rOGmCR4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjk2MQ==", "bodyText": "Are both required? Can't be send with the iso code used by other thesaurus services and use in the UI the services to convert the codes?", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r440616961", "createdAt": "2020-06-16T06:36:35Z", "author": {"login": "josegar74"}, "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "diffHunk": "@@ -693,6 +693,47 @@ public void addTitleElement(String thesaurusTitle) throws IOException, AccessDen\n         repository.addGraph(myGraph);\n     }\n \n+    //    <rdf:RDF>\n+    //    <skos:ConceptScheme rdf:about=\"http://www.thesaurus.gc.ca/#CoreSubjectThesaurus\">\n+    //          <dc:title>Main GN Title</dc:title>\n+    //          <dc:title xml:lang=\"en\">English Version (en)</dc:title>\n+    //          <dc:title xml:lang=\"fr\">French Version (fr)</dc:title>\n+    //          <dc:description></dc:description>\n+    //     </skos:ConceptScheme>\n+    //\n+    // This will setup;\n+    //  {\n+    //      \"en\": \"English Version (en)\",\n+    //      \"fr\": \"French Version (fr)\"\n+    //      \"eng\": \"English Version (en)\",\n+    //      \"fre\": \"French Version (fr)\"\n+    //  }\n+    private void retrieveMultiLingualTitles(Element thesaurusEl) {\n+        List<Namespace> theNSs = new ArrayList<Namespace>();\n+        theNSs.add(Namespace.getNamespace(\"rdf\", \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"));\n+        theNSs.add(Namespace.getNamespace(\"skos\", \"http://www.w3.org/2004/02/skos/core#\"));\n+        theNSs.add(Namespace.getNamespace(\"dc\", \"http://purl.org/dc/elements/1.1/\"));\n+        theNSs.add(Namespace.getNamespace(\"dcterms\", \"http://purl.org/dc/terms/\"));\n+\n+        Namespace xmlNS = Namespace.getNamespace(\"xml\",\"http://www.w3.org/XML/1998/namespace\");\n+\n+        try {\n+            List<Element> multiLingualTitles = (List<Element>) Xml.selectNodes(thesaurusEl,\n+                \"skos:ConceptScheme/dc:title[@xml:lang]|skos:ConceptScheme/dcterms:title[@xml:lang]\", theNSs);\n+            multilingualTitles.clear();\n+            for (Element el: multiLingualTitles) {\n+                    //use both forms of the lang name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5MzQ1OQ==", "bodyText": "I put this in for some consistency - dealing with any form of language codes can be difficult (i.e. fr/fre/fra).  This makes things easier down the line.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r440993459", "createdAt": "2020-06-16T16:41:46Z", "author": {"login": "davidblasby"}, "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "diffHunk": "@@ -693,6 +693,47 @@ public void addTitleElement(String thesaurusTitle) throws IOException, AccessDen\n         repository.addGraph(myGraph);\n     }\n \n+    //    <rdf:RDF>\n+    //    <skos:ConceptScheme rdf:about=\"http://www.thesaurus.gc.ca/#CoreSubjectThesaurus\">\n+    //          <dc:title>Main GN Title</dc:title>\n+    //          <dc:title xml:lang=\"en\">English Version (en)</dc:title>\n+    //          <dc:title xml:lang=\"fr\">French Version (fr)</dc:title>\n+    //          <dc:description></dc:description>\n+    //     </skos:ConceptScheme>\n+    //\n+    // This will setup;\n+    //  {\n+    //      \"en\": \"English Version (en)\",\n+    //      \"fr\": \"French Version (fr)\"\n+    //      \"eng\": \"English Version (en)\",\n+    //      \"fre\": \"French Version (fr)\"\n+    //  }\n+    private void retrieveMultiLingualTitles(Element thesaurusEl) {\n+        List<Namespace> theNSs = new ArrayList<Namespace>();\n+        theNSs.add(Namespace.getNamespace(\"rdf\", \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"));\n+        theNSs.add(Namespace.getNamespace(\"skos\", \"http://www.w3.org/2004/02/skos/core#\"));\n+        theNSs.add(Namespace.getNamespace(\"dc\", \"http://purl.org/dc/elements/1.1/\"));\n+        theNSs.add(Namespace.getNamespace(\"dcterms\", \"http://purl.org/dc/terms/\"));\n+\n+        Namespace xmlNS = Namespace.getNamespace(\"xml\",\"http://www.w3.org/XML/1998/namespace\");\n+\n+        try {\n+            List<Element> multiLingualTitles = (List<Element>) Xml.selectNodes(thesaurusEl,\n+                \"skos:ConceptScheme/dc:title[@xml:lang]|skos:ConceptScheme/dcterms:title[@xml:lang]\", theNSs);\n+            multilingualTitles.clear();\n+            for (Element el: multiLingualTitles) {\n+                    //use both forms of the lang name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjk2MQ=="}, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAyNjczOA==", "bodyText": "I added a bit of code so it wouldn't overwrite explicitly set languages using this 2/3 letter conversion.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r441026738", "createdAt": "2020-06-16T17:37:31Z", "author": {"login": "davidblasby"}, "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "diffHunk": "@@ -693,6 +693,47 @@ public void addTitleElement(String thesaurusTitle) throws IOException, AccessDen\n         repository.addGraph(myGraph);\n     }\n \n+    //    <rdf:RDF>\n+    //    <skos:ConceptScheme rdf:about=\"http://www.thesaurus.gc.ca/#CoreSubjectThesaurus\">\n+    //          <dc:title>Main GN Title</dc:title>\n+    //          <dc:title xml:lang=\"en\">English Version (en)</dc:title>\n+    //          <dc:title xml:lang=\"fr\">French Version (fr)</dc:title>\n+    //          <dc:description></dc:description>\n+    //     </skos:ConceptScheme>\n+    //\n+    // This will setup;\n+    //  {\n+    //      \"en\": \"English Version (en)\",\n+    //      \"fr\": \"French Version (fr)\"\n+    //      \"eng\": \"English Version (en)\",\n+    //      \"fre\": \"French Version (fr)\"\n+    //  }\n+    private void retrieveMultiLingualTitles(Element thesaurusEl) {\n+        List<Namespace> theNSs = new ArrayList<Namespace>();\n+        theNSs.add(Namespace.getNamespace(\"rdf\", \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"));\n+        theNSs.add(Namespace.getNamespace(\"skos\", \"http://www.w3.org/2004/02/skos/core#\"));\n+        theNSs.add(Namespace.getNamespace(\"dc\", \"http://purl.org/dc/elements/1.1/\"));\n+        theNSs.add(Namespace.getNamespace(\"dcterms\", \"http://purl.org/dc/terms/\"));\n+\n+        Namespace xmlNS = Namespace.getNamespace(\"xml\",\"http://www.w3.org/XML/1998/namespace\");\n+\n+        try {\n+            List<Element> multiLingualTitles = (List<Element>) Xml.selectNodes(thesaurusEl,\n+                \"skos:ConceptScheme/dc:title[@xml:lang]|skos:ConceptScheme/dcterms:title[@xml:lang]\", theNSs);\n+            multilingualTitles.clear();\n+            for (Element el: multiLingualTitles) {\n+                    //use both forms of the lang name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjk2MQ=="}, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEzMjA4NA==", "bodyText": "Would it not be better to create 2 functions? - one to get 2 char lang code and values like the following\n    {\n       \"en\": \"English Version (en)\",\n       \"fr\": \"French Version (fr)\"\n    }\n\n\nand one to get 3 char lang codes and values like the following\n   {\n      \"eng\": \"English Version (en)\",\n      \"fre\": \"French Version (fr)\"\n   }\n\n\nWith 2 function, if in the future you want to know where 2 char codes are used vs 3 char code it will be easier to identify usage. This can probably be done by making the main function private and creating 2 public functions that could just subset the existing results.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r442132084", "createdAt": "2020-06-18T10:36:48Z", "author": {"login": "ianwallen"}, "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "diffHunk": "@@ -693,6 +693,47 @@ public void addTitleElement(String thesaurusTitle) throws IOException, AccessDen\n         repository.addGraph(myGraph);\n     }\n \n+    //    <rdf:RDF>\n+    //    <skos:ConceptScheme rdf:about=\"http://www.thesaurus.gc.ca/#CoreSubjectThesaurus\">\n+    //          <dc:title>Main GN Title</dc:title>\n+    //          <dc:title xml:lang=\"en\">English Version (en)</dc:title>\n+    //          <dc:title xml:lang=\"fr\">French Version (fr)</dc:title>\n+    //          <dc:description></dc:description>\n+    //     </skos:ConceptScheme>\n+    //\n+    // This will setup;\n+    //  {\n+    //      \"en\": \"English Version (en)\",\n+    //      \"fr\": \"French Version (fr)\"\n+    //      \"eng\": \"English Version (en)\",\n+    //      \"fre\": \"French Version (fr)\"\n+    //  }\n+    private void retrieveMultiLingualTitles(Element thesaurusEl) {\n+        List<Namespace> theNSs = new ArrayList<Namespace>();\n+        theNSs.add(Namespace.getNamespace(\"rdf\", \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"));\n+        theNSs.add(Namespace.getNamespace(\"skos\", \"http://www.w3.org/2004/02/skos/core#\"));\n+        theNSs.add(Namespace.getNamespace(\"dc\", \"http://purl.org/dc/elements/1.1/\"));\n+        theNSs.add(Namespace.getNamespace(\"dcterms\", \"http://purl.org/dc/terms/\"));\n+\n+        Namespace xmlNS = Namespace.getNamespace(\"xml\",\"http://www.w3.org/XML/1998/namespace\");\n+\n+        try {\n+            List<Element> multiLingualTitles = (List<Element>) Xml.selectNodes(thesaurusEl,\n+                \"skos:ConceptScheme/dc:title[@xml:lang]|skos:ConceptScheme/dcterms:title[@xml:lang]\", theNSs);\n+            multilingualTitles.clear();\n+            for (Element el: multiLingualTitles) {\n+                    //use both forms of the lang name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjk2MQ=="}, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5NjYyNw==", "bodyText": "I can just put in the values that were explicitly specified.  However, this is going to make the XSLT code much more difficult.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r442296627", "createdAt": "2020-06-18T15:04:06Z", "author": {"login": "davidblasby"}, "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "diffHunk": "@@ -693,6 +693,47 @@ public void addTitleElement(String thesaurusTitle) throws IOException, AccessDen\n         repository.addGraph(myGraph);\n     }\n \n+    //    <rdf:RDF>\n+    //    <skos:ConceptScheme rdf:about=\"http://www.thesaurus.gc.ca/#CoreSubjectThesaurus\">\n+    //          <dc:title>Main GN Title</dc:title>\n+    //          <dc:title xml:lang=\"en\">English Version (en)</dc:title>\n+    //          <dc:title xml:lang=\"fr\">French Version (fr)</dc:title>\n+    //          <dc:description></dc:description>\n+    //     </skos:ConceptScheme>\n+    //\n+    // This will setup;\n+    //  {\n+    //      \"en\": \"English Version (en)\",\n+    //      \"fr\": \"French Version (fr)\"\n+    //      \"eng\": \"English Version (en)\",\n+    //      \"fre\": \"French Version (fr)\"\n+    //  }\n+    private void retrieveMultiLingualTitles(Element thesaurusEl) {\n+        List<Namespace> theNSs = new ArrayList<Namespace>();\n+        theNSs.add(Namespace.getNamespace(\"rdf\", \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"));\n+        theNSs.add(Namespace.getNamespace(\"skos\", \"http://www.w3.org/2004/02/skos/core#\"));\n+        theNSs.add(Namespace.getNamespace(\"dc\", \"http://purl.org/dc/elements/1.1/\"));\n+        theNSs.add(Namespace.getNamespace(\"dcterms\", \"http://purl.org/dc/terms/\"));\n+\n+        Namespace xmlNS = Namespace.getNamespace(\"xml\",\"http://www.w3.org/XML/1998/namespace\");\n+\n+        try {\n+            List<Element> multiLingualTitles = (List<Element>) Xml.selectNodes(thesaurusEl,\n+                \"skos:ConceptScheme/dc:title[@xml:lang]|skos:ConceptScheme/dcterms:title[@xml:lang]\", theNSs);\n+            multilingualTitles.clear();\n+            for (Element el: multiLingualTitles) {\n+                    //use both forms of the lang name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjk2MQ=="}, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUzNjQxNg==", "bodyText": "Ok, I pushed a commit to handle this.  There's will now only be \"en\" and \"fr\" in the Thesaurus object", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r442536416", "createdAt": "2020-06-18T22:30:47Z", "author": {"login": "davidblasby"}, "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "diffHunk": "@@ -693,6 +693,47 @@ public void addTitleElement(String thesaurusTitle) throws IOException, AccessDen\n         repository.addGraph(myGraph);\n     }\n \n+    //    <rdf:RDF>\n+    //    <skos:ConceptScheme rdf:about=\"http://www.thesaurus.gc.ca/#CoreSubjectThesaurus\">\n+    //          <dc:title>Main GN Title</dc:title>\n+    //          <dc:title xml:lang=\"en\">English Version (en)</dc:title>\n+    //          <dc:title xml:lang=\"fr\">French Version (fr)</dc:title>\n+    //          <dc:description></dc:description>\n+    //     </skos:ConceptScheme>\n+    //\n+    // This will setup;\n+    //  {\n+    //      \"en\": \"English Version (en)\",\n+    //      \"fr\": \"French Version (fr)\"\n+    //      \"eng\": \"English Version (en)\",\n+    //      \"fre\": \"French Version (fr)\"\n+    //  }\n+    private void retrieveMultiLingualTitles(Element thesaurusEl) {\n+        List<Namespace> theNSs = new ArrayList<Namespace>();\n+        theNSs.add(Namespace.getNamespace(\"rdf\", \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"));\n+        theNSs.add(Namespace.getNamespace(\"skos\", \"http://www.w3.org/2004/02/skos/core#\"));\n+        theNSs.add(Namespace.getNamespace(\"dc\", \"http://purl.org/dc/elements/1.1/\"));\n+        theNSs.add(Namespace.getNamespace(\"dcterms\", \"http://purl.org/dc/terms/\"));\n+\n+        Namespace xmlNS = Namespace.getNamespace(\"xml\",\"http://www.w3.org/XML/1998/namespace\");\n+\n+        try {\n+            List<Element> multiLingualTitles = (List<Element>) Xml.selectNodes(thesaurusEl,\n+                \"skos:ConceptScheme/dc:title[@xml:lang]|skos:ConceptScheme/dcterms:title[@xml:lang]\", theNSs);\n+            multilingualTitles.clear();\n+            for (Element el: multiLingualTitles) {\n+                    //use both forms of the lang name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjk2MQ=="}, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NTE4MjQwOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjozOToxN1rOGkNMPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjozOToxN1rOGkNMPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxODA0Ng==", "bodyText": "Surround code with curly braces", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r440618046", "createdAt": "2020-06-16T06:39:17Z", "author": {"login": "josegar74"}, "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "diffHunk": "@@ -416,31 +406,31 @@ public Element getKeywordById(\n             KeywordsSearcher searcher = new KeywordsSearcher(context, thesaurusManager);\n \n             KeywordBean kb;\n-            if (!uri.contains(SEPARATOR)) {\n-                kb = searcher.searchById(uri, sThesaurusName, langs);\n-                if (kb == null) {\n-                    descKeys = new Element(\"descKeys\");\n-                } else {\n-                    descKeys = KeywordsSearcher.toRawElement(new Element(\"descKeys\"), kb);\n-                }\n-            } else {\n-                String[] url = uri.split(SEPARATOR);\n-                List<KeywordBean> kbList = new ArrayList<>();\n-                for (String currentUri : url) {\n+            String[] url;\n+            if (!uri.contains(SEPARATOR))\n+                url = new String[] {uri};\n+            else\n+                url = uri.split(SEPARATOR);\n+            List<KeywordBean> kbList = new ArrayList<>();\n+            for (String currentUri : url) {\n+                kb = searcher.searchById(currentUri, sThesaurusName, iso3langCodes);\n+                if (kb == null)\n                     kb = searcher.searchById(currentUri, sThesaurusName, langs);\n-                    if (kb == null)\n-                        kb = searcher.searchById(fixUri(currentUri), sThesaurusName, langs);\n-                    if (kb != null) {\n-                        kbList.add(kb);\n-                    }\n-                }\n-                descKeys = new Element(\"descKeys\");\n-                for (KeywordBean keywordBean : kbList) {\n-                    KeywordsSearcher.toRawElement(descKeys, keywordBean);\n+                if (kb == null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NTE4MjgyOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjozOToyOFrOGkNMhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjozOToyOFrOGkNMhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxODExNw==", "bodyText": "Surround code with curly braces", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r440618117", "createdAt": "2020-06-16T06:39:28Z", "author": {"login": "josegar74"}, "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "diffHunk": "@@ -416,31 +406,31 @@ public Element getKeywordById(\n             KeywordsSearcher searcher = new KeywordsSearcher(context, thesaurusManager);\n \n             KeywordBean kb;\n-            if (!uri.contains(SEPARATOR)) {\n-                kb = searcher.searchById(uri, sThesaurusName, langs);\n-                if (kb == null) {\n-                    descKeys = new Element(\"descKeys\");\n-                } else {\n-                    descKeys = KeywordsSearcher.toRawElement(new Element(\"descKeys\"), kb);\n-                }\n-            } else {\n-                String[] url = uri.split(SEPARATOR);\n-                List<KeywordBean> kbList = new ArrayList<>();\n-                for (String currentUri : url) {\n+            String[] url;\n+            if (!uri.contains(SEPARATOR))\n+                url = new String[] {uri};\n+            else\n+                url = uri.split(SEPARATOR);\n+            List<KeywordBean> kbList = new ArrayList<>();\n+            for (String currentUri : url) {\n+                kb = searcher.searchById(currentUri, sThesaurusName, iso3langCodes);\n+                if (kb == null)\n                     kb = searcher.searchById(currentUri, sThesaurusName, langs);\n-                    if (kb == null)\n-                        kb = searcher.searchById(fixUri(currentUri), sThesaurusName, langs);\n-                    if (kb != null) {\n-                        kbList.add(kb);\n-                    }\n-                }\n-                descKeys = new Element(\"descKeys\");\n-                for (KeywordBean keywordBean : kbList) {\n-                    KeywordsSearcher.toRawElement(descKeys, keywordBean);\n+                if (kb == null)\n+                    kb = searcher.searchById(fixUri(currentUri), sThesaurusName, iso3langCodes);\n+                if (kb == null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NTE5MjE5OnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjo0MzowMlrOGkNSTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjo0MzowMlrOGkNSTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxOTU5Nw==", "bodyText": "Please check to move to add Unit tests, if required move to a utility class.", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r440619597", "createdAt": "2020-06-16T06:43:02Z", "author": {"login": "josegar74"}, "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "diffHunk": "@@ -473,12 +463,14 @@ public Element getKeywordById(\n     }\n \n     // fixes common problems in uri\n-    private String fixUri(String uri) throws URISyntaxException {\n-        // We could be smarter about this.\n-        // ie. by breaking string at \"#\" and then urlencode the left part.\n-        //     However, the rdf files could be inconsistent with\n-        //     other characters like \":\" (i.e. should not be url encoded)\n-        return uri.replace(\" \",\"%20\");\n+    private String fixUri(String uri) throws   UnsupportedEncodingException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NTE5NjEwOnYy", "diffSide": "RIGHT", "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjo0NDo0NlrOGkNVFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjo0NDo0NlrOGkNVFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYyMDMxMA==", "bodyText": "Surround code with curly braces", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r440620310", "createdAt": "2020-06-16T06:44:46Z", "author": {"login": "josegar74"}, "path": "services/src/main/java/org/fao/geonet/api/registries/vocabularies/KeywordsApi.java", "diffHunk": "@@ -416,31 +406,31 @@ public Element getKeywordById(\n             KeywordsSearcher searcher = new KeywordsSearcher(context, thesaurusManager);\n \n             KeywordBean kb;\n-            if (!uri.contains(SEPARATOR)) {\n-                kb = searcher.searchById(uri, sThesaurusName, langs);\n-                if (kb == null) {\n-                    descKeys = new Element(\"descKeys\");\n-                } else {\n-                    descKeys = KeywordsSearcher.toRawElement(new Element(\"descKeys\"), kb);\n-                }\n-            } else {\n-                String[] url = uri.split(SEPARATOR);\n-                List<KeywordBean> kbList = new ArrayList<>();\n-                for (String currentUri : url) {\n+            String[] url;\n+            if (!uri.contains(SEPARATOR))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a9058b4794981d586e64dccd2bd5b4fd229cf5"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDU2MTEwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMDozNzowOVrOGlpnSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMDozNzowOVrOGlpnSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEzMjI5Nw==", "bodyText": "Missing \",\" at the end", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r442132297", "createdAt": "2020-06-18T10:37:09Z", "author": {"login": "ianwallen"}, "path": "core/src/main/java/org/fao/geonet/kernel/Thesaurus.java", "diffHunk": "@@ -693,6 +693,49 @@ public void addTitleElement(String thesaurusTitle) throws IOException, AccessDen\n         repository.addGraph(myGraph);\n     }\n \n+    //    <rdf:RDF>\n+    //    <skos:ConceptScheme rdf:about=\"http://www.thesaurus.gc.ca/#CoreSubjectThesaurus\">\n+    //          <dc:title>Main GN Title</dc:title>\n+    //          <dc:title xml:lang=\"en\">English Version (en)</dc:title>\n+    //          <dc:title xml:lang=\"fr\">French Version (fr)</dc:title>\n+    //          <dc:description></dc:description>\n+    //     </skos:ConceptScheme>\n+    //\n+    // This will setup;\n+    //  {\n+    //      \"en\": \"English Version (en)\",\n+    //      \"fr\": \"French Version (fr)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "339c42012b6e884d49462e92e19ca934d6ab854d"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NDgxMTQ2OnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/thesaurus/ThesaurusDirective.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNjoyNDo0NFrOGos7Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjo1MzoxOVrOGpDcmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMzMjMxNA==", "bodyText": "This seem not used?", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r445332314", "createdAt": "2020-06-25T06:24:44Z", "author": {"login": "josegar74"}, "path": "web-ui/src/main/resources/catalog/components/thesaurus/ThesaurusDirective.js", "diffHunk": "@@ -266,11 +266,21 @@\n              scope.transformations.split(',') : [scope.transformations];\n              scope.maxTagsLabel = scope.maxTags || '\u221e';\n \n-             //Get langs of metadata\n-             var langs = [];\n-             _.each(JSON.parse(scope.lang),function(l){\n-                  langs.push(l.replace(\"#\",\"\"));\n+\n+             //examples;\n+             //hnap:{\"eng\":\"#eng\",\"fre\":\"#fra\"}\n+             //iso19139:{\"eng\":\"#EN\",\"fre\":\"#FR\",\"ger\":\"#DE\",\"chi\":\"#ZH\",\"ara\":\"#AR\",\"spa\":\"#ES\",\"rus\":\"#RU\"}\n+             scope.langConversion=JSON.parse(scope.lang); //dictionary, as above\n+\n+             // [\"eng\",\"fra\"]   OR [\"EN\",\"FR\",\"DE\",\"ZH\",\"AR\",\"ES\", \"RU\"]\n+             scope.langAchors = _.map(scope.langConversion,function(l){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b2e9c515f852c9e8803dadb546c2841c716b3af"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY2NjkxOA==", "bodyText": "will remove", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r445666918", "createdAt": "2020-06-25T16:00:04Z", "author": {"login": "davidblasby"}, "path": "web-ui/src/main/resources/catalog/components/thesaurus/ThesaurusDirective.js", "diffHunk": "@@ -266,11 +266,21 @@\n              scope.transformations.split(',') : [scope.transformations];\n              scope.maxTagsLabel = scope.maxTags || '\u221e';\n \n-             //Get langs of metadata\n-             var langs = [];\n-             _.each(JSON.parse(scope.lang),function(l){\n-                  langs.push(l.replace(\"#\",\"\"));\n+\n+             //examples;\n+             //hnap:{\"eng\":\"#eng\",\"fre\":\"#fra\"}\n+             //iso19139:{\"eng\":\"#EN\",\"fre\":\"#FR\",\"ger\":\"#DE\",\"chi\":\"#ZH\",\"ara\":\"#AR\",\"spa\":\"#ES\",\"rus\":\"#RU\"}\n+             scope.langConversion=JSON.parse(scope.lang); //dictionary, as above\n+\n+             // [\"eng\",\"fra\"]   OR [\"EN\",\"FR\",\"DE\",\"ZH\",\"AR\",\"ES\", \"RU\"]\n+             scope.langAchors = _.map(scope.langConversion,function(l){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMzMjMxNA=="}, "originalCommit": {"oid": "9b2e9c515f852c9e8803dadb546c2841c716b3af"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMTI3NQ==", "bodyText": "removed", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r445701275", "createdAt": "2020-06-25T16:53:19Z", "author": {"login": "davidblasby"}, "path": "web-ui/src/main/resources/catalog/components/thesaurus/ThesaurusDirective.js", "diffHunk": "@@ -266,11 +266,21 @@\n              scope.transformations.split(',') : [scope.transformations];\n              scope.maxTagsLabel = scope.maxTags || '\u221e';\n \n-             //Get langs of metadata\n-             var langs = [];\n-             _.each(JSON.parse(scope.lang),function(l){\n-                  langs.push(l.replace(\"#\",\"\"));\n+\n+             //examples;\n+             //hnap:{\"eng\":\"#eng\",\"fre\":\"#fra\"}\n+             //iso19139:{\"eng\":\"#EN\",\"fre\":\"#FR\",\"ger\":\"#DE\",\"chi\":\"#ZH\",\"ara\":\"#AR\",\"spa\":\"#ES\",\"rus\":\"#RU\"}\n+             scope.langConversion=JSON.parse(scope.lang); //dictionary, as above\n+\n+             // [\"eng\",\"fra\"]   OR [\"EN\",\"FR\",\"DE\",\"ZH\",\"AR\",\"ES\", \"RU\"]\n+             scope.langAchors = _.map(scope.langConversion,function(l){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMzMjMxNA=="}, "originalCommit": {"oid": "9b2e9c515f852c9e8803dadb546c2841c716b3af"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzYwOTEzOnYy", "diffSide": "RIGHT", "path": "web-ui/src/main/resources/catalog/components/thesaurus/ThesaurusService.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwNzoyMDo0NVrOG5-igA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwNzoyMDo0NVrOG5-igA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ0NjY1Ng==", "bodyText": "This looks to be failing when editing an english record using UI in french for example\n\nSomething to fix?", "url": "https://github.com/geonetwork/core-geonetwork/pull/4766#discussion_r463446656", "createdAt": "2020-07-31T07:20:45Z", "author": {"login": "fxprunayre"}, "path": "web-ui/src/main/resources/catalog/components/thesaurus/ThesaurusService.js", "diffHunk": "@@ -91,12 +123,36 @@\n               );\n             };\n \n+            var getUILangs = function() {\n+                  var currentUILang_3char = gnLangs.detectLang(\n+                                              gnGlobalSettings.gnCfg.langDetector,\n+                                              gnGlobalSettings\n+                                            );\n+                  var currentUILang2_3char = gnCurrentEdit.allLanguages.iso2code[currentUILang_3char].replace(\"#\",\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f4ec37698d36fd5908e6cdee103d91146a8c3f"}, "originalPosition": 84}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4113, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}