{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MjYxMDYw", "number": 5220, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxMToxNDo1M1rOE99RfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0OToyNlrOE-t0XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNDAyNDkzOnYy", "diffSide": "RIGHT", "path": "web/src/main/webapp/xslt/services/metadata/validate-fn.xsl", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxMToxNDo1M1rOH66kWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNDowNTowNFrOH6_jjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzOTAzMw==", "bodyText": "I don't believe you can hard code the reference the gmd:MD_TopicCategoryCode in the enumeration-valid error as the enumeration-valid is used to generate error messages for all kinds of invalid code list.  I believe this has to be a generic error handler for all enumeration-valid.\nThis  will most likely break validations of other code lists.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5220#discussion_r531539033", "createdAt": "2020-11-27T11:14:53Z", "author": {"login": "ianwallen"}, "path": "web/src/main/webapp/xslt/services/metadata/validate-fn.xsl", "diffHunk": "@@ -186,14 +187,10 @@\n                   </xsl:if>\n                 </xsl:when>\n                 <xsl:when test=\"$errorType = 'enumeration-valid'\">\n-                  <xsl:value-of select=\"$strings/enum1\"/> '<xsl:value-of\n-                  select=\"regex-group(1)\"/>'\n-                  <xsl:value-of select=\"$strings/enum2\"/>\n-                  <xsl:value-of\n-                    select=\"geonet:getTitleWithoutContext($schema, concat(regex-group(3), ':', regex-group(4)), $labels)\"\n-                  /> (<xsl:value-of select=\"concat(regex-group(3), ':', regex-group(4))\"/>).\n+                  <!--The topic category must be found in the following list-->\n                   <xsl:value-of select=\"$strings/enum3\"/>\n-                  <xsl:value-of select=\"regex-group(2)\"/>.\n+                  <!--The code list with translation text-->\n+                  (<xsl:value-of select=\"$codelists//codelist[@name='gmd:MD_TopicCategoryCode']/entry/value\" separator=\", \" />)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8ee2b9767fa25de803370a1a6c43c446b3b80ac"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTYyMDc1MA==", "bodyText": "The variable $strings/enum3 was confused label. It's really the enum element from Strings.xml. It servers as a label instead of the actual list. The enum3 is part of this pull request metadata101/iso19139.ca.HNAP#139\nThe old code used <xsl:value-of select=\"regex-group(2)\"/> as the list to parse. What I found is the list value got passed into this regex-group(2) is the codes from identification.xsd -> xs:simpleType name=\"MD_TopicCategoryCode_Type\". It's not possible to translate it to multi language. Thus I decided to use codelists instead.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5220#discussion_r531620750", "createdAt": "2020-11-27T14:05:04Z", "author": {"login": "wangf1122"}, "path": "web/src/main/webapp/xslt/services/metadata/validate-fn.xsl", "diffHunk": "@@ -186,14 +187,10 @@\n                   </xsl:if>\n                 </xsl:when>\n                 <xsl:when test=\"$errorType = 'enumeration-valid'\">\n-                  <xsl:value-of select=\"$strings/enum1\"/> '<xsl:value-of\n-                  select=\"regex-group(1)\"/>'\n-                  <xsl:value-of select=\"$strings/enum2\"/>\n-                  <xsl:value-of\n-                    select=\"geonet:getTitleWithoutContext($schema, concat(regex-group(3), ':', regex-group(4)), $labels)\"\n-                  /> (<xsl:value-of select=\"concat(regex-group(3), ':', regex-group(4))\"/>).\n+                  <!--The topic category must be found in the following list-->\n                   <xsl:value-of select=\"$strings/enum3\"/>\n-                  <xsl:value-of select=\"regex-group(2)\"/>.\n+                  <!--The code list with translation text-->\n+                  (<xsl:value-of select=\"$codelists//codelist[@name='gmd:MD_TopicCategoryCode']/entry/value\" separator=\", \" />)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTUzOTAzMw=="}, "originalCommit": {"oid": "f8ee2b9767fa25de803370a1a6c43c446b3b80ac"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTk3ODUyOnYy", "diffSide": "RIGHT", "path": "web/src/main/webapp/xslt/services/metadata/validate-fn.xsl", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0OToyNlrOH8BTUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0OToyNlrOH8BTUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5NzkzOA==", "bodyText": "I put test code like\nxsl:otherwise\nxsl:messageSkiped $error=<xsl:value-of select=\"$error\"></xsl:value-of></xsl:message>\n<xsl:value-of select=\"$error\"/>\n</xsl:otherwise>\nSo I summarized all skipped patterns:\nSkiped $error='' is not a valid value of union type 'Date_Type'.\nSkiped $error='' is not a valid value of union type 'Date_Type'.\nSkiped $error='' is not a valid value of union type 'Date_Type'. (Element: gco:Date with parent element: gmd:date)\nSkiped $error='' is not a valid value of union type 'Date_Type'. (Element: gco:Date with parent element: gmd:date)\nSkiped $error=Value '' is not facet-valid with respect to enumeration '[farming, biota, boundaries, climatologyMeteorologyAtmosphere, economy, elevation, environment, geoscientificInformation, health, imageryBaseMapsEarthCover, intelligenceMilitary, inlandWaters, location, oceans, planningCadastre, society, structure, transportation, utilitiesCommunication]'. It must be a value from the enumeration. (Element: gmd:MD_TopicCategoryCode with parent element: gmd:topicCategory)\nRealized there are three uncaught errors: enumeration-validwithparent, datatype-valid.1.2.3withparent, datatype-valid.1.2.3. So I added them accordingly.", "url": "https://github.com/geonetwork/core-geonetwork/pull/5220#discussion_r532697938", "createdAt": "2020-11-30T15:49:26Z", "author": {"login": "wangf1122"}, "path": "web/src/main/webapp/xslt/services/metadata/validate-fn.xsl", "diffHunk": "@@ -97,7 +97,12 @@\n       <!--cvc-type.3.1.3: The value 'DUMMY_DENOMINATOR' of element 'gco:Integer' is not valid. (Element: gco:Integer with parent element: gmd:denominator)-->\n       <rule errorType=\"type.3.1.3withparent\">The value '(.*)' of element '(.*)' is not valid\\. \\(Element: ([a-z]{3}):(.*) with parent element: (.*)\\)</rule>\n       <rule errorType=\"type.3.1.3\">The value '(.*)' of element '(.*)' is not valid\\.</rule>\n-      <rule errorType=\"enumeration-valid\">Value '(.*)' is not facet-valid with respect to enumeration '\\[(.*)\\]'\\. It must be a value from the enumeration\\. \\(Element: ([a-z]{3}):(.*) with parent element: (.*)\\)</rule>\n+      <rule errorType=\"enumeration-validwithparent\">Value '(.*)' is not facet-valid with respect to enumeration '\\[(.*)\\]'\\. It must be a value from the enumeration\\. \\(Element: ([a-z]{3}):(.*) with parent element: (.*)\\)</rule>\n+      <rule errorType=\"enumeration-valid\">Value '(.*)' is not facet-valid with respect to enumeration '\\[(.*)\\]'\\. It must be a value from the enumeration\\.</rule>\n+      <!--datatype-valid.1.2.3: '' is not a valid value of union type 'Date_Type'.-->\n+      <rule errorType=\"datatype-valid.1.2.3withparent\">'(.*)' is not a valid value of union type '(.*)'\\. \\(Element: ([a-z]{3}):(.*) with parent element:(.*)\\)</rule>\n+      <rule errorType=\"datatype-valid.1.2.3\">'(.*)' is not a valid value of union type '(.*)'\\.</rule>\n+\n     </xsl:variable>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9df8527bbac71f0a3ff8882b28bc9c452bcca4a"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4229, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}