{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjUzMzY5", "number": 849, "title": "RDM 7273 - Unable to reference more than one element of a complex type within the search and workbasket tabs", "bodyText": "JIRA link (if applicable)\nhttps://tools.hmcts.net/jira/browse/RDM-7273\nChange description\nUnable to reference more than one element of a complex type within the search and workbasket tabs\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[ ] No", "createdAt": "2020-03-16T13:57:47Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849", "merged": true, "mergeCommit": {"oid": "6a1b8f788f4d5dbff4318d02718fe6a4e5ea7739"}, "closed": true, "closedAt": "2020-03-22T18:16:00Z", "author": {"login": "smathangi"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcON4l0AH2gAyMzg5MjUzMzY5OjVhNTgyN2M2ZWMzYjBhMTFmM2JhNjJlYzdkZTk0OGQ5ZWJmNjIxZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQNcKkAH2gAyMzg5MjUzMzY5OmY5YmYxMDY4Njk1NDIyM2NhNWViM2FjMzAyNzQ4YTM3M2Y4NDljOWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5a5827c6ec3b0a11f3ba62ec7de948d9ebf621d8", "author": {"user": {"login": "smathangi", "name": "Sateesh Mathangi"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5a5827c6ec3b0a11f3ba62ec7de948d9ebf621d8", "committedDate": "2020-03-16T13:11:36Z", "message": "RDM-7273 - fixed complex fields filter issue in search/workbasket input filters and results."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d", "author": {"user": {"login": "smathangi", "name": "Sateesh Mathangi"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/4b374ec3c73065db0526af7cac2e7a32097ddb8d", "committedDate": "2020-03-16T14:05:32Z", "message": "RDM-7273 - fixed complex fields filter issue in search/workbasket input filters and results."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDY5MDUx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#pullrequestreview-375469051", "createdAt": "2020-03-16T18:11:00Z", "commit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODcwNjc2", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#pullrequestreview-375870676", "createdAt": "2020-03-17T09:36:40Z", "commit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOTozNjo0MFrOF3UWMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOTozNjo0MFrOF3UWMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0OTM2MQ==", "bodyText": "just realised that this is not gonna work for case roles. Nothing to do with this PR but raised the following ticket to keep track of this: https://tools.hmcts.net/jira/browse/RDM-7942", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393549361", "createdAt": "2020-03-17T09:36:40Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -80,11 +80,12 @@ private SearchResultViewColumn createSearchResultViewColumn(final SearchResultFi\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = buildCaseFieldId(resultField);\n+        if (addedFields.contains(id)) {\n             return false;\n         } else {\n             if (StringUtils.isEmpty(resultField.getRole()) || userRepository.getUserRoles().contains(resultField.getRole())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTgzNzMy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#pullrequestreview-375983732", "createdAt": "2020-03-17T12:23:35Z", "commit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyMzozNVrOF3Z2_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyMzozNVrOF3Z2_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzOTY3OA==", "bodyText": "consider moving this to a method in the CriteriaInput class itself for future reuse in other places as well. For example getPath or getFullId.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393639678", "createdAt": "2020-03-17T12:23:35Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/AuthorisedGetCriteriaOperation.java", "diffHunk": "@@ -63,15 +63,21 @@ private boolean criteriaAllowedByCRUD(CaseType caseType, CriteriaInput criteriaI\n     }\n \n     private boolean filterDistinctFieldsByRole(final Set<String> addedFields, final CriteriaInput criteriaInput, final Set<String> userRoles) {\n-        if (addedFields.contains(criteriaInput.getField().getId())) {\n+        String id = buildFieldId(criteriaInput);\n+        if (addedFields.contains(id)) {\n             return false;\n         } else {\n             if (StringUtils.isEmpty(criteriaInput.getRole()) || userRoles.contains(criteriaInput.getRole())) {\n-                addedFields.add(criteriaInput.getField().getId());\n+                addedFields.add(id);\n                 return true;\n             } else {\n                 return false;\n             }\n         }\n     }\n+\n+    private String buildFieldId(CriteriaInput criteriaInput) {\n+        return StringUtils.isEmpty(criteriaInput.getField().getElementPath()) ? criteriaInput.getField().getId() :\n+            criteriaInput.getField().getId() + '.' + criteriaInput.getField().getElementPath();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTg0MjM4", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#pullrequestreview-375984238", "createdAt": "2020-03-17T12:24:19Z", "commit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyNDoxOVrOF3Z4iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyNDoxOVrOF3Z4iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY0MDA3Mw==", "bodyText": "rather than buildCaseFieldId consider moving this to a method in the SearchResultField class itself for future reuse in other places as well. For example getPath or getFullId.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393640073", "createdAt": "2020-03-17T12:24:19Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -80,11 +80,12 @@ private SearchResultViewColumn createSearchResultViewColumn(final SearchResultFi\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = buildCaseFieldId(resultField);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTg0NTA1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#pullrequestreview-375984505", "createdAt": "2020-03-17T12:24:44Z", "commit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1bf60534682e2161a4a547e9efa743ae39f2b8c", "author": {"user": {"login": "mario-paniccia", "name": "Mario Paniccia"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f1bf60534682e2161a4a547e9efa743ae39f2b8c", "committedDate": "2020-03-17T12:24:50Z", "message": "Merge branch 'develop' into RDM-7273"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "991da7c0445b3bf418a490225654e9b7465049dd", "author": {"user": {"login": "smathangi", "name": "Sateesh Mathangi"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/991da7c0445b3bf418a490225654e9b7465049dd", "committedDate": "2020-03-17T14:08:37Z", "message": "RDM-7273 - review comment and tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTAzMTg1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#pullrequestreview-376103185", "createdAt": "2020-03-17T14:45:23Z", "commit": {"oid": "991da7c0445b3bf418a490225654e9b7465049dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0NToyM1rOF3fiLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0NToyM1rOF3fiLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMjY1Mw==", "bodyText": "can we have SearchResultField and CriteriaInput use the same method name please?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393732653", "createdAt": "2020-03-17T14:45:23Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -72,34 +72,27 @@ public SearchResultView execute(final CaseType caseType,\n \n     private SearchResultViewColumn createSearchResultViewColumn(final SearchResultField searchResultField, final CaseField caseField) {\n         return new SearchResultViewColumn(\n-            buildCaseFieldId(searchResultField),\n+            searchResultField.buildCaseFieldId(),\n             buildCaseFieldType(searchResultField, caseField),\n             searchResultField.getLabel(),\n             searchResultField.getDisplayOrder(),\n             searchResultField.isMetadata());\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = resultField.buildCaseFieldId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "991da7c0445b3bf418a490225654e9b7465049dd"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTAzMzAy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#pullrequestreview-376103302", "createdAt": "2020-03-17T14:45:31Z", "commit": {"oid": "991da7c0445b3bf418a490225654e9b7465049dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90f663876a3bf7f5a0d4574d2f7451b8aabf8043", "author": {"user": {"login": "smathangi", "name": "Sateesh Mathangi"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/90f663876a3bf7f5a0d4574d2f7451b8aabf8043", "committedDate": "2020-03-18T11:03:53Z", "message": "RDM-7273 - review comment - method name change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baa32edf84f8f5cde44d2f22da96833e985667b2", "author": {"user": {"login": "Olawale", "name": "Olawale Olanrewaju"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/baa32edf84f8f5cde44d2f22da96833e985667b2", "committedDate": "2020-03-20T08:49:38Z", "message": "Merge branch 'develop' into RDM-7273"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6c9be0593ecf79ede13785a4e43cd3a0283460c", "author": {"user": {"login": "smathangi", "name": "Sateesh Mathangi"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/d6c9be0593ecf79ede13785a4e43cd3a0283460c", "committedDate": "2020-03-20T09:22:33Z", "message": "RDM-7273 - changing method name back to buildCaseFieldId as json trying to serialise getFullId method. Though we can ignore with @JsonIgnore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9bf10686954223ca5eb3ac302748a373f849c9d", "author": {"user": {"login": "Olawale", "name": "Olawale Olanrewaju"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f9bf10686954223ca5eb3ac302748a373f849c9d", "committedDate": "2020-03-22T17:48:24Z", "message": "Merge branch 'develop' into RDM-7273"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2626, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}