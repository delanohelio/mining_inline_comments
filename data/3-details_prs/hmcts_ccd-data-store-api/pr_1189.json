{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExODEwMzMy", "number": 1189, "title": "RDM-9587 FTs for the Conditional Post States", "bodyText": "JIRA link (if applicable)\nhttps://tools.hmcts.net/jira/browse/RDM-9587\nChange description\nFTs for the Conditional Post States\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[ X] No", "createdAt": "2020-10-28T20:12:32Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1189", "merged": true, "mergeCommit": {"oid": "b09747283f45fba8b2ad8e51cf04ae77df1a60b7"}, "closed": true, "closedAt": "2020-10-30T10:32:36Z", "author": {"login": "rafalkalita"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXDUqvgH2gAyNTExODEwMzMyOmVjZjMwZWFkNzQ5NDg4MjE2NTZhZjkyMDY2M2I5M2I0YzdhZjI5OTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXjUy0gH2gAyNTExODEwMzMyOjJmNGU4NjFjZTE1NDlmMGIyMTYwYmFmZjU2YzY0MzAwMWI2MTk1MDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ecf30ead74948821656af920663b93b4c7af2997", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/ecf30ead74948821656af920663b93b4c7af2997", "committedDate": "2020-10-28T20:09:47Z", "message": "RDM-9587 FTA's for Conditional Event Post States"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77543b66cb14038a6fe82fe416032b0340005591", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/77543b66cb14038a6fe82fe416032b0340005591", "committedDate": "2020-10-28T20:09:47Z", "message": "RDM-9587 FTA's for Conditional Event Post States. All ACs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "290e803f16e5e785f9c368aa72ac59fbf42b90c6", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/290e803f16e5e785f9c368aa72ac59fbf42b90c6", "committedDate": "2020-10-28T20:09:47Z", "message": "RDM-9587 FTA's for Conditional Event Post States - complex types."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "498fa1996b457dc5fb0c5742ccc9328f06343888", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/498fa1996b457dc5fb0c5742ccc9328f06343888", "committedDate": "2020-10-28T20:10:07Z", "message": "RDM-9587 Added pre-released befta-fw: 5.19.0-RDM-9587"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NDk5ODYz", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1189#pullrequestreview-519499863", "createdAt": "2020-10-29T09:56:49Z", "commit": {"oid": "498fa1996b457dc5fb0c5742ccc9328f06343888"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1Njo0OVrOHqUUOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTo1Njo0OVrOHqUUOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEzNTA5Ng==", "bodyText": "I think we can just do this, instead of calling data-store again:\n\"${[scenarioContext][parentContext][childContexts][S-122-GetToken_CaseCreate][testData][actualResponse][body][token]}\"\nThis applies to all call like this", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1189#discussion_r514135096", "createdAt": "2020-10-29T09:56:49Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/aat/resources/features/F-122 - Conditional Event Post States/F-122.feature", "diffHunk": "@@ -0,0 +1,150 @@\n+#==============================================\n+@F-122 @focus\n+Feature: F-122: Conditional Event Post States\n+#==============================================\n+#  Tests 1-3 use updateCase event with the post state condition:\n+#  CaseCreated -> CaseUpdated(TextField=\"updated\" AND EmailField=\"*\"):1;CaseAmended(TextField=\"amended\" AND EmailField=\"*\"):2;CaseRevoked(AddressField.AddressLine1=\"revoked\" AND EmailField=\"*\"):3;CaseDeleted\n+#\n+#  Tests 4-7 use updateCase2 event with the post state condition:\n+#  CaseCreated -> CaseUpdated2(TextField=\"updated2\" OR EmailField=\"*\"):1;CaseAmended2(TextField=\"amended2\" OR EmailField=\"matched@test.com\"):2;*(TextField=\"keepstate\"):3;CaseRevoked2(EmailField!=\"\"):4;CaseDeleted\n+\n+  Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+#-----------------------------------------------------------------------------------------------------------------------\n+  @S-122.1\n+  Scenario: Defaults the state when none of the post state conditions resolves using AND operator (End state: CaseDeleted)\n+\n+    Given a user with [an active profile in CCD],\n+    And a successful call [to create a token for case creation] as in [S-122-GetToken_CaseCreate],\n+    And a successful call [to create a case] as in [FT_ConditionalPostState_Create_Case],\n+    And a successful call [to get an event token for the case just created] as in [S-122-GetToken_UpdateCase],\n+\n+    When a request is prepared with appropriate values,\n+    And the request [contains a case Id that has just been created],\n+    And the request [contains Update token created as in S-122-GetToken_UpdateCase],\n+    And it is submitted to call the [submit updateCase event with TextField and EmailField values] operation of [CCD data store],\n+\n+    Then a positive response is received,\n+    And the response [contains state: CaseDeleted, updated values for TextField, EmailField along with an HTTP-201 Created],\n+\n+#-----------------------------------------------------------------------------------------------------------------------\n+  @S-122.2\n+  Scenario: Sets the state defined with a matching post state condition using AND operator (End state: CaseAmended)\n+\n+    Given a user with [an active profile in CCD],\n+    And a successful call [to create a token for case creation] as in [S-122-GetToken_CaseCreate],\n+    And a successful call [to create a case] as in [FT_ConditionalPostState_Create_Case],\n+    And a successful call [to get an event token for the case just created] as in [S-122-GetToken_UpdateCase],\n+\n+    When a request is prepared with appropriate values,\n+    And the request [contains a case Id that has just been created],\n+    And the request [contains Update token created as in S-122-GetToken_UpdateCase],\n+    And it is submitted to call the [submit updateCase event with TextField and EmailField values] operation of [CCD data store],\n+\n+    Then a positive response is received,\n+    And the response [contains state: CaseAmended, updated values for TextField, EmailField along with an HTTP-201 Created],\n+\n+#-----------------------------------------------------------------------------------------------------------------------\n+  @S-122.3\n+  Scenario: EmailField=\"*\" operator should not match when field is not defined (End state: CaseDeleted)\n+\n+    Given a user with [an active profile in CCD],\n+    And a successful call [to create a token for case creation] as in [S-122-GetToken_CaseCreate],\n+    And a successful call [to create a case] as in [FT_ConditionalPostState_Create_Case],\n+    And a successful call [to get an event token for the case just created] as in [S-122-GetToken_UpdateCase],\n+\n+    When a request is prepared with appropriate values,\n+    And the request [contains a case Id that has just been created],\n+    And the request [contains Update token created as in S-122-GetToken_UpdateCase],\n+    And it is submitted to call the [submit updateCase event with TextField and EmailField values] operation of [CCD data store],\n+\n+    Then a positive response is received,\n+    And the response [contains state: CaseDeleted, updated values for TextField, EmailField along with an HTTP-201 Created],\n+\n+#-----------------------------------------------------------------------------------------------------------------------\n+  @S-122.4\n+  Scenario: Sets the state defined with a matching post state condition using a complex field (End state: CaseRevoked)\n+\n+    Given a user with [an active profile in CCD],\n+    And a successful call [to create a token for case creation] as in [S-122-GetToken_CaseCreate],\n+    And a successful call [to create a case] as in [FT_ConditionalPostState_Create_Case],\n+    And a successful call [to get an event token for the case just created] as in [S-122-GetToken_UpdateCase],\n+\n+    When a request is prepared with appropriate values,\n+    And the request [contains a case Id that has just been created],\n+    And the request [contains Update token created as in S-122-GetToken_UpdateCase],\n+    And it is submitted to call the [submit updateCase event with AddressField.AddressLine1 and EmailField values] operation of [CCD data store],\n+\n+    Then a positive response is received,\n+    And the response [contains state: CaseRevoked, updated values for AddressField.AddressLine1, EmailField along with an HTTP-201 Created],\n+\n+#-----------------------------------------------------------------------------------------------------------------------\n+  @S-122.5\n+  Scenario: Ordering should take precedence when both conditions resolve (End state: CaseUpdated2)\n+\n+    Given a user with [an active profile in CCD],\n+    And a successful call [to create a token for case creation] as in [S-122-GetToken_CaseCreate],\n+    And a successful call [to create a case] as in [FT_ConditionalPostState_Create_Case],\n+    And a successful call [to get an event token for the case just created] as in [S-122-GetToken_UpdateCase],\n+\n+    When a request is prepared with appropriate values,\n+    And the request [contains a case Id that has just been created],\n+    And the request [contains Update token created as in S-122-GetToken_UpdateCase],\n+    And it is submitted to call the [submit updateCase2 event with TextField and EmailField values] operation of [CCD data store],\n+\n+    Then a positive response is received,\n+    And the response [contains state: CaseUpdated2, updated values for TextField, EmailField along with an HTTP-201 Created],\n+\n+#-----------------------------------------------------------------------------------------------------------------------\n+  @S-122.6\n+  Scenario: Sets the state defined with a matching post state condition using OR operator (End state: CaseAmended2)\n+\n+    Given a user with [an active profile in CCD],\n+    And a successful call [to create a token for case creation] as in [S-122-GetToken_CaseCreate],\n+    And a successful call [to create a case] as in [FT_ConditionalPostState_Create_Case],\n+    And a successful call [to get an event token for the case just created] as in [S-122-GetToken_UpdateCase],\n+\n+    When a request is prepared with appropriate values,\n+    And the request [contains a case Id that has just been created],\n+    And the request [contains Update token created as in S-122-GetToken_UpdateCase],\n+    And it is submitted to call the [submit updateCase2 event with TextField and EmailField values] operation of [CCD data store],\n+\n+    Then a positive response is received,\n+    And the response [contains state: CaseAmended2, updated values for TextField, EmailField along with an HTTP-201 Created],\n+\n+#-----------------------------------------------------------------------------------------------------------------------\n+  @S-122.7\n+  Scenario: *(FieldA) will keep the state as is (End state: CaseCretated)\n+\n+    Given a user with [an active profile in CCD],\n+    And a successful call [to create a token for case creation] as in [S-122-GetToken_CaseCreate],\n+    And a successful call [to create a case] as in [FT_ConditionalPostState_Create_Case],\n+    And a successful call [to get an event token for the case just created] as in [S-122-GetToken_UpdateCase],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "498fa1996b457dc5fb0c5742ccc9328f06343888"}, "originalPosition": 123}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTAxNDY0", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1189#pullrequestreview-519501464", "createdAt": "2020-10-29T09:58:43Z", "commit": {"oid": "498fa1996b457dc5fb0c5742ccc9328f06343888"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c1a18b333220855bb7b6964f86246576af3e5ed", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/0c1a18b333220855bb7b6964f86246576af3e5ed", "committedDate": "2020-10-29T10:40:35Z", "message": "RDM-9587 pre-release befta-fw: 5.19.0-RDM-9893-RDM-9587"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e2318188570d2e4b81d1bc4af7fffe20b857f55", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/4e2318188570d2e4b81d1bc4af7fffe20b857f55", "committedDate": "2020-10-29T11:34:24Z", "message": "RDM-9587 remove focus tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTc0ODYx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1189#pullrequestreview-519574861", "createdAt": "2020-10-29T11:36:33Z", "commit": {"oid": "4e2318188570d2e4b81d1bc4af7fffe20b857f55"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ecdf368c9dfa34956dbf048cba78ece18a96e2e", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5ecdf368c9dfa34956dbf048cba78ece18a96e2e", "committedDate": "2020-10-29T14:38:30Z", "message": "RDM-9587 Fix assertion steps, update to befta-fw 5.19.0-RDM-9587.1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTAyMDEw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1189#pullrequestreview-519902010", "createdAt": "2020-10-29T17:20:10Z", "commit": {"oid": "5ecdf368c9dfa34956dbf048cba78ece18a96e2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4e861ce1549f0b2160baff56c643001b619505", "author": {"user": {"login": "Olawale", "name": "Olawale Olanrewaju"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/2f4e861ce1549f0b2160baff56c643001b619505", "committedDate": "2020-10-30T09:26:53Z", "message": "Updated to latest befta-fw"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2660, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}