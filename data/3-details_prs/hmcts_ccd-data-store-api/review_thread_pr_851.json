{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5OTc5NDg3", "number": 851, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToyMzoyOVrODq7-sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo1Mjo1NlrODrKJLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MzQ5NDkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/WizardPageComplexFieldOverride.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToyMzoyOVrOF6_quA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToyMzoyOVrOF6_quA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQwNDg1Ng==", "bodyText": "could you add a description ? @apimodel(description = \"\")", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397404856", "createdAt": "2020-03-24T19:23:29Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/WizardPageComplexFieldOverride.java", "diffHunk": "@@ -4,6 +4,7 @@\n import io.swagger.annotations.ApiModel;\n \n import java.io.Serializable;\n+import java.util.Optional;\n \n @ApiModel(description = \"\")\n public class WizardPageComplexFieldOverride implements Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MzUxMDc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/CaseViewFieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToyODoxM1rOF6_0hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToyODoxM1rOF6_0hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQwNzM2NQ==", "bodyText": "public CaseViewField execute(CaseViewField caseViewField)  and\npublic CaseViewField execute(CaseViewField caseViewField, WizardPageField wizardPageField)\nare very similar in their implementation .   Can you create a generic common method ?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397407365", "createdAt": "2020-03-24T19:28:13Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/CaseViewFieldProcessor.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.COLLECTION;\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.COMPLEX;\n+\n+public abstract class CaseViewFieldProcessor extends FieldProcessor {\n+\n+    public CaseViewFieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        super(caseViewFieldBuilder);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MzUxNDQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToyOToxNVrOF6_22w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToyOToxNVrOF6_22w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQwNzk2Mw==", "bodyText": "avoid using *.  here is an example of how to set intelij  https://stackoverflow.com/questions/3348816/intellij-never-use-wildcard-imports#3348855", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397407963", "createdAt": "2020-03-24T19:29:15Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.DisplayContext;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageComplexFieldOverride;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.*;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MzUyMDA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOTozMDozNFrOF6_6ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOTozMDozNFrOF6_6ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQwODg2OA==", "bodyText": "The same .*", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397408868", "createdAt": "2020-03-24T19:30:34Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.DisplayContext;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageComplexFieldOverride;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.*;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.getDisplayContextParameterOfType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MzUzMzg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOTozNDo1NFrOF7ADHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOTozNDo1NFrOF7ADHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQxMTEwMg==", "bodyText": "protected CaseViewField executeSimple(CaseViewField caseViewField, BaseType baseType)  and\nprotected CaseViewField executeCollection(CaseViewField caseViewField)\nseems quite similar regardless of  executeCollection () or executeSimple()", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397411102", "createdAt": "2020-03-24T19:34:54Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.DisplayContext;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageComplexFieldOverride;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.*;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.getDisplayContextParameterOfType;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.hasDisplayContextParameterType;\n+\n+@Component\n+public class DateTimeValueFormatter extends CaseViewFieldProcessor {\n+\n+    private static final List<String> SUPPORTED_TYPES = Arrays.asList(DATETIME, DATE);\n+    private static final Map<DisplayContext, DisplayContextParameterType> ENUM_MAP = new EnumMap<>(DisplayContext.class);\n+\n+    private final DateTimeFormatParser dateTimeFormatParser;\n+\n+    static {\n+        ENUM_MAP.put(DisplayContext.MANDATORY, DisplayContextParameterType.DATETIMEENTRY);\n+        ENUM_MAP.put(DisplayContext.OPTIONAL, DisplayContextParameterType.DATETIMEENTRY);\n+        ENUM_MAP.put(DisplayContext.READONLY, DisplayContextParameterType.DATETIMEDISPLAY);\n+    }\n+\n+    @Autowired\n+    public DateTimeValueFormatter(DateTimeFormatParser dateTimeFormatParser,\n+                                  CaseViewFieldBuilder caseViewFieldBuilder) {\n+        super(caseViewFieldBuilder);\n+        this.dateTimeFormatParser = dateTimeFormatParser;\n+    }\n+\n+    @Override\n+    protected CaseViewField executeSimple(CaseViewField caseViewField, BaseType baseType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTM1Mjc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/aggregated/CommonField.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODo1MDoxN1rOF7RFLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODo1MDoxN1rOF7RFLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY5MDE1OQ==", "bodyText": "we have a model object DisplayContextParameter. Can we use that instead of String? it would reduce the boilerplate in the code", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397690159", "createdAt": "2020-03-25T08:50:17Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/aggregated/CommonField.java", "diffHunk": "@@ -29,6 +30,10 @@\n \n     void setDisplayContextParameter(String displayContextParameter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTM4OTc2OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/aggregated/CommonField.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOTowMDoxN1rOF7Rb-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOTowMjoxNVrOF7Rf4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY5NTk5Mw==", "bodyText": "this method in case the value of display context is \"HIDDEN\" is going to return null. Which is logically wrong.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397695993", "createdAt": "2020-03-25T09:00:17Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/aggregated/CommonField.java", "diffHunk": "@@ -44,6 +49,13 @@ default boolean isCompoundFieldType() {\n         return isCollectionFieldType() || isComplexFieldType();\n     }\n \n+    default DisplayContext displayContextType() {\n+        return Optional.ofNullable(getDisplayContext())\n+            .filter(dc -> !dc.equals(\"HIDDEN\"))\n+            .map(DisplayContext::valueOf)\n+            .orElse(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY5Njk5Mw==", "bodyText": "I would also avoid wrapping nulls into Optional just to be able to use its api. In the end is probably making the code more complicated to read", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397696993", "createdAt": "2020-03-25T09:02:15Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/aggregated/CommonField.java", "diffHunk": "@@ -44,6 +49,13 @@ default boolean isCompoundFieldType() {\n         return isCollectionFieldType() || isComplexFieldType();\n     }\n \n+    default DisplayContext displayContextType() {\n+        return Optional.ofNullable(getDisplayContext())\n+            .filter(dc -> !dc.equals(\"HIDDEN\"))\n+            .map(DisplayContext::valueOf)\n+            .orElse(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY5NTk5Mw=="}, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTM5ODY3OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/WizardPageComplexFieldOverride.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOTowMjo1OFrOF7Rhnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOTowMjo1OFrOF7Rhnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY5NzQzOQ==", "bodyText": "same as above", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397697439", "createdAt": "2020-03-25T09:02:58Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/WizardPageComplexFieldOverride.java", "diffHunk": "@@ -67,4 +68,11 @@ public String getDisplayContextParameter() {\n     public void setDisplayContextParameter(String displayContextParameter) {\n         this.displayContextParameter = displayContextParameter;\n     }\n+\n+    public DisplayContext displayContextType() {\n+        return Optional.ofNullable(getDisplayContext())\n+            .filter(dc -> !dc.equals(\"HIDDEN\"))\n+            .map(DisplayContext::valueOf)\n+            .orElse(null);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTQ1MzEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOToxNzo1N1rOF7SDVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOToxNzo1N1rOF7SDVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcwNjA3MA==", "bodyText": "the logic that loops through collection fields and navigates complex fields is common logic that applies to all processors. So it should be made generic and written only once rather than being inside each single subclass of CaseViewFieldProcessor. But we can ignore this comment for now as I have raised a separate ticket to introduce a generic Processor: https://tools.hmcts.net/jira/browse/RDM-8010", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397706070", "createdAt": "2020-03-25T09:17:57Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.DisplayContext;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageComplexFieldOverride;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.*;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.getDisplayContextParameterOfType;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.hasDisplayContextParameterType;\n+\n+@Component\n+public class DateTimeValueFormatter extends CaseViewFieldProcessor {\n+\n+    private static final List<String> SUPPORTED_TYPES = Arrays.asList(DATETIME, DATE);\n+    private static final Map<DisplayContext, DisplayContextParameterType> ENUM_MAP = new EnumMap<>(DisplayContext.class);\n+\n+    private final DateTimeFormatParser dateTimeFormatParser;\n+\n+    static {\n+        ENUM_MAP.put(DisplayContext.MANDATORY, DisplayContextParameterType.DATETIMEENTRY);\n+        ENUM_MAP.put(DisplayContext.OPTIONAL, DisplayContextParameterType.DATETIMEENTRY);\n+        ENUM_MAP.put(DisplayContext.READONLY, DisplayContextParameterType.DATETIMEDISPLAY);\n+    }\n+\n+    @Autowired\n+    public DateTimeValueFormatter(DateTimeFormatParser dateTimeFormatParser,\n+                                  CaseViewFieldBuilder caseViewFieldBuilder) {\n+        super(caseViewFieldBuilder);\n+        this.dateTimeFormatParser = dateTimeFormatParser;\n+    }\n+\n+    @Override\n+    protected CaseViewField executeSimple(CaseViewField caseViewField, BaseType baseType) {\n+        caseViewField.setFormattedValue(\n+            caseViewField.getValue() instanceof TextNode && hasSupportedDisplayContextParameter(caseViewField.getDisplayContextParameter()) ?\n+                executeSimple((TextNode) caseViewField.getValue(), caseViewField, baseType, caseViewField.getId(), null, caseViewField) :\n+                caseViewField.getValue()\n+        );\n+\n+        return caseViewField;\n+    }\n+\n+    @Override\n+    protected CaseViewField executeCollection(CaseViewField caseViewField) {\n+        caseViewField.setFormattedValue(\n+            caseViewField.getValue() instanceof ArrayNode && hasSupportedDisplayContextParameter(caseViewField.getDisplayContextParameter()) ?\n+                executeCollection((ArrayNode) caseViewField.getValue(), caseViewField, caseViewField.getId(), null, caseViewField) :\n+                caseViewField.getValue()\n+        );\n+\n+        return caseViewField;\n+    }\n+\n+    @Override\n+    protected JsonNode executeSimple(JsonNode node, CommonField field, BaseType baseType, String fieldPath, WizardPageComplexFieldOverride override, CaseViewField topLevelField) {\n+        final DisplayContext displayContext = displayContext(topLevelField, override);\n+        return !isNullOrEmpty(node)\n+            && hasDisplayContextParameterType(field.getDisplayContextParameter(), ENUM_MAP.get(displayContext))\n+            && isSupportedBaseType(baseType, SUPPORTED_TYPES) ?\n+            createNode(field.getDisplayContextParameter(), node.asText(), baseType, fieldPath, displayContext) :\n+            node;\n+    }\n+\n+    @Override\n+    protected JsonNode executeCollection(JsonNode collectionNode, CommonField caseViewField, String fieldPath, WizardPageComplexFieldOverride override, CaseViewField topLevelField) {\n+        final BaseType collectionFieldType = BaseType.get(caseViewField.getFieldType().getCollectionFieldType().getType());\n+        final DisplayContext displayContext = displayContext(topLevelField, override);\n+\n+        if (hasDisplayContextParameterType(caseViewField.getDisplayContextParameter(), ENUM_MAP.get(displayContext))\n+            && isSupportedBaseType(collectionFieldType, SUPPORTED_TYPES)) {\n+            ArrayNode newNode = MAPPER.createArrayNode();\n+            collectionNode.forEach(item -> {\n+                JsonNode newItem = item.deepCopy();\n+                ((ObjectNode)newItem).replace(CollectionValidator.VALUE,\n+                    createNode(caseViewField.getDisplayContextParameter(), item.get(CollectionValidator.VALUE).asText(), collectionFieldType, fieldPath, displayContext));\n+                newNode.add(newItem);\n+            });\n+\n+            return newNode;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTQ2NTc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/AbstractDefaultGetCaseViewOperation.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOToyMTowOVrOF7SLBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOToyMTowOVrOF7SLBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcwODAzOA==", "bodyText": "minor:\nthis method is becoming a bit too long. It's generally not recommended to have long sequences of chained methods because it makes the code difficult to understand. It could be useful breaking this down", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397708038", "createdAt": "2020-03-25T09:21:09Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/AbstractDefaultGetCaseViewOperation.java", "diffHunk": "@@ -79,6 +83,7 @@ CaseDetails getCaseDetails(String caseReference) {\n             CommonField[] caseViewFields = tab.getTabFields().stream()\n                 .filter(filterCaseTabFieldsBasedOnSecureData(caseDetails))\n                 .map(caseTypeTabField -> CaseViewField.createFrom(caseTypeTabField, data))\n+                .map(fieldProcessorService::processCaseViewField)\n                 .toArray(CaseViewField[]::new);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTQ4OTU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/CaseViewFieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOToyNzowOFrOF7SZtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwOToyNzowOFrOF7SZtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxMTc5Nw==", "bodyText": "we could reduce boilerplate by adding a\nisCollectionFieldType() and isComplexFieldType() methods to FieldType", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397711797", "createdAt": "2020-03-25T09:27:08Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/CaseViewFieldProcessor.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.COLLECTION;\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.COMPLEX;\n+\n+public abstract class CaseViewFieldProcessor extends FieldProcessor {\n+\n+    public CaseViewFieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        super(caseViewFieldBuilder);\n+    }\n+\n+    public CaseViewField execute(CaseViewField caseViewField) {\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8f6cb84763a0137ddc1f67375f925406b31646"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTc4ODc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessorService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo0NTozNVrOF7VVVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo0NTozNVrOF7VVVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc1OTgyOA==", "bodyText": "minor:\nI can see more and more often we need to find a wizard field corresponding to a certain field id. Probably we could introduce a method on the UIDefinitionRepository that returns a map of the wizard fields by fieldID", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397759828", "createdAt": "2020-03-25T10:45:35Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessorService.java", "diffHunk": "@@ -66,6 +81,27 @@ public FieldProcessorService(final List<CaseDataFieldProcessor> caseDataFieldPro\n         return processData(data, caseType, eventTriggerService.findCaseEvent(caseType, eventId));\n     }\n \n+    private CaseViewField processCaseViewField(final CaseViewField field,\n+                                               final List<WizardPageField> wizardPageFields) {\n+        CaseViewField result = field;\n+        for (CaseViewFieldProcessor processor : caseViewFieldProcessors) {\n+            result = processor.execute(result, wizardPageField(wizardPageFields, field.getId()));\n+        }\n+        return result;\n+    }\n+\n+    private List<WizardPageField> getWizardPageFields(String caseTypeId, String eventId) {\n+        return uiDefinitionRepository.getWizardPageCollection(caseTypeId, eventId)\n+            .stream()\n+            .map(WizardPage::getWizardPageFields)\n+            .flatMap(List::stream)\n+            .collect(Collectors.toList());\n+    }\n+\n+    private WizardPageField wizardPageField(List<WizardPageField> wizardPageFields, String fieldId) {\n+        return wizardPageFields.stream().filter(f -> f.getCaseFieldId().equals(fieldId)).findAny().orElse(null);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a621679cbe24209b65bcfa1e1b33acad841a31cd"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTgwNTU1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo1MDowOFrOF7Vfhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo1MDowOFrOF7Vfhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc2MjQzOQ==", "bodyText": "duplicated", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397762439", "createdAt": "2020-03-25T10:50:08Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeValueFormatter.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.DisplayContext;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageComplexFieldOverride;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.*;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.getDisplayContextParameterOfType;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.hasDisplayContextParameterType;\n+\n+@Component\n+public class DateTimeValueFormatter extends CaseViewFieldProcessor {\n+\n+    private static final List<String> SUPPORTED_TYPES = Arrays.asList(DATETIME, DATE);\n+    private static final Map<DisplayContext, DisplayContextParameterType> ENUM_MAP = new EnumMap<>(DisplayContext.class);\n+\n+    private final DateTimeFormatParser dateTimeFormatParser;\n+\n+    static {\n+        ENUM_MAP.put(DisplayContext.MANDATORY, DisplayContextParameterType.DATETIMEENTRY);\n+        ENUM_MAP.put(DisplayContext.OPTIONAL, DisplayContextParameterType.DATETIMEENTRY);\n+        ENUM_MAP.put(DisplayContext.READONLY, DisplayContextParameterType.DATETIMEDISPLAY);\n+    }\n+\n+    @Autowired\n+    public DateTimeValueFormatter(DateTimeFormatParser dateTimeFormatParser,\n+                                  CaseViewFieldBuilder caseViewFieldBuilder) {\n+        super(caseViewFieldBuilder);\n+        this.dateTimeFormatParser = dateTimeFormatParser;\n+    }\n+\n+    @Override\n+    protected CaseViewField executeSimple(CaseViewField caseViewField, BaseType baseType) {\n+        caseViewField.setFormattedValue(\n+            caseViewField.getValue() instanceof TextNode && hasSupportedDisplayContextParameter(caseViewField.getDisplayContextParameter()) ?\n+                executeSimple((TextNode) caseViewField.getValue(), caseViewField, baseType, caseViewField.getId(), null, caseViewField) :\n+                caseViewField.getValue()\n+        );\n+\n+        return caseViewField;\n+    }\n+\n+    @Override\n+    protected CaseViewField executeCollection(CaseViewField caseViewField) {\n+        caseViewField.setFormattedValue(\n+            caseViewField.getValue() instanceof ArrayNode && hasSupportedDisplayContextParameter(caseViewField.getDisplayContextParameter()) ?\n+                executeCollection((ArrayNode) caseViewField.getValue(), caseViewField, caseViewField.getId(), null, caseViewField) :\n+                caseViewField.getValue()\n+        );\n+\n+        return caseViewField;\n+    }\n+\n+    @Override\n+    protected JsonNode executeSimple(JsonNode node, CommonField field, BaseType baseType, String fieldPath, WizardPageComplexFieldOverride override, CaseViewField topLevelField) {\n+        final DisplayContext displayContext = displayContext(topLevelField, override);\n+        return !isNullOrEmpty(node)\n+            && hasDisplayContextParameterType(field.getDisplayContextParameter(), ENUM_MAP.get(displayContext))\n+            && isSupportedBaseType(baseType, SUPPORTED_TYPES) ?\n+            createNode(field.getDisplayContextParameter(), node.asText(), baseType, fieldPath, displayContext) :\n+            node;\n+    }\n+\n+    @Override\n+    protected JsonNode executeCollection(JsonNode collectionNode, CommonField caseViewField, String fieldPath, WizardPageComplexFieldOverride override, CaseViewField topLevelField) {\n+        final BaseType collectionFieldType = BaseType.get(caseViewField.getFieldType().getCollectionFieldType().getType());\n+        final DisplayContext displayContext = displayContext(topLevelField, override);\n+\n+        if (hasDisplayContextParameterType(caseViewField.getDisplayContextParameter(), ENUM_MAP.get(displayContext))\n+            && isSupportedBaseType(collectionFieldType, SUPPORTED_TYPES)) {\n+            ArrayNode newNode = MAPPER.createArrayNode();\n+            collectionNode.forEach(item -> {\n+                JsonNode newItem = item.deepCopy();\n+                ((ObjectNode)newItem).replace(CollectionValidator.VALUE,\n+                    createNode(caseViewField.getDisplayContextParameter(), item.get(CollectionValidator.VALUE).asText(), collectionFieldType, fieldPath, displayContext));\n+                newNode.add(newItem);\n+            });\n+\n+            return newNode;\n+        }\n+\n+        return collectionNode;\n+    }\n+\n+    private TextNode createNode(String displayContextParameter, String valueToConvert, BaseType baseType, String fieldPath, DisplayContext displayContext) {\n+        if (ENUM_MAP.containsKey(displayContext)) {\n+            String format = format(displayContextParameter, displayContext, baseType);\n+            try {\n+                if (baseType == BaseType.get(DATETIME)) {\n+                    return new TextNode(dateTimeFormatParser.convertIso8601ToDateTime(format, valueToConvert));\n+                } else {\n+                    return new TextNode(dateTimeFormatParser.convertIso8601ToDate(format, valueToConvert));\n+                }\n+            } catch (Exception e) {\n+                throw new DataProcessingException().withDetails(\n+                    String.format(\"Unable to process field %s with value %s. Expected format: %s\",\n+                        fieldPath,\n+                        valueToConvert,\n+                        format)\n+                );\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a621679cbe24209b65bcfa1e1b33acad841a31cd"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTgxNTUwOnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessorServiceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo1Mjo1NlrOF7Vlsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo1Mjo1NlrOF7Vlsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc2NDAxOQ==", "bodyText": "we should add a good bunch of  integration tests to protect ourselves from regressions", "url": "https://github.com/hmcts/ccd-data-store-api/pull/851#discussion_r397764019", "createdAt": "2020-03-25T10:52:56Z", "author": {"login": "mario-paniccia"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessorServiceTest.java", "diffHunk": "@@ -0,0 +1,238 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a621679cbe24209b65bcfa1e1b33acad841a31cd"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3911, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}