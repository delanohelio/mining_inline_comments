{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MjQ3NzAz", "number": 819, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoyMDoxMlrODipMJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMjoxMjozN1rODncNmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjUzMDI4OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolver.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoyMDoxMlrOFuAaKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozOTo0NFrOFuIjrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc4NTUxMg==", "bodyText": "this method interface signature should be more generic. The fact that jurisdictions are retrieved from Idam is a detail of one of the interface implementations. Other implementation might retrieve jurisdiction not from Idam but from other places for example user profile. Same for the parameter. It's specific of the implementation and should not appear here. We should rename to:\ngetJurisdictions()", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r383785512", "createdAt": "2020-02-25T10:20:12Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolver.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package uk.gov.hmcts.ccd.data.user;\n+\n+import java.util.List;\n+\n+public interface JurisdictionsResolver {\n+\n+    List<String> getJurisdictionsFromIdam(String[] roles);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b3c829bfc5d9b630b251fc69a55c56ffb3e67cd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxOTAyMQ==", "bodyText": "addressed", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r383919021", "createdAt": "2020-02-25T14:39:44Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolver.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package uk.gov.hmcts.ccd.data.user;\n+\n+import java.util.List;\n+\n+public interface JurisdictionsResolver {\n+\n+    List<String> getJurisdictionsFromIdam(String[] roles);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc4NTUxMg=="}, "originalCommit": {"oid": "9b3c829bfc5d9b630b251fc69a55c56ffb3e67cd"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjUzNTU1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdam.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoyMTozMVrOFuAdSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoyMTozMVrOFuAdSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc4NjMxNQ==", "bodyText": "rather than passing roles this implementation should inject\nCachedUserRepository and call\nuserRepository.getUserDetails() internally. This way we can make the interface generic with the following signature:\ngetJurisdictions()", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r383786315", "createdAt": "2020-02-25T10:21:31Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdam.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package uk.gov.hmcts.ccd.data.user;\n+\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Service;\n+import org.springframework.web.context.annotation.RequestScope;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+@Service\n+@Qualifier(JurisdictionsResolverFromIdam.QUALIFIER)\n+@RequestScope\n+public class JurisdictionsResolverFromIdam implements JurisdictionsResolver {\n+\n+    public static final String QUALIFIER = \"default\";\n+\n+    @Override\n+    public List<String> getJurisdictionsFromIdam(String[] roles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b3c829bfc5d9b630b251fc69a55c56ffb3e67cd"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjY3Mzk5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdam.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDo1ODo0MlrOFuBvqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozOToyM1rOFuIi0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgwNzQwMg==", "bodyText": "remove this empty line please", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r383807402", "createdAt": "2020-02-25T10:58:42Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdam.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package uk.gov.hmcts.ccd.data.user;\n+\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Service;\n+import org.springframework.web.context.annotation.RequestScope;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+@Service\n+@Qualifier(JurisdictionsResolverFromIdam.QUALIFIER)\n+@RequestScope\n+public class JurisdictionsResolverFromIdam implements JurisdictionsResolver {\n+\n+    public static final String QUALIFIER = \"default\";\n+\n+    @Override\n+    public List<String> getJurisdictionsFromIdam(String[] roles) {\n+\n+        return Arrays.stream(roles).map(role ->  role.split(\"-\"))\n+                .filter(array -> array.length >= 2)\n+            .map(element -> element[1])\n+            .distinct()\n+            .collect(Collectors.toList());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b3c829bfc5d9b630b251fc69a55c56ffb3e67cd"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxODgwMQ==", "bodyText": "addressed", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r383918801", "createdAt": "2020-02-25T14:39:23Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdam.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package uk.gov.hmcts.ccd.data.user;\n+\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Service;\n+import org.springframework.web.context.annotation.RequestScope;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+@Service\n+@Qualifier(JurisdictionsResolverFromIdam.QUALIFIER)\n+@RequestScope\n+public class JurisdictionsResolverFromIdam implements JurisdictionsResolver {\n+\n+    public static final String QUALIFIER = \"default\";\n+\n+    @Override\n+    public List<String> getJurisdictionsFromIdam(String[] roles) {\n+\n+        return Arrays.stream(roles).map(role ->  role.split(\"-\"))\n+                .filter(array -> array.length >= 2)\n+            .map(element -> element[1])\n+            .distinct()\n+            .collect(Collectors.toList());\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgwNzQwMg=="}, "originalCommit": {"oid": "9b3c829bfc5d9b630b251fc69a55c56ffb3e67cd"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjY3ODI1OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdamTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMTowMDowM1rOFuByRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozOTozMFrOFuIjIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgwODA3MA==", "bodyText": "add a test for citizen please", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r383808070", "createdAt": "2020-02-25T11:00:03Z", "author": {"login": "mario-paniccia"}, "path": "src/test/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdamTest.java", "diffHunk": "@@ -0,0 +1,110 @@\n+package uk.gov.hmcts.ccd.data.user;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.List;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.jupiter.api.Assertions.assertAll;\n+\n+public class JurisdictionsResolverFromIdamTest {\n+\n+    private final JurisdictionsResolver jurisdictionsResolver = new JurisdictionsResolverFromIdam();\n+\n+\n+    @BeforeEach\n+    void setUp() {\n+    }\n+\n+    @Nested\n+    @DisplayName(\"JurisdictionsResolverFromIdam\")\n+    class GetUserId {\n+\n+        @Test\n+        @DisplayName(\"It should retrieve one user jurisdiction from idam.\")\n+        void shouldRetrieveOneUserJurisdictionIdam() {\n+\n+            final String[] roles = new String[] { \"caseworker\", \"caseworker-autotest1\",\n+                \"caseworker-autotest1-solicitor\", \"caseworker-autotest1-private\", \"caseworker-autotest1-senior\" };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);\n+\n+            assertAll(\n+                () -> assertThat(result.size(), is(1)),\n+                () -> assertThat(result.get(0), is(\"autotest1\"))\n+            );\n+        }\n+\n+        @Test\n+        @DisplayName(\"It should retrieve all user jurisdictions from idam.\")\n+        void shouldRetrieveAllUserJurisdictionIdam() {\n+\n+            final String[] roles = new String[] {\n+                \"caseworker\",\n+                \"caseworker-autotest1\",\n+                \"caseworker-autotest1-solicitor\",\n+                \"caseworker-autotest1-private\",\n+                \"caseworker-autotest1-senior\",\n+                \"caseworker-autotest2\",\n+                \"caseworker-autotest2-solicitor\",\n+                \"caseworker-autotest2-private\",\n+                \"caseworker-autotest2-senior\"\n+            };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);\n+\n+            assertAll(\n+                () -> assertThat(result.size(), is(2)),\n+                () -> assertThat(result.get(0), is(\"autotest1\")),\n+                () -> assertThat(result.get(1), is(\"autotest2\"))\n+            );\n+        }\n+\n+        @Test\n+        @DisplayName(\"It should retrieve all user jurisdictions from idam with no visibilities settings.\")\n+        void shouldRetrieveAllUserJurisdictionIdamWithNoVisibilities() {\n+\n+            final String[] roles = new String[] {\n+                \"caseworker\",\n+                \"caseworker-autotest1\",\n+                \"caseworker-autotest2\",\n+                \"caseworker-autotest3\"\n+            };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);\n+\n+            assertAll(\n+                () -> assertThat(result.size(), is(3)),\n+                () -> assertThat(result.get(0), is(\"autotest1\")),\n+                () -> assertThat(result.get(1), is(\"autotest2\")),\n+                () -> assertThat(result.get(2), is(\"autotest3\"))\n+            );\n+        }\n+\n+        @Test\n+        @DisplayName(\"It should retrieve all user jurisdictions for a user with many roles.\")\n+        void shouldRetrieveAllUserJurisdictionIdamUserWithManyRoles() {\n+\n+            final String[] roles = new String[] {\n+                \"caseworker\",\n+                \"caseworker-autotest1\",\n+                \"caseworker-autotest2\",\n+                \"otherRole\",\n+                \"otherRole-autotest1\",\n+                \"otherRole-autotest2\"\n+            };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b3c829bfc5d9b630b251fc69a55c56ffb3e67cd"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxODg4MA==", "bodyText": "addressed", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r383918880", "createdAt": "2020-02-25T14:39:30Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/test/java/uk/gov/hmcts/ccd/data/user/JurisdictionsResolverFromIdamTest.java", "diffHunk": "@@ -0,0 +1,110 @@\n+package uk.gov.hmcts.ccd.data.user;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.List;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.jupiter.api.Assertions.assertAll;\n+\n+public class JurisdictionsResolverFromIdamTest {\n+\n+    private final JurisdictionsResolver jurisdictionsResolver = new JurisdictionsResolverFromIdam();\n+\n+\n+    @BeforeEach\n+    void setUp() {\n+    }\n+\n+    @Nested\n+    @DisplayName(\"JurisdictionsResolverFromIdam\")\n+    class GetUserId {\n+\n+        @Test\n+        @DisplayName(\"It should retrieve one user jurisdiction from idam.\")\n+        void shouldRetrieveOneUserJurisdictionIdam() {\n+\n+            final String[] roles = new String[] { \"caseworker\", \"caseworker-autotest1\",\n+                \"caseworker-autotest1-solicitor\", \"caseworker-autotest1-private\", \"caseworker-autotest1-senior\" };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);\n+\n+            assertAll(\n+                () -> assertThat(result.size(), is(1)),\n+                () -> assertThat(result.get(0), is(\"autotest1\"))\n+            );\n+        }\n+\n+        @Test\n+        @DisplayName(\"It should retrieve all user jurisdictions from idam.\")\n+        void shouldRetrieveAllUserJurisdictionIdam() {\n+\n+            final String[] roles = new String[] {\n+                \"caseworker\",\n+                \"caseworker-autotest1\",\n+                \"caseworker-autotest1-solicitor\",\n+                \"caseworker-autotest1-private\",\n+                \"caseworker-autotest1-senior\",\n+                \"caseworker-autotest2\",\n+                \"caseworker-autotest2-solicitor\",\n+                \"caseworker-autotest2-private\",\n+                \"caseworker-autotest2-senior\"\n+            };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);\n+\n+            assertAll(\n+                () -> assertThat(result.size(), is(2)),\n+                () -> assertThat(result.get(0), is(\"autotest1\")),\n+                () -> assertThat(result.get(1), is(\"autotest2\"))\n+            );\n+        }\n+\n+        @Test\n+        @DisplayName(\"It should retrieve all user jurisdictions from idam with no visibilities settings.\")\n+        void shouldRetrieveAllUserJurisdictionIdamWithNoVisibilities() {\n+\n+            final String[] roles = new String[] {\n+                \"caseworker\",\n+                \"caseworker-autotest1\",\n+                \"caseworker-autotest2\",\n+                \"caseworker-autotest3\"\n+            };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);\n+\n+            assertAll(\n+                () -> assertThat(result.size(), is(3)),\n+                () -> assertThat(result.get(0), is(\"autotest1\")),\n+                () -> assertThat(result.get(1), is(\"autotest2\")),\n+                () -> assertThat(result.get(2), is(\"autotest3\"))\n+            );\n+        }\n+\n+        @Test\n+        @DisplayName(\"It should retrieve all user jurisdictions for a user with many roles.\")\n+        void shouldRetrieveAllUserJurisdictionIdamUserWithManyRoles() {\n+\n+            final String[] roles = new String[] {\n+                \"caseworker\",\n+                \"caseworker-autotest1\",\n+                \"caseworker-autotest2\",\n+                \"otherRole\",\n+                \"otherRole-autotest1\",\n+                \"otherRole-autotest2\"\n+            };\n+\n+            final List<String> result = jurisdictionsResolver.getJurisdictionsFromIdam(roles);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgwODA3MA=="}, "originalCommit": {"oid": "9b3c829bfc5d9b630b251fc69a55c56ffb3e67cd"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjgzMjkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/UserService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMjoxMjozN1rOF1cEpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMjozMzoxOVrOF1ctSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU3ODc4OQ==", "bodyText": "ccd-data-store-api/src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java\n    \n    \n         Line 134\n      in\n      24ef266\n    \n    \n    \n    \n\n        \n          \n           throw new BadRequestException(message); \n        \n    \n  \n\n\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (ApiException ae) {\n          \n          \n            \n                    } catch (ResourceNotFoundException ae) {\n          \n      \n    \n    \n  \n\notherwise we would be handling also a generic BadRequestException or any other future subclasses of ApiException as a profile not existing?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r391578789", "createdAt": "2020-03-12T12:12:37Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/UserService.java", "diffHunk": "@@ -58,22 +55,26 @@ public UserProfile getUserProfile() {\n             }\n         });\n \n-        return createUserProfile(idamProperties, userDefault, jurisdictions);\n+        return createUserProfile(idamProperties, userId, jurisdictions);\n     }\n \n-    private UserProfile createUserProfile(IDAMProperties idamProperties, UserDefault userDefault, List<Jurisdiction> jurisdictionsDefinition) {\n+    private UserProfile createUserProfile(IDAMProperties idamProperties, String userId, List<Jurisdiction> jurisdictionsDefinition) {\n \n         JurisdictionDisplayProperties[] resultJurisdictions = toResponse(jurisdictionsDefinition);\n \n-        WorkbasketDefault workbasketDefault = new WorkbasketDefault();\n-        workbasketDefault.setJurisdictionId(userDefault.getWorkBasketDefaultJurisdiction());\n-        workbasketDefault.setCaseTypeId(userDefault.getWorkBasketDefaultCaseType());\n-        workbasketDefault.setStateId(userDefault.getWorkBasketDefaultState());\n-\n         UserProfile userProfile = new UserProfile();\n         userProfile.setJurisdictions(resultJurisdictions);\n         userProfile.getUser().setIdamProperties(idamProperties);\n-        userProfile.getDefaultSettings().setWorkbasketDefault(workbasketDefault);\n+        try {\n+            UserDefault userDefault = userRepository.getUserDefaultSettings(userId);\n+            WorkbasketDefault workbasketDefault = new WorkbasketDefault();\n+            workbasketDefault.setJurisdictionId(userDefault.getWorkBasketDefaultJurisdiction());\n+            workbasketDefault.setCaseTypeId(userDefault.getWorkBasketDefaultCaseType());\n+            workbasketDefault.setStateId(userDefault.getWorkBasketDefaultState());\n+            userProfile.getDefaultSettings().setWorkbasketDefault(workbasketDefault);\n+        } catch (ApiException ae) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edb6ee43c9353ebf9c78cf44c185edf0e606ca89"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU4OTE5Mg==", "bodyText": "agreed... Changed", "url": "https://github.com/hmcts/ccd-data-store-api/pull/819#discussion_r391589192", "createdAt": "2020-03-12T12:33:19Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/UserService.java", "diffHunk": "@@ -58,22 +55,26 @@ public UserProfile getUserProfile() {\n             }\n         });\n \n-        return createUserProfile(idamProperties, userDefault, jurisdictions);\n+        return createUserProfile(idamProperties, userId, jurisdictions);\n     }\n \n-    private UserProfile createUserProfile(IDAMProperties idamProperties, UserDefault userDefault, List<Jurisdiction> jurisdictionsDefinition) {\n+    private UserProfile createUserProfile(IDAMProperties idamProperties, String userId, List<Jurisdiction> jurisdictionsDefinition) {\n \n         JurisdictionDisplayProperties[] resultJurisdictions = toResponse(jurisdictionsDefinition);\n \n-        WorkbasketDefault workbasketDefault = new WorkbasketDefault();\n-        workbasketDefault.setJurisdictionId(userDefault.getWorkBasketDefaultJurisdiction());\n-        workbasketDefault.setCaseTypeId(userDefault.getWorkBasketDefaultCaseType());\n-        workbasketDefault.setStateId(userDefault.getWorkBasketDefaultState());\n-\n         UserProfile userProfile = new UserProfile();\n         userProfile.setJurisdictions(resultJurisdictions);\n         userProfile.getUser().setIdamProperties(idamProperties);\n-        userProfile.getDefaultSettings().setWorkbasketDefault(workbasketDefault);\n+        try {\n+            UserDefault userDefault = userRepository.getUserDefaultSettings(userId);\n+            WorkbasketDefault workbasketDefault = new WorkbasketDefault();\n+            workbasketDefault.setJurisdictionId(userDefault.getWorkBasketDefaultJurisdiction());\n+            workbasketDefault.setCaseTypeId(userDefault.getWorkBasketDefaultCaseType());\n+            workbasketDefault.setStateId(userDefault.getWorkBasketDefaultState());\n+            userProfile.getDefaultSettings().setWorkbasketDefault(workbasketDefault);\n+        } catch (ApiException ae) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU3ODc4OQ=="}, "originalCommit": {"oid": "edb6ee43c9353ebf9c78cf44c185edf0e606ca89"}, "originalPosition": 64}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3888, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}