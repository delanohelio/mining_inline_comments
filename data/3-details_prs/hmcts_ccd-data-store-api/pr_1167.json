{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzOTI2Mjg2", "number": 1167, "title": "RDM-9868 DefaultValue for Complex fields", "bodyText": "JIRA link (if applicable)\nhttps://tools.hmcts.net/jira/browse/RDM-9868\nChange description\nIf defaultValue is present in the EventToComplexTypes tab we add it to all event triggers.\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[ X] No", "createdAt": "2020-10-15T08:32:47Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167", "merged": true, "mergeCommit": {"oid": "3d8839265170adf1e5f8a8f902edc104a52c65b8"}, "closed": true, "closedAt": "2020-10-27T11:16:18Z", "author": {"login": "rafalkalita"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSlOuzgH2gAyNTAzOTI2Mjg2OjZjOTQ1NzQ4M2U2ODk4MDc1MjFhMzRkYjhlY2Q1M2QzYzE5NzNhY2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVDZoCgFqTUxNDgzMzA3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6c9457483e689807521a34db8ecd53d3c1973aca", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6c9457483e689807521a34db8ecd53d3c1973aca", "committedDate": "2020-10-14T22:50:27Z", "message": "RDM-9868 Always populate defaultValue in event triggers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca94cc5edbd4ae960924066f735aaa59daafdf83", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/ca94cc5edbd4ae960924066f735aaa59daafdf83", "committedDate": "2020-10-15T13:41:32Z", "message": "RDM-9868 Tests for DefaultStartEventOperation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/751e7f3eaecb19c5f6417443a9ee03483b447a67", "committedDate": "2020-10-15T14:18:17Z", "message": "RDM-9868 Tests for CaseEventDefinition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjU1NjM0", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510255634", "createdAt": "2020-10-16T08:24:46Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwODoyNDo0NlrOHit0fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwODoyNDo0NlrOHit0fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjE2NDM0OQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506164349", "createdAt": "2020-10-16T08:24:46Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/config/JacksonUtils.java", "diffHunk": "@@ -29,7 +36,7 @@ private JacksonUtils(){\n         .build();\n \n \n-    public static HashMap<String, JsonNode> convertValue(Object from) {\n+    public static Map<String, JsonNode> convertValue(Object from) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjkyOTA5", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510292909", "createdAt": "2020-10-16T09:13:42Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOToxMzo0MlrOHiwYUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOToxMzo0MlrOHiwYUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIwNjI4OA==", "bodyText": "mmm not sure whether it's the best thing in terms of separation of concerns having a definition object having logic to build/manipulate case JSON data. I would have thought this is more responsibility of a CaseService class", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506206288", "createdAt": "2020-10-16T09:13:42Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseEventDefinition.java", "diffHunk": "@@ -205,4 +214,29 @@ public void setCanSaveDraft(Boolean canSaveDraft) {\n             .filter(f -> f.getCaseFieldId().equals(caseFieldId))\n             .findFirst();\n     }\n+\n+    public Map<String, JsonNode> buildJsonNodeFromCaseFieldsWithDefaultValue() {\n+        Map<String, JsonNode> data = new HashMap<>();\n+\n+        getCaseFields().forEach(\n+            caseField -> {\n+\n+                List<JsonNode> collect = caseField.getCaseEventFieldComplexDefinitions().stream()\n+                    .filter(e -> e.getDefaultValue() != null)\n+                    .filter(e -> !e.getReference().isBlank())\n+                    .map(caseEventFieldComplex -> JacksonUtils.buildFromDottedPath(caseEventFieldComplex.getReference(),\n+                                                                                   caseEventFieldComplex.getDefaultValue())).collect(toList());\n+\n+                ObjectNode objectNode = MAPPER.getNodeFactory().objectNode();\n+                collect.forEach(e -> {\n+                    String next = e.fieldNames().next();\n+                    objectNode.set(next, e.findValue(next));\n+                });\n+                if (!collect.isEmpty()) { // to prevent construct like \"FieldA\": {}\n+                    data.put(caseField.getCaseFieldId(), objectNode);\n+                }\n+            });\n+\n+        return data;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzIwNjU2", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510320656", "createdAt": "2020-10-16T09:50:44Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOTo1MDo0NFrOHiyIHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOTo1MDo0NFrOHiyIHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIzNDkxMA==", "bodyText": "mmm isn't it a bit too late to set the default values in the operation classes? For example, when invoking a MidEvent callback CCD sends to the midevent callback the case data, here:\n\n  \n    \n      ccd-data-store-api/src/main/java/uk/gov/hmcts/ccd/domain/service/createevent/MidEventCallback.java\n    \n    \n         Line 69\n      in\n      80adc76\n    \n    \n    \n    \n\n        \n          \n           CaseDetails caseDetailsBefore = null; \n        \n    \n  \n\n\nWith this implementation the callback is not receiving the default value right?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506234910", "createdAt": "2020-10-16T09:50:44Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/startevent/DefaultStartEventOperation.java", "diffHunk": "@@ -1,10 +1,11 @@\n package uk.gov.hmcts.ccd.domain.service.startevent;\n \n+import com.fasterxml.jackson.databind.JsonNode;\n import com.google.common.collect.Maps;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzI2MjIw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510326220", "createdAt": "2020-10-16T09:58:36Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOTo1ODozNlrOHiyrUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwOTo1ODozNlrOHiyrUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI0MzkyMg==", "bodyText": "probably better having the CaseService create methods and get case methods setting the defaults? we could pass the whole caseTypeDefinition.\nThe idea is that all the operations use the CaseService class, and it's the service class the only one responsible for setting the defaults, rather than the various operations. This would eliminate potential bugs where we get the case from the service but forget to set the defaults. And would also reduce duplication", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506243922", "createdAt": "2020-10-16T09:58:36Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/startevent/DefaultStartEventOperation.java", "diffHunk": "@@ -76,12 +80,15 @@ public StartEventResult triggerStartForCaseType(final String caseTypeId,\n \n         final CaseTypeDefinition caseTypeDefinition = getCaseType(caseTypeId);\n \n+        final Map<String, JsonNode> data = Maps.newHashMap();\n+\n+        CaseDetails newCaseDetails = caseService\n+            .createNewCaseDetails(caseTypeId, caseTypeDefinition.getJurisdictionId(), data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzI5ODM0", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510329834", "createdAt": "2020-10-16T10:03:33Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDowMzozM1rOHizCHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMDowMzozM1rOHizCHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI0OTc1Nw==", "bodyText": "mmm perhaps line 99\nfinal CaseDetails caseDetails = getCaseDetails(caseReference);\nshould already return the case with the default values? We should change getCaseDetails to use the Service rather than the Repository directly, and have the CaseService dealing with defaulting", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506249757", "createdAt": "2020-10-16T10:03:33Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/startevent/DefaultStartEventOperation.java", "diffHunk": "@@ -99,6 +106,9 @@ public StartEventResult triggerStartForCase(final String caseReference,\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzI5OTc0", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510329974", "createdAt": "2020-10-16T10:03:44Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzc2MTc5", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510376179", "createdAt": "2020-10-16T11:16:07Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMToxNjowN1rOHi2lYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMToxNjowN1rOHi2lYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMwNzkzNw==", "bodyText": "We are just validating null value, what if user changes the OrgPolicyRole, that means if user enters any other value in this field, we need to check whether that case-role exists or not", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506307937", "createdAt": "2020-10-16T11:16:07Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/validate/DefaultValidateCaseFieldsOperation.java", "diffHunk": "@@ -98,12 +96,10 @@ private void validateContent(final CaseDataContent content,\n             int length = referenceArray.length;\n             String nodeReference = length > 1 ? referenceArray[length - 2] : referenceArray[length - 1];\n             List<JsonNode> parentNodes = caseFieldNode.findParents(nodeReference);\n-            parentNodes.stream().forEach(parentNode -> {\n+            parentNodes.forEach(parentNode -> {\n                 JsonNode orgPolicyNode = findOrgPolicyNode(nodeReference, parentNode, length);\n                 if (orgPolicyNode.isNull()) {\n                     errorList.add(caseFieldId + \" cannot have an empty value.\");\n-                } else if (!defaultValue.equalsIgnoreCase(orgPolicyNode.textValue())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzc3MTU1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510377155", "createdAt": "2020-10-16T11:17:43Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzkwNzk4", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510390798", "createdAt": "2020-10-16T11:40:13Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo0MDoxM1rOHi3u4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo0MDoxM1rOHi3u4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyNjc1NA==", "bodyText": "can we do this check before line 230", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506326754", "createdAt": "2020-10-16T11:40:13Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseEventDefinition.java", "diffHunk": "@@ -205,4 +214,29 @@ public void setCanSaveDraft(Boolean canSaveDraft) {\n             .filter(f -> f.getCaseFieldId().equals(caseFieldId))\n             .findFirst();\n     }\n+\n+    public Map<String, JsonNode> buildJsonNodeFromCaseFieldsWithDefaultValue() {\n+        Map<String, JsonNode> data = new HashMap<>();\n+\n+        getCaseFields().forEach(\n+            caseField -> {\n+\n+                List<JsonNode> collect = caseField.getCaseEventFieldComplexDefinitions().stream()\n+                    .filter(e -> e.getDefaultValue() != null)\n+                    .filter(e -> !e.getReference().isBlank())\n+                    .map(caseEventFieldComplex -> JacksonUtils.buildFromDottedPath(caseEventFieldComplex.getReference(),\n+                                                                                   caseEventFieldComplex.getDefaultValue())).collect(toList());\n+\n+                ObjectNode objectNode = MAPPER.getNodeFactory().objectNode();\n+                collect.forEach(e -> {\n+                    String next = e.fieldNames().next();\n+                    objectNode.set(next, e.findValue(next));\n+                });\n+                if (!collect.isEmpty()) { // to prevent construct like \"FieldA\": {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzkxMDU2", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510391056", "createdAt": "2020-10-16T11:40:38Z", "commit": {"oid": "751e7f3eaecb19c5f6417443a9ee03483b447a67"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b5f2acf4b6191248bf760f1bd5b031a1dafb6cf", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1b5f2acf4b6191248bf760f1bd5b031a1dafb6cf", "committedDate": "2020-10-16T13:13:29Z", "message": "RDM-9868 Move CaseEventDefinition logic to the CaseService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74a519562bf74a3a20efe4866a5b5bd4516ebd28", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/74a519562bf74a3a20efe4866a5b5bd4516ebd28", "committedDate": "2020-10-16T14:28:07Z", "message": "RDM-9868 Add a caseRole check to the orgPolicyRole field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNTM0Mzgx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510534381", "createdAt": "2020-10-16T14:39:04Z", "commit": {"oid": "74a519562bf74a3a20efe4866a5b5bd4516ebd28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDozOTowNFrOHjCCSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDozOTowNFrOHjCCSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ5NTU2MQ==", "bodyText": "Probably nothing to do with your PR @rafalkalita, but I just noticed that we are adding custom validation rules (for the organisation) in this class. But this class is a generic one! Why is a method like:\nprivate void validateOrganisationPolicy(String caseTypeId, CaseDataContent content) {\nhere?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506495561", "createdAt": "2020-10-16T14:39:04Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/validate/DefaultValidateCaseFieldsOperation.java", "diffHunk": "@@ -62,15 +69,15 @@ private void validateOrganisationPolicy(String caseTypeId, CaseDataContent conte\n         caseDefinitionRepository.getCaseType(caseTypeId)\n             .findCaseEvent(content.getEventId())\n             .ifPresent(caseEventDefinition -> caseEventDefinition.getCaseFields()\n-                .stream()\n                 .forEach(eventFieldDefinition -> eventFieldDefinition.getCaseEventFieldComplexDefinitions().stream()\n                     .filter(cefcDefinition -> isOrgPolicyCaseAssignedRole(cefcDefinition.getReference()))\n                     .forEach(cefcDefinition -> {\n                         String reference = cefcDefinition.getReference();\n-                        validateContent(content, eventFieldDefinition.getCaseFieldId(),\n-                            reference,\n-                            cefcDefinition.getDefaultValue(),\n-                            errorList);\n+                        validateContent(content,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a519562bf74a3a20efe4866a5b5bd4516ebd28"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNTQyNzYx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510542761", "createdAt": "2020-10-16T14:48:34Z", "commit": {"oid": "74a519562bf74a3a20efe4866a5b5bd4516ebd28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDo0ODozNFrOHjCj-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDo0ODozNFrOHjCj-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDE4Nw==", "bodyText": "this is getting very complex....", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#discussion_r506504187", "createdAt": "2020-10-16T14:48:34Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/validate/DefaultValidateCaseFieldsOperation.java", "diffHunk": "@@ -62,15 +69,15 @@ private void validateOrganisationPolicy(String caseTypeId, CaseDataContent conte\n         caseDefinitionRepository.getCaseType(caseTypeId)\n             .findCaseEvent(content.getEventId())\n             .ifPresent(caseEventDefinition -> caseEventDefinition.getCaseFields()\n-                .stream()\n                 .forEach(eventFieldDefinition -> eventFieldDefinition.getCaseEventFieldComplexDefinitions().stream()\n                     .filter(cefcDefinition -> isOrgPolicyCaseAssignedRole(cefcDefinition.getReference()))\n                     .forEach(cefcDefinition -> {\n                         String reference = cefcDefinition.getReference();\n-                        validateContent(content, eventFieldDefinition.getCaseFieldId(),\n-                            reference,\n-                            cefcDefinition.getDefaultValue(),\n-                            errorList);\n+                        validateContent(content,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74a519562bf74a3a20efe4866a5b5bd4516ebd28"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNTQ0NTAw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-510544500", "createdAt": "2020-10-16T14:50:30Z", "commit": {"oid": "74a519562bf74a3a20efe4866a5b5bd4516ebd28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1658c9afec2f470a4c7b333ed1da7351f2bf7ce", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c1658c9afec2f470a4c7b333ed1da7351f2bf7ce", "committedDate": "2020-10-16T15:37:38Z", "message": "RDM-9868 Clean up and move isEmpty check up in the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1041ec75e5caf17d038dad9a4d2323a581859edf", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1041ec75e5caf17d038dad9a4d2323a581859edf", "committedDate": "2020-10-16T15:38:17Z", "message": "Merge branch 'develop' into RDM-9868"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cccdae164b9a3638691eefd33f75ad3b23a34d13", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/cccdae164b9a3638691eefd33f75ad3b23a34d13", "committedDate": "2020-10-16T15:48:20Z", "message": "RDM-9868 Address checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47a76a9a1803b5635cb9cc0de8c9196b2fe8db88", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/47a76a9a1803b5635cb9cc0de8c9196b2fe8db88", "committedDate": "2020-10-16T16:10:10Z", "message": "RDM-9868 Address checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d403d81104b84bc0ae4f068952a78e9c1d6d30b", "author": {"user": {"login": "rafalkalita", "name": "Rafal Kalita"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/4d403d81104b84bc0ae4f068952a78e9c1d6d30b", "committedDate": "2020-10-19T07:43:10Z", "message": "RDM-9868 Adjust FTs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODMzMDc5", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1167#pullrequestreview-514833079", "createdAt": "2020-10-22T15:07:21Z", "commit": {"oid": "4d403d81104b84bc0ae4f068952a78e9c1d6d30b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2784, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}