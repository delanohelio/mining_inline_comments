{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MDA4MTIy", "number": 818, "title": "Rdm 5903: Implement and consume external GET event details for case endpoint in API v2", "bodyText": "JIRA link (if applicable)\nhttps://tools.hmcts.net/jira/browse/RDM-5903\nChange description\nNew V2 endpoint created for /cases/{caseId}/events to get events for the passed case id.\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[X ] No", "createdAt": "2020-02-20T22:31:26Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818", "merged": true, "mergeCommit": {"oid": "5a60935f81a272b773ad9fdc8f3187d2469d69f6"}, "closed": true, "closedAt": "2020-02-28T16:29:23Z", "author": {"login": "kiran-yenigala-hmcts"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGS6i8AH2gAyMzc4MDA4MTIyOjgyMjI4NWFhZjQ4OThlNTA1ZjgwZGJkNzgzYjBjZjg3ZWY1Mjc1ZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIydaDgFqTM2NjUyMjI5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/822285aaf4898e505f80dbd783b0cf87ef5275f1", "committedDate": "2020-02-20T22:31:52Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzIxNTE5", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-362721519", "createdAt": "2020-02-21T15:43:45Z", "commit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0Mzo0NVrOFs7TXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0Mzo0NVrOFs7TXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY1MzI3OQ==", "bodyText": "Hmm I thought it would be external like in description of the ticket:\nv1 endpoint: https://github.com/hmcts/ccd-data-store-api/blob/master/src/main/java/uk/gov/hmcts/ccd/endpoint/std/EventsEndpoint.java#L34-L53\nv2: GET /cases/{cid}/events\nso should likve in v2/external package and URL should not have internal prefix?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r382653279", "createdAt": "2020-02-21T15:43:45Z", "author": {"login": "andrewfolga"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/internal/controller/UICaseControllerTest.java", "diffHunk": "@@ -135,4 +145,39 @@ void shouldPropagateExceptionWhenThrown() {\n                 () -> caseController.getCaseEvent(CASE_REFERENCE, EVENT_ID.toString()));\n         }\n     }\n+\n+    @Nested\n+    @DisplayName(\"GET /internal/cases/{caseId}/events\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzIxOTE3", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-362721917", "createdAt": "2020-02-21T15:44:19Z", "commit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0NDoxOVrOFs7Umg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0NDoxOVrOFs7Umg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY1MzU5NA==", "bodyText": "Internal or external?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r382653594", "createdAt": "2020-02-21T15:44:19Z", "author": {"login": "andrewfolga"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/internal/resource/UICaseEventsResourceTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package uk.gov.hmcts.ccd.v2.internal.resource;\n+\n+import com.google.common.collect.Lists;\n+import java.util.List;\n+import java.util.Optional;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.MockitoAnnotations;\n+import org.springframework.hateoas.Link;\n+import uk.gov.hmcts.ccd.domain.model.std.AuditEvent;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.jupiter.api.Assertions.assertAll;\n+\n+class UICaseEventsResourceTest {\n+    private static final String REFERENCE = \"1234123412341238\";\n+    private static final String LINK_SELF = String.format(\"/internal/cases/%s/events\", REFERENCE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzIyNzQ5", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-362722749", "createdAt": "2020-02-21T15:45:27Z", "commit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0NToyN1rOFs7XGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0NToyN1rOFs7XGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY1NDIzNQ==", "bodyText": "If this is to be external then it should not have ui- prefix.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r382654235", "createdAt": "2020-02-21T15:45:27Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/v2/V2.java", "diffHunk": "@@ -41,6 +41,8 @@ private MediaType() {}\n         public static final String UI_JURISDICTIONS =\n             \"application/vnd.uk.gov.hmcts.ccd-data-store-api.ui-jurisdictions.v2+json;charset=UTF-8\";\n \n+        public static final String UI_CASE_EVENTS = \"application/vnd.uk.gov.hmcts.ccd-data-store-api.ui-case-events.v2+json;charset=UTF-8\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzIzMzky", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-362723392", "createdAt": "2020-02-21T15:46:19Z", "commit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0NjoxOVrOFs7ZJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNTo0NjoxOVrOFs7ZJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY1NDc1OQ==", "bodyText": "So this looks like internal endpoint but the story talks about external which would be located in equivalent CaseController class.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r382654759", "createdAt": "2020-02-21T15:46:19Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/v2/internal/controller/UICaseController.java", "diffHunk": "@@ -117,4 +124,42 @@ public UICaseController(\n \n         return ResponseEntity.ok(new UIEventViewResource(caseHistoryView, caseId));\n     }\n+\n+    @GetMapping(\n+        path = \"/{caseId}/events\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzIzNzAy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-362723702", "createdAt": "2020-02-21T15:46:45Z", "commit": {"oid": "822285aaf4898e505f80dbd783b0cf87ef5275f1"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDU5Mjg1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364059285", "createdAt": "2020-02-25T11:11:34Z", "commit": {"oid": "0b7e5b430c3635dcafac4d51cfdb19e287563e45"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMToxMTozNVrOFuCHng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMToxMTozNVrOFuCHng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgxMzUzNA==", "bodyText": "this is duplicated with the already existing `getEvents(String jurisdiction, String caseTypeId, String caseReference)\nThe only difference between the 2 is that the above creates a different error message which indicates the  jurisdiction and caseTypeId.\nString.format(RESOURCE_NOT_FOUND, jurisdiction, caseTypeId, caseReference)));\nI think that's not an important detail and can be changed to only log the caseReference. If you do that you can find a way to easily reuse that logic rather than duplicating", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383813534", "createdAt": "2020-02-25T11:11:35Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/getevents/DefaultGetEventsOperation.java", "diffHunk": "@@ -58,4 +60,18 @@ public DefaultGetEventsOperation(CaseAuditEventRepository auditEventRepository,\n         return auditEventRepository.findByEventId(eventId).map(Optional::of)\n             .orElseThrow(() -> new ResourceNotFoundException(CASE_EVENT_NOT_FOUND));\n     }\n+\n+    @Override\n+    public List<AuditEvent> getEvents(String caseReference) {\n+        if (!uidService.validateUID(caseReference)) {\n+            throw new BadRequestException(\"Case reference \" + caseReference + \" is not valid\");\n+        }\n+\n+        final CaseDetails caseDetails =\n+            getCaseOperation.execute(caseReference)\n+                .orElseThrow(() -> new ResourceNotFoundException(\n+                    String.format(CASE_RESOURCE_NOT_FOUND, caseReference)));\n+\n+        return getEvents(caseDetails);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7e5b430c3635dcafac4d51cfdb19e287563e45"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b7e5b430c3635dcafac4d51cfdb19e287563e45", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/0b7e5b430c3635dcafac4d51cfdb19e287563e45", "committedDate": "2020-02-25T11:12:37Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e51c39e860988ab6ca3b64faa4e8b3dd226324fe", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e51c39e860988ab6ca3b64faa4e8b3dd226324fe", "committedDate": "2020-02-25T11:34:40Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d4480a5fd0890c7dd27a6dae1c4ebdbc77123e3", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6d4480a5fd0890c7dd27a6dae1c4ebdbc77123e3", "committedDate": "2020-02-25T11:35:27Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/034c0f357da546e0482afa34a60994291f29cc75", "committedDate": "2020-02-25T11:36:21Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDc5OTI1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364079925", "createdAt": "2020-02-25T11:48:09Z", "commit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMTo0ODowOVrOFuDJhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMTo0ODowOVrOFuDJhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzMDQwNw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383830407", "createdAt": "2020-02-25T11:48:09Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/getevents/DefaultGetEventsOperation.java", "diffHunk": "@@ -41,15 +43,17 @@ public DefaultGetEventsOperation(CaseAuditEventRepository auditEventRepository,\n \n     @Override\n     public List<AuditEvent> getEvents(String jurisdiction, String caseTypeId, String caseReference) {\n+        return getEvents(caseReference, () -> String.format(RESOURCE_NOT_FOUND, jurisdiction, caseTypeId, caseReference));\n+    }\n+\n+    private List<AuditEvent> getEvents(String caseReference, Supplier<String> errorMessageSupplier) {\n         if (!uidService.validateUID(caseReference)) {\n             throw new BadRequestException(\"Case reference \" + caseReference + \" is not valid\");\n         }\n \n         final CaseDetails caseDetails =\n             getCaseOperation.execute(caseReference)\n-                .orElseThrow(() -> new ResourceNotFoundException(\n-                    String.format(RESOURCE_NOT_FOUND, jurisdiction, caseTypeId, caseReference)));\n-\n+                .orElseThrow(() -> new ResourceNotFoundException(errorMessageSupplier.get()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDgyODg4", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364082888", "createdAt": "2020-02-25T11:53:26Z", "commit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMTo1MzoyNlrOFuDSfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMTo1MzoyNlrOFuDSfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzMjcwMw==", "bodyText": "Is this correct? Are we retrieving also by event IDS?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383832703", "createdAt": "2020-02-25T11:53:26Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/CaseController.java", "diffHunk": "@@ -211,4 +219,43 @@ public CaseController(\n \n         return status(HttpStatus.CREATED).body(new CaseResource(caseDetails, content, ignoreWarning));\n     }\n+\n+\n+    @GetMapping(\n+        path = \"/cases/{caseId}/events\",\n+        headers = {\n+            V2.EXPERIMENTAL_HEADER\n+        },\n+        produces = {\n+            V2.MediaType.CASE_EVENTS\n+        }\n+    )\n+    @ApiOperation(\n+        value = \"Retrieve an event by case and event IDs for dynamic display\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDg0MTE4", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364084118", "createdAt": "2020-02-25T11:55:33Z", "commit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMTo1NTozM1rOFuDWTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMTo1NTozM1rOFuDWTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzMzY3Ng==", "bodyText": "Should it not say - Case audit events not found?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383833676", "createdAt": "2020-02-25T11:55:33Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/CaseController.java", "diffHunk": "@@ -211,4 +219,43 @@ public CaseController(\n \n         return status(HttpStatus.CREATED).body(new CaseResource(caseDetails, content, ignoreWarning));\n     }\n+\n+\n+    @GetMapping(\n+        path = \"/cases/{caseId}/events\",\n+        headers = {\n+            V2.EXPERIMENTAL_HEADER\n+        },\n+        produces = {\n+            V2.MediaType.CASE_EVENTS\n+        }\n+    )\n+    @ApiOperation(\n+        value = \"Retrieve an event by case and event IDs for dynamic display\",\n+        notes = V2.EXPERIMENTAL_WARNING\n+    )\n+    @ApiResponses({\n+        @ApiResponse(\n+            code = 200,\n+            message = \"Success\",\n+            response = CaseEventsResource.class\n+        ),\n+        @ApiResponse(\n+            code = 400,\n+            message = ERROR_CASE_ID_INVALID\n+        ),\n+        @ApiResponse(\n+            code = 404,\n+            message = \"Case event not found\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75"}, "originalPosition": 85}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDg0Mjc1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364084275", "createdAt": "2020-02-25T11:55:49Z", "commit": {"oid": "034c0f357da546e0482afa34a60994291f29cc75"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "320b01010394530d288e4dd83727592e91a28f78", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/320b01010394530d288e4dd83727592e91a28f78", "committedDate": "2020-02-25T12:00:18Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDg3MTAx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364087101", "createdAt": "2020-02-25T12:00:59Z", "commit": {"oid": "320b01010394530d288e4dd83727592e91a28f78"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMjowMDo1OVrOFuDflQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMjowMDo1OVrOFuDflQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNjA1Mw==", "bodyText": "Should it not be \"Retrieve audit events by case ID\"?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383836053", "createdAt": "2020-02-25T12:00:59Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/CaseController.java", "diffHunk": "@@ -211,4 +219,43 @@ public CaseController(\n \n         return status(HttpStatus.CREATED).body(new CaseResource(caseDetails, content, ignoreWarning));\n     }\n+\n+\n+    @GetMapping(\n+        path = \"/cases/{caseId}/events\",\n+        headers = {\n+            V2.EXPERIMENTAL_HEADER\n+        },\n+        produces = {\n+            V2.MediaType.CASE_EVENTS\n+        }\n+    )\n+    @ApiOperation(\n+        value = \"Retrieve an audit event by Case ID\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "320b01010394530d288e4dd83727592e91a28f78"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDg3NzAy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364087702", "createdAt": "2020-02-25T12:02:08Z", "commit": {"oid": "320b01010394530d288e4dd83727592e91a28f78"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMjowMjowOVrOFuDhhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMjowMjowOVrOFuDhhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNjU0OQ==", "bodyText": "Can we extract this to V2.Error like \"AUDIT_EVENTS_NOT_FOUND\"?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383836549", "createdAt": "2020-02-25T12:02:09Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/CaseController.java", "diffHunk": "@@ -211,4 +219,43 @@ public CaseController(\n \n         return status(HttpStatus.CREATED).body(new CaseResource(caseDetails, content, ignoreWarning));\n     }\n+\n+\n+    @GetMapping(\n+        path = \"/cases/{caseId}/events\",\n+        headers = {\n+            V2.EXPERIMENTAL_HEADER\n+        },\n+        produces = {\n+            V2.MediaType.CASE_EVENTS\n+        }\n+    )\n+    @ApiOperation(\n+        value = \"Retrieve an audit event by Case ID\",\n+        notes = V2.EXPERIMENTAL_WARNING\n+    )\n+    @ApiResponses({\n+        @ApiResponse(\n+            code = 200,\n+            message = \"Success\",\n+            response = CaseEventsResource.class\n+        ),\n+        @ApiResponse(\n+            code = 400,\n+            message = ERROR_CASE_ID_INVALID\n+        ),\n+        @ApiResponse(\n+            code = 404,\n+            message = \"Case audit events not found\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "320b01010394530d288e4dd83727592e91a28f78"}, "originalPosition": 85}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a85cd154836bc02957f06ba80013507244dc1acc", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a85cd154836bc02957f06ba80013507244dc1acc", "committedDate": "2020-02-25T12:03:56Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDg5MzM5", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364089339", "createdAt": "2020-02-25T12:04:53Z", "commit": {"oid": "a85cd154836bc02957f06ba80013507244dc1acc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMjowNDo1NFrOFuDmqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMjowNDo1NFrOFuDmqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNzg2NQ==", "bodyText": "Aren't we missing other response codes here like 422 UNPROCESSABLE_ENTITY from ValidationException (AuthorisedGetEventsOperation)?\nCan you check whether others are not missing?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383837865", "createdAt": "2020-02-25T12:04:54Z", "author": {"login": "andrewfolga"}, "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/CaseController.java", "diffHunk": "@@ -211,4 +219,43 @@ public CaseController(\n \n         return status(HttpStatus.CREATED).body(new CaseResource(caseDetails, content, ignoreWarning));\n     }\n+\n+\n+    @GetMapping(\n+        path = \"/cases/{caseId}/events\",\n+        headers = {\n+            V2.EXPERIMENTAL_HEADER\n+        },\n+        produces = {\n+            V2.MediaType.CASE_EVENTS\n+        }\n+    )\n+    @ApiOperation(\n+        value = \"Retrieve audit events by case ID\",\n+        notes = V2.EXPERIMENTAL_WARNING\n+    )\n+    @ApiResponses({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a85cd154836bc02957f06ba80013507244dc1acc"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f535fd8bb804935f7d588d16a3222732e737a3ef", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f535fd8bb804935f7d588d16a3222732e737a3ef", "committedDate": "2020-02-25T12:25:34Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62ff59f6287f0b67bee6602d68a94b78ff9dadfc", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/62ff59f6287f0b67bee6602d68a94b78ff9dadfc", "committedDate": "2020-02-25T13:40:09Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e1d8cfa82bc20b1e76cf5fa48cc25631bfb61be", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/8e1d8cfa82bc20b1e76cf5fa48cc25631bfb61be", "committedDate": "2020-02-25T13:58:57Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTgyNjY0", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364182664", "createdAt": "2020-02-25T14:29:04Z", "commit": {"oid": "8e1d8cfa82bc20b1e76cf5fa48cc25631bfb61be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDoyOTowNFrOFuIKSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDoyOTowNFrOFuIKSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxMjUyMg==", "bodyText": "we sure this is needed? DefaultGetEventsOperation always returns at least 1 event, the create event for a case.\nAnd I think the other decorators that execute before this one will already return an empty list in case that single event is not accessible", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383912522", "createdAt": "2020-02-25T14:29:04Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/getevents/AuthorisedGetEventsOperation.java", "diffHunk": "@@ -61,6 +66,13 @@ public AuthorisedGetEventsOperation(@Qualifier(\"classified\") GetEventsOperation\n         return secureEvents(caseTypeId, event.getCaseDataId(), singletonList(event)).stream().findFirst();\n     }\n \n+    private List<AuditEvent> secureEvents(List<AuditEvent> events) {\n+        if (null == events || events.size() == 0) {\n+            return Lists.newArrayList();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e1d8cfa82bc20b1e76cf5fa48cc25631bfb61be"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTg0NTU2", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364184556", "createdAt": "2020-02-25T14:31:26Z", "commit": {"oid": "8e1d8cfa82bc20b1e76cf5fa48cc25631bfb61be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozMToyNlrOFuIQFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozMToyNlrOFuIQFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxNDAwNA==", "bodyText": "same as above don't think:\nnull == events || events.size() == 0 \nis needed", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383914004", "createdAt": "2020-02-25T14:31:26Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/getevents/ClassifiedGetEventsOperation.java", "diffHunk": "@@ -48,6 +57,14 @@ public ClassifiedGetEventsOperation(@Qualifier(\"default\") GetEventsOperation get\n         return secureEvents(jurisdiction, singletonList(event)).stream().findFirst();\n     }\n \n+    private List<AuditEvent> secureEvents(List<AuditEvent> events, String caseReference) {\n+        CaseDetails caseDetails = getCaseOperation.execute(caseReference).orElse(null);\n+        if (null == events || events.size() == 0 || null == caseDetails) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e1d8cfa82bc20b1e76cf5fa48cc25631bfb61be"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c6b96a1bc110bd8e4a888652108d6750a2d8662", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/2c6b96a1bc110bd8e4a888652108d6750a2d8662", "committedDate": "2020-02-25T14:38:14Z", "message": "RDM-5903: Implement and consume external GET event details for case endpoint in API v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTkwNzEw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-364190710", "createdAt": "2020-02-25T14:39:21Z", "commit": {"oid": "2c6b96a1bc110bd8e4a888652108d6750a2d8662"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozOToyMlrOFuIiwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozOToyMlrOFuIiwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxODc4NQ==", "bodyText": "Kiran can you review AuditEvent and make sure it's not missing any important event property and if all the properties we are returning are relevant?\nLet's give this a thought as as we found out the v1 endpoint was not written by us. Perhaps we can take this chance to improve the json response that is returned", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#discussion_r383918785", "createdAt": "2020-02-25T14:39:22Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/getevents/AuthorisedGetEventsOperation.java", "diffHunk": "@@ -51,6 +51,11 @@ public AuthorisedGetEventsOperation(@Qualifier(\"classified\") GetEventsOperation\n         return secureEvents(caseTypeId, auditEvents.get(0).getCaseDataId(),  auditEvents);\n     }\n \n+    @Override\n+    public List<AuditEvent> getEvents(String caseReference) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c6b96a1bc110bd8e4a888652108d6750a2d8662"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9ef30d150c74000ddf79a2907a9abdc94709c52", "author": {"user": {"login": "Olawale", "name": "Olawale Olanrewaju"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/d9ef30d150c74000ddf79a2907a9abdc94709c52", "committedDate": "2020-02-26T14:01:43Z", "message": "Merge branch 'develop' into RDM-5903"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54f737daef1b1b27f03955eb2b9eda77f7f8b415", "author": {"user": {"login": "kiran-yenigala-hmcts", "name": "Kiran Kumar Yenigala"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/54f737daef1b1b27f03955eb2b9eda77f7f8b415", "committedDate": "2020-02-28T13:57:11Z", "message": "Merge branch 'develop' into RDM-5903"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1a8a1ea10b14497948a7c45ae7c78638908dab3", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c1a8a1ea10b14497948a7c45ae7c78638908dab3", "committedDate": "2020-02-28T14:40:03Z", "message": "RDM-5903: fix compilation issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a5654b897b0d679ab42160fa9212e93287e5969", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1a5654b897b0d679ab42160fa9212e93287e5969", "committedDate": "2020-02-28T15:36:38Z", "message": "RDM-5903: fix test case issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NTIyMjkw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/818#pullrequestreview-366522290", "createdAt": "2020-02-28T16:24:51Z", "commit": {"oid": "1a5654b897b0d679ab42160fa9212e93287e5969"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2595, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}