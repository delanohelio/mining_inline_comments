{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MTgxNjk0", "number": 1026, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwODo0MDoxMlrOERW1GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDoxNTo0N1rOERxWQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NjM1Mjg5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwODo0MDoxM1rOG2BTLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwODo0MDoxM1rOG2BTLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI5NzU4MA==", "bodyText": "I was thinking whether we can take this opportunity to also make the method a bit more precise.\nWith the current implementation any role of the form part1-part2-....partN will be considered a \"jurisidictional\" role for a jurisdiction \"part2\".\nIn reality this (not written) rule applies only for caseworkers (as far as I know!).\nSo was wondering if it would be better applying this method only to caseworkers roles (maybe using a regex?), and rename it to getCaseworkerUserRolesJurisdictions?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459297580", "createdAt": "2020-07-23T08:40:13Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "diffHunk": "@@ -179,7 +180,9 @@ public String getUserId() {\n     public List<String> getUserRolesJurisdictions() {\n         String[] roles = this.getUserDetails().getRoles();\n \n-        return Arrays.stream(roles).map(role ->  role.split(\"-\"))\n+        return Arrays.stream(roles)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db454cb6e4b6f820fd3cba2707a66ba8499157d1"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MDY1NDg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo1OTo0OVrOG2p1eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo1OTo0OVrOG2p1eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MTcyMQ==", "bodyText": "I'd suggest we make this a public method", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459961721", "createdAt": "2020-07-24T09:59:49Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "diffHunk": "@@ -234,4 +223,12 @@ private IdamUser toIdamUser(UserInfo userInfo) {\n         return idamUser;\n     }\n \n+    private boolean isCrossJurisdictionRole(String role) {\n+        return applicationParams.getCcdAccessControlCrossJurisdictionRoles().contains(role);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MDY4MjQyOnYy", "diffSide": "RIGHT", "path": "src/main/resources/application.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDowOTo0OFrOG2qF_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDoyMDoxM1rOG2qWKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2NTk1MA==", "bodyText": "I appreciate the intent to make this configurable.\nBut I think the rules around the format of the caseworker IDAM role format are very unlikely to change now. I doubt we'll ever need to use a delimiter different that - and a jur position different than 1. Also if that was the case CCD would break in many other places already. We can therefore simplify things a bit removing these 2 config options if we wanted.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459965950", "createdAt": "2020-07-24T10:09:48Z", "author": {"login": "mario-paniccia"}, "path": "src/main/resources/application.properties", "diffHunk": "@@ -179,3 +179,6 @@ ccd.conditional-apis.case-assigned-users-and-roles.enabled=${CCD_CONDITIONAL_API\n # (Note SecurityLoggingFilter logs at debug)\n security.logging.filter.path.regex=${DATA_STORE_SECURITY_LOGGING_FILTER_PATH_REGEX:.*}\n \n+caseworker.role.regex=${CASEWORKER_ROLE_REGEX:caseworker.+}\n+caseworker.role.delimiter=${CASEWORKER_ROLE_DELIMITER:-}\n+caseworker.role.jurisdiction.element.index=${CASEWORKER_ROLE_JURISDICTION_ELEMENT_INDEX:1}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MDA4OA==", "bodyText": "or, to simplify, couldn't we combine these 3 properties into one property called:\nccd.access-control.caseworker-jurisdiction.regex-group:caseworker-(.+)-.*  (unverified, probably needs refinement)\n?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459970088", "createdAt": "2020-07-24T10:20:13Z", "author": {"login": "mario-paniccia"}, "path": "src/main/resources/application.properties", "diffHunk": "@@ -179,3 +179,6 @@ ccd.conditional-apis.case-assigned-users-and-roles.enabled=${CCD_CONDITIONAL_API\n # (Note SecurityLoggingFilter logs at debug)\n security.logging.filter.path.regex=${DATA_STORE_SECURITY_LOGGING_FILTER_PATH_REGEX:.*}\n \n+caseworker.role.regex=${CASEWORKER_ROLE_REGEX:caseworker.+}\n+caseworker.role.delimiter=${CASEWORKER_ROLE_DELIMITER:-}\n+caseworker.role.jurisdiction.element.index=${CASEWORKER_ROLE_JURISDICTION_ELEMENT_INDEX:1}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2NTk1MA=="}, "originalCommit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3MDY5NzYxOnYy", "diffSide": "RIGHT", "path": "src/main/resources/application.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDoxNTo0N1rOG2qPZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDoxNTo0N1rOG2qPZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2ODM1OA==", "bodyText": "can you add these under a new section with comment:\n#ccd access control\nand prefix them with:\nccd.access-control\nThen move the already existing\n\n  \n    \n      ccd-data-store-api/src/main/resources/application.properties\n    \n    \n         Line 173\n      in\n      b90fc31\n    \n    \n    \n    \n\n        \n          \n           ccd.access-control.cross-jurisdictional-roles=${DATA_STORE_CROSS_JURISDICTIONAL_ROLES:caseworker-caa} \n        \n    \n  \n\n\nthere as well", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459968358", "createdAt": "2020-07-24T10:15:47Z", "author": {"login": "mario-paniccia"}, "path": "src/main/resources/application.properties", "diffHunk": "@@ -179,3 +179,6 @@ ccd.conditional-apis.case-assigned-users-and-roles.enabled=${CCD_CONDITIONAL_API\n # (Note SecurityLoggingFilter logs at debug)\n security.logging.filter.path.regex=${DATA_STORE_SECURITY_LOGGING_FILTER_PATH_REGEX:.*}\n \n+caseworker.role.regex=${CASEWORKER_ROLE_REGEX:caseworker.+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3775, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}