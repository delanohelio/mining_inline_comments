{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MjAxNTMy", "number": 869, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNTo1OToyMlrODrtt4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNTo1OToyMlrODrtt4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTY0Mzg2OnYy", "diffSide": "RIGHT", "path": "src/main/resources/db/changelog/db.changelog-RDM-6916.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNTo1OToyMlrOF8OC2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNTo1NDoyMFrOF_HSMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY4ODk4NA==", "bodyText": "Suggest you use Postgres' CONCURRENTLY modifier when creating these indexes; standard index creation will lock the case_event table for writes until the indexes are built, which could take time since it's a big table. You'd probably need to write a liquibase sql tag, don't think liquibase supports the concurrently flag. https://www.postgresql.org/docs/9.6/sql-createindex.html", "url": "https://github.com/hmcts/ccd-data-store-api/pull/869#discussion_r398688984", "createdAt": "2020-03-26T15:59:22Z", "author": {"login": "banderous"}, "path": "src/main/resources/db/changelog/db.changelog-RDM-6916.xml", "diffHunk": "@@ -0,0 +1,43 @@\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+                   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+                   xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+\n+    <!-- conditional drop to remove index manually created in some environments -->\n+    <changeSet id=\"rdm-6916-drop\" author=\"matt.nayler@hmcts.net\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <indexExists indexName=\"idx_case_event_created_date\"\n+                   schemaName=\"public\"\n+                   tableName=\"case_event\" />\n+        </preConditions>\n+        <dropIndex indexName=\"idx_case_event_created_date\"\n+                   schemaName=\"public\"\n+                   tableName=\"case_event\" />\n+    </changeSet>\n+\n+\n+    <changeSet id=\"rdm-6916\" author=\"matt.nayler@hmcts.net\">\n+\n+        <createIndex indexName=\"idx_case_event_created_date\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dc0fabc1ca291b848727bca7a4cf43032653cf"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcyMzk1NQ==", "bodyText": "Many thanks for your comment.  Some timing details from a series of test runs have been added to the Jira ticket associated to this PR and will be used during the review and checkpoint process to decide the way forward.\nNB: A separate set of scripts implementing the CONCURRENTLY modifier as you have recommended have been prepared in advance if the change is required.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/869#discussion_r401723955", "createdAt": "2020-04-01T15:54:20Z", "author": {"login": "mattnayler"}, "path": "src/main/resources/db/changelog/db.changelog-RDM-6916.xml", "diffHunk": "@@ -0,0 +1,43 @@\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+                   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+                   xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+\n+    <!-- conditional drop to remove index manually created in some environments -->\n+    <changeSet id=\"rdm-6916-drop\" author=\"matt.nayler@hmcts.net\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <indexExists indexName=\"idx_case_event_created_date\"\n+                   schemaName=\"public\"\n+                   tableName=\"case_event\" />\n+        </preConditions>\n+        <dropIndex indexName=\"idx_case_event_created_date\"\n+                   schemaName=\"public\"\n+                   tableName=\"case_event\" />\n+    </changeSet>\n+\n+\n+    <changeSet id=\"rdm-6916\" author=\"matt.nayler@hmcts.net\">\n+\n+        <createIndex indexName=\"idx_case_event_created_date\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY4ODk4NA=="}, "originalCommit": {"oid": "e6dc0fabc1ca291b848727bca7a4cf43032653cf"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3935, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}