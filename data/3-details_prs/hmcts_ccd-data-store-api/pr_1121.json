{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NjU5MjEx", "number": 1121, "title": "RDM 9505", "bodyText": "Before creating a pull request make sure that:\n\n commit messages are meaningful and follow good commit message guidelines\n README and other documentation has been updated / added (if needed)\n tests have been updated / new tests has been added (if needed)\n\nPlease remove this line and everything above and fill the following sections:\nJIRA link (if applicable)\nhttps://tools.hmcts.net/jira/browse/RDM-9505\nChange description\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[ ] No", "createdAt": "2020-09-17T13:13:31Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121", "merged": true, "mergeCommit": {"oid": "e9161da90f9858aa3630bd31000ed79c005be753"}, "closed": true, "closedAt": "2020-09-21T14:44:24Z", "author": {"login": "tomxelliott"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJwx1pAH2gAyNDg4NjU5MjExOjNiZWY2NzI1YTE0MjBiNjQ1MDIxZGU1MTA0YWNhNzVkODczMTFjZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLBK42AH2gAyNDg4NjU5MjExOjcxNzFiOTc4YmY2YTk0YmM3ZDhhMTdkOWVjMzkzNDllMGFkYWVkNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3bef6725a1420b645021de5104aca75d87311cdf", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/3bef6725a1420b645021de5104aca75d87311cdf", "committedDate": "2020-09-17T13:12:26Z", "message": "RDM-9505: Remove unused indexes and add new indexes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ebd7d95f4450ff305b45d5269ccd796df17649", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c8ebd7d95f4450ff305b45d5269ccd796df17649", "committedDate": "2020-09-17T13:35:58Z", "message": "RDM-9505: Alter create query to only create if not exists"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjA0MDMz", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121#pullrequestreview-490604033", "createdAt": "2020-09-17T13:38:26Z", "commit": {"oid": "3bef6725a1420b645021de5104aca75d87311cdf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzozODoyN1rOHTirbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzozODoyN1rOHTirbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1MzE2Ng==", "bodyText": "Dropping these indexes with liquibase may later on cause an issue should the same indexes are re-created for some reason and liquibase scripts are not aligned yet. I'd suggest removing these lines and manually dropping these and all other unused indexes, say, not scanned for the last 3 months. We need to also make sure these indexes are not getting created by other liquibase change sets. If they are, we need to remove basically any references to these indexes.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121#discussion_r490253166", "createdAt": "2020-09-17T13:38:27Z", "author": {"login": "MSancaktutar"}, "path": "src/main/resources/db/changelog/db.changelog-RDM-9505.xml", "diffHunk": "@@ -0,0 +1,25 @@\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+                   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+                   xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+\n+    <changeSet id=\"rdm-9505\" author=\"thomas.elliot@hmcts.net\">\n+        <sql dbms=\"postgresql\"\n+             endDelimiter=\"\\nGO\"\n+             splitStatements=\"true\"\n+             stripComments=\"true\">\n+            DROP INDEX idx_case_data__generated_dob;\n+            DROP INDEX idx_case_data_generatedemail;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bef6725a1420b645021de5104aca75d87311cdf"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjA0NTUx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121#pullrequestreview-490604551", "createdAt": "2020-09-17T13:38:57Z", "commit": {"oid": "3bef6725a1420b645021de5104aca75d87311cdf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15187e4aeb33f19eb3a7e5d0610edc1d0b301d25", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/15187e4aeb33f19eb3a7e5d0610edc1d0b301d25", "committedDate": "2020-09-17T13:39:33Z", "message": "RDM-9505: Delete indexes only if they exist"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjc2NTEy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121#pullrequestreview-490676512", "createdAt": "2020-09-17T14:43:55Z", "commit": {"oid": "15187e4aeb33f19eb3a7e5d0610edc1d0b301d25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjc4MzMx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121#pullrequestreview-490678331", "createdAt": "2020-09-17T14:45:34Z", "commit": {"oid": "15187e4aeb33f19eb3a7e5d0610edc1d0b301d25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad01be6a6b24e53bedcc51500e28b6a417211b1", "author": {"user": {"login": "tomxelliott", "name": "Tom Elliott"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/aad01be6a6b24e53bedcc51500e28b6a417211b1", "committedDate": "2020-09-18T08:58:33Z", "message": "Merge branch 'develop' into RDM-9505"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMzYwMjQ2", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121#pullrequestreview-492360246", "createdAt": "2020-09-21T08:07:26Z", "commit": {"oid": "aad01be6a6b24e53bedcc51500e28b6a417211b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80dbe563ac6b996c9ee81229156d91fd050a189c", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/80dbe563ac6b996c9ee81229156d91fd050a189c", "committedDate": "2020-09-21T09:39:47Z", "message": "RDM-9505: Create indexes concurrently to ensure the DB is not locked for too long"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf6d7aca788f87afa14e7289ad9046dade1146ee", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/cf6d7aca788f87afa14e7289ad9046dade1146ee", "committedDate": "2020-09-21T09:42:17Z", "message": "Merge branch 'RDM-9505' of github.com:hmcts/ccd-data-store-api into RDM-9505"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDMxOTQ2", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1121#pullrequestreview-492431946", "createdAt": "2020-09-21T09:44:52Z", "commit": {"oid": "cf6d7aca788f87afa14e7289ad9046dade1146ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7171b978bf6a94bc7d8a17d9ec39349e0adaed53", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/7171b978bf6a94bc7d8a17d9ec39349e0adaed53", "committedDate": "2020-09-21T10:52:12Z", "message": "RDM-9505: Add flag for runInTransaction as is required for concurrent index creation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2735, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}