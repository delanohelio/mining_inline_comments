{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MTgxNjk0", "number": 1026, "title": "RDM-9095 - Filter out cross-jurisdiction roles when determining user jurisdictions", "bodyText": "JIRA link (if applicable)\nhttps://tools.hmcts.net/jira/browse/RDM-9095\nChange description\nFilter out cross-jurisdiction roles when determining user jurisdictions\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[x] No", "createdAt": "2020-07-22T15:10:54Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026", "merged": true, "mergeCommit": {"oid": "90e23c1a4d134c1444d81eab399f1de670252b53"}, "closed": true, "closedAt": "2020-08-14T15:16:12Z", "author": {"login": "danlysiak"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3cSzmAH2gAyNDU1MTgxNjk0OjMxNjc3NDRhOTI0ZjQ0OWUzYTZkNmQ3MmE5NzM1ZmIzNDg1NmVhZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-2Kv4AFqTQ2NzY1OTMxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3167744a924f449e3a6d6d72a9735fb34856eaee", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/3167744a924f449e3a6d6d72a9735fb34856eaee", "committedDate": "2020-07-22T15:09:48Z", "message": "RDM-9095 - Filter out cross-jurisdictional roles when determining user jurisdictions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bf95d491ad3801a3eb6f883da43ba3a69e0b46d", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/9bf95d491ad3801a3eb6f883da43ba3a69e0b46d", "committedDate": "2020-07-22T16:05:41Z", "message": "Typos/simplification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db454cb6e4b6f820fd3cba2707a66ba8499157d1", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/db454cb6e4b6f820fd3cba2707a66ba8499157d1", "committedDate": "2020-07-22T16:09:02Z", "message": "Typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzOTM1NjIw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#pullrequestreview-453935620", "createdAt": "2020-07-23T08:40:12Z", "commit": {"oid": "db454cb6e4b6f820fd3cba2707a66ba8499157d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwODo0MDoxM1rOG2BTLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwODo0MDoxM1rOG2BTLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI5NzU4MA==", "bodyText": "I was thinking whether we can take this opportunity to also make the method a bit more precise.\nWith the current implementation any role of the form part1-part2-....partN will be considered a \"jurisidictional\" role for a jurisdiction \"part2\".\nIn reality this (not written) rule applies only for caseworkers (as far as I know!).\nSo was wondering if it would be better applying this method only to caseworkers roles (maybe using a regex?), and rename it to getCaseworkerUserRolesJurisdictions?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459297580", "createdAt": "2020-07-23T08:40:13Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "diffHunk": "@@ -179,7 +180,9 @@ public String getUserId() {\n     public List<String> getUserRolesJurisdictions() {\n         String[] roles = this.getUserDetails().getRoles();\n \n-        return Arrays.stream(roles).map(role ->  role.split(\"-\"))\n+        return Arrays.stream(roles)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db454cb6e4b6f820fd3cba2707a66ba8499157d1"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c3de2e6408a58adefba2226c40b14ebef0853c5", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6c3de2e6408a58adefba2226c40b14ebef0853c5", "committedDate": "2020-07-23T15:10:10Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64ab73ff0f4eac703c06ed6db2545537c743e652", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/64ab73ff0f4eac703c06ed6db2545537c743e652", "committedDate": "2020-07-23T16:19:41Z", "message": "Merge branch 'develop' into RDM-9095"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a7cd401aee0f52791c8fe83dcf0f51048ba7f421", "committedDate": "2020-07-23T17:37:24Z", "message": "Cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NzY3OTU1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#pullrequestreview-454767955", "createdAt": "2020-07-24T09:59:49Z", "commit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo1OTo0OVrOG2p1eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo1OTo0OVrOG2p1eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MTcyMQ==", "bodyText": "I'd suggest we make this a public method", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459961721", "createdAt": "2020-07-24T09:59:49Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "diffHunk": "@@ -234,4 +223,12 @@ private IdamUser toIdamUser(UserInfo userInfo) {\n         return idamUser;\n     }\n \n+    private boolean isCrossJurisdictionRole(String role) {\n+        return applicationParams.getCcdAccessControlCrossJurisdictionRoles().contains(role);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NzczNzAx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#pullrequestreview-454773701", "createdAt": "2020-07-24T10:09:48Z", "commit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDowOTo0OFrOG2qF_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDowOTo0OFrOG2qF_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2NTk1MA==", "bodyText": "I appreciate the intent to make this configurable.\nBut I think the rules around the format of the caseworker IDAM role format are very unlikely to change now. I doubt we'll ever need to use a delimiter different that - and a jur position different than 1. Also if that was the case CCD would break in many other places already. We can therefore simplify things a bit removing these 2 config options if we wanted.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459965950", "createdAt": "2020-07-24T10:09:48Z", "author": {"login": "mario-paniccia"}, "path": "src/main/resources/application.properties", "diffHunk": "@@ -179,3 +179,6 @@ ccd.conditional-apis.case-assigned-users-and-roles.enabled=${CCD_CONDITIONAL_API\n # (Note SecurityLoggingFilter logs at debug)\n security.logging.filter.path.regex=${DATA_STORE_SECURITY_LOGGING_FILTER_PATH_REGEX:.*}\n \n+caseworker.role.regex=${CASEWORKER_ROLE_REGEX:caseworker.+}\n+caseworker.role.delimiter=${CASEWORKER_ROLE_DELIMITER:-}\n+caseworker.role.jurisdiction.element.index=${CASEWORKER_ROLE_JURISDICTION_ELEMENT_INDEX:1}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0Nzc3MDM0", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#pullrequestreview-454777034", "createdAt": "2020-07-24T10:15:47Z", "commit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDoxNTo0N1rOG2qPZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMDoxNTo0N1rOG2qPZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2ODM1OA==", "bodyText": "can you add these under a new section with comment:\n#ccd access control\nand prefix them with:\nccd.access-control\nThen move the already existing\n\n  \n    \n      ccd-data-store-api/src/main/resources/application.properties\n    \n    \n         Line 173\n      in\n      b90fc31\n    \n    \n    \n    \n\n        \n          \n           ccd.access-control.cross-jurisdictional-roles=${DATA_STORE_CROSS_JURISDICTIONAL_ROLES:caseworker-caa} \n        \n    \n  \n\n\nthere as well", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459968358", "createdAt": "2020-07-24T10:15:47Z", "author": {"login": "mario-paniccia"}, "path": "src/main/resources/application.properties", "diffHunk": "@@ -179,3 +179,6 @@ ccd.conditional-apis.case-assigned-users-and-roles.enabled=${CCD_CONDITIONAL_API\n # (Note SecurityLoggingFilter logs at debug)\n security.logging.filter.path.regex=${DATA_STORE_SECURITY_LOGGING_FILTER_PATH_REGEX:.*}\n \n+caseworker.role.regex=${CASEWORKER_ROLE_REGEX:caseworker.+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d20a81407eeeb176f5a99008e1e982e625147ba", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1d20a81407eeeb176f5a99008e1e982e625147ba", "committedDate": "2020-07-24T10:48:37Z", "message": "RDM-9095 - Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f438b691438a200afb61c5d0c07edbb10a0a9e1d", "author": {"user": {"login": "mario-paniccia", "name": "Mario Paniccia"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f438b691438a200afb61c5d0c07edbb10a0a9e1d", "committedDate": "2020-07-24T11:48:49Z", "message": "improved readability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f58682b9856dafbfd1ece7e0a2a68ca0a403254", "author": {"user": {"login": "mario-paniccia", "name": "Mario Paniccia"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/0f58682b9856dafbfd1ece7e0a2a68ca0a403254", "committedDate": "2020-07-24T11:50:11Z", "message": "improved readability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0ODI1Mjkz", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#pullrequestreview-454825293", "createdAt": "2020-07-24T11:50:42Z", "commit": {"oid": "f438b691438a200afb61c5d0c07edbb10a0a9e1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75984952636fb14d4f9d3a417207c949a602e214", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/75984952636fb14d4f9d3a417207c949a602e214", "committedDate": "2020-08-07T08:22:25Z", "message": "Merge branch 'develop' into RDM-9095"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b971908910aa11f8d2c542c3eefce618db871e11", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/b971908910aa11f8d2c542c3eefce618db871e11", "committedDate": "2020-08-07T08:26:39Z", "message": "Update method names from merged changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6578947c4d2fae2e120b7606a70a85a00b2f6f95", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6578947c4d2fae2e120b7606a70a85a00b2f6f95", "committedDate": "2020-08-14T11:24:00Z", "message": "Merge branch 'develop' into RDM-9095"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjU5MzEy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#pullrequestreview-467659312", "createdAt": "2020-08-14T15:16:00Z", "commit": {"oid": "6578947c4d2fae2e120b7606a70a85a00b2f6f95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2854, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}