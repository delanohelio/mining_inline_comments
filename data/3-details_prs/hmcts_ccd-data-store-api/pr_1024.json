{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0OTU2OTIy", "number": 1024, "title": "RDM-8842 Increment Assigned User Count of Cases when Assigned to Users", "bodyText": "JIRA link (if applicable)\nRDM-8842 \"Increment Assigned User Count of Cases when Assigned to Users\"\nChange description\nIncrement an organisation's Assigned User Count for a Case when Case-Roles are assigned to users via Add Case Assigned Users and Roles operation.\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[x] No", "createdAt": "2020-07-22T08:15:48Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024", "merged": true, "mergeCommit": {"oid": "e2fbbb6c12a5876e581577c457d32ac30581c1a4"}, "closed": true, "closedAt": "2020-08-10T11:41:41Z", "author": {"login": "mattnayler"}, "timelineItems": {"totalCount": 102, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9esTGAH2gAyNDU0OTU2OTIyOjY4YzVlMDZlMGY0MTA3Njc2NzNlYTc1ZTcxZTM5ZjEwYjRiOTA1YTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9e0BPAH2gAyNDU0OTU2OTIyOmYyOWEyYTMwMzBlOTgxMzhkODEyN2U5Y2VkMWMwMWU3YTY5MzdkZDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "68c5e06e0f410767673ea75e71e39f10b4b905a6", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/68c5e06e0f410767673ea75e71e39f10b4b905a6", "committedDate": "2020-08-10T09:21:00Z", "message": "Merge branch 'develop' into RDM-8842"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f29a2a3030e98138d8127e9ced1c01e7a6937dd0", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f29a2a3030e98138d8127e9ced1c01e7a6937dd0", "committedDate": "2020-08-10T09:29:26Z", "message": "Merge branch 'develop' into RDM-8842\n\nConflicts:\n\tJenkinsfile_CNP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b21fc992fa089cd8ff09473c2ea0acfc1cf3eac4", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/b21fc992fa089cd8ff09473c2ea0acfc1cf3eac4", "committedDate": "2020-07-13T13:53:33Z", "message": "RDM-8842 Restructure RDM-8606/RDM-8806 FTA files\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRestructure existing FTA files for 'Add Case-Assigned User and Role'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cb5f9e2cfe3120c9eb5fd89b2940b8ee1573e52", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/9cb5f9e2cfe3120c9eb5fd89b2940b8ee1573e52", "committedDate": "2020-07-13T14:07:39Z", "message": "RDM-8842 Restructure RDM-8606/RDM-8806 FTA files\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRestructure existing FTA files for 'Add Case-Assigned User and Role'.\n\nAdjust RDM-8606/RDM-8806 scenarios to match original AC format.\n\nConflicts:\n\tbuild.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f1c81858e46be2f02225035cb854559f80a26c4", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6f1c81858e46be2f02225035cb854559f80a26c4", "committedDate": "2020-07-13T14:21:06Z", "message": "RDM-8842 Increment Assigned User Count (FTA: draft)\n\n   [RDM-8895](https://tools.hmcts.net/jira/browse/RDM-8895)\n\nRDM-8842: Increment Assigned User Count of Cases when Assigned to Users"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e16d45edfbe89302f05474199c5c1381c6709464", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e16d45edfbe89302f05474199c5c1381c6709464", "committedDate": "2020-07-14T13:10:44Z", "message": "RDM-8842: Update BEFTA test for A/C 1 related to 8842\n\t- Set up test data for A/C 1 scenarios"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3bb0a5399c04141b1c7e062bce7b9efafa48b15", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a3bb0a5399c04141b1c7e062bce7b9efafa48b15", "committedDate": "2020-07-14T13:16:11Z", "message": "RDM-8842: Update BEFTA test for A/C 1 related to 8842\n            - Set up test data for A/C 1 scenarios"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8d5fb5a61857181c4c488667c2ad0fdee639125", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c8d5fb5a61857181c4c488667c2ad0fdee639125", "committedDate": "2020-07-16T13:08:48Z", "message": "RDM-8842: Comple A/C 2,3 and 4 as well as additional refactor\n\t- Refactor verify files\n\t- Refactor Verify counter files to remove some code duplication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1633ae2c38472ca2798d87d71eb7b70da4dae2f7", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1633ae2c38472ca2798d87d71eb7b70da4dae2f7", "committedDate": "2020-07-17T10:15:17Z", "message": "RDM-8842: Alter feature file to fix typo\n\t- refactor test data files to account for the typo in the feature file and A/C 4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d8d15f6c81f955458e17945e446443df4d9bac5", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/9d8d15f6c81f955458e17945e446443df4d9bac5", "committedDate": "2020-07-20T10:47:34Z", "message": "RDM-8842 Refactor FTA files\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nAdjust Verify Counter TD files to reflect AC description in ticket."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cf280c1370b9a2cdafcedf5e76be7e1cf9e4b2e", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5cf280c1370b9a2cdafcedf5e76be7e1cf9e4b2e", "committedDate": "2020-07-20T11:19:46Z", "message": "RDM-8842 Increment Assigned User Count\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRDM-8842: Increment Assigned User Count of Cases when Assigned to Users.\n\nFirst working draft before refactoring."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35ee72cc6335f7324c47614ad6709264f507a991", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/35ee72cc6335f7324c47614ad6709264f507a991", "committedDate": "2020-07-20T15:56:37Z", "message": "RDM-8842 Increment Assigned User Count (refactor)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRefactor:\n * convert caseReference to caseId upfront rather than in two locations.\n * group by case ID first so conversion is only required once.\n * also allows it to fail fast when a case has not been found."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5545765cedea25e79b95031d8d863c5d1a098202", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5545765cedea25e79b95031d8d863c5d1a098202", "committedDate": "2020-07-22T07:57:31Z", "message": "RDM-8842 Increment Assigned User Count (test)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nUnit and Integration tests for changes under RDM-8842."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3426c863586e58a3dc55a52ee9e5f6faa2ba7ce", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f3426c863586e58a3dc55a52ee9e5f6faa2ba7ce", "committedDate": "2020-07-22T13:31:57Z", "message": "RDM-8842 Increment Assigned User Count (refactor)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nUse separate data models for the Add and Get APIs so the new\n `organisation_id` property used only by the Add API doesn't pollute\n the Get API's swagger definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dc05bc9a63a4a4e545baa9e7529df63a7db3c0d", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/0dc05bc9a63a4a4e545baa9e7529df63a7db3c0d", "committedDate": "2020-07-22T16:08:58Z", "message": "RDM-8842 Increment Assigned User Count (FTA)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nChange 4th BEFTA account choice but keep to same jurisdiction."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c80264f8122058d38ac5396bdcd047e8ed6041f", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5c80264f8122058d38ac5396bdcd047e8ed6041f", "committedDate": "2020-07-22T16:10:09Z", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzOTMxNjIy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-453931622", "createdAt": "2020-07-23T08:33:54Z", "commit": {"oid": "5c80264f8122058d38ac5396bdcd047e8ed6041f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23dcb66ccb282a4eb3c9b80a076476c625e24c35", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/23dcb66ccb282a4eb3c9b80a076476c625e24c35", "committedDate": "2020-07-27T13:51:13Z", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/F-105.feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e73508818f38eccc8566d563e7d88837605275a", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6e73508818f38eccc8566d563e7d88837605275a", "committedDate": "2020-07-27T17:41:01Z", "message": "RDM-8842 Refactor FTA files\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\n* Move and rename FTA files to create separate folders for each AC.\n* Adjust user references to load user data from parent context."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4cdb60cea9d5568183a1dd8a595aceb67c75c6b", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e4cdb60cea9d5568183a1dd8a595aceb67c75c6b", "committedDate": "2020-07-27T17:41:47Z", "message": "use latest prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed2c8aa874479e5a62842eecb7e70d67385348c2", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/ed2c8aa874479e5a62842eecb7e70d67385348c2", "committedDate": "2020-07-27T18:33:54Z", "message": "use fixed prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58c27e651944d6a686cf1c33befc4a44d335a9d8", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/58c27e651944d6a686cf1c33befc4a44d335a9d8", "committedDate": "2020-07-27T19:14:26Z", "message": "correct test data configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "609ae6d569a6cd97bb603c64040808bfd19fcdd3", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/609ae6d569a6cd97bb603c64040808bfd19fcdd3", "committedDate": "2020-07-27T19:21:30Z", "message": "use merged prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e9921d7d70d8b34d3ce6e127bfd97f66cc5ac43", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6e9921d7d70d8b34d3ce6e127bfd97f66cc5ac43", "committedDate": "2020-07-27T19:48:19Z", "message": "correct user"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e110bf76adc38bc3f0643731574726ccc1ba3ac2", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e110bf76adc38bc3f0643731574726ccc1ba3ac2", "committedDate": "2020-07-27T20:13:42Z", "message": "use latest prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc41013a08341c6f095c73f33545e33c30545461", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/fc41013a08341c6f095c73f33545e33c30545461", "committedDate": "2020-07-27T20:22:26Z", "message": "further user setup corrections"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f509b5ee8b30495c5dc0ad351f9dbdc3a687c339", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f509b5ee8b30495c5dc0ad351f9dbdc3a687c339", "committedDate": "2020-07-27T20:55:53Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d64db441458096c99e1d92b5faa75ef30caa67a", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1d64db441458096c99e1d92b5faa75ef30caa67a", "committedDate": "2020-07-27T20:56:20Z", "message": "correct whitespacing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8678d917131333b01c90e28ad11179940320b2ec", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/8678d917131333b01c90e28ad11179940320b2ec", "committedDate": "2020-07-27T21:27:45Z", "message": "correct invoking user"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c96440c5e7c2bce4b958dadbab810124e3c00750", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c96440c5e7c2bce4b958dadbab810124e3c00750", "committedDate": "2020-07-27T21:42:14Z", "message": "fix wrong token creation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a44b40f7a59b39128348b4202275e51b86b1449", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5a44b40f7a59b39128348b4202275e51b86b1449", "committedDate": "2020-07-27T21:50:41Z", "message": "new prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6ce3d244209aef6449abff91e16e27cabf03e47", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/b6ce3d244209aef6449abff91e16e27cabf03e47", "committedDate": "2020-07-28T09:13:16Z", "message": "Merge pull request #1030 from hmcts/aca-11\n\nuse latest prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c776b98c99a0f02a483d8669517e742e7269f100", "author": {"user": {"login": "nathan-clark", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c776b98c99a0f02a483d8669517e742e7269f100", "committedDate": "2020-07-28T09:25:05Z", "message": "Update Chart.yaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b0b09bf2e131e50b954776de3ef296b0490ab7b", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1b0b09bf2e131e50b954776de3ef296b0490ab7b", "committedDate": "2020-07-28T10:53:50Z", "message": "use latest stable release"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00c8b4eca1fbc7a8d5ab10947dd7f2323d4dfc73", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/00c8b4eca1fbc7a8d5ab10947dd7f2323d4dfc73", "committedDate": "2020-07-28T12:17:39Z", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/F-105_Add_Case_Assigned_User_Roles_400_response.td.json\n\tsrc/aat/resources/features/F-105/F-105_Users.td.json\n\tsrc/aat/resources/features/F-105/S-105.1.verify.td.json\n\tsrc/aat/resources/features/F-105/S-105.11.td.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c2f324b5f2350395fc141ce4264d7abb69fa13f", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/7c2f324b5f2350395fc141ce4264d7abb69fa13f", "committedDate": "2020-07-28T15:49:37Z", "message": "RDM-8842 Refactor FTA files after BEFTA FW upgrade\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\n* Adjust user references to fit with BEFTA FW changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b351f7f03fb08dd02fb35f88662fc25bc6ca686", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6b351f7f03fb08dd02fb35f88662fc25bc6ca686", "committedDate": "2020-07-29T08:25:28Z", "message": "RDM-9143: Resolve unique id issue and enable ES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec253640388be0f08241d36414fdfb5afbb9102e", "author": {"user": {"login": "sumansreenivasan", "name": "suman"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/ec253640388be0f08241d36414fdfb5afbb9102e", "committedDate": "2020-07-29T08:44:26Z", "message": "Adding db ChangeLog for new indexes created as part of RDM-8463 (#959)\n\n* Adding db ChangeLog for new indexes created as part of RDM-8463\r\n\r\n* Adding db ChangeLog for new indexes created as part of RDM-8463\r\n\r\n* Removed duplicate entry\r\n\r\nCo-authored-by: sumansreenivasan <anuManu10>\r\nCo-authored-by: Olawale Olanrewaju <olanrewajume@yahoo.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8259719e3060bfd55210601dd72b8b1eb3b3fe7", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a8259719e3060bfd55210601dd72b8b1eb3b3fe7", "committedDate": "2020-07-29T09:01:21Z", "message": "RDM-9143: Trigger rebuild of Docker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf9f3de4ed4e4b53cb7cfb2276fd5744c16ce729", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/bf9f3de4ed4e4b53cb7cfb2276fd5744c16ce729", "committedDate": "2020-07-29T10:50:43Z", "message": "RDM-9143: Change definition store pr run against"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa0c471ea575b1be98f1354718d224c6f292f81a", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/aa0c471ea575b1be98f1354718d224c6f292f81a", "committedDate": "2020-07-29T11:23:31Z", "message": "Trigger Build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66033a1bcdc5ab0161a9533ffbc30a5734a2611f", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/66033a1bcdc5ab0161a9533ffbc30a5734a2611f", "committedDate": "2020-07-29T11:55:14Z", "message": "Trigger Build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17d6e83445dc2aa7f4edc4f8cc243e734e8a0a08", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/17d6e83445dc2aa7f4edc4f8cc243e734e8a0a08", "committedDate": "2020-07-29T12:32:02Z", "message": "refine feature titles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0cf1b291396ff95b324adced05019c68a591ec8", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f0cf1b291396ff95b324adced05019c68a591ec8", "committedDate": "2020-07-29T12:52:16Z", "message": "declare acls unordered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ba5545fefc47b43abad7996b138eedebbb9b6fe", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/0ba5545fefc47b43abad7996b138eedebbb9b6fe", "committedDate": "2020-07-29T13:04:07Z", "message": "declare acls unordered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "242ae50f75768369560fe4ccbaccbc348a2b4e52", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/242ae50f75768369560fe4ccbaccbc348a2b4e52", "committedDate": "2020-07-29T14:35:21Z", "message": "RDM-9143: Fix case_types_results issues in FTA tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d03341d196292bd477ec8d9002a0611990e8db2e", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/d03341d196292bd477ec8d9002a0611990e8db2e", "committedDate": "2020-07-29T16:38:17Z", "message": "fix user config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d8ebb150b7a3a264dd8d430a753f185669571a", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/97d8ebb150b7a3a264dd8d430a753f185669571a", "committedDate": "2020-07-29T16:38:38Z", "message": "Merge branch 'RDM-9143.new' of git@github.com:hmcts/ccd-data-store-api.git into RDM-9143.new"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59d92644fb51e9bd135a2d8dc49cbd3686d4390a", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/59d92644fb51e9bd135a2d8dc49cbd3686d4390a", "committedDate": "2020-07-29T16:42:52Z", "message": "Merge branch 'release-cut-19.1' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "040f61655acbf6ec632a09e52cf042cf60f7a439", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/040f61655acbf6ec632a09e52cf042cf60f7a439", "committedDate": "2020-07-29T16:43:13Z", "message": "Merge branch 'develop' into RDM-9143.new"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26774efae4dfa81288d81177d7b74f16f413c1ce", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/26774efae4dfa81288d81177d7b74f16f413c1ce", "committedDate": "2020-07-29T17:22:36Z", "message": "fix user config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21f270d2baafc3dbdbf4c0913c52969db92a63ef", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/21f270d2baafc3dbdbf4c0913c52969db92a63ef", "committedDate": "2020-07-29T17:23:21Z", "message": "remove redundant line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "383cbdeebbfbe7cc21435bd49e0844e398e65323", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/383cbdeebbfbe7cc21435bd49e0844e398e65323", "committedDate": "2020-07-29T19:48:25Z", "message": "RDM-9143: Fix broken test for quantity of objects in list\n\t- add ignore annotation to all tests that fail with LAST_STATE_MODIFIED_DATE issue - fix coming in 19.1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be1607d82cfd13d4e94d48894e3bab5e12c87eb6", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/be1607d82cfd13d4e94d48894e3bab5e12c87eb6", "committedDate": "2020-07-29T22:17:29Z", "message": "correct user config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f787d70217d03465ec9659e4196290e1c11c2a23", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f787d70217d03465ec9659e4196290e1c11c2a23", "committedDate": "2020-07-29T22:24:11Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "072e3471b8cce5f96445d9042913b7b69089baec", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/072e3471b8cce5f96445d9042913b7b69089baec", "committedDate": "2020-07-29T22:27:11Z", "message": "fix syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb2e67731f06d316935e1e77c6f1ae98d7c3901", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/8eb2e67731f06d316935e1e77c6f1ae98d7c3901", "committedDate": "2020-07-30T07:26:31Z", "message": "Merge pull request #1033 from hmcts/RDM-9143.new\n\nRdm 9143.new"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04264c68ded3e099fc54408075a07c2c41c207d", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f04264c68ded3e099fc54408075a07c2c41c207d", "committedDate": "2020-07-30T08:43:16Z", "message": "use def store develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a113edc9e8960f18c027b8bdfc5238fcd122611d", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a113edc9e8960f18c027b8bdfc5238fcd122611d", "committedDate": "2020-07-30T08:43:39Z", "message": "use def store develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68eb05c59d4389c89901734b3aa48c6855c807c8", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/68eb05c59d4389c89901734b3aa48c6855c807c8", "committedDate": "2020-07-30T11:11:19Z", "message": "disable ES FTAs on feature branches"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cf238b1f71b89affa230e942658e83bb67175ff", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6cf238b1f71b89affa230e942658e83bb67175ff", "committedDate": "2020-07-30T12:23:04Z", "message": "Trigger Build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d1e82a0cda55a8741741dbe3a4c69ccd5a448aa", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/3d1e82a0cda55a8741741dbe3a4c69ccd5a448aa", "committedDate": "2020-07-30T12:51:40Z", "message": "Trigger Build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3bf7204dd1ce8dabf4070e67cf593d6d766949c", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/d3bf7204dd1ce8dabf4070e67cf593d6d766949c", "committedDate": "2020-07-30T13:53:42Z", "message": "Revert \"disable ES FTAs on feature branches\"\n\nThis reverts commit 68eb05c59d4389c89901734b3aa48c6855c807c8."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd5f07cf912f41550a0103c45c1ecdb2173993cd", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/cd5f07cf912f41550a0103c45c1ecdb2173993cd", "committedDate": "2020-07-30T15:13:06Z", "message": "Revert \"Revert \"disable ES FTAs on feature branches\"\"\n\nThis reverts commit d3bf7204dd1ce8dabf4070e67cf593d6d766949c."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f26e595e0c89dbd9167a970b6f9dd37e41e2855", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/7f26e595e0c89dbd9167a970b6f9dd37e41e2855", "committedDate": "2020-07-30T16:19:04Z", "message": "cleanup and tidy up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "667d27102b36ebcaa09a36ad50a2aa1c1d543401", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/667d27102b36ebcaa09a36ad50a2aa1c1d543401", "committedDate": "2020-07-30T16:31:35Z", "message": "remove redundant code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4279d1af60224267e9b42a8864cf81bfbdbc4afc", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/4279d1af60224267e9b42a8864cf81bfbdbc4afc", "committedDate": "2020-07-30T16:35:55Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22ce42fbd8250c35549fb3f5b4ebe4bf82e12ba1", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/22ce42fbd8250c35549fb3f5b4ebe4bf82e12ba1", "committedDate": "2020-07-30T16:36:18Z", "message": "rename env var to avoid confusion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7c322f353e62ef6623628fa6d2755ce2d82a952", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e7c322f353e62ef6623628fa6d2755ce2d82a952", "committedDate": "2020-07-30T16:37:04Z", "message": "remove redudant env var for ftas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b35331e55679ecc1e42b792a90cf9deada187a9c", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/b35331e55679ecc1e42b792a90cf9deada187a9c", "committedDate": "2020-07-30T16:38:06Z", "message": "remove invalid import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc7244d7c6ce56e569737169497f4351781876f0", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/cc7244d7c6ce56e569737169497f4351781876f0", "committedDate": "2020-07-30T16:58:27Z", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd6c401eaf5d949b2d126614c2379e455a50313e", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/fd6c401eaf5d949b2d126614c2379e455a50313e", "committedDate": "2020-07-30T17:05:59Z", "message": "Merge pull request #1036 from hmcts/disable-es-FTAs-on-feature-branches\n\nDisable es ft as on feature branches"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fd8f458536a37ec131463f217bf300d76495934", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/8fd8f458536a37ec131463f217bf300d76495934", "committedDate": "2020-07-30T19:26:04Z", "message": "fix env var setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91d78fd96ea11ddd80578bb8b2e4443c2c59c498", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/91d78fd96ea11ddd80578bb8b2e4443c2c59c498", "committedDate": "2020-07-30T20:03:18Z", "message": "use pr 601"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc50061e51d1529ee57e60d7e422adf4eeef997d", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/bc50061e51d1529ee57e60d7e422adf4eeef997d", "committedDate": "2020-07-30T20:06:34Z", "message": "echo ES FTA switch with the branch name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "827e080c5b2d2ed05acf34dd0dd85ab312afafef", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/827e080c5b2d2ed05acf34dd0dd85ab312afafef", "committedDate": "2020-07-30T20:08:38Z", "message": "correct 'branch' value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1920f5c47ab734b87c163df826a5c04a44a40b46", "committedDate": "2020-07-30T23:26:17Z", "message": "Merge branch 'develop' into RDM-8842"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTg2NTE3", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-458986517", "createdAt": "2020-07-31T08:00:22Z", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODowMDoyMlrOG5_jfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODowMDoyMlrOG5_jfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2MzI5Mg==", "bodyText": "Should have a more descriptive scenario title, telling what is specific to this scenario.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463463292", "createdAt": "2020-07-31T08:00:22Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-105/F-105.feature", "diffHunk": "@@ -210,3 +199,79 @@ Feature: F-105: Add Case-Assigned Users and Roles\n     Then a positive response is received,\n     And the response has all the details as expected,\n     And a call [to verify Olawale's reception of the role CR-1 and CR-2 over the case C1] will get the expected response as in [S-105.13_Get_Case_Roles_for_Case_C1].\n+\n+  # RDM-8842 AC-1\n+  @S-105.8842.1\n+  Scenario: Must successfully increment Assigned User Count when assigning a user and case role for a specific case (by a user calling through/from an authorised application)\n+    Given an appropriate test context as detailed in the test data source,\n+    And a user [Richard - who can create a case],\n+    And a user [Dil - who is to add some case role assignment for a case],\n+    And a user [Olawale - with an active solicitor profile],\n+    And a user [Hemanth - with an active solicitor profile],\n+    And a case [C1, which Richard has just] created as in [F-105_Case_Data_Create_C1],\n+    And a successful call [to check the number of users having access to C1 in its supplementary data] as in [F-105_Prerequisite_Counter_Check_Call],\n+    When a request is prepared with appropriate values,\n+    And the request [is made from an authorised application, by Dil, with the Case ID of C1, User ID of Olawale, proper Case Role CR-1 and CR-2 and the Organisation ID of Olawale],\n+    And it is submitted to call the [Add Case-Assigned Users and Roles] operation of [CCD Data Store Api],\n+    Then a positive response is received,\n+    And the response has all the details as expected,\n+    And a call [to verify Olawale's reception of the role CR-1 and CR-2 over the case C1] will get the expected response as in [S-105.8842.1_Verify_Case_Roles_for_Case_C1],\n+    And a call [to verify the count of users assigned to C1 has increased by 1] will get the expected response as in [S-105.8842.1_Verify_Counter_1],\n+    And a call [to repeat the same request as above] will get the expected response as in [S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles],\n+    And a call [to verify the count of users assigned to C1 has NOT increased] will get the expected response as in [S-105.8842.1_Verify_Counter_2],\n+    And a call [to repeat the same request as above this time with a different user, Hemanth] will get the expected response as in [S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles_Hemanth],\n+    And a call [to verify the count of users assigned to a case has increased by 1] will get the expected response as in [S-105.8842.1_Verify_Counter_3].\n+\n+   # RDM-8842 AC-2\n+   @S-105.8842.2\n+   Scenario: Must not increment Assigned User Count when assigning a user and case role for a specific case if there was already a case user role assignment with the respective values in the request (by a user calling through/from an authorised application)\n+     Given an appropriate test context as detailed in the test data source,\n+     And a user [Richard - who can create a case],\n+     And a user [Dil - who is to add some case role assignment for a case],\n+     And a user [Olawale - with an active solicitor profile and valid User ID],\n+     And a case [C1, which Richard has just] created as in [F-105_Case_Data_Create_C1],\n+     And a successful call [to grant access for Olawale with a case role CR-1 over the case C1] as in [S-105.8842.2_Grant_Access],\n+     And a successful call [to check the number of users having access to C1 in its supplementary data] as in [F-105_Prerequisite_Counter_Check_Call],\n+     When a request is prepared with appropriate values,\n+     And the request [is made from an authorised application, by Dil, with the Case ID of C1, User ID of Olawale, proper Case Role CR-2 and the Organisation ID of Olawale],\n+     And it is submitted to call the [Add Case-Assigned Users and Roles] operation of [CCD Data Store Api],\n+     Then a positive response is received,\n+     And the response has all the details as expected,\n+     And a call [to verify Olawale's reception of the role CR-2 over the case C1] will get the expected response as in [S-105.8842.2_Verify_Case_Roles_for_Case_C1],\n+     And a call [to verify the count of users assigned to a case] will get the expected response as in [F-105_Verify_Counter_Unchanged].\n+\n+   # RDM-8842 AC-3\n+   @S-105.8842.3\n+   Scenario: No organisation ID is provided by the user", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "originalPosition": 135}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTg3MDU3", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-458987057", "createdAt": "2020-07-31T08:01:18Z", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODowMToxOFrOG5_lJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODowMToxOFrOG5_lJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2MzcxNg==", "bodyText": "could we be more specific in wording here, telling that the count will be zero?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463463716", "createdAt": "2020-07-31T08:01:18Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-105/F-105.feature", "diffHunk": "@@ -210,3 +199,79 @@ Feature: F-105: Add Case-Assigned Users and Roles\n     Then a positive response is received,\n     And the response has all the details as expected,\n     And a call [to verify Olawale's reception of the role CR-1 and CR-2 over the case C1] will get the expected response as in [S-105.13_Get_Case_Roles_for_Case_C1].\n+\n+  # RDM-8842 AC-1\n+  @S-105.8842.1\n+  Scenario: Must successfully increment Assigned User Count when assigning a user and case role for a specific case (by a user calling through/from an authorised application)\n+    Given an appropriate test context as detailed in the test data source,\n+    And a user [Richard - who can create a case],\n+    And a user [Dil - who is to add some case role assignment for a case],\n+    And a user [Olawale - with an active solicitor profile],\n+    And a user [Hemanth - with an active solicitor profile],\n+    And a case [C1, which Richard has just] created as in [F-105_Case_Data_Create_C1],\n+    And a successful call [to check the number of users having access to C1 in its supplementary data] as in [F-105_Prerequisite_Counter_Check_Call],\n+    When a request is prepared with appropriate values,\n+    And the request [is made from an authorised application, by Dil, with the Case ID of C1, User ID of Olawale, proper Case Role CR-1 and CR-2 and the Organisation ID of Olawale],\n+    And it is submitted to call the [Add Case-Assigned Users and Roles] operation of [CCD Data Store Api],\n+    Then a positive response is received,\n+    And the response has all the details as expected,\n+    And a call [to verify Olawale's reception of the role CR-1 and CR-2 over the case C1] will get the expected response as in [S-105.8842.1_Verify_Case_Roles_for_Case_C1],\n+    And a call [to verify the count of users assigned to C1 has increased by 1] will get the expected response as in [S-105.8842.1_Verify_Counter_1],\n+    And a call [to repeat the same request as above] will get the expected response as in [S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles],\n+    And a call [to verify the count of users assigned to C1 has NOT increased] will get the expected response as in [S-105.8842.1_Verify_Counter_2],\n+    And a call [to repeat the same request as above this time with a different user, Hemanth] will get the expected response as in [S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles_Hemanth],\n+    And a call [to verify the count of users assigned to a case has increased by 1] will get the expected response as in [S-105.8842.1_Verify_Counter_3].\n+\n+   # RDM-8842 AC-2\n+   @S-105.8842.2\n+   Scenario: Must not increment Assigned User Count when assigning a user and case role for a specific case if there was already a case user role assignment with the respective values in the request (by a user calling through/from an authorised application)\n+     Given an appropriate test context as detailed in the test data source,\n+     And a user [Richard - who can create a case],\n+     And a user [Dil - who is to add some case role assignment for a case],\n+     And a user [Olawale - with an active solicitor profile and valid User ID],\n+     And a case [C1, which Richard has just] created as in [F-105_Case_Data_Create_C1],\n+     And a successful call [to grant access for Olawale with a case role CR-1 over the case C1] as in [S-105.8842.2_Grant_Access],\n+     And a successful call [to check the number of users having access to C1 in its supplementary data] as in [F-105_Prerequisite_Counter_Check_Call],\n+     When a request is prepared with appropriate values,\n+     And the request [is made from an authorised application, by Dil, with the Case ID of C1, User ID of Olawale, proper Case Role CR-2 and the Organisation ID of Olawale],\n+     And it is submitted to call the [Add Case-Assigned Users and Roles] operation of [CCD Data Store Api],\n+     Then a positive response is received,\n+     And the response has all the details as expected,\n+     And a call [to verify Olawale's reception of the role CR-2 over the case C1] will get the expected response as in [S-105.8842.2_Verify_Case_Roles_for_Case_C1],\n+     And a call [to verify the count of users assigned to a case] will get the expected response as in [F-105_Verify_Counter_Unchanged].\n+\n+   # RDM-8842 AC-3\n+   @S-105.8842.3\n+   Scenario: No organisation ID is provided by the user\n+     Given an appropriate test context as detailed in the test data source,\n+     And a user [Richard - who can create a case],\n+     And a user [Dil - who is to add some case role assignment for a case],\n+     And a user [Olawale - with an active solicitor profile and valid User ID],\n+     And a case [C1, which Richard has just] created as in [F-105_Case_Data_Create_C1],\n+     And a successful call [to check the number of users having access to C1 in its supplementary data] as in [F-105_Prerequisite_Counter_Check_Call],\n+     When a request is prepared with appropriate values,\n+     And the request [is made from an authorised application, by Dil, with the Case ID of C1, User ID of Olawale, proper Case Role CR-1 and no Organisation ID],\n+     And it is submitted to call the [Add Case-Assigned Users and Roles] operation of [CCD Data Store Api],\n+     Then a positive response is received,\n+     And the response has all the details as expected,\n+     And a call [to verify Olawale's reception of the role CR-1 over the case C1] will get the expected response as in [S-105.8842.3_Verify_Case_Roles_for_Case_C1],\n+     And a call [to verify the count of users assigned to a case] will get the expected response as in [F-105_Verify_Counter_Unchanged].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "originalPosition": 148}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTkwNDA3", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-458990407", "createdAt": "2020-07-31T08:07:12Z", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODowNzoxM1rOG5_vuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODowNzoxM1rOG5_vuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2NjQyNA==", "bodyText": "The 2 class names don't have a parallelism in the semantics, breaching the expected connotation of an IS-A relation. The sentence CaseAssignedUserRoleRequest IS A CaseAssignedUserRole is technically correct, but linguistically wrong. Could you please propose a better fitting name for one or both of these to have a proper IS-A reading?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463466424", "createdAt": "2020-07-31T08:07:13Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/std/CaseAssignedUserRoleRequest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package uk.gov.hmcts.ccd.domain.model.std;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.ToString;\n+\n+import static com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+@ToString\n+@NoArgsConstructor\n+@Getter\n+public class CaseAssignedUserRoleRequest extends CaseAssignedUserRole {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTkzMzA3", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-458993307", "createdAt": "2020-07-31T08:12:13Z", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODoxMjoxM1rOG5_45Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODoxMjoxM1rOG5_45Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2ODc3Mw==", "bodyText": "in the value of an entry, the list is not that of roles. perhaps a name like requestedAssignments could read", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463468773", "createdAt": "2020-07-31T08:12:13Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,118 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleRequest> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleRequest>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, roles) ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTkzNTc4", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-458993578", "createdAt": "2020-07-31T08:12:42Z", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODoxMjo0MlrOG5_5tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODoxMjo0MlrOG5_5tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2ODk4MA==", "bodyText": "how about requestedAssignment here?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463468980", "createdAt": "2020-07-31T08:12:42Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,118 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleRequest> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleRequest>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, roles) ->\n+            roles.forEach(caseUserRole ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4OTk0Mjkz", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-458994293", "createdAt": "2020-07-31T08:14:02Z", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODoxNDowMlrOG5_78w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwODoxNDowMlrOG5_78w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2OTU1NQ==", "bodyText": "newUserCounts returned shouldn't be nullable. If there is nothing to return, the method calculating this should return an empty map.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463469555", "createdAt": "2020-07-31T08:14:02Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,118 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleRequest> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleRequest>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, roles) ->\n+            roles.forEach(caseUserRole ->\n+                caseUserRepository.grantAccess(caseId, caseUserRole.getUserId(), caseUserRole.getCaseRole()))\n+        );\n+\n+        if (newUserCounts != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MDEyMDMw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-459012030", "createdAt": "2020-07-31T08:43:49Z", "commit": {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59a9d6db2cc41950908277875bc59d1cf4989e00", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/59a9d6db2cc41950908277875bc59d1cf4989e00", "committedDate": "2020-07-31T14:28:33Z", "message": "RDM-9118 FTA organisation adjustment for RDM-8842\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nIncrement Assigned User Count FTA organisation adjustment:\n* Load organisation data from PRD or test stub.\n* Add PRD reference to BEFTA section of JenkinsFile."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0ad630efb82e7065a72cc4f20a5ff4f5f36cd91", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a0ad630efb82e7065a72cc4f20a5ff4f5f36cd91", "committedDate": "2020-07-31T14:50:18Z", "message": "RDM-9118 use Befta FW pre-release\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nBefta FW changes for RDM-9118 FTA organisation adjustment for RDM-8842:\n* allow formulas to return more complex items: e.g. map, array...,\n* ReflectionUtils.deepGetFieldInObject now supports keys containing `.`,\n* adjust dynamic value injection processing of arrays & lists."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15fb5dabeaf530ec4a0a06d42453b2821de2506", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f15fb5dabeaf530ec4a0a06d42453b2821de2506", "committedDate": "2020-07-31T14:57:35Z", "message": "Merge remote-tracking branch 'origin/RDM-8842' into RDM-9118-from-8842"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "315f08c0683961a7095b3a0c6405a57f411bc7f1", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/315f08c0683961a7095b3a0c6405a57f411bc7f1", "committedDate": "2020-08-04T10:54:58Z", "message": "RDM-8842 dev review changes\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddc012ba6fbd99015daefab78aed0a2912947f3d", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/ddc012ba6fbd99015daefab78aed0a2912947f3d", "committedDate": "2020-08-04T11:21:46Z", "message": "Merge remote-tracking branch 'origin/RDM-8842' into RDM-9118-from-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_2.td.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2299b77b8ee57e7385efd4eedd404ee0a762836", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a2299b77b8ee57e7385efd4eedd404ee0a762836", "committedDate": "2020-08-04T11:33:17Z", "message": "RDM-9118 use Befta FW pre-release\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nBefta FW changes for RDM-9118 FTA organisation adjustment for RDM-8842:\n* allow formulas to return more complex items: e.g. map, array...,\n* ReflectionUtils.deepGetFieldInObject now supports keys containing `.`,\n* adjust dynamic value injection processing of arrays & lists."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "386f797ba41d69c7e430eb7f7776b0d69e535d98", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/386f797ba41d69c7e430eb7f7776b0d69e535d98", "committedDate": "2020-08-04T15:47:42Z", "message": "Merge branch 'develop' into RDM-8842"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c645868721080608b0d221e70564ffbbcd6ef5d2", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c645868721080608b0d221e70564ffbbcd6ef5d2", "committedDate": "2020-08-04T15:57:32Z", "message": "folder reorganisation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "149ac5187211ab98650630bc73ea2cf2afbef478", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/149ac5187211ab98650630bc73ea2cf2afbef478", "committedDate": "2020-08-04T18:05:50Z", "message": "RDM-8842 folder reorganisation (part 2)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd6bbc0d2c4ed287c7312abe921b4cb266299ddf", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/fd6bbc0d2c4ed287c7312abe921b4cb266299ddf", "committedDate": "2020-08-04T18:18:09Z", "message": "RDM-8842 folder reorganisation (part 3)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb7aca2a74e4f2b3e9b44ae29d1b2c6786ba6c2", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/3cb7aca2a74e4f2b3e9b44ae29d1b2c6786ba6c2", "committedDate": "2020-08-04T19:14:38Z", "message": "Merge remote-tracking branch 'origin/RDM-8842' into RDM-9118-from-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/common/F-105_Users.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles_Hemanth.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_1.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_2.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_3.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.2/S-105.8842.2.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.4/S-105.8842.4.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/common/F-105_Check_Orgs_Assigned_Users_Base.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/common/F-105_Prerequisite_Counter_Check_Call.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/common/F-105_Verify_Counter_Unchanged.td.json"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMTU3MDQx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-461157041", "createdAt": "2020-08-04T20:40:38Z", "commit": {"oid": "fd6bbc0d2c4ed287c7312abe921b4cb266299ddf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d572d59f4b3040019ef1f6ebde173580524a76b7", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/d572d59f4b3040019ef1f6ebde173580524a76b7", "committedDate": "2020-08-05T10:46:51Z", "message": "RDM-9118 adjust BEFTA account usage in F-105\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48873c1f0cd4f3582a48ebd5d71221382ce6c70b", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/48873c1f0cd4f3582a48ebd5d71221382ce6c70b", "committedDate": "2020-08-05T10:58:23Z", "message": "RDM-9118 adjust BEFTA account usage in F-105\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5724df52ef85551434d4ba3f33a0b897fce17d45", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5724df52ef85551434d4ba3f33a0b897fce17d45", "committedDate": "2020-08-05T15:59:30Z", "message": "Merge pull request #1039 from hmcts/RDM-9118-from-8842\n\nRDM-9118 FTA organisation adjustment for RDM-8842"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c36c6c1e95343de4e587463345260123f04b2cf", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/0c36c6c1e95343de4e587463345260123f04b2cf", "committedDate": "2020-08-05T17:14:50Z", "message": "use latest stable fw release"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDQxNjM5", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-464041639", "createdAt": "2020-08-10T08:30:38Z", "commit": {"oid": "0c36c6c1e95343de4e587463345260123f04b2cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODozMDozOVrOG-FoWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODozMDozOVrOG-FoWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc1NzE0NA==", "bodyText": "May be it's better to extract these into separate small methods for better readability and unit testing?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r467757144", "createdAt": "2020-08-10T08:30:39Z", "author": {"login": "smathangi"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,121 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, requestedAssignments) ->\n+            requestedAssignments.forEach(requestedAssignment ->\n+                caseUserRepository.grantAccess(caseId, requestedAssignment.getUserId(), requestedAssignment.getCaseRole())\n+            )\n+        );\n+\n+        newUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n+            orgNewUserCountMap.forEach((organisationId, newUserCount) ->\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference, \"orgs_assigned_users.\" + organisationId, newUserCount)\n+            )\n+        );\n+    }\n+\n+    private Map<Long, List<CaseAssignedUserRoleWithOrganisation>> getMapOfCaseAssignedUserRolesByCaseId(\n+        List<CaseAssignedUserRoleWithOrganisation> caseUserRoles\n+    ) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = new HashMap<>();\n+\n         List<Long> caseReferences = caseUserRoles.stream()\n-            .map(CaseAssignedUserRole::getCaseDataId)\n+            .map(CaseAssignedUserRoleWithOrganisation::getCaseDataId)\n             .distinct()\n             .map(Long::parseLong)\n             .collect(Collectors.toCollection(ArrayList::new));\n \n+        // create map of case references to case IDs\n         Map<Long, String> caseIdAndReferences = getCaseDetailsList(caseReferences).stream()\n             .collect(Collectors.toMap(CaseDetails::getReference, CaseDetails::getId));\n \n-        caseUserRoles.forEach(caseUserRole -> {\n-            final Long caseReference = Long.parseLong(caseUserRole.getCaseDataId());\n+        // group roles by case reference\n+        Map<String, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseReference = caseUserRoles.stream()\n+            .collect(Collectors.groupingBy(CaseAssignedUserRoleWithOrganisation::getCaseDataId));\n+\n+        // merge both maps to check we have found all cases\n+        cauRolesByCaseReference.forEach((key, roles) -> {\n+            final Long caseReference = Long.parseLong(key);\n             if (caseIdAndReferences.containsKey(caseReference)) {\n                 final Long caseId = Long.parseLong(caseIdAndReferences.get(caseReference));\n-                caseUserRepository.grantAccess(caseId, caseUserRole.getUserId(), caseUserRole.getCaseRole());\n+                cauRolesByCaseId.put(caseId, roles);\n             } else {\n-                throw new CaseNotFoundException(caseReference.toString());\n+                throw new CaseNotFoundException(key);\n+            }\n+        });\n+\n+        return cauRolesByCaseId;\n+    }\n+\n+    private Map<String, Map<String, Object>> getNewUserCountByCaseAndOrganisation(Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+        Map<String, Map<String, Object>> result = new HashMap<>();\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> caseUserRolesWhichHaveAnOrgId = cauRolesByCaseId.entrySet().stream()\n+            .collect(Collectors.toMap(Map.Entry::getKey, e -> e.getValue().stream()\n+                // filter out no organisation_id\n+                .filter(caseUserRole -> StringUtils.isNoneBlank(caseUserRole.getOrganisationId()))\n+                .collect(Collectors.toList())))\n+            // filter cases that have no remaining roles\n+            .entrySet().stream().filter(e -> !e.getValue().isEmpty())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c36c6c1e95343de4e587463345260123f04b2cf"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDY0NzMx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#pullrequestreview-464064731", "createdAt": "2020-08-10T09:07:10Z", "commit": {"oid": "0c36c6c1e95343de4e587463345260123f04b2cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2846, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}