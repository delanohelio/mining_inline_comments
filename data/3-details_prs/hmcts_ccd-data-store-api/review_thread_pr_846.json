{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3Mjk5NTA5", "number": 846, "reviewThreads": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDozMzo0M1rODpDZGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNzoxNDo0OVrODq5CFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MzczNzg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseEventFieldComplex.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDozMzo0M1rOF3-97Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDozMzo0M1rOF3-97Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0NzY2MQ==", "bodyText": "Cosmetic: Given that a new constructor was added we can make all attribute immutable and remove setters.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394247661", "createdAt": "2020-03-18T10:33:43Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseEventFieldComplex.java", "diffHunk": "@@ -11,15 +11,25 @@\n \n     private Integer order;\n \n+    private String displayContextParameter;\n+\n     public CaseEventFieldComplex() {\n     }\n \n     public CaseEventFieldComplex(String reference,\n-                                 Integer order) {\n+                                  Integer order) {\n         this.reference = reference;\n         this.order = order;\n     }\n \n+    public CaseEventFieldComplex(String reference,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Mzc0MDI3OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseTypeTab.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDozNDoyOFrOF3-_Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDozNDoyOFrOF3-_Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0ODAzOA==", "bodyText": "Not sure if checkstyle likes .*  organise imports", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394248038", "createdAt": "2020-03-18T10:34:28Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseTypeTab.java", "diffHunk": "@@ -1,7 +1,7 @@\n package uk.gov.hmcts.ccd.domain.model.definition;\n \n import com.fasterxml.jackson.annotation.JsonProperty;\n-import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.*;\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Mzc0MzA0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CriteriaField.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDozNToxOFrOF3_BLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoxMDoyNlrOF5VQMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0ODQ5Mg==", "bodyText": "Do we need the  @ApiModelProperty(value = \"\") ?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394248492", "createdAt": "2020-03-18T10:35:18Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CriteriaField.java", "diffHunk": "@@ -69,4 +70,14 @@ public String getRole() {\n     public void setRole(final String role) {\n         this.role = role;\n     }\n+\n+    @ApiModelProperty(value = \"\")\n+    @JsonProperty(\"display_context_parameter\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2MTM2MA==", "bodyText": "Purely added for consistency with rest of this class.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r395661360", "createdAt": "2020-03-20T14:10:26Z", "author": {"login": "danlysiak"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CriteriaField.java", "diffHunk": "@@ -69,4 +70,14 @@ public String getRole() {\n     public void setRole(final String role) {\n         this.role = role;\n     }\n+\n+    @ApiModelProperty(value = \"\")\n+    @JsonProperty(\"display_context_parameter\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0ODQ5Mg=="}, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Mzc0OTMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperation.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDozNzowM1rOF3_FGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzo1ODowMVrOF7cTdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0OTQ5OQ==", "bodyText": "Not sure if checkstyle likes .*  organise imports", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394249499", "createdAt": "2020-03-18T10:37:03Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperation.java", "diffHunk": "@@ -14,9 +14,7 @@\n import uk.gov.hmcts.ccd.data.user.UserRepository;\n import uk.gov.hmcts.ccd.domain.model.aggregated.IdamUser;\n import uk.gov.hmcts.ccd.domain.model.callbacks.AfterSubmitCallbackResponse;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseDetails;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseEvent;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseType;\n+import uk.gov.hmcts.ccd.domain.model.definition.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY3Nzc1NQ==", "bodyText": "Better to create one code template file so that every one can use the same template file in their IDE. So all these import specific warnings/error messages will be handled properly", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394677755", "createdAt": "2020-03-18T22:33:11Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperation.java", "diffHunk": "@@ -14,9 +14,7 @@\n import uk.gov.hmcts.ccd.data.user.UserRepository;\n import uk.gov.hmcts.ccd.domain.model.aggregated.IdamUser;\n import uk.gov.hmcts.ccd.domain.model.callbacks.AfterSubmitCallbackResponse;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseDetails;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseEvent;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseType;\n+import uk.gov.hmcts.ccd.domain.model.definition.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0OTQ5OQ=="}, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjI5NzM0NQ==", "bodyText": "agree with you Kiran. I did raise a ticket for this it's been in Kanban for a while but never gets picked up :)", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396297345", "createdAt": "2020-03-23T09:01:46Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperation.java", "diffHunk": "@@ -14,9 +14,7 @@\n import uk.gov.hmcts.ccd.data.user.UserRepository;\n import uk.gov.hmcts.ccd.domain.model.aggregated.IdamUser;\n import uk.gov.hmcts.ccd.domain.model.callbacks.AfterSubmitCallbackResponse;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseDetails;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseEvent;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseType;\n+import uk.gov.hmcts.ccd.domain.model.definition.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0OTQ5OQ=="}, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3NDAzOA==", "bodyText": "resolving conversation as it's nothing particular relate to this PR.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397874038", "createdAt": "2020-03-25T13:58:01Z", "author": {"login": "smathangi"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperation.java", "diffHunk": "@@ -14,9 +14,7 @@\n import uk.gov.hmcts.ccd.data.user.UserRepository;\n import uk.gov.hmcts.ccd.domain.model.aggregated.IdamUser;\n import uk.gov.hmcts.ccd.domain.model.callbacks.AfterSubmitCallbackResponse;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseDetails;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseEvent;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseType;\n+import uk.gov.hmcts.ccd.domain.model.definition.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0OTQ5OQ=="}, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Mzc2NjE5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/WorkbasketInputDefinition.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDo0MToyOVrOF3_Pcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoxMDozMlrOF5VQfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1MjE0Nw==", "bodyText": "Do we need the @ApiModelProperty(value = \"\") as value=\"\" ?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394252147", "createdAt": "2020-03-18T10:41:29Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/WorkbasketInputDefinition.java", "diffHunk": "@@ -37,4 +38,16 @@ public void setCaseTypeId(String caseTypeId) {\n     public void setFields(List<WorkbasketInputField> fields) {\n         this.fields = fields;\n     }\n+\n+    /**\n+     **/\n+    @ApiModelProperty(value = \"\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2MTQzNw==", "bodyText": "Purely added for consistency with rest of this class.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r395661437", "createdAt": "2020-03-20T14:10:32Z", "author": {"login": "danlysiak"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/WorkbasketInputDefinition.java", "diffHunk": "@@ -37,4 +38,16 @@ public void setCaseTypeId(String caseTypeId) {\n     public void setFields(List<WorkbasketInputField> fields) {\n         this.fields = fields;\n     }\n+\n+    /**\n+     **/\n+    @ApiModelProperty(value = \"\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1MjE0Nw=="}, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Mzc2ODEzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/SearchInputDefinition.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDo0MjowM1rOF3_Qqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoxMDozNlrOF5VQsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1MjQ1OA==", "bodyText": "@ApiModelProperty(value = \"\")  do we need the value=\"\" ?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394252458", "createdAt": "2020-03-18T10:42:03Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/SearchInputDefinition.java", "diffHunk": "@@ -40,4 +41,16 @@ public void setFields(List<SearchInputField> fields) {\n         this.fields = fields;\n     }\n \n+    /**\n+     **/\n+    @ApiModelProperty(value = \"\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2MTQ4OQ==", "bodyText": "Purely added for consistency with rest of this class.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r395661489", "createdAt": "2020-03-20T14:10:36Z", "author": {"login": "danlysiak"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/SearchInputDefinition.java", "diffHunk": "@@ -40,4 +41,16 @@ public void setFields(List<SearchInputField> fields) {\n         this.fields = fields;\n     }\n \n+    /**\n+     **/\n+    @ApiModelProperty(value = \"\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1MjQ1OA=="}, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0Mzc5MzA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDo0OToxM1rOF3_gjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDo0OToxM1rOF3_gjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1NjUyNQ==", "bodyText": "I am not sure about the  requirements . Can we create a \"\" format ?  Would that be default ? or it will lead directly in exception.   If we know before it we can treat it  as  throw new DataProcessingException() . in Common  error handling place.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394256525", "createdAt": "2020-03-18T10:49:13Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+\n+@Component\n+public class DateTimeEntryProcessor extends CaseDataFieldProcessor {\n+\n+    private static final List<String> SUPPORTED_TYPES = Arrays.asList(DATETIME, DATE);\n+\n+    private final DateTimeFormatParser dateTimeFormatParser;\n+\n+    @Autowired\n+    public DateTimeEntryProcessor(CaseViewFieldBuilder caseViewFieldBuilder,\n+                                  DateTimeFormatParser dateTimeFormatParser) {\n+        super(caseViewFieldBuilder);\n+        this.dateTimeFormatParser = dateTimeFormatParser;\n+    }\n+\n+    @Override\n+    protected JsonNode executeSimple(JsonNode node, CommonField field, BaseType baseType, String fieldPath) {\n+        return !isNullOrEmpty(node)\n+            && hasDisplayContextParameterType(field.getDisplayContextParameter(), DisplayContextParameterType.DATETIMEENTRY)\n+            && isSupportedBaseType(baseType, SUPPORTED_TYPES) ?\n+            createNode(field.getDisplayContextParameter(), node.asText(), baseType, fieldPath) :\n+            node;\n+    }\n+\n+    @Override\n+    protected JsonNode executeCollection(JsonNode collectionNode, CommonField caseViewField, String fieldPath) {\n+        final BaseType collectionFieldType = BaseType.get(caseViewField.getFieldType().getCollectionFieldType().getType());\n+\n+        if (hasDisplayContextParameterType(caseViewField.getDisplayContextParameter(), DisplayContextParameterType.DATETIMEENTRY)\n+            && isSupportedBaseType(collectionFieldType, SUPPORTED_TYPES)) {\n+            ArrayNode newNode = MAPPER.createArrayNode();\n+            collectionNode.forEach(item -> {\n+                JsonNode newItem = item.deepCopy();\n+                ((ObjectNode)newItem).replace(CollectionValidator.VALUE,\n+                    createNode(caseViewField.getDisplayContextParameter(), item.get(CollectionValidator.VALUE).asText(), collectionFieldType, fieldPath));\n+                newNode.add(newItem);\n+            });\n+\n+            return newNode;\n+        }\n+\n+        return collectionNode;\n+    }\n+\n+    private TextNode createNode(String displayContextParameter, String valueToConvert, BaseType baseType, String fieldPath) {\n+        String format = getDisplayContextParameterOfType(displayContextParameter, DisplayContextParameterType.DATETIMEENTRY)\n+            .map(DisplayContextParameter::getValue)\n+            .orElse(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MzgwMDg5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDo1MToyN1rOF3_lhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDozNjozOVrOF7eJ2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1Nzc5OA==", "bodyText": "The same .* .", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394257798", "createdAt": "2020-03-18T10:51:27Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkwNDM0Ng==", "bodyText": "done", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397904346", "createdAt": "2020-03-25T14:36:39Z", "author": {"login": "smathangi"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1Nzc5OA=="}, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MzgwNzgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDo1MzoyMlrOF3_p_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMDo1MzoyMlrOF3_p_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI1ODk0MA==", "bodyText": "you can organise imports in inteliJ and add the option to  implicit add each import . It is very cosmetic but sometimes checkstyle tends to complaint about \" .* \" .", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394258940", "createdAt": "2020-03-18T10:53:22Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.google.common.base.Strings;\n+\n+import java.util.*;\n+import java.util.regex.Matcher;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f6395a3d45687530f40410c9c0c11700e339b3d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NDc1NDA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTowMzo1OVrOF4JN4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTowMzo1OVrOF4JN4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQxNTU4NA==", "bodyText": "protected boolean isNullOrEmpty(final JsonNode node)  is quite duplicated any. any places . We could create a util class .", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394415584", "createdAt": "2020-03-18T15:03:59Z", "author": {"login": "Thor-tech-of-metal"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseEventField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseField;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+\n+public abstract class FieldProcessor {\n+\n+    protected static final ObjectMapper MAPPER = new ObjectMapper();\n+    protected static final String FIELD_SEPARATOR = \".\";\n+\n+    private final CaseViewFieldBuilder caseViewFieldBuilder;\n+\n+    public FieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        this.caseViewFieldBuilder = caseViewFieldBuilder;\n+    }\n+\n+    public JsonNode execute(JsonNode node, CaseField caseField, CaseEventField caseEventField, WizardPageField wizardPageField) {\n+        CaseViewField caseViewField = caseViewFieldBuilder.build(caseField, caseEventField);\n+\n+        if (!BaseType.contains(caseViewField.getFieldType().getType())) {\n+            return node;\n+        }\n+\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());\n+\n+        if (BaseType.get(COMPLEX) == fieldType) {\n+            return executeComplex(node, caseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, caseField.getId());\n+        } else if (BaseType.get(COLLECTION) == fieldType) {\n+            return executeCollection(node, caseViewField, caseField.getId());\n+        } else {\n+            return executeSimple(node, caseViewField, fieldType, caseField.getId());\n+        }\n+    }\n+\n+    protected JsonNode executeComplex(JsonNode complexNode,\n+                                      List<CaseField> complexCaseFields,\n+                                      CaseEventField caseEventField,\n+                                      WizardPageField wizardPageField,\n+                                      String fieldPrefix) {\n+        if (complexNode == null) {\n+            return null;\n+        }\n+        ObjectNode newNode = MAPPER.createObjectNode();\n+        complexCaseFields.stream().forEach(complexCaseField -> {\n+            final BaseType complexFieldType = BaseType.get(complexCaseField.getFieldType().getType());\n+            final String fieldId = complexCaseField.getId();\n+            final JsonNode caseFieldNode = complexNode.get(fieldId);\n+            final String fieldPath = fieldPrefix + FIELD_SEPARATOR + fieldId;\n+\n+            if (complexFieldType == BaseType.get(COLLECTION)) {\n+                newNode.set(fieldId, executeCollection(caseFieldNode, complexCaseField, fieldPath));\n+            } else if (complexFieldType == BaseType.get(COMPLEX)) {\n+                Optional.ofNullable(\n+                    executeComplex(caseFieldNode, complexCaseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, fieldPath))\n+                    .ifPresent(result -> newNode.set(fieldId, result));\n+            } else {\n+                newNode.set(fieldId, executeSimple(caseFieldNode, complexCaseField, complexFieldType, fieldPath));\n+            }\n+        });\n+\n+        return newNode;\n+    }\n+\n+    protected abstract JsonNode executeSimple(JsonNode node, CommonField field, BaseType baseType, String fieldPath);\n+\n+    protected abstract JsonNode executeCollection(JsonNode collectionNode, CommonField field, String fieldPath);\n+\n+    protected boolean isNullOrEmpty(final JsonNode node) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjM2MDg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParser.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjo0MToxN1rOF4ZZAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjo0MToxN1rOF4ZZAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MDU3Nw==", "bodyText": "Better to throw the exception from this method. Rather than catching global Exception from the calling method.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394680577", "createdAt": "2020-03-18T22:41:17Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParser.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeFormatterBuilder;\n+import java.time.format.DateTimeParseException;\n+import java.time.temporal.ChronoField;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class DateTimeFormatParser {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(DateTimeFormatParser.class);\n+\n+    private static final String DATE_TIME_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSS\";\n+    private static final String DATE_FORMAT = \"yyyy-MM-dd\";\n+\n+    public void parseDateTimeFormat(String dateTimeFormat, String value) throws Exception {\n+        try {\n+            DateTimeFormatter formatter = DateTimeFormatter.ofPattern(dateTimeFormat);\n+            formatter.parse(value);\n+        } catch (IllegalArgumentException | DateTimeParseException e) {\n+            LOG.error(\"Error occurred while parsing date time format \" + dateTimeFormat, e);\n+            throw new Exception(dateTimeFormat);\n+        }\n+    }\n+\n+    public String convertDateTimeToIso8601(String dateTimeFormat, String value) {\n+        DateTimeFormatter inputFormat = new DateTimeFormatterBuilder()\n+            .appendPattern(dateTimeFormat)\n+            .parseDefaulting(ChronoField.YEAR_OF_ERA, LocalDate.now().getYear())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjM2MTE5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParser.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjo0MToyOFrOF4ZZOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjo0MToyOFrOF4ZZOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MDYzMg==", "bodyText": "Better to throw the exception from this method. Rather than catching global Exception from the calling method.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394680632", "createdAt": "2020-03-18T22:41:28Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParser.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeFormatterBuilder;\n+import java.time.format.DateTimeParseException;\n+import java.time.temporal.ChronoField;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class DateTimeFormatParser {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(DateTimeFormatParser.class);\n+\n+    private static final String DATE_TIME_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSS\";\n+    private static final String DATE_FORMAT = \"yyyy-MM-dd\";\n+\n+    public void parseDateTimeFormat(String dateTimeFormat, String value) throws Exception {\n+        try {\n+            DateTimeFormatter formatter = DateTimeFormatter.ofPattern(dateTimeFormat);\n+            formatter.parse(value);\n+        } catch (IllegalArgumentException | DateTimeParseException e) {\n+            LOG.error(\"Error occurred while parsing date time format \" + dateTimeFormat, e);\n+            throw new Exception(dateTimeFormat);\n+        }\n+    }\n+\n+    public String convertDateTimeToIso8601(String dateTimeFormat, String value) {\n+        DateTimeFormatter inputFormat = new DateTimeFormatterBuilder()\n+            .appendPattern(dateTimeFormat)\n+            .parseDefaulting(ChronoField.YEAR_OF_ERA, LocalDate.now().getYear())\n+            .parseDefaulting(ChronoField.MONTH_OF_YEAR, LocalDate.now().getMonthValue())\n+            .parseDefaulting(ChronoField.DAY_OF_MONTH, LocalDate.now().getDayOfMonth())\n+            .parseDefaulting(ChronoField.HOUR_OF_DAY, 0)\n+            .parseDefaulting(ChronoField.MINUTE_OF_HOUR, 0)\n+            .parseDefaulting(ChronoField.SECOND_OF_MINUTE, 0)\n+            .parseDefaulting(ChronoField.MILLI_OF_SECOND, 0)\n+            .toFormatter();\n+\n+        LocalDateTime dateTime = LocalDateTime.parse(value, inputFormat);\n+        return dateTime.format(DateTimeFormatter.ofPattern(DATE_TIME_FORMAT));\n+    }\n+\n+    public String convertDateToIso8601(String dateFormat, String value) {\n+        DateTimeFormatter inputFormat = new DateTimeFormatterBuilder()\n+            .appendPattern(dateFormat)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjM3MTE3OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjo0NjoxNlrOF4ZfYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjo0NjoxNlrOF4ZfYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MjIwOQ==", "bodyText": "Do we really need to throw IllegalArgumentException here? as it is RuntimeException, if you want to customise the behaviour on exception. Handle that here itself", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394682209", "createdAt": "2020-03-18T22:46:16Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.google.common.base.Strings;\n+\n+import java.util.*;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+public enum DisplayContextParameterType {\n+    DATETIMEENTRY,\n+    DATETIMEDISPLAY,\n+    TABLE,\n+    LIST;\n+\n+    private static final Pattern PATTERN = Pattern.compile(\"#(.+)\\\\((.+)\\\\)\");\n+    private static final int TYPE_GROUP = 1;\n+    private static final int VALUE_GROUP = 2;\n+\n+    public static Optional<DisplayContextParameterType> getParameterTypeFor(String displayContextParameter) {\n+        Matcher m = PATTERN.matcher(displayContextParameter);\n+        if (m.matches()) {\n+            try {\n+                return Optional.of(valueOf(m.group(TYPE_GROUP)));\n+            } catch (IllegalArgumentException e) {\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    public static Optional<String> getParameterValueFor(String displayContextParameter) throws IllegalArgumentException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjM5ODMzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/FieldType.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMjo1ODo0OVrOF4Zwag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDozNDozMVrOF7eDEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4NjU3MA==", "bodyText": "Can we use this option to rename this class to something meaningful. Better to move all constants to enum.\nName is misleading.. This class has more functionality than simple Type class.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394686570", "createdAt": "2020-03-18T22:58:49Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/FieldType.java", "diffHunk": "@@ -26,6 +26,8 @@\n     public static final String PREDEFINED_COMPLEX_ADDRESS_UK = \"AddressUK\";\n     public static final String PREDEFINED_COMPLEX_ORDER_SUMMARY = \"OrderSummary\";\n     public static final String PREDEFINED_COMPLEX_CASELINK = \"CaseLink\";\n+    public static final String DATETIME = \"DateTime\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkwMjYwOA==", "bodyText": "Agree. But that'll be an improvement on existing code - nothing specific to this PR changes.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397902608", "createdAt": "2020-03-25T14:34:31Z", "author": {"login": "smathangi"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/FieldType.java", "diffHunk": "@@ -26,6 +26,8 @@\n     public static final String PREDEFINED_COMPLEX_ADDRESS_UK = \"AddressUK\";\n     public static final String PREDEFINED_COMPLEX_ORDER_SUMMARY = \"OrderSummary\";\n     public static final String PREDEFINED_COMPLEX_CASELINK = \"CaseLink\";\n+    public static final String DATETIME = \"DateTime\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4NjU3MA=="}, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjQwNTc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/SearchResultField.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzowMjoyNFrOF4Z1HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDo0NToyM1rOF5WqVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4Nzc3Mw==", "bodyText": "instead of defining the displayContextParameter in each class, Can we create an AbstractDisplayContextParamterField and extend that class?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394687773", "createdAt": "2020-03-18T23:02:24Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/SearchResultField.java", "diffHunk": "@@ -98,4 +100,12 @@ public String buildCaseFieldId() {\n         }\n         return getCaseFieldId();\n     }\n+\n+    public String getDisplayContextParameter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY4NDQzNw==", "bodyText": "Another potential improvement ticket maybe? There are various fields which are on different models (DCP being one of them) so this kind of idea could apply to a number of fields. Naturally abstract wouldn't work in that case but I get the general point!", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r395684437", "createdAt": "2020-03-20T14:45:23Z", "author": {"login": "danlysiak"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/SearchResultField.java", "diffHunk": "@@ -98,4 +100,12 @@ public String buildCaseFieldId() {\n         }\n         return getCaseFieldId();\n     }\n+\n+    public String getDisplayContextParameter() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4Nzc3Mw=="}, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjQxNDc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzowNjozM1rOF4Z6eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDo0MToxOFrOF5WgAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4OTE0Ng==", "bodyText": "Do we need CaseDataFieldProcessor class? instead we can extend directly from FieldProcessor class.\nCaseDataFieldProcessor has no specific logic implemented...", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394689146", "createdAt": "2020-03-18T23:06:33Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+\n+@Component\n+public class DateTimeEntryProcessor extends CaseDataFieldProcessor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY4MTc5NA==", "bodyText": "This is to cater for the next PR #851 where there are two different types of FieldProcessor (CaseDataFieldProcessor being one of them).", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r395681794", "createdAt": "2020-03-20T14:41:18Z", "author": {"login": "danlysiak"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+\n+@Component\n+public class DateTimeEntryProcessor extends CaseDataFieldProcessor {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4OTE0Ng=="}, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODA0OTk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToxNDo1M1rOF4p7kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMToxNDo1M1rOF4p7kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1MTU2OQ==", "bodyText": "isNullOrEmpty check is already done in getDisplayContextParameterOfType. No need to call this again here.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394951569", "createdAt": "2020-03-19T11:14:53Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameter.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.google.common.base.Strings;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameterType.getParameterTypeFor;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameterType.getParameterValueFor;\n+\n+public class DisplayContextParameter {\n+\n+    private DisplayContextParameterType type;\n+\n+    private String value;\n+\n+    public DisplayContextParameter(DisplayContextParameterType type, String value) {\n+        this.type = type;\n+        this.value = value;\n+    }\n+\n+    public DisplayContextParameterType getType() {\n+        return type;\n+    }\n+\n+    public String getValue() {\n+        return value;\n+    }\n+\n+    public static List<DisplayContextParameter> getDisplayContextParameterFor(String displayContextParameter) {\n+        List<DisplayContextParameter> displayContextParameterTypeList = new ArrayList<>();\n+\n+        String[] displayContextParameters = displayContextParameter.split(\",\");\n+        for (String s : displayContextParameters) {\n+            Optional<DisplayContextParameterType> type = getParameterTypeFor(s);\n+            Optional<String> value = getParameterValueFor(s);\n+\n+            if (!type.isPresent() || !value.isPresent()) {\n+                displayContextParameterTypeList.add(new DisplayContextParameter(null, null));\n+            } else {\n+                displayContextParameterTypeList.add(new DisplayContextParameter(type.get(), value.get()));\n+            }\n+\n+        }\n+        return displayContextParameterTypeList;\n+    }\n+\n+    public static Optional<DisplayContextParameter> getDisplayContextParameterOfType(String displayContextParameter,\n+                                                                                     DisplayContextParameterType type) {\n+        return Strings.isNullOrEmpty(displayContextParameter) ?\n+            Optional.empty() :\n+            getDisplayContextParameterFor(displayContextParameter).stream()\n+                .filter(param -> param.getType() == type)\n+                .findAny();\n+    }\n+\n+    public static boolean hasDisplayContextParameterType(String displayContextParameter, DisplayContextParameterType type) {\n+        return !Strings.isNullOrEmpty(displayContextParameter) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODE0MTk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo0MzowMlrOF4q0ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo0MzowMlrOF4q0ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk2NjE1NA==", "bodyText": "we can make this method private. as this call either executeCollection or executeSimple only.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394966154", "createdAt": "2020-03-19T11:43:02Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseEventField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseField;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+\n+public abstract class FieldProcessor {\n+\n+    protected static final ObjectMapper MAPPER = new ObjectMapper();\n+    protected static final String FIELD_SEPARATOR = \".\";\n+\n+    private final CaseViewFieldBuilder caseViewFieldBuilder;\n+\n+    public FieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        this.caseViewFieldBuilder = caseViewFieldBuilder;\n+    }\n+\n+    public JsonNode execute(JsonNode node, CaseField caseField, CaseEventField caseEventField, WizardPageField wizardPageField) {\n+        CaseViewField caseViewField = caseViewFieldBuilder.build(caseField, caseEventField);\n+\n+        if (!BaseType.contains(caseViewField.getFieldType().getType())) {\n+            return node;\n+        }\n+\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());\n+\n+        if (BaseType.get(COMPLEX) == fieldType) {\n+            return executeComplex(node, caseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, caseField.getId());\n+        } else if (BaseType.get(COLLECTION) == fieldType) {\n+            return executeCollection(node, caseViewField, caseField.getId());\n+        } else {\n+            return executeSimple(node, caseViewField, fieldType, caseField.getId());\n+        }\n+    }\n+\n+    protected JsonNode executeComplex(JsonNode complexNode,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODE2Mjk1OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/aggregated/DefaultGetCaseViewOperationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo0OTozOFrOF4rBiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo0OTozOFrOF4rBiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk2OTQ4MQ==", "bodyText": "Why we need to call with 'null'. Default value is 'null. anyway.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394969481", "createdAt": "2020-03-19T11:49:38Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/aggregated/DefaultGetCaseViewOperationTest.java", "diffHunk": "@@ -161,6 +161,7 @@ void shouldHydrateCaseHistoryViewerIfFieldPresentInTabs() {\n                                                                                                                            .withType(\n                                                                                                                                CASE_HISTORY_VIEWER)\n                                                                                                                            .build())\n+                                                                                                        .withDisplayContextParameter(null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODE2MzE2OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/aggregated/DefaultGetCaseViewOperationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo0OTo0M1rOF4rBrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo0OTo0M1rOF4rBrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk2OTUxOA==", "bodyText": "Why we need to call with 'null'. Default value is 'null. anyway.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394969518", "createdAt": "2020-03-19T11:49:43Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/aggregated/DefaultGetCaseViewOperationTest.java", "diffHunk": "@@ -194,6 +195,7 @@ void shouldNotHydrateCaseHistoryViewerIfFieldIsNotPresentInTabs() {\n                                                                                                                            .withType(\n                                                                                                                                \"NotACaseHistoryViewer\")\n                                                                                                                            .build())\n+                                                                                                        .withDisplayContextParameter(null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODE2ODczOnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/common/TestBuildersUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo1MTo0NFrOF4rFVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTo1MTo0NFrOF4rFVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk3MDQ1NQ==", "bodyText": "Why we need to call with 'null'. Default value is 'null. anyway.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394970455", "createdAt": "2020-03-19T11:51:44Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/common/TestBuildersUtil.java", "diffHunk": "@@ -1432,6 +1442,7 @@ private CaseTypeTabBuilder() {\n             this.caseTypeTabFields = newArrayList();\n             this.caseTypeTab = new CaseTypeTab();\n             this.caseTypeTab.setTabFields(caseTypeTabFields);\n+            this.caseTypeTab.setDisplayContextParameter(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODE5NTQ1OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParserTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMjowMDozOFrOF4rWYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMjowMDozOFrOF4rWYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk3NDgxOA==", "bodyText": "Please add test cases for convertDateToIso8601 and some failure cases as well for the below exceptions\nIllegalArgumentException and DateTimeParseException", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r394974818", "createdAt": "2020-03-19T12:00:38Z", "author": {"login": "kiran-yenigala-hmcts"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParserTest.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.*;\n+import static org.junit.jupiter.api.Assertions.assertAll;\n+\n+class DateTimeFormatParserTest {\n+\n+    private DateTimeFormatParser dateTimeFormatParser;\n+\n+    @BeforeEach\n+    void setUp() {\n+        dateTimeFormatParser = new DateTimeFormatParser();\n+    }\n+\n+    @Test\n+    void shouldConvertDateTimeToIso8601() {\n+        final String dateTimeFormat = \"HHmmssSSS dd/MM/yyyy\";\n+        final String value = \"123059000 20/10/2000\";\n+\n+        final String result = dateTimeFormatParser.convertDateTimeToIso8601(dateTimeFormat, value);\n+\n+        assertAll(\n+            () -> assertThat(result, is(\"2000-10-20T12:30:59.000\"))\n+        );\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a775e2360f6dd74746700acb4662434a36836557"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NjY0MTQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseEventFieldComplex.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwODo1Mzo0MFrOF57xPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwODo1Mzo0MFrOF57xPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjI5MjQxNA==", "bodyText": "minor:\nconsider introducing a builder for CaseEventFieldComplex rather than telescoping constructors:\nhttps://www.vojtechruzicka.com/avoid-telescoping-constructor-pattern/", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396292414", "createdAt": "2020-03-23T08:53:40Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseEventFieldComplex.java", "diffHunk": "@@ -11,15 +11,25 @@\n \n     private Integer order;\n \n+    private String displayContextParameter;\n+\n     public CaseEventFieldComplex() {\n     }\n \n     public CaseEventFieldComplex(String reference,\n-                                 Integer order) {\n+                                  Integer order) {\n         this.reference = reference;\n         this.order = order;\n     }\n \n+    public CaseEventFieldComplex(String reference,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzEzOTEzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowOTowN1rOF6AoAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowOTowN1rOF6AoAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3MTk2OA==", "bodyText": "can we use\ncaseField.isCollectionFieldType()\ncaseField.isComplexFieldType()\n?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396371968", "createdAt": "2020-03-23T11:09:07Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseEventField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseField;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+\n+public abstract class FieldProcessor {\n+\n+    protected static final ObjectMapper MAPPER = new ObjectMapper();\n+    protected static final String FIELD_SEPARATOR = \".\";\n+\n+    private final CaseViewFieldBuilder caseViewFieldBuilder;\n+\n+    public FieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        this.caseViewFieldBuilder = caseViewFieldBuilder;\n+    }\n+\n+    public JsonNode execute(JsonNode node, CaseField caseField, CaseEventField caseEventField, WizardPageField wizardPageField) {\n+        CaseViewField caseViewField = caseViewFieldBuilder.build(caseField, caseEventField);\n+\n+        if (!BaseType.contains(caseViewField.getFieldType().getType())) {\n+            return node;\n+        }\n+\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());\n+\n+        if (BaseType.get(COMPLEX) == fieldType) {\n+            return executeComplex(node, caseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, caseField.getId());\n+        } else if (BaseType.get(COLLECTION) == fieldType) {\n+            return executeCollection(node, caseViewField, caseField.getId());\n+        } else {\n+            return executeSimple(node, caseViewField, fieldType, caseField.getId());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzI3NTM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo1MDo0MlrOF6B-Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo1MDo0MlrOF6B-Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NDA0Mw==", "bodyText": "To improve code readability it is essential to introduce utility methods to the domain classes whenever possible.\nhasDisplayContextParameterType could be removed. We could introduce a method in DisplayContextParameter class that allows to check the type of a DCP. For example:\ndisplayContextParameter.hasType(DisplayContextParameterType.DATETIMEENTRY)\nThen we could add a method to CommonField that returns the display context parameter as an instance of DisplayContextParameter other than a String.\nIf we do that this will simplify in:\nfield.getDisplayContextParameter.hasType(DisplayContextParameterType.DATETIMEENTRY)\nThis is much more reusable and readable", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396394043", "createdAt": "2020-03-23T11:50:42Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,87 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+\n+@Component\n+public class DateTimeEntryProcessor extends CaseDataFieldProcessor {\n+\n+    private static final List<String> SUPPORTED_TYPES = Arrays.asList(DATETIME, DATE);\n+\n+    private final DateTimeFormatParser dateTimeFormatParser;\n+\n+    @Autowired\n+    public DateTimeEntryProcessor(CaseViewFieldBuilder caseViewFieldBuilder,\n+                                  DateTimeFormatParser dateTimeFormatParser) {\n+        super(caseViewFieldBuilder);\n+        this.dateTimeFormatParser = dateTimeFormatParser;\n+    }\n+\n+    @Override\n+    protected JsonNode executeSimple(JsonNode node, CommonField field, BaseType baseType, String fieldPath) {\n+        return !isNullOrEmpty(node)\n+            && hasDisplayContextParameterType(field.getDisplayContextParameter(), DisplayContextParameterType.DATETIMEENTRY)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzUwMTgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo1ODoyNlrOF6ENXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo1ODoyNlrOF6ENXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQzMDY4NA==", "bodyText": "getDisplayContextParameterOfType(displayContextParameter, DisplayContextParameterType.DATETIMEENTRY)\nI think the code would be simpler if CommonField had the diplay context parameter already converted into a list of DisplayContextParameter rather than a raw String. Same as it has a List<AccessControlList>.\nIf that was the case, then CommonField could have a method getDisplayContextParameterOfType(DisplayContextParameterType.DATETIMEENTRY)", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396430684", "createdAt": "2020-03-23T12:58:26Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,87 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+\n+@Component\n+public class DateTimeEntryProcessor extends CaseDataFieldProcessor {\n+\n+    private static final List<String> SUPPORTED_TYPES = Arrays.asList(DATETIME, DATE);\n+\n+    private final DateTimeFormatParser dateTimeFormatParser;\n+\n+    @Autowired\n+    public DateTimeEntryProcessor(CaseViewFieldBuilder caseViewFieldBuilder,\n+                                  DateTimeFormatParser dateTimeFormatParser) {\n+        super(caseViewFieldBuilder);\n+        this.dateTimeFormatParser = dateTimeFormatParser;\n+    }\n+\n+    @Override\n+    protected JsonNode executeSimple(JsonNode node, CommonField field, BaseType baseType, String fieldPath) {\n+        return !isNullOrEmpty(node)\n+            && hasDisplayContextParameterType(field.getDisplayContextParameter(), DisplayContextParameterType.DATETIMEENTRY)\n+            && isSupportedBaseType(baseType, SUPPORTED_TYPES) ?\n+            createNode(field.getDisplayContextParameter(), node.asText(), baseType, fieldPath) :\n+            node;\n+    }\n+\n+    @Override\n+    protected JsonNode executeCollection(JsonNode collectionNode, CommonField caseViewField, String fieldPath) {\n+        final BaseType collectionFieldType = BaseType.get(caseViewField.getFieldType().getCollectionFieldType().getType());\n+\n+        if (hasDisplayContextParameterType(caseViewField.getDisplayContextParameter(), DisplayContextParameterType.DATETIMEENTRY)\n+            && isSupportedBaseType(collectionFieldType, SUPPORTED_TYPES)) {\n+            ArrayNode newNode = MAPPER.createArrayNode();\n+            collectionNode.forEach(item -> {\n+                JsonNode newItem = item.deepCopy();\n+                ((ObjectNode)newItem).replace(CollectionValidator.VALUE,\n+                    createNode(caseViewField.getDisplayContextParameter(), item.get(CollectionValidator.VALUE).asText(), collectionFieldType, fieldPath));\n+                newNode.add(newItem);\n+            });\n+\n+            return newNode;\n+        }\n+\n+        return collectionNode;\n+    }\n+\n+    private TextNode createNode(String displayContextParameter, String valueToConvert, BaseType baseType, String fieldPath) {\n+        String format = getDisplayContextParameterOfType(displayContextParameter, DisplayContextParameterType.DATETIMEENTRY)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzU2NDMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzoxNTowN1rOF6E0Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMzoxNTowN1rOF6E0Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ0MDY2Mg==", "bodyText": "If I'm not wrong here we are failing the case update operation if the date field is not in the format specified in the DisplayContextParameter. This won't be an issue with the UI because it's going to send us the date fields in the correct format.\nBut what about Services that are invoking the update event programmatically? They will still be passing unformatted date fields probably (in ISO8601 format)? will those calls throw exception?\nIn case the date is already in ISO8601 format, does the dateTimeFormatParser.convertDateTimeToIso8601 throws exception?\nWe should allow date fields that are already in ISO8601 format rather than throwing exception. Can you make sure we have an integration test for this please.\nWe need to speak with BAs to understand the behaviour in this situation and state it clearly in the ticket for future reference", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396440662", "createdAt": "2020-03-23T13:15:07Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeEntryProcessor.java", "diffHunk": "@@ -0,0 +1,87 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+import uk.gov.hmcts.ccd.domain.types.CollectionValidator;\n+import uk.gov.hmcts.ccd.endpoint.exceptions.DataProcessingException;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+import static uk.gov.hmcts.ccd.domain.service.processor.DisplayContextParameter.*;\n+\n+@Component\n+public class DateTimeEntryProcessor extends CaseDataFieldProcessor {\n+\n+    private static final List<String> SUPPORTED_TYPES = Arrays.asList(DATETIME, DATE);\n+\n+    private final DateTimeFormatParser dateTimeFormatParser;\n+\n+    @Autowired\n+    public DateTimeEntryProcessor(CaseViewFieldBuilder caseViewFieldBuilder,\n+                                  DateTimeFormatParser dateTimeFormatParser) {\n+        super(caseViewFieldBuilder);\n+        this.dateTimeFormatParser = dateTimeFormatParser;\n+    }\n+\n+    @Override\n+    protected JsonNode executeSimple(JsonNode node, CommonField field, BaseType baseType, String fieldPath) {\n+        return !isNullOrEmpty(node)\n+            && hasDisplayContextParameterType(field.getDisplayContextParameter(), DisplayContextParameterType.DATETIMEENTRY)\n+            && isSupportedBaseType(baseType, SUPPORTED_TYPES) ?\n+            createNode(field.getDisplayContextParameter(), node.asText(), baseType, fieldPath) :\n+            node;\n+    }\n+\n+    @Override\n+    protected JsonNode executeCollection(JsonNode collectionNode, CommonField caseViewField, String fieldPath) {\n+        final BaseType collectionFieldType = BaseType.get(caseViewField.getFieldType().getCollectionFieldType().getType());\n+\n+        if (hasDisplayContextParameterType(caseViewField.getDisplayContextParameter(), DisplayContextParameterType.DATETIMEENTRY)\n+            && isSupportedBaseType(collectionFieldType, SUPPORTED_TYPES)) {\n+            ArrayNode newNode = MAPPER.createArrayNode();\n+            collectionNode.forEach(item -> {\n+                JsonNode newItem = item.deepCopy();\n+                ((ObjectNode)newItem).replace(CollectionValidator.VALUE,\n+                    createNode(caseViewField.getDisplayContextParameter(), item.get(CollectionValidator.VALUE).asText(), collectionFieldType, fieldPath));\n+                newNode.add(newItem);\n+            });\n+\n+            return newNode;\n+        }\n+\n+        return collectionNode;\n+    }\n+\n+    private TextNode createNode(String displayContextParameter, String valueToConvert, BaseType baseType, String fieldPath) {\n+        String format = getDisplayContextParameterOfType(displayContextParameter, DisplayContextParameterType.DATETIMEENTRY)\n+            .map(DisplayContextParameter::getValue)\n+            .orElseThrow(() -> new DataProcessingException().withDetails(\n+                String.format(\"Unable to obtain datetime format for field %s with display context parameter %s\",\n+                    fieldPath,\n+                    displayContextParameter)\n+            ));\n+        try {\n+            if (baseType == BaseType.get(DATETIME)) {\n+                return new TextNode(dateTimeFormatParser.convertDateTimeToIso8601(format, valueToConvert));\n+            } else {\n+                return new TextNode(dateTimeFormatParser.convertDateToIso8601(format, valueToConvert));\n+            }\n+        } catch (Exception e) {\n+            throw new DataProcessingException().withDetails(\n+                String.format(\"Unable to process field %s with value %s. Expected format: %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDkwNTkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODozOTowNVrOF6lxxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODozOTowNVrOF6lxxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4MDY3Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (complexFieldType == BaseType.get(COLLECTION)) {\n          \n          \n            \n                       complexCaseField.isCollectionFieldType()", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396980676", "createdAt": "2020-03-24T08:39:05Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseEventField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseField;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+\n+public abstract class FieldProcessor {\n+\n+    protected static final ObjectMapper MAPPER = new ObjectMapper();\n+    protected static final String FIELD_SEPARATOR = \".\";\n+\n+    private final CaseViewFieldBuilder caseViewFieldBuilder;\n+\n+    public FieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        this.caseViewFieldBuilder = caseViewFieldBuilder;\n+    }\n+\n+    public JsonNode execute(JsonNode node, CaseField caseField, CaseEventField caseEventField, WizardPageField wizardPageField) {\n+        CaseViewField caseViewField = caseViewFieldBuilder.build(caseField, caseEventField);\n+\n+        if (!BaseType.contains(caseViewField.getFieldType().getType())) {\n+            return node;\n+        }\n+\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());\n+\n+        if (BaseType.get(COMPLEX) == fieldType) {\n+            return executeComplex(node, caseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, caseField.getId());\n+        } else if (BaseType.get(COLLECTION) == fieldType) {\n+            return executeCollection(node, caseViewField, caseField.getId());\n+        } else {\n+            return executeSimple(node, caseViewField, fieldType, caseField.getId());\n+        }\n+    }\n+\n+    private JsonNode executeComplex(JsonNode complexNode,\n+                                      List<CaseField> complexCaseFields,\n+                                      CaseEventField caseEventField,\n+                                      WizardPageField wizardPageField,\n+                                      String fieldPrefix) {\n+        if (complexNode == null) {\n+            return null;\n+        }\n+        ObjectNode newNode = MAPPER.createObjectNode();\n+        complexCaseFields.stream().forEach(complexCaseField -> {\n+            final BaseType complexFieldType = BaseType.get(complexCaseField.getFieldType().getType());\n+            final String fieldId = complexCaseField.getId();\n+            final JsonNode caseFieldNode = complexNode.get(fieldId);\n+            final String fieldPath = fieldPrefix + FIELD_SEPARATOR + fieldId;\n+\n+            if (complexFieldType == BaseType.get(COLLECTION)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDkwODkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0MDowM1rOF6lztA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0MDowM1rOF6lztA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4MTE3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        } else if (complexFieldType == BaseType.get(COMPLEX)) {\n          \n          \n            \n                        } else if (complexCaseField.isComplexFieldType()) {", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396981172", "createdAt": "2020-03-24T08:40:03Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseEventField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseField;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+\n+public abstract class FieldProcessor {\n+\n+    protected static final ObjectMapper MAPPER = new ObjectMapper();\n+    protected static final String FIELD_SEPARATOR = \".\";\n+\n+    private final CaseViewFieldBuilder caseViewFieldBuilder;\n+\n+    public FieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        this.caseViewFieldBuilder = caseViewFieldBuilder;\n+    }\n+\n+    public JsonNode execute(JsonNode node, CaseField caseField, CaseEventField caseEventField, WizardPageField wizardPageField) {\n+        CaseViewField caseViewField = caseViewFieldBuilder.build(caseField, caseEventField);\n+\n+        if (!BaseType.contains(caseViewField.getFieldType().getType())) {\n+            return node;\n+        }\n+\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());\n+\n+        if (BaseType.get(COMPLEX) == fieldType) {\n+            return executeComplex(node, caseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, caseField.getId());\n+        } else if (BaseType.get(COLLECTION) == fieldType) {\n+            return executeCollection(node, caseViewField, caseField.getId());\n+        } else {\n+            return executeSimple(node, caseViewField, fieldType, caseField.getId());\n+        }\n+    }\n+\n+    private JsonNode executeComplex(JsonNode complexNode,\n+                                      List<CaseField> complexCaseFields,\n+                                      CaseEventField caseEventField,\n+                                      WizardPageField wizardPageField,\n+                                      String fieldPrefix) {\n+        if (complexNode == null) {\n+            return null;\n+        }\n+        ObjectNode newNode = MAPPER.createObjectNode();\n+        complexCaseFields.stream().forEach(complexCaseField -> {\n+            final BaseType complexFieldType = BaseType.get(complexCaseField.getFieldType().getType());\n+            final String fieldId = complexCaseField.getId();\n+            final JsonNode caseFieldNode = complexNode.get(fieldId);\n+            final String fieldPath = fieldPrefix + FIELD_SEPARATOR + fieldId;\n+\n+            if (complexFieldType == BaseType.get(COLLECTION)) {\n+                newNode.set(fieldId, executeCollection(caseFieldNode, complexCaseField, fieldPath));\n+            } else if (complexFieldType == BaseType.get(COMPLEX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDkyNjY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0NToyMVrOF6l-_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0NToyMVrOF6l-_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4NDA2Mg==", "bodyText": "minor: building a field's path it's common logic that could be encapsulated in a common class or utility method. If we don't have something we can reuse already", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396984062", "createdAt": "2020-03-24T08:45:21Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseEventField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseField;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+\n+public abstract class FieldProcessor {\n+\n+    protected static final ObjectMapper MAPPER = new ObjectMapper();\n+    protected static final String FIELD_SEPARATOR = \".\";\n+\n+    private final CaseViewFieldBuilder caseViewFieldBuilder;\n+\n+    public FieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        this.caseViewFieldBuilder = caseViewFieldBuilder;\n+    }\n+\n+    public JsonNode execute(JsonNode node, CaseField caseField, CaseEventField caseEventField, WizardPageField wizardPageField) {\n+        CaseViewField caseViewField = caseViewFieldBuilder.build(caseField, caseEventField);\n+\n+        if (!BaseType.contains(caseViewField.getFieldType().getType())) {\n+            return node;\n+        }\n+\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());\n+\n+        if (BaseType.get(COMPLEX) == fieldType) {\n+            return executeComplex(node, caseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, caseField.getId());\n+        } else if (BaseType.get(COLLECTION) == fieldType) {\n+            return executeCollection(node, caseViewField, caseField.getId());\n+        } else {\n+            return executeSimple(node, caseViewField, fieldType, caseField.getId());\n+        }\n+    }\n+\n+    private JsonNode executeComplex(JsonNode complexNode,\n+                                      List<CaseField> complexCaseFields,\n+                                      CaseEventField caseEventField,\n+                                      WizardPageField wizardPageField,\n+                                      String fieldPrefix) {\n+        if (complexNode == null) {\n+            return null;\n+        }\n+        ObjectNode newNode = MAPPER.createObjectNode();\n+        complexCaseFields.stream().forEach(complexCaseField -> {\n+            final BaseType complexFieldType = BaseType.get(complexCaseField.getFieldType().getType());\n+            final String fieldId = complexCaseField.getId();\n+            final JsonNode caseFieldNode = complexNode.get(fieldId);\n+            final String fieldPath = fieldPrefix + FIELD_SEPARATOR + fieldId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDk2MDk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo1NDo1N1rOF6mVGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo1NDo1N1rOF6mVGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4OTcyMg==", "bodyText": "I wouldn't bother wrapping a null with an optional just so I can call ifPresent. Either you have the method you are calling return itself an Optional, or just do a null check:\nJsonNode jsonNode = executeComplex(.....);\n if (jsonNode != null) {\n       newNode.set(fieldId, jsonNode);\n}\n\nPlease see: https://stackoverflow.com/questions/53197393/wrap-object-in-optional-to-use-ifpresent-method\nCan you correct this everywhere it has been introduced please?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r396989722", "createdAt": "2020-03-24T08:54:57Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/FieldProcessor.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewField;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CaseViewFieldBuilder;\n+import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseEventField;\n+import uk.gov.hmcts.ccd.domain.model.definition.CaseField;\n+import uk.gov.hmcts.ccd.domain.model.definition.WizardPageField;\n+import uk.gov.hmcts.ccd.domain.types.BaseType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static uk.gov.hmcts.ccd.domain.model.definition.FieldType.*;\n+\n+public abstract class FieldProcessor {\n+\n+    protected static final ObjectMapper MAPPER = new ObjectMapper();\n+    protected static final String FIELD_SEPARATOR = \".\";\n+\n+    private final CaseViewFieldBuilder caseViewFieldBuilder;\n+\n+    public FieldProcessor(CaseViewFieldBuilder caseViewFieldBuilder) {\n+        this.caseViewFieldBuilder = caseViewFieldBuilder;\n+    }\n+\n+    public JsonNode execute(JsonNode node, CaseField caseField, CaseEventField caseEventField, WizardPageField wizardPageField) {\n+        CaseViewField caseViewField = caseViewFieldBuilder.build(caseField, caseEventField);\n+\n+        if (!BaseType.contains(caseViewField.getFieldType().getType())) {\n+            return node;\n+        }\n+\n+        final BaseType fieldType = BaseType.get(caseViewField.getFieldType().getType());\n+\n+        if (BaseType.get(COMPLEX) == fieldType) {\n+            return executeComplex(node, caseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, caseField.getId());\n+        } else if (BaseType.get(COLLECTION) == fieldType) {\n+            return executeCollection(node, caseViewField, caseField.getId());\n+        } else {\n+            return executeSimple(node, caseViewField, fieldType, caseField.getId());\n+        }\n+    }\n+\n+    private JsonNode executeComplex(JsonNode complexNode,\n+                                      List<CaseField> complexCaseFields,\n+                                      CaseEventField caseEventField,\n+                                      WizardPageField wizardPageField,\n+                                      String fieldPrefix) {\n+        if (complexNode == null) {\n+            return null;\n+        }\n+        ObjectNode newNode = MAPPER.createObjectNode();\n+        complexCaseFields.stream().forEach(complexCaseField -> {\n+            final BaseType complexFieldType = BaseType.get(complexCaseField.getFieldType().getType());\n+            final String fieldId = complexCaseField.getId();\n+            final JsonNode caseFieldNode = complexNode.get(fieldId);\n+            final String fieldPath = fieldPrefix + FIELD_SEPARATOR + fieldId;\n+\n+            if (complexFieldType == BaseType.get(COLLECTION)) {\n+                newNode.set(fieldId, executeCollection(caseFieldNode, complexCaseField, fieldPath));\n+            } else if (complexFieldType == BaseType.get(COMPLEX)) {\n+                Optional.ofNullable(\n+                    executeComplex(caseFieldNode, complexCaseField.getFieldType().getComplexFields(), caseEventField, wizardPageField, fieldPath))\n+                    .ifPresent(result -> newNode.set(fieldId, result));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTIwMTAzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParser.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTo1NzowMVrOF6otOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTo1NzowMVrOF6otOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAyODY2Nw==", "bodyText": "maybe better move this into a processor.date package?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397028667", "createdAt": "2020-03-24T09:57:01Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DateTimeFormatParser.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTI5NzUyOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDoyMjo1OVrOF6pq4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDoyMjo1OVrOF6pq4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA0NDQ1MA==", "bodyText": "DisplayContextParameter it's a core domain concept that should be outside the processor package", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397044450", "createdAt": "2020-03-24T10:22:59Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameter.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTM2NjM0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0MToyMlrOF6qWAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0MToyMlrOF6qWAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NTQ5MQ==", "bodyText": "Optional.empty should be used to model missing values, not incorrect or unknown values as we are doing here", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397055491", "createdAt": "2020-03-24T10:41:22Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.google.common.base.Strings;\n+\n+import java.util.*;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+public enum DisplayContextParameterType {\n+    DATETIMEENTRY,\n+    DATETIMEDISPLAY,\n+    TABLE,\n+    LIST;\n+\n+    private static final Pattern PATTERN = Pattern.compile(\"#(.+)\\\\((.+)\\\\)\");\n+    private static final int TYPE_GROUP = 1;\n+    private static final int VALUE_GROUP = 2;\n+\n+    public static Optional<DisplayContextParameterType> getParameterTypeFor(String displayContextParameter) {\n+        Matcher m = PATTERN.matcher(displayContextParameter);\n+        if (m.matches()) {\n+            try {\n+                return Optional.of(valueOf(m.group(TYPE_GROUP)));\n+            } catch (IllegalArgumentException e) {\n+                return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTM2NzI0OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0MTozNlrOF6qWiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0MTozNlrOF6qWiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NTYyNA==", "bodyText": "Optional.empty should be used to model missing values, not incorrect or unknown values as we are doing here", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397055624", "createdAt": "2020-03-24T10:41:36Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.google.common.base.Strings;\n+\n+import java.util.*;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+public enum DisplayContextParameterType {\n+    DATETIMEENTRY,\n+    DATETIMEDISPLAY,\n+    TABLE,\n+    LIST;\n+\n+    private static final Pattern PATTERN = Pattern.compile(\"#(.+)\\\\((.+)\\\\)\");\n+    private static final int TYPE_GROUP = 1;\n+    private static final int VALUE_GROUP = 2;\n+\n+    public static Optional<DisplayContextParameterType> getParameterTypeFor(String displayContextParameter) {\n+        Matcher m = PATTERN.matcher(displayContextParameter);\n+        if (m.matches()) {\n+            try {\n+                return Optional.of(valueOf(m.group(TYPE_GROUP)));\n+            } catch (IllegalArgumentException e) {\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTM3MTIyOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0Mjo1MFrOF6qZHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0Mjo1MFrOF6qZHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NjI4Ng==", "bodyText": "Optional.empty should be used to model missing values, not incorrect or unknown values as we are doing here", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397056286", "createdAt": "2020-03-24T10:42:50Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.google.common.base.Strings;\n+\n+import java.util.*;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+public enum DisplayContextParameterType {\n+    DATETIMEENTRY,\n+    DATETIMEDISPLAY,\n+    TABLE,\n+    LIST;\n+\n+    private static final Pattern PATTERN = Pattern.compile(\"#(.+)\\\\((.+)\\\\)\");\n+    private static final int TYPE_GROUP = 1;\n+    private static final int VALUE_GROUP = 2;\n+\n+    public static Optional<DisplayContextParameterType> getParameterTypeFor(String displayContextParameter) {\n+        Matcher m = PATTERN.matcher(displayContextParameter);\n+        if (m.matches()) {\n+            try {\n+                return Optional.of(valueOf(m.group(TYPE_GROUP)));\n+            } catch (IllegalArgumentException e) {\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    public static Optional<String> getParameterValueFor(String displayContextParameter) {\n+        Matcher m = PATTERN.matcher(displayContextParameter);\n+        if (m.matches() && !Strings.isNullOrEmpty(m.group(VALUE_GROUP))) {\n+            return Optional.of(m.group(VALUE_GROUP));\n+        }\n+        return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTM3NzU4OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0NDozMFrOF6qdEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDo0NDozMFrOF6qdEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1NzI5Ng==", "bodyText": "is the null check required here? if value group of the pattern (.+) is matching that means there is at least on char right?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397057296", "createdAt": "2020-03-24T10:44:30Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/processor/DisplayContextParameterType.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package uk.gov.hmcts.ccd.domain.service.processor;\n+\n+import com.google.common.base.Strings;\n+\n+import java.util.*;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+public enum DisplayContextParameterType {\n+    DATETIMEENTRY,\n+    DATETIMEDISPLAY,\n+    TABLE,\n+    LIST;\n+\n+    private static final Pattern PATTERN = Pattern.compile(\"#(.+)\\\\((.+)\\\\)\");\n+    private static final int TYPE_GROUP = 1;\n+    private static final int VALUE_GROUP = 2;\n+\n+    public static Optional<DisplayContextParameterType> getParameterTypeFor(String displayContextParameter) {\n+        Matcher m = PATTERN.matcher(displayContextParameter);\n+        if (m.matches()) {\n+            try {\n+                return Optional.of(valueOf(m.group(TYPE_GROUP)));\n+            } catch (IllegalArgumentException e) {\n+                return Optional.empty();\n+            }\n+        }\n+        return Optional.empty();\n+    }\n+\n+    public static Optional<String> getParameterValueFor(String displayContextParameter) {\n+        Matcher m = PATTERN.matcher(displayContextParameter);\n+        if (m.matches() && !Strings.isNullOrEmpty(m.group(VALUE_GROUP))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTY1OTA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/validate/DefaultValidateCaseFieldsOperation.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjowNjo1OVrOF6tN_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjowNjo1OVrOF6tN_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwMjU4OA==", "bodyText": "I'm a bit puzzled by this choice. Wouldn't it be more consistent with the current design if we had enhanced the DateTimeValidator and DateValidator to do the validation of the formatted date. And if successful then do the conversion?\nInstead we are converting to the internal unformatted date before doing the validation", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397102588", "createdAt": "2020-03-24T12:06:59Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/validate/DefaultValidateCaseFieldsOperation.java", "diffHunk": "@@ -11,33 +11,38 @@\n import uk.gov.hmcts.ccd.domain.model.definition.CaseType;\n import uk.gov.hmcts.ccd.domain.model.std.CaseDataContent;\n import uk.gov.hmcts.ccd.domain.service.common.CaseTypeService;\n+import uk.gov.hmcts.ccd.domain.service.processor.FieldProcessorService;\n import uk.gov.hmcts.ccd.endpoint.exceptions.ValidationException;\n \n @Service\n public class DefaultValidateCaseFieldsOperation implements ValidateCaseFieldsOperation {\n \n     private final CaseDefinitionRepository caseDefinitionRepository;\n     private final CaseTypeService caseTypeService;\n+    private final FieldProcessorService fieldProcessorService;\n \n     @Inject DefaultValidateCaseFieldsOperation(\n         @Qualifier(CachedCaseDefinitionRepository.QUALIFIER) final CaseDefinitionRepository caseDefinitionRepository,\n-        final CaseTypeService caseTypeService) {\n+        final CaseTypeService caseTypeService,\n+        final FieldProcessorService fieldProcessorService) {\n         this.caseDefinitionRepository = caseDefinitionRepository;\n         this.caseTypeService = caseTypeService;\n+        this.fieldProcessorService = fieldProcessorService;\n     }\n \n     @Override\n     public final Map<String, JsonNode> validateCaseDetails(String caseTypeId, CaseDataContent content) {\n-        if (content == null || content.getEvent().getEventId() == null) {\n+        if (content == null || content.getEvent() == null || content.getEventId() == null) {\n             throw new ValidationException(\"Cannot validate case field because of event is not specified\");\n         }\n         final CaseType caseType = caseDefinitionRepository.getCaseType(caseTypeId);\n         if (caseType == null) {\n-            throw new ValidationException(\"Cannot find case type definition for  \" + caseTypeId);\n+            throw new ValidationException(\"Cannot find case type definition for \" + caseTypeId);\n         }\n         if (!hasEventId(caseType, content.getEventId())) {\n-            throw new ValidationException(\"Cannot validate case field because of event\" + content.getEventId() + \" is not found in case type definition\");\n+            throw new ValidationException(\"Cannot validate case field because of event \" + content.getEventId() + \" is not found in case type definition\");\n         }\n+        content.setData(fieldProcessorService.processData(content.getData(), caseType, content.getEventId()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTY3OTY2OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/exceptions/DataProcessingException.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjoxMzowMVrOF6tbGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjoxMzowMVrOF6tbGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwNTk0Ng==", "bodyText": "why DataProcessing exception should be a subclass of ValidationException? in theory we could have processing errors that have nothing to do with validation", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397105946", "createdAt": "2020-03-24T12:13:01Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/exceptions/DataProcessingException.java", "diffHunk": "@@ -0,0 +1,12 @@\n+package uk.gov.hmcts.ccd.endpoint.exceptions;\n+\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.ResponseStatus;\n+\n+@ResponseStatus(code = HttpStatus.UNPROCESSABLE_ENTITY)\n+public class DataProcessingException extends ValidationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MzAxMjA2OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNzoxNDo0OVrOF66x5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNzoxNTozMlrOF660Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMyNDc3Mg==", "bodyText": "not enough unit testing probably", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397324772", "createdAt": "2020-03-24T17:14:49Z", "author": {"login": "mario-paniccia"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperationTest.java", "diffHunk": "@@ -169,6 +169,33 @@ void shouldThrowValidationException_whenCaseTypeIsNotDefinedForJurisdiction() {\n                      \"Cannot create case because of cti is not defined as case type for jid\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMyNTMyNg==", "bodyText": "and we absolutely must have a good suite of integration tests", "url": "https://github.com/hmcts/ccd-data-store-api/pull/846#discussion_r397325326", "createdAt": "2020-03-24T17:15:32Z", "author": {"login": "mario-paniccia"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/createcase/DefaultCreateCaseOperationTest.java", "diffHunk": "@@ -169,6 +169,33 @@ void shouldThrowValidationException_whenCaseTypeIsNotDefinedForJurisdiction() {\n                      \"Cannot create case because of cti is not defined as case type for jid\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMyNDc3Mg=="}, "originalCommit": {"oid": "ed5bc5d03506d66331469da5ac87a9928cd38036"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3901, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}