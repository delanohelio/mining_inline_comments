{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MDY2OTM2", "number": 1002, "title": "RDM-8788 - Java 11 upgrade", "bodyText": "JIRA link (if applicable)\nhttps://tools.hmcts.net/jira/browse/RDM-8788\nChange description\nUpdate project to Java 11 (including Gradle upgrade)\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[x] No", "createdAt": "2020-07-03T13:45:53Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002", "merged": true, "mergeCommit": {"oid": "6b04ba10a767321a719f349b6e1da94223fe8b54"}, "closed": true, "closedAt": "2020-07-14T09:05:44Z", "author": {"login": "danlysiak"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxRuiFgH2gAyNDQ0MDY2OTM2OmMyNTkwMGZjNTcxZmZmMjQ4NDA5NzgzZWI5OGMyNWE0M2VhNTI4YjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy2OvOAH2gAyNDQ0MDY2OTM2OmYwMGMxNTE2NTgyNTEzNGI2YTAyM2QyYzg5YWMwZTYwMmRjMDk3ZWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c25900fc571fff248409783eb98c25a43ea528b3", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c25900fc571fff248409783eb98c25a43ea528b3", "committedDate": "2020-07-03T11:27:35Z", "message": "RDM-8788 - Java 11 update WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a84093c7e90075fb8a1c7674a34c6517030de71", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/6a84093c7e90075fb8a1c7674a34c6517030de71", "committedDate": "2020-07-03T13:44:34Z", "message": "Update couple of compatibility issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNDI2ODky", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#pullrequestreview-442426892", "createdAt": "2020-07-03T13:51:32Z", "commit": {"oid": "6a84093c7e90075fb8a1c7674a34c6517030de71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMzo1MTozMlrOGsxC4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMzo1MTozMlrOGsxC4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU5NDA4MA==", "bodyText": "Implementation change that will require reviewing. With Java 11-compatible version of Hibernate we can no longer use the old approach of mixing named and positional parameters in the same query. (Note there are a number of tests, especially integration tests, that test this new implementation didn't affect the ultimate behaviour).", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#discussion_r449594080", "createdAt": "2020-07-03T13:51:32Z", "author": {"login": "danlysiak"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SearchQueryFactoryOperation.java", "diffHunk": "@@ -99,16 +98,13 @@ private String addUserCaseStateAccessClause(MetaData metadata, Map<String, Objec\n     }\n \n     private void addParameters(final Query query, List<Criterion> criterion) {\n-\n-        IntStream.range(0, criterion.size())\n-                .forEach(position -> query.setParameter(position, criterion.get(position).getSoughtValue()));\n+        criterion.forEach(criteria -> query.setParameter(criteria.buildParameterId(), criteria.getSoughtValue()));\n     }\n \n     private String toClauses(final List<Criterion> criterion) {\n-        return IntStream.range(0, criterion.size())\n-                .mapToObj(Integer::new)\n-                .map(position -> criterion.get(position).buildClauseString(position, getOperation()))\n-                .collect(Collectors.joining(AND));\n+        return criterion.stream()\n+            .map(criteria -> criteria.buildClauseString(getOperation()))\n+            .collect(Collectors.joining(AND));\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a84093c7e90075fb8a1c7674a34c6517030de71"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNDI4MjUx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#pullrequestreview-442428251", "createdAt": "2020-07-03T13:53:45Z", "commit": {"oid": "6a84093c7e90075fb8a1c7674a34c6517030de71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMzo1Mzo0NVrOGsxG3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMzo1Mzo0NVrOGsxG3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU5NTEwMA==", "bodyText": "TODO in higher env: Check that App Insights still works on latest version, and relying on the HMCTS-provided implementation rather than the jar that was in the repo.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#discussion_r449595100", "createdAt": "2020-07-03T13:53:45Z", "author": {"login": "danlysiak"}, "path": "Dockerfile", "diffHunk": "@@ -1,12 +1,11 @@\n-# Keep hub.Dockerfile aligned to this file as far as possible\n ARG JAVA_OPTS=\"-Djava.security.egd=file:/dev/./urandom\"\n-ARG APP_INSIGHTS_AGENT_VERSION=2.4.1\n+ARG APP_INSIGHTS_AGENT_VERSION=2.5.0\n \n-FROM hmctspublic.azurecr.io/base/java:openjdk-8-distroless-1.0\n+FROM hmctspublic.azurecr.io/base/java:openjdk-11-distroless-1.4\n LABEL maintainer=\"https://github.com/hmcts/ccd-data-store-api\"\n \n COPY build/libs/core-case-data.jar /opt/app/\n-COPY lib/applicationinsights-agent-2.4.1.jar lib/AI-Agent.xml /opt/app/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a84093c7e90075fb8a1c7674a34c6517030de71"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "205305a383308d7e8c158020b7597c356075770d", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/205305a383308d7e8c158020b7597c356075770d", "committedDate": "2020-07-03T13:56:43Z", "message": "CVE-2020-11996"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd57efbbacf2b88c50b3264ccc50cd447786a971", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/cd57efbbacf2b88c50b3264ccc50cd447786a971", "committedDate": "2020-07-03T14:10:29Z", "message": "Minor changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2ca31d88ad4f57d19797faa45f558ec793eac4b", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/d2ca31d88ad4f57d19797faa45f558ec793eac4b", "committedDate": "2020-07-03T14:49:02Z", "message": "Switch Hazelcast back to pre-11 state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5f3c36a67f7124b8771790f836cd689831f9a68", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c5f3c36a67f7124b8771790f836cd689831f9a68", "committedDate": "2020-07-06T09:40:38Z", "message": "RDM-8788 - Cleanup and JVM args for Hazelcast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "236b970ceb1ff2d74d047a00fca6234472d361f2", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/236b970ceb1ff2d74d047a00fca6234472d361f2", "committedDate": "2020-07-07T11:11:15Z", "message": "Revert unrelated changes to Java 11; tidy up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "704a1974fd9fa3550057188dcfcfad7fdc8b4777", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/704a1974fd9fa3550057188dcfcfad7fdc8b4777", "committedDate": "2020-07-07T11:42:30Z", "message": "Minor test fixes for Java 11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abef6c4d77121585a2f7a1b13b577a483c3564ab", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/abef6c4d77121585a2f7a1b13b577a483c3564ab", "committedDate": "2020-07-07T12:04:29Z", "message": "Add jvmArgs for Hazelcast in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "183cece86e4673ee37169e75bb971e39af7a4109", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/183cece86e4673ee37169e75bb971e39af7a4109", "committedDate": "2020-07-07T12:10:08Z", "message": "Tidy up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6e682fc6874e0564c7dbb3bd7da02e3998073ab", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e6e682fc6874e0564c7dbb3bd7da02e3998073ab", "committedDate": "2020-07-07T12:22:00Z", "message": "Fix incorrect syntax"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDY3NjE1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#pullrequestreview-444467615", "createdAt": "2020-07-08T07:10:21Z", "commit": {"oid": "e6e682fc6874e0564c7dbb3bd7da02e3998073ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNzoxMDoyMVrOGua6hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNzoxMDoyMVrOGua6hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMyODY0Ng==", "bodyText": "List<Criterion> criterion --> List<Criterion> criteria\ncriterion.forEach(criteria --> criteria.forEach(criterion", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#discussion_r451328646", "createdAt": "2020-07-08T07:10:21Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SearchQueryFactoryOperation.java", "diffHunk": "@@ -99,16 +98,13 @@ private String addUserCaseStateAccessClause(MetaData metadata, Map<String, Objec\n     }\n \n     private void addParameters(final Query query, List<Criterion> criterion) {\n-\n-        IntStream.range(0, criterion.size())\n-                .forEach(position -> query.setParameter(position, criterion.get(position).getSoughtValue()));\n+        criterion.forEach(criteria -> query.setParameter(criteria.buildParameterId(), criteria.getSoughtValue()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6e682fc6874e0564c7dbb3bd7da02e3998073ab"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDY4MDYx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#pullrequestreview-444468061", "createdAt": "2020-07-08T07:11:05Z", "commit": {"oid": "e6e682fc6874e0564c7dbb3bd7da02e3998073ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNzoxMTowNVrOGua77A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNzoxMTowNVrOGua77A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMyOTAwNA==", "bodyText": "swap use of plural and singular of identifiers.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#discussion_r451329004", "createdAt": "2020-07-08T07:11:05Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SearchQueryFactoryOperation.java", "diffHunk": "@@ -99,16 +98,13 @@ private String addUserCaseStateAccessClause(MetaData metadata, Map<String, Objec\n     }\n \n     private void addParameters(final Query query, List<Criterion> criterion) {\n-\n-        IntStream.range(0, criterion.size())\n-                .forEach(position -> query.setParameter(position, criterion.get(position).getSoughtValue()));\n+        criterion.forEach(criteria -> query.setParameter(criteria.buildParameterId(), criteria.getSoughtValue()));\n     }\n \n     private String toClauses(final List<Criterion> criterion) {\n-        return IntStream.range(0, criterion.size())\n-                .mapToObj(Integer::new)\n-                .map(position -> criterion.get(position).buildClauseString(position, getOperation()))\n-                .collect(Collectors.joining(AND));\n+        return criterion.stream()\n+            .map(criteria -> criteria.buildClauseString(getOperation()))\n+            .collect(Collectors.joining(AND));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6e682fc6874e0564c7dbb3bd7da02e3998073ab"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDY4MjIx", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1002#pullrequestreview-444468221", "createdAt": "2020-07-08T07:11:19Z", "commit": {"oid": "e6e682fc6874e0564c7dbb3bd7da02e3998073ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f00c15165825134b6a023d2c89ac0e602dc097ee", "author": {"user": null}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f00c15165825134b6a023d2c89ac0e602dc097ee", "committedDate": "2020-07-08T08:33:16Z", "message": "Swap variable names for correctness"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2816, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}