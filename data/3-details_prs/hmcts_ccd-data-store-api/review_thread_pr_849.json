{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjUzMzY5", "number": 849, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOTozNjo0MFrODopSjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0NToyM1rODowHQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzOTQ2MTI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOTozNjo0MFrOF3UWMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOTozNjo0MFrOF3UWMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0OTM2MQ==", "bodyText": "just realised that this is not gonna work for case roles. Nothing to do with this PR but raised the following ticket to keep track of this: https://tools.hmcts.net/jira/browse/RDM-7942", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393549361", "createdAt": "2020-03-17T09:36:40Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -80,11 +80,12 @@ private SearchResultViewColumn createSearchResultViewColumn(final SearchResultFi\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = buildCaseFieldId(resultField);\n+        if (addedFields.contains(id)) {\n             return false;\n         } else {\n             if (StringUtils.isEmpty(resultField.getRole()) || userRepository.getUserRoles().contains(resultField.getRole())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDAxMzkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/AuthorisedGetCriteriaOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyMzozNVrOF3Z2_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyMzozNVrOF3Z2_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzOTY3OA==", "bodyText": "consider moving this to a method in the CriteriaInput class itself for future reuse in other places as well. For example getPath or getFullId.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393639678", "createdAt": "2020-03-17T12:23:35Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/AuthorisedGetCriteriaOperation.java", "diffHunk": "@@ -63,15 +63,21 @@ private boolean criteriaAllowedByCRUD(CaseType caseType, CriteriaInput criteriaI\n     }\n \n     private boolean filterDistinctFieldsByRole(final Set<String> addedFields, final CriteriaInput criteriaInput, final Set<String> userRoles) {\n-        if (addedFields.contains(criteriaInput.getField().getId())) {\n+        String id = buildFieldId(criteriaInput);\n+        if (addedFields.contains(id)) {\n             return false;\n         } else {\n             if (StringUtils.isEmpty(criteriaInput.getRole()) || userRoles.contains(criteriaInput.getRole())) {\n-                addedFields.add(criteriaInput.getField().getId());\n+                addedFields.add(id);\n                 return true;\n             } else {\n                 return false;\n             }\n         }\n     }\n+\n+    private String buildFieldId(CriteriaInput criteriaInput) {\n+        return StringUtils.isEmpty(criteriaInput.getField().getElementPath()) ? criteriaInput.getField().getId() :\n+            criteriaInput.getField().getId() + '.' + criteriaInput.getField().getElementPath();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDAxNjUwOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyNDoxOVrOF3Z4iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjoyNDoxOVrOF3Z4iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY0MDA3Mw==", "bodyText": "rather than buildCaseFieldId consider moving this to a method in the SearchResultField class itself for future reuse in other places as well. For example getPath or getFullId.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393640073", "createdAt": "2020-03-17T12:24:19Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -80,11 +80,12 @@ private SearchResultViewColumn createSearchResultViewColumn(final SearchResultFi\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = buildCaseFieldId(resultField);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDU3OTIxOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0NToyM1rOF3fiLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0NToyM1rOF3fiLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMjY1Mw==", "bodyText": "can we have SearchResultField and CriteriaInput use the same method name please?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393732653", "createdAt": "2020-03-17T14:45:23Z", "author": {"login": "mario-paniccia"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -72,34 +72,27 @@ public SearchResultView execute(final CaseType caseType,\n \n     private SearchResultViewColumn createSearchResultViewColumn(final SearchResultField searchResultField, final CaseField caseField) {\n         return new SearchResultViewColumn(\n-            buildCaseFieldId(searchResultField),\n+            searchResultField.buildCaseFieldId(),\n             buildCaseFieldType(searchResultField, caseField),\n             searchResultField.getLabel(),\n             searchResultField.getDisplayOrder(),\n             searchResultField.isMetadata());\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = resultField.buildCaseFieldId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "991da7c0445b3bf418a490225654e9b7465049dd"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3908, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}