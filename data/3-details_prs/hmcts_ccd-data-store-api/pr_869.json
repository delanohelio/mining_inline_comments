{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MjAxNTMy", "number": 869, "title": "RDM-6916 Create indexes for CaseEvent table", "bodyText": "JIRA link (if applicable)\nRDM-6916: \"Create indexes for CaseEvent table to improve query performance\"\nChange description\nCreate indexes for CaseEvent table to improve query performance:\n\nConditional DROP followed by CREATE of idx_case_event_created_date.\nCreate the following new indexes for:\n\ncase_type_id\nevent_id, state_id\n\n\n\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[x] No", "createdAt": "2020-03-26T14:22:36Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/869", "merged": true, "mergeCommit": {"oid": "0df19e5d0ee836f6f945b55d8b7161db19bccf07"}, "closed": true, "closedAt": "2020-07-14T09:10:12Z", "author": {"login": "mattnayler"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRc1INAH2gAyMzk0MjAxNTMyOmU2ZGMwZmFiYzFjYTI5MWI4NDg3MjdiY2E3YTRjZjQzMDMyNjUzY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0yWP_AH2gAyMzk0MjAxNTMyOjI1YTBmODdhYjliNmE1OGJhMTFhZmE0ZTkxZTA1YTNjNThlNWJiMDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6dc0fabc1ca291b848727bca7a4cf43032653cf", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e6dc0fabc1ca291b848727bca7a4cf43032653cf", "committedDate": "2020-03-26T14:18:10Z", "message": "RDM-6916 Create indexes for CaseEvent table\n\n  [RDM-6916] (https://tools.hmcts.net/jira/browse/RDM-6916)\n\nCreate indexes for CaseEvent table to improve query performance:\n* Conditional DROP followed by CREATE of idx_case_event_created_date.\n* Creation new indexes for:\n  * case_type_id\n  * event_id, state_id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTU2Njk1", "url": "https://github.com/hmcts/ccd-data-store-api/pull/869#pullrequestreview-382156695", "createdAt": "2020-03-26T15:59:21Z", "commit": {"oid": "e6dc0fabc1ca291b848727bca7a4cf43032653cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNTo1OToyMlrOF8OC2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNTo1OToyMlrOF8OC2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY4ODk4NA==", "bodyText": "Suggest you use Postgres' CONCURRENTLY modifier when creating these indexes; standard index creation will lock the case_event table for writes until the indexes are built, which could take time since it's a big table. You'd probably need to write a liquibase sql tag, don't think liquibase supports the concurrently flag. https://www.postgresql.org/docs/9.6/sql-createindex.html", "url": "https://github.com/hmcts/ccd-data-store-api/pull/869#discussion_r398688984", "createdAt": "2020-03-26T15:59:22Z", "author": {"login": "banderous"}, "path": "src/main/resources/db/changelog/db.changelog-RDM-6916.xml", "diffHunk": "@@ -0,0 +1,43 @@\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+                   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+                   xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+\n+    <!-- conditional drop to remove index manually created in some environments -->\n+    <changeSet id=\"rdm-6916-drop\" author=\"matt.nayler@hmcts.net\">\n+        <preConditions onFail=\"MARK_RAN\">\n+            <indexExists indexName=\"idx_case_event_created_date\"\n+                   schemaName=\"public\"\n+                   tableName=\"case_event\" />\n+        </preConditions>\n+        <dropIndex indexName=\"idx_case_event_created_date\"\n+                   schemaName=\"public\"\n+                   tableName=\"case_event\" />\n+    </changeSet>\n+\n+\n+    <changeSet id=\"rdm-6916\" author=\"matt.nayler@hmcts.net\">\n+\n+        <createIndex indexName=\"idx_case_event_created_date\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dc0fabc1ca291b848727bca7a4cf43032653cf"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTgyOTA4", "url": "https://github.com/hmcts/ccd-data-store-api/pull/869#pullrequestreview-388982908", "createdAt": "2020-04-07T10:23:41Z", "commit": {"oid": "e6dc0fabc1ca291b848727bca7a4cf43032653cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8c3f420da5d4e99b105ef0a9a656806f13028d9", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e8c3f420da5d4e99b105ef0a9a656806f13028d9", "committedDate": "2020-04-09T13:30:17Z", "message": "RDM-6916 Create indexes for CaseEvent table\n\n  [RDM-6916](https://tools.hmcts.net/jira/browse/RDM-6916)\n\nSwitch build script to use separate SQL statements using IF NOT EXISTS.\n\nCreates new indexes for:\n* created_date\n* case_type_id\n* event_id, state_id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22c9154800c98c141c1ab5e851c194fdb73a4ec3", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/22c9154800c98c141c1ab5e851c194fdb73a4ec3", "committedDate": "2020-04-09T13:37:56Z", "message": "Merge remote-tracking branch 'origin/develop' into RDM-6916"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTc0MTY0", "url": "https://github.com/hmcts/ccd-data-store-api/pull/869#pullrequestreview-393574164", "createdAt": "2020-04-15T08:45:09Z", "commit": {"oid": "22c9154800c98c141c1ab5e851c194fdb73a4ec3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25a0f87ab9b6a58ba11afa4e91e05a3c58e5bb02", "author": {"user": {"login": "hemantt", "name": "Hemanth Potipati"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/25a0f87ab9b6a58ba11afa4e91e05a3c58e5bb02", "committedDate": "2020-07-14T09:09:42Z", "message": "Merge branch 'develop' into RDM-6916"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2653, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}