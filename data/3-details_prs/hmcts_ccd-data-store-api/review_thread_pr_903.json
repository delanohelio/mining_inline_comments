{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNzAzNzU4", "number": 903, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNDoyNTo1NlrOD4EUHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTowNjo0M1rOD5UNvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTE3NTM1OnYy", "diffSide": "RIGHT", "path": "src/aat/java/uk/gov/hmcts/ccd/datastore/befta/DataStoreTestAutomationAdapter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNDoyNTo1NlrOGOryyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwOTozMDoyN1rOGPF0_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA1MDc2MQ==", "bodyText": "uncomment these 2 lines.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/903#discussion_r418050761", "createdAt": "2020-04-30T14:25:56Z", "author": {"login": "aashishaggarwal123"}, "path": "src/aat/java/uk/gov/hmcts/ccd/datastore/befta/DataStoreTestAutomationAdapter.java", "diffHunk": "@@ -2,15 +2,60 @@\n \n import uk.gov.hmcts.befta.DefaultTestAutomationAdapter;\n import uk.gov.hmcts.befta.dse.ccd.TestDataLoaderToDefinitionStore;\n+import uk.gov.hmcts.befta.exception.FunctionalTestException;\n+import uk.gov.hmcts.befta.player.BackEndFunctionalTestScenarioContext;\n+import uk.gov.hmcts.befta.util.EnvironmentVariableUtils;\n+import uk.gov.hmcts.befta.util.ReflectionUtils;\n \n public class DataStoreTestAutomationAdapter extends DefaultTestAutomationAdapter {\n \n     private TestDataLoaderToDefinitionStore loader = new TestDataLoaderToDefinitionStore(this);\n \n     @Override\n     public void doLoadTestData() {\n-        loader.addCcdRoles();\n-        loader.importDefinitions();\n+//        loader.addCcdRoles();\n+//        loader.importDefinitions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87ec1c9a5413629856955fd5f4cca075e5695c53"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ3NzMwOQ==", "bodyText": "done", "url": "https://github.com/hmcts/ccd-data-store-api/pull/903#discussion_r418477309", "createdAt": "2020-05-01T09:30:27Z", "author": {"login": "shrivsksavit"}, "path": "src/aat/java/uk/gov/hmcts/ccd/datastore/befta/DataStoreTestAutomationAdapter.java", "diffHunk": "@@ -2,15 +2,60 @@\n \n import uk.gov.hmcts.befta.DefaultTestAutomationAdapter;\n import uk.gov.hmcts.befta.dse.ccd.TestDataLoaderToDefinitionStore;\n+import uk.gov.hmcts.befta.exception.FunctionalTestException;\n+import uk.gov.hmcts.befta.player.BackEndFunctionalTestScenarioContext;\n+import uk.gov.hmcts.befta.util.EnvironmentVariableUtils;\n+import uk.gov.hmcts.befta.util.ReflectionUtils;\n \n public class DataStoreTestAutomationAdapter extends DefaultTestAutomationAdapter {\n \n     private TestDataLoaderToDefinitionStore loader = new TestDataLoaderToDefinitionStore(this);\n \n     @Override\n     public void doLoadTestData() {\n-        loader.addCcdRoles();\n-        loader.importDefinitions();\n+//        loader.addCcdRoles();\n+//        loader.importDefinitions();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA1MDc2MQ=="}, "originalCommit": {"oid": "87ec1c9a5413629856955fd5f4cca075e5695c53"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwOTc4OTI1OnYy", "diffSide": "RIGHT", "path": "src/aat/java/uk/gov/hmcts/ccd/datastore/befta/DataStoreTestAutomationAdapter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODowODoxM1rOGP2VyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODowODoxM1rOGP2VyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3MjEzNg==", "bodyText": "throw new FunctionalTestException(\"Error extracting the Document Id\", e);", "url": "https://github.com/hmcts/ccd-data-store-api/pull/903#discussion_r419272136", "createdAt": "2020-05-04T08:08:13Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/java/uk/gov/hmcts/ccd/datastore/befta/DataStoreTestAutomationAdapter.java", "diffHunk": "@@ -13,4 +17,45 @@ public void doLoadTestData() {\n         loader.importDefinitions();\n     }\n \n+    @Override\n+    public Object calculateCustomValue(BackEndFunctionalTestScenarioContext scenarioContext, Object key) {\n+        String docAmUrl = EnvironmentVariableUtils.getRequiredVariable(\"CASE_DOCUMENT_AM_URL\");\n+        if (key.equals(\"documentIdInTheResponse\")) {\n+            try {\n+                String href = (String) ReflectionUtils\n+                    .deepGetFieldInObject(scenarioContext,\n+                                          \"testData.actualResponse.body._embedded.documents[0]._links.self.href\");\n+                return href.substring(href.length() - 36);\n+            } catch (Exception exception) {\n+//                logger.error(\"Exception while getting the Document ID from the response :{}\", exception.getMessage());\n+                return \"Error extracting the Document Id\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00edc9a871642632a102eb3205c461250aa9c6b6"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwOTgxNzc2OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-1003/F-1003-V2/F-1003-V2-Base-Root.td.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxNzozM1rOGP2nCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxNzozM1rOGP2nCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NjU1NA==", "bodyText": "why not extend this from a common one from framework?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/903#discussion_r419276554", "createdAt": "2020-05-04T08:17:33Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-1003/F-1003-V2/F-1003-V2-Base-Root.td.json", "diffHunk": "@@ -0,0 +1,71 @@\n+{\n+  \"_guid_\": \"F-1003-V2-Base-Root\",\n+  \"users\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00edc9a871642632a102eb3205c461250aa9c6b6"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwOTgzMzY5OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-1003/F-1003-V3/F-1003-V3.feature", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoyMjozMVrOGP2wmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoyMjozMVrOGP2wmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3OTAwMw==", "bodyText": "bett Default_Document_Upload_Data_01 to Default_Document_Upload_Data_07", "url": "https://github.com/hmcts/ccd-data-store-api/pull/903#discussion_r419279003", "createdAt": "2020-05-04T08:22:31Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-1003/F-1003-V3/F-1003-V3.feature", "diffHunk": "@@ -0,0 +1,106 @@\n+@F-1003-V3 @Ignore\n+Feature: F-1003-V3: Submit Case Creation (V3)\n+\n+  Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+  @S-1030\n+  Scenario: must successfully create a case with new document uploded\n+    Given a user with [an active caseworker profile in CCD with full permissions on a document field],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data],\n+    And   a successful call [to create a token for case creation] as in [Befta_Jurisdiction2_Default_Token_Creation_Data_For_Case_Creation],\n+    When  a request is prepared with appropriate values,\n+    And   the request [is to attach the document uploaded above to a new case],\n+    And   it is submitted to call the [Submit Case Creation (V3)] operation of [CCD Data Store],\n+    Then  a positive response is received,\n+    And   the response [contains necessary details about the document attached to the case],\n+    And   the response has all other details as expected,\n+    And   a call [to retrieve case details by case id] will get the expected response as in [Default_Get_Case_Data_Base].\n+\n+  @S-1031\n+  Scenario: must successfully create a case with multiple documents uploded\n+    Given a user with [an active caseworker profile in CCD with full permissions on a document field],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_01],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_02],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_03],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_04],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_05],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_06],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00edc9a871642632a102eb3205c461250aa9c6b6"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMDI4NDgzOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-1003/F-1003-V3/Default_Document_Upload_Data_01.td.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDo0NToyN1rOGP7Ifg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDo0NToyN1rOGP7Ifg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM1MDY1NA==", "bodyText": "in fact, there could be a nice way of eliminating all these repeated blocks, and have just the below lines:\n  \"_guid_\": \"Default_Document_Upload_Data_01\",\n  \"_extends_\": \"Default_Document_Upload_Data_Base\",\n\nThis is possible, and I can show you how, if you like.\nHint: The file names could be dynamically picked from a custom value with respect to the guid value.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/903#discussion_r419350654", "createdAt": "2020-05-04T10:45:27Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-1003/F-1003-V3/Default_Document_Upload_Data_01.td.json", "diffHunk": "@@ -0,0 +1,29 @@\n+{\n+  \"_guid_\": \"Default_Document_Upload_Data_01\",\n+  \"_extends_\": \"Default_Document_Upload_Data_Base\",\n+  \"specs\": [\n+    \"to upload a document with mandatory metadata\"\n+  ],\n+  \"request\": {\n+    \"body\": {\n+      \"arrayInMap\": [\n+        {\n+          \"key\": \"classification\",\n+          \"value\": \"PUBLIC\"\n+        },\n+        {\n+          \"key\": \"caseTypeId\",\n+          \"value\": \"BEFTA_CASETYPE_2_2\"\n+        },\n+        {\n+          \"key\": \"jurisdictionId\",\n+          \"value\": \"BEFTA_JURISDICTION_2\"\n+        },\n+        {\n+          \"key\": \"files\",\n+          \"filePath\": \"features/common/files/Sample.doc\"\n+        }\n+      ]\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00edc9a871642632a102eb3205c461250aa9c6b6"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDI2NjIxOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-1003/F-1003-V3/F-1003-V3.feature", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTowNjo0M1rOGQgqEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTowNjo0M1rOGQgqEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NTQ1Nw==", "bodyText": "these can also be managed by using only 1 test data file, each time with a different file - I can show if you like.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/903#discussion_r419965457", "createdAt": "2020-05-05T09:06:43Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-1003/F-1003-V3/F-1003-V3.feature", "diffHunk": "@@ -0,0 +1,106 @@\n+@F-1003-V3 @Ignore\n+Feature: F-1003-V3: Submit Case Creation (V3)\n+\n+  Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+  @S-1030\n+  Scenario: must successfully create a case with new document uploded\n+    Given a user with [an active caseworker profile in CCD with full permissions on a document field],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data],\n+    And   a successful call [to create a token for case creation] as in [Befta_Jurisdiction2_Default_Token_Creation_Data_For_Case_Creation],\n+    When  a request is prepared with appropriate values,\n+    And   the request [is to attach the document uploaded above to a new case],\n+    And   it is submitted to call the [Submit Case Creation (V3)] operation of [CCD Data Store],\n+    Then  a positive response is received,\n+    And   the response [contains necessary details about the document attached to the case],\n+    And   the response has all other details as expected,\n+    And   a call [to retrieve case details by case id] will get the expected response as in [Default_Get_Case_Data_Base].\n+\n+  @S-1031\n+  Scenario: must successfully create a case with multiple documents uploded\n+    Given a user with [an active caseworker profile in CCD with full permissions on a document field],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_01],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_02],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_03],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_04],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_05],\n+    And   a successful call [to upload a document with mandatory metadata] as in [Default_Document_Upload_Data_06],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "620a3f36f7ed0b70becc0c48f85a84cfbfc96bab"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3810, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}