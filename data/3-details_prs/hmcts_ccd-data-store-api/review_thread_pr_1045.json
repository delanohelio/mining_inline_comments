{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzkxNzU4", "number": 1045, "reviewThreads": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwODowODoyM1rOEY8OBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo0ODoxMVrOEZE_lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NTg3OTEwOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1.td.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwODowODoyM1rOHBejuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwODowOTozN1rOHBemVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMxMTI4OA==", "bodyText": "That block there is actually needed here:\nhttps://github.com/hmcts/ccd-data-store-api/pull/1045/files#diff-7471b113100f3aaca0e72f80170d2ee8R23-R26", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471311288", "createdAt": "2020-08-17T08:08:23Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1.td.json", "diffHunk": "@@ -0,0 +1,44 @@\n+{\n+  \"title\": \"Must successfully assign a user and case role for a specific case by a user calling through/from an authorised application\",\n+\n+  \"_guid_\": \"S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation\",\n+  \"_extends_\": \"F-111_Add_Case_Assigned_User_Roles_Base\",\n+\n+  \"specs\": [\n+    \"by Dil, within the context of his organisation, to add a Case Role - CR1 on C1 for Olawale and Hemanth\"\n+  ],\n+\n+  \"users\": {\n+    \"_extends_\": \"F-111_Users\"\n+  },\n+\n+  \"prerequisites\": [\n+    \"F-111_Prerequisite_Counter_Check_Call\"\n+  ],\n+\n+  \"request\": {\n+    \"headers\": {\n+      \"Authorization\": \"Bearer ${[scenarioContext][testData][users][userDil][accessToken]}\"\n+    },\n+    \"body\": {\n+      \"case_users\": [\n+        {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMxMTk1OA==", "bodyText": "Sorry - this is the request payload - just ignore this comment.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471311958", "createdAt": "2020-08-17T08:09:37Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1.td.json", "diffHunk": "@@ -0,0 +1,44 @@\n+{\n+  \"title\": \"Must successfully assign a user and case role for a specific case by a user calling through/from an authorised application\",\n+\n+  \"_guid_\": \"S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation\",\n+  \"_extends_\": \"F-111_Add_Case_Assigned_User_Roles_Base\",\n+\n+  \"specs\": [\n+    \"by Dil, within the context of his organisation, to add a Case Role - CR1 on C1 for Olawale and Hemanth\"\n+  ],\n+\n+  \"users\": {\n+    \"_extends_\": \"F-111_Users\"\n+  },\n+\n+  \"prerequisites\": [\n+    \"F-111_Prerequisite_Counter_Check_Call\"\n+  ],\n+\n+  \"request\": {\n+    \"headers\": {\n+      \"Authorization\": \"Bearer ${[scenarioContext][testData][users][userDil][accessToken]}\"\n+    },\n+    \"body\": {\n+      \"case_users\": [\n+        {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMxMTI4OA=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjUzMDAzOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToxNTo0NlrOHBkjug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMzo0MTo0N1rOHBpQcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwOTU5NA==", "bodyText": "One or both of these functions should to be renamed as :\n\nfilterUnknownCauRoles : is filtering OUT unknown CaseRoles: i.e. returns a list EXCLUDING the unknown\nfilterExistingCauRoles: is filtering ON existing CaseRoles: i.e. returns a list containing ONLY pre-existing CaseRoles", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471409594", "createdAt": "2020-08-17T11:15:46Z", "author": {"login": "mattnayler"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -106,11 +108,74 @@ public void addCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUser\n \n         newUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n             orgNewUserCountMap.forEach((organisationId, newUserCount) ->\n-                supplementaryDataRepository.incrementSupplementaryData(caseReference, \"orgs_assigned_users.\" + organisationId, newUserCount)\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference, ORGS_ASSIGNED_USERS_PAH + organisationId, newUserCount)\n             )\n         );\n     }\n \n+    @Transactional\n+    public void removeCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        // Ignore case user role mappings that are NOT exist in the database silently. Also they shouldn't effect counters.\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filteredCauRolesByCaseId = filterUnknownCauRoles(cauRolesByCaseId);\n+\n+        filteredCauRolesByCaseId.forEach((caseId, requestedAssignments) ->\n+            requestedAssignments.forEach(requestedAssignment ->\n+                caseUserRepository.revokeAccess(caseId, requestedAssignment.getUserId(), requestedAssignment.getCaseRole())\n+            )\n+        );\n+\n+        // determine counters after removal of requested mappings so that same function can be re-used (i.e user still has an association to a case).\n+        Map<String, Map<String, Long>> removeUserCounts = getUserCountByCaseAndOrganisation(filteredCauRolesByCaseId);\n+\n+        removeUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n+            orgNewUserCountMap.forEach((organisationId, removeUserCount) ->\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference,\n+                    ORGS_ASSIGNED_USERS_PAH + organisationId, Math.negateExact(removeUserCount))\n+            )\n+        );\n+    }\n+\n+    private Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filterUnknownCauRoles(\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+\n+        List<Long> caseIds = new ArrayList<>(cauRolesByCaseId.keySet());\n+        List<String> userIds = getUserIds(cauRolesByCaseId);\n+\n+        // find existing Case-User relationships for all the cases + users found\n+        Map<Long, List<CaseUserEntity>> existingCaseUserRolesByCaseId =\n+            caseUserRepository.findCaseUserRoles(caseIds, userIds).stream()\n+                .collect(Collectors.groupingBy(\n+                    caseUserEntity -> caseUserEntity.getCasePrimaryKey().getCaseDataId(),\n+                    Collectors.toList()\n+                ));\n+\n+        return cauRolesByCaseId.entrySet().stream()\n+            .collect(Collectors.toMap(Map.Entry::getKey,\n+                entry -> filterExistingCauRoles(entry.getValue(), existingCaseUserRolesByCaseId.getOrDefault(entry.getKey(), new ArrayList<>()))));\n+    }\n+\n+    private List<CaseAssignedUserRoleWithOrganisation> filterExistingCauRoles(\n+        List<CaseAssignedUserRoleWithOrganisation> inputCauRoles,\n+        List<CaseUserEntity> existingCauRoles) {\n+        return inputCauRoles.stream()\n+            .filter(cauRole -> existingCauRoles.stream()\n+                .anyMatch(entity -> entity.getCasePrimaryKey().getCaseRole().equalsIgnoreCase(cauRole.getCaseRole())\n+                    && entity.getCasePrimaryKey().getUserId().equalsIgnoreCase(cauRole.getUserId())))\n+            .collect(Collectors.toList());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NjU3OQ==", "bodyText": "done", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471486579", "createdAt": "2020-08-17T13:41:47Z", "author": {"login": "smathangi"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -106,11 +108,74 @@ public void addCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUser\n \n         newUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n             orgNewUserCountMap.forEach((organisationId, newUserCount) ->\n-                supplementaryDataRepository.incrementSupplementaryData(caseReference, \"orgs_assigned_users.\" + organisationId, newUserCount)\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference, ORGS_ASSIGNED_USERS_PAH + organisationId, newUserCount)\n             )\n         );\n     }\n \n+    @Transactional\n+    public void removeCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        // Ignore case user role mappings that are NOT exist in the database silently. Also they shouldn't effect counters.\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filteredCauRolesByCaseId = filterUnknownCauRoles(cauRolesByCaseId);\n+\n+        filteredCauRolesByCaseId.forEach((caseId, requestedAssignments) ->\n+            requestedAssignments.forEach(requestedAssignment ->\n+                caseUserRepository.revokeAccess(caseId, requestedAssignment.getUserId(), requestedAssignment.getCaseRole())\n+            )\n+        );\n+\n+        // determine counters after removal of requested mappings so that same function can be re-used (i.e user still has an association to a case).\n+        Map<String, Map<String, Long>> removeUserCounts = getUserCountByCaseAndOrganisation(filteredCauRolesByCaseId);\n+\n+        removeUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n+            orgNewUserCountMap.forEach((organisationId, removeUserCount) ->\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference,\n+                    ORGS_ASSIGNED_USERS_PAH + organisationId, Math.negateExact(removeUserCount))\n+            )\n+        );\n+    }\n+\n+    private Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filterUnknownCauRoles(\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+\n+        List<Long> caseIds = new ArrayList<>(cauRolesByCaseId.keySet());\n+        List<String> userIds = getUserIds(cauRolesByCaseId);\n+\n+        // find existing Case-User relationships for all the cases + users found\n+        Map<Long, List<CaseUserEntity>> existingCaseUserRolesByCaseId =\n+            caseUserRepository.findCaseUserRoles(caseIds, userIds).stream()\n+                .collect(Collectors.groupingBy(\n+                    caseUserEntity -> caseUserEntity.getCasePrimaryKey().getCaseDataId(),\n+                    Collectors.toList()\n+                ));\n+\n+        return cauRolesByCaseId.entrySet().stream()\n+            .collect(Collectors.toMap(Map.Entry::getKey,\n+                entry -> filterExistingCauRoles(entry.getValue(), existingCaseUserRolesByCaseId.getOrDefault(entry.getKey(), new ArrayList<>()))));\n+    }\n+\n+    private List<CaseAssignedUserRoleWithOrganisation> filterExistingCauRoles(\n+        List<CaseAssignedUserRoleWithOrganisation> inputCauRoles,\n+        List<CaseUserEntity> existingCauRoles) {\n+        return inputCauRoles.stream()\n+            .filter(cauRole -> existingCauRoles.stream()\n+                .anyMatch(entity -> entity.getCasePrimaryKey().getCaseRole().equalsIgnoreCase(cauRole.getCaseRole())\n+                    && entity.getCasePrimaryKey().getUserId().equalsIgnoreCase(cauRole.getUserId())))\n+            .collect(Collectors.toList());\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwOTU5NA=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjU0NjM4OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToyMTowMFrOHBktUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMzo0MTo0MFrOHBpQJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxMjA1MQ==", "bodyText": "If the data types match(?): should this function also be called from inside  getUserCountByCaseAndOrganisation as a replacement for lines 234-239: i.e. the bit with the comment // get distinct list of user ids", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471412051", "createdAt": "2020-08-17T11:21:00Z", "author": {"login": "mattnayler"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -106,11 +108,74 @@ public void addCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUser\n \n         newUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n             orgNewUserCountMap.forEach((organisationId, newUserCount) ->\n-                supplementaryDataRepository.incrementSupplementaryData(caseReference, \"orgs_assigned_users.\" + organisationId, newUserCount)\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference, ORGS_ASSIGNED_USERS_PAH + organisationId, newUserCount)\n             )\n         );\n     }\n \n+    @Transactional\n+    public void removeCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        // Ignore case user role mappings that are NOT exist in the database silently. Also they shouldn't effect counters.\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filteredCauRolesByCaseId = filterUnknownCauRoles(cauRolesByCaseId);\n+\n+        filteredCauRolesByCaseId.forEach((caseId, requestedAssignments) ->\n+            requestedAssignments.forEach(requestedAssignment ->\n+                caseUserRepository.revokeAccess(caseId, requestedAssignment.getUserId(), requestedAssignment.getCaseRole())\n+            )\n+        );\n+\n+        // determine counters after removal of requested mappings so that same function can be re-used (i.e user still has an association to a case).\n+        Map<String, Map<String, Long>> removeUserCounts = getUserCountByCaseAndOrganisation(filteredCauRolesByCaseId);\n+\n+        removeUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n+            orgNewUserCountMap.forEach((organisationId, removeUserCount) ->\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference,\n+                    ORGS_ASSIGNED_USERS_PAH + organisationId, Math.negateExact(removeUserCount))\n+            )\n+        );\n+    }\n+\n+    private Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filterUnknownCauRoles(\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+\n+        List<Long> caseIds = new ArrayList<>(cauRolesByCaseId.keySet());\n+        List<String> userIds = getUserIds(cauRolesByCaseId);\n+\n+        // find existing Case-User relationships for all the cases + users found\n+        Map<Long, List<CaseUserEntity>> existingCaseUserRolesByCaseId =\n+            caseUserRepository.findCaseUserRoles(caseIds, userIds).stream()\n+                .collect(Collectors.groupingBy(\n+                    caseUserEntity -> caseUserEntity.getCasePrimaryKey().getCaseDataId(),\n+                    Collectors.toList()\n+                ));\n+\n+        return cauRolesByCaseId.entrySet().stream()\n+            .collect(Collectors.toMap(Map.Entry::getKey,\n+                entry -> filterExistingCauRoles(entry.getValue(), existingCaseUserRolesByCaseId.getOrDefault(entry.getKey(), new ArrayList<>()))));\n+    }\n+\n+    private List<CaseAssignedUserRoleWithOrganisation> filterExistingCauRoles(\n+        List<CaseAssignedUserRoleWithOrganisation> inputCauRoles,\n+        List<CaseUserEntity> existingCauRoles) {\n+        return inputCauRoles.stream()\n+            .filter(cauRole -> existingCauRoles.stream()\n+                .anyMatch(entity -> entity.getCasePrimaryKey().getCaseRole().equalsIgnoreCase(cauRole.getCaseRole())\n+                    && entity.getCasePrimaryKey().getUserId().equalsIgnoreCase(cauRole.getUserId())))\n+            .collect(Collectors.toList());\n+    }\n+\n+    private List<String> getUserIds(Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+        return cauRolesByCaseId.values().stream()\n+            .map(requestedAssignments -> requestedAssignments.stream()\n+                .map(CaseAssignedUserRoleWithOrganisation::getUserId).collect(Collectors.toList()))\n+            .flatMap(List::stream)\n+            .distinct()\n+            .collect(Collectors.toList());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NjUwMw==", "bodyText": "done", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471486503", "createdAt": "2020-08-17T13:41:40Z", "author": {"login": "smathangi"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -106,11 +108,74 @@ public void addCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUser\n \n         newUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n             orgNewUserCountMap.forEach((organisationId, newUserCount) ->\n-                supplementaryDataRepository.incrementSupplementaryData(caseReference, \"orgs_assigned_users.\" + organisationId, newUserCount)\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference, ORGS_ASSIGNED_USERS_PAH + organisationId, newUserCount)\n             )\n         );\n     }\n \n+    @Transactional\n+    public void removeCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        // Ignore case user role mappings that are NOT exist in the database silently. Also they shouldn't effect counters.\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filteredCauRolesByCaseId = filterUnknownCauRoles(cauRolesByCaseId);\n+\n+        filteredCauRolesByCaseId.forEach((caseId, requestedAssignments) ->\n+            requestedAssignments.forEach(requestedAssignment ->\n+                caseUserRepository.revokeAccess(caseId, requestedAssignment.getUserId(), requestedAssignment.getCaseRole())\n+            )\n+        );\n+\n+        // determine counters after removal of requested mappings so that same function can be re-used (i.e user still has an association to a case).\n+        Map<String, Map<String, Long>> removeUserCounts = getUserCountByCaseAndOrganisation(filteredCauRolesByCaseId);\n+\n+        removeUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n+            orgNewUserCountMap.forEach((organisationId, removeUserCount) ->\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference,\n+                    ORGS_ASSIGNED_USERS_PAH + organisationId, Math.negateExact(removeUserCount))\n+            )\n+        );\n+    }\n+\n+    private Map<Long, List<CaseAssignedUserRoleWithOrganisation>> filterUnknownCauRoles(\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+\n+        List<Long> caseIds = new ArrayList<>(cauRolesByCaseId.keySet());\n+        List<String> userIds = getUserIds(cauRolesByCaseId);\n+\n+        // find existing Case-User relationships for all the cases + users found\n+        Map<Long, List<CaseUserEntity>> existingCaseUserRolesByCaseId =\n+            caseUserRepository.findCaseUserRoles(caseIds, userIds).stream()\n+                .collect(Collectors.groupingBy(\n+                    caseUserEntity -> caseUserEntity.getCasePrimaryKey().getCaseDataId(),\n+                    Collectors.toList()\n+                ));\n+\n+        return cauRolesByCaseId.entrySet().stream()\n+            .collect(Collectors.toMap(Map.Entry::getKey,\n+                entry -> filterExistingCauRoles(entry.getValue(), existingCaseUserRolesByCaseId.getOrDefault(entry.getKey(), new ArrayList<>()))));\n+    }\n+\n+    private List<CaseAssignedUserRoleWithOrganisation> filterExistingCauRoles(\n+        List<CaseAssignedUserRoleWithOrganisation> inputCauRoles,\n+        List<CaseUserEntity> existingCauRoles) {\n+        return inputCauRoles.stream()\n+            .filter(cauRole -> existingCauRoles.stream()\n+                .anyMatch(entity -> entity.getCasePrimaryKey().getCaseRole().equalsIgnoreCase(cauRole.getCaseRole())\n+                    && entity.getCasePrimaryKey().getUserId().equalsIgnoreCase(cauRole.getUserId())))\n+            .collect(Collectors.toList());\n+    }\n+\n+    private List<String> getUserIds(Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+        return cauRolesByCaseId.values().stream()\n+            .map(requestedAssignments -> requestedAssignments.stream()\n+                .map(CaseAssignedUserRoleWithOrganisation::getUserId).collect(Collectors.toList()))\n+            .flatMap(List::stream)\n+            .distinct()\n+            .collect(Collectors.toList());\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxMjA1MQ=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjU2MzkwOnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/ApplicationParams.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToyNjozOVrOHBk3lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMzo0MTozNFrOHBpP6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxNDY3OQ==", "bodyText": "This code has inherited an unexpected change in order of the Case-User-Roles: i.e. parameter is defined as UserCaseRoles. Should this be renamed?  See also lines 162/163.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471414679", "createdAt": "2020-08-17T11:26:39Z", "author": {"login": "mattnayler"}, "path": "src/main/java/uk/gov/hmcts/ccd/ApplicationParams.java", "diffHunk": "@@ -17,8 +17,8 @@\n @Singleton\n public class ApplicationParams {\n \n-    @Value(\"#{'${ccd.s2s-authorised.services.add_case_user_roles}'.split(',')}\")\n-    private List<String> authorisedServicesForAddUserCaseRoles;\n+    @Value(\"#{'${ccd.s2s-authorised.services.case_user_roles}'.split(',')}\")\n+    private List<String> authorisedServicesForUserCaseRoles;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NjQ0MQ==", "bodyText": "done", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471486441", "createdAt": "2020-08-17T13:41:34Z", "author": {"login": "smathangi"}, "path": "src/main/java/uk/gov/hmcts/ccd/ApplicationParams.java", "diffHunk": "@@ -17,8 +17,8 @@\n @Singleton\n public class ApplicationParams {\n \n-    @Value(\"#{'${ccd.s2s-authorised.services.add_case_user_roles}'.split(',')}\")\n-    private List<String> authorisedServicesForAddUserCaseRoles;\n+    @Value(\"#{'${ccd.s2s-authorised.services.case_user_roles}'.split(',')}\")\n+    private List<String> authorisedServicesForUserCaseRoles;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxNDY3OQ=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjU3NjE5OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozMDozOVrOHBk-xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozMDozOVrOHBk-xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxNjUxNg==", "bodyText": "Cut 'n' paste typo.  Rename so it reference Remove rather than Add.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471416516", "createdAt": "2020-08-17T11:30:39Z", "author": {"login": "mattnayler"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerTest.java", "diffHunk": "@@ -434,6 +435,259 @@ void getCaseUserRoles_shouldGetResponseWhenCaseIdsPassed() {\n \n     }\n \n+    @Nested\n+    @DisplayName(\"DELETE /case-users\")\n+    class RemoveCaseUserRoles {\n+\n+        @BeforeEach\n+        void setUp() {\n+            when(applicationParams.getAuthorisedServicesForUserCaseRoles()).thenReturn(List.of(ADD_SERVICE_GOOD));\n+            doReturn(ADD_SERVICE_GOOD).when(securityUtils).getServiceNameFromS2SToken(CLIENT_S2S_TOKEN_GOOD);\n+        }\n+\n+        @Test\n+        void removeCaseUserRoles_shouldCallAddWhenValidSingleGoodCaseUserRoleSupplied() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 180}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjU3NzI4OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozMDo1NlrOHBk_WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozMDo1NlrOHBk_WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxNjY2NA==", "bodyText": "Cut 'n' paste typo.  Rename so it reference Remove rather than Add.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471416664", "createdAt": "2020-08-17T11:30:56Z", "author": {"login": "mattnayler"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerTest.java", "diffHunk": "@@ -434,6 +435,259 @@ void getCaseUserRoles_shouldGetResponseWhenCaseIdsPassed() {\n \n     }\n \n+    @Nested\n+    @DisplayName(\"DELETE /case-users\")\n+    class RemoveCaseUserRoles {\n+\n+        @BeforeEach\n+        void setUp() {\n+            when(applicationParams.getAuthorisedServicesForUserCaseRoles()).thenReturn(List.of(ADD_SERVICE_GOOD));\n+            doReturn(ADD_SERVICE_GOOD).when(securityUtils).getServiceNameFromS2SToken(CLIENT_S2S_TOKEN_GOOD);\n+        }\n+\n+        @Test\n+        void removeCaseUserRoles_shouldCallAddWhenValidSingleGoodCaseUserRoleSupplied() {\n+            // ARRANGE\n+            List<CaseAssignedUserRoleWithOrganisation> caseUserRoles = Lists.newArrayList(\n+                    new CaseAssignedUserRoleWithOrganisation(CASE_ID_GOOD, USER_ID_1, CASE_ROLE_GOOD)\n+            );\n+\n+            CaseAssignedUserRolesRequest request = new CaseAssignedUserRolesRequest(caseUserRoles);\n+\n+            // ACT\n+            ResponseEntity<CaseAssignedUserRolesResponse> response =\n+                    controller.removeCaseUserRoles(CLIENT_S2S_TOKEN_GOOD, request);\n+\n+            // ASSERT\n+            assertNotNull(response);\n+            assertEquals(HttpStatus.OK, response.getStatusCode());\n+            assertNotNull(response.getBody());\n+            assertEquals(REMOVE_SUCCESS_MESSAGE, response.getBody().getStatus());\n+            verify(caseAssignedUserRolesOperation, times(1)).removeCaseUserRoles(caseUserRoles);\n+        }\n+\n+        @Test\n+        void removeCaseUserRoles_shouldCallAddWhenValidSingleGoodCaseUserRoleSupplied_withOrganisation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 201}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjU3ODQ0OnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozMToyMFrOHBlAEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozMToyMFrOHBlAEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxNjg0OA==", "bodyText": "Cut 'n' paste typo.  Rename so it reference Remove rather than Add.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471416848", "createdAt": "2020-08-17T11:31:20Z", "author": {"login": "mattnayler"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerTest.java", "diffHunk": "@@ -434,6 +435,259 @@ void getCaseUserRoles_shouldGetResponseWhenCaseIdsPassed() {\n \n     }\n \n+    @Nested\n+    @DisplayName(\"DELETE /case-users\")\n+    class RemoveCaseUserRoles {\n+\n+        @BeforeEach\n+        void setUp() {\n+            when(applicationParams.getAuthorisedServicesForUserCaseRoles()).thenReturn(List.of(ADD_SERVICE_GOOD));\n+            doReturn(ADD_SERVICE_GOOD).when(securityUtils).getServiceNameFromS2SToken(CLIENT_S2S_TOKEN_GOOD);\n+        }\n+\n+        @Test\n+        void removeCaseUserRoles_shouldCallAddWhenValidSingleGoodCaseUserRoleSupplied() {\n+            // ARRANGE\n+            List<CaseAssignedUserRoleWithOrganisation> caseUserRoles = Lists.newArrayList(\n+                    new CaseAssignedUserRoleWithOrganisation(CASE_ID_GOOD, USER_ID_1, CASE_ROLE_GOOD)\n+            );\n+\n+            CaseAssignedUserRolesRequest request = new CaseAssignedUserRolesRequest(caseUserRoles);\n+\n+            // ACT\n+            ResponseEntity<CaseAssignedUserRolesResponse> response =\n+                    controller.removeCaseUserRoles(CLIENT_S2S_TOKEN_GOOD, request);\n+\n+            // ASSERT\n+            assertNotNull(response);\n+            assertEquals(HttpStatus.OK, response.getStatusCode());\n+            assertNotNull(response.getBody());\n+            assertEquals(REMOVE_SUCCESS_MESSAGE, response.getBody().getStatus());\n+            verify(caseAssignedUserRolesOperation, times(1)).removeCaseUserRoles(caseUserRoles);\n+        }\n+\n+        @Test\n+        void removeCaseUserRoles_shouldCallAddWhenValidSingleGoodCaseUserRoleSupplied_withOrganisation() {\n+            // ARRANGE\n+            List<CaseAssignedUserRoleWithOrganisation> caseUserRoles = Lists.newArrayList(\n+                    new CaseAssignedUserRoleWithOrganisation(CASE_ID_GOOD, USER_ID_1, CASE_ROLE_GOOD,\n+                            ORGANISATION_ID_GOOD)\n+            );\n+\n+            CaseAssignedUserRolesRequest request = new CaseAssignedUserRolesRequest(caseUserRoles);\n+\n+            // ACT\n+            ResponseEntity<CaseAssignedUserRolesResponse> response =\n+                    controller.removeCaseUserRoles(CLIENT_S2S_TOKEN_GOOD, request);\n+\n+            // ASSERT\n+            assertNotNull(response);\n+            assertEquals(HttpStatus.OK, response.getStatusCode());\n+            assertNotNull(response.getBody());\n+            assertEquals(REMOVE_SUCCESS_MESSAGE, response.getBody().getStatus());\n+            verify(caseAssignedUserRolesOperation, times(1)).removeCaseUserRoles(caseUserRoles);\n+        }\n+\n+        @Test\n+        void removeCaseUserRoles_shouldCallAddWhenValidMultipleGoodCaseUserRolesSupplied() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 223}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjU5MDYxOnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/cauroles/DefaultCaseAssignedUserRolesOperationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozNToxMVrOHBlHHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozNToxMVrOHBlHHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxODY1Mg==", "bodyText": "Cut 'n' paste typo.  This should be calling the Remove functions rather than Add.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471418652", "createdAt": "2020-08-17T11:35:11Z", "author": {"login": "mattnayler"}, "path": "src/test/java/uk/gov/hmcts/ccd/domain/service/cauroles/DefaultCaseAssignedUserRolesOperationTest.java", "diffHunk": "@@ -54,6 +54,18 @@ void findCaseUserRoles() {\n         assertEquals(2, caseAssignedUserRoles.size());\n     }\n \n+    @Test\n+    void removeCaseUserRoles() {\n+        List<CaseAssignedUserRoleWithOrganisation> caseUserRoles = Lists.newArrayList(\n+                new CaseAssignedUserRoleWithOrganisation(),\n+                new CaseAssignedUserRoleWithOrganisation()\n+        );\n+\n+        caseAssignedUserRolesOperation.addCaseUserRoles(caseUserRoles);\n+\n+        verify(caseAccessOperation).addCaseUserRoles(caseUserRoles);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjYyMDQxOnYy", "diffSide": "RIGHT", "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerIT.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTo0NDozMlrOHBlYfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTozOTo1N1rOHBuGSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQyMzEwMg==", "bodyText": "Should this be renamed as AddCaseAssignedUserRolesControllerIT so it compliments RemoveCaseAssignedUserRolesControllerIT?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471423102", "createdAt": "2020-08-17T11:44:32Z", "author": {"login": "mattnayler"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerIT.java", "diffHunk": "@@ -1,174 +1,38 @@\n package uk.gov.hmcts.ccd.v2.external.controller;\n \n-import com.fasterxml.jackson.databind.DeserializationFeature;\n-import com.github.tomakehurst.wiremock.client.WireMock;\n import com.google.common.collect.Lists;\n-import org.apache.commons.lang3.StringUtils;\n import org.hamcrest.Matchers;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.DisplayName;\n import org.junit.jupiter.api.Test;\n-import org.mockito.ArgumentCaptor;\n-import org.mockito.Mock;\n-import org.mockito.MockitoAnnotations;\n-import org.springframework.beans.factory.annotation.Qualifier;\n-import org.springframework.boot.test.mock.mockito.SpyBean;\n import org.springframework.http.HttpHeaders;\n-import org.springframework.http.HttpMethod;\n import org.springframework.http.HttpStatus;\n-import org.springframework.security.core.Authentication;\n-import org.springframework.security.core.context.SecurityContext;\n-import org.springframework.security.core.context.SecurityContextHolder;\n import org.springframework.test.context.jdbc.Sql;\n-import org.springframework.test.util.ReflectionTestUtils;\n-import org.springframework.test.web.servlet.MockMvc;\n import org.springframework.test.web.servlet.MvcResult;\n-import org.springframework.test.web.servlet.setup.MockMvcBuilders;\n-import org.springframework.web.context.WebApplicationContext;\n-import uk.gov.hmcts.ccd.ApplicationParams;\n import uk.gov.hmcts.ccd.MockUtils;\n-import uk.gov.hmcts.ccd.WireMockBaseTest;\n-import uk.gov.hmcts.ccd.auditlog.AuditEntry;\n-import uk.gov.hmcts.ccd.auditlog.AuditOperationType;\n-import uk.gov.hmcts.ccd.auditlog.AuditRepository;\n import uk.gov.hmcts.ccd.data.SecurityUtils;\n-import uk.gov.hmcts.ccd.data.caseaccess.CaseUserRepository;\n-import uk.gov.hmcts.ccd.data.caseaccess.DefaultCaseUserRepository;\n-import uk.gov.hmcts.ccd.data.casedetails.supplementarydata.SupplementaryDataRepository;\n import uk.gov.hmcts.ccd.domain.model.std.CaseAssignedUserRoleWithOrganisation;\n import uk.gov.hmcts.ccd.v2.V2;\n-import uk.gov.hmcts.ccd.v2.external.domain.AddCaseAssignedUserRolesRequest;\n-import uk.gov.hmcts.ccd.v2.external.domain.AddCaseAssignedUserRolesResponse;\n+import uk.gov.hmcts.ccd.v2.external.domain.CaseAssignedUserRolesRequest;\n+import uk.gov.hmcts.ccd.v2.external.domain.CaseAssignedUserRolesResponse;\n import uk.gov.hmcts.ccd.v2.external.resource.CaseAssignedUserRolesResource;\n \n-import javax.inject.Inject;\n-import java.io.IOException;\n-import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n-import java.util.stream.Collectors;\n \n-import static com.github.tomakehurst.wiremock.client.WireMock.okJson;\n-import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n-import static com.github.tomakehurst.wiremock.client.WireMock.urlMatching;\n import static org.hamcrest.CoreMatchers.containsString;\n-import static org.hamcrest.CoreMatchers.is;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.allOf;\n import static org.hamcrest.Matchers.hasItems;\n import static org.hamcrest.Matchers.hasProperty;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertAll;\n-import static org.mockito.Mockito.doReturn;\n-import static org.mockito.Mockito.verify;\n-import static org.springframework.http.HttpHeaders.AUTHORIZATION;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n-import static uk.gov.hmcts.ccd.auditlog.aop.AuditContext.CASE_ID_SEPARATOR;\n-import static uk.gov.hmcts.ccd.data.SecurityUtils.SERVICE_AUTHORIZATION;\n import static uk.gov.hmcts.ccd.v2.V2.Error.OTHER_USER_CASE_ROLE_ACCESS_NOT_GRANTED;\n import static uk.gov.hmcts.ccd.v2.external.controller.CaseAssignedUserRolesController.ADD_SUCCESS_MESSAGE;\n \n-class CaseAssignedUserRolesControllerIT extends WireMockBaseTest {\n-\n-    private static final Long INVALID_CASE_ID = 222L;\n-\n-    private static final String AUTHORISED_ADD_SERVICE_1 = \"ADD_SERVICE_1\";\n-    private static final String AUTHORISED_ADD_SERVICE_2 = \"ADD_SERVICE_2\";\n-    private static final String UNAUTHORISED_ADD_SERVICE = \"UNAUTHORISED_ADD_SERVICE\";\n-\n-    private static final String CASE_ID_1 = \"7578590391163133\";\n-    private static final String CASE_ID_2 = \"6375837333991692\";\n-    private static final String CASE_IDS = CASE_ID_1 + \",\" + CASE_ID_2;\n-\n-    private static final String CASE_ID_EXTRA = \"1983927457663329\";\n-\n-    private static final String CASE_ROLE_1 = \"[case-role-1]\";\n-    private static final String CASE_ROLE_2 = \"[case-role-2]\";\n-    private static final String INVALID_CASE_ROLE = \"bad-role\";\n-\n-    private static final String USER_IDS_1 = \"89000\";\n-    private static final String USER_IDS_2 = \"89001\";\n-    private static final String USER_IDS_3 = \"89002\";\n-    private static final String USER_IDS = USER_IDS_1 + \",\" + USER_IDS_2;\n-\n-    private static final String INVALID_USER_IDS = USER_IDS_1 + \", ,\" + USER_IDS_2;\n-\n-    private static final String ORGANISATION_ID_1 = \"OrgA\";\n-    private static final String ORGANISATION_ID_2 = \"OrgB\";\n-    private static final String INVALID_ORGANISATION_ID = \"\";\n-\n-    private static final String ORGANISATION_ASSIGNED_USER_COUNTER_KEY = \"orgs_assigned_users\";\n-\n-    private final String caseworkerCaa = \"caseworker-caa\";\n-    private final String getCaseAssignedUserRoles = \"/case-users\";\n-    private final String postCaseAssignedUserRoles = \"/case-users\";\n-\n-    private static final String PARAM_CASE_IDS = \"case_ids\";\n-    private static final String PARAM_USER_IDS = \"user_ids\";\n-\n-    @Inject\n-    private ApplicationParams applicationParams;\n-\n-    @SpyBean @Inject\n-    private AuditRepository auditRepository;\n-\n-    @Mock\n-    private Authentication authentication;\n-\n-    @Mock\n-    private SecurityContext securityContext;\n-\n-    private MockMvc mockMvc;\n-\n-    @Inject @Qualifier(DefaultCaseUserRepository.QUALIFIER)\n-    private CaseUserRepository caseUserRepository;\n-\n-    @Inject @Qualifier(\"default\")\n-    private SupplementaryDataRepository supplementaryDataRepository;\n-\n-    @Inject\n-    private WebApplicationContext wac;\n-\n-    @BeforeEach\n-    void setUp() throws IOException {\n-        super.initMock();\n-        MockitoAnnotations.initMocks(this);\n-\n-        doReturn(authentication).when(securityContext).getAuthentication();\n-        SecurityContextHolder.setContext(securityContext);\n-\n-        MockUtils.setSecurityAuthorities(authentication, MockUtils.ROLE_CASEWORKER_PUBLIC);\n-\n-        ReflectionTestUtils.setField(\n-            applicationParams,\n-            \"authorisedServicesForAddUserCaseRoles\",\n-            Lists.newArrayList(AUTHORISED_ADD_SERVICE_1, AUTHORISED_ADD_SERVICE_2)\n-        );\n-        // disable suppression of audit logs\n-        ReflectionTestUtils.setField(\n-            applicationParams,\n-            \"auditLogIgnoreStatuses\",\n-            Lists.newArrayList()\n-        );\n-\n-        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();\n-        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n-\n-        String userJson = \"{\\n\"\n-            + \"          \\\"sub\\\": \\\"Cloud.Strife@test.com\\\",\\n\"\n-            + \"          \\\"uid\\\": \\\"89000\\\",\\n\"\n-            + \"          \\\"roles\\\": [\\n\"\n-            + \"            \\\"caseworker\\\",\\n\"\n-            + \"            \\\"caseworker-probate-public\\\"\\n\"\n-            + \"          ],\\n\"\n-            + \"          \\\"name\\\": \\\"Cloud Strife\\\"\\n\"\n-            + \"        }\";\n-        stubFor(WireMock.get(urlMatching(\"/o/userinfo\"))\n-            .willReturn(okJson(userJson).withStatus(200)));\n-    }\n+class CaseAssignedUserRolesControllerIT extends BaseCaseAssignedUserRolesControllerIT {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUwMDQ0MQ==", "bodyText": "Original one has GET tests as well. Let me split that as well", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471500441", "createdAt": "2020-08-17T14:02:41Z", "author": {"login": "smathangi"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerIT.java", "diffHunk": "@@ -1,174 +1,38 @@\n package uk.gov.hmcts.ccd.v2.external.controller;\n \n-import com.fasterxml.jackson.databind.DeserializationFeature;\n-import com.github.tomakehurst.wiremock.client.WireMock;\n import com.google.common.collect.Lists;\n-import org.apache.commons.lang3.StringUtils;\n import org.hamcrest.Matchers;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.DisplayName;\n import org.junit.jupiter.api.Test;\n-import org.mockito.ArgumentCaptor;\n-import org.mockito.Mock;\n-import org.mockito.MockitoAnnotations;\n-import org.springframework.beans.factory.annotation.Qualifier;\n-import org.springframework.boot.test.mock.mockito.SpyBean;\n import org.springframework.http.HttpHeaders;\n-import org.springframework.http.HttpMethod;\n import org.springframework.http.HttpStatus;\n-import org.springframework.security.core.Authentication;\n-import org.springframework.security.core.context.SecurityContext;\n-import org.springframework.security.core.context.SecurityContextHolder;\n import org.springframework.test.context.jdbc.Sql;\n-import org.springframework.test.util.ReflectionTestUtils;\n-import org.springframework.test.web.servlet.MockMvc;\n import org.springframework.test.web.servlet.MvcResult;\n-import org.springframework.test.web.servlet.setup.MockMvcBuilders;\n-import org.springframework.web.context.WebApplicationContext;\n-import uk.gov.hmcts.ccd.ApplicationParams;\n import uk.gov.hmcts.ccd.MockUtils;\n-import uk.gov.hmcts.ccd.WireMockBaseTest;\n-import uk.gov.hmcts.ccd.auditlog.AuditEntry;\n-import uk.gov.hmcts.ccd.auditlog.AuditOperationType;\n-import uk.gov.hmcts.ccd.auditlog.AuditRepository;\n import uk.gov.hmcts.ccd.data.SecurityUtils;\n-import uk.gov.hmcts.ccd.data.caseaccess.CaseUserRepository;\n-import uk.gov.hmcts.ccd.data.caseaccess.DefaultCaseUserRepository;\n-import uk.gov.hmcts.ccd.data.casedetails.supplementarydata.SupplementaryDataRepository;\n import uk.gov.hmcts.ccd.domain.model.std.CaseAssignedUserRoleWithOrganisation;\n import uk.gov.hmcts.ccd.v2.V2;\n-import uk.gov.hmcts.ccd.v2.external.domain.AddCaseAssignedUserRolesRequest;\n-import uk.gov.hmcts.ccd.v2.external.domain.AddCaseAssignedUserRolesResponse;\n+import uk.gov.hmcts.ccd.v2.external.domain.CaseAssignedUserRolesRequest;\n+import uk.gov.hmcts.ccd.v2.external.domain.CaseAssignedUserRolesResponse;\n import uk.gov.hmcts.ccd.v2.external.resource.CaseAssignedUserRolesResource;\n \n-import javax.inject.Inject;\n-import java.io.IOException;\n-import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n-import java.util.stream.Collectors;\n \n-import static com.github.tomakehurst.wiremock.client.WireMock.okJson;\n-import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n-import static com.github.tomakehurst.wiremock.client.WireMock.urlMatching;\n import static org.hamcrest.CoreMatchers.containsString;\n-import static org.hamcrest.CoreMatchers.is;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.allOf;\n import static org.hamcrest.Matchers.hasItems;\n import static org.hamcrest.Matchers.hasProperty;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertAll;\n-import static org.mockito.Mockito.doReturn;\n-import static org.mockito.Mockito.verify;\n-import static org.springframework.http.HttpHeaders.AUTHORIZATION;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n-import static uk.gov.hmcts.ccd.auditlog.aop.AuditContext.CASE_ID_SEPARATOR;\n-import static uk.gov.hmcts.ccd.data.SecurityUtils.SERVICE_AUTHORIZATION;\n import static uk.gov.hmcts.ccd.v2.V2.Error.OTHER_USER_CASE_ROLE_ACCESS_NOT_GRANTED;\n import static uk.gov.hmcts.ccd.v2.external.controller.CaseAssignedUserRolesController.ADD_SUCCESS_MESSAGE;\n \n-class CaseAssignedUserRolesControllerIT extends WireMockBaseTest {\n-\n-    private static final Long INVALID_CASE_ID = 222L;\n-\n-    private static final String AUTHORISED_ADD_SERVICE_1 = \"ADD_SERVICE_1\";\n-    private static final String AUTHORISED_ADD_SERVICE_2 = \"ADD_SERVICE_2\";\n-    private static final String UNAUTHORISED_ADD_SERVICE = \"UNAUTHORISED_ADD_SERVICE\";\n-\n-    private static final String CASE_ID_1 = \"7578590391163133\";\n-    private static final String CASE_ID_2 = \"6375837333991692\";\n-    private static final String CASE_IDS = CASE_ID_1 + \",\" + CASE_ID_2;\n-\n-    private static final String CASE_ID_EXTRA = \"1983927457663329\";\n-\n-    private static final String CASE_ROLE_1 = \"[case-role-1]\";\n-    private static final String CASE_ROLE_2 = \"[case-role-2]\";\n-    private static final String INVALID_CASE_ROLE = \"bad-role\";\n-\n-    private static final String USER_IDS_1 = \"89000\";\n-    private static final String USER_IDS_2 = \"89001\";\n-    private static final String USER_IDS_3 = \"89002\";\n-    private static final String USER_IDS = USER_IDS_1 + \",\" + USER_IDS_2;\n-\n-    private static final String INVALID_USER_IDS = USER_IDS_1 + \", ,\" + USER_IDS_2;\n-\n-    private static final String ORGANISATION_ID_1 = \"OrgA\";\n-    private static final String ORGANISATION_ID_2 = \"OrgB\";\n-    private static final String INVALID_ORGANISATION_ID = \"\";\n-\n-    private static final String ORGANISATION_ASSIGNED_USER_COUNTER_KEY = \"orgs_assigned_users\";\n-\n-    private final String caseworkerCaa = \"caseworker-caa\";\n-    private final String getCaseAssignedUserRoles = \"/case-users\";\n-    private final String postCaseAssignedUserRoles = \"/case-users\";\n-\n-    private static final String PARAM_CASE_IDS = \"case_ids\";\n-    private static final String PARAM_USER_IDS = \"user_ids\";\n-\n-    @Inject\n-    private ApplicationParams applicationParams;\n-\n-    @SpyBean @Inject\n-    private AuditRepository auditRepository;\n-\n-    @Mock\n-    private Authentication authentication;\n-\n-    @Mock\n-    private SecurityContext securityContext;\n-\n-    private MockMvc mockMvc;\n-\n-    @Inject @Qualifier(DefaultCaseUserRepository.QUALIFIER)\n-    private CaseUserRepository caseUserRepository;\n-\n-    @Inject @Qualifier(\"default\")\n-    private SupplementaryDataRepository supplementaryDataRepository;\n-\n-    @Inject\n-    private WebApplicationContext wac;\n-\n-    @BeforeEach\n-    void setUp() throws IOException {\n-        super.initMock();\n-        MockitoAnnotations.initMocks(this);\n-\n-        doReturn(authentication).when(securityContext).getAuthentication();\n-        SecurityContextHolder.setContext(securityContext);\n-\n-        MockUtils.setSecurityAuthorities(authentication, MockUtils.ROLE_CASEWORKER_PUBLIC);\n-\n-        ReflectionTestUtils.setField(\n-            applicationParams,\n-            \"authorisedServicesForAddUserCaseRoles\",\n-            Lists.newArrayList(AUTHORISED_ADD_SERVICE_1, AUTHORISED_ADD_SERVICE_2)\n-        );\n-        // disable suppression of audit logs\n-        ReflectionTestUtils.setField(\n-            applicationParams,\n-            \"auditLogIgnoreStatuses\",\n-            Lists.newArrayList()\n-        );\n-\n-        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();\n-        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n-\n-        String userJson = \"{\\n\"\n-            + \"          \\\"sub\\\": \\\"Cloud.Strife@test.com\\\",\\n\"\n-            + \"          \\\"uid\\\": \\\"89000\\\",\\n\"\n-            + \"          \\\"roles\\\": [\\n\"\n-            + \"            \\\"caseworker\\\",\\n\"\n-            + \"            \\\"caseworker-probate-public\\\"\\n\"\n-            + \"          ],\\n\"\n-            + \"          \\\"name\\\": \\\"Cloud Strife\\\"\\n\"\n-            + \"        }\";\n-        stubFor(WireMock.get(urlMatching(\"/o/userinfo\"))\n-            .willReturn(okJson(userJson).withStatus(200)));\n-    }\n+class CaseAssignedUserRolesControllerIT extends BaseCaseAssignedUserRolesControllerIT {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQyMzEwMg=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2NTg5Nw==", "bodyText": "Many thanks.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471565897", "createdAt": "2020-08-17T15:39:57Z", "author": {"login": "mattnayler"}, "path": "src/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerIT.java", "diffHunk": "@@ -1,174 +1,38 @@\n package uk.gov.hmcts.ccd.v2.external.controller;\n \n-import com.fasterxml.jackson.databind.DeserializationFeature;\n-import com.github.tomakehurst.wiremock.client.WireMock;\n import com.google.common.collect.Lists;\n-import org.apache.commons.lang3.StringUtils;\n import org.hamcrest.Matchers;\n-import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.DisplayName;\n import org.junit.jupiter.api.Test;\n-import org.mockito.ArgumentCaptor;\n-import org.mockito.Mock;\n-import org.mockito.MockitoAnnotations;\n-import org.springframework.beans.factory.annotation.Qualifier;\n-import org.springframework.boot.test.mock.mockito.SpyBean;\n import org.springframework.http.HttpHeaders;\n-import org.springframework.http.HttpMethod;\n import org.springframework.http.HttpStatus;\n-import org.springframework.security.core.Authentication;\n-import org.springframework.security.core.context.SecurityContext;\n-import org.springframework.security.core.context.SecurityContextHolder;\n import org.springframework.test.context.jdbc.Sql;\n-import org.springframework.test.util.ReflectionTestUtils;\n-import org.springframework.test.web.servlet.MockMvc;\n import org.springframework.test.web.servlet.MvcResult;\n-import org.springframework.test.web.servlet.setup.MockMvcBuilders;\n-import org.springframework.web.context.WebApplicationContext;\n-import uk.gov.hmcts.ccd.ApplicationParams;\n import uk.gov.hmcts.ccd.MockUtils;\n-import uk.gov.hmcts.ccd.WireMockBaseTest;\n-import uk.gov.hmcts.ccd.auditlog.AuditEntry;\n-import uk.gov.hmcts.ccd.auditlog.AuditOperationType;\n-import uk.gov.hmcts.ccd.auditlog.AuditRepository;\n import uk.gov.hmcts.ccd.data.SecurityUtils;\n-import uk.gov.hmcts.ccd.data.caseaccess.CaseUserRepository;\n-import uk.gov.hmcts.ccd.data.caseaccess.DefaultCaseUserRepository;\n-import uk.gov.hmcts.ccd.data.casedetails.supplementarydata.SupplementaryDataRepository;\n import uk.gov.hmcts.ccd.domain.model.std.CaseAssignedUserRoleWithOrganisation;\n import uk.gov.hmcts.ccd.v2.V2;\n-import uk.gov.hmcts.ccd.v2.external.domain.AddCaseAssignedUserRolesRequest;\n-import uk.gov.hmcts.ccd.v2.external.domain.AddCaseAssignedUserRolesResponse;\n+import uk.gov.hmcts.ccd.v2.external.domain.CaseAssignedUserRolesRequest;\n+import uk.gov.hmcts.ccd.v2.external.domain.CaseAssignedUserRolesResponse;\n import uk.gov.hmcts.ccd.v2.external.resource.CaseAssignedUserRolesResource;\n \n-import javax.inject.Inject;\n-import java.io.IOException;\n-import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n-import java.util.stream.Collectors;\n \n-import static com.github.tomakehurst.wiremock.client.WireMock.okJson;\n-import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n-import static com.github.tomakehurst.wiremock.client.WireMock.urlMatching;\n import static org.hamcrest.CoreMatchers.containsString;\n-import static org.hamcrest.CoreMatchers.is;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.allOf;\n import static org.hamcrest.Matchers.hasItems;\n import static org.hamcrest.Matchers.hasProperty;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertAll;\n-import static org.mockito.Mockito.doReturn;\n-import static org.mockito.Mockito.verify;\n-import static org.springframework.http.HttpHeaders.AUTHORIZATION;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n-import static uk.gov.hmcts.ccd.auditlog.aop.AuditContext.CASE_ID_SEPARATOR;\n-import static uk.gov.hmcts.ccd.data.SecurityUtils.SERVICE_AUTHORIZATION;\n import static uk.gov.hmcts.ccd.v2.V2.Error.OTHER_USER_CASE_ROLE_ACCESS_NOT_GRANTED;\n import static uk.gov.hmcts.ccd.v2.external.controller.CaseAssignedUserRolesController.ADD_SUCCESS_MESSAGE;\n \n-class CaseAssignedUserRolesControllerIT extends WireMockBaseTest {\n-\n-    private static final Long INVALID_CASE_ID = 222L;\n-\n-    private static final String AUTHORISED_ADD_SERVICE_1 = \"ADD_SERVICE_1\";\n-    private static final String AUTHORISED_ADD_SERVICE_2 = \"ADD_SERVICE_2\";\n-    private static final String UNAUTHORISED_ADD_SERVICE = \"UNAUTHORISED_ADD_SERVICE\";\n-\n-    private static final String CASE_ID_1 = \"7578590391163133\";\n-    private static final String CASE_ID_2 = \"6375837333991692\";\n-    private static final String CASE_IDS = CASE_ID_1 + \",\" + CASE_ID_2;\n-\n-    private static final String CASE_ID_EXTRA = \"1983927457663329\";\n-\n-    private static final String CASE_ROLE_1 = \"[case-role-1]\";\n-    private static final String CASE_ROLE_2 = \"[case-role-2]\";\n-    private static final String INVALID_CASE_ROLE = \"bad-role\";\n-\n-    private static final String USER_IDS_1 = \"89000\";\n-    private static final String USER_IDS_2 = \"89001\";\n-    private static final String USER_IDS_3 = \"89002\";\n-    private static final String USER_IDS = USER_IDS_1 + \",\" + USER_IDS_2;\n-\n-    private static final String INVALID_USER_IDS = USER_IDS_1 + \", ,\" + USER_IDS_2;\n-\n-    private static final String ORGANISATION_ID_1 = \"OrgA\";\n-    private static final String ORGANISATION_ID_2 = \"OrgB\";\n-    private static final String INVALID_ORGANISATION_ID = \"\";\n-\n-    private static final String ORGANISATION_ASSIGNED_USER_COUNTER_KEY = \"orgs_assigned_users\";\n-\n-    private final String caseworkerCaa = \"caseworker-caa\";\n-    private final String getCaseAssignedUserRoles = \"/case-users\";\n-    private final String postCaseAssignedUserRoles = \"/case-users\";\n-\n-    private static final String PARAM_CASE_IDS = \"case_ids\";\n-    private static final String PARAM_USER_IDS = \"user_ids\";\n-\n-    @Inject\n-    private ApplicationParams applicationParams;\n-\n-    @SpyBean @Inject\n-    private AuditRepository auditRepository;\n-\n-    @Mock\n-    private Authentication authentication;\n-\n-    @Mock\n-    private SecurityContext securityContext;\n-\n-    private MockMvc mockMvc;\n-\n-    @Inject @Qualifier(DefaultCaseUserRepository.QUALIFIER)\n-    private CaseUserRepository caseUserRepository;\n-\n-    @Inject @Qualifier(\"default\")\n-    private SupplementaryDataRepository supplementaryDataRepository;\n-\n-    @Inject\n-    private WebApplicationContext wac;\n-\n-    @BeforeEach\n-    void setUp() throws IOException {\n-        super.initMock();\n-        MockitoAnnotations.initMocks(this);\n-\n-        doReturn(authentication).when(securityContext).getAuthentication();\n-        SecurityContextHolder.setContext(securityContext);\n-\n-        MockUtils.setSecurityAuthorities(authentication, MockUtils.ROLE_CASEWORKER_PUBLIC);\n-\n-        ReflectionTestUtils.setField(\n-            applicationParams,\n-            \"authorisedServicesForAddUserCaseRoles\",\n-            Lists.newArrayList(AUTHORISED_ADD_SERVICE_1, AUTHORISED_ADD_SERVICE_2)\n-        );\n-        // disable suppression of audit logs\n-        ReflectionTestUtils.setField(\n-            applicationParams,\n-            \"auditLogIgnoreStatuses\",\n-            Lists.newArrayList()\n-        );\n-\n-        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();\n-        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n-\n-        String userJson = \"{\\n\"\n-            + \"          \\\"sub\\\": \\\"Cloud.Strife@test.com\\\",\\n\"\n-            + \"          \\\"uid\\\": \\\"89000\\\",\\n\"\n-            + \"          \\\"roles\\\": [\\n\"\n-            + \"            \\\"caseworker\\\",\\n\"\n-            + \"            \\\"caseworker-probate-public\\\"\\n\"\n-            + \"          ],\\n\"\n-            + \"          \\\"name\\\": \\\"Cloud Strife\\\"\\n\"\n-            + \"        }\";\n-        stubFor(WireMock.get(urlMatching(\"/o/userinfo\"))\n-            .willReturn(okJson(userJson).withStatus(200)));\n-    }\n+class CaseAssignedUserRolesControllerIT extends BaseCaseAssignedUserRolesControllerIT {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQyMzEwMg=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 174}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjcwNjg5OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Repeat_Call_to_Remove_For_Hemanth.td.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxMjoyMlrOHBmMGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxMjoyMlrOHBmMGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQzNjMxMg==", "bodyText": "Should this be a reference to F-111_Get_Organisation_Identifier_Hemanth rather than Dil? IGNORE", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471436312", "createdAt": "2020-08-17T12:12:22Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Repeat_Call_to_Remove_For_Hemanth.td.json", "diffHunk": "@@ -0,0 +1,32 @@\n+{\n+  \"_guid_\": \"S-111.13_Repeat_Call_to_Remove_For_Hemanth\",\n+  \"_extends_\": \"F-111_Remove_Case_Assigned_User_Roles_Base\",\n+\n+  \"specs\": [\n+    \"to repeat the same request as above this time with a different user, Hemanth\"\n+  ],\n+\n+  \"users\": {\n+    \"_extends_\": \"F-111_Users\"\n+  },\n+\n+  \"request\": {\n+    \"headers\": {\n+      \"Authorization\": \"Bearer ${[scenarioContext][testData][users][userDil][accessToken]}\"\n+    },\n+    \"body\": {\n+      \"case_users\": [\n+        {\n+          \"case_id\": \"${[scenarioContext][siblingContexts][F-111_Prerequisite_Case_Creation_Call_for_Case_Assignment][testData][actualResponse][body][id]}\",\n+          \"user_id\": \"${[scenarioContext][testData][users][userHemanth][id]}\",\n+          \"case_role\": \"[CR-1]\",\n+          \"organisation_id\": \"${[scenarioContext][siblingContexts][S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation][childContexts][F-111_Prerequisite_Counter_Check_Call][childContexts][F-111_Get_Organisation_Identifier_Dil][testData][actualResponse][body][organisationIdentifier]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjcxODA2OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13.td.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxNjowMlrOHBmS3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxNjowMlrOHBmS3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQzODA0Ng==", "bodyText": "Should this be a reference to F-111_Get_Organisation_Identifier_Olawale rather than Dil? IGNORE: it is strange that AC refers only to Dil's organisation without reference to checking Hemanth and Olawale are in same org.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471438046", "createdAt": "2020-08-17T12:16:02Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13.td.json", "diffHunk": "@@ -0,0 +1,38 @@\n+{\n+  \"title\": \"Must successfully decrease Assigned User Count when removing a user and case role for a specific case\",\n+\n+  \"_guid_\": \"S-111.13\",\n+  \"_extends_\": \"F-111_Remove_Case_Assigned_User_Roles_Base\",\n+\n+  \"specs\": [\n+    \"Richard - who can create a case\",\n+    \"Dil - who is to add and remove some case role assignment for a case\",\n+    \"Olawale - with an active solicitor profile\",\n+    \"Hemanth - with an active solicitor profile\",\n+    \"is made from an authorised application, by Dil, with the Case ID of C1, User ID of Olawale, proper Case Role CR-1 and the Organisation ID of Olawale\"\n+  ],\n+\n+  \"users\": {\n+    \"_extends_\": \"F-111_Users\"\n+  },\n+\n+  \"request\": {\n+    \"headers\": {\n+      \"Authorization\": \"Bearer ${[scenarioContext][testData][users][userDil][accessToken]}\"\n+    },\n+    \"body\": {\n+      \"case_users\": [\n+        {\n+          \"case_id\": \"${[scenarioContext][childContexts][F-111_Prerequisite_Case_Creation_Call_for_Case_Assignment][testData][actualResponse][body][id]}\",\n+          \"user_id\": \"${[scenarioContext][testData][users][userOlawale][id]}\",\n+          \"case_role\": \"[CR-1]\",\n+          \"organisation_id\": \"${[scenarioContext][childContexts][S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation][childContexts][F-111_Prerequisite_Counter_Check_Call][childContexts][F-111_Get_Organisation_Identifier_Dil][testData][actualResponse][body][organisationIdentifier]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjcyMDAwOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Check_Orgs_assigned_Users_Base.td.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxNjo0MFrOHBmT-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxNjo0MFrOHBmT-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQzODMzMA==", "bodyText": "If primary test is adding Ola: Should this be a reference to F-111_Get_Organisation_Identifier_Olawale rather than Dil? IGNORE", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471438330", "createdAt": "2020-08-17T12:16:40Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Check_Orgs_assigned_Users_Base.td.json", "diffHunk": "@@ -0,0 +1,17 @@\n+{\n+  \"_guid_\": \"S-111.13_Check_Orgs_assigned_Users_Base\",\n+  \"_extends_\": \"F-111_Check_Orgs_Assigned_Users_Base\",\n+\n+  \"request\": {\n+    \"_extends_\": \"Common_Request\",\n+    \"pathVariables\": {\n+      \"cid\": \"${}${[scenarioContext][siblingContexts][F-111_Prerequisite_Case_Creation_Call_for_Case_Assignment][testData][actualResponse][body][id]}\"\n+    },\n+    \"body\": {\n+      \"supplementary_data_updates\": {\n+        \"$inc\": \"${[scenarioContext][customValues][orgsAssignedUsers_siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call.childContexts.F-111_Get_Organisation_Identifier_Dil]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjcyMTc4OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Repeat_Call_to_Remove_For_Ola.td.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxNzoxNFrOHBmVHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxNzoxNFrOHBmVHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQzODYyMg==", "bodyText": "If primary test is adding Ola: Should this be a reference to F-111_Get_Organisation_Identifier_Olawale rather than Dil? IGNORE", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471438622", "createdAt": "2020-08-17T12:17:14Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Repeat_Call_to_Remove_For_Ola.td.json", "diffHunk": "@@ -0,0 +1,32 @@\n+{\n+  \"_guid_\": \"S-111.13_Repeat_Call_to_Remove_For_Ola\",\n+  \"_extends_\": \"F-111_Remove_Case_Assigned_User_Roles_Base\",\n+\n+  \"specs\": [\n+    \"to repeat the same request as above\"\n+  ],\n+\n+  \"users\": {\n+    \"_extends_\": \"F-111_Users\"\n+  },\n+\n+  \"request\": {\n+    \"headers\": {\n+      \"Authorization\": \"Bearer ${[scenarioContext][testData][users][userDil][accessToken]}\"\n+    },\n+    \"body\": {\n+      \"case_users\": [\n+        {\n+          \"case_id\": \"${[scenarioContext][siblingContexts][F-111_Prerequisite_Case_Creation_Call_for_Case_Assignment][testData][actualResponse][body][id]}\",\n+          \"user_id\": \"${[scenarioContext][testData][users][userOlawale][id]}\",\n+          \"case_role\": \"[CR-1]\",\n+          \"organisation_id\": \"${[scenarioContext][siblingContexts][S-111.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation][childContexts][F-111_Prerequisite_Counter_Check_Call][childContexts][F-111_Get_Organisation_Identifier_Dil][testData][actualResponse][body][organisationIdentifier]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjcyNjUyOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Repeat_Call_to_Remove_For_Ola.td.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxODo0N1rOHBmYMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoxODo0N1rOHBmYMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQzOTQwOA==", "bodyText": "If this is a repeat call should it not extend the previous but use add the extra Spec definition?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471439408", "createdAt": "2020-08-17T12:18:47Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Repeat_Call_to_Remove_For_Ola.td.json", "diffHunk": "@@ -0,0 +1,32 @@\n+{\n+  \"_guid_\": \"S-111.13_Repeat_Call_to_Remove_For_Ola\",\n+  \"_extends_\": \"F-111_Remove_Case_Assigned_User_Roles_Base\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Njc1NDU5OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Verify_Counter_2.td.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoyNzozNVrOHBmpcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoyNzozNVrOHBmpcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0MzgyNw==", "bodyText": "If the spec says decrease:  should it not refer to S-111.13_Verify_Counter_1 but have an increment value of -1?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471443827", "createdAt": "2020-08-17T12:27:35Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Verify_Counter_2.td.json", "diffHunk": "@@ -0,0 +1,14 @@\n+{\n+  \"_guid_\": \"S-111.13_Verify_Counter_2\",\n+  \"_extends_\": \"S-111.13_Check_Orgs_assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"to verify the count of users assigned to C1 has decreased by 1\"\n+  ],\n+\n+  \"expectedResponse\": {\n+    \"body\": {\n+      \"supplementary_data\": \"${[scenarioContext][customValues][orgsAssignedUsers_siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call.childContexts.F-111_Get_Organisation_Identifier_Dil|siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call|1]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Njc1NTkyOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Verify_Counter_3.td.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoyODowMlrOHBmqRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoyODowMlrOHBmqRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0NDAzNg==", "bodyText": "If the spec says NOT changed:  should it not refer to S-111.13_Verify_Counter_2 but have an increment value of 0?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471444036", "createdAt": "2020-08-17T12:28:02Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Verify_Counter_3.td.json", "diffHunk": "@@ -0,0 +1,14 @@\n+{\n+  \"_guid_\": \"S-111.13_Verify_Counter_3\",\n+  \"_extends_\": \"S-111.13_Check_Orgs_assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"to verify the count of users unassigned to C1 has NOT changed\"\n+  ],\n+\n+  \"expectedResponse\": {\n+    \"body\": {\n+      \"supplementary_data\": \"${[scenarioContext][customValues][orgsAssignedUsers_siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call.childContexts.F-111_Get_Organisation_Identifier_Dil|siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call|1]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Njc1NzEyOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Verify_Counter_4.td.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjoyODoyM1rOHBmq8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyNTozMlrOHBtgcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0NDIxMQ==", "bodyText": "If the spec says decrease:  should it not refer to S-111.13_Verify_Counter_3 but have an increment value of -1?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471444211", "createdAt": "2020-08-17T12:28:23Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Verify_Counter_4.td.json", "diffHunk": "@@ -0,0 +1,14 @@\n+{\n+  \"_guid_\": \"S-111.13_Verify_Counter_4\",\n+  \"_extends_\": \"S-111.13_Check_Orgs_assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"to verify the count of users assigned to a case has decreased by 1\"\n+  ],\n+\n+  \"expectedResponse\": {\n+    \"body\": {\n+      \"supplementary_data\": \"${[scenarioContext][customValues][orgsAssignedUsers_siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call.childContexts.F-111_Get_Organisation_Identifier_Dil|siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call|0]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NjIxMQ==", "bodyText": "Addressed in commit (f9115e7) that addressed review comments", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471556211", "createdAt": "2020-08-17T15:25:32Z", "author": {"login": "sullivangareth"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.13/S-111.13_Verify_Counter_4.td.json", "diffHunk": "@@ -0,0 +1,14 @@\n+{\n+  \"_guid_\": \"S-111.13_Verify_Counter_4\",\n+  \"_extends_\": \"S-111.13_Check_Orgs_assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"to verify the count of users assigned to a case has decreased by 1\"\n+  ],\n+\n+  \"expectedResponse\": {\n+    \"body\": {\n+      \"supplementary_data\": \"${[scenarioContext][customValues][orgsAssignedUsers_siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call.childContexts.F-111_Get_Organisation_Identifier_Dil|siblingContexts.S-111\\\\.13_Add_Case_Assigned_User_Roles_for_Case_C1_With_Organisation.childContexts.F-111_Prerequisite_Counter_Check_Call|0]}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0NDIxMQ=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Njc4NDkyOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.16/S-111.16_Verify_User_Count_Unchanged.td.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjozNzowMVrOHBm7-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyNjozMFrOHBti6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0ODU3MA==", "bodyText": "If the spec says unchanged:  should it not refer to previous counter but have an increment value of 0?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471448570", "createdAt": "2020-08-17T12:37:01Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.16/S-111.16_Verify_User_Count_Unchanged.td.json", "diffHunk": "@@ -0,0 +1,14 @@\n+{\n+  \"_guid_\": \"S-111.16_Verify_User_Count_Unchanged\",\n+  \"_extends_\": \"S-111.16_Check_Orgs_assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"to verify the count of users assigned to a case has NOT changed\"\n+  ],\n+\n+  \"expectedResponse\": {\n+    \"body\": {\n+      \"supplementary_data\": \"${[scenarioContext][customValues][orgsAssignedUsers_siblingContexts.S-111\\\\.16_Add_Case_Assigned_User_Roles_for_Case_C1.childContexts.F-111_Prerequisite_Counter_Check_Call.childContexts.F-111_Get_Organisation_Identifier_Dil|siblingContexts.S-111\\\\.16_Add_Case_Assigned_User_Roles_for_Case_C1.childContexts.F-111_Prerequisite_Counter_Check_Call|2]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1Njg0MA==", "bodyText": "f9115e7", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471556840", "createdAt": "2020-08-17T15:26:30Z", "author": {"login": "sullivangareth"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/S-111.16/S-111.16_Verify_User_Count_Unchanged.td.json", "diffHunk": "@@ -0,0 +1,14 @@\n+{\n+  \"_guid_\": \"S-111.16_Verify_User_Count_Unchanged\",\n+  \"_extends_\": \"S-111.16_Check_Orgs_assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"to verify the count of users assigned to a case has NOT changed\"\n+  ],\n+\n+  \"expectedResponse\": {\n+    \"body\": {\n+      \"supplementary_data\": \"${[scenarioContext][customValues][orgsAssignedUsers_siblingContexts.S-111\\\\.16_Add_Case_Assigned_User_Roles_for_Case_C1.childContexts.F-111_Prerequisite_Counter_Check_Call.childContexts.F-111_Get_Organisation_Identifier_Dil|siblingContexts.S-111\\\\.16_Add_Case_Assigned_User_Roles_for_Case_C1.childContexts.F-111_Prerequisite_Counter_Check_Call|2]}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0ODU3MA=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Njc5MDc4OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "isResolved": false, "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjozODo1NFrOHBm_rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMTozNjo1OVrOHCPZgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw==", "bodyText": "Should this not be Dil?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471449517", "createdAt": "2020-08-17T12:38:54Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4MzQ3Mw==", "bodyText": "Yes, I'm aware of this. Since Dil has n't registered in the AAT PRD - so I changed to use becky user for the time being.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471483473", "createdAt": "2020-08-17T13:36:59Z", "author": {"login": "smathangi"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NzkzNQ==", "bodyText": "@MSancaktutar  could you register user Dil into AAT PRD system please (befta.caseworker.2.solicitor.2@gmail.com)", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471487935", "createdAt": "2020-08-17T13:43:53Z", "author": {"login": "smathangi"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUyMDY4OQ==", "bodyText": "do you mean putting the user in our test organisation? @smathangi .\nDo you really need that? We already have enough users in our solicitor company on AAT, no?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471520689", "createdAt": "2020-08-17T14:32:45Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NzIyMg==", "bodyText": "Changed to Dil in commit f9115e7", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471557222", "createdAt": "2020-08-17T15:27:04Z", "author": {"login": "sullivangareth"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjQzNw==", "bodyText": "yes, but F-111 scenarios are talking about user Dil organisation. (or if you're happy with above hack )", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471562437", "createdAt": "2020-08-17T15:34:48Z", "author": {"login": "smathangi"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU3Mjg5Ng==", "bodyText": "@smathangi Looks like we may need to update user Dil reference in F-111_User_Dil.td.json to a different user:  is emma suitable as per F-002 - Get Assignments in My Organisation/Prerequisite_Case_Assignment_C3_Emma.td.json?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471572896", "createdAt": "2020-08-17T15:49:55Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4Njc0MQ==", "bodyText": "@MSancaktutar  looks like Emma doesn't have relevant roles that match with case jurisdiction BEFTA_JURISDICTION_2. So, she can't access case created in  BEFTA_JURISDICTION_2.  What do you suggest ?\nWould you like to keep user as befta.caseworker.2.solicitor.2@gmail.com for Dil and register same user in PRD? or assign BEFTA_JURISDICTION_2 roles to Emma or any other alternatives..?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r472086741", "createdAt": "2020-08-18T10:46:59Z", "author": {"login": "smathangi"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5MzEwNQ==", "bodyText": "@smathangi - Please give me the role Emma needs. Is it only and exactly caseworker-befta_jurisdiction_2? I'll straight add it to Emma.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r472093105", "createdAt": "2020-08-18T10:59:40Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5ODIwOA==", "bodyText": "caseworker,caseworker-befta_jurisdiction_2,caseworker-befta_jurisdiction_2-solicitor", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r472098208", "createdAt": "2020-08-18T11:10:10Z", "author": {"login": "smathangi"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjExMTQ5MQ==", "bodyText": "@smathangi  - Emma's roles have been added.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r472111491", "createdAt": "2020-08-18T11:36:59Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Get_Organisation_Identifier_Dil.td.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"title\": \"Retrieve user's in Dil's organisation (+ organisationIdentifier)\",\n+\n+  \"_guid_\": \"F-111_Get_Organisation_Identifier_Dil\",\n+  \"_extends_\": \"F-111_Get_Organisation_Identifier_Base\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"_extends_\": \"F-111_User_Olawale\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0OTUxNw=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjgxODMwOnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Prerequisite_Counter_Check_Call.td.json", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo0Njo1NFrOHBnQYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyNzo0OVrOHBtmYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Mzc5Mg==", "bodyText": "Most/All references in Scenarios's are for Dil: even when roles are being added/removed for other users.  This feels wrong: but it is how most of the ACs are defined.  It may be worth adding an expectedResponse check to two of the three prerequisite files to check all user's are in same org: therefore ensuring the the use of Dil's organisation everywhere is justified: otherwise we may as well have hardcoded a fake Org ID.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471453792", "createdAt": "2020-08-17T12:46:54Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Prerequisite_Counter_Check_Call.td.json", "diffHunk": "@@ -0,0 +1,20 @@\n+{\n+  \"_guid_\": \"F-111_Prerequisite_Counter_Check_Call\",\n+  \"_extends_\": \"F-111_Check_Orgs_Assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"As a prerequisite\"\n+  ],\n+\n+  \"prerequisites\": [\n+    \"F-111_Get_Organisation_Identifier_Olawale\",\n+    \"F-111_Get_Organisation_Identifier_Hemanth\",\n+    \"F-111_Get_Organisation_Identifier_Dil\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0NjU1NQ==", "bodyText": "@mattnayler - Good point. To avoid such issues, we will use real user names instead of Dil, Jamal, etc.\nWe have 4 solicitor users with real names and will refer to them with their actual names, in test data files.\nFor Dil, Jamal, etc we can setup new users with emails containing their names. Those users will be in just 1 or 2 well-known test organisations. This way, when we use users from some intended organisations, we will be able to rely on what the scenarios lines are telling us.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471546555", "createdAt": "2020-08-17T15:11:27Z", "author": {"login": "MSancaktutar"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Prerequisite_Counter_Check_Call.td.json", "diffHunk": "@@ -0,0 +1,20 @@\n+{\n+  \"_guid_\": \"F-111_Prerequisite_Counter_Check_Call\",\n+  \"_extends_\": \"F-111_Check_Orgs_Assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"As a prerequisite\"\n+  ],\n+\n+  \"prerequisites\": [\n+    \"F-111_Get_Organisation_Identifier_Olawale\",\n+    \"F-111_Get_Organisation_Identifier_Hemanth\",\n+    \"F-111_Get_Organisation_Identifier_Dil\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Mzc5Mg=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NzcyOQ==", "bodyText": "Commit f9115e7 verifies that Hemanth and Ola are in same organisation as Dil", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471557729", "createdAt": "2020-08-17T15:27:49Z", "author": {"login": "sullivangareth"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/With Organisation Context/common/common/F-111_Prerequisite_Counter_Check_Call.td.json", "diffHunk": "@@ -0,0 +1,20 @@\n+{\n+  \"_guid_\": \"F-111_Prerequisite_Counter_Check_Call\",\n+  \"_extends_\": \"F-111_Check_Orgs_Assigned_Users_Base\",\n+\n+  \"specs\": [\n+    \"As a prerequisite\"\n+  ],\n+\n+  \"prerequisites\": [\n+    \"F-111_Get_Organisation_Identifier_Olawale\",\n+    \"F-111_Get_Organisation_Identifier_Hemanth\",\n+    \"F-111_Get_Organisation_Identifier_Dil\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1Mzc5Mg=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Njg1NDQ4OnYy", "diffSide": "RIGHT", "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/Without Organisation Context/S-111.2/S-111.2_Get_Case_Roles_for_Case_C1_AndC2.td.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo1Njo1M1rOHBnmfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMzo0MDo0M1rOHBpN3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1OTQ1Mg==", "bodyText": "Should this not be a CSV rather than repeat JSON properties?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471459452", "createdAt": "2020-08-17T12:56:53Z", "author": {"login": "mattnayler"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/Without Organisation Context/S-111.2/S-111.2_Get_Case_Roles_for_Case_C1_AndC2.td.json", "diffHunk": "@@ -0,0 +1,36 @@\n+{\n+  \"title\": \"Get Case-Assigned Users and Roles\",\n+\n+  \"_guid_\": \"S-111.2_Get_Case_Roles_for_Case_C1_And_C2\",\n+\n+  \"productName\": \"CCD Data Store\",\n+  \"operationName\": \"Get Case-Assigned Users and Roles\",\n+\n+  \"method\": \"GET\",\n+  \"uri\": \"/case-users\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"username\": \"befta.caseworker.caa@gmail.com\",\n+      \"password\": \"[[$CCD_BEFTA_CASEWORKER_CAA_PWD]]\"\n+    }\n+  },\n+\n+  \"request\": {\n+    \"_extends_\": \"Common_Request\",\n+    \"queryParams\": {\n+      \"case_ids\": \"${}${[scenarioContext][siblingContexts][S-111.2_Add_Case_Assigned_User_Roles_for_Case_C1_And_C2][testData][request][body][case_users][0][case_id]}\",\n+      \"case_ids\": \"${}${[scenarioContext][siblingContexts][S-111.2_Add_Case_Assigned_User_Roles_for_Case_C1_And_C2][testData][request][body][case_users][1][case_id]}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NTkxNw==", "bodyText": "REST API works for both", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471485917", "createdAt": "2020-08-17T13:40:43Z", "author": {"login": "smathangi"}, "path": "src/aat/resources/features/F-111 - Remove Case-Assigned Users and Roles/Without Organisation Context/S-111.2/S-111.2_Get_Case_Roles_for_Case_C1_AndC2.td.json", "diffHunk": "@@ -0,0 +1,36 @@\n+{\n+  \"title\": \"Get Case-Assigned Users and Roles\",\n+\n+  \"_guid_\": \"S-111.2_Get_Case_Roles_for_Case_C1_And_C2\",\n+\n+  \"productName\": \"CCD Data Store\",\n+  \"operationName\": \"Get Case-Assigned Users and Roles\",\n+\n+  \"method\": \"GET\",\n+  \"uri\": \"/case-users\",\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"username\": \"befta.caseworker.caa@gmail.com\",\n+      \"password\": \"[[$CCD_BEFTA_CASEWORKER_CAA_PWD]]\"\n+    }\n+  },\n+\n+  \"request\": {\n+    \"_extends_\": \"Common_Request\",\n+    \"queryParams\": {\n+      \"case_ids\": \"${}${[scenarioContext][siblingContexts][S-111.2_Add_Case_Assigned_User_Roles_for_Case_C1_And_C2][testData][request][body][case_users][0][case_id]}\",\n+      \"case_ids\": \"${}${[scenarioContext][siblingContexts][S-111.2_Add_Case_Assigned_User_Roles_for_Case_C1_And_C2][testData][request][body][case_users][1][case_id]}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1OTQ1Mg=="}, "originalCommit": {"oid": "42f5069b125e6f8b6a9acc169195d08614de7ff1"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzMxNjY4OnYy", "diffSide": "RIGHT", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo0ODoxMVrOHBr-Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo0ODoxMVrOHBr-Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzMTEwMw==", "bodyText": "typo here?", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1045#discussion_r471531103", "createdAt": "2020-08-17T14:48:11Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -36,6 +36,8 @@\n @Service\n public class CaseAccessOperation {\n \n+    public static final String ORGS_ASSIGNED_USERS_PAH = \"orgs_assigned_users.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "938d06c09fe78b3c168079e4005a1929ae23681e"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3787, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}