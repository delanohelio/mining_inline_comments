{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3ODQ5Mzk1", "number": 987, "title": "RDM-8606 Implement Add Case-Assigned User and Role", "bodyText": "JIRA link (if applicable)\nRDM-8606\nChange description\nImplement 'Add Case-Assigned User and Role'\nLLD: API Operation: Add Case-Assigned Users and Roles\nDoes this PR introduce a breaking change? (check one with \"x\")\n[ ] Yes\n[x] No", "createdAt": "2020-06-22T10:39:22Z", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987", "merged": true, "mergeCommit": {"oid": "0ab8b499ae98e02e2f12a24d769a089e57f2afc0"}, "closed": true, "closedAt": "2020-06-26T21:17:35Z", "author": {"login": "mattnayler"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqgWwPgH2gAyNDM3ODQ5Mzk1OjdiMGZiOGE0ODVjNmRiMDA1ZjQ3ODEyNjRlMzI0OGJjZmUzYjkzNGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvF75IAH2gAyNDM3ODQ5Mzk1OmNiNDA4YzhiNzEyNjBlYTFiZTkyNTU2NTg2OWRkOTVmNzQyZmQ5Nzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b0fb8a485c6db005f4781264e3248bcfe3b934c", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/7b0fb8a485c6db005f4781264e3248bcfe3b934c", "committedDate": "2020-06-12T10:32:43Z", "message": "RDM-8606 Implement Add Case-Assigned User and Role\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nFirst cut of code for draft PR without tests which are still in progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c54de6e29db42b5e4586a76216a1509f52abef3a", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c54de6e29db42b5e4586a76216a1509f52abef3a", "committedDate": "2020-06-17T08:24:33Z", "message": "RDM-8606 Tests for Add Case-Assigned User and Role\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cb85986c305803c5f32b5060492afe3c1a788b0", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1cb85986c305803c5f32b5060492afe3c1a788b0", "committedDate": "2020-06-18T08:41:07Z", "message": "Merge branch 'RDM-8606-from-8344' into RDM-8606\n\nConflicts:\n\tsrc/main/java/uk/gov/hmcts/ccd/v2/external/resource/CaseAssignedUserRolesResource.java\n\tsrc/main/resources/application.properties\n\tsrc/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerIT.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fabd5f0c85aa71bdea9ffca3c5cbf554428abfcd", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/fabd5f0c85aa71bdea9ffca3c5cbf554428abfcd", "committedDate": "2020-06-18T16:29:15Z", "message": "RDM-8606 accommodate OIDC changes to service name\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nChanges to retrieval of client service name after OIDC changes:-\n* Read service name directly from S2S Token,\n* Revert CaseAssignedUserRoleValidator code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d410656cec67ed1916d2e1aaa63fe468e531b3f9", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/d410656cec67ed1916d2e1aaa63fe468e531b3f9", "committedDate": "2020-06-19T15:44:50Z", "message": "RDM-8606 lookup case ID when adding case-user-role\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nConvert case reference to case ID when adding a case-use-role."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a54279da3957a493af09f8d1e69f355b2ab1a054", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a54279da3957a493af09f8d1e69f355b2ab1a054", "committedDate": "2020-06-22T10:29:21Z", "message": "RDM-8606 add Log Audit to get case-user-roles\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nAdd LogAudit config to getCaseUserRoles."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ac2e4f11598866c29782dd2231d1e7f7f1ccb41", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/2ac2e4f11598866c29782dd2231d1e7f7f1ccb41", "committedDate": "2020-06-22T12:11:58Z", "message": "RDM-8606 Minor updates for Sonar and Swagger\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\n* Address SonarCloud issues reported against tests.\n* Add NotFound scenario to add case-user-roles swagger config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c9f56ec4e15054795932d06199bd5184493a79f", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/8c9f56ec4e15054795932d06199bd5184493a79f", "committedDate": "2020-06-22T13:15:17Z", "message": "RDM-8606 Minor updates for Sonar\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nAddress SonarCloud issues reported against tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbc4b85bc26047eeafe90d541b2f459799c3e74c", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/cbc4b85bc26047eeafe90d541b2f459799c3e74c", "committedDate": "2020-06-25T10:39:25Z", "message": "RDM-8606 Minor updates for Swagger\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nAdd standard 401/403 scenarios to add case-user-roles swagger config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "399fcd10c834d375f5a667e3f92935028f0b2ab7", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/399fcd10c834d375f5a667e3f92935028f0b2ab7", "committedDate": "2020-06-25T12:25:22Z", "message": "Merge branch 'develop' into RDM-8606"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NDQ4NDcw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#pullrequestreview-437448470", "createdAt": "2020-06-25T12:36:43Z", "commit": {"oid": "cbc4b85bc26047eeafe90d541b2f459799c3e74c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjozNzowOVrOGo4pMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjozNzowOVrOGo4pMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUyNDI3Mg==", "bodyText": "You made me find out https://www.quora.com/What-does-the-abbreviation-N-B-mean-and-why-do-people-use-it. :)", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#discussion_r445524272", "createdAt": "2020-06-25T12:37:09Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/cauroles/AuthorisedCaseAssignedUserRolesOperation.java", "diffHunk": "@@ -23,6 +23,12 @@ public AuthorisedCaseAssignedUserRolesOperation(final @Qualifier(\"default\") Case\n         this.cauRoleValidator = cauRoleValidator;\n     }\n \n+    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+        // NB: Although there are no user based authorisation steps performed here ...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "399fcd10c834d375f5a667e3f92935028f0b2ab7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NDU1NjQz", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#pullrequestreview-437455643", "createdAt": "2020-06-25T12:45:56Z", "commit": {"oid": "cbc4b85bc26047eeafe90d541b2f459799c3e74c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjo0NzoyMVrOGo5AjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjo0NzoyMVrOGo5AjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUzMDI1Mw==", "bodyText": "Calling caseDetailsRepository.findByReference again and again for every distinct case reference may not be performant enough in for a call sending case role assignments for many distinct cases, but as per the current non-functional requirements, we can still accept this.", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#discussion_r445530253", "createdAt": "2020-06-25T12:47:21Z", "author": {"login": "MSancaktutar"}, "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -104,6 +122,15 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n             .collect(Collectors.toCollection(ArrayList::new));\n     }\n \n+    private List<CaseDetails> getCaseDetailsList(List<Long> caseReferences) {\n+        return caseReferences.stream()\n+            .map(caseReference -> {\n+                Optional<CaseDetails> caseDetails = caseDetailsRepository.findByReference(null, caseReference);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "399fcd10c834d375f5a667e3f92935028f0b2ab7"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NDU4Nzgw", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#pullrequestreview-437458780", "createdAt": "2020-06-25T12:49:52Z", "commit": {"oid": "399fcd10c834d375f5a667e3f92935028f0b2ab7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c92fa7c215dda5853c4ec610fecd1cda7879660", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/8c92fa7c215dda5853c4ec610fecd1cda7879660", "committedDate": "2020-06-25T14:26:12Z", "message": "RDM-8606 Change success API status to 201:CREATED\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nUse 201:CREATED HTTP status for success calls to add case-user-roles."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NTU4Mzcy", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#pullrequestreview-437558372", "createdAt": "2020-06-25T14:35:41Z", "commit": {"oid": "8c92fa7c215dda5853c4ec610fecd1cda7879660"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01b1a890b2737528fb10563daf7af1bd8a88ccf0", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/01b1a890b2737528fb10563daf7af1bd8a88ccf0", "committedDate": "2020-06-25T14:56:55Z", "message": "RDM-8806 FTA for 'Add Case-Assigned User and Role'\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)\n\nFTA for 'Add Case-Assigned User and Role' (Dev ticket is RDM-8606)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe78b62d90de97a87a95b530964fcb6d0017098b", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/fe78b62d90de97a87a95b530964fcb6d0017098b", "committedDate": "2020-06-25T16:07:07Z", "message": "use latest fw version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "effda29ab197cbca7c68d51fd0c5e757ac2e2dc4", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/effda29ab197cbca7c68d51fd0c5e757ac2e2dc4", "committedDate": "2020-06-25T16:08:09Z", "message": "Merge branch 'RDM-8606' into RDM-8806-from-8606\n\nConflicts:\n\tbuild.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5289bb64f5d6594c5ac6850abeaa331b1f37365", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a5289bb64f5d6594c5ac6850abeaa331b1f37365", "committedDate": "2020-06-26T11:31:11Z", "message": "use empty string notation with fw prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a43bbfc964e90cf7981b9130db78e531b9a2da1", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/5a43bbfc964e90cf7981b9130db78e531b9a2da1", "committedDate": "2020-06-26T12:06:21Z", "message": "correct empty string notations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1308199e6370b8a6ee687a6515c30bedeb585731", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1308199e6370b8a6ee687a6515c30bedeb585731", "committedDate": "2020-06-26T12:12:32Z", "message": "correct use of empty string notations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3123bc24294f5b9fb947f95fd7a7a48af9c7c02a", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/3123bc24294f5b9fb947f95fd7a7a48af9c7c02a", "committedDate": "2020-06-26T12:41:26Z", "message": "use corrected prerelease"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ec153f01e0dc15d93f5bb52b79bccf24721dff3", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/9ec153f01e0dc15d93f5bb52b79bccf24721dff3", "committedDate": "2020-06-26T12:41:37Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c804a760482139be8a2e7085d8f982db2cc563b7", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/c804a760482139be8a2e7085d8f982db2cc563b7", "committedDate": "2020-06-26T13:05:28Z", "message": "fix copy paste mistake"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7b426ffafddbf0de0289a4e5f0c1f5ba56f8828", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/e7b426ffafddbf0de0289a4e5f0c1f5ba56f8828", "committedDate": "2020-06-26T13:08:34Z", "message": "use latest stable fw release"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d216909ac6ee3857bd77d9a6d4f4b92cfbd368a", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/2d216909ac6ee3857bd77d9a6d4f4b92cfbd368a", "committedDate": "2020-06-26T13:57:05Z", "message": "RDM-8806 dev review changes\n\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b44ad73c64cde802e81e934e5720bdd809d72fe5", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/b44ad73c64cde802e81e934e5720bdd809d72fe5", "committedDate": "2020-06-26T14:33:10Z", "message": "improve data reuse from base objects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f2798d93dd30d70a03c0edf6019a0ed411b80af", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/9f2798d93dd30d70a03c0edf6019a0ed411b80af", "committedDate": "2020-06-26T14:46:15Z", "message": "polish format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f83138999395c3d21ee554dfc9d8fb965f5edc7d", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/f83138999395c3d21ee554dfc9d8fb965f5edc7d", "committedDate": "2020-06-26T14:59:09Z", "message": "correct the field name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a8d0db53ef5d068b766e84ef74e7cbf95ffc5a2", "author": {"user": {"login": "mattnayler", "name": "Matt Nayler"}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/1a8d0db53ef5d068b766e84ef74e7cbf95ffc5a2", "committedDate": "2020-06-26T15:12:57Z", "message": "RDM-8606 Minor updates for Swagger\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nRemove default 200 repsonse status from add case-user-roles swagger."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00355aab639f70af21345e401c487509c1ceb63c", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/00355aab639f70af21345e401c487509c1ceb63c", "committedDate": "2020-06-26T15:20:20Z", "message": "correct product name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a126034e307b12e089e4151827c65a00c488e4d6", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/a126034e307b12e089e4151827c65a00c488e4d6", "committedDate": "2020-06-26T15:21:08Z", "message": "Merge branch 'RDM-8806-from-8606' of git@github.com:hmcts/ccd-data-store-api.git into RDM-8806-from-8606"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01aea69cc74db7c18732fdd09fb8391233b2cca3", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/01aea69cc74db7c18732fdd09fb8391233b2cca3", "committedDate": "2020-06-26T15:40:40Z", "message": "fix oper name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb408c8b71260ea1be925565869dd95f742fd977", "author": {"user": {"login": "MSancaktutar", "name": null}}, "url": "https://github.com/hmcts/ccd-data-store-api/commit/cb408c8b71260ea1be925565869dd95f742fd977", "committedDate": "2020-06-26T16:35:28Z", "message": "Merge pull request #993 from hmcts/RDM-8806-from-8606\n\nRDM-8806 FTA for 'Add Case-Assigned User and Role'"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2790, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}