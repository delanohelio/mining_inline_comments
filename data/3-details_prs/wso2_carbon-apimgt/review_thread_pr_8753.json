{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NDkzMjQ1", "number": 8753, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNTo0NFrOEFgg_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjo0MlrOEFgiQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjExMDcwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNTo0NFrOGjvRiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNTo0NFrOGjvRiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyNzg4MA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440127880", "createdAt": "2020-06-15T12:05:44Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10796,6 +10806,27 @@ public static KeyManagerConfigurationDTO getAndSetDefaultKeyManagerConfiguration\n                 APIConstants.KeyManager.CLAIM_MAPPING)){\n             keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CLAIM_MAPPING, getDefaultClaimMappings());\n         }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_TYPE)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjExMTg1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjowNFrOGjvSTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjowNFrOGjvSTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODA3Ng==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128076", "createdAt": "2020-06-15T12:06:04Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10796,6 +10806,27 @@ public static KeyManagerConfigurationDTO getAndSetDefaultKeyManagerConfiguration\n                 APIConstants.KeyManager.CLAIM_MAPPING)){\n             keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CLAIM_MAPPING, getDefaultClaimMappings());\n         }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_TYPE)){\n+            keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CERTIFICATE_TYPE,\n+                    APIConstants.KeyManager.CERTIFICATE_TYPE_PEM_FILE);\n+        }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_VALUE)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjExMjI1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoxMlrOGjvSjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoxMlrOGjvSjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODE0Mw==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128143", "createdAt": "2020-06-15T12:06:12Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10796,6 +10806,27 @@ public static KeyManagerConfigurationDTO getAndSetDefaultKeyManagerConfiguration\n                 APIConstants.KeyManager.CLAIM_MAPPING)){\n             keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CLAIM_MAPPING, getDefaultClaimMappings());\n         }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_TYPE)){\n+            keyManagerConfigurationDTO.addProperty(APIConstants.KeyManager.CERTIFICATE_TYPE,\n+                    APIConstants.KeyManager.CERTIFICATE_TYPE_PEM_FILE);\n+        }\n+        if (!keyManagerConfigurationDTO.getAdditionalProperties().containsKey(APIConstants.KeyManager.CERTIFICATE_VALUE)){\n+            try {\n+                Certificate certificate = CertificateMgtUtils.getInstance()\n+                        .getPublicCertificate(keyManagerConfigurationDTO.getTenantDomain());\n+                String x509certificateContent = null;\n+                if (certificate != null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjExMjk5OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoyNFrOGjvS-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjoyNFrOGjvS-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODI1MQ==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128251", "createdAt": "2020-06-15T12:06:24Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "diffHunk": "@@ -92,10 +93,19 @@ public static KeyManagerDTO toKeyManagerDTO(KeyManagerConfigurationDTO keyManage\n             keyManagerDTO.setIssuer(issuerElement.getAsString());\n             jsonObject.remove(APIConstants.KeyManager.ISSUER);\n         }\n-        JsonElement jwksEndpointElement = jsonObject.get(APIConstants.KeyManager.JWKS_ENDPOINT);\n-        if (jwksEndpointElement != null) {\n-            keyManagerDTO.setJwksEndpoint(jwksEndpointElement.getAsString());\n-            jsonObject.remove(APIConstants.KeyManager.JWKS_ENDPOINT);\n+        JsonElement certificateValueElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_VALUE);\n+        JsonElement certificateTypeElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_TYPE);\n+        if (certificateTypeElement != null && certificateValueElement != null) {\n+            KeyManagerCertificatesDTO keyManagerCertificatesDTO = new KeyManagerCertificatesDTO();\n+            keyManagerCertificatesDTO.setValue(certificateValueElement.getAsString());\n+            if (APIConstants.KeyManager.CERTIFICATE_TYPE_JWKS_ENDPOINT.equals(certificateTypeElement.getAsString())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjExMzM0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjozM1rOGjvTQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjozM1rOGjvTQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODMyMA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128320", "createdAt": "2020-06-15T12:06:33Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "diffHunk": "@@ -92,10 +93,19 @@ public static KeyManagerDTO toKeyManagerDTO(KeyManagerConfigurationDTO keyManage\n             keyManagerDTO.setIssuer(issuerElement.getAsString());\n             jsonObject.remove(APIConstants.KeyManager.ISSUER);\n         }\n-        JsonElement jwksEndpointElement = jsonObject.get(APIConstants.KeyManager.JWKS_ENDPOINT);\n-        if (jwksEndpointElement != null) {\n-            keyManagerDTO.setJwksEndpoint(jwksEndpointElement.getAsString());\n-            jsonObject.remove(APIConstants.KeyManager.JWKS_ENDPOINT);\n+        JsonElement certificateValueElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_VALUE);\n+        JsonElement certificateTypeElement = jsonObject.get(APIConstants.KeyManager.CERTIFICATE_TYPE);\n+        if (certificateTypeElement != null && certificateValueElement != null) {\n+            KeyManagerCertificatesDTO keyManagerCertificatesDTO = new KeyManagerCertificatesDTO();\n+            keyManagerCertificatesDTO.setValue(certificateValueElement.getAsString());\n+            if (APIConstants.KeyManager.CERTIFICATE_TYPE_JWKS_ENDPOINT.equals(certificateTypeElement.getAsString())){\n+                keyManagerCertificatesDTO.setType(KeyManagerCertificatesDTO.TypeEnum.JWKS);\n+            }else if (APIConstants.KeyManager.CERTIFICATE_TYPE_PEM_FILE.equals(certificateTypeElement.getAsString())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjExMzk0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjo0M1rOGjvTmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjowNjo0M1rOGjvTmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEyODQxMA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8753#discussion_r440128410", "createdAt": "2020-06-15T12:06:43Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/KeyManagerMappingUtil.java", "diffHunk": "@@ -201,8 +211,16 @@ public static KeyManagerConfigurationDTO toKeyManagerConfigurationDTO(String ten\n         if (StringUtils.isNotEmpty(keyManagerDTO.getIssuer())) {\n             additionalProperties.put(APIConstants.KeyManager.ISSUER, keyManagerDTO.getIssuer());\n         }\n-        if (StringUtils.isNotEmpty(keyManagerDTO.getJwksEndpoint())) {\n-            additionalProperties.put(APIConstants.KeyManager.JWKS_ENDPOINT, keyManagerDTO.getJwksEndpoint());\n+        if (keyManagerDTO.getCertificates() != null) {\n+            additionalProperties.put(APIConstants.KeyManager.CERTIFICATE_VALUE,\n+                    keyManagerDTO.getCertificates().getValue());\n+            if (KeyManagerCertificatesDTO.TypeEnum.JWKS.equals(keyManagerDTO.getCertificates().getType())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c38102c3f7ccf96deb6921daade400dc2a3240f"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3265, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}