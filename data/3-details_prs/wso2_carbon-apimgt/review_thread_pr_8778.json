{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzQ2ODUz", "number": 8778, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTowOVrOEGrJsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTo0NVrOEGrKaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDMzOTA2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTowOVrOGlnY6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMzo1M1rOGlnesQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTg0OQ==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442095849", "createdAt": "2020-06-18T09:31:09Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "diffHunk": "@@ -252,8 +254,26 @@ private APIKeyValidationInfoDTO validateSubscriptionDetails(APIKeyValidationInfo\n \n                                 ApplicationPolicy appPolicy = datastore.getApplicationPolicyByName(app.getPolicy(),\n                                         tenantId);\n+                                if(appPolicy == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NzMyOQ==", "bodyText": "done", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442097329", "createdAt": "2020-06-18T09:33:53Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "diffHunk": "@@ -252,8 +254,26 @@ private APIKeyValidationInfoDTO validateSubscriptionDetails(APIKeyValidationInfo\n \n                                 ApplicationPolicy appPolicy = datastore.getApplicationPolicyByName(app.getPolicy(),\n                                         tenantId);\n+                                if(appPolicy == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTg0OQ=="}, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDMzOTQ4OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMToxOVrOGlnZOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMzo0MlrOGlneTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTkzMA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442095930", "createdAt": "2020-06-18T09:31:19Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "diffHunk": "@@ -252,8 +254,26 @@ private APIKeyValidationInfoDTO validateSubscriptionDetails(APIKeyValidationInfo\n \n                                 ApplicationPolicy appPolicy = datastore.getApplicationPolicyByName(app.getPolicy(),\n                                         tenantId);\n+                                if(appPolicy == null) {\n+                                    try {\n+                                        appPolicy = new SubscriptionDataLoaderImpl()\n+                                                .getApplicationPolicy(app.getPolicy(), apiTenantDomain);\n+                                        datastore.addOrUpdateApplicationPolicy(appPolicy);\n+                                    } catch (DataLoadingException e) {\n+                                        log.error(\"Error while loading ApplicationPolicy\");\n+                                    }\n+                                }\n                                 SubscriptionPolicy subPolicy = datastore.getSubscriptionPolicyByName(sub.getPolicyId(),\n                                         tenantId);\n+                                if(subPolicy == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NzIyOQ==", "bodyText": "done", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442097229", "createdAt": "2020-06-18T09:33:42Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "diffHunk": "@@ -252,8 +254,26 @@ private APIKeyValidationInfoDTO validateSubscriptionDetails(APIKeyValidationInfo\n \n                                 ApplicationPolicy appPolicy = datastore.getApplicationPolicyByName(app.getPolicy(),\n                                         tenantId);\n+                                if(appPolicy == null) {\n+                                    try {\n+                                        appPolicy = new SubscriptionDataLoaderImpl()\n+                                                .getApplicationPolicy(app.getPolicy(), apiTenantDomain);\n+                                        datastore.addOrUpdateApplicationPolicy(appPolicy);\n+                                    } catch (DataLoadingException e) {\n+                                        log.error(\"Error while loading ApplicationPolicy\");\n+                                    }\n+                                }\n                                 SubscriptionPolicy subPolicy = datastore.getSubscriptionPolicyByName(sub.getPolicyId(),\n                                         tenantId);\n+                                if(subPolicy == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTkzMA=="}, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDM0MDg4OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/service/APIKeyValidationService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTo0NVrOGlnaLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMzo0N1rOGlnefw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NjE3Mg==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442096172", "createdAt": "2020-06-18T09:31:45Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/service/APIKeyValidationService.java", "diffHunk": "@@ -344,6 +347,19 @@ public APIKeyValidationInfoDTO validateKey(String context, String version, Strin\n             if (storeImpl.isApiPoliciesInitialized()) {\r\n                 log.debug(\"SubscriptionDataStore Initialized. Reading API Policies from SubscriptionDataStore\");\r\n                 apiPolicy = store.getApiPolicyByName(urlMapping.getThrottlingPolicy(), apiTenantId);\r\n+                if(apiPolicy == null) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NzI3OQ==", "bodyText": "done", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442097279", "createdAt": "2020-06-18T09:33:47Z", "author": {"login": "chamilaadhi"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/service/APIKeyValidationService.java", "diffHunk": "@@ -344,6 +347,19 @@ public APIKeyValidationInfoDTO validateKey(String context, String version, Strin\n             if (storeImpl.isApiPoliciesInitialized()) {\r\n                 log.debug(\"SubscriptionDataStore Initialized. Reading API Policies from SubscriptionDataStore\");\r\n                 apiPolicy = store.getApiPolicyByName(urlMapping.getThrottlingPolicy(), apiTenantId);\r\n+                if(apiPolicy == null) {\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NjE3Mg=="}, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3282, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}