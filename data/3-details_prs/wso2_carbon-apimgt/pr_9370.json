{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzY0Nzky", "number": 9370, "title": "Add original role to the role mapping list in tenant.conf", "bodyText": "As $subject this will append the original role also to the role mapping list in the tenant.conf.\nFixes wso2/product-apim#9152", "createdAt": "2020-11-08T20:23:43Z", "url": "https://github.com/wso2/carbon-apimgt/pull/9370", "merged": true, "mergeCommit": {"oid": "911cba480b244758c2182d79828baf2336960a18"}, "closed": true, "closedAt": "2020-11-18T05:36:34Z", "author": {"login": "chashikajw"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdamAzQAH2gAyNTE3MzY0NzkyOmI3OTI2NjQ1Y2RmNDc1NWI3ODhlOTM1MjBlOWY5NTYyNjY0MmIyYzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd0x9wbAFqTU3ODk0MDM4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b7926645cdf4755b788e93520e9f95626642b2c0", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b7926645cdf4755b788e93520e9f95626642b2c0", "committedDate": "2020-11-08T20:16:32Z", "message": "add original role to role mapping list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzUyMzcx", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#pullrequestreview-528752371", "createdAt": "2020-11-12T05:06:24Z", "commit": {"oid": "7238b8ba1e6b8581d28ed32cbd37b8523546546a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzUyNTky", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#pullrequestreview-528752592", "createdAt": "2020-11-12T05:07:07Z", "commit": {"oid": "7238b8ba1e6b8581d28ed32cbd37b8523546546a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzowN1rOHxqtGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzowN1rOHxqtGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0MTk0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                isOriginalRoleAlreadyInroles = true;\n          \n          \n            \n                                isOriginalRoleAlreadyInRoles = true;", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r521841947", "createdAt": "2020-11-12T05:07:07Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11614,6 +11614,25 @@ public static void updateTenantConfRoleAliasMapping(JSONObject newRoleMappingJso\n         } catch (UserStoreException e) {\n             APIUtil.handleException(\"Couldn't read tenant configuration from User Store\", e);\n         }\n+\n+        //append original role to the role mapping list\n+        Set<Map.Entry<String, JsonElement>> roleMappingEntries = newRoleMappingJson.entrySet();\n+        for (Map.Entry<String, JsonElement> entry: roleMappingEntries) {\n+            List<String> currentRoles = Arrays.asList(String.valueOf(entry.getValue()).split(\",\"));\n+            boolean isOriginalRoleAlreadyInroles = false;\n+            for (String role: currentRoles) {\n+                if (role.equals(entry.getKey())) {\n+                    isOriginalRoleAlreadyInroles = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7238b8ba1e6b8581d28ed32cbd37b8523546546a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzUyNjQy", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#pullrequestreview-528752642", "createdAt": "2020-11-12T05:07:17Z", "commit": {"oid": "7238b8ba1e6b8581d28ed32cbd37b8523546546a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzoxOFrOHxqtPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzoxOFrOHxqtPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0MTk4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (!isOriginalRoleAlreadyInroles) {\n          \n          \n            \n                        if (!isOriginalRoleAlreadyInRoles) {", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r521841982", "createdAt": "2020-11-12T05:07:18Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11614,6 +11614,25 @@ public static void updateTenantConfRoleAliasMapping(JSONObject newRoleMappingJso\n         } catch (UserStoreException e) {\n             APIUtil.handleException(\"Couldn't read tenant configuration from User Store\", e);\n         }\n+\n+        //append original role to the role mapping list\n+        Set<Map.Entry<String, JsonElement>> roleMappingEntries = newRoleMappingJson.entrySet();\n+        for (Map.Entry<String, JsonElement> entry: roleMappingEntries) {\n+            List<String> currentRoles = Arrays.asList(String.valueOf(entry.getValue()).split(\",\"));\n+            boolean isOriginalRoleAlreadyInroles = false;\n+            for (String role: currentRoles) {\n+                if (role.equals(entry.getKey())) {\n+                    isOriginalRoleAlreadyInroles = true;\n+                    break;\n+                }\n+            }\n+\n+            if (!isOriginalRoleAlreadyInroles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7238b8ba1e6b8581d28ed32cbd37b8523546546a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzYyMzIz", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#pullrequestreview-528762323", "createdAt": "2020-11-12T05:36:43Z", "commit": {"oid": "bb8af196a77c4fd333cffda945154da09380f42a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTozNjo0M1rOHxrQSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTozNjo0M1rOHxrQSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg1MDk1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        boolean isOriginalRoleAlreadyInroles = false;\n          \n          \n            \n                        boolean isOriginalRoleAlreadyInRoles = false;", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r521850955", "createdAt": "2020-11-12T05:36:43Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11614,6 +11614,25 @@ public static void updateTenantConfRoleAliasMapping(JSONObject newRoleMappingJso\n         } catch (UserStoreException e) {\n             APIUtil.handleException(\"Couldn't read tenant configuration from User Store\", e);\n         }\n+\n+        //append original role to the role mapping list\n+        Set<Map.Entry<String, JsonElement>> roleMappingEntries = newRoleMappingJson.entrySet();\n+        for (Map.Entry<String, JsonElement> entry: roleMappingEntries) {\n+            List<String> currentRoles = Arrays.asList(String.valueOf(entry.getValue()).split(\",\"));\n+            boolean isOriginalRoleAlreadyInroles = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb8af196a77c4fd333cffda945154da09380f42a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "862800cb864c581200b6760705ca39a8389a9c4e", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/862800cb864c581200b6760705ca39a8389a9c4e", "committedDate": "2020-11-18T04:53:00Z", "message": "change variaable case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45da7a834c22cf782f471911aa5fe917c9fd2e7f", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/45da7a834c22cf782f471911aa5fe917c9fd2e7f", "committedDate": "2020-11-18T04:53:13Z", "message": "Update components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n\nCo-authored-by: Malintha Amarasinghe <malintha.prasan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcea49d00fd6af18e51f829ad5b3a2c9c920cc5f", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/dcea49d00fd6af18e51f829ad5b3a2c9c920cc5f", "committedDate": "2020-11-18T04:53:37Z", "message": "Update components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n\nCo-authored-by: Malintha Amarasinghe <malintha.prasan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9988c2858f986fc7b501a70d0fc3c87d971c4c1", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e9988c2858f986fc7b501a70d0fc3c87d971c4c1", "committedDate": "2020-11-18T04:53:51Z", "message": "Update components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n\nCo-authored-by: Malintha Amarasinghe <malintha.prasan@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64e4835e6e21957933c6aa2bc36a67c4609284d9", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/64e4835e6e21957933c6aa2bc36a67c4609284d9", "committedDate": "2020-11-18T04:14:11Z", "message": "Merge branch 'fix-role-mapping' of https://github.com/chashikajw/carbon-apimgt into fix-role-mapping"}, "afterCommit": {"oid": "e9988c2858f986fc7b501a70d0fc3c87d971c4c1", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e9988c2858f986fc7b501a70d0fc3c87d971c4c1", "committedDate": "2020-11-18T04:53:51Z", "message": "Update components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n\nCo-authored-by: Malintha Amarasinghe <malintha.prasan@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "072b4f56812174cdd5bb57a831350f741162e9bb", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/072b4f56812174cdd5bb57a831350f741162e9bb", "committedDate": "2020-11-18T05:08:40Z", "message": "Merge branch 'master' into fix-role-mapping"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTE2ODc2", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#pullrequestreview-533116876", "createdAt": "2020-11-18T05:36:27Z", "commit": {"oid": "072b4f56812174cdd5bb57a831350f741162e9bb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc4OTQwMzg4", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#pullrequestreview-578940388", "createdAt": "2021-01-29T04:53:54Z", "commit": {"oid": "072b4f56812174cdd5bb57a831350f741162e9bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNDo1Mzo1NFrOIcVNig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNDo1Mzo1NFrOIcVNig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU3ODU3MA==", "bodyText": "Shall we remove this extra line?", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r566578570", "createdAt": "2021-01-29T04:53:54Z", "author": {"login": "kavishkafernando"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11752,6 +11771,7 @@ public static boolean isCrossTenantSubscriptionsEnabled() {\n         return false;\n     }\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "072b4f56812174cdd5bb57a831350f741162e9bb"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3087, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}