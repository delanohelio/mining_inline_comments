{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NDA2Njg2", "number": 8510, "title": "Add validation for existing registry name", "bodyText": "", "createdAt": "2020-05-15T06:41:57Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8510", "merged": true, "mergeCommit": {"oid": "5fc1ab0cf47d652e98aeaab509f688da6557fb9f"}, "closed": true, "closedAt": "2020-05-15T08:52:28Z", "author": {"login": "fazlan-nazeem"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchcQp7gH2gAyNDE4NDA2Njg2OmE4Mzg5OWY5MTFiN2NiMzZkMzJlODhlZTM0ODMzOGEyYzI3YzVkNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcheImsAFqTQxMjQ2NDM0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a83899f911b7cb36d32e88ee348338a2c27c5d57", "author": {"user": {"login": "fazlan-nazeem", "name": "Fazlan Nazeem"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a83899f911b7cb36d32e88ee348338a2c27c5d57", "committedDate": "2020-05-15T06:41:07Z", "message": "Add validation for existing registry name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDM3Mzcx", "url": "https://github.com/wso2/carbon-apimgt/pull/8510#pullrequestreview-412437371", "createdAt": "2020-05-15T08:13:20Z", "commit": {"oid": "a83899f911b7cb36d32e88ee348338a2c27c5d57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoxMzoyMFrOGV66SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoxMzoyMFrOGV66SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTYzODQ3Mg==", "bodyText": "I think when the registry name already exists in DB, it will throw 500, internal server error response. If so we need to change it to 409 Resource already exists", "url": "https://github.com/wso2/carbon-apimgt/pull/8510#discussion_r425638472", "createdAt": "2020-05-15T08:13:20Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java", "diffHunk": "@@ -191,10 +191,29 @@ public void deleteEndpointRegistryEntry(String entryId) throws APIManagementExce\n     /**\n      * {@inheritDoc}\n      */\n-    public void updateEndpointRegistry(String registryId, EndpointRegistryInfo endpointRegistryInfo) throws\n-            APIManagementException {\n+    public void updateEndpointRegistry(String registryId, String registryName, EndpointRegistryInfo\n+            endpointRegistryInfo) throws APIManagementException {\n+\n+        String tenantDomain = MultitenantUtils\n+                .getTenantDomain(APIUtil.replaceEmailDomainBack(endpointRegistryInfo.getOwner()));\n+        int tenantId;\n+        try {\n+            tenantId = ServiceReferenceHolder.getInstance().getRealmService().getTenantManager()\n+                    .getTenantId(tenantDomain);\n+            // if another registry with the updated name already exists, fail the operation.\n+            if (!registryName.equals(endpointRegistryInfo.getName()) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83899f911b7cb36d32e88ee348338a2c27c5d57"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1567b27623e42b41ccff89175c890d9c6ee2c22", "author": {"user": {"login": "fazlan-nazeem", "name": "Fazlan Nazeem"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e1567b27623e42b41ccff89175c890d9c6ee2c22", "committedDate": "2020-05-15T08:50:00Z", "message": "Catch resource already exists exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDY0MzQ2", "url": "https://github.com/wso2/carbon-apimgt/pull/8510#pullrequestreview-412464346", "createdAt": "2020-05-15T08:52:09Z", "commit": {"oid": "e1567b27623e42b41ccff89175c890d9c6ee2c22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2743, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}