{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NTYwMzMy", "number": 8514, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjo1NTozMlrOD83CYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzowMDozN1rOD83JWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MTQyODgzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjo1NTozMlrOGWDqJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwMzo1Njo0NFrOGWmzOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4MTc5OA==", "bodyText": "Shall we add this to a method so that can be reused in the updateRegistryEntry method", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r425781798", "createdAt": "2020-05-15T12:55:32Z", "author": {"login": "ChamodDamitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -197,15 +200,24 @@ public Response createRegistryEntry(String registryId, RegistryEntryDTO registry\n                             \"definition url: \" + registryEntry.getDefinitionUrl() + \" given for the new \" +\n                             \"Endpoint Registry with Registry Id: \" + registryId, e, log);\n                 }\n-                definitionFile = new ResourceFile(null, null);\n             } else {\n                 if (!isValidEndpointDefinition(null, definitionFileInputStream,\n                         registryEntry.getDefinitionType().toString())) {\n                     RestApiUtil.handleBadRequest(\"Error while validating the endpoint definition of \" +\n                             \"the new registry entry with registry id: \" + registryId, log);\n                 }\n-                definitionFile = new ResourceFile(definitionFileInputStream, definitionFileDetail\n-                        .getContentType().getType());\n+                if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(registryEntry.getDefinitionType())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1NzU2Mw==", "bodyText": "Yes. fixed in 247029c", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r426357563", "createdAt": "2020-05-18T03:56:44Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -197,15 +200,24 @@ public Response createRegistryEntry(String registryId, RegistryEntryDTO registry\n                             \"definition url: \" + registryEntry.getDefinitionUrl() + \" given for the new \" +\n                             \"Endpoint Registry with Registry Id: \" + registryId, e, log);\n                 }\n-                definitionFile = new ResourceFile(null, null);\n             } else {\n                 if (!isValidEndpointDefinition(null, definitionFileInputStream,\n                         registryEntry.getDefinitionType().toString())) {\n                     RestApiUtil.handleBadRequest(\"Error while validating the endpoint definition of \" +\n                             \"the new registry entry with registry id: \" + registryId, log);\n                 }\n-                definitionFile = new ResourceFile(definitionFileInputStream, definitionFileDetail\n-                        .getContentType().getType());\n+                if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(registryEntry.getDefinitionType())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4MTc5OA=="}, "originalCommit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MTQ0NjY3OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzowMDozN1rOGWD1nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwMzo1NjozMlrOGWmzFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4NDczMg==", "bodyText": "when endpointDefinition == null, need to throw an error response right?", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r425784732", "createdAt": "2020-05-15T13:00:37Z", "author": {"login": "ChamodDamitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -456,4 +481,39 @@ private boolean isValidEndpointDefinition(URL definitionURL, InputStream definit\n         return isValid;\n     }\n \n+    @Override\n+    public Response getEndpointDefinition(String registryId, String entryId, MessageContext messageContext) {\n+        String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+        String contentType = StringUtils.EMPTY;\n+        EndpointRegistry registryProvider = new EndpointRegistryImpl();\n+        InputStream endpointDefinition = null;\n+        try {\n+            EndpointRegistryInfo endpointRegistry = registryProvider.getEndpointRegistryByUUID(registryId, tenantDomain);\n+            if (endpointRegistry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry with the id: \" + registryId +\n+                        \" is not found\", log);\n+            }\n+            EndpointRegistryEntry registryEntry = registryProvider.getEndpointRegistryEntryByUUID(registryId, entryId);\n+            if (registryEntry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry entry with the id: \" + entryId +\n+                        \" is not found\", log);\n+            }\n+            String type = registryEntry.getDefinitionType();\n+            if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(RegistryEntryDTO.DefinitionTypeEnum.fromValue(type))\n+                    || RegistryEntryDTO.DefinitionTypeEnum.GQL_SDL.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type))) {\n+                contentType = MediaType.APPLICATION_JSON;\n+            } else if (RegistryEntryDTO.DefinitionTypeEnum.WSDL1.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type)) || RegistryEntryDTO.DefinitionTypeEnum.WSDL2.equals(RegistryEntryDTO\n+                    .DefinitionTypeEnum.fromValue(type))) {\n+                contentType = MediaType.TEXT_XML;\n+            }\n+            endpointDefinition = registryEntry.getEndpointDefinition();\n+        } catch (APIManagementException e) {\n+            RestApiUtil.handleInternalServerError(\"Error while retrieving the endpoint definition of registry \" +\n+                    \"entry with id: \" + entryId, e, log);\n+        }\n+        return Response.ok(endpointDefinition).type(contentType).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM1NzUyNg==", "bodyText": "Fixed in 247029c", "url": "https://github.com/wso2/carbon-apimgt/pull/8514#discussion_r426357526", "createdAt": "2020-05-18T03:56:32Z", "author": {"login": "vithu30"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -456,4 +481,39 @@ private boolean isValidEndpointDefinition(URL definitionURL, InputStream definit\n         return isValid;\n     }\n \n+    @Override\n+    public Response getEndpointDefinition(String registryId, String entryId, MessageContext messageContext) {\n+        String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+        String contentType = StringUtils.EMPTY;\n+        EndpointRegistry registryProvider = new EndpointRegistryImpl();\n+        InputStream endpointDefinition = null;\n+        try {\n+            EndpointRegistryInfo endpointRegistry = registryProvider.getEndpointRegistryByUUID(registryId, tenantDomain);\n+            if (endpointRegistry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry with the id: \" + registryId +\n+                        \" is not found\", log);\n+            }\n+            EndpointRegistryEntry registryEntry = registryProvider.getEndpointRegistryEntryByUUID(registryId, entryId);\n+            if (registryEntry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry entry with the id: \" + entryId +\n+                        \" is not found\", log);\n+            }\n+            String type = registryEntry.getDefinitionType();\n+            if (RegistryEntryDTO.DefinitionTypeEnum.OAS.equals(RegistryEntryDTO.DefinitionTypeEnum.fromValue(type))\n+                    || RegistryEntryDTO.DefinitionTypeEnum.GQL_SDL.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type))) {\n+                contentType = MediaType.APPLICATION_JSON;\n+            } else if (RegistryEntryDTO.DefinitionTypeEnum.WSDL1.equals(RegistryEntryDTO.DefinitionTypeEnum\n+                    .fromValue(type)) || RegistryEntryDTO.DefinitionTypeEnum.WSDL2.equals(RegistryEntryDTO\n+                    .DefinitionTypeEnum.fromValue(type))) {\n+                contentType = MediaType.TEXT_XML;\n+            }\n+            endpointDefinition = registryEntry.getEndpointDefinition();\n+        } catch (APIManagementException e) {\n+            RestApiUtil.handleInternalServerError(\"Error while retrieving the endpoint definition of registry \" +\n+                    \"entry with id: \" + entryId, e, log);\n+        }\n+        return Response.ok(endpointDefinition).type(contentType).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc4NDczMg=="}, "originalCommit": {"oid": "695d9ffcc33a1837feb2d4616ccd7327cbbcd5fc"}, "originalPosition": 164}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3396, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}