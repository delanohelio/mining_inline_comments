{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0MzgxMDAz", "number": 9012, "title": "Fix migration issues with swagger security schemes", "bodyText": "Fixes wso2/product-apim#8724 and wso2/product-apim#8748", "createdAt": "2020-07-21T10:51:09Z", "url": "https://github.com/wso2/carbon-apimgt/pull/9012", "merged": true, "mergeCommit": {"oid": "c9c1b09e0d4b793ee2ad22c90952b933fabdb617"}, "closed": true, "closedAt": "2020-07-22T04:31:18Z", "author": {"login": "msm1992"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3D4VjAH2gAyNDU0MzgxMDAzOjEwMjhlYWYwZGY5ZDFmNmM5MDJlOWFkMjhkOGRkNzE4MmY3ODI0Zjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3TJNFAFqTQ1Mjk4NjM0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1028eaf0df9d1f6c902e9ad28d8dd7182f7824f7", "author": {"user": {"login": "msm1992", "name": "Sachini De Silva"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/1028eaf0df9d1f6c902e9ad28d8dd7182f7824f7", "committedDate": "2020-07-21T10:43:10Z", "message": "Fix issues with swagger security scheme after migrations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604", "author": {"user": {"login": "msm1992", "name": "Sachini De Silva"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/acdee390f1f64cc3c1e893cbb19e961220e32604", "committedDate": "2020-07-21T10:49:34Z", "message": "Remove commented code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTY2NTE4", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#pullrequestreview-452966518", "createdAt": "2020-07-22T03:17:12Z", "commit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMzoxNzoxMlrOG1RMHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMzoyMDozNlrOG1RPSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUwOTM0Mg==", "bodyText": "shouldn't processLegacyScopes execute before the processOtherSchemeScopes?", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458509342", "createdAt": "2020-07-22T03:17:12Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OASParserUtil.java", "diffHunk": "@@ -1325,7 +1325,8 @@ static JsonNode getResponseCacheConfig(String responseCache, int cacheTimeout) {\n     public static String preProcess(String swaggerContent) throws APIManagementException {\n         //Load required properties from swagger to the API\n         APIDefinition apiDefinition = getOASParser(swaggerContent);\n-        return apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        swaggerContent = apiDefinition.processOtherSchemeScopes(swaggerContent);\n+        return apiDefinition.processLegacyScopes(swaggerContent);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxMDE1NA==", "bodyText": "I think we should not expose processLegacyScopes via the interface because I think it is not required to execute directly.\nI think we can define same method in respective parsers as private and call inside the processOtherSchemeScopes method. Because processLegacyScopes is used by only processOtherSchemeScopes.", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#discussion_r458510154", "createdAt": "2020-07-22T03:20:36Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIDefinition.java", "diffHunk": "@@ -205,4 +205,13 @@ public abstract String processOtherSchemeScopes(String resourceConfigsJSON)\n     public abstract API setExtensionsToAPI(String swaggerContent, API api)\n             throws APIManagementException;\n \n+    /**\n+     * This method will extract scopes from legacy x-wso2-security and add them to default scheme\n+     * @param swaggerContent swagger definition\n+     * @return\n+     * @throws APIManagementException\n+     */\n+    public abstract String processLegacyScopes(String swaggerContent)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acdee390f1f64cc3c1e893cbb19e961220e32604"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b188ce5404a9c6d4634d3c3ad7d44eba254e4437", "author": {"user": {"login": "msm1992", "name": "Sachini De Silva"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/b188ce5404a9c6d4634d3c3ad7d44eba254e4437", "committedDate": "2020-07-22T04:24:26Z", "message": "Add review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTg2MzQy", "url": "https://github.com/wso2/carbon-apimgt/pull/9012#pullrequestreview-452986342", "createdAt": "2020-07-22T04:30:10Z", "commit": {"oid": "b188ce5404a9c6d4634d3c3ad7d44eba254e4437"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2589, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}