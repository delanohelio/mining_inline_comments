{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5Mjk5OTQ1", "number": 8828, "reviewThreads": {"totalCount": 44, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoxNzozM1rOEI1L-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwNjo0NTo1M1rOFLKbhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Njk1NDgyOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoxNzozM1rOGpCENw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOToxMTozNFrOGpITLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3ODY0Nw==", "bodyText": "Formatting issues", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445678647", "createdAt": "2020-06-25T16:17:33Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc4MDc4Mw==", "bodyText": "d953b96", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445780783", "createdAt": "2020-06-25T19:11:34Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3ODY0Nw=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Njk1NTY2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoxNzo0NlrOGpCEyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOTowOToyNFrOGpIPBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3ODc5NQ==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445678795", "createdAt": "2020-06-25T16:17:46Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc3OTcxOA==", "bodyText": "c16f1ec", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445779718", "createdAt": "2020-06-25T19:09:24Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3ODc5NQ=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Njk1NzA0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoxODowOFrOGpCFqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOTowNDowMlrOGpIEdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3OTAxOQ==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445679019", "createdAt": "2020-06-25T16:18:08Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc3NzAxNA==", "bodyText": "0007abb", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445777014", "createdAt": "2020-06-25T19:04:02Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3OTAxOQ=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Njk1NzgwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoxODoyMFrOGpCGNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOToxMToyOVrOGpITAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3OTE1OQ==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445679159", "createdAt": "2020-06-25T16:18:20Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc4MDczOA==", "bodyText": "d953b96", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445780738", "createdAt": "2020-06-25T19:11:29Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3OTE1OQ=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Njk2MjAzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoxOToyN1rOGpCI8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOTowNjo1MlrOGpIKGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3OTg1Nw==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445679857", "createdAt": "2020-06-25T16:19:27Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString = EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc3ODQ1Ng==", "bodyText": "9d9528e", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445778456", "createdAt": "2020-06-25T19:06:52Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString = EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY3OTg1Nw=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Njk3MDYyOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoyMTozN1rOGpCOfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOTowMTozNlrOGpH_gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4MTI3OA==", "bodyText": "Better to do a null check before retrieving the entity", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445681278", "createdAt": "2020-06-25T16:21:37Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString = EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc3NTc0NA==", "bodyText": "0007abb", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445775744", "createdAt": "2020-06-25T19:01:36Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString = EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4MTI3OA=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Njk3NjQ3OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoyMzowNlrOGpCSXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOTowMToyMVrOGpH_FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4MjI2OQ==", "bodyText": "Can't we use the same line without exceeding the row width?", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445682269", "createdAt": "2020-06-25T16:23:06Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString = EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n+        }\n+    }\n+\n+    private HttpResponse invokeService(String endpoint) throws IOException, ArtifactSynchronizerException {\n+        HttpGet method = new HttpGet(endpoint);\n+        URL synapseGetURL = new URL(endpoint);\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance()\n+                .getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String username = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_USERNAME);\n+        String password = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_PASSWORD);\n+        byte[] credentials = Base64.encodeBase64((username + \":\" + password).getBytes\n+                (APIConstants.DigestAuthConstants.CHARSET));\n+        int synapsePort = synapseGetURL .getPort();\n+        String synapseProtocol = synapseGetURL .getProtocol();\n+        method.setHeader(\"Authorization\", \"Basic \" + new String(credentials,\n+                APIConstants.DigestAuthConstants.CHARSET));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc3NTYzNw==", "bodyText": "Nope . It is exceeding the limit", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445775637", "createdAt": "2020-06-25T19:01:21Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,93 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n-            }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction +\"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX + System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path  = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString = EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client \" ;\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n+        }\n+    }\n+\n+    private HttpResponse invokeService(String endpoint) throws IOException, ArtifactSynchronizerException {\n+        HttpGet method = new HttpGet(endpoint);\n+        URL synapseGetURL = new URL(endpoint);\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance()\n+                .getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String username = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_USERNAME);\n+        String password = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_PASSWORD);\n+        byte[] credentials = Base64.encodeBase64((username + \":\" + password).getBytes\n+                (APIConstants.DigestAuthConstants.CHARSET));\n+        int synapsePort = synapseGetURL .getPort();\n+        String synapseProtocol = synapseGetURL .getProtocol();\n+        method.setHeader(\"Authorization\", \"Basic \" + new String(credentials,\n+                APIConstants.DigestAuthConstants.CHARSET));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4MjI2OQ=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NzAwMjk2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBSaver.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjoyOTozOVrOGpCjHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxODo1OTozN1rOGpH7lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4NjU1Ng==", "bodyText": "Can't we add this method to APIUtil and use it by both DBSaver and DBretriever?", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445686556", "createdAt": "2020-06-25T16:29:39Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBSaver.java", "diffHunk": "@@ -43,45 +59,122 @@ public void init() throws ArtifactSynchronizerException {\n     public void saveArtifact(String gatewayRuntimeArtifacts, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n \n-        try {\n-            JSONObject artifactObject = new JSONObject(gatewayRuntimeArtifacts);\n-            String apiId = (String) artifactObject.get(\"apiId\");\n-            String apiName = (String) artifactObject.get(\"name\");\n-            String version = (String) artifactObject.get(\"version\");\n-            String tenantDomain = (String) artifactObject.get(\"tenantDomain\");\n-\n-            byte[] gatewayRuntimeArtifactsAsBytes = gatewayRuntimeArtifacts.getBytes();\n-            ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(gatewayRuntimeArtifactsAsBytes);\n-            if (!apiMgtDAO.isAPIDetailsExists(apiId)) {\n-                apiMgtDAO.addGatewayPublishedAPIDetails(apiId, apiName,\n-                        version, tenantDomain);\n-            }\n+        JSONObject artifactObject = new JSONObject(gatewayRuntimeArtifacts);\n+        String apiId = (String) artifactObject.get(\"apiId\");\n+        String apiName = (String) artifactObject.get(\"name\");\n+        String version = (String) artifactObject.get(\"version\");\n+        String tenantDomain = (String) artifactObject.get(\"tenantDomain\");\n+        byte[] bytesEncoded =  Base64.encodeBase64(gatewayRuntimeArtifacts.getBytes());\n+        String bytesEncodedAsString =  new String(bytesEncoded);\n \n-            String dbQuery;\n-            if (apiMgtDAO.isAPIArtifactExists(apiId, gatewayLabel)) {\n-                dbQuery = SQLConstants.UPDATE_API_ARTIFACT;\n-            } else {\n-                dbQuery = SQLConstants.ADD_GW_API_ARTIFACT;\n+        try {\n+            String baseUrl = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String synapsePost = baseUrl + APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS;\n+\n+            JSONObject revokeRequestPayload = new JSONObject();\n+            revokeRequestPayload.put(\"apiId\", apiId);\n+            revokeRequestPayload.put(\"apiName\", apiName);\n+            revokeRequestPayload.put(\"version\", version);\n+            revokeRequestPayload.put(\"tenantDomain\", tenantDomain);\n+            revokeRequestPayload.put(\"gatewayInstruction\", gatewayInstruction);\n+            revokeRequestPayload.put(\"bytesEncodedAsString\", bytesEncodedAsString);\n+            revokeRequestPayload.put(\"gatewayLabel\", URLEncoder.encode(gatewayLabel,\n+                    APIConstants.DigestAuthConstants.CHARSET));\n+            HttpResponse httpResponse = invokeService(synapsePost,revokeRequestPayload);\n+            if (HttpStatus.SC_OK != httpResponse.getStatusLine().getStatusCode()) {\n+                log.error(\"Retrieving artifacts is UnSuccessful. Internal Data Service returned HTTP Status \" +\n+                        \"code : \" + httpResponse.getStatusLine().getStatusCode() );\n+                throw new ArtifactSynchronizerException(\"Error while Saving Artifacts to DB\");\n             }\n-            apiMgtDAO.addGatewayPublishedAPIArtifacts(apiId, gatewayLabel,\n-                    byteArrayInputStream, gatewayRuntimeArtifactsAsBytes.length, gatewayInstruction, dbQuery);\n+        } catch (MalformedURLException e) {\n+            String msg = \"Error while constructing Synapse POST URL\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n+        }\n+    }\n \n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully saved Artifacts of \" + apiName);\n-            }\n-        } catch (APIManagementException e) {\n-            throw new ArtifactSynchronizerException(\"Error saving Artifacts to the DB\", e);\n+    private HttpResponse invokeService(String endpoint, JSONObject revokeRequestPayload) throws\n+            IOException {\n+        URL synapsePostURL = new URL(endpoint);\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance()\n+                .getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String username = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_USERNAME);\n+        String password = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_PASSWORD);\n+        byte[] credentials = Base64.encodeBase64((username + \":\" + password).getBytes\n+                (APIConstants.DigestAuthConstants.CHARSET));\n+        int synapsePort = synapsePostURL.getPort();\n+        String synapseProtocol = synapsePostURL.getProtocol();\n+        HttpClient httpClient = APIUtil.getHttpClient(synapsePort, synapseProtocol);\n+\n+        if (revokeRequestPayload != null) {\n+             HttpPost method = new HttpPost(endpoint);\n+             method.setHeader(\"Authorization\", \"Basic \" + new String(credentials,\n+                    APIConstants.DigestAuthConstants.CHARSET));\n+             StringEntity requestEntity = new StringEntity(revokeRequestPayload.toString());\n+             requestEntity.setContentType(APIConstants.APPLICATION_JSON_MEDIA_TYPE);\n+             method.setEntity(requestEntity);\n+             return executeHTTPRequest(method, httpClient);\n+\n+        } else {\n+             HttpGet method = new HttpGet(endpoint);\n+             method.setHeader(\"Authorization\", \"Basic \" + new String(credentials,\n+                    APIConstants.DigestAuthConstants.CHARSET));\n+             return executeHTTPRequest(method, httpClient);\n         }\n+    }\n \n+    private HttpResponse executeHTTPRequest(HttpRequestBase method, HttpClient httpClient ) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 140}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc3NDc0Mg==", "bodyText": "0007abb", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445774742", "createdAt": "2020-06-25T18:59:37Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBSaver.java", "diffHunk": "@@ -43,45 +59,122 @@ public void init() throws ArtifactSynchronizerException {\n     public void saveArtifact(String gatewayRuntimeArtifacts, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n \n-        try {\n-            JSONObject artifactObject = new JSONObject(gatewayRuntimeArtifacts);\n-            String apiId = (String) artifactObject.get(\"apiId\");\n-            String apiName = (String) artifactObject.get(\"name\");\n-            String version = (String) artifactObject.get(\"version\");\n-            String tenantDomain = (String) artifactObject.get(\"tenantDomain\");\n-\n-            byte[] gatewayRuntimeArtifactsAsBytes = gatewayRuntimeArtifacts.getBytes();\n-            ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(gatewayRuntimeArtifactsAsBytes);\n-            if (!apiMgtDAO.isAPIDetailsExists(apiId)) {\n-                apiMgtDAO.addGatewayPublishedAPIDetails(apiId, apiName,\n-                        version, tenantDomain);\n-            }\n+        JSONObject artifactObject = new JSONObject(gatewayRuntimeArtifacts);\n+        String apiId = (String) artifactObject.get(\"apiId\");\n+        String apiName = (String) artifactObject.get(\"name\");\n+        String version = (String) artifactObject.get(\"version\");\n+        String tenantDomain = (String) artifactObject.get(\"tenantDomain\");\n+        byte[] bytesEncoded =  Base64.encodeBase64(gatewayRuntimeArtifacts.getBytes());\n+        String bytesEncodedAsString =  new String(bytesEncoded);\n \n-            String dbQuery;\n-            if (apiMgtDAO.isAPIArtifactExists(apiId, gatewayLabel)) {\n-                dbQuery = SQLConstants.UPDATE_API_ARTIFACT;\n-            } else {\n-                dbQuery = SQLConstants.ADD_GW_API_ARTIFACT;\n+        try {\n+            String baseUrl = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String synapsePost = baseUrl + APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS;\n+\n+            JSONObject revokeRequestPayload = new JSONObject();\n+            revokeRequestPayload.put(\"apiId\", apiId);\n+            revokeRequestPayload.put(\"apiName\", apiName);\n+            revokeRequestPayload.put(\"version\", version);\n+            revokeRequestPayload.put(\"tenantDomain\", tenantDomain);\n+            revokeRequestPayload.put(\"gatewayInstruction\", gatewayInstruction);\n+            revokeRequestPayload.put(\"bytesEncodedAsString\", bytesEncodedAsString);\n+            revokeRequestPayload.put(\"gatewayLabel\", URLEncoder.encode(gatewayLabel,\n+                    APIConstants.DigestAuthConstants.CHARSET));\n+            HttpResponse httpResponse = invokeService(synapsePost,revokeRequestPayload);\n+            if (HttpStatus.SC_OK != httpResponse.getStatusLine().getStatusCode()) {\n+                log.error(\"Retrieving artifacts is UnSuccessful. Internal Data Service returned HTTP Status \" +\n+                        \"code : \" + httpResponse.getStatusLine().getStatusCode() );\n+                throw new ArtifactSynchronizerException(\"Error while Saving Artifacts to DB\");\n             }\n-            apiMgtDAO.addGatewayPublishedAPIArtifacts(apiId, gatewayLabel,\n-                    byteArrayInputStream, gatewayRuntimeArtifactsAsBytes.length, gatewayInstruction, dbQuery);\n+        } catch (MalformedURLException e) {\n+            String msg = \"Error while constructing Synapse POST URL\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n+        }\n+    }\n \n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully saved Artifacts of \" + apiName);\n-            }\n-        } catch (APIManagementException e) {\n-            throw new ArtifactSynchronizerException(\"Error saving Artifacts to the DB\", e);\n+    private HttpResponse invokeService(String endpoint, JSONObject revokeRequestPayload) throws\n+            IOException {\n+        URL synapsePostURL = new URL(endpoint);\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance()\n+                .getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String username = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_USERNAME);\n+        String password = config.getFirstProperty(APIConstants.API_KEY_VALIDATOR_PASSWORD);\n+        byte[] credentials = Base64.encodeBase64((username + \":\" + password).getBytes\n+                (APIConstants.DigestAuthConstants.CHARSET));\n+        int synapsePort = synapsePostURL.getPort();\n+        String synapseProtocol = synapsePostURL.getProtocol();\n+        HttpClient httpClient = APIUtil.getHttpClient(synapsePort, synapseProtocol);\n+\n+        if (revokeRequestPayload != null) {\n+             HttpPost method = new HttpPost(endpoint);\n+             method.setHeader(\"Authorization\", \"Basic \" + new String(credentials,\n+                    APIConstants.DigestAuthConstants.CHARSET));\n+             StringEntity requestEntity = new StringEntity(revokeRequestPayload.toString());\n+             requestEntity.setContentType(APIConstants.APPLICATION_JSON_MEDIA_TYPE);\n+             method.setEntity(requestEntity);\n+             return executeHTTPRequest(method, httpClient);\n+\n+        } else {\n+             HttpGet method = new HttpGet(endpoint);\n+             method.setHeader(\"Authorization\", \"Basic \" + new String(credentials,\n+                    APIConstants.DigestAuthConstants.CHARSET));\n+             return executeHTTPRequest(method, httpClient);\n         }\n+    }\n \n+    private HttpResponse executeHTTPRequest(HttpRequestBase method, HttpClient httpClient ) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4NjU1Ng=="}, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 140}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NzAxMTMzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjozMToyNVrOGpCn-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjozMToyNVrOGpCn-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY4NzgwMA==", "bodyText": "We should not use DAO outside of Impl component", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r445687800", "createdAt": "2020-06-25T16:31:25Z", "author": {"login": "1akshitha"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package org.wso2.carbon.apimgt.internal.service.impl;\n+\n+import com.google.common.io.ByteStreams;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.gatewayartifactsynchronizer.exception.ArtifactSynchronizerException;\n+import org.wso2.carbon.apimgt.internal.service.*;\n+import org.wso2.carbon.apimgt.internal.service.dto.*;\n+\n+import org.apache.cxf.jaxrs.ext.multipart.Attachment;\n+import org.apache.cxf.jaxrs.ext.MessageContext;\n+\n+import org.wso2.carbon.apimgt.internal.service.dto.ErrorDTO;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import java.io.InputStream;\n+\n+import javax.ws.rs.core.Response;\n+import javax.ws.rs.core.SecurityContext;\n+\n+\n+public class GatewaySynapseArtifactsApiServiceImpl implements GatewaySynapseArtifactsApiService {\n+\n+    protected ApiMgtDAO apiMgtDAO = ApiMgtDAO.getInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d2b7e0f765ae6be9d02cbbc659450f0c115d71"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODcwODI1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjozNTo1MFrOGqtu7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzowMjoxMFrOGqueuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MjY3MQ==", "bodyText": "Formatting issue.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447442671", "createdAt": "2020-06-30T06:35:50Z", "author": {"login": "prasa7"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -57,24 +55,23 @@ public GatewayStartupListener() {\n \n     @Override\n     public void completingServerStartup() {\n-\n-        deployArtifactsAtStartup();\n+        startListener();\n     }\n \n-    private static void deployArtifactsAtStartup() {\n-\n+    private boolean  deployArtifactsAtStartup(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ1NDkwNA==", "bodyText": "c49dff9", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447454904", "createdAt": "2020-06-30T07:02:10Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -57,24 +55,23 @@ public GatewayStartupListener() {\n \n     @Override\n     public void completingServerStartup() {\n-\n-        deployArtifactsAtStartup();\n+        startListener();\n     }\n \n-    private static void deployArtifactsAtStartup() {\n-\n+    private boolean  deployArtifactsAtStartup(){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MjY3MQ=="}, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODcwODgwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjozNjowM1rOGqtvRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzowMjowN1rOGquelg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0Mjc1OQ==", "bodyText": "Formatting issue.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447442759", "createdAt": "2020-06-30T06:36:03Z", "author": {"login": "prasa7"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +53,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            if (httpResponse.getEntity() != null ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ1NDg3MA==", "bodyText": "c49dff9", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447454870", "createdAt": "2020-06-30T07:02:07Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +53,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            if (httpResponse.getEntity() != null ){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0Mjc1OQ=="}, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODcwOTQ0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjozNjoxOVrOGqtvrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzowMjowNFrOGquefw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0Mjg2Mg==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447442862", "createdAt": "2020-06-30T06:36:19Z", "author": {"login": "prasa7"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +53,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            if (httpResponse.getEntity() != null ){\n+                return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString;\n+            if (httpResponse.getEntity() != null ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ1NDg0Nw==", "bodyText": "c49dff9", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447454847", "createdAt": "2020-06-30T07:02:04Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +53,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            if (httpResponse.getEntity() != null ){\n+                return EntityUtils.toString(httpResponse.getEntity(), APIConstants.DigestAuthConstants.CHARSET);\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String baseURL = APIConstants.HTTPS_PROTOCOL_URL_PREFIX +\n+                    System.getProperty(APIConstants.KEYMANAGER_HOSTNAME) + \":\" +\n+                    System.getProperty(APIConstants.KEYMANAGER_PORT) + APIConstants.INTERNAL_WEB_APP_EP;\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            HttpResponse httpResponse = invokeService(endpoint);\n+            String responseString;\n+            if (httpResponse.getEntity() != null ){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0Mjg2Mg=="}, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODcwOTk0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjozNjoyOVrOGqtv-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzowMjowMVrOGqueYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MjkzOA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447442938", "createdAt": "2020-06-30T06:36:29Z", "author": {"login": "prasa7"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.wso2.carbon.apimgt.internal.service.impl;\n+\n+import com.google.common.io.ByteStreams;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.internal.service.GatewaySynapseArtifactsApiService;\n+import org.apache.cxf.jaxrs.ext.MessageContext;\n+import org.wso2.carbon.apimgt.internal.service.dto.SynapseArtifactListDTO;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.ws.rs.core.Response;\n+\n+\n+\n+public class GatewaySynapseArtifactsApiServiceImpl implements GatewaySynapseArtifactsApiService {\n+\n+    protected ApiMgtDAO apiMgtDAO = ApiMgtDAO.getInstance();\n+\n+    private SynapseArtifactListDTO synapseArtifactListDTOS = new SynapseArtifactListDTO();\n+\n+    public Response gatewaySynapseArtifactsGet(String gatewayLabel, MessageContext messageContext) throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try {\n+            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(gatewayLabel);\n+            for (ByteArrayInputStream byteStream :baip){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ1NDgxOQ==", "bodyText": "c49dff9", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r447454819", "createdAt": "2020-06-30T07:02:01Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.wso2.carbon.apimgt.internal.service.impl;\n+\n+import com.google.common.io.ByteStreams;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.internal.service.GatewaySynapseArtifactsApiService;\n+import org.apache.cxf.jaxrs.ext.MessageContext;\n+import org.wso2.carbon.apimgt.internal.service.dto.SynapseArtifactListDTO;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.ws.rs.core.Response;\n+\n+\n+\n+public class GatewaySynapseArtifactsApiServiceImpl implements GatewaySynapseArtifactsApiService {\n+\n+    protected ApiMgtDAO apiMgtDAO = ApiMgtDAO.getInstance();\n+\n+    private SynapseArtifactListDTO synapseArtifactListDTOS = new SynapseArtifactListDTO();\n+\n+    public Response gatewaySynapseArtifactsGet(String gatewayLabel, MessageContext messageContext) throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try {\n+            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(gatewayLabel);\n+            for (ByteArrayInputStream byteStream :baip){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MjkzOA=="}, "originalCommit": {"oid": "61d0a02639ea99563dd3ec9c2197d33362be8aef"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTU0NDE1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo0MjoyMVrOGrvfbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNToyOToxNFrOGr98gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMDA0NA==", "bodyText": "can we bring it to config level", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448520044", "createdAt": "2020-07-01T17:42:21Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -99,4 +98,38 @@ public void invoke() {\n         }\n     }\n \n-}\n+\n+    public void startListener() {\n+        new Thread(this).start();\n+    }\n+\n+    @Override\n+    public void run() {\n+        deployArtifactsInGateway();\n+    }\n+\n+    private void deployArtifactsInGateway() {\n+        long retryDuration = 10000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1Njg2NA==", "bodyText": "3540dda", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448756864", "createdAt": "2020-07-02T05:29:14Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -99,4 +98,38 @@ public void invoke() {\n         }\n     }\n \n-}\n+\n+    public void startListener() {\n+        new Thread(this).start();\n+    }\n+\n+    @Override\n+    public void run() {\n+        deployArtifactsInGateway();\n+    }\n+\n+    private void deployArtifactsInGateway() {\n+        long retryDuration = 10000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMDA0NA=="}, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTU0ODQzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo0MzozOVrOGrviDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDo1MjowN1rOGr9YjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMDcxOA==", "bodyText": "need private constructot", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448520718", "createdAt": "2020-07-01T17:43:39Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0NzY2MQ==", "bodyText": "d501401", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448747661", "createdAt": "2020-07-02T04:52:07Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMDcxOA=="}, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTU1MzAxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo0NTowNFrOGrvk_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDo1MjozM1rOGr9Y8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMTQ2OQ==", "bodyText": "need to make autocommit false first in connection since it s an insert", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448521469", "createdAt": "2020-07-01T17:45:04Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0Nzc2MQ==", "bodyText": "d501401", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448747761", "createdAt": "2020-07-02T04:52:33Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMTQ2OQ=="}, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTU1NzU4OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo0NjoyNlrOGrvn5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDo1Mjo0MFrOGr9ZEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMjIxNQ==", "bodyText": "fix all the places as above except GET", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448522215", "createdAt": "2020-07-01T17:46:26Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIName);\n+            statement.setString(3, version);\n+            statement.setString(4, tenantDomain);\n+            statement.executeUpdate();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0Nzc5Mw==", "bodyText": "d501401", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448747793", "createdAt": "2020-07-02T04:52:40Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIName);\n+            statement.setString(3, version);\n+            statement.setString(4, tenantDomain);\n+            statement.executeUpdate();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMjIxNQ=="}, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTU2MjM2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo0Nzo1MVrOGrvqzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNTo0MjoyOVrOGr-KFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMjk1Nw==", "bodyText": "make the query Select 1 and check if rs.next", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448522957", "createdAt": "2020-07-01T17:47:51Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIName);\n+            statement.setString(3, version);\n+            statement.setString(4, tenantDomain);\n+            statement.executeUpdate();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(query)) {\n+            statement.setBinaryStream(1, bais, streamLength);\n+            statement.setString(2, gatewayInstruction);\n+            statement.setString(3, APIId);\n+            statement.setString(4, gatewayLabel);\n+            statement.executeUpdate();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.CHECK_ARTIFACT_EXISTS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc2MDM0MQ==", "bodyText": "6604c7c", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448760341", "createdAt": "2020-07-02T05:42:29Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIName);\n+            statement.setString(3, version);\n+            statement.setString(4, tenantDomain);\n+            statement.executeUpdate();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(query)) {\n+            statement.setBinaryStream(1, bais, streamLength);\n+            statement.setString(2, gatewayInstruction);\n+            statement.setString(3, APIId);\n+            statement.setString(4, gatewayLabel);\n+            statement.executeUpdate();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.CHECK_ARTIFACT_EXISTS)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMjk1Nw=="}, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 200}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTU2NTM0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo0ODo1MVrOGrvssQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDo1Mjo1MVrOGr9ZNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMzQ0MQ==", "bodyText": "APIMgtDBUtil ->GatewayArtifactsMgtDBUtil", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448523441", "createdAt": "2020-07-01T17:48:51Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "diffHunk": "@@ -0,0 +1,167 @@\n+package org.wso2.carbon.apimgt.impl.utils;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.APIManagerDatabaseException;\n+import org.wso2.carbon.apimgt.impl.APIManagerConfiguration;\n+import org.wso2.carbon.apimgt.impl.dto.GatewayArtifactSynchronizerProperties;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+\n+import javax.naming.Context;\n+import javax.naming.InitialContext;\n+import javax.naming.NamingException;\n+import javax.sql.DataSource;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+\n+public class GatewayArtifactsMgtDBUtil {\n+\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDBUtil.class);\n+    private static volatile DataSource artifactSynchronizerDataSource = null;\n+    private static final String DATA_SOURCE_NAME = \"DataSourceName\";\n+\n+    /**\n+     * Initializes the data source\n+     *\n+     * @throws APIManagementException if an error occurs while loading DB configuration\n+     */\n+    public static void initialize() throws APIManagerDatabaseException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return;\n+        }\n+\n+        synchronized (APIMgtDBUtil.class) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0NzgzMQ==", "bodyText": "d501401", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448747831", "createdAt": "2020-07-02T04:52:51Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "diffHunk": "@@ -0,0 +1,167 @@\n+package org.wso2.carbon.apimgt.impl.utils;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.APIManagerDatabaseException;\n+import org.wso2.carbon.apimgt.impl.APIManagerConfiguration;\n+import org.wso2.carbon.apimgt.impl.dto.GatewayArtifactSynchronizerProperties;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+\n+import javax.naming.Context;\n+import javax.naming.InitialContext;\n+import javax.naming.NamingException;\n+import javax.sql.DataSource;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+\n+public class GatewayArtifactsMgtDBUtil {\n+\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDBUtil.class);\n+    private static volatile DataSource artifactSynchronizerDataSource = null;\n+    private static final String DATA_SOURCE_NAME = \"DataSourceName\";\n+\n+    /**\n+     * Initializes the data source\n+     *\n+     * @throws APIManagementException if an error occurs while loading DB configuration\n+     */\n+    public static void initialize() throws APIManagerDatabaseException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return;\n+        }\n+\n+        synchronized (APIMgtDBUtil.class) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMzQ0MQ=="}, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTU2NjQ1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo0OTowOVrOGrvtYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNDo1MzoxMFrOGr9ZfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMzYxOA==", "bodyText": "do we need this", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448523618", "createdAt": "2020-07-01T17:49:09Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "diffHunk": "@@ -0,0 +1,167 @@\n+package org.wso2.carbon.apimgt.impl.utils;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.APIManagerDatabaseException;\n+import org.wso2.carbon.apimgt.impl.APIManagerConfiguration;\n+import org.wso2.carbon.apimgt.impl.dto.GatewayArtifactSynchronizerProperties;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+\n+import javax.naming.Context;\n+import javax.naming.InitialContext;\n+import javax.naming.NamingException;\n+import javax.sql.DataSource;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+\n+public class GatewayArtifactsMgtDBUtil {\n+\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDBUtil.class);\n+    private static volatile DataSource artifactSynchronizerDataSource = null;\n+    private static final String DATA_SOURCE_NAME = \"DataSourceName\";\n+\n+    /**\n+     * Initializes the data source\n+     *\n+     * @throws APIManagementException if an error occurs while loading DB configuration\n+     */\n+    public static void initialize() throws APIManagerDatabaseException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return;\n+        }\n+\n+        synchronized (APIMgtDBUtil.class) {\n+            if (artifactSynchronizerDataSource == null) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Initializing data source\");\n+                }\n+                GatewayArtifactSynchronizerProperties gatewayArtifactSynchronizerProperties =\n+                        ServiceReferenceHolder.getInstance().getAPIManagerConfigurationService()\n+                                .getAPIManagerConfiguration().getGatewayArtifactSynchronizerProperties();\n+                String artifactSynchronizerDataSourceName =\n+                        gatewayArtifactSynchronizerProperties.getArtifactSynchronizerDataSource();\n+\n+                if (artifactSynchronizerDataSourceName != null) {\n+                    try {\n+                        Context ctx = new InitialContext();\n+                        artifactSynchronizerDataSource = (DataSource) ctx.lookup(artifactSynchronizerDataSourceName);\n+                    } catch (NamingException e) {\n+                        throw new APIManagerDatabaseException(\"Error while looking up the data \" +\n+                                \"source: \" + artifactSynchronizerDataSourceName, e);\n+                    }\n+                } else {\n+                    log.error(\"AS\" + artifactSynchronizerDataSourceName + \" not defined in api-manager.xml.\");\n+                }\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Utility method to get a new database connection for gatewayRuntime artifacts\n+     *\n+     * @return Connection\n+     * @throws java.sql.SQLException if failed to get Connection\n+     */\n+    public static Connection getArtifactSynchronizerConnection() throws SQLException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return artifactSynchronizerDataSource.getConnection();\n+        }\n+        throw new SQLException(\"Data source is not configured properly.\");\n+    }\n+\n+    /**\n+     * Utility method to close the connection streams.\n+     * @param preparedStatement PreparedStatement\n+     * @param connection Connection\n+     * @param resultSet ResultSet\n+     */\n+    public static void closeAllConnections(PreparedStatement preparedStatement, Connection connection,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc0NzkwMA==", "bodyText": "Removed it . d501401", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r448747900", "createdAt": "2020-07-02T04:53:10Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "diffHunk": "@@ -0,0 +1,167 @@\n+package org.wso2.carbon.apimgt.impl.utils;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.APIManagerDatabaseException;\n+import org.wso2.carbon.apimgt.impl.APIManagerConfiguration;\n+import org.wso2.carbon.apimgt.impl.dto.GatewayArtifactSynchronizerProperties;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+\n+import javax.naming.Context;\n+import javax.naming.InitialContext;\n+import javax.naming.NamingException;\n+import javax.sql.DataSource;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+\n+public class GatewayArtifactsMgtDBUtil {\n+\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDBUtil.class);\n+    private static volatile DataSource artifactSynchronizerDataSource = null;\n+    private static final String DATA_SOURCE_NAME = \"DataSourceName\";\n+\n+    /**\n+     * Initializes the data source\n+     *\n+     * @throws APIManagementException if an error occurs while loading DB configuration\n+     */\n+    public static void initialize() throws APIManagerDatabaseException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return;\n+        }\n+\n+        synchronized (APIMgtDBUtil.class) {\n+            if (artifactSynchronizerDataSource == null) {\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"Initializing data source\");\n+                }\n+                GatewayArtifactSynchronizerProperties gatewayArtifactSynchronizerProperties =\n+                        ServiceReferenceHolder.getInstance().getAPIManagerConfigurationService()\n+                                .getAPIManagerConfiguration().getGatewayArtifactSynchronizerProperties();\n+                String artifactSynchronizerDataSourceName =\n+                        gatewayArtifactSynchronizerProperties.getArtifactSynchronizerDataSource();\n+\n+                if (artifactSynchronizerDataSourceName != null) {\n+                    try {\n+                        Context ctx = new InitialContext();\n+                        artifactSynchronizerDataSource = (DataSource) ctx.lookup(artifactSynchronizerDataSourceName);\n+                    } catch (NamingException e) {\n+                        throw new APIManagerDatabaseException(\"Error while looking up the data \" +\n+                                \"source: \" + artifactSynchronizerDataSourceName, e);\n+                    }\n+                } else {\n+                    log.error(\"AS\" + artifactSynchronizerDataSourceName + \" not defined in api-manager.xml.\");\n+                }\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Utility method to get a new database connection for gatewayRuntime artifacts\n+     *\n+     * @return Connection\n+     * @throws java.sql.SQLException if failed to get Connection\n+     */\n+    public static Connection getArtifactSynchronizerConnection() throws SQLException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return artifactSynchronizerDataSource.getConnection();\n+        }\n+        throw new SQLException(\"Data source is not configured properly.\");\n+    }\n+\n+    /**\n+     * Utility method to close the connection streams.\n+     * @param preparedStatement PreparedStatement\n+     * @param connection Connection\n+     * @param resultSet ResultSet\n+     */\n+    public static void closeAllConnections(PreparedStatement preparedStatement, Connection connection,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMzYxOA=="}, "originalCommit": {"oid": "5cf907a4fdb46cb9734278c1b8619e04cc1f4b27"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTE2MTU2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjozNjo0MVrOGslS3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDoxMzoyOVrOGsrf-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMTU2Ng==", "bodyText": "Any reason why this is in upper case? Uppercase specifically denotes constant names.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449401566", "createdAt": "2020-07-03T06:36:41Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUwMzIyNA==", "bodyText": "dab8323", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449503224", "createdAt": "2020-07-03T10:13:29Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMTU2Ng=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTE4NTA1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjo0NTo1OVrOGslgOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMTowNzoyM1rOGss4lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNDk4NQ==", "bodyText": "As a practice its a good idea to call commit on a connection that is returned from the pool before performing a SELECT operation. This ensures that any uncommitted data will not be returned by the DB. The pattern to be used therefore should be,\ntry (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\nconnection.setAutoCommit(false); connection.commit();\nPreparedStatement statement = connection.prepareStatement(\"SELECT ...\")) {\n\n}", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449404985", "createdAt": "2020-07-03T06:45:59Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyNTkwOA==", "bodyText": "e63b7ad", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449525908", "createdAt": "2020-07-03T11:07:23Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNDk4NQ=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTE5NzAzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjo1MToxOFrOGsln2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMTowNzoxNlrOGss4ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNjkzNg==", "bodyText": "As a practice its a good idea to call commit on a connection that is returned from the pool before performing a SELECT operation. This ensures that any uncommitted data will not be returned by the DB. The pattern to be used therefore should be,\ntry (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\nconnection.setAutoCommit(false); connection.commit();\nPreparedStatement statement = connection.prepareStatement(\"SELECT ...\")) {\n\n}", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449406936", "createdAt": "2020-07-03T06:51:18Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 140}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyNTg2Ng==", "bodyText": "e63b7ad", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449525866", "createdAt": "2020-07-03T11:07:16Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNjkzNg=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 140}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTE5ODY1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjo1MTo1MlrOGslo1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMTowNzoxM1rOGss4Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNzE4OA==", "bodyText": "As a practice its a good idea to call commit on a connection that is returned from the pool before performing a SELECT operation. This ensures that any uncommitted data will not be returned by the DB. The pattern to be used therefore should be,\ntry (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\nconnection.setAutoCommit(false); connection.commit();\nPreparedStatement statement = connection.prepareStatement(\"SELECT ...\")) {\n\n}", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449407188", "createdAt": "2020-07-03T06:51:52Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 169}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyNTg1MA==", "bodyText": "e63b7ad", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449525850", "createdAt": "2020-07-03T11:07:13Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNzE4OA=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 169}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTIwMDc1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjo1Mjo0MVrOGslqIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMTowNzoxMFrOGss4Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNzUyMA==", "bodyText": "As a practice its a good idea to call commit on a connection that is returned from the pool before performing a SELECT operation. This ensures that any uncommitted data will not be returned by the DB. The pattern to be used therefore should be,\ntry (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\nconnection.setAutoCommit(false); connection.commit();\nPreparedStatement statement = connection.prepareStatement(\"SELECT ...\")) {\n\n}", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449407520", "createdAt": "2020-07-03T06:52:41Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 191}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyNTgxOA==", "bodyText": "e63b7ad", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449525818", "createdAt": "2020-07-03T11:07:10Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwNzUyMA=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 191}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTIxMjEwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjo1NzoxMVrOGslwzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDo0NTowMlrOGssVQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwOTIyOA==", "bodyText": "This should be a \"SELECT 1 .....\" style query since you are only interested in checking if rows exist and are not doing anything with the values of the columns.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449409228", "createdAt": "2020-07-03T06:57:11Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 193}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjg2Nw==", "bodyText": "dab8323", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449516867", "createdAt": "2020-07-03T10:45:02Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwOTIyOA=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 193}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTIxNzgxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNjo1OToxOFrOGsl0Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDo0NDo1MlrOGssVBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQxMDA2Mg==", "bodyText": "No need for while loop, doing return rs.next() is sufficient.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449410062", "createdAt": "2020-07-03T06:59:18Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        boolean isExist = false;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.CHECK_ARTIFACT_EXISTS)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNjgwNA==", "bodyText": "dab8323", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449516804", "createdAt": "2020-07-03T10:44:52Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        boolean isExist = false;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.CHECK_ARTIFACT_EXISTS)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQxMDA2Mg=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 217}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTIyMDM1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNzowMDoyMlrOGsl1hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMTowNzowM1rOGss4Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQxMDQzNw==", "bodyText": "As a practice its a good idea to call commit on a connection that is returned from the pool before performing a SELECT operation. This ensures that any uncommitted data will not be returned by the DB. The pattern to be used therefore should be,\ntry (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\nconnection.setAutoCommit(false); connection.commit();\nPreparedStatement statement = connection.prepareStatement(\"SELECT ...\")) {\n\n}", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449410437", "createdAt": "2020-07-03T07:00:22Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        boolean isExist = false;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 212}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyNTc2Mw==", "bodyText": "e63b7ad", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449525763", "createdAt": "2020-07-03T11:07:03Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO INSTANCE = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (INSTANCE == null) {\n+            INSTANCE = new GatewayArtifactsMgtDAO();\n+        }\n+        return INSTANCE;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_GATEWAY_PUBLISHED_API_DETAILS)) {\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        boolean isExist = false;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQxMDQzNw=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 212}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTI1NjcxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNzoxNDoyOFrOGsmLbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMDoxMzowNVrOGsrfNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQxNjA0NA==", "bodyText": "Instead of synchronizing the entire class(which leads to locking all methods of the class), it would be better to move this block into a private synchronized method. It would then look like,\npublic static void initialize() throws APIManagerDatabaseException {\n        if (artifactSynchronizerDataSource != null) {\n            return;\n        }\n\n        InitDataSource();\n}\n\nprivate static void InitDataSource() synchronized {\n    .............\n}\n\nThis would ensure that only callers of the initialize() method will have the potential of having to wait in a concurrent scenario, but callers of the getArtifactSynchronizerConnection() method will not be affected by this.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449416044", "createdAt": "2020-07-03T07:14:28Z", "author": {"login": "uvindra"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package org.wso2.carbon.apimgt.impl.utils;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.APIManagerDatabaseException;\n+import org.wso2.carbon.apimgt.impl.dto.GatewayArtifactSynchronizerProperties;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import javax.naming.Context;\n+import javax.naming.InitialContext;\n+import javax.naming.NamingException;\n+import javax.sql.DataSource;\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+\n+public class GatewayArtifactsMgtDBUtil {\n+\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDBUtil.class);\n+    private static volatile DataSource artifactSynchronizerDataSource = null;\n+\n+    /**\n+     * Initializes the data source\n+     *\n+     * @throws APIManagementException if an error occurs while loading DB configuration\n+     */\n+    public static void initialize() throws APIManagerDatabaseException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return;\n+        }\n+\n+        synchronized (GatewayArtifactsMgtDBUtil.class) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUwMzAzMQ==", "bodyText": "dab8323", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449503031", "createdAt": "2020-07-03T10:13:05Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/GatewayArtifactsMgtDBUtil.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package org.wso2.carbon.apimgt.impl.utils;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.APIManagerDatabaseException;\n+import org.wso2.carbon.apimgt.impl.dto.GatewayArtifactSynchronizerProperties;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import javax.naming.Context;\n+import javax.naming.InitialContext;\n+import javax.naming.NamingException;\n+import javax.sql.DataSource;\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+\n+public class GatewayArtifactsMgtDBUtil {\n+\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDBUtil.class);\n+    private static volatile DataSource artifactSynchronizerDataSource = null;\n+\n+    /**\n+     * Initializes the data source\n+     *\n+     * @throws APIManagementException if an error occurs while loading DB configuration\n+     */\n+    public static void initialize() throws APIManagerDatabaseException {\n+        if (artifactSynchronizerDataSource != null) {\n+            return;\n+        }\n+\n+        synchronized (GatewayArtifactsMgtDBUtil.class) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQxNjA0NA=="}, "originalCommit": {"oid": "6604c7cf1386950cd25886fffa21addbbc595804"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTM4NTEwOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.core.feature/src/main/resources/sql/oracle.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNzo1ODowMlrOGsnZDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNzozMzo0NVrOGtL9vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzNTkxNw==", "bodyText": "did we add the new table to multi_dc scripts as well?", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449435917", "createdAt": "2020-07-03T07:58:02Z", "author": {"login": "bhathiya"}, "path": "features/apimgt/org.wso2.carbon.apimgt.core.feature/src/main/resources/sql/oracle.sql", "diffHunk": "@@ -2913,6 +2913,8 @@ CREATE TABLE AM_KEY_MANAGER (\n )\n  /\n \n+-- AM_GW_PUBLISHED_API_DETAILS & AM_GW_API_ARTIFACTS are independent tables for Artifact synchronizer feature which --\n+-- should not have any referential integrity constraints with other tables in AM database--\n CREATE TABLE IF NOT EXISTS AM_GW_PUBLISHED_API_DETAILS (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bd22237441b3f4612408e9272a9de8c9d986429"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAzNTEzNQ==", "bodyText": "Yes . #8934", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r450035135", "createdAt": "2020-07-06T07:33:45Z", "author": {"login": "Sarangan0219"}, "path": "features/apimgt/org.wso2.carbon.apimgt.core.feature/src/main/resources/sql/oracle.sql", "diffHunk": "@@ -2913,6 +2913,8 @@ CREATE TABLE AM_KEY_MANAGER (\n )\n  /\n \n+-- AM_GW_PUBLISHED_API_DETAILS & AM_GW_API_ARTIFACTS are independent tables for Artifact synchronizer feature which --\n+-- should not have any referential integrity constraints with other tables in AM database--\n CREATE TABLE IF NOT EXISTS AM_GW_PUBLISHED_API_DETAILS (", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzNTkxNw=="}, "originalCommit": {"oid": "5bd22237441b3f4612408e9272a9de8c9d986429"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMTM4NzAzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNzo1ODozNFrOGsnaRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMzoxNzoxMVrOGswHrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzNjIzMA==", "bodyText": "password must be a char[]", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449436230", "createdAt": "2020-07-03T07:58:34Z", "author": {"login": "bhathiya"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = eventHubConfigurationDto.getServiceUrl();\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String gatewayRuntimeArtifact = null;\n+            if (httpResponse.getEntity() != null ) {\n+                gatewayRuntimeArtifact = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            return gatewayRuntimeArtifact;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String responseString;\n+            if (httpResponse.getEntity() != null ) {\n+                responseString = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact from DB\", e);\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    private CloseableHttpResponse invokeService(String endpoint) throws IOException {\n+        HttpGet method = new HttpGet(endpoint);\n+        URL url = new URL(endpoint);\n+        String username = eventHubConfigurationDto.getUsername();\n+        String password = eventHubConfigurationDto.getPassword();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bd22237441b3f4612408e9272a9de8c9d986429"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUwMTU4Nw==", "bodyText": "Yes . But the getPassword() method returns a string (converting char[] --> String)\nhttps://github.com/wso2/carbon-apimgt/blob/master/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dto/EventHubConfigurationDto.java#L90", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449501587", "createdAt": "2020-07-03T10:09:56Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = eventHubConfigurationDto.getServiceUrl();\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String gatewayRuntimeArtifact = null;\n+            if (httpResponse.getEntity() != null ) {\n+                gatewayRuntimeArtifact = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            return gatewayRuntimeArtifact;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String responseString;\n+            if (httpResponse.getEntity() != null ) {\n+                responseString = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact from DB\", e);\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    private CloseableHttpResponse invokeService(String endpoint) throws IOException {\n+        HttpGet method = new HttpGet(endpoint);\n+        URL url = new URL(endpoint);\n+        String username = eventHubConfigurationDto.getUsername();\n+        String password = eventHubConfigurationDto.getPassword();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzNjIzMA=="}, "originalCommit": {"oid": "5bd22237441b3f4612408e9272a9de8c9d986429"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUzMjk1OQ==", "bodyText": "we need to change that. @tharindu1st was there any reason not to do that?", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449532959", "createdAt": "2020-07-03T11:25:29Z", "author": {"login": "bhathiya"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = eventHubConfigurationDto.getServiceUrl();\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String gatewayRuntimeArtifact = null;\n+            if (httpResponse.getEntity() != null ) {\n+                gatewayRuntimeArtifact = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            return gatewayRuntimeArtifact;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String responseString;\n+            if (httpResponse.getEntity() != null ) {\n+                responseString = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact from DB\", e);\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    private CloseableHttpResponse invokeService(String endpoint) throws IOException {\n+        HttpGet method = new HttpGet(endpoint);\n+        URL url = new URL(endpoint);\n+        String username = eventHubConfigurationDto.getUsername();\n+        String password = eventHubConfigurationDto.getPassword();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzNjIzMA=="}, "originalCommit": {"oid": "5bd22237441b3f4612408e9272a9de8c9d986429"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU3ODkyNg==", "bodyText": "we need to change it", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r449578926", "createdAt": "2020-07-03T13:17:11Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -44,39 +56,76 @@ public void init() throws ArtifactSynchronizerException {\n     @Override\n     public String retrieveArtifact(String APIId, String gatewayLabel, String gatewayInstruction)\n             throws ArtifactSynchronizerException {\n-\n-        String gatewayRuntimeArtifacts;\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            ByteArrayInputStream byteStream =\n-                    apiMgtDAO.getGatewayPublishedAPIArtifacts(APIId, gatewayLabel, gatewayInstruction);\n-            byte[] bytes = ByteStreams.toByteArray(byteStream);\n-            gatewayRuntimeArtifacts = new String(bytes);\n-            if (log.isDebugEnabled()) {\n-                log.debug(\"Successfully retrieved Artifact of \" + APIId);\n+            String baseURL = eventHubConfigurationDto.getServiceUrl();\n+            String endcodedgatewayLabel= URLEncoder.encode(gatewayLabel, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.SYNAPSE_ARTIFACTS + \"?apiId=\" + APIId +\n+                    \"&gatewayInstruction=\" + gatewayInstruction + \"&gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String gatewayRuntimeArtifact = null;\n+            if (httpResponse.getEntity() != null ) {\n+                gatewayRuntimeArtifact = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact belongs to  \" + APIId + \" from DB\", e);\n+            return gatewayRuntimeArtifact;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifacts;\n     }\n \n     @Override\n     public List<String> retrieveAllArtifacts(String label) throws ArtifactSynchronizerException {\n         List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        CloseableHttpResponse httpResponse = null;\n         try {\n-            List<ByteArrayInputStream> baip = apiMgtDAO.getAllGatewayPublishedAPIArtifacts(label);\n-            for (ByteArrayInputStream byteStream :baip){\n-                byte[] bytes = ByteStreams.toByteArray(byteStream);\n-                String  gatewayRuntimeArtifacts = new String(bytes);\n-                gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+            String endcodedgatewayLabel= URLEncoder.encode(label, APIConstants.DigestAuthConstants.CHARSET);\n+            String path = APIConstants.GatewayArtifactSynchronizer.GATEAY_SYNAPSE_ARTIFACTS\n+                    + \"?gatewayLabel=\"+ endcodedgatewayLabel;\n+            String endpoint = baseURL + path;\n+            httpResponse = invokeService(endpoint);\n+            String responseString;\n+            if (httpResponse.getEntity() != null ) {\n+                responseString = EntityUtils.toString(httpResponse.getEntity(),\n+                        APIConstants.DigestAuthConstants.CHARSET);\n+                httpResponse.close();\n+            } else {\n+                throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n-            if (log.isDebugEnabled()){\n-                log.debug(\"Successfully retrieved Artifacts from DB\");\n+            JSONObject artifactObject = new JSONObject(responseString);\n+            JSONArray jArray = (JSONArray)artifactObject.get(\"list\");\n+            if (jArray != null) {\n+                for (int i = 0; i < jArray.length(); i++) {\n+                    gatewayRuntimeArtifactsArray.add(jArray.get(i).toString());\n+                }\n             }\n-        } catch (APIManagementException | IOException e) {\n-            throw new ArtifactSynchronizerException(\"Error retrieving Artifact from DB\", e);\n+            return gatewayRuntimeArtifactsArray;\n+        } catch (IOException e) {\n+            String msg = \"Error while executing the http client\";\n+            log.error(msg, e);\n+            throw new ArtifactSynchronizerException(msg, e);\n         }\n-        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    private CloseableHttpResponse invokeService(String endpoint) throws IOException {\n+        HttpGet method = new HttpGet(endpoint);\n+        URL url = new URL(endpoint);\n+        String username = eventHubConfigurationDto.getUsername();\n+        String password = eventHubConfigurationDto.getPassword();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzNjIzMA=="}, "originalCommit": {"oid": "5bd22237441b3f4612408e9272a9de8c9d986429"}, "originalPosition": 126}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTg0ODExOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODoxOTowMlrOGtNY4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODo1OToxOVrOGtOzRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA1ODQ2NQ==", "bodyText": "Resultset closing missed", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r450058465", "createdAt": "2020-07-06T08:19:02Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,240 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO gatewayArtifactsMgtDAO = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (gatewayArtifactsMgtDAO == null) {\n+            gatewayArtifactsMgtDAO = new GatewayArtifactsMgtDAO();\n+        }\n+        return gatewayArtifactsMgtDAO;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.CHECK_API_EXISTS)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.CHECK_ARTIFACT_EXISTS)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            ResultSet rs = statement.executeQuery();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95d56c93e6b56670cfa563cf362dadd389407373"}, "originalPosition": 226}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA4MTYwNQ==", "bodyText": "a0f5e81", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r450081605", "createdAt": "2020-07-06T08:59:19Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/GatewayArtifactsMgtDAO.java", "diffHunk": "@@ -0,0 +1,240 @@\n+package org.wso2.carbon.apimgt.impl.dao;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.constants.SQLConstants;\n+import org.wso2.carbon.apimgt.impl.utils.GatewayArtifactsMgtDBUtil;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class GatewayArtifactsMgtDAO {\n+    private static final Log log = LogFactory.getLog(GatewayArtifactsMgtDAO.class);\n+    private static GatewayArtifactsMgtDAO gatewayArtifactsMgtDAO = null;\n+\n+    /**\n+     * Private constructor\n+     */\n+    private GatewayArtifactsMgtDAO () {\n+    }\n+\n+    /**\n+     * Method to get the instance of the GatewayArtifactsMgtDAO.\n+     *\n+     * @return {@link GatewayArtifactsMgtDAO} instance\n+     */\n+    public static GatewayArtifactsMgtDAO getInstance() {\n+        if (gatewayArtifactsMgtDAO == null) {\n+            gatewayArtifactsMgtDAO = new GatewayArtifactsMgtDAO();\n+        }\n+        return gatewayArtifactsMgtDAO;\n+    }\n+\n+    /**\n+     * Add details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param APIName      - Name of the API\n+     * @param version      - Version of the API\n+     * @param tenantDomain - Tenant domain of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIDetails(String APIId, String APIName, String version, String tenantDomain)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.ADD_GW_PUBLISHED_API_DETAILS)) {\n+                    statement.setString(1, APIId);\n+                    statement.setString(2, APIName);\n+                    statement.setString(3, version);\n+                    statement.setString(4, tenantDomain);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add API details for \" + APIName, e);\n+        }\n+    }\n+\n+    /**\n+     * Add or update details of the APIs published in the Gateway\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Published gateway's label\n+     * @param bais         - Byte array Input stream of the serializide gatewayAPIDTO\n+     * @param streamLength - Length of the stream\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public void addGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel, ByteArrayInputStream bais,\n+            int streamLength, String gatewayInstruction, String query)\n+            throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection()) {\n+            connection.setAutoCommit(false);\n+                try (PreparedStatement statement = connection.prepareStatement(query)) {\n+                    statement.setBinaryStream(1, bais, streamLength);\n+                    statement.setString(2, gatewayInstruction);\n+                    statement.setString(3, APIId);\n+                    statement.setString(4, gatewayLabel);\n+                    statement.executeUpdate();\n+                }\n+            connection.commit();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to add artifacts for \" + APIId, e);\n+        }\n+    }\n+\n+    /**\n+     * Retrieve the blob of the API\n+     *\n+     * @param APIId        - UUID of the API\n+     * @param gatewayLabel - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public String getGatewayPublishedAPIArtifacts(String APIId, String gatewayLabel,\n+            String gatewayInstruction)\n+            throws APIManagementException {\n+\n+        String gatewayRuntimeArtifacts = null;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_API_ARTIFACT)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            statement.setString(3, gatewayInstruction);\n+            ResultSet rs = statement.executeQuery();\n+            if (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    gatewayRuntimeArtifacts = IOUtils.toString(inputStream, APIConstants.DigestAuthConstants.CHARSET);\n+                } catch (IOException  e){\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \" + APIId, e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts of API with ID \" + APIId, e);\n+        }\n+        return gatewayRuntimeArtifacts;\n+    }\n+\n+    /**\n+     * Retrieve the list of blobs of the APIs for a given label\n+     *\n+     * @param label - Gateway label of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public List<String> getAllGatewayPublishedAPIArtifacts(String label)\n+            throws APIManagementException {\n+\n+        List<String> gatewayRuntimeArtifactsArray = new ArrayList<>();\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.GET_ALL_API_ARTIFACT)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, label);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                try (InputStream inputStream = rs.getBinaryStream(1)) {\n+                    String gatewayRuntimeArtifacts = IOUtils.toString(inputStream,\n+                            APIConstants.DigestAuthConstants.CHARSET);\n+                    gatewayRuntimeArtifactsArray.add(gatewayRuntimeArtifacts);\n+                } catch (IOException  e) {\n+                    handleException(\"Error in generating gatewayRuntimeArtifacts \", e);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to get artifacts \" , e);\n+        }\n+        return gatewayRuntimeArtifactsArray;\n+    }\n+\n+    /**\n+     * Check whether the API is published in any of the Gateways\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIPublishedInAnyGateway(String APIId) throws APIManagementException {\n+\n+        int count = 0;\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.GET_PUBLISHED_GATEWAYS_FOR_API)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            statement.setString(2, APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n+            ResultSet rs = statement.executeQuery();\n+            while (rs.next()) {\n+                count = rs.getInt(\"COUNT\");\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed check whether API is published in any gateway \" + APIId, e);\n+        }\n+        return count != 0;\n+    }\n+\n+    /**\n+     * Check whether the API details exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIDetailsExists(String APIId) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection\n+                        .prepareStatement(SQLConstants.CHECK_API_EXISTS)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            ResultSet rs = statement.executeQuery();\n+            return rs.next();\n+        } catch (SQLException e) {\n+            handleException(\"Failed to check API details status of API with ID \" + APIId, e);\n+        }\n+        return false;\n+    }\n+\n+    /**\n+     * Check whether the API artifact for given label exists in the db\n+     *\n+     * @param APIId - UUID of the API\n+     * @throws APIManagementException if an error occurs\n+     */\n+    public boolean isAPIArtifactExists(String APIId, String gatewayLabel) throws APIManagementException {\n+\n+        try (Connection connection = GatewayArtifactsMgtDBUtil.getArtifactSynchronizerConnection();\n+                PreparedStatement statement = connection.prepareStatement(SQLConstants.CHECK_ARTIFACT_EXISTS)) {\n+            connection.setAutoCommit(false);\n+            connection.commit();\n+            statement.setString(1, APIId);\n+            statement.setString(2, gatewayLabel);\n+            ResultSet rs = statement.executeQuery();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA1ODQ2NQ=="}, "originalCommit": {"oid": "95d56c93e6b56670cfa563cf362dadd389407373"}, "originalPosition": 226}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM0MTM2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDowOTo1NlrOIDoR4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzoyMzozOFrOIOgKOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjU3OQ==", "bodyText": "I think we can have this declaration in single line.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540676579", "createdAt": "2020-12-11T04:09:56Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -99,4 +102,40 @@ public void invoke() {\n         }\n     }\n \n-}\n+\n+    public void startListener() {\n+        new Thread(this).start();\n+    }\n+\n+    @Override\n+    public void run() {\n+        deployArtifactsInGateway();\n+    }\n+\n+    private void deployArtifactsInGateway() {\n+\n+        long retryDuration =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA3Nzg4MA==", "bodyText": "Fixed in the latest version https://github.com/wso2/carbon-apimgt/blob/master/components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java#L164", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552077880", "createdAt": "2021-01-05T17:23:38Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -99,4 +102,40 @@ public void invoke() {\n         }\n     }\n \n-}\n+\n+    public void startListener() {\n+        new Thread(this).start();\n+    }\n+\n+    @Override\n+    public void run() {\n+        deployArtifactsInGateway();\n+    }\n+\n+    private void deployArtifactsInGateway() {\n+\n+        long retryDuration =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjU3OQ=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM0MjE3OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxMDoxM1rOIDoSUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzozNDo1OVrOIOgk8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjY4OQ==", "bodyText": "new line in the end of file", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540676689", "createdAt": "2020-12-11T04:10:13Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -99,4 +102,40 @@ public void invoke() {\n         }\n     }\n \n-}\n+\n+    public void startListener() {\n+        new Thread(this).start();\n+    }\n+\n+    @Override\n+    public void run() {\n+        deployArtifactsInGateway();\n+    }\n+\n+    private void deployArtifactsInGateway() {\n+\n+        long retryDuration =\n+                gatewayArtifactSynchronizerProperties.getRetryDuartion();\n+        double reconnectionProgressionFactor = 2.0;\n+        long maxReconnectDuration = 1000 * 60 * 60; // 1 hour\n+\n+        while (true) {\n+            boolean isArtifactsDeployed = deployArtifactsAtStartup();\n+            if (isArtifactsDeployed) {\n+                log.info(\"Synapse Artifacts deployed Successfully in the Gateway\");\n+                break;\n+            } else {\n+                retryDuration = (long) (retryDuration * reconnectionProgressionFactor);\n+                if (retryDuration > maxReconnectDuration) {\n+                    retryDuration = maxReconnectDuration;\n+                }\n+                log.error(\"Unable to deploy synapse artifacts at gateway. Next retry in \" + (retryDuration / 1000)\n+                        + \" seconds\");\n+                try {\n+                    Thread.sleep(retryDuration);\n+                } catch (InterruptedException ignore) {\n+                }\n+            }\n+        }\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4NDcyMw==", "bodyText": "9779641", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552084723", "createdAt": "2021-01-05T17:34:59Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/listeners/GatewayStartupListener.java", "diffHunk": "@@ -99,4 +102,40 @@ public void invoke() {\n         }\n     }\n \n-}\n+\n+    public void startListener() {\n+        new Thread(this).start();\n+    }\n+\n+    @Override\n+    public void run() {\n+        deployArtifactsInGateway();\n+    }\n+\n+    private void deployArtifactsInGateway() {\n+\n+        long retryDuration =\n+                gatewayArtifactSynchronizerProperties.getRetryDuartion();\n+        double reconnectionProgressionFactor = 2.0;\n+        long maxReconnectDuration = 1000 * 60 * 60; // 1 hour\n+\n+        while (true) {\n+            boolean isArtifactsDeployed = deployArtifactsAtStartup();\n+            if (isArtifactsDeployed) {\n+                log.info(\"Synapse Artifacts deployed Successfully in the Gateway\");\n+                break;\n+            } else {\n+                retryDuration = (long) (retryDuration * reconnectionProgressionFactor);\n+                if (retryDuration > maxReconnectDuration) {\n+                    retryDuration = maxReconnectDuration;\n+                }\n+                log.error(\"Unable to deploy synapse artifacts at gateway. Next retry in \" + (retryDuration / 1000)\n+                        + \" seconds\");\n+                try {\n+                    Thread.sleep(retryDuration);\n+                } catch (InterruptedException ignore) {\n+                }\n+            }\n+        }\n+    }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjY4OQ=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM0ODIyOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBSaver.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxMjo1MVrOIDoVnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzozNDoxN1rOIOgjUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NzUzMw==", "bodyText": "new line in the EOF.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540677533", "createdAt": "2020-12-11T04:12:51Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBSaver.java", "diffHunk": "@@ -96,4 +101,4 @@ public String getName() {\n \n         return APIConstants.GatewayArtifactSynchronizer.DB_SAVER_NAME;\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4NDMwNQ==", "bodyText": "9779641", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552084305", "createdAt": "2021-01-05T17:34:17Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBSaver.java", "diffHunk": "@@ -96,4 +101,4 @@ public String getName() {\n \n         return APIConstants.GatewayArtifactSynchronizer.DB_SAVER_NAME;\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NzUzMw=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1MDExOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxMzo0NlrOIDoWnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzoyNDo1NFrOIOgNDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3Nzc4OQ==", "bodyText": "Can we get rid of these additional new lines in the middle", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540677789", "createdAt": "2020-12-11T04:13:46Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApi.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.dto.ErrorDTO;\n+import org.wso2.carbon.apimgt.internal.service.SynapseArtifactsApiService;\n+import org.wso2.carbon.apimgt.internal.service.impl.SynapseArtifactsApiServiceImpl;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+\n+import javax.ws.rs.*;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.Response;\n+import javax.ws.rs.core.SecurityContext;\n+import javax.inject.Inject;\n+\n+import io.swagger.annotations.*;\n+import java.io.InputStream;\n+\n+import org.apache.cxf.jaxrs.ext.MessageContext;\n+import org.apache.cxf.jaxrs.ext.multipart.Attachment;\n+import org.apache.cxf.jaxrs.ext.multipart.Multipart;\n+\n+import java.util.Map;\n+import java.util.List;\n+import javax.validation.constraints.*;\n+@Path(\"/synapse-artifacts\")\n+\n+@Api(description = \"the synapse-artifacts API\")\n+\n+@Produces({ \"application/json\" })\n+\n+\n+public class SynapseArtifactsApi  {\n+\n+  @Context MessageContext securityContext;\n+\n+SynapseArtifactsApiService delegate = new SynapseArtifactsApiServiceImpl();\n+\n+\n+    @GET\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA3ODYwNg==", "bodyText": "This is an auto generated file. We don't need to modify this.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552078606", "createdAt": "2021-01-05T17:24:54Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApi.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.dto.ErrorDTO;\n+import org.wso2.carbon.apimgt.internal.service.SynapseArtifactsApiService;\n+import org.wso2.carbon.apimgt.internal.service.impl.SynapseArtifactsApiServiceImpl;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+\n+import javax.ws.rs.*;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.Response;\n+import javax.ws.rs.core.SecurityContext;\n+import javax.inject.Inject;\n+\n+import io.swagger.annotations.*;\n+import java.io.InputStream;\n+\n+import org.apache.cxf.jaxrs.ext.MessageContext;\n+import org.apache.cxf.jaxrs.ext.multipart.Attachment;\n+import org.apache.cxf.jaxrs.ext.multipart.Multipart;\n+\n+import java.util.Map;\n+import java.util.List;\n+import javax.validation.constraints.*;\n+@Path(\"/synapse-artifacts\")\n+\n+@Api(description = \"the synapse-artifacts API\")\n+\n+@Produces({ \"application/json\" })\n+\n+\n+public class SynapseArtifactsApi  {\n+\n+  @Context MessageContext securityContext;\n+\n+SynapseArtifactsApiService delegate = new SynapseArtifactsApiServiceImpl();\n+\n+\n+    @GET\n+    ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3Nzc4OQ=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1MTUxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/dto/SynapseArtifactDTO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxNDoyNVrOIDoXYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzoyNzowN1rOIOgS0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3Nzk4Nw==", "bodyText": "remove additional new lines", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540677987", "createdAt": "2020-12-11T04:14:25Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/dto/SynapseArtifactDTO.java", "diffHunk": "@@ -0,0 +1,202 @@\n+package org.wso2.carbon.apimgt.internal.service.dto;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import javax.validation.constraints.*;\n+\n+\n+import io.swagger.annotations.*;\n+import java.util.Objects;\n+\n+import javax.xml.bind.annotation.*;\n+import org.wso2.carbon.apimgt.rest.api.util.annotations.Scope;\n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MDA4MQ==", "bodyText": "This is an auto generated file. We don't need to modify this.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552080081", "createdAt": "2021-01-05T17:27:07Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/dto/SynapseArtifactDTO.java", "diffHunk": "@@ -0,0 +1,202 @@\n+package org.wso2.carbon.apimgt.internal.service.dto;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import javax.validation.constraints.*;\n+\n+\n+import io.swagger.annotations.*;\n+import java.util.Objects;\n+\n+import javax.xml.bind.annotation.*;\n+import org.wso2.carbon.apimgt.rest.api.util.annotations.Scope;\n+\n+\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3Nzk4Nw=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1MzUyOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/GatewaySynapseArtifactsApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxNTowOFrOIDoYZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzoyNzoxNVrOIOgTJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODI0NQ==", "bodyText": "Import the exact Class rather than using wildcard.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540678245", "createdAt": "2020-12-11T04:15:08Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/GatewaySynapseArtifactsApi.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.dto.ErrorDTO;\n+import org.wso2.carbon.apimgt.internal.service.dto.SynapseArtifactListDTO;\n+import org.wso2.carbon.apimgt.internal.service.GatewaySynapseArtifactsApiService;\n+import org.wso2.carbon.apimgt.internal.service.impl.GatewaySynapseArtifactsApiServiceImpl;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+\n+import javax.ws.rs.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MDE2Nw==", "bodyText": "This is an auto-generated file. We don't need to modify this.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552080167", "createdAt": "2021-01-05T17:27:15Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/GatewaySynapseArtifactsApi.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.dto.ErrorDTO;\n+import org.wso2.carbon.apimgt.internal.service.dto.SynapseArtifactListDTO;\n+import org.wso2.carbon.apimgt.internal.service.GatewaySynapseArtifactsApiService;\n+import org.wso2.carbon.apimgt.internal.service.impl.GatewaySynapseArtifactsApiServiceImpl;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+\n+import javax.ws.rs.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODI0NQ=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1NDAxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/GatewaySynapseArtifactsApiService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxNToyMlrOIDoYpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzoyNzoyM1rOIOgTcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODMxMQ==", "bodyText": "Import the exact Class rather than using wildcard.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540678311", "createdAt": "2020-12-11T04:15:22Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/GatewaySynapseArtifactsApiService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MDI0MQ==", "bodyText": "This is an auto-generated file. We don't need to modify this.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552080241", "createdAt": "2021-01-05T17:27:23Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/GatewaySynapseArtifactsApiService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODMxMQ=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1NDM0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxNTozM1rOIDoYzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzoyNzoyOVrOIOgTqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODM0OQ==", "bodyText": "Import the exact Class rather than using wildcard.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540678349", "createdAt": "2020-12-11T04:15:33Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApi.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.dto.ErrorDTO;\n+import org.wso2.carbon.apimgt.internal.service.SynapseArtifactsApiService;\n+import org.wso2.carbon.apimgt.internal.service.impl.SynapseArtifactsApiServiceImpl;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+\n+import javax.ws.rs.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MDI5Nw==", "bodyText": "This is an auto-generated file. We don't need to modify this.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552080297", "createdAt": "2021-01-05T17:27:29Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApi.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.dto.ErrorDTO;\n+import org.wso2.carbon.apimgt.internal.service.SynapseArtifactsApiService;\n+import org.wso2.carbon.apimgt.internal.service.impl.SynapseArtifactsApiServiceImpl;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+\n+import javax.ws.rs.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODM0OQ=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1ODEzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxNzowN1rOIDoavA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzoyOTozN1rOIOgZKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODg0NA==", "bodyText": "remove additional new line", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540678844", "createdAt": "2020-12-11T04:17:07Z", "author": {"login": "VirajSalaka"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package org.wso2.carbon.apimgt.internal.service.impl;\n+\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.dao.GatewayArtifactsMgtDAO;\n+import org.wso2.carbon.apimgt.internal.service.GatewaySynapseArtifactsApiService;\n+import org.apache.cxf.jaxrs.ext.MessageContext;\n+import org.wso2.carbon.apimgt.internal.service.dto.SynapseArtifactListDTO;\n+import java.util.List;\n+import javax.ws.rs.core.Response;\n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MTcwNQ==", "bodyText": "Fixed in the latest version https://github.com/wso2/carbon-apimgt/blob/master/components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java#L12", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552081705", "createdAt": "2021-01-05T17:29:37Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/main/java/org/wso2/carbon/apimgt/internal/service/impl/GatewaySynapseArtifactsApiServiceImpl.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package org.wso2.carbon.apimgt.internal.service.impl;\n+\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.impl.dao.GatewayArtifactsMgtDAO;\n+import org.wso2.carbon.apimgt.internal.service.GatewaySynapseArtifactsApiService;\n+import org.apache.cxf.jaxrs.ext.MessageContext;\n+import org.wso2.carbon.apimgt.internal.service.dto.SynapseArtifactListDTO;\n+import java.util.List;\n+import javax.ws.rs.core.Response;\n+\n+\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3ODg0NA=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1OTQ5OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/package.json.lerna_backup", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxNzozMlrOIDobYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzozMTo1OFrOIOgd8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3OTAwOQ==", "bodyText": "new line", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540679009", "createdAt": "2020-12-11T04:17:32Z", "author": {"login": "VirajSalaka"}, "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/package.json.lerna_backup", "diffHunk": "@@ -111,4 +111,4 @@\n         \"webpack-cli\": \"^3.3.2\",\n         \"worker-loader\": \"^2.0.0\"\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MjkyOA==", "bodyText": "File removed in the latest version", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552082928", "createdAt": "2021-01-05T17:31:58Z", "author": {"login": "Sarangan0219"}, "path": "features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/package.json.lerna_backup", "diffHunk": "@@ -111,4 +111,4 @@\n         \"webpack-cli\": \"^3.3.2\",\n         \"worker-loader\": \"^2.0.0\"\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3OTAwOQ=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTM1OTgwOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/package.json.lerna_backup", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDoxNzo0M1rOIDobig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzozMjowOVrOIOgeWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3OTA1MA==", "bodyText": "new line", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r540679050", "createdAt": "2020-12-11T04:17:43Z", "author": {"login": "VirajSalaka"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/package.json.lerna_backup", "diffHunk": "@@ -110,4 +110,4 @@\n         \"webpack-bundle-analyzer\": \"^3.2.0\",\n         \"webpack-cli\": \"^3.3.2\"\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MzAzNQ==", "bodyText": "File removed in the latest version", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552083035", "createdAt": "2021-01-05T17:32:09Z", "author": {"login": "Sarangan0219"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/package.json.lerna_backup", "diffHunk": "@@ -110,4 +110,4 @@\n         \"webpack-bundle-analyzer\": \"^3.2.0\",\n         \"webpack-cli\": \"^3.3.2\"\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3OTA1MA=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3MjQ5NTQxOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApiService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwNjo0NTo1M1rOIOL1tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNzozMDo1M1rOIOgbsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTc0NDk1MA==", "bodyText": "Rather than using wild card import. use the exact classes.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r551744950", "createdAt": "2021-01-05T06:45:53Z", "author": {"login": "RAVEENSR"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApiService.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTc0NTA5Mw==", "bodyText": "Fix this issue in other places/files as well.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r551745093", "createdAt": "2021-01-05T06:46:16Z", "author": {"login": "RAVEENSR"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApiService.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTc0NDk1MA=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjA4MjM1Mw==", "bodyText": "This is an auto-generated file. We don't need to modify this.", "url": "https://github.com/wso2/carbon-apimgt/pull/8828#discussion_r552082353", "createdAt": "2021-01-05T17:30:53Z", "author": {"login": "Sarangan0219"}, "path": "components/apimgt/org.wso2.carbon.apimgt.internal.service/src/gen/java/org/wso2/carbon/apimgt/internal/service/SynapseArtifactsApiService.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.wso2.carbon.apimgt.internal.service;\n+\n+import org.wso2.carbon.apimgt.internal.service.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTc0NDk1MA=="}, "originalCommit": {"oid": "686f3a550b65e231198479099a58630a224583ff"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3208, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}