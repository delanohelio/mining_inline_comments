{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzY0Nzky", "number": 9370, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzowN1rOE3_7Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNDo1Mzo1NFrOFUW8Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MTU0NDM4OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzowN1rOHxqtGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzowN1rOHxqtGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0MTk0Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                isOriginalRoleAlreadyInroles = true;\n          \n          \n            \n                                isOriginalRoleAlreadyInRoles = true;", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r521841947", "createdAt": "2020-11-12T05:07:07Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11614,6 +11614,25 @@ public static void updateTenantConfRoleAliasMapping(JSONObject newRoleMappingJso\n         } catch (UserStoreException e) {\n             APIUtil.handleException(\"Couldn't read tenant configuration from User Store\", e);\n         }\n+\n+        //append original role to the role mapping list\n+        Set<Map.Entry<String, JsonElement>> roleMappingEntries = newRoleMappingJson.entrySet();\n+        for (Map.Entry<String, JsonElement> entry: roleMappingEntries) {\n+            List<String> currentRoles = Arrays.asList(String.valueOf(entry.getValue()).split(\",\"));\n+            boolean isOriginalRoleAlreadyInroles = false;\n+            for (String role: currentRoles) {\n+                if (role.equals(entry.getKey())) {\n+                    isOriginalRoleAlreadyInroles = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7238b8ba1e6b8581d28ed32cbd37b8523546546a"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MTU0NDYzOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzoxOFrOHxqtPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTowNzoxOFrOHxqtPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0MTk4Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (!isOriginalRoleAlreadyInroles) {\n          \n          \n            \n                        if (!isOriginalRoleAlreadyInRoles) {", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r521841982", "createdAt": "2020-11-12T05:07:18Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11614,6 +11614,25 @@ public static void updateTenantConfRoleAliasMapping(JSONObject newRoleMappingJso\n         } catch (UserStoreException e) {\n             APIUtil.handleException(\"Couldn't read tenant configuration from User Store\", e);\n         }\n+\n+        //append original role to the role mapping list\n+        Set<Map.Entry<String, JsonElement>> roleMappingEntries = newRoleMappingJson.entrySet();\n+        for (Map.Entry<String, JsonElement> entry: roleMappingEntries) {\n+            List<String> currentRoles = Arrays.asList(String.valueOf(entry.getValue()).split(\",\"));\n+            boolean isOriginalRoleAlreadyInroles = false;\n+            for (String role: currentRoles) {\n+                if (role.equals(entry.getKey())) {\n+                    isOriginalRoleAlreadyInroles = true;\n+                    break;\n+                }\n+            }\n+\n+            if (!isOriginalRoleAlreadyInroles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7238b8ba1e6b8581d28ed32cbd37b8523546546a"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MTYwNzAwOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTozNjo0M1rOHxrQSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTozNjo0M1rOHxrQSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg1MDk1NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        boolean isOriginalRoleAlreadyInroles = false;\n          \n          \n            \n                        boolean isOriginalRoleAlreadyInRoles = false;", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r521850955", "createdAt": "2020-11-12T05:36:43Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11614,6 +11614,25 @@ public static void updateTenantConfRoleAliasMapping(JSONObject newRoleMappingJso\n         } catch (UserStoreException e) {\n             APIUtil.handleException(\"Couldn't read tenant configuration from User Store\", e);\n         }\n+\n+        //append original role to the role mapping list\n+        Set<Map.Entry<String, JsonElement>> roleMappingEntries = newRoleMappingJson.entrySet();\n+        for (Map.Entry<String, JsonElement> entry: roleMappingEntries) {\n+            List<String> currentRoles = Arrays.asList(String.valueOf(entry.getValue()).split(\",\"));\n+            boolean isOriginalRoleAlreadyInroles = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb8af196a77c4fd333cffda945154da09380f42a"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU2ODkxNjYyOnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNDo1Mzo1NFrOIcVNig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNToyNDo0NVrOIfHyfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU3ODU3MA==", "bodyText": "Shall we remove this extra line?", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r566578570", "createdAt": "2021-01-29T04:53:54Z", "author": {"login": "kavishkafernando"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11752,6 +11771,7 @@ public static boolean isCrossTenantSubscriptionsEnabled() {\n         return false;\n     }\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "072b4f56812174cdd5bb57a831350f741162e9bb"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTUwNDM4MA==", "bodyText": "Fixed in 3e4283c", "url": "https://github.com/wso2/carbon-apimgt/pull/9370#discussion_r569504380", "createdAt": "2021-02-03T15:24:45Z", "author": {"login": "chashikajw"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -11752,6 +11771,7 @@ public static boolean isCrossTenantSubscriptionsEnabled() {\n         return false;\n     }\n \n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU3ODU3MA=="}, "originalCommit": {"oid": "072b4f56812174cdd5bb57a831350f741162e9bb"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2993, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}