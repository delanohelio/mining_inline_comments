{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NTI5ODU1", "number": 8489, "title": "Add implementation of addRegistryEntry resource", "bodyText": "", "createdAt": "2020-05-12T07:06:05Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8489", "merged": true, "mergeCommit": {"oid": "70f1d9c017cc26f222484375a540ba2f216c9aee"}, "closed": true, "closedAt": "2020-05-12T08:36:28Z", "author": {"login": "vithu30"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgbGqDAH2gAyNDE2NTI5ODU1OmUxYTAzOWRkZjdhNmI5ZGMwNzNlNDIxNGE1OWYxYjdkYWRiZjZmZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcggHE4gFqTQwOTgyMDUxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e1a039ddf7a6b9dc073e4214a59f1b7dadbf6ffd", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e1a039ddf7a6b9dc073e4214a59f1b7dadbf6ffd", "committedDate": "2020-05-12T02:46:22Z", "message": "Add initial impl of add registry entry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa992591b9f853f141f63c937fd05ade3fa31024", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/aa992591b9f853f141f63c937fd05ade3fa31024", "committedDate": "2020-05-12T02:55:22Z", "message": "Fetch GET resources impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/4fa06ad511c80776ea0b2ef7fffce3732695acf6", "committedDate": "2020-05-12T07:19:04Z", "message": "Add impl for POST RegistryEntry"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec3169612810327f375e176318a55cfd0740904a", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ec3169612810327f375e176318a55cfd0740904a", "committedDate": "2020-05-12T06:09:15Z", "message": "Add impl for POST RegistryEntry"}, "afterCommit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/4fa06ad511c80776ea0b2ef7fffce3732695acf6", "committedDate": "2020-05-12T07:19:04Z", "message": "Add impl for POST RegistryEntry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc2NTA0", "url": "https://github.com/wso2/carbon-apimgt/pull/8489#pullrequestreview-409776504", "createdAt": "2020-05-12T07:39:40Z", "commit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozOTo0MFrOGT57gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzozOTo0MFrOGT57gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNTI0OQ==", "bodyText": "is there an issue in doing a getEndpointRegistryByUUID instead of introducing a new SQL query to check the existance?", "url": "https://github.com/wso2/carbon-apimgt/pull/8489#discussion_r423525249", "createdAt": "2020-05-12T07:39:40Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -1429,10 +1428,16 @@\n                     \"FROM ENDPOINT_REG_ENTRY AS E, ENDPOINT_REG AS R \" +\n                     \"WHERE E.REG_ID=R.ID AND R.UUID=?\";\n \n+    public static final String ADD_ENDPOINT_REGISTRY_ENTRY_SQL =\n+            \"INSERT INTO ENDPOINT_REG_ENTRY (UUID, ENTRY_NAME, SERVICE_URL, DEFINITION_TYPE, DEFINITION_URL, METADATA,\" +\n+                    \"SERVICE_TYPE, ENDPOINT_DEFINITION, REG_ID) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\";\n \n     public static final String IS_ENDPOINT_REGISTRY_NAME_EXISTS = \"SELECT COUNT(UUID) AS ENDPOINT_REGISTRY_COUNT\" +\n             \" FROM ENDPOINT_REG WHERE LOWER(REG_NAME) = LOWER(?) AND TENANT_ID = ?\";\n \n+    public static final String IS_ENDPOINT_REGISTRY_ENTRY_NAME_EXISTS = \"SELECT COUNT(UUID) AS REGISTRY_ENTRY_COUNT\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzc3MTk1", "url": "https://github.com/wso2/carbon-apimgt/pull/8489#pullrequestreview-409777195", "createdAt": "2020-05-12T07:40:34Z", "commit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MDozNFrOGT59tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0MDozNFrOGT59tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyNTgxNQ==", "bodyText": "why removed?", "url": "https://github.com/wso2/carbon-apimgt/pull/8489#discussion_r423525815", "createdAt": "2020-05-12T07:40:34Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14869,8 +14870,6 @@ public EndpointRegistryEntry getEndpointRegistryEntryByUUID(String registryEntry\n                     endpointRegistryEntry.setServiceType(rs.getString(\"SERVICE_TYPE\"));\n                     endpointRegistryEntry.setServiceURL(rs.getString(\"SERVICE_URL\"));\n                     endpointRegistryEntry.setMetaData(rs.getString(\"METADATA\"));\n-                    ResourceFile resourceFile = new ResourceFile(rs.getBinaryStream(\"ENDPOINT_DEFINITION\"),\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzgwODM2", "url": "https://github.com/wso2/carbon-apimgt/pull/8489#pullrequestreview-409780836", "createdAt": "2020-05-12T07:45:43Z", "commit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NTo0M1rOGT6JIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNzo0NTo0M1rOGT6JIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUyODczNg==", "bodyText": "do we store the content type in the db? do we need it for any purpose?", "url": "https://github.com/wso2/carbon-apimgt/pull/8489#discussion_r423528736", "createdAt": "2020-05-12T07:45:43Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/impl/RegistriesApiServiceImpl.java", "diffHunk": "@@ -126,7 +127,28 @@ public Response addRegistry(RegistryDTO body, MessageContext messageContext) {\n     @Override\n     public Response createRegistryEntry(String registryId, RegistryEntryDTO registryEntry, InputStream\n             definitionFileInputStream, Attachment definitionFileDetail, MessageContext messageContext) {\n-        return Response.ok().entity(registryEntry).build();\n+        EndpointRegistry registryProvider = new EndpointRegistryImpl();\n+        EndpointRegistryEntry createdEntry = null;\n+        try {\n+            EndpointRegistryInfo endpointRegistry = registryProvider.getEndpointRegistryByUUID(registryId);\n+            if (endpointRegistry == null) {\n+                RestApiUtil.handleResourceNotFoundError(\"Endpoint registry with the id: \" + registryId +\n+                        \" is not found\", log);\n+            }\n+            ResourceFile definitionFile = new ResourceFile(definitionFileInputStream, definitionFileDetail", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODIwNTE4", "url": "https://github.com/wso2/carbon-apimgt/pull/8489#pullrequestreview-409820518", "createdAt": "2020-05-12T08:36:21Z", "commit": {"oid": "4fa06ad511c80776ea0b2ef7fffce3732695acf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2849, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}