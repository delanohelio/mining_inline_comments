{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMTg4MDUx", "number": 8547, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzo1NjoxNVrOD-gksg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzo1NjoyM1rOD-gk0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2ODcxOTg2OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/CommonThrottleMappingUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzo1NjoxNVrOGYpu3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzo1NjoxNVrOGYpu3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMjc1MA==", "bodyText": "We shouldn't do both log and throw.. Let's remove logging here.", "url": "https://github.com/wso2/carbon-apimgt/pull/8547#discussion_r428502750", "createdAt": "2020-05-21T07:56:15Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/CommonThrottleMappingUtil.java", "diffHunk": "@@ -205,33 +205,65 @@ public static ThrottleConditionDTO fromConditionToDTO(Condition condition)   //.\n      * @return Derived Quota policy object from DTO\n      * @throws UnsupportedThrottleLimitTypeException\n      */\n-    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitDTO dto) throws UnsupportedThrottleLimitTypeException {\n+    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        ThrottleLimitDTO throttleLimit = getThrottleLimitType(dto);\n         QuotaPolicy quotaPolicy = new QuotaPolicy();\n-        quotaPolicy.setLimit(fromDTOToLimit(dto));\n-        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(dto.getType()));\n+        quotaPolicy.setLimit(fromDTOToLimit(throttleLimit));\n+        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(throttleLimit.getType()));\n         return quotaPolicy;\n     }\n \n     /**\n-     * Converts a Quota Policy object into a Throttle Limit DTO object\n+     * Obtain Throttle Limit DTO object from Throttle Limit Type object\n+     *\n+     * @param dto Throttle Policy Default limit DTO object\n+     * @return Throttle Limit DTO object\n+     * @throws UnsupportedThrottleLimitTypeException\n+     */\n+    public static ThrottleLimitDTO getThrottleLimitType(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        if (dto.getBandwidth() != null && dto.getRequestCount() != null) {\n+            String msg = \"Throttle limit types \" + dto.getBandwidth().getClass().getName() + \" and \" +\n+                    dto.getRequestCount().getClass().getName() + \" cannot be specified at once\";\n+            log.error(msg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab509bcb4779c4cf5a251075a3b24ab2df44940"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2ODcyMDE3OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/CommonThrottleMappingUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzo1NjoyM1rOGYpvDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzo1ODoxNVrOGYpySw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMjc5OA==", "bodyText": "same here", "url": "https://github.com/wso2/carbon-apimgt/pull/8547#discussion_r428502798", "createdAt": "2020-05-21T07:56:23Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/CommonThrottleMappingUtil.java", "diffHunk": "@@ -205,33 +205,65 @@ public static ThrottleConditionDTO fromConditionToDTO(Condition condition)   //.\n      * @return Derived Quota policy object from DTO\n      * @throws UnsupportedThrottleLimitTypeException\n      */\n-    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitDTO dto) throws UnsupportedThrottleLimitTypeException {\n+    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        ThrottleLimitDTO throttleLimit = getThrottleLimitType(dto);\n         QuotaPolicy quotaPolicy = new QuotaPolicy();\n-        quotaPolicy.setLimit(fromDTOToLimit(dto));\n-        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(dto.getType()));\n+        quotaPolicy.setLimit(fromDTOToLimit(throttleLimit));\n+        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(throttleLimit.getType()));\n         return quotaPolicy;\n     }\n \n     /**\n-     * Converts a Quota Policy object into a Throttle Limit DTO object\n+     * Obtain Throttle Limit DTO object from Throttle Limit Type object\n+     *\n+     * @param dto Throttle Policy Default limit DTO object\n+     * @return Throttle Limit DTO object\n+     * @throws UnsupportedThrottleLimitTypeException\n+     */\n+    public static ThrottleLimitDTO getThrottleLimitType(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        if (dto.getBandwidth() != null && dto.getRequestCount() != null) {\n+            String msg = \"Throttle limit types \" + dto.getBandwidth().getClass().getName() + \" and \" +\n+                    dto.getRequestCount().getClass().getName() + \" cannot be specified at once\";\n+            log.error(msg);\n+            throw new UnsupportedThrottleLimitTypeException(msg);\n+        } else if (dto.getBandwidth() != null) {\n+            return dto.getBandwidth();\n+        } else if (dto.getRequestCount() != null) {\n+            return dto.getRequestCount();\n+        } else {\n+            String msg = \"A Throttle limit type has not been specified\";\n+            log.error(msg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab509bcb4779c4cf5a251075a3b24ab2df44940"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMzYyNw==", "bodyText": "throw new UnsupportedThrottleLimitTypeException(\"A Throttle limit type has not been specified\");", "url": "https://github.com/wso2/carbon-apimgt/pull/8547#discussion_r428503627", "createdAt": "2020-05-21T07:58:15Z", "author": {"login": "malinthaprasan"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/throttling/CommonThrottleMappingUtil.java", "diffHunk": "@@ -205,33 +205,65 @@ public static ThrottleConditionDTO fromConditionToDTO(Condition condition)   //.\n      * @return Derived Quota policy object from DTO\n      * @throws UnsupportedThrottleLimitTypeException\n      */\n-    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitDTO dto) throws UnsupportedThrottleLimitTypeException {\n+    public static QuotaPolicy fromDTOToQuotaPolicy(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        ThrottleLimitDTO throttleLimit = getThrottleLimitType(dto);\n         QuotaPolicy quotaPolicy = new QuotaPolicy();\n-        quotaPolicy.setLimit(fromDTOToLimit(dto));\n-        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(dto.getType()));\n+        quotaPolicy.setLimit(fromDTOToLimit(throttleLimit));\n+        quotaPolicy.setType(mapQuotaPolicyTypeFromDTOToModel(throttleLimit.getType()));\n         return quotaPolicy;\n     }\n \n     /**\n-     * Converts a Quota Policy object into a Throttle Limit DTO object\n+     * Obtain Throttle Limit DTO object from Throttle Limit Type object\n+     *\n+     * @param dto Throttle Policy Default limit DTO object\n+     * @return Throttle Limit DTO object\n+     * @throws UnsupportedThrottleLimitTypeException\n+     */\n+    public static ThrottleLimitDTO getThrottleLimitType(ThrottleLimitTypeDTO dto)\n+            throws UnsupportedThrottleLimitTypeException {\n+\n+        if (dto.getBandwidth() != null && dto.getRequestCount() != null) {\n+            String msg = \"Throttle limit types \" + dto.getBandwidth().getClass().getName() + \" and \" +\n+                    dto.getRequestCount().getClass().getName() + \" cannot be specified at once\";\n+            log.error(msg);\n+            throw new UnsupportedThrottleLimitTypeException(msg);\n+        } else if (dto.getBandwidth() != null) {\n+            return dto.getBandwidth();\n+        } else if (dto.getRequestCount() != null) {\n+            return dto.getRequestCount();\n+        } else {\n+            String msg = \"A Throttle limit type has not been specified\";\n+            log.error(msg);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUwMjc5OA=="}, "originalCommit": {"oid": "2ab509bcb4779c4cf5a251075a3b24ab2df44940"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3430, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}