{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzQ2ODUz", "number": 8778, "title": "Fix subscription loading by policy name rest api", "bodyText": "Fix subscription policy loading by name\nfix subscription policy per tenant\nadd policy check for situation where policy is not in the map (due to tenant loading)", "createdAt": "2020-06-18T09:28:44Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8778", "merged": true, "mergeCommit": {"oid": "8f68459fe86eec1cee7324c5d05285dd27d91ffa"}, "closed": true, "closedAt": "2020-06-18T11:01:01Z", "author": {"login": "chamilaadhi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsbAfDgH2gAyNDM2MzQ2ODUzOjJmOTljYmYzNTQzY2NmMTQ1YmQ1NzRmNTgxN2Q0ZTBhNTNiZDZiMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsbIxVAFqTQzMzExMDA2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23", "author": {"user": {"login": "chamilaadhi", "name": "Chamila Adhikarinayake"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/2f99cbf3543ccf145bd574f5817d4e0a53bd6b23", "committedDate": "2020-06-18T09:26:43Z", "message": "Fix subscription loading by policy name rest api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTA2NTA0", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#pullrequestreview-433106504", "createdAt": "2020-06-18T09:31:09Z", "commit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTowOVrOGlnY6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTowOVrOGlnY6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTg0OQ==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442095849", "createdAt": "2020-06-18T09:31:09Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "diffHunk": "@@ -252,8 +254,26 @@ private APIKeyValidationInfoDTO validateSubscriptionDetails(APIKeyValidationInfo\n \n                                 ApplicationPolicy appPolicy = datastore.getApplicationPolicyByName(app.getPolicy(),\n                                         tenantId);\n+                                if(appPolicy == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTA2NjMz", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#pullrequestreview-433106633", "createdAt": "2020-06-18T09:31:19Z", "commit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMToxOVrOGlnZOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMToxOVrOGlnZOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NTkzMA==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442095930", "createdAt": "2020-06-18T09:31:19Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/handlers/AbstractKeyValidationHandler.java", "diffHunk": "@@ -252,8 +254,26 @@ private APIKeyValidationInfoDTO validateSubscriptionDetails(APIKeyValidationInfo\n \n                                 ApplicationPolicy appPolicy = datastore.getApplicationPolicyByName(app.getPolicy(),\n                                         tenantId);\n+                                if(appPolicy == null) {\n+                                    try {\n+                                        appPolicy = new SubscriptionDataLoaderImpl()\n+                                                .getApplicationPolicy(app.getPolicy(), apiTenantDomain);\n+                                        datastore.addOrUpdateApplicationPolicy(appPolicy);\n+                                    } catch (DataLoadingException e) {\n+                                        log.error(\"Error while loading ApplicationPolicy\");\n+                                    }\n+                                }\n                                 SubscriptionPolicy subPolicy = datastore.getSubscriptionPolicyByName(sub.getPolicyId(),\n                                         tenantId);\n+                                if(subPolicy == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTA2OTc0", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#pullrequestreview-433106974", "createdAt": "2020-06-18T09:31:45Z", "commit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTo0NVrOGlnaLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTozMTo0NVrOGlnaLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5NjE3Mg==", "bodyText": "Formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#discussion_r442096172", "createdAt": "2020-06-18T09:31:45Z", "author": {"login": "mushthaq33"}, "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/service/APIKeyValidationService.java", "diffHunk": "@@ -344,6 +347,19 @@ public APIKeyValidationInfoDTO validateKey(String context, String version, Strin\n             if (storeImpl.isApiPoliciesInitialized()) {\r\n                 log.debug(\"SubscriptionDataStore Initialized. Reading API Policies from SubscriptionDataStore\");\r\n                 apiPolicy = store.getApiPolicyByName(urlMapping.getThrottlingPolicy(), apiTenantId);\r\n+                if(apiPolicy == null) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f99cbf3543ccf145bd574f5817d4e0a53bd6b23"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7476d267ba23ce830bdea3b13bfcfaa8f2f45a0d", "author": {"user": {"login": "chamilaadhi", "name": "Chamila Adhikarinayake"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/7476d267ba23ce830bdea3b13bfcfaa8f2f45a0d", "committedDate": "2020-06-18T09:33:11Z", "message": "Fix formatting issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTEwMDY2", "url": "https://github.com/wso2/carbon-apimgt/pull/8778#pullrequestreview-433110066", "createdAt": "2020-06-18T09:35:46Z", "commit": {"oid": "7476d267ba23ce830bdea3b13bfcfaa8f2f45a0d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2660, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}