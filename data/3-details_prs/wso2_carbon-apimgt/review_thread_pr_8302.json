{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyOTIzNDY5", "number": 8302, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1MzowNVrODk-kVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMDozOToxMlrOD5WJEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMTAwNDM2OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1MzowNVrOFxmkHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1MzowNVrOFxmkHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NjM4Mg==", "bodyText": "Formatting issue.", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r387556382", "createdAt": "2020-03-04T09:53:05Z", "author": {"login": "menakaj"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "diffHunk": "@@ -25,15 +25,21 @@\n     app.context = appUtils.getTenantBaseStoreContext();\n     var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n     var serverUrl = \"\";\n+    var isPassive = require(\"/site/public/theme/settings.js\").Settings.app.isPassive;\n     var forwarded_for = request.getHeader(app.customUrl.forwardedHeader);\n     if (app.customUrl.enabled && forwarded_for) {\n         serverUrl = MGT_TRANSPORT + forwarded_for;\n     } else {\n         serverUrl = utils.getServerURL();\n     }\n-    if(request.getParameter(\"error\") === \"login_required\"){\n-       response.sendRedirect(serverUrl + app.context + \"/services/configs\");\n-    } else if(request.getParameter(\"code\") != null){\n+    if(request.getParameter(\"error\")===\"login_required\" && isPassive){\n+        if(utils.getIdentityProviderConfig()!=null){\n+        response.sendRedirect(serverUrl + app.context);\n+        }\n+        else{\n+        response.content={error:\"Loginerror\"};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa3ebe434ec10d8013f8534b623a3fa6947c06"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMTAwNTEwOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1MzoxOFrOFxmkkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1MzoxOFrOFxmkkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NjQ5OA==", "bodyText": "Formatting issue.", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r387556498", "createdAt": "2020-03-04T09:53:18Z", "author": {"login": "menakaj"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/services/login/login_callback.jag", "diffHunk": "@@ -25,15 +25,21 @@\n     app.context = appUtils.getTenantBaseStoreContext();\n     var utils = Packages.org.wso2.carbon.apimgt.impl.utils.APIUtil;\n     var serverUrl = \"\";\n+    var isPassive = require(\"/site/public/theme/settings.js\").Settings.app.isPassive;\n     var forwarded_for = request.getHeader(app.customUrl.forwardedHeader);\n     if (app.customUrl.enabled && forwarded_for) {\n         serverUrl = MGT_TRANSPORT + forwarded_for;\n     } else {\n         serverUrl = utils.getServerURL();\n     }\n-    if(request.getParameter(\"error\") === \"login_required\"){\n-       response.sendRedirect(serverUrl + app.context + \"/services/configs\");\n-    } else if(request.getParameter(\"code\") != null){\n+    if(request.getParameter(\"error\")===\"login_required\" && isPassive){\n+        if(utils.getIdentityProviderConfig()!=null){\n+        response.sendRedirect(serverUrl + app.context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa3ebe434ec10d8013f8534b623a3fa6947c06"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMTAwNzQxOnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/DevPortal.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1Mzo1OFrOFxmmBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1Mzo1OFrOFxmmBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1Njg2OQ==", "bodyText": "Fix formatting. Exceeds 120 character limit.", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r387556869", "createdAt": "2020-03-04T09:53:58Z", "author": {"login": "menakaj"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/DevPortal.jsx", "diffHunk": "@@ -84,6 +89,14 @@ class DevPortal extends React.Component {\n         promisedSettings\n             .then((response) => {\n                 this.setSettings(response.body);\n+            })\n+            .then((response) => {\n+                if(!this.state.settings.IsAnonymousModeEnabled){\n+                    this.setState({isNonAnonymous:true})\n+                }\n+                if (Settings.app.isPassive && !AuthManager.getUser() && !sessionStorage.getItem('notEnoughPermission') && !this.state.isNonAnonymous) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa3ebe434ec10d8013f8534b623a3fa6947c06"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMTAwODA5OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/DevPortal.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1NDoxMlrOFxmmgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo1NDoxMlrOFxmmgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1Njk5Mg==", "bodyText": "Add method comments.", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r387556992", "createdAt": "2020-03-04T09:54:12Z", "author": {"login": "menakaj"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/DevPortal.jsx", "diffHunk": "@@ -244,14 +255,45 @@ class DevPortal extends React.Component {\n         return (prefix + sufix);\n     }\n \n+    checkLoginUser(isExternalIDP) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81aa3ebe434ec10d8013f8534b623a3fa6947c06"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTYxODQ1OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowMDoyMFrOF7TqqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowMDoyMFrOF7TqqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczMjUyMQ==", "bodyText": "Why use debug logs?", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r397732521", "createdAt": "2020-03-25T10:00:20Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -5780,6 +5780,29 @@ public String getRequestedTenant() {\n         return requestedTenant;\n     }\n \n+    /**\n+     * To check whether the DevPortal Anonymous Mode is enabled. It can be either enabled globally or tenant vice.\n+     *\n+     * @param tenantDomain Tenant domain\n+     * @return whether devportal anonymous mode is enabled or not\n+     */\n+\n+    public boolean isDevPortalAnonymousEnabled(String tenantDomain) {\n+\n+        try {\n+            org.json.simple.JSONObject tenantConfig = APIUtil.getTenantConfig(tenantDomain);\n+            Object value = tenantConfig.get(APIConstants.API_TENANT_CONF_ENABLE_ANONYMOUS_MODE);\n+            if (value != null) {\n+                return Boolean.parseBoolean(value.toString());\n+            } else {\n+                return APIUtil.isDevPortalAnonymous();\n+            }\n+        } catch (APIManagementException e) {\n+            log.debug(\"Error while retrieving Recommendation config from registry\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b02277ecf988b4cc10275f91729098ed8448e4"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTYxOTk0OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowMDo0NFrOF7TrqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowMDo0NFrOF7TrqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczMjc3Nw==", "bodyText": "Add space before and after '+'", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r397732777", "createdAt": "2020-03-25T10:00:44Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConstants.java", "diffHunk": "@@ -688,6 +689,7 @@ private Permissions() {\n     public static final String API_STORE_MAP_EXISTING_AUTH_APPS = API_STORE + \"MapExistingAuthApps\";\n     public static final String API_STORE_API_KEY_ALIAS = API_STORE + \"ApiKeyAlias\";\n     public static final String WSO2_ANONYMOUS_USER = \"wso2.anonymous.user\";\n+    public static final String API_DEVPORTAL_ANONYMOUS_MODE = API_STORE+\"EnableAnonymousMode\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b02277ecf988b4cc10275f91729098ed8448e4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTYyMjE4OnYy", "diffSide": "RIGHT", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowMToyMVrOF7TtLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowMToyMVrOF7TtLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczMzE2NQ==", "bodyText": "Remove additional line", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r397733165", "createdAt": "2020-03-25T10:01:21Z", "author": {"login": "menakaj"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10321,6 +10321,17 @@ public static boolean isCertificateExistsInTrustStore(X509Certificate certificat\n         return false;\n     }\n \n+    public static boolean isDevPortalAnonymous() {\n+        APIManagerConfiguration config = ServiceReferenceHolder.getInstance().\n+                getAPIManagerConfigurationService().getAPIManagerConfiguration();\n+        String anonymousMode = config.getFirstProperty(APIConstants.API_DEVPORTAL_ANONYMOUS_MODE);\n+        if (anonymousMode == null) {\n+            return true;\n+        }\n+        return Boolean.parseBoolean(anonymousMode);\n+    }\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b02277ecf988b4cc10275f91729098ed8448e4"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NTYzNjQ2OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/ProtectedApp.jsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowNDo0OFrOF7T10A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDowNDo0OFrOF7T10A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczNTM3Ng==", "bodyText": "Please fix the following eslint issues.\n/home/travis/build/wso2/carbon-apimgt/features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/ProtectedApp.jsx\n71:77  error  A space is required before '}'       object-curly-spacing\n180:1   error  More than 2 blank lines not allowed  no-multiple-empty-lines\n222:42  error  Operator '+' must be spaced          space-infix-ops", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r397735376", "createdAt": "2020-03-25T10:04:48Z", "author": {"login": "menakaj"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/ProtectedApp.jsx", "diffHunk": "@@ -21,9 +21,10 @@ import qs from 'qs';\n import { withTheme } from '@material-ui/core/styles';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b02277ecf988b4cc10275f91729098ed8448e4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NjIzNzc5OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/data/Constants.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjo1NDozM1rOF7ZoMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjo1NDozM1rOF7ZoMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgzMDE5Mg==", "bodyText": "Please add spaces after \":\"\nISLOGINPERMITTED: 'isLoginPermitted',\nLOGINSTATUS: 'loginStatus',", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r397830192", "createdAt": "2020-03-25T12:54:33Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/data/Constants.jsx", "diffHunk": "@@ -20,6 +20,8 @@ const CONSTS = {\n         INSUFFICIENT_PREVILEGES: '900403: Insufficient privileges to login',\n         INVALID_TOKEN: '900401: Invalid token',\n     },\n+    ISLOGINPERMITTED:'isLoginPermitted',\n+    LOGINSTATUS:'loginStatus',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b02277ecf988b4cc10275f91729098ed8448e4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDU4MTk1OnYy", "diffSide": "RIGHT", "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/ProtectedApp.jsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMDozOToxMlrOGQjrHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMDozOToxMlrOGQjrHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxNDg3OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        + clientId + '&redirect_uri='+ window.location.origin\n          \n          \n            \n                        + clientId + '&redirect_uri=' + window.location.origin", "url": "https://github.com/wso2/carbon-apimgt/pull/8302#discussion_r420014878", "createdAt": "2020-05-05T10:39:12Z", "author": {"login": "malinthaprasan"}, "path": "features/apimgt/org.wso2.carbon.apimgt.store.feature/src/main/resources/devportal/source/src/app/ProtectedApp.jsx", "diffHunk": "@@ -217,12 +215,12 @@ class ProtectedApp extends Component {\n      */\n     render() {\n         const {\n-            userResolved, tenantList, notEnoughPermission, tenantResolved, clientId\n+            userResolved, tenantList, notEnoughPermission, tenantResolved, clientId,\n         } = this.state;\n         const checkSessionURL = Settings.idp.checkSessionEndpoint + '?client_id='\n             + clientId + '&redirect_uri='+ window.location.origin", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dda5ede3c17de5e9c9cbc1b018885194a87d3485"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2822, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}