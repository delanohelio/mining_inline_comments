{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyODQxNDEw", "number": 8163, "title": "Fix the issue in generating swagger when WSDL has inline nested complex types definitions ", "bodyText": "This PR fixes wso2/product-apim#7108. Ports the fix added to 2.6.0", "createdAt": "2020-02-09T15:37:06Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8163", "merged": true, "mergeCommit": {"oid": "8b990d60f80907911c887eac5ca406379c2d85f7"}, "closed": true, "closedAt": "2020-02-10T09:21:40Z", "author": {"login": "vithu30"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCqWnpgH2gAyMzcyODQxNDEwOmMzZDI0ZDg3ODEzMGU3ZjQ1M2U5ODFkM2QzZTI3OTBjNTM1YzE1NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC3THFgFqTM1NTcxNDUyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c3d24d878130e7f453e981d3d3e2790c535c1554", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/c3d24d878130e7f453e981d3d3e2790c535c1554", "committedDate": "2020-02-09T15:34:39Z", "message": "Add support to nested inline complex types in SOAP to REST"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1Njk0MzY0", "url": "https://github.com/wso2/carbon-apimgt/pull/8163#pullrequestreview-355694364", "createdAt": "2020-02-10T05:12:00Z", "commit": {"oid": "c3d24d878130e7f453e981d3d3e2790c535c1554"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNToxMjowMFrOFnaYuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNToxMjowMFrOFnaYuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg3MTA5Ng==", "bodyText": "Please check whether the length is exceeded?", "url": "https://github.com/wso2/carbon-apimgt/pull/8163#discussion_r376871096", "createdAt": "2020-02-10T05:12:00Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/wsdl/WSDL11SOAPOperationExtractor.java", "diffHunk": "@@ -386,11 +388,55 @@ private void addModelDefinition(Node current, ModelImpl model, String type, bool\n                             //do nothing\n                         } else if (model.getProperties().containsKey(element)) {\n                             parentProp = model.getProperties().get(element);\n-                            if (SOAPToRESTConstants.RESTRICTION_ATTR.equals(type) && pos == elements.length - 1) {\n-                                model.getProperties().remove(element);\n-                                parentProp = createPropertyFromNode(current, true);\n-                                parentProp.setName(element);\n-                                model.addProperty(element, parentProp);\n+                            if (pos == elements.length - 1) {\n+                                if (SOAPToRESTConstants.RESTRICTION_ATTR.equals(type)) {\n+                                    model.getProperties().remove(element);\n+                                    parentProp = createPropertyFromNode(current, true);\n+                                    parentProp.setName(element);\n+                                    model.addProperty(element, parentProp);\n+                                } else {\n+                                    if (isChildNode(current, prevNode)) {\n+                                        int index = Arrays.asList(elements).indexOf(element);\n+                                        Property parentProperty = null;\n+                                        String parentName = \"\";\n+                                        for (int i = 1; i < index; i++) {\n+                                            parentProperty = model.getProperties().get(elements[index - i]);\n+                                            if (parentProperty != null) {\n+                                                model.getProperties().remove(element);\n+                                                parentName = elements[index - i];\n+                                                break;\n+                                            }\n+                                        }\n+                                        if (parentProperty instanceof ArrayProperty) {\n+                                            if (((ArrayProperty) parentProperty).getItems() != null) {\n+                                                if (parentName.equals(((ArrayProperty) parentProperty).getItems()\n+                                                        .getName())) {\n+                                                    Property objectProperty = new ObjectProperty();\n+                                                    Map propertiesMap = new HashMap();\n+                                                    propertiesMap.put(element, createPropertyFromNode(current, true));\n+                                                    ((ObjectProperty) objectProperty).setProperties(propertiesMap);\n+                                                    ((ArrayProperty) parentProperty).setItems(objectProperty);\n+                                                    parentProp = parentProperty;\n+                                                }\n+                                            } else {\n+                                                ((ArrayProperty) parentProperty)\n+                                                        .setItems(createPropertyFromNode(current, true));\n+                                            }\n+                                        } else if (parentProperty instanceof ObjectProperty) {\n+                                            if (((ObjectProperty) parentProperty).getProperties() != null) {\n+                                                if ((((ObjectProperty) parentProperty).getProperties()).get(parentName) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d24d878130e7f453e981d3d3e2790c535c1554"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1Njk0NzQ4", "url": "https://github.com/wso2/carbon-apimgt/pull/8163#pullrequestreview-355694748", "createdAt": "2020-02-10T05:14:13Z", "commit": {"oid": "c3d24d878130e7f453e981d3d3e2790c535c1554"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNToxNDoxM1rOFnaaCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNToxNDoxM1rOFnaaCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg3MTQzNQ==", "bodyText": "can we just return true? If it is true, no need to loop remaining objects right?", "url": "https://github.com/wso2/carbon-apimgt/pull/8163#discussion_r376871435", "createdAt": "2020-02-10T05:14:13Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/wsdl/WSDL11SOAPOperationExtractor.java", "diffHunk": "@@ -448,6 +522,21 @@ private void addModelDefinition(Node current, ModelImpl model, String type, bool\n         }\n     }\n \n+    private boolean isChildNode(Node current, Node prevNode) {\n+        boolean isChild = false;\n+        if (prevNode.hasChildNodes()) {\n+            NodeList childNodes = prevNode.getChildNodes();\n+            for (int i = 0; i < childNodes.getLength(); i++) {\n+                if (childNodes.item(i).getAttributes() != null && current.getAttributes()\n+                        .getNamedItem(SOAPToRESTConstants.NAME_ATTRIBUTE).getNodeValue().equals(childNodes.item(i)\n+                                .getAttributes().getNamedItem(SOAPToRESTConstants.NAME_ATTRIBUTE).getNodeValue())) {\n+                    isChild = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d24d878130e7f453e981d3d3e2790c535c1554"}, "originalPosition": 178}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab3147c0f92d833c28e013a808c9b4c5a811f6df", "author": {"user": {"login": "vithu30", "name": "Vithursa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ab3147c0f92d833c28e013a808c9b4c5a811f6df", "committedDate": "2020-02-10T06:37:39Z", "message": "Resolve review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzE0NTI5", "url": "https://github.com/wso2/carbon-apimgt/pull/8163#pullrequestreview-355714529", "createdAt": "2020-02-10T06:39:35Z", "commit": {"oid": "ab3147c0f92d833c28e013a808c9b4c5a811f6df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2985, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}