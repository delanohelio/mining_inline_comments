{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NzE1MDU4", "number": 9162, "title": "Fixed the labeling issue in Gateway REST API", "bodyText": "Fixes wso2/product-apim#9025", "createdAt": "2020-08-10T20:28:32Z", "url": "https://github.com/wso2/carbon-apimgt/pull/9162", "merged": true, "mergeCommit": {"oid": "060abd5c0ac214126dba8587367137760dfbd5f4"}, "closed": true, "closedAt": "2020-08-12T14:26:56Z", "author": {"login": "1akshitha"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-KCYHAFqTQ2NTgzMjYxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-MORPABqjM2NDc5NjIyMzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1ODMyNjE1", "url": "https://github.com/wso2/carbon-apimgt/pull/9162#pullrequestreview-465832615", "createdAt": "2020-08-12T11:45:01Z", "commit": {"oid": "2db26d21d670ee9ff7ae5ec990864f34ff7d02cb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMTo0NTowMVrOG_dkRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMTo1MDozN1rOG_dumA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE5Nzg5Mw==", "bodyText": "StringUtils.isnotempty", "url": "https://github.com/wso2/carbon-apimgt/pull/9162#discussion_r469197893", "createdAt": "2020-08-12T11:45:01Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/InMemoryAPIDeployer.java", "diffHunk": "@@ -71,7 +72,7 @@ public boolean deployAPI(String apiId, String gatewayLabel) throws  ArtifactSync\n                 try {\n                     String gatewayRuntimeArtifact = artifactRetriever.retrieveArtifact(apiId, gatewayLabel,\n                             APIConstants.GatewayArtifactSynchronizer.GATEWAY_INSTRUCTION_PUBLISH);\n-                    if (gatewayRuntimeArtifact != null) {\n+                    if (!StringUtils.isEmpty(gatewayRuntimeArtifact)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db26d21d670ee9ff7ae5ec990864f34ff7d02cb"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE5ODE5NQ==", "bodyText": "fix variable naming and same goes here", "url": "https://github.com/wso2/carbon-apimgt/pull/9162#discussion_r469198195", "createdAt": "2020-08-12T11:45:38Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/InMemoryAPIDeployer.java", "diffHunk": "@@ -120,19 +121,20 @@ public boolean deployAllAPIsAtGatewayStartup (Set<String> assignedGatewayLabels)\n                         for (String APIruntimeArtifact :gatewayRuntimeArtifacts){\n                             GatewayAPIDTO gatewayAPIDTO = null;\n                             try {\n-                                if (APIruntimeArtifact != null) {\n+                                if (!StringUtils.isEmpty(APIruntimeArtifact)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db26d21d670ee9ff7ae5ec990864f34ff7d02cb"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIwMDI2MQ==", "bodyText": "JSONArrray", "url": "https://github.com/wso2/carbon-apimgt/pull/9162#discussion_r469200261", "createdAt": "2020-08-12T11:50:00Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -143,9 +148,26 @@ public String retrieveArtifact(String APIId, String gatewayLabel, String gateway\n                 throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n             Map <String, String> apiAttribute = new HashMap<>();\n+\n             JSONObject artifactObject = new JSONObject(responseString);\n-            String apiId = (String)artifactObject.get(APIConstants.GatewayArtifactSynchronizer.API_ID);\n-            String label = (String)artifactObject.get(APIConstants.GatewayArtifactSynchronizer.LABEL);\n+            String label = null;\n+            String apiId = null;\n+            try {\n+                apiId = (String)artifactObject.get(APIConstants.GatewayArtifactSynchronizer.API_ID);\n+                String labelsStr = artifactObject.get(APIConstants.GatewayArtifactSynchronizer.LABELS).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db26d21d670ee9ff7ae5ec990864f34ff7d02cb"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIwMDUzNg==", "bodyText": "can't we catch specific exception", "url": "https://github.com/wso2/carbon-apimgt/pull/9162#discussion_r469200536", "createdAt": "2020-08-12T11:50:37Z", "author": {"login": "tharindu1st"}, "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/gatewayartifactsynchronizer/DBRetriever.java", "diffHunk": "@@ -143,9 +148,26 @@ public String retrieveArtifact(String APIId, String gatewayLabel, String gateway\n                 throw new ArtifactSynchronizerException(\"HTTP response is empty\");\n             }\n             Map <String, String> apiAttribute = new HashMap<>();\n+\n             JSONObject artifactObject = new JSONObject(responseString);\n-            String apiId = (String)artifactObject.get(APIConstants.GatewayArtifactSynchronizer.API_ID);\n-            String label = (String)artifactObject.get(APIConstants.GatewayArtifactSynchronizer.LABEL);\n+            String label = null;\n+            String apiId = null;\n+            try {\n+                apiId = (String)artifactObject.get(APIConstants.GatewayArtifactSynchronizer.API_ID);\n+                String labelsStr = artifactObject.get(APIConstants.GatewayArtifactSynchronizer.LABELS).toString();\n+\n+                Set<String> labelsSet = new Gson().fromJson(labelsStr, new TypeToken<HashSet<String>>(){}.getType());\n+                Set<String> gatewaySubscribedLabel = gatewayArtifactSynchronizerProperties.getGatewayLabels();\n+                if (!labelsSet.isEmpty() || !gatewaySubscribedLabel.isEmpty()){\n+                    labelsSet.retainAll(gatewaySubscribedLabel);\n+                    if (!labelsSet.isEmpty()){\n+                        label = labelsSet.iterator().next();\n+                    }\n+                }\n+            } catch (Exception e ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db26d21d670ee9ff7ae5ec990864f34ff7d02cb"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1OTI2OTg1", "url": "https://github.com/wso2/carbon-apimgt/pull/9162#pullrequestreview-465926985", "createdAt": "2020-08-12T13:41:22Z", "commit": {"oid": "f1fefa5ebc85177015c7bdac17899ebac013acdd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffe9cd706afaaa664fcebf297de83fe9173ee98c", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ffe9cd706afaaa664fcebf297de83fe9173ee98c", "committedDate": "2020-08-12T14:21:46Z", "message": "Fixed the labeling issue in Gateway REST API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06866953854533cc160b083537bbb720201ab3eb", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/06866953854533cc160b083537bbb720201ab3eb", "committedDate": "2020-08-12T14:21:46Z", "message": "Changed the SQL query to return only the labels which has publish state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed3e68de759e36aaf4363d6c26e26e55713241c6", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ed3e68de759e36aaf4363d6c26e26e55713241c6", "committedDate": "2020-08-12T14:21:46Z", "message": "Changed the error codes and responses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fefb8a6b6ed713b63c0feb0e6b9b82a37312e2d", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/3fefb8a6b6ed713b63c0feb0e6b9b82a37312e2d", "committedDate": "2020-08-12T14:21:46Z", "message": "Reformatted the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206712a4ce337c3fd3142972b99a94c9f6fab43a", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/206712a4ce337c3fd3142972b99a94c9f6fab43a", "committedDate": "2020-08-12T14:21:46Z", "message": "Fixed the casting error when the database response is null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bd6796a3f9103622f41d238a40d8496956ff8a0", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/4bd6796a3f9103622f41d238a40d8496956ff8a0", "committedDate": "2020-08-12T14:22:43Z", "message": "Checked for nullity in gateway APIDTO before calling the admin service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a953a60830b7a4d02eb82f7d9b577793a433f3d5", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a953a60830b7a4d02eb82f7d9b577793a433f3d5", "committedDate": "2020-08-12T14:23:14Z", "message": "Addressed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1fefa5ebc85177015c7bdac17899ebac013acdd", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/f1fefa5ebc85177015c7bdac17899ebac013acdd", "committedDate": "2020-08-12T12:20:08Z", "message": "Addressed review comments"}, "afterCommit": {"oid": "a953a60830b7a4d02eb82f7d9b577793a433f3d5", "author": {"user": {"login": "1akshitha", "name": "Lakshitha Gunasekara"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/a953a60830b7a4d02eb82f7d9b577793a433f3d5", "committedDate": "2020-08-12T14:23:14Z", "message": "Addressed review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2486, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}