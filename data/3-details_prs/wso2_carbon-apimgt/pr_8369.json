{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5OTMzMDYy", "number": 8369, "title": "add span related properties", "bodyText": "resolves #wso2/product-apim#7772", "createdAt": "2020-03-17T16:11:47Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8369", "merged": true, "mergeCommit": {"oid": "078ada0f5129b5ec1b20474a3181081630249925"}, "closed": true, "closedAt": "2020-03-17T16:19:29Z", "author": {"login": "tharindu1st"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOlEvKgFqTM3NjE4NjY1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOlKsBgBqjMxMzgwNTU2NDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTg2NjUz", "url": "https://github.com/wso2/carbon-apimgt/pull/8369#pullrequestreview-376186653", "createdAt": "2020-03-17T16:12:41Z", "commit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTg3Mjc4", "url": "https://github.com/wso2/carbon-apimgt/pull/8369#pullrequestreview-376187278", "createdAt": "2020-03-17T16:13:21Z", "commit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoxMzoyMVrOF3jimA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoxMzoyMVrOF3jimA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5ODI5Ng==", "bodyText": "formatting issue", "url": "https://github.com/wso2/carbon-apimgt/pull/8369#discussion_r393798296", "createdAt": "2020-03-17T16:13:21Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/utils/GatewayUtils.java", "diffHunk": "@@ -869,4 +873,34 @@ public static String retrieveJWKSConfiguration(String jwksEndpoint) throws IOExc\n             }\n         }\n     }\n+\n+    public static void setAPIRelatedTags(TracingSpan tracingSpan, org.apache.synapse.MessageContext messageContext) {\n+        org.apache.axis2.context.MessageContext axis2MessageContext =\n+                ((Axis2MessageContext) messageContext).getAxis2MessageContext();\n+        Object restUrlPostfix = axis2MessageContext.getProperty(APIMgtGatewayConstants.REST_URL_POSTFIX);\n+        Object httpMethod = axis2MessageContext.getProperty(Constants.Configuration.HTTP_METHOD);\n+        if (restUrlPostfix != null){\n+            Util.setTag(tracingSpan,APIMgtGatewayConstants.SPAN_REQUEST_PATH, (String) restUrlPostfix);\n+        }\n+        if (httpMethod != null) {\n+            Util.setTag(tracingSpan, APIMgtGatewayConstants.SPAN_REQUEST_METHOD, (String) httpMethod);\n+        }\n+        Object electedResource = messageContext.getProperty(APIMgtGatewayConstants.API_ELECTED_RESOURCE);\n+        if (electedResource != null){\n+            Util.setTag(tracingSpan, APIMgtGatewayConstants.SPAN_RESOURCE, (String) electedResource);\n+        }\n+\n+        setTracingId(tracingSpan, axis2MessageContext);\n+    }\n+\n+    private static void setTracingId(TracingSpan tracingSpan, MessageContext axis2MessageContext) {\n+        Map headersMap =\n+                (Map) axis2MessageContext.getProperty(org.apache.axis2.context.MessageContext.TRANSPORT_HEADERS);\n+        if (headersMap.containsKey(APIConstants.ACTIVITY_ID)){\n+            Util.setTag(tracingSpan, APIMgtGatewayConstants.SPAN_ACTIVITY_ID,\n+                    (String) headersMap.get(APIConstants.ACTIVITY_ID));\n+        }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTg4MTI2", "url": "https://github.com/wso2/carbon-apimgt/pull/8369#pullrequestreview-376188126", "createdAt": "2020-03-17T16:14:18Z", "commit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoxNDoxOFrOF3jlVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoxNDoxOFrOF3jlVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5ODk5Nw==", "bodyText": "seems these new imports are not using", "url": "https://github.com/wso2/carbon-apimgt/pull/8369#discussion_r393798997", "createdAt": "2020-03-17T16:14:18Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.tracing/src/main/java/org/wso2/carbon/apimgt/tracing/Util.java", "diffHunk": "@@ -25,6 +25,8 @@\n import io.opentracing.propagation.TextMapExtractAdapter;\n import io.opentracing.propagation.TextMapInjectAdapter;\n import io.opentracing.util.GlobalTracer;\n+import org.apache.axis2.context.MessageContext;\n+import org.wso2.carbon.apimgt.impl.APIConstants;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTg4NzQ0", "url": "https://github.com/wso2/carbon-apimgt/pull/8369#pullrequestreview-376188744", "createdAt": "2020-03-17T16:14:57Z", "commit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoxNDo1N1rOF3jnGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoxNDo1N1rOF3jnGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5OTQ1MA==", "bodyText": "there are multiple formatting issues in this method", "url": "https://github.com/wso2/carbon-apimgt/pull/8369#discussion_r393799450", "createdAt": "2020-03-17T16:14:57Z", "author": {"login": "ruks"}, "path": "components/apimgt/org.wso2.carbon.apimgt.gateway/src/main/java/org/wso2/carbon/apimgt/gateway/utils/GatewayUtils.java", "diffHunk": "@@ -869,4 +873,34 @@ public static String retrieveJWKSConfiguration(String jwksEndpoint) throws IOExc\n             }\n         }\n     }\n+\n+    public static void setAPIRelatedTags(TracingSpan tracingSpan, org.apache.synapse.MessageContext messageContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2b109347d7e7a7499f56a869c015d05a8f25cb0", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/f2b109347d7e7a7499f56a869c015d05a8f25cb0", "committedDate": "2020-03-17T16:19:01Z", "message": "add span related properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e8df9314bc8b27fe284be2325b03c4e71e0b214", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/6e8df9314bc8b27fe284be2325b03c4e71e0b214", "committedDate": "2020-03-17T16:10:57Z", "message": "add span related properties"}, "afterCommit": {"oid": "f2b109347d7e7a7499f56a869c015d05a8f25cb0", "author": {"user": {"login": "tharindu1st", "name": "Tharindu Dasun Dharmarathna"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/f2b109347d7e7a7499f56a869c015d05a8f25cb0", "committedDate": "2020-03-17T16:19:01Z", "message": "add span related properties"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2870, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}