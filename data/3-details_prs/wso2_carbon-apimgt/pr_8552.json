{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNzcyNDIy", "number": 8552, "title": "Allow create/update endpoint registry entry when no definition file/url provided", "bodyText": "", "createdAt": "2020-05-22T07:52:55Z", "url": "https://github.com/wso2/carbon-apimgt/pull/8552", "merged": true, "mergeCommit": {"oid": "53f7a7f2db7fe97a11b423d90ab8cc9a20f53819"}, "closed": true, "closedAt": "2020-05-22T12:35:05Z", "author": {"login": "ChamodDamitha"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjuQvagBqjMzNjM4NDEyMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8I19ZgFqTQ2MjE5NDMwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3fcf9f38a2672fbe0a652d53b010ee2351db7644", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/3fcf9f38a2672fbe0a652d53b010ee2351db7644", "committedDate": "2020-05-22T08:45:03Z", "message": "Allow create/update endpoint registry entry when no definition file/url  provided"}, "afterCommit": {"oid": "54f755af115f53e84f0be6812a138cbbe516a75c", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/54f755af115f53e84f0be6812a138cbbe516a75c", "committedDate": "2020-05-22T08:47:03Z", "message": "Allow create/update endpoint registry entry when no definition file/url  provided"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2Nzg1NzUx", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#pullrequestreview-416785751", "createdAt": "2020-05-22T09:48:04Z", "commit": {"oid": "54f755af115f53e84f0be6812a138cbbe516a75c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo0ODowNFrOGZRTJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo0ODowNFrOGZRTJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MTAxNQ==", "bodyText": "set defaults if not provided", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429151015", "createdAt": "2020-05-22T09:48:04Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/util/EndpointRegistryMappingUtils.java", "diffHunk": "@@ -43,8 +43,12 @@ public static EndpointRegistryInfo fromDTOtoEndpointRegistry(RegistryDTO registr\n         EndpointRegistryInfo registry = new EndpointRegistryInfo();\n         registry.setName(registryDTO.getName());\n         registry.setOwner(owner);\n-        registry.setType(registryDTO.getType().toString());\n-        registry.setMode(registryDTO.getMode().toString());\n+        if (registryDTO.getType() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54f755af115f53e84f0be6812a138cbbe516a75c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2Nzg3OTY1", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#pullrequestreview-416787965", "createdAt": "2020-05-22T09:51:43Z", "commit": {"oid": "54f755af115f53e84f0be6812a138cbbe516a75c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo1MTo0M1rOGZRZpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTo1MTo0M1rOGZRZpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MjY3Ng==", "bodyText": "shall we introduce a method to create a registryEntry when parameters are given? also another method to return a registryEntry with some default values.", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429152676", "createdAt": "2020-05-22T09:51:43Z", "author": {"login": "fazlan-nazeem"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -817,6 +856,57 @@ public void updateRegistryEntryWithDefinitionUrl() throws APIManagementException\n         compareRegistryEntryDTOs(payloadEntryDTO, responseEntryDTO);\n     }\n \n+    @Test\n+    public void updateRegistryEntryWithNoDefinitionFileAndUrl() throws APIManagementException {\n+        final String REGISTRY_UUID = \"reg1\";\n+\n+        EndpointRegistryInfo endpointRegistryInfo = new EndpointRegistryInfo();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54f755af115f53e84f0be6812a138cbbe516a75c"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54f755af115f53e84f0be6812a138cbbe516a75c", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/54f755af115f53e84f0be6812a138cbbe516a75c", "committedDate": "2020-05-22T08:47:03Z", "message": "Allow create/update endpoint registry entry when no definition file/url  provided"}, "afterCommit": {"oid": "2e5287d5bc7f50e5420792f0258baaa2a5b2905d", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/2e5287d5bc7f50e5420792f0258baaa2a5b2905d", "committedDate": "2020-05-22T11:34:21Z", "message": "Update endpoint registry test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bb8978e4b4fb83f981a667e22774a38daba4209", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/6bb8978e4b4fb83f981a667e22774a38daba4209", "committedDate": "2020-05-22T11:38:02Z", "message": "Fix NPE in endpoint registry/entry DTO mapping functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddfe7a37899a76ce7d8e81c48f1f0497fbe78de7", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/ddfe7a37899a76ce7d8e81c48f1f0497fbe78de7", "committedDate": "2020-05-22T11:38:02Z", "message": "Allow create/update endpoint registry entry when no definition file/url  provided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "committedDate": "2020-05-22T11:45:28Z", "message": "Update endpoint registry test cases"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e5287d5bc7f50e5420792f0258baaa2a5b2905d", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/2e5287d5bc7f50e5420792f0258baaa2a5b2905d", "committedDate": "2020-05-22T11:34:21Z", "message": "Update endpoint registry test cases"}, "afterCommit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "author": {"user": {"login": "ChamodDamitha", "name": "Chamod Damitha Samarajeewa"}}, "url": "https://github.com/wso2/carbon-apimgt/commit/e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "committedDate": "2020-05-22T11:45:28Z", "message": "Update endpoint registry test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2ODc1MjUy", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#pullrequestreview-416875252", "createdAt": "2020-05-22T12:34:56Z", "commit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTcxMTkz", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#pullrequestreview-462171193", "createdAt": "2020-08-06T04:00:48Z", "commit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNDowMDo0OFrOG8ib5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNDowMDo0OFrOG8ib5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMTk0MQ==", "bodyText": "Shall we move \"user1\" to line 233?", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r466131941", "createdAt": "2020-08-06T04:00:48Z", "author": {"login": "Meruja"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -263,23 +228,12 @@ public void addRegistry_ResourceNameExists() throws APIManagementException {\n \n     @Test\n     public void updateRegistry() throws APIManagementException {\n-        EndpointRegistryInfo endpointRegistryInfoOld = new EndpointRegistryInfo();\n-        endpointRegistryInfoOld.setName(\"Endpoint Registry 1\");\n-        endpointRegistryInfoOld.setUuid(\"abc1\");\n-        endpointRegistryInfoOld.setMode(RegistryDTO.ModeEnum.READWRITE.toString());\n-        endpointRegistryInfoOld.setType(RegistryDTO.TypeEnum.ETCD.toString());\n-        endpointRegistryInfoOld.setOwner(ADMIN_USERNAME);\n-\n-        RegistryDTO payloadDTO = new RegistryDTO();\n-        payloadDTO.setName(\"Endpoint Registry 2\");\n-        payloadDTO.setId(\"abc1\");\n-        payloadDTO.setMode(RegistryDTO.ModeEnum.READONLY);\n-        payloadDTO.setType(RegistryDTO.TypeEnum.WSO2);\n-        payloadDTO.setOwner(ADMIN_USERNAME);\n-\n-        EndpointRegistryInfo endpointRegistryInfoNew =\n-                EndpointRegistryMappingUtils.fromDTOtoEndpointRegistry(payloadDTO, ADMIN_USERNAME);\n-        endpointRegistryInfoNew.setUuid(\"abc1\");\n+        EndpointRegistryInfo endpointRegistryInfoOld = createRegistryWithDefaultParams();\n+        EndpointRegistryInfo endpointRegistryInfoNew = createRegistry(endpointRegistryInfoOld.getUuid(), 2,\n+                \"Endpoint Registry 2\", RegistryDTO.ModeEnum.READWRITE, RegistryDTO.TypeEnum.ETCD,\n+                \"user1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTcxMjM0", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#pullrequestreview-462171234", "createdAt": "2020-08-06T04:01:01Z", "commit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNDowMTowMVrOG8icCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNDowMTowMVrOG8icCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMTk3Ng==", "bodyText": "Shall we move \"user1\" to line 256?", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r466131976", "createdAt": "2020-08-06T04:01:01Z", "author": {"login": "Meruja"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -297,23 +251,12 @@ public void updateRegistry() throws APIManagementException {\n \n     @Test\n     public void updateRegistry_existingName() throws APIManagementException {\n-        EndpointRegistryInfo endpointRegistryInfoOld = new EndpointRegistryInfo();\n-        endpointRegistryInfoOld.setName(\"Endpoint Registry 1\");\n-        endpointRegistryInfoOld.setUuid(\"abc1\");\n-        endpointRegistryInfoOld.setMode(RegistryDTO.ModeEnum.READWRITE.toString());\n-        endpointRegistryInfoOld.setType(RegistryDTO.TypeEnum.ETCD.toString());\n-        endpointRegistryInfoOld.setOwner(ADMIN_USERNAME);\n-\n-        RegistryDTO payloadDTO = new RegistryDTO();\n-        payloadDTO.setName(\"Endpoint Registry 2\");\n-        payloadDTO.setId(\"abc1\");\n-        payloadDTO.setMode(RegistryDTO.ModeEnum.READONLY);\n-        payloadDTO.setType(RegistryDTO.TypeEnum.WSO2);\n-        payloadDTO.setOwner(ADMIN_USERNAME);\n-\n-        EndpointRegistryInfo endpointRegistryInfoNew =\n-                EndpointRegistryMappingUtils.fromDTOtoEndpointRegistry(payloadDTO, ADMIN_USERNAME);\n-        endpointRegistryInfoNew.setUuid(\"abc1\");\n+        EndpointRegistryInfo endpointRegistryInfoOld = createRegistryWithDefaultParams();\n+        EndpointRegistryInfo endpointRegistryInfoNew = createRegistry(endpointRegistryInfoOld.getUuid(), 2,\n+                \"Endpoint Registry 2\", RegistryDTO.ModeEnum.READWRITE, RegistryDTO.TypeEnum.ETCD,\n+                \"user1\");\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e"}, "originalPosition": 140}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTk0MzA5", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#pullrequestreview-462194309", "createdAt": "2020-08-06T05:19:43Z", "commit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNToxOTo0M1rOG8jqjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNToxOTo0M1rOG8jqjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE1MjA3OQ==", "bodyText": "Shall we declare variables for \"Entry Name 2\", \"{mutualTLS: false}\" and \"https://xyz2.com\"?\nIt has been used in many places.", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r466152079", "createdAt": "2020-08-06T05:19:43Z", "author": {"login": "Meruja"}, "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -914,26 +685,18 @@ public void getAllEntriesInRegistry() throws APIManagementException {\n \n         List<EndpointRegistryEntry> endpointRegistryEntryList = new ArrayList<>();\n \n-        EndpointRegistryEntry endpointRegistryEntry1 = new EndpointRegistryEntry();\n-        endpointRegistryEntry1.setEntryId(\"entry1\");\n-        endpointRegistryEntry1.setName(\"Entry Name 1\");\n-        endpointRegistryEntry1.setMetaData(\"{mutualTLS: true}\");\n-        endpointRegistryEntry1.setProductionServiceURL(\"https://xyz.com\");\n-        endpointRegistryEntry1.setServiceType(RegistryEntryDTO.ServiceTypeEnum.REST.toString());\n-        endpointRegistryEntry1.setServiceCategory(RegistryEntryDTO.ServiceCategoryEnum.UTILITY.toString());\n-        endpointRegistryEntry1.setDefinitionURL(\"https://petstore.swagger.io/v2/swagger.json\");\n-        endpointRegistryEntry1.setDefinitionType(RegistryEntryDTO.DefinitionTypeEnum.OAS.toString());\n+        EndpointRegistryEntry endpointRegistryEntry1 = createRegistryEntry(\"entry1\", \"Entry Name 1\",\n+                \"{mutualTLS: true}\", \"https://xyz.com\",\n+                RegistryEntryDTO.ServiceTypeEnum.REST, RegistryEntryDTO.ServiceCategoryEnum.UTILITY,\n+                \"https://petstore.swagger.io/v2/swagger.json\", RegistryEntryDTO.DefinitionTypeEnum.OAS,\n+                null);\n         endpointRegistryEntryList.add(endpointRegistryEntry1);\n \n-        EndpointRegistryEntry endpointRegistryEntry2 = new EndpointRegistryEntry();\n-        endpointRegistryEntry2.setEntryId(\"entry2\");\n-        endpointRegistryEntry2.setName(\"Entry Name 2\");\n-        endpointRegistryEntry2.setMetaData(\"{mutualTLS: true}\");\n-        endpointRegistryEntry2.setProductionServiceURL(\"https://xyz2.com\");\n-        endpointRegistryEntry2.setServiceType(RegistryEntryDTO.ServiceTypeEnum.SOAP_1_1.toString());\n-        endpointRegistryEntry2.setServiceCategory(RegistryEntryDTO.ServiceCategoryEnum.DOMAIN.toString());\n-        endpointRegistryEntry2.setDefinitionURL(\"https://petstore.swagger.io/v2/swagger2.json\");\n-        endpointRegistryEntry2.setDefinitionType(RegistryEntryDTO.DefinitionTypeEnum.GQL_SDL.toString());\n+        EndpointRegistryEntry endpointRegistryEntry2 = createRegistryEntry(\"entry2\", \"Entry Name 2\",\n+                \"{mutualTLS: false}\", \"https://xyz2.com\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e"}, "originalPosition": 744}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2782, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}